function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.112774429749013e-02   +4.458092401086679e-02   +3.038904968938839e-02   +3.218823169195079e-02   -4.168439295132402e-02   +9.262633049196348e-04   -9.919296900626955e-04   +9.633877829193812e-03   +2.258269370962532e-04   +2.737628096070188e-02   -8.349857118766955e-03   -1.689132387605727e-03   +1.440257241988534e-02   +3.390576900895154e-02   +8.521051686410451e-03   -4.278963773384483e-02; +2.979682143936725e-03   -3.678836603351106e-02   +1.444486867220480e-02   -1.484642935487307e-02   -1.462061142676209e-02   +4.247897479312734e-02   -2.526991820752325e-02   -2.584357314234297e-02   +2.253102439620623e-02   -6.193911222484895e-03   +1.685589827123503e-02   -5.303480941651041e-03   +7.872713868787122e-03   +4.452159517573279e-03   -1.469487276940023e-02   +4.877259576760300e-02; -2.661308091948845e-03   -5.567301164847920e-02   +7.722366042728107e-03   +4.273530963918002e-02   +1.914542390443266e-03   -1.068707103797139e-02   -3.407720126298038e-02   +6.296661271975815e-03   -7.671983271301491e-02   +7.457411430594464e-04   +2.451835289768283e-02   -1.440818927194109e-02   +5.995740741838859e-02   -2.327231494573787e-03   +4.892995700209778e-02   +7.678187844342455e-03; +3.552953561640451e-02   +1.392048194907753e-02   -3.770193226324625e-02   +5.440998622047950e-02   -3.760107230283426e-03   +2.858076085901621e-03   +2.202947419486889e-02   -1.312859866185001e-02   +2.105549961353431e-02   +9.960729553732145e-03   +2.792969894470392e-03   +6.227076006204249e-03   -3.307264772020657e-02   +6.264077960751116e-02   -1.551252876006703e-02   +6.782391348184462e-02; +1.989101247359265e-02   -1.966012770508174e-02   -4.105277740481059e-02   -3.487092842953798e-02   -5.774707295503206e-02   +4.403332944469479e-02   +9.671585199710632e-03   +2.362394226133515e-02   +4.430257309832351e-02   +1.437435215109809e-02   +4.474440705576546e-02   -8.364465729518707e-03   +2.220459555714101e-02   +8.516089805297776e-03   -2.959627992626438e-02   -2.717926654284391e-02; -2.191003205321844e-02   +1.659613679524249e-02   +6.522735423873202e-02   +1.945265008959876e-02   +8.145694839373947e-03   +2.323106604087433e-02   +5.054388992057132e-02   -6.017087936667523e-03   +2.855226898225919e-02   -7.924245037096737e-04   +3.768565261860991e-02   +5.520760529914125e-02   -1.949293734516210e-02   +9.095492316638882e-03   -3.511316161828874e-02   -3.800742774032588e-03; +2.316417361513577e-02   +5.776124353864267e-02   +7.463103311933159e-03   +8.734679831742509e-03   +5.189635677137622e-02   -4.480317816762749e-02   -5.356987452703268e-02   -8.167702871444183e-03   -2.636057824880252e-02   -4.225453751781839e-02   +1.218247782033977e-02   +5.957735298487883e-02   -1.270967620603873e-02   +2.188652943623793e-02   +1.345978111122139e-03   +6.447193523567532e-02; +9.559802503328312e-02   +3.843625355437773e-02   +3.775841468173390e-02   -5.568177641003541e-02   -4.987055841091671e-02   +6.784424712286929e-02   +2.837520474238396e-02   +3.534369127446271e-02   -5.939958971818514e-02   -2.979242987460248e-02   +4.716660291320460e-02   -6.566385459323271e-03   +4.421323101358459e-03   +4.321017656598921e-02   +2.027219961497443e-02   -7.301875861433529e-02; -6.926996053543955e-02   +2.100245208583654e-03   -2.179936041709008e-03   -3.515647260139708e-02   +3.369498776771077e-03   +3.919841361814765e-02   -4.816885338057280e-03   +5.072807288476502e-02   -8.312463834923978e-03   -2.325050374690782e-02   -4.251280120700739e-03   -7.290954077488515e-02   +1.530749188468327e-02   -3.918060597189810e-02   -1.178174521904133e-02   +9.035491672233106e-03; +4.782368290750429e-02   -7.350597560997895e-03   +1.472768993121516e-02   +1.175243351865554e-02   +2.046013601742586e-02   +3.063378059521928e-02   +7.408640242936168e-02   -7.708550237932182e-03   +2.790894298844104e-02   -3.517773459209191e-02   +3.129413027216105e-02   -8.842874083088467e-03   +2.860448042779356e-02   +6.696892956843781e-02   -5.241383710608071e-02   -3.854141177874314e-02; +7.699178903271671e-02   -3.202031735707734e-02   +4.324557986333469e-04   +4.008556711340255e-02   -2.746289374078513e-02   +6.965625988110595e-02   -4.639700994298473e-02   -3.655148455156890e-02   +2.545808709311905e-02   +2.013238389219422e-02   -3.457608691380299e-03   +2.732545492398244e-02   +3.352690520890241e-02   -4.678948396108558e-02   -6.687767470510412e-03   +5.323138638685533e-03; -5.736002913546139e-02   -2.432806947021284e-02   +1.171218641259121e-02   -3.104432345077587e-02   -8.154093157219613e-03   +2.097580775891020e-02   +5.952796217946083e-03   +4.666181802887264e-02   -3.543293652199516e-03   +8.776300789390522e-03   -1.418386697275182e-02   -1.382617223310066e-02   +5.128849483925363e-02   +2.612589172615591e-03   -1.084328508684660e-02   -4.118163574853946e-02; +3.276621423505752e-03   +1.785262768027121e-02   -7.318692700763140e-03   +4.294181595124626e-02   -2.177882074984505e-02   +1.187772610656327e-02   -1.015170028104658e-02   -5.066025785972849e-02   +1.046632068752662e-01   -3.881383011356322e-02   +1.656030080848123e-02   -2.459042218484220e-02   +6.076448846656721e-02   -4.848904392305285e-03   +3.403136206638816e-02   -3.203497405493864e-02; +2.045055409763640e-03   +1.229295086934587e-03   -7.353302735241438e-03   -9.324376326914238e-03   +2.832094035546456e-02   -4.163995736501942e-02   -8.463064076337424e-03   -2.268091384953538e-02   -2.588181856986490e-02   +5.688353521790167e-02   -3.985066562602600e-02   -5.663718103307234e-02   +2.075244811634765e-02   -4.467702403784164e-02   +2.674998526131954e-02   +1.585779159090833e-02; -1.377892638320890e-02   +1.767811906110203e-02   +2.022793064859884e-02   -2.798654016365050e-02   +6.168808727731384e-02   -1.868292894551314e-02   -4.547743900196211e-02   +3.371005188648279e-02   +3.899035885283409e-02   +5.227588328395970e-02   +5.269613992414543e-02   +8.425466771298466e-03   -1.384714869933487e-02   +4.170029680973444e-02   +4.069401312221078e-02   +2.292913458106382e-02; -7.192485235872845e-02   +7.058374011993114e-03   -8.999404990835697e-04   -3.571026117363531e-03   -4.096620500797572e-02   -2.876712497513081e-02   -6.627079448994705e-02   -2.844365072966866e-02   +4.450542236591595e-02   +3.921994741028800e-02   -3.617922025909616e-02   +3.330918300428844e-02   -6.727145896339733e-02   -4.033197429203133e-02   -2.295300497852618e-02   +1.373401777403273e-02];
L1E_L1I_iGABA_netcon = [+4.187164282083529e-02   +7.025211509174456e-02   -3.728161419292188e-03   -1.497190648680461e-02   -3.981810211002636e-03   +1.915277062276905e-02   -1.572606430702686e-03   +6.496323703419928e-02   -2.621601483025631e-03   -2.801977366407855e-02   -4.468096371598612e-03   +1.160868179535353e-02   -1.694645719838223e-02   +2.800541379091146e-02   -4.575890001475348e-02   +2.089565818852032e-02; +7.201097811975249e-02   -4.773986008945885e-02   +5.524741088432013e-02   +1.188605476014918e-02   +1.096848609388340e-02   -6.665662902482153e-02   +3.035159053191602e-03   -4.325487297088617e-02   +6.626701188184798e-02   -6.627974064184625e-03   -3.726036086000813e-02   +4.670691732775333e-02   -9.496700907442208e-03   +7.531194121642390e-02   +1.393757071271912e-02   -2.624403441657426e-02; +1.906570901745280e-02   -1.092346523363247e-02   -2.438635175789959e-02   +4.677240815429240e-02   -2.628862587246220e-02   +2.906044699044570e-02   -8.725809880002004e-02   +4.612249056606808e-02   +1.784571576108544e-02   -6.767611068505432e-02   +6.070858507365690e-03   -7.349817985636357e-03   +1.780932670282424e-02   -6.222205483626046e-02   -3.340164148316003e-02   +2.204000063015931e-02; -7.267368200434003e-02   +4.167581650915987e-02   -6.404733619185592e-02   -3.021519649356688e-02   +2.396857647402461e-02   -2.386142943135686e-02   -3.810392852614753e-02   +8.149494835255414e-03   +3.091658394119368e-03   -4.799000016427919e-02   +4.856899472314619e-02   +5.240901349960685e-02   +1.393880764494452e-02   -1.405401676384299e-02   +7.428275693895080e-02   -1.690234806841139e-02; -1.173287684905001e-02   -7.842730527491534e-03   +3.626844904524799e-02   +7.113050316045805e-02   +9.041231485427159e-03   +3.085774751265065e-02   +1.401463410742286e-03   +2.312269508708878e-02   +1.646372147515028e-02   -5.194595484318656e-03   +3.055111057245740e-02   +1.274131968717519e-02   -8.473136866019026e-04   -5.964478000401332e-02   +2.609652654371020e-02   -7.761090913169968e-03; -2.761359475776156e-02   -1.153301458042703e-03   +3.739485320946182e-03   -2.282851390550345e-02   +4.089942068966593e-03   -3.741147016056803e-02   +9.177795233120070e-02   +9.807768886673405e-03   -3.358287526810551e-02   +6.399304009168021e-02   +2.011621422033734e-02   -3.976609433870746e-03   +3.497353605807293e-02   +3.419460397820536e-02   -1.325102211159475e-02   -3.926242285940199e-02; -4.246779207428316e-02   +2.258595484149422e-02   -3.149459405193242e-02   -5.770218671647170e-02   -5.969428917754110e-02   +7.511295163700799e-02   -4.566840502504997e-02   +9.717914713389116e-02   +2.266316395999058e-02   +6.359353648627884e-02   -4.148947476004900e-02   -6.291171537453377e-02   +2.615548900337051e-02   -4.570028690601899e-02   -1.756578211168760e-02   -3.172077875632830e-03; +5.871896837316695e-03   +5.079310049530089e-02   +1.199600660799429e-02   -1.684249937332181e-02   -2.275309751962915e-02   +3.363484440439232e-02   +4.166256771139595e-02   -6.458410581646860e-03   -3.841651527680010e-02   +2.088079306366647e-02   -5.343324907568062e-02   +4.047724943929894e-02   -3.120259101464640e-02   +2.234042850326371e-02   +5.002297567068406e-02   +2.257348378767284e-02; -5.784065927813053e-02   -1.044351948581392e-01   +3.699305610597552e-04   +7.339257097786107e-02   +1.032365949890404e-02   -3.666777475999420e-02   +2.066032137540757e-02   -6.096085046169668e-02   -7.455463255209399e-02   -2.978007268377751e-02   -2.952729359433975e-04   +6.572012110361056e-03   +1.560754151347875e-02   +2.403146796648601e-03   -5.722313646352558e-03   +8.408887500998691e-03; -1.113039617468836e-02   -4.683311746779122e-02   -8.052544637973351e-03   +6.961864013889625e-02   -7.038350829049909e-02   +3.235812713471854e-02   -5.663818064424129e-02   +1.187205788317680e-03   +2.095118595018458e-02   -2.651955616521708e-03   -3.954014433597464e-02   -2.369370644881548e-02   +3.503577073613334e-02   -7.067203741191320e-02   +3.126130200106281e-02   -5.765408085513200e-03; +1.953126869899040e-02   +3.497252794877164e-02   +6.274372591792224e-02   +8.828772439318372e-05   +5.366534393774910e-02   -6.475702621356742e-02   -1.733023414126248e-02   -5.398575456308667e-02   +3.410325237724578e-02   +2.141407078221542e-02   -3.252330992980670e-02   -6.103476498329863e-02   -5.508675748992038e-02   +1.348936335155637e-02   +2.583628486105216e-02   -7.997235512904738e-04; -5.182049322584007e-02   +6.226461814341984e-03   -6.387476820581074e-02   +3.702161111660003e-03   -1.412853014387739e-02   -2.779295045408297e-02   -1.797208439491236e-02   -3.915720484968223e-02   +1.754596060085910e-02   +3.438093144242781e-02   -4.784657381399168e-02   +2.047620821570981e-02   +4.459491984079553e-02   +6.211635694450181e-04   +4.491350052521724e-02   -1.245718362507679e-02; +3.674500432367524e-02   +7.071510366991676e-02   -1.585099994691249e-02   -9.627525740691020e-03   +3.231485704856561e-02   +6.999985690761232e-02   -1.323000593289162e-02   -8.637068251904479e-03   -2.701261100349431e-02   +4.155205005024917e-03   +2.667845008969886e-02   -1.311724833950969e-02   +2.086473238416734e-02   -5.405443989275824e-04   -1.111513161732913e-01   +5.979952900528734e-02; +6.435065218535584e-02   -2.305034113215670e-02   -1.629453081617319e-02   -7.207183696302372e-03   -4.191405522704698e-02   -1.946452781298079e-02   -1.261804316405939e-02   -1.694705543180776e-02   +1.119842690277913e-02   -4.907195935974924e-03   -5.691127828064373e-02   -2.728812131798948e-02   +3.490399941973320e-02   -2.984130164254091e-02   +7.670837819536137e-03   -3.834558090194490e-02; -3.454765543868749e-02   -4.578429259728529e-02   -2.057019557396496e-02   -3.050045877156151e-02   +2.447281505826681e-02   +5.858325715287149e-02   +2.651370250949295e-02   -7.294363580250958e-03   +6.447069223886728e-02   +5.278453502752618e-02   +6.734459508856795e-02   +3.834206167537522e-02   +2.406957277702818e-02   +3.959559388785779e-02   +2.629119180228350e-02   -3.916591657327152e-02; +1.550173853797776e-02   +7.372928505216751e-02   +5.807786466376524e-02   +6.240359985194224e-03   -6.921495033003723e-03   +3.682270664347363e-03   -2.377649070477128e-02   -1.769006577949570e-02   -2.104264336797820e-02   +1.117472271516252e-02   -1.056286642422328e-02   -5.789686825556746e-03   -3.709909564510050e-02   -1.999222305205559e-02   -1.006169939503515e-02   -1.681142254132438e-02];
L2I_L1I_iGABA_netcon = [-1.447684972818158e-02   -7.431724660190431e-02   +1.919344148227624e-02   -3.292433989682121e-02   -6.352345468155804e-02   +4.600528074845936e-02   +3.761682244570685e-02   -9.428120836853383e-03; +7.577286761160224e-03   +4.300779848251948e-02   -3.392628460193262e-02   +2.583613535984480e-02   -1.216888912484981e-02   +4.647168292093509e-02   +3.027484034782903e-02   -4.590555892239231e-02; -4.878589624182549e-02   -2.251159814190458e-02   +2.490275953472940e-02   +2.522926884316458e-02   -3.874329635077909e-02   +2.372576958676683e-03   -6.468728019532244e-02   -4.173332308076023e-02; -1.157932994223466e-02   +1.466788493937100e-02   -5.450720666341691e-02   +5.050083677065780e-02   -9.620364048449501e-03   +3.464950416371113e-02   +6.030522000575832e-02   +1.499110490710469e-02; -4.202382784060126e-02   +2.048328500725481e-02   +4.686747768028824e-03   +3.838169883166651e-02   +3.170050933562036e-03   -3.774121015362800e-02   -2.179309647941899e-03   -3.011042836891445e-03; +2.783748412232253e-02   +5.413730463961556e-02   +1.321142413167844e-02   +6.036910012885147e-02   -9.881683127352971e-03   +3.378311581011836e-02   -5.789152772024839e-02   +2.086210544157972e-02; +1.293323761882264e-02   +2.481922818500185e-02   +4.308715948169353e-02   +1.175931906751783e-02   +6.659610122680859e-02   +2.185853289058803e-02   -7.919566823339372e-03   +5.580326263484187e-02; -2.356644104626037e-02   -3.890684712575818e-02   +6.691383639512832e-03   -6.112738761968581e-02   -3.826315930429894e-02   +5.421784723196708e-02   -1.043353812163175e-02   -1.512801599194803e-02; -2.982670344968216e-02   -7.985474637316080e-02   -2.215489811438334e-02   +2.105633686237849e-02   +2.068858124507311e-02   -2.510443109344107e-03   +6.697796099817091e-02   +1.591320794717872e-02; +2.750925759863088e-02   +2.520633816862553e-02   +1.224463690832634e-02   -2.253168241858942e-02   -5.429043436216588e-02   -1.190157685820136e-02   +5.078090802900330e-04   -1.628308728246364e-02; -2.746603245803006e-02   +4.347673359622539e-02   +4.851368448048066e-02   -1.395648866750896e-02   +1.921937520153305e-02   +1.037915582715997e-02   +2.493308988364957e-02   +1.182680512930590e-02; -7.998918320634749e-03   -5.129435354527061e-02   -2.472026124157864e-02   +1.445440005486980e-02   +8.921356694243918e-02   +5.898866173951374e-02   -2.015484447388155e-02   -2.312056060240554e-02; +7.903432771842504e-02   +5.624499484961249e-03   -1.176287008628067e-02   -3.834003880223497e-03   +2.360694964846987e-02   +5.085357377453033e-02   -5.342523849679486e-02   -5.406120460487909e-02; +2.838982576576164e-02   -1.232781428595458e-02   -5.736849036350879e-02   +5.960616986593750e-02   -4.351866358468966e-02   -2.803672985520273e-03   +1.394484924484353e-02   +1.420522334901859e-02; +2.694876293599400e-02   -1.781621399456351e-02   -3.868890880399260e-02   -2.134036472602111e-02   -3.135137223182588e-02   +4.793160603135625e-02   -3.651035553999282e-03   -5.866208547240643e-03; +2.922169650753765e-02   -4.253989404197300e-03   -2.813597199598446e-02   -2.080532859221478e-02   +4.699997067686510e-03   -4.801364066680854e-02   -3.279044585807040e-02   +7.690117630140623e-03];
L1I_L2I_iGABA_netcon = [-5.036609272394525e-02   -9.082368489546459e-04   +4.604293123310507e-02   -4.277273075203658e-02   -4.881488511404441e-02   +4.648952657138286e-02   -1.639397243954283e-03   -2.676667378035176e-02   +4.049102035936417e-02   +6.181669716678025e-03   -3.717615591385413e-03   +1.071040536768276e-02   -2.355844557021869e-02   -3.622319543736156e-02   -8.581339045999929e-02   -7.468783529685109e-02; +3.408842738073555e-02   +4.860939690549418e-03   +1.614101607664878e-02   -3.890763562232268e-03   -7.749028182841948e-02   -6.762923992702100e-04   -2.432739644920688e-02   -2.830054927575947e-02   +7.778525201714785e-02   -3.412974984015981e-03   -2.336278033483931e-02   +1.787130612108513e-02   -1.315431174618913e-02   +3.868931844963378e-02   +1.713269266806246e-02   -5.917518614862801e-03; +1.836754149566255e-02   -2.624131550113091e-02   +6.934703322332476e-03   -3.461479192509880e-02   +8.131239504578353e-03   +3.921135667950263e-02   +1.010226040796380e-04   +1.024546800000492e-02   +1.242174177094572e-02   +5.224449214393992e-02   +3.037587478008700e-02   +2.527503817156877e-02   -3.926776938329639e-02   -1.398255604381260e-02   -2.175796135697583e-02   +1.951488338419794e-02; +1.540534236622208e-03   -3.270624614991705e-03   +3.768512019706846e-02   -5.549938017412250e-03   -2.324797446914217e-02   -2.837313998483212e-02   -4.415883192762952e-02   -1.000447469664604e-02   -5.720210522648070e-02   -2.632325562827555e-02   -4.800879367277079e-03   +6.471512243409321e-03   +1.288777183362653e-03   +4.225516248769215e-02   +7.231411543469869e-02   -5.539291911466477e-03; +1.182924670794463e-02   -1.575577576823867e-02   -6.352200879545584e-03   +3.910732848498971e-02   +2.577392313555954e-02   +3.628625618126928e-02   +5.748724499638402e-03   -1.836178328242890e-02   +7.904655189873883e-02   +6.817685401938868e-02   +3.357097241695705e-02   +3.725272808648186e-02   -3.936241338424577e-02   +2.987985722641896e-02   -3.568819378271514e-02   +3.011188402941385e-03; +3.564058352126704e-02   +7.527377093349913e-02   -3.419313332941013e-02   +2.253537525296540e-02   -1.454418790796934e-02   -6.257063694589594e-03   +7.756940812827416e-02   -1.020521945988967e-02   +1.792467030197765e-02   +5.904252331586793e-03   +4.964868985640566e-02   -7.175181133052698e-03   +3.906020661376910e-02   +4.175112353505765e-02   -1.307468602329176e-02   -6.357881627111160e-02; +1.480635885838954e-02   +2.883206213115775e-02   +2.076977104842462e-02   -8.986869560669020e-05   +9.278901374214363e-03   +1.753815360697300e-02   +1.176765925904414e-02   -3.865794335321102e-02   -5.972285708124840e-02   -3.399533720652168e-02   +4.486045348599445e-02   +2.112783197527623e-02   +1.148979000674550e-02   +6.567385656438678e-02   +3.897382872242495e-03   +4.505398313920864e-02; -1.780024354550283e-03   -8.832803383021803e-02   +2.598554538082113e-03   +2.744446208459316e-02   -2.624518819338841e-02   -3.913369582349249e-03   -3.231266570942501e-02   +1.403498989440562e-02   +1.301638135227080e-03   +4.765346248331899e-02   +5.449997195380950e-02   +4.232754362457796e-02   -9.141662531793987e-02   -3.403371372909806e-02   +6.613388854279539e-03   -5.869703492638649e-02];
L2E_L1E_iAMPA_netcon = [-5.721744971300327e-02   +2.590221268567507e-02   +6.200499476460394e-02   -5.529530084362862e-02   -1.746539909801891e-02   -6.712807231897173e-03   -8.002291382796010e-03   -3.685316160024067e-02; +4.575686262117251e-02   -7.206084862072781e-02   -3.399818938004944e-02   +2.320796231946545e-02   +4.662191396952044e-02   -5.035126897505785e-02   -6.901810316106014e-03   -1.945154077399905e-02; +7.401727507676945e-02   -5.972934422199655e-02   -6.200351106123567e-02   -5.373830677461688e-02   +1.487993317401934e-02   +8.888125739080413e-02   +4.835963930363255e-02   -4.767366403941008e-03; -4.787953424382338e-03   -3.214291281698957e-02   +1.658803424542964e-02   +2.729526880182845e-02   -5.698035799279397e-03   +1.298388146151030e-04   +3.838421331239301e-02   +3.751259082052552e-03; +3.839637758842783e-02   -5.834928570508482e-02   -6.690085422360892e-02   +1.456738500714778e-02   -1.652997646864462e-02   +1.062779165844880e-02   +3.153381486392114e-02   +2.780851055151689e-02; +2.824050815050203e-02   +5.900105369799862e-03   -2.779878028468448e-02   +3.397326183259834e-02   -1.124457327904217e-03   +3.745308028288263e-02   -2.178046302322175e-02   +3.200768429747945e-02; -6.116080784552723e-02   +2.790669546436486e-02   +7.905208231290534e-03   -1.687114209604438e-03   +1.412591369519835e-02   -3.114813968985853e-02   +4.440604560548637e-02   +1.217033326017004e-02; +9.928450219095357e-03   -1.539075871545093e-02   -2.873980355651249e-02   +4.695317156146773e-02   -2.598826308974629e-02   -1.414711882155293e-03   -1.601414064865849e-02   +4.371281867855760e-02; -1.110786987017762e-02   -3.167293418115010e-02   -6.158703426307149e-02   +4.121213930662170e-02   -3.835550437560765e-02   +4.336694427039087e-02   -3.869783940234530e-03   -4.189893249518111e-02; +3.346114019596755e-02   +4.482927111551786e-03   +4.238619624433933e-02   -2.738632800059113e-02   -3.588132144739811e-02   +5.453368356981167e-02   -6.139061946306251e-02   -1.589358133981130e-02; -4.053475640434568e-02   -5.109867549378311e-02   +6.811705957590417e-02   -6.237141507875526e-02   +9.150629719988161e-02   +3.220208766361420e-02   +2.724061708290535e-02   -1.705249918100280e-02; +2.374990890144792e-03   +1.222628226226811e-02   +2.835725650952485e-02   -4.900846897635435e-02   -2.175868463095413e-02   -5.373491928467811e-02   -4.505168557800777e-02   +4.272484095898740e-03; +8.297401178188233e-03   -7.959345938545324e-02   -3.318946340893515e-02   -1.471739722164889e-02   -3.984436482348788e-02   +1.001262352107405e-03   -6.888058440270120e-02   -4.564966443880369e-02; +2.313316692449693e-02   -1.580786250596964e-03   -5.446554199744592e-03   +3.355264227685932e-02   -6.180436098645922e-02   +4.113388273442923e-02   -1.292425807184345e-02   +3.179649273569113e-02; -4.621339228461962e-02   -1.960133381148685e-02   +9.565225811089388e-03   -1.436830008742952e-02   +3.663771861060108e-02   -4.802952092128850e-02   -1.451894738399612e-02   +1.793350663132236e-02; -5.448554239070112e-02   -2.144180636697419e-02   +5.609642920956295e-02   -6.780923132617973e-02   -1.574026056234078e-02   +4.218293360835949e-02   -3.106643527650520e-02   +1.683212945304064e-03];
L1E_L2E_iAMPA_netcon = [+3.034394027406375e-03   +2.135181334255135e-02   +1.357327380816845e-02   -3.842209216309125e-02   -2.417502504610942e-03   -3.248694762946161e-02   -3.357597807229676e-03   -5.849604897211271e-03   -1.714955130949734e-03   -7.719025057809446e-04   +7.299936615430423e-02   +1.236007346084202e-02   +5.294539636336801e-02   -1.349385710890637e-02   +6.522663291494099e-02   -3.421057270178582e-02; +2.745168314241746e-02   -1.739400602920073e-02   -1.166872473893935e-02   +5.040566127442865e-02   +4.537589153997534e-02   +2.537546878760594e-03   -6.566085036511500e-03   -4.012824489502997e-02   +1.456534025600079e-02   +2.571923538681390e-02   -7.183065374400796e-02   +1.473149609939133e-02   +4.517046084616318e-02   +3.153331608837959e-02   -4.568791892524279e-03   -3.223008078675047e-02; -8.409804736020432e-03   +2.945495798872305e-02   +6.782910850130613e-02   -2.374258455249253e-02   +5.273082389900972e-02   +1.065737618917201e-02   +5.913544669515654e-03   -4.262379503154129e-02   +1.697409797046787e-03   +1.439766342371458e-02   -3.989601214464492e-02   -1.271854770571812e-02   -1.589076110213166e-02   -3.088754166483855e-02   -2.090575505033208e-02   -1.575793404252032e-03; -1.666831922093421e-02   -2.497461863051109e-03   -4.555362801882359e-02   +4.679590601627695e-03   -1.208678318218533e-02   -4.652045351681722e-02   -1.506225650107576e-02   +7.260106981847016e-03   -8.278683684717053e-02   -4.052451716310372e-02   -4.289989046718242e-02   -4.555217805296840e-03   -1.737908624888426e-02   +7.282732455244430e-02   +3.186171386224966e-02   -1.730819717370979e-02; +5.295475476505613e-02   +1.658069898140022e-02   +6.118646935190188e-03   -2.053095049738770e-02   -1.012210448562247e-02   +4.267297210816977e-02   +2.705750621252766e-02   -5.852481511300909e-02   -1.667835972665640e-02   -5.268946661564827e-02   +4.189222264362101e-02   +3.227127118686292e-02   +1.914847617858030e-02   -1.304054713660572e-02   +5.147492558909220e-02   +6.252916320706380e-03; -4.132766968026669e-03   +5.701517756015901e-03   -1.619284846991339e-02   -2.595692744077124e-02   +1.570268044294636e-02   +4.939093586988649e-02   +9.995394209432264e-03   -2.893472254105553e-02   -2.309153823048659e-02   -5.840427840275151e-02   -5.167549527774666e-02   +3.351458411168480e-02   +2.997334498071143e-02   -3.808262348081566e-03   +1.594893956737372e-02   +9.624266341549382e-03; +1.144835209526091e-02   +5.629211136777815e-02   +2.952276949860051e-02   -3.352788956200803e-04   -6.147505094927746e-02   -2.128977564592726e-02   -1.950259619176579e-02   -1.088120953784802e-02   -4.866303000691170e-03   -1.665943456243003e-02   +1.082853276575471e-02   +4.788830336182823e-02   -6.896596154277783e-03   +8.389829077093772e-02   -4.454171970472814e-02   -2.146110062685943e-02; +5.419886882151317e-02   +3.792981598355660e-02   -2.226179914568458e-02   -2.504369766097927e-03   +3.405979493365054e-02   +5.877261762457765e-02   +4.754889218631642e-02   -2.291338413564765e-02   -8.407766919057506e-03   +2.365584029401637e-02   -1.275432411319293e-02   -5.735176082170360e-02   +1.170385658637052e-01   -1.036421535603894e-02   -1.157524347289449e-02   +2.772615881615417e-02];
L2I_L2E_iAMPA_netcon = [+1.972606268754092e-02   -5.784698599112338e-02   -4.074356201583498e-03   +2.427155238965367e-02   +5.434694248369208e-02   -7.646490896177367e-02   +1.117351598644225e-02   -5.209610695607605e-02; -2.065564413398654e-02   -2.758159006761674e-03   -4.922357848622279e-02   +9.045910486640241e-02   -2.658000164797894e-02   -7.858339492920370e-03   -4.162801742254828e-02   -2.826354147390543e-02; +1.190362771975618e-02   +1.052486199619426e-02   +1.643294128557643e-02   +4.233200598530130e-02   -5.493947115526705e-02   +2.426217525069656e-02   +5.600671583206909e-02   -2.068590644174952e-02; +1.814204081019640e-02   -1.288705238211088e-02   -4.084652696424059e-02   +3.255454821490468e-02   +2.775451411252552e-02   -1.451904069502724e-02   -1.343287236369015e-02   +3.678146573663219e-02; +7.391739311997447e-02   +1.095704987291701e-02   +5.995691837796217e-02   +1.448299901893926e-02   -8.105739923770110e-02   +1.644712552668265e-02   +3.782522390795728e-02   +3.404685606377062e-02; -7.727101436225710e-03   +6.074723330877078e-02   +2.252055295024256e-02   +4.185299936311085e-03   +3.472421499062037e-02   -7.648279994666654e-02   -8.626126533727496e-02   -2.342861165971008e-03; +3.052425896513999e-02   -1.188962378096039e-02   +3.603828601485391e-02   -9.307089987531915e-03   -4.362607887319141e-02   +6.031162466847120e-03   +2.960085145584467e-02   +8.030719730123842e-03; +8.830162465777620e-04   -1.973157166340805e-02   +1.171653529157799e-02   +8.327417286056231e-03   +3.839921551793286e-02   +3.890216515585225e-03   -6.670328861705535e-02   +4.276651860989356e-03];
L2E_L2I_iGABA_netcon = [+5.787268217542837e-02   -1.182503504713156e-03   -1.734481036506398e-02   -8.540826988004419e-03   +2.213543043567002e-02   -2.983906129474493e-02   +5.253303363671703e-02   +2.171193912911147e-02; +6.426074541812251e-03   -3.774495695176946e-02   +2.985443497922916e-02   -7.991205306459440e-02   -6.936611384158589e-02   -2.650627873420318e-02   -5.790111976830491e-02   -8.310717155012526e-03; -1.383125392857010e-02   +7.831000940924921e-03   -7.562092180039824e-02   +3.206369916232486e-02   +1.120431928059374e-02   -4.787190284463161e-02   -2.798202976953606e-02   -4.319975927579842e-02; -3.023414615889405e-02   -1.544603474472771e-02   +2.884381659160198e-02   -6.179537214997915e-02   +3.758812271437895e-03   -4.449174542663474e-02   +1.336608383902954e-02   +7.806269287031628e-03; +2.648603185854945e-03   -1.792567762545055e-02   -1.662134770081767e-02   +2.209146441916795e-02   +3.665745965947129e-03   -4.802789593724497e-02   -1.725067361968088e-02   -8.053549824753051e-03; -5.584755202716904e-02   +5.248068003009054e-02   -5.736421064558930e-03   +1.212549251412421e-02   +1.044661230080187e-02   -7.953391891997075e-04   +5.375117552415520e-02   +1.925053590220832e-02; -9.251310741055993e-03   -6.565861140245570e-03   -3.821437133024524e-03   +5.930446841689307e-02   +2.896244178327179e-02   -1.784851743654477e-02   +3.743453247400751e-02   +7.415107456091672e-03; +4.688515389116584e-02   +5.372402237860258e-03   +7.752428055729035e-03   -6.964051239988978e-02   -2.470902433026212e-02   +5.271877048705195e-02   -5.691138531983625e-02   +3.296220492656379e-02];
L3E_L2E_iAMPA_netcon = [+4.261903877081834e-02   +2.658592112422617e-02   -4.898995084384045e-05   -2.751332539085875e-02   -5.359739111002466e-03   +1.709356329694704e-02   +1.532919516302960e-02   -4.450062021590877e-02   -2.759900466018354e-02   +7.100684675483157e-02   +2.920062521527210e-03   -5.577254659001483e-02; -4.286915591512229e-02   -3.328754031163482e-02   +2.005266275100049e-02   +1.981849210430480e-02   -3.021089327118635e-03   -2.102423863545033e-02   -4.445947762284386e-02   -1.683722290210508e-02   +1.525575016159091e-02   +3.769063302546209e-02   +2.530142539124798e-02   +4.573964034188093e-02; -4.732884433013744e-02   -7.073034269779754e-02   -9.061149027381829e-02   -5.086310244120276e-02   -1.602973501133509e-02   +4.182693892124941e-02   -5.637011155847421e-03   -6.824420491271474e-02   +2.926021158498677e-02   -2.072096763147206e-02   +2.594843200435393e-02   +1.531224571027828e-02; -3.990563161690518e-02   -3.733799040306431e-02   +3.005061043812627e-02   +2.721564323328897e-02   -2.171978190168167e-02   +2.473963356281379e-02   +3.910134389568667e-02   +8.229077514526296e-03   +5.449449413426199e-02   +7.459367625288424e-02   +2.930528241167135e-02   +2.401358133438418e-02; -8.554560377419624e-03   +3.245008730682922e-02   -1.323370255789600e-02   -1.739294367504515e-02   -6.320062997585302e-03   -2.327718765576897e-02   +1.234186359980395e-02   -3.377153666255844e-02   +3.773704100513030e-03   -1.421526430591689e-02   -6.716733456994481e-02   -3.305057602400250e-02; -2.008901190850809e-02   +4.760559405986453e-02   -2.554120563513774e-02   +3.908293897388257e-02   +3.601910669678102e-02   +1.685895722657128e-02   -3.905363058126433e-02   +3.792765084001704e-02   +3.650115348283202e-02   +3.389564174092309e-02   +9.973622473890296e-03   -4.593919063027331e-02; -1.457737206143034e-02   -1.461279986972228e-02   -5.563291472128671e-02   +1.988681303640220e-03   -2.113062527874696e-02   +4.334627080662652e-02   +5.405605222843106e-02   -4.190186122068354e-02   +9.624590945211176e-03   -4.962416709815562e-02   +1.671262857316907e-02   +4.862535075644507e-02; -5.194892165277456e-02   -2.197832541378575e-02   -4.030264125304434e-02   +5.071657337944735e-03   -1.017583496058150e-02   -1.695517736530565e-02   +4.435926985636117e-02   -4.002132387020588e-03   +2.489606746811841e-02   +2.337135174028981e-03   +1.079119860050829e-02   -2.583680598229821e-02];
L3I_L2I_iGABA_netcon = [+1.300990783766375e-02   +2.028814451116481e-02   +3.256603090500793e-02   -2.223088418758546e-02   -3.972154152937730e-02   +4.858887586444240e-03   -9.313441784035190e-03   -2.727167345674199e-02   -3.897647630260107e-02   -4.402224420909220e-02   -7.492981399692603e-02   -4.093739458942551e-02; -2.868792338827969e-02   +3.526812106939583e-02   +2.037285222169269e-02   -2.136835610524725e-02   -2.826956645841788e-02   -4.294895748826744e-04   -1.957301976785504e-02   -6.317377453401467e-02   -2.272132373573257e-02   +2.146685643891214e-02   +1.729723055606983e-02   -2.189062776013906e-02; +3.890964689463582e-02   -5.043302605605222e-02   +7.763163904996993e-02   +1.863872646052780e-03   -2.722760100284516e-02   +1.352347830888328e-02   -1.266858875088829e-02   -5.516618365533771e-03   +4.052587279387283e-02   +6.744327529055990e-03   +4.232898357600502e-02   -4.185598763559810e-02; +4.380571588221031e-02   +4.207701405652934e-03   +4.701188125831869e-02   +1.244666753338853e-02   +1.462528822420958e-02   +3.964655449289002e-02   +5.549474744767019e-02   +4.720112054421553e-02   -1.350978522482384e-02   +8.069062300993732e-04   +1.421979763098494e-02   +3.395279996718195e-02; -2.064542367723355e-02   +3.637868407769308e-02   +5.032275307736244e-02   +2.419326550798228e-02   +6.869872664338637e-03   +6.285925057163712e-03   +5.497044554542344e-02   -3.685659294563048e-03   -2.407544283314010e-03   -1.574604295797793e-03   +5.914056553544614e-02   -1.958523831406936e-02; +2.581486722343633e-02   +4.949299889480579e-02   -5.881826487527518e-02   +7.808871705878432e-03   +4.002884043583973e-02   +3.758009414178042e-02   -3.242789344160744e-02   -1.260535187286048e-02   -3.473335710198185e-02   +3.425782441414660e-02   -3.423716980302698e-02   -6.863879673962337e-03; -3.275147338432124e-02   -4.112772819357499e-02   -8.434612401790523e-02   -7.623891319572940e-03   -5.192082198015899e-03   +3.329586442816447e-03   -5.618005336940586e-02   -1.213570786401898e-02   -2.704711991991438e-02   -3.929064436808068e-02   +5.028967502471583e-02   +2.918777005405142e-02; -1.688908469477873e-02   +4.704569910211709e-02   -1.787874926397928e-02   +3.808159497488580e-02   -1.459260864103915e-02   -7.052491298639060e-02   +5.991218632996407e-02   -1.540467347821120e-02   -3.177822288541260e-02   +7.798280905813795e-03   -1.330904536924634e-03   -1.442480652601727e-03];
L2E_L3E_iAMPA_netcon = [+3.346498744941766e-02   -2.088028743028115e-03   -3.494000716747940e-02   -9.193041940129722e-02   -1.322595738700838e-02   -2.723976833040791e-02   -4.797416949167451e-04   -3.372058338490744e-02; +3.449184269705759e-02   -1.244843397293391e-02   +6.187044484572077e-02   +1.992865256219164e-02   +8.713602728269584e-03   +2.592045868222510e-02   -1.068603193979281e-01   +7.267217543337853e-02; -1.611786129382323e-02   +3.303299090792371e-02   +3.904055154302864e-02   -2.262514004180039e-02   -3.407508614594536e-02   -3.664692714963591e-02   -2.855957219610813e-03   +5.790957053999642e-02; +3.334285739762060e-03   +7.513938065570840e-02   -5.751083774541953e-02   -1.344947857223196e-02   +7.357024394003180e-02   -1.531966817410420e-02   +5.190842175448153e-02   +3.170286654791404e-02; -2.957778722532988e-02   -1.060111222201748e-02   -4.406797001501710e-02   -8.295568789773242e-02   -3.169013549292833e-02   +3.570855505567927e-02   -1.051027986672216e-02   +9.100325205727625e-03; +2.666760251514234e-02   -2.217951795225421e-02   +2.779613435081943e-02   +6.325159062983936e-02   -8.496688582490084e-03   -4.291750915508333e-02   -3.794886878135811e-04   +4.106947702722992e-02; +3.400895342207381e-03   +2.775635066725582e-02   -3.663005964656786e-02   +2.797245186671880e-02   +1.968633279483331e-02   +4.751717573549893e-02   -3.123010675542497e-02   +4.954742792852305e-02; +6.439075732666601e-02   +3.514826716187072e-02   -4.699907366749408e-02   +4.028240988397366e-02   +4.266862717577559e-02   +1.584986215886391e-02   +1.991119507078888e-02   +1.884720784555237e-02; +1.365867359100439e-02   -3.837168906247055e-03   +2.956035558894252e-02   -9.874790926972365e-03   +2.663203079786267e-02   +6.226667452445137e-02   +7.317030962969345e-03   -2.685504823526976e-02; +8.747302554749358e-03   -1.228636771341464e-01   +4.374301083176028e-02   +1.110131749857583e-02   -9.056567580150795e-03   +3.661173292794090e-03   -1.821706974627129e-02   +4.420441133011074e-02; -1.631589184915776e-02   +6.366480073664825e-03   -2.237807746189160e-03   -5.248094695198027e-02   +2.201580284765131e-03   -1.086567719141708e-02   -7.124955201106163e-02   -6.336836501580897e-03; -7.777772936182946e-03   +4.114259667275291e-02   +3.057187152561213e-03   +1.722036249776748e-03   -3.063322765151781e-02   -3.904911660154245e-02   -3.899044383186880e-02   -9.736672007578029e-03];
L2I_L3I_iGABA_netcon = [-3.880609708803790e-02   -8.011730465762786e-03   -8.644816325221669e-03   +2.134883867213657e-02   -2.660997032255972e-02   +8.489700079358749e-02   +3.934097039341408e-02   -2.496713000647004e-02; -2.969103325280073e-02   +3.469984561034626e-02   +1.558633313625393e-02   -2.652489353840239e-02   -5.057622190566704e-02   +1.271235251577488e-02   +1.839652665879593e-02   -7.837448748403877e-02; +4.953813813159434e-03   -3.522837726484305e-02   -8.973577467003238e-02   +1.275951172446043e-02   -6.049472076389954e-03   +1.793873013421667e-02   +5.361217592260493e-02   +2.342788235791549e-02; -2.596529305545306e-02   -3.074524334903484e-02   -1.345476515410637e-02   +3.021663142111436e-02   -4.815806699261149e-02   -7.399144452180722e-03   +3.497183525142403e-02   -5.780244169800372e-02; +2.676313146725386e-02   +1.802851883468365e-02   -9.844296777696004e-02   +2.043172049573032e-02   +2.326192634979657e-02   +3.505908118358370e-03   +1.989686425605973e-03   -1.658409457220296e-02; +2.565613870282235e-02   +9.666129419239682e-03   -5.945830824007704e-02   -1.373222333019915e-02   +3.787988840957304e-02   +2.628766295623521e-02   +1.165397354376905e-01   -6.635798166358238e-03; -8.346718048413589e-04   -2.273553294554363e-02   -4.733278316070232e-02   +1.905450409394260e-02   +1.976020338377288e-02   +1.385868402996463e-02   -2.397458897124282e-02   +2.008744580132745e-02; +1.287237929101802e-02   -3.730616675492551e-02   +1.212065615103854e-02   +5.943726949773754e-03   +3.475471303085256e-02   +1.702791633973695e-02   -2.138739346883836e-02   +1.036801125288331e-02; +5.110708443690815e-02   +7.494563150674499e-02   -4.276670444300659e-02   +7.643088412209907e-02   +1.097340467097043e-02   -5.243829629801940e-03   +2.561427414752600e-02   +1.899231043310492e-02; +6.909198994570985e-02   -2.131459344952654e-02   -7.288584206381731e-03   -1.752008751370803e-02   +5.519753302020656e-03   -3.678006467141844e-02   -2.669662482412271e-02   -3.395586259353290e-02; +1.544388101898075e-02   -1.258937430842904e-02   +6.406139837448989e-03   +3.772915694730872e-02   +5.274197111290501e-02   +6.226286190888181e-02   -3.255068163050889e-02   +3.350641537319925e-02; -5.704799105958254e-02   -1.428622663104774e-02   -1.048659898990039e-02   +1.081417565306742e-01   -3.459975663992296e-03   -1.241999305148496e-02   +1.330953197301154e-03   -7.168977108145923e-03];
L3I_L3E_iAMPA_netcon = [+3.642783090958763e-02   +3.030025983806225e-02   +1.557430565177193e-02   +2.895878549679048e-02   -5.131992397076044e-03   +3.248338628282780e-02   -4.738323621740582e-02   +2.768827910008342e-02   +3.325391753380465e-02   -3.074967069295368e-02   -1.029076534208758e-02   -2.317869455674054e-02; -3.152012830201999e-02   -3.884186113346399e-02   +3.754799360737528e-02   +7.422828416686365e-03   -2.652063492669864e-02   +2.220267383192492e-02   -8.237037622361812e-03   -4.146223765534177e-02   -2.787422056372387e-02   +5.328392705623713e-04   +1.562227110298910e-02   +2.332272359820059e-02; -2.039662108655912e-02   +4.862306945558797e-02   -5.157046452668291e-02   +3.123440250885072e-02   -8.546308495179790e-02   -2.312500812777732e-02   +1.567189792991641e-02   -4.284614199655384e-03   -2.814980901984554e-02   +7.967923910559112e-02   -4.329468097424297e-02   -2.743448752914574e-02; +1.958450626200924e-02   -1.592364554951700e-02   +3.981308935935185e-02   +2.468043074022445e-02   -1.511317770013470e-02   +1.569829670447415e-02   +8.369016970532998e-04   +2.009434665123854e-02   +1.620185262842313e-02   -3.659949688441568e-02   +7.292441102252729e-04   +4.227149186196394e-02; +6.380171408863415e-03   -4.561253999190391e-02   -5.802612777218739e-02   -4.834349141610638e-02   -1.230536114110547e-02   +2.742628997164208e-02   +3.990090412753604e-02   +1.391453661918711e-02   -6.516324535779168e-02   -6.331047803152935e-02   +6.638511131459746e-03   -2.896661519359594e-02; -1.434612096659918e-02   -1.773956701656218e-02   +5.063862978693316e-02   +9.958492351582549e-04   -2.851436100892438e-02   +9.685521084691119e-02   -1.692556755119552e-02   +2.659060026092326e-03   -7.749506871403914e-03   +1.946908883842834e-02   -4.793029516496933e-03   +4.038633112580828e-02; +5.643734067039770e-02   +3.890149502449485e-03   +2.816583678557243e-02   -2.070709082947783e-02   +6.977879261761108e-02   -2.572239702174720e-02   -2.314824865054285e-02   +1.892726472856296e-02   +2.569030338410180e-02   -5.218982989136151e-02   -5.203981605440228e-02   +1.951530191602631e-02; +1.306931073127474e-02   -1.412540724027609e-02   +4.412798270490480e-02   -5.675167856270490e-02   +2.683954318679098e-02   +1.502219017581447e-02   -1.047049038126617e-02   +2.223438618106618e-02   +1.590312021423904e-02   -3.930178965650462e-03   +6.350446140784685e-02   -9.464343591600543e-03; +1.056929899904286e-02   -3.547694257477709e-03   -9.871035284340241e-03   +1.654472835511172e-02   -5.535792063101744e-03   -2.611598370641629e-02   -3.679498335085550e-02   +2.443532393141010e-02   -5.226331481478851e-02   +5.844368546052110e-02   -5.707630114738948e-02   -7.586080805277751e-02; +3.600122358752841e-02   -2.901418394038182e-02   +3.137342340212876e-02   +2.126084705594473e-02   +6.437277393034454e-03   -3.685628263313553e-02   -7.940944537696312e-02   -3.868592178578474e-02   +2.761383701234259e-02   +6.285571584956443e-03   +6.074574381946940e-02   +9.235308551637848e-03; +3.150088400374518e-02   +5.782023685713503e-02   -2.827551788800843e-02   +1.633470419007402e-02   +2.326884723165924e-02   +1.097908601120146e-02   -2.701353464236532e-02   +5.804697619537149e-02   +1.136569836535178e-02   -4.712654943590959e-02   +5.303374589106949e-02   +5.760225344527965e-02; +6.090778403838318e-02   -3.158906321811020e-02   +3.862711999395496e-02   +5.880083563393925e-02   +5.926284382032451e-02   +3.031487249330660e-02   -1.950050812359089e-02   -7.908127674567633e-02   +2.481383314075837e-02   +4.259733068903927e-02   -3.662167057516848e-02   -9.588975082230489e-03];
L3E_L3I_iGABA_netcon = [-4.526082353590729e-03   +4.286399520259682e-02   -4.291528308350562e-02   -1.681117108890887e-02   -1.383167126195532e-03   -1.054894288854723e-02   +3.659903864599437e-02   -3.789340623248933e-02   -2.501758616825935e-02   -5.690366886458201e-02   +2.185736384469624e-02   +5.180821604637224e-02; +1.779040806272729e-02   -4.433558753898734e-02   +3.270165723595601e-02   +3.887553479090147e-02   +5.992785573365428e-02   -5.337061523189745e-02   +2.598660882507003e-02   +1.521946727123015e-02   -7.696490444246576e-02   +2.301763046602859e-02   +3.749575258050515e-02   +4.020329823933602e-03; +2.130583183773022e-02   +4.280253477576484e-02   +1.874001648297348e-02   +3.428037446806344e-03   +1.358558611648381e-04   -1.651806246708896e-02   +2.455748162705323e-02   +1.443024322213995e-02   +1.092924368455384e-02   +3.318175986002837e-02   -2.854622769817215e-02   -1.550280797595079e-02; +5.520273338020205e-02   -2.292678610521712e-02   -3.661320864328464e-02   +1.575361830702896e-02   +5.672599405626810e-02   +3.983706405800773e-02   +5.851533823193183e-02   +4.308194552561989e-02   +2.895773121307806e-02   +4.209546076381052e-02   -9.000360517719802e-02   -2.646273659671564e-02; +4.915603234918164e-02   -8.586118329170396e-02   +3.241071794096025e-02   +1.838300082899743e-02   +9.531414892785989e-03   -3.419010971002177e-02   -3.974913691618205e-02   -1.395760024112285e-02   -8.019894408469522e-03   -7.004852129337528e-02   -1.059010106652533e-02   +9.491527857738054e-04; +1.621600167827894e-02   +2.085614918531847e-02   +3.838521093292378e-02   -7.087412259948862e-02   +2.431549244960131e-02   -2.767170304088232e-02   -2.519961449343915e-02   +8.167150330839038e-03   -1.301898839497056e-03   -3.412416490385511e-02   -3.678212161541209e-02   -1.729024551846801e-02; -1.800217489332545e-02   -1.442310866709640e-02   +5.669358656902838e-02   +3.553931829376876e-02   +5.319423594688419e-02   +4.495307015765262e-02   +1.382732698451252e-02   +4.208105140171281e-02   +4.039694752899663e-03   +1.144476529188355e-01   +3.905410227282005e-02   +2.039140806444915e-02; +1.386037115486407e-02   +6.542954221499318e-02   -3.189726719190107e-02   -5.365317033500465e-02   -1.349292959929406e-02   +3.179641527715184e-02   +1.406728064163256e-02   +1.076510141136890e-02   -6.997152635975520e-03   -6.134820746391625e-03   -5.291207405910201e-02   -1.635496439760558e-03; -3.708736984507701e-02   +1.975269389273936e-02   +4.294943574317274e-03   -4.556376916202989e-03   +3.690508755800752e-03   -5.115441656634091e-03   -2.782882849855660e-02   +1.809873980157518e-02   +4.766697322772008e-02   +4.437785828812324e-02   -1.974743234442353e-02   -4.648226180582999e-02; +4.057846136963255e-02   -4.890410549640960e-02   -6.292919294607599e-02   -4.001478417314413e-02   -1.578982915837438e-02   -2.373270892720776e-02   +7.276590251028840e-03   +3.098642258882848e-02   -8.099739179320044e-02   +2.298357534048973e-02   -7.558540338655519e-02   -8.853176930193229e-02; +1.967595232009947e-02   +8.909168407982719e-02   -3.464843010484769e-02   +5.186553864707762e-02   -1.287034421797984e-02   +1.943748904796557e-02   +6.898453839667976e-03   +5.113815950272166e-02   -3.321736847683131e-02   -5.017563955008846e-02   +1.845608726232004e-02   +3.738202540627834e-02; +6.714860231707819e-03   +1.858797797732304e-02   +1.831983290464856e-02   +4.131201412132733e-02   +8.620486038669720e-03   -3.622519673588625e-02   +4.376151026365080e-02   +3.626220362534406e-02   -3.419056421020815e-02   +2.807089764568930e-02   -4.615177687814630e-02   -3.037188479882699e-02];
L2E_Input1_iAMPA_netcon = [+2.522508492199852e-02   -8.740215313144003e-03   +5.730294670129622e-02   -2.837819715787825e-03   +4.743561516284506e-02   -1.097654902727068e-02   -1.874626206330777e-02   +3.686681205223822e-02];
L2I_Input2_iAMPA_netcon = [-1.730086655077370e-02   -2.432282629514734e-03   +4.359059695446892e-02   -4.482822837924087e-02   +9.035453243455943e-02   +1.843371596448265e-02   +5.494963543490237e-02   -4.068928385934149e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
