function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.022307330589578e-01   -1.082081904251949e-01   -7.076222276379290e-02   +1.088086034884794e-01   -1.847053015169121e-01   +2.522578940228431e-01   -3.329708499915168e-01   +8.652691741575966e-02   +1.954073345657238e-02   +9.874999463037090e-03   -9.584591966067577e-02   -1.055502424513829e-01   -9.596594046880377e-02   -7.919280958088154e-02   -6.350703689206980e-02   +1.390672558428453e-02; +1.334537989673941e-02   +9.009358511719009e-02   +1.132951230582110e-01   +1.175550957160398e-01   +1.763880507281071e-02   -5.132144121381006e-02   -2.998370707973471e-01   +1.348266733860515e-03   -1.965931645190965e-01   -3.569833706926673e-01   +9.978003131046487e-02   -1.815093361190902e-01   +3.314100055216790e-02   -9.013285094297226e-02   +2.029431804177820e-01   +3.878635844312468e-02; +4.314380009622143e-03   +1.415121608363213e-01   -2.357049092134087e-01   +7.037747011554846e-02   -8.508511128750236e-02   +2.412289682785191e-01   +8.410053221183866e-02   +1.994981092033454e-01   +2.285472524845784e-02   -2.001620586778556e-01   +1.548299542476324e-01   -1.270343172695742e-01   -3.030767771009109e-01   -2.111004012289483e-01   +6.249705605797860e-02   -2.812606273026231e-01; -1.367347104517922e-01   -2.403957383079303e-01   -1.146150146021513e-01   +1.302537288309795e-01   +2.259012249729059e-01   -5.654629837118418e-02   +1.652296155731508e-01   -2.665461379999673e-01   -1.807576521601305e-01   +1.970141672672017e-01   -1.439159640123540e-01   +6.407097755778875e-02   -7.122307402274046e-02   +8.641883825536051e-02   +8.222452965640092e-02   +1.191185702745269e-01; +1.238233840447715e-01   -1.200898104397532e-01   -1.241252489173909e-01   -3.853913653268336e-02   +2.495479552300875e-01   +6.711680734187195e-02   +2.746177910331727e-01   +2.776736623829973e-01   +1.090442262527144e-01   +1.015503886263599e-01   +1.062199785779326e-01   +4.062757640056587e-01   -5.488159580897056e-02   +3.569846616929502e-01   +1.454570849855976e-01   +4.364116949992936e-01; +2.457732362330341e-01   -1.524234659921688e-01   -4.923667297045358e-02   -2.437526524268593e-01   +2.944927485650147e-01   -2.477224004214093e-01   -1.923253856153800e-01   +1.609090001816992e-01   +2.140533729462555e-01   -1.017871315602323e-01   -4.421895127212078e-01   +8.274548217477395e-02   +1.679958414249983e-01   +2.806512830880470e-02   -1.532331046708512e-01   +1.198953508917573e-01; +6.751520472386621e-02   +2.849886882406455e-01   +2.420274747367973e-04   -2.717533194197247e-01   -7.736589448231637e-02   -4.169843034767889e-03   -9.298540948918083e-02   +2.760730389231519e-01   +1.122635619034817e-01   +5.384517389837265e-02   -2.743838906526551e-01   +1.211235565504159e-01   +1.081672456716800e-01   +7.856417493464665e-02   +2.303616960348655e-01   +1.015718965835785e-01; +2.707633086589938e-01   +1.816820701092371e-01   -2.453991180007918e-01   +1.243691931664371e-02   +7.885767997261175e-03   +2.925984950382062e-01   -4.909170959482227e-02   -1.754822863046024e-01   -2.681797230719556e-02   +4.854966584979134e-02   +4.188620135101768e-01   +3.167080617341400e-02   +5.946055898525121e-05   +3.068096550115097e-01   -8.090705171800000e-02   -1.841375645461762e-01; -1.934466121001941e-01   -7.457022138640915e-02   -1.257739191905305e-01   -2.418809980797362e-01   +1.938552174190058e-03   -1.207066924515962e-01   -1.208924239818912e-01   -3.754661959841438e-02   +1.779590312522668e-01   -8.254534027788367e-02   +2.832640950556286e-01   -1.556131267809230e-01   +3.308729513152722e-02   +5.207551597496346e-02   +2.237554879644619e-01   +1.295386101289161e-01; -4.868295581485899e-02   -2.247288954099840e-01   +3.279297750766862e-02   +1.930406516617188e-01   +1.901320505334481e-01   +1.224977895478815e-01   +3.187296841083419e-01   -2.338645303084544e-01   -2.724596874350050e-01   +8.887352801708127e-02   -2.427573597103248e-01   +7.704174540411010e-02   -1.993128371093903e-01   -1.822403160419130e-01   -5.611209376956423e-02   -1.842498928309472e-02; +1.889055057904857e-02   +7.876495362876268e-04   -3.830597449764692e-01   -2.131766944114117e-01   +8.109406822419812e-04   -7.970824761952612e-02   -5.531038977968550e-03   -7.522567964116326e-02   -1.041658107947042e-01   -6.970049378554749e-02   +7.488002995081204e-02   +3.489399664424903e-02   -9.189949787992586e-02   -2.384383595783866e-01   -4.434218748411517e-02   -3.925338343655342e-02; -1.284804886251439e-01   -3.443168519197429e-02   -1.074908159156248e-01   -2.892953310261204e-01   +1.806849631963357e-01   +8.085484958624117e-02   -2.928213612168714e-01   -9.598377197083785e-03   +1.433291194314911e-01   +1.650474529062216e-01   -5.032078310977382e-03   +1.483303668004409e-01   +2.383198169615355e-01   +1.727476955781911e-02   -1.119604010948630e-01   +2.099044739240472e-01; -1.493225832787231e-01   -2.412327821910646e-01   -3.018736132066150e-01   -2.094301626096886e-01   +5.678344458575875e-02   +2.462182550193998e-01   -1.638534291856789e-01   +4.552792654534960e-02   -1.925104013831592e-01   -2.340800009832952e-01   -2.565873972595742e-01   -1.699851279739276e-01   +8.083462222361143e-02   -9.771921525511766e-02   -9.689745817693952e-02   +1.279017754464656e-01; +9.835135826165627e-02   +2.390318688724313e-01   -3.780314640008358e-01   +2.230901620099396e-01   +1.013528414272832e-01   -1.174734520409746e-01   -1.914934695021845e-01   +2.327451374257122e-01   -3.022639142164348e-01   -1.060476609244403e-01   -9.903989675024120e-02   -2.423316372137428e-01   +2.005368542739404e-01   -3.356735292071752e-01   -1.364223351815367e-01   -1.565353553068362e-01; +1.386013898330285e-01   -7.090449431311535e-02   -3.213008733732675e-02   -1.044363367803737e-01   +9.753703432831451e-02   +3.079295627603736e-02   +4.302088436866104e-02   -3.533735868836118e-01   -3.399643488220454e-02   +2.195902581448124e-02   +7.121097069894425e-02   +1.149750701831961e-01   +2.446219445168930e-01   +8.968388483100775e-02   -8.179607174876322e-02   -2.643967132258803e-01; +3.042812300790371e-01   +1.668864417596327e-01   +1.511698160886798e-01   +6.929358461146430e-02   +7.014461310763254e-02   -3.619659736671603e-01   +2.314195659510551e-01   +6.873618529142048e-02   -2.395632251603356e-01   +1.072894877533868e-01   +8.913903214964283e-02   -2.764059429877234e-01   -7.035086433993358e-02   -2.509941268130859e-01   +8.818672108205468e-02   -7.741058782972636e-02];
L1E_L1I_iGABA_netcon = [-9.944632964558414e-02   +1.533976137093244e-01   +2.055048595537802e-02   -2.029340778638447e-01   +3.074851032825754e-01   +1.770246558060376e-01   +3.013546844920139e-01   -3.187384703790949e-01   +1.125118751899480e-01   +1.226651926525404e-01   +3.774981881281090e-02   +1.050278571886834e-01   +4.089075142684735e-02   -2.010613078347683e-01   -1.837603658803243e-01   +1.255815338966602e-01; +1.750104133967327e-02   +2.033505968552614e-01   +1.014998009834646e-01   +2.562802901781280e-01   -2.024173506403156e-01   -1.102263579414183e-01   -6.065927057764749e-02   +2.533356818376313e-02   +4.886388066341185e-01   +1.288159156781349e-01   -1.595815449905331e-01   -1.219431562324099e-01   -5.168453830836132e-02   +5.722343441875848e-02   -1.294559866397640e-02   -4.449633162360696e-02; +9.714867235400457e-02   +8.260459637613067e-02   -4.951851423992487e-03   -8.064730548689553e-02   -1.384520961707252e-01   -1.750938695998939e-01   +9.486275885449769e-02   +5.731771161102377e-02   -1.286835434013889e-01   -2.449697698732418e-01   -1.227154894346841e-01   +2.337670301562061e-01   -8.006950635565113e-04   -2.781423587968154e-01   -1.402389988485463e-01   +2.989533956881501e-01; -1.808068137551809e-01   +9.811266375586794e-02   -1.051127275022697e-01   -8.481666667701253e-02   -8.036243892347109e-02   +2.436257677004047e-02   +1.125763375246821e-01   -1.336234269984418e-01   -2.664348669294406e-01   +2.733565707151815e-02   -1.845143877382267e-01   +4.096259547574545e-02   +5.578450941515231e-02   -1.241666929048653e-02   -1.910052831310969e-02   -2.072571222112808e-01; -1.379226697094031e-01   +6.292538764220688e-02   +3.066468786586323e-01   -1.053826589923951e-01   -1.064305671787186e-01   -2.345910705861665e-01   -2.079838239473706e-01   -5.247818738523965e-02   +1.097462867767676e-02   +2.264042542082865e-01   +3.925029435049231e-02   +9.921221338789921e-02   -1.208345275612297e-01   +4.968259117970555e-02   +3.267215449480164e-02   -3.755280221887702e-01; +6.236274528190656e-02   +1.644904721189927e-02   +1.355910690220781e-01   -1.667404322242509e-01   +9.611881970312675e-02   +8.420133646111259e-02   -9.054548874378621e-02   -8.631342165666439e-02   -2.325682875042404e-02   +4.108610663078170e-01   +1.307823139441472e-01   -1.280495574245690e-01   +2.482671170589231e-01   -1.606750546840899e-01   -4.401715363779464e-02   -1.372367767459059e-01; -1.482284406773541e-01   +1.705404781000704e-01   -1.944261587634596e-01   -1.240697811394235e-01   -3.543749086362233e-01   +2.330876520346692e-03   +2.130533673592148e-01   -4.696641463608924e-02   +1.894950897771000e-01   +1.186275596328279e-01   -9.622018039549035e-02   -1.537317819827833e-01   -1.969693880255541e-01   -3.241537293176602e-01   +5.336192574998743e-02   +2.739529800216994e-01; +1.266103931703926e-01   +4.210129207741817e-03   -1.197011423324533e-01   -5.136551353079823e-02   +3.191642536821280e-01   +1.595441233220335e-01   +2.467596747667006e-02   +1.427837674925290e-01   -1.690107381712835e-02   +1.257923244576427e-01   +1.062656225730108e-01   -1.014494259601787e-01   -2.481635003288161e-01   +3.017307798907241e-01   -1.481692358951314e-01   -1.797013176650843e-01; +1.178284964979380e-02   +1.767615294478930e-01   +1.300246008826109e-01   -1.709752197021672e-01   +5.876131257049533e-02   +1.258623019880024e-01   -2.187287658123753e-02   +6.371941385950550e-02   -2.409214795917605e-02   -1.523003072383498e-01   -1.329705913170026e-01   -1.293137779490225e-01   +1.364862512190934e-01   -3.515309545931819e-02   -2.648269051103749e-01   -3.190366129445824e-01; -7.755340525097112e-02   +4.108599338060942e-02   -8.685266199346156e-02   +1.114655187522638e-01   +2.028932861544208e-01   +1.822838321336401e-01   -9.730278556479147e-02   -2.503129956749375e-01   -3.964423106626861e-01   +1.246090104394047e-01   +8.833650700363740e-02   +3.015313476526496e-01   +4.042694356503196e-01   +2.166800675959646e-01   +1.071026896420413e-02   +1.177162852225505e-01; +2.198255826261488e-01   -2.221797494861414e-01   -4.863668663260263e-01   +3.738175526415516e-01   -3.438623482575320e-02   +1.062157348122298e-01   +1.148442745311523e-01   -2.534927504488038e-01   -4.407816863860989e-01   +3.018910608522007e-02   -2.484920430497944e-03   -1.989287640966096e-01   +4.446297664263118e-01   -2.645485935485481e-01   -2.385242801052781e-01   -2.257569532263244e-01; -1.967877082852235e-02   +1.612105988208869e-01   +1.028785171110296e-01   -2.251831519023411e-01   +4.249823904276193e-02   +2.548973955566067e-01   +2.587340792382400e-02   +1.478809360586344e-01   +2.140914858170316e-01   +1.585696802326636e-01   -1.194105315434207e-01   +3.129428074592656e-02   +1.628849518205279e-01   -7.654865868828216e-02   -2.720472901806154e-01   -1.936072948109111e-01; -8.392797939080564e-02   -2.768133275540586e-01   -2.142870618429037e-01   +1.002789481852860e-02   -8.097661155070332e-02   -2.603830801480432e-01   -1.724118650333124e-02   -2.078499561071964e-01   -1.251191394944693e-01   +1.920024572228849e-01   -2.935809321788408e-02   -1.292732226626284e-01   -1.398797261687629e-02   +2.770617820456309e-02   +1.772921710741444e-01   -2.322005837234523e-01; -2.217137657619726e-02   -2.815166714970584e-02   +1.733305937521873e-01   -1.179075050501148e-01   -2.526469711832167e-01   -1.217610849546455e-01   +1.480603283590458e-01   -2.516792632665397e-02   +3.615773211715778e-01   -5.482522693270711e-02   -3.676052329262040e-01   +3.460558143810692e-02   +2.733214420154823e-02   +1.231671511775643e-01   -8.908613532896809e-02   -2.391141192877592e-02; +6.256250924167157e-02   +3.546467216264630e-01   -4.424399802862167e-01   -8.419298560925415e-02   -2.800089090554734e-01   -8.016474264672890e-02   -9.516130326794522e-02   -2.712561245111671e-01   -3.344221761873110e-01   -4.640876218732323e-02   +4.017106925547020e-02   -1.091815409450454e-02   +2.621609680356490e-04   +4.902898426478896e-01   -4.051172875209594e-02   +1.727715685035619e-01; -1.200394174404531e-01   +4.941080625732333e-02   -1.901691034073975e-01   -6.781985999723789e-02   -1.685887932782627e-01   +1.161428970452200e-01   +1.505808458371908e-01   +1.166547871134568e-01   -3.325076173811661e-01   -7.951796437803980e-02   +8.366083761939565e-02   +7.654445139282283e-02   -7.339478607995156e-02   -2.203777157120079e-01   -3.063143483298420e-01   -1.097910636843644e-01];
L2I_L1I_iGABA_netcon = [+8.490366999337218e-02   +3.162580606690186e-01   -1.445788678412438e-01   -3.400190531527030e-01   +3.102144196117290e-01   +1.825134216898481e-02   +4.152903522841245e-02   -2.608063217506639e-01; +9.443163731345483e-02   -2.985027332541571e-01   +1.672857204057300e-01   +2.997022525192781e-01   -1.342954246809010e-01   -2.934166601960905e-01   -3.170525536468564e-01   +2.466482166924996e-02; -3.331842515657020e-01   -1.780455849618205e-01   -4.583694041219499e-03   -1.236003985562952e-01   +2.073238357663529e-01   -2.481773375742490e-01   -8.434385149678311e-02   +5.025104709289444e-02; -4.049607336484952e-02   -2.534707910219600e-02   +1.528017814531025e-01   +1.736183124450985e-01   +6.476405881950914e-02   -1.539988791397160e-01   +3.804368670306151e-01   +3.025789124336491e-01; -9.267591827727423e-02   -2.579285168345777e-01   +2.525168393759881e-01   +3.688876115939060e-01   +1.508020387791203e-01   -4.040609652688383e-02   -1.464959392012245e-01   -2.538643741946531e-01; +1.016768165088999e-01   +2.231852229906594e-01   -2.550841896732477e-01   -1.168300174735114e-01   +1.988367971042998e-02   -8.519081229765442e-02   +3.171570181831528e-01   -1.366251399592981e-01; +1.276038459178226e-01   +1.844458378938559e-01   +5.527927630543134e-02   -7.217263907231716e-02   +4.903924582852892e-02   -1.104055473777059e-01   -1.031097534531448e-01   +1.785807129765685e-01; +4.508650837290597e-02   +4.237691209496312e-02   -1.647939522026481e-01   -1.193189252151471e-01   -1.375801922214261e-01   +1.275057312653472e-01   -4.194271969037011e-02   -1.561457493877803e-01; -1.565034258489592e-01   +1.124131397949931e-01   +7.739619295382169e-02   -1.985467029224225e-01   -2.749943306103239e-02   -1.174556289232016e-02   +4.273251619897566e-01   -3.778900483244159e-02; -9.058851502766127e-02   -1.938913703928681e-01   -1.122784767724677e-01   +4.463189640616916e-02   -8.273843327058401e-02   -1.061616318673109e-01   -6.233128669607865e-02   -7.532148665140467e-02; +7.016738747877421e-02   +1.532064844219313e-01   -4.382124850310111e-01   +3.452545777191558e-01   +6.534529817032067e-02   -4.317455490362723e-01   +1.555300534872039e-01   +2.167332573966339e-02; -5.598252431551412e-02   -1.383562580121598e-01   -2.258936115972545e-01   -1.927401378874318e-01   +1.939443256655532e-01   +1.312003720970859e-01   -1.768316497505170e-01   +1.303203688270040e-01; +5.123376605240842e-01   -4.304284666827490e-02   -2.303342379378618e-01   +2.197675130129331e-03   -1.110768255414027e-01   -1.002938241318115e-01   -7.623514620102773e-02   -9.453669713577827e-02; -1.664167944432133e-01   -1.436488253291346e-01   -8.336972269194026e-02   +9.928524584320428e-02   -5.710765823145064e-02   -2.548632004682228e-01   -4.727985569953692e-03   +1.069608358133432e-01; +2.045962475890575e-01   +7.007855533594831e-02   -3.019602161890753e-01   +5.673473524975170e-02   +8.744959609320890e-02   +5.511954740264643e-02   -1.400871680513175e-01   +3.647769503939469e-02; +3.999004420368065e-01   +2.992546399000422e-02   +7.412354096004418e-02   -2.312088016073695e-02   -9.253585374149052e-02   -8.422786167181706e-02   +2.702312648660590e-01   -3.991793615874960e-01];
L1I_L2I_iGABA_netcon = [+9.149709669990262e-02   +3.343819525014445e-01   +1.485215294299015e-01   +1.278331321667060e-01   +1.415953788958641e-01   +1.396085241657588e-01   +2.081028787430007e-01   -1.978225649040771e-01   -2.653612165889454e-02   -1.350127206575413e-02   -2.754661906054715e-01   +2.202683550570192e-01   +6.219971830139574e-02   -2.699311976733546e-01   -4.113991413187865e-01   -1.633045022711307e-02; -4.323447451213909e-03   -1.850759358496769e-01   +1.222172317109277e-03   +4.155198466421843e-01   +3.177264787441335e-01   +7.239723967389541e-02   -4.553152944272890e-02   -1.240283531729003e-02   -1.912885549895008e-02   +9.577943387114699e-02   +2.269613981186321e-01   -4.181645435669573e-02   +1.921576943411963e-01   -9.607077568542821e-02   -2.490735527934224e-01   +3.734643072090728e-02; -2.822724096673231e-01   -1.082873572338988e-01   -1.673566067457075e-01   -7.835476880573614e-02   +3.555570815099181e-01   -3.505123785500495e-01   +6.152456679832249e-02   +1.919683717666358e-02   +2.507009362474485e-01   -1.080157718456203e-01   -2.833357650419306e-01   +7.530162137776976e-02   +3.238140479615581e-02   -7.135783500080731e-02   +2.529579183336049e-01   +4.358032216767098e-02; -2.782785338334084e-01   +1.930344334737486e-01   +1.348099642799958e-01   -1.538498450611818e-01   -2.662168036063878e-01   -2.903485840113719e-01   +2.359338804913514e-01   -2.420043708687722e-02   +1.760372393547665e-01   +4.835496716899698e-02   -8.501543806763827e-02   -3.463364685505428e-01   +8.721524683825968e-02   +2.116984036769401e-02   +1.496911291769482e-01   -4.455710663621250e-01; +1.080492132780358e-01   -2.898629466880835e-02   -6.361779915589361e-02   +2.412565066503521e-01   -8.000634808392743e-02   +1.164322016360899e-01   -3.732837591865756e-02   -4.803639527486542e-02   +9.640566152651747e-02   -2.063396220570275e-01   +1.034458876831486e-01   +2.333180643582455e-01   +4.574989572525083e-01   +1.750808903704975e-01   +2.029302140506028e-01   +3.581243394428123e-01; +1.811294537636080e-02   -6.264556063763752e-02   +1.887603515943172e-02   -2.468213826637564e-01   +1.767506365246863e-02   -1.356756576737692e-01   -2.207161911730693e-01   +2.146807968047111e-01   +2.744620068782458e-01   -1.087661734875685e-01   +2.208563297881601e-01   -7.312370528309016e-02   -1.489179582210563e-02   -1.023951999103894e-01   -8.326442841344064e-02   +1.362838227916666e-01; -1.573850610110206e-01   +7.111251605771865e-02   -1.382945324802484e-02   +3.617220686637061e-03   +4.364786315282984e-02   +1.952569886383864e-01   -1.744820044063145e-02   -3.381461894089718e-01   -2.653457624534827e-02   +1.650988126532253e-01   +1.732010576100294e-01   +1.991387516568618e-03   +8.308438103134405e-03   -1.063770299364636e-02   -1.534253087541009e-01   -3.096015382173896e-01; +7.136721007095501e-02   +1.609596942261798e-01   +1.051047128385425e-01   -1.319000229341908e-01   +8.074521901492163e-02   -1.825562767435359e-01   +2.164044321478815e-02   +2.120382344282449e-01   -1.657865252058019e-01   -2.503266612616515e-01   -2.179911706317800e-01   +1.446355509766613e-01   -1.562490955639603e-01   +2.025199357101459e-01   -4.927518082017300e-02   +3.363234001180522e-01];
L2E_L1E_iAMPA_netcon = [+1.976812847228883e-01   +9.451886787077375e-02   +2.026483083595972e-01   +1.637560979879331e-01   -1.165041974585389e-01   -6.457161569031085e-02   +5.117251097943822e-02   -8.393121357590953e-02; +7.641473304726673e-02   -2.467920634727596e-01   -3.666908071938763e-01   -1.928055662403534e-01   -1.148209940418922e-01   -7.669648052667657e-02   +7.018010849679940e-02   +1.655870570001049e-01; -8.240142985428849e-02   -2.172305413166813e-01   -2.835515933080744e-02   -2.012893953299477e-01   -1.696060893869000e-02   +6.675424133839933e-02   +1.034373665842625e-01   -1.100253296112806e-01; +2.356974665131090e-01   +6.354956061707112e-02   +1.386697911353031e-01   +1.901028177902790e-01   -6.603116814241256e-02   -3.481075124113797e-01   +4.206757833795289e-01   +6.471367095635078e-02; -5.511576781367152e-02   +1.687693970886474e-01   -2.994759266762166e-01   +8.942060147809827e-02   -1.334679289294147e-01   -1.530228022945362e-01   -1.361280519494573e-01   +2.078235093860231e-01; -2.754452195597707e-01   -1.922601552729025e-02   +1.722782881486049e-01   +2.439539488701052e-01   +1.807033507417744e-02   +2.724165266416020e-01   +1.143763979561314e-01   -1.195365622442435e-02; +1.869541806065021e-01   -1.533762504756137e-01   +1.474647775600192e-01   +1.720573216971635e-02   +3.169317575696307e-01   +2.302657619902896e-01   +7.081292791872289e-02   +1.943682548662004e-01; +1.452846774122471e-02   -3.440818362508589e-02   -4.568178031033591e-02   +1.336272420093947e-01   +3.451951426367996e-01   -3.492693666593054e-01   -1.171387694205986e-01   -5.178363808375622e-02; -6.351835158349366e-02   +2.086044094572782e-01   +7.544743546989767e-02   +1.604585745831637e-01   +1.308476927523241e-01   -1.671626711505274e-01   -1.461690756972214e-01   -2.332585117133439e-01; +5.029363376222565e-02   -2.082622399172496e-01   -4.844775887813569e-02   -1.950625860438958e-01   +3.285376503348944e-01   -1.028512181381559e-01   +2.213967273532088e-01   -1.203101427248038e-01; -1.279709261410080e-01   +3.998783504608395e-01   -3.079528068236606e-02   +7.908661156083456e-02   -4.142237244468559e-02   -8.787880227424924e-02   -1.931656212848468e-02   +7.357908714224407e-02; -2.607730547875516e-02   -2.009539113212155e-01   +3.738802994356380e-02   +3.927346428285954e-01   -1.571036194987149e-01   +1.557059756225750e-01   -3.719395042022413e-02   -6.601767395745831e-02; -2.186717210703786e-01   -1.326448315604723e-01   -1.780696111335642e-01   +1.818599491475106e-01   +1.611228077286991e-01   +1.247236927036180e-02   +2.514560706899570e-01   +4.436843540120505e-02; -1.791802110660882e-01   -1.834250015070716e-01   +2.530755666866016e-03   +3.479242219848360e-01   +2.397672079457226e-03   -1.088258941137356e-01   +1.511442327736228e-01   -1.304860940844120e-01; +2.731988191914121e-01   -1.366241240974478e-01   -9.797421098064721e-02   -8.543815081490630e-02   -1.172410038583769e-01   +1.668665926432250e-01   -3.262613203471988e-01   +4.255742329356309e-02; +1.588773934250143e-01   -2.530197290282880e-01   -3.835067806128517e-01   +1.505550995677097e-01   +2.817241791753939e-01   -2.310741595194130e-01   +6.924018080104466e-02   +6.025924975594059e-03];
L1E_L2E_iAMPA_netcon = [-2.935578417873690e-01   -1.498191496685278e-01   -3.939281042026293e-02   -3.395430548206510e-02   +6.392957886387352e-02   +8.977036849999150e-02   +6.440846961255528e-02   +1.788078585088897e-02   +1.584271494662344e-01   -2.370869462348507e-01   -2.704253874131095e-01   +5.788477102529600e-02   +1.633460373997567e-01   -6.334829268223190e-02   -1.348890783656189e-01   +1.098461785211417e-01; -3.012537886330883e-01   +9.181109282946268e-02   -2.917761360815814e-01   -1.743606725675044e-01   -2.711382484506183e-01   -1.461277038397227e-01   +1.150661876880141e-01   -1.219929618787913e-01   -8.058589005020771e-02   -1.443706179804498e-01   -1.789741325946678e-01   +1.277868023893287e-01   -3.606356539184504e-01   +2.936909446841738e-01   +3.010993330150914e-01   -1.099298056759264e-01; -4.166502880919532e-01   +7.352841631056027e-02   +1.968675191829388e-01   -3.331128219435209e-01   -3.433614318540656e-02   -3.197650878996983e-01   -6.501861450788894e-02   -1.788553543093837e-02   +1.012773754224667e-01   -8.645496563047826e-02   +1.481234627050928e-01   +1.604940389104475e-01   +9.594384567402773e-03   +2.471875078699564e-01   +2.001178441071124e-01   +2.020557406234817e-01; +2.723508884335136e-01   +9.044703956071033e-02   -2.224214323168596e-01   -6.536635234672317e-02   +6.350597405118041e-02   +8.210144005608547e-02   +1.025864056416097e-01   -8.228280357479756e-02   -2.569787757288429e-02   -1.091501772065095e-01   -9.919498946703402e-02   -4.404486181088121e-02   +1.577244704646990e-01   -2.912885061632050e-01   +1.046357685089995e-01   +7.370616455493403e-02; +1.046274650531651e-01   +7.642711202020222e-03   -3.373286131104920e-01   -2.088986956412198e-02   -1.618915083442623e-01   -2.077501299960924e-01   +1.889136854166988e-01   +1.344128713685638e-01   -4.574219419568698e-02   -9.352921684771238e-02   +2.806357290032934e-01   +5.111625798675506e-02   +4.323084279059590e-01   -1.058058529561274e-03   +1.143879774262565e-01   -3.723641764786956e-01; +2.787673320007812e-02   -1.717367903640297e-01   +2.467511192992367e-01   +2.269594176699431e-01   +3.513145198497711e-01   -1.115478520400099e-01   -4.210363910647334e-02   +3.256959202816968e-02   -5.711264516175915e-03   -2.323869119527759e-02   +9.949801997061845e-02   -2.395959616032271e-02   -4.904151646679112e-01   -1.361433079968772e-01   -2.823557168449344e-01   +2.196565566822153e-02; -3.696084224924551e-02   +2.319031254594906e-01   -1.415894176743650e-01   -1.764738220515141e-01   -6.364828132581629e-04   -3.782407424894727e-01   -1.995786639919509e-01   +3.182040208592926e-02   -4.932700715409188e-02   +3.171727562725277e-01   +2.780521918016488e-01   +7.061007818055443e-02   +2.240024350087283e-01   -1.294552971582060e-01   -3.298548094855435e-01   +1.829153506327018e-02; -1.314502690815931e-01   -1.967847472559298e-01   +3.441027703835955e-01   -1.029913076914983e-01   -1.418562489800497e-01   +2.488072705160371e-01   -6.527367034462862e-02   +1.606754366698807e-01   -1.802459749968992e-01   -1.056882692667379e-01   +3.136210010793395e-01   +9.758520445181049e-02   +3.509616419576862e-01   -8.738856763731129e-02   +2.843334668989395e-01   +1.722394183645488e-01];
L2I_L2E_iAMPA_netcon = [+2.915932105526113e-01   +3.549534358211237e-01   +1.022251923578249e-01   +1.608181426775622e-01   +2.034048353257820e-01   -1.072977622191061e-01   +7.643513853022998e-02   -1.412189098011098e-01; +9.707596198720400e-02   -1.740239079189554e-01   -1.262631264742838e-01   -9.417778100098512e-02   -2.264906556033928e-01   +2.893063599113240e-01   -1.473935040651977e-03   +3.977980329480800e-02; +1.317551463188990e-01   -1.246288934699479e-01   +9.726932722188755e-02   -5.013088945376153e-02   -2.132243201162926e-01   +1.523263368079930e-02   +1.012804860228393e-01   -2.806668181132637e-01; +2.899652844546671e-03   +6.593578386792977e-02   +2.534755543711618e-01   -2.345434841685557e-01   +1.482458624902138e-01   -2.864749546851134e-01   +2.381826399963130e-01   -6.505603098655069e-02; -4.563696884420232e-01   +1.460825949559492e-02   +7.549092013750109e-03   -2.913669625563501e-01   +1.999441509510052e-01   +8.679800262035245e-02   -3.574137168924626e-01   +1.460512095146058e-02; +5.790671698110077e-03   +8.511253887267436e-02   +1.451833479411208e-01   -1.547109789120215e-01   +2.227192795060084e-01   +2.240733854145495e-01   -1.735759582492903e-02   +4.874056467627054e-02; +3.533116214871870e-01   +2.647217523930229e-01   +3.632725425276166e-02   -1.038663053177502e-02   +1.898135499194611e-01   +1.999664207196486e-01   -2.751333431205024e-01   -5.338581658797593e-02; -1.145974384615314e-01   +3.004931045008270e-01   +1.725346820663669e-01   +1.271987599538034e-01   +1.453612823055180e-01   +2.383496504867208e-01   -1.284879650913715e-01   -1.960158365523753e-01];
L2E_L2I_iGABA_netcon = [+2.286436650115003e-01   +1.777466130027529e-01   +6.156077584873867e-02   +2.089381788701477e-01   -1.409715656982572e-01   -3.615058914157218e-01   -8.195841127994513e-02   -1.097682594250332e-01; -1.815566411224689e-01   +1.373945630596174e-02   +6.472121022982232e-02   +1.769693458077795e-01   +8.145269996963315e-02   -4.756281696802281e-02   -1.007714321967556e-01   +2.881659929857436e-01; +2.549351423523466e-01   -1.854140205055809e-01   -1.428406201741434e-01   +1.334823301719648e-01   +2.152202775559416e-01   +6.675295864586295e-02   -8.374840645494208e-03   -2.982254761637854e-03; +1.256356374598129e-01   +1.441937012152573e-01   -1.897572373427972e-01   -3.760039528148974e-02   +1.041583717316045e-01   -4.421019502968782e-01   -2.887011120276091e-01   +9.214758496570562e-02; +2.564788941662263e-02   -3.564783759879088e-01   +1.225657519334184e-01   -3.443869748274465e-02   -2.419158700576581e-01   -2.882923083857495e-01   -1.287596939489935e-01   +7.981145161995944e-02; -1.541956402853614e-01   -3.187194831228606e-01   -2.422367438849009e-01   -1.654354947559198e-01   -3.200469789523156e-02   -3.748056193480948e-02   -1.780671802367585e-01   -1.474440382964246e-01; -5.355583713242933e-02   -2.151497139093997e-01   -1.785148814911849e-01   +5.241014650305570e-02   +2.762805933653986e-01   -2.295551783663536e-01   -3.389761938033080e-02   +1.492837231842088e-01; -1.112763908300794e-01   -1.875593963659289e-02   -2.575440084199036e-02   -7.925203362273921e-02   +3.328951398550974e-01   -1.782701084853485e-01   -1.527871758467801e-01   -2.608531440546696e-01];
L3E_L2E_iAMPA_netcon = [+2.445202311928973e-01   +5.985210906762176e-02   -5.362861177837525e-02   +7.918984085561029e-02   -3.990943848718121e-01   +3.321735623965997e-01   -1.275160266505266e-01   +3.281302874832339e-01   -2.065444418681650e-01   -2.611372332528613e-01   +8.875192003929402e-03   -3.430072205037354e-01; -1.766018249276073e-01   -3.033789364144315e-01   +4.497913184201185e-02   +4.843657657879395e-02   +1.549692671837852e-01   -1.557274722042623e-01   -1.205025020049830e-01   +2.111196692484581e-01   -2.405950638502319e-01   +1.221926727031220e-01   -1.831347980021369e-02   -2.455502628699824e-01; +4.746025095499346e-02   +1.467664169454799e-01   -3.390372581272180e-01   -1.711532255604204e-02   +2.628402906001322e-02   +1.896833094910608e-01   +4.549560472717630e-01   +4.478424414893932e-01   -5.582814994594947e-02   +2.875329546414372e-02   -2.505273894123142e-01   -1.230693816258157e-01; +3.529551930230127e-01   -5.878853289066376e-02   -6.587351359832036e-02   -1.738407556935474e-02   +1.210354779267915e-01   +1.060674933007558e-01   -1.072136605197907e-01   -1.182093323852761e-02   -1.110686857392333e-01   -1.972912497544659e-01   +2.705560292255075e-01   +2.175153269665282e-02; -1.311871302662417e-01   +6.468312772811659e-02   -1.222195769035906e-01   +4.736225155993184e-02   -4.746385272762901e-03   -3.286465045824002e-02   -8.281483102777623e-02   -2.510489807439542e-01   +2.539178864007692e-01   -6.279867234198606e-02   +5.372121808501625e-02   +1.454911699740474e-01; +1.960254595460434e-01   -3.456282396760617e-02   +2.473502695246080e-02   +6.952155250772959e-02   -1.762752729412114e-01   -1.501918922964658e-01   +1.885901487626034e-01   -2.856758687581524e-01   -6.263150386495682e-02   -3.376927946742366e-01   -1.301253577010872e-01   +2.046234755403496e-01; +1.512004849836378e-01   -1.535099783611485e-01   -2.052567384081682e-01   -2.346372660130240e-01   +1.475785734654689e-01   -1.543140437344337e-01   +1.046272479222386e-01   +2.502632324942208e-01   +6.616181657009162e-02   +2.943154356349995e-01   -1.136434616565053e-01   +1.553393487665170e-01; -1.515480810705437e-01   -1.315271351526202e-01   +2.583325085153806e-01   -1.016019901590883e-01   -1.249887413584427e-01   -4.350750085625125e-01   +1.613838031899485e-01   -2.663222429497658e-01   +2.784948548185050e-01   -7.451751709770224e-02   -4.828580399131255e-01   +2.218783006501534e-01];
L3I_L2I_iGABA_netcon = [+1.233607863825967e-01   -6.742017365909167e-02   -2.091189300604600e-01   -6.136620238226995e-02   -4.346134578247688e-02   +1.939560662846344e-01   +4.920699764316371e-02   +2.889172224379010e-01   +1.765206199491087e-01   -1.263953525926412e-01   -2.448036896116786e-01   -1.667268049716008e-01; +2.167467038234536e-01   +3.712354122959588e-03   -1.264987273328207e-01   -4.864883350661382e-02   -2.907391588556604e-01   +5.217174810771175e-02   +1.186231192570233e-01   -1.388501358275178e-01   +2.898285878016515e-01   +7.366875174339781e-02   -3.330582680498594e-01   +1.398984411067815e-01; -1.805084207585437e-01   -3.297659568520340e-02   -6.889770369359494e-02   +1.135114159514949e-02   +3.004630585429665e-01   +1.139565927178253e-01   +2.356946102692889e-01   +9.217965456769438e-02   -4.072613278611573e-01   +1.066926125416155e-01   +1.633839200458805e-01   +1.944820932764200e-01; -2.588457825586054e-01   +1.885701854668276e-01   +2.269432113560088e-01   +4.636735232275802e-02   +7.900649130946438e-02   +1.799055845119168e-01   -2.428652750940690e-01   +2.119241271292682e-01   -5.480659401708869e-02   -1.579261801975232e-01   +2.355863482358875e-01   -7.082021878871146e-02; +3.043872694214444e-01   -1.462680091607316e-02   +1.912796770807219e-01   +3.158499983497154e-03   -9.048424153558601e-02   -1.462825097904313e-01   +1.065744197370234e-01   +8.730359422629212e-02   +2.242586017485865e-01   +2.731810550879804e-02   +1.453845864102316e-02   -1.844177414953130e-03; +1.406195544731985e-01   -3.357120953437413e-01   +3.740901668904461e-01   +4.442332141041436e-02   +9.536521445326188e-02   -2.679575762056905e-01   +7.484898522349193e-02   +3.476251193443575e-01   +3.207260162274714e-01   +2.763255672415195e-02   -1.892623532085926e-01   -2.027242071232340e-01; +6.112390219496652e-02   -3.506953959039948e-02   -1.838791878635538e-01   -1.017181044922793e-01   -1.126880146754195e-01   -3.253891952291221e-01   -7.312813998069831e-02   -2.579737170534391e-01   -2.144958191608666e-01   -7.964015408214523e-02   +1.918145296803584e-01   -1.254862788858205e-02; +2.139578995512422e-01   -1.756875606111844e-01   +5.934966906137969e-02   +5.564998405233508e-02   +2.406922496343071e-01   +2.425356165984826e-01   +9.935020831335942e-02   +2.575500577045293e-01   -2.656201200470605e-01   +2.847884792789416e-02   +3.022569183618237e-01   -3.631956918452882e-01];
L2E_L3E_iAMPA_netcon = [-5.381280986318625e-02   +2.217294761684632e-01   +2.525582262843743e-01   +9.900859800716713e-02   -6.364665854936177e-02   +3.164669165625713e-01   +7.370492674863004e-02   -1.182911487812719e-01; -1.139116227030181e-01   -8.981466310321028e-02   +2.590301501620410e-01   -2.963659818978771e-01   +2.478227411856995e-01   -1.061273152991992e-01   -2.259777304163475e-01   -6.054218768020622e-02; +9.581380909654355e-02   +1.201359820169040e-01   +1.909720048293003e-01   +3.152557597533487e-01   -7.607424921429085e-02   -2.185511715730082e-01   +2.462331215255664e-01   +1.214081460604749e-01; +2.116703060934353e-01   +1.123091850890277e-02   -8.352920280142129e-02   +1.002156525761433e-01   -2.402592559182601e-01   -2.201683701714836e-01   -3.370618122511053e-01   +3.579819170543397e-01; -1.460793577773712e-01   -1.055161906766498e-01   +3.580370408419097e-02   +5.704924432215361e-02   -1.671953741895253e-01   +2.514747762090803e-01   -1.531654334208400e-02   +2.422163174266387e-02; +6.918707944120642e-02   -1.340951361690077e-01   -9.331046112343132e-02   -6.360428948423355e-02   -4.202070040118752e-01   -1.003422408733806e-01   -2.626432863916083e-01   +3.857083840350134e-03; +1.586639131286494e-01   -1.512373346272493e-01   -2.130118096717138e-01   +1.956178740557826e-01   +7.926380070180533e-02   -3.143218039161335e-01   +2.457220792401771e-01   -1.431823213042188e-01; +1.402295809419986e-02   +3.391442955777174e-01   -3.137273669153529e-01   -1.163048715273356e-01   +1.546145955357145e-02   -1.622476156795336e-02   -1.798094038075347e-01   -1.233235626665470e-02; +9.023118729153973e-02   -3.451088207746245e-01   -5.506950773092939e-02   +7.606200800953475e-02   +6.066825396675712e-02   +1.081920895123847e-01   -3.645567728014749e-01   -2.776449874558276e-02; -1.636907938423204e-01   +3.908784368376969e-01   -2.017076811912911e-02   -4.532529743499285e-01   -9.233182148465000e-02   +5.276872530645699e-02   +2.527161789772480e-01   +1.679221261460502e-01; +3.725092921655267e-01   +1.102125446475945e-01   -2.752193776759128e-01   +1.238902850845581e-01   -4.410631617937624e-02   -9.436384359053560e-02   +1.179007653481715e-01   -6.081803290218897e-02; -1.615061953973914e-01   -9.052975136085803e-02   -1.914643486725473e-02   +4.395987343016075e-02   -2.675411315376300e-01   +7.890750391581036e-02   -2.507538769830828e-01   -2.068182863070053e-01];
L2I_L3I_iGABA_netcon = [-1.829753139295440e-01   -4.716132209955082e-02   -1.149167639914850e-01   -2.127412638362036e-01   -2.454446938840260e-01   -1.487600933847590e-01   +1.485738009107690e-01   -4.743482988268097e-02; -1.953350694152605e-01   +1.233704063104295e-01   -2.224357322074931e-01   +1.517954847931064e-01   +2.052203982191637e-01   -9.062311312746059e-02   -2.297146353043540e-01   -1.915069389827811e-01; +6.692181217417756e-02   +1.703375155274948e-01   +3.950435734819780e-01   +2.677031894272017e-01   +2.876851548859143e-01   +2.281800849977588e-01   +6.097357137939646e-01   +1.680624411686706e-01; +2.472199126689913e-01   -2.692102190185026e-01   -2.505042696356313e-01   +2.108285631288890e-01   -2.009762151604326e-01   +3.168241529061788e-01   -2.507734974705018e-01   +1.260064331086380e-02; +1.593431894152145e-01   -3.975571261307012e-01   +8.576555016557845e-02   +1.625363972610566e-01   +6.711661578016111e-02   +4.301909930509964e-01   -2.741315583495905e-01   -4.800969632834531e-02; +3.907455657647131e-01   -2.211060408957961e-01   +1.903043827640915e-01   -2.577227716461136e-01   +2.914802391173317e-02   +1.891919424443672e-01   -6.667741473000419e-02   +1.599534157898684e-01; -1.197773025917171e-01   +7.446542724927507e-03   -2.402251568421077e-01   -1.654972724333148e-02   -1.927604187785672e-01   -1.561713297463707e-02   -2.781466103239599e-01   -1.646701234663889e-01; +1.640482090631364e-01   +1.549298517629901e-01   -1.375700135332031e-03   +2.172459806774435e-01   +3.144464151813112e-01   +2.656973142911170e-02   +2.125662276657370e-01   +5.564784168527659e-02; -3.817126876375359e-01   -2.161620025180479e-01   -2.219982892177147e-01   +3.185284607570936e-01   -7.661194480833380e-02   -1.627882757909591e-02   -1.570197184090437e-01   +2.870545886863109e-01; +2.882979976453184e-02   -1.521111814822855e-01   -4.239432342554778e-02   +1.936816828660601e-01   -5.085501434869966e-03   +5.388220402214573e-02   -1.720043256349345e-01   -7.700875361214311e-02; +3.301043924666975e-01   -1.384463243074280e-01   +3.570016878057896e-01   +5.203199935557734e-02   +1.502737982303876e-01   -3.385973068480911e-01   -1.072979519052644e-01   +5.437255558097270e-02; +1.461960695031857e-01   -2.805829512085481e-01   -7.938082879345215e-02   -1.550886341439064e-02   +1.106796011675552e-01   +5.657905880179086e-02   +6.701644008838915e-02   +2.488225242464147e-01];
L3I_L3E_iAMPA_netcon = [-2.875521024038394e-01   +2.022372186140768e-01   +2.411299075195285e-01   -3.049331868758901e-01   -8.629485783093875e-02   -4.347202190161458e-01   -7.226694092544349e-02   -2.161561797469623e-01   +2.157777219592973e-02   +5.427561259765222e-02   -1.494649274483621e-01   -3.302408847056308e-02; +1.128625077679640e-01   -1.764782052388593e-01   -4.723479863202740e-01   +6.120397500735975e-02   +3.392499218652802e-02   -3.377831394426493e-02   -3.965902716815912e-01   +2.874432138871572e-02   -7.715779666227604e-02   +1.152995428288032e-01   +3.838207822875609e-01   -1.797673890314414e-01; -7.561844143134575e-02   -3.114549695975451e-02   +8.475809920005070e-02   -1.260064350575198e-01   +1.037621080598354e-01   -4.082255601822266e-03   -4.915410856970567e-02   -3.644298511662853e-02   -1.583123874842167e-01   -1.285308889342144e-01   -1.471004433555116e-01   +3.552198422570488e-01; +3.698431201817265e-02   -1.579349357616419e-02   -6.293046439959771e-02   -4.620350305478543e-02   -3.530402751623168e-01   -4.254159788912199e-02   -8.339618829549755e-02   -3.605400036937988e-01   -2.476623862807347e-01   -3.444157683167440e-01   +2.413410088801906e-01   -4.144144611747678e-02; -3.223105664873194e-01   -9.507807443779411e-02   +1.253341714374114e-01   +2.879232731864271e-01   -8.407015703089066e-02   -2.097150256960437e-01   -2.955504450382239e-01   +2.631429461416657e-01   +9.596254821606334e-02   +1.821861906871043e-02   +3.261007436769073e-01   +9.566226439275891e-04; +7.323924233798676e-02   +5.339048242540177e-02   +1.620795437323770e-02   +7.021835353800523e-02   +7.902767832237566e-02   +6.587012984044273e-03   +2.066279393642638e-01   +2.589972699779651e-02   -1.879002195246679e-02   -7.709532001137304e-02   +1.728318053069678e-01   +1.354705810179166e-01; +9.367826990675392e-03   +5.603581492448668e-02   -6.277991385273196e-02   +4.656437501048229e-02   -7.264665975709367e-02   +1.217660599822962e-01   +2.475354919308727e-01   +5.317501686195501e-02   +1.639550094674287e-01   -1.631920275801592e-02   +2.362913982265854e-01   +3.757150692451635e-01; +1.433234922282202e-01   -1.306057226544042e-01   +2.741153362776290e-02   -3.116083659351773e-03   -2.243611386021367e-01   -2.944731776201530e-01   -1.563000973793349e-01   +1.067429055419122e-01   -2.884645088327680e-01   -3.324817166604387e-02   +2.146617058827784e-01   +5.289848728062571e-02; +5.380882868358203e-02   -1.159436378795924e-01   +3.268575044926017e-01   -6.402272946461110e-02   +3.141896809634935e-02   +3.841878491250517e-02   +3.544492284176171e-02   +7.411960473578195e-02   +2.429151113127034e-01   -4.655957626606315e-01   +2.312305541658539e-02   +2.856185023202785e-02; +2.810260521780961e-01   -7.568203637366164e-02   +2.857628300070042e-01   +8.607280301191980e-02   +1.437050436469896e-02   -9.512295166718573e-03   +9.223661499604889e-02   -1.379875003468896e-01   -1.632051320217838e-01   -1.685235480712286e-01   +1.258027182653603e-01   +2.342403921274349e-01; +1.413404689738091e-01   -2.022773108315942e-01   +3.527772165450931e-01   +2.379898266086710e-01   -1.521937063404630e-01   -8.147623009092940e-02   -7.961631410267458e-02   +1.751406655813214e-01   +2.533316858002604e-02   +1.989685877227303e-01   -2.222495580337467e-01   +1.252748327193986e-01; +1.800656544582194e-02   -3.998915748843025e-01   +1.504478993706518e-01   -5.993063519413588e-03   +1.591770283780913e-02   +8.996552344819607e-02   -2.107288385948771e-01   +1.876233144559636e-01   +3.805181616267190e-01   +6.682349665379089e-04   -2.505899804649919e-01   -1.832347500758267e-01];
L3E_L3I_iGABA_netcon = [+2.184514649045886e-01   +1.022304630085704e-01   -2.712437336299757e-01   +1.934120246444541e-02   -3.865638116620031e-02   -2.574216907393792e-01   -1.319439651904822e-01   -1.094303236747008e-01   +1.499136485190398e-01   -2.217539078224685e-01   +2.821325611885098e-01   +1.549805148364120e-01; +1.512492894754159e-01   +1.207124239842552e-03   +6.040382969538834e-02   +5.362881083165245e-02   -1.534646087345962e-01   -2.539718868234810e-01   -3.103900074816331e-01   +1.991972404577627e-01   +2.819908639307488e-01   +2.187145652667989e-01   +2.330946064415520e-01   +2.650470652339104e-02; -4.034844535422954e-01   -3.857078260674907e-02   -2.689973482274893e-02   +3.208078268453399e-01   -3.137582566479341e-01   +1.577035425121553e-02   -3.855568762025899e-01   +2.143588884391517e-02   -5.615895362506987e-02   +2.110745648849581e-01   -2.967926181088060e-02   +1.955597044923332e-01; -3.465351808577911e-01   -1.888999685826184e-01   +1.683483814090247e-01   +1.467974527120565e-01   +6.532586836925638e-02   +9.386420523906677e-02   -6.861951453370921e-02   +1.753259630885386e-02   +3.775085003849048e-02   -3.477513080376874e-01   -1.934260882399635e-01   -1.579939667923916e-01; +1.239095504983867e-01   +2.039834435546992e-03   +1.945314442242912e-01   -9.710087316368354e-02   +3.597285672695100e-02   +1.631472845453232e-01   -3.010856502767058e-01   -3.253534330743176e-01   +6.699624741838067e-02   -3.533190400419730e-01   +1.014922762895380e-01   -1.190845727667617e-01; -2.365837482546936e-01   -2.436366267747903e-02   -2.123808818530511e-01   +1.034889205861677e-01   -1.189690467707908e-01   +3.147367792924008e-01   -9.277631404513167e-03   +1.252283789814813e-01   +2.789420617984654e-01   +3.982377026257862e-01   -1.399970385211718e-02   +1.541867241078553e-01; +1.788431135805421e-01   +3.305848688794683e-01   -2.836986476339938e-02   -1.775694821291619e-01   +1.014970182871273e-02   +8.532467111943542e-02   -1.657222314507958e-01   +6.291600487419836e-02   -1.789000231806701e-01   -1.506410395923174e-01   +1.258608579311918e-01   +2.182149295191650e-01; +2.913564092686402e-01   -2.973388493852853e-02   -1.530440669102994e-01   +3.275011665015209e-01   +5.181691717061913e-02   -2.940501406889786e-01   -9.525715369816676e-02   +3.182164024390050e-01   +2.665345627402677e-02   +2.212642303057242e-01   -6.147292040328752e-02   +1.211596885337364e-01; +2.615081702103325e-01   -2.440584212771570e-03   +1.549032636180008e-01   -4.421078125858341e-02   -1.356932315185617e-01   -3.427446273747987e-01   +3.722553994295575e-02   +3.357006199979686e-01   +7.217298197644925e-02   -2.998927118174951e-01   +2.897560721496025e-02   -1.825883666272435e-01; -1.845887126067168e-01   +6.509065821667992e-02   -7.065208455036694e-02   +1.743563075344022e-01   -1.105477640099653e-01   +2.668020237220926e-01   -5.104616354867147e-03   -2.771079332402727e-02   -2.233552028080809e-01   +2.674049431521674e-01   +4.563020548170464e-01   +1.586225146130700e-01; -3.317689494262189e-01   -1.036133463122390e-01   -4.451150939804059e-01   -1.742926739176159e-02   +2.666161626437309e-01   -2.818305262227953e-01   +3.029559675335057e-01   -1.425320320557339e-01   +1.673816355340958e-01   -1.064219591268846e-02   +4.464278561307376e-02   +2.717170119195922e-01; +1.260855053489809e-01   +7.855657331668556e-02   -3.616459425845062e-02   +2.241647553661163e-01   -1.440335588215629e-01   +1.011530226735483e-01   -6.000917081777762e-02   -7.657671655610568e-02   -1.225390160512532e-01   -2.240310273576663e-01   +1.509722024697422e-01   -2.176360257231803e-01];
L2E_Input1_iAMPA_netcon = [+1.479634916780123e-01   +8.490812823420534e-02   +2.562502324769599e-01   -1.823466037179901e-01   +1.129977036622358e-01   -2.178119327518238e-01   -7.345587049394292e-02   +1.626502538035932e-01];
L2I_Input2_iAMPA_netcon = [+2.870122828422299e-02   +2.890322435965148e-02   +1.669312647438968e-01   +1.189318261225211e-01   -2.261858009450377e-01   +2.123814171063161e-01   -2.721411726986066e-01   +4.419111562988592e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
