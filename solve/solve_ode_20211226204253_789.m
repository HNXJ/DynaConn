function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+4.587354777769691e-02   +1.529569526760467e-01   +1.737185092737932e-02   -8.491640913118975e-02   +2.496581593320484e-03   -5.824716418317419e-02   -6.139538037899496e-03   +1.501345932993540e-01   -4.593615250555394e-02   +1.399512763902685e-01   -2.378744258588401e-01   +1.231015637513631e-01   +2.709600490025649e-02   +9.515596078402155e-02   -2.540754263140418e-01   -1.540790302554488e-01; +1.750840026518648e-01   -2.987167077658270e-01   +1.933039594726962e-01   +1.105422452942121e-01   +1.687389645060940e-02   -5.618080716456397e-02   +9.729048452416914e-02   +3.649658632245992e-02   +1.131226958710145e-01   -3.834147204415061e-02   -2.431066504310373e-01   -1.522705880996942e-01   -2.275182735727740e-01   +1.044480533102138e-01   -8.728620807792888e-02   -1.989052424330267e-01; -7.307957184794749e-03   -2.126650767957698e-01   +1.376726042300830e-01   +1.896327544664056e-02   +9.516770347725198e-02   +3.323555807704508e-02   +1.207222979456112e-01   +1.336762549542642e-01   +1.617689901603471e-01   +7.723789201885214e-02   -1.353315164915124e-03   -1.156204117433787e-01   -1.021093922459330e-02   +5.709145922675690e-02   -3.338153156469769e-01   -7.985157928577521e-02; -1.549813079846163e-01   +1.504730325210916e-01   +1.410961569539057e-01   -6.486013882876641e-02   +1.528644834427910e-01   -1.217270519860496e-02   -8.722153934976679e-02   -8.136285300686682e-03   -1.293361621830291e-02   +2.138405194831271e-01   +9.449122482037872e-02   +5.553725637236249e-02   -2.464981654486749e-02   +1.292866280418502e-02   -7.266969453226099e-04   +1.693534151457279e-01; -1.431664051407463e-01   +1.631244562818694e-01   +1.270907902633719e-01   -1.009368002195460e-01   +2.082947266058282e-01   -3.093042584254518e-01   +2.289984896392449e-02   +4.695497296045917e-02   +1.952325826232288e-01   -9.287000208796237e-02   +1.850562532322588e-01   +1.962765717377147e-02   -2.084098702229926e-02   -1.130583761454428e-01   +1.916910742377003e-02   +9.088602085348288e-02; -8.433543150751925e-02   -1.345587799162037e-01   -8.041094988368884e-02   +3.769359385236366e-02   -1.624436381245098e-01   -8.530270321047609e-02   -2.110792924825394e-01   +3.186114518628405e-01   +3.084627436266037e-01   -3.499767738146615e-01   +7.918396516753083e-02   -3.600095973658020e-02   -2.999390506049660e-01   +2.291513033810749e-01   -4.484652122495941e-02   -1.875371856404249e-01; +1.768337244811488e-01   -2.839633319999780e-01   -2.154916101701689e-02   +1.520509563539354e-01   -2.963874527967377e-01   +1.660239264904080e-01   +2.835160637967709e-01   -2.590754433629721e-01   -1.417479856244535e-01   +7.221381856544176e-02   -1.224525112667693e-01   +2.735059567419684e-01   +2.257596900045385e-01   +3.900693175455237e-02   +1.595125164370774e-01   +1.847248539845062e-01; -4.411605208849761e-02   +6.019715350037625e-02   -3.734181247088608e-01   +8.768409238497596e-02   -1.806767018900734e-01   -2.058898159473801e-02   +3.118698012528415e-01   -1.623227621257382e-01   +1.267368181069924e-02   +9.057584100635453e-02   -8.710926172073738e-02   +1.109870523071836e-01   -6.829759553439750e-02   -3.997566248535848e-01   -1.527268431338087e-02   -9.544349745111864e-02; -1.206459152520783e-01   +4.908317767356143e-02   +3.108235088185740e-01   -1.075409554610779e-02   -4.596889899165083e-02   -1.448284768824043e-01   -1.440632117318674e-02   +8.694386432474475e-02   -2.010081162355301e-01   -2.235039159420332e-01   -1.305056892689407e-01   -3.043228167988419e-01   +1.498455213108111e-01   -1.631973955765043e-01   -1.384301102527784e-01   -5.447249578485489e-03; +6.563345280062786e-02   +7.344756377357192e-02   +2.516151143316647e-01   -1.810796086392848e-01   +2.721239528701631e-01   +6.573017702086126e-03   +4.656220592101648e-02   +4.029837942791236e-02   -1.497927289960516e-01   -1.834014880909800e-01   -1.103072541647746e-01   +2.875075868515002e-01   +4.848769347892428e-02   -2.287956299420152e-01   +1.532892167128279e-01   +1.127947660726053e-01; +1.088652329993621e-01   -1.256497907084583e-01   -1.092744748244121e-01   +9.476011317590124e-02   -1.948461403026666e-02   +2.485161297573261e-01   +9.945142492786735e-02   +1.234892420210271e-01   -5.506089507512985e-02   +2.259699779353209e-02   +3.265366639861405e-01   +1.603546294564558e-01   -3.307235742914266e-01   +1.487669088259494e-01   +3.536669333937906e-01   +1.705692238838460e-01; -3.859260891002151e-02   -1.422380681755474e-01   -2.664680065400493e-01   +2.670351810886719e-01   -1.306262227431609e-01   -7.031107538140607e-02   +9.749862699037590e-02   -1.266283582224646e-01   +2.052417503450033e-01   -1.768373254349754e-01   -2.951519949423007e-01   -8.408028932057342e-02   -3.002826800944840e-01   +2.567351491785204e-01   -2.287532385318226e-01   -1.337133436784788e-01; +1.558350266908899e-01   -1.088031748953370e-01   -3.745142572443045e-01   -6.781188059716613e-02   +1.599296220485277e-01   +1.422872255188340e-02   -2.099808683868751e-01   -1.031869529751323e-01   -1.401069618813280e-01   +1.291881004060391e-01   +3.304513434579776e-02   -1.839015010673571e-01   -1.413173503034436e-01   -1.658064596101365e-01   +2.251698799275303e-01   -8.820575748558143e-03; +4.419805075622537e-01   -4.237065383027432e-02   -1.163908548503582e-01   -1.291770035665210e-01   +1.390310800421042e-01   +1.077974615200338e-01   +4.046184692758817e-02   -1.188387548965700e-01   -3.930051378492855e-02   -1.996532669654357e-01   +7.110562321632344e-02   +1.229349020600734e-02   -6.614217717484784e-02   +2.565410880898247e-01   +1.612501774660911e-01   +2.627508560001192e-01; -1.379726444489630e-01   +9.535046571989365e-02   +1.585392335955491e-01   -1.717339797563467e-01   -1.715490149991264e-01   +3.583183302275383e-02   +9.705823542830679e-02   +3.251294837721677e-01   -5.459130942970044e-02   -2.613272139538787e-02   +2.283392770320545e-01   -9.903077744021853e-02   -3.112553750916304e-02   +9.400526163729153e-02   +9.913781189640378e-02   -8.696928644599848e-02; -1.198170242172549e-01   -3.088492461032111e-01   +2.151997726625852e-01   -1.243747742204067e-01   -2.058867269820185e-01   +3.549464661215375e-02   -9.316215229078510e-02   -2.600208291973803e-01   -8.012043406250630e-03   +4.498843583489043e-02   +1.543926073283605e-01   +1.316301286500557e-02   +1.270497381130812e-01   -1.290814637380185e-01   -8.613757023766257e-02   +4.255928319004919e-04];
L1E_L1I_iGABA_netcon = [-1.799514959909412e-01   +2.342660882765309e-01   -2.645714317938147e-02   +1.732258812335598e-02   +4.947104647791512e-03   +8.081319777759194e-03   +2.165678890100303e-01   -1.580116419804903e-01   +1.220994429553453e-02   -4.544201827428117e-02   +6.371585988777456e-02   -6.690394546404004e-03   +6.870034388986457e-02   +3.720911077360230e-04   -3.922499252746516e-02   -2.123892856050612e-01; -1.672425431613213e-01   +2.069942587351913e-01   -1.835146039744404e-01   -1.957605301971968e-01   +1.275036931534228e-01   -1.989183417985324e-01   +1.658989169075492e-01   +3.402610487430847e-01   -2.150014175378293e-01   -2.653161753906769e-01   -1.875221489701200e-01   -9.385614138157232e-02   -1.157483704360762e-01   +1.879006554222085e-01   -3.994810467040144e-02   +1.276322401199598e-01; +1.133801129381455e-01   +1.971177951237942e-01   +2.689248763956144e-02   -1.231359813191335e-04   +1.532792387081166e-01   -2.547870364211946e-01   +2.133256234836385e-01   -7.584689516213469e-02   +8.401320348151939e-02   -1.619559477814814e-01   -1.321118073658211e-01   -1.174842797919989e-01   +4.112629972970266e-02   -2.115664747571545e-01   -2.280089231310302e-01   -1.452887935039395e-01; -7.716116526601283e-02   +3.101262148506937e-01   +3.053875149058333e-01   -2.392435590915022e-01   -1.023247909175541e-01   -2.431816574495053e-01   -9.577359930635553e-02   -3.348278334828841e-01   +1.877299427738685e-01   +1.101010597233182e-01   +1.125443282397873e-01   +1.930489979003087e-01   +1.700637822133207e-01   +8.039372971076991e-02   +9.622809018456717e-02   +1.179288774676633e-01; +4.055800453556652e-01   -9.409906065287960e-02   -3.891366028196112e-01   -1.315052950596522e-01   -1.681850920329229e-01   -3.679343694208263e-02   -1.545336924996734e-01   +3.322607921291763e-01   +3.857441038486992e-02   -9.863910188010830e-02   +6.406205131500711e-02   +2.071385250898612e-01   +1.618047018755117e-01   -1.071963715818668e-02   +8.137712011193896e-02   -9.441941958561575e-02; -8.588878611940873e-02   +1.215538880586222e-01   +1.564883970629818e-01   -6.959527918528341e-02   -4.893970002480935e-02   +1.091943018685615e-01   -6.285162020672877e-02   +4.107719682990987e-02   -2.255610400758424e-01   +1.759749469304101e-01   -1.829254160888037e-01   +9.602969422823693e-02   +2.956379252612578e-01   +1.172579025437316e-01   +3.210606199051785e-01   -1.159629274085229e-01; +1.071477482345431e-01   +1.463378315220417e-01   -4.728341399596751e-02   +1.496897523568159e-01   -1.294816009771413e-01   +3.094436984724062e-02   +8.087322422150300e-02   +1.157803743947746e-01   -3.228345517844607e-01   +1.729202187924050e-01   -1.610506742110474e-01   +8.588705501451692e-02   +1.944768133425252e-01   -3.656046616251931e-01   +8.399422698071127e-02   +1.358165889179623e-01; +8.517232707163513e-02   -1.427840224943941e-01   +7.155764474090590e-02   +5.833379407577562e-02   +2.574022754232747e-01   -3.564888110800546e-02   -2.194785023236966e-01   +2.939879397419203e-01   -4.007324697752650e-03   +1.699309526750634e-01   +2.021595671058835e-01   +2.689662019238775e-01   +4.514919986975032e-02   -1.467824872506475e-01   -1.241037041312114e-01   -3.732482095881262e-02; +1.915942615762373e-01   -3.208809163117268e-02   -7.919529548529586e-02   +6.684106827165527e-02   -2.207933923540113e-02   -2.055271175828327e-01   -1.849189244751532e-01   -1.712128273098884e-01   -1.814270766812388e-01   -1.030954991017618e-01   +1.842765482613229e-01   -5.320755882880338e-02   +1.817616515044217e-01   -1.108432883428854e-01   +2.306519529008125e-01   -4.340677955799625e-02; +2.946243643238870e-01   -2.318829150801363e-01   +1.042174280212649e-01   -2.222994546942028e-01   +3.319072858130388e-01   +7.076114868594820e-02   +2.779378977434807e-01   -9.315899367357941e-02   -9.009665734741444e-02   +5.679782026480503e-02   -6.336688913768901e-02   -2.910823510337033e-01   +6.766823150815393e-02   +1.084548997123459e-01   -8.215021554895358e-02   -7.457623965533582e-02; -2.285694181791074e-01   -5.798838548781560e-02   +2.200982766224894e-01   +2.396006626693263e-01   +1.074907337304626e-01   +1.351165460765050e-01   +2.465838999810858e-01   -1.959166149368048e-01   +1.218694856189001e-01   -2.938810354556435e-01   +1.797676369540079e-01   -9.062924925049519e-02   -1.352671926325514e-01   +2.399461254833683e-01   -1.804527006935248e-01   -1.273016662130528e-01; -2.862002789152313e-02   -2.136168096070926e-01   -3.461086138566342e-01   -2.183244555669735e-01   +1.301083715564865e-01   +2.344174171991531e-01   -1.693247984589068e-01   -1.857555611899238e-01   +2.231045527748925e-01   +1.518271081334616e-01   -6.708198182635933e-02   -1.881833826169762e-01   +6.522063289376384e-02   -9.476815366638769e-02   -9.317666914732761e-02   +4.713522068225652e-03; +1.592053455124754e-01   +8.139562178095444e-02   +2.118889725411374e-01   -1.567407581033785e-01   +3.709027790070675e-02   +1.170456731327430e-01   -3.052557375669145e-01   -1.695105370409409e-01   -3.840989689428850e-02   -8.464579953933093e-02   +1.098420978554717e-01   +1.822063870840343e-01   +6.599683888999867e-02   -1.603950979746308e-01   +8.790007777471031e-03   +1.235239265083961e-01; +7.442516796092516e-02   -4.748959227413595e-02   -6.556220023577769e-02   -1.118680950415951e-01   -4.629084785627426e-02   -2.272124615712252e-01   -1.575177905895658e-02   +2.182135918359683e-01   -1.400965749671414e-01   +2.243095405188986e-01   +2.163511071643192e-01   -2.973834219719829e-01   +5.983849075053500e-02   +4.338662056489984e-02   -9.765380293935162e-02   +3.768791345559961e-03; -7.610576495923449e-02   -1.365767782404484e-01   -1.307059712976044e-01   +1.153380016224739e-01   +6.783540493024001e-02   +6.550174267498232e-02   -2.561740920133073e-01   +1.914172498505196e-01   +6.727393789393527e-02   -2.129932887654845e-01   +2.670608336975397e-03   +5.268041837541766e-02   -6.264065123103205e-02   -1.505436575783503e-01   -1.957132716522607e-01   -1.535200661156680e-01; +7.103814576507365e-02   +1.002229045974527e-01   -2.080758967063904e-01   +8.333452725378400e-02   -1.050093948097813e-01   +1.970445870853656e-01   +2.017773073455016e-01   -1.779806138976136e-01   +2.241310693885186e-01   -9.459965041711130e-02   -2.880716496069836e-01   +2.705307732209043e-01   +1.574650315283498e-01   +1.022864814693464e-02   +2.283094374203574e-01   -3.376953615759214e-01];
L2I_L1I_iGABA_netcon = [-1.191460812264339e-02   -2.210866438792018e-02   -2.920230570179501e-01   +1.153013244699393e-01   +8.838394302329591e-02   -4.904224853093565e-02   -7.870935590493355e-02   -1.693122588150913e-01; +3.161273198999255e-02   +1.489018075579792e-01   +2.054631013146118e-02   -3.539692146405569e-01   -1.441011183679446e-01   -1.100988177946369e-01   -1.029757805341462e-01   -8.760463606380771e-02; +9.078882357226875e-02   -1.421152786367826e-01   -8.803572625323680e-02   +1.851084421277740e-01   +1.776582443921115e-01   -1.346455410181441e-01   +2.957197160634212e-01   -1.583459918297312e-02; +2.277963489396244e-02   -5.567954245068022e-02   -1.857705803257180e-01   -1.420164526015799e-01   -6.567363595780633e-03   +2.963159898749904e-01   +2.150093951833591e-01   +1.534644388201012e-02; +9.660961183309486e-02   +6.619607667579847e-02   +1.748600999180531e-01   -8.837507118333558e-02   +8.637917862042262e-02   -2.002174529836376e-02   +2.639763412972263e-01   -2.997515816247728e-01; +1.826171330444079e-01   -1.762664563240866e-01   +4.040009837317633e-02   -9.214185441577745e-02   -1.017256157926563e-01   -1.439714595673412e-01   -7.694780986343043e-02   +1.001987583043363e-01; +3.226882211313822e-02   +1.999754141022114e-01   -1.094046002510617e-01   +2.721582332364765e-01   -9.199007144435788e-02   +2.927138992438900e-01   -1.463556915374910e-01   -3.049488055646087e-01; +9.527657792438429e-02   +1.325800982513707e-01   +4.107594272642318e-02   -4.266499247176152e-02   -2.041526458283542e-01   -4.024583965709873e-02   +3.015386354458744e-01   +1.559112950143776e-01; +2.526905830469883e-01   +8.766112770445120e-02   +3.854618424576690e-01   +1.034507342986053e-01   +2.078865413822389e-02   -1.927292844224481e-01   -7.944945788032841e-03   +1.905895913735737e-01; +1.511157016941776e-01   -1.638213762424313e-01   +7.203748428343232e-02   -1.185930999789417e-01   -1.719712852975503e-01   +1.934801765272205e-01   +3.734148538056871e-01   +1.604282693075965e-01; +3.066826247807439e-01   +2.330573992543920e-01   -2.726259928456459e-02   -2.167333477875149e-02   -1.129249377794278e-02   -1.302874644770827e-01   +2.282784136799072e-01   -3.994118814299338e-02; +3.407905589448895e-02   -7.769663218192863e-02   +5.824972848654845e-02   +3.264931435298317e-01   +1.432719667175444e-01   +2.322227002481334e-01   +3.343220610579906e-01   -7.639648998004869e-02; +3.804190372135982e-01   +1.561218843785178e-01   +3.003370145534615e-01   -2.562494076633730e-02   +3.811759532098219e-02   +2.150334205370342e-01   +1.565013599629311e-01   +1.987551273092087e-02; +1.463866534043956e-01   -3.834324332655700e-01   -2.597690463008641e-01   +5.880811121184759e-02   -1.653630393811637e-01   -1.257483195807113e-01   -1.036713708235919e-01   -8.746369687004085e-02; +2.217925067346118e-01   -4.355966003261230e-01   +2.106304590324747e-01   +6.918730209898817e-02   -2.662459196199633e-01   -1.953071868294286e-02   +5.712302430035483e-02   -1.793158337666685e-02; -1.919185831218150e-01   -6.178678753088029e-02   +2.570907671251917e-01   +2.609512134408783e-01   -7.495441904109378e-02   -8.992444146406209e-02   +1.336905687878292e-01   +1.326242990874183e-02];
L1I_L2I_iGABA_netcon = [+1.306947130120182e-01   -1.665893518182366e-01   -2.191731373753225e-01   -3.153339882882925e-02   +3.478415471807544e-01   -2.412805235913704e-02   +2.883864852489262e-01   -1.693969516342899e-01   -3.128872471651246e-01   +1.672834189230503e-01   +1.127229657154289e-01   -2.954686353258736e-01   +2.980116353654078e-01   +1.809751157885808e-02   -8.320743090874652e-02   -2.463721124124686e-01; +1.742073391920871e-01   -7.102603610933028e-02   +2.135128122362090e-01   -1.508416192838555e-01   +2.115957065141363e-01   +9.786377315041543e-02   -2.711226958601521e-01   -1.650096976711490e-02   -3.081536150323007e-01   -2.050928749470325e-03   -1.136155740019557e-02   -1.156259487471342e-01   +2.321018356713871e-01   +1.591286697173865e-01   +2.623793774780563e-01   +1.819022427092978e-01; +2.360514252610315e-01   -3.450285767429628e-01   -1.028875516414127e-01   -8.602195606058907e-02   +1.276912906017690e-03   +2.696164303252721e-01   +1.288217863865080e-01   +2.514367259720386e-01   -6.563397140354893e-02   +2.464345256301274e-02   -9.582609750941957e-02   +1.403736226062784e-02   +1.234847353718739e-01   -1.029327912561820e-01   +1.691200875193841e-02   +9.392101594301064e-02; +1.720176449308659e-01   -1.889333790796482e-01   -6.272562919781691e-02   -1.085478502205776e-01   -2.532990985485375e-01   -1.482467289954040e-01   -2.285137017963380e-01   +2.126096095001025e-01   -2.372296819489301e-02   +1.267167426433237e-01   +5.437792106842398e-02   +8.223983940038784e-04   -1.235082643656166e-01   +2.754474147242503e-01   +4.228023497722092e-02   -3.215049674878815e-02; -5.216345294588899e-03   -2.541699221088261e-02   -2.329486751539788e-02   -2.198974956514255e-01   +1.161003244687623e-01   +7.035240153850500e-02   +9.600299866004725e-02   -2.376039500271341e-02   +1.441200190938977e-03   -1.147675300545817e-01   +3.773848731620764e-02   -7.475515744278932e-02   +6.224691077860929e-02   -2.379506739525526e-01   -1.845310426458859e-01   +2.078898145829217e-01; -3.838774004251551e-01   +4.893223215947020e-02   -2.034425425034382e-01   +1.191830862031391e-02   +2.145835054034460e-01   -1.852836454132034e-01   -3.180969197916612e-01   +4.034940288195223e-02   -3.244846201410196e-02   +4.558257153015595e-02   -2.096909516297742e-01   -1.108784682280219e-02   +4.973226097712968e-02   +1.592091633201473e-01   +9.205126426984184e-02   -1.080583969272235e-01; -2.233283605866136e-01   +1.696214169503280e-01   +1.446558166729060e-01   +1.826897817726529e-01   +2.039225309749986e-01   +1.077543501189874e-01   +2.420073051678135e-01   +4.043195200421378e-02   +1.720303844972509e-01   +2.139606415882059e-01   -1.763877251669996e-02   +2.034111478103947e-01   +1.287308858939077e-02   -8.347083670044915e-02   -7.489610904073025e-02   -1.350345536276528e-01; -2.501592338126393e-01   -3.354245000906253e-01   -1.724840726126394e-01   +6.075863093975752e-02   +8.079290718903945e-02   -2.646633309694658e-02   +1.263454947403892e-03   +7.644527774549373e-02   +6.093684313581574e-02   -2.451392233796405e-01   -1.469401007393204e-01   -2.920718414409099e-02   -2.085145025801116e-01   -1.130346855415085e-02   +7.583329503108846e-02   -3.462424966960789e-02];
L2E_L1E_iAMPA_netcon = [+3.631252228592672e-01   +3.125494522512079e-02   +3.183239695061255e-02   +8.173148850103080e-03   -1.981995906678657e-02   +8.984518590748289e-02   -1.526865770209495e-01   +2.370719117904250e-01; -8.817886845093081e-02   -1.960914953170245e-02   -1.327690662726496e-01   -1.330443641563986e-01   -2.864632128509805e-01   +1.508224215426668e-01   -1.121762787396334e-01   +8.380567965845612e-02; -1.355570156353394e-01   -3.630801706504017e-02   +1.397020977540984e-04   -4.667552126730898e-02   +3.156877117525982e-02   +3.508614573045842e-02   +1.360698693598323e-01   +7.631444529227142e-03; +1.931262695561432e-01   +2.177320457969452e-01   +2.188420582055217e-02   -1.282786014047985e-01   +2.374277792577815e-01   -3.582968148084962e-01   +1.086320887546995e-01   +2.741673506496243e-01; -1.487142033462306e-01   -3.724794459047730e-01   -1.803749405467094e-01   +3.201825260123276e-02   -3.786186161814377e-02   -1.471645506939777e-02   +5.082337634669488e-02   -2.019436633929940e-01; -1.133879729964350e-01   +1.446589498228323e-01   +1.212280181976991e-01   -1.076178470060550e-01   -1.802480418992494e-01   +2.089459738471479e-01   +3.752362957177131e-03   +4.343585314397620e-02; -8.195307534865140e-02   +8.668975278026750e-02   -2.926333917534994e-01   -2.855230118053676e-01   -1.346356260210078e-02   -1.784881542971059e-01   -1.599666259332110e-01   -7.654569651730905e-02; +6.529177700711954e-02   -3.634714242583970e-01   +4.426466017814451e-01   -1.845393336060480e-01   +2.789007684774636e-02   -1.355147144174463e-01   +6.941094247835068e-02   +1.797709989131183e-01; -1.518622351003313e-01   +3.127183297538102e-01   -7.388621964655538e-02   -1.333793995238012e-01   +1.653837054679052e-01   +2.085546239336226e-01   -3.537083363186437e-01   -4.128695833528555e-01; +1.480226705630344e-01   +1.316237366851150e-01   -8.151914231768498e-02   -3.342318238579115e-01   +9.876184912365737e-02   -5.114072635588234e-02   +8.842154142398118e-02   +9.480843515518245e-02; +2.064784327237851e-01   +1.460473760936227e-01   -2.369415011695183e-01   -7.637319002959960e-03   +1.783575154426326e-01   -1.279250570219567e-01   +2.149902736387983e-01   -2.971751462752013e-01; +9.380695370698486e-02   -1.418467656227567e-03   +9.401739995918224e-02   +3.128766082714006e-01   +1.237670461795261e-01   +5.316923949572891e-02   -1.512984883431386e-01   +2.142291278766452e-01; +1.973819308186130e-02   -1.945554613767941e-01   +9.031132203586613e-02   -3.431747676688764e-01   -1.140300093000167e-01   -1.797810100725585e-02   +1.312111234796899e-01   -2.339432963293083e-01; -1.530908233736036e-01   -3.891947045200136e-02   +7.391833424896201e-02   -1.080174819284041e-01   +1.487709456676336e-01   -1.500816930769595e-01   +3.023183190377673e-01   -6.379736484799731e-02; +2.538617571845681e-02   -2.882865615471997e-02   +5.475294336593645e-02   +4.513065066705189e-02   -1.366957118969701e-01   -8.547560488780342e-03   -2.114925721844951e-01   +1.305712138818467e-01; -2.658877808650447e-01   -2.461351357327609e-01   -3.834378649498381e-01   +7.050052951619645e-03   -1.410874481025302e-01   -2.360970832705257e-02   +1.903093642753268e-01   +2.140644427501766e-01];
L1E_L2E_iAMPA_netcon = [-2.225993479386345e-01   -2.802316734678529e-01   -3.959358839676003e-02   +9.011107717173893e-02   +1.274637823243178e-01   -1.283770268123993e-01   +1.435587342889172e-01   +4.875488698692503e-02   +8.215839601432041e-02   +4.292033139392125e-02   -1.161502632564061e-01   -1.102410987796539e-01   -3.624596020151862e-02   -2.014476693178355e-01   +1.605957162042463e-03   +9.837031655960138e-02; -1.504700414885466e-01   -3.251786975104330e-01   +8.303254009054119e-02   +1.109501389393723e-01   -4.371968082967891e-02   +2.227094830859672e-01   -1.095216031183410e-01   +5.715490573929691e-02   +2.142345371750435e-01   +1.539964288530064e-01   +1.576445312018622e-01   -6.348908635198480e-02   +1.225635410038834e-01   +4.152670952624447e-02   +1.690348016828972e-01   +1.645819846517843e-02; -1.903528443948312e-01   +1.985661305842097e-01   +4.617627372010165e-03   -2.754345640665814e-02   -1.096660518261650e-01   -1.809912746136456e-02   +1.711566514150205e-02   -1.162909190288572e-02   +6.875934761120631e-02   +2.579801325536437e-01   -3.394445611734101e-02   +2.180137633524494e-01   -1.292291764902761e-01   -7.980059729786329e-02   -1.255854641332327e-01   +3.614238456778637e-02; +4.180263239018802e-02   +4.771542645573140e-03   -5.664766834044212e-02   +2.592541702787836e-01   +1.052111004094198e-01   -1.228376161914579e-02   +7.726114889262677e-02   +6.163195039182053e-02   -6.239720477883316e-02   +3.544225913279643e-01   +2.237921904743614e-01   -2.276297421543780e-01   -3.478389889745949e-01   -1.290304061752794e-01   -1.036674433652151e-01   -1.229224013663961e-01; +1.456740617191073e-01   +1.572515920326850e-01   +2.035476201887292e-01   +2.444930251831361e-01   -2.330442328823053e-01   +1.605469306837533e-01   +2.968294424297101e-01   +1.646722405387907e-01   -4.917998180354895e-02   -6.502103900128669e-04   +1.032322273921780e-01   -2.080665906395083e-01   +1.296677594019968e-01   +1.218973903666382e-01   +2.202959952736162e-01   -1.092769855730690e-01; +3.862813639650824e-02   -1.081203646574833e-01   -4.857145551029423e-02   +2.532749132011003e-01   +2.379910602015823e-01   -1.792594152264885e-01   +1.601890637798947e-01   -2.067187210810615e-01   +2.723287649965891e-01   -2.145577233819650e-01   +1.574184678041107e-02   -6.540331162894858e-02   -4.313114523521196e-02   +1.739843260584117e-02   +1.062943859491878e-01   -1.212002675839745e-01; +8.608127504608840e-02   -9.118470643245942e-02   -1.562750682241754e-01   +2.848088790510709e-02   +4.128351964647959e-01   +4.847871429975540e-02   -2.748296995158074e-02   -2.817607617525120e-02   +4.615257171448708e-02   -1.485946079256512e-01   +1.647478536432901e-02   -1.164483004348272e-01   +2.501897737468884e-01   +2.706305321052846e-01   -1.018130376958379e-01   -2.371227953650432e-01; +8.040776943780515e-03   -3.011097472086540e-01   +8.403336416766573e-02   -2.425202063739922e-02   -2.142508394642702e-01   +1.326956108066921e-04   +7.336623247024729e-02   -4.027786738449389e-03   +1.283153427320091e-01   -8.167746523035331e-02   +1.717401492022591e-01   +1.465744655611723e-02   +8.713010142046676e-02   +1.031633864182049e-01   -2.440668752074365e-01   +1.705628490662044e-01];
L2I_L2E_iAMPA_netcon = [-1.523128244039656e-01   -4.169015574231252e-01   +9.704871117241112e-02   -1.087896682610732e-01   +1.674079178057760e-01   -2.789891656237136e-01   +2.725599447796925e-01   +2.606591617485571e-01; +1.186745611182480e-01   +2.298658520996683e-01   +1.311057209321858e-02   -6.031183619879123e-02   -4.477801823379705e-03   +4.359854595833508e-02   -2.929250428177250e-01   -4.300214109948070e-03; +2.893068924429814e-01   -2.782415417761755e-01   -2.150558197412829e-01   +1.676692071169247e-01   -3.072238435406338e-02   +1.848386010889362e-01   -1.731020543970882e-03   +1.710778924914988e-01; +4.974604174189041e-02   -1.623191201939674e-01   +2.637405766075463e-01   +1.072396571643345e-01   +1.705876482384287e-01   -1.723500929909395e-01   -2.276781507893554e-01   +1.785426469750107e-01; -2.107022058757821e-01   -1.324630833916887e-01   +6.389379545101223e-02   +3.767928781087430e-01   -1.423671232055038e-01   -8.512845137881622e-02   +1.904284974459814e-01   -2.485961739755302e-01; +7.902071208636043e-03   +8.708486168536428e-02   -6.488990151414459e-02   -1.438481920067120e-01   -1.254670797702112e-01   -7.109243861760053e-02   -1.955326570000880e-01   +9.395890643558946e-02; +2.869632763344229e-01   +1.404725375177963e-01   +2.654815545083284e-02   +2.750757359613739e-01   +8.450971353842163e-02   -1.060723280557635e-01   +3.075759845581432e-02   -9.885547593896041e-02; -3.360574536014876e-02   +3.981850665704620e-01   +2.081208806741754e-01   -1.440801266892720e-02   -3.001024942944350e-01   -8.361747639763992e-02   +3.069274702292656e-01   -6.429672209768245e-02];
L2E_L2I_iGABA_netcon = [+1.591995297965701e-01   +7.160883470212739e-02   -2.231264329547875e-01   -4.186919057302069e-02   +6.348009361617606e-02   -2.519750491761152e-01   -4.375099920702007e-02   -2.824312214708951e-02; +2.656327390873412e-01   -8.963218650826268e-02   +4.597231595347510e-02   +3.061125452609037e-01   +2.743932153442822e-01   -1.281768732149214e-01   -2.693584632829719e-02   +2.350412023892879e-01; -7.874906093262429e-02   -6.855669797677522e-02   +4.599800967120964e-03   +2.133983623626544e-01   +1.978018409601669e-01   +8.642739256827948e-02   -8.953494399157513e-02   +9.758327982826874e-02; +4.885588750390612e-02   -2.343289298891422e-01   +2.079666131702476e-01   -2.424386085660385e-01   +3.835024595596705e-02   -6.343045652202511e-02   -2.016993483285678e-01   -1.288204573093036e-02; +1.381056629530444e-01   +1.575366545916076e-01   -1.933510261928723e-01   -8.637991138580067e-02   +2.693189416787193e-01   +1.618802443002091e-01   -1.244256655053029e-02   +9.185056146561010e-02; +2.202510375354994e-01   +3.628159775147482e-01   -8.463989315653671e-02   -1.296233862229851e-01   +1.906718479647686e-01   -2.199340115881047e-01   +6.126342539748069e-03   -1.003833731591398e-01; -2.570066921804602e-01   -8.648480291335670e-02   +1.663749951473428e-02   -4.310071343876010e-02   +8.221928488829358e-04   +1.695342216527027e-01   -2.716699306218524e-02   -4.252503714126806e-01; +7.718989427944434e-02   -1.952112266281607e-01   +2.257426714692368e-02   -4.774915181422688e-02   +2.455141749693195e-01   -3.140675660866243e-01   -1.496862527965329e-01   +1.751288659823798e-01];
L3E_L2E_iAMPA_netcon = [+4.616306355465568e-02   +1.531390040256426e-01   -1.637784406267165e-01   -9.352109235313322e-02   +2.885674092899986e-01   -1.402074756173276e-02   +1.433558247089093e-01   +2.217288806755689e-02   -7.588332645034634e-02   +2.241445243735282e-01   -2.664227285380389e-02   -4.356416395973068e-02; +1.928338063797120e-01   +7.383128470401266e-02   -2.647387725218762e-02   -1.127884282398267e-01   -2.488705611069676e-01   -2.855465655109454e-01   +6.639115629325473e-02   -1.964451819992184e-01   +7.217269763482970e-02   +1.510859072283721e-01   -1.163710881629667e-01   -1.922930660820518e-02; +7.458742442595161e-03   +2.881678165189829e-01   -1.166444310707572e-01   -1.536452806042514e-01   -1.044822356171793e-01   -6.341999076111607e-02   -2.377327339148144e-02   -6.695684605895852e-02   -2.196221992321873e-01   -9.981343669520773e-02   +1.851878449715816e-01   +6.698253993186551e-02; +3.132613337984029e-02   +5.614825017724272e-02   +6.248575056087921e-02   -6.060083694788239e-02   +1.998529105461959e-01   +1.441309414341227e-02   +1.206038555116297e-01   +3.372802773526398e-02   -8.659093192953134e-02   -1.810110433957455e-02   +6.040424431765012e-02   -6.882455494343827e-02; -3.392382979032443e-01   -3.416255908107779e-02   +1.370807050573093e-01   -4.957218122181098e-03   +8.003657678665396e-02   +1.290246054359639e-01   +1.795798400643244e-01   +2.688172668601005e-02   +2.712202649803701e-02   -1.209885135309761e-02   -4.360857114765440e-01   +4.262732788655782e-02; -1.940163281301980e-01   +1.606495582548955e-02   -3.731808079269261e-02   +2.151422838064060e-01   -1.749109721023820e-01   +2.264355101259120e-01   -2.175851087144794e-01   -2.226787533787457e-01   +1.225025217514308e-01   -1.983197154054944e-01   -3.818342431513996e-02   -1.702317165361521e-01; -4.793415013306208e-02   -1.334387554489201e-01   +2.597561504407457e-01   -4.396901243945746e-02   +2.469232311185258e-02   -1.062752529059361e-01   -1.911744747101694e-01   -3.952373250109146e-02   +1.725743663607337e-01   +1.053161158709655e-01   -8.081401669575410e-02   +1.571885459865796e-01; -9.961249869953326e-02   -4.188052402689957e-02   -6.247463136947033e-02   -3.992613512381787e-01   +1.804710682244647e-02   -7.896336616412347e-02   +1.031853650713467e-01   -9.447834993114594e-02   -3.729924463862958e-01   -1.296545377065723e-01   +1.046406072710445e-01   +1.655499233684687e-01];
L3I_L2I_iGABA_netcon = [+1.100785770513393e-01   +2.127778133730652e-01   +6.395343041742155e-02   +5.220180987914391e-02   -2.850456055280592e-01   -2.352424995636834e-02   +2.917088070549009e-02   -1.890270171588375e-01   -2.501738459084699e-02   +3.617655406883988e-02   -2.922083273464638e-01   -3.732392004919170e-02; -1.735858334632134e-01   -8.339226096019346e-02   -8.895849833580757e-02   -1.498005707101927e-01   -1.646794651643071e-01   -3.496388883842497e-02   +2.082625191130791e-01   -3.840103394258641e-02   -1.801067521698813e-01   -3.340912194214890e-03   -1.312493751210606e-01   -4.898360864888694e-02; -1.069024780819687e-01   -6.507692003095492e-02   -1.775273535868633e-01   -1.296702005818266e-03   -2.563963244781400e-02   -2.104121732737332e-01   -3.853453682322362e-01   -1.922526289025950e-01   +6.757223719029440e-02   +1.026797488894232e-01   -5.346320492414509e-02   -2.041660190741690e-01; +1.481308458319243e-01   -4.121068023062610e-02   -1.014886256164540e-01   +3.069783968361833e-01   -1.171240164649781e-01   -1.705436384088603e-01   -7.180417366045290e-02   -4.374117970644663e-02   -2.331838877417388e-01   -2.915955964086075e-01   -2.011161606224563e-01   -5.243977774410183e-02; -1.417420990368876e-01   +3.229265226189613e-01   +3.160071371870817e-02   +7.795414326976821e-02   -2.118406305632570e-01   -3.816089188843788e-02   +2.165546623472853e-02   -2.483185112997476e-01   -1.834661964607091e-01   +2.296218784876064e-01   -1.291481163819677e-01   -2.258779700476630e-02; -2.012694620038834e-01   +3.291285316266432e-01   -4.628277295858612e-02   +4.135450328225284e-02   -6.704015151232733e-02   +1.609533532676928e-01   +2.483721338402011e-01   +2.444984058687737e-01   -1.807291119801883e-01   -1.783270691666486e-01   -6.327591340651900e-02   -1.511146173482039e-01; +6.513422559176173e-02   +8.273670264611793e-02   +3.224051229762919e-02   -2.254460396780099e-01   +3.372251964926243e-02   -5.140452045775589e-02   +9.656761715869248e-02   +6.899049756788028e-02   -1.585678058525791e-01   +5.300444312154141e-03   +1.839075469649774e-01   -1.769884845563693e-02; -2.742226038216555e-01   +1.443759420518549e-01   -8.075163646430360e-03   -1.452819488396758e-01   -2.050255231223417e-01   -8.765222021885204e-02   -2.496640272739233e-01   -2.309551234572539e-01   -2.942459446681173e-03   +2.986372120627985e-01   -1.925795720768396e-01   -2.739487646436341e-01];
L2E_L3E_iAMPA_netcon = [-3.075264026924092e-01   -9.037467577786029e-02   -9.882640341046098e-02   +3.590925942421566e-01   -1.132093056525390e-01   -5.367415088073507e-02   -8.586415296697916e-02   +1.110567020143233e-01; +4.370874894683942e-02   -2.576692937509683e-01   +4.127069721591606e-02   +2.423473173066686e-01   +7.849575244058012e-02   +1.144106815327860e-02   -2.220925870458870e-01   -2.326065628696518e-01; +1.595078119070730e-01   -1.073770074726248e-02   -2.218005983081091e-01   +1.173608957287930e-01   +6.008505881490001e-02   -1.235393121614056e-01   -1.660004088740411e-01   -1.983635901619104e-02; +2.461332402180531e-01   +1.426344394518515e-01   -1.131928476484189e-01   -1.479306839542379e-01   -1.375241692163560e-01   +5.497421896378879e-02   -3.840839613680012e-04   +1.860943491503501e-02; +5.096764477203952e-02   -1.065021678384451e-01   -1.278145882696577e-01   +6.822225669737914e-02   +1.738807036863441e-01   -2.975154739699092e-01   +1.888164540895246e-01   -1.091272530786640e-01; +2.070911737668218e-02   -4.925259909943028e-02   -1.995678933965554e-02   +7.484144972126459e-02   -6.300886306910697e-03   +7.824813688677842e-02   -1.439479620157232e-01   +7.009815785426658e-02; +1.147275823422291e-01   -2.380806213115592e-01   +2.866437624854047e-02   -2.075826804296108e-01   +2.589381623600964e-03   +1.873492669308918e-01   +3.829374951833453e-02   -6.483915156440756e-02; -2.633487004420933e-01   +4.543171690878629e-02   +2.048159514051481e-01   +7.592099110404031e-02   -2.819202539576323e-01   +9.075811007074772e-02   -2.634861626651419e-01   -5.319929150917577e-02; -7.206424772030237e-02   -2.367191104636163e-02   +2.757320309388565e-01   -1.854461908834967e-02   +4.404042319499787e-02   -2.273729066237395e-01   -2.381803151198163e-01   +1.518379388824037e-01; +3.979519286467306e-01   +1.022606550233551e-01   +1.514775189797964e-01   -9.411906655511312e-02   -1.190870304752432e-01   +4.165797682765256e-02   +1.651486390263742e-01   -3.970043570857849e-02; -2.188464496420055e-01   +2.146578716631521e-01   -6.064389095728352e-03   -8.476908599107934e-02   +7.910404522955521e-02   -3.887632202466855e-02   -2.440574038508860e-01   +2.892601294356007e-01; -5.814628288996448e-02   -3.478976897110337e-01   +4.632169372714231e-02   -2.084420479130011e-01   +2.294614286812088e-02   -5.867030154180198e-02   -3.367333123398640e-01   +7.787936899378475e-02];
L2I_L3I_iGABA_netcon = [+6.518114557138875e-02   -7.168416568227373e-02   -8.802473273028746e-02   +8.532006337283751e-02   +1.907849687638064e-01   +1.445586772796543e-01   +3.543664752387195e-02   -6.874736944694179e-02; -8.334599546851018e-02   +2.897968622309003e-03   +1.184567993288773e-01   +1.686705288590996e-01   -1.051845341780880e-01   -5.999313046046768e-02   +3.633197024314868e-02   -1.035906979479400e-01; -1.572592169746814e-01   +8.289540392569995e-03   -8.216812375678667e-02   -9.541154510209092e-02   -1.012160671549978e-01   -9.120482563968595e-02   -7.211685371341364e-02   -8.998799693647436e-02; +1.034206897355805e-02   -1.389082373151561e-01   -9.601182356263938e-03   +1.058021647124824e-01   +1.683145296319575e-01   +2.689171427520547e-01   +3.277544739818843e-01   -4.519059451577537e-02; -1.101935475648034e-01   +2.392087825867112e-01   +1.364900004118634e-01   +2.065143457373968e-01   +2.703711062927206e-01   +4.171938350262820e-02   +2.542346722279590e-01   +1.404181469707727e-01; +3.021768526346007e-01   +4.834605502971515e-02   +2.354716041854584e-01   -2.496586513775957e-01   -2.438195865974139e-01   +3.768491697210759e-02   -1.702844920236063e-03   +2.084691341897102e-01; -1.036923869101931e-02   +1.019101744167075e-01   +2.607651414771872e-01   -2.387931524037502e-01   -3.721164508998248e-01   -1.002162725136934e-01   -1.098840437131531e-01   -2.063218740498571e-01; -5.303695637084736e-02   -1.352355194417833e-01   +1.216379059697148e-01   -1.843725836934361e-01   +1.931443861922547e-01   -2.100213947645209e-01   +1.930908288420743e-01   -4.419448788330230e-02; -8.114766854587573e-02   +2.126660835728700e-01   -1.079223100549620e-01   -1.439843575640616e-01   -9.287307728491309e-02   +9.198824714827625e-02   +4.543708343168446e-02   -1.872137578248644e-01; +1.420583942254666e-02   +5.970276439483119e-02   +6.897758201943729e-02   +2.010627698318300e-01   -2.011435621277366e-01   -5.430535393978736e-02   -8.694882315553545e-02   -1.958736314986953e-01; +1.234033654317098e-01   -4.341286473953419e-01   -1.433281391169026e-01   +3.012049094651714e-02   +1.252591128480660e-01   -2.580627631128609e-01   -8.525204793628069e-02   +1.275471793347463e-01; -1.160292831526943e-01   +2.499662177592079e-01   +5.875554358888874e-02   -8.783426397750174e-02   -5.046177635500872e-02   -1.457163602409809e-01   +1.045137952278757e-01   -1.517178382927262e-01];
L3I_L3E_iAMPA_netcon = [-1.598836353332760e-01   -1.031537565902718e-01   +1.246578205389608e-01   -2.186062787929280e-01   +7.032694123865479e-04   -2.908135481273429e-02   -1.119955263221317e-02   -5.977263136445240e-02   -1.738680441490122e-01   +3.548673690914793e-02   -1.841193282630619e-01   +2.907913376769265e-02; +1.620241314870545e-01   +6.656336018357432e-02   -1.132653321979421e-01   +1.894063822343411e-01   -4.166986395677342e-02   -2.288772019259004e-01   +5.774216814490422e-02   -7.995447568897395e-03   +1.557879247259146e-02   +1.032476650734155e-01   -2.269621109499264e-01   -5.583520469485444e-02; -2.631384210372832e-01   +3.037730779144122e-01   +1.329198476738459e-01   -1.018895118096476e-01   -8.162042447188936e-02   +5.316761440345195e-02   -7.703712196320935e-02   +6.357293983316378e-02   -1.186207509765494e-01   -1.854380514727542e-01   -1.494489011871931e-01   +1.520875510697409e-01; +1.759270367642866e-02   +1.062348274173820e-01   -1.383412288074507e-01   +2.537687889105283e-01   +1.614956726340266e-01   -2.486485714104225e-02   +1.122812927258822e-01   +3.336785177186170e-02   -1.868648464887486e-01   -1.899042520272882e-01   -2.551958812997144e-01   +1.606452097082411e-02; -1.134179858348703e-01   -2.161367824472878e-01   +6.344264980786715e-02   +1.234483781541678e-02   +7.386389665396829e-02   +9.159788652704851e-04   -6.567355916209300e-02   +4.154838230156896e-02   +2.594901539276489e-01   +7.064376186882307e-02   -9.356138516664465e-02   -2.526829746741503e-01; -4.045145403156346e-02   -2.505272844709395e-03   +6.179219436592578e-02   -1.890771868908001e-01   +1.806784905402127e-01   -2.668069770402271e-01   -1.465759721306496e-01   +1.652102750039999e-01   -9.853882269983000e-02   +1.083640114281330e-01   +1.492016083284185e-01   +9.395250027524066e-02; -9.069022214552816e-02   +2.459922545682823e-01   -2.791672187022580e-01   +2.957447595559980e-01   -2.201045043474285e-01   -1.489398813987757e-01   -1.595970084030411e-01   -4.297610340610745e-02   +4.228970526754769e-03   -5.040759044060560e-02   -3.541669250779575e-03   +2.352957632050620e-02; -8.143869780986543e-02   -2.912181232492005e-01   -4.438467888637086e-02   +7.585386850430774e-02   -8.860508375575202e-02   +2.105503518381703e-01   +3.901091701327659e-02   +3.215255663314781e-01   -5.468387443386996e-02   -3.611088528132494e-02   +1.567589757258854e-01   -3.214624440820334e-02; +1.490856044293854e-01   +1.700315883634778e-01   +1.293695286502048e-01   -5.803940908819512e-02   +3.635543709182198e-01   -1.635147556186579e-01   +6.337347855412767e-02   -1.268470117393720e-01   +4.831523400653782e-02   -1.277973461090015e-01   -3.148013952331462e-01   -1.377066868051759e-01; +6.672145780249129e-02   -3.349216060485998e-02   -1.477329134787972e-01   -1.668348992782697e-01   -1.521057870492413e-01   -1.716748620435753e-01   -1.889120254274515e-01   +1.761640275962612e-02   +6.374246915120789e-02   -1.280762965677003e-01   -1.873349163158408e-01   -4.751160590710422e-03; +1.778441494373041e-01   -1.049293952930811e-02   -1.247290859463975e-02   -3.018104314182040e-01   -3.678751309502783e-02   -1.329683559067352e-01   -1.213518774883475e-02   -6.306916447566502e-03   -1.384135832728417e-01   +1.052993291562449e-01   -4.732272974518015e-02   +5.290962647631455e-02; -1.241108420044015e-01   -5.347950665511210e-02   +2.072784515858055e-01   -2.215528489976255e-01   -2.940665334089894e-02   +6.060033244571053e-02   -3.052968962713882e-01   -1.597508279558376e-01   +1.907091809161487e-01   +1.437294371116324e-02   -2.129809905918446e-01   -1.159724089068506e-01];
L3E_L3I_iGABA_netcon = [+3.075639385234345e-01   -1.031567171950425e-02   +2.270996572386180e-01   +1.847858858003853e-01   +1.452494085300681e-01   -1.786639327733479e-01   +1.646053448465975e-01   +8.655323225142461e-02   +1.511324949751202e-02   -6.391904057093899e-02   +1.788395466149814e-01   +3.236473295690369e-01; -1.383130099426396e-01   +1.379257728851251e-01   +1.472393628952500e-01   -1.058500953729620e-02   -1.798283044059759e-01   +9.417827448023713e-02   +9.476446120012837e-02   -1.332048588067055e-02   +9.062356900576463e-02   +8.191089875776736e-02   -5.708677730261971e-02   -1.157582692073942e-01; -9.146173781959445e-02   +7.631382646843357e-02   -5.822270495388184e-02   +1.213303543402982e-02   +2.677479222975639e-01   -8.361266092976755e-02   +1.244566559003995e-01   -8.815749235817545e-02   -1.755294634318346e-01   +1.791115822736381e-01   +2.273449465718806e-01   -2.804386677177212e-01; -2.800431081325309e-02   +8.509068190921328e-02   +2.603541983627718e-01   +8.120369483562237e-02   +3.892863527356853e-02   +7.959462354390805e-03   +1.142844601187765e-01   -6.773183852411342e-02   -2.305301085545531e-01   +4.607872731801247e-02   -6.111387344963578e-02   -6.233559649910227e-02; -1.934456397548129e-01   -2.058236169211245e-01   +1.773912029708621e-01   -2.704101277896144e-04   +6.073699861103828e-02   -2.714020362920745e-01   -2.820353439811536e-02   +3.139028496455158e-01   +7.336046827617854e-02   -1.235892969197631e-03   +1.119010419480287e-01   -4.001751664136972e-02; -4.362665762846354e-03   -1.041104237009632e-01   +2.414846261142202e-01   +1.398032659667472e-01   -1.739976757371159e-02   -6.022998474825604e-03   -1.667109432161776e-01   -1.459409623366881e-01   +1.937321894521697e-01   +8.740537451728053e-02   -1.463768860708366e-01   +2.762409848061705e-01; +1.139312429399406e-01   +7.372668957438497e-02   -8.279456793790319e-02   +1.226782226530241e-01   +1.557896622299009e-01   +1.213483868489108e-01   -1.628881492848941e-01   +9.453121010688698e-02   +1.837149136717518e-01   +2.686236425947606e-02   -3.397215558476428e-02   +1.745169509920551e-01; -1.662565465005829e-01   -2.516074663699684e-01   -1.425532471812180e-02   +5.625944954658844e-02   -9.254671414404222e-03   -2.221416183899364e-01   -5.498113087500926e-03   +9.953548325733574e-02   -1.330321320240313e-01   +1.214894306919990e-01   -1.104209546607366e-01   +2.214386752214801e-01; -1.979381522603475e-01   -7.028426371590961e-02   -2.663177940883949e-02   +2.236258081157708e-01   +3.333629665532224e-02   -1.778469462350639e-01   -9.832967383995619e-02   +5.565432921129604e-02   +1.210175886496993e-01   +3.613596363946474e-01   +1.436721469909771e-02   -2.154354552067580e-01; +1.758940099675080e-01   -1.657165077692813e-01   +5.002237914755051e-02   -1.224692586644957e-01   -6.316910184409519e-02   +4.976511193456805e-02   -9.005298170889220e-02   -1.623402790419529e-01   +1.216908179516409e-01   +2.516577866817806e-01   +2.379614818448017e-01   +1.795216998164821e-01; -5.422767312498022e-02   +1.059676452677474e-01   -3.669027817422484e-02   +1.336151235956688e-01   +3.257254072865469e-01   +6.295250489918445e-03   +3.085348038376404e-01   +1.997980361182897e-01   -6.580508789848712e-02   -2.261390335857285e-01   -1.424119977635279e-01   -2.807227608028463e-02; +2.493105293063892e-02   -2.634859859009429e-01   -1.183469102523219e-01   -1.142946114518991e-01   -2.451624800338685e-01   +1.293793112405410e-01   +1.348008172412765e-02   -2.813392766132540e-02   -2.103428442917674e-01   -2.136527251230443e-01   -7.836750705741954e-02   -1.117018890927756e-02];
L2E_Input1_iAMPA_netcon = [-3.319451170090499e-01   +7.574394085469582e-02   -2.452235984794134e-01   -3.047606091256114e-01   +5.873950048407701e-02   -2.010343406209161e-01   -1.543000329422633e-01   +2.935714439575088e-01];
L2I_Input2_iAMPA_netcon = [-1.900352151260679e-01   -2.658858642189287e-01   -1.484597667414564e-01   -5.118324361765713e-02   +1.729948461175781e-01   -4.543328081551049e-02   +2.178548563039226e-01   -5.868066426185038e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
