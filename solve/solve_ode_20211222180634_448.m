function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.176591967454806e-01   -8.251631361542723e-02   +7.052504227219201e-01   -2.382207603196065e-02   +2.998879979591569e-01   +6.931154195831484e-01   -2.577353635237686e-01   +2.492061542153367e-01   +6.437653985946565e-01   +3.921400435626144e-01   +2.958493436627087e-01   -3.122122839533060e-01   -2.665474532741811e-01   -5.937706382284142e-01   +1.273067494447397e-01   -4.321786688620007e-01; +5.062843860866462e-01   -1.806223305782416e-01   +5.406004963492922e-02   -5.318629981568135e-01   -2.243884339782936e-01   -3.602074995958680e-01   +5.849042657908470e-01   -6.279344448017074e-02   -1.653603001106882e-01   +9.683110425600061e-02   +1.321194586726707e-01   +9.487595059267694e-02   +1.202420441074142e-01   -1.108046140750117e-01   +4.531314931655559e-01   +3.019452960488826e-01; +5.307624278532582e-01   -1.729626289221151e-01   -4.880313276628999e-01   +2.241634869352504e-01   +4.763830145697422e-01   +2.744532778240404e-01   +4.313121224271140e-01   -4.029400077308992e-01   -1.863731400263638e-01   +1.466588674605196e-01   -6.801838111901799e-01   -4.225007007430813e-01   +3.095192087299867e-02   +2.987517330276665e-01   -4.810539320279861e-01   +4.015347221791235e-01; -1.649541899312245e-01   -2.231022675575267e-01   +1.162184064070931e-01   +1.403984027471304e-01   -2.336982980225057e-02   +9.760980322477747e-02   +3.157064482575053e-01   -2.016201971308714e-02   +1.539939285459411e-01   +2.249822380575188e-02   +3.206074063389351e-01   +2.326985350478181e-01   +1.248886396655580e-01   +1.000800753992502e-01   +3.273841338303999e-01   +7.198319094380546e-01; -2.429184278279834e-01   -3.614486864888000e-02   -4.472856091201020e-01   +1.593171980009097e-01   +1.367788034418860e-01   -2.740825973560006e-01   +9.475325591047079e-02   +6.182304767835617e-01   -1.420993634699150e-02   +6.223872753422853e-01   +9.518273837413609e-02   +3.001006522200760e-01   +2.461404161954107e-01   -2.343958282478896e-01   +8.206473262311786e-02   -2.932880281458246e-01; +5.607485635225944e-03   -5.604559300851133e-01   -1.273319897610280e-02   +2.178704369368165e-01   -5.489204187211323e-01   +2.798420190361446e-01   -1.085203374223748e-01   +3.510903114616734e-01   -1.204834258904773e-01   +3.527254782192765e-02   -1.258527758890058e-01   +2.813871628986834e-01   -2.616900020342768e-01   -2.916184457623274e-01   -5.166702410832558e-03   +1.789928879040972e-01; +3.294129875407068e-01   -7.854067191882537e-02   +2.613858936723922e-01   -5.266070205387183e-02   +1.747191100197845e-01   -1.616665574275620e-01   +2.233131989237164e-01   +4.482906724751876e-01   +1.453030424217547e-02   -2.518585664347193e-01   +3.825003039499690e-01   +1.681330305009392e-01   -3.485718934072415e-01   -6.277841224775842e-01   -4.326729208267550e-01   -2.741984782781419e-01; -2.940104376884382e-01   -1.783036267554545e-01   +5.499569215097133e-01   +2.859928202290782e-01   +4.978213859452851e-03   +2.702807318869694e-01   -1.444227022927369e-02   +2.448567108402047e-01   +2.067190580179024e-01   +6.508241230005519e-01   -7.039558570839632e-02   +2.162619579744050e-01   -1.009667485254753e-01   -8.866335447357328e-02   -2.027690479581706e-01   +6.768715737662551e-03; +1.523043856217751e-01   +8.623860447864704e-02   -5.365375149861952e-01   +6.318760522209681e-02   -4.362024319949592e-02   +2.974950578458231e-01   +2.805125772772069e-01   +1.444958584381144e-01   +9.987410479671349e-02   +5.443323512467744e-01   -6.449033025508788e-01   +2.276180811734649e-01   +1.109712768450579e-01   -4.496261996757693e-01   +3.062959153823116e-01   +5.822247097609489e-01; -1.485579824578389e-01   -1.836591436025564e-01   +3.133378114119674e-01   +3.791713691643632e-01   -1.420839011850554e-01   +7.032988800352363e-01   -3.248867644773325e-01   +2.337803904455188e-02   +8.040930114672050e-02   -5.880595914368089e-01   +1.806624876868881e-02   -3.514195840687245e-01   +3.310734601003439e-01   -2.427898381041525e-01   +5.251410897846608e-02   +8.565459270918840e-02; +4.169848100313861e-01   +7.302836264401272e-02   +6.880061611808990e-01   -3.039536672795358e-02   +1.937133451223517e-01   -7.902648489298536e-01   -1.475555814205054e-02   -2.975317058707355e-01   +6.006372256561240e-02   +4.239361396511444e-01   +1.753336021699055e-01   -4.426327688396682e-01   +4.626951496946967e-01   +3.993690580837137e-01   -5.123662479271291e-01   -3.049276193041142e-01; -2.048048925795108e-01   +7.510113911768270e-01   +5.658746256724960e-01   +9.357836224166860e-03   +4.888447509260523e-01   -7.117448971701557e-02   -5.562295262170155e-01   +5.332561690367533e-01   +5.372423183297146e-01   +3.788366027380821e-01   -3.826576855043728e-02   +4.373984867199543e-01   +1.163658201732411e-01   +1.514074651165355e-01   -2.540668439644183e-01   -7.927027698907906e-02; +1.378586227999773e-01   +4.059999424046945e-01   -1.362985326585031e-02   -1.139575272121771e-01   -4.044226512275344e-01   -9.010030541848287e-03   +1.063029042549487e-02   +1.685908153377157e-02   +1.225785665039625e-01   +2.188768743152328e-01   -3.368591863449230e-01   -9.156535208600419e-02   +2.499640130521004e-01   +6.175447475840035e-02   +7.388681045774336e-01   +3.123232985080873e-01; -1.093350609948865e-01   +3.146784531785519e-01   +1.997862308898088e-01   +3.497664943279373e-01   -2.616331970737629e-01   +2.511609390617245e-01   +1.004813556218718e-01   +5.330427313805708e-01   +4.762625803001176e-02   +4.419661935516584e-01   +5.640929084919063e-01   -1.569483544461722e-01   +4.294903975868596e-01   -8.792730918948825e-02   +1.144294817059822e-01   -3.991892109243866e-01; +2.050716622565862e-02   +2.742705412678953e-01   +8.107353220601902e-01   -2.559249857216996e-01   +3.289886951508595e-01   +1.416989772414817e-01   -4.693725986716877e-01   +2.524711501870003e-01   +3.209614085899420e-02   -4.727799693460853e-01   -6.357997576410181e-01   -4.364810384450021e-01   -7.608147201791939e-02   +7.450750420834966e-02   -7.369738933198064e-02   -8.857955629996592e-02; -1.455427302696338e-01   -2.823664134169257e-01   -6.410461490743132e-01   -5.703339393145876e-01   +1.370698218793814e-01   -5.644090259659598e-01   +6.682179023091980e-02   -5.453048535568992e-01   +4.316549331732774e-01   +4.762871820484832e-01   -2.799927317113660e-02   -1.666825582154259e-01   +4.299027991787191e-03   +8.951935088343843e-02   -3.069692626336238e-01   +1.487970697702146e-01];
L1E_L1I_iGABA_netcon = [+2.221728836882139e-02   +4.104792136198812e-01   -2.950241268520774e-01   +3.109446640468838e-02   +1.876746237118755e-01   -1.264291214358341e-01   -2.794266890619885e-01   -1.543190493404016e-01   -2.445255054443087e-02   +5.074510598359798e-02   -3.473504887023116e-01   +2.556632644895941e-01   -2.386479087857923e-02   +4.238297643879420e-01   +4.835472629040008e-02   +6.952995827033566e-01; -1.628200786212762e-01   +3.843342130587291e-01   -9.808193975735439e-02   -3.396868321048494e-01   +2.731613760743317e-02   -1.077586759767244e-01   -4.963546213029433e-01   -3.916579768695712e-02   -1.430633596477541e-01   +4.747298911647883e-01   +4.247633647014202e-01   +1.004830252576006e-02   +1.221405103937949e-01   +4.286961973100222e-01   +8.672479399034438e-01   +1.614612700030774e-01; +5.062850457503046e-01   -1.111681015994131e-02   -2.796994847350558e-01   -4.679626921372753e-01   -2.665704515864437e-01   +1.106838038412779e-01   -1.127692334596566e-01   +4.653212046663702e-02   -2.764756434660051e-01   +1.797280206361369e-01   +2.597006183877375e-01   -4.636079324865988e-01   +3.650697183907317e-01   +5.553273924566404e-01   -1.118276428699002e-01   +8.355451203238738e-02; +4.898162193363977e-02   -2.100665794700615e-01   +5.313092302413940e-01   +4.148913343567914e-01   +3.585725584024226e-01   -2.490412993249386e-01   +2.525458819839706e-02   -1.238377034448916e-01   +1.731553168214847e-02   -1.396975777096111e-01   +5.417186625159043e-02   -2.126445584758624e-01   +3.975064193782062e-01   +1.806275985570593e-01   +2.825263409430202e-02   +1.746048111621575e-01; -4.567630646025751e-01   -5.802398650340896e-01   -4.488187988812264e-02   +5.269653524784419e-01   +3.364783933527701e-01   +3.932485277419441e-01   +4.548305324857568e-01   +2.569601418069485e-01   -1.083838291671326e-01   +1.914329155668814e-01   +1.739836696017240e-01   -2.827731043009294e-01   -1.244343679661184e-01   -3.303287184093345e-01   +3.573456218735518e-01   -3.850904201615621e-01; +1.114401777057798e-01   -2.900862231389859e-01   -1.811391886276753e-01   -1.331665604831227e-01   +4.885179447972733e-01   -5.845163274856899e-02   -1.345388152694910e-01   +2.938477851766952e-01   +6.398480121406146e-01   +9.065655073883516e-02   -1.132057153694486e-01   +3.813815858556378e-01   +6.962282784095457e-01   +9.277415907688433e-01   +3.420606927355121e-01   +7.915953065657769e-02; -3.638385547661181e-01   +7.541131241739271e-02   +1.532963403323461e-01   +5.737828302901830e-01   -1.645522798534038e-02   +1.715826462009287e-01   -4.104885082574840e-01   +1.825701108853856e-02   +9.672595535080096e-02   -6.122808903585496e-02   +8.746303925121166e-02   +7.158262425271514e-01   -4.741144251614687e-01   +3.612249847691240e-01   +9.068154513309493e-02   -1.658120221117242e-01; +4.645563635637833e-02   -5.394839470934312e-02   -1.532509198172646e-03   -1.071612583131914e-01   -5.004350395422585e-02   +2.330219360096941e-01   +4.909911495383595e-02   -9.727249904440349e-03   +1.765283429516711e-01   -4.709886686766294e-01   -4.093283333264859e-01   +5.428495143228325e-01   +2.510983276892324e-01   -3.816726178350647e-01   +2.914051731502623e-03   +2.419120638408551e-01; +4.238881948533327e-01   -5.234048085838269e-01   +4.066506939353986e-01   +2.482107023257454e-01   +5.292083906439882e-02   +1.575080566091326e-01   +1.918159956346900e-01   -4.833792632032882e-01   -2.391376253831812e-01   +1.624326931259132e-01   -3.132477196567135e-02   -6.528933772356772e-01   -1.899948325217304e-01   +4.431552690203919e-01   +2.702105146315945e-01   -4.195173698092785e-01; -1.177730060605948e-01   +5.587234108601957e-01   +3.256335469477727e-01   +5.107547162878899e-01   -7.987089069364681e-02   -7.668941208292702e-01   +2.344921272111497e-01   +1.056511877695195e-02   +3.346663594300501e-01   +2.716819833064394e-01   +2.026150739384505e-01   -3.701616453790177e-01   +6.769366070150373e-02   +8.818598144941472e-02   -3.569664217467322e-01   +5.298011617129854e-01; -3.866489027670010e-01   -4.476895868501467e-01   -4.130393579207283e-01   +6.593703215005546e-01   -1.470877042098130e-01   +6.377109548147549e-01   +2.619383625388254e-01   +7.222456682459684e-01   +6.142714504709833e-01   +6.002903848947728e-01   -5.888103582869017e-02   +3.191251705853534e-02   +3.804319673890300e-01   +4.209328499481182e-01   +2.005270648240443e-01   +2.094706836416598e-01; +7.045343853951592e-01   -2.318866509817007e-01   +3.499566051642484e-01   +3.237712389191897e-01   +6.051388205288852e-01   -1.345728835463251e-01   -7.615616938841870e-02   -2.162585480343567e-01   +5.997311256268644e-01   +6.412651391569385e-02   -3.863050272021495e-01   +2.897825093643633e-01   -1.483572630425775e-01   +1.516888441947981e-01   -2.731008679379479e-01   +3.655425045468198e-01; -2.836687796527704e-02   +1.300063256747172e-01   -1.002112643196016e-01   +6.808081586595248e-01   -4.198228929466074e-01   +6.753041508238881e-02   +5.317943292556720e-02   +4.933292469484535e-01   +3.872556113362896e-01   +2.977189122053450e-01   -1.157865041634706e-01   +4.588857668291623e-01   -2.775048370121315e-01   +9.991222384597537e-02   -3.054315145964200e-01   -1.416379170381530e-01; +3.900765758671909e-01   -6.307556653487184e-01   -1.510235109252800e-01   -1.070984032979893e-01   -1.128457056610566e-01   -8.051828868664129e-01   -3.365605888576437e-01   +6.165167532716249e-01   +1.729835747486614e-01   +6.785901892354210e-01   -3.970181967278988e-02   -2.066355263632372e-01   -9.071224803074640e-02   -3.547871424728796e-02   +1.069574426458400e-02   -1.291894829257815e-01; +1.559889620878490e-01   -5.982196474092349e-01   -1.267259812587676e-01   -2.794849647690788e-01   +1.741692646212817e-01   +1.921472618484482e-01   +5.997379460163643e-01   -5.348966598260749e-01   +5.232745888208590e-01   -9.283828243546971e-02   -2.618657904347880e-01   -3.704619491794472e-01   -2.480627702522976e-01   -3.058724048226746e-01   -5.990164192887840e-01   +1.628420055942913e-01; +1.323923406829496e-01   +3.145061849967218e-01   -3.548476653106016e-02   -3.334877132118166e-02   +2.172198211373228e-01   -7.266216135373875e-01   +3.150946539852780e-01   +4.113866347819885e-01   -3.043153948408195e-02   +2.525937315973129e-02   -3.270593287888118e-01   +1.354677402183125e-01   -6.092860191785948e-01   -7.065594840845271e-02   +7.388411849995372e-01   +6.757909581101967e-02];
L2I_L1I_iGABA_netcon = [-8.506218292592371e-02   -1.129447038877117e-01   +3.829064176977112e-01   -6.032062006555884e-01   -2.996246750097131e-01   -4.349219089655326e-01   +3.552887829345724e-01   -2.982151846497126e-01; +2.052523936647366e-01   +2.907926659968433e-01   +1.471954519057741e-02   +7.199758744463609e-01   +4.625200312487783e-01   -1.020229594727249e-01   +1.215090671797361e-01   +3.785124636098238e-01; -2.699394128137284e-01   +2.207326201552156e-01   +3.067229944713736e-01   -2.746192228802459e-01   +4.424279053513580e-01   -4.369886486019794e-01   -6.691332430381064e-02   +2.280181998366972e-01; +2.018513680788674e-01   +9.431356646616615e-02   -5.514323813347669e-01   +2.235275453048505e-01   +5.018258343986333e-01   -1.610317623972954e-01   +3.841376920586585e-01   +1.418685306786628e-01; -1.879955378135288e-01   +5.532574288897090e-01   +1.448326514265951e-01   -5.706430742032595e-01   -7.681333720944350e-02   +1.495268336146546e-01   -2.838058547781610e-01   +7.667642977082457e-01; -1.683236039290372e-01   +4.945566995888742e-01   +2.871050505995615e-01   -1.022096729418770e-01   -5.632523242260734e-01   +4.997137594055794e-01   +6.081686070618161e-01   +2.066752919768524e-01; -1.715893991445253e-01   +5.807124119111894e-01   +4.654080466337769e-01   +3.102880911549629e-01   +3.586737419733915e-01   +8.989944465990687e-02   -1.598763824746977e-01   -2.081586941072564e-01; +4.367790362387704e-02   +2.268680764283319e-01   +3.836791135287738e-01   +3.100541343870893e-01   +1.264362494150412e-01   +5.062727493714196e-01   -9.845535356714941e-02   +1.791123062175168e-01; +1.864256869312126e-01   -3.903521899364968e-01   -1.740967421080379e-01   +5.720348176130867e-01   +6.140680136128850e-01   +3.626751641399020e-01   +2.853310196040028e-01   -1.651664305456950e-01; -3.227858698923499e-01   -1.917534246048861e-01   -6.670493637342262e-03   -4.308959236919555e-01   +8.605085416216526e-02   +3.898691772123599e-01   -7.173171348917728e-01   +3.278871025458050e-01; -6.840561665070544e-02   +4.375033601515324e-01   +9.280097633798393e-02   -7.317919130171274e-02   -5.631659451751888e-01   -5.945049373342515e-01   -2.295646852369143e-01   +3.503697006380804e-02; +1.487030300234739e-01   -3.574787804535248e-01   +8.762182494460753e-02   +3.149894606048286e-01   -4.775400904889091e-02   -4.209458720198508e-01   -4.368011071019859e-01   -2.860692783186441e-01; -1.624300988450350e-01   +4.652639588522213e-01   +2.517829370818103e-01   +2.080043918807188e-01   +5.385607243873616e-01   -5.670626044544454e-02   -1.245283757371640e-01   +1.161339664897187e-01; +3.314254709044792e-01   +2.485174363315670e-01   -1.677367097122453e-01   -2.939453835769221e-01   +5.022870016166670e-01   +6.049143556903623e-01   -4.681177701268629e-01   -9.978723443161949e-02; +1.310333344740407e-01   +9.524349364706471e-01   +3.241338127128459e-01   +1.624447235084825e-01   -2.613918833353060e-01   -7.317689066415958e-01   +4.015695549320098e-01   +4.477733743456341e-01; +2.288906826325986e-02   +5.048820192106180e-01   +4.679489452491699e-01   -2.491648876877063e-01   -3.404608495409309e-01   -5.537018260115812e-01   -2.947090142496656e-01   +7.395038766852283e-01];
L1I_L2I_iGABA_netcon = [+1.998581185508111e-02   -6.650107550875084e-02   -3.408023968761996e-01   +3.897074520672413e-01   -3.698372440612834e-01   +4.184458295130301e-01   -1.811233867822238e-01   +3.787667277266548e-01   +2.414264147875604e-01   -2.008205719212393e-01   +4.453838699396134e-01   -3.254555573903408e-01   -4.601910407009513e-01   -4.115380099312450e-02   +1.591618312008039e-01   +7.596558766743416e-02; -4.344249917582363e-01   +4.471507308394321e-02   +3.713531685315627e-01   -5.892959534928940e-02   +1.023403117798795e-01   +2.192988135900435e-01   -2.932085660402630e-01   +4.124565752623959e-02   -3.487417737560710e-01   +4.095586870748050e-01   -7.262760370785274e-01   -8.403528017979026e-02   -1.241350862480601e-01   -1.334951207640741e-01   +3.155251011053073e-01   -4.308748732745407e-01; +3.114548328707019e-01   +3.535146763240542e-01   -4.030170394255035e-01   +1.339217542393620e-01   -1.235420481695459e-01   +1.499572864852224e-01   -3.238423540350461e-02   +1.719003167300800e-01   -2.860529376957521e-01   +2.594678575899492e-01   +2.357798251417220e-01   -5.940969481729068e-01   +1.300371680751172e-01   -2.027393931927195e-01   -9.031129102456655e-02   -6.946770139539635e-02; +4.195361098772629e-01   -3.599853711606340e-01   -3.447496800061076e-01   +2.670108089473864e-01   +4.366070870762998e-01   +2.089304524398705e-01   +9.336419754676710e-02   +4.104153450731225e-02   +6.875322107462167e-03   -8.645538143872974e-02   -4.119442177946293e-01   -1.446531437618278e-01   +3.633417428858451e-02   -3.907739008986139e-01   +4.421331346797981e-01   -1.183116528327619e-01; -2.366929723281204e-01   +1.277235754973516e-01   +7.270412276004365e-02   -4.599881663996849e-01   +2.995413279687651e-01   -3.404352282747617e-01   +1.919486297971836e-02   -9.987938818141986e-03   -3.770485980024090e-01   -2.757172990274662e-01   +9.716089287841405e-01   +2.007977351943023e-01   +1.999108514180084e-02   +1.599015143793758e-01   +4.017780228568131e-01   -5.129216415873963e-01; +3.024181931280934e-01   -5.288298951860027e-01   -1.395840831484688e-02   -2.146723377386033e-01   +2.766240451812216e-01   -8.545907509649471e-02   -3.800535963013135e-01   +2.279060435410502e-01   -1.638806025378837e-01   -1.660936722748052e-01   -1.175960507221449e-01   +3.737032492714571e-01   +1.962512332061748e-01   -3.324594914264747e-01   -1.858954207713058e-01   +1.661667489458288e-01; +3.789630618331472e-02   +9.387157125588888e-02   +1.487624974928522e-01   +3.931500174785445e-01   +2.261341640491696e-01   -7.523030746919818e-03   -4.608000071736010e-02   -1.025509197331995e-01   +2.999313621034017e-01   -6.858314453053721e-02   -4.534330948071828e-01   +2.556433866476487e-01   -8.368723205420749e-02   +4.797251287160560e-02   -8.628770706778797e-02   +3.129413456176400e-01; +5.144268397881963e-01   +2.021318075333866e-01   -1.304040944059447e-01   +1.995191563194614e-01   -2.736280091098052e-01   +2.883884838508812e-01   +1.530411569179294e-02   -1.506031380762787e-02   +4.017936250205960e-01   +3.407000147346382e-01   -1.037120027407255e-01   +8.768968457302709e-02   +1.196376394346146e-01   +3.732800503629488e-02   +2.243419931761682e-01   +6.456208410548414e-02];
L2E_L1E_iAMPA_netcon = [+1.027117924248346e-01   +8.449511968763298e-01   +1.663409972492193e-01   -9.176636968133791e-01   +4.530458963600486e-01   -1.961829024856043e-02   +4.703359372443817e-01   +2.599736512257660e-01; +3.412454159129120e-01   -2.468763206775594e-01   -2.464780955211499e-02   -7.681530396959266e-02   -1.141671243011537e-01   -9.646547281687845e-03   +3.453460235052371e-01   +4.876581661754722e-01; +3.402169819563375e-01   -2.021000107981715e-01   -5.563500653839484e-01   -2.011498652225671e-01   -1.706776045410430e-01   +8.533531230899985e-02   +1.880038308471291e-01   +3.611648910947647e-01; -4.129650750270262e-01   -4.324113248600101e-01   -1.464965873154477e-01   +1.293107380180954e-01   +5.027721376532959e-02   -2.362848470520141e-01   +1.486542378417312e-01   +6.626594437054209e-02; -3.522247124426902e-01   +6.846697034176273e-01   +2.024675528858897e-01   +5.311315733266968e-01   -1.103992655117992e-02   +5.740363893861644e-01   +6.748070155374361e-01   -6.824449916111970e-01; +4.923425522371100e-03   +6.631377207092288e-01   -2.879303283012761e-01   -4.098220302801756e-02   +8.800706201526072e-02   +6.224074270304660e-01   -2.151823231026806e-01   +3.667301595969378e-01; -5.307477692533535e-03   -8.820370272871730e-02   -3.337219053314665e-01   -4.457079865980266e-02   +7.443156054800165e-02   +1.101031332721990e-01   +1.825711405902871e-01   +6.520517065944644e-01; +6.130718327787579e-01   +2.384056543871497e-01   -7.912975836315362e-01   +7.528550896747479e-01   +6.226986664551829e-01   -1.038419844892242e-01   -1.964227448623196e-01   +4.446023792932029e-01; -1.548453964790543e-01   -3.363032871558329e-01   -3.221634254205489e-02   -7.873913813888972e-02   +9.385126672664634e-01   +7.721609047006223e-03   +3.206656503644587e-01   +3.717967438643850e-01; +1.847161296171237e-01   -1.035475376886076e-01   +1.064975323545531e-01   -1.890007867921048e-01   +2.803874497803199e-01   -3.223803386892898e-01   -1.413729609292277e-02   -4.545163353867402e-01; +2.012182081335882e-01   -5.519290708670144e-02   -5.312425150982437e-01   -3.051029697239488e-01   -3.373600973235484e-01   -5.700756000037636e-01   +2.479760984108691e-01   +1.566886797426053e-01; -6.550024955935205e-02   -3.402375407261403e-01   -4.316724906988770e-01   -5.314693270894373e-01   +3.899770674780924e-01   +4.665813187947560e-01   -1.468357288112240e-01   -2.885325026446319e-01; +2.375875682569521e-01   -6.361815421219087e-01   +5.097241882771846e-01   +9.944176921053507e-02   -1.683395622557170e-01   +4.969099044990904e-02   +5.384840963791899e-01   -3.233868914459101e-01; +5.021625658037074e-01   +2.032553051074457e-01   -1.480412510256896e-01   +3.391039060917303e-01   -4.921522159471926e-02   +1.527907968136206e-01   +3.588513087512993e-01   +4.983319075530680e-01; -1.368901748875942e-01   -2.429693397635023e-01   +3.944040526600440e-01   -3.102403679811509e-01   +7.471331711007041e-01   -8.399475019396767e-01   -2.105899494440586e-01   +6.256918311289982e-01; +1.189856956873306e-01   +3.244179603485017e-01   +2.465480834535802e-01   +7.838033783956140e-02   +9.602013998427063e-02   +5.865177011763181e-01   -4.133682419161419e-01   -3.745562323108190e-02];
L1E_L2E_iAMPA_netcon = [-9.548360616875304e-02   +6.125100559463516e-01   -4.388823784389824e-01   -2.372239547562266e-01   +4.450603883103759e-02   +6.859040733402985e-01   +7.098061977157584e-01   +1.965549494716378e-01   +2.503825185294216e-01   +2.841674117724494e-01   -8.821424500835201e-02   +3.427506384172390e-01   -4.313892507505381e-01   -1.546387110682923e-01   +1.251865683709411e-01   -5.866096416655728e-02; +5.262127668904256e-01   -1.889405195127545e-01   -2.616315704918348e-01   +3.923672692911375e-01   +1.943635213913587e-01   -1.610376584227090e-01   -9.702841100417414e-05   -1.796985135430672e-01   +3.387514130203373e-01   +4.546212886468870e-01   -1.517744339441524e-02   -3.834572585672879e-01   +1.253861655950109e-01   +4.107758082715215e-01   +3.400409978639377e-01   -5.221026778756341e-01; -4.326423214754208e-01   +4.862386077012534e-01   +2.521368247634001e-01   -2.855139820030580e-01   +5.797821669542437e-01   +5.508148135872507e-01   -2.098161241644123e-01   +5.480104535741233e-01   +2.496279350957276e-01   +1.937402493909940e-01   -3.060632771829753e-02   +2.029383251941411e-02   +3.244228272677572e-01   +2.724414047993883e-01   +6.761713854079203e-01   +5.056490247234510e-02; +3.507356342745099e-01   +1.568614167809381e-01   -2.170216294275880e-02   +7.320963196703695e-03   -3.898215501024988e-01   +4.747007165527132e-01   -6.312861672003123e-02   -6.514915471126097e-02   -4.520745888839531e-01   -3.345777117702895e-01   -1.662889085329781e-01   +7.507235354810640e-02   -9.656126777507101e-03   +5.140284922577061e-01   +4.410974765656439e-01   -9.339250439071431e-02; +3.545782408984584e-01   +4.753651794596817e-01   -4.064706162119055e-01   -5.931778991109371e-01   -4.288089351703169e-01   +2.431737961444949e-01   +7.203773952691886e-01   -5.699646327747053e-01   +3.128911191895971e-01   -3.160374655270367e-01   +8.390148540392579e-02   +4.137842082398394e-02   +4.546853944733002e-01   +5.095450659344510e-01   -3.929431158761648e-02   -5.338277139733977e-03; +3.806143459987026e-03   +2.341986041003474e-01   +2.625716706286612e-01   -8.163674184439934e-02   +3.012870729510708e-01   -3.989968900230745e-01   -1.234284966799987e-01   -4.889897312296033e-02   -1.468087836500003e-01   +4.425926237603481e-02   -1.410501899066965e-01   -1.860738802544966e-01   +2.391976349184738e-02   -1.230501594706900e-01   -5.422207862152304e-01   +3.072148075031058e-01; -3.847105347442940e-01   -1.731029988614713e-01   -6.827379308456849e-02   +5.891002621243431e-01   +2.745302290827177e-01   +5.072663922994736e-01   -2.744049807441128e-01   +5.255431994805089e-02   -1.650790379499238e-01   -5.134497291708793e-03   -5.313176900900106e-02   -5.394728408667906e-01   -1.900623007434954e-01   -1.419846495646919e-01   -4.623297113991673e-02   -1.461885102879125e-01; +3.601283741054450e-01   +3.291552092284884e-01   -4.576507824683038e-01   +2.971371127199161e-01   -1.370954416484654e-01   -1.995897493864640e-01   -2.937979323689868e-01   +1.873539253750795e-01   +5.152114196388823e-02   +5.685100682292302e-01   -4.206781647082108e-02   +2.040550881569966e-01   +5.284709192262691e-01   +1.141488069419695e-01   +1.271206164324645e-01   +1.497311344996258e-01];
L2I_L2E_iAMPA_netcon = [+8.037082184781311e-01   +7.437795870378475e-01   -4.499680910621598e-01   +1.452718050216666e-01   +5.816810450481293e-01   +6.190006107712761e-01   +2.119576635874354e-01   -3.441574878597225e-01; +4.670963421353230e-01   +4.920556782957489e-02   +1.818138300413263e-02   -2.907375632977408e-01   +6.607039212048295e-01   -6.373477058872801e-01   -7.472007820659551e-01   -1.632261202041567e-01; -3.261291362863736e-01   +1.231330729727469e-01   -2.806170926356072e-01   -4.058030821343409e-02   -1.879147964700416e-02   -1.909891486428327e-01   +4.762166517883069e-01   +5.553708302432426e-01; -1.371032627539549e-01   -2.847593617997458e-01   +7.144204648179595e-01   +4.469672333991559e-02   +3.337465256117423e-01   +2.559297553798669e-01   -9.986261269072313e-02   +4.394729004988872e-01; -1.316922375500371e-02   +1.599527824901538e-01   -4.907987966302244e-02   +1.342794579960910e-01   -1.654024079489294e-03   -5.714019729519881e-01   +6.187992500333768e-01   -8.416405406326728e-02; +3.515815946072514e-01   -1.758339057448705e-01   +2.950700414484161e-02   -4.770706651231930e-01   -6.964720722806253e-02   +3.090502535451354e-02   +1.916746513227142e-01   -3.955530281514800e-01; +3.292926335968491e-02   +4.680204110338207e-01   -2.347749364213900e-02   -1.377821676335506e-01   +3.773295203124875e-01   +3.950668002863445e-01   +1.624615461348932e-01   -3.163764962191757e-02; +4.514000978818015e-01   -5.273407823595466e-02   -1.309263895382386e-01   +7.664400673062140e-02   -6.736286779439991e-01   -6.589930268772266e-01   -5.380062346290587e-02   -2.397979435177910e-01];
L2E_L2I_iGABA_netcon = [-9.092165490117320e-02   -3.515757581349255e-01   +4.574966948736118e-01   -5.266806620737008e-02   -7.990569207176533e-02   +1.084801549268417e-01   +2.390873017936618e-01   -3.690524319927714e-01; -6.216924740576018e-01   +5.329405566099986e-01   +4.145931713553180e-01   -1.321924629794357e-01   +2.051229275163487e-01   +4.184425201647454e-01   -4.275463948706413e-01   -1.407264811968791e-02; -3.997408518954529e-02   -9.078044298280633e-02   -3.729871663490411e-01   +3.701014253142131e-01   +2.265477301832438e-01   -2.528196287438905e-01   -4.673633698541181e-01   +5.059643113908707e-01; +5.752785602485024e-01   -1.153753404974562e-01   +2.091179645461714e-01   +3.997198970915442e-01   +4.531835285635302e-01   +8.245803770965481e-02   +8.746068131395215e-02   -3.853435843380234e-01; -1.238990865322051e-01   -7.529978807070911e-01   +1.912629126477907e-01   +4.945062618293909e-01   -2.840721152959279e-01   -4.670995827155127e-01   +4.489262248535997e-01   +3.782008434236026e-01; +3.662927483979870e-01   +4.862329566867705e-01   -3.107425395360068e-01   +1.138399681748647e-01   -1.940644660632376e-01   +2.180056628646996e-01   +7.105790548069775e-02   +4.637119174477431e-01; +1.536934628106502e-01   -1.712313805577123e-02   -8.689446196029871e-01   -4.622268332481574e-01   +3.781695236974137e-02   +5.340945444681291e-01   -1.031533763966807e-01   +4.165776089387802e-01; -3.905155683535719e-01   +4.491722475151328e-01   -2.036470179379676e-01   -2.989939244541340e-01   +5.638569099843150e-01   -3.184283311745385e-02   +7.287808192257352e-01   -1.324427636178669e-01];
L3E_L2E_iAMPA_netcon = [+2.045195573850344e-01   +5.766066858167930e-01   +1.564084466945624e-02   +1.060802844027234e-02   -4.434061018911114e-01   -4.555998519571198e-02   -8.179286139044493e-01   +3.666979127275730e-01   +1.515892247137048e-01   -1.308446118040606e-01   -6.024831871798743e-01   -1.804123117126611e-01; +2.014786005120629e-01   +3.442497988749487e-01   +7.098320962948740e-03   +5.738156089288478e-01   -1.036734112380399e-01   +6.780073207428586e-01   -3.061439266004171e-01   +5.400815447575530e-01   -5.895704138240132e-01   -1.995463875265459e-01   +4.497949736036079e-01   -2.135005598966438e-01; -2.476446015851063e-01   -1.823582851714612e-02   -6.059187872948452e-02   +4.523681377485919e-01   +1.569339040919874e-01   +1.386214407349561e-01   +5.575097593689975e-01   +7.527771416273181e-01   +2.617284788733904e-01   +1.131931756557580e-01   -6.679667172669390e-02   -2.659699806716656e-01; +2.252167739303111e-01   +3.088061349679588e-02   +3.435463248139240e-01   +3.747630279623846e-01   -1.066290901421277e-01   -1.664025960155260e-01   -7.121927584537896e-02   -1.053553812416531e-01   +5.814923552342015e-01   +8.311990465602853e-02   +3.356998116828367e-01   -5.454079344312440e-01; +2.982561904938457e-01   +1.463639605162009e-01   -6.470630530897461e-01   -2.930434675520899e-02   -2.808880765396198e-01   -1.684745788633017e-01   +6.690506265592213e-01   -3.278185580212885e-01   -9.887369914049202e-02   -2.115875089534613e-01   +1.551965668568002e-01   +3.792979761693614e-01; +3.552664771809249e-01   -1.852280686879437e-01   +3.273856573215925e-01   +6.050249451542241e-01   +4.176081886372427e-01   +1.286021181394556e-01   +4.423905564666176e-01   +4.252977319666139e-01   -3.261875553189947e-02   +5.526053005248908e-01   -6.727661691852631e-02   +4.793360567482369e-01; +4.333532743583716e-01   +3.074909501182370e-01   -1.087042035911930e-01   -3.863762532203190e-01   +4.368005519151996e-01   -3.742808454674826e-02   +1.322149849878003e-01   +1.350988391907690e-02   -3.403695997802990e-01   +3.357696461144770e-01   +9.996401253540359e-02   +2.375677902847951e-01; +4.942720762737969e-01   -7.731348371213215e-01   +5.224071037805400e-01   +1.740471362150513e-01   -1.557429864318794e-01   +2.424424374228350e-01   -1.724248441742138e-01   -2.564297600971454e-01   +1.645838616267923e-01   -2.944528101759382e-02   -4.687240357236933e-02   -2.468899017141336e-01];
L3I_L2I_iGABA_netcon = [+2.248567318852709e-01   +5.324321016725453e-01   -4.410513394068843e-01   -3.369055842580142e-01   +1.577109010649365e-01   +5.912364756145578e-01   -4.795739355639834e-01   -2.799345334822808e-01   +7.591449293231011e-01   +2.097520259645291e-01   -7.726970668888850e-01   -1.915022270349964e-02; +2.306146559026499e-02   -2.366395787667856e-01   +6.102990414931455e-01   -2.939067579931107e-01   +1.503910183667560e-01   +3.310989860029680e-01   +6.975196431025821e-01   -7.063036851649596e-01   +3.982746364660734e-01   +3.239378149863534e-01   -1.519721750675776e-01   +6.438328116504074e-01; +2.497089432857039e-02   +4.009134683869905e-01   +8.222202779058459e-02   +4.248922639412947e-01   -2.976346063317752e-01   -3.704475082768971e-02   +3.636014369689131e-01   +3.990015142499251e-01   +1.075498790708214e-01   +9.926449431066448e-02   -2.771499609212547e-01   -1.836994840837661e-01; +3.417585885107648e-01   +1.000000000000000e+00   +7.867824257009421e-01   -1.848076773650402e-01   -3.474562768275113e-01   +6.005613279247877e-01   +2.585624980780444e-01   -1.991814783740280e-01   +5.959042528147163e-01   -2.326733508517391e-01   +7.813011214150518e-01   -2.333146031270994e-01; +9.048500888109598e-02   +9.847724784926928e-02   +5.611577882737693e-01   -1.750508468882836e-01   -2.661316883114199e-01   +4.679774084531643e-01   -4.137953124383668e-01   +1.479301872261846e-02   +7.968182711218390e-01   +4.372046371125624e-01   +5.235203132756110e-02   +1.743978216347679e-01; -1.617360166422028e-01   +3.039942734339943e-01   -4.070732864565952e-01   -5.265347615895188e-01   -8.022286152492356e-03   +4.794438420056772e-01   -2.573081592040810e-01   +5.446388087033965e-01   +2.144619653654248e-01   +4.644950647755593e-01   -1.895547574085120e-01   +6.409655059964550e-01; +5.183341129601050e-01   -8.138476063556992e-02   +2.873024824278802e-01   +3.235065029630298e-01   +1.888984627976045e-01   +1.054666168134231e-01   +7.025376135480311e-01   +9.501824358930079e-01   +1.498677065076076e-01   +3.909149153505377e-01   -7.075346346415505e-02   +1.016935813403848e-01; -3.955295244338383e-02   -1.553560861939005e-01   +2.560179641326623e-01   -9.428701412413915e-02   -3.305766838353646e-01   +6.237869667934328e-01   -7.463301822625600e-02   +1.655150348379763e-01   -1.186006908340926e-01   -2.349448680507920e-01   +4.094834069678809e-01   +1.747941921783607e-01];
L2E_L3E_iAMPA_netcon = [-1.794819523771487e-01   -5.971141877947610e-01   +2.213373795828573e-01   +9.546970100420779e-02   +3.372060792904671e-01   +5.781882819264152e-02   +4.248965491887534e-01   +3.949204666798868e-01; +2.341921838662716e-01   +4.207728747691145e-01   -1.963862941499586e-01   -2.332697397464789e-01   +3.876664035968760e-01   +1.211705884832744e-01   -4.252658293878808e-01   +3.711194438596809e-01; +5.317333635669598e-02   -4.729592438057286e-01   -2.572857083810280e-01   +7.040001789942396e-01   +5.745494176212068e-02   -6.369320986530269e-02   -1.365719267418136e-01   +6.184386552301224e-01; +3.320454062174179e-01   -3.090775475222298e-02   -4.068482670782471e-01   +9.842978296287441e-03   +3.246799546769007e-01   -3.067359138020593e-01   +1.414621716206333e-01   -4.733801878538523e-01; -2.050476696511430e-01   +3.608031519376033e-01   -4.379774978844226e-01   -4.130590427911779e-03   +5.042796375875043e-01   +1.980386533126069e-01   -1.029095985991249e-01   +3.862042218918658e-01; +4.789972357145428e-01   -9.135400005846665e-02   -3.678179749944460e-01   +1.365711991244997e-01   -1.215332123590960e-01   +3.135477670128475e-02   +7.512788142279586e-02   +2.386657163005549e-01; -4.546965152943531e-01   -3.907070190633447e-01   -5.978115603783933e-01   +2.601922726736006e-01   -3.342753060618946e-01   -7.429637364274301e-01   -3.760744978865384e-01   -1.747676245647644e-01; -1.340001401714602e-01   -1.140207741556870e-02   +4.053680945015181e-01   -3.500684397385385e-01   -1.221152503610237e-01   +1.060676116763981e-02   -1.178926366627969e-01   +8.428078583560383e-01; +3.510213892025150e-01   +2.652193639910329e-01   +3.979279156961775e-01   -2.647549297327184e-01   +1.876907791583229e-01   -3.567731752602571e-01   +3.547219322248967e-01   +3.675529604376134e-01; +3.155413036816485e-01   +1.275014685710935e-01   -2.567628835742801e-01   -5.374015350699497e-01   -7.214688065824844e-01   -4.953507413685254e-01   +5.562866649425231e-02   -4.369650025488759e-01; -1.585175180348628e-01   -4.981697204973395e-01   -2.544209644187398e-01   +1.274251704682941e-01   -1.413330527545791e-01   -1.311040563780315e-01   -2.359756235375730e-01   +1.917424741104442e-01; -6.945951713490328e-03   +5.719654536049017e-01   -6.684517860879535e-03   +6.015921150627176e-02   -3.991035822396871e-01   +1.156365691946153e-02   +8.215114880064320e-02   -4.243325850606477e-01];
L2I_L3I_iGABA_netcon = [-1.589074345205116e-01   +2.629907616494013e-01   -2.966769869232107e-01   +8.217944700517295e-01   +2.033555110601111e-01   +3.936405166268376e-01   -2.276607963547007e-01   +4.961767080806604e-01; -1.103393214571547e-01   -5.709506883210220e-01   +3.668426471936997e-01   -3.905291608636344e-01   +1.575311108261654e-01   -1.350435859885027e-01   +3.396037007968499e-01   -1.299080327917487e-01; -3.196736447239513e-01   -9.268819718505433e-03   +1.614515889417583e-01   +3.200599601253677e-01   +2.705576101097746e-01   -6.443867975248049e-01   -5.899115346930286e-01   -2.929952605551563e-01; -5.541889788261003e-01   -5.267651069550697e-01   -1.295602295909408e-01   +5.164245469782034e-01   +1.116679981837515e-01   +1.975480012616840e-01   +4.189512221096643e-01   +2.513570639209958e-02; +3.775531951239041e-01   +2.300576230483123e-01   -5.855834798585262e-01   +3.259153242607510e-01   -2.872193440740635e-01   +2.506368328785930e-01   -6.012542126405036e-01   -1.466835754824007e-02; -7.995356870268866e-03   +2.466036694003428e-01   -3.853671458876028e-01   +1.828983991407059e-01   +5.814447113141074e-01   +5.779229797076723e-01   +5.086909195353841e-01   +2.970461816822453e-01; +2.727084168900607e-01   +1.354718998086628e-01   -2.829516760132623e-02   -3.780590180258354e-01   +8.527460365848363e-01   -3.237816326151466e-01   +2.178381500409496e-01   +4.021629662571298e-01; +1.675443941835450e-01   -1.067336134510001e-01   -6.201371291663389e-01   +6.646115380341796e-01   +6.693792208606286e-02   +7.375699050942188e-01   -2.891929548422655e-01   +2.356173226836057e-01; +1.552932443598684e-01   +6.185164753681921e-01   +5.365700735780218e-01   +4.459458276633325e-01   -5.672503867164416e-01   +5.000546180991018e-01   +9.335729966765209e-01   +1.144386763412814e-01; +4.384315615900740e-01   -6.490190131834724e-01   -7.077217433321466e-02   -4.115488767681164e-01   +1.758395958515651e-01   +4.773473354136814e-01   +4.069393094310876e-01   -1.287634203064685e-01; -6.710347494307792e-02   +1.985121275545226e-01   -2.161723353178581e-02   +5.661583194326227e-01   -3.245097431598437e-01   -3.652813267405712e-01   -9.673431866444929e-02   -2.332352100081232e-01; -2.180869038666901e-01   +5.304496382450734e-01   +1.193194163733245e-01   -1.200453978940074e-01   -1.966056005650211e-01   -2.381475539618597e-01   -1.804094156592746e-01   -5.201456819980701e-01];
L3I_L3E_iAMPA_netcon = [-3.496098074780076e-01   +1.948226931421598e-01   -5.401412202215684e-02   -3.332358370606874e-02   -1.135871923762900e-01   -4.566726415138938e-01   +1.285676171084639e-01   -1.107817276230997e-01   +3.582502506637778e-01   -4.402544531692479e-01   +2.818271904493108e-01   +6.174068582660247e-01; +4.234581981169344e-01   +6.364490985032737e-01   +3.776596268465744e-01   -4.084428289744442e-01   +2.475560090516671e-01   +3.836434693362062e-01   +3.909216776651291e-01   -4.843306936860413e-02   +4.236366532713368e-01   -1.504779186891105e-01   -3.083865004477809e-01   +6.708776569889561e-01; -5.071251212541936e-02   -4.353429698602690e-02   +1.994190183439601e-02   -4.147937665880445e-01   +6.221758404384400e-01   +4.201951170340941e-01   +9.628140018122594e-03   -5.260504604371898e-02   -1.600081288684307e-01   +1.069748857836349e-01   +1.909211485565304e-01   +1.994317937276079e-01; -3.283121927823786e-01   +5.262837437215498e-01   -4.779445589569081e-03   -5.985133664457459e-02   +1.788646037933601e-01   +1.062594333602745e-01   +3.623467294469168e-01   +4.117738232404284e-01   +4.324273925554175e-01   -1.055541507268449e-01   -1.633872843946246e-01   +1.170822098340296e-03; +4.836084219889553e-01   -5.057905880525955e-01   +3.408037704819217e-02   +6.219279733782721e-01   +6.335568940648165e-01   -2.122657985888319e-01   -1.690291657858546e-01   -3.265107452286035e-01   +1.870041676860232e-01   -2.324249802758489e-01   -2.692721225148099e-01   -4.419035761303286e-03; +4.748073041144339e-01   +2.824112102206121e-01   +5.405841297779820e-01   +5.605372361815861e-01   -3.072040533157562e-01   +8.707643412873927e-01   +1.697937458033877e-01   -2.580097104882300e-01   +2.402970372110911e-01   -1.328259648693110e-01   +3.168844079605190e-01   -3.176944905626754e-01; +4.413376017826265e-01   +1.044628812531364e-01   +2.934774076047512e-01   +6.867570387786499e-02   -6.818174220733457e-01   +4.264579769353474e-02   +7.203412271754920e-01   +7.729235733360453e-01   -4.351907951017397e-01   -5.682279371514963e-01   +4.852481961451733e-01   +3.358495125467562e-01; +5.088523823968569e-01   -6.914125980464491e-01   +4.831926430440271e-01   +3.137749262479744e-01   +8.165826126181940e-01   +1.537135829757332e-01   +1.259980254768975e-01   +8.814401711754044e-03   +4.045443910987750e-01   -2.587480250057229e-01   +8.755965345379554e-01   -5.873456528058925e-01; -2.888752095027777e-01   +1.713924239737539e-01   +1.427417991934442e-01   +5.265862105908429e-01   -5.231306006387730e-01   +3.708655762318090e-01   +5.237748593972587e-01   -8.028175523366063e-02   -4.081469890897834e-01   +3.997251185616649e-01   +5.470993740653018e-01   -2.815326065703492e-01; -1.431645489984670e-01   +6.328050276496436e-01   -1.938698960877635e-01   +7.902950580502198e-02   -6.902120095866646e-02   +4.361936436082207e-01   -4.193447888006386e-01   -1.225141516584568e-01   -3.909163681520718e-02   +7.243206681887592e-01   +4.440453407596323e-02   +3.103576491684550e-01; -1.264813248111291e-02   +3.411154528249692e-01   +2.573123281597587e-01   -2.477063035979724e-01   -9.543766084293709e-02   +3.316945281511940e-01   +1.107531052723572e-01   +3.182020394192924e-01   +2.350191373303240e-01   -2.103858132353964e-02   -5.732871071235839e-01   +8.008673117970886e-01; +5.118995159479510e-01   +1.795808694658845e-01   +5.579649631525720e-01   -5.277750694536799e-01   +7.383796967156205e-01   +7.556527185820519e-01   -5.288609238345481e-01   -3.064417146440314e-01   +2.717442851457847e-01   +4.078021063122990e-01   +1.760642175061365e-01   +1.005522855656688e-01];
L3E_L3I_iGABA_netcon = [+1.677524176592911e-01   -5.451644258281847e-01   +1.126932743658045e-01   +1.029689801365533e-01   -1.046046334730980e-01   -2.917540315804357e-01   +4.249024562521007e-01   +3.566602891889623e-01   +5.014828726480559e-02   +2.430009261604027e-01   +4.623684693545512e-01   -4.466158351609331e-01; -3.214444400103321e-02   -2.171845831065539e-01   -5.107682411538115e-01   +4.563288563777512e-01   +1.231395184495242e-01   +5.477907090509871e-01   +5.941014514872768e-01   -5.615198911154629e-03   +5.734045968984663e-02   +1.684110402387857e-01   -1.445036504458478e-02   -3.623189618116514e-02; -2.243568491871231e-01   +3.201312393963836e-02   +8.228030636160624e-02   +2.614167629523080e-01   -1.852649704483880e-02   +4.418790458307612e-02   -1.088165439772520e-01   +2.021125206897760e-01   -2.741792737011662e-02   +4.501843107252510e-02   -4.127126928355498e-01   -4.134132285019684e-01; +4.741281511228154e-01   +2.747980899822574e-01   -5.467732544751834e-01   -3.796550703595224e-02   -2.069976677677407e-01   +4.498811760899692e-01   -2.474719729075961e-01   -5.987540981186034e-01   +2.743216211943612e-01   -3.119451823112968e-01   +3.006691089277517e-01   -5.261309716678682e-02; -1.938864090178860e-01   -2.256403812993542e-01   -5.097005893788642e-01   +6.782841915383028e-01   -5.698170905149456e-02   -1.003946830765249e-01   -2.308771403791415e-01   -1.945760171217401e-01   -3.503587651077117e-01   -4.792112491196093e-01   -2.846651591977415e-01   -1.772119067996643e-01; -1.759472217489324e-01   -4.772930516815388e-01   +1.409868229650151e-01   -1.999285265999018e-01   +3.772474516815945e-01   +4.667990086869909e-01   +3.567132935712351e-01   -2.761127699709738e-01   -3.535011292164259e-01   +2.470200642730932e-03   -6.033573957819774e-02   +1.885900115641466e-01; -4.015510455854926e-01   +1.546441417782911e-01   +3.959661208132529e-01   +8.263988087401473e-02   +2.957434423261004e-01   +1.514713118639571e-01   +9.927158011862999e-02   +2.143411736828932e-01   -5.934130752981862e-01   +2.234202838899120e-01   +4.048763843449495e-02   -2.095828544545473e-01; +1.015095179261312e-01   +7.632761011559103e-03   +2.246192439832456e-01   -1.945532118508224e-01   +6.686631725845074e-01   +2.883642997176179e-01   -4.477793255076291e-01   +1.822289452588167e-01   +1.189956937780879e-01   -2.800991096241569e-04   -1.000000000000000e+00   -3.338830236839933e-01; +1.965961793509033e-01   -2.247797279535861e-02   -1.578662776309593e-01   +1.878548984261151e-01   +4.132058890900546e-01   -4.408921008553816e-01   +4.366992928229900e-01   +1.880690485310504e-01   -3.377430071031254e-01   +3.039810164005274e-02   +1.074712345295223e-01   -2.461860322929663e-01; +1.446522076449495e-01   -1.055634658938833e-01   -3.260202977405896e-01   -3.679333325947056e-01   -1.734845247211507e-02   +8.286320460960526e-02   -1.250260398110801e-01   +4.114267102146066e-01   +9.585287146864835e-02   +3.000482129965249e-01   +4.432366279490210e-02   +1.656150757168303e-01; +5.216123191042128e-02   -2.003597061436860e-01   -2.292036772227862e-02   +3.201969595490513e-01   -1.427946136743426e-02   -1.912452337289965e-01   -1.261263152607758e-01   -2.666809359484414e-01   +2.993766820837029e-01   -1.740466079984709e-01   -5.200977775321361e-03   +6.970326075068778e-02; -6.157416206985242e-02   +2.931591804914416e-01   +2.873774764175951e-01   -7.718142060903353e-02   -1.918913947433564e-01   -3.840203320355574e-01   +1.454624841714734e-01   -1.733415414380695e-01   -2.724678375830779e-01   +3.884000208646544e-01   +2.866853069946646e-01   +3.402217957604752e-01];
L2E_Input1_iAMPA_netcon = [-4.623741525499186e-01   +4.976806209969437e-01   +6.332348722718258e-02   +1.893229660570120e-01   +5.792194758975208e-01   -7.394115633702422e-01   -1.490531701849031e-02   -6.451265402674587e-01];
L2I_Input2_iAMPA_netcon = [+7.795381929520927e-02   -9.453101094065638e-02   -1.539185965582660e-01   -4.307371276120611e-01   +4.012049778100946e-01   -3.009004753888077e-01   -2.055123461065956e-01   -2.614213791042984e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
