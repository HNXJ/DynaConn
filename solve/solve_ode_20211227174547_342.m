function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.897069321243916e-02   -2.400278389458915e-03   +3.059380408219289e-02   +1.512227253979169e-01   +3.655064277123302e-01   -6.273359033983150e-02   +3.383151207105990e-01   +1.764459575827507e-01   +4.815821679848776e-01   +1.886717598941428e-01   +3.389291334545437e-01   +1.952578217120272e-01   +3.584281094779469e-02   +1.544758532694274e-01   +1.001007676383354e-02   +1.513584280696748e-01; +2.334559398989327e-02   +1.538083583816433e-01   +2.816018274463020e-01   +1.076231362581229e-01   +2.120701668979130e-02   +2.485859938327820e-01   +6.079570095984574e-02   +1.693148311593244e-01   +3.990171279784850e-01   -5.774539802630620e-02   +2.076544491306498e-01   +1.765368207168699e-01   +2.548351074964689e-01   +1.517002804468943e-01   +1.045762247307236e-01   +1.952520937989850e-01; -4.136080077971363e-02   +2.302794040064258e-01   +3.158318963703373e-01   +1.854081492334174e-01   -8.178669836308095e-02   +2.006389845348272e-01   +4.404285074485521e-02   +7.662858110152215e-03   +3.494987341995736e-01   +1.819701282350679e-01   -1.835288065806960e-01   +1.606922625787187e-01   -1.145871433036728e-02   +2.171477665992841e-02   +1.545332068829179e-02   +2.345367680955071e-02; +1.472351216786537e-01   +1.216770362891527e-01   +1.023887614483799e-01   +2.286069632443788e-01   +9.390992806038108e-02   +1.565764826021111e-01   +1.461885412682537e-02   +2.738715704317817e-01   +2.983348029279921e-01   +1.260657175719828e-01   +2.355125828014264e-01   +1.035490696543236e-01   +1.589517348859449e-01   +2.385144764900481e-01   +1.954425283502861e-01   +2.722467326087800e-01; -9.635076065665896e-02   +1.784130945788720e-01   +7.907399648435184e-02   +1.162679129088494e-01   +1.698676469794987e-02   +2.532320543635832e-01   +1.775125203990666e-01   +3.035040960547937e-02   +3.189229891539791e-01   +8.425629647469313e-02   +2.507061971169436e-02   +4.460830923454413e-02   +1.324208041832460e-01   +1.280591957959316e-01   +6.947405074497776e-02   +8.999987961189149e-02; +4.738245217693766e-01   +1.889540717434017e-01   +1.669004159046759e-01   +3.296041867596645e-01   +3.032608578601049e-01   +2.402618946327763e-01   -5.090273189464284e-02   +1.297604118278762e-01   +3.444556155460077e-01   +1.697205932930281e-01   +3.072287024993983e-01   +1.297199044085781e-01   +2.035900286816093e-01   +3.216093591025844e-01   +2.047381742041360e-01   +1.569688394495907e-01; +1.005322314865267e-01   -8.605950545689633e-03   +7.437320081119536e-02   +1.966949747743621e-01   +3.450607266641685e-01   +4.494820300380989e-01   +1.817506669975840e-01   +4.990704975167626e-02   +1.410961168692959e-01   +5.562588236782628e-02   +3.636479995220900e-02   +2.497479974568997e-01   +4.083745702811750e-01   +4.012239448149190e-01   +1.371069965773483e-01   +2.187901066541513e-01; +7.586997419309238e-02   +2.295388139897535e-01   -6.866504486172739e-02   +2.968100578509154e-01   -1.771461664816229e-02   +2.117165998300513e-01   +1.088360641972144e-01   -2.084956636196134e-01   +3.445671377102859e-01   +2.710927527992213e-01   +3.017668223607379e-01   +1.645759476542950e-02   +1.214607463632578e-01   -9.604970309095107e-02   +3.539978141869603e-02   +2.657974671798969e-01; -3.848830498294620e-02   -5.312341870228848e-02   +3.549707495682163e-01   -8.129862836118808e-03   +1.700947076135790e-01   +3.641402444879067e-02   +3.620170594615957e-01   +7.840889159796333e-02   -1.495386794715647e-02   +3.712749809678743e-01   +2.413148609829771e-01   +2.175698415203241e-01   +1.222910139926052e-01   +2.790490701425382e-01   -1.281554995723440e-01   +2.394475289717803e-01; +1.317829060658515e-01   -6.687976417849659e-02   +1.583518496697271e-01   -7.299926385539254e-02   +1.796804942845867e-01   +1.854686719048708e-01   +1.572358918003437e-01   +1.462535553676484e-01   +1.453352989815356e-01   +2.528390087654536e-01   +8.468376816927387e-02   +3.584782671511244e-01   +3.797633457725234e-01   +6.095291138651460e-02   +1.406319301631815e-01   +9.040384176769672e-02; +1.268459367140393e-01   +8.793979052907197e-02   +1.809341641178795e-01   +9.730890249179419e-02   -1.391357042243899e-03   +1.910808326888567e-01   -2.391103199620562e-02   +3.443491460919432e-01   +1.542426911379877e-01   +9.856788218979527e-02   +1.824021750536364e-01   +2.851691397069026e-01   -1.307069311207329e-02   -1.991021127748717e-01   +1.683819852810440e-01   +1.301745706879368e-01; +2.621970600135045e-01   +1.454502580108280e-01   -2.766273548855260e-02   +1.668957549815296e-01   +4.305613657177968e-01   +2.485085094353978e-01   +3.793664248851527e-01   +8.571476509436157e-02   +1.693742140857548e-01   +9.075959886523080e-02   +1.501374690875445e-01   -8.230421070375812e-02   +2.260097180386232e-01   +3.269638343224801e-01   +4.124426412242771e-01   +2.860256097739629e-01; +7.043691431048762e-02   +2.682156694661568e-01   +1.591070843607826e-01   +1.787108928970512e-01   +4.415314193417227e-01   +8.272946132960787e-02   +6.375361942034106e-03   +2.784315451974714e-01   +3.679469083645580e-01   +5.430155530015353e-01   +3.051720555260736e-01   +5.146146300722361e-02   +4.279790376454000e-01   +2.553208570466463e-01   +1.523414377369610e-01   +2.928156839852116e-01; +2.732707205859119e-01   +8.742519930864087e-02   +2.894843958319491e-01   +3.237189642001868e-01   +1.415900630247197e-02   -1.153990154491513e-01   -6.249810709059943e-02   +1.121186784029830e-01   +2.076929726947029e-01   +1.018009812892414e-01   -3.453508684149286e-02   +1.931776100921574e-01   +2.834913343718214e-01   +2.970365710454718e-01   +1.226753552316384e-01   +3.416015966889516e-01; +2.545129199215441e-01   +3.890501251015165e-01   +3.639422457099569e-01   +2.933056110839702e-01   +4.466006985209071e-01   +2.679893133127390e-01   +2.884018303386486e-01   +3.237686210001768e-01   +2.635205130046812e-01   +3.072652780172471e-01   -4.319766254724483e-02   +2.825216061268815e-01   +9.800803961751148e-02   +6.337259425078567e-03   +2.380641930811513e-01   +4.962488102819918e-01; +1.689962408088972e-02   +1.039827245895483e-01   +3.826467579499485e-01   +3.810032085439177e-02   +3.070207106333277e-02   +6.186052986611720e-02   +3.969129555782733e-01   +1.709058638877293e-01   +5.407256801012612e-01   -9.945336423807941e-02   +7.243935749010486e-03   +4.060644662119152e-02   -3.803684530490471e-02   +3.927605749857994e-02   +2.776043528750185e-01   +3.377054880139385e-01];
L1E_L1I_iGABA_netcon = [+2.736967315231009e-01   +1.577172361698239e-01   +1.877770558675060e-01   +1.515423183535084e-02   +2.637290393448847e-01   +1.039356882924438e-01   +2.119249288512483e-01   +2.601919572145268e-01   +2.220515039253905e-01   +2.344509006250250e-01   +1.751871275364976e-01   +3.030055402417597e-01   +4.758592493558877e-01   +2.038148679985213e-01   +1.438040476602936e-01   +3.321851197781911e-01; +2.355803787741583e-01   -7.132191631580413e-02   +6.461251046100361e-02   +3.054556195134334e-01   +1.771609126767022e-01   +1.958827830093467e-01   -1.832666294614294e-02   +2.710086973251359e-01   +2.050557307796286e-01   +2.932864145370938e-01   -4.355601233373405e-03   +2.808010244230118e-01   +6.642115828097907e-02   +1.461742409198890e-01   +2.157722178557160e-01   +3.073244673156089e-01; +1.982892465854350e-01   +1.717444171253274e-03   -3.521808037315927e-02   +3.672411902805811e-02   +1.151229455518807e-01   +4.452893782468137e-02   -3.990379819182351e-02   +2.628689186380440e-01   +3.796152023222631e-02   -9.775444933465188e-03   -1.042117031702199e-01   +1.787295267703105e-01   +5.821280101593349e-02   +2.291712473909816e-01   -5.413436871256722e-02   +9.644931163964453e-02; +9.218963407867936e-02   +1.438704099005363e-01   +3.024098477595579e-01   +1.277354867037555e-01   -7.182977839393509e-02   +1.179075367014149e-01   +1.992402118569041e-01   +2.164718814016118e-01   -1.316526591489243e-01   -4.083762155463738e-02   +4.077310951798358e-01   +1.807365744145465e-01   +2.685283462538023e-01   +1.036788837996016e-01   -1.256490640085914e-01   +3.853435727276779e-01; +4.648881493838195e-01   +2.300566797717155e-01   +3.087603107186562e-01   +4.269154294895845e-02   +1.994847986265826e-01   +3.006793250329609e-01   -1.862589314700042e-03   +2.092973424228835e-01   +6.619412930489488e-02   +2.952055991559778e-01   -1.052206927221903e-01   -1.170782772904870e-02   +1.501124784985124e-01   +5.788295613864444e-02   +1.247603219713801e-01   +1.092143120294618e-01; +3.260519021365945e-01   +3.760849493886411e-01   +1.098884776487340e-01   +3.741065723730829e-01   +1.884127360476927e-01   +4.195261805526243e-01   +1.867669621869776e-01   -5.487177946260939e-02   +3.909670277659991e-01   +3.532476219236688e-01   +2.701447726526915e-02   +3.027411561811439e-01   +2.077335413659107e-01   +1.917326971857509e-01   -2.389082221947363e-02   +1.841858143446246e-01; +4.158631612736647e-01   +3.204278091512144e-01   +3.634878249131841e-01   +1.745583625669740e-01   +2.812260474648652e-01   +1.944063465778657e-01   +2.386941356740703e-01   +1.170738393341256e-01   -3.840737256216085e-02   +9.838675018040235e-02   +1.614692008627446e-01   +1.480687102052634e-01   +5.602427626484950e-02   +2.804827099732904e-01   +1.795238557158019e-01   +3.063450869614537e-01; +3.581195508316292e-01   +8.108552940582406e-02   +4.410132661917766e-01   +1.308749893594952e-01   +9.158882428873327e-02   +4.729056331943100e-02   +2.619344316937414e-01   +8.840962083679868e-02   +2.113063448270675e-01   +1.473661994860451e-01   +1.211165193044871e-01   +1.197603641106830e-01   +2.979431070428329e-01   -3.338805995016967e-03   +3.423236398967329e-01   +1.789334521579754e-01; +1.207646788635829e-01   +5.483697238148432e-01   +3.351534911204455e-01   +1.437648650694066e-01   +1.360620607164101e-01   +1.858522940902701e-01   +1.584629443599091e-01   +7.684598367106422e-02   +1.625678668643035e-01   +6.138941630762378e-02   +1.267557662700334e-01   +1.826500415427361e-01   -5.913092236681410e-02   +2.496871085698250e-01   -4.102869283771939e-02   +1.350895473427554e-01; -9.534471835393327e-04   +4.725426876300861e-01   +1.539261284418481e-01   +9.818656251064828e-02   +3.677543464037901e-01   +4.345690220687798e-01   -4.555645190515052e-04   -9.134494664932102e-03   +3.946026479051649e-02   -1.677109505319563e-01   +2.179451120461726e-01   +2.158286304449237e-01   +2.511420791004575e-02   -7.087276573088584e-02   -7.318337115193006e-02   +1.676602464375275e-01; +1.700853020053030e-01   +7.202242133639460e-02   -3.068336483357291e-02   +1.675739951027263e-01   +1.108965145274817e-01   -2.193016761664601e-01   +3.755035662777038e-01   +2.817063223238087e-01   +2.575884299644233e-01   +3.590343095951862e-02   +2.067697506838772e-01   +3.070194146596113e-02   +2.505632037609480e-01   +3.473214560152788e-02   +2.351608332523649e-01   +2.205176934488559e-01; +9.634530657122294e-02   +2.074973120046578e-01   +2.470040935531526e-01   +1.056534348015986e-01   +1.798042610345759e-01   +1.011536759192402e-01   +1.882066093133540e-01   +3.436211912842658e-01   +3.016094343753424e-01   +7.085429531065207e-02   +5.176231168121441e-01   -8.760191783664227e-02   +1.848798593001944e-01   -1.611924974981582e-03   +2.524944605552141e-01   +2.043937974966752e-01; -1.771780086954206e-01   +2.721610121955841e-01   +8.757286351405622e-02   -1.151758948064408e-01   +3.348596735751798e-01   -3.717352319463862e-02   +1.290830946817711e-01   +3.349104615446115e-01   -6.665159301432652e-02   +1.013264326867242e-01   +1.801398036986244e-01   -6.416849789605382e-02   +2.847549613544941e-01   +2.147400468822151e-01   +3.895314771171501e-01   -8.252744330564700e-03; +6.564033633184099e-03   +3.235167511838640e-01   +3.179253066679134e-01   +3.518417953078475e-01   -4.046578848121151e-02   +2.566785441893696e-01   -1.017895638636759e-01   +3.187065504041952e-01   +3.071053544926559e-01   +1.436367328952263e-01   +5.193380183723727e-02   +2.752419406667964e-02   -1.176874187252234e-01   +3.212045000743764e-01   +3.098984070099179e-01   -2.237887982888011e-02; +1.917973498911370e-01   +2.138134343945768e-01   +1.689591050628295e-01   -8.981641259399593e-02   +1.709501441219163e-01   +2.487547555799164e-01   +2.478189377799790e-01   +9.614782363440950e-02   +2.758304117266871e-01   -2.716807828473064e-01   +1.121313871112443e-01   -9.197622367176005e-02   +2.363729782101498e-01   -6.777590582660509e-02   +2.336581469032446e-01   +3.020696454813610e-01; +8.758436316742479e-02   +4.771954441130765e-01   +2.405904965314124e-01   +4.439711056583887e-02   +7.906183032930914e-02   +1.695258883675607e-01   +3.115789798832145e-01   +1.386113588972328e-01   -1.965152676672205e-02   -1.138503173569292e-01   +4.608346258579565e-02   +1.556574600070281e-01   +5.834026932075907e-02   +2.020580980124460e-01   +1.454947849179898e-01   +3.772866816441013e-01];
L2I_L1I_iGABA_netcon = [+2.321583884819798e-01   +1.602359478857427e-01   -5.870428927348563e-03   +4.913865840145605e-02   +2.590997969585988e-01   +7.906826425276550e-02   -2.414054060646787e-02   +1.149031469012949e-01; +3.598796517115486e-02   +1.671210977790135e-01   +1.620146756242656e-01   +1.968491331777671e-01   +1.482826976629707e-01   +6.154022692041725e-02   +3.900727791483861e-01   +3.301176931944267e-01; +1.012821572469381e-01   +3.969307422569525e-01   +3.772245705131609e-01   +6.569296339802978e-02   +1.910822603136176e-01   +2.736962827652596e-01   -1.837735921127920e-01   +4.775348241091360e-01; +5.462879097111777e-02   -1.512767279602317e-01   -3.495961956220400e-04   +3.483899697223825e-01   +6.391775807148171e-02   -4.761342003439861e-02   +3.896822017750541e-01   +1.342352441240444e-01; +2.494540589301920e-01   -7.254956463873048e-02   +2.649531312580410e-01   +3.123981424971575e-01   +2.826507487911893e-01   +3.130616857022087e-01   -8.868598443205769e-02   +1.066748548715350e-01; +8.070472006822593e-02   +9.388449087651536e-02   +4.185886797216739e-01   +5.014596593257840e-01   +3.078720260688740e-01   +3.980237552171321e-01   +1.973821779375157e-01   +1.636776100404888e-01; +9.444377743552824e-03   +1.276988018091984e-01   -2.019326833967913e-02   +3.348153140779347e-01   +2.680384062777651e-01   +3.503983214055137e-01   +3.016038262542957e-01   -2.748239864591881e-02; +2.052235053056736e-01   +1.646978668035240e-01   +3.845789498009633e-02   +3.799963838273584e-01   +2.156968698107038e-01   +2.743736193013087e-01   +2.198225149663116e-01   +1.133615963752545e-01; +2.145702079255234e-01   +2.188703059531552e-01   +2.741683981588052e-01   -9.405453123649626e-02   -7.215514251462954e-03   +1.472860126383558e-01   -1.398024016946603e-01   +2.153545731173964e-01; +2.078138709124400e-01   +3.857338829101370e-01   +2.291111361435740e-01   +2.774351336948846e-01   +1.594290242669274e-01   +3.701605468076029e-01   +1.937185523925741e-01   +7.856426683801282e-02; +1.227780155951146e-01   +4.036552133777526e-01   +9.609783271466046e-02   +2.847994344992949e-01   +7.858460208861544e-02   +6.135191176939225e-03   +1.864083645248357e-01   +2.237485217873887e-01; +3.758972104438367e-01   -2.386988866747192e-01   +3.226230135729592e-01   +6.745693836390515e-02   +1.895289622041497e-01   -5.946263453327473e-02   -1.363209429107981e-01   -1.815461639081907e-02; -1.333440962544413e-02   +6.205951636677853e-02   -6.795585965775575e-02   -7.132441001905857e-02   +2.665405892857963e-01   +2.220214261212740e-01   +5.933104843760108e-02   +3.403397669590211e-02; -5.471284748981881e-02   +2.230249238895388e-01   +2.262665135351599e-01   -6.595666391396032e-02   +1.052656009456063e-01   +7.594363830016694e-03   +1.366687426437396e-01   +1.814303044081702e-01; +9.201158727276598e-03   -7.993984838227103e-02   +2.485555951426648e-01   +2.529455375444432e-01   +2.202458475318316e-01   -6.850040871352184e-02   +1.167695622809845e-01   +5.594830433232946e-02; -4.966529895400539e-02   +2.507810171205054e-01   +1.964227093802500e-01   +4.118968150509893e-02   +2.816571202754369e-01   +3.476727961457819e-01   +3.276628952558800e-01   +1.610658698535309e-01];
L1I_L2I_iGABA_netcon = [+2.386289593489529e-01   +1.544801333551634e-01   +3.259355659845765e-01   +7.606668632707710e-02   +7.290975307598505e-02   +3.954938544712527e-01   +1.313503984535375e-01   +3.901293203760560e-02   +1.463691308826305e-01   +9.265446261089660e-02   +2.601672399455269e-01   +2.250965292690251e-01   +2.622065845989344e-01   +4.174672501549133e-01   +4.961667339006214e-01   +3.573516113891007e-01; +1.178165855992866e-01   +1.251910252861111e-01   +1.271579000338412e-02   +2.684009670871503e-01   +1.250120815193987e-01   -2.625539243996794e-02   +1.635706737925270e-01   +4.786911282465449e-01   +2.509694649399847e-01   +1.593372829871598e-01   +3.383635791572880e-01   +2.751476490718892e-01   +1.620736428319743e-01   +1.018921969759390e-01   +1.391167735539446e-01   +1.861886890613852e-01; +1.847783408735564e-01   +6.099418218197123e-02   -5.055839741462836e-02   +3.533002871602284e-02   -2.552045353858567e-03   +2.474444722377427e-01   -1.312129462051977e-01   +3.111343186982928e-01   +1.499790939305216e-01   +7.918900162082215e-03   +4.755761699333033e-01   -4.565221086631076e-02   +1.603426023920159e-01   +1.550398093266196e-01   +2.233219819097650e-01   +1.059999525250236e-01; +2.519380951072629e-01   +2.178975366786434e-01   -1.763761490662288e-02   -7.576228580882269e-02   +3.430300710439833e-01   +8.512047779771273e-02   +8.404238871445545e-02   +3.848421756412078e-01   +2.767328670367059e-01   -6.254684091425927e-02   +4.536096847183517e-02   -1.433824691214529e-01   +3.172077317656334e-01   +2.677174779783152e-01   +1.178168891782517e-01   +2.888801355205792e-02; +6.795483065705880e-03   +2.566781849076161e-01   +3.009751646083570e-01   +1.686029777311352e-01   +3.445644649907483e-01   +1.315726894134729e-01   +1.059477533107259e-01   +2.740875689891294e-01   +1.211776540591695e-01   +4.541753604803711e-01   +3.551127632243717e-01   +3.170658514965309e-01   +8.671550307732573e-02   +2.491112849829728e-02   +3.668707447246045e-01   +1.763263865068542e-01; +1.030299510263680e-01   +3.678402000251532e-01   +3.136819319591062e-01   +5.246376953270034e-01   +2.910211234142220e-01   +1.913723791143078e-01   +1.526265804351454e-01   +3.021334812506029e-01   +1.609041049451927e-01   +1.755275186348036e-01   +1.621809287186707e-01   -1.953136086247055e-02   +1.314691538318423e-01   +6.899238390141660e-02   +1.491144242784811e-01   -1.003886124643641e-01; +1.298050432217072e-02   +2.993844264481984e-01   +3.601900477295681e-01   +9.263917415767788e-02   +1.877943016412291e-01   +3.511363320397138e-01   +6.389418414662083e-02   -1.270877589450939e-02   +4.401577952244964e-02   +1.428082876065078e-01   +1.907037631930948e-01   +7.954636621381864e-03   +3.662720965616556e-01   -6.865434391183062e-03   -3.015132873316537e-02   +3.060107779079796e-01; +6.512593754869785e-03   +1.362426662707224e-01   +4.010301217922672e-01   +2.228896605646992e-01   +1.541474670140456e-01   +2.388375652122793e-01   +1.942274956523354e-01   +1.996252088940500e-01   +1.977595327035298e-01   +2.882781388033439e-01   +2.079496030480728e-01   +2.889472679522128e-01   +3.602534608853885e-01   +1.800101752419576e-01   +1.239492388350608e-01   +2.328491651662381e-01];
L2E_L1E_iAMPA_netcon = [+2.730059481724184e-01   +3.435919632647361e-02   +2.456160291161520e-02   +4.037648844358651e-01   +2.912855740352897e-01   +2.336550631325001e-01   +3.251548006056130e-01   +1.255048248514982e-01; +6.401469906764716e-02   +9.430581757934199e-02   -1.288348457043852e-01   -2.492435740419688e-02   -1.778781357365903e-02   -2.590723226664378e-02   +2.910496749375515e-01   +2.892521614967331e-02; +5.714578174275653e-01   +8.438583165929892e-02   +1.742285910305734e-01   +2.196555783253550e-01   +2.983081640991079e-01   +2.471149010975771e-01   +1.431188012205628e-01   +1.115485600491535e-01; +1.584449782897947e-01   +8.845472738162029e-02   +1.552985795060315e-01   +8.670395514652679e-02   +1.555081986044549e-01   +3.111795634557401e-01   -3.711580620758620e-02   +1.021905352439314e-01; +4.621510185767981e-01   -1.129176595695695e-01   +4.444070554328938e-02   +3.472996092569468e-01   +3.189366388295649e-01   -2.926907538644360e-02   -8.193094556819490e-02   +1.874088617634138e-01; -1.186663516393791e-01   +1.046608307756893e-01   +2.015677526500811e-01   +1.786645888131549e-01   +3.021192108893717e-01   +3.113132979572723e-01   +3.423349851415923e-01   +3.611691630571781e-01; +3.034833123581381e-02   +2.956419477045544e-01   +3.494212424738418e-01   +9.894087773874262e-02   +4.155294514823632e-02   +3.331941605990709e-02   -8.970095435044456e-03   +2.636460448220690e-01; +2.437196342324048e-01   +9.746822794251940e-02   +2.661372312101918e-01   +5.036622997066847e-01   +9.617516110074706e-02   +1.162758227975165e-01   +2.387053335361379e-01   +1.433365701463645e-01; +3.441803184474731e-01   +2.244091483455483e-01   +2.064826144433810e-01   +2.166790656603736e-01   +2.977293498081971e-01   +8.517621350217812e-02   +5.289812818771292e-02   +3.236706028312244e-01; +1.442793056665669e-01   +1.080201375328426e-01   +1.339354286593091e-01   +1.098009838157118e-01   +2.120959812755253e-01   -7.607156942177423e-02   -2.084474856805507e-02   -4.390456037979093e-03; +1.802389617783969e-01   +2.901135754552298e-01   +6.177531218650610e-02   +3.749408488718539e-01   +1.966783624494658e-01   +6.804531489439117e-02   +1.253640430390840e-01   +4.229792999581957e-01; +3.460485841541686e-02   +2.197060149395638e-01   +3.459026970777778e-01   -4.023578627086041e-03   +3.091988224646540e-01   +2.184803876072535e-01   +4.698779148635085e-02   -7.021972243951992e-03; +3.016941873255400e-01   +1.226059334144178e-01   +8.896211731725788e-02   -1.139840609661507e-02   +3.285879341400944e-02   +3.731371363514735e-01   +2.970741639359042e-01   +8.539477687057183e-02; +1.491022362672308e-01   -1.270031799656114e-01   +2.383959016311507e-01   +4.972839110430539e-03   +3.476857630115401e-01   +2.710031387788779e-01   +3.709801897905129e-01   +1.268550066134043e-01; +3.050416826353430e-01   +3.571040529637791e-01   +6.496766030988457e-02   +1.206475397845560e-01   +9.564963872106486e-02   +2.648638869251871e-01   +1.510605707231721e-01   -2.110565568553927e-02; +2.941763803838718e-01   +1.949182530395691e-01   +2.688732006986916e-01   +7.471921664909351e-02   +1.667043494108468e-01   +1.746343580049081e-01   +1.911469739649073e-01   +1.312805494783333e-01];
L1E_L2E_iAMPA_netcon = [+1.588692351761376e-01   +4.035956635511989e-01   +8.978562995074876e-02   +4.135164000214551e-01   +2.164120578072377e-01   +1.353553279054045e-01   +1.398334315563695e-01   +1.601252268944586e-01   +3.029059513309605e-01   -1.026549261082273e-02   +3.122444590944251e-01   +2.243564230567265e-01   +3.769310277208890e-01   +6.654943417895942e-02   +3.726928555953520e-01   +1.050781360830947e-01; +4.814074360438694e-02   +2.168349167792269e-01   +1.615324151266949e-01   -1.397143447252315e-01   +3.656008220933732e-01   +1.505929730127185e-01   -1.641318434757109e-01   +1.290269053613278e-01   -7.336577421717934e-02   -2.012126690450074e-02   +3.753275084818632e-01   +2.283990361982152e-02   +2.502265938996788e-01   +1.509355369171745e-01   +1.105736320297156e-02   +1.696889967694672e-01; +3.815646860774662e-01   -1.200290049653267e-01   +1.671311010286096e-01   -6.277381247221989e-02   +1.956716674385668e-01   +1.494859504766244e-01   +1.804233794446834e-01   -7.986453942634131e-02   +2.658385227555637e-01   +7.510795822930216e-02   +4.738134063881069e-01   +2.612713025856723e-01   +4.523181088307816e-01   +3.269367924867030e-01   +6.517631097478004e-02   +1.298921400724661e-01; -6.114187083686545e-02   +3.234818247491967e-01   +2.706070114554582e-01   +5.442396932031671e-02   +2.745636294261480e-01   +2.349932981386157e-01   -1.587921122814697e-01   +2.935050253222271e-01   +3.080616233138423e-01   +3.515529893663418e-01   +3.767436775728547e-02   +3.839142176469109e-01   +1.683445032085809e-01   +2.799891832316649e-01   +3.438856586793952e-01   +1.043771085630531e-01; +1.719173471597630e-01   -7.147119693123982e-02   +1.576541694405807e-01   -4.978844623036907e-02   -7.476508207163098e-02   -5.292521162601131e-02   +2.870595815615670e-01   +4.386026847601930e-02   -1.454456758602793e-02   +1.805874919312619e-01   +1.952885108437794e-01   +2.553923082899500e-01   +1.403732714158325e-01   +2.645833756624932e-01   +2.083962486859902e-01   -3.993646743098160e-02; +4.150520846328608e-01   -1.755614458993061e-02   +2.772777773773791e-01   +1.203708668760404e-01   +1.140609563435757e-01   -3.627865001724712e-03   +3.940020324365816e-01   +8.252096268332007e-02   +2.801063634788357e-01   +2.889520434854914e-01   +1.888314439485830e-01   +1.933296364887997e-01   +3.638486770057104e-01   +2.379537130893614e-01   +1.029814403014288e-01   +1.197364894850539e-01; -1.056717787788130e-01   +1.745125498338616e-01   +6.872396665322568e-02   +1.268553097228982e-01   +7.643329661738141e-02   +3.524754842376377e-01   +1.733132032584750e-01   +2.870739006993653e-01   +6.290968860013618e-02   +4.592960845440485e-01   -3.431566388711865e-02   +5.300297422978554e-02   +1.856498064227470e-01   +1.640441107594761e-01   +1.209069270911307e-01   +3.088056790756203e-01; -9.724091821374597e-03   +2.555551439318028e-01   +1.978562581229399e-01   +2.944096752795498e-01   +1.198761859367997e-01   +1.669365260743149e-01   +1.042692163033667e-01   +4.548207912880639e-01   +2.718487940203374e-01   +2.742568433918832e-02   +1.434422568012781e-01   +1.858544374954196e-01   -9.001127233285083e-02   +4.514174336699527e-01   +2.240895167716698e-01   +1.767685216562451e-01];
L2I_L2E_iAMPA_netcon = [+4.282611374917705e-01   +1.344400950589892e-01   +3.418829753172862e-01   -2.986259447092626e-02   +3.141937990984954e-01   -5.157967060016039e-02   +1.433181336242205e-01   +2.297946031346170e-01; +2.184166741644895e-02   -3.604708921408015e-02   +1.983546829048465e-01   +4.090065723753131e-01   +9.547556090545328e-02   +2.074398501674570e-01   +1.564833491737688e-02   +2.262178017928976e-01; +1.589622871730753e-01   -1.305663289755787e-01   +9.805562482816843e-02   -1.756214085667330e-01   +1.427142751661939e-01   +1.789667981576660e-01   -5.888779794767164e-02   +4.934896285244176e-01; +2.267518151199078e-01   +5.041093382094507e-02   +5.088914649620503e-02   +1.970251943489232e-01   +3.664745574003381e-02   +3.666153416279183e-01   +9.706136390518096e-02   +3.814815423438948e-01; -4.578254308427680e-02   +3.936272868754939e-01   +3.082427445921062e-01   +2.205263474283969e-01   +2.187643007617616e-01   +2.133722036113140e-01   +1.261523552522640e-01   +1.116358969049712e-02; +3.949507284647147e-01   +2.038592844416736e-01   -3.716272520283309e-02   +1.854497586162135e-01   +3.294448157083716e-01   +2.839101357389829e-01   +8.940069908601236e-02   +3.532712757885296e-01; +2.621907502152892e-01   -1.237836349874996e-01   +2.586439207759210e-01   +2.373113205090417e-01   +4.815563369880201e-01   +2.002770547697719e-01   +2.496009560028852e-01   +2.727048610832224e-02; +8.161577478898140e-02   +2.670780454394979e-01   +3.975287477654188e-01   +1.662832024886271e-01   +2.166757908718310e-01   +9.941617139915321e-02   +1.146210147474184e-01   +2.378488417349801e-01];
L2E_L2I_iGABA_netcon = [+2.127463018790829e-01   +2.305632897228628e-01   +3.871674441227354e-01   +6.331223589913396e-02   +1.421341636924124e-01   -6.709736468073049e-02   +9.836222313467188e-02   +2.476443428103831e-01; +1.412686183220440e-01   -6.338937086056715e-02   +7.713831018841130e-02   +2.032401603837099e-01   +3.212874122092658e-02   +2.102065317696666e-01   +1.454041751397558e-01   +2.427340583582161e-01; +2.188863551092913e-01   +7.673092337704397e-02   +2.875139012395855e-01   +2.788764385523470e-01   -5.462488426125170e-02   +3.639363394320431e-01   +1.030328513236570e-01   +3.638676133156176e-01; +2.162044295807555e-01   +4.833610983774721e-01   -2.129923480886857e-02   +1.459180642585864e-01   +1.408379723086728e-01   +3.535327297967955e-01   +2.607884399376929e-02   -2.617115345738267e-02; +1.222331382123283e-01   +3.100474211781964e-01   +3.059897493015247e-01   +6.111640176285894e-02   +1.986985235860225e-01   +2.405452463139509e-01   -1.859353508147522e-01   +3.761440400249910e-01; +1.018292983358023e-01   +2.413353572781523e-01   -1.430504081877243e-02   +1.846576220626838e-01   +2.882593195504203e-01   +2.104040218497182e-01   -1.303895166770999e-01   +1.962363010161532e-01; +2.533646223521376e-01   +2.164902107356278e-01   +2.440919448841818e-02   +3.472129783379362e-01   +2.446986465406837e-01   +1.192528844274647e-01   +1.203350743493104e-01   +1.797676508143600e-01; +3.565603505206932e-01   +2.615909202036616e-01   +1.225496682711548e-01   +2.318198388434865e-01   +1.612555551726271e-01   +3.010509847239964e-01   +2.936128917424080e-01   +2.676615391376224e-01];
L3E_L2E_iAMPA_netcon = [+3.406791035380818e-02   +2.251972967129522e-01   +1.959698875569411e-01   +7.592238022926309e-02   +4.770321600031205e-02   +3.267554867325959e-01   +9.642385530297988e-02   +3.439810070020545e-01   +2.498168439841313e-02   +6.144065897737322e-02   -1.405084436496682e-01   +2.720229714670969e-01; +2.071845065896542e-01   +3.714358358354842e-01   -2.218420332073348e-01   +1.266269955370137e-01   +2.121199088717515e-01   +1.216177916732580e-01   +2.261094478106153e-01   -1.252282117081324e-02   +2.026084551540975e-01   +3.001040299273233e-01   +1.593833517378993e-01   +2.081003627878906e-01; +7.864775015000436e-02   +2.526783352565171e-01   +4.831100851920338e-01   +3.022520999946092e-01   +3.336606740818138e-01   +5.051744951083575e-01   +2.478150561542828e-01   +2.767788584583581e-01   +1.980456321953704e-01   +1.398942595308058e-01   +1.338197949076836e-01   +1.257014606289058e-01; +1.461066991152782e-01   +3.047790126320341e-01   +3.562157675210879e-01   +3.153554106259723e-01   -3.776845013863443e-02   +2.361444353423316e-01   +1.721445224538830e-01   +5.040279482655537e-02   +9.212328157424435e-02   +2.524736262334377e-01   +3.514892807017194e-01   +2.717806390178290e-01; +1.273623595982684e-01   +3.854126353955795e-01   +2.739740087309905e-01   -1.399209113537993e-01   +1.942981024263697e-01   +3.246548808552118e-01   +1.495074621458527e-01   +2.790324282720234e-01   +2.173115308290521e-01   -8.767521829152346e-02   +3.203320935555977e-01   +6.179129474582809e-02; +8.028638683353354e-02   -2.431481774479824e-02   -1.036980448917984e-02   +1.445266062437351e-02   +1.913915342291246e-01   +2.792400037049105e-01   +7.800463161205565e-02   +1.599582142930084e-01   +4.446240075270064e-02   +2.135707698517766e-01   -3.041818306743939e-02   -4.806748758479260e-02; +5.669750408704191e-01   +9.411642356315211e-02   -6.923436576912748e-02   -7.032691495526622e-02   +2.582204787590313e-02   +4.295300488419578e-02   +1.237141373990963e-01   +3.013747853635913e-01   +3.403169496782282e-01   -8.127836443858857e-02   +1.337769420470695e-01   +2.146021743976930e-01; +1.855279517363491e-01   +2.016446048071113e-01   +1.170336846409649e-01   +1.699108971162873e-01   +1.608428330894232e-01   -1.094433194125989e-02   -1.845076557693301e-02   +2.078698052868763e-01   +4.244617140300360e-01   +1.540710281899295e-01   -8.625448763671092e-02   +2.668805405466479e-01];
L3I_L2I_iGABA_netcon = [+3.095492792014105e-01   +2.218934237563856e-02   +1.031557011221562e-01   +4.219637233365026e-01   +2.220325599084888e-01   -4.788851915404008e-02   +7.878656872983834e-02   -3.242802974798704e-02   +7.122959650597138e-02   +2.028396238056742e-01   -1.861923241995441e-01   +9.709806984729942e-02; +8.048811283971852e-02   +2.204825786080379e-01   +2.211255237047141e-01   +2.426731332319040e-01   +1.864203894028053e-01   +2.219937777950046e-02   +5.388709441914452e-02   -5.796518470776883e-02   +2.994933378952389e-01   +2.344642178940130e-01   +2.574975539209549e-01   +2.409285163259016e-01; +1.006613262601011e-01   +2.864364721708598e-01   +1.519367899121170e-01   +2.408293460967870e-01   +2.251043382838158e-01   +4.562258794237258e-02   +3.178174830816883e-01   +2.585473636861648e-01   +1.544934024200953e-01   +4.663729065328159e-01   +2.802765980992505e-01   +6.069158762354025e-02; +1.534997539098834e-01   +3.549746348835248e-01   +3.053252748120038e-01   +6.967769012921454e-03   +4.795534102730507e-01   +2.609771209809919e-02   +5.696465398106156e-02   +2.305052600105092e-01   +7.682392802865137e-02   -2.527568723807732e-02   +1.192324143811433e-01   +2.376852048455597e-01; +4.102219560696447e-01   -6.784619262157465e-02   +2.661710428303019e-01   +1.973295709496193e-01   +1.321169987748793e-01   +7.992986079528111e-02   +3.467979993219926e-01   +1.695024114350014e-01   +2.440029232411974e-01   +2.151104813640981e-01   -2.334320845709965e-02   +3.457669723342144e-02; +8.754572703890073e-02   +3.059031408409864e-01   +2.181811610139120e-01   +1.380659430872480e-01   +3.334753185041897e-01   +2.255247992728879e-01   +4.652640076245772e-02   +2.493189812321282e-01   +3.528555961691315e-01   +3.364235662423820e-01   +2.582508144285854e-01   +1.747868481644114e-01; -1.927539784134207e-02   +2.620402938459391e-01   +3.294413756365138e-01   -1.590273810911821e-01   +1.042736943595557e-01   +2.295867737284322e-01   +2.033417393656486e-01   +2.974279808644034e-01   +2.165485535898357e-01   -1.060087197656000e-02   +2.160365351318517e-01   +2.739212828726946e-01; +1.195975459581222e-01   +7.537112035326041e-02   -2.199983048543809e-02   +3.649644803709908e-01   +1.900310150793389e-01   +8.633829061683905e-02   +1.674005197233373e-01   +1.858468840000262e-01   +4.082369494294645e-02   +2.364943580617082e-01   +1.461341653023222e-01   +2.319030862796255e-01];
L2E_L3E_iAMPA_netcon = [-1.784673863028537e-02   +3.527925238771368e-01   +2.570020517758213e-01   +2.245229760175904e-02   +2.285517519445938e-01   +2.106225456973839e-01   +3.917908528159846e-01   +1.434594456046718e-01; +1.695663498319491e-01   +2.939999989469197e-01   +1.966206604763978e-01   -9.888197145749165e-02   +1.785554577921202e-01   +1.337036335718627e-01   +2.011003988020313e-01   +4.514404773261288e-02; +1.427720950467239e-01   +1.647348712941363e-01   +2.045740078226932e-01   +4.965928147646813e-01   +2.708032786322192e-01   +4.771078202271681e-01   -5.126049635479136e-02   +1.351175705335952e-03; -8.072238881047823e-02   +5.487910884188878e-02   +1.528168497386281e-01   +1.285659593817343e-01   +3.023313684423387e-01   +2.514654009833051e-01   +9.939608515902859e-02   +3.209720701194255e-02; -6.363080363378727e-02   +1.330250812180679e-02   +1.527236843938036e-01   -1.216565784668589e-01   +4.574241533890248e-02   +2.350595584349408e-01   +2.135894023696446e-01   +8.565490975314893e-02; +6.938869508687255e-02   +1.120767651293594e-01   +4.700090049890897e-02   +1.829486995233211e-01   +9.729354575545880e-02   +4.521072913012713e-02   +1.259332503568564e-01   -1.910814860933936e-01; +1.309105670865590e-01   +9.254294531299877e-02   +2.399664300874708e-01   +2.081932936961159e-01   +1.182627218187403e-01   +2.426755541009141e-01   -5.772917664506094e-02   +3.620480165156740e-01; +1.342246264387763e-01   +2.420863958776713e-01   +1.925722802188998e-01   +2.478235188996059e-01   +1.487430607995968e-01   +9.736750812048053e-02   +1.086615586632228e-01   +1.018796948047873e-01; +6.357739246931025e-02   +2.409366850642390e-01   +3.101361143687290e-02   +2.365978303018058e-01   +2.875842332743457e-01   +1.473608217491328e-01   +8.279342158834865e-02   +2.080747541938704e-01; +1.146948491992783e-01   -6.258569480859150e-03   +1.711645998239327e-01   +3.309273882012372e-01   +2.393787479026672e-01   +1.837141503483421e-01   +2.930450749077466e-01   -3.538138660812343e-02; +2.641701543584098e-01   +1.611226080233397e-01   +3.346211499637065e-01   +2.513515942018105e-01   +3.514255964221527e-02   +1.775972828419055e-01   +3.071652654563982e-01   +1.781188208145081e-01; +2.807638825253382e-01   +3.429622746752192e-01   +9.843598792573796e-02   +4.083988938741235e-01   +1.111983596267963e-01   +3.937918547211210e-01   +1.439581906720729e-01   +4.200950690948901e-02];
L2I_L3I_iGABA_netcon = [+4.500899679011238e-01   -7.769471643578228e-02   +2.042193628933630e-01   +9.338635535054471e-02   +1.538610416336240e-01   +2.569979736474605e-01   +2.565070674097426e-01   +4.399611350916580e-01; +2.913893897141998e-01   +1.125146585516407e-01   +2.243978491883371e-02   +1.578289646191707e-01   +7.508279961751868e-02   -5.172922486198320e-02   +1.016614346158192e-01   +1.771547277963402e-01; +2.058581466752225e-01   +1.348717410919905e-01   +3.626937186795392e-01   +3.153876981445239e-01   +2.143255902964897e-01   +1.140529594326525e-01   +1.158156759042281e-01   +2.469562033599458e-01; +1.626485486516451e-01   +3.641152317589125e-01   +2.574938101873718e-01   +3.200606380086068e-01   +1.433901861902335e-01   +3.660596674125374e-01   +1.855929102181963e-02   -8.383885223217746e-02; +4.843700513826145e-01   +3.765728302094830e-01   +8.636847865202053e-02   +3.842033185142377e-01   -4.779537062258866e-02   +1.359436463142580e-01   -3.517780230813831e-02   +1.669974513161451e-01; +5.042363191064918e-01   +2.516327606000011e-01   +2.199438583264901e-01   +8.465332059314488e-02   +4.517500226266227e-01   -8.528640720046704e-02   -6.329936355338525e-02   +2.747551874208589e-01; +1.196927853371785e-02   +1.114415356057480e-01   +3.150493442696946e-01   +5.176722247644221e-01   +2.410457288954779e-01   +2.090870270840159e-01   +1.434231320712245e-01   +1.513214193169700e-01; +1.708080392301486e-01   +2.120969368842756e-01   +8.818619276425915e-02   +4.325758599231522e-02   +2.405641011064210e-01   +7.036692518329479e-02   +1.520935060221793e-01   -8.488130670642970e-02; +2.077836692062378e-01   +1.432827569737950e-01   +3.200588044715227e-02   +1.333218272439412e-01   +2.356709756347893e-01   +8.822357443390610e-02   +1.742463791668238e-01   +9.684325993186625e-02; +2.313306959578052e-01   +1.094193119803707e-01   -1.178192907308648e-01   +3.172460173837480e-01   +1.501047366776130e-01   +2.288610069985596e-01   +3.465808606376890e-01   +2.253834082804667e-03; +6.926061125900249e-02   +2.110670184519733e-01   +1.050964363820572e-01   +2.770460982927550e-01   +1.564147116851121e-01   +1.077569222856336e-02   +1.178198381451313e-01   +9.224424629132660e-02; +2.327113717556728e-01   +2.887197726204339e-01   +1.187453859411728e-01   +2.197080569650663e-01   +2.700550882999896e-01   -9.951904269584412e-02   +1.187829843677839e-01   +6.516516785839895e-02];
L3I_L3E_iAMPA_netcon = [+6.565729118400972e-02   +4.632538248202488e-01   +1.922362617658177e-01   +3.257205398138364e-01   +4.864284751436448e-02   +1.397299385511603e-01   +6.876693328174865e-02   +6.020923976397778e-02   +3.764300869925785e-02   +1.643133938804197e-01   +3.550811224186363e-01   +2.532768240025695e-01; +2.814854984443333e-01   +1.287625825952343e-01   +2.133370922097386e-01   +1.657113958816932e-01   +3.376578352470049e-01   +1.109402895594378e-01   +5.768383750674743e-02   -7.603439848915261e-03   +4.393359592155561e-01   +1.625940518566769e-01   -1.055306795111466e-01   +2.234399244303116e-01; +1.366076293641442e-01   -5.342317449858941e-03   -2.521736642053313e-02   +6.001002288687637e-02   +9.446914567957373e-02   +4.920225445268144e-01   +8.346346602007465e-02   +2.701429836865671e-01   +3.728183019245218e-02   +6.335896352854753e-03   +1.911713076618638e-01   +3.260843089715847e-01; -4.299403233701515e-02   +1.639026321641296e-01   +2.729825598333843e-01   +3.058624577430147e-01   +2.819783378173355e-01   +1.293952190020940e-01   +8.403969396938640e-02   +1.443119254753107e-01   +2.750415220770414e-02   +6.549276609376921e-02   -6.421382555692620e-03   +1.721284682449242e-01; +1.655490182578173e-01   +2.188245241101566e-01   +6.618992226307703e-02   +1.531239787180241e-01   +2.786933439159183e-02   +2.715557104607768e-01   +1.938961355699463e-01   +3.541079190712779e-02   +9.113288328209344e-02   +9.503879102317481e-04   -1.093033491828769e-01   +3.530194358041384e-01; +3.233688763813053e-01   +2.646844885973060e-01   +2.220112417017220e-01   +2.381279084842204e-01   +1.215344008204511e-01   -3.275140875136015e-03   +2.274216393039482e-01   +2.919228199236003e-01   +2.908081592586955e-01   +5.137162588511163e-02   +4.569375758258769e-01   +3.850777727878588e-01; +2.603614930803083e-01   +4.091752836302431e-01   -1.363833377667671e-02   +1.120709028367308e-01   +2.297897146266127e-01   +1.461915172219542e-01   +2.811955171780097e-02   -1.456791566754331e-02   +4.754341501242564e-02   +2.564490381372198e-02   +7.577142273239651e-02   +5.223689797432212e-01; -9.013177045732387e-03   +5.333525141253613e-02   +1.447549656310673e-01   +9.362522358060837e-02   +2.759403859544252e-01   +9.001056576584204e-02   +1.134494759397341e-01   -6.592204849943772e-02   +2.789130348374010e-02   +2.550777109914222e-01   +3.218797892834500e-01   +1.063443715873358e-01; +1.192008302897295e-01   -1.959567074557946e-01   +1.569945337379729e-01   +3.695983936429746e-01   +1.361282471547114e-01   +1.567430386678313e-01   +2.387087844852290e-01   +2.996903605668185e-01   -1.494820624391386e-01   +1.316478547408909e-02   +1.101694889456866e-01   -7.827997154701893e-02; +2.272907435445520e-01   -2.001253301682746e-01   +4.953985808833297e-02   +3.891543567361821e-01   -1.151929156862504e-02   +2.477850890676002e-01   +1.781782788980972e-01   +3.228413620249084e-01   +2.705262845044619e-01   +1.303533665848782e-01   +3.322034621935172e-01   +4.921626072397414e-02; +9.921581795911143e-02   +2.766440591757622e-01   +3.592716702634463e-01   +5.485943677653166e-02   +1.158896129880382e-01   -6.008122642852942e-03   +3.078449109832846e-01   +1.289377889764106e-01   +1.802273592143448e-01   +8.801055426473595e-02   +5.686385029531638e-02   +1.621651392407698e-01; +1.799332240942152e-01   +2.118498410830274e-01   +3.971314219586065e-01   +2.537418979018777e-01   +2.875775291763558e-01   -5.471322844933664e-02   +1.439407113912167e-01   +3.056896637563921e-01   +2.933640180604146e-01   +9.021084901763755e-02   +1.260762092092304e-01   +1.445361589459707e-01];
L3E_L3I_iGABA_netcon = [+3.891378405394089e-01   +3.211996258761003e-01   +5.332470929243752e-02   +4.821300635099507e-01   +1.833470114150098e-01   +8.541204943184517e-02   +1.301526669830954e-01   +1.951892077049364e-03   -9.513100573397534e-02   +3.450203701875402e-01   +3.527711996492080e-01   +3.219662608462218e-01; -2.012602878511872e-01   +1.270865384684081e-01   +3.085248878632582e-01   +1.040292621433199e-01   +2.255835741965375e-01   +3.129254400748269e-01   +3.329893382664438e-01   +2.482018233784624e-01   +2.009249020771091e-01   +1.607537322811046e-01   +9.030409461745452e-02   +2.779923575055685e-01; +1.982112250327326e-01   +2.616981221131432e-01   +1.144009391925383e-01   +3.442433352729718e-02   +7.143428187035489e-03   +9.492497328845927e-02   +2.276847351339055e-01   +1.473382325659660e-01   +2.616417143248946e-01   +1.499929639258938e-01   +1.512458322096048e-01   +1.920840158448870e-01; +2.565276237701353e-02   -1.387922892454875e-01   +9.208501055544087e-02   +2.306059851087286e-01   +1.657003212604420e-02   +1.992864297936806e-01   +2.052832474940357e-01   +4.101844727112970e-01   +1.927625538740561e-03   +6.446592541289586e-02   +2.223323085549875e-01   +1.359882223209999e-01; +1.349670861476832e-01   -1.047775179878387e-01   +3.529520313219174e-01   -1.254788026823953e-01   +3.615945290095863e-01   -6.411639573734072e-02   +3.030016794022964e-01   +7.899612663561603e-02   -6.132873761562644e-02   +1.181835234613370e-01   +1.497397626109481e-01   +1.769371495753779e-01; +4.453482319203846e-02   +1.941026827265263e-01   -5.162829971066187e-02   +3.034403147217787e-01   +1.963697930178257e-01   -2.295792619579919e-02   +2.023327499576804e-01   +3.148624586049111e-01   +1.259764843967399e-02   +2.122590906446570e-01   +6.823625695066093e-02   +2.082960111384915e-01; +1.445741007483632e-01   +2.988558585818703e-01   +3.339823687995709e-01   -5.547790052465165e-03   -6.801254049303879e-02   +1.850082524298664e-01   +1.962281539160920e-01   -8.004560632140363e-02   -1.053777774601182e-02   +2.297145336212167e-01   +1.680001258819815e-01   +1.446740964131192e-01; +7.292322297652901e-02   +6.263871308861420e-02   +2.260515665603869e-01   +2.593837310619906e-03   -4.160614422687902e-02   +2.210056367966758e-01   +2.357678224755536e-01   -3.205238605560967e-02   +1.844701964697020e-01   +3.060706814630077e-01   +1.147234024377787e-01   +3.404016669226778e-02; +1.012227817399129e-01   +1.423677718288667e-01   +1.097681547111905e-01   +7.733550613756381e-02   +3.007338702001038e-01   +1.567169974264819e-01   +1.282923743647890e-01   +3.342941907355035e-01   +1.032715527604943e-01   +1.211217752845543e-01   +1.113830546382175e-02   -4.564797130742653e-03; +2.763771899604027e-01   +1.203186990839619e-01   -1.481092617241542e-01   +2.591650559288570e-01   +3.016294393395539e-01   +2.360121644275905e-01   -1.003570230419712e-01   +1.788921139714008e-01   +1.550049634804036e-01   +4.367644724829134e-01   +4.276784395345934e-02   +3.525895491892712e-02; +8.956837612045007e-02   +1.331389233762351e-01   +1.778683105045855e-01   -3.731342906308106e-02   +1.703528488161271e-01   +1.730929205569342e-01   +3.778276062422893e-01   +3.264589873805088e-01   +2.115966850595390e-01   +2.035741667660107e-01   +1.603824247189091e-01   +1.055709902678614e-01; +5.321844614101845e-03   +6.420892333548606e-02   +1.533643052752133e-01   +3.048894977777207e-01   +5.485934725569602e-02   +2.337825607142830e-01   -1.056457544468687e-01   +1.380931437196445e-01   -4.319204062005724e-02   +2.033952397199889e-01   +2.545169842833296e-01   +1.946899065992577e-01];
L2E_Input1_iAMPA_netcon = [+6.615013858768831e-02   +7.339546875379489e-02   +5.528938985625523e-02   +1.654940217313237e-01   +2.453371564660448e-01   +4.037922433663383e-01   +2.200432313767115e-01   +3.178385683995841e-01];
L2I_Input2_iAMPA_netcon = [+2.885267275562756e-01   +4.648976464164093e-02   +3.323312584356340e-01   +3.225554167755921e-01   -7.666634773905349e-02   +3.118150420856233e-02   +6.340832913505737e-02   -1.026115983049602e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.6*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.9 + 0.6*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.8*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.8*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*1.0 + 0.8*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.6*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.9 + 0.6*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.8*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.8*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*1.0 + 0.8*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
