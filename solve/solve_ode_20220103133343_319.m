function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.702868389316669e-01   +7.279075762519792e-01   +8.839175337604818e-01   +2.012937556540428e-01   +2.482107174681054e-01   +6.967590573856944e-01   -4.887616036338185e-02   +3.652965009485601e-01   +2.332079490634610e-01   +1.901374716082637e-01   +3.718005043337952e-01   +1.803380317217803e-01   +4.857390203689481e-01   +2.728129025193916e-01   +2.451209319716849e-01   +2.433549407415509e-02; +6.879904353424886e-02   +8.986718659405685e-01   +8.451779695375581e-01   +7.363620074832021e-01   +3.058969134235701e-01   +6.857235544822761e-01   +7.030556680960880e-01   +1.675225461292123e-01   +1.279671371417510e-01   +7.449220004441439e-01   +5.461905010127274e-01   +6.275074883466848e-01   +4.170153747564726e-01   +2.587436262182377e-01   +6.440514192700488e-01   +2.561455071618551e-01; +2.120740703282673e-01   +3.384823195841927e-01   +3.899300017763727e-01   +5.068901624458437e-01   +5.884524743879647e-01   +4.342946923067253e-01   +5.445662747140743e-03   +6.307954047883636e-01   +2.988622165470655e-01   +5.106231963485018e-01   +7.594531813047162e-01   +2.469421491115382e-01   +4.037611439018928e-01   -1.552675077246301e-02   +3.150414248423993e-01   +9.412913949263342e-01; +2.076127663235626e-01   +6.268679769927046e-01   +7.632795036272125e-02   +2.632740045555498e-01   +8.227578452431034e-01   +7.842398315649700e-01   +2.078046122171211e-01   +5.497424848621041e-01   +6.864994955746971e-01   +3.572820441912012e-02   +2.110900172937719e-01   +8.170307869202540e-01   +5.128073232255415e-01   +2.123314468326553e-01   +5.561380849146879e-01   +4.734032185318664e-01; +7.317370545779338e-02   +7.067102626723765e-01   +7.792388462175875e-01   +7.509273389026930e-01   +4.893615299838929e-01   +3.127269020278747e-01   +4.788949696025618e-01   +2.937638492327665e-01   +3.121718965404544e-01   +4.632713750929224e-01   +1.895224765037209e-01   +6.395690148582198e-01   +3.940623265201856e-01   +7.564801354993389e-01   +2.273296136943345e-01   +8.509398338342113e-01; +1.339954997501940e-01   +1.798678669629280e-01   +6.862881181957307e-01   +7.455399379909667e-01   +5.687575754996219e-01   +8.609551005739057e-01   +2.718816086416628e-01   +4.159056230113265e-01   +8.448572834988251e-01   +8.905907182337742e-01   +8.579975198639893e-01   +1.795049847629066e-01   +4.162402650574407e-01   +1.408140596964298e-01   +8.415857256020686e-01   +3.865123622630465e-01; +3.110581983878664e-01   +6.912546028184092e-01   +5.816197055200984e-02   +3.379880908768379e-01   +7.816292403613605e-01   +5.021406227206640e-01   +4.099684181394079e-01   +5.506830895213075e-01   +8.946941496405254e-01   +9.082907581949401e-01   +6.678355238081219e-01   +1.056741081637238e-01   +3.283188793157185e-01   +3.516982055503566e-01   +6.573892890974405e-01   +8.605607140831771e-01; +6.533879941432438e-01   +6.870892034724777e-01   +7.127213067047393e-01   +3.021127043535368e-01   +6.318176809660855e-01   +5.162316387425858e-01   +5.003792233774167e-02   +3.860904357026518e-01   +1.000000000000000e+00   +8.341968690893075e-01   +4.736751791442680e-02   +6.880893042114765e-01   +7.677441748945939e-01   +5.387361594081682e-01   +2.793209754439550e-01   +8.145336978124628e-01; +4.726793615137069e-01   +6.234122247283755e-02   +2.270050062138880e-01   +3.855272916475466e-02   +4.323401094894092e-01   +1.502922950909654e-01   +4.059366825665060e-02   +5.595188742965710e-01   +4.664619321288732e-01   +7.446696402363546e-01   +7.353714066864396e-01   +5.064995152508144e-01   +2.644459162628635e-01   +1.752640439070592e-01   +9.343819836728513e-01   +7.530522138043356e-01; +6.311849011380460e-01   +5.375236668949855e-01   +5.503219490484823e-01   +2.252775349331092e-01   +4.145577687168989e-01   +3.048989227741326e-01   +5.552160214058847e-02   +2.106067322608738e-01   +8.643065525759640e-02   +7.537625958034072e-01   +1.493721009342573e-02   +9.736307780313763e-02   +3.240289660178594e-01   +7.438305970445964e-01   +3.213725450664454e-01   +7.419565979048163e-01; +3.722989982385475e-01   +5.067969405164591e-02   +8.923404729569404e-04   +1.713480792619412e-01   +8.809079322826886e-01   +5.652482928384606e-01   +2.449413620103897e-01   +2.007961578624421e-01   +2.050551903578398e-01   +8.428122043797688e-01   +1.261112763701747e-01   +7.334250875452277e-01   +5.240933103443078e-01   +7.876477433684382e-01   -6.491256491034170e-03   +1.113348886395062e-01; +1.397449262907541e-01   +2.693219916688421e-02   +8.818388060284904e-01   +4.508507159344470e-01   +6.324845965097401e-01   +5.018197655676101e-01   +6.601644913765154e-01   +3.757387922352320e-01   +6.561890074495259e-01   +1.073592697027409e-01   +2.893724550521584e-01   +7.602004524311381e-01   +5.148179732386067e-02   +5.151800504826975e-01   +3.794180952198086e-01   +8.364759934770261e-02; +4.151688983837751e-01   +3.349811774351375e-01   +6.246999431862185e-01   +2.146237735531563e-01   +9.234247662164818e-02   +4.547886919547391e-01   +4.121289874729313e-01   +7.069050288915384e-01   +2.875399478148453e-01   +8.751771331078265e-01   +1.443747751282021e-01   +4.167670348751689e-01   +2.170464370019337e-01   +2.249348592303151e-01   +2.802692663152436e-01   +2.157320066636462e-01; +1.587422343131939e-01   +8.613926255442641e-01   +7.063376971992471e-01   +7.037344957671928e-01   +7.399259344585194e-01   +5.578483428154359e-01   +2.470127743452248e-01   +7.382574280820885e-01   +3.398773834644984e-01   +4.400118029878088e-01   +8.386981048355885e-01   +6.115089904641251e-01   +5.518480375596700e-01   +5.343415419777741e-01   +1.063720016458941e-01   +3.635129112616586e-01; +1.137875323047348e-01   +1.889610875235391e-01   +8.396760282794012e-02   +3.499240299175720e-01   +3.557290361040979e-01   +3.923350309397423e-02   +6.482157819128727e-01   +2.943627836221329e-01   +7.960219602155568e-01   +4.760744589984571e-01   +1.151891490513566e-01   +7.779572494177414e-01   +5.995725378191810e-01   +1.801969721711337e-01   +6.872528537185263e-01   +1.430044688378108e-01; +5.505158993836986e-01   +2.063743042595793e-01   +3.035889001307191e-01   +6.197764950225493e-01   +5.236232939729953e-01   +5.249332983928171e-01   +2.295297020133132e-01   +9.885357487136577e-02   +5.574449006780623e-01   +4.657056865466916e-01   -8.401392041417119e-02   +3.567434742002522e-01   +2.227332709315991e-01   +8.869164460032377e-01   +8.810094655595068e-01   -1.094776903790205e-02];
L1E_L1I_iGABA_netcon = [-2.211030398719903e-02   +2.695412673608773e-01   +8.791702249501877e-01   +1.918515981084760e-01   +4.014081583213256e-01   +1.125577603109764e-01   +2.562684029832147e-01   +4.166312474737191e-02   +2.244819024511980e-01   +5.240137887594474e-02   +3.912395245949607e-01   +9.171739687114722e-01   +1.998192082029911e-01   +7.732240646186224e-01   +8.993343028472882e-02   +3.931564101549005e-01; +7.544869122795181e-01   +7.411233648843751e-01   +5.415354170840071e-01   +8.109644694596421e-01   +7.040904057888037e-01   +8.117645783586126e-01   +6.107608574408045e-01   +7.976654951566367e-01   +8.804438740384806e-01   +9.497028039919618e-01   +1.566772086866213e-01   +1.322913981081921e-01   +5.932269816744912e-01   +9.221981200648462e-01   +9.912954615221818e-01   +2.774026162805776e-01; +2.912929035567962e-01   +7.990141121264539e-01   +9.516066639468482e-02   +1.146398244138071e-01   +8.523129674463001e-02   +2.220664676081969e-01   +5.811113790290886e-01   +7.814082068104498e-03   -2.851178931243008e-02   +1.051403743560864e-01   +5.055439729600809e-01   +3.885710939778882e-01   +7.590888729290642e-01   +8.028311538202044e-01   +7.920115972492782e-01   +7.620839908320048e-01; +3.917158670413999e-01   +5.402337442398309e-01   +5.635743150844966e-01   +7.442182963741686e-01   +6.591819655189535e-01   +5.998509376695287e-01   +5.378481393275696e-01   +8.933234604220562e-01   +8.827569256023098e-02   +2.846099006536976e-01   +5.364141654840531e-01   +2.568181029640031e-01   +8.121712894158553e-01   +4.022035480079251e-01   +8.932972987549891e-01   +5.027787501425049e-01; +6.591959437166736e-01   +5.738880647687798e-01   +8.361022630606857e-01   +3.757448728571832e-01   +9.029639896054946e-01   +5.177094426388662e-01   +3.581262717266034e-01   +4.532419784701752e-01   +3.068037389308041e-01   +2.833168708709804e-02   +3.407991183135178e-02   +5.784415178740421e-01   +9.284740727036255e-01   +7.871785145754854e-01   +1.834350625235885e-02   +1.325999991185200e-01; +1.916724253492068e-01   -7.976026381736674e-03   +3.254000947164665e-01   +2.028110880832042e-01   +4.705885284758581e-02   +4.690960607010922e-01   +8.412169420244623e-01   +2.860539291333570e-01   +5.175633967652308e-01   +4.200215660608864e-01   +8.875403643200533e-01   +1.562677668459368e-01   +2.440107470017371e-01   +1.968228908247012e-01   +7.046384388984750e-01   +3.643060792393581e-01; +6.801801358554476e-01   +5.496317503113904e-01   +3.221715405280592e-01   +7.900704787285813e-01   +2.891017478315969e-01   +8.234610655506177e-01   +5.968426609496795e-01   +5.406859276772884e-01   +8.052522832139533e-01   +6.170023350031881e-01   +8.361725175177743e-01   +2.343428917866178e-01   +8.123951755973490e-01   +5.764452879764613e-01   +9.319116627715809e-01   +7.266585053013779e-01; +9.352498670081013e-01   +1.451913857709089e-01   +5.841419427560358e-01   +4.912916585147332e-01   +6.774488520348136e-01   +1.832993226450463e-01   +3.391881682712286e-01   +5.808133278212522e-01   +2.107684299725443e-01   +8.283492166042482e-01   +7.516812300290383e-01   +8.611766720086813e-01   +2.542407286185077e-01   +6.904969804342748e-01   +4.889358869541212e-01   +5.847805307643813e-01; +5.131326429427565e-01   +9.119560612865406e-01   +3.860684988202707e-01   +9.248099203657216e-01   +2.411996560136868e-01   +6.659326676115280e-01   +5.534922271679084e-01   +9.214579920719029e-01   +8.527212110694282e-01   +8.460099622773054e-02   +1.912456987837055e-01   +2.151818001338276e-01   +8.316743019316005e-01   +4.864604731515163e-02   +7.493112962251308e-02   +4.836864163406711e-01; +2.271199459315264e-01   +3.638558431082756e-01   +5.448240161820138e-01   +2.506782452841373e-01   +8.706724261947609e-01   +4.092853047091683e-01   +2.796942588185221e-01   +8.595769331693474e-01   +9.281345636602925e-01   +8.475258303945200e-01   +7.976923054161019e-01   +9.404073863676852e-01   +5.179426039347913e-01   +3.756253537408891e-01   +3.094605579602589e-01   +7.617626775278736e-01; +1.340668542771994e-01   +2.254319114907801e-01   +7.580077347997382e-01   +8.582242180676595e-01   +1.696869631553442e-01   +6.343110732624062e-01   +7.431320558215614e-02   +4.714389658793621e-01   +4.092064548248987e-01   +6.262632171590921e-01   +3.342677703192107e-01   +8.890970689079277e-01   +8.240579124559123e-02   +4.830470155665566e-01   +4.398238073672732e-01   +4.333250475356179e-01; +1.904497039269190e-01   +9.175814538261424e-01   +7.311421787848676e-01   +4.801952428288264e-01   +4.590486552748775e-01   +5.991967544223425e-02   +2.229665575335059e-01   +3.755764763816790e-01   +1.284100417057121e-01   +5.110687575589102e-01   +1.860172583961021e-01   +4.208351013521284e-01   +3.652508679488238e-01   +9.018362674018803e-01   +4.048071316057626e-02   +4.723423673853213e-01; +9.110397267894759e-01   +1.656653537674884e-01   +4.719064639264456e-01   +5.273316237759985e-01   +6.160236583137234e-01   +5.836751876184950e-01   +2.219003481455719e-01   +4.599143385822979e-01   +4.161457573670553e-01   +3.415793168990880e-01   +9.324111148506533e-01   +9.691938795384212e-01   +7.970981985574664e-01   +5.910647949490020e-01   +2.771250842108797e-01   +7.668127474792957e-01; +4.403946966838501e-01   +8.087973830439399e-01   +3.197371042175572e-01   +4.195714624545139e-01   +7.367016604240573e-01   +1.711223581791314e-01   +3.061690452593432e-01   +5.650817488207348e-01   +3.700138517701668e-01   +4.374318058085445e-01   +1.882191074976885e-01   +1.826990687698695e-01   +2.888627660396483e-01   +2.830705154779346e-01   +5.688708574089930e-01   +8.997987053817653e-01; +5.719979115403591e-01   +6.053868298933092e-01   +7.138382193769438e-01   +6.802181924365888e-01   +7.205031341705834e-01   +9.234677271891274e-02   +8.092165725057729e-01   +2.704996196825736e-01   +8.192800934320952e-01   +4.826220850693089e-01   +6.994172536530043e-01   +5.309980500268126e-01   +2.924890919777341e-01   +4.748313977098391e-01   +8.624045581139559e-01   +4.653654456854019e-01; +3.918711129020293e-01   +5.792523363200024e-01   +6.253090751511322e-01   +2.355031431080656e-01   +4.646918945180440e-01   +2.979695638316306e-01   +5.335813002984491e-01   +2.285087460948425e-01   +7.910598969994027e-01   +3.010383082872355e-01   +2.887075335958461e-01   +1.218812974443249e-01   +4.992046125945244e-02   +4.624668124363218e-01   +9.057004506427252e-01   +9.331071096056928e-01];
L2I_L1I_iGABA_netcon = [+6.487787195043366e-01   +4.689198880604216e-01   +7.323756024508792e-01   +5.630626590783666e-01   +9.192301746319855e-01   +6.599316022210823e-01   +8.970489980260551e-01   +7.438509557726880e-02; +4.847645490595839e-01   +1.316513817621174e-01   +2.007972682590433e-01   +9.489119704301979e-01   +1.650526083641915e-01   +5.139065677149668e-02   +8.233859972009873e-01   +6.665146269333495e-01; +9.959088176934773e-01   +5.019653966757229e-01   +6.343304258979333e-01   +6.747874085058786e-01   +7.757038932176183e-01   +6.625897703825120e-01   +3.120892808128490e-01   +2.398557044619299e-01; +3.302731272497387e-01   +1.505492258120090e-01   +8.787998066982194e-01   +4.175020527576265e-01   +7.354709598800750e-01   +3.224718721451817e-01   +8.975194834163841e-01   +1.937862436342039e-01; +6.926545199280503e-01   +4.745895964178554e-01   +6.427942632665156e-01   +2.485907418378384e-01   +8.934641751661160e-01   +3.354290154374834e-01   +5.307646477842600e-01   +2.135257962825932e-01; +5.776782136877674e-01   +5.632570672450562e-01   +7.660638984428062e-01   +1.860950858555740e-01   +2.034849444481342e-01   +7.927329560380280e-01   +8.711958625460868e-01   +5.497750759038703e-01; +8.590346087532179e-01   +4.697743240184530e-01   +2.345139521751596e-01   +2.626396265160312e-01   +7.292632171724234e-01   +1.650958321065731e-01   +6.503163523159808e-01   +3.220405137711422e-01; +9.940816665832771e-01   +3.962419617715628e-01   +6.135473468921737e-01   +8.980963665604553e-01   +1.099151341052682e-01   +4.082459005651159e-01   +4.534465389131009e-01   +2.232186038992469e-01; +7.176654523730674e-01   +1.504570486066183e-01   +4.547437660747840e-01   +2.882121608907664e-02   +7.371089867044389e-01   +3.741998208448127e-01   +7.206891890772718e-01   +6.948037617292967e-01; +4.685512135094775e-01   +8.350937010970746e-01   +6.255550823241000e-01   +8.049759986546769e-01   +3.712299572714963e-01   +8.297493055579893e-01   +8.651002468721339e-01   +2.683298878459699e-01; +5.315034697248138e-01   +6.180709658834995e-01   +4.994649427729267e-01   +3.757957202908670e-01   +3.270688307639846e-02   +8.629606160739693e-01   +6.195240375734795e-01   +4.248531389794746e-01; +1.418023287356194e-02   +3.957485418480342e-01   +3.705553651784979e-01   +4.403522016691820e-01   +3.590866079725460e-01   +5.032809701667192e-01   +2.615944956380147e-01   +5.470525293592854e-01; +3.834249790537997e-01   +1.740648724341937e-01   +6.275728479768563e-01   +7.496408055871787e-01   +2.030281528501540e-01   +6.827127194223641e-01   +3.413174268302704e-01   +6.962496447469757e-01; +4.867588087426847e-01   +4.660631745190867e-01   +6.531417875725996e-01   +3.514061602064847e-01   +8.138718362473614e-01   +4.088625705878753e-01   +3.358544353191210e-01   +3.074154761974813e-01; +5.604268031235098e-01   +1.690803593488522e-01   +2.110802686564097e-01   +2.229164555865309e-01   +6.108122410852105e-01   +5.326093852833409e-01   +2.633647784552748e-01   +7.351598686315722e-01; +7.667744085702480e-01   +6.238828109166604e-02   +6.953363148755659e-01   +3.198800404306327e-01   +3.744923000069234e-01   +5.577897917093745e-01   +1.239899175122900e-01   +2.932294848412447e-01];
L1I_L2I_iGABA_netcon = [+4.973603354233694e-01   +1.926086016229277e-01   +7.969297649049545e-01   +3.295865686311238e-01   +5.316383631684409e-01   +2.868320278839775e-01   +8.659878065369082e-01   +2.308947023673482e-01   +5.285277015402591e-01   +8.389815868366085e-01   +3.891742373039829e-01   +3.839980261975431e-01   -6.468710301122679e-02   +7.280973717016890e-01   +6.138854147175133e-01   +5.053959533080065e-01; +2.569004680165795e-02   -2.302014276763511e-03   +3.102937503069053e-01   +2.865827785835522e-01   +8.779219792077042e-01   +3.694269055388271e-01   +3.277660740571239e-01   +1.372314951981880e-01   +4.605086498271344e-01   +2.222073316364624e-01   +3.072424936739337e-01   +2.768837044863423e-01   +9.355735015575745e-01   +1.789047370415049e-01   +7.778731436126930e-01   +2.183961910408363e-01; +3.921114868566796e-01   +6.594145788023461e-01   +3.171420622444417e-01   +6.873383176569900e-01   +2.502510933780052e-01   +5.278182922266903e-01   +7.465203507055471e-01   +1.288964739392973e-01   +7.417352030124560e-01   +4.599427600066543e-01   +6.167370231011752e-01   +8.780377639333600e-01   +9.507513636909620e-01   +6.604097771212589e-01   +3.693054342582536e-01   +1.857643860621704e-01; +8.243435097832824e-01   +7.395036174708605e-02   +6.694704623715696e-01   +9.182976108854998e-01   +4.678102660058447e-01   +8.878875341955867e-01   +6.508982277949382e-01   +2.072431327790817e-02   +8.512155521579695e-03   +3.383587046753213e-01   +4.228710431148002e-01   +4.413646841929075e-01   +3.252540568855368e-01   +5.305468087904095e-01   +1.436404892509920e-01   +4.811568365139885e-02; +9.253816611332896e-01   +7.770358146369174e-01   +7.323161177706443e-01   +6.211111635368649e-01   +2.819273839887449e-01   +6.620933273823333e-01   +6.301494568276078e-01   +6.253575878544477e-01   +1.036852684070082e-01   +6.705895056626667e-01   +1.822982685222584e-01   +4.637867824879879e-01   +6.640202825078635e-02   +2.002362335589547e-01   +6.710455724850013e-01   +9.399082044338284e-01; +5.271933733537062e-01   +4.330755320942103e-01   +1.154223370270744e-01   +3.588045471694123e-01   +8.907749401588394e-01   +1.454075276035824e-01   +7.138854713133106e-01   +6.260172316918500e-01   +4.947656086611888e-01   +7.475864731308601e-01   +3.057887165457379e-01   +5.504723968260544e-01   +8.947151727804382e-01   +9.626733403152661e-02   +2.235010276947677e-01   +4.285785822465010e-02; +8.743328419682878e-01   +1.119468156533170e-01   +3.630931620978578e-01   +3.143029888828544e-01   +5.289777193013603e-01   +8.335709330801703e-01   +3.536846945775365e-02   +2.556847728755148e-01   +7.146001188981066e-01   +9.105655179305848e-01   +8.980705871217186e-01   +8.519342733148978e-01   +1.184366671611476e-01   +2.595043101715541e-01   +1.024971721953904e-02   +5.967208748198859e-01; +9.041485714338586e-01   +4.061471683204699e-01   +4.940100422081049e-02   +9.018024729977631e-01   +1.857807994637607e-01   +9.728510118704935e-01   +7.678014849850148e-01   +5.122852070413229e-02   +7.854526023519263e-01   +4.792665316040209e-02   +8.656294865042002e-01   -1.994292489540093e-02   +8.344018049329329e-01   +8.964261969655070e-02   +9.767081831897982e-01   +6.778423613589148e-01];
L2E_L1E_iAMPA_netcon = [+2.819586937166688e-01   +9.200094319637392e-01   +6.511150622650395e-01   +5.362861985141218e-02   +3.194043053079686e-01   +3.687397212002759e-01   +7.782574666764011e-02   +6.119612663550918e-01; +2.004826469635211e-01   +1.397448966050542e-01   +7.830266168979615e-01   +8.559311544094087e-01   +3.391655473715303e-01   +5.283460043686418e-01   +2.647966499105083e-01   +1.317865109858059e-01; +4.614874639403585e-01   +8.708718790398745e-01   +7.893239647797892e-01   +2.945213586280822e-02   +6.622650429594805e-01   +2.739157584762405e-02   +4.340938098395328e-01   +8.357374364754503e-01; +4.934118102293626e-01   +6.267001688394300e-01   +9.317685667443928e-02   +5.615756665136166e-01   +2.736959846228303e-01   +5.371997883308481e-01   +1.815680347439622e-01   +4.695105774155626e-01; +8.737288992718780e-01   +6.846851572146814e-01   +7.725109924540741e-01   +5.095708625883835e-01   +7.529641006107237e-01   +3.824703784550607e-01   +4.320707778357511e-01   +4.963384437938350e-01; +4.826245537304135e-01   +6.396461504580263e-01   +3.260018833984848e-02   +6.089157597493363e-01   +6.458601711458724e-01   +8.232789706730397e-01   +2.910360844391889e-01   +9.285878600728818e-02; +4.393232334526833e-01   +3.303033006652990e-01   +2.414106548126897e-01   +4.181826665954383e-01   +4.169456660881035e-01   +2.319019260192697e-01   +6.066098176226258e-01   +2.866401425544508e-01; +6.979444806981526e-01   +1.648344379986207e-01   -5.888996099571525e-02   +9.647659551807903e-01   +5.316205041141242e-01   +3.863129108415135e-01   +5.888886044535177e-01   +6.187996263054383e-01; +7.829867221528970e-01   +5.879003938736863e-01   +6.584983149413387e-01   +1.246473477922368e-01   +3.884714109877848e-01   +2.445020778897399e-01   +5.777717656180094e-02   +9.829657266214527e-01; -3.929403667410943e-02   +1.431912180334770e-01   +1.752548717117581e-01   +1.609825869800136e-01   +1.537560534747434e-01   +5.658452432082082e-01   +8.131510612120384e-01   +8.363045252230489e-01; -2.406682169543745e-02   +1.964439544726585e-01   +5.338809944341203e-01   +4.385449815417195e-01   +1.374527308422617e-01   +4.150647895666913e-01   +1.905561086209029e-01   +7.162911201116284e-01; +3.473747364338773e-01   +5.411885068891562e-01   +6.374166970715156e-01   +4.787585606561509e-01   +6.915351007743915e-01   +3.023423039998511e-01   +7.035368134505197e-01   +4.447039929194863e-01; +6.827813642327055e-01   +7.172170892603308e-01   +5.792728139098929e-01   +2.318777597424659e-01   +2.056801106964815e-01   +1.126561414230311e-01   +6.582200867766497e-02   +4.906727111311822e-01; +7.208855990786401e-01   +8.024350985049845e-01   +2.944544082694507e-02   +8.829674839678483e-01   +5.124031423674188e-01   +7.879216210465042e-01   +1.575939230181784e-03   +1.813557158613910e-01; +9.297112432759619e-01   +2.000895834980477e-01   +4.614261075956747e-01   +5.468843240407268e-01   +3.248549925168028e-01   +2.257161966535045e-01   +5.973447507027742e-01   +3.900750678064754e-01; +8.183867568360562e-01   +6.121106686034938e-01   +6.830249239861733e-01   +3.684710430344774e-01   +4.916251237677799e-01   +8.076202749472975e-01   +7.490292505825683e-01   +1.572250631254866e-01];
L1E_L2E_iAMPA_netcon = [+8.266749517138032e-01   +4.537017546519843e-01   +6.131705996951113e-01   +1.774622715329231e-01   +9.265915877771972e-01   +2.666979328092258e-01   +4.952297486613735e-01   +4.823459285032756e-01   +9.192884605550053e-01   +5.142039130805910e-01   +6.383172469870647e-01   +4.448785485589213e-01   +5.017490470486705e-01   +3.309193856345558e-01   +6.175995884648107e-01   +2.838903762523479e-01; +7.801896234502037e-01   +1.562197387112593e-01   +1.358841815621574e-01   +5.126694203153922e-01   +7.931627235722238e-01   +5.669030174474379e-01   +9.020498955177398e-01   +2.333869712132104e-01   +3.756793346242170e-01   +3.204081631499190e-01   +6.549124222244115e-01   +6.444473210031217e-01   +6.535415529079724e-01   +8.583999728095060e-01   +3.634307342472249e-01   +5.588092709818567e-01; +7.478735829876525e-01   +1.553012353134751e-01   +1.569559716951852e-01   +9.999157367856195e-01   +2.284003339265912e-01   +3.850941009885035e-01   +8.521166066936519e-01   +2.931120752607413e-01   +1.814436437254996e-01   +6.266502179833628e-01   +7.519769970851653e-01   +4.845964906629863e-01   +7.977645059974595e-01   +9.607252400906954e-01   +8.138694913234741e-01   +6.133166572249504e-01; +6.707059362391549e-01   +5.285699571788866e-02   +5.412882249073652e-01   +3.255578688129989e-01   +4.146121959738037e-01   +7.862815989092408e-01   +1.667239741860034e-01   +1.654233697658037e-01   +5.811800411921134e-01   +4.702897603216541e-01   +3.939843783911020e-01   +9.248865085886775e-01   +7.449535581768227e-01   +3.802276663302153e-03   +7.558327413616892e-01   +7.962333471653383e-01; +5.441614204746929e-04   +2.193946358347484e-01   +1.438927346685554e-01   +7.428858268497572e-01   +1.905148174747662e-01   +4.409441428014796e-01   +9.374251528928507e-01   +3.238595154775533e-01   +1.072943566284769e-01   +7.210337059706158e-01   +1.200786635767196e-01   +5.403120312610914e-01   +4.691667937997307e-02   +6.493780116398417e-01   +4.585415309149516e-01   +1.491928598218916e-01; +6.257432619808749e-01   +4.311105910176525e-01   +3.935868356825361e-01   -1.461380130322643e-01   +8.729129966557213e-01   +1.145735474055007e-01   +4.818108552541813e-01   +1.636902524651648e-01   +7.598970694308577e-01   -1.178984330468195e-02   +7.566684194415979e-01   -3.235807674277735e-02   +7.155813055907861e-01   +5.369347227176680e-01   +6.815750762537973e-01   +3.448788957590762e-01; +2.889958996971013e-01   +7.061301891056160e-01   +3.460809532945184e-01   +3.746250333239614e-01   +2.865441363048070e-01   +8.866566189343813e-01   +9.235258850428169e-01   +4.390776436083785e-01   +6.684240425300333e-01   +7.325330083826080e-01   +7.855685752687148e-02   +1.087490743177787e-01   +9.547614010655350e-02   +3.581550720017252e-01   +2.866292477926766e-01   +7.430224372171256e-01; +1.506383211766517e-01   +4.519690521719485e-01   +2.861740682787115e-01   +4.894927459815837e-01   +9.521842256543687e-01   +4.997693933455015e-01   +9.245705904532980e-01   +8.256245510768834e-01   +3.846413602548155e-01   +6.558352926271786e-02   +4.123707075360764e-01   +4.240585424540623e-01   +3.440501907464025e-01   +6.524071707462725e-01   +3.936052510507071e-02   +5.405188666661771e-01];
L2I_L2E_iAMPA_netcon = [+3.306362533394110e-01   +3.044275813831291e-01   +3.346158662853254e-01   +5.489287220702834e-01   +1.734440586763442e-01   +8.246060766153834e-01   +6.881715401979062e-01   +1.915426359462926e-01; +4.812235528764036e-01   +1.333225704234827e-01   +6.794600336620509e-01   +2.824918116610436e-01   +6.733956370611572e-01   +8.298517570509334e-01   +1.047662314579696e-01   +5.247675979162169e-01; +6.439436557129881e-01   -4.571340322752254e-02   +7.105762763094412e-01   +5.876760047062137e-01   +1.490798113757243e-01   +6.367983457670496e-01   +7.546322646085344e-01   +1.147778640102027e-01; +5.487260235426125e-01   +2.464200984537975e-01   +3.948159286942806e-02   +9.647617029593624e-01   +3.541244303025963e-01   +6.232615126195667e-01   +9.614049571959872e-01   +1.622507624559949e-01; +1.407462756095882e-01   +4.601818322716945e-01   +4.662555784745601e-01   +8.552834541912566e-01   +8.586043441838519e-01   +5.362376586874265e-01   +7.026303978501397e-01   +2.666697795163598e-01; +9.034598564449436e-01   +5.142922157399460e-01   +9.216632368470505e-01   +9.163064359551919e-01   +6.873486054894746e-01   +8.693609082779197e-01   +8.453334719062350e-01   +4.914165541528274e-01; +1.122176500074695e-01   +5.613673148732595e-01   +8.994587161681290e-01   +8.412652359249468e-01   +9.494813938863839e-02   +7.241702732412072e-01   +2.393744485004290e-01   +1.602832718382874e-01; +5.842759020235200e-01   +3.916825003370555e-01   +1.387192456976022e-01   +3.056574184840566e-01   +7.070961878434968e-01   +4.109406710058656e-01   +9.721032604779853e-01   +6.687104178251440e-01];
L2E_L2I_iGABA_netcon = [+4.375957413798460e-01   +6.182495600344542e-01   +5.797273554098898e-01   +4.866293023727188e-02   +4.183985915616388e-01   +5.066044910998179e-01   +2.928821003998902e-01   +7.077487963464438e-01; +4.303881149003781e-01   +3.477811969869784e-01   +3.840051614084446e-02   +4.936996734934350e-01   +4.209306496583767e-01   +6.639446771742661e-01   +4.915819701694909e-01   +3.983457957274310e-01; +5.712572351805525e-01   +5.715965583234794e-01   +4.076447265256099e-01   +5.897041464119961e-01   +2.851845457065081e-01   +2.865625171042216e-01   +1.988978909796171e-01   +9.479229630816783e-01; +7.409242529897645e-01   +5.576007460730089e-01   +3.676781923083745e-01   +8.651504716109466e-01   +2.314001490712873e-01   +6.288100132721669e-02   +1.655022515012843e-01   +3.860003084301240e-01; +5.130165637448657e-01   +7.521873938170576e-01   +4.466437157849706e-01   +7.768990122248461e-01   +3.742036212874531e-01   +7.152324063156573e-01   +6.075206216162301e-01   +3.910480481750575e-01; +4.031389314288641e-01   +2.304901925240503e-01   +4.125782319922653e-01   +4.092518551615395e-01   +7.904937831490011e-01   +8.101544404264737e-01   +1.164860519127550e-02   +4.419115568613039e-01; +6.701610840212720e-02   +4.563444553969327e-01   +8.368972361657365e-01   +5.796927894326233e-01   +5.320728514163648e-01   +4.111925962218848e-01   +9.060490006987131e-01   -3.240591880253525e-02; +8.942790601309740e-01   +5.606534154978960e-01   +8.934024924142419e-01   +4.973021617035849e-01   +8.749747729231686e-01   +5.297655940859470e-01   +3.378553303603274e-01   +3.673711199715463e-01];
L3E_L2E_iAMPA_netcon = [+2.559947950600344e-01   +9.084121179912106e-01   +4.597028999395574e-01   +7.433055642260910e-01   +1.821193969269118e-01   +4.083808162446693e-01   +3.660463868530974e-01   +9.924346245774777e-02   +1.384155564281627e-01   +5.417786770214321e-01   +1.619530142450569e-01   +4.975263557827828e-01; +2.736950568192583e-01   +4.528920782021471e-01   +1.472304975453360e-01   +1.946352770298582e-01   +5.375004890686004e-01   +9.263371531175915e-01   +6.848643155489638e-01   +5.546248627911117e-01   +2.162020825944778e-01   +7.685973072369569e-02   -2.195610490424644e-02   +1.020614526140363e-01; +7.566493343049442e-01   +3.584368167660040e-01   +5.224417117903064e-01   +1.331327325271582e-01   +8.148929005236054e-01   +8.829182229735131e-01   +5.288559140865230e-01   +5.777868124672392e-01   +6.975276890097535e-01   +3.146701324819096e-01   +3.671722585921050e-01   +8.796577849635985e-01; +1.798979528137329e-01   +4.756590988263486e-01   +1.893391508427978e-01   +7.532204661660825e-01   +4.569121262567752e-01   +5.475208820663677e-01   +8.348024551332789e-01   +2.739211282167677e-01   +8.028889037187908e-01   +8.086040026056563e-01   +4.244333848157196e-01   +1.669011943384635e-01; +2.063882792128368e-01   +7.585305968039906e-01   +4.259499891149600e-01   +1.792828729347996e-02   +1.928887023788603e-01   +9.380505208961831e-01   -3.559760001351085e-02   +6.630656417102617e-01   +8.647103335032227e-02   +8.416752626234506e-01   +2.650664617779650e-01   +2.073870542077876e-01; +3.267773596776896e-01   +3.944791773311402e-01   +8.183074096258685e-01   +9.389036564051016e-01   +3.571830173502297e-01   +8.958682100116803e-01   +5.668889701237947e-02   +3.441642243534315e-01   +4.876787536048515e-01   +8.180756229931561e-01   +5.826486688357472e-01   +8.449603992345830e-01; +2.297970888244275e-01   +4.675670445239029e-01   +5.470774647269044e-01   +1.209976344935219e-01   +6.292788510733797e-01   +4.525728330780857e-01   +7.283168434388874e-01   +9.832188011853814e-02   +4.137293395165156e-01   +4.078920588100007e-01   +9.751643598894554e-01   +7.061161928287161e-01; +5.699386281185523e-01   -2.289820008317449e-03   +3.862802789342721e-01   +1.499498361995779e-01   +1.478420020034399e-02   +8.631846844043572e-01   +3.745338058162131e-01   +4.628266908828503e-01   +8.198051983390944e-01   +9.897459140915689e-01   +9.085465282730006e-01   +2.893989894639843e-01];
L3I_L2I_iGABA_netcon = [-2.068656743939455e-03   +3.002296826909721e-02   +1.528990474161411e-01   +6.441155652066233e-01   +3.007024864784906e-02   +4.925643850846543e-01   +8.047539516682714e-01   +3.899758421747453e-01   +4.124671720355181e-01   +8.960737013886482e-01   +8.170536053785076e-01   +6.487266252998432e-01; +4.048988583020816e-01   +4.284608908678484e-01   +2.811056960238770e-01   -4.255835984390996e-02   +4.707089486033841e-01   +6.353808837698043e-01   +4.394526217890868e-01   +9.067851416165374e-01   +1.386763376857113e-01   +8.927810187579873e-01   +2.494699244299924e-01   +6.431992677659987e-01; +3.899294859390230e-01   +6.578377527679639e-01   +2.607858070143185e-01   +7.835591864661500e-01   +3.317413548487149e-01   +8.540261959364628e-01   +9.615212913048037e-01   +4.355062742638818e-02   +6.733335014992804e-01   +4.501792600750314e-01   +1.256411105905005e-01   +5.856610927538475e-01; +6.015561930815202e-01   +9.631130409022999e-01   +3.074774668548346e-01   +2.555393837801142e-01   +1.814733129639235e-01   +5.736110230477754e-01   +1.882934959036008e-01   +2.328208796697702e-01   +6.727246040666407e-02   +3.418989272846761e-01   +5.386788811465476e-01   +8.314882494162606e-01; +9.715465706092681e-01   +1.285304541257279e-01   +4.602517878374066e-01   +8.820743430813716e-01   +4.996237924893470e-01   +8.706686252152359e-01   +6.496869273297240e-02   +5.067587698053996e-01   +5.571291674950831e-01   +8.019183596722460e-01   +7.125578832847672e-01   +5.064897327023892e-01; +9.239968379629594e-01   +2.144841627307427e-01   +1.733762454365718e-01   +7.428596920342295e-01   +8.989122257395293e-01   +7.660509111627707e-01   +9.607942023554036e-01   +5.830650984447852e-01   +1.043890541312625e-01   +8.303809734662287e-01   +3.030674185434791e-01   +5.619855156077107e-01; +8.209944233114656e-02   +5.087297388404756e-01   +9.174133374671235e-01   +5.716778176333113e-01   +1.000000000000000e+00   +7.776884050443087e-01   +8.469540959920232e-01   +7.604404746342630e-01   +5.798238729171137e-01   +4.002021991054073e-01   +3.383226250064897e-01   +5.298072760196271e-01; +3.828296521917187e-01   +3.556267632307720e-02   +7.641360424814051e-01   +1.692204648049518e-01   +4.277927568612286e-01   -1.091892351094348e-02   -4.548116269625488e-02   +9.298158180801792e-01   +4.568228455283991e-01   +1.010481287774438e-01   +7.148121850943999e-01   +3.377300325010912e-02];
L2E_L3E_iAMPA_netcon = [+9.515617302057081e-01   +2.259246143311935e-01   +5.538604876836981e-01   +7.283424131180686e-01   -2.463402721937308e-02   +7.056700057552908e-01   +8.119757698800950e-01   +8.613034178331264e-02; +3.395292287858502e-01   +5.255514608861297e-01   +6.719016415363501e-01   +6.860625090513914e-01   +2.730083563178752e-01   +1.994616715878743e-01   +8.281395869538951e-01   +9.124771662499052e-02; +6.489042436197979e-01   +5.108731218488859e-01   +8.478415378925511e-01   +6.087580161839440e-01   +9.442998942810574e-01   +4.582411564720261e-01   +9.964764281326480e-01   +4.366704049428666e-01; +2.153780418998281e-01   +9.127883215396145e-01   +8.869940116503569e-01   +4.172332157058042e-01   +3.754636337820472e-01   +9.465604211945922e-01   +2.279966764539823e-01   +4.895653014952448e-01; +5.582634807262554e-02   +1.927243986114941e-01   +7.151311622324343e-01   -1.979216199007050e-03   +2.254273343699023e-01   +5.469170850674792e-01   +4.659491056459872e-01   +6.068803946164352e-01; +4.002774028399904e-01   +7.867502725143050e-01   +1.678711635181441e-01   +7.679643567481027e-01   +9.202535793795258e-02   -6.151661544280385e-02   +5.182747449831585e-01   +2.281599053581740e-01; +4.575141737660836e-01   +7.747116809435751e-01   +7.925816640548696e-01   +2.651954410933676e-01   +8.127901960805969e-01   +1.723130888048253e-01   +7.038203216407248e-01   +9.447048978582218e-01; -5.511291322649928e-03   +5.348297850310606e-01   +8.867269829300937e-01   +4.702046546427313e-01   +7.175950075598739e-02   +7.725988225203492e-01   +7.331098087077430e-02   +3.228632730915481e-01; +9.690786950882714e-01   +9.174614145225146e-01   +1.240759373722321e-01   +1.646436005476675e-01   +1.042584600970057e-01   +9.106742189103464e-01   +2.745884966669809e-01   +9.103687962153245e-01; +1.365516060667166e-01   +4.035896032807628e-01   +8.157502481348125e-01   +3.314304446814242e-01   +4.257620480047037e-01   +8.904324114022945e-01   +4.823729546456934e-02   +9.172297460907510e-01; +6.854945306623964e-01   +3.499784339970436e-01   +2.817046275596097e-01   +2.646379734781884e-01   +2.021280215058363e-01   +3.405691105139103e-01   +1.919105909006502e-01   +1.359343101197235e-01; +1.481483838432464e-01   +6.475409847140727e-01   +8.373364221006165e-01   +4.140106855019780e-01   +3.775877070046362e-03   +7.037883441914041e-01   +7.881884249794070e-01   +7.665825602259059e-01];
L2I_L3I_iGABA_netcon = [+3.266026783833510e-01   +6.702119408551759e-01   +2.694048107800781e-01   +6.374491811498042e-01   +4.895370245995884e-01   +4.105906634298516e-01   +4.350549864888394e-01   +4.904203027617821e-01; +3.475040685534059e-01   +8.342847287055428e-02   +1.727929753037075e-02   +8.211742028400270e-01   +6.709604515338968e-01   +3.052485858043783e-02   +9.587535648232838e-02   +6.153483544853502e-01; +3.232659861200377e-01   +6.208779744584916e-01   +3.882912068118772e-01   +1.001460786948789e-01   +8.351518958678574e-01   +6.348843112062980e-01   +2.240597694761514e-01   +1.621970599100120e-01; +5.832021819673354e-01   +8.387339388622882e-01   +5.528771657056192e-01   +4.504618816059353e-01   +5.502021309771069e-01   +6.805680049559710e-01   +3.801741437017258e-01   +6.445509814573203e-01; +1.243820310931287e-02   -3.763612696488943e-02   +4.653942283253409e-02   +7.067759992613566e-01   +2.352892858703584e-01   +6.078638675787902e-01   +4.296954874611837e-01   +2.694875694031057e-01; +5.619039167546938e-01   +3.981909983774424e-01   +4.225016123109075e-01   +7.128183900333767e-01   +2.202022033529466e-01   +7.922873195184233e-01   +4.313136257282911e-01   +9.133729620357660e-02; +2.030301619301199e-01   -1.391477077466821e-02   +3.986800194146338e-01   +9.829441912610590e-01   +6.732885417001611e-01   +4.203732597313861e-02   +2.525932220166612e-01   +8.468702774976450e-01; +1.823654589228476e-01   +8.789495883828429e-01   +9.096320301980524e-01   +9.007647842190796e-01   +4.847814034576672e-01   +1.160733157232268e-01   +6.828870268374650e-01   +8.636348087258214e-02; +3.297635442210937e-01   +5.350823891571183e-01   +2.497669720487270e-01   +1.662389440533447e-01   +3.849171375513631e-01   +2.851475857063083e-01   +5.987809622856547e-01   +4.636727951123568e-01; +3.996709769173865e-01   +2.033911140787712e-01   +1.987747292664527e-01   +4.026525214465638e-01   +9.663606861915613e-01   +5.043494720829363e-01   +4.679370204288665e-01   +9.235349432846566e-01; +6.136683434051249e-01   +7.432638230845147e-02   +3.318151622102145e-01   +5.807304322835499e-01   +5.346937391425207e-01   +6.541686842073806e-01   +8.753997851170119e-01   +6.301460955662930e-01; +3.616407273268844e-01   +1.727234618809907e-01   +6.064799450085262e-01   +3.568206269407477e-01   +1.307816135554142e-01   +1.620608399982727e-02   +3.020903547501267e-01   +6.502683831446050e-01];
L3I_L3E_iAMPA_netcon = [+9.810106324003141e-02   +6.461629141335862e-01   +7.820900590972070e-02   +1.832705439725610e-01   +2.413846188266632e-01   +6.259537229054576e-01   +7.343589238566157e-02   +3.552592762500729e-01   +4.903347529412015e-01   +3.588234382706244e-01   +5.969431592816602e-01   +8.784861381595566e-01; +3.487141124561018e-01   +8.029865538734898e-01   +2.518199397275285e-01   +3.172602322420612e-01   +6.908958677920033e-01   +4.435500953793065e-01   +4.346281712497129e-01   +3.596174348347204e-01   +6.188733432870339e-01   +2.769552912057646e-01   +6.745176327768864e-01   +2.015690794327466e-01; +4.352451785563847e-01   +3.124227549603826e-01   +6.993645021605535e-01   +8.583220425635018e-01   +5.496047480803392e-01   +6.215414065075460e-01   +9.970715638352944e-01   +4.473448132800634e-01   +2.263043698732902e-01   +3.273469242096043e-01   +8.964424968536651e-01   +8.370633196095613e-01; +4.759783584807774e-01   +1.190591124428716e-01   +5.642224389800068e-01   +7.097860970448765e-01   +4.161495951687779e-01   +5.943583963123648e-01   +5.458670333101334e-01   +6.954878493480735e-01   +5.148806907147950e-01   +2.299586385118259e-01   +3.923059268502619e-01   +5.003033252764362e-01; +9.084006795813782e-01   +7.732201569829814e-01   +5.555673370183912e-01   +4.769432866752585e-01   +2.408681228509785e-01   +2.972207012066012e-01   +9.623033907315117e-03   +2.434848397219411e-01   -1.740672062385137e-02   +2.431911810897698e-01   +2.134605742112632e-02   +5.041043945335130e-01; +3.694194320699417e-01   +1.587898115278483e-01   +6.264758924822356e-01   +4.144769910774083e-01   +9.709942978768932e-01   +5.908538102806780e-01   +2.896977173610804e-01   +9.094935390379176e-02   +1.789026138150113e-01   +5.478271822647789e-01   +3.055818069473550e-01   +8.765688746728661e-02; +4.822531431016974e-01   +2.553529093310507e-01   +8.319350179337661e-01   +8.371270158066844e-01   +1.173644159183076e-01   +2.292010027820659e-01   +4.153799459358405e-01   +1.225061622695690e-01   +8.939104532562214e-01   +7.289854317764267e-01   +2.847234187280571e-01   +2.047810225395181e-02; +3.669770171298269e-01   +3.994564851499860e-01   +3.218331649879195e-01   +5.883098943207193e-01   +8.141520040909591e-01   +2.386436011506851e-01   +3.834388833569887e-01   +2.926195162093919e-01   +3.284548497261398e-01   +2.265889213959205e-01   +6.468646694655366e-01   +5.211462217410247e-01; +2.922306307605498e-01   +4.659179601614605e-01   +3.759079482173882e-01   +5.625576841242498e-01   +5.662227582466035e-01   -7.268698544821847e-02   +9.871942087009919e-02   +3.042267416688417e-02   +3.079105888865113e-01   +2.029372457814363e-01   +8.358749303726610e-01   +8.822069361849298e-01; +7.138680847368791e-01   +5.797111502276797e-01   +5.987406506343580e-01   +3.900813245788535e-01   +4.849414657944786e-01   +3.946280820358317e-01   -1.382187844932118e-02   +6.482231156565228e-01   +4.959273049924835e-02   +8.478426137109581e-01   +4.376728088456149e-01   +1.437819948236114e-01; +5.597520723248618e-02   +3.051513090446674e-01   +6.200403995753997e-01   +2.528766726177796e-01   +1.756487579422338e-02   +5.371829328758979e-01   +8.340437604498978e-02   +7.268774842898378e-01   +6.889068721201603e-01   +1.515581903298636e-01   +6.317001714981813e-01   +3.013367551601872e-01; +6.227725212775636e-01   +6.803952743431118e-01   +4.226313338641442e-01   +6.120281042139510e-01   +6.431391908694644e-01   +3.396246309824588e-01   +2.948253692658077e-01   +8.062841080435438e-01   +5.715824585090717e-01   +3.707826326043410e-01   +4.969652561891160e-01   +3.699734574028873e-01];
L3E_L3I_iGABA_netcon = [+3.213274733931353e-01   +7.220432133056738e-01   +6.484268416419700e-01   +8.999511193128302e-01   +4.775470673594094e-01   +5.199711729679634e-02   +2.573442504910940e-01   +6.988344799777129e-01   +7.041194974382337e-01   +2.961373443556152e-01   +4.910165259945615e-01   +2.853774058446011e-01; +8.591069219142794e-01   +3.693706040166933e-01   +5.744196180729634e-01   +1.093888989035361e-01   +8.428342900727156e-01   +4.019337227905481e-01   +7.950297193466263e-01   +6.756741511773324e-01   +5.787814313383643e-01   +7.421894648195212e-01   +2.578950162596469e-01   +4.485741918753660e-01; +7.623893544136704e-01   +3.991807411641001e-01   +4.265583258681501e-01   +4.961895783908019e-01   +5.533921842136377e-01   +5.380590036229327e-01   +2.376414990300804e-01   +8.201065885545227e-01   +5.117104509851051e-01   +1.839477839335291e-01   +7.955069831196332e-01   +8.810486710908663e-01; +1.621702376260268e-01   +6.722400175313524e-01   +3.239894822315542e-01   +3.154474224738955e-01   +9.863515741023549e-02   +6.263337477572845e-01   +2.644176779373845e-01   +6.206637199955799e-02   +3.496209663633432e-01   +4.894262501546099e-01   +7.397582859665636e-01   +6.003299179578391e-01; +2.576647506862569e-01   +6.348041029221583e-01   +5.741640897260730e-01   +2.730553179751559e-01   +9.859370125366786e-02   +6.474788369643181e-01   +8.671219832337000e-01   +3.103618117214244e-01   +2.529134273591540e-01   +8.368673293051883e-01   +6.160047659153484e-01   +1.999837546445116e-01; +4.634082325290517e-01   +8.037512295920894e-01   +6.963233297548737e-01   +4.678977270778533e-01   +7.143091287504628e-01   +8.935528316991659e-02   +3.315030069900706e-01   +2.456627358303229e-01   +8.955729628012991e-01   +8.762612792540835e-01   +8.117793233473425e-01   +2.216063794713547e-01; +5.712200704747902e-01   +8.059780985202395e-01   +2.141976441686054e-01   +1.930848744172794e-02   +4.011532208868501e-01   +5.612887876250452e-01   +6.200581326043403e-01   +1.766739560461751e-01   +9.408003767133860e-01   +5.633274880817354e-01   -5.203978035352574e-02   +3.276676894197987e-01; +4.769602841413557e-01   +3.846513849901802e-01   +8.823973136265580e-01   +4.122115963299656e-01   +1.060718149791268e-01   +9.049764053206803e-02   +5.746527991134281e-01   +5.686698863590352e-02   +5.807276249769393e-01   +7.685931573600481e-01   +1.923012560453279e-01   +9.777721224296728e-01; +2.843252260950169e-01   +5.279677821444139e-01   +2.692375227764997e-01   +7.484143237172215e-01   +7.907369608228358e-01   +1.001127489648983e-01   +3.846547989499071e-01   +5.952711389197268e-01   +5.899876364354297e-01   +8.341021123446200e-01   +6.642196977180107e-01   +6.467213901559086e-01; +5.690269707820601e-02   +2.770758663426025e-02   +3.034999111559334e-01   +5.780341759508260e-01   +7.781837029063443e-01   +1.806811044119666e-01   +3.693316687746374e-02   +3.088796170773672e-01   +6.831840084041868e-01   +2.797838316406155e-01   +6.090124950129346e-01   +4.240277839320095e-02; +8.655101660809531e-01   +3.130549172324726e-02   +7.141632866677704e-01   +5.177143748653052e-01   +3.588326314776500e-01   +8.457781274169366e-01   +1.461529049430897e-01   +8.124187691786894e-01   +3.272315847893104e-01   +8.873151881043002e-01   +5.268569181169857e-01   +7.053954625064998e-01; +6.689973793622790e-01   +8.460086501276016e-01   +4.764706690073685e-01   +8.670949827424184e-01   +8.060872262773578e-01   +4.971440833605884e-01   +8.984139061219613e-01   +8.956014406790652e-01   +4.597944527694409e-01   +8.504210873275779e-01   +4.866244145110144e-01   +8.703903883319617e-01];
L2E_Input1_iAMPA_netcon = [+9.528563381099766e-01   +9.279612324773017e-01   +9.094500004748439e-01   +9.534317992329000e-01   +8.919754008408149e-01   +9.932413781755771e-01   +8.973728128374699e-01   +9.354458269310256e-01];
L2I_Input2_iAMPA_netcon = [+9.360160720584252e-01   +9.523428691093895e-01   +9.506172552353542e-01   +8.881812621250307e-01   +8.611589619827619e-01   +8.877627462507266e-01   +9.491453465786821e-01   +9.349184436308964e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
