function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.127081885494572e-01   +9.496466017257376e-01   +6.982365150646579e-01   +1.655604778363839e-01   +9.167640646583937e-01   +2.162386562295496e-01   +7.417303961976608e-01   +3.094392160550563e-01   +5.425451173987077e-01   +8.436755373231245e-01   +9.741267102216470e-01   +9.702627502026662e-01   +6.997010615382787e-01   +3.642144993188386e-01   +2.978400503506143e-01   +3.851853022401112e-01; +3.475348175508786e-01   +8.606062140599930e-03   +1.412414401747105e-01   +1.687493571378151e-01   +7.446463109964052e-02   +8.126289323565579e-01   +7.942991324647825e-01   +7.593268971566252e-01   +7.933408855360834e-01   +1.922166362704120e-01   +4.692988534753066e-01   +6.650726560258423e-01   +3.701532402168645e-01   +2.749543290514664e-01   +6.913050098772026e-01   +9.687806082227454e-01; +2.064778584949325e-01   +4.756311066104343e-01   +8.620528561208202e-02   +7.052775904927204e-01   +3.189919616086215e-01   +3.833868683262706e-01   +6.563502531667411e-01   +9.555899325491271e-01   +5.135472603013184e-02   +9.274222431896826e-01   +8.682031012578977e-01   +2.028230840302182e-01   +5.502962008528266e-01   +7.509624213285426e-02   +7.839523027101334e-01   +8.106015722513006e-01; +2.538101797806668e-02   +4.889169116387583e-01   +4.284101660575983e-01   +8.372826041028890e-01   +6.379998843708200e-01   +8.586012055795286e-01   +4.410625170505028e-01   +3.441301828760699e-03   +4.625381034143786e-01   +4.244557001042599e-01   +9.443641282337475e-01   +8.999632631521803e-01   +5.143728514047612e-01   +1.586399829449860e-01   +7.152111325506989e-01   +8.912909821285745e-01; +7.701866987264594e-01   +5.163739626177291e-01   +8.997660543567633e-01   +8.580752151014436e-02   +9.047838043640508e-01   +3.235253322409015e-01   +5.814519468162416e-01   +3.976613195238876e-01   +9.360757966497233e-01   +3.036223868164266e-01   +2.434734935230438e-01   +4.808744664017824e-01   +7.703974090068347e-01   +3.634939053531432e-01   +2.704998731640319e-01   +6.936574018501097e-02; +5.708984053182805e-01   +2.902540745157076e-01   +7.146373990249867e-01   +8.362741852674087e-01   +7.993704662045581e-01   +3.784436156454274e-01   +5.146145426891254e-01   +1.556146112042235e-01   +4.821254518750920e-01   +3.534911413654165e-01   +9.231760296678890e-01   +6.702925975413171e-01   +7.563406892776199e-02   +7.156088538356287e-01   +1.689381672274374e-02   +8.998703648728551e-01; +5.792588461629931e-01   +5.569849302954684e-01   +6.880566851251616e-01   +5.537893620790995e-01   +6.469365549829450e-01   +6.420799477808479e-01   +7.309656894795465e-01   +8.289383614397230e-01   +7.816491547421265e-01   +9.763485242955788e-01   +6.345124052363601e-01   +5.311676203134100e-01   +2.444932668600301e-03   +5.400608524552933e-01   +1.498733981654622e-02   +6.744160210643846e-01; +3.908555587679906e-01   +5.223644641452401e-01   +2.054145070686833e-01   +9.641520689808989e-01   +4.487719638217666e-01   +3.923603716796839e-01   +2.231182744364693e-01   +2.845550124890840e-01   +1.101272733739778e-01   +5.364533721146328e-01   +2.870524789647262e-01   +7.079215913036720e-01   +4.003971866224940e-01   +2.329926113301739e-01   +9.281138223069326e-01   +3.443793653468103e-01; +5.496716122730816e-01   +6.716683972267085e-01   +5.236197337124049e-01   +6.697108696854469e-01   +7.494945384677526e-01   +7.470237097099844e-02   +9.986547938423298e-01   +9.838773413915423e-01   +5.224065151838057e-01   +7.972877492655542e-01   +8.525966848543881e-01   +7.158513207782645e-01   +6.655546724049967e-01   +4.665492052823599e-01   +9.351208848848311e-01   +8.396231609712030e-01; +1.876623183749813e-01   +6.178610309636480e-01   +8.205708427072564e-01   +3.394339299131684e-01   +8.293940023293899e-01   +1.342757009448284e-02   +6.193924772520583e-01   +6.250825064265541e-01   +6.411150857489352e-01   +8.029238108605518e-01   +1.622864062440692e-01   +2.994982198433199e-01   +3.763621719776091e-01   +7.218724787158040e-01   +3.716093005389756e-01   +1.981374772830915e-01; +1.139373324695791e-01   +5.671460845346687e-01   +1.841305459510948e-01   +2.103019702720401e-01   +3.465554916158578e-01   +8.783538297341015e-01   +9.946240781926848e-01   +7.417652363244719e-01   +5.798603693190602e-01   +1.386372102847762e-01   +8.251672286237782e-01   +1.074888489023239e-01   +3.996279675169657e-01   +5.183448681993625e-01   +1.009780312685605e-01   +8.454339433683998e-01; +5.518261437544766e-02   +5.066222623883546e-01   +5.153413228597850e-01   +5.688586032955989e-01   +1.547624947950756e-01   +1.640236880295288e-01   +4.948143316862531e-01   +8.856294579433932e-01   +8.378207354274135e-01   +4.528186937207229e-01   +2.162696257594036e-01   +3.343715700465643e-01   +1.392737887456550e-01   +5.128055593034476e-01   +7.188363881404534e-01   +4.264230143116094e-01; +9.362578522947445e-01   +6.682500868185220e-01   +3.527854369491905e-01   +2.895050531598680e-03   +5.034463915739258e-01   +9.202271592671607e-01   +5.323334550079880e-01   +3.328785603254635e-01   +1.156819186870307e-01   +4.552449646551453e-01   +2.768802260218052e-01   +4.593847399041433e-01   +3.430599322678225e-01   +3.983327029693751e-01   +4.563494725130504e-01   +5.576240572408658e-01; +7.444415966091220e-01   +6.329426640772953e-01   +6.526295065059359e-01   +5.925932097664756e-01   +4.107743199224772e-01   +5.632882344084641e-01   +8.625835631076014e-01   +9.553331419794459e-02   +5.539623362335952e-02   +9.637225581481007e-01   +9.134115537207108e-02   +7.207785921484063e-01   +1.216240409183186e-01   +4.786919918161803e-01   +1.335944235422020e-02   +4.460430899803429e-01; +2.361655096324870e-01   +1.450479790754801e-01   +2.828385436111722e-01   +8.981741302120013e-01   +1.720282958963422e-01   +9.257377297659163e-01   +2.531646276080831e-01   +4.446026053486241e-01   +5.193702184269438e-01   +5.153131333164023e-02   +9.208916000962779e-01   +4.039516170010671e-01   +3.699696789793742e-01   +7.473242474356960e-01   +1.193606295137231e-01   +7.646862130899933e-01; +2.032978666466591e-01   +1.824695742362212e-01   +4.348862345610387e-01   +2.568435400684546e-01   +4.964507362974445e-01   +5.981756731555589e-01   +5.786735197325427e-01   +2.396022105047377e-01   +7.013522353839104e-01   +3.510207647313371e-02   +7.312293113571243e-01   +2.468340257879764e-01   +2.472961403725590e-01   +7.056473962550139e-01   +6.652292650802992e-01   +9.597514231766456e-02];
L1E_L1I_iGABA_netcon = [+8.479891494417050e-01   +7.543561984157774e-01   +8.739781334958663e-01   +4.356650937533417e-01   +9.199345654759657e-01   +7.725288923948787e-01   +3.243435742664081e-01   +6.435681973921752e-01   +9.161712886270106e-02   +2.757764502267895e-02   +1.268421321289259e-01   +5.204614086928440e-01   +8.834097580203599e-01   +5.754321135826046e-01   +1.709948191867205e-01   +6.446143256763962e-01; +6.219374874244276e-01   +9.973934859118576e-01   +3.142400216402045e-01   +1.405486273642335e-01   +8.955957980587613e-01   +2.784051082290921e-01   +9.692402354573274e-01   +4.448512325734441e-01   +2.964467915155039e-01   +5.096504349020965e-01   +4.388362704857096e-01   +2.036226471941115e-01   +8.085548171956670e-01   +2.923699014291518e-01   +5.074908429721754e-02   +3.394313518070050e-01; +6.682504707322697e-01   +3.730440222454703e-01   +4.313769892652246e-01   +6.557212585645859e-01   +5.855596171060191e-01   +5.214923038148817e-01   +3.548641015991171e-01   +4.837627999285286e-01   +3.343197936450427e-01   +8.715889918515224e-01   +4.832935065147105e-01   +7.766441870413785e-01   +6.518927326741170e-01   +1.452883031528434e-01   +2.257745690277239e-01   +1.507437928838985e-01; +7.863627692768079e-01   +5.086502457317866e-01   +3.798841875477971e-01   +7.327679810174932e-01   +8.389689886617734e-01   +4.155135238768833e-01   +3.226579110858361e-01   +9.738111599989045e-02   +4.798750515332432e-01   +5.825783929572873e-01   +6.797429252597790e-01   +3.875539903661339e-01   +7.362711295910396e-01   +4.571065461985556e-02   +2.013639885660556e-01   +3.997356051369590e-01; +3.151863784571370e-01   +7.603432771665808e-01   +6.566336386858478e-01   +1.704377337696225e-01   +7.842787307819183e-01   +7.864437862200139e-01   +9.188279172521006e-01   +8.066678587330508e-01   +2.433646673197868e-01   +4.250276351235277e-01   +3.506710392195722e-01   +6.493899489177658e-02   +6.700931084006408e-01   +6.216022932613557e-01   +2.103042808069676e-01   +9.219852463233867e-01; +3.244183496677580e-01   +1.352021290310752e-01   +2.484042731715762e-01   +3.400508961557105e-01   +7.926522014747441e-01   +2.847751243370987e-02   +8.850568206932442e-01   +6.338835010597252e-02   +4.612712667159033e-01   +7.262015017527926e-01   +4.880441237077202e-02   +7.515512392835835e-01   +8.876947209474393e-01   +6.071197453138941e-01   +5.840953750135669e-01   +1.589866592360610e-01; +6.275990785121595e-01   +5.175420820261053e-01   +6.877703115608749e-01   +9.997572017248638e-02   +7.001486335477286e-01   +4.058451477892425e-01   +3.619882419312651e-01   +9.547919558586464e-01   +7.586197612205624e-01   +2.290749061318737e-01   +2.935368843968491e-01   +4.612158525307686e-01   +8.547540309309353e-01   +3.753222953859217e-01   +3.324566494565990e-02   +4.634637658773303e-01; +9.030296371140466e-01   +9.136019019073824e-01   +3.291346110810482e-01   +4.476277334314453e-02   +1.429090599905570e-02   +8.341050083719304e-01   +7.427660551156953e-01   +7.758550352816709e-01   +7.152197830398346e-01   +5.868431113457741e-02   +8.094802004502808e-01   +3.097867123353919e-01   +4.068271407463363e-01   +8.370915152149029e-01   +7.993706651958286e-01   +8.138962460215689e-02; +3.734792190021604e-01   +9.727104786273662e-02   +8.828564064033038e-01   +4.771795579104791e-01   +3.286796824604941e-01   +5.921593770146929e-01   +1.189093678283710e-01   +4.505171005385749e-01   +2.367402887360976e-01   +9.771405291207637e-01   +6.537144578894912e-01   +2.690553001246811e-01   +1.157998970957736e-01   +5.193362342745499e-01   +1.410578029281556e-01   +3.410814798590018e-01; +8.893156629994325e-01   +1.890530426054640e-01   +9.979574154889351e-01   +4.777294232903777e-01   +9.560014023099982e-01   +2.107854324300361e-01   +5.977837494844070e-01   +1.667312292318129e-01   +6.994674060259189e-01   +9.757869021871655e-01   +7.146689398444618e-01   +5.762851731636867e-01   +4.121635133476959e-01   +8.190874945514959e-01   +5.783014450477044e-01   +4.936629223784901e-01; +1.155495947529131e-01   +1.744720804001944e-01   +6.909826639492187e-01   +5.546840471056056e-01   +4.068970299656832e-01   +2.953185226572093e-01   +4.355840065160394e-01   +7.908907382985000e-02   +3.031157417503995e-01   +1.271531363222803e-01   +7.579586588217848e-01   +9.136073751010123e-01   +3.334262930384648e-01   +5.864394776036256e-01   +8.456878644506390e-02   +5.036165251181395e-01; +9.127159660859291e-02   +5.359852770170658e-01   +3.528309987708297e-01   +6.461003409430814e-01   +6.273639294479566e-01   +2.713557531105256e-01   +9.703524798515276e-01   +7.445996196416298e-01   +4.723938960858186e-01   +6.335499635106923e-03   +3.913210773114251e-01   +4.510372683015290e-01   +1.066090699349193e-01   +7.134273150822198e-01   +2.261762207526201e-01   +1.315122047818025e-01; +5.429115640533031e-01   +9.772371390580971e-01   +5.603314087268476e-01   +3.530112883187457e-01   +8.530695250587280e-01   +9.430848906846347e-01   +9.808702173970921e-01   +5.351132538193240e-01   +4.341998830808973e-01   +9.377171457740257e-01   +3.629211635286811e-01   +9.799686894403161e-01   +8.645167655930338e-01   +7.359771081666204e-01   +4.384170268532007e-01   +7.683545795828772e-02; +6.028506854749077e-01   +8.456485347909558e-01   +8.978664626298068e-01   +2.549371855653432e-01   +3.723377817862084e-01   +5.592962872807619e-01   +2.498604367650827e-01   +4.899663886821689e-01   +7.340031867044277e-01   +7.434035023267320e-01   +8.144292233294181e-01   +1.048796907308376e-01   +9.023817252392189e-01   +4.482821863732068e-01   +1.754104254054940e-01   +6.713629777634670e-01; +7.266451697770013e-01   +6.683329819820033e-01   +6.509817639117154e-01   +1.818564795877919e-01   +2.055234798388185e-01   +4.382188465214749e-01   +7.793517308050950e-01   +8.913410335112544e-01   +8.771575819269415e-01   +4.281810781919402e-01   +3.905823585860216e-01   +4.211498354638237e-01   +6.956859805905232e-01   +2.789714282784707e-01   +4.189977260648002e-01   +1.184869480346358e-01; +9.939782813927841e-01   +1.579862176632884e-02   +3.827055063834209e-01   +4.787478688534022e-01   +9.112446635512187e-01   +3.230212471098213e-01   +7.133140798350359e-01   +5.913458864048480e-01   +9.119461643320848e-01   +9.475583886011112e-01   +8.759987982452128e-01   +3.932634172717893e-01   +7.495198006962606e-01   +1.574079319890926e-01   +9.709182135931351e-01   +9.861085642257704e-01];
L2I_L1I_iGABA_netcon = [+5.722859504767603e-01   +5.651256507716588e-01   +1.042596897510446e-01   +4.556311077664099e-01   +7.992735816138026e-01   +9.678903618675362e-01   +2.222244317877975e-01   +7.537767298495897e-01; +5.561012615270037e-01   +9.504845124360032e-01   +1.381629267811305e-01   +5.695511279221914e-01   +5.429197851632935e-01   +4.253634903586588e-01   +6.118656821822993e-02   +4.992327723567964e-01; +6.046598788886745e-01   +1.645060442473032e-02   +4.372412977006891e-01   +8.183631660976111e-01   +2.604691415377402e-01   +3.892486847575378e-01   +8.347987452761664e-01   +8.236029160114342e-01; +4.675113575121037e-01   +1.198557450519271e-01   +9.318642263683740e-01   +3.613222356861001e-01   +7.787236885017856e-01   +4.574306936703161e-01   +4.086885194552130e-02   +9.139741092290347e-01; +4.354515044518445e-01   +8.560374834956589e-01   +1.388586467393935e-01   +2.412119640617625e-01   +7.825814345733326e-01   +1.292533785491842e-01   +9.117426454867174e-01   +7.054648790529058e-01; +6.990426662815900e-02   +2.179153086877060e-01   +8.181082332611115e-01   +7.646024841359216e-01   +1.497274031827640e-01   +4.653688421383427e-01   +4.551655881075541e-01   +8.058120701216732e-01; +6.364108050385341e-01   +7.006803754046410e-01   +9.336230041977762e-01   +8.459776897043873e-04   +8.302991779096275e-01   +2.673149208625664e-01   +2.835114757444117e-01   +9.647102759027253e-01; +4.277031513254254e-01   +7.779378964461571e-01   +5.739970360675377e-01   +2.782400701241864e-01   +6.223188660855848e-01   +1.044800821066349e-01   +7.557728546886103e-01   +9.472847573420540e-01; +7.543352018320792e-01   +4.246456316891234e-01   +4.949662620769032e-01   +3.308250749195504e-02   +4.615006182003090e-01   +6.585756215961045e-01   +9.284764465784188e-01   +2.949980290543214e-01; +3.069206372993425e-01   +7.323372582894094e-01   +9.250572477457545e-01   +6.688180882656248e-01   +4.923576544968162e-01   +9.352149434129536e-01   +1.384207605986247e-01   +3.594270551887228e-01; +6.005897552937932e-01   +4.513873072056909e-01   +8.619067013705843e-01   +9.755031735169617e-01   +2.190944611223363e-01   +7.698060722262353e-01   +9.491274221937638e-01   +5.438706910971105e-01; +3.303968093950749e-01   +8.045079966503192e-01   +2.489530360614843e-01   +9.441932365981179e-01   +8.558336148236706e-01   +3.964284124607662e-02   +3.159347573813474e-01   +2.102059247950852e-01; +6.453627127405634e-01   +4.314758145651423e-01   +4.535138785355301e-01   +5.284140164298672e-02   +8.821000066719917e-01   +2.602489395631015e-01   +2.024742035018219e-01   +7.709231939076067e-02; +2.836935487399071e-03   +1.483225611623780e-01   +7.331969432522187e-01   +2.883684443463021e-01   +8.357465319681255e-01   +6.455407910075915e-01   +4.642700378554754e-01   +5.073562970670030e-01; +1.448906900344304e-01   +8.007638639340066e-01   +7.482891898198712e-01   +4.776623044168196e-01   +4.404495478683515e-01   +8.850642641778993e-02   +5.996317503071827e-01   +1.948884126484483e-01; +2.528458317778301e-01   +3.737445445738750e-01   +2.349668726109078e-01   +8.875501730400316e-01   +5.431719877887766e-01   +7.585568673162994e-02   +5.466849861266900e-01   +1.406750392970920e-01];
L1I_L2I_iGABA_netcon = [+7.149994796797453e-01   +8.754040837391728e-01   +6.142111086448649e-01   +5.193742238268204e-02   +1.527101498957999e-01   +2.358774779007501e-01   +8.466692050845317e-01   +3.721933142479701e-01   +7.154306175081141e-01   +3.920958342163368e-01   +2.453985032145476e-01   +6.811235871046137e-01   +1.630728329768856e-01   +5.739607203281190e-01   +4.872312306987250e-02   +4.913066342932353e-02; +6.090801946207808e-01   +8.005497970719477e-01   +6.185613847776328e-01   +5.155524422977494e-02   +7.492925933389051e-01   +5.545639254753896e-01   +1.989114009654689e-01   +5.702386653353786e-01   +1.959377559727387e-01   +7.286378786873111e-01   +5.111632562277566e-01   +3.387045289749800e-01   +1.141945227246454e-01   +8.174340539717869e-01   +4.371608336527685e-01   +9.254913943137120e-01; +1.620838034393633e-01   +6.215305570893312e-01   +3.153801123761804e-01   +6.049967176096456e-01   +9.518851223168232e-01   +1.177050336481503e-01   +6.145159026025560e-01   +8.391566200061251e-01   +2.359457023246401e-01   +6.353229098765885e-01   +7.365940200834923e-01   +5.497420687285244e-01   +7.474580373921650e-01   +6.794647984333163e-01   +9.250732445515668e-01   +1.795658970774115e-01; +4.854114739884623e-01   +4.826852789104965e-01   +1.340349004765067e-01   +6.653744800819500e-01   +2.618218857435240e-01   +8.253260302387051e-01   +1.601182453910637e-01   +7.168244706098342e-01   +9.949438048111845e-01   +9.514900761182625e-02   +7.849777689357958e-01   +5.355475781393593e-01   +2.177616183283378e-01   +4.437285619819659e-01   +8.859478646997186e-01   +7.491409197109660e-01; +2.874268106525700e-01   +2.172250814189141e-02   +6.049894974562338e-01   +4.907462039888391e-01   +9.055649406216364e-02   +6.546075458666644e-01   +5.834613012060369e-01   +1.129013293254558e-01   +9.071400018001269e-01   +5.018988795618211e-01   +6.840865815818410e-01   +9.072581619910919e-01   +4.891776098287118e-01   +8.964905838318941e-01   +9.371896332073047e-02   +4.701985583295532e-01; +3.996750019287092e-01   +1.290480120319172e-01   +8.992692147788409e-01   +9.839750304252260e-01   +2.308507444766588e-01   +2.291876291929103e-01   +5.461605486371170e-01   +7.471122633668285e-01   +1.363666921502482e-02   +5.581979221489026e-01   +8.160862127477225e-01   +2.860912134991954e-01   +4.592317508190557e-02   +7.882692864680243e-01   +6.870342631159786e-01   +2.484454361921797e-01; +4.941018636379443e-01   +7.236713897222203e-01   +5.732307138501224e-01   +8.654425512676573e-01   +8.981184434245022e-01   +3.043049693652747e-01   +6.927847126491190e-01   +9.234030967122215e-01   +8.404744177734909e-01   +5.475895692092382e-02   +4.298474216836882e-01   +1.374322521167100e-01   +5.828941667649205e-01   +5.916896459034369e-01   +1.348559407775606e-02   +6.625635876187946e-01; +8.662158755055944e-01   +6.717664649048911e-01   +6.415885944168851e-01   +9.617938073371577e-01   +1.996538303646846e-01   +3.283022211854141e-01   +7.021118200487153e-01   +9.322073819431631e-01   +2.559331147647045e-01   +8.515077279853318e-02   +4.933648451527147e-01   +9.590061093319406e-01   +4.976651231774918e-01   +6.254864970622575e-01   +1.277055980548045e-01   +6.184526570594577e-01];
L2E_L1E_iAMPA_netcon = [+3.712053284587847e-01   +5.651815314574028e-01   +2.005628129178754e-01   +5.195246870492692e-01   +2.917084117013294e-01   +7.182606242143695e-02   +2.833367308357673e-01   +2.630186335538938e-01; +4.366793233376542e-01   +1.887678301776204e-01   +1.455807719832158e-01   +6.840892173780728e-01   +6.128467231447633e-01   +5.917228344624005e-01   +9.309226979920976e-01   +8.993257772374397e-01; +7.235656813203389e-01   +6.039735403602479e-01   +7.414604283827966e-02   +2.158220849842811e-01   +8.644538124133877e-01   +7.829309587584289e-02   +7.552307767756563e-01   +1.567865596202188e-01; +1.982520530646463e-01   +7.280523627780209e-01   +9.283165549035831e-02   +9.712783289784320e-01   +8.147849757709371e-01   +3.926342048833700e-01   +2.578495665390493e-01   +5.480292105387095e-01; +4.732485086217457e-02   +8.357171584022592e-01   +5.495394237822391e-01   +3.442196903355261e-01   +2.083148617633956e-01   +5.191520306148123e-02   +2.447945197848241e-01   +4.259172065846196e-01; +3.123784438217635e-01   +2.751679624526178e-01   +7.293145780960639e-01   +1.844718961244771e-01   +7.523385628816907e-01   +1.288667425967465e-01   +1.625105354239604e-01   +5.465993532675497e-01; +7.941856922803882e-01   +6.089447901367800e-01   +5.483318526181438e-01   +2.440706392016190e-01   +2.042308782910672e-01   +2.364597497821304e-01   +2.956469709974182e-01   +7.497351705673424e-01; +4.176811458915237e-02   +5.500565121272438e-01   +4.356920054698345e-02   +2.634621023209803e-01   +5.807435895441155e-01   +9.443862466084696e-01   +5.684256434482439e-01   +1.580278707354544e-02; +2.114574481094087e-01   +2.802035974439792e-01   +6.378416201604522e-01   +2.192869064262763e-01   +8.732647833105096e-01   +2.086459792311218e-01   +3.979741716503017e-01   +1.589227566464348e-03; +2.684355814649072e-01   +3.397201914472452e-01   +9.854399529425587e-01   +3.551481829043327e-02   +7.155946402643691e-01   +3.276502265714285e-01   +9.841907744425763e-01   +2.126291973058591e-02; +7.897054710125136e-01   +5.721512977717624e-01   +9.154384280120241e-01   +3.491172232133501e-01   +6.958924668250823e-01   +8.656518705626780e-01   +5.460114106800229e-01   +3.457399539035083e-01; +9.801786346503846e-01   +7.489912245355721e-01   +7.768947011843168e-01   +9.006950512991844e-01   +4.594969746270661e-01   +9.262871935811964e-01   +9.327828325853733e-01   +4.257909986358334e-01; +9.283499185122859e-02   +7.650682389483644e-01   +1.915660557743167e-01   +1.395084544074866e-01   +5.040299635870300e-01   +1.790631504993202e-02   +9.901677359012809e-01   +5.414038932929439e-01; +1.948145578094009e-01   +3.986837879425280e-01   +3.057900506456276e-02   +9.481767684347884e-01   +7.967873343183791e-01   +3.654554106701070e-01   +8.300298549477183e-01   +4.833403062256552e-01; +1.184771806242784e-01   +1.584646740297114e-01   +3.802516459885219e-01   +9.048508743814822e-01   +9.384646557935302e-01   +5.368380090759644e-01   +1.789115273949707e-01   +9.107869568117661e-01; +6.436175094498501e-01   +2.076503133676223e-01   +5.755755950704390e-01   +4.129156148767631e-01   +7.955134318666489e-01   +4.099394165530302e-01   +3.125995409075036e-01   +4.188398164652656e-01];
L1E_L2E_iAMPA_netcon = [+4.968305858644984e-01   +4.598559770577457e-01   +6.154665769909329e-01   +4.946236152112765e-01   +2.361864680010283e-01   +7.178337866242861e-01   +6.846247533562528e-01   +6.344038706551154e-01   +5.216156223045697e-01   +2.430334229029852e-01   +8.754384875963155e-01   +1.735015577364569e-01   +1.377300021199559e-01   +2.413631756635406e-01   +1.846896113721246e-01   +3.235708379915678e-02; +8.397467409276426e-01   +3.688312898521831e-01   +9.976372902432240e-02   +6.600803955369238e-01   +8.369502975367612e-01   +3.781341375313705e-01   +9.775770071772576e-01   +6.232859654479160e-01   +6.713713156536913e-01   +7.312071671721085e-01   +6.608342998425503e-01   +3.013920091073053e-01   +2.884018359342834e-01   +7.435562157510983e-01   +1.544502826173635e-01   +2.511639853578097e-01; +1.843071714985799e-01   +2.936006594843318e-01   +7.571408013817723e-01   +1.764313353315571e-01   +7.313044635132918e-01   +3.797851366035105e-01   +7.546498719791904e-01   +4.086530009800199e-01   +7.769649192218018e-01   +1.230986058028183e-01   +5.456910975034522e-01   +1.050131211950089e-01   +3.528306835250233e-03   +9.327281422903244e-01   +1.348688742642633e-01   +9.880260462528622e-01; +3.413192674504297e-01   +2.388955665160630e-01   +5.408091022730979e-01   +4.782868996977742e-01   +4.895596343318437e-01   +7.114173442520830e-01   +5.507451650152223e-01   +4.326495356491837e-01   +4.634582765745214e-01   +3.615723854411414e-02   +2.450573453767635e-01   +4.577666931722149e-01   +3.078031273988805e-01   +3.813005159901383e-02   +1.641393806957168e-01   +6.363382198704433e-01; +6.919203006983761e-01   +1.375091394335674e-01   +4.461750800915676e-01   +5.046665184541228e-01   +8.490324712047249e-01   +8.324645053325740e-01   +2.253707382792504e-02   +5.103064048838781e-01   +9.078158672983809e-01   +6.462389554835014e-01   +1.096449504713678e-01   +5.875332169404657e-01   +9.091889987734678e-01   +4.262096006365261e-01   +9.224644429341131e-01   +3.546701159241137e-01; +6.863757054213244e-01   +1.006077790033769e-01   +7.413209756759503e-01   +5.996400840215064e-01   +7.204386904300160e-01   +6.697274938190838e-01   +1.940401187449659e-01   +2.614898314391469e-01   +2.322250335786184e-02   +1.955059200255916e-01   +9.698373867661194e-01   +2.149607378196791e-01   +2.939589470510109e-01   +8.210059019250483e-01   +2.633738903795901e-01   +9.984185094731156e-02; +3.677525559362749e-01   +2.360151250866366e-01   +3.888926727737171e-01   +2.443360042061274e-01   +5.171907878667985e-01   +6.502993560479406e-01   +9.442075792374908e-01   +4.227560722313843e-01   +4.886633303806782e-01   +9.781407543337420e-01   +5.880975992036396e-01   +1.078737785827825e-01   +8.233069248882545e-01   +9.983646137577189e-01   +2.034323639868914e-01   +4.160073564751792e-01; +3.224576907722754e-02   +3.508645079241068e-01   +5.315210723197550e-01   +5.214419460586334e-01   +9.400804921263676e-01   +5.606071540475344e-01   +3.943441753598873e-01   +5.135600822991120e-01   +2.688241418316273e-01   +8.288816196368438e-01   +8.184420751914590e-01   +5.602667688440759e-01   +7.347863312421854e-01   +9.194376479484395e-01   +6.219620551955175e-01   +9.293661472353569e-01];
L2I_L2E_iAMPA_netcon = [+6.780019050071252e-01   +6.189720060909697e-01   +4.049239797231239e-02   +7.995113429658158e-01   +5.156966931766364e-01   +8.246198299258906e-01   +6.500958434139494e-01   +3.867475127733662e-01; +2.081498195327508e-02   +9.459817668019120e-01   +5.485323024532001e-02   +9.405968992481805e-01   +6.605002753746157e-02   +1.078565277238294e-01   +3.319209707961397e-02   +1.712803102827851e-01; +7.278329813384558e-01   +9.613711318500990e-01   +4.090093198468915e-01   +9.432440905098119e-01   +2.909241541233831e-01   +2.468877264246385e-02   +5.621296666794999e-01   +4.452203788172447e-01; +2.170800339310428e-01   +3.666556023986676e-01   +9.802866186397001e-01   +1.428256113333272e-01   +7.132184509029835e-01   +7.207661981546902e-03   +3.084447712675402e-01   +8.738353341146173e-01; +8.503517868842044e-01   +7.953831538778626e-01   +7.095611336945300e-01   +3.261556934938099e-01   +8.839364319235881e-01   +3.368389977172837e-01   +2.629365368503467e-01   +4.047281715578399e-01; +1.567455293700565e-01   +7.214760726288658e-01   +9.950291051728986e-01   +4.224195400123262e-01   +3.690171750804660e-01   +6.627667004097463e-01   +7.205499614837388e-01   +1.690907775372384e-01; +6.692050043751792e-01   +9.482267419296903e-01   +6.524865923030601e-01   +7.089124759844064e-01   +5.597577847591949e-01   +5.932646875800355e-01   +3.059227827823827e-01   +6.629935473491614e-01; +9.299757147719476e-01   +1.307932448798859e-02   +5.033159812030132e-01   +6.171826794862569e-01   +8.788952266483088e-01   +8.073566166434785e-02   +9.025674696920660e-01   +9.273287702703742e-01];
L2E_L2I_iGABA_netcon = [+6.718587094268616e-02   +5.218852807148407e-01   +3.422720003167714e-01   +2.581522408099279e-01   +4.308502415586040e-02   +9.033850675071894e-01   +3.420791262487857e-01   +4.570304603100175e-01; +3.564076126205422e-01   +6.240594042578629e-02   +5.538340388037672e-01   +9.823136685034086e-01   +3.640056928820063e-01   +5.577374293785036e-01   +9.403376710823428e-01   +6.703714635752361e-01; +9.275594227493813e-01   +1.772458332655377e-01   +6.845101340661464e-01   +3.491780119932728e-01   +4.047590924765375e-02   +7.090050119336933e-01   +9.070009453233975e-01   +7.668804046335647e-01; +2.411142485002549e-01   +3.159216638039665e-01   +8.718154815493176e-04   +3.926132777712506e-01   +4.901063528601294e-01   +7.141168412042712e-01   +7.302001843416679e-01   +9.269757677283880e-01; +1.139969842994654e-01   +2.424877787304788e-01   +5.077785132266079e-02   +7.511228389283896e-01   +7.300534694254613e-01   +1.747193124193349e-01   +4.445272453954104e-01   +6.499003615014128e-01; +7.107955806573226e-01   +3.207396873484230e-01   +3.082591869794535e-01   +1.066399659675451e-01   +1.429380301040265e-02   +3.515919954432485e-01   +1.475357708436984e-01   +5.012490197233480e-01; +3.671610468537044e-03   +8.713442791203967e-01   +8.760434273203107e-01   +5.980547022564636e-01   +5.050029068244384e-01   +3.669642421968208e-01   +8.289362236144031e-01   +3.414775120094957e-01; +1.755811691989986e-01   +2.995534842380667e-01   +6.288221257656587e-01   +1.261220626167416e-01   +2.538666284696085e-01   +7.613666782249031e-01   +2.508603434214333e-01   +9.432696276303062e-01];
L3E_L2E_iAMPA_netcon = [+7.361951985436839e-02   +1.765694237587100e-02   +3.686764360149583e-01   +4.950920293885666e-01   +1.779510123900212e-02   +9.631176961108133e-01   +3.608797243188615e-01   +1.842714161798968e-02   +2.047629416622863e-01   +6.549463387898113e-02   +2.435970541237525e-01   +9.976307663851501e-01; +9.512192404672445e-01   +9.827751454531666e-01   +1.229486798056265e-01   +6.567991580951738e-02   +8.078894083873548e-01   +3.821885704655350e-01   +2.309288823821797e-01   +1.249541144524880e-01   +3.536312559714916e-01   +7.531640944026314e-01   +5.390947194533081e-01   +3.388215982219411e-01; +6.673668704856784e-01   +7.265324524032599e-01   +5.074867754173531e-01   +8.735182907409726e-01   +7.961677216894538e-01   +6.606781772594010e-01   +7.224773248659381e-01   +6.676088268972779e-01   +8.942941378575531e-01   +9.982990828729310e-01   +3.340762305891040e-01   +8.307726060454987e-01; +1.716044795923354e-01   +8.790846342885730e-01   +8.871180273504222e-03   +9.973501330973578e-01   +4.122500844299647e-01   +5.850450079481890e-01   +7.775603607049708e-01   +5.111467194018194e-01   +8.192893080770706e-01   +7.696042822187427e-01   +6.700451098840609e-01   +1.147300421115143e-01; +2.011783788565170e-01   +8.124630247061781e-01   +8.707946233163026e-01   +1.226586247348607e-01   +6.381380617920055e-01   +4.588440480704260e-02   +3.363791642642519e-01   +7.623411888326935e-02   +3.129641022128645e-01   +8.932452419879938e-01   +8.755772649196242e-01   +7.825916833235157e-01; +9.887565851042506e-01   +3.664550635734558e-02   +9.097164214776720e-01   +1.038069773846925e-01   +5.652288018398199e-01   +7.701388788788985e-02   +5.706625218610246e-01   +5.365351741411011e-01   +5.967873875415798e-01   +3.928066375458457e-02   +9.755050828396016e-01   +1.583767639133473e-01; +9.358986265727861e-01   +9.454739474317449e-02   +1.105275375792046e-01   +1.462906341168867e-01   +9.110817878117929e-01   +2.295337432614366e-01   +6.359305566707631e-01   +6.856149398296142e-01   +7.005629019210854e-01   +7.978309147133125e-01   +1.313983040277126e-01   +7.295099580851745e-01; +9.846575358923760e-01   +9.486330961328657e-02   +4.349376302212215e-02   +1.326096427835789e-01   +7.507578580647998e-01   +4.170870015543471e-01   +3.618201523670093e-01   +5.870484515111583e-01   +1.771210110720378e-01   +7.162472224527677e-01   +8.834264003276338e-01   +1.189724776400370e-01];
L3I_L2I_iGABA_netcon = [+7.699124402763869e-01   +5.410633675817962e-01   +5.978577782734633e-01   +3.104545788703859e-01   +9.612217522805105e-01   +1.126909557751201e-01   +2.942825000142905e-01   +7.909270169363491e-01   +9.164334216300761e-01   +9.913781042705061e-01   +3.083407153109394e-01   +9.960063899216960e-01; +6.384231100718848e-01   +4.522084843907811e-01   +5.622225485269153e-01   +7.596546705995278e-01   +5.467079881104671e-01   +6.610378506594036e-02   +1.637441545177133e-01   +4.858118925933402e-02   +3.889634812611633e-01   +2.910658976975457e-01   +4.436326360739328e-01   +9.193140852277542e-01; +8.035497479091984e-01   +1.161799711199577e-01   +7.024109165972062e-02   +6.532590118950307e-01   +9.768871604875418e-01   +4.738468385701844e-02   +7.247995086963179e-01   +1.855786657888944e-01   +7.522254431506583e-01   +5.230546092617999e-01   +2.052608328255353e-01   +6.910537938543890e-01; +9.643947071003343e-01   +7.183684691145773e-01   +7.615515150031208e-01   +3.306555002342548e-01   +1.218398208863930e-01   +1.261684057445205e-01   +2.958827663728306e-01   +2.489380238062433e-01   +8.759483009738978e-01   +3.636447802879192e-01   +9.406518443975376e-01   +2.184246415018520e-01; +7.111921515525665e-01   +1.883598845737793e-01   +8.706576473936363e-01   +9.804453041949339e-01   +1.562278916826957e-01   +4.905127082051995e-01   +6.740672771273065e-01   +2.571392641232966e-01   +3.998114019002774e-01   +5.244323463866032e-01   +2.889959800538570e-01   +3.129622142860757e-01; +6.485711761696314e-01   +3.229883263372641e-01   +6.990290287100409e-01   +5.321876697459236e-01   +3.371170354674344e-01   +4.686752304983117e-01   +7.566812841532450e-01   +6.509997547481270e-01   +1.700817219303010e-01   +4.956439639439540e-01   +1.122041614876422e-01   +2.287029696235734e-01; +5.200859420383657e-01   +9.704181240288515e-01   +1.164585766269139e-01   +7.540279667760036e-01   +5.260713032809657e-01   +1.576899805164182e-01   +7.468453403286386e-01   +1.014571671624019e-01   +4.428487580216707e-01   +1.840303358705288e-01   +6.527013784356167e-02   +7.038229949591006e-01; +9.513399017223186e-01   +6.924521077357871e-01   +6.598054255337343e-01   +2.632117532854523e-01   +6.893522517274313e-01   +1.289646808918752e-01   +7.780851213976120e-01   +4.732722045460215e-01   +8.528064229180680e-01   +4.901020246542649e-01   +7.267193377801401e-01   +3.731722545103068e-01];
L2E_L3E_iAMPA_netcon = [+6.533439468877847e-01   +3.788561039189229e-01   +2.359300552015713e-01   +4.690904236692672e-01   +9.116716682107208e-01   +9.525249893822864e-01   +7.644018744233513e-01   +3.550984168273595e-01; +3.755959082019608e-01   +2.813242619781905e-02   +9.111192015761121e-01   +2.890733225213891e-01   +6.829766022524247e-01   +2.127778717676589e-02   +8.938829816689392e-01   +6.627576823983039e-01; +3.024896337645183e-01   +3.260149968061118e-01   +4.888654450279464e-01   +2.710996312561766e-01   +8.427034031328592e-01   +5.050493277171830e-01   +7.891434772301215e-01   +5.942107402655543e-01; +1.584272739166981e-01   +4.992638284004013e-01   +5.892404024503299e-01   +1.464450581992902e-01   +9.320671987144553e-02   +3.335312631535667e-01   +9.401536741589704e-01   +5.494020366621991e-02; +7.790855533901354e-01   +2.716854336499640e-01   +9.530128226550685e-01   +1.414965729813547e-01   +7.354033862336995e-01   +6.671125241517060e-01   +5.344645053024655e-01   +2.095244474163602e-01; +7.122760018768429e-01   +5.342468418895103e-01   +8.225774768748166e-02   +2.633341766059084e-01   +5.522235420284261e-01   +1.609906612583895e-01   +1.556724806883955e-01   +5.943589755199983e-01; +1.806080674223299e-01   +4.186814661241455e-01   +2.197314980743446e-01   +6.033993956759809e-01   +2.477879043093939e-01   +2.194232313057518e-01   +1.337014182135573e-01   +2.672821726738084e-01; +4.490349987762999e-01   +5.416911191184182e-03   +1.581900743678455e-01   +1.050782082015786e-01   +7.224013969592852e-01   +1.111188142279592e-01   +2.570134394614802e-02   +1.190181574778266e-01; +8.393200480877033e-01   +8.968712271664717e-01   +3.862925769646419e-01   +4.923967071064264e-01   +3.655466055217507e-01   +9.934545564121460e-01   +6.846890690022910e-01   +2.141757193802141e-01; +7.005607878275243e-01   +2.386218628540818e-01   +1.865268915257780e-01   +8.944207149178848e-01   +8.484885567857006e-01   +1.467148443992740e-01   +5.808135689294986e-01   +8.753409317451772e-01; +7.620840108561046e-01   +8.062119711318401e-01   +7.611014391889090e-01   +1.830095076084545e-01   +8.284448346697864e-01   +7.676679942749309e-01   +2.964006324529950e-01   +4.637061333658059e-01; +9.771424702471018e-01   +5.815703727149171e-01   +2.336842776223629e-01   +5.255148370067048e-02   +6.187159475007683e-01   +6.270673733683735e-01   +7.115672456202342e-02   +7.309133390279694e-01];
L2I_L3I_iGABA_netcon = [+5.888375749186144e-01   +1.435479593999755e-01   +3.460120509711633e-01   +3.717102062526887e-01   +5.973687664725025e-01   +5.123483908495964e-01   +7.743174250929902e-01   +2.614480058313269e-01; +8.385969129516067e-01   +9.902786498255440e-01   +4.631167170532598e-02   +5.388367342989940e-01   +4.774538595135199e-01   +2.393674689004086e-01   +1.811266680773947e-01   +5.945791840773735e-01; +6.047468840999222e-01   +4.820031659070056e-01   +9.505404003534540e-01   +9.753238293322657e-01   +3.792153920020546e-01   +2.661664565658260e-01   +4.507393790513237e-01   +6.832444549115058e-01; +7.465424417774962e-01   +4.311908297326817e-02   +8.602262356147687e-01   +9.992775096604720e-01   +9.824851904411563e-01   +4.130860968448700e-01   +3.048685223505994e-01   +4.193225098150966e-01; +8.538147060199031e-01   +2.733380688446635e-01   +1.403538458028114e-01   +4.058599291192789e-01   +1.348068732047638e-01   +2.681213577071025e-01   +3.816287854751603e-01   +5.182673733172395e-01; +1.431081287825054e-01   +6.715480394167840e-01   +5.787978536347504e-01   +4.506944409391905e-01   +2.702050932464702e-01   +8.539019064728401e-01   +7.952435550587161e-01   +8.176683178444030e-01; +7.327429022853911e-01   +1.397163224893942e-01   +6.311747443622283e-02   +2.436802861148288e-01   +2.267429193530773e-01   +4.843480050017263e-01   +7.832736778835375e-01   +5.420251174837265e-01; +1.683376218368567e-02   +7.749383199867416e-01   +9.505983392802748e-01   +5.951706853995862e-01   +7.930415043249454e-01   +3.309892279887617e-01   +6.448386507036193e-01   +5.915461335800248e-01; +2.337206799428233e-01   +2.658872863048274e-01   +4.977607538853214e-01   +7.646765439969856e-02   +8.204482370798550e-01   +6.344482427911342e-01   +2.414383342789795e-01   +5.398856497814661e-01; +5.374155849387131e-01   +8.785495138181304e-01   +2.691625864366163e-02   +9.092246327528068e-01   +8.023061567266118e-01   +4.201165252705765e-01   +6.025746059403218e-01   +5.473484831488348e-01; +7.077720597863318e-01   +3.652636019456322e-01   +5.107592759745776e-02   +4.730672877417485e-01   +1.195196381338493e-01   +5.434489187602864e-01   +4.185408324035265e-01   +1.545325556248700e-01; +4.364616415099695e-01   +1.775783583377335e-02   +3.093721832830907e-01   +5.009919565601649e-01   +6.430863894059373e-01   +3.375637896363233e-01   +3.024791056376798e-01   +7.019190305478404e-01];
L3I_L3E_iAMPA_netcon = [+6.189392264482640e-02   +7.770788252838380e-01   +5.610054803541182e-01   +5.667230470440163e-01   +9.152398432073141e-01   +8.334813071413326e-01   +8.527558444343321e-01   +8.684313381486644e-01   +5.309471695405446e-01   +9.896925230037812e-01   +4.824784571316282e-01   +3.513142804826126e-01; +9.216004316214690e-01   +8.331821060219937e-01   +8.501814790908403e-01   +9.359895012547457e-01   +5.925248625826613e-01   +4.008570130311034e-01   +6.281844408276194e-01   +8.605196371085636e-01   +5.744424914130299e-01   +7.028031555939415e-01   +7.407652449967291e-01   +3.972636858861260e-01; +1.825657174114637e-01   +5.973130225261535e-01   +9.734697016402485e-01   +7.751029841437836e-01   +5.798804867299867e-01   +6.653288951921686e-02   +4.408516140529949e-01   +9.478329821646936e-01   +9.774898805435734e-01   +8.404117274285762e-01   +5.923506138736564e-01   +9.982161252091116e-01; +5.375640937279429e-01   +7.609698933239706e-01   +4.714004251969020e-01   +6.031707323895508e-01   +6.539556650523554e-01   +3.792667581325568e-01   +2.295312377268556e-01   +6.967670960052575e-01   +9.589466567629497e-01   +7.290302687028266e-01   +2.537232103894609e-01   +2.858769274523378e-01; +3.965431950509636e-01   +6.596806557215930e-01   +7.735099630590070e-01   +6.426049092163977e-02   +4.320657296024883e-01   +8.603672732868333e-01   +4.971002994714555e-02   +3.633935271565010e-01   +5.595394415195341e-01   +9.988409222337411e-01   +6.159663167489162e-01   +2.339829407545800e-01; +9.205227547285347e-03   +5.885147510266030e-01   +2.295449037127085e-02   +5.321236046942309e-01   +9.396995123510499e-01   +2.816158041266500e-02   +7.042026684294322e-01   +3.831698515971282e-01   +5.223364531765420e-01   +5.086145928420629e-01   +2.271115094392875e-01   +3.346426355873059e-01; +1.096361993745597e-01   +2.173261250960083e-02   +6.732910721610437e-01   +8.589135735654366e-01   +1.044949214209198e-01   +4.252605480075876e-01   +8.527049704850328e-01   +8.514568127190585e-01   +4.752278796126855e-01   +1.996238663692416e-01   +1.902065176244660e-01   +1.637546463215791e-01; +8.554947829567828e-01   +6.887666382772631e-01   +8.351818000390819e-01   +3.412603889220670e-01   +4.110515083006048e-01   +2.470496952414321e-01   +3.980644022778969e-01   +3.825379674446997e-01   +9.007805358716898e-01   +9.531549729973220e-01   +4.453807734851091e-03   +3.876102852979081e-01; +3.338320277856213e-01   +3.289696137937904e-01   +6.919471515274367e-01   +1.838377926349911e-01   +8.962346302191595e-01   +6.735819677218663e-02   +2.940317075938327e-01   +7.682277239139627e-01   +4.815737927908778e-01   +4.495519949172712e-01   +6.488399887629080e-01   +5.275294371538403e-01; +1.410450377218708e-01   +8.993491740689859e-02   +9.000983824993191e-01   +8.828094612810260e-01   +7.348448355284539e-01   +9.193584464012047e-01   +2.539853580083125e-01   +7.817100359410539e-01   +4.944991104781785e-01   +5.997586476002177e-01   +4.018850348742814e-01   +5.916329804338826e-01; +7.958752481067646e-01   +7.451985305120141e-01   +9.145490060056601e-02   +8.437643701323910e-01   +9.627442727047901e-01   +2.683586353033088e-01   +5.100280844722097e-01   +4.250093234098581e-01   +3.102620202195707e-01   +6.437236050009181e-01   +2.685196291667029e-01   +1.706595562146697e-01; +6.550954114935791e-01   +9.733253901058818e-01   +7.837150541337973e-02   +8.288465167110156e-01   +9.759555820593049e-01   +1.045061120405679e-01   +1.160607994054578e-01   +4.895540131568055e-01   +8.549964053444090e-01   +7.523174582458607e-01   +4.898715134145459e-03   +6.339368471902032e-02];
L3E_L3I_iGABA_netcon = [+4.426563037354412e-01   +6.375912345791639e-02   +7.930399478084415e-03   +5.042607387160433e-01   +5.387454332889537e-01   +2.505552633443747e-01   +7.208823057905860e-01   +7.592740121438475e-01   +3.806770557682693e-01   +4.476412718949763e-01   +2.043795806701448e-01   +6.550046222114334e-01; +5.404976920647963e-02   +8.071380638621477e-01   +1.320381422039845e-01   +1.915237967379524e-01   +2.218003257099701e-01   +3.368590908453724e-01   +2.187209545287969e-01   +8.863454003585706e-01   +6.069366462252105e-01   +3.924068171980370e-01   +8.294915607046784e-01   +8.997259118280352e-01; +6.313140119200111e-01   +9.141138252995517e-01   +3.077421687462764e-01   +6.444368959894361e-01   +2.650136653284558e-01   +5.961793593797824e-01   +4.924245595389803e-01   +7.293220107973125e-01   +1.605719442680085e-01   +6.784575691696262e-01   +4.427883588718787e-01   +8.382398311896762e-01; +8.060884902150842e-01   +4.211331177495146e-01   +2.332526642674967e-01   +2.530581659068901e-01   +1.341521130288373e-01   +4.768203382294255e-01   +4.758910999414993e-01   +6.842326589960205e-01   +1.012946110820627e-01   +3.428246042580820e-02   +4.615489527283177e-02   +1.631678700261593e-01; +4.005232364247630e-01   +1.905319937687511e-01   +6.553678118005771e-01   +9.433332352939640e-01   +9.950428650264286e-03   +9.020088877800078e-01   +4.352553418054206e-01   +6.558764457220649e-01   +6.188771693806019e-01   +7.831807224289496e-01   +7.635791168720605e-01   +1.605301812400569e-01; +8.878173206444819e-01   +1.837935614178337e-01   +8.033891391900547e-01   +2.960745564070777e-01   +1.571155948083479e-02   +2.845070693978973e-01   +5.600005571069326e-01   +6.213622034431132e-01   +9.616002456242716e-01   +3.740196299714794e-01   +9.278049602045409e-02   +1.352245515852456e-01; +7.171448259936910e-01   +6.721268819908631e-01   +7.371613245433621e-01   +1.464533903580957e-01   +9.866447161048514e-01   +8.064227088514005e-02   +2.052597985760129e-01   +7.419842771366142e-02   +6.716528131100107e-01   +6.393951004735821e-01   +6.598923699031568e-01   +1.525151725018086e-01; +2.065505202196893e-01   +5.205218856395785e-01   +1.184470600184050e-01   +8.651265543427723e-01   +6.528055922970334e-01   +3.833216260551060e-01   +2.790709518481063e-01   +5.503792135552936e-01   +4.776428976273054e-01   +4.955754126255182e-01   +2.614220193286910e-01   +3.970636507578567e-01; +3.760853932044475e-01   +7.814255078650968e-01   +1.693837984017583e-01   +8.831363015236808e-01   +8.064757587442720e-01   +1.860025166717684e-01   +8.047228356403671e-01   +8.764167280574829e-01   +3.354761859464552e-01   +2.275853053745088e-01   +4.426594371341655e-01   +6.626449045257998e-01; +2.107067317153949e-01   +3.008609342921306e-01   +2.650392704101207e-01   +6.603577548016565e-01   +2.790571743482242e-01   +7.292578668938094e-01   +1.038063013379235e-01   +9.798488176592164e-01   +5.890433220364057e-01   +2.143608792570890e-01   +8.479652459143732e-01   +2.216368938444102e-01; +2.603739655931119e-01   +4.686489838050608e-01   +8.184019486974613e-01   +9.992617099023224e-01   +1.984834781870611e-02   +4.308408608938510e-01   +3.430146317519773e-02   +6.369708248553102e-02   +5.477921836505160e-01   +4.509588340709552e-01   +9.060553156266373e-01   +6.397851608911735e-01; +9.933649740618170e-01   +7.083099867859453e-01   +5.860562225095030e-01   +2.564396759152013e-01   +1.006034953196364e-01   +2.624902585645240e-01   +7.572057186951378e-02   +2.998799035996290e-02   +3.752162279580500e-02   +6.312232266897464e-01   +2.806207567231218e-01   +6.109620729895494e-01];
L2E_Input1_iAMPA_netcon = [+9.997061489925612e-01   +9.991959364576566e-01   +9.995099014867059e-01   +9.998852813599574e-01   +9.993261303890495e-01   +9.999595089920701e-01   +9.997060597044577e-01   +9.993824928983501e-01];
L2I_Input2_iAMPA_netcon = [+9.993295020696868e-01   +9.999446732849782e-01   +9.998966712590366e-01   +9.995859677971318e-01   +9.996909495953623e-01   +9.994380135546553e-01   +1.000000000000000e+00   +9.999249699179608e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
