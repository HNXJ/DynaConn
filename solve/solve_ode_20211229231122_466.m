function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.831454306970690e-02   +3.359578312747669e-02   +9.606944778885146e-02   +1.652657171173782e-01   -4.387021106342050e-02   -3.281418690778459e-02   +1.565628051565063e-01   +1.787787045720681e-01   +3.089626233267123e-02   -6.800571532425886e-03   +1.526755356503773e-01   +1.387176991140065e-02   +6.781237160997386e-02   -2.326059884288478e-02   +2.868171392052046e-03   +1.260369063859004e-03; +2.450188653113009e-02   +8.215379324186146e-02   +1.174444427309164e-01   +1.082653967869767e-01   -2.697256484681085e-02   +2.695273453940763e-02   +1.970705892599532e-01   +1.003805121483056e-01   +8.151504764899048e-02   +1.880941755881069e-01   -1.036737286489049e-01   +5.263876286346771e-02   -1.505320650427885e-01   +1.315130027055161e-02   -6.695569835834897e-02   +1.536847814535225e-01; +2.336371744920204e-01   -1.637969209808909e-01   +2.194954001114434e-02   +1.475090477328390e-01   +2.290669200181444e-01   +1.797823931304506e-01   +6.795213408034201e-02   +2.669746215039155e-01   -4.788559447988069e-02   +6.723950731153430e-02   +1.212820815665469e-01   +4.902594093390336e-02   +3.721216266503971e-02   -1.792974778287845e-01   +5.769246180512508e-02   +1.701238098762800e-01; +1.222964775038008e-01   +2.210579841101938e-01   -3.706965212710965e-02   +6.090436232152620e-02   +1.899453605108765e-01   +3.243580576521431e-02   +5.023683019192374e-02   +4.101335487352931e-02   +2.353098323495784e-02   +5.169786245275165e-02   +9.881812196805453e-02   +8.064749926956098e-03   -1.504757671229896e-01   +2.613622810087012e-02   -2.259914031910208e-02   +1.549675514764431e-01; +6.933580257232846e-02   +2.107126167060323e-01   +3.025625539633869e-03   +2.148756342128259e-01   -1.749205001482543e-01   -1.085090795880753e-02   -6.068530260944581e-03   +1.603868136044741e-02   -1.382179359063619e-01   +2.676347923951304e-01   -3.215682940777673e-02   +1.952399811429481e-02   +2.533704028414475e-01   +2.676179858851114e-01   +7.066156405843635e-02   +6.142499736517715e-02; +1.805768347532462e-01   +5.212074082907381e-02   -1.016627759815446e-01   +1.311772308096856e-01   -3.728433615315295e-02   +2.842248811585260e-02   -5.735164032432381e-02   +1.128004422144688e-01   +1.988997589473393e-01   +1.235885103884955e-01   +2.191748394917636e-02   -1.456313473565788e-01   -9.743941420347343e-02   +2.199462463859052e-02   +2.452625317004952e-01   +6.853151778290804e-02; +2.287981143950350e-01   -2.193198105487267e-01   -1.139111955362941e-01   +1.736222807058315e-01   -1.272505084364502e-01   +1.100068066531366e-01   +5.675614891928956e-02   +4.083453288574668e-02   -5.810096372349870e-02   -3.787737628601174e-03   -1.249028136656094e-01   +2.196405464069138e-01   -1.432998458606315e-02   +1.531716788540768e-01   +6.090976289475224e-02   -7.255498483940170e-02; +1.867958106232729e-01   +1.307806036876161e-01   +1.501300724012120e-01   +1.510856559477053e-01   +1.819129205428472e-01   +8.702796569441328e-02   +1.204207127793611e-01   -2.930722257992209e-02   -9.961972635978453e-02   +5.041464333850433e-02   +6.642079170048804e-02   +3.272207896978560e-03   +9.897591612897375e-02   +1.489448388774726e-02   +1.570122033357438e-01   +1.271024935573964e-01; +4.038246065081975e-02   +3.358588066736052e-01   -1.096956334278281e-01   +3.539210380268762e-03   -1.397650371703493e-01   +6.861681298234756e-02   +6.905285483135451e-02   +2.823838694579106e-01   -6.399626874519510e-02   +1.500614710901529e-01   +5.913222849263432e-02   +1.703994652261676e-02   +7.285535655612694e-03   +1.112980057414033e-01   +4.457508791017656e-02   -1.318520531983531e-02; -9.222241397902199e-02   +2.069963802714389e-01   -2.849138628294779e-02   -6.650217359659963e-02   -2.887675186658746e-02   -5.255333929448443e-02   +6.091195294876538e-02   +1.142395936935105e-01   +9.727106216144824e-02   +2.122898879893088e-01   +1.580478108538678e-01   +1.604449165764574e-01   +8.752045551347776e-02   +1.623839100469101e-01   -6.108990767561082e-02   +1.503338325574150e-01; +2.334919234160440e-01   +2.208670873812749e-02   +1.174030420384832e-01   +9.489093455484574e-02   +2.170616693353509e-01   +1.843969588423838e-01   +1.512419267898828e-02   +1.225151474689739e-01   -9.322755441176755e-02   +1.736552635777208e-01   -1.900767302641335e-02   -1.504540781018661e-01   +1.808358018096321e-01   -1.182305313696877e-02   +1.295089135197650e-01   +1.853804886061849e-01; -3.693770581496327e-02   +6.815289491349422e-02   +1.061807822152814e-01   +1.605825909461897e-01   +2.118212822644092e-01   +1.638159096938728e-01   -2.278528260040005e-01   +2.335708750004375e-01   -3.146197824575510e-02   -1.069471218267561e-01   -1.621177564878148e-02   +5.912907582470706e-03   +2.065647293612756e-01   +3.335694477823649e-03   -5.700843759841735e-03   -7.583718700697592e-02; -1.536559231003087e-02   +1.645387050201894e-01   -3.339215343134714e-02   -5.415390861942026e-02   -2.023682591094488e-01   +1.340369696062994e-01   -1.228102518152685e-01   +1.720041532191775e-01   +1.816052811205155e-01   +8.029409730233592e-02   -6.430206039104983e-02   -2.367819679577172e-01   +6.289700887102050e-02   +8.763705443496730e-02   -1.504302124205649e-01   +7.183519919339008e-02; +8.197449016199357e-02   +2.032979541087163e-01   -9.801717293947980e-02   +8.579990994051787e-02   +1.213042670316629e-01   -8.798130755057304e-03   +7.095602111204859e-02   -2.989448193762220e-02   -4.537571000532384e-02   -1.216993942686576e-01   +2.923995664179306e-02   +2.714799194468425e-01   +2.684934003501143e-01   +3.541257679155668e-03   +1.133955499287959e-02   -4.312249563367972e-03; +9.636451979215216e-02   -2.050232244275386e-02   +7.681177036237961e-03   +2.530914773447029e-01   +1.062413377068432e-01   +1.905616273443244e-01   +2.995438102503795e-02   +1.082751756690012e-01   -5.926381819039854e-02   +2.018793184968827e-01   +1.219768424087146e-01   +1.312634573515788e-01   +9.234335054291207e-02   +2.006522430819915e-01   -8.721511060756727e-02   +2.318643911391215e-01; -1.752780606951131e-01   +2.339756724527940e-01   -2.269612670879356e-02   -1.667353151679002e-01   +3.929929215894107e-04   +1.373579351233126e-01   +1.620445354516445e-01   +1.563793147668126e-01   -1.677602970393320e-02   +1.803028550704667e-01   +2.176917205644497e-01   +1.822212867454531e-01   -9.611964798683553e-02   -2.560777575537070e-02   -2.769446237813828e-02   +2.301636915566148e-01];
L1E_L1I_iGABA_netcon = [-1.531087615854230e-02   -1.207354124098504e-02   +3.903276519463867e-02   -3.097810851737862e-02   -1.135414534364211e-01   +8.290673529034719e-02   +2.391908577846853e-01   -1.840014682108541e-01   +8.532293733411879e-02   -4.080244335155411e-02   -9.730947181043205e-02   +5.595917516693014e-02   -1.043703115081248e-01   +2.447531672215728e-01   +1.328231727378541e-01   +1.378953309771684e-01; +3.714273471527789e-02   +1.613859453845659e-01   -9.020318041572041e-02   +6.280986033768847e-02   -6.361076506674500e-02   +8.940502947074461e-02   -9.034782689298944e-03   -1.297876871097857e-01   +2.416690259962614e-02   -3.868974450256844e-02   +1.965630581562094e-01   +1.107951805669771e-02   -2.778169143541665e-02   -8.970672622803916e-02   -5.982064419653234e-02   -7.477940843659267e-02; +1.473821344456281e-01   +1.908999296160189e-01   -3.538955759308522e-03   -1.746751397991410e-01   +2.402914219467024e-02   +1.483237950070790e-01   +1.069747846706537e-01   -6.854026289593845e-02   -1.449745869418198e-01   +4.431307051116251e-02   +1.936602738472391e-01   -5.723806317791844e-02   +2.948065966976009e-01   -9.624403662900376e-02   +1.432153673070467e-01   +1.211110982798144e-02; +2.296883981990207e-01   +2.559379019923147e-01   +2.200554172750287e-01   +3.105598140776159e-01   -7.228270241207702e-04   +2.444871507829494e-02   +4.103309817853984e-02   +6.483171396792126e-02   +2.547380702478305e-02   +1.579539845110331e-02   +1.281572414476518e-01   +1.522790278187006e-01   -4.917818404876046e-02   -9.584412218633077e-02   -4.853124101089107e-02   +1.289375279317313e-02; -2.627576907165803e-01   +3.630050935161241e-02   +9.923457206943097e-02   +1.553311242847014e-01   -9.240051011482951e-02   +1.291647760081786e-01   +3.046199384108576e-01   +1.703384762698418e-01   -1.683729693358522e-01   +2.214812754124867e-01   +1.405811371282399e-01   +6.805233513902929e-02   -1.041623621618108e-01   +9.239272254013120e-02   +9.205287722708632e-03   -3.240677877273125e-02; -4.023871517261735e-02   +2.520718916837212e-01   -4.802740371942758e-02   -7.059584049312917e-02   -5.528816202506213e-02   +1.321039690897164e-01   -4.402899260906591e-02   -1.453897750377135e-01   +2.060360275683231e-01   +1.836082403066256e-01   -6.325485022745897e-02   +1.741520741263207e-01   -2.878698024708417e-02   +1.398986130013017e-01   +9.368656697318972e-02   +1.231264252103124e-01; +1.814272972468411e-01   +8.494673846611192e-02   +4.704107921701089e-03   -7.279743728285440e-02   +9.507606882542216e-02   +4.619474328491152e-02   -1.967237557202167e-04   +1.415038703427883e-01   -1.569467400662629e-01   +7.281711330336088e-02   +3.239849849669945e-03   +1.563272539907236e-01   +1.337516480730629e-01   -4.309704530070919e-02   +9.714880344716759e-02   +2.824158120407714e-01; +2.912378707716554e-02   -9.801470500158840e-02   +1.245062118630683e-01   +1.360819814892512e-01   +2.453750501922635e-01   +5.027445661959670e-02   +2.131495772655393e-01   +2.012317551335069e-01   +1.201043505267560e-01   -5.527802747577269e-02   +6.039431359644682e-02   +1.148285728944727e-01   +4.887101099908801e-02   +5.752287524774221e-02   -2.000022076430966e-01   +2.786813941080244e-01; +4.746768562385215e-02   +3.936914754907815e-02   +9.278744327388067e-03   +2.518968996836430e-02   -7.052019762144986e-02   +4.543285013600037e-02   +2.781945404891343e-01   +2.054392360411071e-01   +6.405171430739932e-02   +1.645885186217919e-01   -2.722026893472976e-02   +5.996992101182270e-02   +7.047004372465651e-02   +1.436016686523082e-01   +5.933589035407236e-04   -4.247848654934143e-02; -1.580192225735656e-02   +1.003526932428115e-01   +1.078623942487820e-01   +2.294925493858367e-01   -1.476458841705273e-02   +1.150676198585756e-01   +4.936584610764752e-02   -1.255424637064499e-02   -6.953628102346952e-02   +1.312559368169154e-03   +5.633896363805656e-02   -8.208342981103924e-02   +1.736927150862793e-01   +5.515579818719631e-02   +1.108663846508307e-01   -2.598500218267387e-02; +5.510202751390932e-02   +1.894448847003818e-01   -1.505865776716195e-01   +6.397758133472028e-02   -1.159879499956181e-01   +8.362982049749852e-02   -3.031956036301554e-02   +1.762709104507999e-01   +3.059763110576090e-02   -5.423105058452766e-02   +8.131776080740701e-02   -2.595536837614510e-02   +1.594096174082809e-01   +5.949484501346966e-02   +6.210035709529090e-02   -1.428030149349718e-02; -1.140899354983884e-01   +2.336285014484862e-01   +7.818533523817850e-02   +1.264727902961321e-01   +1.203449957612284e-01   +1.469847755680477e-01   -2.673278968597764e-02   +1.067530872775618e-01   +1.443633059081221e-01   -1.103166184892436e-01   +1.899619112280616e-01   -3.095808172323494e-03   -1.455535113758833e-01   -1.878698952336803e-02   +9.292677765241050e-02   -9.997227461518270e-02; +9.093186117458239e-02   +1.812012533710472e-01   +6.552316464204251e-02   +8.766447428561565e-02   -6.192906862245987e-02   +1.699150681181197e-01   +1.672145648570098e-01   +9.139474943835640e-02   -8.303144677081636e-02   +3.158393451984470e-02   +1.524734011363146e-01   +2.927862375567367e-01   +1.256833283499584e-01   +1.719411366329469e-01   +1.659830051317023e-01   -1.717182435819419e-01; +1.082710706972659e-01   +1.875698028600064e-01   +1.685258359302249e-01   +8.251467238373145e-02   +1.520418416056016e-01   +5.686638299220736e-02   -2.917168836198775e-03   -1.130139539029250e-01   -2.219523075135229e-01   +1.625080109002459e-02   -3.149367649853990e-02   -1.208745921064060e-01   +1.628616988810990e-02   -1.380365128840216e-01   +1.463765559598888e-01   +1.237744016431092e-01; -3.790555904208467e-02   -8.264319906781090e-02   -6.103020599482131e-03   -6.282895780031086e-02   +9.010957766466846e-02   -6.050078165218255e-02   -1.001113304301896e-01   +2.835214411402817e-03   +3.060722525053971e-03   +8.180077189203686e-02   +1.249755186385427e-01   -1.247835766108747e-01   +1.823464403811912e-01   -6.616640051179956e-04   +1.286180971410197e-01   +1.651058033924579e-01; +3.245849803813620e-02   +6.385208715615989e-02   -9.706338859078965e-02   -4.059176042484901e-02   +1.602312227074846e-02   -8.302190331261622e-02   -1.106533051885195e-01   +1.499559964030301e-01   -1.128836022874039e-02   +8.218472629489930e-02   -6.558976227291033e-02   -1.078462344001672e-01   +7.549455748797859e-02   +2.613132116556302e-01   +1.467622969111386e-02   +7.378328871184180e-02];
L2I_L1I_iGABA_netcon = [+2.218183277029433e-01   -9.082806663754144e-02   +8.156414750654792e-02   +3.014092125854378e-04   +1.942530127396913e-02   +1.007317672265108e-01   -1.153176246481016e-01   +1.806839774657425e-01; +2.543480823328952e-01   +5.392749511039174e-02   +3.054665196046799e-02   +3.241947576168371e-01   -3.386113861680291e-02   +1.977907642620452e-01   +1.990485025229888e-02   -9.730342988922372e-02; -2.321637034784972e-02   +1.599473345409554e-01   -8.003344675921627e-02   +1.982152311256666e-01   -7.848243929340953e-02   -1.608644866766344e-01   -8.630387038798393e-02   +5.071459389158688e-02; -2.492694450496713e-02   +2.121039757601014e-01   +9.078713928620047e-02   -8.073485891413915e-02   +2.820910678642015e-02   -5.225803938456469e-02   +8.408497587580342e-02   +2.185028013639286e-02; +2.391172943280558e-01   +7.606056532582220e-02   -7.127204946245375e-02   +3.829583838022024e-02   +1.240315026918744e-01   +1.574401028258619e-01   -1.194695101699710e-01   +1.095840735409444e-01; +2.807786966268795e-01   -3.002676207543310e-02   +2.742951521647927e-01   +3.701942371836286e-02   -2.489086050287116e-02   +1.191938813969060e-01   -6.545188900291816e-02   -1.306363704224639e-01; +1.270635532910960e-01   +1.305164161737281e-02   -1.819324945669220e-02   +7.943452101324008e-02   +1.265810479514025e-02   +2.073876136949947e-01   +1.743419650202183e-01   +2.446532577155680e-01; +1.221871571689108e-01   -2.828758783274788e-02   +1.836526241975459e-01   -5.354715378283034e-02   +5.671276394925445e-02   -1.108942664406779e-01   +7.070598786333887e-02   -5.864497849632752e-02; -3.382464219663600e-02   -2.787323240432832e-02   +3.111126362066540e-02   +1.193887149612856e-01   +4.364606005888408e-03   +7.659564533490981e-02   -8.648196684288667e-02   +4.255646817516272e-02; -3.797437299014161e-02   +2.159831237400035e-01   +2.599657562586011e-03   +8.703402876701563e-02   +1.361036284047427e-02   +2.653007982671978e-01   +1.142053986138332e-01   +2.549205609675894e-01; +1.562425993187598e-01   +1.189327837376281e-01   +1.001387127771012e-01   +1.602558572908810e-01   -1.698390245288087e-01   +1.140870726887202e-01   +3.700727465180542e-02   -1.029095858854404e-01; +3.890440528919117e-02   +8.647590584757603e-02   +1.463835376304291e-01   +1.670632448286982e-01   +2.144995370009660e-01   +7.269322352815200e-02   +8.933134342363619e-03   +8.306689658066441e-02; +2.484246903780044e-02   -1.110260778794910e-01   +5.837330837383151e-02   +2.857691381939411e-01   +1.726641500881534e-01   +1.474962245106531e-01   +1.048810048164389e-01   -9.933602987623423e-02; +3.878061278076032e-02   +5.026252127142683e-02   +2.995993354510686e-01   -1.464495068277989e-02   -5.504437432816411e-02   +9.809785512724643e-02   +7.021645004937516e-02   +1.027517591797349e-01; +2.371976749715110e-01   +1.999171114381075e-01   -1.606438794361178e-01   +5.064890556284531e-02   -1.978368807664408e-01   -9.761704946117465e-03   +2.684283268284179e-01   +2.558461118989451e-02; +3.141711500798252e-02   +1.988525256721306e-01   +7.363940755229072e-02   -1.283649639552059e-01   +2.125071137896294e-01   +2.684284218095077e-02   -1.779773994918054e-02   +1.149212184524392e-01];
L1I_L2I_iGABA_netcon = [+6.088270249361201e-02   +1.642053514508197e-01   +2.125136362548358e-02   +2.601335667041592e-01   +2.650373503577554e-02   -5.920314861064609e-02   +1.878988985988829e-01   -1.654422139411783e-01   +3.238342206758922e-02   -4.856488311254384e-02   -5.242142376871407e-02   -5.305758798907556e-02   +3.376130668625016e-02   +2.468670976958953e-01   -4.007461270803939e-02   +1.521026165258487e-01; +1.973723810238627e-01   +3.060106496551648e-02   -1.437144871406268e-03   +9.740297849918915e-02   +1.778526399447804e-01   -5.709692139040919e-02   -1.482519529839363e-01   -7.905828050101356e-02   +3.366959839739649e-02   +2.614451652524503e-01   +1.280781964430842e-01   -2.175819592862727e-03   -5.384689094999050e-02   +1.000268030024577e-01   +1.028833083736853e-01   -3.508747361024944e-02; +9.570654934661554e-02   -5.270950942057082e-02   +1.130631901052471e-01   -1.168676250373294e-01   +1.519694951937308e-01   +2.570241974283920e-01   +1.508108168482395e-01   -1.271488943302878e-01   +6.728775659749445e-02   -3.446712039588358e-03   -1.010270972712449e-01   +2.845373350865251e-01   +5.203691286586688e-03   -6.356805441203169e-02   +5.621393913271383e-02   +1.258285343655723e-01; +7.016127835140119e-02   +1.392419259733213e-01   +1.295866700675583e-01   +1.025875397184985e-01   -4.478499899859184e-02   +2.636848195824895e-01   +1.548857898508789e-01   -3.658077792750473e-02   -1.493446252555502e-01   +1.203443708507467e-01   +1.188439865777887e-01   -7.262753371417895e-02   -8.161527876568200e-02   -1.468287060493794e-01   +3.879625431341893e-02   -5.652586764525186e-02; +8.462193702577941e-02   +8.635614253112198e-02   +7.877608268614351e-02   -1.404337383213234e-01   +9.360870787575391e-02   +2.598031645743062e-01   +2.779045650738168e-02   -5.549046558738131e-02   +1.240519378911019e-01   -3.677129880693768e-02   +1.395399226767124e-01   +1.669685793184268e-01   +4.188982617376744e-02   +1.728168449535521e-01   +4.493142947369668e-02   -1.343730298962598e-02; +1.497296177084949e-01   +1.658665980767414e-01   +2.020324815403000e-01   +1.118505889746081e-01   -5.500212873317468e-02   +6.044360814638248e-02   -1.680902669546986e-01   +1.146743533539260e-01   +3.768546195117758e-02   +2.387983795187238e-01   -4.126275095227346e-02   -1.512823871093518e-01   -1.053276314835874e-01   +1.254289811810365e-01   +8.736054001292765e-02   +7.628588826221565e-02; +8.399419906465611e-02   +3.313427796044084e-02   -1.104823981288636e-02   +1.622959365997404e-01   -8.315381724839718e-02   +3.726371818592406e-02   +2.025165205047047e-01   +1.405512060009502e-01   +1.914469630352732e-01   +3.586515161422006e-02   +2.610688746401701e-01   +1.357828333996294e-02   -4.821646674982013e-02   -2.870505519859759e-02   +2.298945349993222e-01   +5.294291723016510e-02; -2.207663926088002e-01   +7.595355606720250e-02   +7.139350959603669e-02   -1.298787143089629e-02   -4.841725378323147e-02   +1.117023497329762e-02   +1.090656241812489e-01   +3.520837443700062e-02   -1.047576182731171e-02   -1.538755945471727e-01   +1.202145888247555e-01   -8.494596379019823e-02   +8.377243104866845e-02   -8.253068956620077e-02   +2.859885881104527e-01   +1.354699904636045e-02];
L2E_L1E_iAMPA_netcon = [+7.570950758536703e-02   +1.910177076389738e-02   -2.630821350365137e-02   -2.368446523723335e-02   +1.578174492588337e-01   +8.971944165070127e-02   -3.754312937795247e-02   -3.028438624528972e-02; +3.247979734878337e-04   +2.703371834800077e-01   -3.340519726476246e-02   +9.870593142992927e-02   +2.890554524171024e-01   +4.502054639906081e-02   -6.166282901606727e-02   +1.859970246477313e-03; +2.147165541347429e-01   +2.692098135226353e-01   -6.866792749809747e-02   +1.745443340635792e-01   -2.752011118301728e-05   -7.800358844209787e-02   +1.102046395364562e-01   +2.692398858433324e-02; +1.675714582077084e-01   -1.308326129835422e-02   +2.303063466685226e-01   -2.255115312918103e-02   +8.483432046239835e-02   +6.088214210642114e-02   +7.663928407607781e-02   +1.675436267360650e-01; -3.931421372373147e-02   -1.035023731809069e-01   +3.734995088663137e-02   +2.321441190933753e-01   -2.178202862424438e-02   +7.969497882352083e-02   -1.535963503698658e-01   +1.894382924810551e-01; -6.226021015824903e-02   -1.169754883062240e-01   +3.020751982221569e-02   -6.349897472523841e-02   +1.142849087283931e-01   +1.981379774190271e-01   -9.904193476715387e-02   +5.423733775876691e-02; +5.470072785400670e-02   +2.004827656044906e-01   +9.507717379324210e-02   +7.475729529136449e-02   +1.784100893249688e-01   -3.704579050220957e-02   +8.782960751243699e-02   -5.817861849548845e-02; -5.662734161498521e-02   +1.101751447739228e-01   +1.529563046789144e-01   +1.912719440743711e-01   +1.685205599783011e-01   +4.420478304321857e-02   +6.924758141257473e-02   +1.794743252914891e-01; +1.334169430461254e-02   +1.484534576012373e-01   +4.028891989436949e-02   -7.450110068466251e-02   +8.336758790149339e-02   -5.899689680748219e-02   +2.511080638938062e-01   -2.862098027365231e-02; +7.106154305773990e-02   -2.817825497475535e-02   +2.168242811071914e-01   +2.122513670351754e-01   +1.679495698725417e-02   +2.602728756942005e-01   +1.265058840058197e-01   +2.838401469265232e-02; -7.632061476632272e-02   -7.208724819406459e-03   +2.539349076594019e-01   -1.044341141655870e-01   +2.681286329786651e-01   -1.148057405867657e-01   +1.193426924330014e-01   -1.145628924047248e-01; +2.134869219157527e-01   +1.334214341051269e-01   -9.758244168791504e-02   +2.035978771783291e-02   +3.811797294476828e-02   +1.410333144521423e-01   +1.049276589829664e-01   -1.232105795406342e-01; -1.075584394645094e-01   -2.739183285416670e-02   +7.149690021028214e-02   -7.028040418491958e-02   +1.379019940520557e-02   -5.575143653948306e-02   -7.425304970841969e-02   +6.048354276521400e-02; +2.798118644311187e-01   -6.375358533926864e-02   +8.978740652923281e-02   +1.045829008327265e-01   -6.828683889946047e-02   +1.111582209504346e-01   +1.874762605516594e-02   +8.642579413643631e-02; -4.455291457725070e-02   +2.265425253200835e-02   -1.214170601824978e-01   +2.648233647805853e-01   -5.345486888337420e-02   -3.988815157099385e-02   -1.863004527145685e-02   -6.706000636233327e-02; +5.226694403420073e-02   +1.639996702945241e-01   +1.031024080782366e-01   -1.036867948386281e-01   -8.810408971028069e-02   -4.562216141497551e-02   -1.599358260030312e-03   +2.221776926434493e-02];
L1E_L2E_iAMPA_netcon = [-2.602942059566218e-01   -4.513208238337315e-02   +1.427801164040118e-01   +6.566239839586742e-03   +8.605486458649196e-02   +2.252804619174796e-01   +3.792482777331858e-02   +1.892601965862143e-01   -3.007129485662843e-02   +7.608555823195853e-03   +7.360840967694302e-02   +6.857554820747747e-02   +1.535668659031333e-02   +6.749601274257255e-02   +1.583614476640526e-01   -2.025330969538851e-02; +1.310279620024008e-01   -3.472123236500595e-02   +1.368424050892736e-01   -9.208308754475641e-02   +2.250149829815475e-01   +6.640979193244437e-02   +3.266446103481092e-01   -1.147978781836876e-02   +4.265637833410296e-02   +1.535583518115916e-01   -1.019384993787786e-01   -1.248792524392072e-02   +2.852898448361147e-01   +2.614583012885638e-01   +2.330402095621984e-01   -6.799284895670751e-02; +1.676069311046378e-01   +9.935486205725946e-02   +1.336210887295752e-01   +1.580330387676745e-01   +2.420208361609449e-01   -1.238957406854529e-01   -2.954672262393256e-03   +4.707311326618363e-03   +1.628270897560245e-01   -3.192182503953969e-02   +4.824809433620725e-02   -8.829791755248756e-02   +5.411136877877252e-02   -1.413335695928552e-01   -1.039535560229458e-01   +1.242471538932041e-02; -6.728589831553852e-02   +1.288844259835196e-01   +1.936673792892223e-01   +1.865614249327181e-02   -1.179030344485607e-02   -5.511350003784872e-02   +2.659508407009637e-01   +1.383748663295427e-01   -1.846853820658151e-01   +1.739634742173042e-02   +8.384035911511512e-02   +7.725856018853040e-02   +8.459228724591733e-02   -2.959672021337038e-02   +3.384341928329690e-03   +3.301013304705860e-01; -9.873924060868544e-02   +2.444721438947612e-01   -4.142609043762124e-02   -1.277499622533130e-01   +6.541462483680248e-02   -1.390172132050665e-02   +1.205569445537650e-01   +1.199122938855686e-01   +8.427603529706029e-02   +1.458004532639785e-01   -6.699956050443850e-03   +3.011864269326890e-02   +4.865609058161817e-02   +3.038212993700467e-02   +3.986227119074467e-03   +3.247290898791910e-01; +2.353740278560548e-01   +2.216118224866664e-01   +8.319310721082165e-02   -1.184123846050212e-01   +8.285268659817505e-02   +4.933651730970633e-02   +7.289667239742276e-02   +1.615780821733994e-01   +7.954079454623147e-02   +5.693648587239061e-02   -6.173524680500272e-02   -7.117066244112803e-02   -6.723745548204668e-02   -2.365198879062846e-02   +1.523040115828596e-01   -1.640972529526727e-01; +1.119287391071727e-01   -1.129388214046972e-01   +1.887496045168663e-03   -1.822533629327708e-02   +2.847956380449249e-02   +2.504115308846226e-01   +1.680815356202994e-01   -3.276570203213378e-02   +8.758807456570783e-02   +1.952155632599481e-01   -6.004340279455523e-02   -1.612014935179192e-01   +3.022248011904253e-01   -4.349473105503247e-02   +1.447898745542731e-01   -1.203898307309044e-01; +3.834987123637167e-01   -3.409027596285839e-03   +1.619146573721370e-02   +6.714897207857778e-02   +6.837186306675816e-02   +5.048350427354021e-02   +1.168104597318929e-01   +2.815245201557601e-02   +6.523777151257926e-02   +5.948732933964085e-02   +1.843515096555616e-01   +5.179676198186245e-02   -5.394075148641776e-02   -1.453354356366756e-02   -1.870901879183398e-01   +2.198654326640404e-01];
L2I_L2E_iAMPA_netcon = [+2.958100064105116e-01   +4.531576015967258e-03   +7.455665041525146e-02   -2.845665388654046e-02   -1.893401265335271e-03   +3.857231698709497e-02   +2.342341452694988e-02   -3.175721478417239e-02; -1.281103546451264e-01   +9.180100104587577e-02   +2.353231977466948e-01   +9.777626957779781e-02   +8.525758661014836e-03   +2.734062481131729e-02   +2.736399819443360e-02   +1.369213905199360e-01; +1.485500364069031e-01   -7.272805815217538e-02   -2.218214598168138e-02   +9.358633097825354e-02   -3.627599172420019e-02   +1.006542828183365e-01   -8.476897682709695e-03   +9.704183378478726e-02; +9.159474139271351e-02   +5.640766692329907e-02   +3.182886463994222e-02   -7.919563683152527e-02   +5.973562977884945e-02   -1.188458089382537e-01   -2.855474135164935e-02   +1.902632628946200e-01; -1.780015265375913e-02   -1.109737090184420e-01   +5.617995046428066e-02   -3.734538138756251e-02   +7.036622573194019e-03   +1.733094104530978e-01   +1.494682997145939e-01   +1.064393428802496e-01; +1.546564008207589e-01   -1.241422296441996e-01   +4.227232282758546e-02   +8.656432645184492e-02   -7.773417747158395e-03   +5.863109836613897e-02   +1.621247046784331e-01   +2.005441803686280e-01; +4.640521771073614e-02   -6.090195304256735e-02   +1.213024690370219e-01   -8.423429791240239e-02   +1.709952970341910e-01   -1.360717734040817e-01   +1.232944914112412e-01   -7.025500604722057e-02; +1.706257027515296e-01   +2.718796057444551e-01   -5.781551288447998e-02   +2.971530290417437e-01   +2.796884919699493e-01   +1.226744788014439e-01   +1.193802831371409e-01   -8.859174854041799e-02];
L2E_L2I_iGABA_netcon = [+4.486371943598332e-02   +1.260002772531925e-01   +6.257471351750296e-03   +8.196428261083533e-02   +1.228089324670332e-01   -1.409503301233562e-01   +1.385822781513771e-01   +1.500736377840014e-01; +1.937796405442284e-02   +1.751785212004150e-01   -1.903539671743525e-02   +1.893352139805888e-01   +1.257218382457619e-01   -5.524731917590123e-02   -1.263406879349508e-01   +2.093812295794339e-01; +2.984011132564329e-01   +7.960638137809059e-02   -1.533087696808695e-01   +1.802246342917641e-01   +6.356191614507016e-02   +7.245036163846057e-02   +5.059129077384957e-02   +5.749503974787868e-02; -2.835792035996786e-02   +8.077784897441342e-02   +3.185301126910217e-01   +1.343861216051216e-01   +6.075115740800742e-02   +9.118284830691124e-02   -2.318324624551270e-01   +1.576214860747298e-01; -1.196771843545416e-02   +4.195117385170398e-02   +2.081881648327857e-01   -8.382459401241577e-02   +1.955276763894712e-01   -2.153615463909088e-01   +6.108311899882359e-02   -1.507058030264897e-02; +2.333664146104166e-01   -9.975388023179074e-02   +5.792485455990536e-02   +1.108244268504965e-02   +5.046520655316837e-02   +6.522713647462836e-02   -1.553526519938026e-01   +1.182802666133931e-01; -1.206759374310499e-01   +2.116320328796643e-01   +1.236326157353029e-01   -6.148563615562642e-02   +1.509010843379201e-01   +9.136582093091639e-02   -4.689007042286739e-02   +9.657989252903798e-02; -8.212530897710402e-03   -2.895236076648709e-02   -4.285981695866384e-02   -4.743232776697143e-02   +5.059538420272437e-02   +1.930740668059930e-02   +8.187648895779001e-02   +8.829746655414855e-02];
L3E_L2E_iAMPA_netcon = [+2.557709778525116e-02   -5.062254674795322e-02   -5.254733224862515e-03   +1.141593923196087e-01   -1.246582557113900e-02   +1.352540369692761e-01   +1.209079405790923e-02   +8.079364129908760e-02   +1.666825679091972e-01   +1.703686324199591e-01   -6.719149168363442e-02   +7.080104922432065e-02; +7.234970195293793e-02   +1.511146811582551e-01   +2.158139287573140e-01   -1.339036774711292e-01   +2.173070173588829e-02   +1.135382669121616e-01   +1.814691689482874e-01   -2.365297454420889e-02   +2.177198454124125e-01   -8.146501880710588e-03   +1.291745055679275e-01   +7.587457912389974e-02; -9.990516328863865e-03   +1.480234660733943e-01   -1.464247307352378e-01   +1.377534593303670e-01   -7.067610745896027e-02   -1.149672826944816e-02   +1.856189016364041e-01   +9.002072894935279e-02   +8.804699384569703e-02   +1.791949325674119e-01   +6.766116806241851e-02   -1.601951896777086e-01; +2.033295001369277e-01   +2.143131872583794e-01   +3.925562305355068e-02   -6.218991922383078e-02   -2.057201850200585e-03   +1.474998186717029e-01   +4.936684021364617e-02   +8.022761307263926e-02   +2.956492464944075e-02   -3.554015785136849e-03   -3.141074930051523e-02   +1.767847391266694e-01; +2.274982606564497e-01   +5.879357800767575e-02   -3.418021552312075e-02   +2.109601095019185e-01   +2.738943004153034e-01   -1.844027708943146e-01   +1.633380536936357e-01   -1.231041364429897e-01   +4.560145573571572e-02   +1.473832213235100e-01   +1.530489932855188e-02   +8.384060577181790e-02; +1.470488339996930e-01   -9.062934010674065e-02   +1.001360680842093e-01   -9.189807994385998e-02   +5.098645474905968e-04   +4.567932976011656e-02   +1.073814145226527e-01   +6.571679397625259e-02   +2.053154037383753e-01   +6.188158834518922e-02   +4.729568009161245e-03   +6.858943621134844e-03; +2.737124272372707e-01   -1.892520290177273e-02   -4.294071454322717e-02   +8.280606655780927e-02   +2.083035531907993e-01   +1.882466434164289e-01   -4.083909287470523e-02   +4.055258309586639e-02   +1.069072911119734e-01   +9.905521138352238e-02   +1.797370847421331e-01   -8.098800130770262e-02; +2.944643659377741e-02   +3.643741044631587e-02   +7.552043808686063e-02   -3.565708888365768e-02   -1.900519821103217e-01   +2.765642716462264e-01   -2.021896415884292e-01   +3.439061573801387e-02   -1.302375602223138e-02   +4.517572082502545e-02   +5.886204817133468e-02   -4.385000687716485e-02];
L3I_L2I_iGABA_netcon = [-5.134213062102034e-02   -2.529542566542872e-02   +1.645743365784924e-01   +1.025568718346238e-01   +4.871780161187472e-03   -1.737843368111671e-01   -6.116361638749686e-02   +9.744775786095564e-02   +3.137553951634891e-01   -7.349102982205580e-02   +8.696612534639488e-02   -2.260227308166221e-02; +7.339533393490633e-02   +1.260157161406303e-01   +1.330991244617225e-01   -4.306148447005193e-02   +1.213562568695914e-01   +1.736138681691076e-01   -3.140526965054333e-02   -1.062119385805905e-01   +1.845930801855005e-01   +1.238859722973548e-01   +5.585895419891876e-02   +1.330965966293371e-02; -1.997712509968025e-02   +2.376129981995827e-02   +5.362154193993923e-02   +3.144391265943877e-01   -1.378656080196340e-01   +1.657837065132675e-01   +8.372025734831338e-02   -3.190542315515732e-02   +1.218351844258816e-01   +3.347149703254449e-02   +1.525701993933462e-01   -2.336741418945730e-02; +1.027232287308806e-01   +1.220290122498434e-01   +1.532041660712240e-01   -1.245861205263289e-01   +1.640741234049789e-02   +2.400560312266155e-01   +2.037718644939815e-02   +1.984299393165208e-01   -7.385164037083108e-02   +1.802604470427255e-01   +5.143575578978114e-02   +1.201655216712196e-01; +1.096008588395577e-01   -8.264465615593618e-02   -1.333410510962474e-04   +8.829846541071368e-02   +1.107340942639080e-01   +1.114497259551483e-01   +1.702205723103647e-01   +1.023518862671725e-01   -5.380227816311505e-02   +8.311096218770674e-02   +2.750534220147233e-01   -7.269195452271028e-02; +4.241514466805810e-02   -1.953639813915815e-02   +1.038337335571223e-01   -9.554748221988926e-03   +8.989695607284436e-02   +5.934346212528230e-02   +1.394306954664193e-03   +2.662214644391895e-01   -3.439401557928462e-03   +1.381742963817526e-01   +2.636237374132922e-02   +1.748155550500779e-01; +2.390338098774972e-01   -6.335071413970420e-02   -5.018259919652220e-02   +1.263376002168787e-01   -7.550508355168337e-02   +2.670964660125827e-01   -1.597258388312973e-01   -3.970858905723191e-02   +1.873516944466599e-01   +1.518938381521579e-01   -8.471176347903975e-02   +6.417002715966519e-02; -1.180924176495367e-01   +2.090034811447940e-01   +1.513331339028673e-01   -1.203823224212889e-01   +8.397794320710419e-02   +4.795294172154081e-02   +5.569591862549048e-02   +1.490045191237735e-01   -7.055560920352373e-03   +2.382080900357340e-01   -2.717858531070916e-02   +9.566764638076791e-03];
L2E_L3E_iAMPA_netcon = [+1.055658515360774e-01   +1.846731260767571e-01   -4.766581306190146e-02   +7.719913954953743e-02   -1.537469800116893e-01   -2.841483748827955e-02   +4.722131314931670e-02   -1.112311460057030e-01; -8.268855009656771e-02   -1.314372599345572e-01   +2.481591853087867e-01   +2.409855478582030e-01   -2.318579928675531e-02   -1.345486231955983e-02   -1.726315328159402e-01   +4.145035557314962e-02; +7.500149957273203e-02   -1.474220633875381e-01   +1.876339408244146e-01   +1.953233859014485e-02   +2.121942531902085e-02   +1.132815844843224e-01   +2.477291460162104e-01   +1.005201259799615e-02; +1.162108896246283e-02   +9.289909640514660e-02   +1.444053654135920e-01   +3.196862441937642e-02   +9.716696011958094e-02   +1.160044960208645e-01   +1.448701965960156e-01   +2.474179972539852e-01; +1.188722850933191e-01   +1.236778964218578e-01   +7.306864033851657e-02   -3.043014070107589e-02   +1.083972830638759e-01   +1.380696764304050e-01   -4.643294766341112e-02   -1.074287513860042e-01; -7.147391315079217e-02   +1.984468920215690e-01   +1.207390230263818e-01   -1.246319365723764e-02   +5.716165488927552e-02   +2.616130512796486e-01   -1.546928034890216e-01   +7.793474119968846e-02; +7.107436112268156e-02   +2.345093970489862e-01   +2.043009978376590e-01   -5.206898315479042e-02   +7.057373522991146e-02   +1.448214565386914e-01   +3.430564645467751e-02   +3.268121530268719e-02; -1.442046714124035e-02   -1.586218215440610e-01   -1.310852421501185e-01   +1.425219789795113e-01   +5.065815124609392e-02   +1.847002130609257e-01   -1.692528242433756e-02   -1.096692046817086e-01; +4.016847250996729e-02   +1.775335242424848e-01   +2.225102491764469e-01   +2.304471066107534e-01   -7.196917198131217e-03   -5.462399671824887e-02   -2.282023825237250e-02   -4.840942598149529e-02; +1.625460834134030e-01   -4.208856573430410e-02   -6.952361285933990e-02   +1.620390509591543e-01   -5.432595418970518e-02   +4.089091845106595e-02   +2.524526034555079e-01   +8.626571634441665e-02; +8.907142099221808e-02   -8.943196273275476e-02   +9.606884638453664e-02   +1.590132920079130e-01   +6.702147911852890e-03   -6.041954748255551e-02   -4.569862769371832e-02   +1.693797167138700e-01; +9.148374697699947e-02   -1.057355102901997e-01   +1.127801523574514e-01   +6.493277391202062e-02   -9.481770354518013e-02   -1.019527123477255e-01   +1.823951245960246e-01   +5.220797078797312e-02];
L2I_L3I_iGABA_netcon = [+1.295266058878802e-01   +1.226046312905127e-01   +1.613289798545319e-01   +1.876171938439754e-01   +1.019611439086523e-01   -1.028927812343246e-01   +4.379307203594227e-02   +2.464049707887077e-01; +1.704132208906617e-01   +3.032443511821596e-01   +6.996006993564431e-02   +1.273349186827851e-01   +1.431774670831722e-01   +2.289143733125901e-01   -2.307501413242699e-02   +5.763281211732151e-02; +2.435449162313606e-02   +6.702942100315634e-02   +4.134374006488508e-02   +2.035514971871284e-01   +1.017125786426903e-03   +6.385403084863010e-02   +1.261378354130991e-01   -5.522881188586653e-02; -1.935483602076440e-01   -2.571706311932720e-02   -1.320026402011944e-01   +1.367117421546659e-01   +1.927432985617341e-01   +7.193700486570542e-02   +9.921005840991066e-02   +1.803025951739159e-01; +1.151834283495746e-01   +1.512100718397369e-01   +2.076990640539996e-01   +8.333675215545526e-02   +9.109429714138003e-03   +4.259332785630551e-02   +6.996334237981883e-02   +1.603106689940996e-01; -3.498717447134805e-03   -9.592887489357597e-02   +2.702941402101311e-02   +1.734398665489014e-01   +7.241093087678110e-02   +1.977599461876948e-01   -1.064184558660160e-02   +3.011136602463600e-02; -6.931235387839248e-03   -2.388627092641671e-01   +7.898911077320415e-02   +1.669125889131232e-01   -4.173712154848186e-03   -2.338181583454854e-02   +2.706592198091215e-01   +6.223866518913390e-02; +1.523685959790447e-03   +2.301294580744564e-01   +2.987942991146043e-02   +1.278827776124604e-01   +1.107715685892423e-02   +1.569261225027185e-01   +1.328782789039927e-01   +2.228291594982315e-01; -2.463181058282797e-02   +1.262224776482940e-02   +1.227001345802508e-01   +1.016275341957438e-01   -1.669329223244305e-02   +1.933984146100626e-02   +1.967204449309683e-02   +1.473063780246269e-01; -4.822543572823260e-02   +2.303339465120485e-01   -1.915074846832247e-02   +1.874996552385289e-02   -6.050810897889562e-02   -3.215130625463860e-02   +1.970792942255328e-01   +1.509238986247027e-01; +1.755367543525439e-01   +4.894179521018438e-02   +1.168023732488872e-01   +3.306275793861553e-02   +2.042861941197725e-01   +3.317430138498905e-02   -1.283102169521569e-01   +2.230025241199242e-01; +1.489666935652028e-01   +2.581752145853395e-02   -2.391753865601604e-02   +1.810038772882823e-01   +1.021680805025103e-01   +1.444883353326438e-01   -9.374445782405150e-02   -1.715301175762873e-02];
L3I_L3E_iAMPA_netcon = [+1.067551278116297e-01   +1.004116009153283e-01   +1.334204100187151e-01   -1.510444678156387e-01   -3.231666932871223e-02   +1.170864307810833e-01   +1.545913573971766e-02   +8.004552596175689e-02   +3.808103084610201e-03   +1.329709967865694e-02   -1.577946547845399e-01   -6.587459401487064e-02; +1.249228421259826e-01   +2.458863290863618e-02   -4.129688069797970e-02   +2.557846656012933e-01   +3.900288472699179e-02   -6.281800994215136e-02   +1.944416704650720e-01   +2.950277778394206e-02   -1.348432582156672e-02   -4.817314583158950e-02   +2.886196415011833e-02   -1.590941957697882e-01; +4.648627343137607e-02   +1.484460466888340e-01   +1.370333193477478e-01   -1.157027359060685e-01   +6.277662706839592e-02   +1.164557107118147e-01   +2.775925351118492e-01   -1.154709407174323e-01   -9.622085172634696e-02   +3.893027498073085e-02   +1.337783787152013e-01   +9.049141437805289e-03; +2.697822404044865e-01   +9.627588188261075e-03   -1.571079123421185e-02   +1.721994238366858e-01   -1.121231785718554e-01   +4.670502014472246e-02   -1.071998042596273e-01   -1.728706095510234e-02   +2.234208640009440e-01   +8.537017411680675e-02   +8.090442818106577e-02   +1.015633587912926e-01; +2.885104117228605e-01   -2.757890307448135e-02   +1.625760502258620e-01   +9.757345975739098e-02   +1.839406006873027e-01   -5.269096118745996e-03   +1.204098215915410e-01   +1.062567399309702e-01   +1.678069444279222e-01   -1.357486880572294e-01   +1.574416184956436e-01   +1.173536856847175e-01; -2.212229591351741e-01   +1.567743544003396e-01   +1.935325318288431e-01   +1.350585521451006e-01   +4.457620860540246e-02   -1.022950037261451e-01   +1.803241733071695e-01   +1.674386036999011e-01   +1.208996471122695e-01   -4.508281302030803e-02   -3.316238003683730e-02   -1.136509125516313e-01; +2.777839275105832e-01   +2.503078016050471e-01   +2.973480936104207e-02   +1.479722174634156e-01   +8.483310792626574e-02   +7.269390703815663e-02   +1.523905758484133e-01   -1.223975999048212e-02   +3.007792848818096e-02   +6.987798525829765e-02   +9.580139742011574e-02   -1.027502332750811e-01; +1.690878487681491e-01   +1.978876334526705e-01   -7.169202323845067e-02   +1.346082751915819e-02   -4.120677063028486e-02   +3.023401546663926e-01   +1.117938300138111e-01   -1.241288994770676e-02   +1.370566915451712e-01   -2.100691645786587e-02   +7.139665159378245e-02   +2.437858413274095e-02; +1.403073119054813e-01   -1.006064119833818e-01   +1.015702750899217e-01   -3.452103389045441e-02   +1.337786147164751e-01   -1.047379323798384e-02   +2.000075684781872e-01   +2.216965962736318e-01   -1.014662630155493e-01   +1.502677608261865e-01   +1.642364695382539e-01   +1.963729405538146e-01; -8.104207397738834e-03   +1.304683071756150e-01   +1.421800052526856e-01   +1.293770911060145e-02   +1.238705917865642e-01   -3.910525864333415e-02   +2.939444992904062e-01   +1.071931752404007e-02   +4.379680174338323e-02   -7.531960595197001e-02   -2.401372552225418e-02   +5.885400149721439e-02; +2.257823845573211e-02   +2.010349674931267e-01   -1.113419155545507e-01   +8.321664837703166e-02   -6.280285938234434e-02   -1.948967107195550e-01   +1.111184580563380e-01   -5.659426119646033e-02   -7.581390530883624e-02   -5.846806476943846e-02   +1.497533788062594e-01   +1.563653156215561e-01; +1.077584077967644e-02   +3.341237006417468e-02   +1.240361080920561e-01   -3.660463532286767e-02   +6.714114279995732e-02   +2.747503794435494e-02   -9.731908241268648e-02   -7.629060886215411e-02   -7.992241063937568e-02   -8.446395203989418e-02   +2.421048849200234e-02   +1.273015566292802e-01];
L3E_L3I_iGABA_netcon = [+1.572078155290996e-01   -9.631653570995252e-02   -3.053374825721487e-02   +2.003645148905071e-01   +8.485920958675178e-02   -1.803048197195507e-02   +1.978009602789446e-01   -2.409155273344281e-01   +5.030107487444813e-03   -7.160875455372884e-02   -8.151644001202499e-02   -1.494330761734307e-01; +2.543303200802450e-01   +8.076235544493712e-02   -8.731165697829441e-02   +1.648524821707595e-01   +1.347435364817540e-01   +4.666964988275070e-02   -1.162708854674142e-02   +6.428034655317369e-02   +1.938242049917978e-01   -8.805697666568774e-03   +1.863419680195428e-01   +1.870916807782889e-01; +2.328123065327097e-01   +1.320179931379920e-01   +4.181983740945971e-02   -5.084448238915368e-02   +4.582431636222822e-03   -1.704905012498038e-01   +2.652987713994667e-01   +2.518192946410579e-01   +1.538013105627385e-01   +2.643763165327409e-02   -6.043811225634743e-02   +1.320734708130883e-01; -4.523351567222694e-02   +1.797782640033910e-02   -7.193359946437086e-02   +4.351600807716655e-03   -3.771151969685080e-02   +1.434593306937067e-01   +7.276176740873749e-02   -5.869080854269927e-02   +4.436459041512288e-02   +2.296114673688445e-01   +6.801199235526348e-02   -1.186772647344789e-01; -4.946647381715996e-02   +1.476762538313974e-01   +2.194630662998718e-02   +1.004840636327262e-01   +9.577102646770093e-02   +2.648658224566328e-02   +1.273574004074144e-02   +2.260497615138175e-01   +5.343097484039902e-02   +2.939621423029515e-02   +7.720435810114847e-02   -1.545745931767703e-01; +2.344420511027658e-04   -1.545511276424819e-01   -1.572344004756945e-01   +1.939375192076206e-01   -4.783236978884180e-02   +2.435677171926757e-01   +2.619847435424531e-01   +2.423908142433733e-01   +7.933020137485028e-02   +1.496807935273169e-01   +1.681536018522234e-02   -7.133361549877926e-02; +2.282132415494426e-01   -1.327339229751891e-01   +7.576374354509599e-02   -3.996598202224711e-02   +3.604862663963875e-02   +5.458274479340548e-02   +1.917375830469909e-01   -1.095274800028155e-01   +1.355658263819444e-01   -1.125529411948025e-02   +2.619587106045884e-01   +1.360436484966432e-01; -1.369747384610535e-02   +1.380311330701456e-01   +8.335035191077095e-02   -2.918462207442979e-02   -4.443385303090186e-02   +6.062591107514965e-02   -1.032825060745135e-01   +5.353504531436458e-02   +1.039962911942603e-01   +7.836679023959436e-02   -3.541941966620361e-02   -2.857866957283739e-02; +9.612913976842330e-03   +4.722964969761882e-02   +8.533783081085654e-02   +4.044213017431986e-02   -8.214387389047180e-03   +7.782950664441574e-02   -1.085081436216777e-01   -2.444689411763457e-01   +1.983027291463045e-01   +1.596772969499007e-01   +3.858940766920099e-02   +1.276567224017472e-01; -1.209081919045183e-01   -1.015946226947277e-01   +2.319257554290535e-01   +6.093133572483667e-02   +1.496594784523865e-02   -5.940750696978993e-02   +1.558518328715262e-01   -1.763886871402751e-01   -6.639867506880337e-03   +1.893356077112616e-01   +8.912181443514279e-02   -2.879369443863563e-02; +1.510873183453839e-02   +1.186655930397966e-02   +4.295137597377063e-02   +1.030037825035894e-01   +9.864174540751239e-02   -1.085774096856682e-02   +9.253987663234459e-03   +6.554813097331016e-02   -2.056110269715399e-02   +6.347535708695244e-02   -1.132741242922060e-01   +3.614324693916225e-03; +1.413637668481099e-01   -3.806271286332730e-02   -9.377871509962471e-03   +2.027993149638292e-01   +1.231453870442845e-01   -1.648994543224927e-02   -7.820859479627357e-02   -1.520431041249106e-01   +4.364251707036684e-02   +5.130141044919072e-02   -1.033385805861475e-01   +1.661751942849115e-01];
L2E_Input1_iAMPA_netcon = [+3.756949567298684e-02   +1.297656556163405e-01   +8.405888820544347e-02   +1.173286480340134e-01   +9.722397943319182e-02   +2.036913860727678e-01   +1.774033091711466e-01   -1.083448987900226e-01];
L2I_Input2_iAMPA_netcon = [-3.534030698109213e-02   +2.177593830127347e-01   -1.679769647381498e-01   -1.117679321048003e-01   +1.152263605613683e-01   +1.590167082193891e-01   -1.304338196758636e-01   +3.936438764844997e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.3*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.9 + 0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.3*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*1.0 + 0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.3*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*1.0 + 0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.3*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.9 + 0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.3*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*1.0 + 0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.3*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*1.0 + 0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
