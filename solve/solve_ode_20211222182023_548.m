function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.770174806384825e-01   +2.271333318736606e-01   -2.853472124128309e-01   +2.551146328060631e-01   -1.678135288980523e-01   +7.831666772536268e-01   +2.647087975262114e-01   -2.461984023531706e-01   -5.601940573814687e-02   +2.416595982428213e-01   -3.247718930473434e-01   -6.328743177679752e-02   -1.405385924866361e-01   -1.326300416068216e-01   +1.254963239077918e-01   +2.791708203339618e-01; +8.608279474818841e-01   -3.320758455601052e-01   -2.367093771695857e-01   -3.148645560135188e-01   -1.252477393860595e-02   +5.071400487941358e-02   +3.249834364359758e-01   -2.585981643457672e-01   +6.662656953555810e-01   +3.586154333692070e-02   -3.244592258299918e-01   -2.743721868117467e-01   +5.366858213523747e-02   -5.214285059851061e-01   +5.669755840180065e-01   +9.511110405337822e-02; -3.538968661922263e-01   -5.184423301615929e-02   -3.119937359383883e-01   +1.527475816765451e-01   -6.893707944710384e-02   -1.216904033618141e-01   -4.391589183647723e-01   +2.129422470919771e-01   +1.101442908149661e-02   +5.655056232902560e-01   -1.522458155441456e-01   +8.270228070128893e-03   -1.238719683533827e-01   +1.426593567718104e-02   -9.347525400445643e-02   -5.223311243868156e-01; -6.272631418137314e-02   +5.220439098872315e-01   -2.625131460707554e-01   -3.824954151932713e-01   -4.521951459178682e-01   -1.165738600177606e-01   +3.928439057850875e-01   -4.174696767306401e-01   -2.228699342670727e-01   -4.003396612111415e-01   +4.279766471169723e-01   -2.364165423618800e-02   -6.020347091771219e-01   +8.419964657698092e-03   +2.449186577792425e-01   +2.862436667139556e-02; +3.902585902768061e-01   +1.360127426972711e-01   -2.522881239680727e-01   -1.576462704591149e-01   -3.217729879349416e-01   -1.106492333028950e-01   +4.068449915006473e-01   -1.209070891596917e-02   -2.351111953392900e-01   +4.004731865980088e-01   +4.063972406722290e-01   -3.457460532513533e-01   -1.438669606566766e-01   -4.098543851418612e-01   +2.026459311783654e-02   -4.896316392111170e-02; -2.488521774277346e-01   -8.367124851781882e-01   -3.976648437711305e-02   -1.214590396723015e-01   -2.968978630275798e-01   +1.850382516177225e-02   -3.414815503710908e-01   +5.243540278369807e-01   -1.713664675561067e-01   -6.580944920031467e-02   +4.526169896948287e-01   +1.906004163254221e-01   -1.232306867774997e-01   -3.324331825067833e-01   +2.263738656103308e-01   +2.731294640451283e-01; -3.233556155231582e-01   +8.157199027229695e-03   +5.575764287928189e-01   +2.812438683707541e-01   +3.189147719102757e-01   +5.590535831328587e-01   -3.787364949616971e-01   +7.608894757342555e-03   +3.023081732757935e-01   +9.189418934170174e-02   -5.437142701632262e-02   +1.418400715119444e-01   -1.918867569916122e-01   +1.585091747336756e-01   +1.931847534013089e-01   -7.282406537885092e-02; -2.013025930254625e-01   +2.384100583093056e-02   -3.523940266395162e-02   -1.224964389973408e-01   +9.854356380274712e-02   -2.508511585436606e-01   -1.449627109243323e-01   +9.847701760352978e-02   -1.655241254063198e-01   +6.710519121808248e-02   -5.222418074921138e-01   -1.362878015037509e-01   -4.954208131051892e-01   +1.534290879154066e-01   +4.028075316595896e-01   +1.176583985453961e-01; -3.945339177439742e-01   +1.638174384615634e-01   -3.257374797661297e-01   -1.815022759078062e-01   -3.521218200030421e-01   -4.724671531681102e-01   +4.355037158542370e-01   -3.992464343913452e-01   +1.762920148087140e-01   +1.197556420261564e-01   -2.742145909309190e-01   -6.896703458498539e-01   -8.290122412482111e-02   +1.000184166664796e-01   -1.612414020126100e-01   -1.117346572832477e-01; -4.616927034122727e-01   +1.701966594800329e-01   -5.902872460121000e-01   +1.390417139380796e-01   -3.688712563224922e-01   -2.244071341508968e-01   -2.271894981574040e-01   -2.529114368259686e-01   -2.179356857019402e-01   +2.141639260802164e-01   +3.178630484069862e-01   +8.905180674149969e-02   +6.196396206375919e-01   +1.297778586404221e-01   +3.289443978493175e-01   -7.851764472848563e-02; -3.764953861001179e-01   +2.743303524099416e-01   -4.934276716641087e-01   -1.867712396895726e-01   +5.446908140214152e-02   +1.203911991457265e-01   -1.053059269555291e-01   +9.759002544644987e-02   +1.381913715231981e-01   -3.025743129212492e-01   -9.517338960921269e-02   -4.601413428538862e-01   -1.878885958118901e-01   +5.071584217681132e-01   +6.767281159282462e-02   +1.740906377475622e-01; -4.181059111651803e-01   -3.800089324937010e-01   +7.671418453844901e-02   -5.734496950498450e-01   -5.001021725438901e-01   -4.584316872667895e-01   -5.441343996205378e-02   +5.139208596175860e-01   +2.647018425145778e-01   +3.654596033001101e-01   -4.185566286526556e-01   +1.568092209819219e-01   -2.674061606170897e-01   -1.142958926718583e-01   +3.313689527941599e-01   -4.195641745486852e-01; +6.362661160402587e-01   +1.956028703062082e-01   +3.782309926013267e-01   +4.294423862531171e-01   +4.660347825101255e-01   +2.928526677624720e-01   +4.326027484866597e-01   +4.686276330558254e-01   -3.565741322468181e-01   +4.225036019867786e-01   -1.468176318757510e-01   -1.771652420048780e-01   -3.630343508163708e-01   -6.600443813802116e-01   +6.321913789719721e-01   -1.370862118670258e-01; +5.190285838110601e-01   +3.283812991235989e-01   +5.730697638354674e-01   +4.678839489196478e-01   +1.592827405071880e-01   -2.068472094787066e-02   -2.881678794492744e-01   -1.831493250530067e-01   +1.365038645647833e-02   +6.537758682864396e-02   -6.324626554732193e-02   -5.559033498527967e-01   +1.424295253686013e-01   +2.398797519514757e-01   -1.301372105742328e-01   -2.778255327239865e-02; +3.784068621119654e-01   +5.509304706727524e-01   +3.043154851256876e-01   -4.754504292642994e-01   -1.597800691314414e-01   -4.487136754338660e-01   -2.307933151804190e-02   +4.689465921979422e-02   -2.644722489832642e-01   -2.157406328694094e-01   -5.791744317967488e-01   -1.985650878633236e-01   +3.280821114816909e-01   -4.328161494051465e-01   +2.040591843967396e-01   +1.101838025237006e-02; +4.557690385872446e-01   -8.017399919180129e-02   +4.231013143289992e-01   +8.171336047526542e-02   -6.999957969376015e-01   -2.841742792521555e-01   +8.986073993918096e-02   +9.697321170368564e-02   -2.455733910017044e-01   +3.594354480407448e-01   +1.379381885092060e-01   -1.719809376158566e-01   -7.633830157687602e-02   +9.368705010906336e-02   -3.316547571011752e-01   +3.980423411372420e-01];
L1E_L1I_iGABA_netcon = [+6.498709382545549e-01   -4.838806132447312e-01   +3.579657257036369e-01   +1.381967167970585e-01   -3.152974872074132e-01   -2.295354075055724e-01   +1.966359660352682e-01   -3.026353115925829e-01   -1.480886960816428e-01   -1.626355354599425e-01   +3.233210450629228e-01   +2.227123629532083e-01   -1.003975264537342e-01   +5.645828783969800e-02   -4.372235962722447e-01   -2.644231319421532e-01; +1.764835709533610e-01   -2.182178054238628e-01   -7.391537105667059e-02   -2.299418274628092e-01   -4.742377774017357e-01   -2.120195212345957e-01   -2.908382576555205e-01   +2.652956283092177e-01   +7.698630229664507e-01   +4.780398026120783e-01   +1.650857897362036e-01   +3.162440995982256e-01   -2.344834827367546e-01   +8.600930603535178e-02   +1.148149051293717e-02   +2.170026258188169e-01; -7.084394392100872e-02   +5.010073177870401e-01   +7.621668589757022e-01   +3.946560210342343e-01   +1.670435041463180e-01   -1.277463237527793e-02   +9.065268796352920e-02   +2.003784926075194e-02   +2.732225709162903e-01   +1.044036589983883e-01   +1.389490179537312e-01   +9.453388419975196e-02   -4.314322998288682e-01   -8.052162077165179e-03   +2.389765911068639e-01   -2.063197636587416e-01; -1.822658073568177e-01   +2.556923189528378e-01   +2.645832639575216e-01   +7.279227379909663e-02   +1.705031766553576e-01   +2.887291485348437e-01   -2.410887330373267e-01   -5.336956072995183e-02   +2.446979293138371e-01   -2.615236241029974e-03   +8.559892827610702e-01   -4.082333781783664e-01   +4.069539808494035e-01   -4.438096407470683e-02   -4.449343566591698e-01   -3.667451656771871e-01; -6.458231594677126e-01   +1.124602160233239e-01   +3.608460775443932e-01   +1.658793340174523e-01   +1.569331268242547e-01   -3.674286745172536e-01   +1.287710582879463e-01   +3.540964837999602e-01   -1.352378124824396e-01   -4.061604572316456e-01   -7.531696507750714e-02   +8.726115540932154e-02   -3.810973015719224e-02   +4.014635959843909e-01   +3.100856727982935e-01   -2.961910608119109e-02; +1.565748428463258e-01   -3.099698701583476e-01   -3.235690629303897e-02   -1.483103688018956e-01   -4.114553543786547e-01   +4.147611257449393e-01   -4.771192087985653e-01   +1.760547553091288e-01   +3.206543352971688e-01   +7.133946956011875e-02   +2.246297141526399e-01   +1.424497336995238e-01   -3.299035006143616e-01   +4.787923203188393e-01   -2.608660964998993e-01   +5.933810272827409e-01; -2.908518848475640e-01   -7.763035676052465e-03   -4.695090970892701e-01   +1.434364037003117e-01   -3.046366884644867e-02   +4.838191036290678e-01   -1.205690344860339e-01   -1.608469616056210e-01   -5.444088412350077e-03   -4.694939949248566e-01   -3.778641145476844e-01   +2.985516061525034e-02   -2.352249580225240e-01   -1.599951671426433e-01   -9.848428925986287e-02   -2.399269068747773e-01; +2.439501940814030e-01   +1.923673497849571e-01   +5.176297010478126e-01   +2.015300033417246e-01   +2.214853014884688e-01   -1.707452304164530e-01   -3.385153010045306e-01   +1.522120028796933e-01   +2.992827622558553e-02   +4.261607090617615e-02   +2.507052685197218e-01   +1.949538334680551e-02   -2.366696851739724e-01   -1.685225800648509e-01   +1.984543422659184e-01   +2.277103432338980e-02; -5.427885584649927e-02   +2.115712216010873e-01   -1.525319542566484e-01   +1.611419744620799e-01   -2.861147628155368e-01   -1.793712953245944e-01   -4.576931390549742e-01   -1.007340025896708e-01   -1.348785918041095e-01   -6.099691722104730e-01   -3.630631002723838e-01   +1.618073887734598e-01   +6.616217118332816e-02   +1.377047906185687e-01   +4.707529677412257e-01   +1.700495379021622e-01; +4.230049712150806e-02   +2.451671168282235e-01   +1.965758897185240e-01   +1.519573579698591e-01   +4.538992317912479e-02   -5.573975099545684e-01   -6.676110130136177e-01   -3.635195494526343e-01   +1.398837803826622e-01   +2.189423240790515e-01   -3.157032104761645e-01   -9.295836622831526e-02   +6.096112784576049e-01   +4.402930298209674e-02   +1.183121841785127e-01   +1.887017623463259e-01; -2.385200101790156e-01   +1.185463974489542e-01   +5.265627309125526e-03   +7.856862991753180e-02   -9.016855490551062e-04   +2.905580148452999e-02   -4.787755345428849e-01   +1.331333990125126e-01   +7.593422983214859e-03   -1.239394411310940e-01   +1.335736310097554e-01   -8.205524606837501e-02   +5.564608786564494e-01   +4.857035013370964e-02   +3.212913988417368e-01   +2.679242213290734e-01; +3.493868723266537e-01   +2.646180827681773e-01   -1.490148197907176e-01   +1.264570673826692e-01   +8.490464928163387e-02   +2.467713831020465e-02   +4.896830246771280e-01   -3.665929807425051e-01   -8.270226118880231e-02   +6.096037705649252e-02   -5.560138380365218e-01   +3.377140217490999e-01   +8.971889718077088e-02   -2.461282607026674e-01   +2.162972838526977e-01   -8.810457816293256e-01; +3.849288457971107e-01   -2.071588778137909e-01   -5.224985709865579e-01   +6.202431295800019e-01   +1.102384882236051e-01   +2.213273923629542e-01   -6.162059196733194e-01   +3.243662404641144e-01   +4.204400593900489e-01   +2.731556725133282e-01   -3.115660864043870e-01   +4.411519766772108e-01   +1.519178819246793e-01   +2.847692707739778e-01   +4.071525355202670e-01   +5.756657558227369e-01; +3.966423783438924e-01   +4.148462793515331e-02   -2.344967309077344e-01   -3.462337993092942e-01   +1.450932719006353e-01   -7.088926417232078e-01   -1.177934443043921e-01   +7.803915633511273e-02   -1.787944028656149e-01   +3.087979035674738e-01   -3.674036712069894e-01   -3.513848184283692e-01   +3.603908619242797e-01   -3.767635726223946e-01   +4.749312360599188e-01   +6.168462798812566e-02; -5.272508633390988e-01   +2.653155279551002e-01   -7.272987726824698e-02   -1.709572260218536e-01   -3.472359985068545e-02   -3.218503798605988e-01   +3.138512555333915e-01   -7.326067684116067e-02   +1.251972341203181e-01   -6.685060386184807e-02   -5.660486276929312e-03   -1.861550725090596e-01   -5.337088364250475e-01   -6.140573751560285e-02   +4.048113314688386e-01   +2.370954503067751e-01; +5.154285138546731e-02   -1.572508183530145e-01   -9.892295077518910e-02   +1.948797008827757e-01   +7.026761653719223e-02   +1.169527622211394e-01   -6.407837936774410e-02   -6.472846608703509e-02   +9.854062855093576e-02   -3.366918046045935e-01   -1.309443732440154e-01   -1.024475185474800e-01   +1.656686198884648e-01   -2.680193849801501e-01   +3.507843610248501e-01   +2.110573755911544e-01];
L2I_L1I_iGABA_netcon = [-4.038239408223813e-01   -1.084577641721892e-01   +3.323865885332379e-01   -4.279612564359222e-01   -1.103066072479780e-01   -6.967584916527830e-02   -3.279217299765890e-01   +2.129995823351515e-01; +2.307124242003881e-01   -8.625099918385601e-02   -2.252691021684635e-01   -6.916240973877610e-02   +5.073995584228956e-01   -3.865779048294313e-02   +9.781202036586686e-01   +3.589619336257081e-01; +5.474261741214790e-01   -7.023479586056322e-02   -1.972882641888535e-02   -8.167769187924533e-02   +2.935170006312120e-01   +1.591185715913168e-01   -4.314450557377555e-01   +4.277301245279009e-01; -6.093992573675764e-01   +3.253080775713291e-01   +4.315845393214165e-01   -2.873651189531257e-01   -5.842283930891286e-01   -6.484693077298063e-01   +6.186868317994024e-01   -5.279998535933635e-02; -5.371179176715454e-02   -2.676846649511614e-02   +3.166853185671529e-01   -1.803338334167104e-01   -2.085213092101059e-01   +5.924789984797774e-01   +6.418004963080958e-01   -5.888614101002032e-01; +1.546436530754365e-01   -1.255824742178560e-01   +3.622466688091720e-02   -5.497449566355441e-01   +8.254574412979092e-02   -3.098234843604811e-01   -2.368971921966314e-01   -1.303308844039493e-01; +5.239603663577693e-01   -1.769897599599249e-01   -1.955254785694555e-01   +1.377809618551804e-01   +2.584301942851341e-01   -5.751126504281632e-01   +8.320973477277738e-02   +3.633916721007203e-01; -1.553664811138618e-03   -2.928690354846886e-01   -1.737620597524116e-01   -3.421708873173558e-01   +5.980283810997739e-01   +8.913553713484092e-02   +3.430705688782706e-01   -7.467934435546432e-02; -6.404871441634794e-01   +5.340005469612052e-01   -3.474044445226916e-01   +7.179248501473762e-02   -4.444011095428322e-01   +5.813552833220191e-01   -1.213733590339521e-01   -3.009888131446327e-01; -1.562251367207046e-02   +4.933014253421416e-02   -2.142355630119830e-01   -6.036887569208963e-01   +2.743089733153417e-01   +3.103253417082426e-01   -3.766206746009038e-01   +2.173817790704841e-01; -4.486606949360036e-01   +2.952127054731386e-01   +2.137871000836511e-02   -2.385342738579670e-02   -1.619644794297605e-01   +8.439036985413217e-01   -4.255978897414900e-01   -1.287000696398093e-01; +5.690809788859934e-01   +4.387169571078701e-01   +1.497838264992087e-01   +2.879713662963704e-03   -3.296401446211337e-01   -4.217057351786089e-01   -9.304332785009353e-02   -4.000007964056804e-01; +4.102095750660045e-02   -1.553044667845391e-01   +5.151626626310835e-01   -7.674239661332136e-02   +3.337736652702405e-01   -5.855903326381363e-01   -4.026015498783818e-01   +8.276300618448978e-02; +5.155757334996355e-02   -5.280442434091395e-01   -6.558892722320712e-01   +3.152363159090553e-01   +1.271038369419329e-01   +2.876043639608131e-01   +6.179964616529178e-02   +5.814892672777980e-02; +6.005926862652989e-01   -2.206179744471353e-01   -1.175312392918721e-01   +3.433456249954793e-01   -5.032669017072271e-02   +3.612906198485005e-01   -1.181586799322058e-01   -4.319879629927925e-01; +1.646275203729786e-02   -1.271836825401888e-01   +1.928004353080267e-01   -2.614247721229713e-01   +4.105439427971428e-01   -9.133983570479701e-02   +2.134742144750352e-01   +3.399086455542825e-01];
L1I_L2I_iGABA_netcon = [-4.831573554492747e-01   +2.743850553360793e-01   +2.331032365952417e-01   -1.094791199627177e-02   +2.792180606749813e-01   +2.660165548021457e-01   +2.438274019211626e-01   -7.328060915164555e-02   -1.952826497406009e-01   +2.735209188531856e-01   -5.488805614422578e-01   +1.567406359991276e-01   +5.101938396016800e-01   -3.332281984274492e-01   -1.223631405739435e-01   +5.282754738868904e-01; +5.665309608913940e-02   +8.177983724547663e-02   +2.799798716931381e-01   +4.906220293360255e-01   -2.126702794435629e-01   +5.588068279932490e-01   +1.250518824538129e-01   -1.523014773411373e-01   -4.157285688305452e-01   -4.635035881930044e-01   -5.631901944378230e-02   +5.820033743682469e-01   +6.773719192779171e-01   -1.506639426711739e-01   -3.330989218524389e-01   -2.941855996969508e-01; +3.728445901016279e-01   -2.749097176492696e-01   -4.206273539018534e-01   -4.333516112362230e-01   -3.762663840712906e-01   +1.502598199430966e-01   +3.757506488562292e-01   +1.222151593192338e-01   +1.675945766367929e-01   -2.492339886638443e-01   -8.295999854258305e-01   +1.233309611437354e-01   +1.817993542337767e-01   +7.010258934656775e-01   +3.978579274020497e-01   +1.436660219042482e-01; +8.563468695326940e-01   -2.338088657199800e-01   -3.941862021893786e-01   -4.703171074783341e-01   +8.674913242468031e-02   +3.308803217117132e-02   +1.629737812677841e-01   +1.063142961924634e-02   +1.709328561683313e-01   +3.048219738130820e-01   +7.548058978361665e-01   +2.854867395938320e-01   -2.730226881790460e-01   -2.411041141632373e-01   +7.489679974162192e-02   +3.877124483465541e-01; -4.476008059431419e-01   -2.628762226319697e-01   -5.461210210187786e-02   -6.179879124502867e-01   -2.126596070806963e-01   -2.150688639034729e-01   +5.464271882610658e-03   -1.949001164960960e-01   -4.591269202397100e-02   +2.311513533488492e-02   +7.484499672285333e-02   -3.281297628797384e-01   +1.358300185659702e-01   -5.555800909969599e-01   +1.987847728631410e-01   -5.010459976887544e-01; -3.108950029705778e-01   +3.650907598407481e-01   +2.319151585552278e-01   -5.403184474988378e-01   +1.435354979068149e-01   +4.165630764653154e-01   +3.050637510918680e-01   -1.059342099164567e-01   +4.257409607704198e-01   +3.369766424832953e-01   +4.105556143940854e-01   +7.324152526128389e-01   -3.640803027684943e-01   -2.785801858364835e-01   +1.363342525547414e-01   +2.103183644083138e-01; +8.819574923910711e-01   -4.313104760506509e-01   +8.516409315927030e-02   +1.659197282268700e-01   +7.124974243628094e-01   +2.081699075901657e-01   -7.728006017805691e-01   -2.468025537374807e-01   +2.803444062159804e-01   +4.641782613772969e-01   -6.215931242348702e-01   +2.236360764993638e-01   -2.793898433476427e-01   +5.429887476648142e-03   -3.228896929876541e-01   +4.035458818755859e-01; -7.939097111755228e-01   -1.327106995485145e-01   +6.693475726183991e-02   -1.157684486809931e-01   -3.604697571998983e-01   -7.103814613778405e-01   -1.404782812765101e-01   +3.060818316694469e-02   -6.439281786553218e-02   +2.883895453134435e-01   +8.856304346306519e-02   -3.415077323528855e-01   -1.846064001291162e-01   +3.637204554134128e-01   +7.795122364673339e-01   +3.734977344114708e-01];
L2E_L1E_iAMPA_netcon = [-1.288924473482198e-01   +2.465183144020675e-01   -1.244106286338632e-01   -2.733099473951431e-01   -1.746398993671510e-01   +8.000561432867842e-03   -2.374336917712411e-01   -1.056599295380334e-01; +3.012497163381905e-01   -3.858691379933235e-03   +1.837788127114566e-01   -7.423403144307894e-03   +7.090594095418704e-02   -3.898297783169620e-01   +1.547696207774746e-01   -1.572202625268227e-01; +5.900234867634810e-01   -1.349984139745090e-01   -8.793320494966544e-02   +1.466921522662453e-01   -1.080028098276244e-01   +2.290401078822820e-01   +7.648048262370262e-03   -1.539522180511849e-01; -6.690166004724165e-01   +6.198268918735593e-02   -1.423758286379406e-02   -2.590504774285509e-01   +3.511630964647852e-01   +6.514623871092565e-02   +9.811837063815693e-03   +8.083587257262242e-02; -4.505905569583217e-02   -4.137169021530398e-01   -1.215074091040375e-01   +6.109897584551984e-01   -1.562389039024475e-01   -6.657350443371313e-02   -3.793110153971628e-01   -5.350068807615682e-01; +1.193394365444115e-01   -9.507404711286202e-02   -2.803497537773700e-01   +2.658155676864769e-01   -9.189498792056083e-02   +5.433281054796806e-01   +1.643065660611662e-03   +1.560025255960805e-01; -3.074082043264331e-02   +8.915321678383888e-02   -2.996999901976591e-01   +2.096661048653969e-03   -3.541021981739293e-01   +4.280457423287563e-01   -4.836329601584547e-01   -1.411664005717503e-01; +1.522117881523436e-01   +2.882941689207101e-01   -2.744903459679644e-01   +3.989249612578526e-01   -1.266779858976960e-01   -6.852464176326402e-01   -1.792281570158830e-02   +2.814201367815156e-01; -4.860711067535075e-01   -9.360739314580978e-02   +2.663589869128338e-01   +2.965529794599188e-01   +4.886692462062197e-01   -1.032863430708326e-01   -3.042650585868223e-01   +3.700674270886715e-01; -1.187367337461254e-01   +6.627970166776438e-02   +4.472873960690171e-01   +8.404368538276567e-02   -8.364233359888858e-02   -1.395008272315820e-01   +3.212433436775852e-03   +2.899859501781130e-01; +1.592664018057409e-01   -1.602274456517450e-01   -1.381492754757267e-01   -3.206857632347849e-01   +3.369459020014631e-01   -3.185725690296329e-01   +2.257396768045532e-03   -4.211840203203315e-01; -7.243879656768368e-02   +2.591714816108424e-01   -1.845963032328525e-01   +1.130416199921121e-01   +6.947924681633335e-01   +7.907544038686293e-03   -1.046794845987126e-01   -5.839716102694701e-01; -3.347269522301599e-02   -5.026489382262199e-01   -1.574086741582605e-01   -3.708294886697552e-01   +6.819306014733346e-02   -2.222125934840097e-01   +6.459957767020353e-01   +9.972286727892020e-02; +2.052594078454638e-01   +1.539812348978826e-01   -5.912494556176336e-01   -2.840601411065868e-02   +2.673310247498492e-03   -2.374824820406463e-01   -3.343889137255859e-02   -2.819398086068444e-01; +1.096683794303854e-01   -1.723646052165203e-01   +2.618058670368097e-01   +5.865095023133799e-01   +1.553579869013602e-01   -1.596834787532755e-01   -1.247869423024629e-02   +3.582841015029594e-01; +2.132469341545071e-02   +3.267975065000037e-01   -3.792813320423866e-01   +6.903855296933496e-02   -2.623562867835154e-01   -1.733671744964266e-01   -2.880951928524906e-01   -3.777436916594505e-01];
L1E_L2E_iAMPA_netcon = [+1.898521138592388e-01   -4.714217307068626e-01   +1.184908786913835e-01   -1.228033851944400e-01   +3.218691355918772e-01   +3.295900596354684e-02   +2.145377416078214e-01   -3.533301127074958e-01   +1.280827169111657e-01   -2.453763099785374e-01   +4.519115560769577e-02   -4.482232042296620e-02   +8.492094580023871e-02   -2.969082338364137e-01   +3.754273278237080e-01   +2.109853981116991e-01; +1.441910790383581e-02   -1.121987169474472e-01   +7.021296158867218e-02   -2.884844178283708e-01   +5.418654938249738e-04   +6.962469147382230e-01   -3.711319649818674e-01   -1.059377748098085e-01   -1.053689765284654e-01   +5.206751103518961e-01   -8.816356315288965e-02   +2.767866424217572e-02   +4.195568021492345e-02   +1.094705682019892e-01   +6.149370555325494e-01   -1.213943168059384e-02; -7.153022396142465e-01   -4.129814228374071e-02   +4.783863209533201e-01   +8.547696187214848e-02   +2.258170808814556e-01   +5.817330246696839e-03   +7.426185548995191e-03   -2.559972178000431e-01   -4.377161657388609e-01   -2.104309229489081e-02   -3.408482965253149e-01   -8.771657707442654e-02   -4.022506908429666e-01   -5.733633861110242e-01   +1.182513330109901e-01   +1.570651633264324e-01; +3.186286501083234e-02   -2.000146670995788e-01   -1.661493764075867e-01   +1.885102686957621e-01   +8.358350469723848e-01   +4.299621801039274e-02   +2.711115989722263e-01   +1.800129613856172e-01   -1.736339162184949e-01   +2.412121583291746e-01   -1.283893041177088e-01   -3.827771640342144e-01   +1.417405045007240e-01   -5.159121510640848e-01   +3.603796259660315e-01   -1.633008256554742e-01; +3.271625080170388e-01   +1.435815060915395e-01   +2.172957863875946e-01   -2.438686635375790e-01   +1.324937818673521e-01   +2.915017983271542e-01   +2.351212714566119e-01   -2.011246582453788e-04   +1.869502043169380e-01   -4.735060998736882e-01   -2.343900729407243e-01   +3.314138742621538e-02   -4.987870284053149e-02   +1.259668175361191e-01   +3.350027793192414e-01   -6.458256230335757e-02; +5.314266624326403e-01   -1.540374633016379e-01   -3.538231945451927e-01   +1.408125010103869e-01   -4.190337987020834e-01   +2.684970367548422e-01   -1.467237276756377e-01   -5.408932271112215e-01   -1.713087279613951e-01   +6.374626368418479e-02   -2.036948938763143e-01   +5.463099604895179e-02   +2.265688737450579e-01   -2.877317278236905e-01   +1.340655316468985e-01   +2.603777089479637e-01; -4.464837936345221e-01   -4.655184289344257e-01   +1.823323407983543e-01   -3.370984086521754e-01   +2.642715874032790e-01   -2.221762280548138e-02   -1.631383186515546e-01   -3.020632196409191e-01   +3.416875389922778e-01   +9.252966617813901e-02   -2.443293960357570e-01   +5.774502610596910e-02   +9.220455399975030e-02   +4.195009012887365e-01   -1.018167407104692e-01   +4.775610801113885e-01; -1.862289365718998e-02   +1.912015407570287e-02   -5.385675628126405e-01   +2.044506652493517e-01   -2.359608201519630e-01   -6.582258832534117e-02   -2.817604970205245e-01   +2.169629028756591e-01   -4.340997693204438e-01   -1.371010485452371e-01   +2.153338632737840e-01   -3.662498512444046e-02   +2.857418740330853e-02   -1.333398401060441e-01   +2.965318951966529e-01   -5.685853258063316e-02];
L2I_L2E_iAMPA_netcon = [+5.110911620632326e-01   +1.116881445376158e-01   -3.374517325349846e-01   +1.093195518033742e-01   -3.186831717085198e-01   -1.859387831816720e-01   -2.034754101583735e-01   -3.130274936100079e-01; -3.700871257332832e-01   -1.738477392017545e-02   -2.431704509952515e-01   -8.709484057856058e-02   +3.831162114115098e-01   -6.158693333109820e-01   +3.632074257837703e-01   +2.593336892421574e-01; +1.957405514783550e-01   +3.064704291875906e-01   +2.361389845838774e-02   +2.575330325492220e-01   -3.904761984254235e-01   -5.535550262864938e-01   +3.859069341002959e-01   -5.235465457527017e-02; -8.676610339881499e-02   -2.767930481096377e-02   +7.452149414404283e-01   +4.791464435240144e-02   +2.300525397923495e-01   +8.311905360756061e-02   +2.126831407923317e-01   -3.143252964560509e-01; -1.012204295635873e-01   -8.694032618389785e-02   -3.987614810479063e-01   +1.577171807536362e-01   -2.815528500709222e-01   -3.240352250446803e-01   -3.518573497586408e-01   -1.314527084402459e-01; +3.908384910623676e-01   +2.519189469089881e-01   +6.047243566865190e-02   +3.579043700325832e-02   +1.828052044782931e-01   -8.420742759825330e-02   -2.509137330927490e-01   +6.089744589077808e-01; +2.621360310215104e-01   +8.450069476114082e-02   +1.497139423247865e-01   +4.288241997506519e-02   -6.138106575871947e-02   +3.710869622084882e-02   -1.113941766763797e-01   -2.500458641198947e-01; -1.561886655740363e-03   -5.360149721119380e-01   +1.210935399978454e-01   +3.124551986261162e-02   +5.718598076620495e-01   -4.660397408364610e-01   +1.787980324150791e-01   +4.265634692459712e-01];
L2E_L2I_iGABA_netcon = [+3.606293271880806e-01   +2.722656482764233e-01   -1.138981982167294e-01   -4.657283895722729e-01   -1.401018055196398e-01   -2.371187077098224e-01   +3.531085656045397e-01   +9.562658501519376e-02; -1.907361180723590e-01   +1.673164063025636e-01   -5.547799379823363e-02   -2.097178831433183e-02   -4.775076552402024e-02   +5.415282116725465e-01   +4.673831785337350e-02   +3.777729480295504e-01; -5.494024926637239e-01   -2.128743187511109e-02   -3.007040594889713e-01   +4.914897719325141e-01   +1.328723286446623e-01   -2.907043954044620e-01   +2.736394342796294e-01   -4.386551140666093e-01; +1.575931631100206e-01   -2.338762042140044e-03   -4.085970365583379e-01   +2.674807688956125e-01   +5.429605954700519e-01   -2.945146666888933e-01   -3.643553674213336e-01   -9.298189251740729e-02; +2.959782409501707e-01   -1.983646612077613e-01   -1.332304141543909e-01   +2.273018201163253e-01   +7.293630217596073e-02   +6.865584625071121e-01   +6.519819009340705e-03   -2.829743119681450e-01; -7.596700728208812e-01   +2.197747465078478e-01   +4.914401472631379e-01   -5.467141225124701e-02   +2.073076537618697e-02   -3.911648483177403e-02   -6.026564446504049e-02   +4.898077074029372e-01; +7.758161347550220e-01   -2.968597491134157e-01   -1.645828453394831e-02   +3.842936242680022e-01   +1.072601097539566e-01   -3.127974235924009e-01   -3.862199960633694e-01   -5.667456593858770e-01; -4.490556609205256e-01   -2.028187286367004e-02   -5.008568622385259e-01   -2.739426330258713e-01   -5.069619863471451e-02   +3.223829030486417e-01   +6.130833791963781e-01   +1.665892106080783e-01];
L3E_L2E_iAMPA_netcon = [+5.786715594578398e-01   +8.842278488229238e-01   -4.002977635185401e-01   +2.026178781517211e-01   +1.451858772619321e-01   +2.031922724210506e-01   -6.053484209135476e-01   -1.211521817365456e-01   +2.741691776566239e-01   -4.726224469400106e-02   +2.242620615210106e-02   +6.314240446397794e-01; +4.846885926955094e-02   +6.485501878475123e-01   -4.167970793545842e-01   +6.404858275220889e-01   -2.704385643803109e-01   +1.737529748867749e-01   -5.449189161500785e-03   -2.059351315248089e-02   +3.697783979616496e-01   +8.929303361303012e-02   -1.957308814845713e-01   -3.208831234470753e-01; +1.629432095094351e-01   -2.437825534225990e-01   -1.409821727753460e-02   -1.047426911463394e-01   +3.197059620963232e-02   +4.160716384630855e-01   -2.899715187602481e-01   +3.250006333310558e-01   -2.456179332581330e-01   +2.247070973305819e-01   +4.742935868341946e-01   -2.109833886018374e-01; -6.917464506065593e-02   +1.977389877847585e-01   +6.385280231144077e-01   -2.732554561569121e-02   +9.028210265533398e-02   +2.903803289188114e-01   -1.414506570152476e-01   -3.671964867040543e-01   +2.656827472698677e-01   -4.217194764351432e-01   -6.458241639036960e-01   +2.621552965588345e-01; +4.223851000001450e-01   +1.011641084206762e-01   -1.959669117563475e-01   -5.197028944433578e-01   +4.742248456198233e-01   +5.095892922840675e-01   -2.578799455585862e-01   +3.281573948428823e-01   -3.474302906894966e-01   +2.460591225367912e-01   -1.475001810732960e-01   +2.925985718825088e-01; +4.886095438138752e-01   -2.524762386293819e-01   -8.461144047083519e-01   +3.685902418678916e-01   +1.159268730226220e-01   +6.195895409322300e-02   +2.867536662939174e-01   -8.056064321587555e-03   +2.133347381598158e-02   +3.714602630047855e-01   -4.910837663334583e-04   -3.567622260336685e-01; -1.246137754617849e-01   +3.873112548168050e-01   -2.047774746280604e-01   -7.870498080135544e-01   +3.594572258872951e-01   -4.662872600234780e-01   +9.688609889553675e-03   -1.761258033443890e-01   +6.248694849352988e-01   -3.524230519980333e-01   +9.259092886178208e-02   -6.171998238537992e-01; -3.687320036797809e-01   -1.132771783399248e-01   -5.250800901188389e-01   +2.644177049056821e-01   -4.144137255196258e-01   -5.447337907006233e-01   -5.651468396229355e-01   +1.413540076414495e-01   +7.364593013120545e-01   -3.558611914689106e-01   -9.901650750377108e-02   +1.070646925690331e-01];
L3I_L2I_iGABA_netcon = [+7.020071540214203e-01   -6.971733945498942e-02   -1.448838989366433e-01   -3.508779921121994e-01   +4.527053804225696e-01   +8.585021864101912e-01   -5.115321779976715e-01   +4.342950564138406e-01   +4.086102654760075e-01   +6.734001112379626e-01   -4.994526368605611e-01   -3.575193817584779e-01; +4.092110696792653e-01   -5.390270380776792e-01   -3.761625837939768e-01   +3.615271694517777e-02   -2.923661119425593e-01   +3.478213464588306e-01   -2.304231836068174e-01   -3.084235134368663e-01   +7.124488383491710e-02   +3.751912804072629e-01   -2.854259869020397e-02   +3.206484182758519e-01; +1.224866273688089e-01   +1.165407945436930e-01   -3.284347163734442e-01   -2.843994415348444e-01   +2.635618531872108e-01   +4.532372715197573e-02   +8.812602720686293e-02   -7.566950419248372e-01   -6.749068616519112e-01   +6.014483251606326e-02   -6.016621529985672e-01   -9.235404287861890e-02; +5.873023039796172e-01   -3.759115842034443e-01   +7.590106493695135e-01   -3.738398835706233e-01   -2.729884743025216e-02   -4.973385854313999e-02   +2.680549288378014e-01   +1.524559342650344e-01   +5.498581299167457e-01   -4.954931947194336e-01   +1.762543976287772e-01   +1.654026013729734e-01; +5.040180387935718e-01   -7.515177304121261e-01   -1.190460268764010e-02   -4.200160679141181e-02   -5.850791580985744e-01   +5.993771260841784e-01   +4.491450576847653e-02   -1.246931810298036e-01   +3.161675002252837e-01   +7.251583902447483e-01   +4.476364117513548e-01   +4.987077418939120e-01; +2.978084470627240e-01   +5.084841432563869e-01   -8.602730474711463e-01   -1.844835308933064e-01   -3.497580020898938e-02   -1.282411709699671e-01   -6.005203549755556e-01   +2.123876034324435e-01   -2.358560086353848e-01   -8.445906513058934e-02   -3.380199918700495e-01   +6.481439708820362e-01; -2.524398228442712e-01   +4.138732954698257e-01   +5.555873102754250e-01   -2.452320542321530e-01   +1.070238517970626e-02   +9.956717334780790e-02   +3.024580905661104e-01   +1.315242821098317e-01   -6.408932846606082e-01   +7.476884254903958e-02   -1.498110756225398e-01   -3.179171806478712e-01; +2.212096230498271e-01   -4.078401276408868e-01   +4.882494265063241e-01   +8.962505224300384e-02   +4.054247034255470e-01   +1.270162046215965e-01   +1.243297040771438e-01   -2.127433234633994e-02   -3.133721370613559e-01   -1.729777176226407e-01   +7.354077174679484e-01   +1.801514406194390e-01];
L2E_L3E_iAMPA_netcon = [-8.872063522329052e-02   +7.503484588329680e-01   +5.285907822604374e-01   -2.076122054570237e-01   -9.714283540667801e-02   -1.949378035527998e-01   -3.033548981841072e-02   +4.381790786377751e-01; -1.497750274693834e-01   -5.526303964715135e-01   +6.034745489944260e-01   +1.262104099079795e-01   +5.176789193105500e-01   -1.390775452964160e-01   +3.691318127052816e-02   -1.252199164700101e-01; +8.714898925162698e-01   +8.043419983226535e-02   -2.413101798083863e-01   +5.066975896320567e-01   -7.449383760699230e-01   +3.010398817306219e-01   +1.623881386876289e-01   +9.026823049181376e-02; -2.016800655818756e-01   -9.697987005760253e-02   -7.368396408492278e-02   -5.085541428725651e-01   -1.843937781105492e-01   +3.987791142163182e-01   +1.876912425972380e-01   +6.471465247339994e-01; -2.763645814556158e-01   -2.908421083966369e-01   -3.626367450898157e-01   +1.165561773017027e-01   +2.390757298810697e-01   -6.370637095123393e-01   +6.066497392527732e-02   +3.507172005389698e-01; +1.020376281918348e-01   +3.858559237142218e-01   +2.920187211880024e-01   -5.202028725946379e-01   +4.804738841919847e-01   -2.068634666800263e-01   -5.856870535760887e-01   +3.803843152741810e-01; -1.188221146093756e-01   -2.012863337392740e-01   +3.648185982094158e-01   -9.100785722593566e-02   -1.625371551530278e-01   -6.814692352988048e-01   +2.575052732434631e-02   -5.483128719634928e-01; +3.961401461170315e-01   +5.597557888510722e-01   +3.194249984184452e-01   -4.375862271285679e-01   -2.698722404595480e-01   +4.982200709637622e-01   -9.206420959199590e-02   +4.781386161173362e-01; +6.881176943780079e-02   +1.175656726640953e-01   +3.209779891792716e-01   -4.916737053399292e-01   -8.848555962524554e-02   -1.194665611830459e-01   -5.235313888600253e-01   -3.454660084881110e-01; -2.207771176372583e-01   +1.897250849466005e-01   +1.793818290062601e-01   -3.629108551649987e-01   -4.127639182391868e-01   +7.549251168958569e-02   +4.927846182662921e-02   -5.618148607775061e-01; -3.348926609466854e-02   -2.731381176356911e-01   +1.707988942816781e-02   +2.208097041611113e-01   -6.653009879565743e-01   +9.686461032979217e-02   -3.520762341224182e-01   +4.564044217010024e-01; -1.275049416881847e-01   +1.244382591017161e-01   -2.636721682294175e-01   +1.371868908981764e-01   -6.448627247821104e-01   -3.411163666419611e-01   +1.949792687804748e-01   -1.701016708441741e-01];
L2I_L3I_iGABA_netcon = [+1.406314918453631e-01   -2.994277907347483e-02   -6.231740205424975e-01   -6.313500767051347e-01   +1.970634165946510e-01   -2.657641858713365e-01   +2.662762992431850e-02   +5.855119035565712e-01; -2.187806669428834e-01   -2.316158107742072e-01   -9.282897064347305e-02   +2.871834939947138e-02   +4.959346927149277e-01   -5.285299491720905e-01   +2.102915175026970e-01   +1.268293416018755e-02; -6.514680968788163e-03   +1.603149643040755e-01   -2.685413773564969e-01   -1.709002450184801e-01   -1.831097477873672e-02   +1.639919256850365e-01   -1.868945514919029e-01   +5.611609862597525e-01; -2.438159391734250e-01   -3.891489804398936e-01   -7.530796210752734e-01   +4.232276508089644e-01   +4.154752272354126e-01   +7.623722122373747e-02   -2.880978491136981e-01   +3.999494349153820e-02; -5.433663260264177e-01   +1.368971560124839e-01   -4.301094520235460e-01   +4.522081726890991e-01   -7.615696737980961e-01   +2.780181619792627e-03   +6.783535815848007e-04   +1.100659825558746e-01; +4.825015263407276e-01   -2.751628313933679e-01   +2.333257195862734e-01   +7.208628414043142e-01   +5.069642238278373e-01   +2.883335097363695e-01   -3.186517238113959e-01   +5.865872622777976e-03; -4.063144838533119e-01   -4.956123475593558e-01   -3.365924411406047e-01   +8.127383779195319e-02   -3.206324882932101e-01   +4.970416617839318e-01   -1.766154270458908e-01   +1.950756375070310e-01; +6.277524812961000e-01   +3.762122975065521e-01   +1.584334571448424e-01   +5.772742384018653e-01   -2.395923100859010e-02   +9.020370443886137e-01   +6.884449243933335e-02   +1.398909495072209e-01; +1.646768104036800e-01   +5.073904002337623e-01   +9.655201643033070e-01   -7.538474901187003e-01   -3.836170929221017e-01   -4.677776458482037e-01   +8.758954159685536e-02   +2.129602236406894e-01; +5.674613659067079e-02   -5.185253952761500e-01   +4.145321984735028e-01   +2.722497386768454e-01   +7.536853901882631e-01   -1.156875804038572e-02   +2.144148129675831e-01   -2.945314365897809e-01; -4.919057059011564e-02   +1.164942594690541e-01   -3.564920757848808e-01   -5.118623761740091e-02   +9.984759292976859e-02   -7.067694617601858e-02   -1.148126484045493e-01   +2.190608359428325e-02; +2.627158478740500e-01   +5.536464306078176e-01   +1.162593676598128e-01   +5.233544717395174e-01   -2.350159052658241e-01   -4.055005733240410e-02   +1.014799628489402e-01   -1.536357242445909e-01];
L3I_L3E_iAMPA_netcon = [-3.946815027734105e-01   -7.228338344860544e-01   +1.443800432055992e-01   +4.928287304090674e-01   -2.652947619867557e-01   +1.224347947494754e-01   -3.842402494950820e-01   -2.359378940035045e-01   +6.656995876242894e-01   -3.820897065324058e-02   -2.553184747240403e-01   +3.122978651090614e-01; +2.123733960439399e-01   -8.797355527537855e-02   -2.547470783231838e-02   -1.847090986088444e-01   +2.345367487267107e-01   +2.180906411849262e-01   +4.104669783759328e-01   +2.873117222637746e-01   -7.204243260852025e-01   -6.011003835813011e-01   -7.390491217576055e-02   -4.656649928612299e-01; -6.494229071258530e-01   +4.979199267747790e-01   +2.832916109644599e-01   +3.126656656670755e-01   -1.335106840213196e-01   +4.842415387711447e-01   -4.153831916533308e-01   -3.460026504048720e-01   +6.129074874762628e-01   -3.134501691983543e-01   -2.599137236032377e-01   -3.758045204822369e-01; -2.918719848811915e-01   -1.979013701986223e-01   -5.461607001586086e-01   -3.818457637933050e-02   -4.069861386960197e-01   +1.705638937782410e-01   -8.770601502173346e-02   +3.667791241618696e-01   -6.427711214913897e-01   +4.711513986036139e-01   -3.725173427765119e-01   +2.377568350657554e-01; -3.589102362579157e-01   -2.189904976527241e-01   +2.912567611406461e-01   -4.927905630345836e-02   -1.540588632468788e-01   +4.231450275311993e-01   -2.251165280496748e-01   +1.250454003666298e-01   -1.598722173948157e-01   -4.589341083010808e-01   -4.819567404830788e-02   -7.493795265859364e-01; +2.742041058565838e-01   +9.846022777247335e-02   +6.195019020695418e-01   +3.130735412784941e-01   -1.276458061684784e-01   +4.731533113078116e-01   -5.121882849012828e-01   +1.627035985579098e-01   +3.542077644816485e-02   +5.058560775606614e-01   +1.626473517851128e-01   -3.326893851062688e-01; -8.702398616482157e-02   -1.070221714157676e-01   +6.697363778305253e-02   +2.547723579738416e-01   -2.794213387242309e-01   +2.673923873242032e-01   +3.357181580106172e-03   +1.414833754328925e-01   +1.541862749063498e-01   +3.318650611574456e-01   +4.611677647484674e-01   +4.093299851779019e-01; +1.443840111415488e-01   -4.660276657026513e-02   -3.635620136887771e-01   +6.891961589243706e-02   +3.455656835836937e-01   -9.091147978202423e-03   +3.026977451982371e-01   -8.065894122937048e-02   +6.272069287394961e-01   -1.044967865698167e-01   +6.981195689844871e-02   +1.054098907856808e-01; -6.785039696801811e-01   +1.203045499889365e-01   +4.626768618754196e-01   -1.779812107256460e-01   +3.433481695568622e-01   -5.060459220496166e-02   -3.756464688738388e-02   -4.351771865599904e-02   -2.378029559316156e-02   -8.223855159444614e-02   -1.855342223800920e-01   -4.790555747393769e-01; -1.665100054620307e-01   -4.603892499246484e-01   -4.531733386798385e-01   -2.432275998056957e-01   +3.152040039530308e-01   +6.671052886420308e-02   -2.911953581908748e-01   +4.630560939050672e-01   -4.891982032634520e-01   +2.353154907044225e-01   -8.348261711683994e-01   +2.554192574640267e-01; -4.304052489951310e-01   +1.782951516179294e-01   +3.082310231372710e-01   -3.677988836441220e-01   +4.083923218621996e-01   +2.480754551313286e-01   -1.441656115239307e-01   -1.814671180041936e-01   +8.197999316177551e-02   +2.001103763846783e-01   +3.927237165388183e-01   -3.151252884607538e-01; +1.666064641248450e-01   +1.114168530877386e-01   +7.649778439142462e-01   -6.078232883342172e-01   -1.180235151113608e-01   +2.688844449751199e-01   +1.272900208148154e-01   +7.396783092408442e-02   +3.203888037526581e-01   -6.547448853506179e-01   +2.949408968881888e-01   -1.137309149080594e-01];
L3E_L3I_iGABA_netcon = [+2.327042384021592e-01   +4.324992257172018e-01   -4.703928152039825e-01   +2.245074183207002e-01   +9.139488714661430e-02   +1.036574059254797e-01   +2.884695840082528e-01   +3.674324906103703e-01   +1.886246696251744e-01   -4.063268908786365e-01   +2.463229947575655e-01   +5.461896085598319e-01; -2.825220506850394e-02   -1.095307235193045e-01   -1.261552649366455e-01   -3.343404828580946e-01   +4.235859536018720e-02   -5.338470177270167e-01   +2.408461181826795e-01   -5.804000651613982e-01   +5.438833085497551e-01   -6.641306303969853e-01   +5.859799956842501e-01   -4.236777846272462e-01; +3.078074564883896e-01   +1.076888267400123e-02   -1.169595847675542e-01   -4.327821767307594e-01   -2.570378863832876e-01   -3.193608945962056e-01   -3.034497154958671e-01   +1.524332742084270e-01   -1.365805985491210e-02   +5.534760849852716e-02   -2.031339833421323e-01   +1.689538265307405e-01; +3.294172295836127e-01   +2.542468924290835e-01   -6.303043824888733e-01   -2.890940892519575e-01   -1.886430095764782e-01   +2.303965724899285e-01   +7.710724466311573e-01   -4.367684763703316e-01   +4.240410317672913e-01   -9.449908313424515e-02   +2.725973643881529e-01   -2.950540735384827e-01; -2.423295348517372e-01   -4.674406149637407e-01   +7.435066532731441e-02   +4.642680551837169e-02   +8.232531740708149e-02   +2.305513853943886e-01   -1.038565897268909e-01   -3.445270409368129e-01   -9.076040857389701e-02   +4.968233395813469e-01   -3.976137578526391e-01   +1.701808320359987e-01; -2.888370853545084e-01   -4.148042910380184e-01   +2.337796765831655e-02   +3.520631509258422e-01   -1.982320970540214e-01   -2.485857286530611e-01   +3.739747427238441e-01   -1.110423354062424e-01   -1.940433592126640e-01   +2.434102159160870e-01   -6.844791681715033e-02   -3.886135186626843e-01; +4.185318404548449e-02   -4.140705124567999e-01   -3.772373435945522e-01   +1.271114138666660e-01   -5.717143793345339e-02   -3.123117635213950e-01   -4.761550847309833e-01   -3.426270345699406e-01   -5.412281471461883e-01   +5.400532290997326e-02   -4.429605174630488e-01   -1.385514337728660e-01; +6.207241787586671e-01   +3.089225973318133e-02   -1.504560585963991e-01   +1.959939973124302e-01   -1.268849353298998e-01   -1.042297018958143e-01   -2.440308429573367e-01   +5.987219563894520e-01   -3.683358735401481e-01   +4.235906038143669e-01   +3.061031362117188e-01   -2.134906284373035e-01; -3.113066660222367e-01   -5.909129336977106e-02   +2.130113868636537e-03   +2.806770744105989e-01   -3.196328111977711e-02   -4.687936068937500e-01   +4.585190067678389e-01   +1.178518006668950e-01   +3.751276509007900e-02   +4.664464910831990e-02   +1.003537660086321e-01   -5.928646589980413e-01; +6.789784523136538e-02   +3.452428401578721e-01   -2.543423106099741e-01   +6.072496032539710e-01   -6.751546705007972e-01   +3.292626569626874e-01   -8.314038864771700e-01   -3.488082400696151e-01   -5.786827041413625e-01   +2.196676751806954e-02   +1.693123624352618e-01   +3.462911636041005e-02; -4.168500227848437e-02   +3.213512548090384e-01   -1.172537224278287e-01   +5.384054745652112e-01   -6.107877863407413e-01   -1.119920335088589e-01   -4.387423621067112e-02   +2.799514440247596e-01   +2.452608438323816e-01   -2.679111499320947e-01   +3.353081767440328e-01   -4.682933381982056e-01; -2.227861563396115e-01   -6.387687320048384e-01   +1.607874336994892e-01   -5.282504646871692e-02   +2.445870974466363e-02   +3.907185605923432e-01   -1.122047553893536e-01   +2.635573666210567e-01   -2.199900907643623e-01   +5.586792029630654e-01   +5.386710164479902e-01   -1.803912030890572e-01];
L2E_Input1_iAMPA_netcon = [-4.976911244632335e-01   -1.274317677337587e-01   +4.312856484719207e-01   +5.404319291884616e-01   +2.379458689922490e-01   -6.856810121679907e-01   +2.246156379640442e-02   +2.303600165623501e-01];
L2I_Input2_iAMPA_netcon = [+3.563955395946575e-01   -9.271311516025025e-01   +6.411016598148834e-01   -5.269523409594429e-01   +4.018866483017245e-01   +2.633823504326698e-01   -8.014867518424859e-01   +6.200407425675539e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
