function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.096904145580533e-01   +6.871844748477215e-01   -7.319935645019286e-02   +5.742787542017361e-01   +4.201723552388326e-01   +3.449213973659129e-01   +3.656603793937458e-01   +6.975026571802392e-01   +3.480897166460132e-01   +2.619678567394035e-01   +2.753225637859335e-01   +4.349531980982143e-01   +5.588636260507535e-01   +5.006309105871160e-02   -7.512481003242734e-02   +1.767086857156330e-01; +8.471692335376975e-01   +4.452948836871320e-01   +6.789539969137245e-01   +1.222752738886963e-01   +2.364119742014358e-01   +1.507786817504842e-01   +3.040272670569508e-01   +3.017277350710277e-01   +4.223684435938960e-01   +6.131749598451728e-01   +1.619130670940065e-01   +2.881491280978892e-01   +6.371034544680156e-01   +6.678501883161189e-01   +5.306927419490334e-01   +1.589780684449780e-01; +2.206462859720318e-01   +3.993627832102543e-01   +3.637110845064638e-01   +1.796172228099149e-01   +3.771688218039100e-01   +1.732563565980582e-01   +1.188858602294183e-01   +6.789687294666518e-01   +1.890227203342223e-01   +2.580278817919416e-01   +7.983250701325845e-01   +5.270455842718120e-01   +6.676387335479649e-01   +8.322080013606746e-01   +1.941756901556593e-01   +4.696058507052079e-01; +3.926177630988335e-01   +8.901693146828193e-02   +4.096546882514002e-01   +9.425948641964020e-01   +6.724613618898556e-01   +7.622050262183342e-01   +5.192499825547916e-01   +3.969439049118583e-01   +1.103970919182605e-01   +1.058115746183728e-01   +5.530485780494833e-01   +4.982433664105608e-01   +1.979728771520168e-01   +5.649193534544893e-01   +3.942924797680444e-01   +7.372548804069834e-02; +5.416334849531785e-01   +5.241493215781817e-01   +5.386537262953320e-01   +2.075845747879104e-01   +1.655312601198343e-01   +7.978584087786350e-01   +6.680859705267561e-02   +2.176393077632048e-01   +5.464158839252135e-01   +5.219399531003831e-01   +4.063266240736818e-01   +3.829238073256811e-01   +7.764925905032011e-01   +5.452618057156574e-01   +7.912108316506767e-01   -3.866265483317739e-02; +1.665125148820719e-01   +2.088396321295285e-01   +4.449495157947093e-01   +1.625413737826762e-01   +6.583966539193310e-01   +1.341313028215172e-01   +6.819883215174227e-01   +2.630378758508216e-01   +1.765508932580658e-01   -1.163552527726573e-01   +4.878207322285446e-01   +6.443970159949122e-01   +2.541050606296815e-01   +5.601831475239667e-01   +5.795396046145165e-01   +1.611579714994107e-01; +3.495327266802860e-01   +6.634124777906294e-01   +1.700595908267988e-01   +3.494893559168931e-01   +4.032771751518499e-02   +4.595091127709899e-01   +7.380353678069776e-01   +6.811232902734843e-01   +7.157647507658083e-01   +7.470709009125318e-01   +5.959087429953701e-01   +5.293397514540197e-01   +3.262372621605802e-01   +1.563567079444309e-01   +3.290085695838236e-01   +1.533783795516312e-01; +2.960121086608666e-01   +3.647839707272830e-01   +1.340178714645096e-01   +7.476313311535809e-01   +6.429104008358630e-01   +1.743166181974979e-01   +3.308815682130416e-01   +1.810239877257041e-01   +4.433388826380206e-01   +3.442227523050356e-01   +8.658516065354115e-01   +1.000000000000000e+00   +6.438607994401510e-01   +1.995220326685670e-01   +5.150064888703454e-01   -1.568126772081906e-01; +1.925175171771679e-01   +4.193906064427707e-01   +2.452003696260045e-01   -5.372098320141182e-02   +2.060066672099287e-01   +5.430905450921344e-01   +5.780304845597648e-01   +1.728399601284658e-01   +2.096711047359400e-01   +3.460647483295783e-01   +4.424231796422677e-01   +3.252411097441963e-01   +7.467820824694118e-01   +5.780673661535002e-01   +2.743798187237299e-02   +4.250655803109484e-01; +4.037069047451299e-01   +3.037260943625712e-01   +8.062863723502890e-01   +8.802962475622470e-01   +2.473978262039336e-01   +6.433092080918837e-01   +1.630539579595801e-01   +7.550385790690048e-01   +4.540994428952588e-01   +4.498455141318111e-01   +2.798082299444585e-01   +6.974548126386184e-01   +4.533846010794721e-01   +6.070352534474857e-01   +4.447820918813614e-01   +3.945853352270752e-02; +2.054487241750276e-01   +8.347395280866448e-01   +6.107792799605554e-01   +2.134235488781731e-01   +6.485202083488084e-01   +6.240124912234262e-01   +1.762529048393285e-01   +2.125471313279698e-01   -1.130917556127675e-01   +8.717623127945412e-01   +4.537686626081208e-02   +3.800671177547440e-01   +6.244796857874689e-01   +1.319641518310633e-01   +4.016456533191921e-01   -6.414655167871101e-02; +3.363650995012614e-01   +4.638404974832716e-01   +6.352689949835525e-01   +9.609395333117492e-01   +2.583834382879039e-01   +4.848812910415480e-01   +2.194637682744914e-01   +2.308494392484720e-01   +3.624936462321680e-01   +3.021706515984069e-01   +8.741478726915264e-01   +4.645767084582736e-01   +1.999683425960842e-01   +2.776449237583054e-01   +5.790548714979648e-01   +3.522202039327528e-01; +4.538777305830305e-01   +5.248421672922832e-01   +5.837413246042547e-01   +5.873225805584270e-01   +3.776311983018629e-01   +7.200873884565021e-01   +6.754164179253638e-01   +4.158238414091205e-01   +5.761763452491678e-01   +5.398175339823104e-01   +4.167176898439711e-01   +5.080271177949198e-01   +2.703286160226080e-01   +4.839729869111692e-01   +7.190136536275096e-01   +4.230889082688775e-01; +7.983705649160727e-01   +8.815110062697233e-01   +4.588012144159266e-01   +3.783471091407169e-01   +5.127149177292937e-01   -6.757006450669018e-02   +5.188413643516908e-01   +5.492659645303331e-02   +4.438723585906331e-01   +5.433054811515705e-01   +1.509650340466767e-01   +1.891375517318891e-01   +4.918100370437543e-01   +4.523590672429224e-01   +2.485372435513709e-01   +6.427927409251691e-01; +5.244190004484774e-01   +5.120110917662458e-01   +6.992628182101478e-01   +2.707489175673994e-02   +9.942676758227274e-02   +2.984493559598882e-01   +5.187029119871386e-01   +3.198040774198174e-01   +1.563385642742816e-01   +3.172190996105544e-01   +4.334471356314378e-01   +6.265649848093309e-02   +6.847804122614006e-01   +4.335991506234254e-01   +6.340937600095663e-01   +5.120510586395682e-01; +1.340433938683754e-01   +6.897867465307436e-02   +2.318799208753665e-01   +1.153780120295902e-03   +4.998948113413095e-01   +8.499728648171816e-01   +5.754786501806295e-01   +6.734290703526359e-01   +1.950300281642053e-01   +2.706988921618474e-01   +3.170007995986297e-01   +5.372173641504789e-01   +4.997077161351461e-01   +6.143839732532930e-01   +5.779620504376783e-01   +2.572976022554929e-01];
L1E_L1I_iGABA_netcon = [+6.943594501716766e-01   +6.067582187618206e-01   +3.339830339616826e-01   +4.911879544710262e-01   +5.785811458006519e-01   -4.206149247275093e-02   +2.385442521773230e-01   +5.273560040470199e-01   -1.529898978768004e-02   +3.027576872178982e-01   +2.699108129619822e-01   +7.092972714467088e-01   +5.195347148925866e-01   +2.648984708381510e-01   +3.024903405123000e-01   +8.903801653216322e-01; +3.306605548544000e-02   +1.633237573974224e-01   +4.710751756912793e-01   +4.343774123479190e-01   +5.464731934437109e-01   +7.826680743497854e-01   +8.912906370778352e-01   +5.795039880511447e-01   +1.442074528870948e-01   +3.588318350219788e-02   +4.050700160906506e-01   +6.912763320643637e-01   -2.612792778791078e-02   +8.418937955799176e-01   +6.195006642843931e-01   +5.570979145745750e-01; -4.268690716930499e-02   +2.908874082964280e-01   +4.140513842070406e-01   +5.637040064940542e-01   +3.867573915170102e-01   +6.138356193263437e-01   +4.165819243350736e-01   +4.963826365542396e-01   +6.278452241233680e-01   +3.158792316514269e-01   +4.394148573445314e-01   +2.915389539845087e-01   +8.592849383469764e-01   +6.977048193982067e-01   +5.646402958285902e-01   +7.049229562414790e-01; +1.485615481251386e-01   +5.847817541605110e-01   +8.896710117678520e-01   +3.939659253410300e-01   +1.125336203470687e-01   +2.107760879792775e-01   +2.444899964458687e-01   +4.527310512911926e-02   +6.619603305888517e-01   +1.265686330300751e-01   +7.862949714100576e-01   +2.054135732868785e-01   +5.344379544397621e-02   +5.506731723162791e-01   -2.393019378728626e-02   +2.833047397125035e-01; +6.623362039670679e-01   +3.437330466546464e-01   +4.205666804173075e-02   +5.802532523701801e-01   +6.840879168077018e-01   +5.124932605213056e-01   -3.568161834043611e-02   +3.001895597697664e-01   +3.502609379364465e-01   +6.515989482084319e-01   +4.487112640893804e-01   -2.689054794795152e-02   +2.754365416089470e-01   +6.865857219577327e-01   +5.462636301891007e-01   +3.900569337058743e-01; +2.723147598769632e-01   -1.189153881104906e-02   +8.513671926681304e-01   +3.847678935216185e-01   +1.059260445701524e-01   +2.625967569655952e-01   +7.493717183588962e-01   +1.124237605044278e-01   +4.987828645511703e-01   +5.703924985230159e-01   +4.614283904098477e-01   +5.258824454913229e-01   +1.485271696856414e-01   +3.233293339344139e-01   -1.991357714139279e-01   +6.504662224896854e-01; +2.017032601002192e-01   +4.196147047685047e-01   +2.985493551377384e-01   +5.704079273988351e-01   +5.455364127758463e-01   +2.007993096573441e-01   +7.907351794158421e-02   +1.555080306347904e-01   +8.430024380247225e-01   +2.937589593977696e-01   -8.897002509034113e-03   +8.780894074574579e-02   +6.508281455844438e-01   +6.501784379764087e-01   +4.840920379324142e-01   -1.834545646189319e-01; +7.736360649154933e-01   +4.749543714510738e-01   +3.236519743921218e-01   +2.804570115658110e-01   +4.227359989253754e-02   +4.593319069682872e-01   +2.501294769106783e-01   +5.935953402816221e-01   +2.147816323482423e-02   +8.144755739485406e-01   +7.162061083707298e-01   +4.536058024702894e-01   +4.813379817698023e-01   -1.951242705120107e-01   +6.608973555643787e-01   +6.959423811717989e-01; +4.945338655832264e-01   +5.120309039679544e-01   +7.406383743011097e-01   +2.864092521446746e-01   -1.742104435723423e-03   +7.616737736183947e-01   +3.686715228327295e-01   +4.374719538896190e-01   +1.000000000000000e+00   -5.247556621958547e-02   +4.805658862092522e-01   +3.557247495450422e-01   +6.673512499221722e-01   +4.854828764179297e-01   +1.757037599105547e-01   +4.796495630048849e-01; +6.935148936810337e-01   +3.405180921104773e-01   +6.220863773117009e-01   +6.457997862867281e-01   +2.669750430216464e-01   +4.532685309768563e-01   +2.485461571814441e-01   +4.675100196331311e-01   +5.205114266935154e-01   +7.804017892630465e-02   +6.612224631925725e-01   +9.376967697881368e-02   +7.977689650265145e-01   -3.629291839248019e-02   -4.008393418296805e-02   +2.969310313404243e-01; +2.482133743008227e-01   -1.043656042571619e-01   +4.870530055263339e-01   +3.174904225529256e-01   +4.626777328129232e-01   +2.742317468559728e-01   -1.198826386361722e-01   +4.443517576919241e-02   +2.679766366019996e-01   +1.828812921749478e-01   +1.858486660482633e-01   +2.314129478900416e-01   +8.671021948549027e-01   +6.885196514382382e-01   +2.933501488905851e-01   +6.950588318647656e-01; +4.109249145389068e-02   +9.252338632916808e-01   +7.076796215517309e-01   +8.061555071238560e-01   +6.297931189692869e-01   -9.763113900794416e-02   -2.944273127171820e-02   +1.988734146104141e-01   +5.392579924473218e-01   +6.453689912550792e-01   +6.218941819660314e-01   +5.857631395307568e-01   +7.870874955067493e-02   +8.587763094530563e-01   +7.054401127452502e-01   -1.166456933446595e-02; +5.035870439002820e-01   +6.979660116736113e-01   +8.691288305776358e-01   +1.834768720291386e-01   +5.922463845253109e-01   +2.891152398005419e-01   +8.565292195284057e-01   +7.391546052949018e-01   +3.318388963540542e-02   +2.883319995468378e-01   +3.193132698786726e-02   +6.363885218099714e-01   +2.901324392751141e-01   +1.843573702602528e-01   +9.550660329887779e-03   +2.975142469453161e-02; +9.285784335702776e-02   +3.208690003836424e-01   +6.489177629217151e-01   +1.707753857081702e-01   +2.681581484785828e-01   +6.925542438121648e-01   +4.208486061828568e-01   +5.640387152598907e-01   +2.053260637214202e-01   +9.986382349820091e-01   +6.030086326515997e-01   +3.565267599656574e-02   +4.659152480606932e-01   +2.927451230925818e-01   +3.889380304058434e-01   +5.925368494335987e-01; +6.420540949538531e-01   +7.834935571059700e-01   +9.326097423852935e-01   +8.278319599797497e-01   +2.906952952851765e-01   +3.727649053183417e-01   +4.425122351206770e-01   +5.307067268503028e-01   +3.841480327667660e-01   +3.360643546222218e-01   +6.103245679843223e-01   +4.019850676443820e-01   +7.278617054549903e-01   +7.316688103031960e-01   +6.152421077503443e-01   +7.979363274911725e-01; +5.445784186883655e-01   +4.506582005383467e-01   +5.546953918931992e-01   +1.424532866265573e-01   +4.670824196831867e-01   +6.672970148984531e-01   +2.843348659308024e-01   +4.227367058221576e-01   +5.548496777879617e-01   +4.338115329365824e-01   +6.719903763551148e-01   +4.272792331757529e-01   +2.683235197284051e-01   +3.574878726501923e-01   +5.731832271579735e-01   +9.584241949801553e-02];
L2I_L1I_iGABA_netcon = [+5.392882989284734e-01   +4.142931045910818e-01   +6.994745316852371e-01   +1.000000000000000e+00   -1.146580017087285e-01   +1.881722518172395e-01   +1.326019842157450e-01   +1.395786737858285e-02; -1.704146930556012e-01   +5.089368113645510e-01   +5.378683509313527e-01   +6.068788720847855e-01   +3.923276822670023e-01   +8.186465165441675e-02   +5.849127461869707e-02   +2.545079571495796e-01; +2.010855839128481e-01   -7.606386231121252e-03   +6.254760688625330e-01   +6.273722820015912e-01   +4.928441407644210e-01   +1.177774227764944e-01   +4.006620136997065e-01   +7.679415566677357e-01; +1.544816808345797e-02   +4.347073022205330e-01   +1.317726918870711e-01   +8.105434288644843e-01   +4.240820876845371e-01   +3.996764228937840e-01   -8.122373279628292e-02   +5.467409670752540e-01; +6.293826240713598e-01   +9.137632194344706e-01   +6.076066684595226e-01   +4.630160097416302e-01   +3.902733832646009e-01   +6.547954398360972e-01   -4.615757961900163e-02   +6.288502355831487e-01; +1.297085942005415e-01   +5.346525912715704e-01   +3.995763148200961e-01   +8.108116071877939e-01   +6.260109518107752e-01   +5.390729872379303e-01   +8.436849534360316e-01   +4.392958199341846e-01; +8.255283786955717e-02   +6.608965001894390e-01   +9.210805297841100e-01   +9.880698638381364e-01   +1.936465971573145e-01   +7.875790384380317e-01   +3.334783567140681e-01   +4.044338858832855e-01; +5.769504472340132e-01   +9.656122372690770e-02   +8.549584925586703e-01   +2.583446385382157e-01   +4.463324713878566e-01   +1.769729392506783e-01   +3.570716537151862e-01   +8.402441350445580e-01; +1.405850522301397e-02   +3.408353892343428e-01   +5.586685253053690e-01   +4.694898229447294e-01   +7.684258682970151e-01   +3.532152740049766e-03   +5.502784327596949e-01   +3.457713184500454e-01; +4.807061433503795e-02   +8.783273267518439e-01   +2.484707926762519e-01   +9.878539507612216e-02   +5.343938241433088e-01   +6.230942805401659e-01   +7.302312168571056e-01   +7.452991851416544e-01; +5.627028539634222e-01   +1.971150955445454e-01   +2.886197764233101e-01   +3.639362368761550e-01   +6.063806089321536e-01   +4.728704773474806e-01   +8.651352467479584e-02   +7.767362438487789e-01; +7.073556507343320e-01   +3.789440605328102e-01   +7.760795656116807e-01   +3.810395482662749e-01   +6.492117527659638e-01   +2.259367690022748e-01   +5.488054693588788e-01   +8.570876030015734e-01; +3.844768048090758e-01   +1.762413460942109e-01   +5.700878046573706e-01   +4.909723984847446e-01   +2.201657985796887e-01   +5.875628515294260e-01   -4.215356129856059e-02   +7.073980094584094e-01; -8.994238638523298e-02   +7.294991970962509e-01   +5.658027747944371e-01   +5.853014774562879e-01   +4.238236590088162e-01   +8.044406312853464e-02   +1.435221644363997e-01   +2.917754937991948e-01; +3.435744732255083e-01   +3.081594923107659e-01   +6.628914599958416e-01   +3.272356479291259e-01   -1.075228053319750e-01   +6.186573008070507e-01   +6.312598652709434e-01   +6.303141187332407e-01; -5.998549014368751e-02   +3.885633288916741e-01   +1.254521835022842e-01   +7.254608098129858e-01   +3.224422649288631e-03   +1.972595182914492e-01   +2.570692565378002e-01   +6.478184236526798e-01];
L1I_L2I_iGABA_netcon = [+1.245120969218340e-02   +9.411177371304162e-02   +6.834814956490176e-01   +1.670182897867875e-01   +6.162271758911529e-01   +4.099483527874391e-01   +6.097995568471212e-01   +6.880575630999203e-01   +2.225564514992501e-01   +2.172804492949293e-01   +5.623417265486201e-01   +5.605019490731165e-01   +7.124995551392640e-01   +4.352324960385778e-01   -8.925493032119543e-02   +3.019662949633566e-01; +3.228044160108505e-01   +6.750120771520101e-01   +5.187783265854538e-01   +7.019410354142915e-01   -6.090349433656970e-02   +3.011847088296197e-01   +4.493912234720856e-01   +7.274902722495546e-02   +2.685498683463587e-01   +3.015517070917528e-01   +6.815012336291177e-01   +5.632398438455403e-01   +5.098613793158370e-01   +7.273665031773173e-01   +7.892678527690098e-01   +5.862877755415056e-01; +3.569655057306446e-01   +5.275060086257151e-01   +5.151115198970263e-01   +4.098771925633286e-01   +5.200429907733383e-01   +7.861572533427428e-01   +4.017936614026861e-01   +3.533835787548694e-01   +2.622252131612429e-01   +7.319294243677641e-01   +4.632703073578884e-01   +5.651214768344930e-01   +1.996204960741715e-01   +5.775365372116147e-01   +2.621768100881231e-01   +1.000214671338334e-01; +3.145179242259425e-01   +7.562944545728350e-01   +3.403306480449024e-01   +3.518943434874057e-01   +5.789629260662558e-02   +2.569033618046351e-01   +4.792994056400284e-01   +4.870939936924857e-02   +4.046329772473307e-01   +4.193184133397899e-01   +1.678365212888038e-01   +6.471161394794782e-01   +3.136763562005576e-01   +6.108753676581713e-01   +3.556739257866859e-01   +7.062093059547375e-01; +4.145382928702894e-01   +5.545568936967089e-01   +7.998523523641188e-01   +3.615523928664228e-01   +7.040083127738290e-01   +5.691344471110161e-01   +4.175243754752515e-01   +5.892369925304817e-01   +9.248532631694906e-02   +7.197710902526869e-01   +2.530883061590844e-02   +7.928507674196408e-01   -1.207087283946222e-01   +1.693720634077441e-01   +1.562834653956231e-01   +4.114194419329115e-01; +2.009307436088182e-02   +2.395779628134168e-01   +2.076017086897144e-01   +4.988492372945734e-01   +7.680841434326962e-01   +1.975152470058331e-01   +1.431408933772050e-01   +3.304328498038985e-01   +4.221098334104535e-01   +7.112875071691710e-01   +1.798778807122981e-01   +2.860074844781078e-01   +7.408691958856833e-01   +3.123295521238698e-01   +4.755954266211431e-01   +5.037509829466660e-01; +5.453389597531052e-01   +1.000000000000000e+00   +3.119497079616261e-01   +8.014180131231924e-01   +1.277439184917633e-01   +7.964674467217818e-01   -4.389103004790308e-02   +4.207686135750280e-01   +3.590127107924876e-01   +1.176742488670148e-01   +6.596197948549132e-01   +5.537322260086927e-01   +2.818572567615151e-01   +6.020317864895433e-01   +6.098968159442721e-01   +4.017366597547761e-01; +5.164953259292365e-01   +8.002740158365090e-01   +6.595001701567296e-01   +6.017875881404339e-01   -4.021775310380129e-03   +3.427763233937475e-01   +3.415675413933456e-01   +3.138363732497271e-01   +5.989928240711243e-01   +4.043428693257161e-01   +2.532722014688262e-01   +4.022503156669616e-01   +4.596608369169967e-01   +8.191660232993559e-01   +1.888192672846582e-01   +4.537369179656230e-01];
L2E_L1E_iAMPA_netcon = [+5.236574644672999e-01   +2.631435525493425e-02   -9.479437751759151e-02   +4.646833455627806e-01   +5.218592489764518e-01   +7.221016570437054e-01   +2.497416183131106e-01   +3.094071713512821e-01; +5.007743851984381e-01   +5.577559435483295e-01   +6.678153411528528e-01   +8.755286860087793e-01   +3.115033686910487e-01   +4.534584474258869e-02   +3.647849955933566e-01   +2.089780079017883e-01; +4.283404817499639e-01   +3.239472029095202e-01   +1.950024636362011e-01   +7.277290659340359e-01   +2.353979415800976e-01   -9.097179939013034e-03   +1.666721304571456e-01   +3.487268720642188e-01; +9.031285994318472e-04   +2.613519723170046e-01   +5.442747161221427e-01   -5.593825556097532e-02   +6.994201982210915e-01   +5.221211660500892e-01   +1.004063946026564e-02   +3.103878727870672e-01; +3.463079029796829e-01   +4.253369516516385e-01   +6.028055833657293e-03   +7.165171891429144e-01   +9.462512726877318e-01   +3.703752963916261e-01   +3.192278528514553e-01   +5.945111833341582e-01; +6.097439982683582e-01   +6.035569841362666e-01   +1.733589872480586e-01   +4.183020680646515e-01   +4.047421057770865e-01   +2.495431096865262e-01   +1.381532548944455e-03   +2.859155389825677e-01; +9.031580614219655e-01   +4.972506115709731e-01   -6.322719591654340e-02   +8.929806376365635e-01   +2.495184171705560e-01   +1.717379462525475e-01   +3.899426101557767e-01   +2.377110001613015e-01; +1.703060911945830e-01   +5.619673587549424e-01   +6.305332074887720e-01   +1.215676947940164e-01   +2.423122473344752e-01   +1.854422565733851e-01   -2.790156141876712e-02   +8.590031262971347e-02; +8.291514770393770e-01   +6.423253486647255e-01   +5.282536883200974e-01   +4.988513946750909e-01   +5.503676733979466e-01   +2.979890952995086e-01   +2.011316589451855e-01   +3.685098300142536e-01; +2.062802062479649e-01   +3.138105446859312e-01   +3.731586792341404e-01   +6.369513296970396e-02   +4.467400661833472e-01   +6.856319742288051e-01   +5.883035736444334e-01   -1.157359155287487e-02; +7.854765127040128e-02   +8.095660044204286e-01   +7.712860376566111e-01   +2.154618890076425e-01   +6.789757492516995e-01   -1.534924387622651e-02   +1.000000000000000e+00   +5.068286992843745e-01; +9.603211552222147e-01   +2.358250981090994e-01   +5.924395557731122e-01   +5.339322177768844e-01   +4.553924992444087e-02   +5.390911256937740e-01   +4.834227057811220e-01   +2.848083340793711e-01; +5.820073020578965e-01   +5.066231107933129e-01   +2.853294576854247e-01   +7.476923581682848e-01   +6.493476716442130e-01   +8.796203344931788e-02   +6.085960267538276e-02   +5.374342207898410e-01; +2.392030373033858e-01   +1.894643358484041e-01   +2.257232220964863e-01   +5.927642833126999e-01   +2.153422716521058e-01   +4.332100143495523e-01   +8.818150825688722e-01   +3.763860443764392e-01; +1.517885277900582e-01   -7.518188645023086e-02   +5.104620784963688e-01   +7.826632518598838e-01   +6.956785290234950e-01   +2.881356666960930e-01   +2.513231105358128e-01   +6.070885189239442e-01; +3.146392230324449e-02   +5.719849130715446e-01   +2.778831123331874e-01   +3.258182151840011e-01   +2.319200485665151e-01   +8.074829471825445e-02   +4.053380384200291e-01   -4.853536189520309e-02];
L1E_L2E_iAMPA_netcon = [+3.496821615579093e-01   +2.476350556271182e-01   +4.877087852052147e-01   +5.300789695135022e-01   +7.935052064359749e-01   +3.850683343136084e-01   +8.069941286335585e-01   +3.387792964750994e-01   +5.300819631018813e-01   +7.271614465035909e-01   +1.757336416831226e-01   +5.547970352787779e-01   +5.722583027525925e-01   +5.824687782020219e-01   +2.170693788317862e-01   +5.541141240302989e-01; +4.334955240728674e-01   +6.428588591301988e-01   +7.050306224115609e-02   +2.374994147262870e-01   +2.160706273952958e-01   +4.157998399665899e-01   -6.426329524953357e-02   +3.937931426794359e-01   +4.065387384386009e-01   +5.989244649544151e-01   +4.136865838044646e-01   +4.676317587367987e-01   +6.208005376877914e-01   +2.789895967145912e-01   +7.715520213139080e-01   +1.592846868770062e-01; +5.300516684678345e-01   +2.919588347014460e-01   +9.859368816464248e-01   +7.998942556149382e-03   +7.453590268243027e-01   +1.870070952581978e-01   +2.758538748843259e-01   +4.727506622416955e-01   +3.996361582056561e-01   +5.804166471454140e-01   +4.143956147005453e-01   +6.508196418368272e-01   +8.214268536728109e-01   +2.513072804689124e-01   +4.514547822338422e-01   +1.000000000000000e+00; +4.749671894616007e-01   +8.507060455150263e-01   +6.183252034815755e-02   -2.075275065989254e-02   +3.890651463232952e-01   +4.790504516526258e-01   +4.636202312897990e-01   -1.022784517430282e-01   +9.401558956499175e-01   +5.026991047066349e-01   +8.948865023502557e-02   +1.720329587054907e-01   +6.234470988039763e-01   +7.232395423191460e-01   +9.385149946252366e-02   -7.590526902738197e-02; +7.065066765391800e-01   +5.911158112696833e-01   +2.897474453873309e-01   +2.803922975819407e-01   +2.266194889709540e-01   +2.968308574653996e-01   +6.786892454919552e-01   +9.572011434262226e-01   -1.199269664127594e-01   +5.313696740235725e-01   +1.667446032741480e-01   +8.323726414152878e-02   -7.530412883779050e-02   +2.713554984502899e-01   +5.485651722003079e-01   +2.739344187731190e-01; +4.382400148431824e-01   +4.678827329022630e-01   +7.315240519834483e-01   +9.794931040664793e-01   -1.443291416188711e-01   +1.826959689582328e-01   +3.813550556051853e-01   +5.128258766071108e-01   +3.583041259926539e-01   +9.653070729280232e-02   +2.921579526368591e-01   -2.515936863433826e-02   +9.372657967622371e-01   +1.363300781232139e-01   +4.261778455831875e-01   +9.298936029889086e-01; +6.525285158697768e-01   +5.356772613222115e-02   +3.298155246634733e-01   +2.348044425183187e-01   +1.490228580386924e-01   +1.774054378126848e-01   +2.795172982219350e-01   +7.174247695076299e-01   +5.927474133248388e-01   +9.329036073871758e-02   +5.788480814408937e-01   +3.124527581526725e-03   +3.459571429133561e-01   +6.566189926754308e-02   -3.869803387229136e-02   +1.608526011036821e-01; +6.348681755945615e-01   +1.560571277964952e-01   +7.592194131630179e-01   -1.394434295109413e-01   +7.416210496571348e-01   +8.041191025982971e-01   +3.582561216303050e-01   +1.593807329080748e-01   +4.978098241419586e-01   +3.453449208638314e-01   +2.630425980144701e-01   +3.034998825680069e-01   +2.352010836383916e-01   +6.865960040283734e-01   +7.728866178637713e-01   +1.707927213482165e-01];
L2I_L2E_iAMPA_netcon = [-1.487663168295902e-01   +3.444844107309048e-01   +3.425954923103459e-01   +4.348567694035875e-02   +8.777334097581387e-01   +6.476997248922256e-01   +3.521318240417076e-01   +8.284571226013300e-01; +5.404384905742082e-01   +1.866519914054213e-01   -5.097881814274376e-02   +3.994471488587740e-01   +2.584495394648592e-01   +3.924372189916175e-01   +4.121489190358514e-01   +1.000000000000000e+00; +1.296621248318185e-01   +5.836684978270731e-01   -7.428003346768679e-02   -1.603943923554221e-01   +6.950423999437121e-01   -8.615041850485614e-02   +9.978485768599842e-02   +5.071379400501153e-01; +6.551541156485757e-01   +9.405237981280365e-01   -1.452361468914383e-02   +9.839922535223767e-01   +5.363515154473627e-01   +4.494846879376622e-01   +1.690462958083357e-01   -1.100739812378267e-01; +1.498505309830812e-01   +3.315011910705225e-01   +4.105530749413293e-01   +6.619001809920756e-01   +8.563035374754422e-01   +6.785149243005290e-01   +5.801608431255557e-01   +3.077347657991513e-01; +8.160627569403319e-01   +2.520066335145476e-01   +2.231443933823976e-01   +1.783116000563260e-01   +5.878742769767219e-02   +9.562321781953430e-01   +9.977950252203101e-02   -3.418877081084942e-02; +4.927778789214374e-01   +7.478765052011280e-01   +6.938846813721035e-01   +6.877669989284225e-01   +8.572253737435060e-01   -4.472221942559838e-02   +3.215415954212434e-01   +2.461872508641106e-01; +8.881559911572315e-01   +4.172835916579326e-01   +2.065144973405421e-01   +2.624582112446240e-01   +7.048024121453423e-01   +3.043562184812836e-01   +5.221362911877265e-01   +4.773540933178296e-01];
L2E_L2I_iGABA_netcon = [+1.354295352650872e-01   +2.219775451683790e-01   +4.024821318242190e-01   +1.207438978184829e-01   +8.123552855493849e-01   +7.776444681221963e-01   +4.263680355561544e-01   +4.612978022319040e-01; +7.547979365153574e-01   +8.960745008399936e-01   +1.409048348654529e-01   +2.611557764698647e-01   -5.007719213552913e-03   +8.238433765026527e-01   +4.442122637102255e-01   +3.833007710311142e-01; +1.000000000000000e+00   +1.859176178219619e-02   +7.259490422568253e-01   -1.792442420652210e-03   +7.240174624806004e-01   +7.165041532814767e-01   +7.715018338186502e-01   +2.783869972647626e-01; +1.309163625631813e-01   +1.663779909619673e-01   +7.703767020718547e-01   +6.795793760088789e-01   +7.013617906590263e-01   +6.273506086202458e-01   +1.809774052658970e-01   +7.229048450945466e-01; +6.976918293441015e-02   +7.119692497091545e-01   +7.566974408347290e-01   +2.247541653583607e-01   +2.459546754237963e-01   +1.456844806381258e-01   +5.318732471782200e-01   +2.022722969372433e-02; +1.977693594383147e-01   +4.973461047270019e-01   +4.733888500404109e-01   +3.284607872891199e-01   +3.107397395390419e-01   +7.514052435776606e-01   +2.520639167781637e-02   +1.394323606868226e-01; +2.980142720425781e-01   +6.357283015467703e-01   -2.275853405002062e-02   +7.883817934720133e-01   +4.843876066653213e-01   +5.992474957921544e-01   +8.171305921627883e-01   +7.366224674365460e-01; +2.746569826257781e-01   -9.202758455746281e-05   +5.636510390129715e-01   +5.319745365302027e-01   +6.299102965124154e-01   +3.456834782181695e-01   +5.857089243871854e-01   +5.839168251740607e-01];
L3E_L2E_iAMPA_netcon = [+3.320233966499973e-01   +1.000000000000000e+00   +4.347123882137287e-02   +3.920300032710234e-02   +6.039743705955523e-01   +7.032000730426756e-01   +1.829273383155558e-01   +7.602634438087649e-01   +6.526484811496793e-01   +8.173594371357983e-02   +4.519574446919870e-01   +6.198336132885900e-01; +3.045022380544176e-01   +2.625527784730088e-01   +5.974284765294174e-01   +4.205235011701504e-01   +5.731029725273182e-01   +3.768333999361111e-01   +3.973841738469974e-01   +6.080794137513637e-01   +3.421859799295492e-01   +2.908718280080509e-01   +1.669738226737169e-01   +6.129449960263272e-01; +5.191684540184365e-01   +7.972975497536148e-01   +6.598103751770359e-01   +4.653436373552020e-01   +6.780192877993690e-01   +3.763050401826744e-01   +6.852279935799594e-01   +4.946088334699552e-01   +7.095923888491230e-01   +3.860507659039699e-01   +3.232321389284786e-01   -2.129619509775530e-02; +7.081447310819690e-01   +1.450747973248981e-01   +7.587144294650962e-01   +4.940070281443633e-01   +6.885872764211673e-01   +7.178840300001543e-01   +3.035708927463936e-01   +3.056048833084254e-01   +6.105180496537750e-01   +6.525835417387327e-01   +2.978322457007774e-01   +8.792112002531477e-01; +3.576599882583039e-01   -1.166221448241619e-02   +5.659599356772869e-01   +1.273588917233016e-01   +3.292921886780040e-03   +4.660250104962872e-01   -1.109327380253864e-01   +6.829153231926353e-01   +1.534102031551272e-01   +7.721737174750618e-01   +2.488988171972665e-01   +5.878562852516690e-01; +1.416498234459750e-01   +5.666230112548223e-01   +2.260587973192229e-01   +3.946960767307489e-01   -2.763004827901352e-02   +2.824177982089006e-01   +2.499840613379419e-01   +9.174034158620844e-01   +6.895011098488297e-01   +7.995570944214083e-01   -1.541524753788676e-01   +7.394191163029287e-01; +4.228246667655343e-01   +5.590606844480142e-01   +3.331970924291375e-01   +7.442596343016100e-01   +2.560338539767083e-01   +5.504140710670938e-01   +5.234855027490128e-01   -2.314515504156756e-01   +8.306794445135289e-02   +8.915188243315263e-01   -2.480064294726031e-02   +5.380569188816660e-01; +1.047436958710275e-01   +4.042903202815409e-01   +3.462525938343974e-01   +6.256697830911643e-01   +2.201333871917776e-01   +2.332648210498639e-01   +4.616293334740393e-01   +1.664120851633730e-01   +1.171706115296567e-01   +8.692443138969366e-01   +5.762115562734039e-01   +1.403851479045066e-01];
L3I_L2I_iGABA_netcon = [+6.192522098962115e-01   +6.240265904819539e-01   +5.181154916026089e-01   +1.021953661119939e-01   +3.711182453677748e-01   +7.852894804722750e-01   +4.020835743774747e-01   +3.455412427996469e-01   +8.393030731479701e-01   +1.286305581339200e-02   +5.761286326317495e-01   +6.421842701640756e-01; +7.024672017643980e-01   +3.064456575691424e-01   +1.212842737117302e-01   +7.046584522737313e-01   +4.078364570252254e-01   +1.147592968630814e-01   -3.273735251153976e-02   +2.365903468906965e-01   +6.428345471125998e-01   -3.389628835598041e-02   +2.677517561104634e-02   +5.378147765293709e-01; +1.362945848368799e-01   +2.241859106493419e-01   +1.068861718758911e-01   +2.451326813455511e-01   +4.994947131308324e-01   +1.061257916106186e-01   +4.525788613251986e-01   +6.050864420917192e-01   +3.782639400938383e-01   +5.608879746547002e-01   +7.180894917701502e-01   +7.370801614254505e-01; +8.022168976042835e-01   +1.095359433692581e-01   +4.655410326098255e-01   +7.337749664212696e-01   +3.174775306176597e-01   +9.855367155502164e-01   +3.883423441180622e-01   +9.700955980325718e-01   +3.987314982904595e-01   +7.490361560868736e-01   +7.644449268921509e-01   +6.898371606242212e-01; -2.283302728147870e-01   +2.794224125351727e-01   -1.800717807486336e-01   +5.111129932714812e-01   +6.952789663301449e-02   +5.407545829040411e-01   +9.464100523554471e-02   +1.666469227715139e-01   +2.979279584675361e-01   +7.675206312432402e-01   +6.837375787640206e-01   +5.888105394114892e-02; +2.698133468365358e-01   -1.264722916863750e-01   +1.874746038049390e-01   +5.717100609556744e-01   +5.793908920092560e-01   +1.000000000000000e+00   +7.453849036710830e-01   -9.565682349965163e-02   +1.262869480624463e-01   +5.987079296309831e-01   +3.607291421905429e-01   +5.632269319679871e-01; +3.965081694623878e-01   +2.386267326069952e-01   +3.771904469105610e-01   +3.356408726742375e-01   +7.563453294720710e-01   +5.203539435911380e-01   +3.388661932560011e-01   +1.729494412034650e-01   +7.630633692968772e-01   +3.173346465446165e-01   +6.696172003094142e-01   +7.741352399083219e-01; +4.995795463990240e-01   +5.568058609838428e-01   +2.068662834556689e-01   +3.338039507251135e-01   +2.944505829470930e-01   +3.303955836749900e-01   +8.144092694973739e-01   +6.643485336307942e-01   +4.201595236511836e-01   +2.903071433043700e-01   +3.761411052115546e-01   -1.542873316625619e-01];
L2E_L3E_iAMPA_netcon = [+7.907886378242110e-01   -7.202492319806289e-02   +2.811592007952285e-01   +7.172892979397108e-02   +5.953829774713563e-01   +4.841445107531379e-01   +5.854533379325334e-01   +1.475809385982024e-01; +3.563803085794262e-01   +8.737084222372431e-01   -1.239768993873176e-01   +6.232840247524045e-01   +2.491041420074327e-01   +3.486948086679224e-01   -3.240335668763357e-02   +6.543925532187689e-01; +6.015409013625045e-01   +5.188346187715439e-01   +3.732280471046752e-01   +8.865407441068390e-01   +8.153046856744307e-01   +5.844817688679009e-01   +3.383491658331498e-01   +3.087642238551735e-01; +4.331332481137007e-01   +4.879173440353978e-01   +6.415039825641380e-01   +4.693031816617367e-01   +6.576015099639620e-01   +1.543031454600283e-01   +3.836074649511092e-01   +6.238071625195503e-01; +8.651815910396816e-01   +7.074115129803645e-01   +3.165058883705978e-01   +4.037675133844260e-01   +3.033196482940386e-01   +7.571712205551804e-01   +4.828793168962075e-02   +4.821715278267266e-01; +6.335581549942758e-01   +4.938879257835649e-01   +8.589491703383256e-01   +2.551961611550078e-01   +9.729895519387268e-01   +9.772960082648102e-01   +9.351091597003326e-02   +8.996836222611336e-01; +6.898301131980343e-01   +3.964149120918369e-01   +2.824430026999896e-01   +6.243056843879987e-01   +5.541582788021044e-01   +2.594877288009686e-01   +3.080225221812150e-01   +5.471559257536498e-01; +4.215691811745697e-01   +2.192342718708208e-01   +2.902675182934395e-01   +2.170807395664342e-01   +5.927989311845524e-01   +4.068651074076257e-02   +6.156313182145168e-01   +9.588347229956234e-01; +6.297212787291228e-01   +3.560471524762567e-01   +7.221707223898751e-01   +3.389490163914757e-01   +5.935392537617053e-03   +9.395455715799810e-01   +5.615629108080640e-01   +6.222848749823389e-01; -1.460879458154682e-03   +3.410120423983670e-01   +4.826291526852384e-01   +3.849731588260030e-01   +4.115535004585910e-01   +8.844119950008830e-01   +6.161318572999840e-01   +6.378627898361368e-01; +5.868600663637585e-01   -3.915859847464186e-02   +7.194881271582192e-01   -5.313320412091818e-03   +3.002226090618478e-01   +1.374033579006899e-01   +2.860363890372002e-01   +5.634451906504097e-01; +4.621838884093497e-01   +3.604555755225856e-01   +2.385638093320308e-01   +2.046677347003010e-01   +7.104645817786162e-01   +7.858091239095952e-02   +1.000000000000000e+00   +8.001624084828662e-01];
L2I_L3I_iGABA_netcon = [+2.986516839920434e-01   +4.635048476959686e-01   +5.753549023127210e-01   +8.716498888019446e-01   +4.785568062143656e-01   +9.228799990841216e-03   +5.361646286480192e-01   +5.309105547450650e-01; +1.861425501606401e-01   +7.100418776336886e-01   +5.316717204734522e-01   +9.232409825690423e-01   +3.486680659554986e-01   +1.000000000000000e+00   -1.694596448739452e-01   +6.000016147048733e-01; +4.028414750435507e-01   +9.238681533755911e-01   +7.211259514132091e-01   +3.798825424258052e-01   -6.815947578215226e-02   +2.083381619999119e-01   +7.420218119532220e-01   +1.145084446264654e-01; +1.586325275195579e-01   -1.573311074369110e-01   +6.952309353763566e-01   +1.328805173072122e-01   +1.782161161685903e-01   +8.872655876540073e-02   +3.455810935734955e-01   +7.199803251405422e-01; +7.498420941826177e-01   +4.693279031170591e-01   +4.471851067005020e-01   +5.489503097319300e-01   +5.158183528361253e-01   +8.091485577216838e-01   +1.629283281078069e-01   +1.937364306259168e-01; +2.325358334398407e-01   +9.482828868413393e-02   +2.528817309743378e-01   +2.421726420499733e-01   +6.352499451795343e-01   +6.844876166777143e-01   +7.361683337374699e-01   +1.226214809546742e-01; +8.256337910062239e-01   +2.245822350568061e-01   +6.912129496061231e-01   +9.474187495149348e-01   +3.907986175186305e-01   +2.268230005717714e-01   +8.814557358787325e-01   +3.436182892004355e-02; +7.548118306948248e-01   +5.735850362330710e-01   +7.831777640595218e-01   +3.491904122794911e-01   +8.504903395587294e-01   +8.959312042011528e-01   +6.562610169188194e-01   +2.049958398238703e-01; +5.678699025218474e-01   +7.084321548425013e-01   +7.801384956226493e-01   +3.558139800037496e-01   +5.835345696247076e-01   +4.677718917370374e-01   +9.462479507198505e-01   +7.381864781239235e-01; +8.417406995779693e-01   +5.583602733247129e-01   +6.571106794064044e-01   +6.525889181092298e-01   +1.748484843458394e-01   +2.191409030901904e-01   -3.924292063859327e-02   +3.955928482625730e-01; +6.449734820838476e-01   +8.101716053211108e-01   +3.517611764168847e-02   +6.284959940711564e-01   +3.748112896386762e-01   +5.561736817043890e-01   -1.142555836589234e-01   +4.630833215166673e-01; +1.064649619351231e-01   +4.099757124214452e-01   +3.100402893627803e-01   +5.660406570650657e-01   +7.690196932824785e-01   +1.903598623349462e-01   +2.807631074835699e-01   +5.640343058340808e-01];
L3I_L3E_iAMPA_netcon = [+2.733092464459618e-01   -1.413865529245084e-01   -8.590343514123279e-02   -1.381648733308835e-01   -5.863889338545458e-02   +6.614882427057929e-01   +1.657263976980514e-01   +3.230624259017368e-01   +3.414352683832506e-01   +8.142971943278365e-01   +8.058265950372930e-01   +3.869955236967294e-01; +7.958121484451790e-01   +4.631436748054979e-01   +7.062402242763605e-01   +1.140847955737687e-01   +7.164914822364086e-01   +8.287952933922642e-01   +7.746163936620665e-01   +2.687843892228663e-01   -1.095897111509552e-01   +5.394105097130599e-01   +7.724075568479059e-01   +1.371025452037956e-01; +1.000000000000000e+00   +4.565537718074079e-02   +3.185582080692115e-01   +5.143935135122255e-01   +2.864767763578033e-01   +2.939145988298487e-01   +6.763234556833859e-01   +2.586625977620559e-01   +5.082555284514767e-01   +4.442510605625101e-01   +4.389475135356126e-01   +1.839311547579091e-01; +7.418734554266235e-01   +3.651467707277607e-01   +9.946325934611674e-01   +6.857784631358270e-01   +2.877318644936138e-01   +6.260076962499095e-01   +7.692388618661906e-02   +5.942098684051580e-01   +5.883412575508895e-01   +1.748043271907790e-01   +7.042309039121881e-01   +8.521576188103591e-02; +1.651716332416156e-01   +2.691046764068842e-01   +6.246167789023403e-02   +4.657386357922793e-01   +8.860669707064281e-01   +2.095610332368461e-01   +5.616058318594102e-01   +2.564101638378136e-01   +5.778655119289404e-01   +4.012165814128133e-01   +4.300677176548607e-01   +4.849708489216750e-01; +2.628616631626791e-01   +3.086935527224491e-01   +6.869525670905426e-02   +4.564953456637695e-01   +2.781014274460939e-01   -6.808355163046448e-02   +2.148967475559987e-01   +8.944249899676086e-01   +1.834301093055012e-01   +2.677624037209109e-01   +5.616897230242544e-01   +2.754743197938484e-02; +4.274747609807551e-02   +5.950379228528081e-01   +7.867711449566237e-01   +2.985184439465953e-01   +4.887794853515273e-01   +4.258797880659123e-01   +4.921710872549182e-01   +2.224224501386917e-01   -7.533626304437875e-02   +5.570047963715543e-01   +6.331499865943079e-01   +6.336318359225214e-01; +6.136992107426742e-01   +7.190341516410805e-01   +2.842626098000848e-01   +6.234645478041664e-01   +7.609113923312586e-01   +6.055796656515109e-01   +1.465372294493901e-01   +1.135061622046448e-01   +9.032925267570688e-01   +5.399542912191371e-01   +1.128104363438204e-01   +6.266222992539480e-01; +6.456171255257164e-01   +8.577238777127166e-01   +8.643915409772025e-01   +6.499982237847077e-01   +5.731402244110361e-01   +6.014883504063705e-01   +4.610754941480615e-01   +4.540769893200239e-01   +1.377458009138894e-01   +2.677553199113505e-01   +7.021381765556670e-01   +5.897054784868900e-01; +7.058730334364045e-02   +6.199870280122819e-01   +5.802542197786013e-01   +6.527120886077511e-01   +6.266958858424951e-01   +6.348175522634817e-01   +5.993904890608182e-01   +1.470532154061786e-01   +1.345693410557800e-01   +8.428715729520957e-01   +5.662564741169243e-01   +5.754719103488277e-01; +8.000561748775863e-01   +2.414722076400485e-01   +7.234521339756422e-01   +8.092698793849382e-01   +1.963116010816607e-01   +3.770169691549795e-01   +2.137984561385744e-01   +9.228587041719364e-01   +7.583080478704579e-01   +1.052809209799101e-01   +6.190672934833108e-01   +7.512868288308199e-01; +4.713890506973833e-01   +5.585866762542919e-01   -5.055668850055956e-02   +2.160559302657560e-01   +4.302310129497992e-01   +4.402966525559681e-01   +9.581113369826652e-01   +1.057944202158512e-01   +9.534102218804798e-02   +2.301766531517748e-01   +3.819663262059675e-01   -4.651237444841622e-02];
L3E_L3I_iGABA_netcon = [+3.343080811594288e-01   +1.719638578710677e-01   +8.231714858537956e-01   +6.891538883987332e-02   +3.791972552051904e-01   +6.312505309256660e-01   +7.499571045627654e-01   +2.861403365599132e-01   +1.186360713113516e-01   +2.827913436996449e-01   +9.351010622900420e-02   +3.044378714017001e-01; +1.866014832187120e-01   +4.071257559284593e-01   +3.049460025100730e-01   +6.654376833462280e-01   +6.057643267300256e-01   +2.779672879608524e-01   +2.081453799899645e-01   +2.013218325663084e-01   +4.678762714831016e-01   +5.433518621711446e-01   +8.578397655423631e-01   +3.291672045350680e-01; +4.403908898361362e-01   +2.981304927462024e-02   +3.677798769194565e-01   +4.812961570660663e-01   +4.798490264456461e-01   +8.288745748527504e-01   +3.419135584168165e-01   +4.036022484200518e-01   +4.948321620445220e-01   +3.587799387260037e-01   +6.176727529534817e-01   +8.863068214402046e-01; +6.056228164266038e-01   +6.452324645999270e-01   +8.718516349820744e-01   -2.818423689764956e-02   +2.253261501250186e-01   +3.690880564744962e-01   +4.596021846886346e-01   +3.277675562057026e-01   +2.751062056906805e-01   +5.141897559971614e-01   +7.538251902916384e-01   +5.173438481097100e-01; +1.577276310586248e-01   +2.853350907157907e-01   +6.084633065980896e-01   +4.065181843223868e-01   +4.882940539217260e-01   +3.417214780114605e-01   +4.080659250807375e-01   +4.640159348054048e-01   +3.031666099344016e-01   +5.047733553745184e-01   -1.264681463172369e-01   +5.837575088000273e-01; +6.331315709296114e-01   +5.993052654786718e-01   -1.138457309753865e-01   +4.975760802280629e-01   +7.075329292756392e-01   +2.359727749039540e-01   +3.810814046257084e-01   +2.325700514384791e-01   -1.529165409115394e-01   +4.835571108970124e-01   +2.581536388687029e-01   +8.385903231702649e-01; +7.524478538986194e-02   -4.183451005264478e-02   +1.159026762737719e-01   +3.804824382632864e-01   +4.741832010779144e-01   +2.465436933113676e-01   +4.248689855897632e-01   +5.404255072898415e-01   +4.779971318203286e-01   +7.180635271391053e-01   +4.773755237526088e-01   +2.259826918366827e-01; +5.061906556472088e-01   +1.479076604634271e-01   +1.045552369243879e-02   +2.417514817645300e-01   +7.142559562167886e-01   +6.896613245635824e-01   +4.959617752035029e-01   +3.207990413888693e-01   +2.137110050190713e-01   +2.120555083758711e-02   +6.106189655405916e-01   +6.991996663258548e-01; +3.123598636271742e-01   +2.545726256700752e-01   +1.601945123300394e-01   +5.631146650444815e-01   +8.219787139720558e-02   +4.389593977033059e-01   +7.853417218090177e-01   +2.103685414271072e-01   +3.187071469902030e-01   +6.187625498211405e-01   +8.890160779273409e-01   -3.208815441932904e-02; +5.696819130324268e-02   +5.456061722675944e-01   +2.237931404116875e-01   +4.123144832010640e-01   +3.695628984093110e-01   +1.776617209096218e-01   +3.709605548400098e-01   +1.000000000000000e+00   +1.883937348898400e-01   +2.148422360620765e-01   +2.991400481897271e-01   +3.715697033976415e-01; +6.604173726171753e-01   +7.225414660404799e-01   +7.718448761613517e-01   +1.277151370305822e-01   -1.626587064343578e-01   +4.727135945783639e-01   -1.366770932941412e-01   +8.706385548823501e-01   +4.428913529799475e-01   +6.150599728767001e-01   +8.992491743182908e-01   +6.190694489682261e-01; +1.634661428178089e-01   +3.696966954734792e-01   +2.892981638523789e-01   +6.673582819710588e-01   +2.558297318335151e-01   +2.371945746877279e-01   +9.566211049776415e-01   +4.504390689793000e-01   +7.633393034794862e-01   +7.215419442223659e-01   +4.414056027218300e-01   +1.157777531718625e-01];
L2E_Input1_iAMPA_netcon = [+7.151383101590726e-01   +7.573411676741050e-01   +6.916604986682051e-01   +9.930904272225883e-01   +9.307830654429804e-01   +7.640209140484586e-01   +9.661798763649299e-01   +7.891722118117968e-01];
L2I_Input2_iAMPA_netcon = [+1.000000000000000e+00   +7.528761597162853e-01   +9.908799954149536e-01   +6.749156589381499e-01   +6.020395787974261e-01   +8.621172426744248e-01   +7.127978527808951e-01   +7.811279065768523e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
