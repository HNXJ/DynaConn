function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.209039321435952e-03   +2.620439122849364e-02   +4.501596710464989e-02   +3.658368183300229e-02   +3.673059869037716e-02   +6.352411814622264e-02   +2.212279822240654e-02   +9.389994072614859e-03   +1.654873475057541e-02   +2.548054377702228e-02   +3.684228165718720e-02   +1.737125360471551e-02   +2.422680395434350e-02   +4.097006576514829e-02   +2.690588141630213e-02   +3.779655575045830e-03; +2.380876806490520e-02   -1.048285606387363e-03   +2.817300258456028e-02   +3.650823584118194e-02   +1.237402507250471e-02   +1.969088129144281e-02   +5.642824857481347e-02   +5.911418572943355e-02   +4.561014809569944e-02   +1.699689165150641e-02   +5.721133646849855e-02   +1.026233395576896e-02   +8.915003384801291e-03   -4.591345884884731e-03   +2.901820141565825e-02   -2.183356939483798e-03; +3.495688319566215e-02   +3.348866720627587e-02   +5.328219445988859e-02   +3.136887099962407e-02   +2.495414597797114e-03   +5.361420838094541e-02   +4.547849345533819e-02   +2.869714627987058e-02   +2.648917940894073e-02   +2.286079445242251e-02   +3.016277806391726e-02   +1.342159098662188e-02   +3.521850195499259e-03   +1.099160989706585e-02   +4.543605246311995e-02   +3.326947101504112e-02; -3.756912268544193e-03   +2.642808416542194e-03   +2.447525274787887e-02   +4.098396179183667e-02   +1.590533957432426e-02   +4.011584270618078e-02   +2.871770940161499e-02   +5.706431305054632e-02   +2.830572244010655e-02   +1.120674166302339e-02   +4.568932964137783e-02   +4.900075894753347e-02   +1.130409301309396e-02   +5.399371673117899e-02   +1.446896674668022e-02   +1.883965776971590e-02; +3.003192650348786e-02   +3.663647464927676e-02   +3.781314236862088e-02   +4.001715680222449e-02   +2.515612591446654e-02   +5.604218510410468e-02   +2.694624338504585e-02   +1.848173236560773e-02   +3.345949509376583e-02   +5.468059866692762e-02   +2.281168069837079e-02   +4.420680968537622e-02   +1.105335225723644e-02   +1.814188206225373e-02   +6.012125815126965e-02   +1.099150039705069e-02; +3.017421430316451e-02   +3.162203151320723e-03   +5.093027055363247e-02   +1.446332620958998e-02   +3.406164278365083e-02   +2.310265052535064e-02   +1.975352949045913e-02   +9.752018715089308e-03   +2.592924817283751e-02   +3.188862129348458e-02   +4.403660369245944e-02   +1.432999836177685e-02   +2.825605542374720e-02   +2.893991040085041e-02   +2.744848242178840e-02   +4.310420851065255e-02; +1.379876976513465e-02   +3.892097095014684e-02   +5.338464084213197e-02   +3.582203931055570e-02   +2.750742830548287e-02   +3.149751252203389e-02   +1.740659114376870e-02   +5.568797840249922e-02   +5.367788573104369e-02   +2.306059872562645e-02   +5.521556730194715e-03   +1.373593921955424e-02   +2.441462818371027e-02   +4.948699318127163e-02   +3.495265666829061e-03   +1.578545017076718e-02; +3.956572813365666e-02   +2.097720421315289e-02   +4.600740373126293e-02   +4.037426470169123e-02   +3.816513099123308e-02   +9.899177040457102e-03   +1.580257575130660e-03   +3.327920037406572e-02   +4.749507156528129e-02   +4.060457128304048e-02   +1.627050165985207e-02   +4.163738975128151e-02   +1.068190336145927e-02   +8.514295113538335e-03   +3.842855850459306e-02   +3.762813539504153e-02; +8.707112797162306e-04   +4.303580097144881e-02   +3.452537272043967e-02   +3.349555116200560e-02   +5.499566946827013e-03   +5.055021516430936e-02   +1.950001434304385e-02   +2.700767929541661e-02   +2.994662173928648e-02   +2.948250439394317e-02   +8.830128048958823e-03   +5.184372818981055e-02   -9.116469289165291e-04   +4.725941173936421e-02   +1.922679960701519e-02   +2.121942650963119e-02; +3.129125527910325e-02   +1.018643329491106e-02   +5.176210883527363e-02   +4.413515354331614e-02   +3.675590039426826e-02   +1.573202694211610e-02   +4.661590419914116e-03   +2.608014964851261e-03   +4.163292814164295e-02   +2.416677817167599e-02   +2.549131970920728e-03   +3.489923586799912e-02   +5.409327396596137e-02   +1.660949627170927e-02   +5.536334828500324e-02   +3.578047593340328e-02; +2.568049017931581e-02   +2.900977145239751e-02   +2.925189291466515e-02   +4.932541393724536e-02   +4.578407397201395e-02   +7.537786109790383e-03   +3.808339617602570e-02   +3.805152301513803e-02   +1.504576442979536e-02   +1.462378786793508e-02   +4.072761198688563e-02   +5.360605756749397e-02   +7.297578994874441e-03   +3.371178724377039e-02   +4.636430410810743e-02   +1.088145313040496e-02; +3.259593706282012e-02   +1.437447681469020e-02   +2.113644910527922e-03   +9.076644324840233e-04   +5.308878142721480e-02   +5.620240672179790e-02   +3.594409151795300e-03   +4.151181513621374e-02   +3.854216920686772e-02   +1.748724777031608e-02   +1.049361597986602e-02   -1.248083170040808e-03   +5.267154319174652e-02   +8.583159046275712e-03   +3.161276952819701e-02   +2.959144489851201e-02; +3.775830835226762e-02   +3.964814106169981e-02   +4.922717902902056e-02   +1.066202220683152e-02   +4.081919079712470e-02   +3.823444843245159e-02   +4.188492269811841e-02   +4.486976992734207e-02   +4.624212207337558e-02   +2.389943209173330e-02   +2.270216733765019e-02   +6.224901774792473e-02   +4.773539237340581e-02   +4.199422234137276e-02   +2.933911867848227e-02   +5.234558334748887e-02; +4.847421704919309e-02   +3.798946081226980e-02   +1.887798635884154e-02   +3.300691624821799e-02   +4.212320756628616e-03   +1.401692649058154e-02   +6.733128099418827e-03   +1.283302338523797e-02   +1.490132454405329e-02   +4.381925941478801e-02   +1.024038548626202e-02   +5.337247208564441e-02   +3.700706892239940e-02   +3.408295503825148e-02   +2.101884450407132e-02   +1.748132636120584e-02; +3.139200656653119e-03   +2.981391335871632e-02   +5.001400633288353e-02   +2.995233782177600e-02   +1.885206705934570e-02   +8.785722853297980e-03   +1.348433947833479e-02   +2.728297430343483e-02   +1.380739640630933e-02   +5.958948122644603e-02   +2.227208703585117e-02   +2.038150035487251e-03   +3.199051371167865e-03   +4.989256379631474e-02   +6.463349282006051e-07   +3.572845782344791e-02; +4.754161779971165e-02   +1.331413820260626e-02   +1.303136161773702e-02   +5.709936675372263e-02   +3.486032703847165e-03   +3.376516807232189e-03   +4.645863753356322e-02   +5.795631101632111e-03   +2.719163304370994e-02   +5.182204176413532e-02   +4.143369418855864e-02   +6.645758227607462e-03   +4.266730561194205e-02   +4.723130159458769e-02   +5.859866704035491e-02   +5.276267330233332e-02];
L1E_L1I_iGABA_netcon = [+2.778768794072484e-02   +3.754690807244082e-02   +3.384101375646743e-03   +1.947916847308719e-02   +4.790823162611606e-02   +2.794008814054584e-02   +2.216957471761494e-02   +1.404880939795891e-02   +6.345880771803409e-03   +1.591570013484842e-02   +2.207461940001669e-02   +2.899747728229151e-02   +1.678704584626452e-02   +5.311443859294386e-02   +7.830012177175060e-03   +2.534981158655767e-02; +9.245644478444531e-03   +4.612846984795774e-02   +2.789835593080257e-02   +5.169494727106972e-02   +2.830139987056172e-02   +2.670993608200235e-02   +1.283322803282667e-02   +3.289889495010977e-02   +2.584529934356478e-02   +7.930841149061436e-03   +1.365129411603658e-02   +4.167168884795583e-02   +2.049887267926328e-02   +3.869457358349401e-02   +3.337349213811587e-02   +4.564982406947059e-02; +3.515914613594880e-02   +6.125803884759345e-02   +4.982662397485008e-02   +3.834584843736166e-02   +8.144306128555856e-03   +2.592193366247468e-02   +3.754462948789199e-02   +4.881443084924622e-02   +5.374277479846248e-02   +5.789580995469677e-02   +3.946860219950203e-02   +3.425463025778659e-02   +5.594140529320966e-02   +4.857034848144283e-02   +2.303622039068033e-02   +3.841235424008679e-02; +7.653367819208624e-04   +8.949468509368851e-03   +5.378380566227717e-02   +6.246384467267083e-03   +2.496295638513229e-03   +3.791681232174924e-02   +4.585523669235369e-02   +2.786088599618497e-02   +2.841415112632693e-02   +5.462797605379236e-02   +3.518012051731968e-02   +7.365169117042065e-03   +1.955753850162345e-02   +1.676942047297589e-02   +5.746249303822814e-03   +6.135848389076153e-02; +4.298215476361487e-03   +5.534712511643704e-02   +2.524073686199775e-02   +4.840077828985284e-03   +3.098644332892346e-02   +4.810050600400249e-02   +4.064969222654249e-02   +2.277231557143332e-02   +5.179058273500855e-03   +6.298338092460783e-03   +4.264626853031847e-02   +7.357257603763861e-03   +4.663733319856463e-02   +2.468499658651259e-02   +3.802637858176741e-02   +2.811642144056130e-02; +4.895307838395044e-02   +4.596911569314446e-02   +1.349226323365495e-03   +4.146047864218581e-02   +2.017848728582828e-02   -2.993773406478360e-03   +3.866137383958384e-02   +1.880885905390450e-02   +4.926947522146752e-02   +1.375672500389516e-02   +4.971099502395073e-02   +2.800714834678503e-03   +2.584075737429883e-02   +4.087062525828427e-03   +3.959682435592519e-02   +1.206323675643398e-02; +2.691348078824650e-02   +1.594857320202293e-02   +9.947139909433775e-03   +1.556849841776648e-02   +9.385343062104919e-03   +2.563663132073975e-02   +1.274844485030530e-02   +3.041564143881662e-02   +5.725027582297173e-02   +1.145428301755205e-02   +4.661936069760252e-02   +5.823790679655048e-02   +6.264138557002474e-02   +3.309269127415129e-02   +3.113152196723996e-02   +1.540158277806162e-02; +1.913411079260337e-02   +6.435575913212860e-03   +7.453943480531182e-03   +9.972657411206851e-03   +4.245598333409004e-02   +3.058822316953081e-02   +2.852894929754333e-02   +3.299450577846265e-02   +1.915168039680690e-02   +2.288691465744819e-02   +4.714037611063258e-02   +6.626347206001178e-02   +3.076736262847028e-02   +2.433129819432326e-02   +5.067956897111493e-03   +3.729374855781597e-02; +1.856020155008627e-02   +3.302828827373719e-02   +1.775914841851502e-02   -6.492933355192252e-03   +1.465491294776156e-02   +4.256611951433677e-02   +5.039838811554451e-02   +5.421385096541929e-02   +2.227070462210078e-02   +6.528455574431399e-03   +4.126680406253300e-02   +2.308883757098846e-02   +5.354006158743741e-02   +5.550078507857343e-02   +3.136268323886540e-02   +8.608814480636299e-03; +3.462381030143864e-03   +2.204919013286721e-02   +1.310897947394698e-02   +3.371288756801977e-02   +1.982609178754604e-02   +4.173363639445347e-02   +1.912569705716003e-02   +1.294378461614526e-02   +5.611336350932392e-02   +5.055566737131085e-02   +1.034347152451714e-02   +2.922946392863132e-02   +4.631460104720232e-02   +1.209208774970132e-02   +4.101489168975749e-02   +1.714361775349027e-02; +5.308073310026279e-02   +4.517385660343639e-03   +1.490794268546120e-02   +2.651195534306617e-02   +3.858473828421956e-02   +3.575735500124370e-02   +2.758448467733754e-02   +5.843670180887017e-02   +1.808556829064144e-02   +1.813923824913647e-02   +2.945526621455924e-02   +3.124459388383408e-02   +1.175527569652304e-02   +6.005688941880512e-02   +4.986655364535350e-02   +2.187443263230126e-02; +1.151071548080066e-02   +5.688281006939002e-02   +3.254523405124198e-02   +5.331925047389947e-02   +5.632039965430951e-02   +3.936666723693507e-02   +2.871307208210758e-02   +5.963300220043401e-03   +4.072555091389581e-02   +2.795572445374227e-02   +1.153868565333886e-02   +4.505079353481067e-02   +3.984427528009168e-02   +3.447544575155015e-02   +4.607718478823916e-02   +1.324550368828296e-02; +4.096582832744214e-02   +7.995773445776408e-03   +3.585615884918723e-02   +8.105469925750289e-03   +3.374648726055051e-02   +3.284822550251500e-02   +3.210313721147354e-02   +1.267706330667257e-02   +4.613147302282207e-02   +4.737538651262635e-02   +1.745137880950599e-02   +4.952219717904589e-02   +5.461854404451959e-02   +4.004627884912731e-02   +2.150478226342232e-02   +7.072122624861324e-03; +1.737879550274447e-02   +1.550492934986972e-02   +1.036234838078053e-02   +5.464590796222444e-03   +1.154209426673534e-02   +5.310765248231168e-02   +5.119175493120331e-02   +4.715832838229866e-02   +2.601641605498641e-02   +3.368388658299284e-02   +5.046560307664784e-02   +4.171334357337216e-02   +3.756427247260768e-02   +4.751358693083522e-02   +3.874266865332156e-02   +4.483875530418516e-02; +2.339172844290809e-02   +9.427698539443714e-03   +2.410973644336160e-02   +4.847180537766808e-02   +3.138612300259574e-02   +3.212651837605125e-02   +2.737468110789807e-03   +1.645878608779857e-02   +1.155390167413513e-02   +3.398571785677035e-02   +1.645904920506536e-02   +2.438258114452219e-02   +1.708790883337273e-02   +8.989877663108246e-03   +7.612155139639590e-03   +1.832224827283078e-02; +2.678134828579255e-02   +7.027803282390207e-03   +1.280349736460807e-02   +5.144878332077940e-02   +5.637725878047771e-02   +2.757297190353230e-03   +1.309395147031778e-02   +4.777234705388711e-02   +4.973057939582230e-02   +7.023137229911971e-03   +1.143672024667794e-03   +3.037155182987362e-02   +4.126752700652971e-02   +3.005042464711863e-02   +2.284376920190368e-02   +2.861071744891843e-02];
L2I_L1I_iGABA_netcon = [+5.818888399396943e-02   +2.145566750717659e-02   +1.611025218545740e-02   +5.095924372990925e-02   +6.033429864058399e-02   +5.162519542940616e-02   +2.197858046300007e-02   +4.665333641651691e-02; +4.747525961451431e-02   +5.237740228943938e-02   +3.478699632506659e-02   +1.878224895929264e-02   +2.371019626382340e-02   +3.988128145931258e-02   +5.133525093761826e-02   +1.513176894960203e-02; +1.230715114511182e-02   +1.443394211930852e-02   +1.387092220927038e-02   +5.701441161953648e-03   +4.905526121429214e-02   +5.676920552961095e-02   +6.867134520560772e-03   +3.508078312624738e-02; +1.616100558033424e-02   +4.415000070542547e-02   +4.111420996137286e-02   +3.669309110704599e-02   +3.374559585433966e-02   +3.230871274182919e-02   +2.807513147650235e-02   +5.194684537249412e-02; +1.645532184465374e-02   +6.603771998887039e-03   +3.376433587704119e-02   +3.876307293735736e-02   +2.411918275694981e-02   +4.576166902486679e-02   +2.646505695645152e-02   +3.479442560599070e-02; +4.426741828331710e-02   +3.785140082626502e-02   +5.198697977502259e-02   +3.075755683519065e-02   +1.656149524787003e-02   +3.883850208319924e-02   +7.480727905862289e-03   +4.072968042322918e-02; +3.253206343964943e-03   +2.503737467220082e-02   +2.196203249288833e-02   +1.289455377902121e-02   +4.842537568337373e-02   +1.548062008680296e-02   +1.210374449482354e-02   +4.098153144452950e-02; +3.306382826385010e-02   +2.405915690997070e-02   +4.650774544584595e-02   +2.899118675331818e-02   +1.727950148054839e-02   +3.799346183985303e-02   +2.561821936529589e-02   +1.570316909519108e-02; +3.050151476954853e-02   +3.750419076862452e-02   +1.388653493008234e-02   +1.043165132702983e-02   +1.647828412789989e-02   +1.025106758925985e-02   +2.489700241125053e-02   +5.796715086225094e-02; +2.688297550244151e-02   +3.981083498363085e-02   +5.028532242075922e-03   +2.368050516277678e-02   +8.838493388927343e-03   +3.885774544508912e-02   +5.264839103470554e-02   +3.992131091999289e-02; +2.828748801874344e-02   +4.813041565185543e-02   +4.633754887524775e-02   +1.799442078798677e-02   +4.493478550179216e-02   +4.836609673474954e-02   +4.992043722321726e-03   +2.164366896127940e-02; +4.670266188139829e-02   +3.031961219979124e-02   +4.018741741153834e-02   +2.908599045517942e-02   +5.328387475007052e-02   +1.009471408957003e-02   +3.693523791612194e-02   +1.854063354156037e-02; +2.464921525049971e-02   +5.568924726973386e-02   +4.882206872234900e-02   +6.301266658930557e-03   +2.922296645967880e-02   +1.981975753351096e-02   +1.620189530787232e-02   +3.727519828827061e-02; +4.601832263873695e-02   +1.450824334176614e-02   +5.702057227739874e-02   +3.115980946186146e-02   +5.103156956321018e-02   +1.369905510613672e-02   +4.944355500702333e-02   +1.414989700460879e-02; +5.887268825523772e-02   +1.386881313733138e-02   +1.595150167027158e-02   +5.845323914629016e-02   +3.996455017424490e-02   +5.616748835716363e-03   +2.652101784246072e-02   +4.500709657151336e-02; +8.243637947453379e-03   +4.107283410725854e-02   +3.283842189024992e-02   +3.931500487911750e-02   +5.228660554725006e-02   +4.434036276537844e-03   +5.446919339765974e-02   +1.658321635570657e-02];
L1I_L2I_iGABA_netcon = [+3.771932175892373e-02   +3.635864186345683e-02   +5.826445565976064e-03   +5.131435279944663e-03   +3.364832320976475e-02   +1.842763145897679e-02   +5.933061793322816e-02   +3.863717606439875e-02   +2.556154165756017e-02   +4.752923165169388e-02   +6.701943922352255e-03   +1.206239188614296e-02   +7.996457740862601e-03   -1.759030784709659e-03   +1.002738028744230e-02   +5.377082114131259e-02; +4.195082847394656e-02   +3.844552701943050e-02   +2.529406897776009e-02   +2.935291309905312e-02   +5.310471665293502e-02   +2.621805519619573e-02   +3.012454464008245e-02   +5.743460989994391e-02   +3.052133886763407e-02   +5.410878355880309e-02   +4.063702670258112e-02   +2.005212046464469e-02   +3.034644695989851e-02   +6.554345093943193e-03   +2.626378862041009e-03   +4.767721480737014e-02; +5.179917607722118e-02   +3.644327091988865e-02   +1.254214901639144e-02   +4.718662150242212e-02   +1.705256750760777e-02   +5.239496480351188e-02   +3.609484590094408e-02   +3.662230287923256e-02   +2.103017884253370e-02   +2.942845215259690e-02   +3.525061422729020e-02   +2.238565618377316e-02   +2.627535099289018e-02   +8.231130815731444e-03   +3.423426751113957e-02   +1.031173922332336e-02; +2.573201439369156e-02   +2.696846109121509e-03   +3.579495945898407e-02   +4.602569694752971e-02   +1.275190727064064e-02   +5.905070552575983e-04   +2.027517820077810e-02   +1.876081346244143e-02   +6.026776121686181e-04   +3.603968758264957e-02   +2.724902524577709e-02   +2.694173362114348e-02   +1.841676946091017e-02   +1.151057508184308e-03   +4.224087024715248e-02   +2.516227500271915e-02; +6.601250357600442e-03   +4.709756144678443e-02   +4.335093020562261e-02   +3.740990378630915e-02   +3.741793065346913e-02   +3.596708396323239e-02   +3.545598642929857e-02   +5.299201609011446e-02   +3.399027257909488e-02   +4.461548670735856e-03   +1.369629917576523e-02   -3.630959926959644e-03   +1.765942482047571e-02   +5.476811290123796e-02   +4.988800227087378e-03   +3.528324112067361e-02; +3.373387232742986e-02   +3.846396371268947e-02   +5.471063743276897e-03   +5.292111151398358e-02   +3.256871286338643e-02   +5.390397748947061e-02   +3.738615528297367e-02   +4.609858861634933e-02   +3.622377181084945e-02   +3.142706375376693e-02   +5.160952123988728e-02   +4.506918632055602e-02   +8.152407530613640e-03   +6.208568531801503e-02   +3.765254745174194e-02   +5.143627662623746e-02; +5.011966891084380e-02   +9.228550183399124e-03   +4.721663933595543e-02   +5.807401527523882e-02   +2.310241531952856e-02   +6.044954633564586e-02   +3.306938776744941e-02   +2.499493265355100e-02   +1.274398722665550e-04   +3.216245787759274e-02   +2.010685400942059e-02   +1.611167339886188e-02   +4.639285129650557e-02   +2.367196866431070e-02   +5.572034259087549e-02   +3.300042978895656e-02; +4.266782080316156e-02   +1.585978475595068e-03   +4.753197107214600e-02   +4.080271067781310e-02   +4.349060788401225e-03   +4.338997789155210e-02   +3.968064374211386e-02   +4.270529197384517e-02   +2.935186979358768e-02   +5.099642595864558e-02   +1.086071515441510e-02   +2.819785645273092e-02   +3.073982252361448e-02   -2.957053006127644e-03   +5.218203655579418e-02   +1.842942434106017e-03];
L2E_L1E_iAMPA_netcon = [+4.852450551317906e-02   +2.118858538743244e-02   +6.985340861721720e-03   +5.918464902511304e-02   +2.772223172247429e-04   +2.398698314027196e-02   +3.869205114817772e-02   +3.837332104445976e-03; +5.240342316416503e-02   +5.252642548820446e-02   +3.285770596314674e-02   +2.164355038438015e-02   +3.318716257045297e-02   +1.556925658460694e-02   +5.337770273480252e-02   +2.678945349251684e-02; +4.621960665027319e-03   +9.450722441702343e-03   +1.256855531081714e-02   +1.158047158616969e-02   +3.159879275116938e-02   +5.100027136762836e-02   +2.157058260926252e-02   +1.403679315127435e-02; +1.689273877703538e-02   +4.451584990214484e-02   +1.697652036768949e-02   +4.086537975461536e-02   +5.133802128742804e-02   +2.092941927923640e-02   +5.326428411384818e-02   +5.547196654436104e-02; +9.388949419709313e-03   +5.937452543041091e-02   +4.020676035090521e-03   +2.125582118241007e-03   +5.556275132892207e-02   +5.323015189585071e-02   +3.909789939993948e-02   +2.119070018189678e-02; +4.265592108226744e-02   +2.782978017391242e-02   +5.468866347970315e-02   +4.739431933861808e-02   +3.468365177753758e-02   +7.758269880829589e-03   +3.892218818152265e-02   +3.785604769063675e-02; +4.878367309439774e-03   +1.830698288954798e-02   +1.229811064616397e-02   +2.150575186273338e-02   +4.963827499887207e-02   +2.481656515547390e-02   +1.114071064605386e-02   +1.838741664988983e-02; +4.026905132748039e-03   +7.300004373552113e-03   +2.776533579318910e-02   +3.795106543505565e-02   +2.173461184077669e-02   +5.158683846100313e-02   +5.072348910133019e-02   +5.026231561401177e-02; +2.221212911697481e-02   +5.085126326795567e-02   +1.276080491764692e-03   +1.713528130682569e-02   +9.095152616266188e-03   +6.049522111137841e-02   +2.838238243913138e-02   +3.427069781997426e-03; +1.298038974945121e-02   +1.461650671630308e-02   +4.855993763973706e-02   +2.301635453628086e-02   +5.537336700296849e-02   +9.580546090394671e-03   +1.005657053743305e-02   +5.141431435062352e-02; +3.028612262111296e-02   +2.203295345801580e-02   +6.086780829516098e-03   +3.895084491686909e-02   +2.604712588292819e-02   +1.810376423776587e-02   +3.732668990332236e-02   +4.655465938466019e-02; +1.560044878683490e-02   +2.513919007698474e-02   +4.688275926917414e-02   +4.122821295735886e-02   +3.687363199513347e-02   +8.706498158991790e-03   +5.609973285366660e-02   +8.185261274100825e-03; +3.796967292977364e-02   +4.992174666624280e-02   +8.379782495089968e-03   +7.853843750787756e-03   +5.583743614908827e-02   +4.186433156491442e-02   +2.745211585967992e-02   +5.451553881962928e-02; +2.421456539506068e-02   +2.601853203748125e-03   +3.631464380117272e-03   +4.990393575423841e-02   +3.928303658444807e-03   +1.526564107818923e-02   +5.193725231854984e-03   +4.169362955606365e-02; +2.417103267430281e-02   +9.761358658035265e-03   +2.726208051773149e-05   +4.972875989279417e-02   +1.092309471537746e-02   +1.540249886702407e-03   +2.426020550325077e-02   +1.136423891145113e-02; +1.094051852978932e-02   +2.777008601658990e-02   +3.754972685340737e-03   +2.777398478276204e-02   +1.089342053189619e-02   +3.310923429036328e-02   +5.344994058242249e-03   +4.936176961651522e-02];
L1E_L2E_iAMPA_netcon = [+1.242329899661155e-02   +1.197622729618782e-02   +5.723120225910660e-02   +5.652622173754177e-02   +1.885719733603485e-02   +5.441655571940591e-02   +2.761055409434874e-02   +5.742444251545571e-02   +1.010533445845576e-02   +3.538407396779574e-02   +3.170770001345662e-02   +4.518426002190985e-02   +2.355350912832986e-02   +3.948794858656454e-02   +3.555566473750237e-02   +2.756831700315973e-02; +2.081215503854238e-02   +4.203676324997058e-02   +6.556208875722347e-03   +1.143786161058999e-02   +7.446955786247465e-03   +4.112905716921664e-02   +5.609873105645278e-03   +1.476351745870187e-02   +1.890723717685869e-02   +1.720424772310471e-02   +1.471003374066662e-02   +5.480953810111017e-02   +8.323508809080339e-03   +1.249123643159518e-02   +3.725471561868321e-02   +1.668527570778016e-02; +2.171419616038502e-02   +3.397416354771041e-02   +5.302348038639185e-02   +5.076042349315463e-02   +5.128279273692322e-02   +5.796607139708861e-03   +1.992915446734279e-02   -5.232666551545934e-03   +2.658828027707510e-02   +4.167113523447544e-02   +1.771766717239716e-02   +3.464422549898463e-03   +3.923848270171947e-02   +3.511752579439483e-02   +5.602852689874720e-02   +7.435988991295873e-03; +4.082148388610792e-02   +1.585606997962167e-03   +1.405685281405971e-02   +8.653190364927361e-03   +3.913498086485859e-02   +1.780084810352667e-02   +5.963132403637422e-02   +5.818775735680695e-02   +4.588941941495983e-02   +4.783903707655366e-02   +1.954992966622732e-02   +3.291095254424633e-02   +5.625250193051147e-02   +2.093383296220565e-02   +5.414278337738984e-02   +5.145013080632996e-02; +8.336565082324696e-03   +6.128944516693002e-02   +4.469673186224839e-02   -2.901153252792865e-03   +1.421784634302820e-02   +4.518252678704127e-02   +5.140256735739027e-02   +9.674785892971272e-03   +2.794548285594597e-02   +2.314342361341310e-02   +3.236068820511658e-02   +4.596197601326466e-02   +1.798760052051688e-02   +3.305283521239030e-02   +5.623042618378645e-02   +3.109871767336231e-03; +4.665477602969712e-03   +5.185692522751269e-02   +1.644898561652691e-02   +5.537742651361707e-02   +5.656554144374138e-02   +4.843218648448877e-02   +2.568302609411666e-02   +4.666082714638872e-02   +1.793040650783229e-02   +2.992348721036280e-02   +5.208508931674751e-02   +5.690955704994589e-02   +5.263702591864643e-02   +3.571036913827832e-02   +8.656876609296276e-03   +3.294177381423163e-02; +1.875678693379925e-02   +7.272722924889201e-03   +4.013282546938299e-02   +8.112368449315649e-03   +1.973073986186210e-02   +2.806587218526877e-02   +4.201186593710043e-02   +3.369840613080665e-02   +3.153177778783819e-02   +4.760860045788009e-02   +4.342965098432780e-02   +4.836148211261592e-03   +2.457727334595949e-02   +3.611942616759773e-02   +1.696172711498508e-02   +1.681208104947124e-02; +5.030421491048894e-03   +3.408858589059280e-02   +2.646325077219366e-02   +2.364611178755551e-02   +3.703697931558832e-02   +5.720908530174418e-02   +5.904446305268650e-02   +3.300548886266678e-02   +5.163058540061050e-02   +2.416125800592258e-02   +1.855114728509210e-02   +5.887733888031503e-02   +4.313466426951606e-02   +4.526559327412514e-02   +1.547890836294113e-02   +1.331529714523823e-02];
L2I_L2E_iAMPA_netcon = [+4.207397561756487e-02   +2.307424615039313e-02   +5.215655569676831e-02   +2.685519867448529e-02   +4.574342969826922e-02   +2.881289542118609e-03   -2.545605827277211e-03   +5.141900056700394e-02; +9.772976733005615e-03   +9.576139275861262e-03   +1.239705005307431e-02   +4.327693905384680e-02   +4.015873325634275e-02   +1.832614645973599e-02   +3.823311348229701e-02   +3.104308535175153e-02; +4.814684855002258e-02   +4.576503082710397e-02   +5.212611137452106e-02   +4.015872453773053e-02   +2.857180401969488e-02   +3.040890234846059e-02   +2.421621515867526e-02   +3.811178618493376e-02; +2.103713065693551e-02   +1.363402369868065e-02   +5.629245430246382e-02   +2.788437275581290e-02   +5.903059475046595e-02   +8.581526742353551e-03   +2.053398143805354e-02   +4.736523390945234e-02; +3.322039980176718e-02   +5.058122951084213e-02   +3.075150869160621e-02   +3.665913347211015e-02   +5.422835286080509e-02   +3.924843400228528e-02   +2.669493662715010e-02   +4.129040109441723e-02; +3.752767493905684e-02   -8.778822982869652e-04   +5.074751430232708e-02   +4.230197691037529e-02   +2.959018830329221e-02   +1.577266015944712e-02   +7.386640021631355e-03   +4.236892620898659e-02; +6.106171778627505e-02   +3.142869449013444e-02   +1.742463857893610e-03   -3.095415639787465e-03   +1.201902967874212e-02   +1.237195916317599e-02   +1.105232221787372e-02   +1.090453134844020e-02; +5.236420383751474e-02   +1.025033138676150e-02   +2.987340624303142e-02   +3.548034271884098e-02   +5.172562767943151e-02   +1.424654212016778e-02   +4.696091054278036e-03   +8.484670595435853e-03];
L2E_L2I_iGABA_netcon = [+5.714190624555805e-02   +1.142121823043928e-02   +1.341367982949233e-02   +7.711011415514323e-03   +4.174858233003827e-02   +2.254254976593639e-02   +4.111196039820743e-02   +5.571121290031330e-02; +1.485840638749267e-02   +2.243995078919103e-02   +1.510932443548487e-02   -4.180117778686458e-03   +5.826250770194508e-02   +4.452366337696909e-02   +4.354316395100884e-02   +3.594355573086523e-03; +4.036196641406493e-02   +2.254762089966377e-02   +2.856495832027225e-02   +1.038287831055446e-02   +1.504923857602735e-02   +2.033941489128035e-03   +6.030682406629087e-02   +5.109319623709387e-02; +4.060760921167064e-02   +2.366442063472178e-03   +9.850813487594418e-03   +4.327341993196016e-02   +5.455069957826612e-02   +4.395673476734095e-02   +2.575517987905549e-02   +3.470904644489126e-02; +1.001670218994186e-02   +4.853294412062312e-02   +3.478434406999738e-03   +4.719423404693823e-02   +1.950476819566753e-02   +2.034426537396386e-02   -3.394964671116114e-03   +1.519935404828185e-02; +4.237910864941589e-02   -7.186538957102410e-03   +2.853509534971349e-02   +4.795101819357050e-02   +4.990998622253125e-02   +2.250342682189814e-02   +5.602945015537876e-02   +4.162915024611760e-02; +5.970305603851490e-03   +6.244028189784132e-02   +1.330663231210758e-02   +1.086688780712984e-03   +4.370970963747146e-02   +2.510867041132175e-02   +3.011593968057291e-02   +3.189823948976416e-02; +4.584904808998742e-02   +1.696792585518088e-02   +3.151109891905320e-02   +1.726014317021773e-02   +2.063111885511173e-02   +4.651528466255524e-02   +5.470263578668326e-02   +3.810347743328550e-02];
L3E_L2E_iAMPA_netcon = [+2.518814759088671e-02   +3.593881310552824e-02   +7.938967365930784e-03   +1.011399161227779e-03   -1.472439788825582e-03   +5.767596071762313e-02   +1.727382308456212e-02   +5.094517218715182e-02   +6.959535696715919e-03   +1.055133033803093e-02   +2.245483916437480e-02   +5.407946068347057e-03; +1.291129355753199e-02   +5.463624242794427e-02   +1.594849340183464e-02   +2.397815276349870e-02   +3.135141980244070e-02   +3.497990793872170e-02   +4.666350030517086e-02   +5.721425737055329e-02   +3.641747928630842e-02   +5.391450374327653e-02   +2.270929834924695e-02   +1.874372493385537e-02; +6.792453579911286e-03   +4.541930995441882e-02   +7.245204133985459e-03   +4.031238283235068e-02   +1.723914924562932e-03   +3.596607324441864e-04   +3.539326697694946e-02   +5.635283005590919e-02   +3.925410439162660e-02   +2.668598120700814e-02   +1.734936233810516e-02   +3.807248778578488e-02; +7.295580500894260e-03   +1.944811873282976e-02   +5.151721865843394e-02   +2.239598877268502e-02   +1.381883535889243e-02   +3.854565718328055e-03   +2.161638802615366e-02   -4.015489268168328e-05   +8.768274653947160e-03   +1.849069291223451e-02   +1.075450072478669e-02   +1.903763420995896e-02; +5.195335430527160e-02   +2.401336988428167e-02   +2.132025273854606e-02   +5.100281613928413e-02   +4.589013993374366e-02   +1.741160947718808e-02   +5.887053772419556e-02   +9.829034101517692e-03   +4.341089688363373e-02   +2.239468911706618e-02   +4.465419083253968e-02   +2.128894469580169e-02; +4.927441115082361e-02   +3.382919502696662e-02   +2.576410336218560e-03   +2.444482391995057e-02   +3.857964272549966e-02   +5.715334104390282e-02   +5.718102567945178e-02   +2.313536078629535e-02   +2.974714067122374e-02   -6.025789264497985e-03   +3.627716635799260e-02   +1.146124308155184e-02; +3.946672714096693e-02   +2.257358395016507e-02   +3.280726435046622e-02   +1.668260065725959e-02   -1.194222019590395e-03   +2.647882939715324e-02   +3.614199583237672e-03   +2.354327256095397e-02   +1.826605569152403e-02   +6.906874365170516e-03   +9.981017370735848e-04   +2.278109907336501e-02; +5.100010089014745e-02   +1.039362237128299e-02   +1.554071504152447e-03   +1.731625817215707e-02   +3.181464551926282e-02   +7.772932960610320e-03   +3.624329869725326e-03   +2.328019591746794e-02   +2.427917950052807e-02   +4.781914173813473e-02   +9.877690384509240e-03   +3.639414501338309e-02];
L3I_L2I_iGABA_netcon = [+5.899211240167171e-02   +3.962525969477756e-02   +3.989895652632848e-02   +2.070520199444430e-02   +5.376242302845084e-02   +2.588322009425984e-02   +7.950235506437990e-03   +7.930320556113913e-04   +5.010257175171993e-02   +3.121021848337205e-02   +9.054192335421700e-03   +4.635588400343897e-02; +4.741116724665934e-02   +5.779625211538528e-02   +4.579153050781424e-02   +1.148277638739627e-02   +2.657305419596848e-02   +4.458045066953128e-02   +1.386485457153850e-03   +5.810306261425910e-03   +3.266295432635663e-02   +4.023121878068971e-02   +4.625276597282582e-03   +3.826608903850622e-02; +5.601799059726881e-03   +4.545539667616980e-02   +5.853016931868391e-02   -2.577187794608783e-04   +4.052121203188852e-02   -3.440013959783706e-03   +4.132572153917441e-02   +5.783999640228464e-02   +4.107405627692651e-02   +5.081182159956026e-03   +3.668516658257123e-02   +2.657693608284536e-03; +6.167824115059051e-02   +5.986353046076472e-04   -1.574899245624629e-04   +4.071504740993630e-02   +5.305551959652430e-02   +3.481953919836445e-02   -3.343731713716967e-03   +1.234017504516095e-03   +5.619267936471990e-02   +5.045135506505018e-02   +5.084765631939107e-02   +3.594025250027675e-02; +1.277614799038100e-02   +6.343812935406315e-02   +2.002507441340331e-02   +2.522469171726276e-02   +2.890166638986667e-02   +5.790335360163065e-02   +1.785319582629647e-02   +4.891112411553707e-03   +4.928976224262275e-02   +3.326061295431949e-02   +1.068463617651702e-02   +9.873257325152620e-03; +2.696742681591514e-03   +3.729528488412433e-02   +1.129408463834951e-02   +2.004836213731111e-03   +1.093281883467355e-02   +3.356160191739411e-02   +4.561173148272486e-02   +1.017036010557571e-02   -1.720520930711795e-03   +4.815217631874225e-02   +4.241241890781865e-02   +3.618588038787385e-03; +3.651895409815183e-02   +5.218392672560589e-02   +3.030927973438362e-02   +3.864582892061747e-02   +3.054450686820570e-02   +1.194120489417763e-02   +3.540987909463517e-02   +4.334072470972099e-03   +5.674479323158724e-02   +1.932965725536125e-02   +2.725796190921067e-02   +3.879170530451988e-02; +3.320010960289222e-02   +3.530335498196050e-03   +1.866196367729660e-02   +3.087277441013883e-02   +2.409152784577027e-02   +7.472065918311945e-03   +1.384858281049438e-02   +1.330647304551151e-02   +3.727022284711404e-02   +5.682484940309723e-02   +1.492102219814798e-02   +1.910305963710338e-02];
L2E_L3E_iAMPA_netcon = [+3.544542254486955e-02   +3.357246214921031e-02   +1.639858685321617e-02   +4.594986631555501e-02   +7.174730367615148e-03   +3.514948550616574e-02   +4.187193417841655e-02   +5.725411100491265e-02; +2.557001505584710e-02   +4.548899996837186e-02   +4.191665920103444e-02   +3.938537649363311e-02   +1.197158731881730e-03   +3.505937127611629e-02   +5.314456673239062e-02   +3.617662980354912e-02; +4.593718840472218e-02   +5.364750886947309e-02   +4.838040695129496e-02   +5.474005905113321e-02   +4.157725489019001e-02   +4.129484307821295e-02   +4.324243876397085e-02   +3.119416082675602e-02; +2.709444568598845e-02   +5.306296268764457e-02   +5.092418314062160e-02   +3.403739486684560e-02   +2.796327068988575e-02   +3.040692257075658e-02   +1.733238362275040e-02   +7.069706317834829e-03; +5.731440459829974e-03   +3.160270418561907e-02   +1.668239279192153e-02   +6.027291217983690e-03   +7.052754402779704e-03   +3.397552274748508e-02   +5.362767991418164e-02   +4.262748284924685e-02; +3.594471370212789e-02   +6.141844479851018e-02   +5.045701174068449e-02   +3.314017670513487e-02   +2.754981333497107e-02   +5.664241954921031e-02   +3.865565389432838e-02   +5.667204919646600e-02; +2.379443418767967e-02   +7.089946825541950e-03   +2.832744291356070e-02   +3.275606233052657e-03   +2.014640992154917e-02   +5.465210697529656e-02   +1.801854275180826e-02   +4.199852262435541e-02; +5.151987986958941e-02   +4.145714036826995e-02   +2.841868831084511e-02   +4.427954370463745e-02   +2.113853742998570e-02   +4.240372669478043e-02   +2.756316917085209e-02   +2.196512146740133e-02; +2.086576594639995e-02   +2.833329363489663e-02   +5.699235496122536e-02   +3.274413020472093e-02   +3.501583502839035e-02   +1.397648559722110e-02   +3.377713985989459e-02   +3.653618503705108e-02; +1.403629255308794e-02   +1.090498817810860e-02   +4.351437434207633e-02   +5.303423692374545e-02   +5.730521086200842e-02   +2.325161107608401e-03   +7.954748189536048e-03   +3.728270717662571e-02; +3.748120596177971e-02   +1.597190801448862e-02   +4.222563467826038e-02   +4.258080774220078e-02   +4.770514754480669e-02   +6.188020023682714e-02   +1.238420955164399e-02   +2.579879711391110e-02; +5.410101578544114e-03   +3.647612010229088e-02   +2.037730266197026e-02   +4.512427835737959e-02   +2.446903583671990e-02   +9.775528891461001e-03   +3.905759562477568e-02   +4.901066903552163e-02];
L2I_L3I_iGABA_netcon = [+5.577005534977617e-02   +2.315357836414270e-02   +1.684314644863641e-02   +3.328765473671186e-02   +4.942105864761095e-02   +4.759589360667646e-02   -5.970481488379968e-04   +2.848474103793948e-02; +2.474675969197611e-02   +2.614921259462902e-02   +4.407324544145280e-02   +1.172443266766355e-02   +4.752107605401436e-02   +5.012100145532648e-02   +2.946651544952816e-02   +2.093975908468789e-02; +3.839065977153527e-02   +4.699313473922670e-02   +5.285768980120013e-02   +3.408838424816093e-02   +2.289234190434142e-02   +3.662840405013973e-02   +2.984801624909296e-02   +5.573467947202691e-03; +1.215185304260852e-02   +4.644660986410646e-02   +1.212033773375588e-02   +3.024076445540360e-02   +2.491668962747045e-04   +1.895291322845855e-02   +2.406608711081838e-02   +5.883348407176385e-02; +1.909712596744129e-02   +2.301827480796256e-02   +3.247125118233211e-02   +2.813280470294286e-02   +2.132668541031455e-02   +3.451921581528000e-02   +8.017761726617539e-03   +6.822004757519162e-03; -7.296936852027740e-04   +1.592899026580829e-02   +1.936346482356273e-02   +5.172706643797115e-03   +2.209559452721306e-02   +2.737260554958952e-02   +3.081788232872084e-02   +4.835574342628728e-02; +2.169959642342115e-02   +2.744701805363960e-02   +5.409794258594517e-02   +3.922034887833187e-02   +4.738715419558306e-02   +2.019153966410122e-02   +2.438468985885659e-02   +2.342191522846724e-02; -6.424881462928343e-04   +5.268533008939112e-02   +1.743299224376336e-02   +4.427332650420273e-02   +5.083502824225013e-03   +4.045568590249379e-02   +3.253252806460580e-02   +4.185213769827104e-02; +4.572707099507179e-02   +2.593742607063433e-02   +5.302146090082096e-02   +8.257830960012942e-04   +3.021328113189239e-02   +1.589919078643394e-02   +2.295427476000250e-02   +3.063892446201140e-02; +4.395331478405998e-02   +3.291980167863383e-02   +4.044666652405055e-03   +3.009671044396232e-02   +3.146669538600726e-02   +1.575430118997822e-02   +1.305546098316562e-02   +1.774078795620646e-02; +4.144312263018245e-02   +5.379438053244644e-02   +3.455530238845572e-02   +4.123346198740429e-02   +2.002935553419630e-02   +2.618831686812915e-02   +5.364405180569684e-02   +1.121297620169252e-02; +3.816391619012849e-02   -5.464909231938484e-03   +1.573694139691513e-02   +7.120360802318123e-03   +6.731507345479270e-03   +5.121181517985273e-02   +3.215693892868887e-02   +3.249311460356646e-02];
L3I_L3E_iAMPA_netcon = [+2.335037608270005e-02   +5.223813598242485e-02   +1.002013029769291e-02   +3.247670574659874e-02   +4.299195392666827e-02   +2.486326222059549e-02   +1.926021288714471e-02   +9.490926757406377e-03   +2.471323843143698e-02   +2.035533927901269e-02   +1.760328948756959e-02   +8.634401240234815e-03; +2.384495687788931e-02   +3.903713106394767e-02   +1.658153971060920e-02   +5.141617768855343e-03   -3.837548690157324e-03   +3.117977571524078e-02   +3.710162036396878e-02   +2.746355392189496e-02   +1.940657388682630e-02   +3.125592147232617e-02   +4.149823857454538e-02   +3.106460296998537e-02; +3.729737608274604e-03   +2.824285879682002e-02   +2.981264683506729e-02   +3.197428692018878e-02   +2.870698108149711e-02   +2.381761605905784e-02   +2.524232550512325e-02   +2.208764168011624e-02   +2.629905366014023e-02   +3.330501165777396e-02   +2.349235110551564e-02   +3.304092363968680e-02; +2.556362346969710e-02   +4.150894659024195e-02   +3.642372565145490e-02   +3.027614835499458e-02   +2.964662835502129e-02   +5.382290458959763e-02   +4.569229047013912e-02   +8.512400785612627e-03   +5.334289928000199e-02   +5.365831495113106e-02   +1.258298352095536e-02   +3.567847755345658e-02; +5.191173564853543e-03   +2.760036178111774e-02   +1.225512267291325e-02   +5.277923338669560e-02   +4.362522266260802e-02   +3.315666918088828e-02   +5.458028753530750e-02   +7.697392997665069e-04   +5.585447847120545e-02   +3.117785221814676e-02   +1.622395617910464e-02   +6.890822753170464e-03; +1.716541524725716e-02   +2.748814045867707e-02   +4.645125592518537e-02   +2.790725397613626e-02   +5.855694422028253e-02   +3.074928377733641e-03   +4.900414174243230e-02   +1.611570803873254e-02   +4.005984044858686e-02   +8.872728162685164e-03   +1.771183421876743e-02   +1.093411305080440e-02; +4.423674425231446e-02   +2.224580354412008e-02   +2.229201013860330e-02   +1.506581278156710e-02   +3.203604538614688e-02   +7.459761896284590e-03   +2.580349127557237e-02   +5.505347332595090e-02   +5.151701057267928e-02   +5.813743363547252e-02   +3.154564149726109e-02   +4.092643367006642e-02; +4.269929442240006e-02   +8.934913997156168e-03   +4.464817442298349e-02   +3.853857130663704e-02   +5.462909423954156e-02   +3.367319617839306e-02   +3.897869867975519e-03   +2.956055814733650e-02   +3.108635170604241e-02   +1.990461973828807e-02   +1.250377973898924e-02   +5.392381408820607e-02; +6.520102921955010e-03   +5.014333302428615e-02   +3.515708917407979e-02   +3.880271531705167e-02   +2.248197899605451e-02   +4.334955063373746e-02   +1.088227472748925e-02   +4.252174450567709e-02   +4.400753283315125e-02   +2.705277152104744e-02   +1.732347863290621e-02   +8.869790589983221e-03; +5.484484400964728e-02   +4.984989734712463e-02   +2.229918165221530e-02   +1.613735233886378e-02   +2.691325237281121e-02   +4.922132321556339e-02   +3.469956736075262e-02   +5.518422833745096e-02   +4.527203645768659e-02   +2.007008306609131e-02   +5.213807488414329e-02   +1.496893963551264e-02; +2.803729657735547e-02   +2.381093049334330e-02   +5.922265899940257e-02   +4.814955055982219e-02   +6.723647070213233e-03   +3.165393815910723e-02   +3.555477676758194e-03   +1.390861722907920e-02   +4.131225935448316e-03   +5.292659299912682e-02   +4.554365398634815e-02   +2.218434199642819e-02; +2.918063701448503e-03   +1.489011916140195e-02   +7.877877767549325e-03   +3.477794260820288e-02   +2.930454216978486e-02   +1.954269770671171e-02   +4.666263312528875e-02   +4.904556304238609e-03   +2.082776297959241e-02   +1.043016162277157e-02   +4.107332557911554e-02   +1.932973955195862e-02];
L3E_L3I_iGABA_netcon = [+3.316518336080025e-03   +2.207685330421627e-02   +1.581460307761413e-02   +5.655135328220431e-02   +4.523027777431336e-02   +3.759247715633443e-02   +2.059211005278283e-02   +4.129692353039940e-02   +3.365754963278752e-02   +4.391837296945238e-02   +3.098885896162324e-02   +1.157503237531562e-02; +4.293532447901813e-02   +4.092814013485473e-02   +2.103255421268644e-02   -1.047911526818698e-03   +1.705545503485516e-02   +4.022392928347696e-02   +3.482077149215498e-02   +5.918460089905606e-02   +4.428679770566711e-02   +2.711539288401078e-02   +1.531994196251992e-02   -2.797700397560178e-03; +3.197526703814423e-02   +5.796138173056201e-02   +5.721324833639933e-02   +4.974368729335926e-02   -2.238286729951492e-03   +4.474235717038773e-02   +3.621343974434517e-02   +3.775999395374362e-02   +2.271307630448954e-02   +2.388832543960700e-02   +1.713075933791376e-02   +5.348755637367507e-03; +1.951168113647429e-02   -2.325362041444695e-03   +9.815740775856868e-03   +4.738935854346930e-02   +4.358744692243601e-02   +2.116380770187494e-02   +2.333168052713746e-02   +2.684475223529945e-02   +6.071770759865276e-02   +2.642807753932939e-02   +5.577259017864980e-03   +3.972933387943332e-02; +2.403848926017356e-02   +2.636699544560287e-02   +6.162635290095562e-02   +1.095345295886930e-02   +2.386117831569387e-02   +4.528098583888594e-02   +6.062117532160012e-02   +5.373389832072019e-02   +1.840190333959395e-02   +3.858255675215247e-02   +5.172711980605849e-02   +3.466207342476468e-03; +3.854786343025113e-02   +2.057010598363181e-02   +4.713223414429887e-02   +1.725180658493268e-03   +6.852293583295463e-03   +6.186667720546984e-02   +1.521468181812130e-03   -6.962774635696628e-04   +4.368428391150604e-02   +3.543092445509727e-02   +1.008766980080150e-02   +8.582909489419574e-03; +3.274135462107579e-02   +2.171530343506045e-02   +3.282122381030695e-02   +3.548593795750299e-02   +3.279322890776341e-02   +2.384478071024026e-02   +1.670253280046079e-02   +2.867064037436458e-03   +2.691715646469743e-02   +5.328930624028353e-03   +1.648897303341812e-02   +3.352866449150924e-02; +1.214382806747836e-02   +5.500420134622109e-03   +7.478916693984548e-03   +5.371147890454703e-02   +2.348194920920096e-02   +4.564166220501534e-02   +3.159235369217495e-02   +4.233853539102297e-02   +4.451630226430175e-02   +5.123004988400436e-02   +1.048597379976451e-02   +4.055541132027569e-02; +1.438368324489414e-02   +7.770699917203357e-03   +4.914754227809025e-02   +1.474441147602875e-03   +5.633851916831224e-02   +5.378787987491400e-02   +1.275501177535532e-02   +5.021888805646681e-02   +1.038708955146550e-02   +1.805070876743251e-02   +2.768146691420405e-02   +3.284212301974356e-02; +4.574420807796721e-02   +1.928370713825176e-02   +5.131804260815407e-02   +1.434224944449084e-02   +2.124903836312236e-02   +6.136233754505539e-02   +3.944910260558842e-02   +2.951967976376539e-02   +5.614429830535898e-02   +5.780383101383650e-02   +1.395346927492850e-02   -2.419990792171914e-03; +2.789000365815977e-02   +5.453198238001027e-03   +1.980214223342237e-02   +1.230671293345494e-02   +3.579409815243266e-02   +2.731097498739505e-02   +5.712451573036558e-02   +4.302587871351812e-02   +2.830133570470026e-02   +1.234130195798812e-02   +5.236780937805997e-03   +5.038136514300820e-02; +4.092531662507459e-02   +3.730937462545691e-02   +5.886613835607824e-02   +4.157879854502579e-02   +4.873118731618558e-03   +2.430931060645840e-02   +5.583967390854287e-02   +2.375858624317159e-03   +4.272495779856390e-02   +2.533441989547500e-02   +2.862162327877638e-02   +2.629505074382803e-02];
L2E_Input1_iAMPA_netcon = [+5.657855885079476e-02   +5.923118076173117e-02   +5.004039328157158e-02   +5.587495724407317e-02   +6.105951285261991e-02   +6.493590769255178e-02   +5.979554651345799e-02   +5.689779466171171e-02];
L2I_Input2_iAMPA_netcon = [+5.248189819076982e-02   +5.998301478858126e-02   +6.095276963894354e-02   +5.336698439159063e-02   +5.355525695008992e-02   +6.499458839773932e-02   +6.081800307270940e-02   +5.423979666332764e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
