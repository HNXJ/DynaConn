function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.007970582908704e-01   +1.123027755172362e-01   +3.525722813483327e-01   +3.552477211832394e-01   +5.379448237675181e-01   +1.585864528941253e-01   +1.227022571359489e-01   +7.842916956169506e-02   +1.297684803419794e-01   +5.118784133635570e-01   +8.055403548647993e-03   +1.938856896737960e-02   +3.486911381331430e-01   +5.875826826624588e-02   +7.357390948128120e-02   +2.404000799429765e-01; +5.544922255487025e-01   +2.128783218607631e-01   +3.949960734150619e-01   +3.304185242637999e-01   +4.411547329578794e-01   +3.844090159668365e-02   +5.583600046068094e-02   +1.647863736211696e-01   +2.751026854384012e-01   +1.279171752382781e-01   +4.118373874016403e-01   +3.965748908950673e-02   +3.322332556202836e-01   +5.179732413954442e-01   +1.416595694356587e-01   +3.344753758316356e-01; +4.790571630258172e-01   +5.754573791418229e-01   +2.153377012973148e-01   +9.375169082081769e-02   +5.163648185779400e-01   +1.302896063584921e-01   +4.284121923780411e-01   +1.528741401182391e-01   +2.804314460358612e-01   +8.267799611575959e-02   +4.619997749908092e-01   +2.600606587065853e-01   +3.582121018500463e-01   +4.500425351686163e-01   +1.508035407595049e-01   +4.835124945520001e-01; +1.396315803604109e-01   +1.421149902142536e-01   +3.590582805650718e-01   +4.892468748336435e-01   +1.033066386378844e-01   +5.326913617891107e-01   +5.564607474897327e-01   +2.586176930362539e-01   +3.841843779945115e-01   +7.583350628479373e-02   +3.812233769586291e-02   +2.518901675780983e-01   +2.276552516072755e-01   +5.071141882171062e-02   +1.026706599560748e-01   +4.015391844638271e-01; +1.873836863740110e-01   +1.335047433367233e-01   +5.472997793410348e-01   +3.209096586114255e-01   +2.241904075526000e-01   +4.239458655681632e-01   +4.832954569793564e-01   +2.212255298941817e-01   +5.719008683064126e-01   +4.459128704703625e-01   +2.185981691477322e-01   +1.248335104138465e-01   +2.226721551531761e-01   +1.484300627881204e-01   +3.825573327337166e-01   +3.361865950799857e-01; +8.146551681211292e-02   +3.397357768457072e-01   +3.720254242844379e-01   +1.405522191599055e-01   +3.561526129522526e-01   +4.479743044299594e-01   +1.434978247941554e-01   +1.674013001197502e-01   +5.666025769705854e-01   +3.955995632914913e-01   +1.223431518535718e-01   +5.395030304888012e-01   +1.843192047768360e-01   +4.934859257566688e-01   +4.021062953140509e-01   +5.621347343947455e-01; +3.944015069449989e-01   +5.302980006464710e-02   +4.755953446856289e-01   +3.729955817439742e-01   +3.774189386192038e-01   +2.476505304194634e-01   +3.976455364532299e-01   +5.053720069213699e-01   +4.898378117693311e-01   +5.453382790513559e-01   +5.178306324025597e-01   +3.679458084433843e-01   +2.685463705798101e-01   +1.197597089861565e-01   +6.227984763861827e-02   +2.728218228164767e-01; +2.075313960315975e-01   +2.290137836807036e-01   +1.220760490359499e-01   +5.204009803381888e-01   +2.116065145879454e-01   +1.807424908019158e-02   +3.277922131853249e-01   +5.308799531680054e-01   +4.959054356120725e-01   +1.290097675724979e-02   +9.465742907490919e-02   +2.858365416711302e-01   +1.710226889408837e-02   +5.690025244128500e-01   +2.666745317919778e-01   +6.822645402041444e-03; +5.862774153319724e-01   +2.321302347157385e-01   +2.605803237472900e-01   +1.500850705433547e-01   +3.681431245743714e-01   +4.994576415017449e-01   +1.284020255521556e-01   +3.540999645327145e-01   +9.937695533672038e-02   +5.012901966300157e-01   +5.935422223097375e-02   +3.823305364268533e-01   +9.883477928566166e-02   +4.247533112948713e-01   +1.717639354187664e-01   +7.387768987124957e-02; +4.295045716603547e-01   +4.303245366796967e-01   +2.979644271222491e-01   +3.718060847439408e-01   +1.930445511325432e-01   +3.141375823368070e-01   +2.000414357570348e-01   +1.605183795164705e-01   +5.825809870622767e-01   +1.392405393828634e-01   +2.387442197721673e-01   +1.248096047719965e-01   +9.659562665179816e-02   +1.119480600544505e-01   +2.125249191090840e-01   +4.464241898894818e-01; +7.692991993930413e-02   +5.154425817324424e-01   +5.019134672988712e-01   +4.462398392712718e-01   +1.983993996711120e-01   +3.569730261386571e-01   +1.621558688110710e-01   +1.364773021658487e-01   +3.741277813451149e-01   +3.576168078836757e-01   +1.900047368851351e-01   +2.276908792875739e-01   +4.819260777654118e-02   +2.412291783455215e-02   +4.887843313794146e-02   +5.694768400057743e-01; +6.796919775268259e-02   +5.838904585273934e-01   +5.717374979886041e-01   +5.901824410572144e-01   +5.844402030995403e-01   +5.778689537381697e-01   +5.038021166913140e-01   +3.062514744258701e-02   +3.152889993712639e-01   +5.173481274587330e-01   +7.757301656251540e-02   +1.868768452312560e-01   +4.798898431937814e-01   +2.977521336363917e-01   +5.116597042187564e-01   +1.930561480320002e-01; +2.535927817519050e-01   +1.049001595870139e-02   +2.148206285081323e-01   +1.818743366214027e-01   +4.324495820123137e-01   +2.062188100038134e-01   +5.770084480191137e-01   +2.336982184005483e-01   +4.061854785612992e-01   +5.707234210744729e-02   +1.732510032260621e-02   +1.253212415604941e-01   +5.368751633561389e-01   +1.215318900247714e-01   +4.893785473277927e-01   +2.889638905469564e-01; +3.007494048093627e-01   +2.183612297577173e-01   +5.903370630711198e-02   +8.283654974224994e-02   +2.862921570482575e-01   +3.760511198979518e-01   +4.561081726601707e-01   +9.158590766154839e-02   +4.385847272925257e-01   +2.995615522953664e-01   +1.748686396091572e-01   +2.246025272417128e-01   +4.449478683625361e-01   +8.761392935750524e-02   +1.569469387412959e-01   +1.166839652123388e-01; +1.559916531836118e-01   +5.152239608028409e-01   +3.193943891097837e-01   +3.348410215024964e-01   +1.515023546802277e-01   +3.197384330826403e-02   +1.203124233782795e-01   +5.666516876694994e-02   +1.819042835208536e-01   +4.417231262301506e-01   +4.170356071527673e-01   +4.613410593125929e-01   +4.509738330354610e-01   +4.229445178328933e-01   +3.313295475867689e-01   +3.674783627695480e-01; +1.280967299960907e-02   +5.357612862577387e-01   +1.381375286431451e-01   +4.705027114749981e-01   +4.548589278434426e-01   +2.818036894483794e-01   +5.758125012589859e-01   +4.457088369114955e-01   +3.658353797607788e-01   +9.108508069776669e-02   +4.427941239641975e-01   +3.935078503939946e-01   +4.457230889741683e-01   +5.895222485067191e-01   +1.725231587257687e-02   +1.592219813186465e-01];
L1E_L1I_iGABA_netcon = [+4.810713051367331e-01   +6.220970180255940e-02   +1.693984085876632e-01   +3.253731909375326e-01   +5.421232827427577e-01   +3.409485648252729e-01   +4.374332121274951e-01   +5.721295753119173e-01   +4.898487972116425e-01   +3.539275748705761e-01   +3.253147709538131e-01   +4.935913926707226e-02   +4.188730029824154e-01   +1.470077177229223e-01   +5.235309179311749e-01   +1.004347020212294e-01; +6.874712598907004e-02   +7.747661838014666e-02   +5.457353669283678e-01   +3.708215844968764e-01   +4.232458550936768e-01   +4.362947418931508e-01   +1.174846390433341e-01   +2.254366439826379e-01   +6.250491354777835e-02   +5.326859198422221e-01   +5.283874455581864e-01   +1.773772347162056e-01   +5.597014040869313e-01   +3.869584341861780e-01   +3.737691898402993e-01   +1.342200346555018e-01; +4.362311971584316e-01   +2.444424524839294e-01   +2.665662697992606e-01   +4.748846266487063e-01   +5.128647846465662e-01   +5.213447732234346e-01   +4.038648999501374e-01   +9.785814121172438e-02   +1.273146580280951e-01   +3.460724502980739e-01   +3.350514034090318e-01   +3.709904966232187e-01   +5.461570544673947e-01   +1.153514826347080e-01   +2.925396483015757e-01   +4.646763084285969e-01; +3.712402538834513e-01   +3.187681489091735e-01   +2.241826658524135e-01   +5.603698367093968e-01   +1.268935183841028e-01   +3.170328289821808e-01   +1.150000523541286e-01   +1.494524985239018e-01   +2.663805031569025e-01   +2.325693178715078e-01   +3.647368832595944e-02   +2.147918248463732e-01   +1.374595985295661e-01   +2.679620917593551e-01   +2.735588798967792e-02   +3.505202632640601e-01; +2.216703439524160e-01   +7.401298636525931e-02   +4.751602499058436e-01   +4.765003583485496e-01   +5.656655735279288e-01   +7.749500317939777e-02   +1.872748647552581e-02   +1.229021941076932e-01   +5.008615332502169e-01   +3.560015749981291e-02   +5.506513135675332e-01   +3.024388355449998e-01   +3.429697163232704e-01   +1.476177740146611e-01   +3.628544199291787e-01   +1.213040833458292e-01; +8.106201935255952e-02   +2.876026085563710e-03   +1.398003162970134e-01   +5.610781504373622e-01   +3.928043263631651e-01   +2.877326848146349e-01   +2.764306226926265e-01   +4.916758903515159e-01   +3.868756276921363e-01   +1.692889579124384e-01   +8.712322272280029e-02   +1.763833549583095e-01   +1.489392733455549e-02   +4.986373876244060e-01   +6.916648962304958e-02   +4.513695593955706e-01; +5.741208236608553e-02   +2.979445511428068e-01   +3.935884063681280e-01   +1.701717652076557e-01   +2.135883642226692e-01   +3.435748031044634e-01   +2.798416551575432e-01   +5.549454473151932e-01   +8.657609704604603e-02   +4.603941460342594e-03   +3.691771714216223e-01   +5.284047279237551e-01   +4.476558963447692e-01   +4.165107667934085e-01   +4.656504181072280e-01   +1.981112313769833e-02; +3.562215230421933e-01   +3.872751444820264e-01   +2.388504719329398e-01   +4.511600185939487e-01   +3.896924135907823e-01   +5.944351753141861e-02   +5.040812719504484e-01   +3.973360358226594e-01   +2.068331191252463e-01   +5.106027480869716e-01   +5.063449249141344e-01   +5.741811765176360e-01   +1.673402879675267e-01   +3.623285862390931e-01   +1.890726771853818e-01   +5.695520660288373e-01; +3.990151414632025e-01   +3.643950871472734e-01   +4.961419939129728e-01   +3.504828890227468e-01   +1.275430076705717e-02   +2.068942262442743e-01   +2.563340306670588e-01   +4.917345961584870e-01   +3.699805569668004e-01   +4.311907890911809e-01   +4.707387198812936e-01   +5.129504053348999e-01   +3.086952268796579e-01   +1.661028574634082e-01   +2.866297758943521e-01   +4.425972994551213e-02; +1.582731073737182e-02   +9.427716747325592e-02   +5.637244463042823e-01   +5.826559374119984e-01   +1.613458431493053e-01   +5.768414546653120e-01   +3.456324739071954e-01   +3.756473237933841e-01   +3.609662832731474e-01   +1.083104972101244e-01   +1.741004838087436e-02   +1.976502627623651e-01   +1.148977261828987e-01   +8.987016641895337e-02   +5.597424780226896e-01   +2.579596110673783e-02; +4.033555926853547e-01   +1.157376538623206e-01   +4.197599501030603e-01   +5.209957849275592e-01   +4.510121511856877e-01   +3.018048450448714e-01   +2.801446882774576e-01   +4.401289620365404e-01   +1.067042671647960e-01   +2.940824151636001e-01   +5.109120849249441e-01   +3.295494405236710e-01   +4.858897956367013e-01   +3.337877071416746e-01   +3.742519249923969e-01   +1.638313799278615e-01; +2.019950881715311e-01   +7.015608719519743e-02   +2.130926439973925e-01   +5.724196353615258e-01   +5.806550722457406e-01   +2.685104247896378e-01   +2.919191677816221e-01   +4.596201270571995e-01   +2.398204256529871e-01   +2.310383762335589e-01   +8.149772303920040e-02   +1.935038660211983e-01   +2.346583116848094e-01   +7.899561179307965e-02   +6.943251767893428e-02   +3.754708254857240e-01; +8.791547594654353e-02   +5.286929900417611e-01   +2.721219729580111e-01   +5.328470551412470e-01   +4.066162298317541e-01   +2.277614181281607e-01   +1.792963595892585e-01   +3.148891739472648e-01   +3.570429945095985e-01   +2.410371830044189e-01   +3.480606089438541e-01   +3.588975487493924e-01   +3.792311659749397e-01   +3.159772234126114e-01   +1.242583848156304e-01   +2.830725337378268e-01; +2.487000781946941e-01   +2.836514038270452e-01   +5.373222230890999e-02   +5.934916293080839e-02   +2.739627109757040e-01   +4.606248139968094e-02   +2.105026583458229e-01   +5.848645431673032e-01   +5.178934756357373e-01   +9.071376751487598e-02   +2.092857554117430e-01   +1.930807106295945e-01   +3.337871039406138e-01   +5.795366491250926e-01   +2.356551232763636e-01   +4.065270200377292e-01; +4.035054411661062e-01   +4.704814691487397e-01   +1.833132511709918e-01   +1.688785562353740e-01   +5.574250662020419e-01   +2.342526365972696e-01   +2.823241856489656e-01   +1.251711569956061e-02   +4.378043600246496e-01   +4.925456115698865e-01   +4.477280422141381e-01   +1.965975594950949e-01   +4.140486692303417e-01   +5.505835478471753e-01   +1.877753776157266e-01   +4.584104494035978e-01; +4.972375155989988e-01   +3.495704467096291e-01   +4.141219536287468e-01   +1.111638755972958e-02   +3.569416041509629e-01   +5.688748109409791e-01   +1.111071763270257e-01   +2.335147797244089e-01   +3.293744181496238e-01   +5.343176155954538e-01   +5.147411926998173e-01   +2.648466199398636e-01   +4.747396532696284e-01   +3.817980004635655e-01   +5.878500989189430e-01   +5.783445145676198e-01];
L2I_L1I_iGABA_netcon = [+7.737471696497755e-02   +1.541399405729847e-01   +5.687059341749287e-01   +1.484742320748056e-01   +2.037358942265732e-01   +4.453067471015245e-01   +5.497442509684054e-01   +4.609459091170845e-01; +2.089838096996784e-01   +8.345243897724007e-02   +5.045402668695971e-01   +2.941184428852785e-01   +2.660912369289304e-01   +5.913625279859382e-01   +1.705364587486657e-01   +1.492132828663844e-01; +2.665889183316433e-01   +4.526110937430131e-01   +5.617666710099900e-01   +3.371209575956118e-02   +1.591556149120982e-01   +6.319224530937266e-02   +5.202213352614536e-01   +2.236433429872324e-02; +2.046533526049900e-01   +3.333397519868939e-01   +1.919662400327180e-01   +1.324457250530935e-01   +1.730998973838176e-01   +9.097412636637167e-02   +1.514627209816545e-01   +2.516344822856956e-01; +4.308435847975596e-01   +5.592172758139362e-01   +2.775299534599009e-01   +9.749222251270390e-02   +1.715226089230694e-01   +5.232076242701990e-02   +4.801771143854465e-01   +3.726059944519491e-01; +5.408038187172740e-01   +2.960385293092615e-01   +4.566693126427799e-01   +2.468932084541210e-01   +2.565576961930889e-02   +3.968675748787954e-01   +3.317652582279908e-01   +4.114501971420440e-01; +4.143588543476673e-01   +5.720466416578647e-01   +5.615028528402161e-01   +3.895974424593093e-01   +2.195201061487955e-02   +5.823546044390944e-01   +2.326424337907031e-01   +3.448828405565968e-01; +4.549143367519277e-01   +3.522158222598586e-01   +5.591909464640359e-01   +5.884591696746845e-01   +4.620601021086541e-01   +7.267982961189577e-02   +1.724388734756177e-02   +5.450801912737903e-01; +5.630275265781280e-01   +3.055502456810832e-01   +3.206364851899470e-01   +2.789848219847331e-01   +4.649040066664594e-01   +5.694868574770819e-01   +6.910145309056093e-02   +1.263052190033797e-01; +1.798341117343021e-01   +2.609392110957044e-01   +7.343988383533906e-02   +1.417512509591364e-01   +1.415401421673762e-01   +5.318652539553468e-01   +4.285992247845817e-01   +1.689811429188782e-01; +3.709561647412378e-01   +1.349514875446851e-01   +5.917254982096490e-01   +1.058740201917274e-02   +2.666658566032165e-01   +4.512962618628614e-01   +2.029253248218853e-01   +2.855086586966871e-01; +3.118844062473586e-01   +1.876113528529839e-01   +4.196834302641040e-01   +2.157132830332381e-01   +2.975814491746009e-02   +3.947524789730765e-01   +2.379219169462281e-01   +5.337641856738698e-03; +2.099718012884079e-01   +5.475837558328279e-01   +3.526903435637816e-01   +6.742183645403370e-02   +3.418153784600891e-01   +1.914635818948930e-01   +4.215834878046495e-01   +1.104138448473871e-01; +5.397451697663247e-02   +3.084072981317755e-01   +4.755653065049218e-01   +2.083987790127505e-01   +4.525768000142040e-01   +1.204023984208227e-01   +1.158619440760705e-01   +2.887179642985632e-01; +3.854395742305927e-01   +2.981900350744551e-02   +3.260135321042887e-01   +5.794601190266169e-01   +2.698182536975183e-01   +3.883963687040574e-02   +1.238226143239972e-01   +2.836341838626688e-01; +4.658399634208440e-01   +5.049292417402274e-03   +4.992748337539972e-02   +5.254544933030871e-01   +2.174735841514082e-01   +4.334854394325937e-01   +6.964754302956577e-02   +1.610138380935644e-01];
L1I_L2I_iGABA_netcon = [+5.637361307429815e-01   +5.361197733305466e-01   +4.299509576321512e-01   +8.724408437396786e-02   +7.496904609211601e-02   +5.393449849379003e-01   +7.823313441970596e-02   +1.443179574868253e-01   +9.157676500091649e-02   +1.939677033339873e-01   +4.371051556738756e-01   +2.917396199521179e-01   +1.909392358691488e-01   +3.717856940401583e-01   +5.239313619794005e-01   +5.284190594144660e-01; +3.002629373734829e-01   +5.439305982202643e-01   +2.108847712867520e-01   +2.040807462343821e-01   +5.265856629728587e-01   +5.589726913809261e-01   +2.835240584845206e-01   +9.560492182788065e-02   +2.779956643098029e-01   +5.261300139986201e-01   +3.628497541157572e-01   +5.437524679629069e-01   +3.290553675220599e-01   +2.323190794801553e-01   +1.546324503260021e-01   +3.171603671947111e-01; +2.379460317169622e-01   +2.815916986066960e-01   +2.574771039841429e-01   +3.446684099703191e-01   +1.897473494167278e-01   +4.328451562557245e-01   +1.651048334073810e-02   +4.786399537348604e-01   +4.541200198350627e-01   +3.146957735107698e-01   +1.002370378694047e-01   +4.814707360258094e-01   +2.098464770336062e-01   +3.484582383877782e-01   +2.617659380450821e-01   +1.039311380499865e-01; +4.964453162574711e-01   +2.212024687659949e-01   +3.063216258518241e-02   +2.166548862241189e-01   +3.573382817876286e-01   +1.815740189138484e-01   +1.440278890343628e-01   +1.831476743879817e-01   +5.785599979214707e-01   +8.091811564008322e-03   +1.918558601505578e-01   +9.640098595354174e-02   +5.837253128009258e-01   +3.701899087860952e-01   +6.968409092576364e-02   +3.755751017081995e-01; +5.638409592842792e-01   +5.409441735155177e-01   +2.512908423187507e-01   +2.268153322422670e-01   +1.578781122391086e-01   +5.321862850908279e-03   +1.043255295273012e-01   +2.934796259811948e-01   +4.844555914638399e-01   +3.793129439951198e-02   +5.747666824499835e-01   +3.027395144800391e-01   +2.416130823815092e-01   +4.529514598195116e-01   +1.806976350865766e-01   +3.184870535303844e-01; +5.847110516126269e-01   +2.845794174917645e-01   +1.225226028215537e-01   +3.633383974434771e-01   +3.538911186685155e-01   +1.671573834618413e-01   +4.669704605886761e-01   +5.388905874723061e-01   +2.851833383122142e-01   +4.675380900638080e-01   +5.271841380123192e-01   +2.666942538707685e-01   +4.214012600430052e-02   +2.920991283666325e-01   +2.935971754054374e-01   +2.194557916853885e-01; +2.666549341753374e-01   +8.230708919480836e-02   +3.203360075338270e-01   +2.951010006020167e-01   +4.813799938109660e-02   +5.548052245628169e-01   +2.745463437936850e-01   +6.115320912424456e-02   +4.099450846047412e-02   +6.589331672219366e-02   +4.222664570642621e-01   +2.968750682007444e-01   +9.971264285021089e-02   +1.427285851855927e-01   +1.820023882008731e-01   +1.686546875549816e-01; +1.951873317036923e-01   +1.074486624572902e-02   +3.625087020073759e-01   +3.723089580285101e-01   +4.169691549229597e-01   +1.330771767543679e-01   +2.752277792087052e-01   +1.062195079528786e-01   +4.634612172603741e-01   +4.538364936670383e-01   +4.468177310218128e-01   +2.589986622232403e-01   +5.825805632605814e-02   +1.646845467089982e-01   +2.702210344093777e-01   +4.211308285619388e-01];
L2E_L1E_iAMPA_netcon = [+4.563988734636663e-01   +3.111521059618355e-01   +4.274288451126238e-01   +1.934170906855056e-02   +7.590977711892133e-02   +3.037359340880455e-01   +1.975649674863645e-01   +1.546775599812766e-01; +1.091945428155110e-02   +4.011517625823731e-01   +3.828938751974789e-01   +4.054763325095228e-01   +5.863216104668617e-01   +4.002600073801656e-01   +4.677207594280625e-01   +5.784404264799685e-01; +1.952016463446778e-01   +3.735492070261553e-01   +1.650500215920563e-01   +3.953113563524115e-01   +3.016934659391149e-01   +4.603138942568677e-02   +3.416370746713342e-01   +4.143795893125750e-01; +1.249482987517603e-01   +4.988158567787174e-01   +4.066851594724873e-01   +2.847930922383156e-01   +2.514307749894382e-01   +7.460527930145314e-02   +1.462096134569292e-02   +2.379835768539450e-02; +5.592644750950182e-01   +1.878614237589490e-01   +1.135135267009667e-02   +5.605448574903505e-01   +5.820666458246656e-01   +1.355629784235551e-01   +3.368655647751299e-02   +3.578539143656309e-01; +4.855794702351226e-01   +4.484640807895811e-01   +2.778612923289506e-02   +2.626300317928451e-01   +2.858109816489703e-01   +4.331542053862585e-01   +3.131477231416066e-01   +1.702927522782660e-01; +1.302673836927926e-01   +4.337897241099028e-01   +9.094700604943363e-02   +2.122672187075327e-01   +2.078235028493736e-01   +2.680851146210512e-01   +3.573155715396639e-01   +4.639068138310938e-01; +4.660949248976712e-01   +3.434851759368482e-02   +4.579080747613917e-01   +4.507432350269763e-01   +2.562004755692560e-01   +2.964399524220405e-01   +2.458184146008424e-01   +3.431970328533384e-01; +8.635837717745092e-02   +2.271182136525073e-01   +3.424433619814494e-01   +3.207029509869905e-01   +4.077164570227918e-01   +3.126746796871342e-01   +5.014715442354170e-01   +3.235836544819237e-01; +3.549233943230759e-01   +3.027955431750919e-01   +4.900487918565220e-01   +1.187550153904890e-01   +4.524227893589927e-01   +3.090647376460717e-01   +4.531083362079430e-01   +1.989890451489790e-01; +5.411031667299861e-02   +2.885639531315025e-01   +3.116633671506969e-01   +5.724367538923418e-01   +8.904613009675366e-02   +2.643306173008942e-01   +4.966438875406274e-01   +5.401916156478597e-01; +4.335876829336943e-01   +5.261450753324708e-01   +2.747622418609093e-01   +4.301639534636630e-01   +1.880144156718044e-01   +3.019401102884695e-02   +2.531297976294322e-01   +2.994762961933939e-01; +3.732955205318612e-02   +3.977892684151864e-01   +1.168961675243388e-01   +3.302413465593899e-01   +8.509582000863386e-02   +5.299756407850518e-02   +2.582851004501485e-01   +1.721779564806520e-01; +2.727216775620103e-01   +1.453047101866401e-01   +5.022974036597913e-01   +2.054456789999929e-01   +3.212354352970991e-02   +6.883310548590583e-02   +3.491994370577127e-01   +2.034866190640220e-01; +4.059395953462146e-01   +3.469295633022905e-01   +5.534669400997591e-01   +3.939806964588570e-01   +4.299705454199970e-01   +2.748108995161679e-01   +4.120390876486300e-02   +7.041663519350966e-02; +1.215966082733127e-01   +3.734465502659098e-01   +3.969146625177898e-01   +2.511359601465492e-01   +3.410106382189445e-01   +5.885305191606571e-01   +5.825882057080644e-01   +3.444918782407567e-01];
L1E_L2E_iAMPA_netcon = [+5.407959260480276e-01   +4.908729873665990e-01   +3.213017804075826e-01   +1.061513790701962e-01   +3.133232313020339e-01   +4.885495621622918e-01   +2.399614519671491e-01   +2.900797463243261e-01   +4.734790696520860e-01   +5.723594561585547e-01   +5.114160386760987e-01   +5.406180968196059e-02   +5.237056142199673e-01   +4.933440695972442e-02   +1.267604070450717e-01   +2.290356788015004e-01; +4.019325958644157e-01   +1.600298496187149e-01   +1.638757017378088e-01   +1.834526330607783e-01   +5.800385352925813e-01   +1.298056709705714e-01   +2.656147339171525e-01   +5.543623027660375e-01   +3.655933120441316e-01   +4.367169211924892e-01   +1.232904349529230e-01   +2.456472446234239e-01   +3.372420541796444e-01   +5.493737955736364e-01   +2.809114130630804e-01   +4.316870256623771e-03; +4.438583812209173e-01   +1.298446240582631e-01   +3.650966588604657e-02   +1.966476759254747e-01   +2.631730344573847e-01   +9.488958062046532e-02   +5.333010033696619e-01   +1.749269180502971e-01   +3.295885971189653e-01   +9.391039123104404e-02   +3.009386421260381e-02   +1.284712185232632e-01   +5.146033376570291e-01   +2.955724232476459e-01   +2.577453976650964e-01   +4.151713949317115e-01; +1.497981519603928e-01   +9.767423647535017e-02   +1.316874269505186e-02   +5.881671413337614e-01   +3.190977965711895e-01   +5.602223826906765e-01   +5.502956654431943e-01   +3.722991181131884e-01   +2.354935787715330e-01   +4.106981735307325e-02   +4.660263508421399e-01   +2.370246275242050e-01   +2.390369027230320e-02   +1.608389168847005e-01   +5.054256093084426e-01   +2.342434815740728e-01; +5.652046973317750e-01   +2.004662216409872e-01   +8.157773768800784e-02   +4.557932431470989e-01   +1.351249903808086e-02   +2.450898434543208e-01   +1.050866957164165e-01   +2.295451237818051e-01   +2.109569239683089e-01   +1.252605260001775e-01   +7.517583015407313e-02   +5.174760697640276e-01   +2.244239666756248e-02   +7.054928508818747e-02   +4.783416747418104e-01   +3.601177059599857e-01; +5.698320867127237e-01   +2.621024273041880e-01   +5.622996612116874e-01   +1.538486702735079e-01   +1.865782264406812e-01   +1.788502382213757e-01   +2.487396666269533e-02   +1.649336723012791e-01   +1.179247277809896e-01   +9.315701152051140e-02   +9.001874228718146e-02   +4.085382721030388e-01   +5.584379613516203e-01   +3.838507531700899e-01   +5.286607696564705e-02   +5.887837509234598e-01; +2.678861683569964e-01   +5.226385791546757e-02   +1.564728433945431e-01   +5.472488107031233e-01   +1.276420546366607e-01   +2.511825921004921e-01   +5.733249367605672e-01   +3.740021640517751e-01   +3.653156414727547e-01   +6.424845066057060e-02   +1.450870782262010e-02   +2.219854400557120e-01   +4.856335719607688e-02   +4.476387715802716e-01   +2.475896726242056e-01   +3.248180592407659e-01; +4.923134311828311e-01   +1.684072743155814e-01   +5.137103036674334e-01   +3.926343208548070e-01   +3.190889673601529e-01   +2.923275328178784e-01   +8.681899992621002e-02   +1.591545820262219e-01   +1.080947230276944e-01   +2.509395231280674e-01   +5.143933947611474e-01   +5.774238888988295e-01   +4.664771951286991e-01   +1.992876090192282e-01   +1.775184416370514e-02   +2.417790918589257e-01];
L2I_L2E_iAMPA_netcon = [+3.741358823367800e-01   +4.786621205157774e-01   +5.505475048736908e-01   +4.631841160119344e-02   +1.732553852745985e-01   +1.248282787080518e-01   +5.894219227479138e-01   +5.877698858404448e-01; +3.019413909310625e-01   +1.539572336712392e-01   +2.161173378517778e-01   +6.024051219999382e-02   +2.001073352699900e-01   +7.906280286655498e-02   +4.669189951869074e-01   +1.201304547734935e-01; +5.230967832487892e-01   +2.092519556031102e-01   +1.109011118016863e-01   +2.766572007933271e-02   +9.226638504304895e-02   +1.244063723452573e-01   +5.555557458016632e-01   +4.784600895916307e-01; +1.123962517592659e-01   +1.684647128261953e-02   +1.382659654507774e-01   +5.611127366665696e-01   +4.076989997194424e-02   +2.108958870254819e-01   +1.717767536388098e-01   +2.199357283085324e-01; +8.421280241526534e-02   +4.516841517535058e-01   +1.230560719919162e-01   +3.934389646745402e-01   +4.045277720688255e-01   +2.758555244930023e-01   +5.319022057364651e-01   +3.328683523347423e-01; +7.133472040756764e-02   +3.006721438123047e-01   +3.463546102040898e-01   +2.084412115139837e-01   +3.142585194646126e-01   +2.093448950475587e-01   +8.024345820944346e-03   +2.688449058063403e-01; +1.938679337479467e-01   +4.210680225553809e-01   +3.046255330289978e-01   +3.689053267815123e-01   +2.339334185329822e-01   +3.780675701820184e-01   +6.863682678298402e-02   +2.393731813970746e-01; +6.772893506690293e-02   +1.086565308967712e-01   +8.753827344325482e-02   +1.892667860837512e-01   +3.336974902581871e-01   +4.762894202812791e-01   +1.831739384968425e-01   +2.004727956934902e-01];
L2E_L2I_iGABA_netcon = [+3.937311825536902e-01   +1.074094398815357e-02   +1.060395493071457e-01   +3.936758180831160e-01   +7.295669260583004e-03   +2.803746299609957e-02   +3.298258713850092e-01   +2.006769512173082e-01; +5.515095002785609e-01   +8.589738031567433e-02   +1.611583733454037e-01   +2.280345761807396e-01   +4.566872522322279e-01   +4.254429876321765e-01   +2.542692111264135e-01   +5.859032793309624e-01; +3.326090009965476e-01   +6.213414500981724e-02   +2.292319862634974e-01   +4.775715358391241e-01   +3.182406264457324e-01   +3.469148499688683e-01   +5.080322490152378e-01   +2.883311675074198e-01; +1.901105939164152e-01   +2.978397991623803e-01   +3.885921994635427e-01   +1.460140022622683e-01   +9.925691166974039e-03   +3.800125548175714e-02   +3.310050259584931e-01   +5.158797043296599e-01; +4.166247838865343e-01   +4.174003012026430e-01   +2.482613884131221e-01   +4.394134817489378e-01   +2.970623753907290e-01   +4.172637135394414e-02   +5.010998490496744e-01   +2.268974050567985e-01; +5.567743096295110e-01   +5.948540853104933e-02   +4.486046077504343e-01   +1.316112130344579e-01   +5.134339585553352e-01   +3.092773498090889e-01   +4.590503404019966e-01   +3.220555220734413e-01; +1.505066790264724e-01   +1.370305330081606e-01   +4.512984497173496e-01   +4.737480320499011e-01   +2.032956852073808e-01   +1.948353300190619e-01   +1.236194665123730e-01   +4.243265309961554e-01; +1.485218727946085e-01   +9.284345815204141e-02   +1.625647933899557e-01   +1.601695558567208e-01   +4.208630200748520e-01   +2.119551929320921e-01   +5.676389185057723e-01   +3.806827031078163e-01];
L3E_L2E_iAMPA_netcon = [+3.530499912854808e-01   +3.257187293425782e-01   +3.914964680869869e-01   +3.418390634768627e-01   +2.727273367703183e-01   +5.259095055430533e-01   +5.726456135950151e-01   +1.024460990396580e-01   +1.141232618845881e-01   +6.017429473144487e-02   +3.378389835066862e-02   +1.922835185475405e-01; +4.028091196199030e-01   +4.952910754132396e-01   +3.704917266470178e-01   +3.726114288823863e-01   +2.741372208309941e-01   +1.158524979671856e-01   +5.470407939868670e-01   +2.796963565090242e-01   +2.423186131139509e-02   +5.136786177221592e-01   +4.574073544182461e-02   +1.468107839359989e-01; +3.017852222440798e-01   +3.513055710111517e-01   +3.153217754465932e-02   +3.811701655406567e-01   +2.624778647400658e-01   +2.030280630055411e-01   +4.567357467939823e-01   +8.814798672547798e-02   +2.977815270483213e-01   +1.043011941266931e-01   +2.044628566264910e-01   +4.245512408806612e-01; +4.339521236316491e-01   +5.616571268647690e-01   +2.324590041628912e-01   +2.015906304099146e-01   +5.140444637182722e-01   +2.490826138556237e-01   +3.222344751546695e-01   +3.745107807883168e-01   +1.294560521221320e-01   +1.018608880672351e-01   +4.215294395099036e-01   +3.326643444889210e-01; +4.157201125159590e-01   +1.542682050321728e-01   +3.367065612459319e-01   +4.759792161129437e-01   +2.402010687343224e-01   +1.406074468586595e-01   +5.902292320362650e-01   +1.617711234184608e-01   +6.215078271358518e-02   +2.410274837366392e-01   +5.472505921016321e-02   +4.756340405902278e-01; +3.481715914803118e-01   +3.354320848144703e-01   +4.161274686867936e-01   +5.842031651483967e-01   +4.474511376229818e-01   +4.986173408526737e-01   +1.703633869893026e-01   +4.685718082553599e-01   +3.387406983765234e-01   +3.551023959403181e-01   +4.923711430675594e-01   +3.838544212394375e-01; +1.075577831332911e-01   +5.456463692486419e-02   +2.957909737686742e-01   +9.811795363377045e-02   +2.194697246818630e-01   +1.972192549468885e-01   +4.778430103903968e-01   +2.182281138005882e-01   +2.022239055855939e-01   +5.689705112777534e-01   +2.828909284674791e-01   +4.022080889092428e-01; +8.739847730017697e-02   +2.463079244437435e-01   +4.545057269760714e-01   +3.137339515471184e-01   +5.236727598048975e-01   +3.248258017750492e-01   +4.689956954023956e-02   +1.773936733387743e-01   +2.138921366555036e-01   +4.644655537929063e-01   +5.437101925583543e-01   +2.105506948804333e-01];
L3I_L2I_iGABA_netcon = [+7.870482047549480e-02   +4.395565967845010e-01   +3.566360832523091e-01   +1.703571392519824e-01   +2.412539803034345e-01   +4.711965010848761e-01   +2.626853948343661e-01   +4.976063830463071e-01   +3.420757661519525e-01   +1.669025166367270e-01   +1.682674675228482e-01   +2.589459739466756e-01; +4.445263910743696e-02   +1.987701940361806e-01   +5.596179789464550e-01   +1.257402413712258e-01   +4.843690224821223e-01   +4.894976374893689e-01   +2.677718936209910e-01   +2.287348248990784e-01   +2.780665559140210e-01   +3.991144353922773e-01   +4.949516435215628e-01   +3.854255404901438e-01; +4.672092505850199e-01   +3.832450759856137e-01   +3.897662576974509e-01   +3.612614217437211e-01   +1.725701950367712e-01   +4.887755943416784e-02   +4.289259226255271e-01   +5.918657618309902e-01   +3.929304249367335e-01   +3.314978301256143e-01   +5.145005600544879e-01   +4.907327639233510e-01; +4.534237762741632e-02   +5.566628140061518e-01   +6.572393320678149e-03   +5.512842146573802e-01   +3.188971067737576e-02   +2.540390513643369e-01   +1.996780351598479e-01   +5.476269674226684e-01   +1.987942768015306e-01   +5.398530980715806e-02   +5.291336369859102e-01   +9.795701200656851e-02; +1.055223126442335e-01   +4.606928138006302e-01   +3.261076467932997e-01   +1.811251804513689e-01   +3.788521466969961e-01   +9.665227733456956e-02   +5.224483195803622e-01   +5.338619013263980e-01   +4.636338717584820e-01   +3.924910000574160e-01   +5.898522594838391e-01   +1.913965292592095e-01; +1.169138629961394e-01   +3.195019278483833e-01   +1.774539569102130e-01   +4.017441480569135e-01   +2.987881547130175e-01   +5.522285388050433e-01   +1.735530609136250e-01   +5.379911911710214e-02   +5.370853676590344e-01   +3.255050991281814e-01   +2.458029022908421e-01   +5.413837166256286e-01; +6.919818837263136e-02   +3.221016236184039e-02   +1.102167985609829e-01   +3.508008358898732e-01   +1.457241727030813e-01   +4.543529774688371e-01   +1.296756073456284e-01   +2.773203466078492e-01   +4.413223516353619e-01   +1.268379913303458e-01   +7.546457807789460e-02   +1.783065051903482e-01; +2.899901346214618e-01   +1.719118467238079e-01   +4.608034310451702e-01   +5.519298542675034e-01   +5.311676374102994e-01   +4.204562150347484e-01   +4.679391960260619e-01   +5.831101648633236e-01   +5.403663157926250e-01   +2.258978072807456e-01   +5.075941563650227e-01   +1.528769209348548e-01];
L2E_L3E_iAMPA_netcon = [+1.649322892236911e-01   +4.010191428188513e-01   +5.200458762169282e-01   +4.831883420466354e-01   +5.301868224145323e-02   +3.236767014716097e-01   +2.077859142655781e-01   +3.221499922780411e-01; +5.726479012993470e-01   +4.302212164918052e-01   +4.925734913507531e-01   +3.931694869411583e-01   +6.327670799192229e-03   +2.409679043726414e-01   +1.720298060115323e-01   +6.484158001727379e-02; +5.664075043315728e-01   +1.790116599686726e-01   +5.699595647044509e-02   +4.482512140876159e-01   +1.051761314192710e-01   +8.452806179167241e-02   +5.332464445293906e-01   +6.108236965720617e-02; +1.441761905036075e-01   +4.357159572655502e-01   +2.017125352600117e-01   +3.075466608068499e-01   +2.434419085015686e-01   +2.964020608833574e-01   +2.813847211799484e-01   +5.277602741824334e-01; +3.738292031168023e-01   +4.759427023329186e-01   +1.531391101089712e-01   +1.640567160423405e-01   +4.900912704227190e-01   +1.544850043899715e-01   +4.005294263990197e-01   +2.992907914048425e-01; +3.176411194561498e-01   +5.501820978172516e-01   +3.748589232048005e-01   +9.773356858655995e-02   +3.331250168180146e-01   +1.800743209718318e-01   +4.140432209173559e-01   +3.807745177604477e-01; +9.965143224353092e-02   +7.183518597093433e-02   +1.077301053795273e-01   +2.473763402778784e-01   +1.033453737201569e-01   +5.655565136805876e-01   +3.415130267698839e-01   +5.859469868842394e-01; +3.492804035116062e-01   +4.501919150095932e-01   +4.724645094567941e-01   +1.698971188759089e-01   +1.274731164285546e-01   +5.337952385913113e-01   +3.029633600127226e-01   +2.349518703561130e-01; +2.504065334533338e-01   +2.949254988461352e-01   +5.489032497891068e-01   +2.199463483820421e-01   +4.213376254687873e-01   +4.819447042496350e-01   +4.279404268066908e-01   +2.937181373354238e-01; +5.339289708160311e-01   +3.032332509908227e-01   +4.790112136168861e-01   +3.874559874146515e-01   +2.848922609577869e-01   +2.767186027255120e-01   +2.653911984190703e-01   +3.339771425226726e-01; +3.712881868448796e-01   +2.027112069096285e-01   +6.604995571866899e-02   +4.724129743671526e-01   +4.511703991984028e-01   +4.393653962902423e-01   +9.471802249865241e-02   +2.681047826537661e-01; +5.230149109608796e-01   +2.514907291563576e-01   +1.374933117651060e-01   +1.762088551855547e-01   +3.008295995918318e-01   +5.180109435336288e-01   +3.107419217900475e-02   +3.536594650665132e-01];
L2I_L3I_iGABA_netcon = [+1.096169674181145e-01   +2.123495709287246e-01   +3.522768066057444e-01   +2.535311329683009e-01   +4.262836274409369e-01   +4.087231716800162e-01   +1.089105964803077e-01   +5.143041633671189e-02; +1.151207760117004e-01   +2.374858928854506e-01   +4.777188728579718e-01   +5.315489370713032e-01   +2.425323358286976e-01   +3.667669926541142e-01   +1.678212916726610e-01   +5.386920138756338e-01; +4.031499344233899e-01   +4.839677996326888e-01   +3.219539697674355e-01   +3.731104926310805e-01   +3.388241090396521e-01   +4.554973865149947e-01   +3.378365743845788e-01   +1.599879448567917e-02; +4.536295958298252e-01   +1.236553317641163e-01   +4.086432669905973e-01   +4.904845926969810e-01   +2.509576071306398e-01   +8.673380113491437e-02   +5.856659897697883e-01   +3.494907425323475e-01; +3.228976524420992e-01   +7.517283767046486e-02   +4.126997100840836e-01   +2.690550957756636e-01   +1.959721301517258e-01   +3.710695414223663e-01   +2.491742313766404e-01   +1.796139323903775e-01; +3.805139587926987e-01   +5.249103250011939e-01   +2.884234923928845e-01   +8.128125251379571e-02   +5.277414548011859e-01   +1.965996532865461e-01   +5.569977439049598e-02   +5.567506822948122e-01; +5.887022396007856e-01   +9.921643064518214e-02   +2.244298235914785e-01   +2.449643979286920e-01   +2.275239366761840e-01   +3.499924219270517e-01   +3.144888194585503e-01   +5.916321726537610e-01; +3.184317411784345e-01   +9.661535102672889e-02   +9.675918346030196e-02   +4.481438845027116e-01   +1.742180153834404e-01   +2.976096481661318e-01   +1.638366480894122e-01   +1.792849895157003e-01; +5.014416028528950e-01   +9.347807182093239e-02   +3.247575939374400e-01   +8.540270829228981e-02   +3.558360909278188e-01   +4.537864334203116e-01   +3.539623002904228e-01   +2.967531749383513e-01; +5.423202690017314e-01   +4.936541644438240e-01   +2.329712612879112e-01   +3.607432319634317e-01   +1.475996436658448e-02   +3.768937287652301e-01   +1.996083859396735e-01   +2.532670643992417e-01; +2.997385047171751e-01   +3.450710686354180e-01   +3.238229013347994e-01   +4.052276914642107e-01   +2.525505291736261e-01   +1.653483256311925e-01   +4.652234525480650e-02   +8.602932148896736e-02; +1.806494927691071e-01   +3.623577422056114e-02   +2.675755955621818e-01   +2.718764562893890e-01   +3.826975970121003e-01   +4.390019233694928e-01   +5.010921666099248e-01   +2.641227062296476e-01];
L3I_L3E_iAMPA_netcon = [+4.797222838697625e-01   +2.059496638818406e-01   +4.224261944134701e-01   +9.146318282955022e-02   +5.609331015554354e-02   +4.432851106304218e-01   +2.712531704279936e-01   +1.304887507464538e-01   +2.092505566862192e-01   +1.374863561540036e-01   +5.755723900729921e-02   +3.721334306843543e-01; +4.894237744589469e-01   +4.049255669733969e-01   +5.222339704481522e-01   +7.598878137913405e-02   +3.554311885966429e-01   +1.704124126151398e-01   +2.770032440511310e-01   +1.386374838575324e-01   +3.735508655570090e-01   +5.489510851707003e-02   +2.465490391345919e-01   +4.909632197518593e-01; +1.915311628449531e-01   +1.708920418526805e-01   +1.489847083286412e-01   +4.720643869983402e-01   +4.499219883136988e-01   +5.173345517985287e-01   +2.185809009254135e-01   +5.163387511217540e-01   +5.819318627035909e-01   +1.124687488183096e-01   +3.406280771356715e-04   +3.777104787231381e-01; +1.123921255308149e-02   +3.599952178295132e-01   +9.625495404301311e-02   +5.178618483081824e-01   +5.082517836594009e-01   +8.582750955069741e-02   +4.991123337471048e-01   +2.070817074458103e-02   +3.717448992169463e-01   +1.760238328282983e-01   +2.874788073430152e-03   +4.561821404094631e-01; +9.317185563958495e-02   +3.765611933061967e-01   +2.933884410416584e-01   +5.307077268975854e-01   +4.832998478181381e-02   +1.367456927342004e-01   +1.218097758393797e-01   +8.890939728917921e-02   +1.927143437694257e-01   +1.857220375017894e-01   +2.725920502216731e-03   +2.205407081531399e-01; +4.603632470440195e-01   +1.522193209795186e-01   +9.210857668538630e-02   +2.773504476730789e-01   +1.974559833900165e-01   +3.302339544708652e-01   +1.995507978627364e-01   +3.662144986840705e-01   +7.844966682502197e-02   +4.432684568025153e-01   +7.825584176833017e-02   +9.085428882676405e-02; +4.877745409410134e-01   +5.755950295719763e-01   +3.643770879005387e-01   +4.307042322523331e-02   +2.844561705678017e-01   +5.032070466017905e-01   +2.962274570202994e-01   +4.565674042332513e-01   +2.068566228216661e-01   +3.333224995574054e-01   +3.863664685208110e-03   +2.803177661296520e-01; +2.243047530517715e-01   +3.086901265981045e-01   +3.253732986786876e-01   +1.388819609641596e-01   +4.644498571880175e-01   +4.814328791094453e-01   +4.711427280493060e-01   +5.082919018552398e-01   +3.902516645740016e-01   +1.889464039983886e-01   +5.247826077307870e-01   +2.705733374199634e-01; +7.168995367228168e-02   +9.269219727711873e-02   +5.708431970727670e-01   +3.819812460429094e-02   +3.917092443189601e-01   +2.171174995782906e-01   +5.085910678871550e-01   +3.124523679474542e-01   +4.944153708324221e-01   +4.724591163116715e-01   +2.559693786031840e-01   +4.211092106615533e-01; +5.237365516662430e-01   +1.422884233547471e-02   +7.917806314402973e-02   +6.200402611100321e-02   +1.466340245516666e-01   +5.773615098818534e-01   +5.411653789636562e-01   +2.085863143116601e-01   +4.761825637413620e-01   +3.735199040881721e-01   +1.830436491636216e-01   +3.065486860796423e-01; +7.864125283060476e-03   +5.150957815653525e-01   +5.021241826816137e-01   +4.377649900926033e-01   +5.606273065905674e-01   +3.418648985041043e-01   +4.459938346016328e-02   +4.939468029754710e-01   +4.180908162992227e-01   +1.945825434373601e-01   +4.340803275102988e-01   +5.056610141322510e-01; +2.268210565315085e-01   +2.394182410448001e-01   +1.525509835365899e-01   +3.292410635154112e-01   +1.856326335658895e-01   +3.510889792273246e-01   +2.044073674307758e-01   +1.757238719948422e-01   +2.060676833635882e-01   +5.073564271227142e-01   +3.454615261054900e-01   +2.385628775053552e-01];
L3E_L3I_iGABA_netcon = [+3.612191005506730e-01   +1.381273358270735e-01   +2.795231825189408e-01   +8.918950954576019e-02   +5.548599618937047e-01   +1.372917734776410e-01   +2.090664397947647e-01   +5.861948711100663e-01   +8.453824111727200e-02   +1.426147582563356e-01   +3.203911783761982e-01   +3.533177323542651e-01; +4.423301309846677e-01   +5.526098819444997e-01   +1.179281250889746e-01   +5.041509950538681e-02   +3.442887105567792e-01   +4.833749537990752e-02   +5.439050526684761e-02   +1.938092428697962e-01   +5.031336105183943e-02   +3.665992942994087e-03   +4.479370170561149e-01   +1.442692869999299e-01; +4.523370063478436e-01   +5.091514627241479e-01   +5.248154655216088e-01   +2.148920791420638e-01   +2.929766183548262e-01   +1.512289084289873e-01   +7.389729604508523e-02   +5.481616185372521e-01   +6.475951042975404e-02   +4.825618908175562e-01   +1.242849937472390e-01   +4.027827804441168e-01; +1.513570264603672e-02   +3.588163393652746e-01   +2.753196625384078e-01   +5.518152943548821e-01   +1.261580488247394e-01   +4.033372787025788e-01   +2.584070455857164e-02   +5.267416401723045e-01   +2.761278118362574e-01   +3.245001727171572e-02   +5.251939064572918e-01   +4.916631935416330e-01; +4.446930936938461e-01   +2.403182436131096e-01   +1.171089131420031e-01   +3.331572098396126e-01   +4.408392215601952e-01   +9.196806916772951e-02   +9.399200621193229e-02   +3.587209656494671e-01   +1.016534519643131e-01   +3.411938840281140e-01   +6.228987675637677e-02   +2.925253269335919e-01; +4.579888053932803e-01   +3.240812546952426e-01   +1.114272345849859e-01   +1.319584623136565e-01   +1.777649189876530e-01   +1.418605396548905e-01   +3.859429691079877e-01   +4.171897868430141e-01   +1.340679022335857e-01   +4.499392697614970e-01   +3.139289434388676e-01   +9.326216055858139e-02; +2.800253587240510e-01   +8.471116932253255e-02   +3.793450487196439e-01   +3.933719679307954e-01   +4.833049393948942e-01   +3.168764187057436e-01   +4.217552396429687e-01   +2.797303869699506e-01   +1.470971021328817e-01   +4.378480708309932e-01   +4.118686481650558e-01   +3.144350041608723e-01; +4.640714678431367e-01   +2.450797618291617e-01   +1.657207918106089e-02   +2.584268043239867e-01   +1.838331884524707e-01   +5.611163755794637e-01   +2.264826617934343e-01   +2.833328191856935e-01   +3.708291761185681e-01   +2.688789210211899e-01   +2.906758786593163e-01   +2.041363861510967e-01; +3.740170129772576e-01   +7.789631104862826e-02   +3.147806025968182e-01   +2.922069195502407e-01   +2.547566583476275e-01   +5.429831012203202e-01   +2.668460678091584e-02   +5.091293751559678e-01   +4.207783974851604e-01   +4.869025200828441e-01   +8.662287248153258e-02   +2.694509058102953e-01; +1.824997580676483e-01   +3.457745536919985e-01   +4.026578732520040e-01   +4.056889032141843e-02   +2.814744156218504e-01   +4.108028780588379e-01   +2.965297201235954e-01   +1.223636984833290e-01   +5.211163662070140e-01   +4.690220521749450e-02   +2.567055440649503e-01   +4.425889448487943e-01; +2.303991938502142e-01   +1.127820665068555e-01   +6.632426196838986e-02   +4.847504552790784e-02   +3.013517059997651e-01   +5.016090286578205e-02   +3.524698409167832e-01   +4.105772395227900e-01   +4.340925576456785e-01   +3.362864998030399e-01   +1.671996135180026e-01   +5.565437254868894e-01; +4.772000970228172e-01   +1.003552139934455e-01   +4.195864541906052e-01   +9.686090649450034e-02   +2.426962459145562e-01   +5.810632011869751e-01   +3.864700997432529e-01   +5.899084402113307e-01   +4.738188624445033e-01   +4.163522095027151e-01   +3.779732290111684e-02   +2.721273808277452e-03];
L2E_Input1_iAMPA_netcon = [+3.096951551204424e-01   +4.234056262350436e-01   +1.347589392799498e-01   +5.685202238698629e-01   +9.504622811710393e-02   +5.560769709910549e-01   +4.870241836862992e-01   +6.415288767036217e-02];
L2I_Input2_iAMPA_netcon = [+1.669204813642695e-01   +1.955261437462466e-01   +3.133163077926817e-01   +4.779536886325177e-01   +5.186438725578359e-01   +4.552026895983249e-01   +7.143166065731420e-02   +1.387308180667107e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  5.6 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = -10*((exp(-10*((t)-( 50))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 10*((exp(-10*((t)-( 50))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
