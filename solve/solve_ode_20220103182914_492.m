function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.145003119223046e-01   +9.477819773340846e-01   +7.000898275115548e-01   +1.634008588508987e-01   +9.193832626224909e-01   +2.122331729060960e-01   +7.425001607573917e-01   +3.055417790815145e-01   +5.388492685435357e-01   +8.386637281566840e-01   +9.734171003664376e-01   +9.721130165089639e-01   +6.983208005913943e-01   +3.673974781870169e-01   +2.972674531907918e-01   +3.848242214717968e-01; +3.508149306867693e-01   +9.299574921672462e-03   +1.398198039503303e-01   +1.703343372069725e-01   +7.796525325799147e-02   +8.110459060718433e-01   +7.962668366845227e-01   +7.557367416529445e-01   +7.922542287335704e-01   +1.900637974001192e-01   +4.749307766337749e-01   +6.640338772026827e-01   +3.675512792482880e-01   +2.755944202473223e-01   +6.902105041666132e-01   +9.633452810087614e-01; +2.008562778279538e-01   +4.749612449967600e-01   +8.298444130529128e-02   +7.068075058972120e-01   +3.176736131160337e-01   +3.802201971587975e-01   +6.588533010043242e-01   +9.537653177820461e-01   +4.864642343968689e-02   +9.264994840429054e-01   +8.731893889590288e-01   +1.993634856385038e-01   +5.479182623576914e-01   +7.473837819121805e-02   +7.809948136501540e-01   +8.100517836219185e-01; +2.707904235952458e-02   +4.883812432522672e-01   +4.281144463016083e-01   +8.375506098060219e-01   +6.331280110765802e-01   +8.596086895059669e-01   +4.411525166080724e-01   +3.912435421825924e-03   +4.590357018887850e-01   +4.191087621341685e-01   +9.415412261166688e-01   +9.019196780438598e-01   +5.139566063259741e-01   +1.597442419876039e-01   +7.119211548851494e-01   +8.939661498028567e-01; +7.659109480009740e-01   +5.159524181746844e-01   +8.999779809256345e-01   +8.497528284573515e-02   +9.047152124486789e-01   +3.232508000801217e-01   +5.790849612959378e-01   +4.014596286264919e-01   +9.391157211660932e-01   +3.021743184783566e-01   +2.425159650967731e-01   +4.812990619838758e-01   +7.673118469687289e-01   +3.626184606143427e-01   +2.728303860498230e-01   +6.521307044962189e-02; +5.695336110518001e-01   +2.894289699688826e-01   +7.176356754948595e-01   +8.340827798331467e-01   +8.002243442592213e-01   +3.803693537739205e-01   +5.140392739122912e-01   +1.558862789165099e-01   +4.774555144712792e-01   +3.581678390308738e-01   +9.194426872633641e-01   +6.677510402941024e-01   +7.439817282430874e-02   +7.155008796557047e-01   +2.120433106885911e-02   +9.008721302866742e-01; +5.803125731420530e-01   +5.592990474100620e-01   +6.833716435003001e-01   +5.520848009840063e-01   +6.476184014565034e-01   +6.451851471333586e-01   +7.286718292209167e-01   +8.311157935842496e-01   +7.778744035962504e-01   +9.755077404266997e-01   +6.344225288744793e-01   +5.304250253019502e-01   +3.647161320152209e-03   +5.422982700142904e-01   +1.478046861392283e-02   +6.727409445054542e-01; +3.883007530808038e-01   +5.188461506341109e-01   +2.048851491135074e-01   +9.661808016170695e-01   +4.436663051432729e-01   +3.939138794792637e-01   +2.238587770084794e-01   +2.870558577577841e-01   +1.105472670167509e-01   +5.380917998090062e-01   +2.856907291020267e-01   +7.066102585891337e-01   +4.014345173311836e-01   +2.332069803478669e-01   +9.285665406454489e-01   +3.472332359028550e-01; +5.536138819475414e-01   +6.744473495936042e-01   +5.249001970964001e-01   +6.713664860600114e-01   +7.485264069208812e-01   +7.180778848266302e-02   +9.992931885813958e-01   +9.799286129263998e-01   +5.213433302821538e-01   +7.967859044418231e-01   +8.490979311761754e-01   +7.138184881646333e-01   +6.638618892452727e-01   +4.678454042856739e-01   +9.342864269028698e-01   +8.407039718705778e-01; +1.858451536227454e-01   +6.176239474448729e-01   +8.250511690897701e-01   +3.380889529388979e-01   +8.291823635711337e-01   +1.722857292799084e-02   +6.192159269863823e-01   +6.199321209858295e-01   +6.374018026572789e-01   +8.013302347840467e-01   +1.651797251814520e-01   +2.982355592805890e-01   +3.735093134766898e-01   +7.153480878870595e-01   +3.736398151988405e-01   +1.954270787869870e-01; +1.153456539991684e-01   +5.672915268910054e-01   +1.843495210385826e-01   +2.145945368307438e-01   +3.484346075487340e-01   +8.769060675618845e-01   +9.927052899257491e-01   +7.454866067155387e-01   +5.762279296147272e-01   +1.360622661049015e-01   +8.275363507732536e-01   +1.113664085095313e-01   +3.973782179308351e-01   +5.186546156327220e-01   +1.026950337200540e-01   +8.448700430819697e-01; +5.201240563012718e-02   +5.101696336747990e-01   +5.169269268053629e-01   +5.706030766227875e-01   +1.514663589987206e-01   +1.600786099556577e-01   +4.913336989481724e-01   +8.855655339109173e-01   +8.407459522625995e-01   +4.529104020236533e-01   +2.214344113592615e-01   +3.322904850531056e-01   +1.370788671141528e-01   +5.135350619633735e-01   +7.226350234772979e-01   +4.297656383683545e-01; +9.351448384115542e-01   +6.680964875341918e-01   +3.575264067385888e-01   +4.412508357202807e-03   +5.055301302281441e-01   +9.195880604558785e-01   +5.280780333904754e-01   +3.360353603074300e-01   +1.171694626074412e-01   +4.538225879778039e-01   +2.760555888622261e-01   +4.631563206001144e-01   +3.389489026889854e-01   +3.939820684713434e-01   +4.586252718651997e-01   +5.548207821665485e-01; +7.448030194802736e-01   +6.375771027981029e-01   +6.523435158499594e-01   +5.935088796904983e-01   +4.109660869705758e-01   +5.644191623453957e-01   +8.564857919211017e-01   +9.221808942158291e-02   +5.032920753569981e-02   +9.601642665071000e-01   +9.052720574722942e-02   +7.171776137220348e-01   +1.211326008152165e-01   +4.805380840437973e-01   +1.451875220940051e-02   +4.463035929347455e-01; +2.384877371231175e-01   +1.425836401359784e-01   +2.815889095223961e-01   +8.976197793900065e-01   +1.759344123367956e-01   +9.233584704673856e-01   +2.558507006051008e-01   +4.455849786472846e-01   +5.180952537034921e-01   +5.230868625704670e-02   +9.172741428794157e-01   +3.990871310394199e-01   +3.676833808829000e-01   +7.434158569822019e-01   +1.159109241143301e-01   +7.621590027734635e-01; +2.014173751663954e-01   +1.803923530285104e-01   +4.340001675210491e-01   +2.582405012241100e-01   +4.951880557390760e-01   +5.954311337970615e-01   +5.760726833890545e-01   +2.387179500692001e-01   +7.028158120069943e-01   +4.013095746713180e-02   +7.309856416553913e-01   +2.406341508142185e-01   +2.462575234750432e-01   +7.046098806649547e-01   +6.635699034884416e-01   +9.383879549471229e-02];
L1E_L1I_iGABA_netcon = [+8.410139406657257e-01   +7.504614523062425e-01   +8.709835171347282e-01   +4.378743964435589e-01   +9.192650634640906e-01   +7.702946402033117e-01   +3.199229306080223e-01   +6.433102064302213e-01   +9.526078738227897e-02   +2.702170388437424e-02   +1.262136561162748e-01   +5.177931891342299e-01   +8.775646930367452e-01   +5.745212318938331e-01   +1.719191233823048e-01   +6.365774417960567e-01; +6.186059363389439e-01   +9.914214719275725e-01   +3.122660996460468e-01   +1.411382264744385e-01   +8.913655827902522e-01   +2.763199498487973e-01   +9.665642521897044e-01   +4.386396492208287e-01   +2.973703415719245e-01   +5.110638844085083e-01   +4.339476888459087e-01   +2.057967894910114e-01   +8.051247151222040e-01   +2.912433481830314e-01   +5.832586758961258e-02   +3.417782477947490e-01; +6.654712658373889e-01   +3.735764711259461e-01   +4.324525346031315e-01   +6.499208816903358e-01   +5.898595333830254e-01   +5.215924775726043e-01   +3.502680610733983e-01   +4.812024062088097e-01   +3.319352423652150e-01   +8.669270439987439e-01   +4.798904230801217e-01   +7.731692286386006e-01   +6.487612536840535e-01   +1.422363883672144e-01   +2.199467500006400e-01   +1.516375855093547e-01; +7.801269219929333e-01   +5.089613660263587e-01   +3.784729040478227e-01   +7.260098599242154e-01   +8.371677733567269e-01   +4.092549619941472e-01   +3.159998349881922e-01   +9.588454155027856e-02   +4.770369250983086e-01   +5.754281817466451e-01   +6.752750818339355e-01   +3.887972498830306e-01   +7.354305470997089e-01   +4.345553726057670e-02   +2.048428281578029e-01   +3.986956742477630e-01; +3.172962497002231e-01   +7.566226324930347e-01   +6.542895369496324e-01   +1.717615954439553e-01   +7.789887211978368e-01   +7.867261369818402e-01   +9.139764176449013e-01   +8.048409902795097e-01   +2.407204772184602e-01   +4.259360298487507e-01   +3.494659321567273e-01   +6.820900114136624e-02   +6.635618670009451e-01   +6.220133876286688e-01   +2.128846826199362e-01   +9.172324714081456e-01; +3.227752535077599e-01   +1.344498807748634e-01   +2.456996673667552e-01   +3.375755783378520e-01   +7.919603671376336e-01   +2.644179375477543e-02   +8.831718258572255e-01   +6.135130577910485e-02   +4.552789750899101e-01   +7.196876460322599e-01   +4.377281296630102e-02   +7.509604033453345e-01   +8.861269211629473e-01   +6.054957334742547e-01   +5.812754415782028e-01   +1.535691232009045e-01; +6.270220328789159e-01   +5.174632908169867e-01   +6.898425577691262e-01   +1.021091729712511e-01   +6.943105341033472e-01   +4.075115385719873e-01   +3.593146991644224e-01   +9.554121950915108e-01   +7.541792470010923e-01   +2.283741942775634e-01   +2.923602353718732e-01   +4.586358868459486e-01   +8.539529169504833e-01   +3.734486869077077e-01   +3.731320297643460e-02   +4.667983815313501e-01; +9.021453718289475e-01   +9.099221916899793e-01   +3.278379086153981e-01   +4.614172456861799e-02   +1.764432591501491e-02   +8.279410515120090e-01   +7.381374626376844e-01   +7.728901075204534e-01   +7.137157359670812e-01   +5.854226697425194e-02   +8.001862377613301e-01   +3.117284254382112e-01   +4.068918624925962e-01   +8.313326004470080e-01   +7.959894011367880e-01   +8.180074499001162e-02; +3.719106570357478e-01   +9.962465491806285e-02   +8.739886836644457e-01   +4.717350221488191e-01   +3.247441540273189e-01   +5.904102757055093e-01   +1.234254403268188e-01   +4.452786141759162e-01   +2.320184821692799e-01   +9.751866843360194e-01   +6.494702675481628e-01   +2.737979149351128e-01   +1.111498996822354e-01   +5.191678140306349e-01   +1.389073464258752e-01   +3.348241328998892e-01; +8.854692744485344e-01   +1.839354562876790e-01   +9.998690781342686e-01   +4.760262509712919e-01   +9.479155892186788e-01   +2.086723511891326e-01   +5.905200002635171e-01   +1.670652592931307e-01   +6.995653849004371e-01   +9.715732110149154e-01   +7.084742252051450e-01   +5.746435168630426e-01   +4.096514213401070e-01   +8.146509001557553e-01   +5.756658468737913e-01   +4.881431952230033e-01; +1.150969429292005e-01   +1.789902728647997e-01   +6.854543596216305e-01   +5.491932009954757e-01   +4.085135058458746e-01   +2.904289584409858e-01   +4.375687642730009e-01   +7.768445062801382e-02   +3.020549176789945e-01   +1.282533254577495e-01   +7.592194333624045e-01   +9.142630530144246e-01   +3.325651854132660e-01   +5.792853628636037e-01   +8.120555321830007e-02   +4.999876144060195e-01; +9.521373273064325e-02   +5.337654334101389e-01   +3.481497821396938e-01   +6.454498434531010e-01   +6.232072684793071e-01   +2.684111375917145e-01   +9.638339626087401e-01   +7.460902745416241e-01   +4.670863476225166e-01   +1.512994578914763e-03   +3.872220654878584e-01   +4.471133764163296e-01   +1.084712675185865e-01   +7.125056912152180e-01   +2.281584234411441e-01   +1.321725313529280e-01; +5.415327122841150e-01   +9.761013947290927e-01   +5.596515041544271e-01   +3.486933855670460e-01   +8.529684651772820e-01   +9.348755746367906e-01   +9.751692088494162e-01   +5.350635853468652e-01   +4.382217348409074e-01   +9.337316955533426e-01   +3.644669229614094e-01   +9.805009220375738e-01   +8.590500695452757e-01   +7.296188239330329e-01   +4.426319091671396e-01   +7.557250544163512e-02; +6.002642031724784e-01   +8.398849829743934e-01   +8.947253606445238e-01   +2.523512654908265e-01   +3.688854045253883e-01   +5.579387485850438e-01   +2.498987523215705e-01   +4.857538836115767e-01   +7.274940585594788e-01   +7.408215724993628e-01   +8.128489796892817e-01   +1.026004982431510e-01   +9.005864072593064e-01   +4.487601733368001e-01   +1.757791089495801e-01   +6.736731064169358e-01; +7.246178965499539e-01   +6.686514207703247e-01   +6.498740759403814e-01   +1.821967178018733e-01   +2.043801857625044e-01   +4.334646762611945e-01   +7.766176513336724e-01   +8.862118806934604e-01   +8.740166780127914e-01   +4.310000947097893e-01   +3.878932636201863e-01   +4.203236004576044e-01   +6.907578230001939e-01   +2.788679862507207e-01   +4.162540708215609e-01   +1.162451029213514e-01; +9.915954791537079e-01   +1.439465148105220e-02   +3.834784650759444e-01   +4.785486073966881e-01   +9.083305330562038e-01   +3.252008382842747e-01   +7.081896958030712e-01   +5.884974283566629e-01   +9.098266843880730e-01   +9.413710813596252e-01   +8.722650261878169e-01   +3.879917493511901e-01   +7.459484829684002e-01   +1.575536329702953e-01   +9.639245425231263e-01   +9.858501098334013e-01];
L2I_L1I_iGABA_netcon = [+5.724357188537753e-01   +5.674918940032662e-01   +1.062939752328075e-01   +4.558855409770086e-01   +8.018482660381829e-01   +9.746686167829148e-01   +2.236094917344736e-01   +7.576485510662896e-01; +5.609413406390107e-01   +9.522225241815970e-01   +1.337276045389878e-01   +5.656971555829539e-01   +5.462968834672854e-01   +4.238640678124024e-01   +6.480731310585511e-02   +4.987581827170940e-01; +6.043879187429708e-01   +1.219290583272680e-02   +4.380082102622619e-01   +8.192598697497839e-01   +2.583150719819132e-01   +3.913819261630180e-01   +8.290943826195341e-01   +8.253125119192729e-01; +4.656516448285616e-01   +1.218942584689286e-01   +9.291241825836035e-01   +3.608531075295584e-01   +7.777571301843136e-01   +4.604090699612054e-01   +3.929267954095376e-02   +9.160097752814365e-01; +4.368738452167255e-01   +8.534276919871230e-01   +1.357084228010865e-01   +2.415393952407778e-01   +7.776090255078540e-01   +1.317403173572936e-01   +9.097814767056888e-01   +7.069330558347648e-01; +6.884356304920347e-02   +2.201390868223382e-01   +8.206043184784563e-01   +7.666390246632896e-01   +1.482203751494003e-01   +4.632511220546052e-01   +4.544008350719034e-01   +8.017704273462855e-01; +6.374312764457412e-01   +7.012436029024837e-01   +9.329970239357001e-01   +2.371615809321308e-03   +8.281042391362540e-01   +2.670186710401887e-01   +2.826488356755397e-01   +9.594474417634975e-01; +4.268603001309055e-01   +7.777071819900008e-01   +5.759615549296307e-01   +2.784874914215284e-01   +6.212681198777689e-01   +1.008915047431640e-01   +7.561432434759182e-01   +9.489903752288481e-01; +7.557830202220727e-01   +4.282520007291505e-01   +4.995919842119173e-01   +3.141898195295421e-02   +4.663860244193473e-01   +6.588914199653854e-01   +9.300986002418095e-01   +2.947240435826122e-01; +3.023116431354779e-01   +7.328568910890663e-01   +9.249929481643138e-01   +6.676409336021030e-01   +4.880676866475987e-01   +9.379759836488751e-01   +1.388810392282960e-01   +3.541592668020553e-01; +6.000098795267608e-01   +4.521231615604452e-01   +8.603643902546388e-01   +9.750490099760820e-01   +2.207540022038886e-01   +7.680058209147215e-01   +9.438247768153751e-01   +5.434800573278324e-01; +3.304369798814372e-01   +8.030303138255128e-01   +2.525523626923127e-01   +9.461795920059403e-01   +8.551293244679339e-01   +4.481554832913579e-02   +3.140239826941873e-01   +2.097820239999122e-01; +6.459638673174778e-01   +4.323772866376198e-01   +4.573487317971825e-01   +5.013241984012826e-02   +8.758952151411263e-01   +2.586335196210831e-01   +2.074237024238568e-01   +7.784833580081336e-02; +1.745354028233619e-03   +1.495911118928764e-01   +7.384198916580276e-01   +2.904009797011386e-01   +8.370093377378843e-01   +6.431096879380795e-01   +4.632593491388449e-01   +5.097644615620195e-01; +1.483063212617141e-01   +8.004515078349397e-01   +7.508519632686214e-01   +4.827374220584059e-01   +4.404358883065227e-01   +8.786881728006901e-02   +5.971904756703376e-01   +1.967524775994048e-01; +2.486675236426153e-01   +3.763560245885628e-01   +2.408088023455634e-01   +8.858918637517453e-01   +5.430714271907453e-01   +7.219639184185779e-02   +5.474645409178621e-01   +1.413586586669419e-01];
L1I_L2I_iGABA_netcon = [+7.165273971207148e-01   +8.709536873035064e-01   +6.175312800664480e-01   +4.790052550502123e-02   +1.503005892709415e-01   +2.359134971850957e-01   +8.444819805616673e-01   +3.690437162411337e-01   +7.143033881007371e-01   +3.903626353997580e-01   +2.418349684505468e-01   +6.778625266927872e-01   +1.635788363734747e-01   +5.714897591117878e-01   +4.704259591757434e-02   +4.409739282711764e-02; +6.111888301610380e-01   +8.049546799038683e-01   +6.177215130731504e-01   +5.385434561038196e-02   +7.485352596900106e-01   +5.527948843421303e-01   +1.997939746438076e-01   +5.640916235381377e-01   +1.929514404370753e-01   +7.287869443018569e-01   +5.073440505545324e-01   +3.397341757231911e-01   +1.102412206741179e-01   +8.162702765457649e-01   +4.361345487662639e-01   +9.258050462901729e-01; +1.632558503263584e-01   +6.208188115954157e-01   +3.114981147072086e-01   +6.001610696592578e-01   +9.514393251460124e-01   +1.135690107882820e-01   +6.158180357319674e-01   +8.399688844852050e-01   +2.333745015547425e-01   +6.340110246329229e-01   +7.356786485765805e-01   +5.481977266796909e-01   +7.473241429963444e-01   +6.795552813154176e-01   +9.250732799655141e-01   +1.777363405423801e-01; +4.823897564937402e-01   +4.810940715866828e-01   +1.356795266941635e-01   +6.610311864442201e-01   +2.596125295315984e-01   +8.270140545540933e-01   +1.582499998059512e-01   +7.166654986192301e-01   +1.000000000000000e+00   +9.802883895451259e-02   +7.842150842509753e-01   +5.335984446522766e-01   +2.185236690983477e-01   +4.412349742085654e-01   +8.861706688480502e-01   +7.488470842012531e-01; +2.901272847245314e-01   +2.067039930847069e-02   +6.061135622399348e-01   +4.877966481563951e-01   +9.405570618450622e-02   +6.566619172775588e-01   +5.853357079015699e-01   +1.134239199149972e-01   +9.038567710667434e-01   +4.984733615689431e-01   +6.816199675682265e-01   +9.079349741331377e-01   +4.880266534828526e-01   +8.937264539777445e-01   +9.396668846739598e-02   +4.701859330832011e-01; +4.022242298024357e-01   +1.249702338918034e-01   +8.956721238746370e-01   +9.823641260014530e-01   +2.327482535111808e-01   +2.324270617379078e-01   +5.436345944472107e-01   +7.428612269863699e-01   +9.357906409857883e-03   +5.571739901143544e-01   +8.151500337898659e-01   +2.849254085522168e-01   +4.755033852967675e-02   +7.902544767776097e-01   +6.816716062704232e-01   +2.504334569508247e-01; +4.893778285783911e-01   +7.224263400890728e-01   +5.678889055308344e-01   +8.646513946637928e-01   +8.934397599273585e-01   +3.029887885178619e-01   +6.886396858103682e-01   +9.244637547885672e-01   +8.365417407950275e-01   +5.690970448060735e-02   +4.247795943945570e-01   +1.365713818781454e-01   +5.809643773426113e-01   +5.918083053526279e-01   +1.577331930228639e-02   +6.626252850728119e-01; +8.653383127072575e-01   +6.691611911580646e-01   +6.375432254549398e-01   +9.580578748121225e-01   +1.976772855114239e-01   +3.261474404225995e-01   +7.030338432288430e-01   +9.255740458719715e-01   +2.539050339890881e-01   +8.346296214820069e-02   +4.954999290482069e-01   +9.578460833529387e-01   +4.954573356972410e-01   +6.232544208088777e-01   +1.258619217008048e-01   +6.140033299843495e-01];
L2E_L1E_iAMPA_netcon = [+3.750443650780056e-01   +5.637930324012165e-01   +2.020388755470988e-01   +5.194439620082352e-01   +2.949772170106922e-01   +6.898548457460003e-02   +2.827202014615875e-01   +2.661909546054760e-01; +4.366138888954661e-01   +1.847823672063730e-01   +1.436229192800974e-01   +6.824468814823531e-01   +6.161601422264036e-01   +5.904833411302658e-01   +9.295124053949965e-01   +9.000516563040242e-01; +7.216155809461673e-01   +6.055805403893452e-01   +7.649132365046242e-02   +2.136072891786529e-01   +8.684701149080563e-01   +7.799783283672922e-02   +7.594636511778957e-01   +1.579509978093777e-01; +1.951405606096927e-01   +7.315070477116548e-01   +9.181192639179830e-02   +9.699315213849923e-01   +8.152043257902922e-01   +3.977781220153702e-01   +2.597620089759999e-01   +5.532960173542557e-01; +4.475626758308979e-02   +8.374790963301192e-01   +5.497660602663110e-01   +3.481845584796308e-01   +2.080592726833884e-01   +5.373651599330415e-02   +2.424593187933920e-01   +4.222552208698668e-01; +3.093675425619363e-01   +2.750396440663438e-01   +7.316082457983234e-01   +1.845263355562003e-01   +7.523685543245742e-01   +1.273842822688567e-01   +1.622495956031468e-01   +5.450891177827928e-01; +7.919427337113487e-01   +6.086397938572217e-01   +5.461433895335488e-01   +2.461493631058411e-01   +2.006370142301135e-01   +2.387019345853973e-01   +2.919307771380315e-01   +7.475271797296047e-01; +4.363322576787700e-02   +5.503521777706413e-01   +4.472162056295648e-02   +2.592906983591036e-01   +5.843792378634322e-01   +9.412612178986501e-01   +5.663692792161793e-01   +1.314008886321163e-02; +2.155388075599046e-01   +2.803725241647446e-01   +6.375321046374435e-01   +2.194108351580391e-01   +8.760985199598981e-01   +2.056905064161049e-01   +3.966057602964254e-01   +9.379026515342719e-04; +2.701881346218872e-01   +3.400823116963231e-01   +9.898085699484444e-01   +3.620171163144753e-02   +7.187963958531812e-01   +3.278307248838247e-01   +9.845668157881438e-01   +1.918287867985694e-02; +7.914069423228087e-01   +5.725577473692446e-01   +9.169552443840397e-01   +3.511159291913108e-01   +6.980436143374815e-01   +8.644670371289827e-01   +5.466934233085993e-01   +3.490733765413432e-01; +9.831464525578067e-01   +7.468723537872626e-01   +7.750939524006233e-01   +9.008186442976679e-01   +4.574245412473996e-01   +9.248226929681161e-01   +9.361718973156624e-01   +4.283498299917261e-01; +9.445377858020550e-02   +7.673685395833733e-01   +1.969820882065477e-01   +1.357082768114141e-01   +5.062202950468107e-01   +2.314101384272495e-02   +9.874854787571153e-01   +5.428045271557649e-01; +1.988790975235139e-01   +4.057173326679691e-01   +3.071385988664096e-02   +9.512375094412312e-01   +7.982282314343729e-01   +3.624559253495057e-01   +8.303594764214850e-01   +4.798121224918614e-01; +1.185434352746010e-01   +1.546632959717907e-01   +3.792527525179336e-01   +9.067520466141058e-01   +9.372325447539784e-01   +5.332253477803636e-01   +1.790237061144268e-01   +9.136320713628494e-01; +6.429993680053441e-01   +2.048200749548073e-01   +5.771474694266910e-01   +4.102704522789528e-01   +7.920574314573978e-01   +4.095047418622720e-01   +3.141791611847656e-01   +4.184235812310109e-01];
L1E_L2E_iAMPA_netcon = [+4.966179443075754e-01   +4.591563066386777e-01   +6.166317836616365e-01   +4.912882418388990e-01   +2.371438873749623e-01   +7.162010704712118e-01   +6.848885408019837e-01   +6.348158717293340e-01   +5.199529584914122e-01   +2.394430857361842e-01   +8.726748296638445e-01   +1.739650282366086e-01   +1.344354114084397e-01   +2.440528624212636e-01   +1.836474356066595e-01   +3.187310529736839e-02; +8.362410978622221e-01   +3.651121010364101e-01   +1.011024445953224e-01   +6.641703221493961e-01   +8.342056530522941e-01   +3.788902784955780e-01   +9.739318013017580e-01   +6.224311828754983e-01   +6.722465601955874e-01   +7.288502714802456e-01   +6.658448982905929e-01   +2.971780119001240e-01   +2.882607502259386e-01   +7.429906705499905e-01   +1.521666595952277e-01   +2.538745561365210e-01; +1.818939101923058e-01   +2.926843754394921e-01   +7.582147298467702e-01   +1.792661232483527e-01   +7.321965648022363e-01   +3.795482453180499e-01   +7.578547124328603e-01   +4.106323626318513e-01   +7.735021012693755e-01   +1.237103980492233e-01   +5.474706418602469e-01   +1.046466434931862e-01   +6.649313026555941e-03   +9.328175349269577e-01   +1.334053225541592e-01   +9.873209132413516e-01; +3.402412582702405e-01   +2.381776929421953e-01   +5.400541282449807e-01   +4.738538274162816e-01   +4.878188068627023e-01   +7.186414066814890e-01   +5.518966462953663e-01   +4.328056496098832e-01   +4.617941113143475e-01   +3.883770259604773e-02   +2.441076401013135e-01   +4.544928007799759e-01   +3.059504706409290e-01   +3.457949766659474e-02   +1.628166434023025e-01   +6.315513922185625e-01; +6.949110365877750e-01   +1.388489527799630e-01   +4.475752406853650e-01   +4.998630373196444e-01   +8.521033612356385e-01   +8.326032480234484e-01   +2.675976930727838e-02   +5.128784526173238e-01   +9.091937904282487e-01   +6.514837584407339e-01   +1.081605020614280e-01   +5.880081301567022e-01   +9.071527963377455e-01   +4.289227660936758e-01   +9.254522749615604e-01   +3.573642377725602e-01; +6.903385035087664e-01   +1.022717849600708e-01   +7.429770712080397e-01   +6.002439498395576e-01   +7.209610752060551e-01   +6.681755243504369e-01   +1.886551031992658e-01   +2.627531395496512e-01   +2.440955141161786e-02   +1.955488347982157e-01   +9.680660605224637e-01   +2.189611910950180e-01   +2.944424444278211e-01   +8.254949122978842e-01   +2.637076574646340e-01   +9.922723463321001e-02; +3.679219553223431e-01   +2.355469410689502e-01   +3.880096413175617e-01   +2.457601165414000e-01   +5.193712453061339e-01   +6.473583708611673e-01   +9.400155492647934e-01   +4.227172432866518e-01   +4.871383599242938e-01   +9.724364755092795e-01   +5.865355235920421e-01   +1.056160195483037e-01   +8.290531559143175e-01   +9.979747652906662e-01   +2.046452293414797e-01   +4.128753307937609e-01; +2.955386978660580e-02   +3.481445085362247e-01   +5.328978359713539e-01   +5.189578339725932e-01   +9.373749097128734e-01   +5.626125304254339e-01   +3.945275710628026e-01   +5.208867894432806e-01   +2.697478376118194e-01   +8.241633351148825e-01   +8.170118935809679e-01   +5.639261266056438e-01   +7.378921930963612e-01   +9.209139492547705e-01   +6.199321145475241e-01   +9.287617760195682e-01];
L2I_L2E_iAMPA_netcon = [+6.769368623667397e-01   +6.124341122730682e-01   +3.784312755158130e-02   +8.013160919648025e-01   +5.200117036741516e-01   +8.203167381863093e-01   +6.477875393692182e-01   +3.853498049807589e-01; +2.224941972252969e-02   +9.419455207481755e-01   +5.450859813101429e-02   +9.359528906717247e-01   +6.437304713884209e-02   +1.092410830569539e-01   +3.352475514682623e-02   +1.680988994279837e-01; +7.322551051543487e-01   +9.616469806082063e-01   +4.068473628008059e-01   +9.384370223271619e-01   +2.872376554775647e-01   +2.422660793257359e-02   +5.636131846277500e-01   +4.466671589840263e-01; +2.153767374788736e-01   +3.681100284508343e-01   +9.791903374954457e-01   +1.450744159149548e-01   +7.159676776166433e-01   +8.984853605687919e-03   +3.089340111411443e-01   +8.757211449582182e-01; +8.529937933185873e-01   +7.957335918388001e-01   +7.114112326322064e-01   +3.245269997247247e-01   +8.873979837593403e-01   +3.350746632261322e-01   +2.624123764307559e-01   +4.039827463984098e-01; +1.569329122058492e-01   +7.222613720936948e-01   +9.903915787603931e-01   +4.275064837600316e-01   +3.676588104714151e-01   +6.650644134322384e-01   +7.188187386811850e-01   +1.672407103129432e-01; +6.702989247787771e-01   +9.520683431118869e-01   +6.495041392807885e-01   +7.079651084020484e-01   +5.639744094617430e-01   +5.909902441776386e-01   +3.056623163771520e-01   +6.657580721869955e-01; +9.335909134193054e-01   +1.197886402586951e-02   +5.025221698056409e-01   +6.213024194523192e-01   +8.804583150030337e-01   +7.906306582949189e-02   +9.023190039312377e-01   +9.318799815822614e-01];
L2E_L2I_iGABA_netcon = [+6.463127515737654e-02   +5.247200976013781e-01   +3.448791536889992e-01   +2.584192218717630e-01   +4.656768891232806e-02   +9.032443262703632e-01   +3.430809842278329e-01   +4.547170854029736e-01; +3.541628632053552e-01   +6.163686133549545e-02   +5.576996571928668e-01   +9.844886167837256e-01   +3.640869041630032e-01   +5.534960553480424e-01   +9.353424085035361e-01   +6.684790386915700e-01; +9.279923714178023e-01   +1.820971268867755e-01   +6.885910956004516e-01   +3.482516517489050e-01   +4.190894733709419e-02   +7.108573164138039e-01   +9.114196974303476e-01   +7.714087078135692e-01; +2.400796522312268e-01   +3.176049510814189e-01   +3.473991117156587e-03   +3.933354771601372e-01   +4.919410730331012e-01   +7.170223656508480e-01   +7.303416269815279e-01   +9.270996119224756e-01; +1.127406844270154e-01   +2.450103927692577e-01   +5.012257141554903e-02   +7.517165204509020e-01   +7.308764662333448e-01   +1.739460232085089e-01   +4.447232064485253e-01   +6.510600516064622e-01; +7.111113762111571e-01   +3.188520308033972e-01   +3.048741889809454e-01   +1.092068607245952e-01   +1.456580324772594e-02   +3.545990822880896e-01   +1.465975460673806e-01   +5.026353909927442e-01; +2.493080051535449e-03   +8.713591850195704e-01   +8.756576134867468e-01   +5.949880071347350e-01   +5.058543507977149e-01   +3.739302828851362e-01   +8.317073706351422e-01   +3.420232129549517e-01; +1.791965579351058e-01   +3.016687004809845e-01   +6.261037240534751e-01   +1.242906628906017e-01   +2.489323860922304e-01   +7.587350012667783e-01   +2.460665130107978e-01   +9.426748165928170e-01];
L3E_L2E_iAMPA_netcon = [+7.679255626731174e-02   +1.634598584763235e-02   +3.696534376128963e-01   +4.918041545436467e-01   +1.955922419246496e-02   +9.647783581607638e-01   +3.585780824334703e-01   +2.207445771674399e-02   +2.037143004540478e-01   +6.834087514048984e-02   +2.418703255465808e-01   +9.986137094615162e-01; +9.550052544995817e-01   +9.852077547456189e-01   +1.214242734589399e-01   +6.722402675605929e-02   +8.074092283940915e-01   +3.894795256695214e-01   +2.283489448756813e-01   +1.288237741315397e-01   +3.560549151554127e-01   +7.502930850114984e-01   +5.429191854941005e-01   +3.398547739990368e-01; +6.650360734153534e-01   +7.221989166807367e-01   +5.102810093269184e-01   +8.712282317818159e-01   +7.976156243094853e-01   +6.628280024937376e-01   +7.244145334106290e-01   +6.708851379926961e-01   +8.941668999242380e-01   +9.960298901178362e-01   +3.355912652448044e-01   +8.313037373954021e-01; +1.690956574419056e-01   +8.791774471350101e-01   +7.680123908319477e-03   +9.996405381055860e-01   +4.179806306875541e-01   +5.847298626115306e-01   +7.750969821168769e-01   +5.099873598454645e-01   +8.192838643053099e-01   +7.713222653405424e-01   +6.697375414860200e-01   +1.118427419043019e-01; +1.994624721196612e-01   +8.155901148795798e-01   +8.726183980067930e-01   +1.201012843735837e-01   +6.383933019663982e-01   +5.025398454147288e-02   +3.366369560535331e-01   +7.579985254011558e-02   +3.176216885002207e-01   +8.928489721136930e-01   +8.792043251532301e-01   +7.817728063525665e-01; +9.917891353520152e-01   +3.373859386372305e-02   +9.083717598328620e-01   +1.053952846853285e-01   +5.675831698863913e-01   +7.677482176636681e-02   +5.733508602129446e-01   +5.359917491726730e-01   +6.008038497668331e-01   +4.386522342657694e-02   +9.772656287546962e-01   +1.518852496147756e-01; +9.361289064143059e-01   +9.361756783924291e-02   +1.121593438842742e-01   +1.477885065881365e-01   +9.104981930322039e-01   +2.291453033668961e-01   +6.362852664816473e-01   +6.875635518307397e-01   +7.050115575171441e-01   +7.989521653811642e-01   +1.350681026266490e-01   +7.311829232271717e-01; +9.808782158946898e-01   +9.489794423257623e-02   +4.146858867125533e-02   +1.307642931953452e-01   +7.551774214667403e-01   +4.155542524569194e-01   +3.660256295520822e-01   +5.907255000928949e-01   +1.786329329306061e-01   +7.149622882989929e-01   +8.821602031973215e-01   +1.167053050688574e-01];
L3I_L2I_iGABA_netcon = [+7.693083622332928e-01   +5.382788061978648e-01   +5.981770144106363e-01   +3.088772239627395e-01   +9.611478295324992e-01   +1.117984758942798e-01   +2.950865947810010e-01   +7.956231697729500e-01   +9.204608378469543e-01   +9.961840098832396e-01   +3.098462778353550e-01   +9.951559826986454e-01; +6.367560343493749e-01   +4.508820850003548e-01   +5.640191906039217e-01   +7.588030916927522e-01   +5.477271054647047e-01   +6.256568285885096e-02   +1.672647730682707e-01   +5.018358174883628e-02   +3.878896288247731e-01   +2.918975049210284e-01   +4.438069211540892e-01   +9.182685999891673e-01; +8.000082622464250e-01   +1.152158903618566e-01   +7.391717648187456e-02   +6.509876384026783e-01   +9.783173015524012e-01   +4.411505330644877e-02   +7.229040003868966e-01   +1.817674739604579e-01   +7.469337443152554e-01   +5.227323015463526e-01   +2.026691181002265e-01   +6.924073827563956e-01; +9.656287876603235e-01   +7.152614134202417e-01   +7.648200505364448e-01   +3.327854068369469e-01   +1.237625949370155e-01   +1.285367065449506e-01   +2.976350854475303e-01   +2.477101596241924e-01   +8.787214366303053e-01   +3.621065370313246e-01   +9.413604335626230e-01   +2.174053226821179e-01; +7.139751620389939e-01   +1.836650418037502e-01   +8.689321478009441e-01   +9.787720732062890e-01   +1.606635105534420e-01   +4.904088849724677e-01   +6.750122427676126e-01   +2.556787872995065e-01   +3.973415455596016e-01   +5.204779412417064e-01   +2.918360849500710e-01   +3.086692444550067e-01; +6.456535177878597e-01   +3.277602662534841e-01   +6.997474590442991e-01   +5.319566121812865e-01   +3.333758940554399e-01   +4.694228217852218e-01   +7.537669781286244e-01   +6.490958357555506e-01   +1.691108259007640e-01   +4.946780101409143e-01   +1.180667744129903e-01   +2.255599470622497e-01; +5.175993697799637e-01   +9.697470483745525e-01   +1.097617799822660e-01   +7.513895817633404e-01   +5.295017590562366e-01   +1.559363082351751e-01   +7.431339485674540e-01   +1.009562835169474e-01   +4.433705858396316e-01   +1.831245115562914e-01   +6.619268236740486e-02   +7.031767528869047e-01; +9.550027254672679e-01   +6.946889427300460e-01   +6.614949819644035e-01   +2.645929882524429e-01   +6.902265404810148e-01   +1.324602972450410e-01   +7.797731518499825e-01   +4.691564740808108e-01   +8.536049703054183e-01   +4.851321086586393e-01   +7.280734676046080e-01   +3.769751893846062e-01];
L2E_L3E_iAMPA_netcon = [+6.524580306662854e-01   +3.816851681871792e-01   +2.311960600188278e-01   +4.669013828697883e-01   +9.094920672744644e-01   +9.529884970404153e-01   +7.611661049446147e-01   +3.554430090135349e-01; +3.790184891691824e-01   +2.619598250149160e-02   +9.143513527825489e-01   +2.861549741783564e-01   +6.798639963333518e-01   +1.908583106135789e-02   +8.955562906451148e-01   +6.651788829562032e-01; +3.035640448876043e-01   +3.281222057424611e-01   +4.878179185726130e-01   +2.721111937643775e-01   +8.431776352417935e-01   +5.017288442468237e-01   +7.948237740419162e-01   +5.937803685323927e-01; +1.563135262607880e-01   +4.938241146975761e-01   +5.881055031534337e-01   +1.467789146889213e-01   +9.754978151596490e-02   +3.359265585703688e-01   +9.451572381525553e-01   +5.254739497647220e-02; +7.776956345670476e-01   +2.682042610926169e-01   +9.530107671408385e-01   +1.414723913707021e-01   +7.350652211492643e-01   +6.676967689900484e-01   +5.365704855039957e-01   +2.120625103702544e-01; +7.123014059632816e-01   +5.321579723072055e-01   +8.468363114719274e-02   +2.641065921371543e-01   +5.503917259842628e-01   +1.626389764108157e-01   +1.585848905601653e-01   +5.964783238111303e-01; +1.739733321830078e-01   +4.177279534294543e-01   +2.211853879908370e-01   +6.066222036331343e-01   +2.489994395222536e-01   +2.241267549497113e-01   +1.357570672929327e-01   +2.681819604982845e-01; +4.480239193864546e-01   +6.982327068371836e-03   +1.602392892693335e-01   +1.016013637875482e-01   +7.187045273684919e-01   +1.118512211853732e-01   +2.475976117437737e-02   +1.167482369646815e-01; +8.414182027185911e-01   +8.949135158268089e-01   +3.922010588086105e-01   +4.920807321191038e-01   +3.626381512884875e-01   +9.920752557586053e-01   +6.891611817396343e-01   +2.182171067177117e-01; +7.016141046105594e-01   +2.390572516590852e-01   +1.863192091795620e-01   +8.935762625971369e-01   +8.464388035170434e-01   +1.441629267062327e-01   +5.820724493839103e-01   +8.782691793629068e-01; +7.642466230792782e-01   +8.016607387399673e-01   +7.596915745652275e-01   +1.869918791809152e-01   +8.222823337637009e-01   +7.676646919275609e-01   +2.986394770776187e-01   +4.624587632371773e-01; +9.770761847848501e-01   +5.810107971108772e-01   +2.346174098685140e-01   +5.318682046165434e-02   +6.187625287856172e-01   +6.288648381564584e-01   +7.228119864241343e-02   +7.300183488813321e-01];
L2I_L3I_iGABA_netcon = [+5.900130515395084e-01   +1.437283375911826e-01   +3.459985496056240e-01   +3.720472513458200e-01   +5.969355174707004e-01   +5.126735100572141e-01   +7.739024843949087e-01   +2.662956740087934e-01; +8.428871774271114e-01   +9.894311425764271e-01   +4.305416081509188e-02   +5.367433310228611e-01   +4.766256004165179e-01   +2.420317205062832e-01   +1.824251673307525e-01   +5.957557393083117e-01; +6.055540411733616e-01   +4.780866311733996e-01   +9.479705380927225e-01   +9.723194520143101e-01   +3.765706257459274e-01   +2.680723833222597e-01   +4.513823358971178e-01   +6.849569204328578e-01; +7.471622699975270e-01   +4.200466034933858e-02   +8.589542119359096e-01   +9.975460224190251e-01   +9.799175945807698e-01   +4.128091127304845e-01   +3.054188498195430e-01   +4.147441847494287e-01; +8.550401305769094e-01   +2.695746550973632e-01   +1.372463108604651e-01   +4.105977761472646e-01   +1.408272339666738e-01   +2.639332734286027e-01   +3.800869270320817e-01   +5.152904932100372e-01; +1.438179840641083e-01   +6.738720669895826e-01   +5.817422864772839e-01   +4.480164978675737e-01   +2.715253651268475e-01   +8.543858380917897e-01   +7.951625589500544e-01   +8.130422019481053e-01; +7.386675298408981e-01   +1.426115782366174e-01   +6.275202614772460e-02   +2.428994481889580e-01   +2.259632234377933e-01   +4.803520473653665e-01   +7.809788607396485e-01   +5.413256819997315e-01; +1.475109707922906e-02   +7.732118230374464e-01   +9.527308264554749e-01   +5.957431198791197e-01   +7.938962684705956e-01   +3.331684042609764e-01   +6.436115862508341e-01   +5.913785455603084e-01; +2.302099556930343e-01   +2.671207881736026e-01   +4.988082231898938e-01   +7.507894183242340e-02   +8.175768280624931e-01   +6.297686548780422e-01   +2.410464756063500e-01   +5.383010833183948e-01; +5.380419891840150e-01   +8.815235344870320e-01   +2.483209748848017e-02   +9.107961472502004e-01   +8.037449311601895e-01   +4.165154474030983e-01   +6.042265342135382e-01   +5.439002209111594e-01; +7.116418134777039e-01   +3.622009311710401e-01   +5.493706781109461e-02   +4.748099346581912e-01   +1.187218312353394e-01   +5.421095697420499e-01   +4.184890500676954e-01   +1.524156271248037e-01; +4.352040947711578e-01   +1.504241101108586e-02   +3.080923360972160e-01   +5.029088970693789e-01   +6.423500909152453e-01   +3.383419352160862e-01   +2.992253509862601e-01   +6.970963094633147e-01];
L3I_L3E_iAMPA_netcon = [+6.026653714328355e-02   +7.771532018664904e-01   +5.563578859430702e-01   +5.668802166280402e-01   +9.131512136949714e-01   +8.345221463880379e-01   +8.503873321425723e-01   +8.632581135639292e-01   +5.291063235903327e-01   +9.926075259748266e-01   +4.806104018061453e-01   +3.521765613014782e-01; +9.204034610484850e-01   +8.322754616371897e-01   +8.491794236997828e-01   +9.351255543949061e-01   +5.899906909025782e-01   +4.016058293063095e-01   +6.269851667910775e-01   +8.534709445207228e-01   +5.701106181997098e-01   +6.990600293736884e-01   +7.400960502399743e-01   +3.961026242928563e-01; +1.835960332329112e-01   +5.946403013918955e-01   +9.700537452611503e-01   +7.761102307055886e-01   +5.757319081473300e-01   +6.829321299962740e-02   +4.413995958588411e-01   +9.473599191959972e-01   +9.790502309982394e-01   +8.369757980330489e-01   +5.921353112563901e-01   +9.932534983438928e-01; +5.338959010823955e-01   +7.583268950015705e-01   +4.684212019876410e-01   +5.983805305852621e-01   +6.525461911689940e-01   +3.779243651182471e-01   +2.270797841814982e-01   +6.959384640730836e-01   +9.593086299131973e-01   +7.309566259208067e-01   +2.543032067669493e-01   +2.902588093746353e-01; +4.000369793304988e-01   +6.595609000221417e-01   +7.743549567557257e-01   +6.511235156617072e-02   +4.314160164682143e-01   +8.602822200329814e-01   +5.005297818425681e-02   +3.596086398174741e-01   +5.554372084397251e-01   +9.988718705868337e-01   +6.113813655825733e-01   +2.354748278137919e-01; +9.701120784265023e-03   +5.848335422440406e-01   +2.411482252555413e-02   +5.319191222682380e-01   +9.396524572851125e-01   +3.055937947810618e-02   +7.047843253385691e-01   +3.816907966559838e-01   +5.204739803696107e-01   +5.049949227887851e-01   +2.298421526076448e-01   +3.293835704561988e-01; +1.068237069417230e-01   +2.390946326936117e-02   +6.772798399414361e-01   +8.593441723034416e-01   +1.019358245009647e-01   +4.237719281788392e-01   +8.492882275318275e-01   +8.528240089123011e-01   +4.724100438376432e-01   +1.934286466308154e-01   +1.926726158019492e-01   +1.674027187348570e-01; +8.545555193919052e-01   +6.861291656994392e-01   +8.393914995905991e-01   +3.407500370780873e-01   +4.107297625608325e-01   +2.481561182071887e-01   +4.019720674624250e-01   +3.858390736986266e-01   +8.939437209647154e-01   +9.505703166668983e-01   +5.231232215164334e-03   +3.848805032975935e-01; +3.358036453777460e-01   +3.221795021691914e-01   +6.901653271078370e-01   +1.799897778789991e-01   +8.941270343891741e-01   +7.102688072403375e-02   +2.890249829536794e-01   +7.722340691555180e-01   +4.815765940498699e-01   +4.524354473582002e-01   +6.520781118443231e-01   +5.269788843971257e-01; +1.447480781309970e-01   +8.693925539351532e-02   +8.990274997192179e-01   +8.829432612242665e-01   +7.367270824460763e-01   +9.183933914276697e-01   +2.566815369900912e-01   +7.784771888268579e-01   +4.907417298403163e-01   +6.011941953774872e-01   +4.013467209275519e-01   +5.932213717367919e-01; +7.969226818636806e-01   +7.479850914496282e-01   +8.985770986732874e-02   +8.442371549749684e-01   +9.578651077457995e-01   +2.665085595409628e-01   +5.118772599446012e-01   +4.263233327445247e-01   +3.105539409614225e-01   +6.442108320727231e-01   +2.705939845614815e-01   +1.656914102538223e-01; +6.534181077651465e-01   +9.679584107249012e-01   +7.874289056520867e-02   +8.262188996557903e-01   +9.755425654452118e-01   +1.088572755644489e-01   +1.199050168042048e-01   +4.895467939663082e-01   +8.563914333894713e-01   +7.564403737120616e-01   +6.826019919866002e-03   +6.244948281099977e-02];
L3E_L3I_iGABA_netcon = [+4.437125739382924e-01   +6.101024036230584e-02   +6.319649332993517e-03   +4.985299610300239e-01   +5.401505826457441e-01   +2.506021526901274e-01   +7.194431323991645e-01   +7.588746519753025e-01   +3.806824069035277e-01   +4.485018986901653e-01   +2.014867429019167e-01   +6.567089184013362e-01; +6.070309156490046e-02   +8.065594072566120e-01   +1.287023080421354e-01   +1.938575327038549e-01   +2.187479994810228e-01   +3.372954590133182e-01   +2.231263992873262e-01   +8.868694990091420e-01   +6.087328484283288e-01   +3.929570423741445e-01   +8.289937725237199e-01   +9.034412775180419e-01; +6.254303795543305e-01   +9.132751288133062e-01   +3.108821383107695e-01   +6.444986724519598e-01   +2.675713163338918e-01   +6.020639571320475e-01   +4.964194905876549e-01   +7.299186707084074e-01   +1.608283663357114e-01   +6.738707288719401e-01   +4.400857662697652e-01   +8.369752591121021e-01; +8.090982571318314e-01   +4.241239322045060e-01   +2.377288549117872e-01   +2.546238226649061e-01   +1.345628800187287e-01   +4.795613932629803e-01   +4.762320695348491e-01   +6.900662386458160e-01   +1.030191210780924e-01   +3.291674696868533e-02   +4.263957018764324e-02   +1.664715528752622e-01; +4.040099555268925e-01   +1.881635299495908e-01   +6.520568125828166e-01   +9.404443872626735e-01   +1.276275987807297e-02   +8.999612518751768e-01   +4.344303257332832e-01   +6.482489431530610e-01   +6.160433648703245e-01   +7.817438196168425e-01   +7.641955028481537e-01   +1.628712971869876e-01; +8.886292492292081e-01   +1.855647153779013e-01   +8.065484720417073e-01   +2.893176163553143e-01   +1.489214736008874e-02   +2.865406733967131e-01   +5.580812425401598e-01   +6.193225964920942e-01   +9.593340853677578e-01   +3.740192339017017e-01   +9.321217273557938e-02   +1.364251776506000e-01; +7.209893353763867e-01   +6.700098501228784e-01   +7.358784924032540e-01   +1.453827043711863e-01   +9.891164484470802e-01   +7.710076610027156e-02   +2.048251063651081e-01   +7.673698483484405e-02   +6.685912407874955e-01   +6.381775298650414e-01   +6.537327585046562e-01   +1.538424706351917e-01; +2.021554704145346e-01   +5.243809638163427e-01   +1.208889342575460e-01   +8.674554019309665e-01   +6.472944212133602e-01   +3.843979709051710e-01   +2.777433712145265e-01   +5.461100049838931e-01   +4.708823775321288e-01   +4.921977767808643e-01   +2.655932972488451e-01   +3.976331759886357e-01; +3.732837651005991e-01   +7.793784019307760e-01   +1.751665253017216e-01   +8.854150329871122e-01   +8.085433041501053e-01   +1.840264565768894e-01   +8.047399633900409e-01   +8.777745114835039e-01   +3.340494136106366e-01   +2.271198307976234e-01   +4.384604565199769e-01   +6.577491110019673e-01; +2.121975169808283e-01   +3.024316337042632e-01   +2.640039861420601e-01   +6.573167665574099e-01   +2.803323660936780e-01   +7.287613415769668e-01   +9.977629470716533e-02   +9.847873195447991e-01   +5.875220800098205e-01   +2.128545445820273e-01   +8.477934309671551e-01   +2.210177339448452e-01; +2.589797759446042e-01   +4.704369201428591e-01   +8.177214276097287e-01   +9.972925224333652e-01   +1.294397228230835e-02   +4.262501588719405e-01   +3.806935381756222e-02   +6.848751485325963e-02   +5.478093098537261e-01   +4.523138235254896e-01   +9.048853284305584e-01   +6.410211865045473e-01; +9.938721635163450e-01   +7.086575801802928e-01   +5.896870645846148e-01   +2.622083401409553e-01   +1.021409841763644e-01   +2.655361612563231e-01   +7.115089080244803e-02   +2.892398164911241e-02   +4.220355426981102e-02   +6.282232109304693e-01   +2.831906265316912e-01   +6.111543060820520e-01];
L2E_Input1_iAMPA_netcon = [+9.971290418366379e-01   +9.974452592994713e-01   +9.997149434048080e-01   +9.928093531154074e-01   +9.930227990378619e-01   +9.993487525632875e-01   +9.909332638734019e-01   +9.967782610189075e-01];
L2I_Input2_iAMPA_netcon = [+9.983321418139399e-01   +9.964534168701825e-01   +9.953853440456778e-01   +9.944617016097962e-01   +9.963615357664177e-01   +9.934777413408662e-01   +9.977035071211723e-01   +1.000000000000000e+00];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
