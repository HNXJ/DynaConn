function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.599155323519470e-01   +4.770849004511948e-01   +5.366716427583619e-01   +6.286884128200801e-02   +3.453516785454945e-01   +8.383743898651301e-01   +9.332826146556082e-01   -5.995124051498721e-02   +2.755332696358227e-02   +2.648409793533069e-01   +3.763309026844564e-01   +6.502195705366949e-01   +3.781176925514118e-01   +5.554628420046583e-01   +8.641308485807812e-01   +6.757163936885171e-01; +4.074288188627292e-01   +1.608758019282445e-01   +3.943344032547457e-01   +3.219400711116529e-01   +3.672408196469010e-01   +2.279244423756947e-01   +1.873874862682711e-01   +6.207757176493161e-01   +4.130934270291119e-02   +7.325507492869492e-01   +4.550654235261201e-01   +7.779343978288876e-01   +8.195901014402112e-01   +3.311478117175709e-01   +7.443520532975073e-01   +5.399659155145259e-01; +1.382950698599789e-01   +2.533347855419138e-01   +7.470377444071474e-01   +8.337782049948780e-01   +6.968763028103062e-01   +3.754073310158760e-01   +3.104786797060162e-01   +6.140394348951036e-01   +3.429659228346661e-01   +6.838683796626032e-03   +4.700217694464177e-01   +8.037460189391687e-01   +7.358060806269993e-02   +2.868970321656805e-01   +8.164391700596301e-01   +1.280478922955451e-01; +5.654375785298644e-01   +8.066946142385996e-01   +6.641252539782319e-01   +7.292027515359513e-01   +2.850104486543107e-01   +4.638219653643289e-01   +8.661007707784305e-01   +4.614787827910132e-01   +8.480603737201886e-01   +5.976327596295492e-01   +5.330072699137088e-03   +5.631232993769979e-01   +6.492552752549026e-01   +8.844928690286129e-01   -6.457088174865661e-02   +4.504924448025066e-01; +4.272810167117344e-01   +8.810591605264133e-01   +2.229157367782342e-01   +3.490276924148214e-01   +4.008287838970778e-01   +2.146746889545448e-01   +5.907918716565368e-01   +5.731956873798724e-01   +9.231775678247499e-01   +2.696049947643505e-01   +6.428674125674168e-01   +5.091410398945425e-01   +3.739377869078188e-01   +6.418868633503069e-01   +4.623443006140036e-01   +3.546276583588471e-01; +8.223881837805066e-01   +7.454822303700016e-01   +5.516808080530454e-01   +2.344466800439090e-01   +2.256551292470796e-01   +6.476926897186691e-01   +7.368574541580909e-01   +2.032865681431006e-01   +3.129238745757080e-01   +7.198611069227320e-01   +3.010135828287830e-01   +8.201068228204396e-01   +5.640441143989575e-01   +7.245207900373033e-01   +7.287801296607185e-01   +9.811297239400744e-02; +5.705478329349036e-01   +7.772923750693059e-01   +4.181754172371687e-01   +5.918858477915343e-01   +5.574371300997474e-01   +3.635994711681232e-01   +5.238700758081629e-01   +4.332458548165809e-02   +9.345130737919050e-02   +2.689163116929785e-01   +5.019253844387551e-01   +4.646996835301255e-01   +6.783078676207102e-01   +2.745665437777414e-01   +6.722096665942681e-01   +3.313202824938276e-01; +4.802379191125977e-01   +3.825170593878156e-01   +1.743427796295258e-01   +2.034970980733985e-01   +4.321164270989097e-01   +2.503026321681519e-01   +6.307619839731162e-01   +4.001788912283477e-01   +1.338941466993323e-01   +1.601114410096737e-01   +4.141179641810250e-01   +5.742414510398585e-01   +1.197752048391098e-01   +6.235882362768577e-01   +1.910950981286739e-01   +6.153204712455623e-02; +6.620844714199541e-01   +2.365252893657109e-01   +6.861554881525952e-01   +1.950783066189204e-01   +5.511278922955669e-01   +4.919332812295106e-01   +7.497782068449850e-02   +4.617838493768103e-01   +4.159409044870603e-01   +4.517851340120649e-01   +5.060507147119117e-01   +7.612886482494164e-01   +6.441957192041280e-01   +8.120523111038228e-01   +7.244442372758075e-01   +6.339313825709519e-01; +1.873042088990993e-01   +8.153434458723079e-01   +5.608089381673877e-01   +2.675344864853251e-01   +7.065889086183920e-01   +8.982235714250536e-01   +5.714680438816632e-01   +3.982983054052923e-01   +2.012347342298181e-01   +2.289150199705453e-01   +1.840551497571590e-01   +4.263232083937121e-01   +1.569620960588265e-01   +2.116812687025647e-02   +3.550223055621684e-01   +4.568347170239450e-01; +2.691493371856412e-01   +1.100416287886223e-01   +4.471206063510232e-01   +4.094304270027553e-01   +6.528685823515457e-01   +8.367415063692076e-01   +6.972205501836614e-01   +4.748926297817513e-01   +7.847798787204530e-01   +4.610258853948920e-01   +6.550368061217743e-01   +3.059722871526120e-01   +1.730314974190977e-01   +4.610454010195086e-02   +6.903890869948666e-01   +9.817668028408452e-02; +4.415645227048406e-01   -2.904695866922724e-02   +3.707829421196234e-01   +2.573994406297364e-01   +3.075235744566087e-01   +6.360405902238272e-01   +4.322579584935121e-01   +7.334257286031429e-01   +6.787895801224515e-01   +8.950183142795377e-01   +4.728036391237017e-01   +8.241557655068349e-01   +5.512485559365770e-01   +2.740431441313650e-01   +7.810104938752613e-01   +7.864208109840635e-01; -9.283779506353879e-02   +1.839930565642326e-01   +9.726425579898256e-01   +3.105026476369979e-01   +1.309143640818355e-01   +7.282884349518433e-01   +7.440787680624132e-01   +5.960659618873365e-01   +7.309258001029324e-01   +7.763127373428220e-01   +1.717752522701875e-01   +6.369149596085326e-01   +7.804173762737773e-01   +4.891733970567654e-01   +8.681383371487946e-01   +5.207170440101426e-01; +4.212419810946075e-02   +9.327649393418400e-01   +4.052164852616478e-01   +1.053955099173004e-01   +3.506016275508031e-01   +4.807871855606247e-01   +4.644903151838462e-01   +7.960855194738600e-01   +1.246493010779908e-01   +8.098846867140775e-01   +6.774851559380034e-01   +2.492792356691401e-01   +6.257510600913435e-01   +6.658281641269457e-01   +1.616556254221077e-01   +7.509171879566265e-01; +1.607811607605776e-01   +3.894833229637926e-01   +7.600788463478022e-01   -2.367559883572738e-03   +2.581381066220056e-01   +2.365157880321858e-01   +7.841910055362584e-01   +7.729502514485189e-01   +9.527249038909662e-02   +1.000000000000000e+00   +2.898480914768333e-01   +1.486281983585501e-01   +2.802289237879372e-01   -2.989961354973610e-02   +5.813723978898259e-01   +5.079111900824161e-01; +5.476883608108314e-01   +7.048588321626432e-01   +7.513642825993812e-01   +6.015253580719152e-01   +7.263392626875084e-01   +5.045064032744195e-01   +1.468717448426096e-01   +5.586354126748392e-01   +6.929279591659431e-01   +7.803343497881531e-01   +2.772435675306931e-01   +5.414670843093501e-01   +3.315719602787837e-01   +7.501040383464044e-01   +7.781017122452736e-01   +7.895563092098704e-01];
L1E_L1I_iGABA_netcon = [+3.712393952054659e-01   +2.036160561441556e-01   +1.695549596363987e-01   +4.388048868282239e-01   +2.461156916131693e-01   +4.738084052071999e-01   +1.292351765148951e-01   +4.754692832115315e-01   +5.778833051110965e-01   +4.257264008828093e-01   +7.054939687545371e-01   +5.034703232176021e-01   -9.171386417956338e-03   +7.545104818589774e-01   +4.577996432896996e-01   +1.352239904462054e-01; +3.694005038719304e-01   -2.153267431635056e-02   +6.038789698789988e-01   +5.070115877894955e-01   +4.568473059865720e-01   +3.753149814880517e-01   +5.724759470211469e-01   +4.488417565305615e-01   +7.198815634177914e-02   +3.145290188719204e-01   +1.471150249977338e-01   +4.674933049378523e-01   +9.327544975366329e-02   +2.223420619001772e-01   +5.596833103439554e-01   +4.522733739644499e-01; +7.777969356399682e-01   +8.452494438980802e-02   +4.953590743993275e-01   +8.549209802635048e-01   +6.853330837984826e-01   +4.306970094328902e-01   +4.732766423700970e-01   +6.445053463611367e-01   +2.332482252303519e-01   +2.386546683273281e-01   +5.116872900618031e-01   +2.983569522745113e-01   +9.568289738570198e-01   +6.280253835174660e-01   +1.362394402051465e-02   +7.013917699038577e-01; -7.653846161524929e-03   +7.511187180824535e-01   +6.791665623701946e-01   +2.127673706614686e-01   +5.632831912847083e-01   +6.974488064865817e-01   +1.177923505515037e-01   +4.952586963100301e-01   +1.353381221181188e-01   +2.563094095372129e-02   +4.151111763271909e-02   +4.785140307508260e-01   +2.260378979823486e-01   +5.032831895587383e-01   +3.656711328368649e-01   +5.902605453961378e-01; +2.271123954539040e-01   +2.990008142454255e-01   -7.792454841069003e-02   +3.751674208610000e-01   +3.509186894546626e-01   +4.478496408729299e-01   +1.634906228688683e-03   +2.273840839950369e-01   +2.298990045897554e-01   +1.814663819058376e-03   +9.523340084307387e-02   +7.763020048350983e-01   +3.163238954476880e-01   +1.433800629733585e-01   +8.202454604106194e-01   +9.178755782583171e-01; +4.332479405221752e-01   +1.239542174039189e-01   +9.084683583719939e-02   +1.241448745072486e-01   +3.437379928101079e-02   +6.882243894836767e-01   +2.229910510697893e-01   +7.567095559330402e-01   +3.745490608977657e-01   +8.933077485093767e-01   +7.153234900225708e-01   +8.236088074388532e-01   +7.036930282847853e-01   +3.240181946556616e-01   +1.164305433374845e-01   +3.262634319336392e-01; +7.696538024516473e-01   +3.171980712931721e-02   -2.146975543734339e-02   +7.117184095194697e-02   +5.783311055158726e-01   +5.797970073569890e-01   +8.162883081688040e-01   +1.137709752509201e-01   +3.034938789699101e-01   +9.296528486636086e-01   +7.665607688665610e-02   +4.254791830340902e-01   +5.139935173150437e-01   +4.298194905094303e-01   +2.485929020868581e-01   +2.589768801488700e-01; +3.508684283275444e-01   +1.845298370780551e-01   +7.494506315768489e-01   +1.000000000000000e+00   +2.572395423761140e-01   +3.648894991707419e-01   +2.545593827743552e-01   +7.961602534509927e-01   +4.111397443328631e-01   +3.623248648716013e-01   +1.132863378003072e-01   +9.414736029400103e-01   +6.837812695301700e-01   +3.119967160644522e-01   +9.242383431244086e-02   +6.800079325167558e-01; +8.741397400108174e-02   +7.237093971373600e-01   +5.179756348007513e-01   +1.396214638574264e-01   +8.264028650373388e-01   +3.483094499205178e-01   +4.452304913320788e-01   +5.213444232543069e-01   +9.405842691458612e-02   +9.567884857616024e-01   +2.314453459714999e-02   +8.933088209915104e-01   +2.198000192633872e-01   +2.184467767788049e-01   +3.241436668331606e-01   +3.558281524562869e-01; +1.972477573465875e-01   +4.324358522978954e-01   +5.925778851102057e-03   +1.107067454396812e-01   +6.923779096301390e-01   +9.082518685202884e-02   +5.431341889409516e-01   +8.268388952925869e-01   +2.790986096912124e-01   +7.663898803769992e-01   +2.514530542966806e-01   +8.621692369849457e-01   +3.492342088727838e-01   +4.519542278731938e-01   +3.180093821644465e-01   +9.091391039025329e-01; +6.975215682778533e-01   +7.156664148734471e-01   +7.596665484844181e-01   +6.478580763488401e-01   +7.385568051346844e-01   +6.090635295735987e-01   +4.442302140935975e-02   +1.248789013402894e-01   +4.508097237195420e-01   +7.094364994980250e-02   +6.563873966381979e-01   +6.005072535410991e-01   +1.268303971405134e-01   +9.455925939774620e-01   -1.105816798246839e-01   +6.407530701516316e-01; +1.608211932143243e-01   +5.903956584374148e-01   +5.963271432041390e-01   +7.886893714149168e-01   +1.192982349615498e-01   +3.113395778528115e-01   +4.642529523687464e-01   +4.795616870918046e-01   +9.086895242691565e-01   +3.469378905774725e-01   +6.272370250699402e-01   +9.773791939065797e-01   +3.559891483405503e-01   +8.228780434179701e-01   +7.514249270126085e-01   +5.457117884367702e-01; +3.178846095632011e-02   +4.864092322120819e-01   -3.734684346044413e-03   +4.303118973537876e-01   +1.709263446527799e-01   +7.964404907962940e-01   +6.614989830365221e-01   +5.201860549463839e-01   +4.527433431960712e-01   +6.998293374496178e-01   +3.413131936326955e-01   +6.080280282238178e-02   +2.779551971527842e-01   +1.571340052556137e-01   +3.107491903828120e-01   +8.888784610311161e-01; +9.052411540893437e-01   -5.599682399567749e-02   +5.351279028441390e-01   +4.980229000892764e-01   +5.081640322528520e-01   +1.341056097364749e-01   +4.124010057119830e-01   +2.495110957199182e-01   +6.451126137000737e-01   +1.239744636188390e-01   +4.160439637487598e-01   +6.245588051645170e-01   +5.344638195219112e-01   +9.399796535962723e-01   +1.078591111156963e-01   +1.712219047955238e-01; +1.413754709544552e-01   +6.132914498747820e-01   +6.039584365306631e-02   +1.939122898794829e-01   +6.151788040429477e-01   +3.562107383554987e-01   +9.319726573248088e-01   +8.715679325339686e-01   +7.336199207835913e-01   +8.891931929033453e-01   +7.378923200204368e-01   +5.166926294827588e-01   +3.489822338539765e-01   +7.489499577688948e-02   +3.321922551778155e-01   +3.553422983226311e-01; +3.917857300402395e-01   +1.162383977192602e-01   +5.570709051509913e-01   +5.250541381041227e-02   +4.722129262943005e-01   +7.775552241956759e-01   +4.617058904516651e-01   +1.007890402928206e-01   +7.914191318955799e-01   +7.845226450298588e-01   +5.721960449542688e-01   +7.127698890257567e-01   +8.019540205010767e-01   +3.099939893417932e-01   +3.854255860334024e-02   -2.687944737481256e-02];
L2I_L1I_iGABA_netcon = [+9.128027754761010e-02   +6.214265680680428e-01   +8.413974359809241e-01   -1.539145022364924e-02   +6.669090098730985e-01   +3.392104290388292e-01   +7.548279673577107e-01   +7.094154014865390e-01; +1.280661267118020e-02   +2.884923383987971e-01   +4.451189968930641e-01   +2.825755059477484e-01   +8.704608985338126e-01   +1.512081061395584e-01   +6.711329938109227e-01   +8.887718387257859e-01; +6.050840927777221e-02   +7.241120116025951e-01   +5.231552143565990e-01   +6.178241014224389e-01   +6.117698082105876e-01   +5.971814849448375e-01   +3.607037905510062e-01   +2.502915519481437e-01; +6.412685174116814e-01   +4.525894605841077e-01   +5.374640972969750e-01   +8.281768078747326e-01   +2.522159369055009e-01   +5.632015081019717e-02   +3.558457919752036e-01   +5.124534594319684e-02; +8.756695726905320e-01   +7.667470246244756e-02   +4.011506250101693e-01   +8.037141495971831e-02   +7.840971037083508e-01   +2.317097376018887e-01   +1.000000000000000e+00   +2.456319435796951e-01; +6.024363106674356e-01   +5.717230626399211e-01   +7.589844499869409e-01   +7.699512264369863e-01   +8.457286691611255e-01   +7.771283644426550e-01   +3.338664738359567e-01   +6.174757352903992e-01; +9.392077811337419e-01   +2.438640124192451e-01   +4.282251176558056e-01   +1.706999186437622e-01   +5.446059594446400e-01   +4.747101840599731e-01   +7.698174521063988e-02   +6.587652280577768e-01; +6.899194416757258e-01   +3.650034086821773e-01   +1.324160697037630e-01   +7.918647538293461e-01   +8.196756650279674e-01   +8.563188432430062e-01   +7.302144142295240e-01   +4.372851418797211e-01; +6.763157248446112e-02   +6.592912178464733e-01   -3.274466660532607e-02   +3.163939590230668e-01   +3.654177003265135e-01   +6.478447831966360e-01   +7.516692442093098e-01   +1.985374294922921e-01; +7.517131432885864e-01   +9.040154050885956e-01   +3.684101376506682e-01   +7.889859895492705e-01   +2.239902416978545e-01   +5.848712164003696e-02   +5.448335476890819e-01   +2.972825499195511e-01; +2.828279915237969e-01   +1.026688173486211e-01   +7.196474765133614e-01   +5.681848088816860e-01   +6.522764123321795e-02   +8.347762079512250e-02   +5.611537956029733e-01   +1.441530365278675e-01; +1.140679991497148e-01   +2.936449236665684e-01   +3.909640843030028e-01   +6.513142512807089e-01   +3.069759299560616e-01   +4.316299211171098e-01   +4.329367418517290e-01   +4.913047057607867e-02; +7.837372293183312e-01   +8.470749258111777e-01   +2.714577610598343e-01   +6.515370739986264e-01   +3.474764107724669e-01   +5.891379573249197e-02   +2.209321552817957e-02   +7.756250418848938e-01; +3.265147915711856e-01   +9.122762598140017e-01   +2.543522556687762e-03   +1.983529778010292e-01   +5.543927293181193e-01   +7.568880191844424e-01   +5.681359038740788e-01   +7.392612062900923e-01; +5.167652120889924e-01   +4.171401636399877e-01   +4.321003400783430e-01   +2.666457541607703e-01   +5.888311709860828e-01   +2.509628287100103e-01   +8.944629044210016e-02   +4.356592676457166e-01; +4.191516584738580e-02   +2.702265229491178e-01   +2.545981503481372e-01   +1.179017181818775e-01   +7.422236344343106e-01   +7.433277966367559e-01   +4.207063224981426e-01   +2.177244859919735e-01];
L1I_L2I_iGABA_netcon = [+1.266527021262399e-01   +8.054496760201794e-01   +2.292945273417923e-01   +2.985210185580950e-01   +8.898322413479312e-01   +8.371781905027040e-01   -1.167409558874818e-02   +2.300979472954395e-01   +3.458436937768352e-03   +8.637303292171608e-01   +6.327283794325554e-01   +2.510523846576493e-01   -8.838271281510302e-02   +4.495351514702548e-01   +4.719829026322580e-02   +7.576262221443673e-01; +9.415050287682567e-01   +6.398906048770320e-01   +5.563643604874416e-01   +5.081821311412140e-01   +1.125916511869545e-01   +3.286403831816075e-01   +7.141211086140977e-01   +2.250850720129136e-02   +4.465546146954154e-01   +2.654589285278874e-01   +3.414520167347793e-01   +1.911921801192156e-01   +7.261444498027301e-01   +7.135515593001887e-01   +1.000000000000000e+00   +1.661099456011254e-01; +4.757245656302954e-01   +5.495664346552381e-01   +9.892784775919656e-01   +6.656504803482520e-01   +2.690401540048261e-01   +3.702194130124721e-03   +6.493632473548410e-01   +4.402427282673352e-01   -5.009939692181378e-02   +6.283635529494523e-01   +1.394126538685533e-01   +5.086253690987150e-01   +9.339748346439876e-01   +6.178076931602321e-01   +2.189752187884804e-01   +3.249465751578382e-01; +7.880770342923440e-01   +4.990719927053467e-01   +4.408478057287992e-01   +3.660344718963018e-01   +8.777064612542074e-01   +5.931682223984071e-01   +5.704398215886367e-01   +1.163507708623745e-01   +4.524219456126511e-01   +3.987592754069046e-01   +4.508659191887298e-01   +4.477326089387985e-01   +3.923226380192016e-01   -1.096175345945688e-01   +4.378923754060678e-02   +5.420225789004478e-01; +8.211115063974208e-01   +5.079679747095610e-01   +3.329003104648877e-02   +8.910690592038130e-01   +6.175265522253894e-01   +3.792831699058244e-01   +7.412731591824606e-01   +2.540389906919078e-01   +8.139735312786756e-01   +4.688895569649497e-01   +6.953030503407926e-01   +8.109238603219713e-01   +9.277623800203343e-01   +2.235778582522081e-02   +6.176335513523022e-01   +6.782611661168365e-01; +3.889053033484181e-01   +2.624177248365029e-01   +8.223262436655396e-01   +1.438413806753848e-01   +2.037936149925298e-01   +6.539434924528920e-01   +6.424545458470825e-01   +7.771895760983409e-01   +5.079908826052953e-01   +5.137394407284657e-01   +9.583096108684468e-01   +7.484752995560463e-01   +5.608211363530001e-01   +1.191085860727734e-01   +3.801921677470690e-01   +9.842095859469885e-01; +4.750680182556170e-01   +1.386167447442870e-01   +1.177708031891248e-01   +9.198708901972608e-01   +5.818120240175234e-01   +6.684229421534076e-01   +2.878148149410976e-01   +4.407391485294940e-01   +1.328056131063835e-01   +2.107181385975548e-01   +4.576823531302886e-01   +1.465848692792870e-01   +6.524773262005181e-01   +4.484378395429583e-01   +6.496828498195060e-01   +6.928590824492872e-02; +5.885961293076163e-01   +6.981290663409221e-01   +9.064927002526577e-01   +4.230272695127815e-01   +7.013599380201081e-01   +1.613829295261848e-01   +7.624222308286442e-02   +6.892124215670290e-01   +6.747026790041707e-01   +3.712042244877116e-01   +3.126902290658250e-01   +6.654068686233581e-01   +3.642928196738149e-01   +7.846848298032381e-01   +2.505789755384673e-01   +4.869186906472086e-01];
L2E_L1E_iAMPA_netcon = [+1.816037406619989e-01   +4.928886773855531e-01   +7.883084301123959e-01   +6.730855522879265e-01   +5.364396270702338e-01   +6.833080821458871e-01   +7.625985710139691e-01   +7.946510933597785e-02; +2.296419043666828e-01   +2.324355770169891e-01   +2.831658123485585e-01   +2.627813956269719e-01   +4.956628220596615e-01   +5.993122744913097e-01   +7.944609905091350e-01   +2.736768438008994e-01; +2.582560443827476e-01   +8.725934878398438e-02   +9.196488290495636e-01   +6.043214007997262e-01   +3.128724511005088e-01   +4.823971904535725e-01   -3.082722741462993e-02   +5.203457072330477e-01; +1.860510774869737e-01   +2.063705478978137e-01   +9.183264984662767e-01   +1.683210703616334e-01   +4.221777135298408e-01   +8.869532587142913e-01   +4.054148486184606e-01   +5.330218055856185e-01; +7.874205739990575e-01   +5.134967303853621e-02   +6.650948029891285e-01   +9.523348111273893e-01   +2.325740605368548e-01   +6.922238738265187e-01   +7.361013793030413e-01   +7.690522913551180e-01; +7.830920793546796e-01   +4.872857946372479e-01   +7.431554195438578e-01   +5.455006983798644e-01   +1.484019126707385e-01   +8.477230586974467e-01   +6.082892766719235e-01   +1.000000000000000e+00; +8.747116833730106e-01   +8.796599543052509e-01   +8.771050298926526e-01   +1.226900372937589e-01   +1.581336920497716e-01   -3.074545670015547e-02   +9.262156071161732e-01   +7.351147343077107e-01; +5.966824056522352e-01   +9.555929081387282e-01   +6.751010520900539e-01   +5.732246718147962e-01   +6.119175991706121e-01   +6.967916589823767e-01   +7.115298269254354e-01   +7.269872083114752e-01; +8.690695274935567e-02   +2.768195787600088e-01   +6.916168438656352e-01   +6.245583396586563e-01   -9.490234404042822e-02   +6.775499626519358e-01   +6.478235593590381e-01   +9.712777138506902e-01; +2.542950480703109e-01   +2.763489306718666e-01   +5.394228917980193e-01   +1.385943636721681e-01   +7.704706587448454e-01   +2.435187093995981e-01   +5.177173486766572e-01   +7.758886131309224e-01; +8.257663589026949e-01   +9.046296394620973e-01   +3.654260513229234e-01   +7.710372772521282e-02   +1.952316602779058e-01   +7.837342021932738e-01   +1.114966018767054e-02   -4.541084565102980e-02; -3.113914461880984e-02   +4.850114856066671e-01   +7.739268387709505e-01   +2.851013571323077e-01   +2.673220400450665e-01   -5.725123315163394e-02   +7.697526949560516e-01   +6.783476110272769e-01; +3.167400719051291e-01   +9.024839522700155e-01   +9.865782337962167e-01   +1.153176965522087e-01   +3.806914297643164e-01   +2.708383091836934e-01   -3.435538015698402e-02   +9.143566422022538e-01; +2.255126713015820e-01   +1.231905112192306e-01   +4.760716503001969e-01   +9.344514803139929e-01   +8.315157357501964e-01   +7.863955810292418e-01   +1.940223942452740e-01   +1.524085001712719e-01; +5.937879172963119e-01   +8.316679373762880e-01   +3.506405330515521e-01   +7.358991717364960e-01   +7.459049831546601e-01   +4.806196201153244e-01   +6.737561057351622e-01   +7.301137674163405e-01; +5.021144320713326e-01   +6.659923937874873e-01   +7.031669726203905e-02   +5.582025280946991e-01   +1.411422107342508e-01   +4.974065100454798e-01   +4.163291338225128e-01   +4.446140670395026e-01];
L1E_L2E_iAMPA_netcon = [+7.495316989032301e-01   +4.899531177214419e-01   -2.066671216474684e-02   +4.887429964326776e-01   +7.864876761066848e-01   +2.406508708754595e-01   +3.734624509157800e-01   +8.701716952295144e-01   +5.012054172501604e-02   +2.074420164054016e-01   +3.992930670956665e-01   +8.405739750565888e-01   +5.473729489451162e-02   +1.823340393924082e-01   +7.954816008791832e-01   +3.247539157801161e-01; +4.548806640946688e-02   +2.529038135810717e-01   +6.236442554336850e-01   +8.822433488491371e-02   +2.853749930163694e-01   +1.920335620848242e-02   +4.564146106926381e-01   +2.926362387959284e-01   +5.997296875633931e-01   +1.000000000000000e+00   +5.351817149695417e-01   +2.199412368848100e-01   +8.932177115455781e-01   +8.474137153854108e-01   +7.275838729848877e-01   +5.633489625048009e-01; +2.616122014428276e-01   +7.536029555591014e-01   +1.558576735592039e-01   +1.028969355590244e-01   +5.115346906681965e-01   +1.631659990419846e-01   +8.874300526397776e-01   +8.182470611192763e-01   +6.154517942260562e-01   +6.123429646120924e-01   +6.364477971625156e-01   +3.047005652903642e-01   +5.858920575662881e-01   +3.441430665381562e-01   +8.888514415496997e-02   +4.444043838368831e-01; +7.297818009231485e-01   +1.961658033815354e-01   +5.489588479048831e-01   +1.291499175673837e-01   +4.911921588036994e-01   +3.859548363992045e-01   -7.660805381905125e-02   +3.157030978027110e-02   +8.075189127951722e-01   +1.087583914044153e-01   +4.126567032267304e-01   +2.540192138934029e-01   +5.158281139301920e-01   +8.245870315392850e-01   +4.726534150552035e-01   +5.777468985490120e-01; +3.914124187182897e-01   +2.884313126460420e-01   +3.256252224472667e-01   +2.930831535730916e-01   +4.017041839500433e-01   +6.298620524338477e-01   +3.100429370365093e-01   +5.695855664133712e-01   +1.855993839568629e-01   +5.056417259836633e-01   +4.615485752190908e-01   +1.714461337499299e-02   +4.069016828582642e-03   +8.444887897831813e-01   +7.340107563540632e-02   +6.843785874944357e-01; +8.739319339676852e-01   +1.628183283100914e-01   +1.078146815787784e-01   +6.870683535647294e-01   +1.501230359720637e-01   +2.603452006186801e-01   +6.907155779097479e-01   +1.049555148356746e-01   +3.787777607644859e-01   +2.920244855170906e-01   +3.939361635179323e-01   +8.681814846197077e-01   -1.223181830438676e-01   +2.737590655351797e-01   +3.887762146997485e-01   +7.159714911003202e-01; +3.588232682927592e-01   +1.760497978447973e-01   +2.513683443247001e-01   +1.487931204932658e-01   +9.083909071652103e-01   +5.657152650200061e-01   +8.247022819501947e-02   +4.912672522464498e-01   +4.364396588711571e-01   +6.576779258261966e-01   +5.839724728969919e-01   +2.256012773285821e-01   +4.814937156256229e-01   +3.490697863234989e-01   +6.015646946705357e-01   +1.577255493676149e-01; +4.049743140939532e-01   +5.392152937427685e-02   +7.040000217420501e-01   +1.043483057994656e-01   +6.006911512854934e-01   +1.160206214187405e-01   +2.467500600596042e-01   +1.374991219541451e-01   +8.397918570488146e-02   +7.452424913842091e-01   +5.654507325353118e-01   +2.031992059074737e-01   +8.164333981114266e-01   +5.843602107717453e-01   +2.830028586132430e-01   +1.623000598935799e-01];
L2I_L2E_iAMPA_netcon = [+4.329347268827702e-01   +7.991608442640651e-01   +2.037777387570692e-01   +5.412142238616368e-01   +7.777405664404963e-01   +7.909565036621572e-01   +5.980734890209950e-01   +3.790417281794093e-01; +9.175504290204345e-01   -1.802378664239830e-02   +5.868950045606827e-01   +2.089305379007798e-01   +6.713963214468408e-01   +4.183138985504472e-01   +2.340795901223899e-01   +8.225526893019013e-01; +1.000000000000000e+00   +2.930650189757370e-01   +7.351040152319757e-01   +6.265749228543155e-01   +1.599483437258476e-01   +6.916173283783706e-01   +1.339020495498109e-01   +5.762567265748110e-01; +3.357464276976945e-01   +7.852093446749522e-01   +3.981694676543416e-01   +3.041631799296304e-01   +4.447262207911556e-01   +8.799251748868443e-02   +2.680332412147326e-02   +5.578660246646383e-01; +3.090131353187569e-01   +4.138495424875238e-01   +4.722633222995443e-01   -8.578448150986240e-03   +7.491581265071787e-01   +2.816289452373651e-01   +1.648441248991566e-01   +6.154562793435212e-01; +2.784641301784280e-01   +2.014762214924278e-01   +5.970784179401514e-01   -2.197598073700788e-02   +5.824391499360604e-01   +6.984326635170147e-01   -2.155562085012625e-02   +5.097528889502358e-01; +1.150401477570764e-01   +1.564414627603209e-01   +5.296563844028300e-01   +4.160195479501402e-01   +1.161579381666936e-01   +2.539583573839354e-02   +2.502472885234314e-01   +5.179603960242255e-01; +4.516530195723216e-01   +5.112680757224379e-01   +6.789232115479686e-02   +6.955870085348784e-01   +2.000024579280504e-01   +7.331900875950985e-01   +3.776908524733577e-01   +5.734155905269384e-01];
L2E_L2I_iGABA_netcon = [+5.534402764864994e-02   +4.471707299402950e-01   +1.106514730650097e-01   +6.964516490689456e-01   +3.106636930793100e-01   +8.485190167063028e-01   +6.094175757827668e-01   +1.843212301319161e-01; +5.346635225305105e-01   +7.611282920823312e-01   +2.144949284162761e-01   +5.788234962556434e-01   +6.057745874885700e-01   +5.158013853133062e-01   +1.288440368468659e-01   +8.359097370010276e-01; +3.536038410252755e-01   +1.335655468389040e-01   +6.378489287604188e-01   +5.784682157089606e-01   +2.181593460851706e-01   +2.710321796681038e-01   +9.991516739983815e-02   +7.553873595101622e-01; +5.924668138604206e-02   +8.518987536535038e-01   -3.490846707830887e-03   +7.331113564647527e-01   +2.699631509794811e-01   +6.023537469794260e-01   +7.587976632699371e-01   +7.714746778675237e-01; +4.629421453952187e-01   +4.561328125509820e-01   +2.103487027949510e-01   +2.781199459960654e-01   +5.951196158402101e-02   +6.731088026789787e-01   +1.496025114296935e-01   +1.011782477330176e-01; +7.874171975330830e-01   +8.046178317184870e-01   +8.130910626045559e-01   +1.000000000000000e+00   +6.613102940924468e-01   +6.240430717884069e-01   +2.899455825742576e-01   +5.904803786436531e-01; +5.204734991419085e-02   +4.050084038876033e-01   +1.773505077810466e-01   -6.024018386224268e-03   +2.796076400165082e-01   +3.642402317141859e-02   +1.237642409230943e-01   +7.717115385791369e-01; -5.979538372726974e-03   +8.579536206722095e-01   +7.771429766790326e-01   -1.378955276834746e-03   +3.002584568286376e-01   +6.551749001720230e-01   +4.183183145706178e-01   +7.280277980962910e-01];
L3E_L2E_iAMPA_netcon = [+3.703334047165860e-01   +6.093143304603288e-01   +7.429555431433575e-01   +2.122168575787317e-01   +1.331159177740628e-01   +9.009683084534671e-01   +8.750190077171132e-01   +8.327479607510287e-01   +5.636581445360744e-01   +1.778964919214018e-01   +3.604227581678633e-01   +9.123430994339291e-02; +3.991722641670618e-02   +1.000000000000000e+00   +2.180920057911975e-01   +2.159373638632669e-01   +4.509200847548199e-01   -9.611418121243168e-02   +5.803317876841236e-01   +2.002220730055360e-01   +4.363205749501436e-01   +5.549541420140507e-01   +1.344986778137984e-01   +7.565476176968559e-02; +3.286194909669125e-01   +1.086694384860765e-01   +2.194241520666845e-01   +6.284482774526915e-01   +5.882100538051509e-01   +8.492372740744250e-01   +6.057737449781166e-01   +7.972463882206572e-01   +8.241555823202742e-02   +8.265759220779827e-01   +4.666092534529931e-01   +8.335324277860897e-01; +8.412940183659184e-01   +5.118640086834664e-01   +6.829850201508629e-01   +7.026854208053248e-01   +5.085810695072204e-01   +8.559855982781068e-01   +3.520511510242945e-01   +4.054254952131825e-01   +5.928928735017827e-01   -5.796713408536316e-02   +3.816838257394269e-01   +6.755333405186180e-01; +7.391747969157892e-01   +2.733237603551327e-01   +5.522128952942610e-01   +6.794336553154514e-01   +2.456329057255332e-01   +5.138619069291528e-01   +3.597199730137183e-01   +7.819708420693133e-01   +8.113973532350413e-01   +3.253289146806892e-01   +5.990019530982938e-01   +3.078318679142707e-01; +3.979427151634582e-01   +3.969704191726857e-01   +4.556365417363503e-01   +5.651615738266056e-02   +1.657446212425676e-01   +4.364437578458978e-01   +3.838282279686923e-01   +6.166575371003292e-01   +4.068322754358158e-01   +6.046070131334880e-01   +6.523458397098757e-01   -8.301320875585685e-02; -1.834869544228055e-02   +8.545056137023738e-02   +1.856858277856407e-01   +3.699652877341070e-01   +8.439873757401398e-01   +8.970510461003807e-01   +5.571828616154583e-01   +1.647997787684493e-01   +5.911724804812285e-01   +4.285427235633220e-01   +3.153485759035237e-01   +2.150278052477849e-01; +3.216623486669247e-01   -1.004621435317408e-01   +6.728907887918715e-01   +7.692340950299739e-01   +6.645410555246097e-01   +7.568107022411136e-01   +7.308181786077104e-01   +2.034732439993633e-01   +6.586987365337093e-01   +2.608759225052319e-01   +1.027971453615394e-01   +4.900638255871946e-01];
L3I_L2I_iGABA_netcon = [+6.862047393525382e-01   +3.966511033915388e-02   +4.902258195108679e-01   +6.559752518141289e-01   +3.251353798000174e-01   +4.022338573336144e-02   +1.642654682488484e-01   +2.127107036651527e-01   +3.623817031776038e-01   -6.461716941634205e-02   +2.482014538890842e-01   +9.361804889557446e-01; +8.795559081487607e-01   -8.655565141485005e-02   -1.839626600353431e-02   +5.496016361021712e-01   +9.188436283220427e-01   +4.416333342819448e-01   +5.201667125006501e-01   +3.764330260927243e-01   +2.232860331444146e-01   +6.938131670876050e-01   +1.610231275485233e-01   +3.424171199379653e-01; +9.005345563657753e-01   +2.467635520776356e-01   +8.105340931108145e-01   +1.885630517259949e-02   +6.375808633569626e-01   +2.005850344954981e-01   +5.397245569336226e-01   +1.006735073599897e-01   +3.723458050780782e-01   +6.216196838430936e-01   +4.185638234926095e-01   +8.922669040926626e-01; +5.598842786357109e-01   +1.890418315592614e-01   +9.494576598053387e-01   +9.195740924328338e-01   +7.663305330220589e-01   +7.729442963610009e-02   +7.223572608615860e-01   +1.491059527575198e-01   +7.436229208235863e-01   +7.447018721503890e-02   +2.245590135201543e-01   +6.071906477099777e-01; +1.727205302399455e-01   +2.630633371002906e-01   +4.642918136658838e-01   +2.970394585716465e-01   +5.709446070940379e-01   +8.184701331585811e-01   +3.972631645192652e-01   +1.720318573424245e-01   -5.485416645336617e-03   +2.239515303046139e-01   +9.528489371822958e-01   +1.201468855770319e-01; +1.000000000000000e+00   +3.622048088976458e-01   +5.850673307292429e-01   +8.014886682863657e-01   +5.735112459381354e-01   +3.560456665695385e-01   +4.863702334483894e-01   +8.985096725075747e-02   +4.276548714268869e-01   +1.647948606717309e-01   +2.770807739856816e-01   +3.650555170669605e-01; +7.567531223549480e-01   +6.977677984229095e-01   +6.988155269091173e-01   +5.955685122839955e-01   +1.950333325935298e-01   +6.146584728915144e-01   +4.102074050391200e-01   +6.362199844531183e-01   +1.304129231554004e-01   +8.806062542303068e-01   +4.234903793315257e-01   +8.306449588382281e-01; +7.202083686657353e-02   +2.308641729589589e-01   +6.308681130597776e-01   +6.444720217962084e-01   +1.989190276090384e-01   +2.467121845682437e-01   +1.298199422138129e-01   +1.101833917879000e-01   +6.379551671227276e-01   +4.922792640039522e-01   +4.110156072887394e-01   +1.762385150297387e-01];
L2E_L3E_iAMPA_netcon = [+3.868966414056257e-01   +8.338788513534112e-01   +4.657964366358205e-01   +7.659291177431879e-01   +3.715245239290327e-01   +1.564133266877357e-02   -1.874080853212746e-02   +4.804877119335669e-01; +5.620713178822865e-01   +3.378463064316560e-01   +7.743130059336180e-01   +1.240235681857400e-01   -1.639041593214198e-03   +3.303045550486896e-01   +7.798223034943753e-01   +6.203247098367213e-01; +8.378058379824911e-02   +2.744414809547883e-01   +1.000000000000000e+00   +8.687206545660597e-01   +6.417280759070352e-01   +2.874654962810374e-01   +3.645639044629705e-01   +6.441135286370424e-01; +2.784257442007511e-01   +3.781808892079308e-01   +2.281842547065283e-01   +5.246900670262703e-01   +2.318405206147496e-01   +6.653499116117215e-01   +6.898452640065839e-01   +2.244956721999415e-01; +3.452423861621502e-01   +6.779518257244667e-01   +5.744908196873342e-01   +8.495613671083919e-01   +6.806786237781083e-01   +1.816284556640034e-01   +1.010125439005349e-01   +9.093186936039094e-01; +8.770025072282962e-01   +7.881579677428275e-01   +3.115119554668426e-01   +1.456823545495814e-01   +4.010249165884674e-01   +7.498124815117899e-01   +5.988996926797923e-01   +6.993887547225860e-01; +6.288347650494246e-02   +3.112764028084770e-01   +3.290702609631032e-01   -2.090865042542689e-02   +2.056803911069303e-01   +2.828323438033750e-01   +2.788771627679011e-01   +2.001279436513183e-01; +7.734223452827199e-01   +3.705337864297556e-02   +8.335666409005777e-01   +1.898416519216929e-01   +3.027331543786664e-01   +3.547344938164008e-01   +1.328392563679282e-01   +4.547795531401175e-02; +4.376829506510077e-01   +6.036489389612297e-01   +5.739099499655809e-01   -7.234006713604781e-02   +2.174989469105117e-01   +1.250223417593354e-01   +5.912027197842888e-01   +5.863816370614496e-01; +4.277907683007879e-01   +6.732258414278990e-01   +1.261572076718559e-01   +4.920456746822116e-01   +7.412424208204536e-01   +4.269909608149080e-01   +7.619062407885497e-01   +4.092844684497088e-01; +5.062645989309351e-01   +1.873854220084639e-01   +6.461825901567976e-01   +3.140687161300228e-01   -6.999005577049694e-02   +8.118749812297243e-02   +7.864238779567246e-01   +5.958253963895774e-01; +6.433797920210657e-01   +3.360699741295674e-01   +5.638375945863843e-01   +8.332776141551553e-01   +5.462266668005943e-01   +8.020695514908649e-01   +2.500867191011068e-01   +5.141936822301585e-01];
L2I_L3I_iGABA_netcon = [+3.606288554502735e-01   +4.319677397847984e-01   +9.550405596657571e-01   +2.708691019630450e-01   +2.089957399143750e-01   +3.947227079346802e-01   -6.231583623450686e-02   +4.725918609848472e-01; +3.159409869248704e-01   -2.371844401818591e-02   +7.139047474314132e-01   +6.812957652099670e-01   +3.865439762211423e-01   +4.627670735835272e-01   +7.969809137547988e-01   +3.442009506092222e-01; +4.459073477349830e-01   +8.521530875421147e-01   +9.794181454911167e-02   +3.386726066193170e-01   +1.628122678568892e-01   +8.077257341742193e-01   +5.337176031715301e-01   +3.424331463918029e-01; +4.416916293278918e-01   +3.830927068945775e-01   -7.113034416913373e-03   +3.637624744413078e-01   +7.808424292994203e-01   +3.954357925840210e-01   +3.347813256848960e-01   +8.885165096383291e-02; +8.946148138288011e-01   +3.805838599616175e-01   +7.952313717154628e-01   +6.333027445056312e-01   +2.193212539881265e-01   +5.714539130089120e-01   +1.059698950193086e-01   +2.196538007271136e-01; -5.774256644078223e-02   +2.121100661723315e-01   +5.318471199754302e-01   +8.035082399449375e-01   +8.526605657901817e-01   +8.365618959778506e-01   +7.960510504577227e-01   +1.861451443561922e-01; +3.454403997599440e-01   +2.673495407814870e-01   +3.889544785794646e-01   +5.242225746969544e-01   +4.083454110419650e-01   +8.303763030168293e-01   +8.567507078035577e-01   +9.828954591217424e-01; +4.622795670018841e-01   +7.501007140061805e-01   +2.847235874352405e-01   +3.369317802680336e-01   +7.389229416738215e-02   +2.552838240659252e-01   +1.746031724582855e-01   +3.111052982317938e-01; +1.122345771346769e-01   +3.221375607232826e-01   +4.148430516970233e-02   -3.110823542853325e-02   +6.574487603779476e-01   +2.537317211036197e-01   +2.383573832385148e-01   +1.487725407925221e-01; +1.548676075409799e-01   -1.837300678683426e-02   +5.716171735141463e-01   +6.571317025267888e-01   +7.831116319305854e-01   +6.802083057324567e-01   +1.000000000000000e+00   +1.841189326816287e-01; +4.774731988939867e-01   +2.772223545164478e-01   +7.542393559660797e-01   +1.419055572106302e-01   +7.492075421266698e-01   +3.305205399980381e-01   +8.331623439800540e-01   +3.874710470341768e-01; +9.179124943758465e-01   +3.052390512113056e-01   +3.575375623009648e-01   +1.543797142029564e-01   +7.038291690726374e-01   +7.829605710021698e-01   +3.306406392686799e-01   +9.900727816787137e-02];
L3I_L3E_iAMPA_netcon = [+5.328289474585907e-01   +7.485076844200682e-02   +4.599384690667481e-01   +9.438858249849480e-01   +9.482733300079248e-01   +2.327465315005387e-01   +3.436836307340774e-01   +2.481999532433712e-01   -1.144891200860886e-02   +9.839253492400010e-02   +3.490669499170653e-01   -5.642861624881600e-02; +4.353823406848431e-01   +6.804520336577846e-01   +5.157497129249207e-01   +4.745258825805562e-01   +2.104276690484725e-01   -1.373862071654155e-02   +4.246874477062044e-01   +1.734872253606248e-01   +3.416317202699681e-02   +7.338658092378515e-01   +3.778118554603481e-01   +7.944986660356688e-01; -2.534574888851025e-02   +9.368401493545663e-01   +5.686959220252671e-01   +3.347873035885521e-01   +7.025339899249659e-01   +3.699949605700129e-01   +2.345734190215814e-01   +3.373561301256982e-01   +2.947027928200890e-01   +1.047036112032241e-01   +8.179011409794248e-01   +2.144367081269170e-01; +7.423324605438568e-01   +3.927140702756233e-02   +7.137112757154508e-01   +1.973928390797063e-01   +8.901300222082266e-01   +3.101148231882233e-01   +1.378192170628419e-01   +4.228765617119114e-01   +4.115765382727505e-01   +5.077199817462252e-01   +4.960866448025297e-01   +2.443061402589201e-01; -1.582798500478074e-02   +8.166148368680654e-01   -6.831143435228604e-03   +3.261928066474369e-01   +7.300663224180871e-01   +3.417384541793632e-01   +1.641612681932627e-01   +1.828816265539842e-01   +7.970553003411405e-01   +1.566973356003131e-01   +5.596706538511989e-01   +1.685904616235717e-01; +2.539948965493809e-01   +3.379176046658688e-01   +8.894996235956358e-01   +3.778256995038852e-01   +2.129185172428359e-01   +4.228767903764715e-01   +1.934909719493179e-01   +4.094954448198405e-01   +5.756004331474570e-01   -6.559762589889198e-03   +2.548156742078966e-01   +9.320085722054465e-01; +4.820500383523888e-02   +8.127287601772447e-01   +1.888547062023785e-01   +6.764729661727168e-01   +5.102004897094834e-01   +5.825951677448515e-01   +6.872339117997481e-01   +2.335004600196497e-01   +6.251934566395415e-01   +8.508349709257017e-01   +2.717814329917284e-01   +7.764040748458892e-01; +8.482526321257498e-02   +6.012672505405586e-01   +7.818623197703800e-01   +4.305928669326450e-01   +9.220867569201149e-01   +6.989508186390754e-02   +8.784233914328164e-01   +2.945111942034076e-01   +8.767739316397947e-01   +7.954748593617076e-01   +8.134863362059668e-01   +5.123660221648790e-01; +8.834749891502054e-01   +1.905786196114066e-01   -4.678581435479736e-02   +6.576041116479988e-01   +1.000000000000000e+00   +2.249302101407976e-02   +6.974630735417738e-02   +4.441878127952643e-01   +5.021167559200125e-01   +9.243163934743612e-01   +6.156963618345309e-01   +2.909524191802833e-01; +8.016138029239182e-01   +5.497158343323286e-01   +4.441184045037001e-01   +4.023357910761827e-01   +2.932506177056425e-01   +1.525912537112059e-01   +9.331465481894222e-01   +5.538598156299648e-01   +4.868958863486082e-01   +1.923269204067113e-01   +1.445091753907597e-01   +6.356312109118191e-01; +1.313157464619255e-01   +5.534077772450435e-01   +2.728074405078976e-01   +4.693515385449173e-01   +6.924877835187320e-01   +3.712055730263698e-01   +6.651304763738599e-01   +8.032183996320266e-01   +3.675400121794173e-01   +7.506114736259601e-01   +9.439254178148450e-02   +8.375968931104369e-01; +5.851710312113891e-01   +1.486763109629774e-02   +4.285302783091601e-01   +9.364746069357827e-01   +7.682242321741529e-01   +3.063415904702652e-01   +2.371827103074598e-01   +6.284662789678557e-01   +7.063722943672455e-01   +8.084449286105977e-01   +2.361747973769520e-01   +5.855673008927982e-01];
L3E_L3I_iGABA_netcon = [+1.027755507899854e-01   +7.088463196921679e-01   +3.896727741990407e-01   +6.484387394706832e-01   +6.998244905891743e-01   +5.858614001638669e-01   +7.469597427302482e-01   +7.782073264274414e-01   +7.382886398896391e-01   +2.029057068256780e-01   +4.660454582215089e-01   +3.876296403780952e-01; +5.963991364062566e-01   +6.529393131356483e-01   +5.756944983479046e-01   +7.423487518803361e-01   +2.548417930633275e-01   +2.750085851924371e-01   +7.383773345683537e-01   +7.178274360875524e-01   +8.230868235242177e-01   +6.169411818029087e-01   +4.039651751032921e-01   +2.478494482115774e-01; +3.461534593811011e-01   +8.846299559011623e-01   +2.686364395421404e-01   +8.783080812316573e-01   +2.669051835541356e-01   +4.843169107997436e-01   -1.283682332100089e-02   +3.057132144598517e-01   +1.908865641074987e-01   +3.991253277951896e-01   +4.641621518774314e-02   +7.480252411546960e-02; +3.534307437850934e-01   +7.306099593497302e-03   +7.436210847257780e-01   +5.938179451509241e-02   +1.082307885969323e-01   +1.369612620880860e-01   +9.129387899248376e-01   +4.046872704430992e-01   +4.574990744349118e-01   +3.824292748760977e-01   +2.796672047337323e-01   +2.457306772153379e-01; +8.195216131024724e-01   +6.123611447407116e-01   +7.775127476984944e-01   +3.087852413377741e-01   +5.659229687016490e-01   +6.143320398060642e-01   +5.745536651298958e-01   +7.499658816915581e-01   +3.295239652708926e-01   +8.447427916472573e-01   +5.863418736403295e-01   +3.205762101955034e-01; +8.748076520237223e-01   +8.235486657292340e-01   +3.648375495726282e-01   +5.512360085576651e-01   +2.850581797126883e-01   +7.182046830890978e-01   +2.211916898690838e-01   +5.909896150204834e-01   +3.106849443286545e-01   +6.605425493657615e-01   +1.450878693745234e-01   +1.412750934198310e-01; +5.903371607009851e-01   +4.869092226880397e-01   +2.083413410975442e-02   +8.720832960030136e-01   +3.728558057883463e-01   +4.281114794620604e-01   +5.652728882643189e-01   +2.572777243199606e-01   +3.834754485429007e-01   +2.585926575782175e-01   +1.000000000000000e+00   +7.384178689206214e-01; +6.183008481532568e-01   +3.627802590566883e-01   +4.157879243344262e-01   +7.527769504168518e-01   +7.885702077254181e-01   +3.229314205413785e-01   +2.645290421877251e-01   +5.213400855723267e-01   +3.065703529124852e-01   +5.835927886087651e-01   +3.280856390806064e-01   +5.062093616572166e-01; +1.852531425350089e-01   +4.304078426037217e-01   +6.470799096955426e-01   +7.895490626009724e-01   +7.153267545245078e-02   +6.853721003769517e-01   +4.484164621740210e-02   +5.316888807131193e-01   +4.730549991800950e-02   +6.876551782374608e-02   +9.604651087296729e-01   +2.452710365492631e-01; +3.261986111883234e-01   +3.918071987434180e-01   +2.352628101275233e-01   +2.975644032758774e-01   +1.970019959710227e-01   +5.178847816385206e-01   -5.273422370309851e-02   +8.034135630407295e-01   +2.701298958159560e-01   +4.026219712595020e-01   +2.211528526275625e-02   +1.838182447174777e-01; +7.632522121624786e-01   +2.251210119935779e-01   +8.635811598831908e-01   +2.058381867114928e-01   -1.655039953775962e-04   +1.958904715963189e-01   +5.187456285229037e-01   +2.992381382916811e-01   +2.132477026611757e-01   +5.904468090572890e-02   +6.805983559507565e-01   +7.039734004424675e-01; +1.102618491784247e-01   +3.629706917614384e-01   +7.757761890046624e-01   +1.495193447855167e-01   +2.392605484677263e-01   +3.761843988738614e-01   +7.199775589010996e-01   +6.988912305992564e-01   +1.444692398185808e-01   +3.459495110869481e-01   +2.493346083776352e-01   +5.258854620918813e-01];
L2E_Input1_iAMPA_netcon = [+9.006887632999498e-01   +1.000000000000000e+00   +8.966336035368596e-01   +9.187951662970391e-01   +8.537372630586966e-01   +8.952223876214004e-01   +7.978156684558398e-01   +9.086869497817432e-01];
L2I_Input2_iAMPA_netcon = [+8.205937234374754e-01   +9.592527658344703e-01   +8.102100695039399e-01   +1.000000000000000e+00   +7.674900648385333e-01   +8.914254331437843e-01   +8.960581641372019e-01   +9.800212026236439e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
