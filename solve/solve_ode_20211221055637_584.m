function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.831867343101347e-01   -3.823882922657368e-01   +2.602137129964427e-01   -2.351422401834908e-01   +8.691303887048142e-02   -4.098085666626680e-01   -1.511004895149587e-01   +3.427537397681148e-01   +6.212811698365137e-01   -2.709362796785750e-01   +1.707075279109839e-01   -5.008384400361416e-02   -2.449403989597033e-01   +4.426316438272430e-01   -4.696330151617205e-01   -2.117828117388913e-01; -2.245321915617871e-01   -2.795293934372946e-01   -4.246457699038502e-01   -4.208121519265711e-01   -7.708630906442447e-02   -4.862311340961572e-01   +5.472616164999802e-02   +8.749861298108809e-02   +3.435955054908741e-01   -3.165725570300475e-01   +2.498778727905515e-02   +3.667221998164892e-01   +1.039022913666767e-01   -6.300820313376916e-02   -2.695275164485892e-01   -1.116772528958370e-01; -1.955437293035360e-01   -7.090920579496420e-01   +1.049875101308462e-01   +8.488626264612732e-01   +1.719091361466363e-02   -3.261362596167812e-02   +2.207735831499671e-01   -1.053841022168805e-01   -2.145061881119975e-01   +1.106837583309246e-01   +3.783220525232191e-01   -2.172366817468900e-01   -7.220647813095830e-01   -8.871794744822724e-02   -2.661000079366087e-01   -5.350579023549522e-01; -5.217126083333449e-01   +3.588058269679906e-02   -5.368835065915809e-01   -3.235604356724351e-01   -1.784728342950123e-01   -8.510758653548915e-03   +4.594677453955326e-02   -4.987439335895296e-01   +7.343891320118342e-01   -2.337987446082068e-01   -3.678204620952093e-02   +3.919309447320795e-01   -3.026920249463552e-01   -4.264991748126145e-02   -1.384889658255203e-01   -5.080592935411014e-01; -4.779153989896466e-02   +3.802270968811409e-01   +7.871394025400098e-01   +3.251862291639609e-01   -2.048019194406600e-01   -6.490689702056653e-01   -2.417546198523027e-02   -2.348183744951083e-01   -4.194594216220008e-01   +2.580236034557449e-01   +1.357231825258860e-01   -3.104494563296407e-01   -4.384393952086325e-01   -6.277259393739836e-01   +3.425561747545292e-01   +8.218655618051477e-01; -9.178631980252754e-02   -3.468307541158187e-01   -4.613203504874090e-01   +1.517578271341596e-01   +7.144545816315229e-01   +2.149025201718104e-01   -3.762011505023103e-01   -3.998239061252922e-01   +1.335729709883685e-01   +9.932468567408945e-04   +3.331517179325587e-01   -3.892573699951574e-01   -1.930144794413147e-02   +2.191379126804655e-01   +1.740560475433041e-01   +5.995907896264472e-01; +5.253491290677588e-01   +4.262316761878184e-01   +1.972840344047911e-01   +2.583104650206021e-02   +9.764941799891384e-02   -3.612995023440832e-01   +4.704811413611814e-01   +3.621942796094124e-01   +1.482977016295420e-02   -2.840565481489851e-01   +8.304768916765267e-01   +4.002645358666765e-01   +3.649895729295187e-01   -6.678320453571798e-01   -2.099762443439156e-01   -2.214708290132497e-01; -2.520057904921245e-01   -3.411742789917722e-01   +4.504909151716882e-01   -3.100405264357960e-01   -4.276621882463029e-01   -4.202972152952654e-01   +8.668142289473207e-02   -5.603418778007307e-02   -3.900744411710897e-02   +1.302568693252023e-01   -3.526709086986129e-01   +3.807817048051717e-01   +2.268878777581744e-02   +1.739171456420510e-01   -3.045653568967661e-01   +5.791544566134561e-02; -9.849345433071585e-02   -1.307290162567620e-01   -3.602267943058180e-01   +3.854530130139997e-01   -2.125841728173354e-01   +2.676678727417371e-01   +6.966931370733779e-01   +4.085551774180937e-01   -4.445895102420884e-02   +6.984351238645925e-01   -5.859763792548347e-02   +3.306518866416338e-01   +1.168231040888107e-01   -6.431382938279555e-01   -1.684972435009258e-01   +2.374032880922065e-01; -1.479372981692442e-01   +5.357542117102700e-01   -1.670059230622025e-01   +7.911956038063074e-02   +4.026328205979124e-01   +2.001092724786936e-01   -2.709325403224381e-02   -3.556855156605189e-01   -1.514284175280525e-02   +4.885277964314610e-01   +1.587526964820331e-01   +5.666292658535519e-01   -3.296290992279932e-02   -1.138974815535931e-01   -8.631420392152185e-02   +5.590580632898278e-01; +2.786649679464072e-01   +5.952631411898466e-03   +4.212383329376937e-01   -5.579761294320640e-01   -1.645763554121570e-02   +1.039200200115550e-01   +9.150311320296645e-02   -6.714455496785973e-01   -1.146781980530203e-01   -3.220776470727535e-03   +1.640199117680032e-01   -1.954727148147736e-01   +1.574123543218007e-01   +1.091903538674859e-01   -9.206448577810497e-02   +6.323540076515565e-01; +6.464967835998023e-02   -8.808583941781586e-01   +9.462408494660716e-02   +1.307525555764210e-01   -4.135952674499112e-01   -3.313760228690140e-01   +1.981897287577895e-01   -3.872541557291693e-01   +3.433550746364959e-01   +5.462943808678648e-02   -6.403678575168573e-01   +5.800675169461069e-01   +2.514996624457915e-01   -1.698065320385824e-01   -4.108728081781771e-01   -1.152899886652444e-01; -6.574425626205320e-02   +1.218819293745816e-01   +1.634281784365894e-01   -5.622900937159808e-02   +4.743168521660785e-01   -2.395430684471162e-01   +3.846263252967674e-01   +7.150476358169152e-01   +4.009538493233290e-01   -1.924107692544248e-01   -1.679039413149978e-01   +8.503712881684381e-01   +5.546974191899701e-01   -5.130718330303246e-01   +9.050704543179154e-02   -1.471289158800626e-01; +3.583069273116966e-01   +3.935678488529618e-02   -5.030866221765178e-01   -2.170137472375906e-01   -2.026215808165728e-01   -1.972574279642942e-01   -7.090361265895507e-01   +2.659670092998788e-01   +1.087718187401036e-01   +9.009847989070591e-01   -1.522235589836270e-01   -2.179053621328447e-01   -5.426336094076656e-02   +4.963494137645199e-01   +5.615625292623932e-02   +1.495823261138386e-01; +1.268042511023581e-01   +1.471560629444154e-02   -1.597391228073842e-01   -2.868790973703145e-01   +4.773563464027230e-01   -6.521545192083214e-02   -3.787503813248669e-01   +1.005043683139405e-01   +5.742380890675394e-01   -7.397239418548925e-02   +7.458616876863612e-01   -1.556716630347939e-01   +1.000000000000000e+00   -3.297717375725596e-02   -3.353199450563939e-01   -6.526245128814291e-01; -3.284532372864845e-01   +2.021098077673244e-01   +2.146089527841236e-01   +2.032032737741526e-01   -2.336710126432320e-01   -2.920489442054048e-02   -2.714617523670562e-01   +4.767092585386806e-01   +4.476346803535081e-01   +5.861010130543930e-02   -1.622078884443303e-01   -3.261195270903219e-02   -2.915679292840386e-01   -5.394274160535774e-01   -1.040157548614322e-03   +2.521737185509808e-02];
L1E_L1I_iGABA_netcon = [-2.555766851908325e-01   +2.265636810828601e-01   +2.536546089614251e-01   -6.567389357807053e-02   -4.182575447943055e-01   +5.839599482449519e-01   -2.248440829188666e-01   +7.238273589925414e-01   -7.117113513435273e-02   +3.113889564391558e-01   +1.820583750449482e-01   +3.085766819293888e-01   -1.561950517675759e-01   -5.759407420161686e-02   +1.680826837758270e-02   +1.676972167315411e-01; -3.155311149094375e-02   -8.997425454231505e-01   -7.452484441417763e-01   -4.318488202043037e-01   +2.838920603815717e-01   -2.859614725486012e-01   -7.067947155264473e-01   +6.322616387701478e-01   +4.104546454335239e-01   -1.473573111044395e-01   -6.320382644872520e-02   +4.967996144458970e-01   +4.238187418652024e-01   +3.269866763560259e-01   +2.846811156211726e-01   +2.717813409415070e-01; +5.671557181288278e-01   -3.024753141347816e-01   -3.514613720086804e-01   -3.117812315421766e-01   -3.636369870774868e-01   -3.679378645491954e-01   +3.077131839969923e-01   +4.662536634427414e-01   -1.984048386959766e-02   -5.607153872553953e-01   +4.950794042534390e-01   -1.341607590062010e-03   +8.895827669229799e-02   -8.899917261924258e-02   +1.671200820076779e-01   -3.236366420816165e-01; +3.781503266463549e-01   +8.754678145431134e-01   +3.595468014088223e-01   +4.363160049653099e-01   +7.267586283726273e-03   -6.995871986701781e-02   +3.795137255905719e-02   +6.936955987127471e-01   +5.336317990167012e-01   +1.773589524935912e-01   -4.711865700106820e-01   +2.194942587388662e-01   +3.643640877427871e-01   +8.692070959748154e-02   -2.205824065065273e-02   -2.518649420238830e-01; +4.194324143083860e-01   +6.816605092839124e-01   -5.884251937735004e-01   -3.995519724756594e-02   +6.969312051052350e-02   -5.541399712647694e-01   +7.058546750222390e-01   -6.473492747541955e-04   -4.186528064790166e-01   -4.968705417714561e-01   -3.318767889240316e-01   +5.090925073009626e-01   +5.756269755639331e-01   -2.146051359864839e-01   -4.527932437625133e-01   +5.493968038106909e-01; -3.815485525089271e-02   +3.639859611293282e-01   +2.813220058247669e-01   -1.818071146110593e-01   +2.578068543780009e-02   -1.111585694656729e-01   +1.692869269902341e-01   -8.096249049025671e-01   -1.081211871676945e-01   +4.987195756198617e-01   -4.636851854702689e-01   +9.964043831613953e-02   +5.917794949236573e-01   -4.051524345310157e-01   -3.478216040527912e-01   +5.633443290293135e-01; +5.378614447512520e-02   +4.220483796750885e-01   +2.947942805016583e-01   -8.636602248002131e-01   +6.537697975575359e-01   +2.255866617150768e-01   +2.198828244204731e-01   +1.657440726775247e-01   -3.406203816938092e-01   +1.564983222336850e-01   -9.870618425917459e-02   +2.269504871155874e-01   +7.215787753672491e-01   -3.444027529752376e-01   +1.239979979428678e-01   +3.575608340933194e-01; -1.000000000000000e+00   -1.060481014970780e-01   +2.033771531207920e-01   -3.182301134312359e-01   -9.513386769725207e-02   +7.705363618784398e-01   +2.613096908357574e-01   +6.277859686206845e-02   -4.676858340360708e-01   +5.159949567877840e-01   -4.359961789825503e-01   -1.515023420572129e-01   -4.745480993416279e-01   +4.158839142972016e-03   -6.538482181779635e-02   +7.900589746376628e-02; +3.724262320004433e-01   -1.683127563298545e-01   -4.805529522215877e-01   -3.949937928127746e-01   +4.367255561558458e-02   -1.905799803798980e-01   -1.672983226396187e-02   +1.438642417794710e-01   +3.627714550362928e-01   +8.811106802698822e-02   -1.198025805364788e-01   +1.147707788939182e-01   +5.063535095583145e-01   +5.698685173532607e-01   -7.011491587272348e-01   -4.525947522768881e-01; -1.421391827113682e-01   +6.312323319753763e-01   +2.646480780634769e-01   -4.303299121247086e-01   -6.512014040182258e-02   -3.336749191433785e-01   +8.756334830395985e-01   +3.686192099391378e-01   +3.547415481538631e-01   -4.815554550144647e-01   -1.639706448898830e-01   +6.281871743309875e-01   -9.927610239204082e-03   -4.698999378916375e-01   +4.142575151877503e-01   -3.591354446932475e-01; +3.887127352987932e-01   +4.832266280648014e-01   -3.482648982430617e-02   -7.832065007652310e-02   -5.482552407282203e-01   +2.212453322642489e-01   +2.745303471854295e-01   -3.809200099654030e-01   +6.016600937241073e-01   -4.169192514760017e-01   -2.615717024267292e-01   -1.929247397723570e-01   -1.864080654427500e-01   -8.012192424243879e-02   -5.279381174051586e-01   -5.034396309872327e-01; -4.635763718948372e-01   -2.333689011008140e-01   -3.502111341001846e-01   +6.173670257011132e-01   +3.336926844001476e-01   -9.637937508367448e-01   +3.617890194050917e-01   -9.148345110265750e-02   -3.011416589111180e-01   -4.096100487451054e-01   -5.578698052324239e-01   -2.939540845399626e-01   -8.052921628722786e-01   +4.872862798378059e-01   +1.349746949889450e-01   -1.138361592463498e-01; +3.769614114174541e-01   +7.602260907937233e-01   +5.049271501983813e-01   -7.278410987707293e-01   +2.773832795321652e-01   -6.052880104874672e-01   +5.158281458298559e-01   -5.369650964427751e-01   +1.435305071740965e-01   -2.249065629458412e-01   +2.727922285644414e-01   +5.297184321312660e-01   +4.345842660148713e-01   -1.138797555826100e-01   +1.018109880248340e-01   +4.183713517524359e-02; -4.810711496805928e-02   -8.171155520654858e-01   -3.105705593508733e-01   +2.786371082893147e-01   +4.094187571241020e-01   -3.499285953370534e-01   -2.878342930497383e-01   +4.476780392453873e-01   +2.199231654341879e-01   +4.125385874266583e-01   -1.650111761942762e-01   -2.935507733289685e-01   +2.165243459690444e-01   -4.827551278013753e-01   -7.205598365417281e-01   +4.716868739360316e-01; -3.537951550027102e-01   +3.298054205172795e-01   +5.072009983165229e-01   +3.763466404865143e-01   +3.157193983948080e-01   +2.266207659295217e-01   +3.988956835488700e-01   -2.616568900242712e-01   +1.317135827831185e-01   +1.874015649910161e-01   -8.573204086339170e-01   -6.382062146285400e-02   +6.885300246400574e-01   +3.026864645079279e-01   -5.910556667380898e-01   -3.466650943248563e-01; +5.608463712751550e-01   +1.587262083426532e-01   -9.233390983984080e-02   -6.763100688585569e-01   +2.819129156061599e-01   +5.662859911957295e-01   -2.838064018640711e-01   -1.596405548809690e-02   +6.221017274617152e-01   -1.026083778992850e-01   -1.756791174591637e-01   +9.389361816755255e-02   +3.421490957224344e-01   +5.704415244848933e-01   +3.631100258757446e-01   +5.602623640466570e-01];
L2I_L1I_iGABA_netcon = [+2.437502427164603e-01   +5.076505846197160e-02   -1.801809830384026e-01   -1.684406974854943e-01   +3.329215819617595e-01   +7.424571753001745e-02   -1.356952209209134e-02   +7.227401314023896e-01; +2.609593577721085e-01   -2.128427449845656e-01   +3.790701408359222e-01   -6.854864535454258e-01   +3.939445415119531e-01   -1.756029767721473e-01   +4.148637217242760e-01   -3.984369726858982e-01; +6.917814421731667e-01   +3.928862750502580e-02   +5.124034183261348e-01   -1.195096932534984e-02   +6.570967014072127e-02   -1.319890653789009e-01   -5.389521519307827e-01   -6.728447182913684e-01; -9.464684885081420e-01   -6.648022618328873e-01   -1.230045864920988e-01   -3.181859368017355e-01   -6.636269912427846e-01   -2.495916780797410e-01   +1.485428239309139e-01   -1.844963368945783e-01; -4.479085200804332e-01   -4.204651141774986e-02   -1.510217076109527e-01   +4.557136536717147e-01   -2.877766039924255e-01   -3.431777495839508e-01   -4.486632619622966e-01   -2.894807805021496e-01; -2.135619362045404e-01   +2.870756241755792e-01   -1.581516015247838e-01   -4.199590382696777e-01   -1.530731146051037e-01   +5.589898146245460e-01   +1.965817724070930e-01   -2.728702442545064e-02; +3.760679120072346e-01   +1.460114550757221e-01   -3.754028469249024e-01   -3.335703996682310e-01   +3.739949238091300e-01   +1.838186410199189e-03   +2.852392956664174e-01   +2.802971805109521e-01; +4.605462662000570e-01   -3.356973624754716e-01   -3.588781454869670e-01   +4.005928009881768e-01   +4.178750937103768e-01   +6.948632228861158e-01   +2.744244553814010e-01   -2.025718844549900e-01; +1.905164203289513e-01   +4.848049044277478e-01   -9.257259045022018e-02   -3.762911233824821e-01   +5.514227357661401e-02   +1.737074336043661e-01   +3.091413774197975e-01   -4.102831652652430e-01; +1.000000000000000e+00   -2.385967344744346e-01   +1.713356456717480e-01   +3.200777288484802e-01   -2.364192634868720e-01   +1.132698689791151e-01   +9.452902731925972e-02   -5.753524463703691e-01; +6.019081475578730e-01   -4.640434031302553e-01   +2.692215457211687e-01   -1.012719293646687e-01   +4.618196799113607e-01   +1.222896806944034e-02   +2.022508729389563e-02   -7.742104376078683e-01; -4.201116486041172e-02   -2.324006599135634e-01   +1.145526805315046e-01   -4.648717131561025e-02   -8.625334081504220e-02   +2.088116884611046e-01   -2.364762003608835e-01   +3.035403486084036e-01; -4.057609846150250e-01   +1.785818772657601e-01   +3.298218737716206e-01   -1.795588081280649e-01   +3.367643557339357e-01   -4.845344942487330e-01   -2.604345936005009e-01   -2.416852572802375e-01; -3.553987307523421e-01   +3.596302969009329e-01   +5.270158822383286e-01   -1.693946107867535e-02   +3.218742288401721e-01   +1.572022828920504e-01   +1.473222521032606e-01   -2.713051997630514e-02; -9.787925283507935e-03   -5.422356153810327e-01   +5.494321623378602e-01   -2.410456072271868e-01   +3.421353739559091e-01   -3.701175201565559e-01   +6.101870649264756e-01   -2.175801193642819e-01; -4.943865109550968e-02   +8.262395538957854e-01   -2.379278762050820e-01   +3.162487840512251e-01   +4.653899078759245e-01   +3.873079613081492e-01   +1.643896202310028e-01   +4.266908338544610e-01];
L1I_L2I_iGABA_netcon = [-1.098729267741064e-01   -9.315071773071235e-02   +5.097851642785657e-01   +3.349936686243475e-01   -1.017697031332186e-01   +3.610959751103472e-02   +7.798966478244429e-01   -8.309024543106438e-03   +5.929100690836319e-01   +3.482201360502927e-01   -9.251345980489446e-02   +3.422931956712543e-01   -4.108001852152865e-01   -2.534776364533797e-01   +4.194380855980492e-03   +6.793375403940235e-01; +2.241938574568618e-01   +3.682913343969730e-01   -8.146522282423554e-01   -9.073069400542934e-02   -3.043170501800113e-01   -3.814096782807888e-01   +4.760332469653972e-01   -5.234931097689168e-01   +2.620412148210364e-01   -1.748502218720677e-02   +3.494674698996791e-01   +6.385210945984361e-01   +1.286289568956667e-01   -3.176949171704259e-01   -1.806572514959563e-01   +2.482814452615504e-01; +1.793512530977955e-01   +5.019438324245221e-01   +1.769629649023127e-01   +6.291313458591397e-01   +4.121874126624815e-01   -4.752420816296777e-01   +2.892697103611853e-01   +3.076881492878178e-01   -4.300535528312261e-01   +8.746090765922453e-02   -8.568777846423645e-02   -4.313306610200812e-01   +3.544972250829443e-01   +3.430084496544755e-01   -1.920333594992997e-01   -1.422696270675484e-01; +2.946511920838286e-01   +2.986263734235841e-01   +5.145290248174516e-02   +9.044329292304984e-02   -2.733989774634536e-01   -1.506406582323124e-01   +4.089097644101655e-01   +3.953543839227179e-01   +3.634250385094520e-01   +3.755556032923744e-01   +8.810906693179307e-02   -2.636110953515089e-01   -1.546945904119559e-01   -2.859536855649992e-01   +7.519859747219033e-02   -7.195045107340862e-01; +2.858452987638431e-02   -2.976415402874177e-01   -1.427949300178480e-01   -1.896910593186596e-01   +2.492666269954229e-01   +2.044692798207899e-01   -1.241204883536646e-02   +1.349979322354163e-01   -3.518606241993422e-01   +1.056885568882904e-01   +4.875461219030034e-01   +5.117989029438028e-01   -4.117362517326787e-01   -1.477061173929717e-01   -3.981130705983328e-01   +6.006978153947565e-02; +3.647352289799992e-01   -2.894442144518024e-01   -1.477715940136796e-01   +5.851698251929635e-01   +5.157471978021275e-02   -1.529898861388858e-01   -8.792163919387463e-02   +1.987104585918456e-01   +6.111470782306930e-01   -2.650928364275924e-01   -5.447068714650470e-02   -4.570058915005414e-02   -4.770040131881418e-01   +1.345486899961909e-01   +1.375842542419768e-01   -2.251015639258557e-01; -2.274959016966636e-01   -3.831096562731372e-01   +1.138630071795483e-02   +2.650081668457351e-01   -2.506395261011462e-01   +8.102360188429918e-01   -1.011622200092404e-02   -1.000000000000000e+00   +4.277342383183506e-01   +5.700602387997158e-02   -5.051291209495782e-01   -7.585228649682518e-01   +3.434204770762680e-01   +5.348002627089161e-01   +2.295502822518599e-02   +2.400745825848480e-01; -9.561203704758146e-02   +4.111752062011849e-01   +1.358493076440267e-01   -6.128425459818865e-01   +5.638881850297257e-01   +6.612463498160771e-02   +7.176744991759650e-02   +3.338574842729605e-01   +5.142930716085999e-01   +4.037814124700534e-01   -4.146733942225430e-01   +2.590377872616066e-02   +3.735165634658878e-02   -4.033935632243965e-01   +8.283612318044686e-01   +1.432040068510884e-01];
L2E_L1E_iAMPA_netcon = [-1.802886953742726e-01   -1.565486143924685e-02   +9.308765803659079e-02   +8.872265099562451e-02   -2.871122714323396e-01   +1.852478047484418e-01   +3.829204986895821e-01   -3.985535937293430e-01; +6.611639664258550e-01   +3.602869147773792e-01   +2.598369790338533e-01   -7.025488016271769e-01   -1.037867239852163e-01   +9.310233939788957e-01   +2.072771189785795e-01   +6.444961173793815e-01; +5.090832934014786e-02   -8.186518085844698e-01   -7.921352461702910e-01   -2.887084507140623e-01   -7.222474094054151e-01   -3.490643089867095e-01   -9.345039431175716e-01   -4.192606788295326e-01; +1.783056513714860e-01   -1.307739623449556e-03   +4.667080242092945e-01   +4.039966955919373e-01   -8.162400144676567e-01   -6.369423837020429e-01   +4.698382171827635e-01   +3.879532895326830e-01; -6.756598001064212e-01   +4.864586973920846e-01   +1.128831931248505e-01   +4.165345392656349e-01   -2.824955377902281e-01   -7.112983680753686e-01   -3.826144232839778e-01   +2.469232502721731e-01; -8.246061661398691e-01   -5.622360501791681e-01   -2.150189437781707e-01   +3.881818929990937e-01   -3.733878480400453e-01   -7.618036600900270e-01   -2.339479605836356e-01   -5.217794965016963e-01; +5.780331014687371e-01   +7.259232416840035e-02   -8.291452823611757e-01   +2.948010035474352e-01   -8.013882894125048e-02   +5.707112382021342e-01   -4.185966377058600e-01   -2.624812309463323e-01; +2.367828312452711e-01   +1.412214958978353e-01   -3.813161132872709e-01   +2.581199696185913e-02   -2.719503342091437e-01   +3.360215219086866e-01   +7.600295210649272e-01   +5.561944876364829e-02; +6.837983483185515e-01   +2.198625451105275e-01   -8.085776571727239e-02   -3.848714322481316e-01   +6.035466266390405e-01   +2.097538760803490e-01   +4.134623036503999e-01   +7.158275791199842e-01; +1.734741551534147e-02   -9.382832948498596e-03   +5.154435287934039e-01   +1.157926240371187e-01   -2.509850747720879e-01   -2.696014728869301e-01   -1.194599823199384e-02   +3.368378300063137e-01; +3.543622479681099e-01   -7.404830567190166e-01   -2.956731918898964e-01   +2.784750687925073e-01   -1.067929766600475e-01   -9.776023582576499e-03   -1.121852959312912e-01   -2.942880976646407e-01; +5.832130466327308e-01   -2.075309860294891e-01   +4.524660543101669e-01   -5.397815027308224e-02   -4.986574774870335e-01   -6.004045183141777e-01   +8.545490055893902e-02   -5.684877681986028e-01; +1.944230435201154e-01   -1.600159260840941e-01   -1.045296510250825e-01   +2.677836678959288e-01   +1.549648334414428e-01   -4.791176164225926e-01   -2.633062126851855e-01   +3.865491093808431e-01; +4.391106407870503e-01   -5.326678326861418e-03   +2.291365789343976e-01   +7.064742271983902e-02   -6.983245422957719e-02   -9.510377519464468e-01   +5.312988284193207e-01   -2.560754184825437e-02; -1.000000000000000e+00   +3.608578676085976e-01   +6.901631190537261e-01   +5.052956160952888e-01   -2.615337258240522e-01   -3.812093846703937e-01   +5.432992942954109e-02   -2.037977146651542e-02; -7.203992631561550e-01   +2.822446261135926e-01   -4.574904311163308e-01   +2.229472961524386e-01   +1.763794955011894e-01   +1.011562335552696e-01   +8.893759290173860e-01   -3.722306729188810e-01];
L1E_L2E_iAMPA_netcon = [+6.573588058168981e-01   +1.000000000000000e+00   +3.060066397272821e-01   -2.399744096062936e-01   -2.020907940191890e-02   -4.416270724937327e-02   -3.289402208381335e-01   +3.211076905348262e-01   -6.133421014137896e-01   -2.184162134837468e-01   +3.275721428527319e-01   -1.068919100721782e-01   +4.901708452844792e-01   +7.967761558996610e-03   -5.469261996424346e-01   +2.778123215823546e-01; +2.525999916164337e-01   +2.131330727689429e-01   +4.052501156194500e-01   +1.873577007583199e-01   +1.980050613710563e-01   -7.696823408192951e-01   -3.396425818270752e-01   -1.490254883712715e-01   +6.486981197636369e-01   -4.476227537115226e-01   -4.312640633350268e-01   -5.329154546990604e-01   +5.937338690779690e-01   +3.356017859369786e-01   -1.382491041987593e-01   +8.316779160417808e-01; -7.596019931832093e-01   -1.290441909022304e-01   +5.733181271941379e-01   +3.477646587864989e-01   -5.073537542738239e-01   -5.287527166068178e-01   -2.664660936912405e-01   -3.343042851324242e-01   -7.277110695320638e-01   -1.143789387265068e-01   +2.808855613730458e-01   -6.100593253470329e-02   -2.413090954646824e-01   +1.505059124724353e-01   +1.906841457961695e-01   -7.022206380671951e-01; +1.274286849360899e-01   -3.629103532833109e-02   +9.131786569730055e-02   -4.152537158890162e-01   -5.212345956526379e-02   +1.987019447270332e-01   -1.054255443674409e-01   +1.940436228730360e-01   +3.359474671602302e-01   +6.205338747396040e-02   +8.090556980982827e-01   -7.543783300154493e-03   -1.295652745149666e-01   -6.997675231608770e-01   +1.171764576577265e-02   +5.144630030966020e-01; -4.468785054375227e-02   -2.237832123384144e-02   -4.828695793137442e-01   +4.413512334456007e-01   +7.706237320451317e-01   +2.542948184132063e-01   -3.018699362335812e-01   +1.415979953253503e-01   -1.441016664452891e-01   +2.666567428733989e-01   +2.566163855280441e-01   -2.918907257505290e-02   +1.311451510857157e-01   +8.885807751100720e-02   +1.744528077348317e-01   +1.738277653900002e-01; +3.068985581800059e-01   -1.219280336329381e-01   -5.778228257360820e-01   +2.921701265519414e-01   +4.768016208444985e-02   +8.254040753502408e-02   +8.521435032528122e-01   -1.994732913868138e-01   +3.768754043351912e-01   -3.831247935711747e-01   -5.046072127293310e-01   +2.141514510111820e-01   -2.950670868538248e-01   +4.074037924363530e-01   -7.877716792058065e-02   -2.699948654974099e-01; +4.388000485779618e-01   -3.954399162593725e-01   -6.619993280656821e-01   +7.696218335490596e-01   -5.818089232612917e-01   -6.561741201917158e-01   +2.683072896177249e-01   +1.088598564609696e-01   +2.014040031337268e-01   +1.113803413562059e-01   +1.230117617731506e-01   -5.294873535676616e-01   +3.215188869360618e-01   +3.694140206480626e-01   +2.353487814193481e-02   +5.632732176012779e-02; -9.849697565624436e-02   -1.863729559845326e-02   -1.558584362914230e-01   -1.392186146465129e-01   -3.229666358298198e-02   +4.864054513828570e-01   -1.224374555595868e-01   -7.975069794995830e-01   +1.683555342580398e-01   -5.153869722178262e-02   +1.388143887492023e-01   -1.448773257978630e-01   -5.560682874866467e-01   +1.436944852047911e-01   +1.800004340494860e-01   +6.495459829644046e-02];
L2I_L2E_iAMPA_netcon = [-6.955373739229348e-01   +2.245402120750269e-01   +6.982163592017375e-01   -4.753869155724827e-01   +4.312988267337934e-01   +7.859814042393605e-01   -5.973945203446924e-02   +3.663253676626348e-01; -1.112932320055497e-01   -5.546138404927001e-02   +2.208706664124230e-01   +6.174897200483154e-01   +4.448898924645438e-02   +3.102216224568607e-01   -4.391835379136853e-01   +4.550918517267966e-01; -6.895975326269081e-01   +4.091569020614554e-02   +2.185006739376642e-01   +1.909020394271342e-01   +7.228529887428532e-02   -4.585114624807836e-01   -1.245157560048089e-01   +6.047474142146029e-01; +5.228793016506486e-01   +6.404072821933264e-01   +2.674746576425023e-01   -1.913020713544849e-01   +4.105616196247482e-01   +1.300045489721000e-01   +1.716279570715188e-01   -4.205350603421973e-01; +7.493236446484963e-02   +3.112641162554660e-01   +7.990807699455285e-01   +6.899204876960710e-02   +1.493868229089007e-01   -4.402872764644129e-01   -9.064204955791938e-02   +7.457165945409606e-01; +5.165985595953249e-01   -4.867392341430249e-01   -5.340137275416985e-01   -2.032449483522600e-01   -4.363386156721262e-01   +2.207551867741210e-01   +2.559816665195241e-02   +2.631565301430944e-01; +7.618301415070983e-01   +3.931575398029823e-01   -5.827965800787803e-01   -5.937051522671868e-01   -2.746708624483153e-01   +4.408318714741754e-01   +4.341305626059895e-01   -7.247185816632387e-01; -2.519504979653013e-01   +1.000000000000000e+00   +6.023004040136276e-01   -2.914032437165788e-01   -2.381122786592331e-01   +8.226557483900532e-01   -4.580019013417541e-01   -5.104114057402348e-01];
L2E_L2I_iGABA_netcon = [+4.695620355021430e-01   -2.341390381763011e-02   -1.955001388193157e-01   +8.472330901077900e-01   -4.347405855447980e-01   -4.190906803035604e-02   +1.000000000000000e+00   +1.796593445831946e-01; +3.829710408686267e-01   +3.682719557685163e-01   +2.798518781533610e-01   +3.359641907800288e-02   +1.067070531375163e-01   +6.823601185658698e-02   -2.269320328910531e-01   +5.936699717559415e-01; +2.815478935404352e-01   -2.984555270408795e-01   +1.987265374212999e-01   +5.125826145034037e-01   +5.551983763649073e-01   +1.930146224697307e-01   -2.904266993659842e-02   +3.463069359791574e-01; +3.246408615232085e-01   -1.464293473552774e-01   -3.222210526303924e-01   -4.725093564480182e-01   -3.151886733393138e-01   -3.820434143741331e-01   -3.637504191230415e-01   +1.706281410211356e-01; +3.112360568856161e-01   -4.397565429195803e-01   +5.217079327873122e-01   +1.469153056258723e-01   -1.853891076004281e-01   -5.945165515754242e-01   -2.401107385181151e-01   +7.336028829726483e-02; +1.238948899116904e-01   -7.034065051403635e-01   -4.061767093527647e-01   -5.941344400613920e-01   +5.023690380544917e-01   +1.275839925121801e-01   +1.080285087926673e-01   +3.052124861804185e-01; +3.163651362521713e-01   -2.489057211538329e-01   +4.203543027022762e-02   -5.629029872049384e-01   -4.801108294275963e-01   +7.450873623275226e-01   -5.553446343854911e-01   +6.511630140964311e-01; +1.312866897517913e-01   +5.359587145907245e-01   +6.390333524893207e-01   -3.147412308614420e-01   -1.493283306406531e-01   -3.846269367551080e-01   +4.197967675628751e-01   -4.184559261691488e-01];
L3E_L2E_iAMPA_netcon = [+5.133944965024624e-01   -1.810769711305529e-01   -4.300586162277959e-01   -1.149568038558991e-01   +5.743489692691043e-01   -2.422768149176326e-01   +1.537216576883379e-01   +5.707212999215187e-02   +4.411389161855325e-01   -3.907910351323933e-01   +7.225943543556151e-01   +3.057050179642991e-01; +4.917299113329952e-01   -3.414001589598381e-01   +5.823163167617323e-01   +4.457486319539693e-01   +4.082360397874212e-01   -3.262163373393168e-01   -3.170264894362217e-01   +2.864130868107690e-01   +8.440421352360053e-02   -2.727020221074970e-01   -2.601437067537143e-01   +6.750422663420591e-03; -3.901761317311227e-01   +2.820860038888657e-01   -3.747462487293872e-01   +3.518448782504816e-01   -1.406224897504178e-02   -5.521704638520613e-01   -7.403867121757472e-02   -5.253982659115166e-01   +4.309408828321230e-01   -1.902944016329535e-01   +2.129748346820982e-01   +4.652393946773822e-01; +9.974208705828766e-02   +7.929014281764888e-01   -3.986219921299640e-01   -4.377515671965034e-01   -4.145452495262184e-01   -2.340868351943879e-01   -4.725231581250978e-01   +9.194257884423102e-01   +6.741272621713789e-01   -6.789464286877235e-02   -3.187447781436294e-01   -6.416084696217963e-01; -1.568211825541250e-01   +6.485802562875925e-01   -5.438068715295331e-01   +8.107914346344266e-01   -2.739509090990349e-02   +1.408065604526990e-01   +6.916395513012367e-02   +1.843401336261927e-01   +1.814920213083206e-02   -3.790992881466069e-01   -1.394652203048421e-02   -1.006538133492321e-01; +3.456154169147245e-02   +1.207179748823133e-01   +1.000000000000000e+00   +3.802260237106946e-01   +5.856813960372585e-02   +2.680992188558441e-01   -3.969339057976599e-01   -2.305240197521728e-01   -2.820381014535118e-01   -3.581829649998755e-01   +3.831808788252038e-02   -5.871957835282010e-01; -1.725195362397340e-02   +5.060700717470298e-01   -3.818188287580246e-01   -1.771706007428425e-01   +2.297079545983388e-02   +5.606536930597629e-01   +5.369338042490258e-01   -4.881005839691414e-01   -5.264015846562384e-01   -4.964488689856577e-01   +5.243161151700291e-01   +4.349689058256268e-01; +1.592182460932571e-01   +2.218950602697349e-02   +7.531839372959696e-01   -4.352158826029247e-01   -1.522597077554697e-01   +1.771600749741123e-01   -1.751307768767394e-01   +3.499003572183825e-01   -2.381501792800870e-01   +1.828405313532635e-02   -7.679944456642275e-01   +1.856725591356975e-01];
L3I_L2I_iGABA_netcon = [+1.743356214872903e-01   +4.822304650776188e-02   -4.590173463293579e-01   +8.942244923355117e-02   -3.838567302668329e-01   +2.246835488934179e-02   +1.325271503881671e-01   +1.661740094013683e-02   -1.904779143299101e-01   -1.880847221349653e-01   +6.688892407454902e-01   -1.166077520071823e-01; +6.222897354192052e-02   +1.111960394607689e-01   +6.153155673210550e-02   +1.608695217720642e-02   -4.988281823204526e-01   -1.372650613870129e-01   +3.783060074270493e-01   -2.016196293751361e-01   -5.748493909338822e-01   -2.957977010912532e-01   +5.245709912092313e-01   +3.216308193260641e-01; +4.680996124484566e-02   -6.051425729631774e-02   +2.166421488764993e-01   -4.276234027692826e-01   -3.667294633460553e-01   -1.604894018555889e-01   -2.458478152450194e-01   +1.632010883714538e-01   +8.831763045616173e-01   -5.178963998205958e-01   +6.247876665020212e-01   +4.999119914160199e-02; +4.313315874410588e-02   +2.557344511114116e-01   -9.976390961785966e-02   +5.506497638621595e-01   +1.581463085484565e-01   +1.505660724258356e-01   -4.355686056980917e-01   +2.818528853073112e-01   -3.112951153155747e-01   -6.319174845248721e-02   -1.368716209169996e-01   -3.569061091839779e-01; -4.958375251182996e-02   +2.550242514715582e-01   -1.383642547278633e-01   +9.428914056073408e-02   +8.936774615822211e-02   -2.297517384314792e-01   -6.729706366338516e-01   -2.800391778136992e-01   -2.120150787122435e-01   +5.554837320659193e-01   +1.386313361186856e-01   +1.989641260294590e-02; -3.205723131064463e-01   -5.510119031936760e-01   +1.357212900580335e-02   +3.706610846680833e-01   +2.570333536960873e-01   +4.490785353070734e-01   -2.293662813049374e-01   -6.826577853601717e-02   -6.951861297182946e-02   -4.285220127265572e-01   -4.459107453423101e-02   -4.755190519957314e-01; +5.144408939940046e-01   -2.806827547142849e-01   -4.768833754865469e-01   +1.951242894885016e-01   -2.980430887242069e-01   +2.450555572126546e-01   +3.399654031800234e-01   +6.496397004730869e-01   -6.821092602421854e-01   -2.903488515133487e-01   -1.031774908442565e-01   +4.720954673006426e-01; -6.012781522089723e-02   -6.218945175269589e-01   -8.302478300216984e-02   +4.524162894820238e-01   +2.092300074220467e-01   +3.792334152287441e-01   +4.759012781171630e-01   -5.828112813158250e-02   +1.129188212667397e-01   -1.591278971417319e-01   +4.742559845068922e-01   -1.000000000000000e+00];
L2E_L3E_iAMPA_netcon = [+1.845012410074894e-01   -4.901382274426283e-01   +7.058130359868381e-01   +6.793346771409879e-01   -6.320074331971187e-01   +8.843938826771887e-01   -2.630538764116200e-01   +1.426354650280946e-01; +7.171277637208021e-01   +1.742156876678261e-01   -4.573503486413873e-01   +4.414663353224849e-01   +5.802514065142976e-01   +1.470004155820237e-01   +6.877182541754187e-01   -7.428046997824515e-02; +9.353065423619569e-02   +2.079560117605859e-02   +1.296765967766853e-01   +4.097677547669260e-01   +3.074625655736075e-01   +2.928592280982336e-01   -7.560968734951858e-01   -4.109756737299000e-01; -8.407594065162995e-02   -4.263845773044053e-01   -2.720713847840900e-01   -9.566074350775559e-03   +6.619294112156151e-01   +4.108199421764574e-03   +1.149735558920708e-01   -3.610596332307436e-01; -2.990696398394028e-01   +7.293750207171712e-02   +2.229521902274621e-01   -1.615520392279202e-01   -3.470252050465122e-01   -1.674303698301645e-01   -2.712395149088746e-01   -3.686396111349818e-01; +5.471708927333535e-01   -3.458050043275848e-01   +6.848570838203454e-01   -1.213638010358592e-01   +2.571113617323198e-01   +1.391563526272341e-02   -2.465298466464947e-01   -6.618496409857630e-01; +1.000000000000000e+00   -7.228479226351139e-01   +6.259160577073133e-01   +6.121362825069339e-01   -3.143344208129270e-01   +1.325998592563314e-01   +4.609024689500578e-01   -1.352642758765978e-02; -2.922724733740985e-01   +2.018431461850973e-01   -1.744564540349857e-02   -5.524581149922055e-01   +3.551407903714310e-01   -8.113260459544331e-01   +5.253457151141980e-01   -9.558195755706754e-02; -2.015998420692023e-01   +9.655563531646498e-02   +6.682689648712720e-01   +5.574758611145400e-02   -1.034037813247205e-01   +2.733122470445706e-01   -1.108529426109438e-01   -3.302339865732894e-01; -2.421280725232796e-02   -3.903324417719588e-01   +1.997197062848139e-02   +4.145682194527239e-01   +2.035600844982953e-01   +1.608638778659234e-01   -4.675622452567627e-01   -3.732242070946793e-01; +4.866106135645051e-01   +6.576578117272036e-01   -1.142830418391930e-01   +3.966698631285988e-01   -2.049909606520135e-01   +1.656421870907633e-01   +4.184117377704925e-01   -2.980927457284788e-01; -5.852102487097314e-02   -1.006481744212342e-01   -5.302368112355303e-02   +1.195808695981272e-01   +3.823809279038891e-01   -1.466439270664249e-01   -4.228593077278558e-01   -3.253402686336513e-01];
L2I_L3I_iGABA_netcon = [-6.779541664407296e-01   -7.092860026876233e-01   -9.887581798712366e-01   -4.603618318134480e-01   +4.782447997494220e-01   +5.074461442269210e-01   +5.715020617091465e-01   -2.594145176460222e-01; +4.513891434308039e-02   -2.110146798193785e-02   +4.040424334226308e-02   +1.665911350355003e-01   -4.386704399049144e-01   +7.494693573498059e-01   +6.957794121630807e-01   +2.071466896808951e-01; -3.535131777049123e-01   -6.381750871760371e-01   -4.014027227310022e-01   -6.218087086535417e-01   +5.634908719073759e-01   +1.920906158942789e-01   -4.325062935325157e-01   -3.768848315247241e-01; +7.612513728714257e-03   +7.739702381979788e-01   +4.847647874422819e-01   -3.322514551794273e-01   -1.948122633606394e-01   -7.950980091058431e-02   +4.691862173984906e-01   +6.645498903805679e-01; -3.951747860819971e-02   +5.149600076999854e-02   -8.720996241036972e-03   -4.326676713737247e-02   +6.789283905379009e-01   +4.482823024354683e-01   -1.093084956364511e-01   +3.309600047291795e-01; -4.441713420486875e-01   -1.422237176191803e-01   +1.215629324630970e-01   +7.670329387103551e-02   -5.376932691391017e-02   +8.829456824276017e-01   -4.295065772371946e-01   +1.180199183624740e-01; +3.802448797972535e-01   +5.719824988376297e-01   +3.975135274509239e-01   +5.995271570134957e-01   +1.982609950250891e-02   +1.830064123527969e-02   -4.443962924337095e-01   +1.000000000000000e+00; +5.597051584705461e-02   -4.629604577577823e-01   -5.974022954966220e-01   -3.580462216332895e-01   -3.983715148412987e-01   +8.741911276851355e-01   +3.548957457045382e-01   -1.756946845578222e-01; -2.883985579097684e-01   -4.436448700181492e-02   -1.862162218573996e-01   -8.759524894012016e-01   +6.047620245453329e-02   +5.541685412550574e-01   +3.919821772277577e-01   -3.988240286280462e-01; -1.027452471565801e-01   -2.026078898161886e-01   +4.699981813237571e-01   +2.025537070129104e-01   -3.639519552076271e-01   +8.352987315381595e-01   -3.099221866770475e-01   +1.555725397973347e-01; -2.211150531087544e-01   -2.624541700491270e-01   -6.262872589063878e-02   +5.999651764521409e-01   -3.210340661600448e-01   -2.757493785476741e-01   +9.824437742439285e-02   +5.503980395038172e-01; -6.968243133386112e-01   -2.709527211910993e-02   +8.492301545430055e-01   -1.905412178321134e-01   -6.282539953392222e-01   +2.593112298998234e-01   -9.050416123004712e-01   -2.181316593416823e-02];
L3I_L3E_iAMPA_netcon = [+9.569196279317164e-02   +2.365028972737740e-01   +5.414945448045037e-02   -7.161541779230522e-01   +5.770082358981643e-01   +1.799293337364602e-01   -1.482819501163979e-02   +2.656970356518473e-01   -2.936907852014226e-01   +3.960666420867497e-01   +6.220900409972989e-01   -3.302209256318269e-01; +1.829902228663038e-01   +3.121867004473593e-01   +5.227951793642324e-01   -6.715451998005845e-01   +2.537903634313119e-01   +1.684318501560305e-01   -1.824955061764988e-01   -2.331984277368441e-01   -1.151518404700241e-02   -4.293889956292429e-01   -8.468275737761274e-02   -6.873711798316834e-03; -1.220836848758358e-01   -3.857989218222349e-01   -1.906663522906071e-01   +2.127576758997838e-01   -1.030389925736539e-01   -9.086576711773580e-01   +6.567401252615637e-01   +9.564817859469443e-03   -3.562017910393109e-01   -2.783419759557234e-01   -1.123742627796852e-01   +3.855197172343466e-01; +4.669529300952813e-02   -4.279407378660495e-01   -4.460192481647140e-01   +3.386854210653988e-02   -1.301841859870659e-02   +8.166915129383066e-01   -5.685195878075955e-01   +7.129648964267115e-01   +3.545444613014487e-02   -4.290765308732455e-02   -6.986803576010489e-02   +2.612052368934644e-01; +2.274134206515469e-01   +3.958704600955540e-01   +6.429517040347308e-01   +1.632453753553033e-01   +4.240976147595435e-01   +3.233714520415167e-01   -5.213474661337696e-01   -9.754085678992658e-01   +1.781029871614603e-02   +1.705303405626468e-01   +1.994961266600023e-01   -4.540444108197567e-02; -5.713613220417073e-01   +3.725453083580721e-01   -4.858969591119602e-01   +2.823781921113953e-01   +5.599034419542701e-01   -7.914419265077588e-02   -2.460086437641486e-02   +3.007262555844590e-01   -3.641198194885009e-03   -5.720543710307190e-01   +1.354877457479810e-01   +2.535589191440424e-01; +7.263042350636730e-01   -3.025793764748666e-02   -5.330800151147270e-01   -2.903297826244598e-01   +5.858120453734407e-01   -6.337865996387582e-01   +5.081667970602346e-01   +6.277153252525411e-01   -5.945286173308486e-01   -1.810113613255659e-01   -2.661657904331498e-01   +6.664531445045278e-01; -6.428987378501664e-01   +4.228235297149141e-01   +4.216982905882662e-01   -7.757121165298539e-01   -3.146043076357397e-02   +4.251748027900516e-01   +1.701138545449119e-01   -2.991454109659030e-01   +3.099099185475646e-01   +6.398792062831039e-01   -1.671154888318639e-02   -1.552808392007315e-01; -3.938253086827345e-01   -2.342405269555403e-01   -6.278535057272078e-02   -3.982015587929492e-01   +5.484575261250889e-01   +6.950969444277577e-02   -6.902281019616814e-01   -2.621940589364313e-01   +6.963148773170214e-02   +2.370713739767187e-01   +2.525599975872017e-01   -2.370441040288253e-01; -4.633149517357437e-01   -1.077187274082016e-01   -2.126378513823833e-01   +4.143069488717804e-01   -3.608852985327299e-01   -1.902350945719433e-01   -3.939142308165478e-02   -2.844615362257321e-01   -7.393043733098689e-01   +6.094482363511141e-02   -6.988262539023949e-01   +6.560020864312799e-02; -6.183231858223704e-01   +2.681559572284363e-01   +6.084782921128443e-01   +5.299589647726658e-01   -1.502803252447630e-01   -1.114867677328394e-01   +3.064548990026038e-01   -2.435379895281615e-01   +1.222352872575365e-01   +4.913364647445788e-01   -6.082939019337892e-01   +5.405831898199965e-01; -1.752943356659585e-01   +1.501593592264452e-01   +4.519374486689849e-01   -7.470965630102364e-01   +6.678454376149296e-01   -5.184909667905346e-01   -2.235763815510564e-01   +2.755311689514499e-01   +2.540575151499621e-01   -8.684631935183188e-03   -1.941315344799320e-01   +6.679338825966062e-01];
L3E_L3I_iGABA_netcon = [-1.405702521463714e-01   +9.113281963263330e-02   -2.734679807343897e-01   -4.414944132823434e-01   +2.609925104931451e-01   +1.174521697146184e-01   -4.277096926771298e-01   +1.192627114970216e-02   -3.135613295394170e-01   +4.159751154781335e-01   +4.343390776497942e-01   -4.675343632054226e-01; +2.629240363441195e-01   +7.573072557613968e-02   -6.430398113785721e-02   -3.158330173113489e-01   -2.921831048896456e-01   -7.530838749478532e-03   -3.607630507628842e-01   -4.266527032026800e-01   -6.883593505774361e-01   +1.003641446104652e-01   +3.613069600692962e-01   +4.092080917714572e-01; +4.136352191086400e-01   +1.765901828481721e-01   +3.952335019264901e-01   +4.555318654889690e-01   +4.257257662120025e-02   +3.474428202791164e-01   -5.553092942337632e-01   +5.871170748972514e-01   -3.865938433551424e-01   +2.276565156758078e-01   +4.511365891814936e-02   +8.482808009027250e-02; +2.625411558440737e-02   -9.537035746942712e-02   +2.097912640194945e-01   +7.542920720529549e-02   -4.177486073181866e-01   +3.551542392174366e-01   -6.265186717644010e-01   +4.845595677104450e-01   -3.452003887708330e-01   -3.257563368078902e-01   -2.959342832620420e-01   -3.810072906927608e-02; +2.242406647279784e-01   -2.549037885826683e-01   -5.084954614706548e-02   +1.324915218930340e-01   +2.946885897842881e-02   +1.161572671045866e-02   -8.370205727294160e-02   +4.228955224707074e-01   +3.099920912526782e-01   -5.327632030948831e-01   -1.450493574894772e-01   -2.239244391595362e-01; +2.800301271976173e-01   -2.981922498645871e-01   +6.195175169165307e-01   -1.000000000000000e+00   +1.047669259610274e-01   +3.658387875366766e-01   +4.168594177450301e-02   +3.509020245530067e-01   +2.769189542504468e-01   -1.918944486934926e-01   -2.213603549421239e-01   +2.573927899967041e-02; +3.115355065632485e-02   +1.117273624860074e-01   -3.717983997506734e-01   -1.016748497209952e-02   +1.020771374761025e-01   +2.547182231979767e-01   -5.318791063222261e-02   -4.105057944782698e-01   -2.026682092580216e-01   +3.089668653714185e-01   +2.745531886107974e-01   -3.719757652762287e-01; +4.715767973220338e-02   -2.632666876966148e-01   +5.269801618061618e-01   +1.612220372526492e-02   -3.526028029042350e-01   +4.282334007114239e-01   -2.222014445461769e-01   -3.781211449634695e-01   +1.132799536246819e-01   -1.627401800119694e-01   -1.315143579437061e-01   +5.934678201946102e-01; +5.654200916089323e-02   +3.233144977838693e-01   +3.384117338687159e-02   -4.970544543184349e-01   -5.390158961388265e-01   +3.167420460425135e-01   -3.298037966635181e-01   +6.244165927555489e-01   -8.527284617814436e-01   +2.437164204032407e-01   +5.301933445467566e-01   -3.762898028406654e-01; +4.972631707007724e-02   -5.444707711247428e-01   -1.107796742105139e-01   +2.763837404589445e-01   +5.630300134508338e-02   +2.319170050915577e-01   -3.815009900819470e-01   +8.125085524013914e-01   +2.175853009913788e-01   +1.614262822672208e-01   +8.028430866334697e-01   +1.351558394371061e-01; +4.355033053801857e-02   +2.918595269413785e-01   -4.374059591189142e-02   -9.985556218803791e-02   -5.348050889654671e-01   +5.242567327251687e-01   -2.827103634289992e-01   +2.460984319510044e-01   +2.724692353415574e-02   -2.393038197345972e-02   -2.489398654053395e-01   +9.978700580100637e-02; +4.205016205415850e-01   -1.287526606130395e-01   +3.991442759346616e-01   +3.112165678622898e-02   -2.011532386798830e-01   +2.253660066263543e-01   +5.875054003889565e-01   +3.587736664135082e-01   -3.018276438810357e-01   +9.264738668692273e-02   +5.102034182877566e-01   -3.777926878831179e-01];
L2E_Input1_iAMPA_netcon = [+5.282275359832719e-01   +4.461114620619403e-01   -5.973583739994137e-01   +2.834202950516325e-01   +1.000000000000000e+00   -1.345522200464813e-01   +2.456898123653022e-01   -8.193729337952224e-01];
L2I_Input2_iAMPA_netcon = [-7.758226749671954e-02   -1.356841426449233e-02   +1.366631331829837e-01   -4.128455264290690e-01   +8.060290760529298e-01   +1.908569586862128e-01   +3.509446187302032e-01   +5.762904405844174e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 100*(sin(2*t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 100*(sin(2*t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
