function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.110468426344357e-02   -8.587189946821229e-02   -1.087867250363784e-01   +3.708991281434604e-02   -1.280828952352654e-01   +1.985488339344395e-01   -3.847856701567308e-01   +3.150093098238879e-02   -8.339535631041164e-02   +8.877493079415438e-02   -1.659748588736627e-01   -1.433009657287835e-01   -1.528850941007852e-01   +9.446048788692901e-03   -1.739937480592844e-01   -5.441558873275413e-02; +1.572554247621256e-01   +2.904463163117984e-01   +5.980729058912015e-02   +1.444126046394835e-02   -1.431943334543469e-01   -1.387481626434094e-02   -3.428441510345175e-01   +1.607933076427576e-01   -8.062016689532003e-02   -2.858233174976568e-01   -8.411441947176884e-03   -1.049589983265743e-01   +9.317346626642664e-03   -1.101203052129715e-01   +2.072279177936677e-01   +1.828331807579042e-01; +9.388973639495696e-02   +2.324027087548901e-01   -2.339471887596182e-01   +1.125181228855994e-01   -6.928563349490149e-02   +1.532885629530173e-01   +2.075599597452265e-01   +2.072010371121820e-01   -1.288970475250586e-01   -2.202116300923492e-01   +5.418809416948477e-02   -1.305790419572795e-01   -2.903118837991082e-01   -1.521772969109514e-01   -5.831968929862277e-05   -4.123271618614951e-01; -9.404229950811213e-02   -1.861718165846227e-01   -1.289622740724281e-02   +1.511593365668304e-01   +2.981967631355521e-01   -8.162171613024463e-02   +1.699856818615712e-01   -1.657431654234972e-01   -1.428897118701400e-01   +1.183171065789255e-01   -1.079542629050614e-01   +1.375869019259854e-01   -1.749505469352512e-01   +1.560859466695652e-01   +1.337799788129743e-01   +2.955134472394710e-01; +1.921127732418659e-01   -1.006557964944307e-01   -7.199217121123427e-02   -4.345845312814328e-02   +2.714993995778891e-01   -4.767373871058168e-02   +1.682949421927706e-01   +3.381231881938365e-01   +1.340140513547380e-01   +1.749527596826527e-01   +2.615007581052988e-01   +4.762681304223125e-01   -1.287352726871554e-01   +2.925739184109361e-01   +1.823718198579133e-01   +3.689841845870507e-01; +2.291208677887328e-01   -3.592479959312819e-01   +4.633509951516912e-02   -2.414347641005932e-01   +3.523997036614913e-01   -3.183891553285689e-01   -3.283976387921503e-01   +2.064657383927572e-01   +1.479358076010007e-01   -1.965824986806091e-01   -4.468057647472666e-01   +6.100815221042521e-02   +5.583534774912496e-02   +7.978673570090149e-02   -1.976239973658555e-01   +2.643943569061151e-01; +1.481658559037933e-01   +2.673704907576766e-01   -1.276091097952244e-01   -2.359275715616805e-01   -1.819746437640101e-01   -1.543797325141829e-01   -1.635277655550483e-01   +3.429407133068941e-01   +2.032197724812227e-01   -6.545878756195393e-03   -2.448635639901027e-01   +1.139642548575026e-02   +9.639542651969209e-03   -6.451342860144925e-02   +1.592122649738569e-01   +5.747379161855634e-02; +2.608929241974314e-01   +1.768717979164004e-01   -3.489120319277181e-01   +5.352537892182417e-02   -2.583099891842600e-02   +2.287531810189359e-01   +4.877810119561149e-02   -2.693820599057332e-01   -7.080507601362250e-02   +1.529750798310883e-01   +3.605887733176302e-01   -4.358580484286589e-02   +4.936661451782889e-02   +4.602085140434927e-01   -1.788310773264316e-01   -1.864363733992132e-01; -1.714564938599529e-01   -1.033074615258553e-01   -2.245551389041759e-01   -2.273735000003297e-01   +3.358667634756984e-02   -1.921295338713298e-01   -2.495778790096149e-01   +1.256774478294866e-01   +2.341954064996855e-01   -9.630492760379825e-02   +1.953749671812437e-01   -2.416929228312027e-01   -3.965519095955044e-02   +1.837895327816991e-01   +2.772752064378038e-01   +2.397105021823143e-02; -2.430518077297133e-01   -1.207054320592490e-01   +1.091025675394058e-01   +3.247054448690753e-01   +8.265555332087979e-02   +1.047427576532484e-01   +2.515099919725187e-01   -3.170926743787876e-01   -2.628638406448541e-01   +2.123622880822620e-01   -2.773963899689107e-01   +1.379537691277652e-01   -2.536821482945341e-01   -7.710867862295832e-02   +1.133362639953107e-02   -3.363531343085993e-03; -5.813007986021826e-02   -4.644223345131065e-02   -4.480801085973393e-01   -3.505130341013173e-01   +1.028939859344666e-01   +9.581793765051985e-03   -1.781503344626639e-02   -1.516103293342008e-01   -7.948264220018522e-02   -1.031870032228287e-01   -1.973904694394754e-02   +4.367180778459515e-02   -1.354578661358193e-03   -1.719155762110686e-01   +3.708451272688443e-03   -1.953769504944728e-01; +1.323509471308823e-02   -2.249690239853168e-01   -2.051519127823821e-01   -3.289285263437070e-01   +1.071504300336850e-01   -2.452013495738459e-02   -2.830253121381964e-01   +4.605070676606401e-02   +1.946867615233651e-01   +2.764601236175441e-01   -3.088488053953820e-02   +6.061897927238649e-02   +1.909807220087818e-01   -1.399440798997511e-01   -2.303351382902450e-01   +2.155288208067147e-01; -1.610491867609038e-01   -3.228250302352633e-01   -3.476032778978385e-01   -1.849340157728741e-01   +1.871331704286608e-02   +2.524438626119517e-01   -2.577545378601538e-01   +1.197021957450016e-01   -7.767148093272139e-02   -3.392747621228014e-01   -3.346993351588573e-01   -1.733728508804513e-01   -1.656260298266594e-02   -1.196154977604297e-01   +3.074012404202478e-02   +2.687892066507984e-01; +9.315904089495591e-02   +3.389431131259336e-01   -3.388445776383356e-01   +1.183056248383368e-01   -2.379159964791175e-02   -1.039452851125160e-01   -3.046712312301865e-01   +1.329492813119666e-01   -3.448434670706444e-01   -2.233488597499610e-01   -2.096218438598340e-01   -3.327356395574791e-01   +2.179801922501906e-01   -3.743106468433312e-01   -2.313003525426329e-01   -3.157006494658090e-01; +8.792441713014226e-02   -1.080038597769720e-01   -1.608030070764667e-01   -1.111687470320529e-02   -5.652829660039781e-02   +5.740358633367834e-02   +8.754442390873501e-02   -3.428891659525732e-01   -1.383452979865480e-01   +6.241899898010300e-02   +2.760059704180585e-01   +1.589865515952107e-01   +2.918407896676908e-01   -4.081418491180294e-03   -2.212827521992372e-01   -3.360801520851459e-01; +2.338283378858993e-01   +3.342351773617621e-01   +7.249188004622903e-03   +4.057595290703525e-02   -7.347096670047244e-02   -3.275294895143911e-01   +2.114859638938307e-01   -4.042548722008710e-03   -1.379884364777537e-01   -2.583343519650873e-02   +8.342344787405256e-02   -1.689079340121108e-01   -1.240645425157570e-01   -1.500010819057094e-01   +1.906652112054085e-01   -1.749751565207464e-01];
L1E_L1I_iGABA_netcon = [-2.749895395363864e-01   +1.665398802488129e-01   +3.505556383137019e-02   -1.457509347297096e-01   +2.630415376255156e-01   +6.674257667455646e-02   +2.690286869656092e-01   -2.661654016261460e-01   +2.092382514897212e-01   +9.047026904983169e-02   +1.051913936453458e-01   +9.937227278275128e-02   +7.203112880052719e-02   -6.921586833251522e-02   -1.019627018285483e-01   +1.334427900833749e-01; +1.342150066596965e-01   +9.311376866042323e-02   +8.261552778038964e-02   +3.222250784845851e-01   -3.639177233448387e-01   +1.126945743245580e-02   -1.258967839996026e-01   -1.036332697481368e-01   +4.568487493982116e-01   +9.022974050959839e-02   -2.946915068212302e-01   -3.093033793843362e-02   -3.345515513087363e-02   -5.089761981372308e-02   +9.392893619214339e-02   +2.625393597431580e-02; +2.227306384929048e-02   -3.001296059289449e-03   -1.383406717155725e-01   -1.484918527447102e-01   -1.068962254893396e-01   -2.100637035485977e-01   +2.425802792562607e-01   -7.805264284421590e-02   -1.360026950772531e-01   -2.155768193418963e-01   +1.770341392133864e-02   +1.130015950191305e-01   +1.698041250140450e-01   -4.288204202199087e-01   -1.905429325855295e-01   +2.369907411270785e-01; -2.078965001350090e-01   +2.834719449931933e-01   -2.169011135771493e-01   -6.759976625463662e-02   -9.293495007616229e-02   -1.174348349450939e-01   +2.917451208308521e-01   -2.063006048669184e-01   -3.911216423438035e-01   -1.210505596024400e-01   -2.212664521188942e-01   +7.959827803677000e-02   +5.166299352027438e-02   -6.758001043742561e-02   +2.451865329731064e-02   -1.968534208417775e-01; -1.210740209684416e-01   +6.178578196938332e-02   +4.014114048520491e-01   -2.169591310458889e-01   +4.938461735910368e-02   -1.596232282800945e-01   -2.026230497513084e-01   -1.554045952470567e-02   -1.193296592638910e-01   +3.621837011031197e-01   +6.496337432070136e-02   +1.539379890259129e-01   +5.296352198077666e-03   +2.237352616567712e-01   -9.497503056249769e-02   -2.995109325457926e-01; +8.451846672875658e-02   +1.022895334033567e-01   +6.933986938606967e-02   -7.974717814658622e-02   +2.086019440422159e-01   +2.575416662119088e-01   +2.621577075948711e-02   -2.950947938832056e-01   +5.973700681441059e-02   +3.290628489321970e-01   +1.033900428094783e-02   +7.907163247197535e-03   +2.476414986365553e-01   -3.369602290596613e-01   -1.700589369491706e-02   -9.827845649962061e-02; -1.503249844335036e-02   +2.571179303146121e-02   -1.527447318624399e-01   +2.124680481154259e-02   -2.654985686254938e-01   +1.290070677116407e-01   +1.371104565697712e-01   +4.493874159610239e-02   +1.512672508551169e-01   -5.860232507882382e-03   -1.026228274634249e-01   -2.925837683689416e-01   -1.604365212829959e-01   -2.519342603764401e-01   -4.560869917826538e-02   +4.281854971697346e-01; +1.514280699694889e-01   -1.078875054944871e-01   +2.855830290886556e-02   -8.545568118635440e-02   +2.537164819705302e-01   +5.714958148980744e-02   +1.574581088570481e-01   +3.276786121662644e-02   +1.559570139157568e-01   +1.026315684290327e-01   +1.387279483732093e-01   -1.919472253101950e-01   -2.616943976721640e-01   +2.055697459390528e-01   -2.378246116430874e-01   -8.080134075042375e-02; +1.592128053839259e-01   +3.244403445676751e-01   +1.888170451191971e-01   -7.836233306802315e-02   +4.862929103648042e-02   +4.718803114525993e-02   -1.070802464037883e-01   +1.739096484478925e-04   +1.523169164449448e-02   -7.043930061926779e-02   -1.992033387883836e-01   -1.511976571705162e-01   +2.233753070410586e-01   +1.226804450330739e-01   -2.924381739550641e-01   -4.043018505941085e-01; -2.815987644020722e-01   +8.925427603699970e-02   -1.898365266349732e-01   -2.476136790555748e-02   +9.983615618473969e-02   +2.067045664973193e-01   -3.698500800724169e-02   -4.015644668175845e-01   -3.534668442034610e-01   +6.040767483499944e-02   +2.081256354355664e-01   +3.060951752876780e-01   +3.226810821937907e-01   +1.730288814041906e-01   -9.390454424923124e-02   +1.556588371137621e-01; +3.032128883152440e-01   -9.361127639941509e-02   -4.270193891229753e-01   +4.925214885052835e-01   -1.545311134650453e-01   +1.776846718461988e-01   -1.517503992575563e-02   -1.511651810773150e-01   -5.207256542907693e-01   -1.443430998039387e-01   -1.082817864148284e-01   -2.677963764370604e-01   +4.847186477502305e-01   -4.525132446280588e-01   -2.871194013705192e-01   -1.318653827878265e-01; +7.745950781342997e-02   +4.649739483682459e-02   +1.781467289740771e-01   -3.507984123369590e-01   +8.326628022013829e-02   +3.313278796000618e-01   -3.925046951689434e-02   +2.365044815028651e-01   +2.291291393870226e-01   +1.683893068604938e-01   -2.142844550239664e-01   -6.113603676074729e-02   +6.536502967791495e-02   -2.494247068743618e-01   -2.866780027196216e-01   -7.251163624080299e-02; -1.024140870585080e-01   -1.675318247136750e-01   -2.422568757339295e-01   -1.294887728639659e-01   -1.533585786135669e-01   -3.700395790242800e-01   +4.050920655533988e-02   -1.297886725603393e-01   -7.155676942781540e-02   +4.173321866111475e-01   -9.432384761294925e-03   -6.279638953819559e-02   +9.174383999596522e-02   +4.859944142025030e-02   +1.606301765007820e-01   -2.701387319301695e-01; +1.092781348458313e-02   -6.814007735625772e-02   +2.544757617007887e-01   -5.354485562451101e-02   -2.920368543859072e-01   -8.088336279266457e-02   +1.638542049210011e-01   -6.077229756921687e-02   +2.816165288048580e-01   +5.290976039299630e-02   -3.125588513851449e-01   -1.366073359201850e-02   -1.046809716611652e-01   +6.927205726503675e-03   -1.789982784481431e-01   -1.822113550462953e-03; +1.817597194896041e-01   +3.944638483165163e-01   -4.049907820897426e-01   -7.204819521310396e-02   -4.081984786615185e-01   -1.756635840223380e-01   -2.059526309433043e-02   -2.765471335490539e-01   -2.343705179266776e-01   -2.503035955976424e-02   +1.937489898295948e-01   +3.753295122324329e-02   -1.383832160821722e-01   +5.179982908747107e-01   -7.265212648200181e-03   +5.902712578025351e-02; -1.128164582321295e-01   +1.579529009760377e-01   -2.810497447412318e-01   +7.698213455566298e-02   -1.894042296769037e-01   +1.410228014974786e-01   +2.587440636518006e-01   +6.689265616066019e-02   -2.796976882181743e-01   -1.926479779640129e-01   +1.919988594992953e-01   -2.177050507977785e-02   -8.363231020502571e-04   -1.696275227655121e-01   -3.093315153494641e-01   -4.748392834761561e-02];
L2I_L1I_iGABA_netcon = [+1.937121471504932e-01   +2.719081066040930e-01   -1.236800814846340e-01   -2.807288667506047e-01   +2.821847711537483e-01   +4.852135362466634e-02   +2.049907327961388e-01   -1.884195390072612e-01; +6.787225323473409e-03   -3.299202230051531e-01   +3.251468104513429e-01   +2.206978063830138e-01   -6.480723596651829e-02   -4.987067108661777e-01   -2.636787326121831e-01   -1.259473015973119e-01; -3.294592762027146e-01   -2.219701579027098e-01   -1.346062346739959e-01   -1.690275077449827e-01   +9.180621434942307e-02   -1.643272179730213e-01   +4.581832035383686e-02   +2.051014230349524e-02; +8.708128494224657e-02   -1.393946990155635e-01   +1.194596492652562e-01   +9.080628801383842e-02   +7.261461814455186e-02   -5.495072630160318e-02   +3.337360058237037e-01   +3.282068278923509e-01; -2.868298080755547e-01   -2.024925606345318e-01   +2.645777204808866e-01   +3.130424455647611e-01   +5.646463439472900e-02   +6.548322531448839e-03   -1.432357171172581e-01   -4.444379678493532e-01; +2.963456674531069e-01   +1.202772789905397e-01   -1.404059570683914e-01   -2.126747074343508e-01   +3.012510200630797e-02   -1.961905433204847e-01   +2.948978929486241e-01   -3.431373724030177e-01; -1.335616898825519e-02   +1.389511810254231e-01   +1.472140961807985e-01   -5.842527816749654e-03   +2.090484385272542e-02   -1.838844627420395e-02   -1.653170993585484e-01   +1.404459642177812e-01; +2.105355259610864e-03   +8.868205628201735e-02   -2.707597912656701e-01   -1.854417380539405e-01   -1.044683300706463e-01   +1.800984925637162e-01   +1.121939897271500e-01   -2.692450735672184e-01; -2.915841592139236e-01   -2.423989995070308e-02   -5.828321767757109e-02   -9.760053236564704e-02   -2.152383627237580e-01   -1.427705951209911e-01   +5.437821136555088e-01   -1.091112764447660e-02; -1.884617401404409e-01   -9.826394361794166e-02   +3.809802318356215e-02   +1.946288957328126e-01   +7.934749017716375e-03   +1.130416134715092e-04   +2.583837840608083e-02   -1.749964365086205e-01; +1.196266100282582e-02   +1.234308141941853e-01   -3.777389880265329e-01   +5.381290554046529e-01   -3.971614680117912e-02   -3.923251945236176e-01   +8.116642983754307e-02   +7.746717204463682e-03; -2.357173609130831e-01   -3.910876649411532e-02   -2.110350239363373e-01   -7.846152115962204e-02   +4.165555573391151e-01   +2.098027227595317e-01   -3.860001588868928e-02   +4.812304671960865e-04; +4.975598010881935e-01   +2.331832426509161e-02   -4.029862600140598e-01   +2.473207474870846e-02   -1.454274388229224e-01   -2.174648143645757e-01   -2.814988923444939e-01   +1.851567804721943e-02; -3.659650986436867e-01   -3.253996237846207e-01   -2.283536382436663e-01   +5.188620109930633e-02   +1.000126821226359e-01   -3.296670240527564e-01   +4.352712892747210e-02   +6.131438164771980e-02; +7.522306548577275e-02   -6.339450882464603e-02   -3.131538102027356e-01   -1.111582808277665e-01   +7.660931984350586e-02   +2.677790004825602e-02   -1.999338218978300e-01   +1.370856395349572e-01; +4.226855464875244e-01   -5.413114991786115e-02   +4.742945096127388e-02   +1.069089878925776e-01   -1.791513426490323e-01   -2.329737161421838e-01   +3.676679428638854e-01   -3.983222180199637e-01];
L1I_L2I_iGABA_netcon = [+2.659834716011173e-01   +3.138222354051424e-01   +8.973473646553293e-03   +1.195768019726632e-01   +3.291300066004821e-01   +9.859219708393380e-02   +1.753518640173072e-01   -2.127673742613553e-01   -9.020684657794847e-03   -1.872767359571907e-01   -2.067094957170422e-01   +3.728986050770827e-01   +7.640931494050714e-02   -2.307274557899646e-01   -3.798805566547364e-01   -7.136239432288508e-02; +9.943706480750547e-03   -8.992058993079485e-02   +1.269434582836590e-01   +5.517809883730338e-01   +2.102947040594933e-01   -1.598984010745064e-02   -1.850492210268462e-01   +1.632531875493593e-01   +1.104926355980292e-01   +1.060576325039979e-01   +3.579951651715809e-01   -1.451660130526460e-01   +4.116999357788600e-01   -1.740421269298164e-01   -1.366619334156335e-01   +1.802373820390413e-01; -2.602519656896467e-01   -1.164895880160327e-01   -1.776901154712732e-01   +4.315896250963955e-02   +3.388574287344363e-01   -2.539656984140904e-01   +1.674937076758239e-01   +1.253116353157592e-01   +1.605911842709692e-01   -4.989386851146130e-02   -2.862007715524058e-01   +1.118870648988282e-01   +7.693861587708950e-02   -1.316292161248455e-01   +2.507579799804885e-01   -4.847031469113211e-02; -2.800532528644189e-01   +1.280101723374109e-01   +1.900485761040790e-01   -9.297512080814524e-02   -2.547290270507183e-01   -3.083061560023450e-01   +1.339730220682849e-01   -1.380554880310050e-01   +2.933809135499375e-01   +7.193277941023864e-02   +7.052013591583661e-02   -2.499283487183812e-01   +2.715250337260441e-01   -4.814051183991383e-02   +7.704945477656394e-03   -4.121794095424076e-01; +3.063443394648434e-01   -1.299860930394139e-01   -1.548139925865549e-01   +2.093609466627243e-01   +1.827907047619562e-02   -3.412193807765486e-02   -9.441153961379858e-02   +3.900663524384707e-02   -6.284154861933820e-02   -9.728565055334779e-02   +5.395689694410277e-02   +3.247547201210322e-01   +3.977865605105319e-01   +9.573434161059527e-02   +2.625414290452051e-01   +4.748084900534440e-01; +1.421280882565028e-01   -1.290936894407150e-01   -2.844783991582361e-02   -3.024076506867732e-01   -9.930905519423612e-02   -1.652016132589566e-01   -1.624799941105778e-01   +2.789591077804664e-01   +2.240075240516058e-01   -5.201210922911294e-02   +2.239189822007140e-01   -1.967823460102372e-01   -1.628901473160798e-01   -9.917288297065338e-02   -3.189234066310766e-02   +2.841961328598482e-01; -3.756637347793044e-01   -7.575755408818682e-02   +7.647324340220173e-02   +1.006049297036750e-02   -3.853907498426096e-02   +6.268108911959781e-02   +4.227507381235944e-02   -3.983521863495493e-01   -7.984968771260287e-02   +2.013952285943541e-01   +1.694508192934601e-01   -4.988292520482247e-02   +1.654660490788604e-01   +5.068265657848643e-02   -6.368793450956696e-02   -3.610964057725736e-01; +2.675509566791778e-01   +3.843051917628403e-01   -1.177669296312758e-02   -2.826244536684461e-02   -7.734725818606542e-02   -1.861984807101763e-01   +9.668501700646738e-02   +1.860026877083141e-01   -9.176090249743349e-02   -2.139777509068500e-01   -3.041432406308367e-01   +5.560633740468011e-02   -1.188329831713768e-01   +4.334252244046905e-01   +8.764540366861169e-02   +2.660695317768180e-01];
L2E_L1E_iAMPA_netcon = [+6.315995909723578e-02   -1.262320715447915e-02   +4.358922945544298e-01   +5.325763922228062e-02   -4.746088895339895e-03   -1.926685977836728e-01   +1.804542992616146e-01   -2.391998539337869e-01; -3.211060678791378e-02   -2.165032077632237e-01   -5.016907378099658e-01   -1.349267010788672e-01   -1.206788231830229e-02   -7.946227674929165e-02   -4.117268951913100e-02   +3.373359416849503e-02; -4.494579183010063e-02   -1.460837595632620e-01   +8.450911356344534e-02   -9.482868748809523e-02   +5.926742913155636e-02   +6.295936719137030e-04   +1.254550164458854e-01   -1.733199061355508e-02; +1.287373488562874e-01   -1.850428135600333e-02   +1.463933611574826e-01   +7.371822479370307e-02   +3.910511948764180e-02   -2.732778614460235e-01   +3.395631122754635e-01   -1.546795368198634e-02; -1.348802687204832e-01   +5.311406363270831e-02   -2.118890108993345e-01   +1.859004055617320e-01   -2.443642673971175e-01   -9.208002895381588e-02   -5.965437961739468e-03   +1.383274422528641e-01; -2.286726844318935e-01   +5.052429104586310e-02   +1.721329984305019e-01   +3.253450445922990e-01   -5.280486689765718e-02   +3.419010751922957e-01   -3.982797138299405e-02   -4.817180710216599e-02; +9.685407836491811e-02   -1.280928052745744e-01   +4.129577411812194e-02   -8.640109826668717e-02   +3.417561366554868e-01   +2.375669300029871e-01   +1.270898807986820e-01   +6.351740826450175e-02; -1.158187317767364e-01   +7.585457164133023e-02   +1.208160238486138e-01   -2.535908702180123e-03   +2.559790879716937e-01   -2.861868500192452e-01   -2.054904758049573e-01   -1.615901060034457e-02; +7.959313962203712e-02   +2.687572639831415e-01   +8.027786441220261e-02   +3.681283557431275e-01   +6.908436225573425e-02   -8.899083434115990e-02   +4.168534560154896e-03   -2.305934859625879e-01; +1.805160036091787e-01   -3.118368164504360e-01   -1.353914074170535e-01   -8.762126893382555e-02   +2.929702315648302e-01   -2.330833847737057e-01   +9.842530444643580e-02   -3.225986010261946e-01; -2.154598709262766e-01   +3.550951749275065e-01   +2.723459148775026e-02   +1.689292961526530e-02   -5.319126077319410e-02   -1.780298420571186e-01   -2.564284129223253e-02   +1.095020542661023e-01; +1.135543724924639e-01   -3.765105254451172e-01   +7.561157296540170e-02   +4.605497922362521e-01   -2.166724347619952e-01   +7.305608111593195e-02   +2.266522003769096e-02   +6.210212784787489e-02; -2.037006275799399e-01   -9.304608358227857e-02   -6.895510386395945e-02   +1.218870466055099e-01   +2.554577390935041e-01   +1.722686020476547e-01   +2.434530099904501e-01   -1.071051307873010e-01; -2.845254083543302e-01   -1.223597786547790e-01   +1.338848310373401e-01   +2.724016997340473e-01   +1.770373318827034e-02   +4.629678737539609e-02   +2.571262796946042e-01   -9.146046157215676e-02; +1.816690603659586e-01   -2.257032276939561e-01   -1.199295392536128e-01   -1.333196054700860e-01   -2.822998581356513e-01   +2.732251918048745e-01   -2.385400854099522e-01   +3.162094017580286e-02; +2.154547639643508e-01   -3.929861288968154e-01   -3.163419461083257e-01   +6.500750542957887e-03   +2.179950889189092e-01   -3.687601751724481e-01   +1.048991439745651e-01   -3.047926774288380e-02];
L1E_L2E_iAMPA_netcon = [-3.601846330734927e-01   -1.416296874590873e-01   -1.837864584880824e-02   -2.127559054646666e-01   -6.939602689339086e-02   +8.294223428742270e-02   +1.784293706523503e-01   +4.486187622548020e-02   +3.144169676214854e-02   -2.028993409544240e-01   -1.620549984861290e-01   -9.263988271302684e-02   +2.715740556067478e-02   -1.820368919407411e-01   -1.181466187138634e-01   +1.858467749110485e-01; -4.088722993982440e-01   +2.061568526897677e-01   -3.523123652093619e-01   -8.284901759689564e-02   -1.527467760225822e-01   -1.752142470668440e-01   +1.999317170825750e-01   -1.852225216633151e-01   -2.372330960518064e-01   -1.239566880933986e-01   -4.781481819594447e-02   +1.640289010813092e-01   -5.239735712329354e-01   +2.555941172010140e-01   +4.208908490310856e-01   -1.459218846867006e-01; -3.783914366277259e-01   +1.560210002544202e-01   +1.556558043148268e-01   -2.614543357747308e-01   -1.496241875653002e-01   -4.534845107254292e-01   -1.660656168680635e-04   +6.308553606002498e-02   +1.755398076371365e-01   -8.615972245243690e-02   +1.851791977748405e-01   +2.108314120283973e-01   +2.772802061837351e-02   +3.501280541541641e-01   +2.034696240992888e-01   +2.054937607796249e-01; +1.925644523633035e-01   +5.490527156581389e-02   -2.747377702077542e-01   -6.628366485812429e-02   -3.614523273800044e-02   +1.761128850698299e-01   -3.070097112724716e-02   -2.419565622450566e-01   -1.371462983896881e-01   -4.084972672084949e-02   -8.134159786681461e-02   -3.383695166322698e-02   +6.333526279178647e-02   -2.124406410541065e-01   +1.952775089563864e-01   +1.840692293239597e-01; +2.150715848028942e-02   -7.815205343403298e-03   -2.958731167668075e-01   +1.244915907708506e-01   -3.062112901473376e-01   -1.939504906604485e-01   +9.949792699344895e-02   +3.161548123983516e-01   -1.967631047709630e-01   -1.516949704815143e-01   +4.019244694102715e-01   +1.307553232721314e-01   +4.976988886756697e-01   -2.505112043893637e-02   +1.308774109558535e-01   -3.206193532318058e-01; +6.132151175722735e-02   -3.166326130677388e-01   +1.625011479136695e-01   +2.757422959029978e-01   +2.818111167596138e-01   -3.173094688002494e-01   +9.617678806999726e-02   -4.194105050038849e-02   +1.238847678079070e-01   -1.841507389258548e-01   +1.250997258332225e-01   +1.044550370910237e-01   -4.484141310334574e-01   -6.921132451604105e-02   -3.515396183723636e-01   -1.338821696250951e-01; -2.239893844816493e-01   +2.338613523754978e-01   -2.408483857346054e-01   -1.268742557938430e-01   +6.300394329676205e-02   -3.339211593584169e-01   -2.083950641879958e-01   +1.261195888643437e-01   +2.327148176988161e-02   +2.108496424087430e-01   +3.223132121177057e-01   +1.139751285498475e-02   +1.281240481363499e-01   -2.584597731926553e-01   -2.959893765536516e-01   -1.912762423284637e-02; +8.887707101084386e-03   -2.280493504100861e-01   +3.509620975029617e-01   -7.706608300254329e-02   -1.692417334773049e-01   +2.322737609775340e-01   -1.861376740284818e-01   +8.556913742418823e-02   -1.239477883576486e-01   -1.386064392354577e-01   +2.660828014241255e-01   +2.013997787997148e-01   +3.890686407389947e-01   +2.906858506632313e-02   +2.254282378036712e-01   +2.781637526587859e-01];
L2I_L2E_iAMPA_netcon = [+3.775789162940557e-01   +4.053492338611127e-01   +7.571198808102513e-02   +3.919812012046180e-02   +7.426492564487398e-02   -7.298940547962256e-02   +8.417508028574550e-03   -1.259037732339746e-01; -4.611256473952946e-02   -1.521325007647046e-01   -1.940909994942760e-01   +5.214527475123459e-02   -1.420996668711335e-01   +2.035197225549041e-01   -8.164193309745357e-02   -9.988934546661882e-02; +2.743665518524827e-01   +2.858720616492951e-02   -5.131254612081662e-02   -9.212013821238731e-02   -3.274550056865534e-01   -1.591297233481431e-01   +1.326720779956207e-01   -1.867618800523361e-01; -1.051626036222235e-01   +2.368787983009266e-01   +1.756785463969378e-01   -2.290624359696881e-01   +2.536184102159652e-01   -1.953947590017826e-01   +1.769239279334450e-01   -1.881092477084562e-01; -4.541286799231259e-01   +6.269453965135122e-02   +3.507518350668905e-02   -3.776449759045162e-01   +1.876969437064686e-01   -6.253700055439279e-02   -4.238211279364005e-01   -1.499456296472457e-02; +2.521947356252878e-03   +7.382672400993331e-02   +6.616697928370599e-02   -3.596108228218618e-01   +1.378638064510638e-01   +2.250220710239147e-01   -2.274324241601241e-02   +1.029345362150638e-01; +2.721082244884787e-01   +3.822516201183509e-01   +6.082838096488824e-03   -3.280405512975500e-02   +1.856362949397116e-01   +2.031134410032747e-01   -1.999048544818072e-01   +6.713323383571758e-02; -2.194974654208248e-01   +2.604351935252707e-01   +3.564533612316638e-01   +3.387111937165880e-01   +4.724145639495048e-02   +2.670627719941030e-01   -2.033460398402120e-01   -6.675742938504980e-02];
L2E_L2I_iGABA_netcon = [+1.305371121307274e-01   +2.472250288139198e-01   -2.029472476791225e-02   +1.030013030597293e-01   -2.328669729362122e-01   -2.775202648317313e-01   -2.521780398494231e-01   -1.119929817916802e-01; -2.450409228667693e-01   +1.904539975911770e-01   +2.712467134463875e-02   +1.983220947943227e-01   +8.799031447921798e-02   -8.135688620690276e-02   -1.377743476629440e-01   +2.488501337149944e-01; +3.763188159356799e-01   -7.153123215201070e-02   -2.455899437660804e-01   +2.714373047398922e-01   +1.527734830221837e-01   +2.607784239921007e-01   -1.875352111345353e-01   -1.385566233703971e-01; +2.321086888540554e-01   +2.869933972875920e-01   -7.327046997686182e-02   +3.622265920745867e-02   -3.005014875411101e-02   -4.482089939857374e-01   -2.979725226676180e-01   +8.466908420777894e-02; -7.101777726935919e-02   -2.810252063878398e-01   +1.900995275463426e-01   +1.431574668541306e-01   -2.363433459101839e-01   -2.007722933504137e-01   -1.001126027948080e-02   -7.736820826737831e-02; -2.149744937070112e-01   -2.947154103770124e-01   -2.217997908637667e-01   -6.068791841069791e-02   -1.172434520457609e-01   -1.092275019994829e-01   -2.746959921401962e-01   -2.040590888841192e-01; -1.232382874540710e-01   -1.112410656696139e-01   -7.449562677814120e-02   +2.444978115811163e-01   +2.301297954379065e-01   -4.537349451781744e-01   -9.757267362718397e-02   +2.574688628753518e-01; -1.512371123754371e-01   -2.290321491871791e-02   +1.487374288351181e-01   -2.127095715849967e-01   +3.299517618084629e-01   -2.073263623488045e-01   -4.567180901199136e-02   -2.520108912646730e-01];
L3E_L2E_iAMPA_netcon = [+1.872386093180533e-01   +8.821120031696512e-02   +5.347034056298751e-02   -1.844368986390274e-03   -4.027125575823846e-01   +2.368163038323251e-01   -6.895716210353656e-02   +3.538837063539743e-01   -1.186501257165397e-01   -3.012650809447300e-01   -1.207573191376305e-01   -3.427186948096942e-01; -1.150332961156113e-01   -2.512265330381908e-01   +1.368425580464519e-02   +9.834163561817477e-02   +3.271859619399653e-01   -1.713209996188161e-01   -1.522293609734437e-01   +3.056540911773248e-01   -2.646666764840247e-01   +6.896771180869719e-02   +1.075615502144052e-01   -4.070216102061250e-01; +1.238908446359387e-01   +1.623431063036194e-01   -3.703135196128818e-01   -2.447475171707876e-02   -3.496943186297952e-03   +2.167740369005388e-01   +4.129486406456419e-01   +5.536420222499125e-01   -2.179742595335594e-01   +3.009138659726861e-03   -2.894958147985632e-01   -2.206554867763695e-01; +2.547619638277305e-01   -1.569248152523284e-02   -2.352131051165657e-01   -1.261874200382930e-01   +5.531209236532650e-03   +2.342594770657194e-01   +4.325549018085160e-02   +1.286612234476182e-01   -1.770193941373555e-01   -3.265201540494295e-01   +3.208460427476579e-01   +7.096292298278724e-02; -2.395575600910512e-01   +2.131528722092007e-01   -3.706077873483529e-02   +2.021231528848751e-01   -1.184747290542912e-01   -8.335744298274948e-02   -2.150666407091867e-01   -1.648781491738208e-01   +2.460962993258932e-01   -1.003629803301538e-01   +2.027292275565710e-01   +2.114768965671271e-02; +2.602775520014079e-01   -6.604965525144529e-03   +1.924129447517153e-02   +1.213686027010566e-01   -6.528777869496871e-02   -6.805589516500736e-02   +1.580149482640746e-01   -4.619275143634199e-01   +9.973579083241321e-02   -4.925095834915911e-01   -2.292442020273608e-03   +3.134748670807619e-01; +2.372228503142975e-02   -2.722679858573096e-01   -2.478103431276517e-01   -2.055952461782571e-01   +1.313889771235012e-01   -2.572366039224060e-01   +1.446502412945950e-01   +2.457632225538670e-01   -1.615596598825533e-02   +2.064050836389315e-01   -8.288128629426367e-02   +2.023039222604030e-01; -5.574039424616567e-02   -1.272312699867236e-01   +4.620447078310925e-01   +2.281629128247925e-02   -2.956219318463826e-01   -4.195894247382065e-01   +2.126323006929315e-01   -3.773873926816785e-01   +1.951651885489517e-01   -1.371095472193821e-01   -4.186915329462665e-01   +1.417137254235796e-01];
L3I_L2I_iGABA_netcon = [-3.585437149326604e-03   -1.992187318528234e-01   -9.084811943473439e-02   -9.622319831579372e-02   +1.027520626775767e-02   +1.081950188911551e-01   +1.683734010147371e-01   +2.368440609159780e-01   +3.928851754043039e-02   +2.183590160198420e-02   -3.623388532682293e-01   -1.549039390753983e-01; +1.185774472603540e-01   +3.440572997890105e-02   -1.243599216529547e-01   +2.621672747954440e-05   -2.935242077274467e-01   -1.173567084274268e-01   +1.734237683094614e-01   -2.998967478878685e-02   +2.447645248581038e-01   +1.469558705303249e-01   -3.390137155930261e-01   +8.569885230170984e-02; -2.931677429598890e-01   -6.289681480512495e-02   -2.029873038972408e-01   -4.047438540419802e-02   +3.077296020216929e-01   +1.094144158479023e-01   +4.225485706165049e-01   +1.166581438140754e-01   -5.123672672505195e-01   +9.783619023322647e-02   +4.084197661984443e-02   +2.015498197985167e-01; -2.208920896139540e-01   +2.730649222725591e-01   +2.123734061472312e-01   -5.179443321470772e-03   +7.428230004908945e-02   +3.044860228915515e-01   -2.296396896969919e-01   +2.252672726113175e-01   -2.025782174505003e-01   -1.253585463031898e-01   +1.558537813882027e-01   +3.754101501205464e-02; +2.350591836084436e-01   +8.897363950697573e-02   +1.073048586688625e-01   +1.178069975907053e-01   +7.351778222629270e-02   -9.256415587685632e-02   +2.601656265361509e-02   +2.295395766192946e-01   +3.383106753282439e-01   +3.291590844344028e-02   +1.038884637369972e-01   +1.310667921330462e-01; +5.202942486124179e-02   -4.452866283578345e-01   +3.113494593169627e-01   -3.414082850736275e-02   +1.299203030338068e-01   -2.753107462672491e-01   +2.444361177342857e-01   +3.000602173881767e-01   +2.684789724596451e-01   -8.924708089842570e-02   -3.345315983577379e-01   -1.812421609222822e-01; +7.991225533009516e-03   +1.166266299536057e-01   -2.000810836734527e-01   +4.921347615035554e-02   +1.331193993787663e-02   -4.100317723980109e-01   -8.162074920659081e-02   -3.652458865669608e-01   -4.098200540264090e-01   +2.423286496101823e-02   +3.414152345743036e-01   -1.816802624254505e-01; +1.864399607866543e-01   -2.316701240520943e-01   +1.977859972876205e-01   +9.347866906084940e-03   +2.080379221042900e-01   +2.213074613412540e-01   +7.729337433586589e-02   +3.247664942119691e-01   -2.461994124101760e-01   -6.773336043074374e-02   +3.855594201416980e-01   -2.983136958715943e-01];
L2E_L3E_iAMPA_netcon = [-1.160705942865223e-01   +1.689781065085567e-01   +2.778078323783930e-01   -1.290817332476787e-02   -1.223227671724322e-01   +2.767315731045334e-01   +5.584638147735041e-02   -3.770744399724316e-03; -1.470892295004423e-01   -1.232909358288105e-01   +4.075682908196262e-01   -3.255584623664746e-01   +1.969473655308844e-01   -1.262440231765327e-01   -1.384742540865473e-01   -1.121499503060540e-01; +8.120996200375817e-02   +9.557451358034932e-02   +1.389149111484714e-01   +2.411199184626703e-01   -1.381144684908330e-01   -1.356674983406844e-01   +2.805972665025241e-01   +1.121950185299795e-01; +7.942723258306300e-02   +5.357451027980395e-02   -5.821310285709893e-02   +1.298799633142767e-01   -1.147805946613617e-01   -1.476223590623362e-01   -4.464030913010754e-01   +3.139684667830914e-01; -2.087287279806652e-01   -2.063115902157014e-02   -1.374167931419140e-01   -1.139700377607625e-01   -6.353840181151085e-02   +3.445713133817301e-01   -1.191450317001118e-01   +2.112434480999809e-01; +1.194031840107292e-01   -1.667457781700456e-02   -2.367407787079512e-01   -1.756065499533310e-01   -5.265619692508241e-01   +2.693818141808561e-02   -4.799527092494023e-01   +1.229317098388581e-01; +4.897819029556380e-02   -1.211184871778817e-01   -1.622917679126748e-01   +2.518071462453497e-01   -4.747337283695807e-03   -2.181559254857799e-01   +2.675331529346111e-01   +5.405673525020638e-03; +3.335141112189580e-02   +3.384586666400381e-01   -3.537929143992372e-01   -1.407562402501182e-01   +1.756872859641985e-01   +1.237736298612706e-01   -1.738326909087794e-01   -1.497724153832024e-01; +1.078376009333238e-01   -4.357855194954603e-01   -1.612183760109493e-01   -2.119817995986259e-02   +2.349098709847686e-01   +1.624071547375578e-01   -4.864455886185214e-01   -1.205477746130789e-01; -1.304555260226773e-01   +4.220920374844958e-01   +1.112423209897982e-01   -4.645713353580299e-01   +1.602741902193680e-02   +1.054624062262933e-01   +3.216288724901037e-01   +1.921734594796209e-01; +3.827757041029831e-01   +1.451037044279393e-01   -1.877588470629014e-01   +1.131610659919774e-01   -2.923371854480050e-03   -2.929871810952311e-01   -2.026401333526056e-02   +6.884161296871001e-02; -2.608924056338227e-02   -1.514620451646072e-01   -1.728590350678409e-01   +1.075594825598942e-02   -2.036450686820212e-01   +1.513397127177823e-01   -2.886915399340186e-01   -2.061611715232929e-01];
L2I_L3I_iGABA_netcon = [-1.932503890494231e-01   -2.386070430244538e-01   +1.759754890722921e-02   -1.012285606027273e-01   -3.125402129607762e-01   -5.927876955813867e-02   +4.840063155487237e-02   +2.623632058438775e-02; -2.185649028953185e-01   +1.425479382322667e-01   -9.235266993057265e-02   +1.969789096553661e-01   +1.495916672535873e-01   +5.810402077774260e-02   -1.737587487825941e-01   -2.292965744567129e-01; +6.515612717128140e-02   +1.408139254435054e-01   +3.619952635531417e-01   +1.499814640839050e-01   +4.273731657230477e-01   +2.826687771793659e-01   +6.167402873273300e-01   +3.588914735500864e-01; +2.454456874398684e-01   -3.621330943189753e-01   -3.751714761701427e-01   +2.828376692437577e-01   -3.198313323213829e-01   +3.799482417282266e-01   -1.398001342645117e-01   +5.492025850347693e-03; +1.166605575804104e-01   -3.299867269004216e-01   +2.450528348740921e-01   +6.705234226311435e-02   +1.996997666432485e-02   +4.808515908898646e-01   -2.954940638246537e-01   -1.036497166729304e-01; +3.483654497190635e-01   -2.834251636217452e-01   +2.041483324441631e-01   -4.442625844318656e-01   +1.055748996416371e-01   +7.202459131007674e-02   +1.000726252895084e-01   +2.488916541976861e-02; -7.990680540631839e-02   +1.434774698697882e-01   -2.158644953817078e-01   -1.343432817044623e-01   -2.563454193667411e-01   -1.771181211615923e-01   -1.735724794891893e-01   -1.907331529267798e-01; +2.433133745139820e-01   +6.760736371172107e-02   +1.615499379627496e-01   +2.134288500591856e-01   +4.114988060828575e-01   +1.596044782916420e-01   +1.124948324059289e-01   +2.063821492259009e-01; -2.904801619943685e-01   -9.226685404570822e-02   -3.436076279152812e-01   +3.524818960988496e-01   -5.171918033767214e-02   -1.487130655325425e-01   -2.431646562218470e-01   +2.984435086968552e-01; +8.717634591570367e-02   -1.434327308717115e-01   -2.250612685907559e-01   +4.107045196196358e-01   -1.279087367815307e-01   +2.663054534368034e-02   -1.060221395403640e-01   -1.215907753622796e-01; +3.345170091129026e-01   -8.168591476238189e-02   +3.233226045370352e-01   +1.006363836967046e-01   +9.540501570152109e-02   -2.773681648063004e-01   -1.015363956116597e-01   -3.226703082405458e-02; +1.255703498360871e-01   -2.616615230433714e-01   -1.491672465282872e-01   +4.599597354901731e-02   +1.183845015812438e-01   +2.218868980179712e-01   -7.123034591830449e-02   +3.445720046584655e-01];
L3I_L3E_iAMPA_netcon = [-3.139130991489307e-01   +2.156255403817156e-01   +3.347410217710797e-01   -3.558059534119341e-01   -1.339384476875767e-01   -3.694702474726406e-01   -6.851914942431203e-03   -3.319846951109222e-01   +7.567719393575341e-02   -1.107332087793849e-02   -6.415408069244342e-02   +1.267069023706158e-02; -3.261471551462289e-02   -1.908156785863052e-01   -4.363686822106528e-01   -1.867526520947647e-02   +3.211172765287865e-02   +8.502785061105844e-02   -3.226559219195114e-01   +5.029692990405679e-02   -1.304513390728557e-01   +2.460240206765357e-01   +3.024709623938578e-01   -1.046418463716438e-01; +7.018107547865036e-02   +2.841247829063742e-02   -3.173685094327411e-02   -4.203761496639737e-03   +4.367507235887252e-02   -1.714933840368056e-01   -2.420667899891774e-01   +4.045750910245761e-02   -2.420895677792744e-01   -1.854912168937786e-01   -2.983734136321448e-02   +3.086611356897067e-01; +1.846127069280238e-01   -1.984502962841118e-01   +7.212238272028873e-02   -8.325920303846737e-02   -3.443844759149634e-01   -2.362429196185753e-02   -1.183429993830741e-01   -3.373950090468625e-01   -2.078999641330877e-01   -2.809806828487513e-01   +1.400522303969071e-01   +3.821355515078825e-03; -2.871983350206409e-01   +3.059753013941692e-02   -5.928495377925044e-03   +3.120031007387923e-01   -7.258049406495673e-02   -8.488126532468221e-02   -3.908379904041860e-01   +3.602772627058118e-01   -4.430045661943180e-02   -1.556402803557652e-01   +3.075935039558972e-01   -1.378373886749890e-02; -5.208379626014537e-02   -7.410450271029015e-02   -1.320963687193429e-01   +1.553925698194324e-01   +1.891022032982354e-02   -3.200327836417025e-02   +2.734332840355929e-01   +5.849411376200711e-02   -1.089016584260773e-01   -4.450567390246296e-02   +9.024136853392725e-02   +2.636201472289911e-01; -2.686671263805383e-02   -3.180438151695290e-02   -2.523344974489951e-02   -1.193363325261959e-02   -6.397586479694008e-02   +6.551225333409709e-02   +1.369225884295187e-01   +1.497015672507897e-02   +1.313682166031616e-01   -1.665400887966673e-01   +1.379631858922577e-01   +4.057853126182958e-01; +2.334023818852759e-01   -1.547133568750418e-01   -1.017012839656360e-01   -9.023158452387525e-02   -3.179577917850723e-01   -2.015679238094103e-01   -3.304262195879407e-01   +1.118471448721552e-01   -3.154092199744114e-01   -1.189168892402664e-02   +3.137500880658988e-01   -1.258107754124885e-02; +1.836922782269803e-01   -3.809047283130210e-03   +2.694829922750964e-01   +1.383849816211180e-02   +1.362360600688335e-01   -1.014613153163942e-01   +7.940963332584602e-02   +9.883934319579499e-02   +3.387070539041412e-01   -4.192965634998334e-01   -7.329895884913562e-02   -4.874333436770564e-02; +2.282395824367413e-01   +2.566551080363366e-02   +2.204099925974748e-01   +2.703616692509664e-01   +2.871850431570011e-03   -1.453905469311809e-01   +7.866371946472270e-02   -1.000755135536582e-01   -1.427440790063036e-01   -7.023758203677974e-02   +2.376069481412998e-01   +1.875669011454676e-01; +1.749123224846750e-01   -9.666971828543942e-02   +3.507834673323933e-01   +4.299532721372904e-01   -7.657878350649461e-02   -6.942472286454272e-02   -1.341178966072337e-02   +1.252410302365252e-01   +1.606288191795319e-01   +3.239221061048823e-01   -1.692576552393178e-01   +3.786306793992873e-02; +7.043640102311821e-02   -3.768340462284370e-01   +2.796580025055021e-01   -1.236598233876196e-01   +4.669823542654810e-02   +1.521477586199494e-01   -1.440240965577353e-01   +2.224797234772588e-01   +3.709247739731124e-01   +1.557552744727553e-01   -2.294867507652847e-01   -2.389406309603133e-01];
L3E_L3I_iGABA_netcon = [+2.128047655517630e-01   +2.568044843513979e-01   -3.042492697518019e-01   +1.396011100122851e-01   -7.155637376511967e-02   -2.547165436685943e-01   -1.392172211914678e-01   -4.190204360987353e-02   +2.530397002369988e-01   -2.774353938246048e-01   +2.021155152790720e-01   +2.655455712675592e-01; +4.980531188671573e-02   -9.629879608252845e-02   +1.025809822385824e-01   -9.366102312428509e-02   -1.207087265413961e-01   -3.178382798823223e-01   -4.611643879414911e-01   +1.875120334251306e-01   +4.432678094604967e-01   +1.195033861277475e-01   +3.935255361823682e-01   -9.532270919069674e-02; -3.265226705173232e-01   +2.525394495403521e-02   -1.622972042508474e-01   +3.611523920710220e-01   -4.119556902567455e-01   +1.893562106596679e-01   -3.287861742354377e-01   -7.775912899493945e-02   +8.785436818431747e-02   +2.709356913804167e-01   +3.879728856499651e-02   +7.465784726775482e-02; -3.017059756938600e-01   -6.931724952885873e-02   +1.226745153953298e-01   +2.964009374525038e-01   +7.394454007329115e-02   +5.924787566417880e-02   -1.034804071240292e-02   +5.360683433148120e-03   +8.209111308885168e-02   -3.356969462255172e-01   -5.859011760404580e-02   -1.412178168099059e-01; +5.654615535617631e-02   -1.440386411027728e-01   +2.913913425230585e-01   -1.667568260563956e-01   -4.289375645005102e-02   +1.090104862786967e-01   -3.055158996728366e-01   -3.493016074814559e-01   +1.017196302711100e-01   -3.491378308528638e-01   +1.615012487528617e-01   -6.887085663182362e-02; -1.933994293277594e-01   +1.271865811715492e-01   -4.281115649040474e-01   +2.652540979759982e-01   -2.496763891316810e-01   +3.805714759251972e-01   +8.214603895774014e-02   +3.960286241904385e-02   +1.919196472086473e-01   +3.620472453127260e-01   -6.962415604159315e-02   +1.562699256277537e-01; +2.938579574635990e-01   +2.637618190021834e-01   -1.819991758615090e-01   -2.274486486103543e-01   +1.289504603469110e-01   +6.757748416843541e-02   -1.798148815730064e-01   +8.329115092402510e-02   -2.929816854705299e-01   -1.532854268929660e-02   +2.448312056731977e-01   +1.072623443879162e-01; +2.854313281566829e-01   -1.211322050102727e-01   -4.608621370305870e-02   +3.784218693348449e-01   +2.103091101494013e-01   -4.293730901867726e-01   +7.421098146427885e-03   +4.837070598887541e-01   -1.288959911443118e-01   +1.500689374126352e-01   +7.502534246426826e-02   +4.229654449221631e-02; +3.090060585972210e-01   -3.178985840878568e-02   +1.206392312679363e-01   -1.527072169978008e-01   -2.119605442919415e-01   -3.491448340086635e-01   +1.357287908750060e-02   +3.634934812867675e-01   +2.576638724674921e-02   -3.029510768908994e-01   -3.638811502702644e-02   -1.854388084755525e-01; -1.460179713176954e-01   +4.854214920418609e-02   -1.219265807635432e-01   +8.157779238147074e-02   -1.176973918514085e-01   +3.504303390125484e-01   -1.982638245931780e-02   +1.444730739259571e-01   -3.123816158558576e-01   +2.396739749642742e-01   +4.969680333816637e-01   +1.469147723742210e-01; -3.082864389661708e-01   -1.683863997208583e-01   -4.431581041503239e-01   -1.599519292413192e-01   +4.531362034586870e-01   -1.693216430769993e-01   +4.427079724417159e-01   -5.770347503312193e-02   +1.292859493981577e-01   +3.301375173275611e-02   +1.107857524595978e-01   +2.627552141023745e-01; +1.565693969801369e-01   +7.291352786268691e-02   -1.280937749724572e-01   +1.930458496301544e-01   -3.298657455085153e-01   -1.368146798502473e-02   -1.806177061249353e-01   -1.663278269782340e-01   -9.396475664814143e-02   -2.613051120538576e-01   +1.906366311651530e-01   -1.637649560685551e-01];
L2E_Input1_iAMPA_netcon = [+9.664733289771704e-02   -1.082287012177818e-02   +3.823538825337719e-01   -1.707021617932167e-01   +1.382103292866416e-01   -2.617597229015082e-01   -2.498521535635913e-01   +3.244760912402241e-01];
L2I_Input2_iAMPA_netcon = [-1.027228165427529e-01   +1.634074788619694e-01   +2.532730941216785e-01   +7.098561985313484e-02   -3.050124144801928e-01   +3.851344149827354e-01   -1.829497396548744e-01   -6.300696267589004e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
