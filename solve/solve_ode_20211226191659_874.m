function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.782075507407778e-01   -5.380745456076320e-02   -2.021024183458226e-01   +1.826832303917657e-01   -1.588689451911215e-01   -1.918601526561997e-01   -8.844351892417182e-02   -6.688890096209113e-03   -1.022179296499547e-01   +1.508031120483509e-01   +1.872012342107199e-01   -2.517204735269165e-01   -1.788201855417098e-01   -8.592579724169712e-02   -1.062230334977340e-01   -1.580138491195862e-01; +4.938515104416751e-03   -1.388542374132375e-01   +1.212084105073551e-02   +3.723624212815566e-01   -2.054771589755852e-01   +2.583843679123387e-02   +1.092175683491774e-01   -3.584734035999901e-02   -5.421948192241947e-02   +2.009516903295836e-01   -8.861309848676621e-02   -1.350547881203748e-02   -5.514156221022876e-02   -9.428502975742811e-03   +3.896042801831006e-01   +1.148316579874488e-01; -7.506899099146948e-02   +2.408577688037814e-01   +5.720129292332272e-02   -4.664693823007359e-02   -2.656235077256139e-01   +1.978477292383645e-01   +1.916273475129201e-01   -1.161369945406420e-01   -2.062499802828353e-02   +4.954045826372386e-02   +1.422094366281011e-01   +6.962212009997401e-02   -4.119751254952211e-02   +2.812633492042608e-01   +5.527282720454864e-02   -2.315547925223454e-01; -1.594212575304913e-01   -8.443457979479069e-02   -1.415270879949084e-01   +1.495903131406617e-02   +6.698917339443240e-02   +1.169389052406693e-01   +3.012130815808208e-01   -1.618440157694922e-01   +7.765689640631344e-02   -1.377115171501120e-02   +3.189665219778950e-01   -2.440052105663789e-01   -5.253511509502859e-02   -2.522354999318499e-01   -3.725118325674870e-02   -4.925205869092694e-02; -3.352341943921150e-01   +7.898286969004334e-02   +6.027432340053811e-02   -2.332671296486283e-01   +1.851966490823571e-01   +2.340997715524590e-01   -3.208389260360552e-01   -2.304875099981535e-01   -1.573533792066365e-01   +1.295457507207110e-02   +1.634679678710732e-01   -2.709347947693912e-01   +1.640353131927303e-01   +2.836658492113466e-01   +5.661703981175631e-02   +3.426321113438083e-01; -6.696259804157516e-02   -3.271603969576238e-01   +1.110718622871907e-01   +5.193162310728924e-02   -4.695914318594169e-02   -5.922448105621145e-02   +2.143414401328443e-01   +1.098318599521236e-01   +3.391389980691135e-01   +1.019043201738005e-01   -1.112052184042401e-01   -5.063955838702246e-02   -8.252644572801546e-02   -1.404981830795544e-01   +1.401854997170126e-01   +2.140923423431308e-01; -2.708253963248796e-01   -3.059413249310967e-01   +3.193556123232403e-02   +2.759539969919449e-01   -2.248429173044615e-01   -1.715171460090366e-01   -3.324088018641649e-02   +2.035315602747612e-02   +3.866851807077028e-01   +2.724397545219530e-01   -1.281662492916619e-01   +1.170546498388418e-01   +4.122445670007938e-02   +6.816254959136511e-02   +1.801855105327934e-01   -6.985602363093735e-02; -1.265813901033394e-01   +2.164033692361555e-01   +4.400190518699640e-02   +3.171706605033639e-02   -9.883280245273071e-02   -2.558990664557168e-01   +1.492622428182515e-01   -1.817206090718521e-01   +2.024090664784181e-01   +7.971936383780268e-02   +3.083363749909111e-02   -6.484095296650352e-02   +1.122717138272088e-02   +3.599066853018378e-02   -1.421968979154124e-02   -4.390034746977316e-02; -2.713634402948904e-01   +1.672246927365391e-01   -8.160641741580635e-02   -3.721849926538374e-01   -2.788816397892300e-02   -4.802808246151383e-03   +1.384320157551774e-01   +7.386460204158032e-02   -2.619794232387550e-01   -1.018022370216087e-02   +2.588880245885074e-02   +1.026073542680774e-01   +2.248536827861364e-01   +5.847063017082248e-02   -1.533925687659048e-01   +6.725687511873467e-02; -4.017095363263762e-02   +5.921774318020581e-02   -1.769049445893020e-01   +1.858367085899209e-01   +1.754158136236368e-01   -5.411650336195366e-02   -1.396336305003699e-02   -1.491098153250790e-01   -6.428071360921958e-02   -6.262410905498920e-02   -1.770283662690029e-01   -9.380447538234143e-02   -3.920783849028101e-01   -1.373475621466467e-01   -1.343716456538406e-01   -2.607231981253828e-01; +5.902041190719180e-02   +4.833694346142096e-02   -4.185115097294499e-01   -9.281925131963938e-02   +9.777861098458347e-02   +1.738220949800131e-01   +2.194169125523996e-01   +8.074297998592710e-02   +4.877302574457569e-02   -8.843385267635606e-02   -3.811277904296516e-01   -8.742613754118572e-02   +1.791420156551006e-01   +2.082279140701192e-01   -6.764259711511275e-03   +2.042812629918850e-01; +3.303543868293835e-02   +1.610765659185210e-01   +4.151631130620798e-02   -2.691041914163393e-01   +2.252112655490338e-01   +6.452125880665220e-02   +2.708315124715486e-01   -3.584601622844383e-02   -6.691488304513211e-02   +5.634845747414403e-02   +1.545560366926982e-01   -3.484927277449580e-01   -1.520355331878639e-02   +7.888336549223605e-02   -7.809831833128660e-02   +6.423215875245609e-02; +5.996849086280516e-02   -2.029163506974683e-01   -1.688178607626886e-01   +1.222673288370742e-01   +1.637411825124707e-02   +1.442034620648317e-01   +1.272319326270203e-01   -1.030294077113043e-02   -3.375068969100283e-01   -2.826095712345544e-01   +1.231199426556622e-01   -6.813366115492554e-02   +9.763285572185780e-02   +2.662101920594501e-01   +1.028073026685641e-01   +1.547803998372470e-01; -2.255588211253644e-01   +3.704178700468748e-01   +2.815967407151022e-02   +1.562235102129187e-01   -6.445953152073990e-03   +1.973066530473140e-01   -1.376598369138564e-01   -5.683514034888354e-02   +3.347015434183762e-01   -2.433337293839852e-01   -2.954161026909782e-01   +1.575163134500772e-02   -3.150557172256874e-01   -9.656222662196884e-02   +1.962101949307871e-01   -1.164319807766176e-01; +7.173624818374652e-02   +2.197968130645327e-01   +3.407419237672049e-01   +7.548457945065520e-02   +2.613820781878521e-01   -4.608519793750439e-02   -2.477589914964269e-01   +3.068450194886801e-01   +2.512491574123852e-01   -3.727874325369060e-01   +1.122027659774208e-01   +3.517873171180209e-01   +2.101309111609732e-01   +9.442009850369940e-02   -1.318622178042972e-01   -1.724684393611717e-02; +3.908110869467175e-02   +9.283216920570496e-02   +2.900584187768027e-02   -5.719242261330894e-03   -2.200598010842821e-02   +2.892076641461261e-01   -6.712671258092151e-02   +2.498825127858439e-01   -1.336560870378722e-01   -1.734221095574798e-01   +8.197344482740940e-02   +1.951105952374717e-01   +1.491513321612194e-01   +1.305517021424965e-01   +3.449256795813750e-01   -2.474722893909030e-01];
L1E_L1I_iGABA_netcon = [-6.554996617208533e-02   +4.456784010116542e-02   -1.267563398735577e-01   -1.258916681985723e-01   -2.554495930209576e-01   +1.387377170292237e-01   +1.739112203738608e-01   +2.394772218356974e-01   -3.914511145190228e-02   -1.174069040855992e-01   -5.818902518612508e-02   +2.985438140390599e-01   -1.185292462679242e-01   -5.979715815052797e-02   +4.995086203431426e-02   +8.829098318483969e-03; +4.312468434286221e-02   +9.521389144002032e-03   -7.137267877582611e-02   -2.531840170052704e-01   +8.153505503385561e-02   +1.604907510097262e-01   -1.876673109700168e-01   -4.645810515544088e-02   +2.582381293139095e-01   -1.107239214232236e-01   +1.203674642788211e-01   +6.043884252959062e-02   +2.685748327324422e-02   -7.823883845241061e-03   -5.670471597550773e-02   -3.475500297273131e-01; -3.041453631544278e-01   +3.190058719588127e-01   -8.468368734379297e-02   +3.496672021321529e-01   +3.488115724469456e-01   +8.829176624916911e-02   +1.684021978070645e-01   -1.672602314675352e-01   -9.299954408736491e-02   -7.890661795427843e-02   -2.070444016245143e-01   -7.319661686150269e-02   -1.668307064281113e-01   +5.911391771561374e-02   +1.169487431145362e-01   +2.388975299262912e-01; +1.971774907219528e-01   -2.884821597708628e-01   +1.856681836852382e-01   -3.899820540097948e-01   -2.739167723769348e-01   +9.950774206303804e-02   +7.914916410965460e-02   -1.965001756964930e-01   +2.579494979218827e-02   +1.633490729058508e-01   -2.445424735426301e-01   -2.723733216628378e-01   +2.392091126530061e-01   -1.162203730535910e-01   +1.440142593319852e-01   -3.403424935944722e-01; +1.834986925919081e-02   +5.987458397358229e-02   -2.644820229644896e-01   +8.893983825758875e-02   +8.471607968826216e-03   -6.898720305482828e-02   +1.256558796656719e-01   +3.346074011216802e-02   +5.308498131753984e-02   -9.182296227142583e-02   -2.018403683161950e-01   -2.496900254789231e-01   -2.064872949964657e-01   -2.853655380197494e-01   +1.053995871224371e-01   +5.509165227141776e-02; +7.309829384150579e-02   -3.913768282144945e-01   +1.014213471430277e-01   +1.967998812276433e-01   -1.368269606363063e-01   -4.102217172313842e-01   +1.080580559412921e-01   +5.097392059870440e-02   +2.840597744752534e-02   -1.046434732482804e-01   -6.333740970680095e-02   +9.744376043831419e-02   +1.081031342105786e-01   +1.857354638693443e-01   -1.237577899796587e-01   +1.617892856095682e-01; -1.286793526151242e-01   -1.511535747758551e-01   -2.154364567352251e-01   -3.900014889569193e-01   +1.440931887111386e-01   +1.605462004600566e-01   -1.992667990914987e-01   +1.693191231724097e-01   -7.291550081364762e-02   -2.909809433862263e-01   -1.504703744003306e-01   -4.398622078775360e-02   +1.422830262506761e-01   -8.152797971067262e-02   -2.068584913509641e-03   -3.345683261265920e-02; +1.829170641520362e-01   -4.979417396257476e-01   +4.025798437553237e-02   +4.091906251204752e-01   -3.127805734309677e-01   +3.561863400529348e-01   +1.931922539933680e-01   +2.076346808327710e-01   +2.340562804540766e-01   +3.689652050447735e-01   +1.516320590796252e-01   -4.640313485059296e-02   -3.119830439835036e-01   +3.274744520816226e-01   -2.750178693791305e-01   +4.304489864445460e-01; -4.654547398633002e-02   +2.043056894716620e-01   +2.518707049031141e-01   +3.220447697898903e-01   +3.057736721975443e-03   +2.557600930185712e-01   -1.793344782433335e-01   -1.341470605847022e-01   +8.755791690083473e-02   +1.137589176887604e-01   -3.572982607396800e-02   -1.494152578777092e-01   -1.071415112768651e-01   -8.461952732267577e-02   -1.330095193703048e-02   +2.925932247201177e-01; +5.931400545537521e-03   -1.921265581805478e-01   -5.034171524257627e-02   -2.107992839919252e-01   -1.651562899017398e-01   +3.529001204916479e-01   -6.310112791454534e-02   +1.072927670854775e-01   -6.622392133930201e-02   -1.973627931892076e-01   -3.807586624141855e-01   +6.509104687984335e-02   -3.282510123961931e-01   +1.709459042911977e-02   +1.386254342593415e-03   +4.169305508429254e-01; +1.155238294497891e-01   +2.350403798338780e-01   -8.256217083833034e-02   -3.411969589190099e-02   +9.938475634341662e-02   -4.138661156157156e-01   -5.888710001717885e-02   -2.399545431668655e-01   -1.360841245655333e-01   -1.165246508589551e-01   +1.110217987839053e-01   +1.991678672589227e-01   -2.758080385257194e-01   -1.648311883389857e-01   +1.422590684102973e-01   -3.293513113229403e-01; -1.107962898289692e-01   -1.233355075544405e-01   +2.290023345210556e-01   -3.528820430698570e-02   +1.831184072753022e-01   +3.966538402160803e-02   +3.885279326056058e-01   +1.288849206626843e-01   +8.707052573212050e-02   +2.524611262386444e-01   -8.311699966677139e-02   +2.481943214379522e-01   +5.702961581305782e-02   +6.003974130297585e-02   +2.583617563567051e-02   -5.966333789030862e-02; +4.228793666151474e-02   -1.818811839409016e-01   +1.184246462024820e-01   +1.944331654560156e-01   -1.185585484157282e-01   +2.034345701982402e-01   +6.094683123270091e-02   +3.822440596408521e-01   -1.229848002497609e-01   +6.846591227005777e-02   +3.174480364482843e-02   +3.706535513509529e-02   +7.060359413716791e-02   +8.311799369036768e-02   -9.273432449001853e-02   -2.310174149278799e-01; +2.111139513445375e-01   -1.777692164060999e-01   +8.657657750130476e-02   -4.090079720716652e-02   -4.385759468776201e-03   +4.052835283328203e-01   -1.622560510782008e-01   +3.063282484006355e-01   -1.948856895280510e-01   -1.424820584569841e-01   +1.687963346370691e-01   +7.034669894262952e-02   -1.389122891099154e-01   +1.836413766633658e-01   -3.005280831190820e-02   +4.649415460725065e-01; +1.090729966495503e-01   +4.765894531422402e-01   -5.138827128952757e-02   -2.485880323291026e-01   -2.910141286407924e-01   +1.634554179722141e-01   -1.954789242500759e-01   -6.336149333065794e-02   +4.696187995105193e-01   -9.263655549732329e-02   -2.314298634913929e-01   -3.148439826942107e-01   +1.383920673936986e-01   -2.939544285540577e-01   +3.660158023811585e-01   +3.375933422544345e-01; +2.516539018120418e-01   +2.060244154323377e-01   +5.219018549530610e-01   -1.262182139404272e-02   -2.749865257993547e-02   +5.812705957600325e-02   +1.442120500236209e-01   -3.242316971404720e-02   +1.265792217105149e-01   -5.122442582716581e-02   -8.507989995127696e-02   -1.419611511331594e-02   +8.172934814924798e-02   -3.461829744123214e-01   +3.208878213869398e-02   +2.114161356466130e-01];
L2I_L1I_iGABA_netcon = [-2.264547214985936e-03   +1.076179759565674e-01   +1.830845899767205e-01   -1.914799292516599e-01   -3.034315080160187e-02   +7.996785542273530e-02   +1.002753232114852e-01   -2.613904414787005e-02; -1.358234790801185e-01   +6.420395564275400e-02   -2.554198389441493e-01   +1.989514493427663e-01   -1.053963375840175e-01   -1.900075195388434e-01   -8.945270405756413e-03   +1.161856262278411e-01; -1.247993593362486e-01   +1.271138926309386e-01   -2.379471584989640e-01   -3.795818822580348e-01   +2.892928078796956e-01   +2.812380910398437e-01   +1.152996514204963e-01   -1.817738197962158e-01; -3.861442224055502e-01   -1.238371801973630e-01   +2.191010256694724e-01   -1.737980740417464e-02   +2.487863172120590e-01   -1.766496158142910e-01   -2.168306471325420e-02   +1.448499891881790e-01; -1.376960037515639e-01   +1.737515278639485e-01   -7.187562779557813e-02   +2.492884502727907e-01   +1.462522271206439e-01   -1.307006582004173e-01   +1.582106351811598e-02   +1.042653159846247e-01; -2.310979359585318e-01   +9.745677771392150e-02   -4.961099439453700e-01   -1.792746449679742e-01   +1.358676451840424e-02   -1.748455654242096e-01   -7.049929761504009e-02   -7.453514926923874e-02; +8.236990860515980e-02   -1.438750536053591e-01   -2.761101928034519e-01   -1.993948248149263e-01   -5.653052477498221e-02   -2.410118038047698e-01   +9.783677484814697e-02   -1.797809187351554e-01; +2.232635554037996e-01   +3.919878600617450e-01   -1.272378653830129e-01   -8.769520428611066e-03   -1.873544575089920e-01   +2.444736998363366e-01   +3.618433463415369e-01   -1.713334303886332e-01; -3.263027461690569e-01   +2.064800649206131e-01   -4.577271600971891e-03   -1.317810764171135e-01   +3.120809453315426e-01   -1.366089624249371e-01   -1.123074749449654e-01   -2.102983675150361e-01; +2.300818575513260e-01   +5.212207054042978e-02   -2.308802841229986e-01   +6.169834284778081e-02   -2.940200475672243e-01   -1.555137897978459e-01   -3.716766639668853e-01   -1.384986312590650e-01; -9.873090645453828e-02   -3.360438864237846e-01   +6.077494746885391e-02   +1.685635234730523e-01   -4.495255690453022e-02   -5.179040347557501e-02   -2.023208514724893e-01   +5.744168928130217e-02; -1.006642855285881e-01   -1.521073851976330e-02   +3.511391295608413e-02   +3.767383536469074e-01   +2.131969492410085e-01   -2.325826142796376e-01   +9.480462741674869e-03   +2.591891631607877e-01; -1.378924201724333e-01   +2.550739605078939e-01   +1.078613008027451e-01   +4.405321360992798e-01   -3.343494727613470e-02   -1.052159697508347e-01   +2.899243187644204e-02   -3.573473243551132e-01; -1.856629104038685e-01   +1.162834739131910e-01   -7.706362670691815e-02   +6.122678313042192e-02   -1.592002943477371e-01   +1.991237845367796e-01   -4.709437468310179e-02   -3.355766502506743e-01; -3.100076919245308e-01   -1.884988001194640e-01   -8.884622952302151e-02   +1.271059345789166e-01   -4.173205834923047e-03   +7.019214378175748e-02   -3.262809657037413e-02   +7.734980231705753e-02; +3.723108014791591e-02   +4.845691811567389e-02   +2.015349028558644e-02   +2.921033449617875e-01   -3.978802518552093e-01   -2.521824992177498e-02   -2.863762433699160e-01   +8.629794351342354e-02];
L1I_L2I_iGABA_netcon = [+7.931406069357917e-03   -1.977033793854786e-01   -1.447732741128355e-01   -1.246347220071860e-01   +3.217011093177768e-02   +2.583068923527338e-01   -3.077110658707777e-01   +1.091678484935564e-01   +1.164474532275276e-01   -2.527584727721676e-01   -1.372916815402938e-01   -1.985769294954848e-01   -1.368904430324712e-01   +3.564547223602408e-01   +7.683960681328583e-02   +1.150252261014021e-01; -7.734175669699164e-02   -1.756636432070393e-01   -3.262296406081407e-01   -1.778161709575627e-01   +2.168318554796980e-01   +2.294428679447524e-01   -2.538240938449222e-01   +1.323224586743560e-01   +2.284209561476679e-01   -1.167704145911711e-01   +2.465030901650130e-02   -4.968866256366823e-01   +9.024664194992538e-02   +3.294016349698188e-01   +1.366275577507262e-01   +1.381872825344922e-01; +1.584254599488289e-01   -1.425803874768679e-01   +1.346637215935650e-01   -1.562226728529112e-03   +2.548622152653373e-01   +1.397085538609304e-01   -1.835193311691232e-01   +2.235096214378997e-01   -1.660291415348555e-01   -1.357813790817442e-01   -8.923955638094302e-02   +6.662701675775082e-02   +7.642191504469038e-02   -5.550242246794666e-02   +1.197457754844226e-01   -2.690383815868854e-01; +1.973997271459001e-01   -2.552288407185857e-01   -2.550625509946081e-01   -2.507047303580071e-01   +2.025912401780202e-01   -5.213541450401592e-02   +4.068086541332693e-01   -7.607016774862073e-02   -3.792715303163950e-01   -2.845950611092467e-01   -8.527754347058834e-02   -9.030212094057324e-02   -6.027252965343688e-02   +2.036851393464024e-01   -1.184258280346408e-01   +5.127968256631193e-02; +1.444173822890841e-01   -7.692542864434689e-02   +3.733829390639646e-01   -2.061535960656016e-01   -1.609374555340286e-01   -1.620194264957634e-01   +1.781730086337204e-01   +3.588134114108303e-01   -3.513085507238207e-01   +4.529955590263482e-02   -5.979509147897814e-02   -2.449092497052928e-01   -2.500602267460383e-02   -2.848779577362409e-01   +5.174619686606069e-03   -6.808468676268978e-02; -7.976076994946173e-02   +1.561229738150576e-01   -6.228340260021277e-03   +1.874070252780115e-01   +2.192080457981876e-01   +9.700716213639750e-02   -2.696297037402653e-02   -3.942000583567459e-02   +2.988572270784236e-01   +1.900670624078491e-02   +1.084097637232447e-01   +1.317027286748688e-02   +1.629198525725047e-01   +6.011868593583436e-03   +7.016365630107067e-02   -1.171346116731167e-01; -1.132323702126286e-01   -2.555900333567589e-01   -1.288660927630361e-01   +4.913932843862275e-01   -1.446710881589583e-01   -9.048928678952968e-02   -7.390646921495683e-02   -1.221664437988110e-02   +1.069275244225003e-01   +7.931625554017874e-02   +2.461202688545536e-03   -2.108208613492938e-02   -4.141675672022408e-02   +3.824623882554844e-01   +5.628082546174154e-04   +7.669546282115200e-02; -1.331539492081469e-01   -1.352517870198214e-01   -2.228575952040134e-01   +1.463295313906800e-01   -4.323772693965472e-03   +2.356535489522716e-01   +1.511508128202272e-01   +1.883856492802929e-01   +7.476319189200692e-02   -1.484459554524424e-02   -2.998537709490012e-01   -1.611163681343766e-01   +1.160515107460407e-01   -1.731930356140409e-01   -3.273382827156566e-02   +6.671608647930774e-02];
L2E_L1E_iAMPA_netcon = [-5.616941540116728e-02   +1.050011954765390e-01   -1.219622423025486e-01   -2.588415352967414e-02   -1.679970648465221e-01   -3.131552156259917e-03   +3.911799812974886e-01   -5.256035395533232e-02; +1.507330518839183e-01   -2.185434308062615e-01   -1.739769187527474e-01   +6.038298587478248e-02   +3.457992985067651e-01   +2.082836861113504e-01   -1.351797141572881e-01   -3.615461722601174e-01; +5.376310058459760e-02   -4.180774569886322e-02   -2.073508653048233e-01   -6.374803413935307e-02   +2.325243498995640e-01   -1.255611134884428e-01   -6.066300221303807e-02   +1.356097073985124e-01; +2.011339218659564e-01   -6.328780764188462e-03   +1.657390872556299e-01   -1.443542571935466e-01   +6.524814705062601e-02   -2.987690670910206e-01   -1.109427124598322e-01   +2.333296989370648e-01; -1.561138811065874e-01   +5.136783311766564e-02   -6.859981339286814e-02   -5.987133026213889e-02   -8.622854927018292e-02   -2.420797253277001e-01   -1.626346929837068e-01   +3.818181623810532e-02; +9.346162022184093e-02   +1.177434011073640e-02   +4.729241038967863e-02   +9.133911890168667e-02   -1.060874293384051e-01   +2.732911498825797e-01   +1.373231023643691e-02   +3.265072417623244e-02; +2.029580183507791e-01   -3.078115816930840e-01   -8.652816932263269e-02   -9.156362739628124e-02   +3.348735397324737e-02   -2.707621148592647e-01   -2.724906497404467e-01   -2.836531088239421e-01; +2.024945700431570e-02   -1.660038989691749e-01   -7.003189176060630e-02   -2.282879190248809e-01   +3.280071820739766e-01   -2.671722251706361e-01   +1.144988008249796e-01   -1.162802804051465e-01; +8.974963182232176e-02   -5.925583714391677e-02   -6.536127184662618e-02   -1.020795759227411e-01   +2.210228025310368e-01   +1.733706620722777e-02   +4.601994743774976e-02   +2.981793267333267e-02; +1.021544099699571e-01   -3.279318152673533e-01   +1.940520092970094e-01   +3.428639375221235e-01   -1.380118463576226e-01   -4.570711600368332e-02   -1.211138722474635e-01   +9.973877355015681e-02; +2.738274601005116e-02   +3.859432175556411e-01   -2.208712919479748e-01   +3.291693459921198e-01   +1.490027064773014e-01   +3.049846554922762e-01   +2.312559427418390e-01   +8.333742097226968e-03; +1.519068609481346e-01   -2.293187708762407e-02   -1.530750906288973e-01   -1.752420779199985e-01   -7.620403367968298e-02   -1.061489418407083e-01   -2.475017891372064e-01   +3.144905225061552e-01; -6.776665561826775e-02   -6.720459004731016e-02   -4.887401445409995e-01   -1.192333421931634e-02   +1.533053093539144e-01   -3.319153562091081e-01   +5.243709679098923e-02   -1.586106407293660e-01; +2.099872803344214e-01   +5.137413991065656e-02   -1.080975961210418e-01   -6.513958181444877e-02   +9.655730194834669e-02   -7.957638880275371e-02   -2.031701079505314e-01   -1.728232801653480e-01; +1.006041559015088e-01   +7.446774224540571e-02   +1.563181554290746e-01   -1.773176925810896e-01   -1.876445114423067e-01   +1.264977460323103e-01   +3.765838392882680e-02   +4.865183916488214e-03; -1.538825514231458e-01   -1.722853779427814e-01   +8.462282903872477e-02   +3.432025966676087e-02   -1.463443739623271e-01   +4.255132487064366e-02   -2.725969078771398e-02   +5.076427332444571e-02];
L1E_L2E_iAMPA_netcon = [-2.437214936331146e-02   -1.926863277966762e-01   -1.790338202814017e-01   +1.583546743783908e-01   -1.231473019209093e-01   -9.303194991503655e-02   +7.027552559796106e-02   +1.005659520461201e-01   -1.175246657391584e-01   -3.731798153874148e-02   +9.861365595306860e-02   -2.063695279252690e-01   +1.326913323093407e-01   +4.243632451733910e-01   +2.076171368859901e-01   +4.161611496227022e-02; -5.789445365444025e-02   -1.743023231645411e-01   +9.877137014688739e-02   -4.148878516032059e-02   -1.900531321473133e-01   -1.030711645530437e-01   -2.720525133603596e-02   -7.780671504249692e-02   -1.568575746295651e-01   +1.920798148356104e-02   -2.708343654969652e-01   +1.767369943728194e-01   +2.096257526007997e-02   +6.123473988905138e-02   +4.232328631373804e-01   -6.740836733197830e-02; -1.151033837032407e-01   -7.543319771256672e-02   +2.281999032778765e-01   -1.617677664414987e-01   -2.207276949557112e-01   +1.449633632167956e-01   -1.474982569683106e-01   +3.198650336545430e-01   +2.749205664349931e-01   -4.518224984725455e-03   +1.461096559868352e-01   +2.792214255706024e-02   -2.113221401444066e-01   -2.411280910807778e-02   +3.493455463813211e-01   +5.742379941208381e-03; +1.732979483360807e-01   -6.340234188567051e-02   +2.513938905942913e-01   -6.184892924121817e-02   +1.449810012201458e-01   +2.611144016478962e-01   +1.035335518596948e-01   -6.333299720438224e-04   +9.538869196075388e-02   -4.898680539310563e-02   -3.263696212158162e-01   +7.078567089338267e-03   -1.337842979237932e-01   +8.285848654298705e-02   -7.968300554811285e-02   -1.831033229682950e-01; +2.659011250281746e-01   -1.979412886230947e-01   +2.061959283427973e-01   +1.223145345146595e-01   -9.416138823448032e-02   +6.546763343143434e-02   -6.599353695574312e-02   +3.847844493498755e-01   +1.744757497746093e-01   +2.268363225971626e-01   +1.825538042582230e-01   -5.019067382549825e-03   +3.143292003151265e-01   +1.396546852138056e-02   -5.107755163301749e-02   +2.171638839185404e-01; +1.232555864741372e-02   +1.943836141020346e-02   +8.903013527941496e-02   +2.205620371900156e-02   +1.113686375923544e-01   +7.631420844202255e-02   -6.553587319309848e-02   -4.573153986747594e-02   -2.338323154106922e-01   -2.326507755740699e-01   -1.174078375613913e-01   -5.682266877661304e-02   -1.747921548536798e-02   -2.806267845485846e-01   -1.887785341156304e-01   -7.232063429456813e-02; -1.440716870837216e-01   +1.055105186087247e-01   -2.100021859713735e-02   -2.434686081822652e-01   +9.995484330097550e-02   -1.041197732099815e-01   +1.118239929201456e-01   +3.730650967494763e-01   -3.829276171127766e-02   -3.930085538524740e-02   +2.693890281714316e-01   +7.030779855735954e-02   -2.688226895614519e-01   -2.336115939541196e-01   +2.828509255499750e-01   +7.170575010844872e-02; -7.004899677217216e-02   -3.710691023966216e-01   -1.724840561390266e-01   +4.126637659616541e-01   +1.474904265797607e-01   +2.237755641946779e-01   -6.408229541915200e-02   +4.030471107921642e-01   +2.463095322126771e-01   -6.725654404909286e-02   -5.555851161254885e-03   +3.383951391222778e-02   -2.411111095000551e-01   +1.142442319780980e-01   -5.100725548416907e-02   -5.187007218749117e-01];
L2I_L2E_iAMPA_netcon = [+3.300257213640658e-01   -8.991295299361893e-02   +3.019451567563865e-01   +1.958863146267152e-01   -1.625822453649628e-01   +1.139175486109648e-02   -3.025056979998239e-01   +1.625017228407744e-01; +8.776120134369544e-02   +1.257086103453079e-01   +5.418554602668417e-02   +7.052162089244074e-02   +5.914278512397205e-02   +9.893693607698470e-02   +2.643185772413192e-01   +2.267563430628423e-01; -1.045433957629597e-01   -1.328166686436245e-01   -2.973681401241302e-01   -7.985442999619019e-02   +2.351504488283782e-01   -1.575261923198818e-01   -2.624341395963279e-01   +1.122305186438161e-01; +5.832024278565007e-02   -5.446792781614703e-02   -1.838408252253334e-01   -1.197549523167179e-01   -9.601311685462584e-02   +2.012489992461538e-01   -1.854349430866518e-02   -1.463231696009058e-01; -2.324345645713240e-01   -1.426790843890806e-01   -3.619130194545097e-01   -2.083166984902846e-02   -1.062234051302079e-01   -1.592995074954638e-01   +1.378967119637526e-01   -2.004761469957853e-01; +3.642660765896994e-01   +9.353575095110382e-02   -2.316196584795795e-02   +9.999061761229107e-02   +3.285695474686136e-01   -3.898559391344605e-02   +1.675385693245416e-01   +1.586399643071428e-01; -2.983379946223368e-02   -1.029006124378659e-01   -1.032383663251153e-03   -2.868676394588006e-01   -2.451453742840700e-02   +4.779360761454823e-02   -1.710532517697913e-01   +1.720957626335779e-01; -2.788037744574963e-01   +7.763891828804580e-02   +5.212345687519734e-02   +4.816591760813822e-01   -1.264262270214507e-02   -1.969481011917965e-01   +2.120281183458658e-02   +2.544646242901225e-01];
L2E_L2I_iGABA_netcon = [-2.247092752682945e-01   -3.428605418818772e-01   -1.111496362395901e-01   -3.738934800995248e-02   +3.260282851917106e-01   -2.555618626759426e-01   +1.051882571319493e-01   +3.459546678604208e-01; -8.879084077272408e-02   +5.014173791448293e-03   -2.018965673588285e-01   +1.673146349029533e-01   +2.367892873450974e-02   -1.564023453842735e-02   +2.092216467579159e-01   -1.376756067616294e-01; +5.023913538808215e-02   -3.119673275046191e-02   -3.006386555273886e-01   -1.858757995052785e-01   +3.927820850617829e-02   +1.386850290252750e-02   +1.360883342230654e-02   +1.805732862477900e-01; +3.528857467251049e-02   +1.665403696055623e-01   -2.525098516485377e-01   +1.743687636260426e-01   -1.289929986466453e-01   -5.948483196015038e-02   -1.623102952291902e-01   +8.777519311167035e-02; +1.133717463524404e-02   +1.679470179298493e-01   +2.052645524737796e-02   -2.002300618886250e-02   +2.090353754438760e-01   +1.283060186667523e-01   +4.991587271352209e-02   +1.471115462310967e-01; -6.911517916825408e-02   +1.512322713610140e-01   -1.679251424798472e-01   +2.083638861288669e-01   -9.663658351263570e-02   +1.339972509473865e-01   +2.427260791530291e-01   -2.995947986682218e-01; +2.646420308425942e-02   -1.011259351455884e-01   +2.068649821609301e-01   -1.155764340525944e-03   +9.231929975716796e-02   -2.746734261254262e-01   +4.543577024119540e-02   -1.109440285911750e-01; +4.437202165651893e-02   +3.558666704576975e-01   +2.144558421230044e-01   +8.553869767476902e-02   +9.198515283807948e-02   +2.491789310545114e-01   -1.831405737176389e-01   +6.534123740342451e-02];
L3E_L2E_iAMPA_netcon = [+3.857578805757941e-02   -1.596867738614870e-01   +2.508880928830298e-02   +2.093762287427826e-02   -1.191758043774432e-02   -4.804722607486746e-02   +1.257097178044715e-01   -1.854199391202382e-01   +6.129797079498392e-02   -6.080692225193925e-02   +3.133645595056600e-01   -7.012248445721708e-02; +1.022300299576147e-01   +2.066262062911230e-01   +1.817744192134516e-01   +1.819498588692344e-01   +1.000456101746948e-01   -5.070657072979660e-02   +1.464190808024478e-01   +1.045986215174464e-01   -2.430191038669844e-01   +1.106979224348317e-01   -6.600310947922652e-02   +6.721156142652285e-02; -8.425929596039813e-03   +4.135153815255659e-01   +4.028194120435955e-01   -1.243734133679054e-01   -1.279090738194347e-01   +3.508506261943837e-01   -5.784919675093417e-02   +9.229665651517108e-02   +3.492613703790984e-02   -1.005985533682805e-01   -1.132172377049626e-01   +1.324524892124378e-01; +3.979949316207750e-01   +1.173749311664112e-01   -1.837004345353550e-01   -1.854066620754278e-01   -4.646682809823650e-02   +1.435542269305637e-01   +2.125006339812172e-01   -1.103962651659105e-01   +7.484221136307191e-02   -2.682878226075880e-03   +1.601719623801484e-03   +1.654655450122050e-01; +8.633033170655967e-02   +2.147218675457333e-01   +2.365911997721454e-01   -3.655525710991694e-01   -9.822263463496499e-02   +2.625865389442145e-01   -8.180294395662449e-02   -5.519181609425141e-02   -9.498293641767086e-02   -1.400986365936014e-02   +1.403735621278137e-01   +1.294274737643039e-01; -1.435205029076813e-01   -3.233163674152478e-01   -1.416107937133012e-01   +2.416691886348833e-01   +1.564120228494986e-01   +1.352185614824447e-01   -7.315886230342539e-02   -1.309027186007459e-01   +1.038141345976135e-01   +3.547715453342776e-02   -7.021725709992066e-02   -2.822121390286342e-03; -2.743644459942270e-01   +1.800723130293429e-01   +2.626265049530588e-01   +1.265396460572358e-01   -1.983054190421308e-01   +3.117681954251560e-02   -1.303491918820250e-01   +2.220448920786326e-01   +1.805146184098771e-01   -2.910784866401698e-01   -3.172482139380757e-01   +4.269015300722498e-02; -1.985872461827256e-01   +2.755203506779684e-01   -5.110619861725302e-02   +1.335462290675050e-01   +3.713208126022510e-02   -2.311424910558818e-01   -2.126244298410885e-01   -2.117279405866405e-01   +1.387011682207410e-01   -7.318480526751348e-02   +7.224606065588532e-02   +2.262425676536925e-02];
L3I_L2I_iGABA_netcon = [-1.961710035029146e-01   -1.380797366024546e-01   -6.262591030158790e-02   +1.170563939015931e-01   -1.796732673963822e-01   +3.722203487165694e-02   +2.163057865957911e-01   +1.008327785050620e-01   +1.910963356745581e-01   -1.669452463096276e-01   -3.365836941362374e-02   -1.105191627619428e-02; -3.841631337147781e-01   +1.550705054607620e-01   -1.095878515254984e-01   -2.850632683459043e-01   -8.340343718466979e-02   +2.627858413214926e-01   +1.895634003216037e-02   -1.928565905979640e-01   -2.605165352942892e-01   +3.517606393414936e-02   +4.908807242862682e-02   +4.803273587628623e-02; -1.690977919872966e-02   +8.435997180230828e-02   +1.794914493528093e-01   +6.521104666113688e-02   +3.440930265857053e-02   +9.894334533959437e-05   +1.067183160618856e-01   +1.632663792721241e-01   +1.643053229799932e-01   +3.271189572822059e-02   +1.115523920439650e-01   -7.615229125578048e-02; +1.786028098005218e-02   +6.814846659054921e-02   -1.069970039742807e-02   -2.542839320311820e-01   +1.192825069658105e-01   +1.968565282201711e-01   +4.004752449707105e-03   +3.826485555928347e-01   +2.588541583203573e-01   +9.934604968973249e-02   -3.889817394608580e-01   -2.274752772841957e-01; +2.310695458491662e-01   +2.904351653638197e-01   +2.521077099704382e-02   +1.372125535853208e-01   -1.432963676444903e-01   -1.154477562851063e-01   +1.606220452100953e-01   +1.140720878773212e-01   +1.009434939566878e-01   +2.249085837798420e-02   +5.677604775538737e-02   +8.571891750862587e-02; +3.100265858284411e-01   +3.348884693081741e-01   -1.140667770358027e-01   -3.146420972784934e-01   +8.665714567147677e-02   +1.780714929613696e-01   +7.826310092451247e-02   +1.991570669616679e-01   +1.319271238184282e-01   -1.313881434340031e-01   -4.679089962161140e-02   +2.221716381343384e-01; +7.991265573562156e-02   -9.052024283710244e-02   -6.314862886049953e-02   +1.214171959924750e-01   +8.002079985022437e-02   +9.787270508926542e-02   -4.448728006823588e-02   +1.318285759937530e-01   -9.706870988595737e-02   +8.120736188321209e-04   -2.116784260720804e-01   -6.839598284941133e-02; -2.954793220037801e-01   -4.250827907584153e-01   -8.028565854362510e-02   -5.275905565623557e-02   +5.282292766260376e-02   -9.512422557463798e-02   -7.999850416823114e-03   -1.624596535720518e-01   +1.067648583385361e-01   -7.851535244983858e-02   -3.235121177063229e-01   +4.402210492143774e-02];
L2E_L3E_iAMPA_netcon = [-8.239984659679706e-03   -1.514336787631008e-01   +2.202893119707277e-01   -1.095672816028497e-01   -7.566572115590041e-02   +1.564849901953362e-01   -9.724973634302081e-03   -4.227224468773245e-01; +2.145520128004555e-01   -9.353867023515530e-02   -4.197964255302583e-03   +2.872401070427257e-01   +1.330470483552980e-01   -6.757224310894785e-02   -1.377150740791112e-01   +1.414177077750591e-01; -3.664458623928081e-02   -1.056330573099195e-01   -3.691363144681603e-02   -2.022273375282901e-01   +3.942365289919612e-02   +7.094565778084019e-02   +5.063953246624783e-02   +2.378209627679082e-01; -4.202518582965216e-01   -1.328493851745693e-01   -2.753177457791092e-03   +2.049112568579268e-01   +1.131885013381314e-01   -1.646442558460252e-01   +1.356852257927393e-01   -1.633573486761033e-01; +3.125821809570211e-01   -2.476248306217564e-02   +4.702659995791947e-03   -1.687269004013477e-02   -4.233443008613155e-03   -1.398105615525725e-01   +1.935470186245005e-01   -5.988164413626825e-02; -8.536514072446501e-02   -1.241069599712263e-02   -4.441509724756613e-02   -4.020092234791046e-01   -3.402592335186746e-02   -1.393489585249213e-01   +2.782312410798388e-02   -2.985954878659206e-01; +2.205737494647076e-01   +2.467405778027132e-01   -9.267975970521878e-03   +1.897301687952603e-01   -4.051026001430397e-02   -8.344122021477417e-02   -1.784408510839423e-01   +1.275519499839184e-01; -1.900965163845014e-01   -2.298540614459026e-01   +1.891770267546136e-01   -1.912899950027373e-01   -5.730609333810729e-02   -2.290306152235932e-02   +5.433559755192822e-02   +1.888549115638840e-01; +5.101039240131057e-02   -1.200938191524977e-01   -2.176017527420772e-01   -2.324726323362450e-01   +3.654772058279797e-01   +7.199929507599608e-02   +2.906519174556710e-01   -2.259837551031632e-01; +1.958366939956783e-01   -9.152231845033579e-02   -2.287566258881111e-01   +2.109322668940710e-01   +1.166406282887814e-01   -3.669967820742540e-01   +6.574883138586474e-02   -2.036883015539360e-01; +3.536199513649867e-02   -3.065918341248811e-02   -2.040811587847569e-01   +1.870730313032913e-02   -1.174000813986141e-01   +5.566289374175228e-02   +2.328416570295710e-01   -4.622798014663735e-02; -1.390085660021738e-01   -9.737321412814104e-02   +4.412782634220180e-02   +9.531991692670365e-02   +1.347318183781467e-01   -2.254322172203674e-01   -7.664209860014708e-02   +1.115200424734307e-02];
L2I_L3I_iGABA_netcon = [-2.242141161104038e-01   +5.695812379281297e-02   +3.756998872506729e-01   -8.471278853551967e-02   +1.691538671837956e-01   +2.770517766686697e-01   -2.532011014686173e-02   -1.647801520526607e-01; +5.404119183543096e-02   -1.855495789069803e-01   -3.054643123719449e-01   -3.908672555415306e-01   +1.536198226193504e-02   +4.618550571705866e-01   -3.782242288567723e-03   -2.903308398405957e-01; +2.867742825080813e-02   +4.628635239317543e-02   -1.153854712424902e-01   +1.494864564030441e-01   +2.618254904600974e-01   -3.973995153627814e-02   +1.953696355649333e-01   +6.856435415713558e-02; +4.956405192018716e-02   +1.168117892095620e-01   +1.894582964133281e-01   -3.195268617437785e-02   -4.562210712210435e-02   -2.288912018511355e-01   -1.841915771699849e-02   -3.928696840037520e-02; -2.238541011001576e-02   -5.161557694930159e-02   +2.101991827303951e-01   +8.403622176183501e-02   +1.711015184849599e-02   -1.050760911301853e-01   +8.314573118113305e-02   +3.955271040791752e-02; +1.745679639114137e-01   -1.427480687504668e-01   -7.664033125745900e-04   -1.215851392304661e-02   -1.156835305211554e-01   +1.892979676368980e-01   -3.909149661136719e-02   +2.814402587761161e-01; +1.064381168063239e-01   +5.060007047312032e-02   -3.859356683949308e-03   -4.109561640129934e-02   -6.714649408745774e-02   -4.148066353600888e-02   +1.094994861360647e-01   +2.184606859619532e-03; -5.142983676627125e-02   +2.372845271504209e-01   -7.594200167136111e-02   -2.615991561800265e-01   -2.748907132787938e-01   -6.155733196355781e-02   +2.946556421846700e-01   +5.744802810165038e-02; -1.680357065473420e-01   -3.089992307933681e-01   -1.834437372118352e-01   +2.493737766088634e-01   +4.482560547530696e-02   +1.812532140553047e-03   +1.385830693030785e-01   -2.627944000934318e-01; +1.318634789875862e-01   -3.053470121518417e-01   -1.310780979484933e-01   -9.459860105452889e-02   -3.710587875833360e-02   -3.349535052995076e-02   -8.696456291690829e-03   +1.736830527170545e-01; -3.205371675234041e-01   +7.609551887833249e-02   -2.778329082265137e-01   -4.043165994682546e-01   -1.114352401777033e-01   +1.353876553376421e-01   +2.261242341826870e-01   +3.934155150928877e-02; +8.013380752513363e-02   +9.718060453920810e-02   -6.925432645917784e-02   +1.374729239323098e-01   +9.884584782218112e-02   +9.685645378164931e-02   +3.791955442084161e-01   -2.937775585185719e-02];
L3I_L3E_iAMPA_netcon = [-1.282228928957592e-01   +8.090941921468657e-02   +8.905549134277291e-02   +2.611873068561511e-01   +7.971213875703714e-02   -5.428568858326870e-02   -9.234112821899046e-02   +1.174020579708155e-01   +1.657965664302634e-01   +1.951373444885887e-01   -2.703168436110660e-01   +3.072465585229743e-01; +1.493718321913595e-02   -9.987237886274286e-02   -1.637104205670320e-01   -1.051462094117740e-01   +9.318300610008232e-02   +2.051585729675623e-01   -1.355272980674246e-01   -1.587117082975134e-02   +2.158546151658194e-01   +3.933506246913159e-01   +1.395290878002250e-01   +4.396458220231746e-01; -4.877234752278119e-02   -4.030174545066811e-02   +1.712064595514015e-01   +2.037111521287385e-01   +7.771997658284771e-02   -2.148774527455308e-02   +1.177784714833348e-01   -9.359439532208430e-02   -5.720446049692163e-02   +9.932679855682949e-02   -1.683419652064284e-01   +3.087556171245043e-02; -2.237935929035998e-01   +4.570837828136561e-02   -2.021154236277349e-01   -3.718826483206313e-01   -2.224974860571025e-01   +2.771901801560304e-01   -2.961095988948961e-03   -4.879850485347849e-01   +2.677392898395370e-01   -3.155666219878890e-01   +1.366360660900082e-02   -8.411464680144273e-02; -1.888217308200217e-01   -4.083985589638067e-02   -1.924506727900766e-01   +2.566012862964476e-01   +8.755542653483367e-02   -1.181150431498117e-01   +3.461127925596385e-01   +7.126878893799093e-02   +2.182944134526489e-01   +6.325031180702613e-02   +2.609101392915087e-01   -5.172517065428632e-02; -1.427997496149987e-01   -7.655811425711492e-03   +1.182217106407368e-03   +2.417544182268608e-01   -2.830873275071948e-01   +3.955475230599679e-01   +2.396641461137398e-02   +2.164804698456100e-02   +1.758901047652690e-02   -2.469515658345755e-01   +5.896557802740343e-03   +3.605238275397932e-01; +2.519759829004704e-01   +8.231670780161912e-02   -8.684052948422796e-02   +1.588795681349772e-01   -9.298427242603460e-02   -1.848869691890922e-01   -2.725580971744225e-01   +9.188901804066511e-03   -1.198613282420086e-02   -3.836791538269196e-02   -1.498469877340855e-01   -2.571944263907746e-01; -6.442331693337811e-02   -2.232629202157846e-01   -2.588580188384322e-02   +3.569485154151007e-01   -7.245818691821926e-02   -6.271526703573511e-02   +3.107707661175008e-01   +3.587422867583678e-01   +2.347359893889653e-01   +1.024574262735140e-01   -8.356890233294025e-02   -2.325623004563710e-01; +1.030857337585487e-01   -1.816578256399430e-01   +2.122045887033207e-01   -7.200556105800729e-02   +6.278455808971460e-02   -3.709232042359831e-02   -3.023664742000953e-02   -6.834469448602429e-03   -1.983074065592989e-01   +1.436577317401224e-01   -1.844772902453127e-01   +1.661562271041961e-01; +7.573487930509723e-02   +9.153627492974119e-02   -1.652902038488687e-01   -2.460389314018351e-01   -6.793613912532526e-02   -1.803494738256000e-01   +6.701262334042793e-02   +1.323905877951914e-01   -2.946917156160961e-02   +1.471425463897264e-01   +1.649999043391781e-01   +2.207487125387420e-01; -8.764700065030258e-02   +1.329356767227198e-01   -1.440184007396108e-01   -2.116729496383978e-01   -1.026330686608551e-01   -1.906765349200350e-01   +1.929405472831633e-01   -1.603942839597350e-01   +1.343095524572813e-01   -1.646409062927342e-01   +3.250286108478703e-03   -9.278506264931860e-02; -2.623641962745109e-01   -9.569944735442981e-02   -3.698175756321254e-02   +1.531723925951342e-01   -4.850516157621760e-02   +2.938256856216473e-01   +3.506547655932375e-01   +6.712161876181905e-02   -1.951618695146114e-01   -3.195485075378170e-01   +7.311802845661422e-02   -1.961594400362760e-01];
L3E_L3I_iGABA_netcon = [+1.363902464141765e-01   -2.230172457527190e-01   +1.681048680289185e-01   -1.422797494729625e-01   -4.113525334310481e-02   -1.566285974397464e-01   -1.896129479005318e-02   -1.521959310446017e-02   -1.753783303083503e-01   -3.084230139127529e-02   +2.319056477110070e-01   +9.516028130607529e-02; +2.322823008215424e-01   -1.782768696495799e-01   +2.163734291711902e-01   +1.542505760046640e-01   -3.453785045909156e-01   -1.676971493631417e-01   +7.578388759715374e-02   +2.290998439180773e-01   -2.667873369017218e-01   -2.448065205821347e-01   +1.419968528221767e-01   -4.480998504359396e-02; -1.864687471658912e-01   +1.292440820259886e-01   -9.500638359742379e-02   +3.865414359468272e-02   -2.923514170084331e-01   -2.792265636099813e-01   +2.308736971717979e-01   +1.829254962660622e-01   -1.578968796235641e-01   +3.182649479516259e-02   +3.305738657820744e-02   -4.190915844994548e-01; -1.584318333569378e-01   +5.831142160035103e-02   +1.720682970449783e-01   +1.370924070985355e-01   +4.211061532597123e-02   -5.717250466755580e-02   -1.483383600858353e-01   +3.676619643244552e-02   -1.405960430705700e-02   +2.882777370177522e-01   +2.424763043354015e-01   +1.269294919497669e-01; +3.796614469800877e-02   -2.307953472688203e-01   -2.069754167136080e-01   -1.476666565094005e-01   +1.743035557025784e-01   +2.577848376572919e-01   -3.886055305028249e-01   +3.198237185697808e-01   +1.727282859603019e-01   -4.811758523822865e-02   -3.876132951812915e-01   -1.112748121718416e-01; +7.308501202689544e-02   -1.519229465742839e-02   +2.216228530650831e-01   +8.675763361283140e-02   +2.395674606469368e-02   +3.431519316318071e-01   +3.387505746398578e-02   -6.003138690379335e-02   +3.840852999758490e-02   -3.676076272575959e-01   +3.831579676543738e-01   +9.973120435623054e-02; -2.004384370293974e-03   -1.376455825455100e-02   +1.991894332603180e-01   -2.118711404612184e-01   -2.573415763491415e-01   -3.785860465459868e-02   -7.791275148318555e-02   +5.057336820229769e-02   +3.050536443532904e-01   +3.810278830889059e-02   +3.111996243849227e-01   +4.641704168831469e-02; +5.976428859746571e-02   +3.384171831512319e-01   -1.844326903477243e-02   +1.599236061351967e-01   +6.337968760570548e-02   -8.900189739409733e-02   -1.731420413095174e-01   -1.800475585135466e-01   -4.093230622971559e-02   -1.749958234059374e-03   -1.763901469077818e-01   -2.316272273829550e-01; -2.318804463279373e-01   +3.310716238283890e-02   +5.744865452312659e-02   +1.691120063932155e-01   +1.548300168765288e-01   -1.471081478109805e-01   +1.971355764032887e-01   +8.572716525343915e-02   +7.678635740944444e-02   +1.229504008946934e-01   +1.155785909116507e-01   +1.791160245443165e-01; -2.283441909068791e-01   -6.243536692278741e-02   -1.147829767734832e-01   -5.560597729445109e-02   -2.536376480363174e-01   -3.170119414766145e-01   -8.913072337043873e-02   -1.142843563347512e-01   +1.439089718329807e-01   -6.216978313975727e-02   -7.251551489115327e-02   +3.981137435389186e-01; +2.086618878144968e-01   +4.002574359084927e-01   -2.746650386436050e-02   +2.023080960231897e-02   -3.213147629255130e-01   -3.040348893996765e-01   -6.958480144748785e-02   -9.518782326623994e-02   +3.374361302596308e-02   -1.766916447727986e-01   -2.809061303690120e-01   +2.127021767378736e-01; +6.412389969951890e-02   -1.023338254583694e-01   +2.202289224731857e-01   -1.852105094665014e-01   -4.163451267835309e-01   +1.783396028564883e-01   -1.573286586135376e-02   +3.320226659916280e-01   +3.652518044329687e-01   -1.521611997196183e-01   -3.452353803521046e-02   +3.189748799376228e-01];
L2E_Input1_iAMPA_netcon = [-1.123464348486736e-01   +2.057751497567900e-01   +1.766162534142042e-01   -1.356239221280471e-01   -2.198226453143030e-02   +1.321536459379326e-02   +7.386421029288021e-03   -4.141091300992375e-02];
L2I_Input2_iAMPA_netcon = [+1.734007656995457e-02   -8.569051387481963e-02   +3.350713786588279e-02   -2.719889911823968e-01   -3.805601989082058e-03   +7.883670178982116e-02   +1.589402277687150e-01   -2.437594851951042e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
