function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-4.957904675693900e-01   -5.687098044741251e-01   +1.703651769164430e-01   -1.184233889050497e-01   -5.259972832432599e-02   +6.830001376668411e-01   +2.771469027782296e-01   +7.889531623513779e-01   +3.519291096719915e-02   -2.163669448851479e-01   +6.957920095036356e-01   +3.482994706763875e-01   -4.522066467729462e-01   -4.508079854279352e-01   +6.873142237694825e-01   +6.367244079548906e-01; +6.288165262879054e-01   -4.464214718094839e-01   +7.203094785940677e-02   +4.346396077194992e-01   -5.754147958046627e-01   +2.787550844369619e-01   +9.177941200182078e-01   -5.082893813036241e-01   -3.650473733947483e-02   +2.404460570000369e-01   -7.939802776676689e-01   +4.049993938547350e-02   -2.009166266546454e-01   -5.638357105032630e-01   +4.949596459753711e-01   +6.137010324881492e-02; -6.978765232796367e-01   -5.962132505930747e-01   +1.237930441016756e-01   -6.525282980854082e-02   +3.734535817338993e-01   -5.318193684409076e-01   +4.920752469887040e-01   -6.239281811235198e-01   -4.664873249531774e-01   -2.810486633506066e-01   +4.579668010780440e-02   -3.166716895815204e-01   -1.506945951589387e-01   +5.085631742467076e-01   -4.187489211195224e-01   -5.340223428491577e-01; -5.772382392694176e-03   -2.671071689141284e-01   +2.730231179204554e-01   -1.486849164485947e-01   +2.273579631562163e-01   +5.014467734384827e-01   -3.814910540175953e-01   +5.498308735387154e-01   +4.090987141653537e-01   +8.529054074578428e-01   +7.975235508561154e-01   +2.857122766959950e-01   +1.361191447622844e-01   +1.645507252378998e-01   +1.150928708059357e-01   +6.978175536693654e-01; -2.307916498464232e-01   -5.221802464595704e-01   +9.832155866719045e-01   +4.177522554590218e-01   -1.879286662352487e-01   +3.275872482736184e-01   +3.799896035376439e-01   +7.881561414481524e-01   +5.293555743246438e-03   +2.063954942042489e-01   -4.663508731412814e-01   -4.367681702550274e-01   -5.625661059905817e-01   +5.835927126873781e-01   -5.818980720733762e-01   -8.343709824141206e-01; +5.810228440504801e-01   -1.524147573244806e-01   +5.555062836505202e-01   +6.428447813900439e-01   -1.190631197132926e-01   -1.486466157384453e-01   +1.634031863314408e-01   +2.295786356323500e-01   +1.800662583474780e-01   +6.731021370429302e-02   -7.995883121962265e-03   +7.346350047179042e-01   -1.687426675812415e-01   +2.456624813962172e-01   +1.000000000000000e+00   -4.975864413917988e-01; +3.135410889833851e-01   +5.546338720986561e-01   +6.538512277885585e-01   -6.426489093968959e-01   +7.494624385470253e-01   +6.083985057492466e-02   +4.131057872672023e-02   +6.797742287480408e-01   +4.415074070507339e-01   +6.509888905823673e-01   +2.823707396138602e-01   -6.412366909906733e-01   +2.463999736894410e-01   +5.133249737289330e-01   -3.390328544656858e-01   -4.382652964981990e-01; -1.197568044139000e-01   +6.312295548227505e-02   +6.376343634603353e-01   -3.573719539680952e-01   -3.610031504506129e-01   -5.425477674108574e-01   -7.925870581116460e-01   +5.824029332174482e-01   -4.954449208769237e-01   -1.409051641670927e-01   -3.165433941679173e-01   +6.737725576148756e-01   -3.850622781537681e-01   +7.058871329304993e-01   +2.757087254539510e-01   +9.897554869489733e-02; -3.207443272219519e-01   -4.839690611134261e-02   -5.076205577056815e-01   -3.894834595154694e-01   +5.015822127763594e-01   -2.070512644403023e-01   -3.003366225991912e-01   -2.073204402211732e-01   -4.319715290156882e-01   -2.803399125737133e-02   +9.843535786740357e-02   -3.420825371932817e-02   +2.016225406898571e-01   +1.390082457614497e-01   +4.402898772683684e-04   -1.094375350430941e-01; +1.178208130306266e-01   -5.822861280053463e-01   +6.179258284396226e-01   -1.236715428528955e-01   +1.078282140033325e-01   +8.841755771183218e-02   -4.454068239472943e-01   -6.904459344297581e-01   +4.142989542703424e-01   +3.804891854618168e-01   -4.142683071962523e-01   +3.837792287771414e-01   -1.988800833259139e-01   +5.655467637173081e-01   +9.090317125832139e-01   +3.681026948090012e-01; +4.087841150412874e-01   -1.784635236502619e-01   +3.047137463842995e-01   -1.562164953265388e-01   -4.029387114884727e-01   +2.491920802470194e-01   -3.341735083512153e-01   +3.106202242832343e-01   -6.151020126181459e-01   +2.168077854136742e-01   -1.186417603558194e-01   -1.357015056445253e-01   +4.669924018999555e-01   -1.405775383457223e-01   +2.475028746570170e-01   +3.513450925292189e-01; -3.842950814809405e-01   -6.442241909067874e-01   +1.334045685062687e-01   +1.846251411518580e-01   +4.838686948882656e-01   -2.841586144225325e-02   +1.775178712678468e-01   -8.116460872857293e-01   +5.692570311411420e-01   -4.588006150014419e-01   -3.496510045037207e-01   +3.222130247674356e-01   +4.373672596959875e-01   +1.568631376605355e-01   +4.611318781162166e-02   +1.735027212117893e-01; +1.175813322697905e-01   +4.762831526459305e-01   -3.302681860639139e-01   -4.448753867847529e-01   -9.810503794242446e-02   +7.284562406184603e-01   +6.720324408502309e-01   -3.098366177473606e-01   +3.439919420907595e-01   -5.659077069970111e-02   -5.053914279272370e-01   -2.128125121665703e-02   -3.311449456941717e-01   -6.282060575918206e-01   -6.113630235270296e-01   -3.032926830410120e-01; +1.855495835940308e-01   +5.690876496140042e-01   -1.504965965603204e-01   -6.286032175505106e-01   -1.571420716283693e-01   -7.352523438810968e-01   +2.538555612423952e-01   -1.510954010957968e-01   +8.153077817578012e-01   -6.935003563285216e-01   +4.364589017708136e-01   +2.704393196972876e-01   +5.443416675713039e-01   +8.662001526472382e-01   +4.271603623186366e-01   -3.792474456547499e-01; +4.863459814187567e-02   +5.405805508183166e-01   -7.933961559534623e-02   +5.273139196487283e-01   -6.882151729733200e-01   +6.542977073452557e-01   +2.576272424509314e-01   -4.625836992859183e-01   +4.500071575180265e-01   -2.834728561140623e-01   -2.346517039000318e-01   +9.083695055019494e-01   -7.275440776535260e-01   +3.040451505884907e-01   +2.882951818845801e-01   -3.539094055673390e-01; -6.696738207672552e-01   +2.065773654724561e-02   -2.597295954530147e-01   -3.771825713953763e-01   +5.327355436416067e-02   -2.533190952258139e-01   -3.502047029694751e-01   -4.069742399223768e-01   -4.426312741981830e-01   -4.374549970689705e-01   -4.525326022736658e-01   -1.590353385148901e-02   +5.578852402249602e-01   -1.378335729657047e-01   +5.743336756211049e-01   +4.601889456645218e-01];
L1E_L1I_iGABA_netcon = [+2.745042018142281e-01   -6.640716344808897e-01   -3.827391858375119e-01   -6.088147941509129e-01   -3.693980899457053e-02   +1.413782073947358e-01   +3.608100297070646e-01   -1.302029082597912e-01   -5.641279363709316e-01   -1.817393660253811e-01   -7.605695574776314e-01   +1.417322912003209e-01   +5.296615011867157e-01   -4.619930869511105e-01   -3.210913728645569e-01   +4.863412800626551e-01; +9.902763680379559e-02   -5.521980770359898e-01   +4.912584043793756e-01   -6.343380478353620e-01   +4.392233490288634e-01   +5.709681709277531e-01   +8.315126240666288e-01   +7.308671197701025e-01   +1.081678095735092e-01   -4.021507147307140e-01   -1.098119234223135e-01   -1.081958630641598e-01   +4.952305483776875e-01   -3.712271281153839e-01   +7.804375056597523e-01   +6.516615858406823e-01; +1.376508235557754e-01   -7.347713627507207e-01   -1.330854900947125e-01   +7.744074468240166e-01   +3.600489841264752e-02   -4.258111894405253e-01   -2.356187139940899e-01   +1.000000000000000e+00   -4.164425825860180e-01   -6.676646173993592e-01   +4.017293365446893e-01   -2.630665313285963e-01   +2.118091080156223e-01   +8.373614820934230e-01   -3.714170007881770e-01   -1.511973551828625e-01; +6.648522726847880e-01   -4.475061610220247e-01   -1.346308018251356e-01   -6.134518422037445e-01   +2.755502160417759e-02   +4.663530353601119e-01   +2.360843304593060e-01   -3.606114594833831e-01   -6.597211856157623e-01   -1.128329307427730e-01   +2.926447766437161e-01   +2.407835856010191e-01   -5.462661520909136e-01   +2.251678449990044e-01   +6.674894183817475e-01   +6.222702797910146e-02; +7.312602082278955e-01   +2.827628824289726e-01   -5.974028532380656e-01   +5.897305696829743e-01   +6.009117803305729e-01   +6.623739695584774e-01   +5.343380589175906e-01   -3.740253555283136e-01   -6.549903327127589e-01   -8.608956259093435e-01   +2.897496545938070e-01   -6.945832609310550e-01   +1.837745852847663e-01   +7.811558021225542e-01   -5.909424617183986e-01   +4.772386648062650e-01; -9.465274672778097e-01   -5.733415668498609e-01   -2.980234077592847e-02   +4.947031763211974e-01   -8.365165143170507e-02   +2.145715010152350e-02   +5.344687391973067e-02   +9.373494818739644e-02   -5.249041623450078e-01   -7.987938788951340e-03   +5.631992937062065e-01   -9.564951276602944e-02   +3.379730141006153e-01   -3.450919821435260e-01   -3.677991289843927e-01   -5.209703867186493e-01; +5.317776270304324e-01   +4.592368592245112e-01   +5.710358424869811e-01   -1.061524215543170e-01   +3.270924459016944e-01   -4.341476726042389e-01   +6.366853610055828e-01   -7.204062909756677e-01   +6.077127489017560e-01   -1.989971634623022e-01   -6.595401487486693e-02   -2.217858416596718e-01   +7.225343018250885e-02   +6.524735117887742e-01   +8.189228570537230e-02   +7.881870789858987e-01; +3.646719305811715e-01   +9.829790999752666e-01   +3.204099201547740e-01   -3.094827123409394e-01   +6.275255050899566e-01   +3.729010290245742e-01   +9.695391922289688e-02   -4.059516095254956e-01   +3.650544344297707e-01   +9.238393775349768e-02   -2.405287563871462e-01   +7.186433842544162e-01   +7.056981759658018e-01   -7.739148967315480e-02   +7.876766186094726e-01   -1.121700688986909e-01; +1.056120889393735e-01   +1.423885394289218e-01   -5.478937294405475e-01   +7.504452759354693e-01   +5.225082182588210e-01   +3.276735065584501e-01   +6.778787454775894e-01   -6.534859859368545e-01   -4.603487388629262e-01   +9.571747311038502e-01   +2.385973734540082e-01   +5.753952892388259e-01   +6.627228918723560e-01   -4.755133841834270e-01   -3.279104841726926e-01   +7.036832634617252e-01; +3.425793083848848e-01   +4.235331770316790e-01   -2.207652973036971e-01   -2.317112217789662e-01   +6.764751684591442e-01   +1.786778208124282e-01   +1.411815370083858e-01   +7.943198904932217e-01   +6.754455372732258e-01   -7.975683070456472e-01   -5.683809127469354e-01   -5.854594236428733e-01   -1.318576980057298e-01   -2.815608878569449e-01   -4.802239110008726e-01   -6.533800116426924e-01; -2.641294724204495e-01   +1.880320983133081e-01   -5.798813103108996e-02   +1.528765195258817e-02   +1.750533827283030e-01   -5.895376303679816e-01   -3.390134887859539e-01   -1.527605664917683e-01   +3.252677235022437e-02   +2.390579694278045e-01   +8.925306441787989e-01   +3.996214255810407e-01   -6.292705646179964e-01   +1.929049926573391e-01   -7.019291677118699e-01   +2.628060384486344e-01; -1.719028418144795e-01   +5.500258873408818e-01   +6.084230105498528e-01   -4.453525579271085e-01   +2.358836328796737e-01   -2.265677863557652e-01   +4.927562786902415e-01   +6.665699298823929e-01   -1.886515522983201e-01   -2.494332635496792e-01   -3.895275365352738e-01   -2.684095574174351e-01   -5.015755956146732e-02   +7.379566017270026e-02   +2.143072886974935e-01   +3.616977119180521e-01; +9.595882658975240e-01   +4.718922630741628e-01   +2.120476512078147e-01   +2.874940826160512e-01   +3.415238709140093e-01   -2.804790394306813e-01   +1.238248354456535e-01   -7.357388505058805e-02   -8.471519552444535e-01   +3.586025187775964e-02   +8.575653007093093e-01   -5.205533894938758e-01   +2.796186598866782e-01   -6.147417517285541e-03   -3.411334897750642e-01   +1.012075849689223e-01; +7.127255714639503e-01   +2.947835822015253e-01   +1.376068159187304e-01   -5.498970898297051e-01   -6.175524805530495e-01   -6.211321515670967e-01   +5.560959974196775e-02   +6.817195956417010e-01   -1.216518168930267e-02   -6.524160545619623e-01   -3.362921689009764e-01   +7.590968111658574e-01   -2.593957126814343e-01   +6.868219210270562e-02   -2.030392751965693e-01   +3.439951222416974e-01; -5.829158878567661e-01   -4.969546156825010e-01   -2.975715065870187e-01   +1.757502821118787e-01   -4.859143904532257e-01   -3.787500748340379e-01   +1.860439436258967e-01   +8.453559294133952e-01   -4.842778558923749e-01   -1.686130087366680e-02   +8.956711094208849e-01   +5.085201710693110e-01   +2.336667468811690e-01   +5.191829399222896e-01   +5.605608805754494e-01   -6.150299907472664e-01; -2.685359234210620e-01   +9.238931840211783e-01   -3.010794844548386e-01   -5.710372552143002e-01   +7.494291406089988e-01   +4.258096011017665e-01   +3.192042703251385e-03   +8.928068659799411e-02   -4.769182450882688e-01   +6.812809074400825e-01   +5.852956608895111e-01   +4.298974904153665e-01   +1.017877803183595e-01   -2.059038838973238e-01   -3.827160711989701e-01   +2.702000990834255e-01];
L2I_L1I_iGABA_netcon = [-5.241231319080748e-01   +2.442764960490678e-01   +1.517567086817574e-01   +2.576095359906461e-01   +8.859495666032388e-02   -4.301072845408888e-02   +8.170854734026571e-02   +7.129989103851091e-01; -3.598417802824567e-01   +4.622924319707093e-01   +6.543116376406245e-01   +4.659268582093221e-01   +4.912733474724468e-01   -4.938855182289230e-01   -3.263572331156466e-01   -3.253074997137401e-01; -2.450794482544971e-01   -1.779882897449047e-01   -5.237140818517954e-01   +2.674831534706354e-01   -9.194669449053179e-01   +7.142723493832380e-01   -3.483547502279098e-01   +5.359827203914397e-01; +1.739747199266359e-01   -4.389171428072970e-01   -4.397834149976545e-01   -4.350508189319666e-01   +8.045220026970547e-01   +1.875446026413398e-01   -8.777269445748066e-02   +4.651345639989720e-01; +4.808608668717713e-01   +1.000000000000000e+00   -9.494118165438582e-01   -5.658114812486326e-02   +8.101911519455848e-01   +3.596939767565444e-01   +2.369246697741915e-01   -2.126983741720911e-01; +4.367361832195668e-01   +4.361138264006647e-01   -3.728450658069479e-01   -2.496274712176291e-01   -9.454442064570686e-01   +2.875304228994809e-01   -2.920796880060662e-01   +7.377774968579834e-01; +2.087183863837991e-01   +2.368010845187448e-01   -5.690356874741049e-01   +4.493309825848800e-01   -2.666815864003240e-01   +2.030582206667507e-01   -4.197711559794391e-03   +5.774329473861176e-01; -1.010581217172629e-01   -1.862000589204924e-02   -2.571414836757326e-01   -9.724025942482000e-01   -4.218116136502826e-02   +9.738869108649435e-01   -5.864501646242835e-01   -2.504318854359851e-01; +8.502423713916882e-01   -9.954796909834407e-02   +6.599684455287926e-02   +5.956089228779405e-01   -5.181440506236118e-01   +7.035698529509420e-02   -2.651076813266267e-03   +2.462157819702031e-02; -9.518006304686174e-01   +7.535989469643323e-02   -9.851499304770725e-02   +7.109518331866737e-01   +5.003574571886769e-01   +5.614088677176051e-01   -5.398030564383279e-01   +2.606255531340455e-01; -6.070119864445042e-01   -4.972084668278096e-01   +4.851636832291688e-01   +4.366080627316648e-01   -3.859127754800782e-01   -3.706975819440709e-01   +6.449526329528020e-02   +1.846778863112994e-02; +3.270266399034747e-01   -4.404760862858083e-01   +4.912880882696306e-01   -1.486114289528126e-01   +7.028209478614283e-01   +6.328420082501466e-01   +5.983755908098771e-01   +6.793088740418052e-01; -8.121271308558758e-01   +5.435306416653741e-02   -2.074252487063793e-01   +1.196485306043608e-01   -2.003955414515290e-01   +3.643910460763261e-01   -2.972391291889384e-01   +3.253401339298389e-01; +3.639108546843015e-01   +5.315061995965347e-01   -8.131331241299263e-01   +7.084727335032740e-01   +1.851020762268407e-01   +4.887137794222827e-01   +4.975250034420240e-01   +6.648920473279366e-01; -4.148414644318971e-01   -1.281976446730147e-01   -6.769851105770052e-01   +5.835175852758905e-01   +4.955410098335344e-02   +7.063743929554858e-01   -7.423686048614923e-01   -6.878912572695055e-01; +1.189848347253143e-01   +1.618979372016512e-01   -1.265942749736069e-01   +2.693765904390689e-01   +6.899492441677215e-01   -2.664811049447063e-01   +8.714128827906412e-02   +6.361267292720812e-01];
L1I_L2I_iGABA_netcon = [+5.204450084932787e-01   +6.768466450422275e-02   -6.808382858277100e-02   -5.368944460818823e-01   -3.729907048082270e-01   -2.799143170043241e-01   +5.964407568374747e-01   -4.763965432004222e-01   +1.827726420814332e-01   +6.840637700288299e-01   -3.684001209621501e-01   +4.912509593086165e-01   +5.992664053146137e-03   -3.928319304034360e-01   +2.152419671881527e-01   +7.263510005878679e-01; -5.657527023375959e-02   -5.178123017850589e-01   +6.118482453504165e-01   +2.787407056804213e-01   +1.403191147265697e-01   -1.250843278340795e-01   +6.411001345244260e-01   +1.087594260840945e-01   +5.679190770549625e-01   -1.103545874907415e-01   +4.837067644527702e-01   -2.346517313774246e-01   -3.467459479845792e-01   +7.978908605261811e-01   +6.972042821568164e-01   +5.944219387302325e-01; +5.583003397667825e-01   +6.470015079863193e-01   +6.539162954222992e-01   +3.637527307837646e-02   +5.215466855929403e-01   -6.282876258104325e-01   +4.067492014576474e-01   +5.826551086249245e-01   -1.850870397455325e-01   -1.884339729570157e-01   +1.668208645235190e-01   +9.954274351770453e-01   +3.744023069548155e-02   -8.458849907649177e-02   +3.746497026782807e-01   +2.506313860500233e-01; -1.421140060602032e-01   +1.828612158854437e-01   -7.022901195085726e-02   -6.783571567482252e-01   -4.444054699467941e-01   -7.204231512575540e-01   +3.398953013556593e-01   -3.229794229240131e-01   +4.522576644410244e-01   +5.262066621691635e-01   +3.568391391247169e-03   +1.189402728831687e-01   +2.367519851440624e-01   +7.030011519697144e-02   +1.000000000000000e+00   -5.335143351145635e-01; +6.233582516675229e-01   -2.445694084975890e-01   +1.534304593296155e-01   -4.744613064083908e-01   +3.052074456188029e-02   -6.257194256709995e-01   -1.254205932730319e-01   +4.098951354140086e-01   -3.238181880622236e-01   +5.116713621895750e-01   +3.422110812954418e-01   -3.006030766327210e-01   +1.804320370369471e-01   +4.684591523622986e-01   -4.681558018671967e-01   +8.225735752235915e-01; +3.497498435283204e-01   +6.589546011460955e-01   +4.165208315148484e-01   +3.360911128884069e-01   +1.901051487107311e-01   +3.338172976794974e-01   +5.932429467614028e-01   -3.611525130212102e-01   +1.757115109058144e-01   +5.572204048247936e-01   -2.475771420176794e-01   -1.426621861800049e-02   +7.021699197873791e-01   -1.196727585786429e-01   -1.071493390748777e-01   +3.239271544573230e-01; -8.284335445783456e-01   -6.394214398364350e-01   +1.012965436132586e-01   +5.379756971213201e-01   +7.812855829009993e-02   +5.128989227052027e-01   -1.607912422376202e-01   -3.358277804154417e-01   +1.030088379728012e-02   -2.461181999296385e-01   +8.127142300256753e-01   -4.441401075570872e-01   -7.526486625892584e-01   -7.193838145841024e-01   -4.495055466707742e-01   +5.698458392926703e-01; +5.888402704377529e-01   -1.009262541597331e-01   +2.021789780384627e-01   -5.635524955957153e-01   -8.336602148065079e-01   -3.244771663949931e-01   -1.387487412362255e-01   -1.275422832836355e-01   +9.493876545335238e-01   +1.577925321883059e-01   +1.793349242382848e-01   -3.830554485215010e-02   -7.754507613205965e-02   +4.360657899297766e-01   -4.985424337456716e-01   +8.784576572898111e-01];
L2E_L1E_iAMPA_netcon = [+4.874772231597844e-01   -6.589095854389181e-01   -2.109682078692300e-01   -3.059144293804988e-01   +3.064887276211276e-01   +3.067866898736212e-01   +1.600165379754792e-01   +8.474439699700703e-01; -1.872937963101822e-01   +3.729803284407403e-01   -2.646258832678799e-01   +1.833794222024282e-01   -4.756738755308243e-01   -6.294627562716669e-01   -5.095041862988782e-01   -1.037957623665596e-01; +2.054815993954532e-01   +7.423156801013074e-01   +2.925703674337035e-01   +1.699684054865651e-01   +3.470727551283918e-01   -3.308975367250522e-01   +3.324629012662181e-01   -4.096728257395363e-01; +6.435815931038720e-01   -1.829854891427730e-01   -1.854199768397450e-01   -2.102629532413395e-01   +4.945847216300423e-02   -8.223376581713820e-01   -7.313726782481813e-01   -2.203779438664185e-01; +7.012095745982194e-01   -5.246605592777895e-01   -2.478887655188977e-01   +8.093955034238873e-01   -2.860580187310163e-01   -2.590374159450892e-01   +7.836503691806714e-02   +1.198114100576161e-01; -3.819721750947879e-01   +3.862932702450531e-01   +7.402938901501279e-01   -6.845252009341339e-01   +7.219261747423812e-01   -1.877393886376104e-01   +4.916948522763290e-01   -1.310231915253981e-01; -1.402350778626984e-01   -4.467700873793207e-01   +3.960412406377501e-01   +9.826466057405582e-02   +2.119326028894994e-01   +6.078565203017088e-01   -5.504116492933604e-01   -3.446876092073515e-01; +5.346343219390136e-01   -5.791588540008263e-01   -4.600507328005204e-01   -3.032251303962752e-02   +1.888080159551819e-01   +3.403049981269377e-01   +1.190300382470262e-01   -6.036428021080253e-01; -2.102414230545318e-01   +7.046801019767744e-01   -2.166584545481704e-02   -1.016781661003430e-01   -4.965853625850013e-01   +8.984957804324910e-02   -6.411981530658841e-01   +6.168839563336260e-01; +4.675492716090761e-01   -1.500974828266937e-01   -5.601403224176768e-01   -5.247287948314588e-01   -2.444139102244482e-01   -2.421629646014434e-01   +1.808586282309236e-02   +9.931080969276106e-01; +3.395002443379587e-01   +5.491634880715269e-01   +1.060437415717238e-01   +1.540045860675145e-01   +4.004473738956527e-01   -2.448087892449500e-01   +8.066764964410001e-01   +5.551680353625556e-02; -5.280017484084989e-01   +9.663396444820894e-01   +3.478285280580128e-01   -9.080677373593047e-01   +1.700519156898190e-01   +1.891186301028728e-01   -4.076876216895216e-01   -5.074498257958841e-02; +1.216051005775875e-01   -8.736088066997424e-02   -5.447766296110849e-01   +1.788552698756979e-01   +1.590195069810760e-01   +5.242853572238556e-01   -3.277643921652062e-01   -1.814253565648457e-01; -6.075092943249333e-01   -6.672545001224930e-01   -3.854820978274626e-01   -6.502760322001496e-01   +2.704252811820105e-01   +3.673301728171935e-01   -5.293945224536186e-01   +5.559507518164851e-01; +6.013262528929402e-01   -8.996912816523696e-01   +8.664374167774219e-02   +3.010017508807328e-01   -3.219287609553187e-01   +1.000000000000000e+00   -2.940886207181964e-01   -2.025377067385316e-01; -3.609300963943375e-01   -6.980185879010581e-01   -1.896354651493180e-02   +2.766960719505750e-01   +7.712972959709379e-01   -2.093722293403238e-01   -4.011476720504355e-01   +3.208063642414566e-01];
L1E_L2E_iAMPA_netcon = [-8.771795947536527e-01   +2.688803980149366e-01   -2.922749263444705e-01   +1.546949475561668e-02   -7.682941287468940e-02   +5.787151880565359e-01   +9.753210190297019e-01   +5.003641874671569e-01   +4.227027708760211e-01   -3.752415820330796e-01   -3.127250291184451e-03   +2.056039119988215e-01   +5.795159383129938e-01   -7.620199314330938e-01   -6.976986136759449e-02   -1.445870945432560e-01; -2.903830916067263e-01   +3.633505708384691e-01   +6.661377597807534e-01   +2.861400914457297e-01   +7.715664265624603e-01   -2.667604888585859e-01   +2.151869057484182e-01   +1.825659186338142e-01   +3.099054965225791e-02   -3.538383883188073e-01   +2.952460353608102e-01   -1.043043901849976e-01   -3.515899201674106e-01   -3.762175211511513e-02   -3.718720319188056e-01   -6.717051746387608e-01; +1.723142881033884e-01   +1.609357280746836e-01   -3.420945930993889e-01   +4.684502929551234e-01   +1.477568497371330e-01   -2.239274945504053e-01   -4.479949542237970e-01   -1.859383674030748e-01   +6.345487552938502e-03   -2.328389510086542e-01   -1.357856972544714e-01   +3.105871284198150e-01   +3.623761407738845e-01   +8.156547845852994e-01   -5.416299916185395e-01   -6.795408622668160e-02; +4.982979875627742e-01   +8.806209722454217e-01   -1.287390096925517e-01   +1.465381041526277e-01   +9.791239660312795e-01   -1.027398948030011e-02   -6.520572737066181e-01   +2.371730137994704e-01   +6.726439298770538e-01   +6.441791393957546e-01   -1.634574725751626e-01   +6.782875097724751e-01   -4.670329091436791e-01   -2.222060359028984e-01   -4.902264855725221e-01   -2.637325276850187e-01; -4.727228977131246e-01   -3.249122719534291e-01   +4.499792123081984e-01   +7.501202473537719e-01   -2.108356649305299e-01   -3.847122573392183e-01   +3.334779968350312e-01   +8.637887663697595e-01   -6.544640777312557e-01   +1.000000000000000e+00   -6.950654153933364e-02   +1.304530102471082e-01   +3.684378868296336e-01   +3.716433776920613e-01   +7.660205153385271e-01   -7.883543089100240e-01; +5.319311124652195e-01   -5.190086515245920e-02   +7.320571425715162e-02   +2.576717371584840e-01   +9.729378444689529e-01   +6.489820978912626e-01   -7.842692202580659e-01   -2.910865180933625e-02   -6.466788322869237e-01   -7.114706640178308e-01   +2.922013026205871e-01   -1.965366303479074e-02   +5.485313193764496e-01   +7.540220887979263e-01   +2.333702274433395e-01   -3.633280789082317e-03; +8.695023931651455e-02   +9.603150602965910e-02   +3.695863961259745e-01   -6.159614347507978e-01   -3.691648503015011e-02   +6.118531267674406e-01   +5.263281240007242e-01   +4.396513921463360e-01   +3.789821654665325e-01   -2.206815009553541e-01   +5.305229141794926e-01   +4.154103385902552e-01   +1.275701536257667e-01   -4.727291082629007e-01   +2.094202478132656e-01   -4.846707352997675e-01; +1.695401945421825e-01   -3.324575953322647e-01   -4.935012216596001e-01   -1.190216898616533e-01   +1.548906012900508e-01   +1.442986642232754e-01   -6.263789717477493e-01   -6.722305352746778e-01   +2.384537077878149e-01   +1.286925751702589e-01   +2.290777925225133e-01   +3.073446214544088e-01   +5.679128495044343e-01   +3.383813876588400e-01   +3.304711097752319e-01   -2.165478038004034e-02];
L2I_L2E_iAMPA_netcon = [-6.208832467484812e-03   +6.732210481968008e-01   -7.656701055701450e-01   -3.006326894561428e-01   -3.447872061093281e-01   -5.941417899706062e-01   +5.317838932842746e-01   +6.949877255500493e-01; +7.262020478115330e-01   -3.766362893276402e-01   +1.743085362477054e-01   -3.408811238924280e-01   -3.965672993971107e-01   +7.077155542686610e-01   -3.564038618878620e-01   +1.000000000000000e+00; +6.683962901223947e-02   +4.251121678296047e-01   -4.659361867367239e-01   +3.759553659592504e-01   +3.157150124108270e-02   -5.189759454177462e-01   +1.745464598525803e-01   +3.394707763171769e-01; -1.032386089437647e-01   -3.248868465593421e-01   -4.081895799915019e-01   -2.223763936126849e-01   -4.540828587678440e-01   +3.622745782836435e-01   +2.121629100247067e-01   +8.107465689865549e-01; -3.462513058694911e-01   +6.289258402621165e-01   -6.502576613989878e-01   -4.540019747909212e-01   +9.192681150717587e-01   +7.796934540384066e-01   +4.197875823774863e-01   -4.225559676085264e-01; +3.924759248881313e-01   +9.294310141486140e-02   +4.401981156076923e-01   -3.614183285406274e-01   +2.688295507272267e-01   +5.407239043933693e-01   -8.304106532960845e-01   -2.319770458398537e-01; -4.627771595662762e-01   +6.471914240475254e-01   +3.324884080588278e-01   -4.530916459984982e-01   +6.251311983991317e-01   +4.033588869370572e-01   -5.714237128381128e-01   +2.071486313384928e-01; -8.173752656857382e-01   +3.838308797060768e-01   -5.004651440367570e-01   -4.325018358723769e-01   +8.207630064770602e-01   -2.438819842908052e-01   -5.471710330238584e-01   +1.502167971654992e-01];
L2E_L2I_iGABA_netcon = [-2.934741980510339e-01   +6.504393762890661e-01   +6.938066328289116e-02   -9.200354464789228e-01   -2.511044108697357e-01   +8.268839141743709e-01   +4.333126693137186e-01   -4.974239832391750e-01; +8.680871820950991e-01   +1.274724911772772e-01   -5.206332637826667e-01   +7.788553185189779e-01   -5.478885040498911e-01   +2.957620040265672e-01   +8.650053222917271e-01   +1.005424968248065e-01; -4.001767196597819e-01   -5.800905085824465e-01   +6.510733579876272e-01   +1.000000000000000e+00   +7.949217913314311e-01   +1.598741702330650e-01   +3.689015391968367e-01   +8.183891282563824e-02; +6.348185068083868e-02   +2.250430940136701e-02   +6.590129947706622e-01   -9.396469777329619e-02   -4.251023069430176e-01   +7.462544645605169e-01   +4.322356052561649e-01   +5.834940301503260e-02; +2.876624862098035e-02   -7.354482605546044e-01   +5.066125882418243e-01   +4.003148543884459e-01   -1.041145431150705e-01   +5.318126298218184e-02   +9.561678192410498e-03   +7.955669582529240e-01; +6.017135068998709e-01   -2.440788393907977e-01   +9.077314209947472e-01   -8.351461779599963e-01   +3.119991289409770e-01   +6.907348182534344e-01   -5.562483176601567e-02   +1.788213242684006e-01; +4.108015959878097e-01   -1.009019259522350e-01   -8.223739325161399e-01   +1.262256986625837e-01   +6.655060348702462e-01   +7.747102580170457e-01   -6.130486319876416e-01   -3.271996016670569e-01; +1.692270773192757e-01   +1.255447817548005e-01   +2.031278479669854e-01   +4.694179888868574e-01   -1.649536133218119e-01   -7.180303654227584e-01   -3.716387512627953e-02   +4.034400277424500e-01];
L3E_L2E_iAMPA_netcon = [-8.615661644470701e-02   -1.986472114522505e-01   -2.654017150329998e-01   -6.192419199334529e-01   +6.118909392615655e-01   +1.000000000000000e+00   -4.089120964216975e-01   +2.528814042430846e-01   +5.218878689371076e-01   +2.228847238355806e-01   -4.244706719676895e-01   -3.908089146823795e-01; +9.576551876140633e-01   +1.667652376313902e-01   -2.286552557774463e-02   +7.217542835037797e-01   +5.971667376590605e-01   -3.640753329858362e-01   +5.251489560466904e-01   -3.417419634481696e-02   -4.914456581794275e-01   -4.224655129541816e-02   +3.196407869976020e-01   -8.387400697713578e-01; +4.606464604006970e-01   +6.384567843592260e-01   -2.196242907570494e-01   -1.989810759997151e-01   -7.120954224082937e-01   +9.641674938240472e-02   +2.140096137045157e-01   -2.430651242888412e-01   -6.660238498030376e-01   +7.239220907752605e-01   -6.768168078984367e-01   +6.601426350013914e-02; +4.406149496426330e-02   +1.453861559883288e-01   +1.791684472519594e-01   +3.811487686137627e-01   -7.428383920029961e-01   +4.892334737539299e-01   -6.947735464411657e-01   -5.027943474023386e-01   -2.111713346795812e-01   +8.059240115876080e-01   +4.765349794625006e-01   -6.130646507872837e-01; -1.837398507422833e-01   -3.669621036544893e-01   -2.121948649437274e-01   -1.828085402528379e-01   -7.675999441640836e-02   +6.062886179115025e-01   -6.617068862661327e-01   +1.355528865082637e-01   +1.045803619931604e-01   +1.821940967330882e-02   -2.163302947524731e-01   +5.108221362915630e-03; +6.661710863239659e-01   +2.741136595908858e-01   -5.387400001439066e-03   +6.094147490651382e-01   +1.936235727407268e-01   -4.716325476901307e-01   +6.921970535698936e-01   +4.707723312473865e-01   -1.151162134942418e-01   +4.585145888429681e-01   +2.756598392138558e-02   -1.106413566027842e-01; +5.723799120901103e-01   -8.671377019159346e-02   +9.577137555751534e-01   +1.310709958694676e-01   +3.371366430101790e-01   -1.993956344853733e-01   +1.054574315010797e-01   +1.884188356163268e-02   +5.792864777448995e-01   -7.278433529175257e-02   -6.661380482827389e-01   -5.364189874816448e-02; +5.289958719684296e-01   +1.159562778640999e-01   +3.652385756245286e-01   +9.725687573972509e-01   +4.069246643430680e-01   -8.110050763715145e-01   +7.034140815040050e-01   -2.726897379127259e-01   -2.482880737290056e-01   +4.797156161013103e-02   +4.974439042085348e-01   -1.118849785465638e-02];
L3I_L2I_iGABA_netcon = [-8.358736056542820e-01   -4.732365786361983e-01   -2.464202144164747e-01   -7.867425147064052e-01   +5.868492121101737e-01   +3.545193391435620e-01   +5.518082311737377e-01   +6.231097423344722e-01   -4.001148435803149e-01   -5.218658550456489e-01   -6.983605205736050e-02   +6.972217569705350e-01; +3.063477686662524e-01   +6.921796471878024e-01   +2.967396981372598e-01   +7.556893129491965e-01   -1.209660204167033e-02   +2.843141823609995e-01   +6.816641869877352e-01   -5.009086110381069e-01   +8.139104233764445e-01   +2.610272489277844e-01   -7.376262328902885e-01   +4.554525195634566e-01; +5.834299336372234e-01   +4.860080318635016e-01   -4.287535725974103e-01   +9.913111405770431e-01   -3.166348184721186e-01   -6.084521126952627e-01   +7.668592625962501e-01   +3.605581651887849e-01   +3.129246446150332e-01   -2.244099416692564e-01   +1.716778873666217e-01   +6.857265694507049e-01; -1.229225370496711e-01   -3.609585916207988e-01   +4.559526990623678e-01   +2.750144114551550e-01   +7.000651181885671e-01   +3.377094503465582e-01   -3.044125807679363e-02   +5.112635238077110e-01   -1.078125591288430e-01   -5.265006684079149e-01   -2.209338247330421e-01   +1.000000000000000e+00; -6.676392322299718e-01   +9.038784637021274e-01   +2.050840577095233e-01   -1.335870322239067e-01   -1.160601747819919e-02   +2.056275677990154e-02   +1.640623310397690e-01   -4.309677996696046e-01   +2.724089420138767e-01   -3.643670975233769e-01   -2.054317395408082e-01   -7.518437740154350e-01; -7.364087422437121e-01   -4.952296796689365e-01   +8.640960642600963e-01   +8.277677893464803e-01   +6.582169200559225e-01   +1.386171661020953e-01   -2.660949928393489e-01   +2.241970090592926e-02   +6.336273640217328e-02   +4.219738016152581e-01   +5.461912653834711e-01   -4.049934220253425e-02; -7.087950305166556e-01   +9.209382583895966e-01   -2.509920694203073e-01   -3.691587810015577e-01   +3.518036380693764e-01   +1.172401715374725e-01   +7.386030307189398e-01   -7.708460704016742e-01   +2.091840212149786e-01   +3.522162364935044e-01   +2.380879116061342e-01   +6.726727260368296e-01; -5.693642307167069e-01   +4.223099130739593e-01   -3.847438286178628e-01   +7.345131515440233e-01   +5.291966515256161e-01   +7.103394176209465e-01   +4.488121027568837e-01   +9.754465062090329e-01   -5.148379438772007e-01   +4.987575497026200e-01   +1.890170215259792e-01   -2.559350339071986e-01];
L2E_L3E_iAMPA_netcon = [-5.474602669725502e-01   -3.495568666150315e-01   -2.948530401451269e-01   -8.059800941408993e-02   +1.000000000000000e+00   -1.381906642362050e-01   +8.934587841264883e-01   +7.427502740341708e-02; +3.490989133200802e-01   +7.375426301892507e-01   +3.425005214919005e-01   -6.259885218957988e-01   +5.806284812204324e-01   -5.917589536982627e-02   -5.512835731021424e-01   +2.376317808562300e-01; +3.601275203561228e-01   -1.877432705149618e-01   -7.064727516424413e-02   +5.349988106445609e-01   -4.877438929549571e-01   -6.317279294917909e-01   -5.644510661967135e-01   +6.820002724605547e-01; +1.803019183168032e-01   +7.232644294954779e-02   -2.493718358124980e-01   +3.857747241398942e-01   -7.270780026436358e-01   +3.661096098043927e-01   -4.704787662272558e-01   +4.878678856073395e-01; +5.976725655780999e-01   +4.153936556896446e-01   +1.776359168107653e-02   +5.520225669833900e-01   -2.153042183791134e-01   +4.348428088455093e-02   -7.312422790001154e-02   +1.846856972875401e-01; +1.831963105975083e-01   +5.313550959669440e-02   +8.606858684888600e-01   +3.436528476838702e-01   +1.810773879050649e-02   -8.312251003826898e-02   +2.553137453441811e-01   +4.907352395395929e-02; +9.668500918116412e-01   +8.370501570935067e-02   +2.806709105766329e-01   +1.956074761112452e-01   -5.513187910173427e-01   -7.684449053728876e-01   +1.487779395245173e-01   +4.987026362596957e-01; -7.889014159429316e-01   +7.969484139521599e-01   -1.387998901518440e-01   +6.026651960911049e-01   +1.076170451749593e-01   +8.646297289395717e-01   +6.889608555957695e-02   -1.969803981716194e-01; +4.206261790014761e-01   -3.163291897919044e-01   +2.832206224465392e-01   +2.924026262006783e-01   -1.655206019218454e-02   +8.260356159699136e-01   -2.579886608704799e-01   -2.479074312903125e-01; +1.056757932496835e-01   -6.259118520584218e-01   +1.949440598004056e-01   -7.105004169015202e-01   -2.880097030916985e-01   +5.348706232067889e-01   -3.318581033412379e-01   -1.611014215395506e-01; +4.677615821352883e-01   +6.243663952124643e-01   -6.850033497217227e-01   +6.692220489790497e-01   +4.377011969121402e-01   -5.435001769375101e-01   -6.008641716714723e-01   -5.784371048364636e-01; +3.980176921134415e-01   +8.871554186650384e-01   +5.716633359884103e-02   -9.011615526034429e-02   -4.078048852998173e-01   -3.286284929640753e-02   +2.457984639376828e-01   +3.815863722212032e-01];
L2I_L3I_iGABA_netcon = [+2.196803693349832e-01   -1.376048569264709e-01   -2.809520018981532e-01   +4.326902400622111e-02   -1.591086141108716e-01   +5.608879166416372e-01   -4.393571167378386e-01   -7.846908641153192e-01; +3.514774307804258e-01   -1.494714562275117e-01   +2.663745226604433e-01   +5.547667503007123e-01   -1.226320562992282e-01   -1.890310443518785e-01   +4.919320942797222e-02   +9.071956028334371e-01; +6.494271978381013e-01   +8.016080892926541e-02   -1.406084354733050e-01   -5.430317090241968e-01   +4.349305452722073e-01   +4.257486065347539e-01   +3.184170048715864e-01   -3.556486978627093e-01; +4.430900333434021e-01   +1.753854026459971e-01   -7.525388055909028e-01   +4.414798843841023e-02   -2.841661013230879e-01   -5.427039412562744e-01   -3.365459572288961e-01   -1.129896583653252e-02; -4.729984093520458e-02   -6.132912970918082e-01   +4.125918886065480e-01   +5.489001424439371e-01   +4.091498672287361e-01   -2.668401119996210e-01   +2.717548341881076e-01   -5.431039675749840e-01; +7.755227223096411e-02   -5.634631617942959e-01   -1.175406922126484e-02   -4.635176510344667e-01   -3.137259262062153e-01   +8.821814295452129e-01   +5.934165842013698e-01   +9.816093085967600e-01; +2.317852505690080e-01   +1.000000000000000e+00   +5.965098195513773e-01   -5.418605136479596e-01   -4.208409348244048e-01   -1.879027725158436e-01   +4.622888359699064e-01   +2.402329485526085e-01; -4.593062388043055e-01   -5.948450180004898e-01   -4.040062631466466e-01   +4.924539720288072e-02   +5.663005756994629e-01   -7.050314630800052e-02   +8.322089723511750e-01   -7.831455461510798e-01; -5.061273536748647e-01   -2.831205348934207e-01   +9.873178882115811e-01   +9.282297919997616e-01   +6.485928907155157e-01   -5.551110453281368e-01   +4.554998085270683e-01   +3.239438992081929e-01; -5.045523652196214e-01   +6.603996349457284e-01   +5.998353781171559e-01   -1.795844374887192e-01   +8.158620112215269e-01   -1.160802017923204e-02   +6.045873169719120e-01   +8.640237286969391e-01; +4.816340974384563e-01   +7.337479860699795e-01   -6.173861413060499e-01   -5.801529562098755e-01   -6.257858360835521e-01   -5.844414460354035e-01   -5.206451881434503e-01   +4.692407593563220e-01; -5.418161590715687e-01   +9.182696797421147e-02   +4.063326144249498e-01   -5.015307552539731e-01   +6.990972938383913e-01   +9.578598329152345e-02   -5.624210681112399e-01   -4.923620250141529e-01];
L3I_L3E_iAMPA_netcon = [+8.030742933750693e-01   -2.150067189098613e-01   +4.573229623454559e-01   +2.784685064128765e-01   +8.674521138080681e-02   +7.193054308688090e-01   -8.585749096906020e-02   -8.556611754469372e-02   -5.784503124803061e-01   +4.776546111394704e-01   +1.444064898337343e-01   +4.879121150142612e-01; +4.138603875785102e-01   +7.913596339207106e-01   +1.077946024216587e-02   -3.784432655991385e-01   -7.301034859210299e-02   +2.460575959193077e-01   +8.743013418038439e-02   +7.083204221457526e-01   +3.790501066714322e-01   -1.978427386655607e-03   -1.777132962251072e-01   +1.531451815281040e-01; +6.006892130054015e-01   -4.203585241543376e-01   +1.000000000000000e+00   +1.623727446031017e-01   -3.047680162007934e-01   -5.083028627783763e-01   +9.555939743890003e-01   -6.837724983879866e-02   +3.677002997987036e-02   -5.278099634102486e-02   +3.552557643601570e-02   +8.823656403652577e-01; +6.204485435741437e-01   +3.797384006590597e-01   +7.615571625994303e-01   -1.441373395347783e-01   +7.660406125641009e-01   +3.300781334122316e-01   -7.854377181007732e-01   -1.027752295032610e-01   -5.603550209402051e-02   -4.308814944497802e-01   -4.799621702739746e-01   +9.035591141589995e-01; -1.489386693365383e-01   +8.004774539225271e-02   -4.233977583652432e-01   -6.055937501689919e-01   +2.507941906851029e-02   -7.785762850485801e-01   -5.515510044278672e-01   +3.367004184701256e-01   +7.834916346184699e-01   -2.286628563975653e-01   -5.547640424350574e-01   -3.295178985349529e-01; +9.354183097179342e-02   -5.132728871735921e-01   +6.779860899163384e-01   -2.281919922589349e-01   +5.598284027500061e-01   -4.862956942737864e-01   -8.065469557972444e-01   +3.932671661358709e-02   +9.598618202932313e-01   +3.340536010195407e-03   +3.005243625582883e-01   +1.834747239713678e-01; -1.682668295604724e-01   +7.618895167403631e-01   +8.029455986906303e-01   -1.360718177804635e-01   -4.949495266373907e-01   -5.056203245103345e-01   -7.770183069088724e-01   +1.358894225742871e-01   -8.407013120259802e-01   +1.389360806118785e-01   +7.599751689301683e-02   -1.127244533200718e-01; +1.957678630245011e-01   +6.490222656042491e-01   +4.876521230127338e-01   +2.441106208374455e-01   -3.824933549278398e-01   -8.418169057586560e-01   +8.113915864405383e-01   +8.317553450571820e-01   -1.344256601812900e-01   -3.532385187985321e-01   -4.680359757131773e-01   -6.249156441725412e-01; -3.346028415588088e-01   -2.250751184406244e-01   +1.264616995871091e-01   +3.392710707920809e-01   +6.936098128755913e-01   +5.704348675327393e-01   -3.203424217192105e-01   -4.373820090996094e-01   -1.708194574372890e-02   +5.827301856546557e-01   -3.279874071304418e-01   +6.584818725607096e-02; +9.451669636665380e-01   +4.350477141880577e-01   +2.847945803774752e-01   +6.557402633033636e-02   +9.892304416439821e-01   -2.777169659180723e-01   -7.101117881217726e-01   -2.540011703375909e-01   -2.827285204778928e-01   +7.093364781805136e-01   -2.289582805052572e-01   +2.764846177344650e-01; -4.872726940830289e-01   +4.340346756785183e-01   +8.462816336816280e-01   -1.159100162472674e-01   -1.114503954821031e-02   +5.153457849195566e-01   -4.593642546281462e-01   -6.674356366580429e-02   +3.046464588826069e-01   +8.344113955399359e-01   +1.788113280194190e-01   +3.638417848627209e-03; +1.885437989861989e-01   +7.587715418776139e-02   +1.420840800382409e-01   +6.541069654083713e-01   +2.701463106303971e-01   +8.715812040314017e-01   +2.964552571254295e-02   +4.811809910066865e-01   +4.641842951316330e-01   +1.563865264203305e-01   +3.499867470541139e-01   -7.083053515545872e-01];
L3E_L3I_iGABA_netcon = [+5.683815030723094e-01   -8.078579563131365e-02   +8.644791466062296e-02   -6.342102831489428e-01   -2.669477199216579e-01   +8.805643442263268e-01   -3.809662508404898e-01   -2.020613139651465e-01   -4.698455762079435e-01   +1.038642152408049e-02   -1.933719283205411e-01   +4.313615345313659e-02; +4.086905581097600e-01   +1.782779374226771e-02   -3.523606751189538e-01   -1.387231195064998e-02   +3.472044932442055e-01   +4.237750114060193e-01   +4.150479539915778e-01   +3.942633079334683e-01   -1.159139019316012e-01   +5.345562341117905e-01   +8.300282347178597e-01   -5.926668739016934e-01; -6.492834680815007e-01   +2.494748781131885e-01   -4.951537913006758e-03   +1.000000000000000e+00   -5.040312032509683e-01   -2.993587883956670e-01   +7.574703924029507e-01   +8.975808836802717e-01   -8.133301036290188e-01   +3.509142796250909e-01   +3.153238597710012e-01   -3.627297189133059e-01; -3.564756174263645e-02   +3.837324845272095e-01   +5.074844125553940e-01   +7.942787916278721e-01   -7.053553929031401e-01   -1.907249719740930e-01   -2.659981170216587e-01   -2.799898325525462e-02   +8.511278518527189e-01   +7.600375353516896e-01   +6.620776764443225e-01   +6.663438856610453e-02; -2.577003162467673e-01   -4.222516280218261e-01   +9.112819956391598e-01   -1.210987207939131e-01   +1.916656316696478e-01   -9.323791078655807e-03   -5.684111409692391e-01   +9.472943657165254e-01   -1.153523007431022e-02   +3.605225882190324e-01   +4.351428023412530e-01   -3.548336312340317e-01; +1.881559393649262e-01   -2.358037648432200e-02   -5.879490263867329e-01   -5.747598075196148e-01   +4.086433967381506e-01   +7.003549694865016e-01   -4.859291324523520e-01   +3.796257899311259e-01   +4.365952596619480e-01   -2.003978516122297e-01   -6.821957736982512e-02   +9.152143187620048e-01; +4.185087646050792e-01   +5.762918968847772e-01   +5.041653647845387e-01   -6.261731337231616e-01   +1.537575416462362e-01   +6.704300569070978e-01   +2.490131529024606e-02   -5.305980879617392e-01   +3.889943265093432e-01   -1.885818686010403e-01   +4.915779504307180e-01   -6.244109261307714e-01; +5.872837833277419e-01   -1.520366037711057e-01   +7.736891653617922e-02   +4.472975240948184e-01   -1.023242419785788e-01   +3.920599393433976e-01   +6.426095489627581e-01   -5.207760965253246e-01   -5.875565949658568e-01   -4.179342921461904e-01   +3.602879657669892e-01   -6.249155292288436e-02; +8.978526164871369e-01   +2.129672989893623e-01   -1.337138201109687e-01   +7.132267591746231e-01   +2.010713967427078e-01   -4.589400016646061e-01   -3.577833159570242e-01   -1.085437209182392e-01   +1.754056243417614e-01   +5.769435849910640e-01   +8.893092871550545e-02   +7.137823228212214e-01; +3.416575689487344e-02   +1.263745443107648e-01   +6.387008774904239e-01   +3.591319835236602e-01   +8.466789033180637e-01   +5.618495917616066e-01   -3.460974863846668e-01   +5.268660096488065e-01   -2.277203244970671e-01   +1.889665312114538e-01   -4.725090257204482e-01   +6.169938180772605e-01; +2.233797677492812e-01   -3.812145514153886e-01   -6.507682721422814e-01   +2.651205139484707e-01   -5.846011522823881e-01   +9.621849825505329e-01   +3.138430373394921e-01   +2.101717636758922e-03   -3.950719019863420e-01   +9.174888152830919e-02   +7.160196432836025e-01   -5.885570358453214e-01; -4.103372809102745e-01   -1.881771951580005e-02   +8.029509036845437e-01   +2.147272620539001e-01   -1.106938803352302e-02   -6.567690153300760e-01   +3.269292465036381e-01   -7.028361891139084e-01   +4.729093131018277e-02   +7.953079277471869e-01   +4.862308468395876e-01   -4.132749127769417e-01];
L2E_Input1_iAMPA_netcon = [+2.843050947930559e-01   +5.523649419812344e-02   -7.148908946554127e-01   +3.095517266686323e-01   +4.238038953218982e-01   -1.153829396952676e-01   -2.020385212443928e-01   -1.000000000000000e+00];
L2I_Input2_iAMPA_netcon = [+7.418666721640546e-01   -1.000000000000000e+00   +9.128713865284878e-01   -2.989535515274420e-01   +2.232885705934383e-01   +6.285990987453101e-01   +1.133972483373783e-01   -6.366286486842302e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
