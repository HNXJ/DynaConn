function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.309043820695791e-01   -1.737427530007657e-01   +4.535195194250514e-01   +3.502161708506843e-01   -2.273523180986414e-02   +4.324523427113874e-02   -7.191252709381666e-01   +2.136682363078282e-01   +6.412681340571403e-01   +6.868532609238893e-01   +2.688897325778937e-01   +4.761057849326727e-01   +2.509141337352607e-01   -6.013139502288060e-02   -2.697586231998061e-01   +4.036726515683951e-02; +5.242075198887421e-01   +2.121145275365718e-01   +1.580755520670925e-01   +1.081770934489271e-01   -3.084960265439822e-01   +6.674811085698098e-01   -6.032666949455320e-01   +1.711266046645785e-02   +5.648268244446777e-01   +1.245102096769946e-01   +9.152356834935007e-01   +5.640417693508167e-01   +4.263637140216164e-01   -7.771888075255429e-02   +2.213054655376394e-01   -1.849930314498444e-02; +4.568963694302374e-01   +3.053074905816301e-01   -6.689422959798044e-02   +1.875638906611784e-01   +2.147263355775900e-01   +1.118554950403438e-02   +4.526014409441502e-01   +1.180263269439294e-01   +3.446403277516705e-01   +3.872484903132699e-01   +4.478458373696118e-01   +2.301269179452974e-01   +1.651205916577782e-01   -4.463234080357408e-01   -6.803041859615318e-03   +9.168008342394840e-02; +3.605623720886876e-02   -2.568162775917663e-01   -4.058753165707956e-02   +5.909251170266731e-01   -1.494055327264514e-01   +2.751728128580620e-01   +4.889786143246392e-01   +8.335337858324361e-01   +3.996820025444452e-01   +1.465840066589594e-01   +3.511099970627069e-01   +3.628467516279920e-01   +1.091101293147085e-01   +4.068418874452607e-01   +1.735174098001867e-01   +7.923267081636302e-01; +3.032624215857833e-01   +3.773245141068010e-01   +4.673441922917118e-01   +5.883334975340949e-01   -7.796884214576072e-02   +2.820527085426726e-01   +1.526916901036431e-01   +2.035103770885001e-01   -4.650653076370484e-03   +3.912807244306103e-01   +6.036841492298343e-01   -2.136915911989225e-01   +3.742373942226617e-01   +1.248096478186835e-01   +3.297244202684748e-01   +1.548579935613495e-01; +1.483948484792955e-01   +6.480487661785205e-01   +1.711925849467505e-01   -7.629348673897866e-02   +5.328002292462433e-01   +1.057267452276080e-01   +4.727746592317552e-01   +1.502464583568639e-01   +3.504443024109398e-01   +3.657196000931088e-01   +2.120734192022007e-01   -2.906239853106890e-01   +3.155849105760149e-01   +3.025053981121362e-01   -3.206946406791881e-01   -3.378589723370777e-01; +3.770570348354875e-01   +2.462770770819982e-01   +5.500132387654815e-01   +1.662745921451996e-01   +1.676200695902085e-01   +4.944044722435583e-01   +4.452324319492535e-01   +2.921092376910073e-01   -3.038253222850897e-01   +9.285789853019649e-03   -4.282562895126546e-02   +3.293609032208926e-01   +2.636425640293508e-01   +2.395299421571039e-02   +4.040773495144205e-01   +5.774952757285100e-01; +5.668168505873052e-01   +5.410934961153041e-02   -8.880386063786319e-02   +2.980347487478859e-01   +1.073804285885224e-01   +4.887855788919484e-03   +3.911025165113981e-02   +6.615167810467251e-01   +3.277771387220904e-01   +2.101613642113875e-01   +2.904383724290311e-01   +2.791941654392673e-01   -1.205303374280692e-02   +2.131469084283528e-01   -2.875792843376462e-01   +2.808334433921102e-01; -1.399609792989336e-02   +5.241480740757705e-01   -3.836342270014371e-01   +3.408333802673840e-01   +2.478042476473838e-01   +4.751067565441172e-01   -9.459948454904426e-03   -3.942650108207059e-01   +2.520462700907219e-01   -4.657247872650741e-03   +5.605873580256445e-01   -1.813680938377149e-01   +3.613610653316725e-01   +5.740577474731605e-01   -3.641888964497420e-02   +9.345737866374887e-02; +2.211692489096824e-01   +5.928880125948307e-01   +4.795073593001146e-01   +2.390012737153435e-01   -3.154405780484820e-02   -2.505886420616272e-02   +4.005676688880650e-01   -9.284421967400065e-02   +1.614734963677112e-01   +1.412214833945701e-01   +4.367295692512760e-01   +3.044522430849247e-01   +4.574637966603496e-01   -1.421842456827332e-01   +1.144025840817231e-01   +3.753667733042454e-01; +1.233358824793523e-01   +5.923043977508370e-01   -7.952234717993379e-03   +2.034849277286267e-01   +5.342387100667556e-01   +6.287409321094968e-02   +3.610391355957414e-01   +8.101153078863525e-02   +1.631873280982096e-01   +5.532812363857451e-01   -4.839507964422868e-01   +2.245173303828019e-01   -5.558760297794108e-01   +4.024539788155027e-01   +3.317928049796577e-01   +2.474605777266189e-01; +3.586343227856611e-01   +2.632928762615011e-01   +6.712553766718471e-02   -1.799508140501074e-01   +4.912258096328229e-02   +2.506951811803237e-01   +4.052834900630918e-01   +2.614021666932705e-01   +5.980022761797101e-01   -9.502424621809827e-02   +3.589958328017470e-01   +6.357931114078068e-01   +6.643461259031705e-01   +1.061956540226999e-01   -3.653108948703892e-01   +1.817721742196295e-01; +1.128448706851450e-01   +1.767639889760782e-01   +6.118749220979723e-01   +1.948057902294539e-01   +6.725486239236220e-01   +5.410577267998725e-01   -4.263315952858272e-02   +2.130408232759355e-01   +8.036675742065342e-01   -3.056339375713154e-03   +2.224654294663174e-01   +5.023185329351472e-01   -1.630556411579759e-01   +1.028426420544964e-01   +1.171832248161529e-01   -1.617328616448930e-01; +1.166843895297430e-01   +2.457763647484541e-01   +2.861802544602630e-01   -6.541699723298506e-01   +9.740360210184874e-02   +8.053311219200788e-01   +6.418402561186856e-02   +3.130145377851233e-01   -2.138030879939304e-01   +1.479821131441113e-01   +5.184093064994795e-01   -1.549687851100698e-02   +3.306097681155832e-01   +4.553405189044171e-01   -4.190667128913808e-03   -1.351927537061235e-01; +3.334453044893009e-01   -3.220376097197440e-01   +5.971110729493171e-01   +3.254218269280102e-01   -2.303329796363189e-01   -2.117241245995703e-02   +3.727272413008642e-01   -7.392684678470404e-02   +9.217735480534930e-02   -1.786477874676773e-02   -1.301374400760246e-01   +2.488625769507298e-01   +5.119176908591626e-01   +1.173151267092586e-01   +1.540339408952643e-01   -4.041730311970697e-01; -4.889297832033802e-01   +5.891234486771978e-01   +3.891657273064879e-02   +4.526975396069555e-01   +7.375161268653652e-01   +6.290864629554606e-01   +5.742571952968475e-02   +7.861459277155891e-01   -5.405337680946591e-02   +3.947293609014161e-01   +3.371291935044725e-01   +3.930596202996811e-01   +4.841561507194166e-01   +4.429392312242786e-01   +3.889937694516201e-01   +2.679442707159438e-01];
L1E_L1I_iGABA_netcon = [-3.668953260346073e-03   +2.911629469682036e-01   -2.434531745822542e-01   -1.511599746256117e-01   +7.184606077051559e-01   -1.634671148471974e-01   +1.822050112791564e-01   +1.454372071969195e-01   -9.923174956613544e-02   +1.036418689991416e-01   +3.410998925572850e-01   +3.100947819504620e-01   +9.552505561085433e-01   -6.177204636584321e-01   -4.766281909538899e-02   +8.550121488608048e-01; -4.642042303950979e-01   -1.539291272978289e-01   +6.398662952319288e-01   -3.508664129232585e-01   +1.986146541214083e-01   -2.372388032777035e-01   +4.004427108158836e-01   +4.275736777888416e-01   +3.635739058907140e-01   +1.645921331204429e-01   +5.188830049880950e-01   +1.021344725286150e-01   +7.607469936375696e-01   +6.795605985789625e-02   +2.553224511438276e-01   -2.154464849056374e-01; +1.287661981469841e-01   -2.070549836782131e-02   -2.310771778091742e-01   +5.419434150078913e-01   -5.121435815341250e-02   -2.074337626986870e-01   +5.091505465859916e-02   +4.225650564972677e-02   -1.362918310301325e-01   +6.612280539276461e-01   -1.756764200857697e-01   +1.828829028435517e-01   +5.287873034597802e-02   +2.668551530652585e-03   +7.272547171960037e-01   +2.854422160785502e-01; +5.506851740628812e-01   -2.878678356052529e-01   -1.726242385892678e-02   +2.790603605408127e-01   +8.131424709555522e-02   +4.818768635199636e-01   +2.910906700580914e-02   -1.500342751169975e-01   +1.560896757572189e-01   +2.289806912083825e-01   +3.733876941231924e-01   +6.591019357099129e-01   +1.403658633431564e-02   +2.223604605649285e-01   -7.254088389067905e-03   -3.375804848856260e-01; -3.521043655072861e-02   -5.789830914097148e-02   +5.174731316655472e-02   +4.147409201655662e-01   +2.204157125212211e-01   -1.060281560704546e-01   +2.378379199594933e-01   -4.170038355227025e-01   -4.279951576305792e-02   +1.605920753607288e-01   -5.485413105004830e-01   +7.041015068007542e-01   +2.120995103829268e-01   +3.194470034601634e-01   +1.486056793508181e-01   +7.791106130256871e-02; +1.996671825648529e-01   +1.967341459561634e-01   +2.241067955248409e-01   -3.114540557395873e-01   -1.225586622200495e-01   +7.322418442106725e-01   +5.392501796641906e-02   -5.739752952966013e-01   -2.342903704801742e-02   +1.190282350871473e-01   -4.218509363142601e-01   +2.760013478275072e-01   -5.073012514912436e-02   -5.228676440549991e-01   +5.040857170700977e-01   +1.193280995767785e-01; -3.658113341115941e-02   -2.027742769179076e-02   -1.655004397873441e-01   -3.701641117673868e-01   +3.668493722921231e-01   +1.435169327447616e-01   +2.649036514266653e-01   -1.841778043617729e-01   +2.298703678009081e-02   +4.928056501288492e-01   +6.298643938771068e-01   +3.146910051801580e-01   +5.497794280498911e-02   +7.070271193398786e-02   +9.648252064823187e-01   -3.050094012375374e-01; +7.453458088835059e-03   +2.023280207692884e-01   +1.320292610526036e-02   +1.604766879901607e-01   +9.155466517657188e-02   -1.275037718401170e-01   +6.408402590635266e-01   +5.926338116831533e-02   +6.017956338627787e-01   +4.429621475851295e-01   +2.156617894145972e-01   -1.646439674136556e-01   +3.621870543535262e-01   +3.394933909364127e-01   +4.210969680740973e-01   +4.825687080502365e-01; +7.259022663604343e-01   +7.679269853928189e-01   +1.615081585813490e-01   -2.761296886167670e-01   -5.756457777416399e-01   +3.133215536755509e-01   +1.795966753953497e-01   -4.548903013450112e-01   +1.335653985417169e-01   -3.521208915573646e-03   +1.601699853022897e-01   -2.276686173602564e-01   -7.227312508382172e-02   +6.899038708648605e-02   +8.007643086985563e-01   +2.779400872433023e-03; +3.595830271582123e-01   +5.165060357103737e-01   +5.708889886215829e-04   -1.802596868584994e-01   -1.973594646731849e-01   +1.430299120984527e-01   +3.098131255187075e-01   +1.029397500137406e-01   +4.088692852165280e-01   +9.129176353511213e-02   -4.416680498623425e-01   -2.666636753350740e-01   +5.971126805948337e-01   +4.378417223593564e-01   +3.080351270701928e-01   +2.754547259091498e-01; +3.336400695041254e-01   +1.447465878090847e-01   +1.878403111968330e-01   +5.489642384938289e-01   +1.784911774015199e-01   -4.964876707916722e-02   +2.435109387092515e-01   -1.564223524598854e-01   +3.716878651825054e-01   +1.673798471868244e-01   +4.786471169957794e-02   +9.011567904277611e-01   +7.553905700649277e-01   +2.207371521006689e-01   +2.689423773911622e-02   -2.198281301754133e-01; +2.202729114477190e-01   +2.783051237058070e-01   -8.430181614200954e-02   -4.912876524436414e-01   -3.205605387505049e-01   +1.280716273135489e-01   +1.824514946341847e-02   +5.750250562331416e-01   -1.648005693266208e-01   -3.086944136844566e-01   +3.121852718642127e-01   +4.810964879734143e-01   -1.614595879255493e-01   -2.573152065328558e-02   +3.948626132747317e-01   +3.828298348125567e-01; +4.346270612785119e-01   +4.865084654288526e-01   +1.607042637817066e-01   +5.356750216135273e-01   -1.359337519572435e-01   +3.393401101064723e-01   +5.196104111970103e-02   +4.043013496322462e-01   +5.669472812997424e-01   -2.832170610462941e-01   +1.265100748832105e-01   +4.574926387357784e-01   +2.360215843780740e-01   +7.793181397619683e-02   +5.034988455981183e-01   +3.872698758051802e-01; +4.889289725114788e-01   -1.038903833197240e-01   -2.588102287527422e-01   -4.483992632986095e-02   +4.369916909856786e-02   -3.423842029624863e-01   +3.635588729680503e-02   +2.867126406203105e-01   +5.110584068539352e-01   -1.975157294435431e-01   +4.760155422508495e-01   -8.228059016433295e-03   +1.325120682540679e-01   -9.596173477763370e-02   +7.939705480196801e-02   -3.636865547032482e-01; +5.380920564894448e-01   +1.408328060076282e-01   -6.929690086828148e-02   +5.207749724984247e-02   +2.645889327963449e-01   +1.212571509327327e-01   +4.482988789145717e-01   +7.019159382539311e-02   +6.161420981751364e-01   +1.486839349659450e-02   +2.311300194747289e-01   +1.719874151027753e-01   +1.689009448780552e-01   -2.296021061677851e-01   +6.727918227755226e-01   +6.818963817052589e-01; -4.535466371571594e-01   +2.687380184110941e-01   +1.108537920115839e-01   +3.144224807392004e-03   -2.468879420741242e-03   +3.288866336477158e-01   -1.960507292120547e-02   +2.069481833467473e-01   +3.840551639676250e-02   +3.572301674713260e-01   +1.265633379740471e-02   +2.067507004200787e-01   +6.767760126427015e-02   +2.508053655057426e-01   -5.116671492240016e-02   +6.011007744765036e-01];
L2I_L1I_iGABA_netcon = [-3.060358153256552e-01   -3.747830249935624e-01   +2.049082745520912e-01   +4.845671275113597e-01   -1.742560236355332e-01   +9.587512849548037e-02   +4.580413278439358e-01   -4.717117916277703e-01; +3.656601551227737e-01   +7.434395098744645e-01   -2.843942949552741e-01   +5.820113153559806e-02   +4.279394929434985e-01   +6.366740960519992e-01   +2.442232323440931e-01   -4.220042916096827e-02; +5.790070100341889e-01   +4.444852019645942e-01   +8.565429014832153e-02   +3.516850814678620e-01   +5.154289870153594e-01   +2.271459475138974e-01   +9.147495647813766e-02   -1.181700104775671e-02; +6.375163754551024e-01   +2.462330977862571e-01   +6.471028455657653e-01   +6.279466009814452e-03   +4.162202272397801e-01   +3.021520207082473e-01   +6.393569362417457e-01   +2.153163641353946e-01; +1.445542464480799e-01   +6.113354817063033e-03   +4.639697932269282e-01   +3.611521969352814e-01   +5.056602927419649e-01   +4.563434705755513e-02   +2.308279844228698e-01   -1.198594455448237e-01; +2.453587910695889e-02   -1.142305092770594e-01   +1.541670578647591e-01   +1.856333021320540e-01   -2.898536048933057e-01   +2.328344882972776e-01   +3.251923814503533e-01   +5.795512231110064e-01; +6.788097215486126e-01   -2.416905247224902e-02   +2.028786675406671e-01   -2.296823078084883e-02   +2.736783304510364e-01   +6.152282262423180e-01   +3.860052793194935e-01   +1.277562950337947e-01; +3.310507050918685e-02   +5.141939227095764e-01   +2.563997694514281e-01   +1.663337113515184e-01   +7.534281381331423e-02   +1.394560797151345e-01   +5.442009874573317e-02   +1.548687096523494e-01; +2.933188836104327e-01   +9.353675644553772e-01   -6.820194469082294e-01   +2.807488873569100e-01   -1.943049186855617e-01   +1.888462103829328e-01   +2.972506477552603e-01   +5.785001363514122e-02; -3.849702562762612e-02   +3.751502479958768e-02   +2.192726221285782e-01   +4.503032960753072e-01   +6.209606027351090e-01   -6.574305100514849e-02   -8.592474404130201e-02   +3.546063612510997e-01; +1.806222061889146e-02   +8.358483284748629e-02   +4.530716393838736e-01   +2.180121663193781e-01   -1.500366391749762e-02   -1.668544024106675e-01   +2.686658707763851e-01   +2.920189831781168e-01; +3.505271993132087e-01   +4.538580505048026e-01   +5.985190707361130e-01   +4.498254333095548e-01   -2.030120211403645e-02   +1.340567624021991e-01   +4.027476517824085e-01   +3.385621315671575e-01; +2.975539275294717e-01   +4.934705795257958e-01   +4.560356647546497e-01   +2.413041663424418e-02   +2.220464052575929e-01   +2.632335982186252e-02   -1.543783573573360e-01   +1.190875780669814e-01; +8.798534159361693e-02   -2.638741996764892e-01   +2.263228974648940e-01   -1.900374585612582e-01   +4.580492171842647e-01   -1.468034799398958e-01   +4.605025589383942e-01   +2.073748791978335e-01; +2.924156979637888e-01   +7.551054029957960e-02   +3.328378761301589e-01   +1.112379234010766e-01   +7.365453413688428e-02   +8.641681189108495e-01   +2.988668893400541e-01   +4.485845858181176e-01; -2.947402136451570e-02   +3.194576123729257e-03   +2.743696640291096e-01   +2.619023353131535e-01   +2.774342657620652e-01   +8.103459905480867e-02   +2.303321821690723e-01   -2.447301397728519e-02];
L1I_L2I_iGABA_netcon = [+5.054191944543188e-01   -1.567986837497005e-01   -2.498587478126336e-01   +5.090879181607816e-01   -8.432360356406605e-02   +7.120411471227919e-02   +3.423385963159777e-02   +3.142059763893304e-01   -9.645916384229056e-02   +3.775273668507455e-01   -1.406848438003903e-01   +2.245881570776892e-01   +2.958628392953011e-01   +1.850525013613445e-01   -4.913684635471668e-02   +4.272102778908125e-01; +3.606435925316828e-01   -2.273586645344550e-02   +1.279290026263875e-01   -2.529399107247239e-01   -8.042172865821345e-02   -2.646040357108055e-02   +5.470542194841311e-01   +3.447981135424424e-01   +5.261624891772083e-01   +7.982664198314982e-01   +1.760228817956517e-01   -1.117539704490527e-01   -1.916785009895925e-01   -4.245022461106812e-01   +2.935192983750409e-01   +3.519422275773879e-01; +1.946841332707595e-01   -3.492992828632442e-01   +4.013588937556761e-01   -9.427294510580961e-02   +3.045827848340305e-01   -2.005887888822194e-01   +5.865197788264507e-01   +4.905770449011366e-01   -2.382433853625789e-01   +1.999637879421115e-02   +2.448832711908915e-02   +3.728566609830752e-01   +6.006627500431136e-01   +5.298267075378581e-01   +9.281608249246827e-01   -7.367114003981773e-02; +3.027255397750037e-01   +6.967234000950692e-01   +4.414708098277345e-01   +2.805164513585074e-01   +5.899679696193861e-01   +6.094785983861349e-01   +7.162909943609951e-01   +5.734828596433168e-01   -2.032070137604855e-01   +7.776688500074439e-01   +5.772771365444993e-01   +2.977648402799843e-01   +1.756090857316103e-01   +1.584261599085289e-01   +3.840977546835389e-01   +7.661685053576903e-02; -2.705270653174613e-01   +6.766384307013691e-02   -2.238687813991621e-01   +3.014269591919221e-01   -7.955121147521022e-02   +7.897631900957360e-01   +7.203689483554501e-01   +2.852451206555264e-01   +5.196078397361032e-01   +4.549414472285932e-01   -2.510323999744092e-01   +1.919777044451804e-01   -4.649853243359809e-01   +2.012590879060837e-01   +2.681908413136996e-01   +5.359328000755829e-01; +2.049555141573577e-02   +4.227268868672203e-01   -9.358073967931972e-02   +6.730982379136773e-01   -9.707767835640053e-02   +1.512143129991974e-01   +3.166962257309858e-01   -1.174631350076621e-01   +7.414067519731651e-03   +8.731966605926827e-02   +1.411925894440985e-01   -3.684811112152775e-02   +6.299142478355698e-01   +9.890486160783839e-01   +2.129095327975460e-01   +4.660673791448508e-01; +5.298814534055565e-01   +4.701259730586805e-01   -4.442735379250803e-01   +9.709047656012215e-02   +4.545356231542110e-01   -3.128950372844894e-01   +5.134286448597485e-01   -1.213324361412760e-01   -2.037676582207211e-01   +1.671492969800282e-01   +4.468516248215338e-01   +4.202841633477930e-01   +3.215413096578830e-01   -2.224088843301774e-01   +1.408232457017404e-01   +4.643449478664161e-01; +5.359240767877217e-01   +2.138787790829468e-03   -9.802668000467059e-03   -1.700631242072194e-02   +1.054148049698384e-01   +5.421503021351912e-01   +1.655110233885083e-01   +8.688573132223865e-02   -1.894655685976758e-01   +4.261009562452593e-01   +4.249313271767123e-01   +4.360151282245922e-01   +2.885641874793949e-01   -1.564470952152796e-01   +3.555665282803240e-01   +5.175049656535999e-01];
L2E_L1E_iAMPA_netcon = [+3.582405073091117e-01   +1.917212741963550e-01   +1.547545531671406e-01   +3.735190240662042e-01   +9.649749752626434e-01   +5.518164807959661e-01   +4.084311346679576e-01   +5.040193420054325e-02; -2.202911291772970e-01   +3.217770220663983e-01   -2.059619505956376e-01   +5.622004906044499e-02   +6.264316124228694e-01   +1.882085794344927e-01   +4.667148082935261e-01   +2.045729004465873e-01; +2.851849661776810e-01   +5.205275270873784e-01   +4.191418560451612e-01   +4.467565257675302e-02   +1.387616233918429e-01   -9.741413992890499e-02   +2.027317037104140e-01   +3.196463181000456e-01; +4.056263190217069e-01   +1.119476535833956e-01   -1.065297722762526e-01   +4.079454497754452e-01   +1.135256569173709e-02   +2.413672415840759e-01   +2.353397738577605e-02   -3.612330678224875e-02; -5.904207804255349e-02   +6.974176278342256e-02   +5.935833630520219e-01   -1.962078899483448e-01   -1.554390331025354e-03   +1.356517092015079e-02   +2.541541329237841e-02   +2.794043398781790e-01; +3.445611180113828e-01   -1.017337375703661e-01   +1.932900927746060e-01   -6.023496625477007e-02   +3.419255846495022e-01   +5.413701170527320e-01   +4.147702916079908e-01   +2.699862258393371e-01; +1.710969445065196e-01   +6.038039011853407e-01   +2.627003880271025e-01   -1.709283046835116e-01   -2.403166166473062e-01   +4.240874493058239e-01   +7.626785332730793e-01   -1.934969639633738e-01; +9.405736358534666e-02   +3.180010494179480e-01   +7.707465153319364e-01   +9.102982341103213e-02   +2.470494543576732e-01   +3.156292914982194e-01   +5.274571478617345e-01   +2.857736290670506e-01; +5.403331341336244e-01   -7.489351280012625e-02   +3.700289958827014e-01   +8.128972608784979e-01   -2.605455084023540e-01   +4.616793438300686e-01   +4.232823363854252e-01   -1.719119026051758e-01; +1.452715691154088e-01   +8.640085490309300e-02   +1.073934419347672e-01   +2.224347861116847e-01   +2.962125702948785e-01   -8.253379106242395e-02   -3.461749524570990e-02   +4.353014445218604e-01; -4.056095217344431e-01   +6.082415698495173e-01   +4.604145790074018e-01   -2.925693392737395e-01   +1.993715145106892e-01   -9.164791020467205e-03   +2.636187898596832e-01   +2.838857218474387e-01; +2.194350726341744e-01   +1.396873817007732e-01   +5.630716188454759e-01   +1.317773770907683e-01   -4.625022440034930e-02   +5.216217062024753e-01   -3.131901361698893e-01   +1.574741954955183e-01; -1.395448304850712e-01   +3.450105048726280e-01   +7.297394624768494e-02   -1.456229529877897e-01   +5.802098775647914e-01   -3.456939417060420e-03   +3.873087272161738e-01   +7.014379831906593e-02; +1.227601425144418e-01   +6.530254434636039e-01   -4.184999426273888e-01   +1.433317232752964e-01   +2.897725011934235e-01   +2.337537750904101e-01   -4.136509482235132e-01   +1.518555776885626e-01; -5.150351239664260e-02   -5.990786415472476e-02   -4.080233534686778e-02   +3.352936816113762e-01   -1.648008470955146e-01   -1.571995392348222e-01   -3.210411117954878e-03   +1.587191389038586e-01; -2.732584238729253e-02   -2.823708836569048e-02   -8.439556885049634e-02   -6.974047126833507e-02   +2.481828793750407e-01   +4.570613220921844e-01   +3.764502990126442e-01   +5.113742381306320e-01];
L1E_L2E_iAMPA_netcon = [+2.391445006698540e-01   +2.019874974225754e-01   +2.498335893203300e-01   +1.243708810850546e-01   +4.328268154006507e-01   +1.740183662056862e-01   +2.037607467608468e-01   +1.388007116135838e-01   -6.143575232843652e-03   -1.757496839118861e-01   +3.163558049378193e-01   +7.815921495139658e-02   +3.371960092751599e-01   +1.190709193024618e-01   -2.070090346734707e-01   -1.512576342698199e-03; +3.206118299133348e-01   -3.332153487475609e-01   +6.647130101837265e-01   +3.977008654206309e-01   +2.953065041625182e-01   +1.619986097171621e-01   +6.747804698702472e-01   +2.989777857603248e-01   -2.426081659432748e-01   +3.628621101778323e-03   +3.382777560601726e-01   +3.621031560824587e-01   +5.761155078905303e-01   +2.108495696608883e-01   +1.957530336619703e-01   -1.892262038068138e-01; +6.123854806566544e-01   +1.214403106999534e-01   +2.832512555159903e-02   -7.749529441145554e-03   +8.784963591436024e-02   +2.947377041716268e-01   +1.959774105779838e-01   +3.521880861372371e-01   +1.981711529826717e-01   -2.108140596522656e-01   +2.779471174061738e-01   +6.524032440540583e-01   +6.031847596662102e-03   +4.264322047583445e-01   +9.392640909745588e-04   +4.845986130948761e-02; +1.765501374575880e-01   +1.125967353264044e-01   +5.791008152160895e-02   +1.004824374357270e-01   +4.288878168337800e-02   +5.294925614695065e-01   +1.000000000000000e+00   -7.892167025664743e-03   -1.355978894066790e-02   +2.542617856463963e-01   +4.218065360948354e-01   -3.009970802986375e-01   -1.312461327326067e-01   +8.697185062443125e-01   +1.453702126887333e-01   -1.868111446502800e-01; -1.263299348145381e-01   -4.796645276987781e-01   +2.705581507159526e-01   +1.461398282517145e-02   +1.198633960040125e-01   +2.272325542589937e-02   +4.044320401781882e-01   +2.805125733125104e-01   +3.422893206357440e-01   -6.228223883169320e-02   +6.824301814165371e-02   -2.534436937309828e-01   +4.340367704764267e-01   +1.891035138468123e-01   +5.311323763650542e-01   -1.103265822951537e-01; +7.639194852976733e-02   +4.090254525889858e-01   +8.619517546206923e-02   +6.302658343310613e-01   +3.799421993934196e-01   +1.290079458974339e-01   +5.896933580103485e-01   -6.828365254680939e-02   +2.804530653943604e-01   -8.243977420816451e-03   +6.904950626922225e-01   -8.637325987453524e-02   -1.961400238931108e-01   -2.476131509343489e-01   -3.185971171916575e-01   +4.521735960072488e-01; +1.914245443364791e-01   +1.579724082392420e-01   -2.072035048151880e-01   +3.418233803692703e-01   +4.241404159264752e-01   +3.653423565414933e-01   +4.415097695452044e-01   -1.367879101415949e-01   -4.398312894989040e-01   +5.333789895945572e-02   -7.702982340191759e-03   -2.840485474611812e-01   -2.712923740610018e-01   +3.461208818259396e-01   +5.451032718721047e-01   +1.421224797846690e-01; +3.251571077888888e-01   +3.176069937502260e-01   +3.761423220565028e-01   +4.699446693703047e-01   +4.146736097460421e-01   +5.910801488240111e-01   +7.287999996159676e-01   +2.819196639876525e-01   +3.020336311323910e-01   +4.828282453366487e-02   +4.315541383228302e-03   +8.770694609544384e-02   -5.335873831735243e-01   +1.421538084758149e-01   +9.166969266882841e-02   +1.127471432074030e-01];
L2I_L2E_iAMPA_netcon = [+1.790171404735376e-01   +5.925872630121144e-01   +5.580518832267679e-01   +9.290707140600693e-02   +7.803828789878024e-02   +4.575084177978902e-01   +2.722368009312589e-01   +6.978315846343063e-01; +6.979644657211942e-01   +8.273277718792778e-02   +9.267613458269576e-01   +6.431347699977472e-01   +3.843849522183037e-01   -2.051009542889534e-02   -8.697019053187365e-02   +1.916197045082679e-02; +1.144492499218962e-01   +3.670099504170649e-01   +4.436646706006146e-02   -1.099444955152199e-02   -9.572159539353638e-02   -3.910894838904267e-02   +4.142543530824090e-01   +1.449735030006075e-01; +3.240098423956977e-01   -6.877678894532326e-02   -2.881193259946264e-01   +3.362659966182915e-01   +4.075781433337692e-01   -3.790697165089685e-01   +6.366074252210914e-01   +1.023980006545769e-01; +3.908092319322310e-01   +1.182901268194764e-01   +3.387988817043665e-02   +5.643644203922477e-01   +4.844047793867698e-01   +7.469725287504465e-02   +6.217879749982554e-01   +5.332524788775970e-02; +4.027448849485841e-01   +4.055446989840905e-01   -5.889345973301128e-02   +5.913717245976715e-01   +9.178686629361853e-02   +3.170563696906052e-01   +1.718750096298805e-01   +1.555277441678938e-01; +3.279558611387292e-01   -2.529607093990045e-01   +4.791981943731054e-01   +6.795694784243097e-01   +7.827364621834282e-02   -3.687679509934179e-01   +7.374627961681552e-01   -7.562413951439237e-02; +2.538686001502218e-01   +2.556743312940131e-01   -4.958425312707654e-01   +3.100209650695445e-01   -5.102626771037532e-02   -9.021942333703473e-02   -2.912579442142399e-02   +6.944816914266506e-01];
L2E_L2I_iGABA_netcon = [+8.483149144063958e-02   +4.803368411889424e-01   +5.418007263023368e-01   -2.159806787317944e-01   -2.007341783157150e-01   -1.536597154831838e-01   -1.103695554532801e-01   +4.712025217475521e-01; +1.469072351484788e-01   +1.365564398358341e-01   +2.541433876066667e-01   +8.892454401695210e-01   +4.778384047355964e-01   +2.274462780775798e-01   -4.761978776900114e-01   +3.116046052892923e-01; +1.218114898765281e-01   +8.283086051355290e-01   -3.075213807487672e-01   -3.637028760649053e-01   +2.446130978795897e-01   +5.958478816069837e-01   +2.682864669442365e-01   +3.242073610679584e-01; +1.561342589488356e-02   +6.366028464486733e-01   +1.045491662032911e-01   +7.114927000772785e-01   +7.918383869521989e-01   -2.974922149824570e-01   -2.892289067038014e-01   -1.241549968707702e-01; -1.582155795854688e-01   -3.317113980218761e-01   -1.773170784385457e-01   +2.646553502229959e-01   +7.007538936349356e-01   +1.993216019654993e-01   +1.520751062268726e-01   +1.111380388081922e-01; +7.923754558681908e-01   +5.473523836968500e-01   +3.074650310467647e-01   +6.400403943106596e-01   +3.126743664741319e-01   -5.438999481575366e-01   +6.303755101092984e-01   -3.161475218606901e-01; +1.800967922028613e-01   +1.635091026100704e-01   -3.366457011291450e-01   +3.049523821515969e-02   +5.474691175502572e-02   -4.621718469374768e-01   +1.847414531511597e-02   +8.616609531513555e-01; +7.127195911826478e-02   +3.966467104720104e-01   +5.599912090966893e-01   -6.788161664399095e-03   +1.732127002043636e-01   +4.289516630979426e-01   +3.547552736117491e-01   +5.582251625519660e-01];
L3E_L2E_iAMPA_netcon = [+3.991245061404696e-01   -3.458367917361999e-01   +1.145311730670793e-01   +3.084776731674416e-01   +4.633660766839406e-01   +3.193255795658184e-01   +5.031667882413207e-02   +5.613698270855335e-01   +2.720825452384260e-01   +3.622495115764245e-03   -5.249480307383786e-02   -2.965708376206160e-01; +2.184852932841826e-01   +3.995876839532820e-01   +7.951639678477715e-02   +2.041938219989508e-01   -2.005208819237493e-02   -3.568736859413547e-01   -7.685309246422987e-02   +1.339395485970747e-01   -1.349883724090739e-02   +2.322067035203193e-01   -8.395007658997274e-02   +6.259397855167922e-01; -3.390779628533328e-01   -2.375573063622772e-01   +5.663000015006691e-01   +4.247663725440307e-01   +5.894327253017219e-01   +1.388842152005906e-01   +4.044959748581869e-01   +3.468505474715585e-01   +7.789324585056248e-01   -2.941049284551410e-01   +5.758893030809484e-01   +5.074806440221795e-01; +2.852204835384720e-01   +3.743424777332445e-01   +4.383345972703814e-01   +1.733197881389510e-01   +5.543597248180058e-01   +2.251511247690180e-01   +1.047427883099523e-01   +3.627706384265498e-01   +5.858818442165607e-02   -6.562387117303169e-02   -1.799034372377744e-01   +6.015878231897926e-01; +2.034336110031066e-01   +2.335774728209278e-01   +2.568090623547550e-01   +6.216013135797391e-01   +5.636760272973769e-01   +4.207836699970864e-01   +8.687967931758594e-02   -4.650029365340819e-02   -3.210898588755201e-03   +5.431049491872342e-01   +5.522010539507878e-01   +6.130593869576354e-01; +2.922086314098385e-01   +6.328481601251935e-02   +7.911238593197728e-02   -1.599337705680366e-01   +3.379939211746008e-01   +5.580875805904704e-01   -1.991271199610920e-01   -2.276392175702631e-01   +3.394702428963367e-01   +3.018631790683161e-01   -2.460324004552503e-02   -1.115731075275134e-01; +2.517484075265465e-01   +2.371276135022781e-01   +5.587423460994801e-01   -5.431404591351860e-02   +3.211838750270177e-01   +2.243593047363882e-01   -8.912842710444398e-02   +5.002110118920844e-02   +2.834239828758240e-01   +5.943935064238579e-01   -1.071751631920061e-01   +3.599552023711103e-01; -2.426016556916420e-01   +8.264685240696998e-01   +3.359407824880928e-01   -6.826483146371485e-01   +4.511961391698897e-01   -7.626061818085507e-02   -2.811664176713335e-01   +5.620020321510565e-02   +2.253296104180571e-01   +2.885580047795676e-01   +5.669930645733655e-02   -4.413795466754133e-02];
L3I_L2I_iGABA_netcon = [+6.981930096473340e-01   +5.632990691933458e-01   +2.555355105619188e-01   +3.746190520659978e-01   -4.688955177341683e-01   -1.211417351373185e-01   +9.734424038954173e-01   +5.536394251667915e-01   +6.569325901887787e-01   +6.521687213957023e-02   +9.877736078698363e-02   +5.233014760848991e-02; +1.835418987884498e-01   +3.678174319050331e-03   +5.484412488279712e-02   -2.979702456129081e-01   +5.560867521147923e-01   +1.908411651263785e-01   +2.893125348321324e-01   +4.294405548508719e-02   +5.380807400504490e-03   -3.540931172834864e-01   +3.480971208977621e-01   +1.190806525891175e-01; -8.135594806958546e-02   +3.326432576557404e-01   +2.304430132161547e-01   -1.821693980114531e-01   -6.389266906235608e-02   +3.332889004892400e-01   +2.835402676877024e-01   +2.113071352628629e-01   +2.514631816140279e-01   -1.465172550345109e-01   -3.463590459126061e-02   +8.845515956643102e-01; +5.838899581014694e-01   +4.537174745537139e-01   +7.199659673353819e-01   -1.104429854932730e-01   +2.303550351659411e-01   -2.447438295130646e-01   +2.607535150333173e-01   -2.498388101411197e-01   +3.031448132514670e-01   +6.071704588219944e-01   +5.847153514531154e-01   +3.244534493322241e-02; +5.489160979484242e-01   +1.671018289677335e-01   -1.541942202761446e-01   -3.009126252489095e-03   +5.700125765635030e-01   +3.633932857442274e-01   -2.604115551982051e-01   +7.944526403326791e-01   +5.718234167669082e-01   +2.271660535599806e-02   +3.389186795874330e-01   +2.746823953439412e-01; -1.259691639253410e-02   +4.411231955598573e-01   +6.154763148613951e-01   -7.146498043896280e-03   +5.309577914314598e-01   +4.720154417713203e-01   +1.036114021305528e-01   -2.978371712787488e-01   +5.377292557190325e-01   +4.785671403546553e-01   -3.100876378460631e-01   +1.561242773505021e-01; +6.365821432326205e-01   -5.444285904935935e-02   +5.448942364887336e-01   +2.120455439350743e-02   +6.496834595317532e-01   +6.280508000348393e-01   +4.786035170530268e-01   +1.877354341294057e-01   -4.966336355371578e-01   +8.091639012133101e-01   +1.062709761255644e-01   -1.334294214553183e-01; +1.834385580637096e-01   +3.164278998744962e-01   +4.083824266842717e-01   +3.441452808452324e-01   +1.624951602441447e-01   +4.687971790232768e-01   +8.447556523285339e-01   +8.901648692223123e-01   +4.722446819477699e-01   +2.620964129209547e-01   +2.600993809637915e-01   +4.852315506770529e-01];
L2E_L3E_iAMPA_netcon = [+5.079791685429077e-01   +2.060421816872096e-01   +7.462709477307234e-01   -6.566844872944300e-01   +1.772406365105782e-01   +3.821130962983599e-01   +5.747102106748602e-01   +5.159702767223601e-01; -1.348336016411169e-01   +2.180180645893545e-02   +1.699300807664232e-01   +4.994369901803049e-01   +6.186845234076566e-01   -2.100806168281626e-01   -1.810164989825746e-01   -5.174798568230425e-01; +7.671470468352214e-03   -2.351513939593839e-01   +1.201522315348579e-01   +3.847716442117619e-01   +4.128486174334557e-01   +1.570026279183326e-01   +6.366412214633779e-02   -3.694465718641808e-02; +2.528711972781961e-01   +3.330464197946453e-01   +6.658687856151380e-01   +7.798602576855337e-01   +1.576361902443708e-01   +8.534513278687471e-01   -2.358771223314184e-01   -4.000238848336314e-01; +1.107729961487323e-01   +2.249577402497838e-01   +1.078008730113791e-01   +5.181445325432896e-01   +2.247671095176470e-01   +2.035997115636004e-01   -5.315856739182540e-02   -1.856945004697161e-01; +1.104315101821447e-01   +6.329609903809861e-01   +4.654423043160310e-01   +7.612662038780662e-01   +2.062842231819487e-01   +1.205704125941294e-01   +2.053074965284724e-01   +3.881638729311444e-02; +1.581060146678285e-01   +8.435260428654837e-01   +7.232413586884543e-01   -2.414470492393190e-01   +7.841056932969817e-02   -1.647413085843785e-02   -5.867995813363700e-02   +1.887124334623657e-01; +5.292202480407180e-01   +4.043306279569262e-01   +1.474709755417219e-01   +2.942598776041728e-01   -1.016511164826323e-01   +1.765844009679685e-01   +8.287080194649758e-02   +6.425199562441118e-01; +5.568006910132736e-02   +6.853637240138885e-01   +4.688721202665653e-01   +2.950844755047399e-01   +3.189295581633899e-01   +7.835965555757454e-02   +8.369145976467569e-01   -1.213324224107143e-01; -7.328589065568809e-02   +1.696718402836327e-01   +3.496435930331112e-01   -2.363378415636262e-02   -3.719225947564341e-02   -3.606294661301148e-01   +3.241038248044663e-01   +6.374385411750451e-02; +4.288472463029245e-01   +2.087469099110892e-01   -2.522756701272994e-01   +9.972801446284275e-01   -1.972455067599267e-02   +5.790383464669010e-01   -1.417869819145444e-01   +2.837637744585213e-01; -5.606243459797075e-02   +7.392932207404249e-01   +2.237955635105235e-01   +6.464798611424580e-01   -5.779922638036102e-02   -9.202317451432722e-02   +1.234913961833454e-01   +1.508073887085053e-01];
L2I_L3I_iGABA_netcon = [-5.340489747057783e-02   +1.697311761101762e-01   +9.392526568633079e-02   +4.977918809044603e-02   +4.064584912508383e-02   +6.928900503141707e-01   +3.310697441152853e-01   -1.152566174529644e-01; -1.734704520998043e-01   +2.950837864991815e-01   -1.790951110039275e-01   -5.217371054613217e-02   +1.877716030376797e-02   -2.280805406486714e-01   +4.450652090241197e-01   +3.478111874685067e-01; +6.519459389567009e-01   +9.882428148144292e-01   +1.864299838545680e-02   +5.472035378660803e-01   -8.614757098928716e-02   +7.429404658838936e-01   +1.225551371778149e-01   -4.847259316798773e-02; -2.152924417550090e-01   +1.706397191332047e-01   +7.299252148793499e-01   -2.904116487785293e-01   -3.080975043681311e-03   +7.132418364851044e-01   +3.083758639732710e-01   +3.334408402428537e-01; +5.137312649999521e-01   +3.883846465161417e-02   +4.069945207807799e-01   +3.588478206109270e-01   -1.429451820041426e-01   +3.481211548188748e-01   +2.528034553714847e-01   -9.808655252093441e-02; -7.780685000367742e-02   +3.329001958754683e-01   +6.074178770471296e-01   -1.662597186179254e-01   +3.365488441448042e-01   +7.330396559609337e-01   -3.045718048365023e-01   -7.138735122004909e-02; +2.308670687818304e-01   +3.682435583811833e-01   +8.845749836551811e-02   +4.163084094769860e-01   +1.367131576217917e-01   +2.225210584074848e-01   +8.813068556771476e-01   +5.879122091372025e-01; -4.177061908625597e-01   +1.977808151888889e-01   +5.287682865176071e-01   -7.363387705508232e-04   +7.660459314599245e-02   +4.289925948266020e-01   +2.553875010397315e-02   +7.512613982482833e-01; -5.810166454088309e-01   +5.655364351779411e-01   +6.276184240234307e-01   +1.157636146630432e-01   +3.240420115404691e-01   +1.340509246703613e-01   +3.833849170232848e-01   +2.996707083825610e-01; +1.489153177470314e-01   -1.932150485947127e-01   +1.232750852659554e-01   -8.845771634679535e-02   +2.715831328525715e-01   +5.880902157044585e-01   +2.139276988705675e-01   +2.812404649069647e-01; +5.259545580261207e-01   +1.619922503953035e-01   -4.608885539181249e-01   +2.808399818777119e-01   +2.040554317830792e-01   -1.374074736903974e-01   +5.066635071963569e-01   +4.493014905539845e-01; -4.756626337369456e-01   +7.479721379741148e-01   +6.804579807212918e-03   +6.480297349818328e-01   +5.544900249630053e-01   +3.125366528527476e-01   +3.429977730619314e-02   -2.707308481001559e-01];
L3I_L3E_iAMPA_netcon = [+1.082173474604153e-01   -1.976758832112479e-02   +3.087606040767328e-01   +2.842626934807967e-01   -4.040716579146624e-01   -1.443211418462480e-01   +2.752621697492345e-01   +3.898735643751637e-01   +3.209640294431528e-01   +6.232289475125434e-01   +1.420070030905551e-01   +3.650664422919960e-01; +1.971401485092508e-01   +1.106445885211392e-01   +2.562566022887433e-01   +7.808711276163145e-01   +2.022142633519211e-01   -2.302306649807459e-01   +3.495195487913532e-01   +4.057165488404815e-01   +4.848141806329430e-01   +3.079492538029106e-01   -2.700077081902914e-01   -2.413544504546281e-01; -6.850930835089666e-03   +4.829086788536291e-01   +4.462130665603836e-01   -1.191411290243917e-02   +7.980678244448215e-01   +3.017609343805542e-01   +6.433814133552389e-01   -2.164238245990092e-01   +3.005576469943885e-01   +4.463083012089925e-01   -1.467632129597621e-02   +4.028992532884634e-01; +3.557866496121666e-01   +2.588443804673615e-01   +5.080427840868140e-01   -1.264931889860445e-01   -1.092788593736008e-01   +3.108805606912254e-01   +1.437312606626919e-01   +2.775722831905632e-01   +7.769903214982271e-02   +2.752775292482272e-01   -8.626854973327343e-02   -1.272818290674073e-01; -7.004314840782740e-02   +1.588747377028359e-01   +8.229178628389406e-01   +4.431154305372567e-01   +1.357849001812956e-01   +1.606049479064266e-01   -6.823459626067442e-02   +3.859817954726314e-01   +2.889312594338642e-01   +3.154302427494523e-01   +2.978946184792623e-01   +1.247213657251844e-01; +2.341603413462193e-01   -1.389768160976113e-01   +2.571826358762075e-02   +1.648523752373368e-01   -1.691852323946862e-02   -1.508112697255663e-01   +2.223225584613276e-01   +1.671732323837272e-01   +4.363878514433193e-01   +2.079439147578082e-01   +1.643721175620905e-01   +7.574828215270473e-01; +1.083118832860704e-01   +5.364104273927868e-02   -2.412483887702086e-01   -4.158098062114532e-02   +4.434801935533765e-01   -1.358616842810492e-01   +6.565756369407194e-01   +1.612906494407090e-02   +2.849325341026808e-01   +3.812335867186595e-02   +4.068117416311089e-01   +1.645310607422666e-01; -2.209455034180026e-01   +2.228871667085503e-01   -6.792806377139729e-02   +8.802343583999531e-02   +2.783477226962719e-01   +1.920021946158199e-01   -2.048068636190864e-01   +8.444260558347204e-03   -1.111007012476497e-01   -3.832866227659690e-01   -1.652152861908590e-01   +2.142985868314065e-01; -2.871998731132731e-01   +6.305416578297058e-01   -9.853934019065086e-02   +3.597970341936046e-01   +6.113432505644610e-02   +5.075453993411924e-01   +2.758629170133317e-01   +5.752704536924621e-01   -4.748193044108363e-02   +9.969592155958229e-02   +3.464433012361902e-01   +6.629575157003725e-01; +6.899306039437763e-01   -5.242797886259745e-01   +6.371278535372586e-01   +3.227982938195665e-01   +1.308639849577961e-01   -3.946613140955444e-01   +3.676648925304469e-01   +3.555428775110602e-01   -8.427777832870621e-02   -2.264586068753169e-01   +9.026274541276486e-01   -1.493607193469695e-02; -3.854773270870644e-01   +4.324306147134045e-01   +7.735670287637781e-01   +3.069853106384922e-01   +1.728026992687995e-02   -1.174145211884214e-02   +3.154238589053731e-01   -7.925793481356161e-02   +5.430432315824820e-01   +1.498434916621881e-02   -1.169982532855230e-01   +4.560526486030665e-01; -1.599471482918387e-01   +1.361874622790264e-01   +8.626677240568328e-02   +5.890285021607550e-01   -1.392251218514380e-01   -1.681496278241852e-01   -2.774025588375786e-01   +2.108152022745153e-01   +3.329010881874544e-01   +2.099508755749457e-01   +3.050648596398498e-01   -1.139589921138509e-02];
L3E_L3I_iGABA_netcon = [+7.168297304080440e-02   +2.887984328943992e-01   +1.224179678692004e-01   +2.174003732886726e-01   +1.952597365504952e-01   +4.526871174771460e-03   -1.753385474356046e-01   +3.162183188083187e-01   -2.142481800974194e-01   +6.490390476402047e-01   +5.477754916411678e-02   -9.653508895562135e-02; +1.179931668419621e-01   +5.584359315004555e-01   +3.892956377614518e-01   +2.180024329751928e-01   +6.684450700269710e-01   +2.646137853486314e-02   -4.549234235390279e-02   +4.189151416585919e-02   -5.441574580861739e-01   +2.018099396577698e-01   -5.689257884245186e-01   +5.307010376599549e-02; +7.655275357116685e-02   +9.884715104360178e-02   -4.454498177116376e-01   -3.922989547290553e-02   +2.625068570253293e-01   +9.665910988284698e-02   +3.952114066607278e-01   +2.356163830106096e-01   -5.764897627817327e-02   +2.293029353801351e-01   -2.093877066438816e-01   -2.832623030468301e-02; +2.478787732822296e-02   +3.361556123796782e-01   -7.001234825924310e-01   +4.485726459906089e-01   +9.538068034489438e-01   -2.105222863471097e-02   +1.189296723149245e-02   +3.391161188843522e-02   +8.151715095004172e-01   +4.154570756220101e-01   +6.736767900358663e-02   -5.739577019966309e-02; +2.493064912167456e-01   +5.625479116105557e-02   +1.047759671669978e-03   +5.183278965840904e-01   +6.166333024748182e-02   +3.241719506936928e-02   -9.774844998375680e-02   +7.180908497206488e-01   -2.749173529295525e-01   +5.689715223785982e-01   +2.778526808982824e-01   +3.259147911148352e-02; +6.006542716362952e-02   -2.869501251405933e-01   +2.718249640379244e-02   -1.329968842732983e-01   -3.047052516894165e-02   +3.736366995873588e-01   +2.680577330540282e-01   +3.896834153794307e-02   +5.675332024448767e-01   +3.203518430869643e-01   -2.437672038169979e-01   +3.730892055508955e-02; -1.398766648483113e-01   +1.111258845960867e-01   +2.050855600656835e-01   +8.488402164848040e-01   +7.772743986222504e-02   +4.165917952603894e-01   +4.202181274321997e-01   +4.584803218263656e-01   -1.808522480698786e-01   +3.700663426836680e-01   +4.956504911290776e-01   +2.531291926448060e-01; +1.654881201211566e-01   +2.666081675398097e-01   +3.361522726333954e-01   +6.554949549565182e-02   +4.041450863109383e-01   -4.696949905840576e-01   -2.533675994022746e-01   +6.210176153383966e-01   -1.202439572126223e-01   -2.503464453984687e-01   +6.396146050345122e-02   +2.974546015960586e-01; +2.987970633079293e-01   -1.397115151101757e-01   +3.825740658609840e-01   +1.899115778722179e-02   +3.245647250592968e-01   +5.087904808369201e-02   -6.103042562779429e-01   -1.295357405725967e-01   +5.769014002774080e-01   +4.424182460059757e-01   +1.584727787369349e-01   +5.242739875077206e-01; +9.626008267285749e-02   +2.040253825835026e-02   +2.247790644921550e-01   +4.900160069272023e-02   -6.581388484904197e-01   +5.946838765406166e-02   -2.031265581504377e-01   +2.331785372743963e-01   -9.038119995021247e-02   +1.381640787808021e-01   +1.170453604566266e-01   +8.182379588378473e-02; +1.175550147637761e-01   -2.209789321159943e-01   +3.505253776245011e-01   -1.302743999296865e-01   +1.643351476028594e-01   +3.036579955468063e-03   +3.335890530811173e-01   -2.042541307632368e-02   -1.779420257044264e-01   +7.074689222723261e-02   +2.869845967446717e-01   +3.172337253197240e-01; +4.290057426810137e-02   +5.691978727180139e-02   -2.631440090631300e-01   -1.498056766363347e-01   +9.625019038053528e-01   +5.701751113182553e-01   +5.134910032344082e-01   +4.135654130377062e-01   +1.520692309399545e-01   -2.896256728881171e-01   +4.211614059890812e-01   -2.022110533785231e-01];
L2E_Input1_iAMPA_netcon = [+7.072859150785781e-01   +7.706113288610867e-01   +4.953685264383412e-01   +6.623502744168237e-01   +9.742628963450318e-01   +3.282480102771722e-01   +5.424770631764392e-01   +5.597116374149503e-01];
L2I_Input2_iAMPA_netcon = [+5.258597933197992e-01   +6.800671031414687e-01   +6.831402434508429e-01   +5.122381072591211e-01   +1.753040535642188e-01   +9.998108901653864e-01   -6.863883365402768e-03   +5.745943479113293e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
