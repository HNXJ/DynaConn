function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+4.977625037771920e-01   -3.759016459784776e-01   +3.240294011662001e-01   +8.049932682354664e-02   -7.292126800651198e-02   +5.779846235289259e-01   +1.636162770731419e-01   -5.755554459929509e-01   +8.681776444573919e-01   -6.234621096847522e-01   -5.866872640483254e-01   -1.126308205092528e-01   +2.972951901938294e-01   +6.678677050498570e-01   -4.111484131864376e-01   +5.373945836040820e-01; +7.328623453529471e-01   +1.696856187726958e-01   +4.330717403786151e-01   -3.072837307149576e-01   +1.925152297191659e-02   -9.385771912065682e-01   -8.343086670440877e-02   +3.739417727921598e-01   -5.743217061997916e-01   +1.310998382663916e-01   +5.034071041065295e-02   -4.170370602602176e-01   +2.216116190235812e-02   +4.412418746654721e-01   +5.524030675816175e-01   -1.970833690496049e-01; +5.690293411501626e-01   +5.693046623655045e-01   +5.156743082765606e-01   -6.978975024340942e-01   -3.636984069640924e-02   +2.118722459230218e-01   +3.488743565671944e-01   -2.919256370277647e-02   +4.404210727547738e-01   -1.543569763234004e-01   -3.847135500217372e-01   +8.307395171909061e-01   +4.219544407099771e-01   +7.745589342890274e-01   +2.455500451062544e-01   -4.232776581787563e-01; -8.387290981638038e-01   -7.463184517588795e-03   +8.621545953186012e-01   +3.388934737047052e-01   -1.264248009243469e-01   +8.030017310909310e-02   -1.306963337797370e-02   +5.426789694095461e-01   -6.300965540648382e-01   -2.743043390087931e-01   -1.111203012808604e-01   -4.122595975423496e-01   +6.325441117387635e-03   +2.256877043713888e-01   +3.760256025278370e-01   -6.915591001131832e-01; +4.923484545063491e-01   +1.775080727872541e-02   +2.023878907167771e-01   -2.318470384221244e-01   -2.550150592662820e-01   +5.595297934900759e-01   +2.130123439100525e-01   +5.165602804649534e-01   +4.095290969868717e-01   +4.783731950513087e-01   -5.923806761942890e-01   +8.233941338342109e-02   +3.388977633722967e-01   -4.879014562324819e-01   -5.456456690769835e-01   +3.260366592676292e-01; +4.939419841030711e-01   -6.227137873533201e-04   -1.822842248844745e-02   +2.507634130383744e-01   -3.603352181152189e-01   +3.326179612007816e-01   -5.734121493392854e-02   +4.925638428256168e-01   +4.458724833786640e-01   -1.491679003786546e-01   -4.488214864238091e-02   +3.300360574634500e-02   +2.131447066427528e-01   +7.936963010841099e-01   -2.160946656270791e-02   +5.909233212832382e-01; -2.700119928458499e-01   -5.964232553284022e-01   +5.048123188163953e-01   +6.647483254395020e-01   +2.665222243179697e-01   +6.117028410079357e-01   -3.278568523703728e-01   -1.026803238441739e-01   -4.723363729717361e-01   +5.295755735609522e-01   -3.343352853126737e-01   -4.936480696894224e-01   -4.645980891041148e-01   -8.347972604946777e-02   -1.574203064146468e-01   -4.238313557166865e-01; -5.451610332470815e-01   +9.554634445907940e-02   -3.529330345923885e-01   -8.580371945466393e-01   -9.048650477637850e-03   +1.095286552226886e-01   -1.868067972416645e-01   +2.471337441172732e-01   +4.359400780366104e-01   -2.129729023519182e-01   +7.761311174529251e-02   -5.980323001784073e-01   +7.624426040106353e-01   -2.466427966722808e-01   -2.264510688130082e-01   +7.464572818366008e-01; +1.076894606240390e-01   -5.741093366358931e-02   +2.514760402153666e-01   -1.812671354406573e-01   -1.731488752813132e-01   +8.742134835737957e-02   -1.388267435961471e-01   +4.613099593972806e-01   -7.944609483546496e-01   +1.115822663360418e-01   -1.520637191382688e-01   -9.689217238950108e-02   +1.340663173518660e-02   -4.591026832724920e-01   -4.165459183932825e-01   -9.230104039023201e-02; -3.547080259753663e-01   +1.995343015750778e-01   -2.325930185484197e-01   +4.906885736735439e-01   +5.038908485538149e-01   +1.124226747367356e-02   -7.127322414593638e-02   -6.876394708495456e-01   +8.031209784127005e-01   -2.125395614364616e-01   -1.118114874429396e-01   -5.417433819861116e-01   -1.594005402308836e-01   -2.841456433301739e-01   -1.530360391548233e-01   -9.388043168079194e-01; +1.446525536870819e-01   +1.698253461120803e-01   +3.871393491337716e-01   -7.737443993201578e-01   -7.715323301399252e-01   +7.411987678500156e-01   +1.505446380352348e-02   -5.402505593665956e-01   +1.918275277211803e-01   -6.106288278662991e-01   +2.738299206483409e-01   -9.367654450821781e-01   -6.372120499674891e-02   +2.859831644862582e-01   +1.103015268431858e-01   -8.717570078265562e-01; +5.429377175564191e-01   -2.699356684835483e-01   -3.721800914381561e-01   -3.022354558172087e-01   -2.417957573676707e-01   +4.226074949767386e-01   +6.136930041638081e-01   -3.289786637176966e-01   -4.555014782738718e-01   +2.585538593123305e-01   -2.897501445132232e-01   -3.990961987740136e-01   +8.667293372916752e-01   -2.797747672372140e-01   -3.266570115087885e-01   -6.679903124337027e-01; +4.356378383269500e-01   +1.000000000000000e+00   +4.480052887327778e-01   -1.073056259731735e-01   -4.759334955082119e-01   +5.123718450773507e-01   -1.404002853738165e-01   +4.732471481763919e-01   +3.497549386028353e-01   +2.652076704631409e-01   +3.158043409031673e-01   -1.688276513127307e-02   +6.244291823860391e-01   -1.158938606215351e-01   +6.509062486438558e-01   +7.103788370871663e-01; -5.512258190685201e-01   +4.748014017953112e-01   -4.798556684947022e-01   +6.008958408541185e-01   -4.727358656770710e-01   +4.222126072398178e-01   -2.646799386149609e-01   +1.474440282317076e-02   +2.632578024616896e-01   +3.327455069408838e-01   -8.657936986724764e-01   -2.822093608201118e-01   +3.016769388093734e-01   -2.665197151642085e-02   -1.438603953794163e-01   -7.358188777307806e-01; -1.296039747330407e-01   +9.442790275845328e-02   -4.261985336313824e-02   +8.878914044946219e-02   +1.488874664797496e-01   -1.622987031563606e-01   +5.380994649631131e-01   -6.662052614469351e-01   +1.074460654811871e-01   -9.543349872987841e-02   -7.499215760498105e-01   +1.049364624020385e-01   +1.933109532815313e-01   -4.802712621451324e-02   +4.083346079774020e-01   +2.009620316377680e-01; +7.924700174867852e-01   -5.750907732466524e-01   +4.059031636655931e-01   +4.264466102798783e-01   +2.461918390077993e-01   +5.833480641885171e-01   +2.701346285345578e-01   -7.047503156934893e-01   +4.871062755881225e-01   -4.392812123978804e-01   +2.100068690370477e-01   +2.188948525606756e-01   -3.262633466779132e-01   -5.313215368838242e-01   -2.120380319770437e-01   +3.697752090598069e-01];
L1E_L1I_iGABA_netcon = [+1.616402585758877e-01   +1.806665249639445e-01   -8.252872588237545e-01   +1.701911198943542e-01   -2.353121249865114e-01   -5.843018757749648e-01   +8.194366864702390e-02   -4.445829682883630e-01   +4.816596291141090e-01   -2.592800223855550e-02   +3.401692725224519e-01   +3.791159944938586e-01   +2.635633120376629e-01   +6.228892365821463e-01   -4.612365432983508e-01   +1.314456499143574e-02; -2.040789131879171e-02   -1.131861491510776e-01   -7.213776115922427e-01   -3.748929862577059e-01   -2.684328111930295e-02   -9.710456865525414e-02   -2.392261200257922e-02   -6.336669382987739e-01   +6.359294919483325e-01   -1.383727096832972e-01   +6.575200391774102e-01   -2.212379782994856e-01   +1.971042034205627e-01   +1.511304125687570e-01   -3.699325689077509e-01   -1.737499798208333e-01; +5.598423012350645e-01   +7.968524188011294e-02   +4.457827424655292e-02   -1.178505819120379e-02   +9.116388745481582e-02   +4.013273183268943e-01   +1.314195298650994e-01   -1.381333875736359e-01   -3.344025577572374e-01   -5.046113760388112e-01   -3.339495317278034e-01   -2.993811374762021e-01   -5.686547802137896e-01   +5.245311356279601e-02   +4.937094513841047e-01   +4.033036698268492e-01; -1.700659158366939e-01   -3.715248429174542e-01   +3.697669558347491e-01   +5.798471112583401e-01   +1.695897592111426e-01   +5.811567734608265e-01   +2.752886820529216e-01   -4.982053360252237e-01   +3.941403511656062e-01   -2.717523600206815e-01   -2.720758283678475e-01   +7.668247581125802e-01   -1.605164547647482e-01   -5.268904317080083e-01   -4.480346982642873e-01   +1.346217247767916e-02; +2.296839789175698e-01   +2.105260835342510e-01   -2.942565169426388e-01   +1.455931478856530e-01   -3.310634218679185e-01   +3.277287418746776e-03   +3.430904543065643e-01   +5.148045322476104e-01   +6.076925023092842e-01   +5.547497122909321e-01   -4.806021115108781e-02   -4.066498246347167e-01   +4.089514788179349e-01   +2.178176699416235e-01   +5.980828865716096e-01   -1.027067057418071e-02; -5.456717255516043e-01   -2.608966959942683e-01   +5.539656961104862e-01   +2.156820936950356e-01   +4.093962363112265e-01   -4.493818878872308e-01   -1.247067504858958e-01   +3.276278175684749e-01   +3.323473472484884e-01   +3.864535221009633e-01   +5.125622143058085e-01   -5.077077465333447e-02   +4.905788311121392e-01   +4.453397648482360e-01   +3.719769411807846e-01   +5.562069322744746e-01; +3.256565547400291e-01   -2.493768103057440e-01   -2.962714179302966e-01   -7.079784443298273e-01   +5.101257890195009e-01   -6.808557433899740e-01   +1.778957545381085e-01   +3.316066141156603e-01   -1.451926244321737e-01   -4.531416425473968e-01   -1.879902457165265e-01   +1.179318351155543e-01   -1.091843733787541e-01   -4.248647360968564e-01   -3.646353039028807e-01   +1.637042317603462e-01; -3.901021092413122e-01   -2.777385636630773e-01   -4.496294162363497e-01   -5.623958551176701e-01   +1.028858825581912e-01   +3.353984235047703e-02   +1.000000000000000e+00   +5.606076590722577e-01   +5.312629125415245e-01   -5.283230747369699e-02   -4.868560505904498e-01   +7.895655800714737e-01   +3.608206304656857e-01   +4.729647750812791e-01   +2.279328607153779e-01   +2.607316101832102e-01; -2.311825354475660e-01   -3.634587355612450e-02   -7.893428810514734e-01   -1.845652582169006e-01   +1.470457796542966e-01   -6.550360805761302e-01   -3.158693695407139e-01   +5.559449790246286e-02   -4.327328524756139e-01   +4.176454342084103e-01   -3.251090559941830e-01   +3.331766452961273e-01   -2.991317486524110e-01   +6.819169136306646e-01   +1.837534584518473e-01   -7.066186878674432e-01; +1.879593101472774e-01   -1.937987834876453e-01   +4.138544446839271e-01   +6.558642089806753e-02   -1.660849991636419e-01   +3.508037454483909e-01   +4.106103859850142e-01   +1.916428264318677e-01   +5.506523237337579e-01   -2.730345693142583e-02   +2.339551288007052e-01   -5.263554677700238e-02   -2.704386725492507e-02   -7.309863032892860e-01   -2.300948129885187e-01   -6.166853451960792e-01; +3.656620369953599e-01   -6.071233284673080e-01   +3.428319625115887e-01   -2.438666956278532e-01   -1.331933793403676e-01   +5.459437409520237e-01   +8.086810419923283e-01   +4.282705665708312e-01   -2.800140168731149e-01   +5.632528657264464e-01   -2.892309157773277e-02   -5.211430122694419e-01   +7.100006398553225e-01   -3.999351816540829e-01   -3.104540166031584e-01   +1.302308751331179e-02; +4.755271583296711e-01   +1.541640825079971e-01   +2.220577023058335e-01   -2.799238299177608e-01   +5.703251729066164e-02   -3.229487265452062e-01   -6.318834146118322e-01   +4.747973449535576e-01   -1.803183806639779e-02   -2.352281426869595e-01   -3.084987077542787e-01   +3.335561019704658e-01   +6.565440699527864e-02   -3.617135082762176e-01   +5.332540960917973e-01   -5.333007269955617e-01; -7.678208178180405e-02   -2.027298610224466e-02   -2.999896589948261e-01   +1.002279485028722e-01   -4.277885499035885e-01   +3.413554500833892e-01   +4.030838346780837e-01   -4.850049742092369e-01   +6.419589923772190e-02   +4.217046552554702e-01   -4.038257192503711e-01   +1.647433613714322e-01   -1.864064629452634e-01   +1.670605622331506e-02   -4.555500485536391e-01   -1.546276998036895e-01; +5.949707648534378e-01   -3.870861002249757e-01   +1.501524762129130e-01   -3.046406009396288e-01   +2.258318994156956e-01   -4.653760477434948e-01   +4.679665994831257e-01   +4.470787097864447e-01   -5.082234689959189e-01   -1.459552083657507e-01   -3.611332621887649e-01   -2.743983468719713e-01   +2.406098277624794e-01   -1.749451750732480e-01   +1.580217841958882e-01   -8.129357680552092e-02; -1.473307062168071e-01   -6.170300939067155e-01   +2.990292906908093e-01   -5.139086481772532e-01   +2.486791781129802e-01   -4.081800616816758e-01   -2.631957478994082e-01   -2.802377534701206e-01   +3.865118071811462e-01   -4.769368849432143e-01   +2.255919895108054e-01   -9.812181938470104e-01   +3.834699799277461e-01   -5.507240334083788e-01   +1.369189144603095e-02   +6.466042744979177e-01; +1.280871626374040e-01   +7.009572484639417e-01   -2.427563906797451e-01   -3.513845597601580e-01   -1.116694788177300e-01   +1.124074658755854e-01   -3.004573792222685e-01   +6.494041870059147e-01   +2.699853534304815e-01   +3.877061396308834e-01   -7.190588434337103e-01   +1.698735387135800e-01   -7.081768152490704e-01   +7.993943732107190e-01   -3.174603315868448e-01   +4.868533117559473e-01];
L2I_L1I_iGABA_netcon = [+5.973955955790386e-02   +1.873459645444665e-01   +3.768377391964489e-01   +1.502138337062655e-01   -1.901494458975369e-01   +3.335497525292422e-01   -2.863331875106470e-01   +5.571505940829041e-01; +4.738269264102479e-03   -5.965634989996392e-01   -1.156970506435566e-01   +2.148302911917914e-01   -4.377850189126479e-02   +9.921625063148964e-02   +8.778670719408100e-01   +4.323751872988832e-01; -1.718830092988157e-01   -3.827400304652922e-01   -5.445844598080576e-01   +6.243568022167907e-01   +9.569808060256765e-02   +5.364869906709626e-01   +7.416080586855250e-01   +4.265290470644539e-01; -6.328236724440022e-01   -3.543356861628480e-01   -3.994511920592087e-01   +4.668533846062977e-01   -6.430990338742530e-01   +2.887275512770389e-01   +1.151412876754805e-01   -2.329328172024602e-01; +9.982799030822259e-02   +7.948808386954179e-03   +4.607778437355112e-01   -2.918278439327823e-01   +6.958661648400390e-01   +2.962148556942460e-01   -1.391212899818648e-01   +6.347866073350824e-01; -7.570023047489595e-01   -6.469670366403362e-01   +9.885155344481020e-01   +3.248465571818524e-01   -5.201117750576302e-01   +4.588210464943301e-01   -5.451291904346351e-01   -2.153696929313039e-01; -5.037924669605988e-01   +1.704080337024796e-01   -8.151643540817277e-01   -9.761159743446105e-01   +4.637289416589035e-01   +6.512095824172695e-01   +2.000122565868794e-01   +3.407681319475482e-01; +4.170653913737335e-01   +4.596799032350960e-01   -1.167276004091784e-01   +3.631670591883684e-01   +1.307815014537396e-01   -6.425079809034170e-01   -1.059404672483308e-01   -1.190781148338295e-01; +2.001127189934245e-01   -6.889672016767976e-01   -1.706056362207288e-01   +6.620456641814370e-01   -5.466642428229253e-01   +4.678560979799496e-01   -5.813148060931831e-01   +3.025522179748531e-01; +4.486882229746564e-01   +6.396599691088445e-01   +4.931642299467945e-01   -4.887389052815405e-01   +8.217881907645674e-01   -3.032018750272260e-01   -1.831024824769920e-01   -2.017399560165585e-01; +1.317240354889830e-02   +7.137537525158711e-01   -2.542064507345576e-02   +2.411849504496905e-01   +4.654184964955447e-01   -2.687112961591098e-02   +5.056814657464158e-01   +2.162956678497016e-01; -6.823900784417128e-01   -6.389237488953408e-01   -2.841373688768578e-01   -7.880750245429090e-01   +2.218352683366660e-01   -2.427530510249509e-01   -6.410662400910695e-02   +3.431546765302912e-01; -9.424503283946141e-02   +6.947558131373400e-01   -5.247701707190183e-01   -8.703911434002036e-01   -6.831055182074696e-01   -1.356301049983566e-01   -2.518143137881372e-02   +5.466032359779007e-01; +8.539065604289749e-01   +3.923494058380499e-02   +2.730625381752408e-01   -4.740718177444200e-01   -6.406677152014340e-01   -1.608840150792741e-02   -1.289914128839380e-01   +5.672067841915972e-01; -3.076721384527863e-01   -1.433100437772220e-01   +3.487606216447869e-01   +1.163054718247311e-01   -2.290702767214987e-01   -3.351332176798407e-01   +3.052937377426229e-01   -1.726744115191736e-01; -7.636661558185189e-01   -1.000000000000000e+00   -1.468157762434548e-01   -2.711445665175558e-01   +5.293940227540107e-01   -1.776280045919713e-01   +6.295354752675619e-01   +7.620993305415963e-01];
L1I_L2I_iGABA_netcon = [-4.475343399162419e-01   +1.855258044879490e-02   +4.852754936163758e-01   +3.264970664059190e-01   +4.047109888599865e-02   -8.064477890586869e-02   +4.759158364451685e-01   -1.984329069182794e-01   +4.592537700013307e-02   -5.993106490184047e-01   +2.577694595836355e-02   -2.618420534569899e-01   -1.302473943045826e-01   -6.485019459361042e-01   -1.927992415696185e-01   -4.312482649365759e-01; +6.503227880454963e-01   -2.798386477089659e-01   +7.536599512764764e-01   -7.758222438321679e-01   -1.992439097987415e-01   -2.347664372014611e-01   +6.244371633662522e-01   +3.058909807518636e-01   +1.695009846823159e-01   +1.000000000000000e+00   -7.095181707853281e-01   +6.012223865716987e-01   -7.945267798133114e-01   +4.606940210987249e-01   +2.605676230692986e-01   -3.826837387119000e-01; +5.249381161930289e-01   +9.148247676880320e-01   +6.360528843234342e-01   +7.078657197292177e-01   -4.130199594226047e-01   -4.982255284316779e-01   +4.701524049834131e-01   +4.041535283344829e-01   +7.618730720786877e-02   +2.320100865664186e-01   -6.650169809061016e-02   +1.722994996399374e-01   +4.180806112538390e-02   +3.984769892924296e-01   +4.874475560247835e-01   +1.428862852389601e-02; -8.521032659815586e-01   -5.864863419957693e-01   +1.348013141143790e-01   -2.236141747529833e-01   +1.833639072872895e-01   +8.153179077264301e-01   +4.607204235912051e-01   -1.937261153360869e-01   +8.323438409553555e-01   +7.597371380440766e-05   -1.873055253877396e-01   +4.062723662575168e-01   +5.291741801314991e-01   +4.343491639596948e-01   -7.676083193169133e-01   +3.605995079372534e-01; +8.267282541756871e-02   +6.567286389037842e-01   +2.277066641135296e-01   -3.838892748714719e-02   -6.070012978061297e-01   +3.952453092961978e-01   -5.694828766038067e-01   -4.109209214296634e-01   +1.881077227933649e-01   +3.816706945682013e-01   -3.912828955243461e-01   -6.906812102264369e-01   +1.111164927625687e-01   +2.782458283626376e-01   +1.750641102870961e-01   +7.959514558347821e-01; -4.776810994856071e-01   -3.645759778519374e-01   -2.065248605955594e-01   +3.112042464783021e-01   -3.543951222931254e-01   -1.602841394070275e-01   +2.069960439754638e-01   +3.663305960629846e-01   +2.295930567471465e-01   +3.612807143619921e-01   -4.230815735210442e-01   +6.104883313838263e-01   +1.686143830750582e-01   -4.462836871696738e-01   -5.055333604542466e-02   -7.132663811204649e-01; -2.148588721332848e-01   +1.494228735671168e-01   +6.553134993714111e-03   -5.342861135765267e-01   +4.513239855248846e-01   +2.986604467086507e-01   +4.435535581542364e-01   -1.671070463438186e-01   -5.555254980776221e-01   +4.512682939936331e-01   -5.192435440337987e-01   +2.800580460802665e-03   +1.048505896338748e-01   -8.042644059684737e-01   -3.268636315908757e-01   +8.222494815940935e-01; -1.684674116840894e-01   +5.019821016066658e-01   -2.307759182692410e-01   -1.948293581164363e-01   -5.428286385352268e-01   +4.167682523379285e-01   +3.839597939803222e-01   +6.513056340281835e-01   +4.338649495832701e-02   +7.895962811435639e-02   -5.101766845993060e-01   -4.005954615780272e-01   -3.971043867975220e-01   +7.181006924397897e-01   +7.875839982307878e-01   +3.091577950094944e-01];
L2E_L1E_iAMPA_netcon = [+3.856583838524615e-01   +6.063909568114222e-01   -6.668239891106838e-02   -4.707329187040249e-01   +1.256242244090228e-01   +7.176505444837288e-01   -1.833102218497842e-02   -4.534123852719523e-01; -4.775619239243675e-01   +9.034550135449980e-01   -3.468202475714971e-01   +5.656200611681114e-01   -4.520095979659887e-01   +2.159044397248082e-01   +2.543825599015980e-01   -6.867154984150858e-01; -2.632616381612922e-01   +2.408408777221547e-01   +3.183971632469539e-01   -3.353691642684681e-01   -6.419710738786100e-01   +6.400610935639898e-01   -1.330821395226474e-01   +2.980035532292388e-01; -4.774981202148898e-01   -3.821193669148575e-01   +3.571330701950847e-01   -3.708811599549959e-01   -1.315243510127029e-01   +3.576618815926049e-01   -3.910527206286533e-01   +9.367207262645784e-02; -1.587948865830091e-01   +5.769200137325313e-01   +7.637836118242151e-01   -3.495579725102881e-01   +2.889119098159870e-01   +4.957109089002257e-01   -4.945738959972401e-01   +6.701175224514817e-01; -6.582362073490380e-01   -1.850697255399142e-01   -8.770794837247478e-01   -3.787492952136347e-01   +2.701550623210749e-01   -6.161574536832173e-01   +2.429104676638904e-01   -4.168835311942389e-01; +3.373088882429612e-02   +1.699610114241292e-01   +2.551451257280836e-02   -8.351938555081621e-02   -5.883829059820763e-01   +2.367265733505636e-01   +5.549916269026350e-02   +3.424792261526963e-01; +3.780862618005070e-01   -2.719410905396828e-01   -7.204362318220772e-01   +4.324043549754317e-01   -1.501259470445391e-01   -3.483822880446149e-01   -5.942728701954042e-01   -2.508168090875530e-03; -4.748826967071136e-01   -5.545338299771749e-01   +4.856667652257767e-01   +4.082329844342134e-02   +8.250629641435292e-01   -5.899439523197922e-01   -6.277948005522214e-01   +7.255472268748007e-01; +2.698554191495305e-01   +1.020427852194191e-01   +6.525062928638918e-01   +9.150399704251364e-02   +1.562602767111354e-01   +1.632590999670641e-01   +2.224418210103306e-02   +3.593910182467876e-01; +3.919193667199136e-01   +3.539722971579333e-01   -2.372236054318398e-01   -1.365310937049353e-01   +1.024779366300524e-01   +8.227650505803856e-01   -1.286822445161553e-01   +1.263113592381150e-01; +2.279435854641536e-01   +1.702677777720661e-01   -5.187652274073896e-01   -2.306769111761523e-01   +4.486310071231973e-01   -1.521227502817195e-01   +1.911699573084483e-01   -1.353142963219214e-01; -1.000000000000000e+00   -8.489297960712536e-02   +7.568208285867783e-01   -1.255011695279635e-01   -2.245886012133389e-01   +3.564010671078544e-01   -1.891132842562146e-01   -2.510769323366412e-01; +1.890176519779097e-01   +1.308191805593104e-01   -7.849861599755545e-01   -1.341424258642034e-01   -3.550883281456597e-01   -5.147705008746436e-01   -6.463436003343215e-01   +4.919030894627454e-01; +1.560512523716768e-01   -5.078854497270955e-01   -4.822928882243465e-01   -9.601130595623432e-02   +4.336016116347954e-01   +1.372714436170819e-01   -4.600111919495256e-01   -4.921481828695878e-01; -4.034947849893034e-02   -7.023930594359942e-02   +3.936446216440544e-01   -3.080565257928103e-01   +4.288457053710497e-01   -3.507678942620813e-01   +7.458676398394174e-01   -2.786194009994419e-01];
L1E_L2E_iAMPA_netcon = [+3.278123023507434e-01   -1.690242611921144e-01   +4.380126987290618e-02   -2.834690534367974e-01   -2.590804531372159e-01   +2.567829503026615e-02   +6.345127335072677e-02   -8.748297200437595e-02   +7.481068919537756e-01   -3.897516829107481e-01   -4.462741113290317e-01   +6.928614778390525e-01   +5.121603088343311e-01   -1.659436328198071e-02   -4.821528625094109e-01   -4.673919447109097e-01; +2.523887418932778e-01   +2.381480738205027e-02   +3.388354883940342e-01   +2.946442733188265e-04   +1.878154568389004e-01   -4.431859273305983e-02   +2.656521042461066e-01   -1.354401841485756e-01   +5.435637745203931e-01   -8.929441072576825e-01   +2.471095161504990e-01   -5.123401594695484e-01   -3.028859215556074e-02   +2.022476196030835e-02   +6.554390873784379e-01   +2.525236542565835e-01; +4.592807092618821e-01   -3.978292839800698e-01   -4.025324445835757e-01   +7.514059717324720e-01   -2.120507101074450e-01   -2.701801875246993e-02   -4.989076703564497e-01   -7.680550997877313e-01   -5.870291058668120e-01   +3.583700653817699e-02   -5.030595947448651e-02   -2.617351845440437e-01   +8.031340817208601e-01   +8.092245026242743e-01   +1.319513838444674e-01   +5.857742686320767e-01; -1.568824708893665e-01   +4.950890610727310e-01   -1.191710888961831e-01   -6.129880484212324e-01   -1.212628834462120e-01   -8.735479124356109e-01   +1.964385941094786e-01   -8.954776199035871e-01   +3.153259655805252e-01   +1.697646314842352e-01   +5.246317647490482e-01   +4.358644815650787e-01   +1.110870235858105e-01   +4.373397928298042e-01   +7.648787523770997e-02   +5.207628489649966e-01; -3.269153185949759e-01   -4.552361830498245e-01   -1.399923867215538e-01   +7.615061557281159e-01   -7.087538457760567e-01   -5.439364012187876e-01   -9.372577646612404e-02   +7.381134425234124e-01   +2.728207188576532e-01   +5.543616768634584e-01   -5.607557624314509e-02   +2.740287781558922e-01   -4.269092234723729e-01   -4.985233571267566e-01   +5.520873516265412e-01   +4.943202184410938e-01; +6.104351431289754e-01   +5.456051144826132e-01   +2.767589455148963e-01   +3.325983503081469e-01   -1.385815357982679e-01   -5.193101839406672e-01   -6.216872648444849e-01   +3.888822955346893e-01   -5.385600641529331e-01   +5.352536217348216e-01   -8.598071290577055e-01   -2.493603621953260e-01   +1.000000000000000e+00   +5.333879887991473e-01   +3.968988826839130e-01   -5.405717073018728e-02; -2.829887438267925e-01   +3.436563536486870e-01   +3.578465976301982e-01   +2.654960178917308e-01   -6.746516206317552e-01   -3.743374633094522e-01   -7.521556272527118e-01   +3.140473878500851e-01   -1.524825620497995e-01   -3.182247573596731e-01   +5.873013665321211e-01   -3.168705232695594e-01   -6.584124720444788e-01   -3.967265398966474e-01   +2.609489909472146e-01   +3.139570967152277e-01; +9.644037651145577e-01   -3.322554779508038e-01   -8.452004380888631e-01   +3.564720912659374e-01   -5.817237320919200e-01   +2.924224790845988e-01   -3.954054522710850e-01   -1.976044483832002e-03   +4.033319857563702e-01   +8.626880210529401e-01   +5.524493597176356e-02   -2.610916758620111e-01   -3.138696741011269e-01   -8.643188508252275e-01   -1.996732580192931e-01   +3.386752738108244e-01];
L2I_L2E_iAMPA_netcon = [-1.174482906624578e-02   +1.662541067489889e-01   +7.173065283838461e-01   +3.703312707633269e-01   -4.010310764876669e-01   +4.050499593474978e-01   +5.341268839039915e-01   -2.690357227343737e-01; -9.522966950372466e-02   +7.499152231067190e-01   -2.963008006655594e-01   -6.108176521435703e-01   -7.724378709372699e-01   +1.000000000000000e+00   +5.123026396542063e-01   +4.462218001256908e-01; +2.169520846815574e-01   +2.511022238436486e-01   +3.913916455827776e-01   -6.960347550797843e-01   -1.662915310937118e-01   -6.511440947448312e-02   -2.523582324827766e-01   -8.025797552636460e-02; +7.964898306517937e-01   +5.326882339937828e-02   -6.935494315495656e-01   -8.239800563393672e-01   -3.998885452008111e-01   +2.277310803854832e-01   -3.758523118539256e-01   -5.286213361083558e-01; -1.888400689429593e-01   +1.265061576416812e-01   +6.338512955167144e-02   -4.323103735189368e-01   +2.583831327140094e-01   -4.634441208421904e-01   +2.963602433829033e-01   +1.825660545927795e-01; -3.331608414980419e-02   -4.586723322100099e-02   -3.884500660652914e-01   -2.666362724721273e-01   +4.782130028372850e-01   +1.147635837583910e-01   -8.607735547038914e-01   -2.524703197635910e-01; -7.391315671697882e-01   -3.520871964808168e-01   +8.944627592409178e-02   +4.799600198116418e-01   +8.136814263314253e-02   -5.420277827451744e-01   -6.949437403129216e-01   -8.332262323445790e-01; -2.535697018672769e-01   +3.043933679190209e-01   +2.243487052240255e-01   -4.181529567100062e-01   +4.866209212572020e-01   -4.558671101268978e-01   +1.172322004515181e-01   +4.192470557217852e-01];
L2E_L2I_iGABA_netcon = [-7.736546972240176e-01   -9.203225551123378e-01   -4.669607955618568e-01   -7.319724851063498e-01   -6.762225666585847e-02   -1.322297612825805e-01   -9.396766088467822e-01   +3.676297834888880e-01; +8.541932003136535e-01   +1.025461535141511e-01   -4.529516647837897e-01   +4.080949773589315e-01   -4.283517408314419e-01   -5.969097568298881e-01   +1.551664808236980e-01   +8.008964422416549e-01; -2.241437534519358e-02   +2.591132780884990e-01   +3.804177720331907e-01   +6.820728410644608e-01   -1.899504497894351e-01   +7.965496544395706e-01   -4.493036043029666e-01   -6.859843719703298e-01; -3.457263353381115e-01   +7.360272924989379e-01   -7.154796498425605e-01   +2.738626458430038e-04   +2.080234024565913e-01   -7.903676172208500e-01   +7.646189416055440e-01   -3.631137552252100e-01; +6.236701668998933e-01   +6.046140622835372e-01   -4.174271731656773e-01   -5.606876508262439e-01   -4.091575075903132e-02   -2.935842207709017e-01   -9.535754933642049e-01   +1.815094852146279e-01; -5.525791129417483e-01   -8.634798155374268e-01   -6.441779025373029e-01   +2.624402312876758e-01   -7.877685603990182e-01   -1.453759062946910e-01   +3.551178319986266e-01   -6.962326785144217e-01; -2.507457330225418e-01   +1.654948306900222e-01   +2.377085312824561e-01   +3.348806147762515e-01   -8.886013737643683e-01   -2.955369730317748e-01   +4.674244471616997e-01   -6.468819362912162e-01; +2.016701067928753e-01   +2.445427106783889e-01   +8.409073955304676e-01   -3.585954216914204e-01   -1.366171866204343e-01   -3.008052047479066e-01   +1.347445647801858e-01   +9.226291198767270e-01];
L3E_L2E_iAMPA_netcon = [-6.198232225565833e-01   +2.349928421818346e-01   +1.708019169533332e-01   +6.061840356178090e-01   -1.346101837175482e-01   +5.442878074714321e-01   +1.277298846658236e-01   -1.164132364817175e-01   +3.848001936344420e-01   +2.175173169420280e-01   -3.867013122542207e-01   +7.671511454784103e-01; +5.912401043778704e-01   +2.123157678445482e-01   +3.570605963647868e-01   +5.720156599179963e-01   -4.337522568175063e-01   +5.956517081474053e-01   +4.965713450795644e-01   +5.100088914331002e-01   +7.800853347444066e-01   -5.543229681749599e-01   -1.311026593909980e-03   +4.150139750649029e-01; -3.166973096039121e-01   -4.191824880412517e-01   +4.083056245827896e-01   +7.067573274483288e-01   -5.337429185282039e-01   -5.624388577629196e-01   +8.510529538662445e-02   -1.642327506953590e-01   -6.885515292895719e-02   -1.450068285572811e-01   +1.757756846933624e-01   -5.377993072631987e-01; +9.084230056131078e-01   +1.790818751285602e-01   -4.091297987718260e-01   +3.601737264050336e-01   -1.132329183845291e-01   +1.056848751393025e-01   -1.436620133921463e-01   -2.427792197490515e-01   -7.016599242946131e-01   -9.596528858062797e-02   -1.942259396087464e-01   +5.102951380656809e-03; -1.886331532006498e-01   +2.394423920210627e-01   +3.770403961808637e-03   +1.023637039472754e-01   -4.128848690927336e-02   +1.292168343326988e-01   -9.819807174189176e-01   +6.414023007675269e-01   -7.818948994384258e-01   +4.006789665130825e-02   +4.743583654208902e-01   -4.310199328404942e-01; +9.111246869100668e-01   -4.951196560357913e-01   +2.663518625510756e-01   -4.199610475517165e-01   -1.812114721996615e-02   -4.002585869957415e-01   -3.929699213816983e-01   -7.670674171313421e-01   -9.801170856054715e-01   +1.000000000000000e+00   +5.197226553638906e-01   +1.884850166375090e-01; -2.976666113127624e-01   -1.477701105102568e-01   -4.371131536590674e-01   -8.943918932421122e-01   +1.535118097577993e-01   +3.591223610023250e-01   -3.029564568693359e-02   +5.271546930468302e-01   -8.237907232238885e-01   -8.141889985665618e-01   -3.303435132809210e-01   +9.328852147441561e-01; -2.479340698091800e-01   +1.092072423808067e-01   -8.054187797215595e-01   +5.977262150871142e-01   -6.103903229983558e-01   +4.600770221094766e-01   -2.354125724296944e-01   -3.319724700497234e-02   +1.271123035534771e-01   -4.923365393773327e-01   -5.712142862756742e-01   +9.118274339313799e-01];
L3I_L2I_iGABA_netcon = [-4.429970973869140e-01   -8.733568383596910e-01   -6.465840950401250e-01   -5.303453779058782e-01   -3.944552988293797e-01   +4.050175027222709e-01   -7.586075639028650e-01   +5.004964564642689e-01   +8.551564351264905e-01   -6.509515062380397e-01   +5.527274991757194e-01   -5.428815325890158e-01; -6.890977619925363e-01   -6.844466160778909e-01   -4.931282396989079e-01   +7.947830170131543e-01   +3.327468903700215e-01   -5.861062568188660e-02   -5.616003944167748e-01   +9.982806292207105e-01   +1.029250457959184e-01   +6.657992790129322e-01   +6.893721047942594e-01   -4.024771950726163e-01; +3.204277467531125e-01   -5.058912721332605e-01   +5.222690495889646e-01   -3.126971563948767e-01   -9.414622101628993e-02   +7.009435484590447e-01   -2.156344277830019e-01   -5.471362882512050e-01   -4.175679045032605e-01   -3.157479330464567e-01   -2.257862708240244e-01   +1.000000000000000e+00; -7.529320830678994e-01   -4.175252252144590e-01   -5.464540717210525e-02   +6.800720022533283e-02   +5.833436477385996e-01   +4.326779574750388e-01   -2.017586002968303e-01   -6.008879575006998e-01   -8.929912099436106e-01   -2.119360416753135e-02   +9.546498792731375e-02   -2.288594234548665e-02; +6.784259038295061e-01   -3.131258874016621e-01   -3.460554612943841e-01   +2.766859668014788e-01   +2.341752107164156e-01   -5.688505120267889e-01   +2.231004068455157e-01   -2.499765140383491e-01   -3.963756055180747e-01   -8.921361846995207e-01   +6.700017014378292e-01   +3.699088097078649e-02; +3.456657500405776e-03   +6.729066603109707e-01   +3.988966970885722e-01   +7.840779645070445e-01   +2.725202380528919e-02   -1.878424452660935e-01   +8.178599810212337e-01   +9.932855590616273e-02   -7.216446992768322e-01   -1.816952223573426e-02   +1.639827467731966e-01   +6.188614481708603e-01; +2.898311840941563e-02   +1.396334883054357e-01   +7.616677814830365e-02   -6.888794090496463e-01   -3.687520885956060e-01   -7.834693938065350e-02   -5.220534605157771e-01   +5.360101228618881e-01   -7.620752876862693e-01   +5.406333506124515e-02   -3.936920589740212e-01   +3.124672357260286e-01; -1.611294624722776e-01   +8.253558697231331e-01   -5.014948108045593e-01   +5.465789508909031e-01   +1.477742675184323e-01   +4.955310362139511e-01   -2.844777761642498e-01   +5.462670744825925e-01   -3.694139459145926e-01   -1.522430728851306e-01   -5.165731262754734e-02   -7.417962530294245e-01];
L2E_L3E_iAMPA_netcon = [+2.771455567918781e-01   +4.353746198942637e-01   +9.649421749698321e-01   -9.676899408126672e-01   +1.392033507649796e-01   -1.522326201449937e-01   -1.086742535351720e-01   -3.283222896635681e-01; -7.973221220676121e-01   +5.969437960503591e-01   +8.190297797038417e-01   +7.326423135462909e-01   +1.311616836959107e-01   -9.429162648874269e-01   -3.843823180682574e-01   -1.000000000000000e+00; -4.870364905023684e-01   +2.619796916609602e-01   +1.296777562484427e-01   +7.727170202876488e-01   -3.241723784757124e-01   +7.257785201390163e-01   +2.788225113716931e-01   +4.476984959337712e-01; -5.628148261715519e-01   -7.805354777675676e-01   -4.565366593711325e-01   +3.375234303811715e-01   -6.031413704996506e-01   -1.822990746369451e-02   +4.350438122780360e-01   -2.499163307904077e-01; +7.978626313922914e-01   +2.930029856818224e-01   -5.311702480748645e-01   -2.282246320904625e-01   +5.012507295492893e-01   +2.334098444986121e-01   +7.075276629769253e-01   -3.553374683020581e-01; -4.021573094041984e-01   -7.317627359376646e-01   -4.850459873066787e-01   +1.564199209935901e-01   +8.707934001696269e-01   -5.787818873395958e-01   -4.714641723085178e-01   -1.487530223669642e-01; +6.337040019459466e-01   -2.862363810339391e-01   -1.447315226995476e-01   -3.371674387066154e-01   +2.121910045840948e-01   -1.487954073074327e-01   +3.095683924448092e-01   -4.462677981868752e-01; +6.733202730416450e-02   -4.877784531010477e-01   +8.968969062335387e-01   +2.602162083867818e-01   +3.071818968541476e-01   +5.795846771324509e-01   -8.242902381595307e-01   -2.116518284487448e-02; +1.565487073388172e-01   -4.629268309361211e-01   +4.703195361731072e-01   -5.496578716758410e-01   -4.993747700583155e-01   +2.568480915160369e-01   -4.446713787426721e-01   +9.500501314081584e-01; -1.039535528182330e-01   +5.313619335032101e-01   +1.285029134552936e-02   +9.813768237191526e-01   -1.198393194322636e-01   +9.677550980741041e-02   +1.139528111246163e-01   +7.536327147254104e-01; -1.095509192969750e-01   -3.397451118705950e-01   -6.176431794344697e-01   -5.709981001535582e-01   +3.667884577204013e-01   -1.933630816440590e-01   -2.791446160164651e-01   +3.446430578072768e-01; +3.811210900307801e-01   -2.794792752706499e-02   +1.176730054878905e-01   -5.739791074125358e-01   -4.144737622973472e-01   +2.043853397542494e-01   -8.366770198425595e-01   +8.261599361151064e-01];
L2I_L3I_iGABA_netcon = [-3.010912815915134e-01   +2.194487825563764e-01   +1.869922938736787e-01   +1.688253119126013e-01   -6.778767257911986e-02   -1.158087632592873e-01   +4.487773136022277e-01   +3.919028406365338e-01; +8.977191053480534e-02   +6.213006974132743e-01   -7.494252565829550e-01   -2.033901806254651e-01   -6.355097486230441e-01   +1.876094023312354e-02   -4.880131000616900e-01   -9.708988520601307e-02; +5.330139490346828e-01   -4.922854128301480e-01   +4.294650858799087e-01   +1.807933171327719e-01   -4.032515961686866e-01   +3.457169368267248e-01   +5.014094615128047e-01   +3.143830127034267e-01; +7.131032611362821e-01   +6.767275190210038e-02   -3.394941284528764e-01   -5.223719788996487e-01   -3.672037369105416e-01   +1.005202133060444e-01   -4.708674583093222e-01   -5.655244563193231e-01; -4.902040791979418e-02   +2.480570064076774e-02   +5.839938186815301e-01   +4.528724049907490e-01   +4.059984597312599e-01   +8.155918790437520e-01   +7.537373112424722e-02   +6.625820894359107e-01; -5.059526792190666e-01   -8.341397157966271e-02   +2.688331730137732e-01   +7.501910281220846e-02   -5.615487672660253e-01   -7.094442937889740e-02   -4.310526062537017e-01   -2.555586421244674e-01; +1.000000000000000e+00   +7.642692650726235e-01   -1.893715647823480e-02   -5.938783143984561e-01   +2.412824004270264e-01   -9.237651300638573e-02   +2.797341590567426e-01   +3.587705295745481e-01; +2.269148214588033e-01   +7.380078724833650e-02   -3.246741468411186e-01   +3.439651528686747e-01   -2.183799556977792e-01   +5.793665561696811e-01   -9.054874752878911e-01   +5.991624223340275e-01; -4.441427516593927e-01   -7.439537509772227e-01   +2.799214440596717e-01   -9.371666380644589e-02   +2.204513828694419e-01   +3.771330719298798e-01   +3.515712299609894e-01   +3.757940482815890e-01; -8.516622990540689e-01   +1.434261230352787e-01   -2.163174826914814e-01   +9.530130740393354e-01   -8.798672509704411e-01   -6.897793454064580e-01   -9.002624423752925e-01   -1.917996825538749e-01; -1.813640721281185e-03   -8.215310941040052e-01   +9.014717569973499e-01   +4.593427355095857e-01   -4.049830406306069e-01   -4.809346501091669e-01   +5.315937981593652e-01   +6.140871069176836e-01; -5.334538696960434e-01   -6.360562711339031e-02   -6.508273055319119e-02   +6.945214529667526e-02   +3.619552654209039e-02   -2.908860580494844e-01   -3.728700701125998e-01   +2.949736446309010e-01];
L3I_L3E_iAMPA_netcon = [-2.679241802851464e-01   +2.368189435071199e-01   +4.305778157267592e-01   +5.556026723166908e-01   -3.984148194331331e-01   -3.452361431584193e-01   -1.869072360799896e-02   +3.415145688801715e-01   +2.243778250290261e-01   +4.620163391801456e-01   +2.598666744286970e-01   -3.893316825953083e-01; -8.611019823454262e-02   -3.650720860792284e-01   +1.028184157089302e-01   +7.022274941675328e-01   +3.327772042398616e-01   +3.348529796002529e-01   -2.553290219556245e-01   -1.101167253491147e-01   -6.043195065416812e-01   -2.753081571121060e-01   -1.482630729207568e-01   -3.368530071672303e-01; +7.175828604521624e-01   -3.429901607387075e-01   +4.662775673359618e-01   +2.530593588588924e-01   -4.113533591706255e-01   -3.793931269822065e-01   -1.688605578405021e-01   +5.836311979642639e-01   +5.630628450083817e-01   +8.922177801582879e-01   +1.818192374582512e-01   +2.486296756397303e-01; -2.678046883177956e-02   -9.077813366358812e-01   +7.805796706061552e-01   -4.883272095411981e-02   -3.845442049097411e-01   -6.373237048802315e-01   -1.304484752033881e-01   -7.495551815119497e-01   +4.240278671788759e-01   +3.655905245192812e-02   +6.748414230491582e-03   -6.787076434462033e-01; +5.658621317500245e-01   -4.602973470780721e-01   +5.159140362147678e-01   +5.729133852456638e-01   -6.124249934542709e-01   +4.127071311007636e-02   +3.801022205939463e-01   -6.451443865151447e-02   -4.959717173302876e-01   -2.254408636014914e-01   +2.740409740290211e-01   +4.642200601064134e-01; -1.953017063214028e-01   -6.625161522317817e-01   +3.299692904517991e-01   -7.757569399278397e-01   +4.369587949400691e-01   -2.347889631549053e-01   -6.385676313970138e-01   -7.429924856621352e-01   -3.692965000594141e-01   -6.863041044485335e-01   +5.100209996589138e-01   +5.253587423950808e-01; +5.883916273388401e-02   -3.172062818750179e-01   -2.703327287451008e-01   -1.563237809435178e-01   -1.680286623249742e-01   +3.098038830803576e-01   +4.686646522601762e-01   -3.692453282135796e-01   +6.909631143701211e-01   -2.435603529492961e-01   +1.763363044402340e-01   -8.829888714054931e-01; +3.792740854603941e-01   +1.574633696223563e-01   +5.665699103418439e-01   -8.606418176417054e-02   +4.449456887432496e-01   -8.621094848789652e-01   +2.874481632942725e-01   +4.896294329982067e-01   +3.787883981834272e-03   -4.133755525326279e-01   -4.013883217242451e-01   +6.670868272203492e-01; +5.066150894296977e-02   -2.432779341948249e-01   -1.668937272962090e-02   -4.610948571695898e-01   -1.098456039287194e-01   -6.458859037326744e-01   +3.781975677666705e-01   +4.405006804957756e-01   -4.477935755026238e-01   +5.588276125966474e-01   -2.510452575090958e-01   -4.021182594138729e-02; +4.056713849147190e-01   -5.087049291373019e-01   +3.183969481124971e-01   -4.713074931440280e-01   -5.197667540002596e-01   +1.885059122858465e-01   -1.339352681373881e-01   -1.561730160208428e-01   -5.434298669205097e-01   -8.337252262496864e-02   +1.000000000000000e+00   -5.413727442942671e-01; +6.968131122945925e-01   -1.928774551721629e-01   +4.029697707450723e-01   -1.200842716639149e-01   +1.702438081065572e-01   +4.104439361541913e-01   +1.830500194790213e-01   -4.741752520737453e-01   -2.039359388012712e-01   +6.055923998443806e-02   -8.964899370900355e-02   +9.314319699039068e-03; -5.532681253225543e-01   +3.346847584606614e-01   -4.458162039816128e-01   -3.917937200525717e-01   -3.378884020928626e-02   -3.175388827432125e-01   -6.940716049499153e-03   -2.871938940354552e-01   +1.633301174070529e-01   -3.157233621390423e-01   +6.070472008765591e-02   +6.882748665254798e-01];
L3E_L3I_iGABA_netcon = [-6.807271830623887e-02   -1.819560167600529e-01   -3.167122795338965e-01   -1.421887776596895e-03   +5.634622060205273e-01   +4.880131690495339e-01   -2.770502463883989e-01   -8.137104505905820e-01   +4.154409737738267e-01   -3.800838547532918e-01   -4.119986416847771e-01   -1.209933700796863e-01; +3.119632266367842e-01   -7.843321676324780e-01   -2.996683172994845e-01   -1.149141761829713e-01   +6.980503367057997e-01   -1.959387670092029e-01   -1.906884018051061e-01   +1.933217225070971e-01   -1.231642313302038e-01   +3.829844393630086e-01   -2.858517843471893e-01   +7.016396903098797e-01; -2.506836866134511e-02   +1.207375097284175e-01   +4.935177620254441e-01   -1.301708621592569e-01   -7.120849465933363e-01   +6.599431236152332e-02   +3.657779432026109e-02   -3.726812037732327e-01   +5.980138542858086e-01   -4.253675341837899e-01   +7.186984987599817e-01   -3.601129580378138e-01; -8.466586685746949e-02   -4.630411862041200e-01   -1.115781825769578e-01   -3.702597948501593e-01   -3.237390602028701e-01   +4.743575559280178e-03   -5.432581565762856e-02   +4.547519475568731e-01   +2.921034920222583e-01   +1.764245782658737e-01   +6.118573971345179e-01   +7.379236577126316e-02; -1.696024953218668e-01   -1.493286952314950e-01   -1.097409067074901e-01   -4.413398601174985e-01   +6.497880080453878e-01   +5.870729639659650e-01   -5.068970675873975e-01   +4.512163361376048e-01   +1.538510862376279e-01   -3.617692201453196e-01   -2.821109666087084e-01   +9.610096723643777e-02; +5.517570459373420e-01   +4.809591877292860e-01   +7.720937623964048e-02   -5.461103562675982e-01   +5.612436406170725e-01   +4.510139158885594e-01   +2.184086611705516e-02   -2.036782689197885e-01   +5.194252054363211e-01   +1.593931614907968e-01   +3.015982500999114e-01   -9.073575613782123e-01; -2.984640013664702e-01   +7.159088364753529e-01   -2.785421895133430e-01   +3.644115770784824e-01   -6.199093389434108e-01   -5.946720771425997e-01   +1.886735605342161e-01   +2.079885603134213e-01   +4.420664903060108e-01   -1.624764932872339e-02   +1.151909313543466e-01   -1.395865639011210e-01; -5.488477349034361e-01   +1.556318994006589e-01   -2.292999564824870e-02   -1.991015271925898e-01   +5.943470509551648e-01   -1.843100510538463e-01   -9.099088759399045e-03   -3.558087406150052e-01   +7.228163396305994e-01   -2.862027527884154e-01   +2.357802271214420e-02   +1.445750709494032e-01; +9.591061786734389e-01   +5.173623428079350e-01   -5.314136272012462e-01   +2.548611729618067e-01   +2.368692513510740e-01   +5.496387635151478e-01   -4.329228447530918e-01   -3.127513579920332e-01   -6.235658362476428e-01   +3.560427348752278e-01   -5.582673796914259e-01   -4.438126177192146e-01; -6.073025534418833e-01   -5.043465015262087e-01   +5.231223325912719e-01   -1.873619408404630e-01   +5.196875243924677e-01   -3.213940887870947e-01   -2.904151475221247e-01   +4.089821374384437e-01   +7.092786989385298e-01   +4.376910416865017e-01   +1.069475386632295e-01   -5.388100175930260e-01; +9.854265102919516e-02   +3.899786917347622e-02   -6.518766990579386e-02   -1.609070815863693e-01   -4.775098476724534e-02   -2.895247592215274e-01   +2.422234782604471e-04   +1.000000000000000e+00   -1.678165499016342e-01   -5.281392298695532e-01   -1.676472472287965e-01   +3.118925625077723e-01; -5.944369161830004e-01   +7.254199848639362e-01   -6.254028769310973e-01   -2.315761467422348e-01   -3.201038510475118e-01   +6.517253618133384e-01   +2.891786877483802e-01   +6.633698551011527e-01   -8.529344959579661e-01   +2.263354512786846e-01   -3.535887624119169e-02   -5.598463629125153e-01];
L2E_Input1_iAMPA_netcon = [-5.967630913154026e-01   -8.635388428597947e-02   -5.103390169091051e-01   +1.000000000000000e+00   -5.546930190601820e-01   +5.063516653120654e-01   +2.422729286156062e-01   +1.251423687109498e-01];
L2I_Input2_iAMPA_netcon = [-1.751254810336936e-02   +5.369997096852684e-01   -5.015544444005714e-01   -5.124846826774936e-01   +6.699067393324680e-01   +6.835257424207641e-01   +6.787535302881846e-01   +9.096040980886341e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
