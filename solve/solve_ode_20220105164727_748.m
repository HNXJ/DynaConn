function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+8.237701698986689e-01   +4.236865397455902e-01   +5.308367179340836e-01   +6.367286295560322e-01   +6.012424801482963e-01   +3.406318710753292e-01   +6.480974416413516e-01   +8.410952248378764e-01   +5.442133289296058e-01   +1.919578787171022e-01   +4.427680849493212e-02   +8.222597074178037e-01   +7.678643594459240e-01   +1.105855613152294e-01   +1.541982436352896e-04   +8.376383511125053e-02; +9.834202993454229e-01   +9.472354221985534e-02   +3.246504787648461e-01   +9.575171965857152e-01   +3.868871428968075e-01   +6.064361852372040e-01   +6.786928273188240e-01   +8.320891698433065e-01   +7.220034695749342e-01   +1.377930054996608e-01   +7.543068962276261e-01   +4.300767524149887e-01   +1.671241043532706e-01   +1.352801561457788e-01   +8.663782974247266e-01   +6.264356557109027e-01; +7.310333810987254e-01   +5.986656616327964e-01   +1.057011270374472e-01   +2.415327566133269e-01   +9.158662060968361e-01   +1.907704357983311e-01   +6.350608956103668e-01   +2.560622583407379e-01   +5.214507975760139e-01   +6.957770457072675e-01   +2.429040877932348e-01   +8.875556200847019e-01   +8.631136382739799e-01   +6.784466173216027e-01   +6.129324880049081e-01   +6.612561196589793e-01; +3.441862836109014e-01   +4.714284705840280e-01   +6.119609165968597e-01   +6.760601284548210e-01   +4.793697430406826e-04   +7.389143078215246e-01   +9.450679965381138e-01   +6.124485676632906e-01   +9.935230593510521e-01   +9.307277956773820e-02   +4.429096740357835e-01   +3.916823587310295e-01   +9.908907838952683e-01   +4.941033399565407e-01   +9.900999969765273e-01   +7.298881222461766e-01; +5.846347731683497e-01   +6.962330596983403e-01   +7.798906932005100e-01   +2.885850884014721e-01   +4.618831432375614e-01   +2.431670129290515e-01   +2.092919755794913e-01   +5.827097614477053e-01   +2.198476128417642e-01   +5.244189825099331e-01   +6.868832588871213e-01   +7.691864773999133e-01   +5.151988594775632e-01   +1.888740822389726e-01   +5.265568742134790e-01   +8.917702556544613e-01; +1.089122459549285e-01   +7.002208011491089e-01   +4.245048031487477e-01   +6.707878877952713e-01   +4.253272257598484e-01   +9.181086198158166e-01   +7.099720957953064e-01   +5.412683980198353e-01   +1.055262772344191e-01   +5.307705302477101e-01   +3.587273452865228e-01   +3.970970121151433e-01   +8.842935922013683e-01   +4.950934802710420e-01   +4.802602930976280e-01   +9.822229361391838e-01; +9.055870202545703e-01   +6.391554706762330e-01   +9.139710271984720e-02   +6.953518450564717e-01   +4.610056894862047e-01   +2.701110959769289e-01   +2.367330477278159e-01   +8.698578933055032e-01   +1.108548986406568e-01   +8.617566218133947e-01   +7.359265993827739e-01   +8.096350046721935e-01   +5.875096600648648e-01   +1.480534353254798e-01   +8.020492766658769e-01   +7.694137667022569e-01; +8.807806427444347e-01   +3.305978691150005e-02   +2.667340506676351e-01   +6.756322888890184e-02   +7.705396972963010e-01   +7.646164830255024e-01   +1.193471361666692e-01   +2.637967439347058e-01   +6.463198618639004e-02   +4.844956647313010e-01   +3.951265412233677e-01   +7.552669525364837e-01   +1.547247253467011e-01   +5.432671622211319e-02   +2.286370425152750e-01   +5.824832234549475e-01; +8.166645385539881e-01   +6.910194550587807e-02   +1.531185255816684e-01   +2.538373700680900e-01   +3.226341240401747e-01   +1.892687654682354e-01   +6.079353854030812e-01   +3.174949914380990e-01   +4.037103363454184e-01   +3.927262502374899e-01   +6.842883016797286e-01   +3.771426348463041e-01   +2.001467323509922e-01   +8.517221488000092e-01   +4.971737754011261e-01   +9.274886696138933e-01; +2.597138985931619e-01   +3.189831278512947e-01   +2.809475979870734e-01   +2.229618342370141e-01   +7.851703444338248e-01   +2.870303383073165e-01   +4.513004435539039e-01   +1.187992483201722e-01   +4.481022064634053e-01   +6.724442388531373e-01   +7.045456927937138e-01   +2.167563623967289e-01   +4.063007451629166e-01   +5.616376391887981e-01   +8.996812678857750e-01   +5.807287554560434e-01; +5.947230082578615e-01   +5.297619089481274e-01   +4.411792656227650e-01   +6.687142825685504e-01   +4.712439328128582e-01   +9.038287948360693e-02   +4.591828756580743e-01   +9.407459487736989e-01   +3.656434090941943e-01   +7.422151237683424e-01   +4.430035759105535e-01   +7.912928228428980e-01   +7.484105092152832e-01   +9.297677122706216e-01   +5.748098017207179e-01   +1.686429365926603e-02; +2.256048947851948e-02   +6.537881278869014e-01   +5.262212450925080e-01   +8.444402942599123e-01   +3.595725093591504e-02   +5.772358544934812e-01   +6.621834778891653e-01   +6.461965952390135e-01   +7.626984576284686e-01   +5.190326536381717e-01   +1.867877182129534e-02   +9.497310684424247e-01   +8.245034467272249e-01   +6.977729499866658e-01   +8.452748715836647e-01   +1.219670520805899e-01; +4.256817635089731e-01   +4.080607491809606e-01   +4.584639754960568e-01   +3.449017156502115e-01   +1.770151387987111e-01   +6.836000713966307e-01   +7.698869006947032e-01   +4.805300117973147e-01   +6.267985307574502e-01   +3.466851081093548e-01   +3.306550091688666e-01   +3.287278592206975e-01   +7.901064710015188e-01   +5.835593901286978e-01   +7.379002477551043e-01   +8.631645211079916e-01; +3.124777576232827e-01   +8.197146878640319e-01   +8.749335246980372e-01   +7.813983993740125e-01   +7.207676497438709e-01   +5.467593916269095e-01   +3.508003142592422e-01   +6.395897271845657e-01   +7.719871595691979e-01   +1.491222059529780e-01   +4.236337521768641e-01   +6.719111491909895e-01   +3.192999932730282e-01   +8.155435555719248e-01   +5.855262444001639e-01   +4.834744281768943e-01; +1.609211610613276e-01   +7.194215754447946e-01   +5.185444141993609e-01   +6.755776611785186e-01   +4.735819694258722e-01   +4.247941163629349e-01   +6.620144936738382e-01   +5.437535526446405e-01   +9.331674745445474e-01   +5.867901969260282e-01   +2.694992830784350e-01   +4.395593028681452e-01   +5.336740828195817e-01   +8.798723690259903e-01   +2.457647848277071e-01   +8.453267570869389e-01; +1.777482407507993e-01   +9.682017395237307e-01   +9.444228565916087e-01   +7.835024186470037e-03   +1.524188624227869e-01   +6.433890987583132e-01   +4.154568896663202e-01   +6.461890231443703e-01   +9.722649936160773e-01   +2.618564015163488e-01   +1.969361978619627e-01   +8.330858377551408e-01   +9.086825435926446e-02   +9.899027351022355e-01   +6.658814829133207e-01   +2.090087268396047e-01];
L1E_L1I_iGABA_netcon = [+5.515215267850029e-01   +6.944403903704176e-01   +1.054050676170811e-01   +1.765792416916774e-01   +5.504322694759690e-02   +1.784740827514744e-01   +5.964747404023728e-01   +9.960308173348824e-01   +3.389729752453148e-01   +7.798607643291654e-01   +6.832823461122625e-01   +3.655036541057490e-01   +7.822808514831826e-01   +4.322930358876669e-01   +5.971979816288961e-02   +9.836793372359177e-02; +6.304260777201913e-01   +4.980928125348907e-01   +1.414371201080306e-01   +3.988073883846166e-01   +1.777639024455712e-01   +3.605683537082653e-01   +2.995141217397483e-01   +3.311854552879396e-01   +2.938421004038948e-01   +3.374903238678262e-01   +1.312145122704452e-01   +3.692212535758550e-01   +1.006565638480620e-01   +6.551301540829244e-01   +3.151103314414541e-01   +1.429332947183844e-01; +3.243340806557491e-02   +5.346219436083300e-01   +1.666142663817063e-01   +1.333848001198902e-01   +6.624521879408112e-01   +5.625830978928045e-02   +1.338723237665770e-01   +2.975651758962344e-01   +7.452128412510113e-01   +6.067037480307824e-01   +7.221852491677273e-01   +6.845647974544734e-01   +2.936653204176567e-01   +1.109073931858961e-01   +7.724620315064162e-01   +1.686489227341203e-01; +6.141611886060802e-01   +4.444513818358508e-01   +6.216643187088391e-01   +2.990867719188577e-02   +3.314527199144727e-01   +5.216133273932383e-01   +2.114861895052657e-01   +6.275518335241058e-02   +1.126044427383321e-02   +7.417273827713735e-01   +1.095482890445562e-01   +5.976377038578076e-01   +2.362923813729210e-01   +9.332008633203784e-01   +6.964699713189465e-01   +1.955448311955642e-01; +3.631841816031356e-01   +1.234063713116886e-01   +5.731029770042859e-01   +9.379363567305924e-01   +8.981317438529011e-01   +3.356052632158998e-01   +8.956740424246386e-01   +2.971888529343072e-01   +4.848932731409154e-02   +1.058005191380333e-01   +1.168716739159779e-01   +7.882982917621053e-01   +5.299746825844740e-01   +1.863648486542692e-01   +1.243624089702982e-01   +3.179674264100333e-01; +4.979087908980454e-02   +4.909904010232504e-01   +5.236232651943047e-02   +3.007295076081718e-01   +1.176354141992475e-01   +1.751461771580140e-01   +7.253183905291921e-02   +4.524617370527434e-02   +6.669193184376170e-01   +1.276214343903249e-01   +6.398748067881027e-01   +3.684473305280697e-01   +9.233128972333773e-02   +2.664592540730277e-01   +1.289934070208750e-01   +3.172317809484880e-01; +4.885481625970167e-01   +8.525393210847347e-01   +9.319025029332426e-01   +2.960968485603216e-01   +9.893321917960196e-01   +2.099717387248103e-01   +2.435431597282794e-01   +5.051542805664432e-01   +6.043920845402354e-01   +5.489559632027450e-01   +3.290372755065509e-01   +2.059272916276628e-01   +4.062833421868352e-01   +7.973582682210602e-01   +9.238254724745039e-02   +2.177072227942262e-01; +1.924512505731602e-01   +8.748094756650017e-01   +7.286221488698402e-01   +3.338295123801481e-01   +5.410780823570662e-01   +9.057312493436607e-01   +5.469950945825663e-02   +7.618412880307566e-01   +5.262910272416320e-01   +4.852939197455337e-01   +6.547369385088573e-01   +8.741293936143266e-02   +1.041532977326030e-01   +4.877740161566947e-01   +8.441361771407667e-03   +2.515904747424302e-01; +1.220769289179977e-01   +2.705369294389517e-01   +7.378528851400876e-01   +4.676927609333612e-01   +7.058816326691769e-01   +6.745944439413286e-01   +4.409240725756882e-01   +6.320902384155039e-01   +7.293387790463068e-01   +8.916040562982833e-01   +7.498510963222005e-01   +7.721936899852481e-01   +1.115823988056173e-01   +7.692698657993035e-01   +4.239773470805385e-01   +8.933145198459825e-01; +2.066000624796596e-01   +2.089351059813687e-01   +6.316094176853392e-02   +6.470023003945502e-01   +1.000000000000000e+00   +4.675296460161645e-01   +1.414293144188006e-02   +9.047022914084643e-02   +7.072703591097991e-01   +7.985979382823511e-01   +5.842902381429064e-01   +2.067813404492508e-01   +7.848916775319394e-01   +3.969829349189456e-01   +6.549053073796206e-01   +7.031744861628192e-01; +1.467026529521383e-01   +5.638452058552402e-01   +8.600033330515696e-01   +2.409158825396036e-02   +2.882096153382523e-01   +9.124464776001847e-01   +8.970749890227658e-01   +8.021476055466868e-02   +7.806350874037066e-01   +7.352481768563016e-01   +7.410049494050517e-01   +3.880743288461277e-01   +2.914928776592695e-01   +2.720622364137897e-01   +7.231752308633345e-01   +5.550003397999708e-01; +1.889260097713327e-01   +6.397118262014780e-01   +9.333744213975739e-01   +8.429879651561418e-01   +4.138473241073017e-01   +1.037017126162790e-01   +1.959104870909839e-01   +7.761034399452454e-01   +2.883027194721455e-01   +5.188882350224607e-02   +2.347790672514882e-01   +5.518724695798664e-01   +6.035112868722629e-01   +3.766177104332287e-02   +5.305860961260445e-01   +1.845948615384737e-01; +4.257651489800456e-02   +4.170018321099760e-01   +9.837791540489080e-01   +5.585899199062698e-01   +4.653905089560428e-01   +7.449883688912554e-01   +9.315207152132016e-02   +9.055834373074926e-01   +6.915441276669130e-01   +7.279046392399606e-02   +7.344130755775718e-01   +2.285657394349419e-01   +9.636264596412614e-01   +6.734567428570984e-01   +1.086495477580403e-01   +2.111630046671941e-01; +6.358963864326987e-01   +2.065058870532795e-01   +8.584742716985858e-01   +8.545668200228305e-01   +7.642940085611071e-01   +7.369900977141661e-01   +3.079376865301762e-01   +5.337037750418568e-01   +5.567088602886039e-01   +8.751131630416081e-02   +9.709406554294240e-01   +6.419261458441823e-01   +4.325722287903854e-01   +4.288161229477910e-01   +6.324690541029832e-01   +7.619273357316472e-02; +2.818597678921812e-01   +9.477732276368228e-01   +7.859590839491457e-01   +3.482576452199298e-01   +8.174980090253430e-01   +5.617816429990864e-01   +4.555334017212493e-01   +1.093800378723981e-01   +3.965166529094670e-01   +7.973592995202692e-01   +8.669058847275790e-01   +4.838437663076672e-01   +6.950826379078122e-01   +4.514978377488807e-01   +1.270978769345255e-01   +9.141672428617680e-01; +5.381586304152550e-01   +8.106069563496870e-02   +5.141640007867004e-01   +4.467308118823926e-01   +1.004707189286206e-01   +1.849647917436396e-01   +1.017387047467860e-01   +8.267655665405470e-01   +6.140340245092517e-02   +9.428841316983679e-01   +8.627681257179579e-02   +1.514270669336386e-01   +7.570657488576487e-01   +6.087475414498356e-01   +1.339695753686249e-01   +7.060685856629795e-01];
L2I_L1I_iGABA_netcon = [+5.582915182004561e-01   +1.599952485157578e-01   +4.246245076653566e-01   +6.822893587878534e-01   +8.083289776099926e-01   +7.952243858594455e-01   +7.887725059710033e-01   +2.584564982423144e-02; +3.128010684742670e-01   +7.575983864151583e-01   +4.291982804803997e-01   +4.639149665034660e-01   +7.493526588765617e-01   +5.782649519747673e-01   +8.522403661120483e-01   +4.219580669290071e-01; +1.663763266185220e-01   +8.699879790655927e-01   +1.243565753146956e-01   +2.132063561488970e-01   +1.191910223256559e-01   +4.412038055277187e-01   +5.064755303851084e-01   +1.830536954777594e-01; +6.222266807771821e-01   +3.511163128580221e-01   +2.348946674132475e-02   +9.820622709054820e-02   +5.242977058656499e-01   +2.578104105411174e-01   +6.364619153640210e-01   +7.263281234927584e-01; +9.879406474886032e-01   +6.863136840066653e-01   +2.904321629944716e-01   +8.228241347993991e-01   +3.263056806460587e-01   +7.510408439570960e-01   +9.510489847509878e-01   +3.695024060492131e-01; +1.705570773440984e-01   +2.938428118848693e-01   +3.182843125439537e-01   +1.757260118248638e-01   +5.456473786384315e-01   +2.295276959030951e-01   +4.433713772829436e-01   +8.411670171509290e-01; +2.588878312622827e-01   +5.304176013432520e-01   +6.533174176589771e-01   +1.646987588038503e-01   +3.997084939759715e-01   +6.530291100728981e-02   +5.905140321849092e-02   +7.339655205908377e-01; +3.975291137025820e-01   +8.333822263330023e-01   +9.573856313181524e-01   +6.670108232201918e-01   +4.153844664761287e-01   +7.672156469194830e-01   +8.670031859483355e-01   +5.711585626105015e-01; +7.456829432522002e-02   +5.973248040652603e-01   +9.363331811982232e-01   +8.941690096511991e-01   +1.802726269738758e-01   +6.717897384015984e-01   +6.315067773898908e-01   +1.778518462067043e-01; +6.847863340244013e-01   +3.347588218586397e-01   +4.572284755204382e-01   +5.170917850429700e-01   +2.545877498956906e-01   +7.147133167831625e-01   +3.543101592698727e-01   +9.585261619402967e-01; +4.032130335998049e-01   +2.992029848542408e-01   +2.396209936178726e-01   +7.028132191459138e-01   +1.937281738730689e-02   +6.426312377515790e-01   +9.972374368768001e-01   +2.657760950569041e-01; +9.825265200307091e-01   +4.524254520606313e-01   +7.647741814270578e-01   +1.525896047226105e-01   +9.240202974759179e-01   +4.194128129629302e-01   +2.243563175014592e-01   +9.242253339191224e-01; +4.013807705518305e-01   +4.228469682299404e-01   +7.592856465801664e-01   +9.530179992501059e-01   +6.538171076093948e-01   +3.918808029721311e-01   +6.514210785365727e-01   +2.226529427253572e-01; +6.214935365355403e-01   +3.586754930114203e-01   +7.394832749701808e-01   +5.411779144805432e-01   +9.333940681402025e-01   +8.159769706456307e-01   +6.049470498605388e-01   +3.731462139436574e-01; +1.551030348085277e-01   +5.593931528690548e-01   +7.441392513586288e-01   +6.808478353809250e-01   +1.636490106756577e-01   +3.164571652835599e-01   +3.875570898309567e-01   +8.666019203330227e-02; +3.824843378756904e-01   +7.429540114816453e-01   +1.070448287453777e-01   +3.713817940995743e-02   +9.218000624198708e-01   +8.151362729670497e-01   +1.412113038387899e-01   +6.406130230036394e-01];
L1I_L2I_iGABA_netcon = [+1.810024479500116e-01   +9.111610608856061e-01   +2.761609921536391e-01   +8.671975412809031e-02   +5.337784265901855e-01   +1.067585779644711e-01   +9.882761237989186e-01   +4.113241343503902e-01   +7.204908164911665e-01   +2.173004709321874e-01   +9.225202424530772e-01   +6.736936467914715e-01   +1.069294414785372e-01   +5.574624490254114e-01   +6.297667963023869e-01   +4.846212831412665e-01; +4.582055997806088e-02   +8.001900386462721e-01   +2.476773621916745e-01   +8.025422745618477e-01   +8.864088776819523e-01   +6.153243422671465e-01   +7.676988780382072e-01   +6.017072926888837e-01   +9.962926107263825e-01   +1.259684641019793e-01   +7.712170798245120e-01   +4.781591366215372e-01   +1.817710469352495e-01   +7.715904886586124e-01   +1.008976824219568e-01   +8.938593348776461e-01; +7.235104424158241e-01   +7.448199718617964e-01   +4.515483604599616e-01   +9.895636137428055e-01   +8.983703086403894e-01   +9.403822109041656e-01   +3.364569551957590e-01   +7.499463181439721e-01   +3.548718680300337e-01   +3.088146601735348e-01   +4.358940832986338e-02   +6.245394939739481e-01   +9.924458246474986e-02   +3.123499804125429e-01   +3.907216921577770e-01   +1.381926759170257e-01; +3.477859738784024e-01   +8.134615333053729e-01   +2.277477002262978e-01   +6.728871751574368e-02   +6.248460546163979e-01   +3.539115158701935e-01   +6.623576325183430e-01   +5.834759375280355e-01   +9.721340844804455e-01   +7.258480883984462e-01   +3.785013240886262e-01   +2.372732381591281e-01   +4.899411737744575e-01   +1.787704064126182e-01   +5.511124340984262e-02   +3.899247331222719e-01; +6.601715663491357e-01   +3.826917274475890e-01   +8.050782668898977e-01   +9.394187047668151e-01   +1.371179579845206e-01   +4.111597380541353e-01   +2.452456698533495e-01   +5.523685309551504e-01   +3.474264920713646e-01   +7.830736901527504e-01   +7.042190236051670e-01   +1.777156515590266e-01   +1.930221610305410e-01   +3.391842484674916e-01   +5.012396196433583e-01   +9.278779323836328e-01; +3.846303853228242e-01   +6.171876745450350e-01   +9.851772665145290e-01   +1.785528910445182e-02   +2.183613603225349e-01   +9.841429961696123e-01   +2.949727325165758e-01   +5.824787265031411e-01   +8.864909772520699e-01   +6.926620031024135e-01   +7.284274197380352e-01   +8.298220609844108e-01   +8.949893356421876e-01   +2.093013582197567e-01   +4.313592208070394e-01   +9.183708367811516e-01; +6.279963234949717e-01   +5.759235884908881e-01   +2.963199250643073e-02   +6.842447832296674e-01   +1.814184809597605e-01   +9.449353375621583e-01   +6.799624171419986e-01   +5.113228025422339e-01   +4.550621841849298e-01   +8.923522755452551e-03   +2.253650821589472e-01   +7.657627140094242e-01   +9.960554678521126e-02   +5.103043531028271e-01   +9.977582958142918e-01   +7.144372733392539e-01; +2.221648297797329e-02   +5.288857404532765e-01   +5.367060550732661e-01   +7.828418904655541e-01   +4.258358713869530e-02   +6.762568936613612e-01   +5.274129625797909e-01   +8.262198726039020e-02   +4.138782312362826e-01   +8.443540391265194e-01   +2.687501751582957e-01   +9.340185332953167e-01   +4.516675588733913e-02   +9.062179882727868e-01   +8.105306171621505e-01   +6.181745635596977e-01];
L2E_L1E_iAMPA_netcon = [+3.435248258789982e-01   +7.575073054858816e-01   +5.896946522253903e-01   +5.027180331708625e-01   +8.491309862405233e-02   +4.672491088715384e-02   +9.228221056595062e-01   +4.763334341743655e-01; +9.357288290847615e-01   +4.137010133076102e-01   +6.613475866220712e-01   +4.888356061996719e-01   +9.745391522831007e-01   +3.429638679705732e-01   +8.004863832022893e-01   +3.635320475564109e-01; +1.245103502534406e-01   +4.928780228468046e-01   +4.823003623693981e-02   +8.775565691601090e-01   +6.513411358578701e-01   +7.360617786656506e-01   +2.867833256506818e-01   +7.887437442171042e-01; +7.308280415978984e-01   +6.955558900492838e-01   +3.479329775041654e-01   +3.531098305798200e-01   +2.304985594826588e-01   +7.952634472626630e-01   +5.443450407256056e-01   +7.807091066477498e-01; +6.466625771504362e-01   +9.737289199398990e-01   +4.502345489051822e-01   +4.497172228206051e-01   +4.028416830301988e-01   +5.442673202223686e-01   +9.838816903215245e-01   +6.678645869059072e-01; +8.326458058918813e-01   +3.281081410321451e-01   +2.398015852189419e-01   +9.644399012254706e-01   +1.214449333638931e-01   +6.873291054772553e-01   +7.146365607793221e-01   +1.330301972464854e-01; +3.976493723029327e-01   +8.382547812536655e-01   +7.148081651956708e-01   +4.287400038761274e-02   +2.686033226014184e-01   +8.936986237322943e-01   +8.396045576296097e-01   +2.044839475297035e-02; +7.498888325986700e-01   +7.393304072515827e-01   +8.556049799142533e-01   +9.733049572335336e-01   +2.566989649531412e-01   +5.394043463529639e-02   +4.336858716466179e-01   +5.594836102104178e-01; +8.348455992625279e-01   +9.539767480440322e-01   +2.821436569539491e-01   +1.880502994228071e-01   +3.328140836195593e-01   +3.041567363664452e-01   +4.709953757196582e-01   +3.015421938300480e-01; +3.233048675990077e-01   +3.259851775471118e-02   +7.308348720479613e-01   +6.662623556350953e-01   +1.514197716983134e-01   +4.600021286053282e-02   +5.609699117477748e-01   +9.391349898918309e-01; +5.515652948339144e-01   +3.557997321846633e-01   +1.387646644629783e-01   +5.871124575131678e-01   +3.475540372970234e-01   +1.953241993026346e-01   +2.694921501814235e-01   +9.816644421455979e-01; +9.800754973300243e-01   +6.620208801849642e-01   +8.373799629776525e-01   +6.751616065943222e-01   +1.208417450021424e-01   +7.192184598068700e-01   +7.482801544762431e-01   +2.874068983563496e-01; +5.485481369305530e-01   +2.824356210935275e-01   +1.389763328397398e-01   +3.599540958760402e-01   +8.831812975420404e-01   +7.225373802220529e-01   +5.042356496124316e-01   +8.001920381570202e-01; +3.304715323009945e-01   +2.301758765465241e-01   +5.873325758861815e-01   +6.206469661160422e-01   +9.500294184791057e-02   +8.771719713027637e-01   +6.470103847372305e-01   +8.954618514459771e-01; +6.189271271233152e-01   +7.103639009531120e-01   +3.672559106726890e-01   +8.115939205736814e-01   +9.304046121018325e-01   +5.813214511818624e-01   +3.079826913353579e-01   +5.982259366293674e-01; +3.617286158710844e-01   +6.239978757555135e-01   +8.060530094115320e-01   +2.038348294882446e-02   +3.998797137282365e-01   +7.126810571207480e-02   +1.384836538400561e-01   +8.843005632589432e-01];
L1E_L2E_iAMPA_netcon = [+9.433864802247441e-01   +3.722518426387946e-01   +6.679071151486662e-01   +4.856029323239680e-01   +2.475308136241743e-01   +4.510302025727346e-01   +1.224274630587737e-01   +4.972035456143200e-01   +8.833758145732070e-01   +3.252344503455192e-01   +5.142200907979425e-01   +8.541990197343177e-02   +6.307327612246810e-01   +4.294914158924343e-01   +6.130569045291163e-01   +5.046291050856738e-01; +5.490582970491958e-01   +9.373329125042503e-01   +2.078039933067527e-01   +7.572749825103490e-01   +7.852172004577990e-01   +2.046147341468025e-01   +4.077045755565017e-01   +6.939719233446453e-01   +7.200071469454923e-01   +2.460100638050978e-01   +6.576828165758843e-01   +1.631439049942548e-01   +8.590842637593961e-01   +4.926235839501622e-01   +8.194395332683407e-01   +6.122361762053957e-01; +7.284678682508211e-01   +8.299671223447777e-01   +6.538618375193951e-01   +4.169456276578527e-01   +8.833427250749122e-01   +8.995991896159445e-01   +2.762567901691481e-01   +8.333131088206737e-01   +1.901070693050137e-02   +3.425886716194242e-01   +9.519144426266370e-01   +3.231511169003038e-01   +9.752718437647431e-01   +7.004593169389259e-02   +8.869638843260876e-01   +8.200171378220842e-01; +5.767580085806746e-01   +8.489212337133993e-01   +7.207869874383502e-02   +9.713005181869898e-01   +9.132642895653157e-01   +7.622925096018265e-01   +7.169298865665795e-01   +6.108008392897284e-01   +6.751843675946149e-01   +3.745721348594332e-01   +7.231760669176198e-01   +3.014492646341087e-01   +5.699073181343743e-01   +8.879524602811769e-01   +9.299476531878333e-01   +5.312601760773336e-01; +2.599425664933671e-02   +3.713824415111167e-01   +4.063932442914092e-01   +9.890158812320972e-01   +5.587947636517127e-01   +8.833757625616406e-01   +2.823350772452098e-01   +5.745792400607713e-01   +4.384276285041176e-01   +5.457219034034066e-01   +3.999383434332624e-01   +1.178469900120190e-02   +9.975305110609654e-01   +6.467689319655680e-02   +1.915994566744197e-01   +2.029634905664927e-01; +4.472974970364785e-01   +5.931556783639571e-01   +6.668499291300971e-01   +8.644797598025593e-01   +5.990020747107840e-01   +2.856774714586646e-01   +8.964149689492444e-01   +3.253004884760148e-01   +4.367887188814452e-01   +5.621270319223834e-01   +8.327079791595000e-01   +5.403667771911688e-01   +5.537401505254034e-01   +4.367551436291984e-01   +2.589191211771187e-01   +4.548597361670862e-01; +6.471124730490148e-01   +8.734246851286032e-01   +9.348845610395247e-01   +3.887553434163207e-01   +1.485745893921173e-01   +6.722660849560078e-01   +8.267989730829634e-01   +4.564627550536206e-01   +1.165035689465212e-01   +3.952905250674660e-01   +1.353590107084627e-01   +9.635340808723310e-02   +5.146852647627036e-01   +8.257677099602797e-01   +8.972854215874555e-01   +4.284171851510615e-01; +5.214948576248517e-01   +9.336500377716080e-01   +8.102461333559234e-01   +4.549220966134092e-01   +9.003158685010676e-01   +6.638855378949421e-01   +3.899880757750283e-01   +7.145179492511594e-01   +8.144545843887775e-01   +3.976489645205054e-01   +5.999058221134544e-02   +1.476441964167676e-01   +3.314756826006214e-01   +3.941286815663346e-01   +5.938781344930254e-01   +9.663300401699708e-01];
L2I_L2E_iAMPA_netcon = [+6.195190707410453e-01   +6.955145801668580e-01   +7.344717665979930e-01   +5.901183037280577e-01   +6.690196368815836e-01   +5.570323485065751e-02   +9.852702300918137e-02   +8.486263353179977e-01; +6.962254047301631e-01   +4.267251872423564e-01   +4.293207891876356e-01   +4.599190931523758e-01   +5.000601240700473e-01   +1.530890181990513e-01   +9.079073739462378e-01   +9.173573201975649e-01; +7.212636695488572e-01   +8.364900153647062e-01   +6.940214439756847e-01   +5.134418894524973e-02   +2.189214159782547e-01   +1.957751389850352e-02   +1.091435731238599e-01   +9.871452119953539e-01; +3.473819860399180e-01   +7.313500214421433e-01   +9.449057344240903e-01   +2.280747355768730e-01   +5.720953646979783e-01   +4.346989320394929e-01   +5.166665258272231e-01   +5.039776622214506e-01; +5.175910185298340e-01   +3.610732896662102e-01   +7.834280963563479e-01   +8.349726460941568e-01   +1.216330400953039e-01   +8.318326377810323e-01   +1.442390938374095e-01   +2.705730219046465e-01; +5.566548123859089e-01   +4.546184323425262e-01   +7.057336145887344e-01   +1.591640550944524e-02   +6.710339499592810e-01   +6.166589871434894e-01   +5.601273918993435e-01   +1.014165583958362e-01; +1.567347857554688e-01   +3.863486576555606e-01   +1.098769463762486e-01   +8.647277690714349e-01   +6.001711849308404e-01   +5.205636873274767e-01   +5.302563412788308e-03   +5.088878346077955e-01; +5.628944886286663e-01   +7.756646229262814e-01   +3.897900797184692e-01   +7.819858656436034e-02   +5.607657971238280e-02   +8.632947679243259e-01   +7.676472795931769e-01   +5.844909649295398e-01];
L2E_L2I_iGABA_netcon = [+7.633709764536067e-01   +9.418786926055295e-01   +2.393156068288887e-01   +8.341496888280459e-01   +2.571925688865852e-01   +7.523303042836871e-02   +1.747010031832365e-01   +5.237115370329289e-01; +8.367150468490875e-02   +6.569682077768513e-01   +5.798115469619697e-01   +4.027654446385853e-01   +2.976017967571736e-01   +3.937929163027025e-01   +1.390294716398058e-01   +2.647941464688324e-01; +6.611685961425643e-01   +4.523060627320700e-01   +8.668006316216245e-01   +3.908975679672309e-01   +4.258215482666453e-01   +2.649950840516449e-03   +5.996967378969078e-01   +6.809126138913352e-02; +5.169167853156990e-01   +8.398350038894397e-01   +4.060522137558479e-01   +3.612971873901568e-01   +1.186651392467019e-01   +2.199727634116440e-01   +8.998952618953002e-01   +4.366939367016542e-01; +1.713895862632202e-01   +5.327951743954703e-01   +1.117556068348747e-01   +1.393405733263925e-01   +4.957894767047550e-01   +1.185499905253695e-03   +9.389633699274217e-01   +1.732180333244243e-01; +9.397233812908496e-01   +5.542539005977832e-01   +4.445672622595204e-01   +2.591489858238297e-01   +7.061793389280807e-01   +1.896929666044399e-01   +2.209244731046700e-01   +2.701291628521322e-02; +5.907702866689306e-01   +6.799070477786276e-01   +2.996517944517765e-01   +8.703610996972390e-02   +2.436813913286228e-01   +1.426592949751408e-01   +4.816811148092162e-01   +9.541203530761960e-01; +4.415266743002130e-01   +3.672198387099067e-01   +4.002198764361404e-01   +4.303685701389116e-01   +7.849740204977785e-01   +2.677096196969336e-01   +3.758764897895921e-01   +4.307540347484879e-01];
L3E_L2E_iAMPA_netcon = [+9.621543770111866e-01   +7.731025724159524e-01   +9.113360187773021e-01   +5.318048203279545e-01   +4.816786256653344e-02   +8.193768557117828e-01   +6.250456837293240e-01   +7.481189588290199e-01   +6.733766791570510e-01   +9.054567511963857e-01   +5.823993920702948e-01   +5.852996738273638e-02; +7.612932732890590e-01   +2.272974298929783e-01   +9.081370118492240e-01   +7.159022612034792e-01   +5.526585926838383e-01   +7.274434743725575e-01   +5.427674107473166e-01   +6.465085471182508e-01   +4.315937555037916e-01   +3.933466202132779e-01   +6.876937587802306e-01   +9.800095255262696e-01; +7.057020060086138e-03   +3.702441549008326e-01   +5.911124703589662e-01   +1.797989643698176e-01   +2.739424629409785e-01   +1.768332318905869e-01   +4.379588916400361e-01   +1.227475748175505e-01   +6.936601610967955e-01   +2.573228955446758e-02   +7.202504283184695e-01   +2.850508577662131e-01; +6.801410899936033e-01   +8.913736194121803e-01   +3.320200615720762e-01   +3.353724836585916e-01   +2.422332460489205e-01   +3.609949018835250e-01   +2.878094319211438e-01   +5.052904556868086e-01   +2.567204594383445e-01   +6.710252018697427e-01   +6.491487133703004e-01   +5.950296869527274e-01; +7.055344579367691e-01   +8.558519564259391e-01   +8.528639265772701e-01   +1.866151514949393e-01   +2.420775221733070e-01   +1.877287302685332e-01   +5.006008249143903e-01   +3.464453207505744e-01   +1.092432044969658e-02   +8.378337524970917e-01   +7.266809971452050e-01   +9.612540629216035e-01; +6.449904617694746e-01   +4.018508988257549e-01   +4.426722290716392e-01   +3.211298486409239e-01   +1.547296993775282e-01   +1.168742658711850e-03   +7.624793316749184e-01   +9.137677098353988e-02   +5.311733801380757e-01   +9.714456586296760e-01   +3.739957648763479e-01   +1.865311293215556e-01; +5.524238791095517e-01   +3.188201174690477e-01   +9.038904665653500e-01   +4.042232864389484e-01   +9.574158529287941e-01   +3.152681545444644e-01   +7.615298987592688e-01   +1.477115328366593e-01   +2.787144786817609e-01   +5.699386392804103e-02   +5.809471199584515e-01   +1.921847060815878e-01; +2.185291998144597e-01   +6.093615757345235e-01   +3.341704959631780e-02   +5.494544683579600e-01   +9.364219987923756e-01   +6.985477921810425e-01   +5.767006143747426e-01   +1.992437035484806e-01   +9.459746443969347e-01   +4.493080421630749e-01   +1.151986178688505e-01   +3.413603498870469e-01];
L3I_L2I_iGABA_netcon = [+9.334138761751201e-01   +9.239304470098590e-02   +6.165269131183621e-02   +2.777783725411092e-01   +2.546747314887911e-01   +4.037131332387484e-01   +5.295751386638026e-01   +1.096657923755452e-01   +9.123722847966276e-01   +5.849580378799313e-01   +2.086914767191941e-01   +9.090003276905022e-01; +3.905217395471917e-01   +6.154131931101652e-01   +4.958243407230993e-01   +7.454875477203707e-01   +8.581195618205185e-01   +9.886676861014209e-01   +8.293262592470114e-01   +2.705198554280496e-01   +6.396641845087624e-01   +2.844056947936912e-01   +3.169605168343549e-01   +5.510957055578179e-01; +2.729031957611461e-01   +1.195649318898932e-02   +6.430480180503108e-01   +2.378548270621320e-01   +9.112820398714223e-01   +8.964013201266005e-02   +8.577469671384635e-01   +5.241252141609417e-01   +2.557117819883982e-01   +8.276300396032242e-01   +1.336030710132833e-01   +3.381863789854310e-02; +1.522435042751244e-01   +5.736922323762879e-01   +2.218260273987039e-01   +9.568283346218472e-01   +6.996958093849068e-01   +3.213188746690093e-01   +7.888569779930767e-01   +9.725459867918200e-01   +8.969914446618452e-02   +1.921131706731602e-01   +6.721458739114710e-01   +5.397339965460341e-02; +3.963613789351583e-01   +7.887802504620588e-01   +8.381403479547139e-01   +6.211462010723472e-01   +7.257669777481357e-01   +5.118177249074833e-01   +3.188626723354588e-01   +7.095833666579874e-01   +8.386049269874365e-01   +4.414414547858001e-01   +5.700320007111436e-01   +8.049110702238443e-01; +3.754284567072187e-01   +2.357410558532458e-01   +9.711296658209809e-01   +6.011736017085819e-01   +2.291189558346628e-01   +6.023242522432614e-02   +4.519867284939003e-01   +3.111166337226582e-01   +5.842635399065619e-01   +3.937543891190642e-01   +1.704556514173306e-01   +4.510449024195690e-01; +1.299477809990212e-01   +4.475850716043696e-01   +8.466943655062857e-01   +1.737245164735135e-01   +5.749371165557624e-01   +7.257900908766122e-01   +7.513071293126760e-01   +2.924771801873374e-01   +9.485688390060065e-01   +8.268515723497366e-01   +1.476200354171552e-01   +3.817929217091624e-01; +4.350678815933319e-01   +5.684762121929289e-01   +5.067774158433827e-01   +9.061118961644857e-02   +8.105134615576542e-01   +5.575032267463114e-01   +1.108763233293954e-01   +8.493499380330679e-01   +6.056166148929958e-02   +6.772014904823048e-01   +4.757606020236879e-01   +7.897623743293481e-01];
L2E_L3E_iAMPA_netcon = [+3.650196668998738e-01   +7.577289078517843e-01   +7.436424427056364e-02   +5.184896807964224e-01   +7.571404482935403e-01   +4.329151401240798e-01   +1.992570985389108e-01   +8.766817590843961e-01; +5.313536900882071e-01   +9.962686442633661e-01   +5.918463954395023e-01   +9.950751720890130e-01   +9.952095541245849e-01   +5.434093493909866e-01   +1.942450456858994e-01   +7.860165450009309e-01; +7.123395599070027e-01   +1.871506141491086e-01   +9.109435764841809e-01   +8.555257429881109e-01   +9.626570642024741e-01   +7.122637896967788e-01   +3.267252094252783e-01   +4.658938593104818e-01; +8.718538048561979e-01   +7.808178654825370e-01   +1.926403096375977e-01   +9.621086603217892e-01   +5.347894477062781e-01   +1.625801810377200e-02   +8.801139006451558e-01   +8.133361756326951e-01; +3.275792991804785e-01   +1.947763947055604e-01   +4.326056645314945e-01   +6.784471134159816e-01   +9.646804147651272e-01   +8.007397607799387e-01   +4.699616877783860e-01   +8.983168646898144e-01; +6.491294119428960e-01   +9.924649430332725e-01   +7.496444157079795e-01   +4.030861423481036e-01   +1.163939705563474e-01   +1.419664166062220e-01   +4.046717570021116e-01   +4.284590272114570e-01; +9.757285741229427e-01   +8.015032032115973e-01   +3.982631272199619e-02   +9.339757570357501e-01   +5.069349402701493e-02   +4.788234884419092e-01   +1.789454266794698e-01   +3.337902957290544e-01; +7.650751688044891e-02   +4.250053060084455e-01   +9.464823520449793e-01   +4.797555877491683e-01   +3.036476150149524e-01   +2.556751482351499e-01   +9.680683260083074e-01   +5.961269314246549e-01; +5.881331121520047e-01   +7.279744834127451e-01   +7.628226317398219e-01   +2.308082851183309e-01   +5.806670513102186e-01   +3.685085179394734e-01   +4.084183719858856e-01   +9.008719965198552e-01; +4.129203116040885e-01   +4.980711852955489e-01   +5.579233398979764e-01   +3.964554263745471e-01   +5.317025486596101e-01   +6.618447581342253e-01   +8.437576845509941e-01   +7.022671814271502e-01; +3.081975346403591e-01   +8.089025375691982e-01   +1.841441626432372e-01   +7.054559735393674e-01   +9.001995596182217e-01   +1.689324713604598e-01   +6.160887272618475e-01   +3.779367796538077e-01; +2.632737350402698e-01   +3.561052821024347e-01   +4.989803348656925e-01   +5.585654890867648e-01   +5.395509892947057e-01   +2.799070361085114e-01   +3.755292031992291e-01   +7.342811703886806e-01];
L2I_L3I_iGABA_netcon = [+9.551056141016490e-01   +3.119456768387787e-02   +9.111821334931559e-02   +4.604725162628810e-01   +3.275375903667384e-01   +3.678916252949180e-01   +6.857837107670990e-01   +8.044981298856752e-01; +5.434994384099795e-01   +2.086352717429517e-01   +5.932743981773797e-01   +6.387086158416970e-01   +8.040681132516219e-01   +2.092662611772751e-01   +9.105977037405356e-01   +6.686624368604673e-02; +5.396759859098414e-01   +4.550815467661014e-01   +2.420926235941632e-01   +9.169770815418476e-01   +9.999601002561693e-01   +4.414305489598228e-01   +6.113950817332867e-01   +9.502894058020024e-01; +3.104274235015884e-01   +1.276456890555506e-01   +8.402926958243011e-01   +1.622420430011897e-01   +9.803651667568047e-01   +9.553654078596497e-01   +9.003149847030986e-01   +4.967274123261347e-01; +7.054940917630660e-02   +9.409801658335999e-03   +8.582795869923967e-01   +7.146137038583901e-01   +1.267078160109880e-01   +1.246966367822587e-01   +1.940075442366142e-01   +7.543162465659459e-01; +1.821825600289722e-01   +7.269957131186373e-01   +9.626742639177608e-01   +5.775926567234646e-01   +2.311370763078088e-01   +4.698729913246307e-01   +7.543179893416267e-01   +7.413554857601219e-01; +9.287709539962009e-02   +3.534856789802987e-01   +4.890673970974755e-01   +4.332558898296435e-01   +2.442511258566808e-02   +8.558032407951653e-01   +3.473497569658418e-01   +8.305083241743400e-01; +4.629618528230993e-01   +7.799576464203853e-01   +2.195735800459377e-01   +8.837123781010704e-01   +6.083610837658975e-01   +4.274469658846061e-02   +4.191901209852933e-01   +1.567938183448445e-01; +9.861535105906493e-03   +4.366011585120062e-01   +2.272210934248919e-01   +3.930210304258411e-01   +1.097927544464660e-01   +6.910039462413075e-01   +1.554953775808748e-01   +4.580357982504238e-01; +9.146336120431260e-01   +4.372724281844587e-01   +5.370253456599897e-01   +1.784081862345023e-01   +4.076331628332746e-01   +9.785010388627542e-01   +8.196944661296982e-01   +6.185142783573542e-01; +6.430858989657134e-01   +5.020762552309271e-02   +7.618345630667233e-01   +6.324328482177681e-01   +8.842095757315236e-01   +2.839483513626402e-01   +6.242007172519781e-01   +9.314149305154952e-01; +1.456109175869442e-03   +4.880772581059673e-02   +3.465032963607133e-01   +6.244353506030808e-01   +5.491858263786106e-01   +1.337611099254079e-01   +7.394966012635099e-01   +8.348207712000392e-01];
L3I_L3E_iAMPA_netcon = [+8.952054882409606e-01   +2.548962220900877e-01   +7.411589126888881e-01   +6.804912509284878e-01   +6.010503762363734e-01   +7.478968227120887e-01   +7.451842125176328e-01   +2.243826327424461e-01   +4.628129750527896e-02   +8.010696080879206e-01   +2.901265007903446e-01   +8.012363940364017e-01; +5.826414887860062e-01   +3.236555991708817e-01   +6.939500155747191e-01   +2.346533381130950e-01   +8.566496343631490e-01   +5.424492588221891e-01   +1.263982720122628e-01   +3.505965379287404e-01   +2.145716854091776e-01   +2.337626207726720e-01   +4.033130529901746e-01   +1.044881481238524e-01; +5.829383637902890e-01   +4.029616037393512e-01   +8.234788637656210e-01   +4.554424296559819e-01   +9.888578965141348e-01   +3.388490568479216e-01   +8.220569976840429e-01   +2.860318266426837e-01   +3.975618515681291e-01   +9.323470680015512e-01   +8.626587459624875e-01   +8.213278331325371e-01; +8.548755843897508e-01   +4.052085816424484e-01   +8.290674253192739e-01   +3.837104184164440e-01   +9.291460323813828e-01   +8.330940680692778e-01   +2.626918321402785e-02   +9.268086087396780e-01   +3.334231394309410e-01   +7.636347661991743e-01   +6.139009035767954e-01   +8.403094594014271e-01; +3.389472625466979e-02   +3.863282722835960e-01   +2.937438947543400e-01   +5.378734608543884e-01   +4.098828346879783e-01   +5.514086155099966e-01   +4.153815092546319e-01   +5.070732992139214e-02   +2.301861587984818e-01   +8.264112072156636e-01   +9.911628067489766e-01   +3.546521775061699e-01; +8.849801649121170e-01   +6.086836248114393e-01   +3.103014831668078e-01   +9.914190643723065e-01   +1.387564702396040e-03   +9.582911950715463e-01   +7.305904016535881e-01   +5.932936731614453e-01   +9.359858771041958e-01   +5.725677116316388e-01   +2.036618503395095e-01   +4.300596815621353e-01; +4.067659294630590e-01   +1.661074920849412e-01   +5.237359384234853e-01   +7.557229426651809e-01   +5.414322489335018e-01   +8.927976518946374e-01   +7.817273704633063e-01   +1.623389673466939e-01   +6.831241620478454e-01   +7.922799913766554e-01   +8.280431164477303e-01   +5.712205254078982e-01; +3.667080400798323e-02   +1.888196926155035e-01   +3.260412542379547e-01   +9.813980749666361e-01   +2.080126769531604e-01   +3.572546236021265e-01   +3.679915845966074e-01   +8.382455328570548e-01   +9.630639535108123e-01   +3.291591249385995e-01   +6.761024211305202e-01   +7.008212700360099e-01; +7.461376678031320e-01   +9.464691894998312e-02   +8.329293498519921e-01   +2.358293831208660e-01   +2.201950730417600e-01   +5.474811311931201e-01   +7.459752922249524e-01   +1.687292840510023e-01   +4.388231732802144e-01   +2.238528909474970e-01   +2.495628970292235e-01   +7.427518959795838e-01; +1.547806957706445e-01   +3.222964017669711e-01   +8.099900045323661e-01   +5.275979751068862e-01   +3.266581902655696e-01   +3.460078646416856e-01   +8.927395479705863e-01   +5.024401929959802e-01   +9.394697755293335e-01   +3.116762719798030e-01   +4.768381107468344e-01   +7.568199114555116e-01; +1.442520333797622e-01   +7.705164459441267e-01   +5.577377355485633e-01   +5.236264777093017e-02   +9.649088170329492e-02   +6.232624212209089e-01   +2.437281747107429e-01   +9.991738799570280e-01   +6.554635895849576e-03   +5.851363323197034e-01   +3.988062311872728e-01   +3.891460741371450e-01; +6.064711611066730e-01   +2.342298988147578e-01   +2.624179737782673e-01   +7.580144005052538e-01   +7.486364036208707e-01   +7.975361432568545e-01   +1.288748148838567e-01   +3.552953405915195e-01   +6.109826552882750e-01   +8.304015909575531e-01   +5.988474058385029e-01   +4.281667116081200e-01];
L3E_L3I_iGABA_netcon = [+9.556987444562212e-01   +8.848031501252660e-01   +7.994860709299217e-01   +9.861618423734697e-01   +9.022365720745407e-01   +9.612771680466121e-01   +6.530181645445524e-01   +4.949824527494834e-02   +1.070480334920184e-01   +4.519939087898624e-01   +8.287534938200266e-01   +5.807854698214124e-01; +5.719376794438329e-01   +4.379833272005541e-01   +9.877998328605114e-01   +5.600438986373943e-01   +9.946629283886420e-01   +5.408715511043035e-01   +6.725418127525634e-02   +4.660081016101988e-01   +4.604506699293229e-01   +3.333018496619081e-01   +6.259734260664839e-01   +6.361709093528245e-01; +8.500083335625304e-01   +7.826603600090920e-01   +1.585502492862327e-01   +9.335812876944160e-01   +6.528743741876831e-01   +3.118058907115324e-02   +2.757505196487034e-01   +3.248528567381010e-01   +4.509284380705851e-01   +5.853117715126421e-02   +5.391040479889997e-01   +6.511940084031738e-01; +2.763412550253391e-01   +1.489834290733248e-01   +2.367017483607165e-01   +7.205636881385679e-01   +1.084846152372062e-01   +6.956539965116203e-01   +2.812130883278887e-01   +6.307552514116943e-01   +5.511943716457578e-01   +7.412689839224210e-01   +6.511064800408848e-01   +8.637008286498933e-01; +6.230961345193533e-01   +6.209751259376756e-01   +7.017225939108097e-01   +4.837877628022549e-01   +3.682150111164156e-02   +5.190973530307369e-01   +8.793281191142843e-01   +2.293941156052206e-01   +8.062733391116954e-01   +5.066314511475518e-01   +7.263778143110512e-01   +5.677146709162979e-02; +5.891142778008648e-01   +2.595730832692963e-01   +3.758963982846520e-01   +6.392989920310843e-01   +6.185291394710288e-01   +5.988339727916548e-02   +4.446004359349677e-01   +5.803822651459596e-01   +7.015025088880220e-01   +2.005476324771621e-01   +9.424209672411182e-02   +8.180115568661602e-01; +9.644400045579022e-01   +4.450862535353389e-01   +9.746128589391363e-01   +8.884560358007187e-01   +5.663840665289359e-01   +8.890836833489495e-01   +7.569793460164288e-01   +6.043072982388139e-01   +8.721288399369029e-01   +4.275912734249558e-01   +8.780854459756576e-01   +5.291183041511819e-01; +8.585372584621050e-02   +8.442224501458444e-01   +9.717705553391911e-01   +1.991124892831637e-01   +9.624120335006477e-01   +3.294873235221234e-01   +6.025838224858031e-01   +5.997159038975204e-01   +5.241084430166205e-02   +1.678520087072580e-01   +1.326267096079508e-02   +6.948081181925839e-01; +5.006829148719929e-01   +1.962874649598175e-01   +6.439901336186781e-01   +3.964196517871844e-01   +7.471821395585457e-01   +2.287956162610534e-01   +7.833004172632482e-01   +4.485446388342538e-01   +2.185317626263449e-01   +7.509008986909268e-01   +2.932027243212365e-01   +2.129912503842496e-01; +5.217507282590590e-01   +3.031383713927673e-01   +8.592273357793813e-01   +9.924495642786235e-01   +6.623372562269316e-01   +1.131973825417279e-01   +1.137277636394430e-01   +3.429564441971145e-02   +4.590326914724537e-01   +3.671787302101887e-01   +1.788608326940746e-01   +5.429158226738565e-01; +9.017152478103434e-02   +4.822199233671943e-01   +4.015472791294843e-01   +4.021926145256185e-01   +5.244434425788091e-01   +3.118350629086508e-01   +9.780725338624319e-01   +5.134780831919391e-01   +9.585550667503703e-01   +9.417214111485646e-01   +9.267540142660097e-01   +7.036289533914855e-01; +9.054572091044155e-01   +3.369728571984750e-01   +6.314044847146496e-01   +6.587039895498732e-01   +2.600275183473151e-01   +2.280961521133875e-01   +8.477092555162726e-01   +4.067624396839936e-01   +7.906576323036489e-01   +1.636361195794325e-02   +6.774205422415999e-02   +9.554381515931988e-01];
L2E_Input1_iAMPA_netcon = [+9.995016946342181e-01   +1.000000000000000e+00   +9.983244050041923e-01   +9.985698941687883e-01   +9.980524184626288e-01   +9.998899016773303e-01   +9.988964135988696e-01   +9.980390197242848e-01];
L2I_Input2_iAMPA_netcon = [+9.980871667302507e-01   +9.982434145809226e-01   +1.000000000000000e+00   +9.999795783075126e-01   +9.994656570774046e-01   +9.981311828148878e-01   +9.996399436565669e-01   +9.991197040710038e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
