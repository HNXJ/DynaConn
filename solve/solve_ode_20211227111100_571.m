function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.155995402896629e-01   +2.546610126612496e-01   -2.202180920734039e-02   -9.791956806858335e-03   +5.632420094577674e-02   +2.462644015165830e-01   -2.446692038547090e-02   -1.382014723095320e-01   +1.861200000792477e-01   +9.150052025265391e-02   +1.879425416484777e-01   +2.091683879537173e-01   +3.493332470958722e-02   +2.583995717762367e-01   -7.263738475419199e-02   +7.177601220220926e-02; +6.404460919696639e-02   +2.574673471656864e-01   +9.701279690701832e-02   +1.040381812611061e-01   +8.729123286193124e-02   -4.042680549414230e-02   -3.204496762162459e-01   -1.214273406683890e-01   +9.369257714519987e-02   -1.003059876315380e-01   -3.003780286648419e-02   -3.839915303771689e-01   -8.613451311969664e-02   +8.830090944924912e-02   +1.609648977136140e-01   -9.154043192181674e-02; +2.447751865605198e-01   +3.433412647926773e-01   +1.703756939920236e-02   +9.480654672692183e-02   +1.285987432670042e-01   +1.359065712286279e-01   +2.212174976052425e-02   -4.965597770244249e-02   +2.041383514297717e-01   -2.649855231187767e-01   +1.782553783909464e-02   -8.245388017594978e-02   -1.808020353995756e-01   -1.746459750504753e-01   -5.307598775879664e-02   +2.191098589845040e-01; +4.119889355073083e-02   -1.286918285483494e-01   +3.431196785758733e-03   -6.412004108194956e-02   +7.832156770283064e-02   +1.754247557660547e-01   +6.161661081338150e-02   -1.009862226555894e-02   -7.551592911531896e-02   +1.405360463969197e-01   +1.177547548684479e-01   +1.668068369008891e-01   -8.837510507798839e-02   -1.446389404377096e-01   +2.918477957547348e-02   +1.357305747984555e-01; -5.908506380584476e-02   -5.328805339425640e-02   -1.375047388707886e-01   -3.045147816563870e-02   +2.986784540728764e-01   -4.246187607221539e-02   -1.162304673053821e-01   +1.326998195342163e-01   +2.758514336032896e-01   +1.782020113517104e-01   -1.229990765743427e-01   +4.958696780915076e-01   -1.583365340909425e-01   +3.237394767702313e-01   +1.415713127431777e-01   +4.842339245140695e-01; +1.780067178083439e-01   +3.402479110903954e-01   -8.221975270829729e-02   -1.458791719590477e-01   +1.481393796833886e-01   -3.962691131359140e-01   -2.813102913375476e-01   +1.166471567065874e-01   -1.313188983074745e-01   +3.585253732187358e-02   +3.630095370352393e-02   -7.455998523205577e-02   +1.846434459680310e-02   +1.605606468604014e-01   -3.638636933380950e-01   +1.351255072104963e-01; +2.325453955840831e-01   +3.108282720258428e-02   -2.617834006233221e-02   -1.465342163498109e-01   -2.225273906617614e-01   -1.668810163594794e-01   -2.855703752999959e-01   -1.045359861170952e-01   +1.162304739770808e-02   -3.419789614190930e-03   -1.250672498467092e-01   +1.021496085783091e-01   +2.536124272457023e-01   +4.486893914519841e-02   +8.572284210121933e-02   +1.174651646486248e-01; -5.263347191832248e-02   +1.599695467217751e-02   +1.597197766598169e-01   -3.933116141881634e-02   +3.860802823684364e-03   -1.310516449181571e-01   -1.492292846579875e-02   -4.135560442743053e-02   -1.233717012065814e-01   +8.309293390507098e-02   +4.751409429464780e-01   +2.404813921470056e-01   +1.335422680513391e-01   +1.612996782534414e-01   -8.235895059077260e-02   -3.310861078227437e-01; +1.075153799896045e-01   -1.561497498347422e-01   -4.170206301668831e-02   -1.103365471547689e-01   -9.725263102069464e-03   +9.849510741699011e-02   +1.506625884937034e-01   -2.488348905353492e-02   +1.249325788997006e-01   -2.276892544335749e-02   +2.821058942705061e-01   -2.537406237221668e-01   +9.454370224801036e-02   +6.139497048237129e-02   +1.362477651361558e-01   -1.825236073027429e-01; -2.999705019801268e-01   -1.671453700683980e-01   -8.054484193232495e-02   -5.409355829492712e-02   -4.828204302770938e-02   +8.290923505468245e-02   +3.499368750585667e-01   -2.913177181855242e-01   -2.805998132797410e-01   +2.330520127494342e-01   -9.806381710090965e-02   +2.125445295495233e-01   -1.459063727098522e-01   +9.948793631623180e-02   -2.780893085020575e-01   +1.532023275181742e-01; -2.684425111086600e-01   -2.530057764124661e-02   +1.127875902695607e-01   -1.551080538680054e-01   +1.506006860198042e-01   -1.365456252192599e-01   +9.373563915778212e-03   +9.771923253469508e-02   +1.758617416638723e-01   -2.183169608526528e-01   -6.520831911617822e-02   +9.678549234044045e-02   +1.507925091169282e-01   +4.608539671415438e-02   +2.908384366359850e-01   +3.181194905892253e-02; +1.813860503979636e-02   -1.553961593321728e-01   -6.969065698761225e-02   -1.048865530830618e-01   -2.316992239217869e-01   +1.839244946395871e-02   +1.340196253149429e-02   +1.114232316720527e-01   -8.996101770630234e-03   -1.319811493877438e-01   +1.235238411884166e-01   +5.285550027627419e-02   +1.825378916394752e-01   +5.034476447140192e-02   -2.681246888979218e-01   -2.115867765220516e-01; +3.427817191870901e-02   -3.751153687402347e-01   +2.416166416396816e-01   -1.006059292284077e-01   -2.023213055626521e-01   +7.222289698251380e-02   +1.655936960977085e-01   -2.872860476758428e-01   -6.588683266112794e-02   -1.949133464901460e-01   -1.690117662469508e-02   +2.401751408474223e-01   -1.667934697753346e-01   -9.784319354492227e-03   -6.544917867905332e-03   -7.158263607124568e-02; +5.097802644885040e-02   -1.272313477346435e-01   +1.420975274708511e-01   +3.191170394762671e-01   -3.617806162938644e-02   -6.977581512319809e-03   -3.548604460191744e-01   +7.094089703402540e-02   -2.941841565689709e-01   +5.950731966407182e-02   -1.003464805884646e-01   +1.598519643080023e-01   +7.413434715555134e-02   -2.306593010712675e-01   -1.261810872995951e-02   +7.637618109329279e-03; +3.040624940981607e-01   -3.892308963630196e-02   -2.820289973015453e-01   +9.712978944305017e-02   -4.309445785504160e-02   -1.211050460012842e-01   +3.206836865864585e-01   -1.223934849847907e-01   +2.015532891351162e-01   -4.898515271936513e-02   +6.621872431604070e-02   +2.283140024466501e-01   +8.029176399202861e-02   +3.039012950564638e-02   +5.892383635499002e-03   -7.121301441332181e-02; +3.333300811654605e-01   +1.609413139232846e-01   +2.000939838256429e-01   -1.763894086941788e-01   +1.279420621775395e-01   -4.770725026728220e-02   -1.006967074027092e-01   -6.475974030073321e-02   -1.790577491732892e-01   +4.577545425207340e-02   +2.396533518263146e-01   +3.487138899134722e-02   +1.038593205833842e-01   -1.953798864897086e-02   +3.140527406188529e-01   -2.046350686148954e-01];
L1E_L1I_iGABA_netcon = [-7.996032927446842e-03   -4.906452418837112e-02   -2.584884330708168e-01   +1.899619243911292e-01   +3.797791180812348e-01   +1.874117147664039e-01   +1.887522452067296e-01   -1.362431322048815e-01   -9.384414602839550e-02   +3.334998668368948e-01   -5.111190997580616e-02   -1.655956174088740e-01   -1.643109107063289e-01   -1.238320233773979e-01   -3.274630567551117e-01   -9.697895700900835e-02; -8.264052396998703e-02   +1.054883672899150e-01   -1.963122932383154e-02   +9.722940311812298e-02   +4.798835066707628e-02   -2.165028197474837e-01   -1.487316253253361e-01   +6.528008405144411e-02   +1.286565622862997e-01   -1.485073540801381e-01   -1.498943246922700e-01   +2.726676192490279e-01   +1.471474121238983e-01   +1.499202462783124e-01   -2.188108373503728e-01   -1.733664157295041e-01; -2.367410654561124e-01   -5.802144020263793e-02   -1.032010309812186e-01   +4.666266617605145e-02   +1.164832677989780e-01   +1.428436934223994e-01   -7.464124873032429e-02   +1.452007672863729e-01   -1.840057764837518e-02   -1.969328430499411e-01   +2.398107526863850e-02   -4.938928537465365e-02   -1.360185920803527e-02   -1.727198056478894e-01   +7.397400379013438e-02   -5.146279855198747e-03; +7.956756741497777e-02   -2.903933135471896e-01   +1.425500239339728e-01   -1.715155363688801e-01   -3.022916963187575e-01   -1.059818637565049e-01   +9.295368337135747e-02   -1.503492736701294e-01   +3.837893136997065e-03   -3.607446385409913e-01   +2.825007919038260e-02   +3.341233733553466e-01   -2.853382178844626e-01   -8.722541544692641e-02   -4.369643768883223e-02   -2.720727033732772e-01; -7.872837434340269e-02   +1.031076435321911e-01   +2.218898071426340e-02   +9.393121130178611e-02   +2.264904364733538e-03   +9.014378884704706e-02   +2.372061092001900e-01   -1.517872758168416e-02   +2.439525796612238e-02   +1.506755367746000e-01   -6.714367678665237e-02   -1.337286254072704e-01   -3.652446206417824e-02   -5.013879045270148e-03   -1.312596749177801e-01   -1.376899481665053e-01; +2.408618841048805e-01   +1.707757319768539e-01   +1.244187313082655e-01   -1.188660672633014e-01   +3.721281522806453e-01   +9.618848058634558e-02   -8.267052745903816e-02   -4.900283178967696e-02   -1.229064003539793e-01   +1.803219045962164e-01   +2.063317213785499e-02   -1.955233902798003e-01   +2.163050077485966e-01   -1.842328674540672e-01   -9.221491170113533e-02   -2.685193138955543e-01; -3.000917263548934e-01   +2.752861983466471e-01   +2.058703474308443e-01   -1.712274491009741e-01   -1.425972814081813e-01   -8.752966573934445e-02   -1.486089033770526e-02   +6.650695027471126e-02   +3.194954780081153e-01   -9.455313121389712e-02   -5.394888833190857e-02   -1.840731490189652e-01   +1.106693333578994e-01   -3.320330036417460e-01   +1.722857584027135e-02   +3.276087762657206e-01; +1.016146276648618e-01   -1.979568776155292e-03   -2.747875638783573e-02   +2.565853768867777e-01   +2.093631491456573e-01   -1.620951759031027e-01   -1.339518911974502e-02   +3.377771204152253e-01   +1.579707216968258e-01   +7.876815541891510e-02   -2.054246358970220e-01   -1.310768605999338e-02   -2.715409313929949e-01   -6.481122303088149e-02   +2.254579036125216e-01   +2.004498041616967e-01; +9.412592813488373e-02   -1.093833380813680e-02   +1.367290549902881e-01   -4.094189075820823e-02   -2.162665694757369e-01   +3.560811802433844e-01   -2.021672734891281e-01   +3.026869092226401e-02   +8.363493347523454e-03   +2.088566012235892e-01   -1.038157217657291e-01   -8.897035855050554e-02   -3.451487432975381e-02   -6.926233677859969e-02   +7.530809812337615e-02   +1.757819642028874e-01; +4.311643090845208e-02   -6.652097990052389e-02   +4.531318008098184e-02   -2.407473610052912e-01   +3.036002809245612e-01   +8.606901605361328e-02   +6.148671002372279e-02   -7.611264407493198e-02   -2.870987599346099e-01   -2.545506750381146e-01   -2.743887718556154e-01   +3.906336395102539e-01   +1.654796478665003e-01   +1.266760706271803e-01   +9.341078027995439e-02   +3.379687725130518e-01; +1.501986653231022e-01   -1.781840414115652e-01   -2.054463673983303e-01   +4.044337686719323e-01   +8.465368886254369e-02   +2.857077479929639e-02   +1.984432162491150e-01   -5.926980013290995e-02   -1.708931808641034e-01   -1.851068698566561e-01   -1.399020991164079e-01   -3.561102589607285e-02   +3.696620689327225e-01   +6.386340099361530e-02   -4.501613942533512e-02   +4.066576827033719e-02; -1.712029840817877e-01   +1.898823429464201e-01   +5.197237660001857e-03   -1.422972112227663e-01   +6.324724295671305e-02   -2.187919606146363e-01   -7.955302792981289e-04   +9.999121452443398e-02   +1.443394806859771e-01   +3.996965502705015e-02   +2.020855407326151e-01   +2.765274952324231e-01   -1.389270210189235e-01   -1.101035623282672e-01   -9.840190022381590e-02   +1.106746012222660e-01; -5.871870599136744e-02   -9.263285629198717e-02   +1.966349621864709e-01   -8.076422649709572e-02   +2.359453951024259e-03   +1.291297254166223e-02   +1.277350891369021e-01   +1.284866477781539e-01   -8.113409037827729e-02   +2.707447413824352e-02   -2.446346140928014e-01   +2.657697550976288e-01   -1.557575993005607e-01   -1.887073368290833e-01   +1.077371493859495e-01   -1.486663625510042e-01; -1.537340344277731e-01   -2.449079624065157e-02   +1.349242367136858e-01   -1.677940568037514e-01   +1.142065201771821e-01   -1.622238204639742e-01   +8.908079091001246e-02   -2.472962118018316e-01   +1.584579554396943e-01   +1.954992105951468e-01   -8.924694887480775e-03   -2.246058329475386e-01   +1.585547627466619e-01   -9.101154688145854e-02   +1.819788088716464e-01   -2.313723169979999e-01; +2.626875909825151e-01   -1.832717220381971e-01   -1.103931622730254e-01   +2.785142482749857e-02   -1.300508796760812e-01   -2.057650843346903e-01   +9.854221542040248e-02   -1.847316432166216e-01   -1.152791063535488e-02   -2.497840812332891e-01   +9.150262443975690e-02   -2.902098395577662e-01   -7.934033630417732e-03   +4.715725604236718e-01   -2.266052004085163e-01   +2.382893051728464e-01; -1.715164409790017e-01   -1.572187609259333e-01   +4.977046125906553e-02   +2.584912705754213e-01   -1.633369186949716e-02   -1.937067943558413e-01   +2.555095399044760e-02   -1.753967808128949e-01   -1.177116945083281e-01   +5.396749931185536e-02   -7.756367598338540e-02   +1.521464710965480e-01   +3.445968315906527e-01   -7.739733747749215e-02   -3.105379047239071e-01   -1.055147843261303e-01];
L2I_L1I_iGABA_netcon = [+4.731783255492489e-02   +9.468102058937967e-02   +4.183067435790795e-02   -3.986195138840882e-01   -8.269120891139675e-02   -5.829613333439907e-02   -1.810219290122446e-01   -2.463749647819682e-01; -1.635649565187159e-01   +1.317121338125840e-01   +9.165576784973598e-02   +5.815220197688762e-02   -3.329713862113164e-01   +1.096339508625989e-01   +5.561999752679337e-02   +1.314237999647350e-01; -6.744967084927525e-02   -3.174531672171065e-01   +2.085563163207210e-02   -2.179369463356634e-01   +2.795176195083440e-01   -1.209682824027524e-01   -2.757302113543936e-01   +1.059229133253683e-01; +2.666435013285861e-02   +6.997516480807223e-03   +4.074699137315909e-02   +8.890012446047628e-02   -1.009254469684896e-01   +1.774116391207052e-02   +3.115016656246765e-01   -2.669943774386702e-02; -4.453269750831894e-02   -2.698470081902157e-01   +4.321521278235186e-02   +5.157338682821454e-02   -6.566342867291602e-03   +9.472061766648626e-02   -1.717776703529391e-01   -1.428412672571849e-01; +1.291026865511347e-02   -1.761744213057099e-01   -4.288839104589954e-01   -3.980911095858173e-01   -9.880750178234826e-02   -1.343151665553177e-01   +2.597117195861851e-01   -1.446884324625677e-01; +2.390289296188295e-01   +2.062006533778566e-01   -2.455956251856901e-01   +3.091059698612832e-01   +2.023309769778291e-03   +1.194360096511513e-01   -1.445356991011558e-01   -2.820869354815861e-02; +1.394511252737509e-01   +2.465287335494017e-01   -8.426580117758030e-02   +8.008434442322497e-02   -1.073784100838373e-01   -1.334528079215976e-02   +9.192651122372897e-02   -3.126368805169832e-02; -2.652908762265041e-02   +1.825455568604339e-01   +1.583780715194435e-01   -4.158670244702485e-01   -1.819927962882132e-01   -4.228680440367318e-02   +1.578443867901694e-02   -2.646779137646714e-02; +1.866851250483977e-01   -6.128971777662162e-02   +6.872294188177838e-02   +8.735811947692043e-02   +6.043201672107062e-02   -2.589755739120657e-01   -1.225725207613309e-01   -1.400716584471352e-01; +5.785448918383555e-02   +1.518356979836176e-01   -1.130215808140707e-01   +1.948497743086497e-01   +8.142503434763462e-02   -3.506539982158663e-01   -4.624248224853578e-02   -2.123323815184944e-01; -2.174882796953085e-01   -3.456876734846764e-01   -1.312342042511270e-02   -1.109821433686590e-01   -6.742997811428419e-02   +9.859970427656563e-02   +2.934895976907151e-02   +2.851835612707269e-01; +2.863062994954542e-01   -1.401374432499752e-01   -7.593193372129424e-02   -3.441668159324056e-02   +2.042357362811901e-01   +7.223809371029924e-02   -1.038199361737016e-01   -2.395559197951730e-01; +2.472600789355860e-01   +1.584651815379239e-01   +9.442173322246996e-03   -5.202328538552966e-02   -7.611432613877137e-02   -3.996164901893048e-01   -4.370192904434595e-03   -1.075186472342471e-01; +2.509511744171848e-01   -3.268613759575177e-01   -1.732204898904335e-01   +3.512195128363067e-02   -2.162092397751837e-01   -3.152346744064281e-02   +1.088732230361778e-01   +3.506929908457133e-01; +8.695438760701171e-02   -1.016515205728586e-02   +2.102387118088115e-01   +1.697127369227865e-01   -1.224369852064379e-01   +2.694821909069488e-02   +3.289162002813958e-01   -3.087885453585058e-01];
L1I_L2I_iGABA_netcon = [+4.342124236659629e-02   +5.735444279145772e-02   +3.977486125630739e-01   +2.887837782701305e-02   +7.111581546528339e-02   +1.917548450767925e-01   +1.264353013417628e-01   +8.906639935150594e-02   -2.019718685491090e-01   -1.157366005482166e-01   -2.194960838581905e-01   +2.375427709927158e-01   +1.973573586284105e-01   -2.912185717161631e-02   -2.155501845082206e-01   -1.137715988329700e-01; -2.865568746727913e-01   +1.117534654564987e-01   +1.798839900058267e-01   +4.129158108978816e-01   +1.610807329477619e-01   +1.356097705580482e-01   +8.436477245524368e-02   -3.132864462310476e-02   -2.429425406227243e-02   -7.484810629372660e-02   +6.009761739346931e-02   -5.268090225092138e-02   +7.541343848224816e-03   -2.828860410089797e-01   -1.964016225060911e-01   +3.942382178779621e-02; -1.901999357829224e-01   -1.206157685356473e-01   -1.904226166298371e-02   -1.680789220586874e-02   -9.139890129006829e-02   -4.742727383128448e-01   -4.603950429672841e-02   +8.330176078202081e-02   +5.324291608281781e-02   -3.378108779773673e-01   -1.197072296428116e-01   -6.912890465513699e-02   +1.624903751252592e-01   -2.803574225130635e-01   +8.647421938711594e-02   -9.021300849362109e-02; +4.533219142605666e-02   -1.462455887186812e-02   +5.553775896372408e-02   -1.206482395852109e-01   -1.169873982225772e-01   -1.334562495328750e-01   +1.171846383362939e-01   +1.771684781714174e-01   +7.152444788419024e-02   -2.344253811236952e-01   -1.603451955568287e-01   +2.146456009478883e-01   +1.147742643821571e-01   -2.689812686660475e-01   +1.340075661664871e-01   +1.071383099427645e-01; +1.862094682360428e-01   -1.614158729420865e-01   -7.693254370225289e-02   +1.392069483203625e-01   -3.274248312493991e-01   +5.401648166279831e-02   +3.737790373881568e-02   +1.943600575939454e-01   +3.528822120736860e-02   -1.940295833518829e-01   +2.123304049151243e-01   -3.988625674293506e-02   +1.881427714432121e-01   +3.733020362209775e-01   +4.028619226578417e-02   +2.588451208219839e-01; +2.407149451407275e-01   +6.739651115132470e-02   +1.194710435125000e-01   -3.584137613392359e-01   +7.649922693514359e-02   +1.902716240373264e-01   +6.195214406345517e-02   +2.305934664599149e-01   +2.392306546120792e-01   -7.456742847755130e-02   +1.417054826533534e-01   +1.393109947512920e-01   +1.083386716184927e-01   +1.963910449655766e-01   +4.887322949366471e-02   -2.089853241220379e-01; +3.480068152609712e-01   +2.395581905083042e-01   +1.242008591221962e-01   +1.775928977965099e-01   +2.122476863717620e-02   -1.529620295963492e-01   -1.449906515380946e-01   +6.115772234371709e-02   +1.537861343695756e-01   +6.036205323442788e-02   +1.129196892707080e-01   -1.442193765337311e-01   -2.780064331927609e-01   -1.947133791916538e-01   -6.927456191940831e-02   -3.035999017728488e-01; +9.659480786154420e-02   +1.789957611465621e-01   +9.045246991727897e-02   -1.691283596509769e-01   +2.467989165287209e-01   -1.026046342923213e-01   +1.754186933915240e-01   +2.962746320573252e-01   +1.939616417053537e-01   +2.648657752652807e-02   +7.838855411053305e-02   +6.576816089121876e-02   +5.502239405808691e-02   +3.247490257556814e-01   +1.462297071092860e-01   +1.914040695973277e-01];
L2E_L1E_iAMPA_netcon = [+5.797043590167023e-02   +2.263752178584048e-01   -3.466452152278032e-01   -1.267544763704723e-01   +3.736108353952688e-03   +4.952888387499114e-02   +2.415487044221069e-01   -1.766731145879004e-02; -1.483316885268242e-01   +1.666546405498154e-01   -4.471695504493357e-01   +2.853904468958160e-02   -7.954193227300944e-02   -3.120863423245467e-02   +6.153346799323633e-02   +5.343024606637045e-02; -1.197130031633614e-01   -9.689397497102328e-02   -7.950452121610521e-02   -3.684406218486383e-03   +2.057280859926440e-01   -2.063539948491731e-01   +8.827290923903128e-02   -1.696638547109410e-01; -1.412335201904818e-01   +2.339746078890674e-01   +5.527107171552501e-02   -1.734647580019177e-01   -3.801944415599833e-02   -2.125351742628190e-01   -1.209854327089468e-01   -1.009839810609124e-01; +2.020206619182830e-01   +2.455965179366234e-01   -1.836897418389108e-01   -6.103314661178837e-02   -2.906483432913122e-02   -8.290175673278682e-02   +2.164788206571950e-02   +5.359494711080916e-02; -1.772118015108133e-01   -5.175365495573659e-02   +8.417825190442017e-03   -1.911363504429905e-02   +1.137541575454842e-01   +2.555535019463405e-01   +8.341187546650672e-02   -3.660713440996870e-01; +2.048848205102516e-02   +9.801642002957643e-02   -9.542305798467837e-02   +6.299123445474664e-02   +1.531266587598276e-01   +1.876822538974153e-01   +3.383597021786523e-02   +1.665439854400200e-02; +9.631882920732607e-02   +1.450173061864951e-01   -1.051846125305431e-01   +3.154052480215108e-02   -2.393282936949397e-01   -2.172533329250842e-01   -7.871690558179206e-02   +1.081062625639403e-01; +1.322782031284776e-01   +2.674014569464209e-01   +4.236888501748134e-03   +1.488565253292078e-01   +2.560322827011206e-01   -1.827956642706067e-01   -3.520431997202466e-01   +5.392678433430445e-02; -1.498778299110683e-01   -2.754775606430393e-01   -1.049445402791351e-01   -8.083127120206018e-02   +2.166733581409984e-02   -2.405138266920154e-01   +1.511609235426719e-01   -8.041862787713253e-02; -2.173997124107863e-02   +5.073418992325391e-01   +3.313462830647781e-02   +3.990034962673029e-02   -6.009431230785921e-02   -2.067642890047028e-01   -3.731500299770832e-02   -6.823692695632268e-02; +2.943845458904646e-02   -1.178638568647224e-01   -4.675187420490250e-02   +2.210591570830385e-01   -3.924597547483298e-02   -7.671568827774125e-02   +4.769027917339512e-02   -1.425724406818892e-01; -4.064446604782873e-01   +2.457579796976556e-01   +7.588839447825137e-02   -5.024813640215862e-02   -2.043540263366574e-01   -3.154560300376647e-02   +1.407527512493247e-01   -3.330113488707826e-02; -2.831643504316480e-01   -7.984034602060479e-02   +3.297099248250271e-01   +3.528232323033046e-01   +7.338330708071994e-02   -1.318951592609483e-01   -9.920323784120853e-02   -4.731672752406552e-02; -1.017364001541248e-01   +1.136950232771142e-01   -2.955605149725914e-01   +4.048030643939485e-02   -2.829060273845587e-02   +5.721227761467727e-02   +7.138384808287138e-02   +2.308429603533666e-01; +2.276876645727964e-01   -8.750766984887288e-02   -1.480268565530020e-01   +3.261855014990625e-02   +3.654602364708329e-01   -1.232511265652588e-01   +1.637971049029847e-01   -1.559318356101937e-03];
L1E_L2E_iAMPA_netcon = [-5.448529245978403e-02   -9.591584566137541e-02   +2.449743714272428e-01   +4.939797163889632e-02   +1.772131850811692e-01   -1.008031521045248e-01   +3.401228445406511e-01   -3.577450571590520e-01   +3.218305603411902e-01   -2.253153853545679e-01   -1.418299004962929e-01   -3.648093116549456e-03   +2.403515184840502e-01   -1.052498640861709e-01   +9.142505291590572e-02   +2.922361984348817e-02; -2.761402408897394e-01   -1.314381214664462e-01   +8.286200614695581e-02   -3.629160396251184e-01   -1.681713966158107e-01   -2.621621745478904e-01   +6.365202801211689e-02   -1.124659579331807e-01   -8.985357312107847e-02   -1.543898707113374e-01   -8.024229066422217e-02   +5.914533333374294e-02   -3.262580027636645e-01   -1.030776831848312e-02   +2.420650130310487e-01   -1.898640228145015e-01; -2.732315570691354e-02   +3.587717261519954e-02   +3.234126001780306e-01   +6.965420979953359e-02   +8.376670724361265e-02   -9.852085006616480e-02   +1.131862081845866e-01   -6.554731216555910e-02   +2.000229133371485e-01   +3.442956548005736e-02   -8.352659719818026e-02   +2.604404043560239e-01   -1.210931645956861e-01   +2.527454153993608e-01   +8.906913666189065e-02   +5.090659928034158e-02; +1.946452278231814e-01   +2.138721996085408e-01   -1.148990690287758e-01   +2.111899625923806e-01   +1.121260964587677e-01   -1.901790849497479e-01   +6.388190706132615e-02   +3.910335298182410e-02   +1.252228585633997e-01   +6.158757863550060e-02   -5.920113005976405e-02   -3.679219757022112e-02   +2.205159491549299e-01   -7.167068757631929e-02   -1.331251960473781e-01   -1.161835879696222e-01; +1.032871325055181e-01   -1.301212916000845e-01   -1.691031847134714e-01   +1.199764328589341e-01   +2.700949302911702e-01   -4.624489185505508e-02   +5.192543702169285e-02   +1.786648552792232e-01   +1.189861106009124e-01   -1.898831505709533e-01   +7.301664268157647e-02   -8.892816329562869e-02   +3.925319997640385e-01   +3.045165321515613e-02   -4.405354760692034e-02   +5.887620835647947e-02; +2.465022665632413e-01   -1.515884729197220e-01   +2.549855566485332e-02   +3.151787814531565e-02   +2.791249481933712e-01   -4.076744499763982e-01   -3.476771857431110e-02   +4.183543716879688e-02   -2.072946493952629e-02   +1.385019119770696e-02   +3.580047081205306e-03   -5.029310639401507e-02   -3.181512201512980e-02   +1.177484271162006e-01   +8.624902733426179e-02   +2.519968053905999e-02; -9.279475035324111e-02   +3.042934027005852e-01   +3.907373753728989e-02   -1.409954800322403e-01   -7.543704049917787e-04   -8.741303395482208e-02   -9.563065550068351e-03   -1.170708116265829e-01   -7.506262285784707e-02   -7.804067106709631e-02   +1.240280315126802e-02   -1.756355196820915e-01   -1.455373689788559e-02   +2.710032150479776e-03   +1.916564278692814e-03   +5.039812992158679e-04; -5.164231989522862e-02   -2.787528600163389e-01   +9.272922159438619e-02   +8.364933265541792e-02   +1.251540374239028e-01   +3.514295813523134e-01   +4.501486238006031e-02   +1.046066220920573e-01   -2.576764765113813e-02   -1.552284468897346e-01   +9.566235720377730e-02   -1.262106367963215e-01   +2.402837125242234e-01   -4.861917402283716e-02   +2.496422022194108e-01   -1.689430589468633e-01];
L2I_L2E_iAMPA_netcon = [+2.227909094134057e-02   +5.110626149681036e-01   +1.066871123802466e-01   +2.405985780076474e-02   -2.472291076741594e-03   +1.866195370034011e-01   +8.000526682544373e-02   -9.424343978891812e-02; +1.146062080777040e-01   -1.106325810391237e-01   -5.237059432446227e-02   +1.730891420179455e-01   -2.380299438871102e-01   +3.176147108515374e-01   +1.348097435654044e-01   +2.475733491041378e-01; -2.722360378521625e-02   -2.478867000779418e-01   -1.852959197140847e-01   -6.900329682344347e-02   -1.494694799903201e-01   -1.031645875420371e-01   +3.942308602807490e-01   -1.490675756264161e-01; -1.558380568212968e-01   -2.152342086938129e-01   +7.106654530284558e-02   -1.365431258262175e-01   +4.845282701680911e-02   -2.791547276789386e-01   -7.345738076451397e-02   -1.670482584577910e-01; -3.970613368446520e-01   +2.960518704873395e-03   -9.500815131000290e-03   -3.955204975891766e-01   -2.122191150120334e-01   -3.917201586944120e-02   -6.105838868618983e-02   +2.199093354063522e-01; -4.271457976398512e-02   -1.712859099650608e-01   -1.743555666485815e-02   -3.280310229410404e-01   -7.513666215908352e-02   +5.163553412108152e-02   -1.150304550103967e-01   +1.504990675119279e-01; +3.464470361273489e-01   +1.172247628944436e-01   -1.015686525314962e-01   +1.649093584135522e-01   -1.200481933786063e-01   -1.723674827148351e-01   -1.593137342188730e-01   +1.667306086528431e-01; -4.770404436057755e-02   -8.437230663120419e-02   +1.482967407483460e-01   -8.766602989162878e-02   -5.205133369061891e-02   +3.813815006239942e-01   -1.980429260727894e-02   -1.730101750532129e-01];
L2E_L2I_iGABA_netcon = [+9.292848094852953e-02   +2.300979767008698e-01   -3.987436786662826e-02   +2.360821382144866e-01   -8.889164881627123e-02   -1.714668382399090e-01   -1.870023131732287e-01   -5.207248568284201e-02; +2.116287944166795e-01   -8.356113463385190e-02   -4.067251317394320e-03   -1.130925403821114e-01   -2.152688094014060e-02   +1.366671065878366e-01   +1.012384668537307e-01   +6.755224866861928e-02; -2.372514503191890e-01   +3.209083312992618e-02   -2.319767117552174e-01   +5.146582895931805e-02   -1.285643084143718e-01   +5.467290688504693e-02   -1.776641917626370e-01   +2.571990583664505e-01; +3.230961920397829e-02   +1.622919383794829e-01   -5.969440397204785e-02   +1.443097055272042e-01   +1.657851225429795e-01   -4.891110769234883e-01   +1.146212715421437e-01   +2.709585260107956e-01; +5.476971018240673e-03   -1.319975393750335e-01   +3.726792688021858e-01   +2.048836943174010e-02   +5.362377238075202e-02   +4.705884441673132e-02   -1.472639449348140e-01   -2.321940213647390e-01; +9.798631961329271e-02   +6.209209214135494e-03   -8.616608171272139e-02   -9.978629260468466e-02   -1.677680129664162e-01   -1.070002016733612e-01   -1.900753601924663e-02   -8.931523355307663e-02; -3.090734146786150e-01   -3.284395028172152e-01   -5.288609336632952e-02   -6.398882264247960e-02   -7.222804688121682e-03   -1.551253526551033e-01   -2.806585044049872e-02   +4.512121524787836e-02; -1.463266707732329e-01   -9.104026420123301e-02   +1.972468560650246e-01   +3.108154889811253e-02   +1.600830931993844e-01   -1.537388827704215e-01   +1.798125794250976e-02   -1.724227202330648e-01];
L3E_L2E_iAMPA_netcon = [+8.749797273141965e-02   +4.049183429708751e-02   +1.196307671476688e-01   +1.647561109878935e-01   -3.438570639208996e-01   +3.683033706896959e-01   +1.367550004242451e-01   +4.296400671954604e-01   +5.995758192003439e-02   -3.507603022275278e-02   +3.307395374694293e-02   -3.377704149969097e-01; -1.657520884636593e-01   -3.987444363362215e-03   +3.896591112936505e-02   +2.697177080747935e-01   +3.191759940074321e-01   +1.066754573438549e-01   -2.578834615997591e-01   -1.891918620412290e-01   -1.393923189361008e-01   -2.404903754938040e-02   -2.810594323667377e-01   -6.113239291321576e-02; -1.933608526713593e-02   -1.937717075843977e-01   -2.955772057150320e-01   -3.937603764521820e-02   +3.989415582598265e-01   +2.855863992511426e-01   +1.951534325324981e-01   +2.400924085318349e-01   +1.681925483486660e-02   +2.803094806332206e-02   -1.297150644886834e-01   +5.159375623678318e-02; -3.900408632762849e-02   +2.437632711796401e-01   +3.809051054406325e-02   -5.897956680288613e-03   -1.428218306834935e-01   +2.907997380935461e-01   +1.117240930849128e-01   +1.987423850524587e-01   +1.668123314200207e-01   +1.388532390963676e-01   +2.673492808947820e-01   +8.511642305506564e-02; +4.475924119359493e-02   -2.546410977569372e-02   +9.269048942867289e-02   -1.147074442613621e-01   +1.079097739180377e-02   -8.160930022825122e-02   -1.883688223177573e-01   +1.054522151698460e-01   -1.409665514049930e-01   +3.782631220299240e-02   +2.787541854153465e-02   +9.767059090386175e-02; +2.432484415663797e-01   +4.622054067485278e-02   +1.358103024791682e-01   +1.000391827516985e-01   +1.148363275712810e-01   -1.333222928223359e-01   +1.173555669231579e-01   -4.382220503039796e-01   +1.668723152049999e-01   -1.980709955942486e-01   -2.044302821489649e-01   -9.169790503858501e-02; +1.298484961624321e-01   +8.593779518841252e-02   +1.951395358545372e-02   -1.811694670802464e-01   -1.291139512423589e-01   -3.372761729237148e-01   +1.338774652269430e-01   +4.301843576583169e-01   +9.789457407920745e-04   -2.409679551929657e-02   +1.527533004548627e-01   -1.214446548613665e-01; +3.328572691198450e-01   -8.353181888267873e-02   +3.630237567952170e-01   -1.272348886015761e-01   -1.379638014341806e-01   +3.367128615930769e-03   +2.469089353209763e-01   -1.159354506818189e-02   -3.046468051427656e-02   -2.218995559340200e-01   -3.030996601071142e-01   +1.644252822818070e-01];
L3I_L2I_iGABA_netcon = [+1.965783925797053e-01   -9.197408806518753e-02   -1.057817763920455e-01   +8.930054387134057e-03   -7.521135710901086e-02   -2.268891270819302e-01   -3.313288559923582e-01   +2.288631943498061e-01   +1.769907234430917e-01   -1.546481488304305e-01   -1.165619000039588e-02   -9.745818340914819e-02; -2.641649160460176e-02   -9.490878507821329e-02   +1.176488659022204e-02   -3.024389435513743e-02   +1.101297052479948e-01   +8.375576076448307e-02   -2.543855327422026e-02   +4.452683325053775e-03   -7.832650322142531e-02   -1.429494900597885e-01   -2.176317779568200e-01   -1.448765837841961e-01; -3.560003167256698e-02   -6.210138959286976e-02   -1.614085362785283e-02   -1.223541341993978e-01   +1.559609369701241e-01   +1.973749502358696e-01   +3.373466447923875e-01   +1.483090513238203e-01   -6.339476794984919e-02   +2.381445624956844e-01   +4.352014397533576e-02   +2.267411795574595e-01; -1.954354071966083e-01   +1.924508487517311e-01   -6.992759777783515e-03   +1.954356779435423e-02   -4.804935538348744e-03   +1.633375776151199e-01   -1.650543303126236e-01   +2.190162321905714e-01   -3.473077196648623e-02   +1.064832525034506e-01   +1.765003257464655e-01   +1.657144805994515e-01; +4.854698843633265e-02   +1.200693343965313e-01   +2.059008872694238e-01   +1.721926490558418e-01   -1.304805276548419e-02   +6.358651931066650e-02   -1.081501859407213e-02   +3.232084752058360e-02   +5.345059042836123e-02   -9.107207038895843e-02   +1.617060388446004e-01   -2.241836056681501e-01; +4.084268725321835e-02   +2.533021348141001e-02   +4.803075238299466e-01   +2.853494017382189e-01   -1.022874894563691e-01   -2.638030173277897e-01   +1.504034477402200e-01   +3.948326715177981e-01   +2.824558587507904e-01   -2.352181190060919e-02   -2.851256798618185e-01   -3.881913344143101e-01; -1.461040085495133e-01   +2.668885391233388e-01   +1.230437598023022e-01   -1.407270017007238e-02   -3.061990514443294e-03   +1.001791614621392e-01   -1.781743228125725e-01   +1.751362427335670e-01   +5.936349877169288e-02   -1.814315482104381e-01   +7.674929426559954e-02   -1.418589857420343e-01; +1.896487750784601e-02   -4.347740581534511e-02   +3.937299029750974e-02   -2.470296296496865e-01   +1.148373690793813e-01   +1.856952672131457e-01   -1.108156972294818e-01   -2.346859362779778e-03   +2.615052041726036e-02   +4.284229558803974e-01   +2.396666198875922e-01   -3.084873725176687e-01];
L2E_L3E_iAMPA_netcon = [+2.254519671356112e-01   -1.432387902028808e-01   +6.878166608787405e-02   +6.587764671397725e-02   +1.723588228910089e-01   -1.284293610601016e-02   -5.479222340068344e-03   +2.743748479232174e-01; +3.757068999615196e-02   -4.220100327919267e-01   +2.358265973133634e-01   -3.531169069157985e-02   -1.026448889223587e-01   +3.393385316600436e-02   -3.495902519056294e-01   +1.153116060558495e-01; -3.159631163207548e-03   +2.322023445120089e-01   +2.302824748346422e-01   +3.247279795639602e-02   +1.887404961074761e-01   -1.913507413653808e-01   +1.235254043671695e-01   +8.754523997398128e-02; -1.822033521265702e-01   -4.135644636229148e-02   -1.118424194956351e-01   -1.634138044454018e-01   -1.902032911121719e-01   +5.443928579420179e-02   -2.097820539805061e-01   +2.129593603534632e-01; -2.851499510414337e-01   -5.773351180106131e-03   -4.876793531860076e-02   +4.670277638734393e-02   -1.059375123180605e-01   -7.930807106550385e-02   +6.030419534155561e-02   -9.829014407424447e-02; +3.086563797541667e-02   +4.065005928455568e-02   +2.249069605288417e-02   -1.156918369933751e-01   -1.023162232511055e-01   +2.664554264133268e-02   +9.177441242112772e-02   +8.509444515010667e-02; +4.765081304411620e-03   +1.138359392361091e-01   -2.748206996715840e-01   -2.401971684499676e-02   +2.030588756647922e-01   -3.112541911612566e-01   +2.935024861550364e-02   -1.449222565274285e-01; -1.164814627468045e-01   +2.318222581452719e-01   -5.823882415405018e-02   -1.132134775096174e-01   +6.141488740590119e-02   -1.145111272250698e-01   +1.623518466130193e-01   -2.314579341181389e-02; +2.760525658187116e-03   -1.307030288816845e-01   -3.968622380860300e-03   +2.604083679992309e-01   +9.160239195168479e-02   +6.378370040262252e-02   +3.895221578084158e-03   -2.675097412441637e-01; +9.286132653337081e-02   +9.695980818150779e-02   -6.287108421145202e-02   -4.047547308442172e-01   -3.698513840391234e-01   -6.272193640097523e-02   +1.980303798385053e-01   -1.526937291061987e-01; +1.747267515745230e-01   +2.638999861187399e-01   -1.807802821872915e-01   -8.030851449613949e-02   +1.546383477683312e-01   +1.042180648982616e-02   +1.284545970722972e-01   -2.770220051278054e-01; +8.207935672132879e-02   -7.176261756452423e-02   +1.539790660555782e-01   +6.820880822407676e-03   -4.755001646405423e-02   +7.457119734596665e-02   +1.878934901673261e-02   -1.519356784065654e-02];
L2I_L3I_iGABA_netcon = [-1.246592203557833e-01   -2.589348666875068e-01   -3.099267034435775e-01   -2.701206089096622e-01   -3.789602753208624e-01   +1.210741266952997e-01   -1.535550432514844e-01   +2.299632914225724e-01; +6.138602663405699e-02   +9.008843435313271e-02   -2.620505982366577e-01   -3.354207918261244e-03   +1.940950707094873e-01   -1.657177623389263e-01   -2.060178453170515e-01   +6.710739493589306e-02; +2.497271325842712e-01   +1.747827381782195e-01   +2.864830235871924e-01   +1.127801584087285e-01   +1.663490445565304e-01   +1.151480999975155e-01   +6.799610180729157e-02   -1.049572656650958e-01; +2.028716192682357e-01   -2.619478314155575e-02   -1.326894513840422e-02   +3.656625180959305e-01   -6.723273824284287e-02   +2.714142095421133e-02   -6.233175252121107e-02   +6.165923494115566e-02; +6.818661850181772e-02   +8.286100015378575e-02   +3.737833351519609e-01   +2.123204938874193e-01   -8.265547824169725e-02   +2.831795979442568e-01   -2.488005196288346e-01   -3.667877161024379e-01; +4.441023878064625e-02   +1.548144238958952e-01   +1.054490936695425e-01   -3.510785589476294e-02   -2.238919981777819e-01   +7.322743154195749e-02   -3.429085548902505e-01   +4.324227559928993e-02; +4.298629271685216e-02   +1.647576141484246e-01   +1.458344683608477e-01   -3.693348799470991e-02   -2.360806867967014e-01   -2.376433751120494e-01   -1.501958867687290e-01   +1.916670999445995e-01; +5.548233391656258e-02   -1.433748418079953e-01   -3.646056920067940e-03   +4.271675523682644e-02   +1.505978173807354e-01   -1.773823531209181e-01   +3.709139792738374e-01   +2.542575434212646e-01; -1.683581024014370e-01   -3.631410916911786e-02   +7.778894806852808e-03   +1.899119893687355e-01   +1.766165405027924e-02   -5.469090195018512e-02   +1.369653582617265e-01   +2.687471888182751e-01; +2.194220472913365e-01   +5.845022104788979e-02   +9.407731003820499e-02   +1.754081252343102e-01   +7.218044825335033e-02   -1.308800159869583e-01   -7.795428827849313e-02   -1.134745455522447e-01; +3.018183962326552e-01   +6.297911947139136e-02   +4.288755751385720e-01   +2.594746672242161e-01   -1.038794407508748e-01   -2.396770887712415e-01   -6.601073606025160e-02   +2.430063748416136e-03; +2.135944422790303e-01   -1.604985895114860e-01   -4.949027118081324e-03   +2.476128461860340e-01   -1.081290456651241e-01   -8.870149085641174e-02   -1.030460841435957e-01   -6.588604979761124e-02];
L3I_L3E_iAMPA_netcon = [-2.104336272396796e-01   +4.225634904826329e-01   -7.404555346911923e-02   +1.143708516098803e-02   -1.502752715930584e-01   -2.778044658475167e-01   +1.290802015353811e-01   -7.429824802101026e-02   -1.104205337819570e-01   -2.007005602601493e-02   +1.226731013000479e-01   -1.305072709093524e-01; +2.580632036375364e-01   -2.250836505814437e-01   +2.267614090397085e-02   -2.321399646833018e-01   +3.983200558070697e-02   -1.980638985631554e-01   -1.754632628229878e-01   -1.116617728905828e-01   -1.154289902110441e-01   -3.115088477036508e-02   -1.696594041336852e-01   -4.807371274699791e-02; -3.092545851606509e-01   +1.613727196751166e-01   -1.651880526675941e-01   -1.379667768651296e-01   +2.214071460975177e-01   -2.206863334734082e-01   +9.463625660812908e-02   +2.786810724350110e-02   -2.464487534375200e-01   +1.102565533179695e-01   -1.595931555412038e-01   +1.582179545199653e-01; -1.467654057488957e-02   +1.303510897688890e-01   -2.428381508156146e-01   +5.885621001012392e-02   +1.498166708196481e-01   -2.432614214891213e-01   -2.011986080018912e-02   -4.356162002911573e-01   -2.912421458168341e-01   -1.350194664235158e-01   +2.277633280999022e-01   +1.782460164175570e-01; -1.172738667210324e-01   +2.664939212929719e-01   -9.056629061027345e-02   +3.452077204603377e-01   -2.346292967169539e-02   +1.179262434398179e-01   -7.353631767847653e-02   +3.281654732379457e-01   -5.352976714819364e-02   +2.228157904028114e-01   -7.270393869816841e-02   -9.137382084775855e-02; +2.088896991349790e-01   -4.877704744925465e-02   +1.842988187198382e-01   +1.127860505589465e-01   +2.392409178589927e-01   +1.506438261471415e-01   -2.713238942293817e-02   +6.607547571670594e-02   -2.461187940461953e-01   -2.678997595510402e-01   -1.415369953465126e-01   -1.734965535639161e-01; +1.126006947486241e-01   -2.574645532876708e-01   -9.403983609700842e-02   +3.396647423312747e-01   -1.653143165645163e-01   -1.768621483698958e-02   +3.523603001337334e-02   -7.147171026439941e-02   +5.195088189245080e-02   -9.052193045642712e-03   +3.758072742989110e-02   +1.814780635896052e-01; +1.555598698399163e-01   +4.052055941679390e-02   -1.779668853035148e-01   -1.485942460460184e-01   -6.568818398890737e-02   -2.733271036748110e-01   -4.407259029317113e-02   +1.113859805389890e-01   -4.173269437944700e-01   -5.043390889204158e-02   -4.748404345139273e-02   -1.532032781056041e-02; -9.380799638239223e-02   +2.534630082872767e-01   -1.872404610374195e-02   +1.007300367789798e-02   -2.447867224321305e-01   -2.899590458587330e-01   +1.350621375209460e-01   -1.576133724872135e-02   +1.205807294620086e-01   -2.829578296750159e-01   +5.942699395897088e-02   +2.099230269758193e-01; +2.492150682804981e-01   +1.054004766210354e-01   +2.839667311878475e-01   +3.159256963364931e-01   +2.797598954121764e-01   -2.212787804423330e-01   +1.436672119719683e-01   -2.330623383718853e-01   -1.158180935412910e-01   -1.140707415152261e-01   -5.922478887010503e-02   +1.414372720654111e-02; +1.810680461940908e-01   -1.091804356321458e-01   +8.218095159033724e-02   +1.431379715356726e-01   -1.712072038376893e-01   -1.279353760452737e-01   +1.634880013642064e-01   -1.132339917074026e-01   +1.739155046690653e-01   -2.001906759663808e-01   -3.981070912735818e-01   +1.238223577771122e-01; +4.610473275980646e-02   -2.414594072321631e-01   -1.096610693866785e-01   -1.480038567462121e-01   +2.931406518853657e-01   -2.310338803152538e-01   -8.128035811831179e-02   +2.143823723158609e-03   +1.220699247040647e-01   -2.555324962903259e-02   -5.773875307525012e-02   +1.546604084735230e-01];
L3E_L3I_iGABA_netcon = [+1.157206541281769e-01   +4.212413292124935e-02   +1.048295745925896e-01   +1.291899580189745e-01   -9.898869543253717e-03   -2.598306849886167e-01   +1.297442001788227e-01   +1.674118620555624e-01   +1.286213884829926e-01   -1.585288563349659e-01   +2.300258735330844e-01   -1.401040383438462e-01; +1.983046293079635e-02   +7.498444720261138e-02   +1.355004538389351e-01   +1.434040084473538e-01   -7.551168132612165e-02   -2.263476607307835e-01   +1.769347725346138e-02   -3.311070280838783e-02   +3.123461242180764e-01   -2.225607661951322e-01   +1.671718186159789e-01   -4.305892455641365e-02; -1.926544380325728e-01   -3.480695926171543e-01   -8.582372132477274e-03   +6.842610032676583e-02   -2.851812934091560e-01   -2.289002103623553e-01   -1.582047039255952e-01   -3.431743421356773e-02   -1.393101882549864e-01   -3.884598018154956e-02   +4.287673450033935e-02   +9.230925378761778e-02; -3.097492644425009e-01   -1.304831167831598e-02   +2.052750821433674e-01   +1.845195005175417e-01   -1.091651678798347e-01   -1.660296997302874e-01   -1.352982489288663e-01   -2.471472634862434e-01   -1.043323994355842e-01   -1.146728934793310e-01   -8.282185424147590e-03   -1.918430164478404e-01; -7.121727250311814e-03   +2.434019585182314e-01   +1.487476248051187e-01   -1.522172532501757e-01   +1.746447954741549e-01   -2.541722109345571e-01   -2.196776175428760e-01   -2.741918503085543e-01   +1.014630941380303e-03   -4.495727901482511e-01   -1.142585530660124e-01   +1.320239713115424e-01; -3.865545037703007e-02   +2.256159597070787e-01   +1.501396355310440e-01   -3.097846668619016e-01   +8.101399611235127e-03   +9.827604098214560e-02   +4.393492598189273e-02   -2.022164159161819e-02   +6.715066953767326e-02   +2.701194012722626e-01   +2.159889782332916e-01   +3.980170448933840e-02; -1.088529946837751e-01   +3.247143941852126e-01   -7.358385700692973e-03   -6.932610096096019e-02   -4.088032973541725e-02   +2.066687072937177e-01   -1.071511973826823e-01   +2.695214893792630e-01   -3.484409888096318e-01   +7.162949318766631e-03   +2.734207777176831e-01   +1.881347299908319e-01; -4.884740544304571e-02   -7.816554489812440e-02   -1.611718674485148e-02   -4.623389876694961e-02   +2.323119110091188e-02   -1.502804467104702e-01   -8.503485225417093e-02   -2.601363785363912e-01   -5.902140606841287e-02   +1.853539008565553e-01   -1.000288888166090e-03   -2.884078361839954e-01; -5.392574469323704e-02   -2.826319586304592e-01   -1.981523886682465e-02   +1.269544811495946e-01   -1.717839346786184e-01   -1.472559286602909e-01   -2.082068591434346e-01   +8.600932613280328e-02   +2.164217858563348e-02   -2.942455212214967e-01   -9.914019294345058e-02   -4.043238316547855e-01; -8.823384910608123e-02   +4.273926096579093e-02   -5.182921843995384e-02   +6.062925611713871e-02   -2.035371421362022e-01   -6.760248440858183e-02   -2.057092633413404e-01   -2.755685355738369e-01   -5.585679379632872e-02   +3.476967168509019e-02   +2.152159293121979e-01   +5.781461936511145e-02; -2.888720241733805e-01   +6.498510399567198e-02   +7.507109809362709e-02   -4.262439247231488e-02   +1.557736116418421e-01   +2.547650165787200e-03   -5.140612808493594e-03   -2.484051771882020e-01   +1.043202533271940e-01   -1.240271143128050e-01   -1.302717882716438e-01   +2.018334676224095e-01; +3.156883976656026e-02   +3.744565209629389e-02   -1.035993892449487e-01   +2.890486635770219e-01   +6.622782522706157e-02   +8.452170797645620e-02   -3.177483861047447e-01   +2.689036231254539e-01   -3.528631913476292e-03   -3.631994858547783e-02   +8.865169015024865e-02   -1.751756113685982e-01];
L2E_Input1_iAMPA_netcon = [+5.792959742263057e-02   -6.123686012558926e-02   +2.463096145946674e-01   +1.071749356919796e-01   -6.370898007932092e-02   -2.955876711794687e-01   +9.800401285152169e-02   -2.498663635871669e-01];
L2I_Input2_iAMPA_netcon = [-9.948857899360822e-02   +2.840404279667132e-02   -1.049810692011817e-01   -2.500251852317630e-01   -2.203380855053179e-01   +3.669130209860321e-01   -7.981871315583569e-02   +1.931966514700479e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
