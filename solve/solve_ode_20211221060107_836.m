function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.950098618802332e-01   +3.675516193515443e-01   +6.053934021087501e-01   -3.915965313723159e-01   -6.171723752735992e-01   -4.631266187429423e-01   -2.719417062207007e-01   +6.946868872661154e-01   +6.727993008572958e-01   -3.967297688826303e-01   -1.098529736527332e-01   +1.320235448921543e-01   -3.295646037839888e-01   +1.774517645127451e-01   +5.234211733966826e-01   -6.143594179127594e-01; -3.195523083886423e-01   -2.483714452706297e-01   +2.393315556131697e-01   -9.847440064498522e-02   -1.763730938191125e-01   +5.211631326335032e-02   +1.277043505313373e-01   +3.099561006947791e-02   +3.994066289976819e-02   -3.785748909160063e-01   -1.217398823808562e-01   +6.155266547544057e-01   -1.268180468410303e-01   -2.382624324765364e-01   -2.090690022252218e-01   -8.551586139184590e-02; +3.534414082302350e-01   -1.815399538118875e-01   +1.790748457460833e-02   -3.446244171330471e-02   -5.258686652245341e-02   +5.902340216260256e-01   -4.731834677526608e-02   -4.436723398785785e-01   -7.682278470963527e-01   +7.953557829118577e-01   +3.197100734048923e-02   -5.689939212321437e-01   -3.426897002817056e-01   +1.755481718447186e-01   +5.511936393840023e-02   -1.981683381933375e-01; -3.473307922603066e-01   +3.216160213388773e-01   -4.623837108663144e-01   -4.810426849251610e-01   -9.611083205282667e-03   -8.542362003030844e-02   -3.459511902462393e-01   -3.209173109896703e-01   +5.932256503673844e-01   -3.881711114679360e-01   +2.016662324238550e-01   +7.734919146958855e-02   -1.679152023105628e-01   -3.337439504090032e-01   -3.382267899046528e-01   -4.408145827804822e-01; +3.137255852766590e-02   -1.430251825158883e-01   -7.134182823846424e-02   -6.519375539993368e-02   -1.629891619813336e-01   -1.618367008994286e-01   +4.176619571361496e-01   +3.548469150868128e-02   +2.532189669284438e-02   +5.067181874593018e-02   +5.920200647663296e-01   +2.831471550091392e-01   +4.855784083375539e-01   -4.630317900933810e-01   -4.776807392687273e-01   -1.422257113386357e-02; +6.721588572688273e-01   -2.936564949035304e-01   -2.616843100702097e-01   -2.024662307803218e-01   +2.058912578287624e-01   +6.963315676645152e-01   -3.789256642152791e-01   +1.592977590602515e-01   +4.640416832388754e-02   -5.002712889883972e-01   -1.954127877293678e-02   -3.127524298780327e-01   -2.573689592428079e-01   -2.430213319058667e-01   +6.430985244177487e-01   +9.047741143034219e-01; +6.510405836803760e-01   +3.147884580758988e-01   +1.190740131595538e-02   +2.729371851725810e-01   -2.410394799989313e-01   +7.708879064197159e-02   -1.449422096467174e-01   -2.011737453476819e-01   -1.692528236117449e-01   -4.408327147319722e-01   +1.511497920253836e-01   +2.830666132625123e-01   -1.542074283327145e-01   -3.455511537687079e-01   -1.130332759138058e-01   -1.134296840062889e-01; +2.630649002087272e-02   +1.123975678414305e-01   +8.157820253405151e-01   -4.052665357974359e-01   +1.233821951999020e-01   -6.068074360094801e-01   +2.422129050216827e-01   -4.502343562307091e-01   -7.064058137944552e-01   -7.131069180209428e-01   +6.429898672114644e-01   -1.029817253732659e-01   +4.839683503905489e-01   -6.697172530548567e-02   -8.613991280126343e-02   +6.852107981965297e-01; +3.592046813602857e-01   +3.286831210473787e-02   +2.626061388689249e-01   -2.652300490886588e-01   -1.155861066612427e-01   +4.193727554223297e-01   +1.989588696469012e-01   +1.015718463203380e-02   +5.036450056052134e-02   +4.310677520160694e-01   -2.389945364604114e-01   +4.703989604934745e-01   +2.504010762450507e-01   +5.130345063764696e-02   +8.222376735323749e-01   +4.067604364134148e-01; +2.275226403590294e-01   -2.972751440304864e-01   +7.124169842371565e-02   -6.295455884825985e-01   +4.038502295201398e-01   +5.021496090360750e-01   +6.647626595742386e-01   -6.313307944688620e-01   +1.511125294248844e-01   +6.343547773010633e-01   +1.619119018956128e-01   +1.782869013377674e-01   -2.288689398114552e-01   +3.560257531592549e-01   -4.310047338250637e-01   +2.853901953585163e-01; -5.012739992684220e-01   +3.777389785764988e-01   +3.862077909071749e-01   -6.903887483861009e-01   +2.756296775757091e-01   +5.862349763619528e-02   +1.751725882933571e-01   -1.564123818415014e-01   -8.211765377953405e-02   -2.514462298426565e-01   +5.447383533155763e-03   +6.101215336800532e-01   -1.297946794387433e-01   -3.301793440485724e-01   -5.100006710667221e-01   -2.651402378112042e-01; -8.429950454642698e-02   -4.170523665848808e-01   +3.555294546768300e-02   +3.814574565266333e-01   -1.679963611892372e-01   -6.144757773894343e-03   -4.521608683403893e-02   -1.660160728008149e-01   +2.743774717970224e-01   +4.157116446559334e-01   -4.562711304807112e-01   +6.810888077415195e-01   -1.784423585273777e-01   +9.564906275915554e-02   +7.354582586829859e-02   +3.239744879725866e-01; -2.346077418418417e-01   +1.529633417580213e-01   -5.482073737612508e-01   +2.424313029711145e-01   +7.603851260897438e-01   -7.321737877655362e-01   -1.652344141897912e-01   +3.104399147601708e-02   +1.483764233391250e-01   -4.233230771628039e-01   -2.197699017340890e-01   +5.130193438768060e-02   +4.477012317052110e-01   -7.580375793006707e-01   +2.946174631908015e-01   +1.959770187052391e-01; -3.640335125145545e-01   +6.100079617660948e-01   -7.871531811220978e-01   -4.866830054257713e-01   +1.865426774338022e-01   +1.830867830837745e-02   +2.880923384937997e-01   -4.571098402486480e-01   +1.849664625488079e-01   +1.750402290627106e-01   +2.099735611184955e-01   +4.831208103655256e-01   +7.879943521726386e-01   +6.118749795507457e-01   +3.925823032912681e-02   +5.199677255422002e-01; +3.715400413741523e-01   +4.785620535849768e-01   +7.346217206709024e-01   -5.914338243129962e-01   +6.747036422408210e-01   +1.780923386255558e-01   -2.720824080441645e-01   +4.353832026970131e-02   +1.321698142268530e-01   -2.991083650287468e-01   +7.209544463584526e-01   -6.717861659387611e-01   -2.175557080990335e-01   +1.117754760970930e-01   +6.452256275564812e-01   +1.032556399117979e-01; +6.429478779102270e-02   +8.215979055093658e-02   +1.914445198973109e-01   +2.706631202505601e-01   +8.640985200530952e-03   +6.565467857305431e-02   -3.699643476073863e-02   +2.271862723106298e-01   +1.958603989101683e-01   +2.120046066435692e-01   -3.417484951040367e-01   +6.125594280886211e-01   -5.791965667164269e-01   -1.000000000000000e+00   +1.095545733097308e-01   +3.482994070693938e-01];
L1E_L1I_iGABA_netcon = [+4.383874016706201e-01   +6.343038385630702e-01   +2.032801100112434e-01   -9.454483205391742e-02   -5.865394281600973e-01   +7.538144249149784e-02   -6.439795632187615e-01   +8.442287775519007e-01   -6.871188999506517e-01   -9.553711889639320e-02   +2.567602985421241e-01   +6.320713951368864e-01   +7.264817631788907e-02   -2.150864075599518e-01   -5.331596232070568e-01   +4.005834738010225e-01; +3.589335995183888e-01   -3.112756710206071e-01   +1.706843577941650e-01   +1.722558062421900e-01   -2.466813972175070e-01   +5.919874705832959e-02   +3.447427027306387e-01   -2.330264241992462e-01   +3.551365190571107e-01   -2.774898681416178e-02   +6.948769023327667e-01   -7.083556948164721e-01   +9.223319735980307e-01   +3.071094988285838e-01   +3.861829989691336e-01   +2.577913406660519e-01; +7.983808062804498e-01   +2.241058176303050e-01   -4.665059817727440e-01   +3.796659606481378e-01   -2.807001501776585e-01   -7.021247828228813e-02   +4.198151762106209e-01   +4.861788850078635e-01   -2.037334363254674e-01   -1.441553420857851e-01   -7.685818633426177e-02   +1.575968789856892e-01   +3.554496905747632e-01   -5.668008628188541e-01   -9.283837042746215e-02   -1.571606253360940e-02; +2.240576329961698e-02   -4.433688386398565e-02   +7.872453248981888e-01   +2.894927347702688e-02   -2.197566642079711e-01   -1.777927752479410e-01   +3.555778882383928e-02   +4.722825818032460e-02   +5.325711309482379e-01   +5.879240522619853e-01   -2.368737831252435e-01   -1.484739404592602e-01   +4.367150575542859e-01   -2.515393197694297e-01   -6.361636745109520e-02   -3.371008557355907e-01; -7.988744894771518e-03   +5.314339963452308e-01   +3.726769971215392e-01   -4.716196397082465e-01   +2.300641003188867e-01   -5.676377186965539e-01   +2.097394301955928e-01   +6.031652738148263e-01   -3.779644230803383e-01   -2.044309262786246e-01   +3.549117067862047e-01   +1.274374531206163e-01   -1.681743195825930e-01   -4.643422001920110e-01   +1.131475794102947e-01   +5.412350513164609e-02; -2.581322202079650e-01   +9.528739284192277e-03   +6.171406781487266e-01   -3.293416736579186e-01   -7.972160417769550e-01   +5.253084453871686e-02   -3.994660711782569e-01   -3.780439207125261e-01   -1.569841206921143e-01   +4.390014031582606e-01   +8.524111374378157e-02   +5.328561806830440e-01   +7.337681069182476e-01   -4.797454022354284e-01   -6.859975895547793e-01   +3.421649990618754e-01; -4.044742648950810e-02   -2.376718530489047e-01   +1.661877068422171e-01   -2.821309419825162e-01   +2.288684160926001e-01   +4.982608601365061e-01   -3.856399305283130e-01   +7.380358919681280e-01   -4.025888659198593e-01   +5.553914328491540e-01   +1.998413177365935e-01   -3.497640450638943e-01   -3.519654419143802e-01   -6.990047220410808e-01   -1.366938605377094e-01   -1.822719397768632e-01; -5.154387532519338e-02   -5.710992055899664e-01   -1.400090263478500e-02   -1.270360441403019e-01   +2.047090591296737e-01   +2.375260465341368e-01   +1.728638296847212e-01   -1.965711492483036e-01   -2.122285699336995e-01   +5.187456607303530e-01   -1.000000000000000e+00   +8.360634295308915e-02   -2.061534277961154e-01   +1.760207551659946e-01   -2.163578915007544e-01   +3.635050248416344e-01; +1.283994763617862e-01   -5.591963934349861e-01   +5.649060260601788e-02   +5.003238158608850e-01   -2.779786048823737e-01   -3.605514549124512e-02   -2.083666151042412e-01   +3.856943967307216e-01   +1.995008005093850e-01   +3.775113840694220e-01   -1.433073854401432e-01   +2.671072311419372e-01   +8.297342700943459e-02   +7.509169179101398e-01   -4.391031616435875e-01   +3.565869097343771e-02; -5.352898403715287e-01   +3.982280344956531e-01   -6.075336964736250e-01   -1.596054886985589e-01   +2.621340542713107e-01   -2.913825950186830e-01   +2.556806995551589e-01   +7.285405002540832e-01   -5.960579207346559e-01   -4.943111765019335e-01   +1.828364935611844e-01   +1.812389202467120e-03   +8.000007195614697e-01   -3.180570661110279e-01   +1.280088252319529e-01   +4.106844371715510e-01; +2.192431735178954e-01   -2.344582107515893e-01   -4.800169057940771e-01   +3.857220117281094e-01   -3.039403410983932e-03   -2.189976914535497e-01   +7.726732743469081e-01   -6.547055675190030e-01   -2.528545958667444e-01   -4.930728632871897e-02   -1.885327692848227e-01   +6.314840928940449e-01   +3.050264478711635e-02   -3.941823291866376e-01   +4.640944990459465e-01   -2.024999212700728e-01; -5.910170515506967e-01   +2.435231601447488e-01   +3.959375058064959e-01   -4.578086505708136e-01   +1.856551461396898e-01   -2.522307531826766e-01   +1.144779843865791e-01   -2.535240313476058e-01   -1.484796184009385e-01   -2.638673254473040e-01   +2.365790394523795e-01   -3.057722677035688e-01   -2.902577652288076e-01   +4.110400521518766e-01   +2.817827630026856e-01   -6.112643819552656e-01; +9.552445491023635e-02   -3.508709880035989e-01   +9.930032329225753e-01   +3.224274704193802e-02   -7.506995503706761e-02   -1.831520229054102e-01   +2.281493395447919e-01   -2.118319187645458e-01   -1.298386215419892e-01   +4.459220008971315e-02   -4.511037432893875e-01   +1.883462196608703e-02   +1.631335132424043e-01   +6.602994830140131e-01   +5.514298919935281e-01   -4.827372767221848e-01; -7.217931818349488e-01   -7.142419974156242e-01   +5.597447224096382e-02   -1.042665298623509e-02   +7.160665963648420e-01   -5.776416867867094e-01   -2.111188901902407e-01   +8.875426533757479e-01   -1.022283426186014e-01   -8.929198231090998e-02   +2.788976889982875e-01   -8.211481317156724e-01   -1.972381071178182e-01   -7.485510621215906e-01   -3.252155529258453e-01   +8.440384339372867e-03; -3.095171614424463e-01   +3.309302986240196e-01   -2.998949235605572e-01   +2.411135972165586e-01   +8.738080621080477e-01   -2.734265664025273e-01   +6.331561366773195e-02   -2.983745865224961e-01   -4.712968176452183e-01   +1.487372220329009e-01   -2.363130521891071e-01   +4.691284555136334e-01   +6.221387319222335e-01   -2.807989949372736e-01   +1.319879309729801e-01   -2.766895279457221e-01; -3.700500231407053e-01   +2.077386664495464e-01   +6.822324745919279e-01   -4.115013315424861e-01   -2.827707391146317e-01   +1.884706786217943e-02   -4.793529887495104e-01   -3.036022359773563e-01   +7.405031292976338e-01   +1.211829327444825e-01   -7.161077160156630e-01   +3.192422711968753e-01   +2.691273967261840e-02   +4.671161375178482e-02   +2.595556860825667e-01   +7.657844240611655e-01];
L2I_L1I_iGABA_netcon = [+2.951998560173519e-01   -4.469743465309573e-01   -2.873588848177826e-01   -6.434042414606156e-02   -1.820306341139712e-02   +6.546785255999373e-01   +1.520900751745561e-01   +2.612937889352084e-01; +3.940179909731271e-01   -1.696090188950488e-02   -9.995727109895594e-02   -3.666023772356722e-01   +6.561166245737555e-01   -6.476585783106327e-01   -2.020998712258618e-01   -4.027723845933668e-01; -3.281161984559403e-01   -7.186310778941022e-01   -3.824341239428932e-01   -5.568867171988431e-01   +2.322905998644701e-01   -5.150867539872799e-02   -2.504908650655411e-01   -1.000000000000000e+00; -1.397451466058439e-01   +5.386181557526962e-01   -2.321811737773275e-02   -2.720280252873058e-01   -1.704127073847237e-01   -1.252081807618327e-01   -2.206022790677874e-01   -3.138650927859069e-01; -2.308383491109673e-01   -1.628950535517304e-01   -1.236768824872387e-02   +7.096047224961513e-01   +3.408269229454053e-01   +4.514457970460254e-01   +9.271723470872077e-02   -3.431494353844022e-01; +4.404934833199874e-01   +5.590255264850331e-01   -3.577904368969664e-01   -2.781236205922636e-01   +2.888237247847926e-02   +1.616581086010706e-01   +1.356247910986254e-01   +5.626736989913974e-01; -3.347806786734628e-01   +5.132087877049128e-01   +4.466068585102809e-01   -1.073518149961282e-01   -3.297217741525945e-01   +1.657164487728496e-01   +4.412797656909936e-01   +5.607224027152502e-01; -3.058539933450871e-01   -3.400493462146312e-01   -3.179725613716249e-01   +3.226116609996703e-01   +2.703490274026455e-01   -2.605129036278660e-02   +2.024401122768468e-01   +4.279637213256244e-01; +1.193519938062960e-01   +4.615269707294754e-01   -2.275763565989272e-01   +3.039110150394383e-01   -2.060988612553111e-02   +9.608355955559914e-01   -2.070427333476497e-01   -7.595270830488148e-01; -1.675006164404587e-02   +2.984485484762246e-01   +2.470709167228932e-01   +5.181705796313049e-01   -3.276885109542592e-01   +6.270391280175698e-01   -3.758544333668436e-01   -5.005486059662645e-03; -1.405296025606262e-01   -6.969609359075269e-01   -1.562205165497446e-01   +5.104742642716075e-02   +1.971194033514459e-01   -1.836093531255858e-01   -2.556465192978257e-01   -5.401730108050898e-01; -6.142936654226031e-02   -1.033198707337954e-01   +3.875680418457435e-01   -1.452137092105787e-01   +1.014075312938964e-01   +4.814603748328904e-01   -8.067223254725021e-01   +1.833806409069902e-01; +5.712014053741311e-01   +1.049189142457409e-02   +1.252517738392068e-01   -1.647167726775764e-01   +1.802321167229978e-01   -3.898374771883651e-01   -3.580170447945913e-02   -5.470734473067504e-01; +2.803244723048253e-01   +5.949834456451363e-03   +3.547506783612502e-01   +3.472481577090124e-01   -3.959145326930358e-02   +7.820304640471573e-02   -2.148047688347798e-01   -1.961543135519680e-01; -5.904324465957258e-02   +3.943912628155559e-01   -1.841159755733618e-01   -6.803068500061624e-01   +3.618290626684558e-01   +4.791226189667856e-02   +6.207456522746957e-01   -4.353252647918070e-01; +1.510457738251105e-01   +3.804063547104852e-01   -3.069689247143569e-01   -7.097271632858243e-01   +9.345440538290603e-02   +7.016401083668394e-01   -5.152349498561867e-01   +3.701944937393474e-01];
L1I_L2I_iGABA_netcon = [+2.892579819441380e-01   +8.512536417929435e-01   +2.409629002288833e-01   -5.539651879531615e-01   -2.139475094340960e-02   -9.090416460768744e-02   +7.308009183977672e-01   +2.688774634049504e-01   -1.726157360960177e-01   +3.623591122532048e-01   -3.907243479019272e-01   +6.435277290716050e-01   -1.061678446724266e-01   -3.225736867106603e-01   -4.563588472221303e-01   -1.597308834759293e-01; +7.979614056836489e-01   -9.409155100283804e-02   -8.235069999592604e-01   +3.345647217637343e-01   -4.609215547410774e-01   +3.095832155639717e-01   +8.794131505217655e-01   +1.462926387437622e-01   +2.067240222281122e-02   +1.453469472256854e-01   -4.804716219457784e-01   +9.599735434753545e-02   +4.496977428769608e-02   +2.497396111713549e-01   -7.243108276509612e-01   -6.268470574094323e-02; -2.603749304030728e-02   +9.385589398859252e-01   +1.596238227765220e-01   -4.062155112344538e-01   +6.277443248576262e-01   -2.017810009686994e-01   -5.612216463645028e-02   +1.857782104360574e-01   -2.531739751035775e-01   -2.538123021252685e-01   +6.404977774827739e-01   -8.612121454803894e-01   +3.227970806083400e-01   -1.699723395990351e-01   +8.235457239552657e-01   -1.751871626052972e-01; +3.500058786968141e-01   -4.095071662774023e-02   -1.054349838583844e-02   +5.331164405397675e-01   -7.146367925947761e-01   -2.169389959815827e-01   +9.335849175058432e-01   +8.289392066903588e-01   +7.869362741455100e-01   +3.864847674193017e-01   +1.251027339788188e-01   -1.166104288294860e-01   -2.998956421643092e-01   +3.355486678334012e-01   -1.679546649989550e-01   -7.750510404035739e-01; -1.585330191267608e-01   +1.986885513162446e-01   +5.618739128440386e-01   +8.718121817034009e-01   +9.768222284969830e-02   +3.222190105287882e-01   +7.684935969533800e-01   -1.928771060075680e-01   +5.135728261008189e-01   +3.803855359991054e-01   +1.195372209681955e-01   -3.690313752748126e-01   +5.300995267868241e-02   +2.339999701248452e-01   -1.273547681104181e-01   +2.358167316135817e-01; +2.042982375696834e-01   -2.486802970967870e-01   +5.073584538183015e-01   -1.961246580181218e-01   -2.840014016651764e-01   +3.886565788256467e-01   +1.000000000000000e+00   +2.982865079761817e-01   +4.896499659844557e-01   +3.416935443128881e-04   -2.011009920910509e-01   +2.903149535267041e-02   -3.050763141069012e-01   +8.120290953693271e-01   -2.953716203903279e-01   +2.265336899599407e-01; -8.423210186711723e-02   +1.680479317255412e-01   -5.392689707295160e-01   +3.394177042064347e-01   -4.287960480586199e-01   +4.571787182247570e-01   -3.545622793293756e-01   -1.867231796816858e-01   +7.805648010615255e-01   +3.085993384393921e-02   +5.674420979421658e-01   +1.493268150104639e-01   +4.071325911276130e-01   -5.122681132639627e-03   +3.333542969749251e-01   -7.235660764967410e-01; +3.483031399643735e-01   -7.979871117318896e-01   -7.467791887276641e-02   -1.461799979885454e-01   +5.410776534343011e-01   +3.676727968406970e-01   -9.475256716959050e-02   -2.394855110624095e-01   +4.153889304033420e-01   +3.526891841664493e-01   -6.564573811832228e-02   +2.694353764771026e-01   -3.639913554834156e-01   -8.881578756519418e-01   -1.292298009806406e-01   +1.437207295398649e-01];
L2E_L1E_iAMPA_netcon = [-2.273446475476142e-01   +1.671728500287684e-01   +5.512332401775489e-01   -9.153643643911549e-01   +7.847245529801981e-01   +4.507315049636760e-01   +2.596112361583240e-01   -6.790408539721066e-02; +1.224504628272691e-01   +1.743298089069782e-01   -7.427922222098282e-02   +6.332876736711812e-02   +3.351441583490219e-01   +5.107467258928418e-01   +3.790051200203798e-01   +6.489869196029007e-01; +7.857624388685288e-01   +3.292031749342486e-01   +1.530069467931067e-01   -7.843930135683524e-02   -3.148754003189000e-01   +3.219657752303173e-01   -5.043869349382842e-01   -2.073080728842852e-02; +2.835185159366967e-01   -4.921512179129106e-01   +2.416398610498516e-02   -1.244248925586876e-01   -4.110606160324060e-01   -6.015779484725646e-01   -1.322721254428399e-01   -1.052069848959579e-01; +3.670123007063304e-01   -6.961211538632039e-02   -7.793372474961641e-02   -2.563091048307511e-01   -8.117904084424352e-02   +4.341624681755225e-01   -2.572228405964069e-01   +1.769965196997073e-01; -5.755428976069566e-01   -2.465251134501278e-01   -4.547308122657703e-01   -1.448412700231069e-01   +4.252282139831925e-01   -8.628303369565667e-01   -1.237366638473902e-01   -4.711517957122045e-01; +1.029702004365383e-01   +2.566839466838823e-01   -2.907476657747987e-01   +4.103468220932353e-01   -3.531048460826987e-01   +5.565837560388612e-01   -4.540193256075731e-01   +3.685122365109922e-01; +3.691577866416573e-02   +1.258872137299977e-02   -6.586269621723871e-01   +1.329736297227581e-01   -2.319484652926131e-01   -1.141599503142469e-01   -3.188009815982717e-02   -2.532271024968621e-01; -4.648109460113575e-01   +1.956737702098164e-01   +7.159402264431194e-01   -9.253494737719536e-02   +4.285560839627582e-01   +2.417221959201504e-02   +8.219167996445809e-02   +3.204962995098781e-02; +8.180086184779443e-01   +6.290849333764181e-01   +4.821491983772859e-01   -2.355080411306192e-01   +4.499260982973757e-01   -3.931006904247034e-01   -5.263202989702314e-01   -5.393015122703546e-03; +2.906418657962106e-01   -4.618951639135745e-01   +8.785608924690785e-02   +6.140236046271504e-01   -6.604078010958503e-02   +1.957352914995767e-01   -4.494637768460766e-01   -2.176007805668559e-01; +2.143151327339837e-01   +2.306728665162173e-01   -1.018130189877829e-01   -6.441264312646962e-01   -1.319125055475297e-01   +2.106682910653722e-01   -8.158086571161222e-02   -6.963903829897528e-01; +6.445375348350864e-01   -2.307808127939930e-01   +5.587986064670505e-02   -3.374974979980702e-01   +1.584344985272096e-01   -2.018578072945746e-01   +2.008088706910371e-01   +2.736263402831070e-01; -3.877009530686248e-01   +6.039636927120362e-01   +4.847672752426766e-01   +4.207594524153181e-01   -1.697033767660081e-01   -5.940946093749749e-01   +3.949192583149955e-01   +5.299684845454533e-01; -8.824464550008929e-01   -1.940413683828473e-01   +1.397901155387769e-01   -2.659837184163073e-01   -4.145407657348051e-01   -6.645689256693108e-01   +4.130579724179384e-01   -5.156792370663282e-01; -8.915050412324270e-01   +2.535412489482391e-01   +7.246282743235045e-02   -7.724928674393781e-01   +7.082181585854623e-01   +2.004990410877516e-02   +6.849215247285279e-01   -2.409065864811105e-01];
L1E_L2E_iAMPA_netcon = [+3.983114194745906e-01   +5.470174016924503e-01   +1.293073509403924e-01   +1.871477394631040e-01   +1.401532793097667e-01   +2.183756441950725e-01   -3.703144994792500e-02   -5.454044982580799e-01   +2.962503258381901e-01   -4.372042626739875e-01   -5.145936607119487e-02   -3.625123618363542e-02   +1.757371496104788e-01   -1.604905168557557e-01   -1.546609478775632e-01   +3.488538790448019e-01; +1.039035642309862e-02   -4.583479660276322e-01   +4.037484933665437e-01   -8.821763577648493e-02   -1.831106921394162e-01   -1.000000000000000e+00   -3.522803550754224e-01   -1.575257589089990e-01   +8.907296457192561e-01   -8.457117288203402e-01   -7.619906231890099e-01   -6.338476742152234e-01   +1.606321983268295e-01   +6.404367623809278e-02   +2.210884378870751e-01   +1.641638436017434e-01; -2.323464567020508e-01   -3.210986619183036e-01   +3.935140477991702e-01   +5.739640262675823e-02   -4.571018481035126e-01   -2.496243688901988e-01   -5.926712626637596e-01   -6.618107151181797e-01   -9.714648721271302e-01   +2.918842856957731e-01   -3.166116617489944e-01   +4.335934102997828e-01   -5.023482735238793e-01   +1.514405717752784e-01   +4.026954057914349e-01   -3.128160695018942e-01; -3.073903039134716e-01   +2.948673889193387e-01   +1.122111197404013e-01   -9.600535564014100e-02   +3.773683238873266e-02   +9.502666009993334e-01   +2.864185906551781e-01   -6.065211004081734e-02   +2.254868013565909e-01   +5.868631342708319e-01   -1.279593955372020e-02   -1.897115789071293e-01   -3.552100958892713e-01   +2.337642061545428e-01   +3.081921052583875e-01   +5.478514286977848e-01; +3.182867848105137e-01   +3.179844301144137e-01   -2.713996629964843e-01   -4.259115982548546e-01   -1.175744289832861e-01   +5.039237549545107e-01   +1.615214001160371e-01   +2.579244665738491e-02   -4.162850989509799e-01   +2.105855197231480e-01   -4.885465540010164e-01   +8.274967242361312e-01   -4.630104325091183e-02   -2.833601457882076e-01   +4.183058467698227e-01   +4.592439183754963e-01; +3.463656353672599e-01   +2.435016343516410e-01   +1.496835310395521e-01   -4.417244798582655e-01   +4.815440105737399e-01   -5.251600392357811e-02   +4.165423438301769e-01   -6.957819505019502e-02   +6.411542269602304e-02   -2.436413895573632e-02   +2.998791528165416e-01   +1.609373019595843e-01   -3.409134746298028e-01   +5.648961495165992e-02   +3.939456691845621e-01   -5.205295948283902e-01; +7.382930601515450e-02   -9.168564160200306e-02   -3.408066121598390e-01   +2.077860558098122e-01   +7.438150548451827e-02   -6.030300736127927e-01   +6.043665997814477e-01   -1.893061754077359e-01   +2.552664351397098e-01   +1.613134734269429e-01   +6.008418450315014e-01   -1.551825070659414e-01   +3.196528957696422e-01   +4.883695669909839e-01   +6.079558262899046e-02   +4.442018483569969e-01; -2.941187523020872e-01   +5.947032089186487e-01   -5.259165690217839e-01   +8.920030076534281e-02   -4.276961284859618e-01   -1.223063470984246e-01   +2.525344372412940e-01   -4.876838943995479e-01   -5.846991328663842e-03   +2.425772580931477e-02   -1.554414061198721e-01   +1.602347296724342e-01   -5.324336786891786e-01   +2.361886812012263e-01   +4.839798966161635e-02   -1.946184386805772e-01];
L2I_L2E_iAMPA_netcon = [+5.434502571865885e-01   -7.654209283588183e-02   +6.652525825223247e-02   -5.555873213598396e-01   +8.838062810814631e-02   +1.389363765712892e-01   -2.617642456100910e-01   +6.356414090407518e-02; +2.177315268675910e-01   -8.613819394012850e-02   -6.444158335242048e-01   +2.884234771473642e-01   -3.745867589967379e-02   +5.368476348918213e-01   +4.522526092009239e-02   +4.394778843094885e-01; -2.641190231880413e-01   -9.176372057867603e-02   +3.300838902766394e-01   +2.104042401454248e-01   +4.000682726060407e-01   -7.471857142187740e-01   +2.811427826039484e-01   +3.260896642128636e-01; -3.158484545445916e-02   -6.513319707756800e-02   -1.550522944225478e-01   +5.497489768864817e-02   +3.564290379620056e-01   +3.396481051305122e-01   -4.143045095132634e-02   +1.509094138918553e-01; -9.414876644934579e-01   -1.986174024341699e-03   +1.577910735841533e-01   -1.232099750075327e-01   +2.447589413451860e-01   -6.663688757694842e-01   +3.333460657218735e-01   +9.624445374677866e-01; +4.553412488105594e-01   -2.936171295588996e-01   -1.000000000000000e+00   -8.316271972559858e-01   -5.777772595855094e-01   +4.780618329762413e-01   +6.950554879537234e-02   +2.008325824705843e-02; +1.027683895384452e-01   +1.190113658963483e-01   -5.866515973623032e-02   +4.514007901285230e-01   -4.110633184942702e-02   +3.082261938722622e-01   -2.637464625987971e-02   -3.220352910183397e-01; +3.621179394505478e-01   +5.514703093663688e-01   +1.545382471959438e-01   -1.772567391750140e-02   -9.088814308717817e-02   +4.477049311739884e-01   -3.314759344640116e-01   -1.391415728006113e-01];
L2E_L2I_iGABA_netcon = [-1.717740559017218e-01   +2.314201683705974e-02   -4.544980226105766e-01   -2.170732067827331e-01   +2.343240462868497e-01   +1.465483016182424e-01   +4.788548245536462e-01   -3.533805074600613e-01; -1.258718144827785e-01   +1.760111786217427e-01   +6.479632502744045e-01   +5.934804617629361e-01   +3.126083133300243e-01   +2.520626023569580e-02   +2.512725640781805e-01   +7.383124295139349e-01; +2.927265341888181e-01   +1.170758023276382e-01   +5.932903240141851e-02   +1.122266919422742e-01   +6.679804802214285e-01   +2.379173983822853e-01   -1.140503753982298e-02   +1.887947340052753e-02; -6.927801337634898e-01   -5.072342242961539e-01   +9.037215346940530e-02   +9.429441283355400e-02   -7.090612240913581e-02   -1.548213099503550e-01   -5.300253384377300e-01   +8.175154214575106e-02; +2.421490241420195e-01   -6.274453160780791e-01   -1.919001867240791e-01   +3.443837391560816e-01   +2.785487718202833e-01   -7.187965795567227e-01   +1.823150794350847e-02   -1.323790974054990e-01; -3.163513461899163e-01   -6.761905795239948e-01   +3.367537572999211e-01   -6.835160692400700e-01   +5.289433811257750e-01   -2.133362822517980e-01   -5.972743114296327e-01   -3.833042990090630e-01; +1.857975152537744e-01   +1.129445807183410e-01   -2.416112315380750e-01   -5.301995034016782e-01   -1.034778056914474e-01   +4.913051272147175e-01   -8.024678299423157e-01   +5.593166206065106e-01; +5.251315685605252e-01   +1.000000000000000e+00   +4.218654684053449e-01   +2.432126080849237e-01   +5.290089440217394e-01   +4.047337876017661e-01   -3.197935822100778e-01   -6.694452609413317e-01];
L3E_L2E_iAMPA_netcon = [+6.227386502079466e-01   -6.974475820658038e-02   -5.593349535424357e-01   +2.340918627961603e-01   +1.000000000000000e+00   -5.898064432925960e-02   +2.191683958590657e-01   -4.310022419395270e-03   +8.393929574381013e-01   +6.336062457539101e-01   +3.851963001813293e-01   +9.932735295167228e-01; +5.859536896764717e-01   +1.248111873877955e-01   +6.309094460929365e-02   +1.864504571770040e-01   -1.587091337360844e-01   -5.888083927752262e-01   -8.201352423776176e-02   +4.890726430718050e-01   -7.739189558612203e-01   +5.453124769374313e-01   -3.033725169783850e-01   +5.211213094656408e-02; +4.394877711975264e-01   -3.555392950776510e-01   -2.478908371774973e-02   +3.763435799943285e-01   +7.280754831637832e-01   -4.474540995749897e-01   +4.824145962303300e-01   -2.979748998626938e-01   -8.958129558314921e-02   -5.461588226423851e-01   +1.425081813778096e-01   +9.407944982371123e-01; -2.984129265663224e-01   -1.237056770190173e-01   +1.814036593223755e-01   -4.657774467367002e-01   -6.923606649520931e-01   -2.534562159913205e-01   -4.630217974866146e-02   -1.079474909669583e-01   +6.993777428630077e-01   +5.833746293462320e-01   +5.918554550609606e-01   -6.338483638965456e-01; -1.573050711242246e-01   -3.861078306957234e-02   -3.690907899213478e-01   +1.808488449805559e-01   +1.675461763381760e-01   -1.385287286705430e-01   +2.663701787377643e-02   +1.055934462544089e-01   -2.186473787397898e-01   +2.353625962288241e-01   +5.226676595087538e-01   -5.283578202977937e-01; +8.541597902584430e-01   -1.845902624972610e-02   -4.205917951400484e-01   -4.204645798908664e-01   +2.628080022714224e-01   +2.764583885737009e-01   +8.612205091000247e-03   -1.458728665947140e-02   +6.434491438309204e-01   -1.035386559858202e-01   -4.084446960695368e-01   -6.022285252826767e-01; -1.227948616365787e-01   +4.406304663243786e-01   -3.376540674465896e-01   -3.055657453466293e-01   -3.295393311319476e-01   +4.192167347580921e-01   +9.568757084730796e-01   -4.753449678007158e-01   -5.759453225347000e-01   +2.560961363228185e-01   +6.356191504424550e-01   -1.100767341040402e-01; -3.635317319167982e-01   -1.476307874447557e-01   +7.349032839968147e-01   -1.612967878409066e-01   +3.386906940383095e-01   -9.704305107359149e-01   +8.630237703045824e-01   -2.001540494210824e-01   -2.165162704598236e-01   +3.430107254394881e-01   -7.602810664130366e-02   -3.227034100054653e-01];
L3I_L2I_iGABA_netcon = [+4.453312371037981e-01   +5.368227165266086e-02   -1.519056835420869e-03   +2.102794380551123e-01   -1.911336739775287e-01   +6.807038607295121e-01   +1.831276615862228e-01   -5.019740192844724e-01   +4.389848714446845e-01   -2.853862790753936e-02   -2.908190817918322e-01   +4.961135753381657e-03; -2.576440175426262e-01   +6.615264776262771e-02   -6.062261871273816e-01   +3.405316344080938e-01   +9.546678793795628e-02   +2.503671824157352e-01   +2.689611883373926e-01   -2.691571296919059e-02   -7.237204865189154e-01   -6.226739297940190e-02   +4.756115212024769e-01   +6.362864285158708e-01; +3.104069868113838e-01   +3.740815359767474e-01   -3.432845823058036e-01   -1.004612601143398e-01   -3.907476833910407e-04   -1.176046067719483e-01   +5.513687133489746e-01   +6.321789103893389e-01   +3.185892013502721e-01   -2.656423466642576e-01   +5.723689287772860e-01   -5.126805443151305e-02; +4.928962248964581e-01   +3.407914538916089e-01   +1.907134943244744e-01   +3.188488617811348e-01   +1.718777988754751e-01   -2.224724318825632e-01   +1.055580135682336e-01   -1.384561546848827e-01   +9.604859467233575e-03   +2.760267235022437e-01   +1.090561431667704e-02   -1.639160796356720e-01; -2.231966530986997e-01   +8.357828278850601e-02   +3.618466409579078e-02   -2.888678358443726e-01   -8.822646859068659e-02   -2.437239717331878e-01   -1.000000000000000e+00   -1.094319776201249e-01   -7.259626168414063e-01   -2.722649290396644e-01   +1.542896701231419e-01   -3.684973242265394e-01; +5.028722650788287e-03   -4.641242012565455e-01   +1.132557226404894e-01   +2.134796119495861e-01   +4.073093040728894e-01   -9.493848756675793e-02   -6.239825395398793e-01   +6.808842203711537e-01   +2.536648234116046e-02   -3.136104416329785e-01   -4.480645354107168e-02   -6.258509867848137e-01; +1.602725850446950e-01   +2.834023789868111e-01   -2.119475519892574e-01   +3.109139859031113e-01   -4.210800890018655e-01   +2.880782423993614e-02   +6.425952547852488e-02   +2.583564103176323e-01   -3.292701236476737e-01   -2.088424076912187e-01   +6.747924992751377e-01   +7.706462790895029e-02; +1.251851183718743e-01   -5.938620913409207e-01   -2.716953636557421e-01   -2.385926930167865e-03   -1.233148146066162e-01   +5.772145465547368e-01   +7.281388046907532e-02   -9.930669134192956e-02   +2.675353988228519e-01   -5.123228309431077e-01   +1.631631545526134e-01   -6.442479287475746e-01];
L2E_L3E_iAMPA_netcon = [+3.062393320679350e-02   +1.282069287015669e-01   +2.813282450026417e-01   +4.461184364732179e-02   +1.113118296632100e-01   +3.621137355859031e-01   -5.987666713352379e-01   +1.150123741978506e-01; +5.833961250830589e-01   +1.636686167024031e-01   -3.268683444104254e-04   +2.201361302939381e-01   -5.633061838373090e-01   -1.275380208746953e-01   +5.378632139527605e-01   +2.814114159053712e-01; -1.596542703112852e-01   +3.928587292196694e-01   +2.298921146218151e-01   +2.883844588125201e-01   -3.668045617081021e-02   +6.959864401117394e-01   +3.543840573347105e-01   -3.897744044226611e-01; +3.726590739211536e-03   -5.378263694434843e-02   -6.732579215697235e-02   -5.077787788410481e-03   -1.685889662808103e-01   +1.384850852505139e-02   +7.340785484071568e-01   -4.461365116244941e-02; +1.344198353875273e-01   +9.566276904401771e-02   +4.433273380169541e-01   +3.904532145515649e-01   -6.900096415804869e-01   +3.447108492402052e-01   +1.852191330940210e-01   -1.838569081913691e-02; +4.456976006804167e-01   -7.754932101433688e-02   +4.534860553747454e-01   +1.503867687809965e-01   -4.239614013574440e-01   -2.216491188915082e-01   +3.136400038482506e-01   -7.394028886375558e-01; +4.224724950225771e-01   -5.915115495865600e-01   +7.415479694648492e-01   +2.769960905052666e-01   +6.533796034059962e-01   +4.916844364810646e-01   +6.323895770717569e-02   -3.510747738174110e-01; +4.694856302882923e-01   +5.420269910150032e-01   -2.796216442471840e-01   -7.398542625152879e-01   -2.923229343458153e-01   -1.000000000000000e+00   +4.779231470630055e-01   +5.969175877949825e-01; -1.020709433697436e-01   +3.679625134200286e-01   +4.891171877728253e-01   +1.099437787573816e-01   -3.542525600808296e-01   -1.346787395726150e-01   +2.416250979616471e-01   -1.192468595530060e-01; +2.887561907325202e-01   -6.016708438967198e-01   -4.588800695419164e-02   +6.135913147787009e-01   +2.444363426070910e-01   +2.884227980588388e-01   -7.496661947900849e-01   -7.749295243077010e-02; +3.343353649896978e-01   +2.238374185139279e-01   +2.734135797586227e-01   +6.592223507804503e-01   +2.769753555223047e-02   +2.006335144064313e-01   +2.357258147526231e-01   -1.100106459908408e-01; -1.507098686494797e-01   -1.097066720697556e-01   +6.339545656296101e-02   -1.689022436166582e-01   +5.241461506159344e-01   -1.600752415250807e-01   +6.095118965080336e-01   -8.453827437649390e-01];
L2I_L3I_iGABA_netcon = [-5.770846347884950e-01   -6.844470406394194e-01   -1.000000000000000e+00   +1.457815579422579e-01   +7.066442133324639e-01   +6.032648298217906e-01   +2.854735222408645e-02   +7.169499814775637e-02; +6.935907681737713e-01   +1.262182015251962e-03   -5.819345055329525e-01   -4.014174840936826e-01   +8.095893202784071e-02   +8.532666577186511e-02   +8.197141763382227e-01   -2.379608361846692e-01; -7.685113330903075e-01   -2.408377698176608e-01   -2.726848622895995e-01   +1.995806825760464e-01   -5.703437152911985e-01   +2.447987008204788e-01   -1.745309580980680e-01   -7.185193725547641e-03; +2.455475517027616e-01   -7.502766884354507e-02   +1.059452781145749e-01   -6.463472880163920e-02   -4.725196160630593e-01   +1.532971306962224e-01   -7.234537687586041e-02   +3.088978439292171e-01; +1.543025971070631e-01   -6.011346925723302e-01   +2.281607595753329e-01   -6.572963906761366e-02   +9.552779915460033e-01   +2.964704695938240e-01   -1.331553961488648e-01   -3.147522470199534e-02; +4.600405560000231e-01   +4.491451658049842e-01   -5.838121366380424e-01   +5.064635977299200e-01   -3.963253045090974e-01   +1.160565441829879e-01   -3.166455228021298e-01   -2.980527928802124e-01; -3.409472433735998e-01   -4.499735628272872e-02   +4.796821894940226e-01   +5.471387262130274e-01   +8.192024759041304e-02   -2.236196253778584e-01   -7.508171635988486e-02   +3.321473469652920e-02; -1.386108045474556e-01   +2.337659206216579e-01   +2.047996585245735e-01   -4.384243646960885e-01   -1.209269606532645e-01   +2.718380320067726e-01   -3.906659030911282e-01   -3.705239177233732e-01; +4.576418144474021e-01   +5.051996347312411e-01   -2.441409622681583e-01   -9.293072673074686e-01   -3.153954900085623e-01   -1.282220825280767e-01   -7.270886154020537e-02   +1.225088164528430e-01; -3.779215584561555e-01   -2.363429509877461e-02   +6.474370645585681e-01   +2.071812018915474e-01   +1.228407393978621e-01   +5.784633044583653e-03   -5.996439099842397e-01   +3.789815380886245e-02; +2.240899681388257e-01   +6.021531305734051e-02   +4.642470743242674e-02   +3.821613757857302e-01   +1.168335352153859e-01   -1.515742950106290e-01   +8.149354466389322e-02   +4.933886878799759e-01; -6.592342937011859e-02   +3.226965483237484e-01   +3.241195002231690e-01   -1.373953665449996e-01   -2.556327395211456e-01   +5.071901487003110e-01   -6.765914690749090e-01   -4.911472160724694e-01];
L3I_L3E_iAMPA_netcon = [+4.574937536770048e-01   +9.927339633270367e-01   +1.545234196450513e-01   -1.368152868616466e-01   +2.536666285752760e-01   +5.134732053359539e-02   -4.829563185335147e-01   +7.545186715137894e-01   -1.007078160156960e-01   +6.311658662189144e-01   -5.243621863335729e-03   -2.990827245439219e-01; +3.688092711629347e-01   +4.362651637836962e-01   -4.937422169866379e-01   +3.113154839781177e-01   +1.210142169803005e-01   -1.851698168148605e-01   +5.192012276191960e-01   +6.460407427553793e-01   +3.838662860735447e-01   -2.948141277277095e-01   +3.005119628258923e-01   -9.925436146027904e-02; -2.269602075950814e-01   +3.248383204903590e-01   -1.481944752441006e-02   -2.811154764360403e-01   +2.933154630464431e-01   -2.304509337196147e-01   -1.162987010072072e-01   +6.481616446357943e-01   -6.086303639870633e-01   +2.155640442984946e-02   +1.075227417614700e-01   +3.594440124089459e-01; +2.365684415089178e-01   +2.470106194922889e-01   +1.540338669663699e-01   +3.350259224943340e-01   +1.964839839184773e-01   +7.337188257774253e-01   -1.000000000000000e+00   +2.450994625964520e-01   -4.414755817203917e-02   +5.715572103269756e-01   -1.490551686448655e-01   -2.608641563348694e-01; +1.220918845849951e-01   +9.736682558503633e-01   +6.254065372981432e-01   -3.393123911969428e-01   +3.228811058448582e-01   +3.940672127525686e-02   +1.577828992514791e-01   -3.517294584683532e-01   -1.118754667572639e-01   -8.212046941195643e-01   -2.087483421126666e-01   +6.365536871228486e-02; +5.063292731055232e-01   -2.901335476607847e-01   -1.496331755622212e-01   +1.351359456753833e-01   +2.984590145204133e-01   +3.886855410988495e-01   -4.492878732716745e-01   -5.709241025079115e-02   -1.403514206864431e-01   -1.190508791666787e-01   -4.066722247745219e-01   +5.340671878916788e-01; +7.318103146271753e-01   -4.291053402949269e-02   -8.948701423248802e-01   +1.795315302521048e-01   +6.745620852803478e-01   +4.001934762609147e-01   +8.275618012986476e-02   -5.612082362103243e-01   -9.834034882493954e-02   +3.290764119233816e-01   -1.811136986057495e-01   -2.111746943839875e-01; -7.133351209413769e-01   +3.106494998505480e-01   -6.762382612761035e-01   -4.576046616673365e-01   -1.246403497816716e-01   -4.397390912274267e-01   +3.051334205032541e-01   -2.471766223361132e-01   +3.347097506381640e-01   +2.211538637800384e-01   -4.436530797888547e-01   -8.116570701481923e-02; +2.125478748047255e-01   -5.759371794417494e-01   +2.293616752345889e-02   -2.483460745200887e-01   -6.304606604790319e-01   +6.281875479600049e-02   -7.478097008291414e-01   +2.443784919009593e-01   +7.913600456742175e-01   -4.439189494619786e-02   +1.258360456324052e-01   -9.345255321258477e-01; -6.788860649178536e-01   +1.484633120033390e-01   +3.937611752843214e-01   +8.046208308985511e-01   +1.509608169705290e-01   -3.805430115791655e-02   -4.827164258120539e-01   +3.057850579920200e-01   -1.091038372586264e-03   -4.324881084325302e-01   +1.705344518677880e-01   +2.193302879561566e-01; -1.816265095046902e-01   -3.443187950537105e-02   +1.765974479128461e-01   +1.592821548261853e-01   -5.608264614886029e-01   +7.820392844771246e-02   +6.329678632278650e-01   +1.144569624069871e-02   -1.438547840067373e-01   +1.757696665415387e-01   +2.231650769465180e-01   -4.482846657139894e-01; -7.764570192885856e-01   +7.714108327711757e-01   -5.529673349315233e-02   -4.966257785658758e-01   +7.495072241633688e-01   +3.266935312845973e-01   -6.243360588755386e-01   -2.473749759510395e-01   +6.604750182142149e-01   -4.761460705515579e-02   -4.302635490773780e-01   +8.341089506281621e-01];
L3E_L3I_iGABA_netcon = [+4.656184140462058e-01   +3.873919204758405e-01   -3.008318714282912e-02   -2.056421633663214e-01   -2.628509766612275e-01   +3.429725664196619e-01   -2.793576229151688e-01   -4.707437312194230e-01   -1.000000000000000e+00   -7.041519405725048e-03   -4.756228764830466e-01   +3.349257512600661e-01; -1.871903479799776e-01   -2.623459844606144e-01   +3.603964623156993e-01   -9.870708716345384e-01   +5.085503173447758e-01   -4.342058586509318e-01   -6.495858985844144e-01   -4.424641091477012e-01   -5.202746407978895e-01   +4.532382814994400e-01   +4.085552436500733e-01   +9.224073956914778e-01; -6.112693647374097e-01   +1.088215482032072e-01   -1.035117040535433e-01   +1.566510705663739e-01   +1.487147115167551e-01   -1.329133447025949e-01   +2.795600148340704e-01   +4.111565680370535e-02   -3.094567680575857e-01   +3.174411654125882e-01   +1.223468046044784e-01   +1.949365724081220e-01; -8.780176015775779e-01   +1.227495952314980e-02   +5.488620655358821e-01   -4.478809561904649e-01   +6.604336891607410e-02   -1.503521452747998e-01   +5.090317039956399e-01   +6.447880910156645e-01   -1.505815749924822e-01   -4.784188602615732e-01   -4.238001919866684e-01   -3.748039202862552e-01; +3.155794542639655e-01   +5.902181164007254e-02   +5.068704817177681e-02   -9.409014356762632e-02   -2.438345963928763e-01   -3.431452254813963e-01   -1.948199493225253e-02   +2.719158825790114e-01   +6.118019292834972e-01   +5.107806043179675e-02   -3.826729823743984e-01   -5.227992163313119e-01; -1.721960867079108e-01   +1.350878674095468e-01   +3.444598898091010e-01   -5.157219888209665e-01   +4.499474154054720e-02   -7.095866479676038e-02   +3.236626960468304e-01   +3.132037146768265e-01   -2.739131198281032e-01   -2.623430654659605e-02   -5.526713952092015e-01   -4.385193159268100e-01; -1.257872777250795e-01   +8.346588464253183e-01   +3.456310874914887e-01   -4.545583427436463e-02   -9.221148857877540e-02   +3.785962256644401e-01   -2.115951981893545e-02   -1.567073437329261e-01   -5.460319174426623e-02   +5.296358557112754e-02   -3.402091050538578e-01   -2.345787061955699e-01; +7.311192598987908e-02   -4.269579880478347e-01   +7.269437163409508e-01   +1.057220649883106e-01   -5.511246501838516e-01   +2.956267320161838e-01   +2.166112727918455e-01   -4.095339636799940e-01   +4.316009645749631e-01   -1.788818962219530e-01   -7.075576303849026e-01   -1.066999697392787e-01; +8.907298198866845e-02   -3.566716513953483e-01   +1.823550613161986e-01   -4.302466558908907e-01   -1.849172912485127e-01   +6.538848300221635e-01   -2.989946037787723e-01   -9.315689547637523e-02   -8.414661918361672e-02   +7.734185132717192e-01   +4.973046727344750e-01   +7.782225863630929e-02; -1.413916893473482e-01   +5.402256374454339e-02   -3.534517524792914e-02   -5.504834573920370e-01   +2.318152570302655e-01   -3.182353594598262e-02   +3.057041117145312e-01   +2.860434259359548e-01   +3.345148961698934e-01   +6.832294075715966e-01   -2.675620860423940e-02   -1.453644238188654e-01; -3.856364511230649e-01   -5.010709038798731e-01   -1.474441367335955e-01   +8.490906481711510e-02   -6.494041369767520e-01   +1.798591629378475e-01   +1.472114392357077e-01   +4.051672245195930e-01   +6.748787657964687e-01   +7.772761842932517e-02   -3.680906527185178e-01   +5.088365525439538e-01; -5.570823730074768e-01   -3.970669202481346e-01   +3.118077806498427e-01   -5.820360059545551e-01   +2.189500311277190e-01   +5.129299628095741e-01   -1.094844138738053e-01   +3.675508676210392e-01   +9.807853829598887e-02   +3.470121168285693e-01   -6.280146222017823e-02   -3.599552533652542e-01];
L2E_Input1_iAMPA_netcon = [+4.576244001367417e-01   -3.196204998651717e-01   -2.050626608897064e-01   +8.908544484748604e-02   +2.032122688785155e-01   -5.847454559784565e-01   -1.162417098188493e-01   -7.141153216897784e-01];
L2I_Input2_iAMPA_netcon = [+5.620792799261592e-02   +2.132757441286364e-01   +5.389508204748265e-01   +2.154091979618050e-01   -1.004807719554560e-02   -1.775887522468848e-01   +5.828478570166292e-01   -2.007600147802585e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 100*(sin(2*t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 100*(sin(2*t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
