function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+6.318351913663862e-01   +4.895903082949759e-01   +6.562815813192928e-01   +1.638383671018808e-01   +3.874021612463699e-01   +9.072159551490085e-01   +8.347023964384896e-01   -1.263410021648901e-01   -9.461570319497076e-02   +1.751763903076604e-01   +5.345154529715669e-01   +6.618629013552599e-01   +4.517175398646255e-01   +3.862986133912620e-01   +8.620388901017220e-01   +5.145626957950571e-01; +4.185354156429354e-01   +1.377003315583304e-01   +4.810074593510627e-01   +3.558428469645978e-01   +3.908314499677903e-01   +1.763330664339175e-01   +3.020077312535617e-01   +5.548925939750422e-01   +1.555137589886611e-01   +7.387482199300112e-01   +4.795834609145900e-01   +8.038651097298262e-01   +8.872184194980204e-01   +2.490298035892319e-01   +7.253513912453703e-01   +4.932171221709255e-01; +1.143990559372110e-01   +3.590633439317110e-01   +7.372766528533724e-01   +7.784006312401839e-01   +7.994128000525667e-01   +2.732678562587268e-01   +2.822031379908883e-01   +5.812119593435718e-01   +2.845028470933753e-01   +9.982288704548106e-03   +5.149106821604235e-01   +8.430265449922352e-01   -3.144254516012292e-02   +2.392316599127418e-01   +7.102167317467989e-01   +1.512381431163577e-01; +4.597509410837733e-01   +8.344416046806056e-01   +6.748181195542607e-01   +7.879817268322733e-01   +1.708948237595641e-01   +5.041378613232261e-01   +8.846283753253277e-01   +5.223954966251825e-01   +8.046296669791283e-01   +4.563704204372729e-01   -2.826194363366103e-02   +5.319789870039354e-01   +5.414405554408711e-01   +8.549375869595388e-01   -9.810494251187564e-02   +4.622448841077160e-01; +3.244080976206780e-01   +7.467419777837848e-01   +2.733798053515244e-01   +3.141386713858367e-01   +3.366129771008249e-01   +2.008884505875187e-01   +4.649513879279784e-01   +5.095405745940094e-01   +7.932518390929367e-01   +3.031113412188593e-01   +5.909122361462089e-01   +5.579142691328121e-01   +2.156793864302839e-01   +5.995231557269435e-01   +5.638630319493483e-01   +3.376719180274542e-01; +8.626393924017853e-01   +8.510775319734403e-01   +5.008976706372518e-01   +2.971130661021685e-01   +1.751429611004009e-01   +7.023579354028660e-01   +7.681658260667807e-01   +2.419160024308874e-01   +1.953786761685817e-01   +6.825454174050692e-01   +2.863910311230619e-01   +7.175068567445173e-01   +6.021952125864202e-01   +6.034974501973662e-01   +8.653173248522847e-01   -6.576257046366139e-02; +6.284176041304499e-01   +6.980544328652938e-01   +5.105904656180763e-01   +4.601755141330275e-01   +5.869343880413262e-01   +3.454010585942882e-01   +6.269581438608626e-01   +1.331960421952248e-02   +7.049406844077118e-02   +1.927545575924181e-01   +4.761316802398814e-01   +3.767451079058277e-01   +8.216574573678261e-01   +4.424248578065196e-01   +7.326952031454336e-01   +2.079024720871017e-01; +5.313646625510011e-01   +5.166237434457581e-01   +1.774075982344123e-01   +1.848547334460698e-01   +4.044060370635638e-01   +2.740556750659730e-01   +5.542478862399816e-01   +3.111988686347937e-01   +1.562908086871270e-01   +2.193996121605807e-01   +4.731394895363438e-01   +4.443218860700366e-01   +3.284755161701070e-02   +6.176802863369009e-01   +3.167674079600767e-01   +5.842690365033108e-02; +7.139331407098296e-01   +3.256829298015023e-01   +7.307996076668971e-01   +1.478329106566127e-01   +6.787229219364471e-01   +5.380707903934707e-01   +7.934888419436974e-02   +3.762308894989344e-01   +4.759438880076943e-01   +2.962167369636038e-01   +4.689993276966776e-01   +7.189589096826167e-01   +7.578855551258845e-01   +7.237830942056971e-01   +5.870671770397686e-01   +6.937564310037316e-01; +9.596600979763151e-02   +7.395467718029808e-01   +5.371687883959126e-01   +3.706593091237972e-01   +6.261280569402586e-01   +8.852345373376078e-01   +5.367228465069158e-01   +4.695371269480501e-01   +2.822715150652026e-01   +1.669987710584818e-01   +3.232118127565622e-01   +4.859186965746959e-01   +2.559427151550433e-01   -3.275605269018539e-02   +4.098159590918141e-01   +4.104844773285438e-01; +2.937368687102485e-01   +8.116139301545171e-02   +3.604211981410056e-01   +4.362503478786713e-01   +7.070744462990033e-01   +7.449268456598607e-01   +8.165822444381556e-01   +3.543805215932326e-01   +8.752501970712994e-01   +3.371337302993068e-01   +6.321267332140992e-01   +4.775338148940742e-01   +1.463323257706066e-01   +1.432219684056248e-01   +6.689562783082789e-01   +2.172634556928530e-01; +4.725059613953402e-01   +1.024767181641745e-02   +3.424755286954855e-01   +3.871227734311021e-01   +2.540692944470666e-01   +6.846113225136563e-01   +3.942790736431250e-01   +8.714926798678885e-01   +6.931790119087985e-01   +8.516353570266944e-01   +4.104500610580858e-01   +8.025843558848955e-01   +5.207429842467555e-01   +3.911253015539061e-01   +7.039813458420120e-01   +6.905056020459084e-01; -3.610994169837842e-02   +1.942364771246634e-01   +7.955695038276920e-01   +4.000386326233870e-01   +2.628094211117318e-02   +7.303814208204723e-01   +6.185398727175984e-01   +6.121982430692533e-01   +8.208939499216146e-01   +9.099414667840915e-01   +2.793220740370293e-01   +6.408745848554568e-01   +7.509942772989764e-01   +5.051208231198302e-01   +8.497633973449903e-01   +3.694726201582322e-01; +2.532923218252368e-02   +8.305821036200229e-01   +5.329115447909162e-01   +1.144393174660443e-01   +4.041612315578432e-01   +5.970886803027280e-01   +5.994623703607436e-01   +7.646911850643117e-01   +1.286347983663900e-01   +7.724134450303171e-01   +6.604514835412966e-01   +3.485504883531124e-01   +7.309561510712084e-01   +5.660402680363443e-01   +1.931014015353294e-01   +7.261930297431762e-01; +1.122124555257712e-01   +3.536066474755658e-01   +8.048951543991866e-01   -2.533997499149546e-02   +2.061065766561381e-01   +3.336402006710357e-01   +8.578401591272924e-01   +6.692228133636254e-01   +8.977638140321237e-02   +9.859635770939520e-01   +2.514868803067351e-01   +2.094954173731001e-01   +3.406400178533063e-01   +1.159885833165963e-01   +4.517121520336096e-01   +5.305016869973476e-01; +5.347623663337526e-01   +7.551437081902725e-01   +7.047769861948190e-01   +6.887271691541892e-01   +7.518751533013347e-01   +5.130644817975289e-01   +2.691781924690109e-01   +6.318673687509428e-01   +6.363171225167199e-01   +8.339682012359010e-01   +1.411601275935938e-01   +4.588827379964002e-01   +3.830454419306201e-01   +7.803707946726068e-01   +6.369492469968174e-01   +7.548052061653771e-01];
L1E_L1I_iGABA_netcon = [+3.898522441628705e-01   +1.582487303023472e-01   +1.163368905271575e-01   +3.691954371711672e-01   +3.111945663021063e-01   +4.227549850184545e-01   -1.527941570504771e-02   +3.810901487685026e-01   +5.352438281177387e-01   +2.535488645643603e-01   +6.069158923068773e-01   +5.390914979576988e-01   +6.931065204587496e-02   +5.428699530417164e-01   +5.225106015033080e-01   +1.498628517997853e-01; +2.564812364052820e-01   -4.705787040106065e-03   +6.790987472207307e-01   +4.532840958126345e-01   +3.859847391845034e-01   +2.867444324070998e-01   +5.457574369664576e-01   +3.879998191200393e-01   +1.955568969406317e-01   +3.269046674310633e-01   +2.170602316650088e-01   +3.465632559326786e-01   -1.468942795520818e-02   +7.505813900838852e-02   +5.167623774012330e-01   +3.110768245468448e-01; +5.972263719973637e-01   -1.042641493494023e-02   +5.739083349576779e-01   +6.877606478372829e-01   +6.285223801632326e-01   +4.427116511178490e-01   +4.295221931859455e-01   +6.045483093135802e-01   +2.688505206274672e-01   +2.422698161837678e-01   +4.621468474983029e-01   +2.397494756729520e-01   +9.545387349818473e-01   +4.971230674072447e-01   -9.304105169282366e-02   +6.618655554275052e-01; +1.939649716477801e-02   +7.537358474847757e-01   +5.519864167642424e-01   +2.369730299110686e-01   +6.590440953062814e-01   +6.036702574114997e-01   +6.304613107778115e-02   +4.856737861382894e-01   +1.444723783150229e-01   +8.626836355656359e-03   -1.484733430917063e-02   +3.383441340456222e-01   +1.860401756581720e-01   +4.075200929534448e-01   +2.239115293187249e-01   +5.997670216998554e-01; +1.938492677994097e-01   +1.932336543445349e-01   +5.085406229826141e-02   +3.752762835037852e-01   +2.455331501517208e-01   +5.574976318968843e-01   -3.806539783059263e-02   +1.411772357061139e-01   +1.697544704287373e-01   +1.106642148285368e-01   +5.640973527308291e-02   +7.588634473843050e-01   +2.946014959680697e-01   -6.051797172387818e-03   +5.887544583908446e-01   +8.520682697896559e-01; +4.113273437967420e-01   +9.951339850766146e-02   +8.357836503171547e-02   +1.207916561905139e-01   +5.279445373359774e-02   +4.732688565481627e-01   +7.864604677744010e-02   +7.110315561956502e-01   +4.759514293296209e-01   +8.235309732014732e-01   +7.138831306296343e-01   +7.841223067754535e-01   +5.122044206682433e-01   +4.467727872001654e-01   +5.386064201481439e-02   +3.632676298338082e-01; +6.455279389779447e-01   +5.808046099580878e-02   -7.132224545031915e-02   +1.163290217004044e-01   +6.595556828450673e-01   +5.439678994988828e-01   +6.622874045004087e-01   +4.399640271038849e-02   +2.131071862487334e-01   +8.198131081159477e-01   +1.432818842494419e-01   +4.970362492519243e-01   +4.670208838317926e-01   +4.940911083763032e-01   +3.091056503309810e-01   +1.580716903359671e-01; +4.322793442663119e-01   +2.144873024623761e-01   +5.840362564106749e-01   +1.000000000000000e+00   +1.980330040520774e-01   +4.901227084068259e-01   +1.838184182215695e-01   +7.220785490182062e-01   +3.422013279120097e-01   +2.959709411749116e-01   +9.179982603453953e-02   +7.601103874370229e-01   +5.585764259401136e-01   +2.304527333936922e-01   -1.465649832938090e-02   +6.567742795088236e-01; +2.973075580232786e-02   +7.494577713410283e-01   +4.638608004879599e-01   +2.138248833211112e-02   +6.906796734338537e-01   +3.716801784449161e-01   +3.786970882483395e-01   +3.684533380386457e-01   +1.672337932247705e-01   +9.054459331354681e-01   -5.877937108561702e-02   +8.070098570957086e-01   +1.782502288626490e-01   +2.106182750837230e-01   +1.631233851189736e-01   +4.350293057189093e-01; +1.967540467602676e-01   +5.079990569299628e-01   -6.819938073376031e-02   +1.285706177665675e-01   +6.608639888734130e-01   -1.608353682577723e-02   +5.287353102109100e-01   +8.242785603930756e-01   +1.255212436539486e-01   +7.258240739822363e-01   +2.458030093569999e-01   +7.610330401521639e-01   +2.747677420889746e-01   +3.146645520356025e-01   +3.615605127799619e-01   +9.035720139306517e-01; +7.921523033899481e-01   +5.437955899486056e-01   +6.512023693567152e-01   +7.028047185124072e-01   +7.407592334998706e-01   +4.837877675798402e-01   +8.909956051518496e-02   +4.479913749757345e-02   +4.712892233358071e-01   +7.581100929465391e-02   +5.146407857389910e-01   +4.338972947613460e-01   +2.443700984750961e-01   +9.028443097139786e-01   -1.865706950781924e-01   +6.373646590939887e-01; +1.147801613657669e-01   +5.805936722990144e-01   +5.280496343138601e-01   +7.659468281021695e-01   +1.269887141224437e-01   +2.758888528596563e-01   +3.581869024480986e-01   +4.030744670384973e-01   +8.521238082822430e-01   +4.028937318521270e-01   +6.197009350629330e-01   +7.778222608877013e-01   +2.634383822585307e-01   +7.233015373058442e-01   +6.393354740920552e-01   +4.524135949845939e-01; -4.040801195651538e-02   +5.142169860095245e-01   +5.828919760742673e-02   +5.435525717106044e-01   +1.560319386501653e-01   +5.965977666343186e-01   +4.390100616953768e-01   +4.951720821523105e-01   +4.354627375131492e-01   +5.701101513389776e-01   +3.403945943548202e-01   +5.108393464938622e-02   +3.112718779674163e-01   +1.099781691917355e-01   +2.485903295492645e-01   +7.394778028202506e-01; +8.067442323204327e-01   +2.479866811278588e-03   +6.149456080049495e-01   +5.490802387936452e-01   +4.763774644376856e-01   -6.662523359039849e-03   +3.117271137117889e-01   +1.347112791134688e-01   +5.600700970584802e-01   +6.131115467650202e-02   +4.455308928944896e-01   +5.887477196747278e-01   +5.139694783558758e-01   +8.082271660564122e-01   +5.718799042519343e-03   +2.662535375079253e-01; +1.846513917592904e-01   +4.254859983440039e-01   -7.177743820018494e-03   +1.208838254876199e-01   +5.754533267059881e-01   +4.128348703358269e-01   +7.593316796467754e-01   +7.203394992686224e-01   +7.441385532116670e-01   +6.809161006834838e-01   +6.318330384460935e-01   +4.641208212762338e-01   +2.827323870227945e-01   +9.287941849619354e-02   +2.613446998332275e-01   +2.909708204375352e-01; +4.389046249483431e-01   +1.925089571271756e-01   +5.307286752184938e-01   -1.413985221512108e-02   +5.158642065698942e-01   +7.593104836862906e-01   +4.895147793437024e-01   +1.177461636756469e-01   +6.796266486911964e-01   +8.463083979622710e-01   +6.306020537367726e-01   +6.256146285014496e-01   +5.592269116060604e-01   +2.120246644090089e-01   +2.255938734556131e-02   +4.193147380026381e-02];
L2I_L1I_iGABA_netcon = [-3.280194118879620e-02   +5.980500274639905e-01   +6.766554029399815e-01   +5.890577948860446e-02   +5.746820883958890e-01   +2.359417289915325e-01   +6.002796492693946e-01   +6.297653374929879e-01; +9.734717287724018e-02   +2.609783324635542e-01   +3.350372689949129e-01   +2.167544794142147e-01   +8.111071657279904e-01   +1.619652026112048e-01   +5.777356541435480e-01   +8.114847301781366e-01; +6.450343485597927e-02   +6.245528338906415e-01   +5.368767727720712e-01   +4.478590515815619e-01   +4.539712228319236e-01   +3.561389595763689e-01   +2.524329758305229e-01   +1.229692790061830e-01; +4.978099167362510e-01   +3.820966234842576e-01   +5.236002341728037e-01   +8.240888443406083e-01   +2.408831638505833e-01   -4.555619530419166e-02   +3.128020679590558e-01   +1.175418707061054e-01; +8.615572662877682e-01   +1.036158450044914e-01   +3.333988286680446e-01   -3.168936612149157e-02   +5.709035312380779e-01   +1.915361689191188e-01   +1.000000000000000e+00   +2.398854040372849e-01; +4.531986058236381e-01   +4.800392078796140e-01   +6.555693650268249e-01   +7.514715331127416e-01   +8.599466961710105e-01   +6.669778440706589e-01   +2.574130798677987e-01   +5.846675601994503e-01; +8.350773830128081e-01   +1.656288359469741e-01   +4.078899685704326e-01   +1.711342445735438e-01   +5.283380411492273e-01   +3.285951191584754e-01   -4.075929483693769e-02   +5.590762256474693e-01; +6.078407636249468e-01   +4.050647977773250e-01   +4.384132410308061e-02   +7.284316272365111e-01   +6.665430256028839e-01   +8.073368699666188e-01   +4.758498937926682e-01   +3.709450766388494e-01; -6.175372858334480e-02   +5.523280959022056e-01   +3.475418879024637e-02   +3.769301820373102e-01   +3.662349906615017e-01   +6.334514304983426e-01   +5.044268630698086e-01   +1.799602071166007e-01; +6.314244497052223e-01   +8.522018537406090e-01   +3.708113812991599e-01   +6.087652974216732e-01   +1.336927483656079e-01   +1.376568181477214e-01   +4.196034992514459e-01   +2.672181878704062e-01; +3.632120770257118e-01   +1.732423618152839e-01   +5.859994582143035e-01   +5.826445212938347e-01   +4.817062821490592e-02   +5.488889294710279e-02   +3.884305758143680e-01   +1.300446454453715e-01; +2.021248982682107e-01   +2.121381725638428e-01   +2.843001484856099e-01   +5.769108631124441e-01   +1.717034102035057e-01   +4.315848881687556e-01   +2.651244699884120e-01   +1.103178858058055e-01; +7.250778439119386e-01   +7.063656099005697e-01   +1.915729467028557e-01   +5.735326837803710e-01   +3.154514117000478e-01   +1.868395132483572e-01   +7.388243669500140e-02   +6.651610821952896e-01; +4.201932172461788e-01   +7.447724047235027e-01   +6.622695597388878e-02   +2.647347927317787e-01   +4.053566510140337e-01   +6.170859207721784e-01   +4.918135818689722e-01   +5.888635635438230e-01; +3.265598748655910e-01   +3.263799335221156e-01   +3.687789325151636e-01   +2.103529994143088e-01   +5.476035488766047e-01   +1.921613946564917e-01   +5.870421707301454e-02   +3.558498563363339e-01; -5.193019696780051e-02   +2.434419963638607e-01   +2.748501105106572e-01   +4.729788799670431e-02   +5.335699294932068e-01   +6.837783178148545e-01   +2.744720936313506e-01   +3.295319395959437e-01];
L1I_L2I_iGABA_netcon = [+6.939099995531661e-02   +6.615825480601384e-01   +2.090754451591923e-01   +2.127017133800034e-01   +8.006918756120197e-01   +8.027426279288054e-01   -1.240654859768589e-01   +1.851333114183857e-01   +3.358033992535784e-02   +6.931114277621576e-01   +7.214046293304488e-01   +3.754729207189566e-01   -1.351523191844275e-01   +2.737828741204173e-01   +1.013832679730803e-01   +7.703814839358623e-01; +8.687586237088163e-01   +5.635952327080240e-01   +4.528633434254608e-01   +4.133692004334195e-01   +1.577820517821643e-02   +2.614503302755855e-01   +6.014939790573137e-01   -1.204448849282164e-01   +3.627293542004140e-01   +2.261252934092310e-01   +4.264147551779171e-01   +1.255632820072553e-01   +5.651255244509414e-01   +6.158544345181164e-01   +1.000000000000000e+00   +8.603311520411533e-02; +4.478420598683657e-01   +4.508042290309059e-01   +8.391354246175381e-01   +4.943327859273762e-01   +9.318304905655499e-02   -7.464363930350743e-02   +7.189020288640172e-01   +5.173766754499295e-01   -1.425249198824226e-01   +6.457583505433003e-01   +2.084398179268795e-01   +4.182858761550212e-01   +8.544102798468610e-01   +6.756070490122582e-01   +1.932421770193781e-01   +2.353222478931999e-01; +7.336075437184535e-01   +5.286985004609850e-01   +5.203841028380851e-01   +3.791390434121286e-01   +7.733100447492015e-01   +5.246422278035094e-01   +4.834644165150685e-01   +1.565920844659138e-01   +5.268125909958536e-01   +3.410028960214296e-01   +3.387904377206264e-01   +3.793263604821641e-01   +3.416910656561966e-01   -1.965578591924408e-01   +4.193110965459849e-02   +4.609931269183533e-01; +8.521271819206748e-01   +4.671519543196995e-01   +1.609885512417440e-03   +8.485266152132466e-01   +5.760513661749964e-01   +3.185960537167446e-01   +6.058174889807095e-01   +1.661499999865945e-01   +7.872084050795947e-01   +4.908055184980637e-01   +7.316961881563239e-01   +7.824210828455577e-01   +9.039257074404735e-01   -3.726661214174549e-02   +5.985843579361522e-01   +7.637222340881418e-01; +3.284248011664224e-01   +2.953019970007198e-01   +8.293949045722818e-01   +1.345218192722021e-01   +1.694884836928638e-01   +4.914013607720621e-01   +5.921988701263710e-01   +6.965948310430891e-01   +5.189471290427785e-01   +5.460411461688635e-01   +8.309461152069952e-01   +7.204527487725948e-01   +5.004406287118638e-01   +8.411942369698042e-02   +2.725491563067885e-01   +9.156665888858379e-01; +3.627418749793350e-01   +2.105485545267928e-02   +1.106274111363617e-01   +7.923111969630534e-01   +4.623880694858470e-01   +5.473976969756429e-01   +3.027612871613756e-01   +3.873623490357956e-01   +2.163522187769336e-01   +2.367913917370967e-01   +4.226556654038572e-01   +7.083907025414962e-02   +6.064829462389884e-01   +4.950518375761365e-01   +6.624053829114365e-01   +1.284380328737709e-01; +4.964145832401787e-01   +6.833669060735632e-01   +7.031036592378516e-01   +2.944477151185049e-01   +6.173994807794443e-01   +1.980967958950558e-01   +2.513143532990966e-02   +6.291903484082479e-01   +6.768698965535438e-01   +2.979258998129742e-01   +1.875702778427411e-01   +7.611640565330318e-01   +4.355238934745582e-01   +8.012062034846466e-01   +2.662066368142309e-01   +4.013301283589502e-01];
L2E_L1E_iAMPA_netcon = [+2.892300106485119e-01   +5.294592574865784e-01   +7.098657026962690e-01   +5.114474635475964e-01   +3.558087426430696e-01   +6.674669735562193e-01   +6.846304139245390e-01   -5.496070165285787e-03; +3.056476028223303e-01   +2.785766530418825e-01   +1.726449502030770e-01   +1.852458455792749e-01   +4.006205527955541e-01   +5.185634387519037e-01   +7.055204330048331e-01   +1.740355668059369e-01; +2.149446512851383e-01   +4.502810914405012e-02   +9.388783520297861e-01   +4.059187166172752e-01   +3.978961959429725e-01   +3.711984530451765e-01   -1.252047724921163e-01   +3.972082325520943e-01; +8.299565233194357e-02   +1.726491229792178e-01   +8.659063462535487e-01   +1.580305125511529e-01   +4.012681813357674e-01   +8.285711495027230e-01   +2.621291078493045e-01   +4.144493868976445e-01; +6.165050997204231e-01   +7.333724432657315e-02   +5.918035410551169e-01   +6.880245754209002e-01   +2.503366036185845e-01   +6.132187422691117e-01   +5.884683899550884e-01   +7.459987512470663e-01; +7.479271708731748e-01   +4.443942103780653e-01   +6.438967088786446e-01   +5.038393388117313e-01   +2.481521102550467e-01   +8.309457305098776e-01   +6.374717251097182e-01   +9.733799253256628e-01; +9.004886094175391e-01   +8.233962142501479e-01   +8.321240308902274e-01   +1.617162196341971e-01   +4.005649572748816e-02   -1.140940795196331e-01   +8.251108190328983e-01   +7.780517221955646e-01; +6.447578809359810e-01   +9.936749326876515e-01   +5.842962191585431e-01   +4.634365631996311e-01   +4.612109986397576e-01   +6.859944539725069e-01   +7.099191534159569e-01   +5.693823800010650e-01; +1.091853618753256e-01   +3.566023255909327e-01   +5.795014295870478e-01   +5.173278082937203e-01   -4.315028503283050e-02   +6.125820493113646e-01   +6.324578931326655e-01   +1.000000000000000e+00; +1.851975598398538e-01   +1.416062590994553e-01   +3.992304844657162e-01   +2.262249413100751e-01   +6.447190547964452e-01   +2.310477592649715e-01   +4.010450598752704e-01   +6.540235236630166e-01; +5.967059392806837e-01   +8.433557855232501e-01   +4.269555488060646e-01   +1.154761071853555e-01   +2.592571518295188e-01   +7.630555084991837e-01   +7.803464425869826e-03   -1.845763733118349e-02; -9.831293916589266e-02   +5.206713467517351e-01   +7.783890942757470e-01   +1.793083078824966e-01   +2.082551128233493e-01   -7.671255137538911e-03   +6.498106005258003e-01   +4.898842104159391e-01; +2.722869305042668e-01   +6.957681143953670e-01   +9.698248697353691e-01   +1.238340272752192e-01   +3.880095684572312e-01   +1.542953483571944e-01   +7.188668711444113e-02   +7.678163620898123e-01; +2.914597349525943e-01   +2.729156381697692e-02   +3.635776707732066e-01   +6.991301240378990e-01   +6.511974173310131e-01   +7.110687063395343e-01   +2.000966219798391e-01   +1.238455091378654e-01; +6.145633079682409e-01   +5.903134681080506e-01   +2.982649544454112e-01   +7.248221867557231e-01   +6.454794168300324e-01   +3.742605546414798e-01   +5.389650965810854e-01   +7.254700755843565e-01; +3.435328069046848e-01   +6.129189594220480e-01   +7.574636244366162e-02   +6.023767780569601e-01   +1.343405181291311e-01   +4.892657514283064e-01   +4.099393179497164e-01   +2.976618399619320e-01];
L1E_L2E_iAMPA_netcon = [+6.758203202470376e-01   +4.936515378694097e-01   +4.506213342171913e-02   +4.798641549029791e-01   +8.843277304748765e-01   +1.660769393470045e-01   +3.535218548586148e-01   +7.636829537833393e-01   +5.985912262896018e-02   +2.992928164292372e-01   +4.960572925810188e-01   +8.325765230335826e-01   +1.080128669790869e-01   +4.823696637597639e-02   +7.722575928403153e-01   +2.513146036674420e-01; +1.049211317731805e-01   +1.338250357476863e-01   +4.831301301499926e-01   +1.860621982045436e-01   +3.058987024270216e-01   -4.062261405936358e-03   +3.213383981969560e-01   +2.355333951903269e-01   +5.391026844589089e-01   +1.000000000000000e+00   +4.858267392883653e-01   +1.081778790842301e-01   +8.817962099887295e-01   +8.484041590857889e-01   +5.491923387912874e-01   +5.788965785461149e-01; +2.256437397400086e-01   +7.767517988906231e-01   +2.615167269470702e-01   +1.190170895735936e-01   +5.866421116075775e-01   +1.214592476374871e-01   +7.422588099616002e-01   +7.030554030426057e-01   +6.525991863897042e-01   +4.342043855663207e-01   +6.085546143777911e-01   +2.573525111462662e-01   +4.631777414639528e-01   +3.357015144859971e-01   +1.616603610594575e-01   +3.835374683949542e-01; +6.913813311807250e-01   +2.229232726035788e-01   +4.367918676390612e-01   +1.703339132400652e-01   +4.134309907715437e-01   +4.288690749262232e-01   -2.229706706839602e-01   +8.365022864165979e-02   +7.606863488802089e-01   +1.233408926782827e-01   +3.999995185416020e-01   +1.811471954709331e-01   +5.391072273720816e-01   +6.600251403969877e-01   +4.614471395481918e-01   +5.958169643868468e-01; +4.300636283758306e-01   +2.660896135684941e-01   +2.162597738532427e-01   +3.473117173359838e-01   +4.898121464772565e-01   +5.399185916089465e-01   +3.874501498228811e-01   +4.070969871157901e-01   +2.976486688748565e-01   +5.290347802981472e-01   +3.470435791851376e-01   -7.550114655440911e-02   -1.665024452447288e-03   +7.903581690633447e-01   -2.436171278470932e-02   +7.355361939111350e-01; +8.333648797339110e-01   +3.096127397231362e-02   +6.396899138646289e-02   +5.743110950933200e-01   +6.098872514015084e-02   +1.652494010443064e-01   +5.952228770284684e-01   +1.432719729734113e-01   +3.283558297079684e-01   +2.528062407028709e-01   +4.658841603278415e-01   +7.554632480557008e-01   -1.623024359022424e-01   +1.942189400681582e-01   +3.981332591136035e-01   +6.043813074831361e-01; +3.138790214027820e-01   +7.649110847162888e-02   +2.742374777715823e-01   +2.196337854052122e-01   +8.715829048274782e-01   +5.385573780663389e-01   +3.308638742245779e-02   +5.265679589806286e-01   +3.745464010523175e-01   +7.340643821808279e-01   +4.422421821160934e-01   +1.823497998956255e-01   +3.563374576728344e-01   +2.297571111413209e-01   +4.824785076433145e-01   +1.407602621847203e-01; +4.042255624881920e-01   +1.484707912988717e-01   +6.722354115485211e-01   +3.052512620479619e-02   +6.124073807377877e-01   +1.793243774007472e-01   +3.036193914069720e-01   -2.494997643641162e-02   +5.823161675731112e-02   +6.835200818899616e-01   +4.097420432961777e-01   +1.348944295172231e-01   +6.890958185839514e-01   +5.904293470161059e-01   +2.646447643807350e-01   +1.012611260697845e-01];
L2I_L2E_iAMPA_netcon = [+5.441966728229457e-01   +8.255531634687381e-01   +1.734494022901438e-01   +6.803335496270447e-01   +8.522118846896154e-01   +7.637916239874322e-01   +5.866504770342825e-01   +3.241657487573543e-01; +1.000000000000000e+00   -8.739357346273741e-02   +4.738217141819779e-01   +2.689752430003756e-01   +7.428465213464707e-01   +5.299151799875190e-01   +3.528057959273717e-01   +9.451059532459953e-01; +9.546494438162545e-01   +3.425577157606157e-01   +7.968479934226105e-01   +5.740858681000471e-01   +1.490826368415830e-01   +7.348850325525618e-01   +1.533618720982150e-01   +6.647695876998641e-01; +3.833099453271175e-01   +8.376221873703084e-01   +4.502431647322115e-01   +2.501864816670025e-01   +5.409497937955187e-01   +5.133005066220022e-03   +1.066037927854157e-01   +4.334148218749658e-01; +4.081016263027727e-01   +4.660001984917947e-01   +4.927876545330192e-01   -4.552464968959741e-02   +7.614635953839426e-01   +1.180714088075535e-01   +2.462599042075912e-01   +6.291679883996006e-01; +2.967521637477503e-01   +2.721857093104206e-01   +5.350938267585322e-01   -6.622234894804706e-02   +5.578459206939842e-01   +6.202368386979857e-01   -5.114977512828153e-02   +4.201990584615650e-01; +2.526883683447839e-01   +1.226003693861479e-01   +5.613442139491598e-01   +4.747346761309039e-01   +2.041035981798725e-01   -1.405413724446208e-01   +2.279305940753600e-01   +5.472946736533922e-01; +3.976229800549956e-01   +5.401525689103657e-01   +9.104776686931829e-02   +6.094290555239480e-01   +9.236181872694763e-02   +8.350893949401100e-01   +3.127757922129560e-01   +6.823384679067772e-01];
L2E_L2I_iGABA_netcon = [+2.940662298293530e-02   +4.112320773761105e-01   -3.623284043544714e-02   +8.002048465239084e-01   +4.409837916596308e-01   +9.303930707108001e-01   +7.231454953182015e-01   +2.259125152672798e-01; +6.114096481882735e-01   +6.420690639800041e-01   +3.534409415428365e-01   +4.361830078992515e-01   +5.911650416999499e-01   +3.804850074098358e-01   +1.829391763411021e-01   +9.331440632242425e-01; +3.665694456503608e-01   +6.922439199952225e-02   +7.085265301863564e-01   +5.462888824767974e-01   +2.119932912629653e-01   +3.298933126307302e-01   +1.901806439547710e-01   +8.268063688671415e-01; +1.262827004023662e-02   +7.510106563058397e-01   -1.420528520123693e-02   +7.354005937798983e-01   +3.248026705274759e-01   +4.867179657104933e-01   +7.521982579903961e-01   +8.403850428936559e-01; +4.754345732689667e-01   +4.137237897161727e-01   +2.022223896822607e-01   +3.202642948440109e-01   +1.255083566165703e-01   +6.009492141408643e-01   +1.357449410108630e-01   +1.414815904649246e-01; +8.203395227754808e-01   +7.697276193014559e-01   +9.560451718789469e-01   +9.122179605222163e-01   +8.394133146950231e-01   +4.498811328922342e-01   +3.445396592708204e-01   +5.041458816186292e-01; +6.672584449886632e-02   +2.788240359134535e-01   +1.831642667889870e-01   -1.455813709705288e-01   +2.884797915058270e-01   -4.926278599197507e-02   +1.939700165625003e-01   +6.754498608454181e-01; +4.972228247881690e-02   +7.112239409064217e-01   +6.686996213516858e-01   +1.421305910306132e-01   +4.148378300853650e-01   +6.349581475760170e-01   +4.143358660517038e-01   +7.679401700906872e-01];
L3E_L2E_iAMPA_netcon = [+5.296762186852028e-01   +5.976745266255243e-01   +5.572352554422139e-01   +6.882838593718517e-02   -2.168894471990059e-02   +9.542698704357714e-01   +8.535945303881490e-01   +8.971417347479460e-01   +6.207722730345224e-01   +1.517001622969789e-01   +3.411507096321127e-01   +2.059595576605697e-01; -5.318494734589131e-02   +9.039542594104994e-01   +1.667407425582189e-01   +1.745453319621877e-01   +4.742837295565820e-01   -1.506533535724795e-01   +5.282938158236788e-01   +2.335358576741605e-01   +4.449423527499504e-01   +5.743893583536762e-01   +8.342632715961959e-02   +1.933162992416809e-01; +3.427330451470840e-01   +2.145352426667982e-01   +3.179010691646116e-01   +6.487568750169791e-01   +4.472891603926100e-01   +7.412975022368405e-01   +7.002140465690937e-01   +8.337030697972148e-01   +5.427053306450854e-02   +7.676432616237956e-01   +5.615434123656118e-01   +7.815328431911213e-01; +8.611177528897711e-01   +5.410809905015809e-01   +7.159136784473799e-01   +6.440277161782698e-01   +3.660529022144717e-01   +1.000000000000000e+00   +3.723981802954289e-01   +2.743523339989034e-01   +6.233523409715939e-01   -1.838841208605541e-01   +3.326439806266802e-01   +7.609264385719509e-01; +7.495072530065382e-01   +3.564420746227124e-01   +4.421996455171258e-01   +5.414717601214386e-01   +1.274513762508544e-01   +4.623329960832172e-01   +4.874535714063773e-01   +7.269555270461022e-01   +9.482334051062830e-01   +3.847786620743859e-01   +6.749944253069706e-01   +2.022663737631677e-01; +2.869750825836739e-01   +3.076959046101863e-01   +4.360135571305539e-01   -6.409360003192177e-02   +1.745313209318667e-01   +4.149862510317368e-01   +4.506525562087028e-01   +7.848348468022633e-01   +4.724710564095287e-01   +5.673266335667391e-01   +5.712826581334451e-01   -1.668603831223422e-01; +1.031711379344752e-01   +7.539496135299087e-02   +2.246502827561099e-01   +4.213096071172336e-01   +9.406644572302537e-01   +8.115587107128822e-01   +6.988701136440738e-01   +2.999023031610493e-01   +6.030992980095400e-01   +4.025013208993005e-01   +3.136027699936131e-01   +3.797457199628251e-01; +2.070537963407826e-01   -1.381395123655560e-01   +7.426314444207409e-01   +7.847191458917260e-01   +4.884192998964836e-01   +7.907655657922049e-01   +5.953418013123956e-01   +2.878570688132652e-01   +6.746270663502114e-01   +2.237484564394664e-01   +1.612054014428646e-01   +3.316935817254946e-01];
L3I_L2I_iGABA_netcon = [+8.222854599116809e-01   -3.058066353027363e-03   +5.102828308781087e-01   +7.711001555192479e-01   +2.846771631680127e-01   +9.215164576759376e-03   +2.120195597437920e-01   +2.756500868300667e-01   +2.836840677422681e-01   -1.231154632052269e-01   +1.712747337063961e-01   +9.610422715973912e-01; +8.290579767634494e-01   -1.410175284418700e-01   +9.803393667385749e-02   +6.291819287436220e-01   +8.629814198700199e-01   +4.244602364008093e-01   +5.462502822459090e-01   +3.573461707685510e-01   +2.565867850473406e-01   +6.718572175899293e-01   +7.927160405155065e-02   +4.185207113858248e-01; +8.872948550301394e-01   +1.542338601441446e-01   +6.565585269414236e-01   -8.223033722529767e-02   +6.915892976400364e-01   +1.731860187827845e-01   +5.734136309215440e-01   +1.498945460779487e-01   +3.142591767616411e-01   +5.331665271416270e-01   +4.189755592766978e-01   +9.065622885348192e-01; +5.207364375941680e-01   +3.468191433057305e-01   +8.707607782874398e-01   +8.377921962958632e-01   +7.588660440251539e-01   +9.346548169471720e-02   +6.991340109864641e-01   +2.212051444857120e-01   +7.979388443602751e-01   +8.664053070216131e-02   +2.536289689428671e-01   +5.223208942325051e-01; +2.751881832195844e-01   +2.009839794202259e-01   +5.357970625206631e-01   +2.791164668942375e-01   +5.267806074424718e-01   +8.429179880101840e-01   +4.470312759700196e-01   +1.621034651101281e-01   -5.269398803312637e-02   +1.388982855931330e-01   +9.115752395352473e-01   +9.742949997782271e-02; +9.798746742690853e-01   +3.713181747879426e-01   +5.161374994730884e-01   +8.971106546397578e-01   +5.577351713385874e-01   +3.773305362547847e-01   +3.349255838741066e-01   +4.857890307218238e-02   +4.707168806076917e-01   +1.967692826428610e-02   +2.374527602623727e-01   +2.512781232204525e-01; +6.527488468785956e-01   +6.497112122536142e-01   +8.024786706558575e-01   +4.885887589377915e-01   +3.389760581042527e-01   +5.761168528546050e-01   +4.517416930765307e-01   +6.946490377244746e-01   -3.515344026196244e-02   +1.000000000000000e+00   +3.141951488933805e-01   +7.748449902898739e-01; -8.914004829146899e-02   +2.287560861159604e-01   +6.583730065089157e-01   +5.280004317582750e-01   +1.455453760928289e-01   +2.356560703658988e-01   +1.551358716103199e-01   +6.537921119184656e-02   +6.331707056106980e-01   +4.512917963281090e-01   +3.435580934609887e-01   +2.119090191845041e-01];
L2E_L3E_iAMPA_netcon = [+4.375796272988451e-01   +9.462743958671401e-01   +4.231971859595425e-01   +7.305612600338846e-01   +3.500224333594015e-01   +6.332021677666584e-03   +6.335511158605897e-02   +4.065810970457533e-01; +4.432966724374688e-01   +3.947161989665245e-01   +6.114122025460120e-01   +1.785409310274615e-01   -2.620899635969484e-02   +2.343297420279733e-01   +7.127626636920208e-01   +6.090060308432320e-01; +6.872264076713933e-02   +1.325788460447509e-01   +8.941680132482036e-01   +8.643184504640727e-01   +5.696988850677234e-01   +1.703007872831789e-01   +4.586865888051987e-01   +5.995854910629587e-01; +2.243499767404368e-01   +3.509481448309419e-01   +1.537583161896938e-01   +5.474603344358522e-01   +2.673584045787475e-01   +5.605617327458366e-01   +6.488153009458040e-01   +8.079309805885666e-02; +3.424127751843779e-01   +7.421445237771642e-01   +6.240937719207494e-01   +8.108600510125287e-01   +7.351734956215248e-01   +3.573489725463438e-02   +1.195057290561977e-01   +8.985761576051162e-01; +8.960345181743896e-01   +7.086234262971196e-01   +3.115403410148854e-01   +4.328249677030774e-02   +4.395513752564059e-01   +6.666367753733810e-01   +4.781026574496563e-01   +7.785027227710517e-01; +6.084643337673599e-02   +3.449120695918777e-01   +3.072483503054205e-01   -1.497846685801413e-01   +1.964380199683594e-01   +3.720666784002328e-01   +2.874589010302760e-01   +2.351713806341746e-01; +5.894672166023102e-01   +3.114971397336978e-02   +8.563964649578961e-01   +2.248443780941199e-01   +2.009716771058114e-01   +3.103128036440082e-01   +1.133269983786272e-01   -6.877871503216186e-02; +4.534881134234339e-01   +6.941484422660449e-01   +5.932773047807545e-01   -1.344008316907593e-01   +3.366305290010169e-01   +1.352854218538681e-02   +5.375739048932759e-01   +6.177645586206696e-01; +4.250782798437537e-01   +6.622733420395547e-01   +2.931612454963956e-01   +5.030616118186702e-01   +6.713302707442763e-01   +5.231150781967387e-01   +6.437463872739494e-01   +3.177256174953026e-01; +5.229562348471618e-01   +2.421062268392294e-01   +6.679616457082759e-01   +2.580644138385215e-01   -1.363739948365484e-01   +4.733610630673951e-02   +7.918224651496825e-01   +5.629614631329984e-01; +7.280939480963521e-01   +3.972587141058879e-01   +5.690301078403782e-01   +7.777834937335100e-01   +4.124980042216879e-01   +6.638582594955496e-01   +3.382143182668021e-01   +4.184108861194393e-01];
L2I_L3I_iGABA_netcon = [+3.128567748585498e-01   +3.188138414191246e-01   +9.930393886364335e-01   +3.151771861669055e-01   +1.767463276240139e-01   +4.263860960195418e-01   -1.248031087641902e-01   +5.247826924971443e-01; +2.340438965110160e-01   +2.671931535060718e-02   +6.136243671609662e-01   +6.650849892325884e-01   +2.903614899124120e-01   +3.150276197205950e-01   +7.745886853452663e-01   +4.101968967337691e-01; +3.271100156762393e-01   +7.559428624014675e-01   +2.434112699843128e-02   +2.921531682387318e-01   +1.343316912203869e-01   +8.342611005833952e-01   +3.620468074316863e-01   +4.081845506265148e-01; +4.144832577104453e-01   +3.898482495329196e-01   -3.561953249754261e-02   +3.626985569972611e-01   +6.464805719507081e-01   +2.459923187371348e-01   +2.580038113766042e-01   +2.050110769742730e-01; +6.902440926120961e-01   +4.032778069491020e-01   +5.857293670341335e-01   +7.199328466601481e-01   +1.964747854909235e-01   +5.104115538614334e-01   +1.809630519131803e-02   +1.732113318451453e-01; -2.023404182987491e-01   +5.091981478106013e-02   +4.297395560813352e-01   +6.953123033685881e-01   +7.904668803348472e-01   +7.384062509959286e-01   +7.914811682458237e-01   +9.564889757822699e-02; +2.935209144199418e-01   +2.073425063926997e-01   +3.652881479060605e-01   +4.934938578950721e-01   +2.266952582947974e-01   +8.180685872599466e-01   +8.318909363817922e-01   +1.000000000000000e+00; +4.063570231078952e-01   +5.795008762931892e-01   +2.255012869643160e-01   +2.501774756577450e-01   +1.215027847040156e-02   +1.663524396025574e-01   +1.556404292562446e-01   +2.323020381916195e-01; +1.714251871395628e-01   +3.130856907446446e-01   +9.173841303342868e-03   -7.630030750974309e-02   +6.028685274487383e-01   +2.037432860150468e-01   +1.331614310184024e-01   +1.851295339918590e-01; +2.524398724678284e-01   -1.171888509829522e-01   +5.404375898537980e-01   +5.856471680670515e-01   +7.428388357482106e-01   +6.795983755083275e-01   +8.980229843570222e-01   +1.359906296043148e-01; +4.613361838255703e-01   +3.488890356389703e-01   +6.884093190313109e-01   +9.080985038142274e-02   +7.747341141458496e-01   +3.202519739530292e-01   +6.910359832736789e-01   +2.769793492986584e-01; +7.572987126129399e-01   +2.787330805326776e-01   +3.217021151714678e-01   +9.305400776009260e-03   +5.812760870037840e-01   +7.793983597607074e-01   +3.512638125244344e-01   +4.670084071851791e-02];
L3I_L3E_iAMPA_netcon = [+4.410890989214986e-01   -4.879574283453524e-02   +3.589418904057585e-01   +9.456578046926042e-01   +9.339686200559280e-01   +1.724145263591669e-01   +3.442636103800684e-01   +2.397766121580332e-01   -6.522427717065914e-02   +1.745189093370615e-01   +4.929053030898833e-01   -1.916168573334743e-01; +4.436822757083878e-01   +5.413435355151397e-01   +4.720069527943464e-01   +5.432175945281742e-01   +2.717590604265893e-01   +3.377315868771402e-02   +4.275961828663770e-01   +1.585692383690834e-01   +1.095682968671549e-01   +6.495898888384980e-01   +3.239495851084707e-01   +7.779301599781013e-01; -2.861487089956734e-02   +9.510475063247351e-01   +6.229485827361392e-01   +4.352103432817795e-01   +5.924407568740839e-01   +2.599495398622043e-01   +3.591306983962832e-01   +4.277306455375633e-01   +2.595629832032939e-01   +1.122607422534048e-01   +8.758836564217830e-01   +3.428360720630356e-01; +7.029676978522313e-01   -2.912049116310313e-02   +6.402732323894281e-01   +8.232615243249555e-02   +8.179874101892790e-01   +3.063573889011896e-01   +1.403993607057944e-01   +4.077326584663549e-01   +5.354551810730782e-01   +4.451302668257592e-01   +3.548044529773224e-01   +1.824907369704079e-01; +3.030043884758356e-02   +8.546058808956337e-01   +1.144603044487583e-01   +3.438405636982471e-01   +7.027798565857867e-01   +2.309556884402064e-01   +1.265247817225108e-01   +1.720809554725982e-01   +7.083255858382642e-01   +8.303885830408736e-02   +5.911586746931733e-01   +1.269903155868206e-01; +2.260475189035773e-01   +2.313435583867185e-01   +8.806615547460392e-01   +3.128341959107944e-01   +3.547864288453981e-01   +5.152721067514804e-01   +3.006095641875330e-01   +2.832712725568970e-01   +5.844212681107783e-01   -4.128729141070599e-02   +3.700947558165689e-01   +8.396959523312020e-01; -3.356577724551098e-03   +7.985592830333195e-01   +5.670286062564975e-02   +5.204841045902135e-01   +3.754544415046079e-01   +5.713024789897716e-01   +6.337882320660854e-01   +2.863910555470240e-01   +5.964671678215882e-01   +9.388448280625630e-01   +1.533067459751820e-01   +8.148909177766518e-01; +1.732708428291164e-01   +5.147189482142510e-01   +7.220394264356444e-01   +4.210144174254760e-01   +8.950938377860921e-01   +6.610153473603207e-02   +1.000000000000000e+00   +1.862535191996695e-01   +8.138926631110108e-01   +6.469765532530528e-01   +9.342016253673421e-01   +4.813133560595759e-01; +8.920340528585931e-01   +2.735568454898015e-02   -2.565996030309330e-02   +7.122126232702751e-01   +9.520172504312507e-01   +2.470592342390545e-02   +3.473891408767166e-02   +4.384252694501456e-01   +4.713583956242984e-01   +9.608562180298306e-01   +4.610719629641792e-01   +3.123899189589225e-01; +8.004180069479995e-01   +6.233167850861541e-01   +4.535490015032292e-01   +4.804864389611382e-01   +3.360670470308783e-01   +2.405374228073605e-02   +9.537661924867473e-01   +6.965539885803183e-01   +5.063412798865931e-01   +1.687477169415408e-01   +1.658448152886193e-01   +7.054403040022879e-01; +1.833311001346341e-01   +5.152036297207828e-01   +1.618110974010950e-01   +4.973561932060062e-01   +6.713795386369503e-01   +2.605206502823981e-01   +7.293771250705113e-01   +8.838493786605499e-01   +2.137959527250849e-01   +7.740853233816790e-01   +4.031196322178285e-02   +9.020877784025688e-01; +5.198990461094615e-01   -1.153601598782854e-01   +4.644546534849568e-01   +9.857281448494180e-01   +8.535738689112169e-01   +3.140209967137541e-01   +1.821654979565956e-01   +4.836745448826265e-01   +8.624891229241413e-01   +7.082489877425279e-01   +2.828667746116495e-01   +4.915009319811806e-01];
L3E_L3I_iGABA_netcon = [+4.665047823286303e-02   +5.736300262520091e-01   +4.524758651887354e-01   +6.815644278588975e-01   +7.680825640718417e-01   +5.412882868072506e-01   +7.788130865179750e-01   +8.659403884512408e-01   +8.205800357633858e-01   +2.814928830020667e-01   +3.494638832449475e-01   +4.197490392315267e-01; +5.399368448896331e-01   +7.136773982096659e-01   +6.059217909829729e-01   +7.015803235680539e-01   +2.649694923113871e-01   +1.518052413544931e-01   +6.469804755368873e-01   +6.736319360092736e-01   +7.796444505803291e-01   +6.401143282635468e-01   +3.298153703019321e-01   +3.605754671493663e-01; +3.598207252530275e-01   +9.572234528253276e-01   +1.561333064625038e-01   +8.107322237992366e-01   +1.949368630293607e-01   +5.337375033169324e-01   +5.343658681169815e-02   +4.459881282587115e-01   +1.649485873256449e-01   +2.687139521575173e-01   +1.355941136013448e-01   +6.348717671342143e-02; +2.125841370256764e-01   +6.746617470844712e-02   +7.385989645319840e-01   +1.380706683481629e-01   +1.521687370864323e-01   +1.290584437283900e-01   +8.596862829629162e-01   +5.181757217274917e-01   +5.331294268787342e-01   +3.961538600146006e-01   +1.483963184353918e-01   +3.240389670300093e-01; +8.150843876941358e-01   +6.487306252012215e-01   +8.556223274951475e-01   +3.493292656357267e-01   +5.424553775401461e-01   +4.859347775543637e-01   +6.314230410630469e-01   +8.716778986809126e-01   +2.163688879622421e-01   +8.110695591535634e-01   +5.571699269019890e-01   +3.470689960836743e-01; +9.085464051031260e-01   +8.012806891298317e-01   +4.198612168650730e-01   +5.692270726198188e-01   +4.257976689246768e-01   +7.518304544489365e-01   +2.480370941942343e-01   +7.337113134781410e-01   +2.140856937385087e-01   +5.349511557059816e-01   +2.900064264384142e-02   +2.491663001258354e-01; +5.824842908221229e-01   +5.440340197014922e-01   +1.192978113270805e-01   +9.820737490759970e-01   +3.860839439187164e-01   +2.738151341591302e-01   +4.235087207455851e-01   +4.089007191465050e-01   +3.210039562876177e-01   +2.024744895941110e-01   +9.347708271654734e-01   +6.702752831472338e-01; +6.820552554237916e-01   +2.739769069806965e-01   +4.528447527409967e-01   +6.298060203073089e-01   +7.680949713500337e-01   +3.360491358873724e-01   +2.911414693935300e-01   +4.284069252542910e-01   +4.279769833833579e-01   +7.221490368175508e-01   +1.992191953990245e-01   +4.751673451983507e-01; +2.754264526477647e-01   +3.739759014385424e-01   +7.219667052403577e-01   +7.161227015738809e-01   +1.068739028019407e-01   +6.303253347297229e-01   +1.984896262416071e-02   +6.102324527293917e-01   +1.965991868575914e-01   +9.028685199734843e-02   +8.779498732807119e-01   +1.049783300402534e-01; +4.290189097837659e-01   +5.449168409651453e-01   +3.808039446459849e-01   +3.590272472336826e-01   +2.144299555171696e-01   +5.569411276375325e-01   -3.366610648777962e-02   +7.533661714886994e-01   +1.031016143288754e-01   +3.496047950201449e-01   -7.363068260275735e-02   +1.656363690295312e-01; +8.030450123229029e-01   +1.324616076437807e-01   +8.577476370032202e-01   +1.938726990964226e-01   -1.250417195977326e-01   +1.372777064976606e-01   +5.303572050453441e-01   +2.486889415839998e-01   +2.822393805267676e-01   +6.624712350514197e-02   +5.389688111875504e-01   +5.671733327340209e-01; -1.682286650907036e-02   +3.967427366839760e-01   +8.761209498643970e-01   +1.337157098294751e-01   +2.392958479756593e-01   +4.987291413379266e-01   +6.836912370857589e-01   +5.781735760764042e-01   +1.851913542397473e-01   +2.288987276813820e-01   +2.654118633962146e-01   +4.489374237235828e-01];
L2E_Input1_iAMPA_netcon = [+9.127186992646972e-01   +9.400173019596989e-01   +7.969625356385514e-01   +9.780704528229167e-01   +9.063374171379437e-01   +9.176137690720098e-01   +9.704051800531908e-01   +9.531821814978477e-01];
L2I_Input2_iAMPA_netcon = [+9.124767363851805e-01   +9.119154607961595e-01   +8.912683207565685e-01   +9.431401368605495e-01   +6.915602030411296e-01   +7.447368308811457e-01   +8.328555709335266e-01   +9.659082289519677e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
