function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.195027954615763e-01   -3.122541723651178e-01   +3.437526416539707e-02   -1.929104332554372e-01   -1.305866432753932e-01   -1.573397163489433e-01   +1.669953123608618e-03   +1.069786916656659e-01   +1.596159938603687e-01   +1.061152111681332e-02   +1.032742183048358e-01   +1.997720366734076e-02   -3.004853510645449e-01   -1.755442374162097e-02   -1.084291490465701e-01   +2.056880833543445e-02; +2.789007069068444e-01   +1.631540024853168e-01   -7.904083404212375e-02   -2.191923503793478e-01   +4.188131568481699e-01   +9.051062976089146e-02   -2.319687113522383e-01   +2.553166579910767e-01   +8.205031494978435e-02   -2.117583408440108e-02   -2.037663117811777e-01   -6.681935332513353e-02   +9.507831968993317e-03   +1.106231589513199e-01   -1.847716200273845e-01   +1.015443818734726e-01; -2.408501397011719e-01   +2.449298362875176e-01   +1.209498927157093e-01   +1.865877367402923e-02   -8.145007720668013e-02   -4.679849362002788e-02   -3.214064308930044e-02   -2.904683850327833e-01   +3.516190117576360e-02   +2.373088598433437e-01   -5.083888333492187e-02   +2.254366294978087e-01   +5.621985503919674e-02   -2.740736023816356e-02   +2.296661972658115e-02   -2.552354857806283e-01; -2.882182302986779e-01   +2.216731828588318e-01   +3.395725465399825e-01   -1.930720273058009e-01   +1.699346768820056e-01   -1.276099519184025e-01   -1.187849177444740e-01   +2.931450559656454e-01   -5.527782304013421e-02   +2.197107381997392e-01   -1.740801212462014e-01   +1.009887689553605e-01   -1.175170599183697e-01   +1.542600381102252e-01   -3.410292791835703e-01   -3.172476171956603e-01; +2.321876848221035e-01   -3.756784116415057e-03   +5.436531373568833e-01   -2.096984331091711e-01   +7.632037728238776e-03   +2.917418010889638e-01   -3.971271562454080e-01   +3.591700908246676e-01   -3.546227591188453e-02   +7.169561630819901e-02   +1.663255087170714e-01   +5.296617469946706e-02   -6.369736828939471e-02   -1.144187498041917e-01   +2.582818711024785e-02   +1.375056505908915e-01; +2.208189075067798e-01   -5.685056554538973e-02   -8.741620336862654e-02   +2.047994788112725e-01   -2.393727211158098e-02   +1.090698682640731e-01   +7.107582811666688e-02   +3.241131579598684e-01   -1.895905821151426e-01   -8.886696248896797e-02   +5.539748554854361e-02   -2.232497889946274e-01   +2.711045178943834e-01   +2.302730550772998e-01   -5.268059494618552e-01   +1.329633527914003e-01; +8.599416047784986e-02   +2.108480766477350e-03   -2.761878541274287e-01   -3.373514981644151e-01   +1.848826523851661e-01   +2.475577450662197e-01   -1.731424353293592e-01   -2.544485748927833e-01   -1.082658404873240e-01   -4.090113412288490e-02   +4.680230271360981e-02   +2.981652552994483e-01   -3.975445615910265e-01   +1.995364595765167e-01   -7.932046961302512e-02   +2.568397902220851e-01; +9.425918095183919e-02   +5.207132979956963e-02   +9.400226256204840e-02   +4.898085125498760e-02   -1.218493926832384e-02   +1.732291586373816e-01   -1.362504996964137e-01   +2.927829208703508e-01   +2.578811720534878e-01   +3.284409869195074e-01   -1.216848083820219e-01   +4.658660605312063e-02   +9.006789338998089e-02   +4.090685805336002e-01   -3.135339515808795e-01   +1.359952298044369e-01; -1.299344179070316e-01   -1.402784725440003e-01   +2.046184356342626e-01   -1.047960728560513e-01   -2.151493896439202e-01   -9.167635260331042e-02   +2.815912280472601e-01   +2.425444387206452e-01   +1.884067677350343e-01   -2.014360842996036e-01   +2.122977680529409e-01   -1.229332184337002e-01   -2.687256434536395e-01   +1.116444160337016e-01   +4.251872617023027e-02   +2.380399482762630e-01; -1.075036431972110e-01   -2.577596331403820e-01   +2.907380330783178e-01   +1.848469179348956e-01   +1.349354673869588e-01   -5.865000187504955e-02   +6.880959433392080e-02   -4.427572736101751e-01   -5.345488875884119e-02   +1.048378854106123e-01   -1.145969066677526e-01   -4.149091074815620e-01   +1.653709738969655e-01   +5.684284710992415e-02   -1.166478717952431e-01   +1.029818395465495e-01; -1.664851050017482e-01   -7.740332798929458e-02   -3.461383735799304e-01   +3.406626478802181e-01   -2.826111213351606e-01   +1.440267408696923e-01   +4.365878732191728e-02   +6.345046925078753e-02   -1.977848158265224e-01   -2.174580488523314e-01   +9.429984283786642e-02   -7.607764199798346e-02   +2.551967836173924e-01   +4.563713342439275e-02   +1.553156519978421e-01   +1.868901852806337e-01; -5.634658702964104e-03   -2.627414919980592e-01   -3.317318437110972e-01   +2.781146836663568e-01   -2.115701038176718e-01   -3.188730605386720e-02   +5.339350341841721e-02   +3.036761911678871e-01   -4.055378711206087e-02   +1.829067603596998e-01   -9.621338456089982e-03   +1.863921450795290e-02   +3.462090632298667e-01   +3.632977634336145e-01   -3.898330470117478e-01   +5.359694742283820e-02; +9.099805820688191e-02   +2.604591395772207e-01   +2.221242634271184e-01   -2.446712012292026e-01   +2.277778132508868e-01   +1.754409413804093e-01   -8.584524799383136e-02   -1.511228175756202e-01   -1.139872426280098e-01   +2.203074805369722e-02   -1.274702275077244e-02   +1.398957792124145e-02   +2.324539436970593e-01   -1.365707240198940e-01   -3.320955378738516e-01   +3.339358244464335e-01; -1.100029661512492e-01   +2.929702464007756e-01   +2.720148186397320e-03   -1.420860000634515e-02   +3.534517228219866e-01   -1.912100805369237e-01   -1.489162127462923e-01   +2.299363418347774e-01   +8.661942396216554e-02   +1.388469922373108e-01   +1.153897778377761e-01   +4.979953152624632e-02   -1.276593529065888e-01   -4.013927744679123e-01   +3.915598039534341e-01   +9.035746321105230e-03; -2.793540477322928e-01   +8.829367108424052e-02   -3.075637266650257e-01   -4.188537308390106e-01   -1.938344129997470e-01   -1.907190500837072e-01   +1.710701228456782e-01   +7.827326906120455e-02   +8.781359003002615e-03   +1.795154008582579e-01   -3.527683295474032e-01   +2.319817549718741e-01   -9.976757023146526e-02   -1.887484426093838e-01   -3.288215723020965e-01   -2.656110847076087e-02; +3.068367596732748e-01   -1.701346729144657e-01   -3.766497627708065e-01   +7.655371997053499e-02   -1.940072721743493e-01   +2.839732878969182e-01   -1.712245139192248e-01   -9.332905255075852e-02   -1.399003310319262e-01   -7.625140949998180e-02   -3.451390875582570e-01   +2.687419762209708e-01   -4.134465401848511e-01   -2.958522701568270e-01   -1.690622246584784e-01   -3.014199273960025e-01];
L1E_L1I_iGABA_netcon = [-1.049397087234653e-01   +1.056300668069218e-01   -5.649017705779694e-02   +3.383497705842414e-02   +2.033445928768856e-01   -2.456667170095573e-01   -5.773333941931392e-02   +1.674112840258018e-01   -3.410165084798420e-01   +5.051189832228768e-02   +1.640292855586247e-01   -1.996675244730957e-01   +9.500484951038110e-02   -3.884575842501131e-01   -2.613448276921614e-01   +7.334706400473616e-02; +3.844443160289746e-02   -4.841083672651711e-02   -2.078258650022737e-02   -7.379449729491908e-02   -4.281117619650855e-02   +3.140597591725076e-02   -4.969801170771490e-02   +3.732942357598523e-01   +2.480273333041009e-01   -1.055754951473918e-01   -1.957123934172815e-02   -3.037512942098837e-01   +1.219833186247986e-01   +1.219167501237383e-01   -8.116664365537965e-02   +2.670866347042239e-01; -1.067274730409896e-01   +2.164410113342829e-01   +1.770701608595363e-01   -1.855109900970806e-04   +5.873438852970536e-03   +5.559709850759879e-02   +1.124061075593442e-01   +3.600264452954835e-02   -2.616969789878278e-01   +2.487297260767497e-01   -2.309593301934755e-01   -6.689573373388701e-02   +3.626787287580089e-02   +1.325170301941865e-01   -3.893917447204273e-01   -1.556005034045760e-01; -1.176892237337682e-01   -4.380669147510115e-02   -4.701362834960783e-02   -8.026402493242057e-02   +1.517953769022479e-01   -8.993333518373031e-02   -1.966037707259287e-01   +1.311259386644387e-02   +1.681013367949177e-01   -2.691901835535757e-01   -3.376457082945082e-01   +5.115270382738756e-02   -9.390145566908259e-02   -2.477827535958497e-01   +3.149560485582535e-02   +1.218964817611367e-01; +5.344280568457269e-02   +2.308817312104450e-01   -4.267914038910523e-01   -1.983873650767187e-03   -2.509930056845423e-01   -1.864623748463186e-01   +4.937319676209276e-01   +1.155658619757688e-01   +2.109558224219752e-01   +9.562263192595295e-02   +1.842910792970646e-01   +4.705033617524446e-01   +1.484762190960701e-01   +3.271344507633291e-01   -2.044627602541335e-01   -2.572739635280643e-01; -9.512781939411701e-02   -2.812381639534909e-01   -6.512566276157222e-02   +2.928691173767382e-01   -2.306647672594437e-02   -3.024114344654617e-01   -4.786925988025869e-01   -2.134178620958260e-01   +3.618992692126131e-01   -3.023823926425070e-01   -1.808512369123870e-01   -7.952807549957723e-02   -1.585149621082103e-01   +5.811393173078269e-02   -5.074093749039164e-02   +8.953816385243624e-02; +8.154237852631849e-03   +1.032254657304708e-01   +2.929633157455584e-01   -1.760924779017621e-02   +2.277707892262458e-01   -1.342782112233974e-01   -3.345470973848436e-01   +1.577093113888360e-02   +5.946662777094430e-02   -1.982543727736232e-01   +1.020338227973089e-01   -4.370863177695187e-02   +1.179107667841861e-01   -1.073871835991015e-01   -1.906471428509834e-01   +3.349154834053334e-01; +2.146344207727995e-01   -2.907190393619359e-01   +1.562726409222441e-02   +2.347905327080257e-01   -1.139426187162224e-01   -1.294739884556811e-01   +1.367322395128152e-01   -3.426783110171661e-02   -2.329917211611854e-01   +2.471932570716843e-01   -2.195841049252630e-02   +1.940110945401969e-01   -1.509380346049619e-01   -3.960732366801756e-01   +1.004639085345551e-01   -8.622169173522619e-02; +3.354752031441272e-01   -1.644101220304146e-01   -4.394527102673260e-02   -2.165597819403313e-01   -1.420852138671659e-01   -2.830674851548250e-02   +2.984875020743669e-02   +5.953564594465721e-02   -3.221157410465135e-01   -4.404427396229282e-01   -2.644601363974257e-01   +2.692604216752628e-02   +1.677082279306548e-01   +2.060908134075664e-01   +7.848369667602972e-02   -3.860048564962272e-01; +1.462313915105220e-02   -1.778022869988836e-01   -1.525439776532090e-01   +2.496300258092587e-02   -2.203091730512849e-01   -1.632609260249666e-01   -2.892373341737227e-02   -1.704936978552891e-01   +2.478203569827829e-01   -5.464363854933811e-02   -5.815340929756051e-02   +4.050594370778736e-01   +8.784835111896215e-02   -2.058737222190164e-01   -2.752447167383253e-01   +1.208445444627270e-01; +4.056446241449430e-01   -6.779193884766867e-02   +1.312548178258138e-01   -4.649321865019564e-01   -5.543093611277371e-02   +1.119295930069952e-01   -9.892679918963464e-02   -1.010470933688974e-01   +2.258913742904315e-01   +3.092016478355694e-01   -2.125017987848496e-01   -1.732553175696343e-01   -2.376848754050524e-02   -1.496274984768576e-01   -1.552544991244751e-01   -2.304889978060667e-02; -2.700479088262369e-01   +4.431831837937598e-02   +4.986979667446341e-02   -2.632044704219541e-01   -2.380396166874279e-01   +5.610085906170924e-02   +8.075445147616812e-02   +2.327945728025260e-01   +1.870640172348199e-01   -3.013522180009370e-01   +3.600684631056428e-02   +6.036393265921673e-02   -1.652400475063012e-02   -1.331697949672022e-01   -1.531368202458290e-01   +1.206456851761974e-01; -4.011661654830662e-03   -3.035853078136819e-01   -1.344807337368671e-01   +2.354180817417254e-01   -3.339654567167303e-01   -2.504960074964819e-01   +2.819825731261203e-01   -2.060050792115714e-03   -3.124591647629698e-01   +2.066955691212616e-01   -1.851895173916368e-01   -2.662581127833963e-01   +1.779564939899030e-01   +2.016155730691431e-01   -1.072354308459017e-01   +2.934589756351529e-01; +1.950879426560088e-01   +3.868660040726983e-01   -2.009862178816251e-01   +3.095083379905159e-01   +2.519437661217086e-01   -7.474204113698615e-02   +1.060292181459671e-01   +1.186585156604106e-01   +3.636755846551933e-01   +2.741297974450953e-02   -2.262314238369948e-01   +7.211397387208357e-02   -2.028261681552689e-01   +8.204092263498650e-03   -2.185684305700146e-01   -1.271466224329709e-02; -6.556731943971814e-02   -1.293726404414493e-01   +2.532083080179651e-01   +7.123614042482626e-02   +2.383143423633464e-01   +5.120278143195675e-02   +1.125934082801136e-02   +4.274654625385129e-01   -1.044788390508293e-01   +2.371334171446574e-01   +1.623386138792629e-01   +2.282253639772852e-02   +2.176000754630721e-02   +1.048419591977765e-01   -8.460359357898163e-03   +2.540395908950984e-01; -2.117716910555457e-01   -4.125371374330483e-01   -2.015599407871337e-02   +1.708115733628629e-01   -1.887215623514719e-01   -2.721199670543490e-01   +4.232330843195689e-01   -3.300781600098888e-02   -2.617345786074572e-01   +6.881911855063537e-02   +4.975311820160148e-02   +1.646588747553668e-01   +1.183605231219294e-01   +6.214954487626685e-02   -3.471688884805814e-01   -2.927480649012811e-01];
L2I_L1I_iGABA_netcon = [+4.834335560679005e-03   -1.447791985198671e-01   +6.997251971900689e-02   +7.755470477267272e-02   -1.144888406480168e-01   -2.289629590902967e-01   -1.035136640502036e-01   +8.535864772624478e-02; +2.381918554302825e-01   -1.324579384893804e-01   +2.902592685013254e-01   -2.284520944258444e-01   +1.026902884121475e-01   +2.602390633775932e-01   +7.742572536557706e-02   +8.605597178795840e-02; +8.571730845868310e-02   -7.840419535977869e-02   -6.421498840451828e-02   +8.151761941483376e-02   -1.819756732499363e-01   -7.552273058972696e-02   -8.532544801234006e-03   -4.087344448240269e-02; -3.554717612652127e-01   -1.576518858284421e-01   -1.394176214103789e-01   +3.396672279956464e-01   -2.679720797824852e-01   -8.758350689418229e-02   -1.405726189054766e-01   -1.794291171841427e-01; -5.563443386441424e-02   +9.102128198412075e-02   +3.999713384791461e-01   +3.898672913889016e-01   -1.299720878947367e-01   -1.098374881128324e-01   +4.516090292766932e-01   -1.149204625778914e-01; -8.713107704656650e-03   -1.034368956324828e-02   -2.146468125127691e-01   -9.027959764475893e-02   -6.283000753270807e-02   +2.826256154012705e-01   -1.922839203057493e-01   -9.047226190368282e-02; +2.349204473194869e-01   +1.703724292898551e-01   +2.583406255826160e-01   -6.334851959683802e-02   +3.875511629678847e-02   +2.116245145453230e-01   +8.877333761617695e-02   +2.754977383841245e-01; -3.189836695509110e-02   +1.758301405995433e-01   -9.501071291927460e-02   +2.666437115263515e-01   -3.907043915868670e-02   -2.098047406170124e-01   +1.233504601027604e-01   +1.006638474275709e-01; -1.217138941071781e-01   -1.587245031940795e-01   -1.489155969425393e-01   +2.291509061272653e-01   -2.244949703625318e-01   -2.113940146975030e-02   -1.204821370813978e-01   -9.164768980747896e-02; +5.987359431962713e-03   -1.653904910175652e-01   +1.152770687336221e-01   +4.754116376156378e-02   +9.279436656639567e-02   +5.181874652860392e-02   -2.751741032827840e-01   -2.399196674655672e-01; -2.405206106533399e-01   -2.189153241576218e-01   +1.797749305218222e-01   -2.419588880770647e-01   +1.315036366842448e-01   -4.126731515738039e-01   +3.131159768579332e-01   -1.612625585746696e-01; +5.582426270261703e-03   +1.764043867128676e-01   +3.756489226334117e-01   -5.704579825279738e-03   +2.111371717751651e-02   +3.222797231767290e-02   +2.166882801774123e-01   +1.062034296981296e-01; -6.652003721921110e-03   +1.015758223158996e-01   -1.761954250496415e-01   -7.585877747992352e-02   -1.396128228474937e-01   +1.346343843956108e-01   -1.686940790449020e-01   -2.530294535802211e-02; -2.741351257182342e-01   +2.005384895057855e-01   +7.669725062671526e-02   +1.370941619403701e-01   -1.314602142291788e-01   +1.535776871802959e-01   +7.446360627911509e-02   +1.932833291486821e-01; +9.002574471429936e-02   -1.771949691187873e-01   -4.190662060783402e-02   +2.950399587665925e-01   +1.288925722351092e-01   +6.555216819880588e-02   +1.069329233169327e-01   +9.781353384973469e-02; +2.866873316583562e-01   +3.083812252673950e-02   +2.419120436796213e-02   -3.328175642621022e-01   +5.677273333327468e-02   +8.652469969864801e-03   +5.299636451539141e-02   -1.611803394778095e-01];
L1I_L2I_iGABA_netcon = [+4.668239179319560e-02   -1.051563644969780e-01   +7.374945764316784e-03   +1.151708876579561e-01   +2.654598418289628e-01   +1.181468093535054e-01   -1.016370545343643e-01   +3.112994695510707e-01   -3.954191889187647e-01   -1.734581482745434e-01   +2.481472466053201e-03   -1.722219774831137e-01   +1.728621068342650e-02   -1.336160820771768e-01   +3.976531691010585e-01   -4.718674366338196e-01; -1.153504251493641e-01   -1.611568577642229e-02   +4.115461602531194e-01   +2.444182604778051e-01   +1.143001069737336e-02   -3.315627467986344e-02   +1.153280274800294e-01   +3.229606784039603e-01   +4.779763444813770e-02   -7.151369999529142e-02   -6.787158904233648e-03   +2.085966538219685e-01   +8.369998284320898e-02   +4.756026455098426e-01   +4.921859708870339e-02   +9.698572672318335e-03; +1.612357259323537e-01   +1.141110309216727e-01   +2.968805837493251e-01   +4.575968409368500e-01   +2.247348984496585e-01   -1.946344775267092e-01   +1.184496289389273e-01   -9.630534395005480e-02   -7.351257513699103e-02   -7.158994253915607e-02   -3.037813089872728e-01   +1.140573025640482e-03   +1.045422335085660e-01   -2.156775284649892e-01   +2.232479477326941e-01   -3.292009403446302e-01; +2.366335505345409e-01   -2.025639886855521e-01   +3.708712759467466e-01   -4.756659830548137e-01   +3.350085422231879e-02   -3.932246768441458e-02   +2.714967243253189e-02   +2.609639925998680e-02   +1.687384488574512e-01   +1.397473673021409e-01   -1.294138013719045e-01   -5.312661283358365e-02   +3.813689713487268e-01   -2.352495087766529e-01   +3.304385222927983e-01   +2.429510283978323e-01; +1.579679118359704e-01   +2.526016926340589e-02   -7.072457814038784e-02   +1.691579779119982e-01   -1.543774394070095e-01   +7.861420831535784e-02   +2.822032242615098e-02   +1.618766201783268e-01   +7.824206435364342e-02   +2.850267996511352e-02   +1.719635667749640e-01   +1.229457716139252e-01   -7.904575559799952e-02   -6.467178643124903e-02   +2.273583781945665e-01   -9.719782422471190e-02; -1.374861316514893e-01   +3.310951359649738e-01   +3.941955668560842e-01   +1.642362045506898e-02   +1.219292066644835e-02   -1.451979399831817e-02   -9.212010013398347e-02   -2.912110667225301e-01   -1.153553557404045e-01   -3.399533076870004e-01   -2.302363880165227e-01   +3.456857466695636e-02   +8.557407049970316e-02   +1.805168675624998e-01   -4.655269653997283e-01   +2.604030123751573e-01; -2.306044978163609e-01   -1.451208465972413e-01   +5.667302999689364e-02   +2.378730714403945e-02   -4.273797608704502e-01   -3.666683537482913e-01   +1.495089085268750e-01   -1.908272300401983e-01   +1.482387913155102e-01   +9.569645305703049e-02   +5.169233045189958e-03   -8.299039172196623e-02   +4.404217935781482e-02   -9.824901690722886e-03   +7.806319086941907e-02   -6.004293997539537e-02; -2.307785231940521e-01   -2.938693762693452e-01   -6.818024667371399e-02   -1.694982091689758e-01   +1.972291502315692e-01   +4.955386686227352e-02   -5.422997024133766e-02   +1.339302571207681e-01   +4.062227075652663e-01   -2.061686139495704e-01   +8.941817025348742e-02   +2.976941307328379e-01   -6.204829999182868e-02   -2.052717867818925e-01   -1.710430663503132e-01   +4.794589152813974e-02];
L2E_L1E_iAMPA_netcon = [-1.540115802821641e-01   +7.308699219793542e-02   +2.892039101468010e-01   +3.212647980744046e-01   -1.884834253818606e-01   +2.188381060688310e-03   +4.868687731896434e-02   -2.198604926623677e-01; -1.542143753901943e-01   -1.784300212523147e-01   -3.600385364548377e-02   +1.323624988034802e-01   -3.878735256822558e-02   -5.041516912212800e-02   -9.433669919113623e-02   -7.622773082023870e-02; -5.101000302709466e-01   +7.471993748576194e-02   +4.821382126491014e-01   +3.562090209898126e-01   +7.765894253135019e-02   -6.324595675423826e-02   +2.632557313119959e-01   +4.614719225372822e-01; +7.078724495867110e-02   -5.442191485262352e-02   -5.559485747306690e-02   -2.775744656469967e-01   +3.459853006449217e-01   +3.772528711758847e-01   +1.369101664699982e-01   +1.045044610948155e-01; -2.382113483284620e-01   -7.000372446600572e-02   +1.085880077448323e-01   +5.129566516198782e-01   +8.279157119189591e-03   -3.591213103185122e-02   -2.339673435846955e-02   -6.574279407014610e-02; -1.827973687328968e-01   +4.947977939734460e-01   +3.173033856369162e-01   +4.103527211368845e-01   +1.313575907952570e-01   +3.157824961126270e-02   -1.237325348593503e-02   -1.275224867929794e-01; +3.047719410325442e-01   -2.432278159223229e-01   +1.063246460883213e-01   +7.438517976366468e-02   +2.519462999239148e-01   +1.240601538840101e-01   +1.235872898460141e-01   -1.502844557648148e-01; -1.222986857687865e-02   -1.333965160547484e-01   -3.166145577774893e-03   -3.982391699210212e-01   +3.900865764376523e-01   -4.149288363178327e-01   -4.575448371052460e-02   +3.054455215266175e-02; -6.763911604462204e-02   -7.297602163549212e-02   -3.146695883687043e-01   -3.458181937085252e-01   +1.176982321540651e-01   +8.999441283300962e-02   +2.106106504582862e-01   +1.212995496974523e-01; +7.835197270838218e-02   +1.344175181369793e-01   +2.927736492946970e-02   +1.306780900144695e-01   +2.338125749033520e-01   -1.287422967501436e-02   +2.719309152978661e-01   +1.626133768696268e-01; -1.173656937212628e-01   +2.040434149186892e-01   +3.612942846542914e-01   -2.104775739358614e-01   +1.652621043086358e-01   +4.670347281427938e-01   -1.842839110010542e-01   +3.137428762387695e-01; +1.044910691849627e-01   -5.029340824440221e-02   +1.115943616103515e-01   +9.125551246970653e-02   -8.901160671008664e-02   +3.386496653353871e-02   -1.700004100427435e-01   +3.760576559298634e-02; +1.709585500263176e-02   +8.624563159227809e-02   -3.648090528612501e-01   -3.136924722121148e-01   -3.695031833493558e-02   -1.399839359742444e-01   +2.207792068320128e-01   -1.292082015529623e-01; -3.160793393608134e-01   -3.701651048688969e-01   +5.224944765746733e-02   +2.374265249294304e-01   -2.102927288007006e-02   -1.484372959516893e-01   -2.042865791345000e-02   -8.006776133850393e-02; +7.413071315700376e-02   -3.833186847616893e-02   +5.187953173556786e-01   +3.484057644232434e-01   +9.485444299639982e-02   -1.824411087120023e-01   -7.526019783423576e-02   -1.564825595000821e-01; -3.324479502226335e-01   +3.150760533224079e-01   -2.343826183941818e-01   -1.940057160924056e-01   +1.177120544496645e-01   +4.073572158184265e-01   +1.994498929345104e-01   -1.131246038515906e-01];
L1E_L2E_iAMPA_netcon = [+1.481886130640668e-01   -2.992847720314856e-01   +1.301751975341201e-01   -4.850985134850116e-02   -2.180786293341292e-01   -3.560487999668862e-01   -6.969141803019450e-02   -5.491092366672987e-02   +1.466518171712083e-01   -6.442222047098378e-02   -1.870760557156927e-01   +5.687952794608160e-01   +8.410723736114209e-02   +9.155688126008167e-02   +1.061901368876360e-01   -7.469386345903573e-02; +1.325392484385867e-01   +2.265625124175024e-01   +3.172273721647590e-01   -9.406955819246063e-02   +2.142819405051735e-01   +4.696113251303845e-02   -1.201465411501368e-01   +3.395645740162608e-01   -1.775139176638068e-01   +2.099800614911120e-01   -3.864450610695325e-01   +7.909083166639827e-02   -1.107167277664426e-01   -2.871327516601421e-01   +2.997003613058198e-01   +1.358760476614868e-01; -1.527943409405082e-02   -6.275284630631262e-02   -3.024749498106828e-01   -1.066611810862585e-01   -1.073394925220846e-01   +5.510782294085045e-02   -3.563900134153707e-01   -2.402495924240769e-01   -1.844896173780713e-01   -3.321838137885958e-01   -2.231610953209713e-01   +2.894730946277966e-01   -2.198330902293810e-01   +6.475621227887393e-02   +2.349603198270420e-02   +1.606254010394309e-01; -1.756013262088627e-01   -9.754938171784037e-02   +9.999354824447770e-02   +3.132465342496934e-01   -9.149453223503827e-02   +1.050233352834746e-01   +5.301801397276917e-02   +2.547125111264097e-01   +5.609401385761559e-02   -1.021479397750052e-01   -1.418779983091375e-01   -2.550844637898164e-01   -1.999688332695505e-01   +1.473257510899337e-01   -1.506033728766220e-01   -1.505674198368030e-01; +1.479973927145791e-01   +2.084113999331564e-01   -6.015365941873263e-02   -3.772187801131605e-03   -1.774598198553228e-01   +2.676729470343799e-02   -1.633983920580618e-01   -2.282191703387571e-01   -4.654484182916446e-03   +1.674543164583994e-01   -1.161862172285094e-01   -9.359797607870574e-02   -2.244802944316871e-01   +3.533978290944657e-01   +2.871579853565021e-01   +9.578709209167152e-03; -4.323248465653071e-01   -1.344011505690702e-01   -1.988101168341794e-01   +2.008879908842351e-02   +1.716067379272006e-01   +1.613415009813031e-01   +4.249044373049308e-01   -1.306139980925426e-01   +1.651174651226355e-01   -1.891828805594204e-01   +2.556911554942932e-01   -2.054132808508086e-01   -1.517276709621393e-01   +4.260540144530523e-01   +4.876788731353188e-02   +8.259090769770967e-02; +6.095357213250373e-02   +2.734542614756529e-01   +1.656449500912850e-01   -5.589497560478117e-02   +1.441676463524273e-01   -8.084205619390930e-02   -2.611024632675257e-01   +4.289775861098602e-02   +7.788123323946192e-02   -4.898544150233199e-02   +4.511651040278034e-01   +1.474409378737926e-01   +2.818422753683801e-01   -1.196049451906321e-02   -2.942821762105789e-01   -9.296735766479121e-02; -6.279815056442965e-02   -7.688412270907663e-02   -2.704254551987080e-01   -3.110239098615862e-01   -1.375455101010435e-01   -4.269382487490841e-02   +8.758838558003773e-02   -1.895538130106224e-01   -3.160209346493884e-01   -1.739470249358008e-01   +8.259877730030171e-02   +1.216607709099558e-01   -9.281132890293559e-03   -1.160029604600485e-01   -4.647360192361260e-01   +2.527354999137395e-01];
L2I_L2E_iAMPA_netcon = [+1.497868820983022e-01   +2.314050591313698e-01   +2.663956810064389e-01   -7.530466170278215e-02   -3.379951488383784e-02   -2.785139713562312e-02   +6.021228630786860e-02   -1.295562184369413e-01; +2.249706370169528e-01   +2.743103746736197e-01   -1.433211521344951e-01   -2.639207794174341e-01   +6.033187766597338e-02   +3.130364764646647e-01   +1.636383185102039e-01   +2.945023983330932e-02; +5.363939878104679e-02   -1.128181638313165e-01   -9.967927018058033e-02   +1.479422752947541e-01   -7.265016218564915e-02   +3.689539800557189e-02   +5.389609052088504e-03   -9.897806919652309e-02; -1.786271978363519e-01   -1.255087413647849e-01   +1.339538484894445e-01   -1.623166928270643e-01   -4.008398973157502e-01   +8.714360829501873e-02   -1.592802266607496e-01   -1.391911678677848e-01; -2.423623394805343e-01   -3.964886668587325e-03   -2.104667513168265e-01   +6.122735659331999e-02   +3.046281788768136e-01   +4.066887656260484e-02   -2.152016164551213e-02   +2.170467469925880e-01; +8.023497837227653e-02   -1.282336887100411e-01   +1.978145572951048e-01   +1.511802381383174e-01   +2.204567385675551e-01   -6.482249060069761e-02   +3.942419210348136e-02   -2.007192103275606e-01; +1.782468511965401e-01   -2.611693080779855e-02   +4.815245006975380e-02   -2.457837929703919e-01   +2.579408477666545e-01   -1.054345896615620e-01   -2.082529406806748e-01   -2.480149354711783e-01; +1.854155230423913e-01   +1.640498575465901e-01   -1.015730967037169e-01   -1.603368735725867e-01   +6.290903937216720e-02   -2.250815251095686e-01   +6.529542978010697e-02   -4.196664519158362e-02];
L2E_L2I_iGABA_netcon = [-2.010368357720241e-02   +1.163418851629491e-01   -8.571840843355069e-02   -3.693192813395731e-01   +2.188646454593147e-01   -3.706911058234388e-02   -1.284159644724718e-01   -9.697344154823014e-02; -1.010360854683279e-01   +1.997530102609648e-01   +2.761650811980923e-01   +2.125190009956271e-01   -1.093189846698236e-01   -2.583413408855081e-01   -4.498271888822564e-01   +3.166725160292325e-01; +2.971312967278689e-02   -1.786589778033238e-01   -1.269576032421725e-01   -9.053650090640930e-02   +3.148803733499067e-01   +9.202402780985774e-02   -1.870706436288179e-01   -1.513876875365714e-01; -1.870910009369276e-01   -8.511186352279343e-02   -2.261181056929991e-01   +2.460419650534741e-01   -1.611356274437873e-01   +3.881111400503788e-02   +1.246570784924815e-01   +6.490031046663400e-02; -5.765621388765624e-02   +1.342260018643455e-01   +4.825907697442823e-01   -9.686079711170234e-02   -5.863653807895403e-02   -9.863389194669543e-02   -2.008809265510577e-01   +1.086458994161132e-02; +2.208443912926258e-01   +3.908812821099078e-01   -1.475851647184256e-01   +1.356556988677943e-01   -9.704614411018236e-02   +2.480735032869467e-01   +1.171401485143689e-01   -1.262927789985317e-01; -1.622666227231127e-01   -2.175070465307249e-01   +4.001483628031214e-01   -4.190953396510459e-01   -1.839764527445600e-01   +2.800546650796574e-01   -3.124351353699161e-01   -3.524921468484821e-01; +1.501539078979084e-01   -1.973829369051040e-02   +1.692493676602320e-01   +3.906038892371279e-02   -3.440437917622357e-01   -5.518304965215621e-03   +2.385697591002623e-02   +2.383804853465564e-01];
L3E_L2E_iAMPA_netcon = [-9.639624670732742e-02   +1.650696662618415e-01   +2.654733972904210e-01   -9.298996711217458e-02   +4.588256232197477e-01   -1.872875482183181e-01   -4.503332771518792e-02   +1.340299027405850e-02   -4.046544468896782e-01   +9.083784131187189e-02   +1.622773305981255e-01   +4.379766598563667e-01; -7.151798252559244e-02   -4.122849354125779e-02   -1.961622937028724e-01   +3.874549032940755e-02   -1.245391189044660e-01   +1.695075328286057e-01   +1.955263206456636e-01   -4.136894575277550e-01   -1.875539370276504e-01   +1.245121685670207e-01   +3.145645749551456e-01   -1.235768764560040e-02; +1.997753091225296e-01   +2.742020807064657e-02   +1.593428059518465e-01   +2.153928708028251e-01   -2.234267940991074e-01   -3.350712826737289e-01   +3.662221578360607e-01   +7.171214768516306e-02   -1.311703315955402e-01   -1.452350337125723e-01   +2.842912714271998e-01   +4.437537215376747e-02; +1.849834670287196e-01   -5.133321989067645e-01   +2.805012254990458e-02   -1.834496588267591e-01   +1.646805307706813e-01   +3.083721160862449e-01   -2.746249342791363e-01   -1.515143551509986e-01   -1.887310723909744e-01   +2.877484983016911e-01   -1.091561630356888e-02   +4.622489610844144e-02; +1.730601717899405e-01   +1.682408718900841e-01   -1.942633177476620e-01   +2.598790605524115e-01   +9.342583576857422e-02   +3.665608613325526e-01   -1.257586962591878e-01   -2.050533140562428e-01   +1.797342455522268e-02   -2.507341054024065e-01   -5.749524785440545e-02   +6.951696151109600e-02; +1.725978163040146e-01   +1.942884459159599e-01   +2.607385765749017e-01   -8.995539060034852e-02   -4.954514127079955e-02   -2.220205383575516e-01   +1.621930189637840e-01   -1.740624440987439e-01   -3.428856083104231e-01   -2.711990183291444e-01   -1.482907191267306e-01   -1.068740827396965e-01; -1.736755694894359e-01   +1.907950875245380e-01   -1.529351982073862e-02   +2.088141436973708e-01   -2.622663485100592e-02   +8.261267759192739e-02   +5.458060988358446e-02   +2.944497719658137e-02   -1.431667051670660e-01   -1.742400071991691e-01   -3.092802989378990e-01   -2.872587809132319e-01; -3.879323733385073e-01   +6.129622352745660e-02   +3.138736925698329e-02   -8.301217014554521e-02   -1.792054530849648e-01   -1.037267045970878e-01   +1.595583299999564e-01   -1.322800397618033e-01   +1.293165967134630e-01   -8.248726565310768e-02   +8.418821644846733e-02   -7.777133258069509e-03];
L3I_L2I_iGABA_netcon = [-3.003281583943699e-01   -1.200049891432203e-01   +7.232786290274704e-02   -6.874805039846416e-03   +1.388449122984852e-01   -1.973583168554710e-01   -2.571830725739188e-02   -1.211082799261949e-01   -1.932781784334862e-01   +1.665690918692064e-01   -8.807529437730195e-02   +2.998952491323648e-01; +2.036657768861063e-01   +9.685924393598917e-02   -1.268461931437085e-01   -8.457833942403137e-02   -3.071949223337673e-01   +2.641364483116731e-01   -3.614729213340460e-01   -1.459484959856526e-01   +1.264670408571336e-02   +3.883701370328356e-01   -4.579241318894289e-02   +2.297823635539495e-01; -1.151104745287998e-01   -1.379443918642787e-01   -2.486197778284352e-02   -2.819487588420120e-01   +5.911929294075606e-01   -9.761052378453867e-02   -3.251822789111208e-01   +2.803911571437166e-02   +1.035004066411290e-01   -6.748886869486176e-02   -3.002337008865196e-01   +2.281634903559288e-03; -3.421291100661601e-01   +9.310893008200669e-02   +1.122418936295813e-01   +9.267229653712671e-02   +1.679546494259213e-02   -3.108769199163828e-01   +5.097770307642958e-02   +1.047049466980312e-01   -1.029852054889255e-02   +1.848665694045541e-01   +1.751288910866584e-01   -2.138364225111569e-01; +3.150755891410806e-01   +5.495305897337549e-02   +1.357081348257237e-02   +3.035730085555246e-01   -2.120119466454289e-01   -2.543312948383449e-01   -2.004125202548736e-01   -5.579596275642280e-02   +8.608941605011076e-02   +4.661377448908872e-01   +2.534230327095550e-02   +3.858274153811110e-01; +2.498265989414302e-01   +9.280446482479676e-02   -2.332798756074273e-02   +3.550774996393177e-01   +1.392635241958527e-01   +8.570380536186011e-02   +1.271515030895230e-01   -1.219320255863313e-01   +1.126631134168518e-01   -1.043159657415270e-01   -2.759351377711884e-01   +1.503076251984573e-01; +2.895218236016333e-01   +5.190113390136294e-03   +1.312293404690977e-01   +9.667381491978130e-02   -2.442261712261202e-01   +4.240467853036625e-03   -1.267523967486906e-02   +1.414459930513583e-03   +1.017017318046134e-01   -2.467074905637703e-01   +1.178371233128025e-01   -1.635987674042483e-01; -3.215682122816539e-02   -3.878567847523074e-01   -6.199739937169647e-02   -4.238827292744038e-01   +1.092785887422630e-01   -4.509913526360856e-01   -2.150933532082770e-01   +1.222958059108423e-01   +8.443032853784141e-02   -1.162165743687685e-01   -1.580050739965542e-01   -2.330465473796768e-02];
L2E_L3E_iAMPA_netcon = [-6.227473988132226e-03   +1.688211726708823e-01   +1.542482412674320e-02   +1.640203581719585e-01   -3.813060363930773e-02   +2.218065042626723e-01   -2.638078074717522e-02   -1.336089441233358e-01; +8.225838276444343e-02   -7.721073870057754e-02   -2.140087803475159e-01   +1.741506934470501e-01   +2.640845177872325e-02   -2.830886064800565e-01   -3.536819580653752e-01   -8.563836537759145e-02; +1.831871832358249e-02   +1.493707134054869e-01   -1.741154820962372e-01   -8.566604401381302e-02   -3.193683641638172e-01   -3.766464846813536e-02   +9.125751831812980e-02   -3.618728273385236e-01; +3.001467599475840e-01   +4.584360947711113e-02   -3.350049312779755e-01   +2.721545439765988e-02   +1.434156899675997e-01   -2.139376555371684e-01   -3.885237613360698e-01   +4.630688953663793e-01; +1.646061491012859e-01   +5.278607206617696e-02   -1.553838165889736e-01   +6.445963029652944e-02   -1.747941620639685e-01   -2.605327672146759e-02   +7.373967215240648e-02   -2.252093399188358e-01; -1.870614504635505e-02   +4.003087840871522e-01   +1.280874099515942e-01   -5.446642608483682e-02   -2.542589418544425e-01   +1.619368036207290e-02   +3.190053541903478e-01   +1.532675591006856e-01; +2.725982681913179e-01   +1.021695612334608e-01   -4.628655397631398e-02   -2.302401425015875e-01   -2.112929428144245e-01   +3.563222707287272e-01   -3.309097151125563e-01   +4.223569614299814e-01; +2.069904322388741e-01   +7.939687859461066e-02   +1.311851501821896e-01   +2.448643228230561e-01   +4.202712898093094e-01   +1.339632681430297e-01   +3.726032107493429e-01   -5.129806751196339e-02; +3.233338083594109e-01   -1.411109944421429e-01   +3.069403540127617e-01   +2.004816587865048e-01   -2.373245255902154e-02   +2.437317270578287e-01   -2.131388559487342e-01   -9.785531281028027e-02; -8.649741303740172e-02   +1.417624837731174e-01   +1.197145143732273e-02   -1.085205791650294e-01   +2.319507186972784e-01   +2.523983122578967e-01   +1.513965713962211e-01   -1.487373498185612e-01; +3.423756954528004e-01   +2.920254022048820e-01   +1.188848607024798e-01   +1.786572644101192e-01   -1.525633277252049e-01   +2.059132170383339e-01   +2.633603516183017e-01   -1.768443835167485e-01; +6.784044183811450e-02   -1.431987499599766e-01   -7.835512576757568e-02   +1.611712087105653e-01   -2.680890851290201e-01   -1.229891875973745e-01   +1.027194396359209e-01   +6.178746712907344e-02];
L2I_L3I_iGABA_netcon = [+2.843271388764664e-02   -1.492304510532087e-01   -4.828953575171282e-02   +1.018201590835763e-01   +2.805755975986769e-02   +1.743587351879646e-01   -2.523174485312644e-01   -3.343215578361746e-01; +1.196199278491969e-01   +2.451480958534902e-01   -2.001583609101666e-01   +3.005121477100922e-01   -4.573680703830550e-02   +4.554031996882472e-01   +5.424786152185407e-02   -2.955842888847703e-01; -1.122331888647188e-01   +8.564707797098005e-02   +4.927092469949318e-02   +8.629443173609934e-02   +3.602567129091656e-01   -2.462000609856166e-01   +2.104538345524719e-01   -1.426403309212222e-01; -1.401398832722351e-01   +1.099998199996464e-01   -5.761036400415416e-02   -2.121830375868439e-03   -1.637799474767249e-01   +1.733153427634076e-01   -1.705043200202004e-01   -1.379872245438173e-01; -7.456953211015102e-02   +3.317597076275743e-01   +3.167286697610759e-02   -4.895699701696095e-02   -3.712205142388438e-01   +8.446346401628774e-02   +3.344667567445730e-02   -2.553346391816036e-03; +7.740806737650846e-02   -6.415229279794979e-02   +3.428607704891086e-01   -2.122718915938906e-01   +3.630012932174557e-01   +1.686582270535542e-01   +1.609828159615262e-01   +3.304338286460456e-03; -1.788715462227503e-02   +2.890427220715081e-01   -3.328095746013716e-02   -5.009425789564886e-01   +2.526026013120485e-02   -2.329910348496189e-01   -1.820405414173947e-01   +8.856783410582966e-02; +1.829309644855419e-01   -3.441875141792483e-02   +1.652638287896878e-01   +3.246694006371128e-01   -3.013351940886163e-01   +3.418261892753288e-01   +2.962831324804210e-01   +8.276637143130927e-02; -6.106841150619965e-02   +1.599922654703155e-02   +6.218680970263379e-02   -1.553800197091506e-03   +2.544207742458970e-01   -2.263273564832274e-02   +3.793568906293211e-04   +1.175101322576265e-01; +2.762327485012407e-01   -1.328628288144370e-01   +5.789118114965983e-02   +2.322215232649973e-01   -2.052580688638176e-01   +1.729766709108636e-01   +4.228737110272107e-02   +2.419353459011128e-01; -2.200981203360747e-01   +1.123006889849944e-01   -1.771837847069108e-01   +2.297181451731891e-01   -4.407760975356999e-02   +8.469615681354330e-04   +3.923733417667942e-01   -2.053057238336894e-01; -1.302845611741871e-01   +6.379808378706414e-03   -5.197152221145418e-02   +2.425633690548049e-01   -3.207527719599957e-01   +3.734097266250133e-01   -1.068838830641700e-01   -1.106489470784516e-01];
L3I_L3E_iAMPA_netcon = [+1.646501784918407e-02   -1.642144228874108e-01   -6.580970479250098e-02   +2.945963861518887e-01   +2.987601333960127e-01   -1.757348475724178e-01   +2.504736783756012e-02   -4.472449065502242e-02   -9.755607830252616e-02   -1.710048839757667e-01   -5.492744959879258e-01   +3.010378207148025e-01; +1.651957469457663e-01   -1.991834361517417e-01   -3.991958002996042e-02   -1.534928411698323e-01   +2.201783835606057e-01   -1.767739152679911e-01   -3.985267601801584e-02   +7.863082921322630e-02   -1.537481448258732e-02   +3.047221026062086e-04   +4.616773855966479e-02   +3.784588968188352e-01; +8.883919105721005e-02   +1.238229033171971e-01   -4.487382471705604e-01   -2.106275776209762e-01   +1.165653423932363e-01   -1.241032975957969e-01   +4.282783963399352e-02   -1.528577006550158e-01   -2.525214856096071e-01   -9.256583137936296e-02   +1.651167293272264e-01   -2.320492183415172e-01; -2.628683519800714e-01   +2.920044150039053e-01   -2.211877697608553e-01   +2.065138574157463e-01   +1.578942003431238e-01   +3.350515402527526e-01   -2.103871910675442e-01   -1.863594672584256e-01   +2.170512404221763e-01   -1.745617318201410e-02   -8.970479688919404e-02   -3.230190391375527e-01; +1.850138330025596e-01   +1.224922951410108e-02   +1.089860297640375e-01   +5.283770172151264e-02   +8.897829256918484e-02   +3.746541351239616e-01   -4.798356126615430e-02   -1.614245934211878e-01   +3.978568861659880e-02   +2.020693509215762e-01   -2.302065758869862e-02   -2.226061645293458e-01; +8.700592166389826e-03   -2.702733105077882e-01   -1.840694542984019e-01   +5.322144038051815e-02   +2.292994892382108e-01   +3.054666442104093e-01   +2.058376306462399e-01   -6.791440948156344e-02   -8.226546187956414e-02   -6.802493529138851e-02   -7.435637964762518e-02   +1.482955499376049e-01; -1.025143816968282e-02   +3.731811974460338e-01   -9.024369023803262e-02   -2.975751794635728e-01   -7.391256777284895e-02   +1.350991743427435e-01   +1.094187338181633e-01   +1.239344362005704e-01   +1.455433063056137e-01   -2.491590496089004e-02   -2.802189462200209e-02   -6.439197401831849e-02; +1.767203534917466e-01   +1.406457484854333e-01   -8.337754725259727e-02   -6.116777860999133e-02   +1.958052603210841e-01   -2.373104743579569e-01   -9.618096603305765e-02   -2.216018804198616e-01   +1.365650275209082e-01   -2.085166988037153e-01   +7.096458522491150e-02   -9.061585223094794e-02; -6.865762610107388e-02   +4.802135330132827e-02   -2.499598894474813e-01   +3.629660990386213e-01   -1.407445479658615e-01   +3.337969168731794e-02   -3.781624061775044e-02   -4.941494077395600e-01   +2.947910092577429e-01   -3.841047048834308e-01   -3.006780983036439e-01   -2.859339721363998e-01; -4.452527700767947e-02   +1.011472211954769e-01   +4.329291113622234e-02   -4.637383080457926e-02   +4.244590397304501e-01   -1.908667706731424e-01   +3.576268519564951e-01   +9.819242404500292e-02   +6.694881962009502e-02   -1.736442693210502e-02   +4.021978501621192e-01   +2.375109116916444e-01; -7.128832188217642e-02   -1.298279158748847e-01   -2.256995323313184e-01   -1.426605453161973e-01   +3.675551791639412e-01   -5.167991392922275e-02   +5.447735838794211e-02   -8.600035276204218e-02   +2.078883334043061e-01   +2.854073835328895e-01   -2.206622912548063e-01   +2.382519117791737e-02; +1.234902022874977e-01   -2.121338565612506e-01   +3.659949555215827e-01   -3.539477948464758e-01   +8.324060548735857e-04   -3.164343478270889e-01   -3.268174223413970e-01   +1.247176072834770e-01   -1.027643919706531e-01   -5.386404162692872e-02   +2.261374637713897e-01   +4.648769200810980e-01];
L3E_L3I_iGABA_netcon = [+5.884761762387380e-02   -2.824534666283418e-01   -1.779664173080363e-01   +6.134357554660440e-02   +3.164885744114830e-01   +1.066612561298995e-01   +4.699249474384751e-02   -6.610449365800092e-02   +3.586636028865685e-01   +1.032472513418090e-01   +4.688158986886252e-01   -1.341431944551777e-01; +1.155378734297984e-01   -1.671613713244295e-01   +1.140886319185426e-01   -5.654522097272855e-02   -3.313327040108355e-02   +1.541904522491619e-01   -3.044487270284835e-03   -1.964162434319321e-01   +1.857920246884390e-01   +2.390098699430644e-01   +2.209161190182141e-01   -1.259084200123566e-01; -2.274512873845298e-01   -2.975976687672899e-01   -1.993352310954055e-01   -1.101642632367650e-01   -1.058152881289895e-01   +1.289055542161345e-01   -5.716133223390049e-02   -2.541896471152811e-01   -8.317971386227010e-02   +6.540972189914021e-03   +3.615397605848658e-01   +2.644985559982410e-01; +2.398002527794375e-01   +1.823975466533095e-01   +2.057256962175377e-01   +8.263845437209144e-02   +1.417690806186749e-01   -1.907702729693819e-01   -4.785101847218624e-02   +1.905168205280588e-01   -1.865207546210970e-01   -1.975868277434161e-01   -1.949257729801169e-01   +3.067157586150111e-01; +3.128006419412141e-01   -3.415496264220799e-02   -4.423093003147931e-01   -1.084941011890157e-01   -6.792958278518099e-02   +3.291515684796630e-01   -3.350236483565484e-01   -1.247573515352785e-01   +1.171364123760379e-01   -2.586723078942537e-01   -2.966992698532335e-01   -2.054666155044662e-01; -1.369334769183017e-01   -2.893616583380453e-01   +6.413157146838022e-02   +3.774628452538187e-01   -1.253808407605135e-01   -3.800342917661517e-01   -2.965161050709088e-01   -1.481967519423087e-01   +5.578278216820173e-02   -1.456886067746271e-01   -2.299939381425116e-01   -1.633796160027146e-01; -6.189176050202578e-02   -6.079486406823822e-02   -4.275101079149918e-02   +1.290235430110666e-01   -1.203496487132352e-01   -1.415650141425602e-01   -2.733847798175534e-01   +1.002310409861248e-01   -1.848741219820337e-02   -5.055744014245671e-01   -1.930413629471997e-01   +5.236689943281611e-02; +2.002121280089083e-01   +1.668546831594780e-02   +2.324483106962177e-02   -7.950451990747576e-02   +2.118724172786774e-01   -8.821397043856165e-02   -1.998020267429146e-01   +2.595316020024397e-01   -1.014417749685147e-01   -4.921084442419732e-03   -7.508871806743972e-02   -1.362097791912298e-01; -7.998544711775162e-02   +7.957528678798494e-02   +2.812748457047188e-01   +2.139610297425052e-01   +4.226481633125815e-01   +1.054682410595577e-01   +3.070802699953398e-01   +1.345209053154856e-01   -8.542319623029132e-02   +1.481466574534193e-01   -6.751684748379123e-02   -2.363257345547008e-01; +3.441239650945234e-01   -2.118629983141240e-01   -9.214434361121210e-02   +2.373916973746190e-01   -1.619722867917783e-01   +1.796133075103125e-01   -2.431068761923590e-01   +3.365560784330617e-02   -1.418682941231921e-01   -9.590344511086729e-02   +6.110557302949289e-02   -2.466231870352774e-01; -4.158248735334297e-01   -2.339189181700285e-01   -2.075450150352346e-01   +1.182675440359975e-01   +9.044552671309639e-02   +2.683112266599899e-01   -3.007716295985009e-02   -5.183589694867097e-02   -2.249364117648391e-01   +1.170961299743042e-01   +1.910553836982711e-01   +2.943281455641480e-01; +3.250936049705856e-01   +2.267233516154630e-01   +1.801554455179910e-01   +1.309795369925931e-01   +2.146930948757922e-01   -2.884148744645718e-02   -1.091446081407359e-01   -3.106691439373308e-01   -1.521632905852878e-01   +1.446027721113897e-01   +1.567532495968016e-01   -2.169500803388623e-01];
L2E_Input1_iAMPA_netcon = [-9.301719711990163e-02   +1.051865223941887e-01   -1.084727313108351e-01   -2.460085559068626e-01   +2.272826372380539e-01   -3.788430028331236e-02   +2.062660671771232e-01   +9.500689260342016e-02];
L2I_Input2_iAMPA_netcon = [-1.531586117917114e-01   -9.176846980564121e-02   +2.220465628874033e-01   +8.175339348228533e-02   -1.434735446248278e-01   -2.807753102923996e-01   +1.771491975240198e-01   +5.984022989443889e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
