function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+6.659194832928519e-01   +3.817588202584308e-01   +6.885540402951404e-01   -4.770257745296105e-01   +6.574928204951376e-01   +1.326730514810183e-01   -5.153018070542645e-01   +3.168649505147933e-01   -6.384700364302646e-01   -8.747962576616367e-02   -3.038341487452605e-01   -3.701118579878360e-02   -6.140927255784220e-02   -1.554476354318380e-02   -1.819771129507289e-01   -3.993926452865116e-01; +4.644103607278212e-01   +4.031359213564670e-01   -2.407196468629376e-01   +6.941423647552902e-01   +4.101810356126793e-01   +4.015273121769003e-02   +6.750472044709552e-02   +3.894601319963746e-01   +4.115516844242659e-01   -5.391261925610907e-01   -1.173577288217433e-02   +6.682721835253798e-01   +3.244048455133935e-01   +5.199640847921831e-01   -3.423296008973790e-02   +3.650110913740117e-01; -3.681709899996510e-01   -2.051547040049992e-01   -1.412712210301004e-01   +4.006461079671676e-01   -1.717543671444978e-01   -1.214011004353643e-01   -2.420795746867326e-01   +4.739095942704871e-01   +4.244681199834304e-01   +5.091243789392645e-01   +7.079175470567928e-01   -5.120429207663009e-01   -2.451690483148574e-01   +8.474338167846400e-02   +5.836718026149526e-01   -4.810011903134221e-01; +2.336533777201754e-01   -3.273246810992366e-01   -2.939563333226878e-01   -6.701105225021705e-01   -8.044630142952067e-01   +1.299652570522296e-01   -1.953507836743421e-01   -1.873274773691935e-01   +2.770060690504369e-01   -1.388766607433720e-01   -6.946172598393807e-02   +1.701339934557921e-01   +3.405996027303228e-01   -3.366270754642555e-01   -6.766114557418160e-03   +4.320327636624777e-01; +5.314818303804367e-01   -5.814931510282336e-01   +2.254672163313796e-01   -5.462176447615802e-01   +1.565510775813395e-01   +4.111079626115595e-01   +5.120610082980159e-01   -1.920893353702200e-01   +5.675730617540887e-01   -8.209638045288029e-01   -3.026910083483275e-01   +3.742465359099902e-01   +5.200472247505885e-01   +1.694969001328765e-01   +8.208300175301382e-01   -3.044713752911353e-01; +4.358819495499829e-01   -2.653391904749874e-01   -2.148883058790624e-01   -6.513565443808846e-01   +6.994505212761426e-01   -3.737897571089659e-01   +2.021231332924585e-01   -4.843485918378367e-01   -9.357844165922304e-01   -3.725639028335014e-01   -2.821077735030060e-01   +4.678847507064556e-01   +5.643934055477012e-01   +3.277854133635469e-01   +4.393212158270071e-01   +7.082374852741381e-01; +1.683106551363371e-01   -5.766223396203127e-01   -2.835840418592433e-01   +4.535411047416213e-01   +2.756887787842068e-01   +4.386373787380868e-01   -7.811887770652791e-02   +1.000000000000000e+00   +3.922147171434291e-01   -6.238830331445094e-02   +2.611472775570907e-01   -2.091634186197275e-01   -7.257819383649601e-01   -4.557015960661049e-01   -7.124957750752585e-02   -2.298272118527995e-01; +1.987008100793480e-01   +4.437683433360072e-01   -3.055210671635881e-01   +4.461602696049604e-01   -3.258096151771475e-01   -6.586575723306987e-01   +6.854813070837448e-02   -3.544062381461497e-01   +2.863074078316220e-01   -1.988277095397779e-01   +2.530604738788431e-01   -1.322826623751473e-02   +4.029109547537923e-01   +3.994349668970000e-01   +7.048191661645034e-02   +2.341989511075917e-01; +7.446652963388248e-02   -1.841183198707530e-02   +5.781195587595395e-01   -2.799520068480954e-01   -2.863808943326055e-02   -1.795917715874514e-01   -2.370716840841024e-01   -4.140351252735658e-01   -1.693738366148652e-01   -3.469692982548802e-01   -8.155691420137525e-01   -2.549647990923911e-01   -1.986186806969390e-02   -1.523443261854218e-01   +1.199109312505572e-01   -3.722544989649533e-01; -3.642400866777857e-01   +1.069253422878574e-01   +3.285034868590364e-02   -1.749957855432001e-01   +3.152704696674660e-01   -1.433250456108727e-01   -3.514444956628294e-01   +2.575263917806624e-01   +1.009847690647050e-01   +1.784486903664581e-01   +7.144955898954952e-01   -1.330855974457759e-01   -1.776128791189887e-01   -5.364333218490066e-01   +2.036954100626762e-01   -3.034104085964868e-01; +9.226205023776510e-01   +7.546317543927095e-02   +4.382378503274427e-02   +1.309279474701073e-01   -1.227145990922794e-01   +3.335654401978697e-01   -5.241386157289480e-01   +3.557448652689658e-01   -1.885632734776995e-01   +2.931992776812987e-01   -9.922540451643721e-03   +6.092811835434686e-01   +6.655895214526791e-02   -4.029448219717892e-01   -7.666142546893435e-01   +2.324562080420813e-01; -8.333164196573119e-02   +8.502384966082646e-01   -4.631015700605403e-01   -4.676302123821128e-02   +4.327748672643351e-01   -6.547799241852196e-01   +1.242509884259664e-02   -1.791613233940952e-01   -1.605051818148289e-01   -3.772164224249024e-02   +2.787834788580856e-01   +4.796137235764504e-01   -4.211894142066827e-01   +6.190915289082255e-02   +1.653775981669596e-01   -2.802539310270727e-01; +2.763697513231063e-01   +7.686720158883944e-01   +6.521126176247069e-02   -6.039194268082004e-01   +5.406818626155112e-01   +2.466022940448680e-01   -7.531190778733779e-02   +8.861745120973123e-02   +9.830780680102107e-02   -8.905855273744513e-02   -4.822621430189322e-01   +4.648288405238500e-01   +6.161481436674422e-01   -5.259277909493246e-01   +2.365008580930782e-02   +6.005442121936103e-01; -9.011280735594175e-02   -8.045134833328340e-01   +3.822324394538169e-01   +1.377987082561708e-01   +5.282871514645449e-02   +4.231787133362305e-03   -2.593759279980232e-01   +8.294260177663965e-03   -1.251836160941478e-01   -5.555601639867087e-02   +4.527397909564159e-01   +3.254057287344780e-01   +1.940397054221780e-01   +9.348854958537002e-02   -7.042790312126020e-01   +3.745950577567436e-01; -3.060300033546550e-03   +2.632707943753738e-01   -2.244468859922293e-01   +4.830913214609516e-01   -6.907126860946095e-01   +2.383231655597622e-02   +4.557716405753660e-01   -3.449774855779342e-01   -4.192570528324596e-01   +5.001182289828701e-01   -1.523230693538395e-01   -1.071912557789950e-01   -3.275853233980110e-01   -9.705776719098350e-01   +1.679962209754052e-01   +3.890735546450442e-01; +5.096067127722530e-01   -7.580732145313320e-01   +1.827422467242928e-01   +6.894514156698535e-02   -2.600615549149597e-01   -3.779918321081619e-01   -4.517482875030701e-01   -4.827762199145502e-01   -6.432254527039025e-01   +3.545006959799641e-01   -2.627960670891910e-01   +7.176692550682746e-01   +3.224125152928412e-01   +1.368712048890292e-01   -4.208144501846852e-01   -7.390564229206371e-02];
L1E_L1I_iGABA_netcon = [-4.797911345900280e-01   +6.079315762377021e-01   -5.296427027808465e-01   -2.421611384409783e-01   +5.082082326326349e-01   +3.262687991128443e-01   -6.431593286201432e-01   -3.016625217960844e-01   +3.799459122293368e-01   +1.855949755214911e-01   +5.901402881433388e-02   -6.944886036440731e-02   +3.025849539014624e-01   +1.880223744957976e-01   +4.571017791868374e-01   +3.890430865092768e-01; +2.600780412123056e-01   -1.854997747027973e-01   +1.555066757830378e-01   +2.901910216050055e-02   -8.422013105524199e-01   -2.791963037017051e-01   +7.837642179489043e-01   -4.594135868297494e-02   +3.262638316659835e-02   -2.097724901145447e-01   -8.839638501395507e-01   +8.308520310787960e-01   +4.699669405980282e-01   -1.622814657838237e-01   +2.407611594606594e-01   +5.763784343695669e-03; -1.780958222460965e-01   +2.833960405808620e-01   +3.946691422889185e-01   -4.233791474277175e-01   -2.432054724864222e-01   -6.335814535728016e-01   +2.726712508586661e-01   +7.790009111013632e-03   -8.659822376624447e-02   -4.107951417713298e-01   +4.129582718566186e-01   -3.412602834859404e-01   +4.427934352887238e-01   +3.360409392382954e-01   -5.596617436924135e-01   +1.863669853489338e-01; +8.340753666299251e-01   -4.127839665083460e-01   +5.102827268311917e-01   -5.176463687785897e-01   +3.704921058079472e-01   -5.612048663614757e-01   +3.088508867971786e-01   +3.137360288443896e-01   -1.995948306634799e-01   -6.057396600940915e-01   -2.835688966628702e-01   -8.214883151609732e-01   +5.752364049802906e-02   -6.023730661073581e-01   -3.370012563080262e-01   +3.758579607897089e-02; +1.276481934258934e-02   -5.748957370358849e-01   -5.303267230006955e-01   +3.214876401902824e-01   -7.939378286548318e-01   -8.158275318933940e-01   +4.018123226127888e-01   +4.866921870248079e-01   -4.661552887007583e-01   -4.771100284112278e-01   -4.959971866347332e-01   +5.298872540984421e-01   -1.750142159398273e-01   -3.114876107207465e-01   -1.706024670932219e-01   -9.629416276883619e-02; -2.031383327601398e-01   +1.185026343643146e-01   +5.846376085770238e-01   -2.959304002074505e-01   -1.275753956514276e-01   -5.289965607136083e-01   -7.368647953452062e-03   +5.068274476857882e-01   -1.371970731100024e-01   -3.324192902406041e-02   +7.340560414041708e-01   +3.752156522065258e-01   -5.404808649554113e-01   +2.547479916903814e-01   +4.213865233128776e-01   -3.330283439104892e-01; -1.254825088436007e-01   +3.627378116748787e-01   +6.280439368570848e-01   -1.453702071943270e-01   -4.904199353010006e-01   -7.385937695176609e-01   +3.187780779080291e-01   +4.210373640979988e-01   +3.156815399202488e-01   -8.571804550863005e-02   -5.251913227573431e-02   +3.608387007253970e-01   +5.596313908148739e-01   -5.077518087615176e-01   +9.714529392617303e-01   +7.720828466986566e-02; -6.817212214723338e-01   +1.052035439945517e-01   +9.608519498295146e-02   +3.973927812947333e-01   -3.742454636572917e-01   +4.385951059464195e-01   +5.876640166170329e-01   -5.523745972620064e-01   +6.566229527775942e-01   -5.139877704685285e-01   +9.837222322580853e-02   +7.469425762038606e-01   -3.766500917505660e-01   -5.847770335473932e-01   +1.663411681330388e-01   -2.228372686788343e-01; -6.035845025329197e-01   -3.992564013538948e-01   -5.551759635371998e-01   +3.191985507563729e-01   -8.395336173789899e-01   +4.910161972978355e-01   -4.985937327720752e-01   +1.118847271024632e-01   -1.950010626190629e-01   +2.525070627517627e-01   -1.789522889519519e-01   -1.411271965450696e-01   -2.757821727086939e-01   -7.032539358641131e-01   +1.283346428649166e-01   +8.661119148719000e-02; -2.516208136355512e-01   -5.566916649060539e-01   +3.931426695478619e-01   -4.964760771838820e-02   +1.928706299754159e-01   +3.356028666521159e-01   +1.212973231914916e-01   -4.988497534905556e-01   -4.439267577260841e-01   +7.553808798422014e-02   +7.902955322638698e-01   -3.373908397037831e-01   -4.205817389604460e-01   -3.425320454368945e-01   -6.530127291848409e-01   -4.472220782170552e-01; -8.738499422381373e-01   +7.466829549966517e-01   +1.403452535799967e-01   +4.566636184579083e-01   +9.077985083724024e-02   -9.955698062401327e-02   -4.596163105215962e-01   -3.982134810567284e-01   -9.811288883036308e-02   -7.237765374640353e-01   -1.746153893676881e-01   +4.188393189960591e-01   -2.313085085951227e-01   +2.281885759381189e-01   -8.741282299394254e-02   -8.122861998182214e-01; +4.273450378370489e-01   +3.118977441675827e-03   -4.780595641207008e-01   +5.001028356858942e-01   -2.989201130681134e-01   -5.720255210284280e-01   +1.972584767501917e-02   -3.669002041631992e-01   -2.921394237442032e-01   -6.409106481860044e-01   -1.509510783754122e-01   -3.832469047241190e-01   +7.811601725240490e-01   +6.792355061782068e-01   +2.762132249581138e-01   -4.083710451958457e-01; +2.544191779817949e-01   +1.193834736998428e-01   +3.099839338938394e-01   -1.392333405659584e-01   -3.462229844262919e-01   +3.564482918821483e-01   +2.542288734056084e-01   +2.915240114105681e-01   -2.157611098665237e-01   -5.739475257072137e-02   -2.583862509603435e-01   -7.528641490513932e-01   +4.803100173837725e-01   -1.061441501173821e-01   -1.000000000000000e+00   -4.241939588722081e-01; +1.105058131613015e-01   +6.278576932984876e-02   +3.368989898216804e-01   +4.761329120285887e-01   +1.707904487740826e-01   -6.975042303312611e-01   -3.561547656651542e-01   +1.941613937014285e-01   +5.109767459330508e-01   +1.417008718471915e-01   -6.421764806943331e-01   +6.454228701896531e-01   -2.848512873505482e-01   +1.265259105346558e-01   +8.522971278355257e-01   -6.155555964010334e-01; +5.332945371431509e-01   +3.301435876200804e-01   -2.382363998863477e-02   -3.324290004076744e-01   +2.842723152429318e-02   +1.088816747789512e-01   +3.787785817269026e-01   -1.174480074677019e-01   +1.092731949272076e-01   -5.076728369553933e-01   -5.858697182517166e-01   -1.971940041724996e-01   -1.610393365734014e-01   -8.926048275546554e-01   +6.170553334050848e-01   +6.457882874411793e-01; +1.343752896633149e-01   -1.671147174777838e-01   +8.691708527139305e-01   +2.887548995349055e-01   +4.604611348384961e-01   -8.945098420067904e-02   +1.168959434952269e-01   -6.068110076272425e-01   -3.480021432934021e-01   +5.291929551981110e-01   +9.229093601248257e-02   +1.401501877099106e-03   +5.713662247670236e-01   +1.313315813789519e-01   -3.254399144966991e-01   -5.149417817981659e-01];
L2I_L1I_iGABA_netcon = [-9.304708647073683e-01   +1.993767047789006e-02   +7.609713778665689e-01   +4.698565140063763e-01   +3.363979954988351e-01   +2.966555399980128e-01   -3.642724090399880e-01   -4.121698013107640e-01; -4.900101510517194e-01   -5.546043321481772e-01   -5.214472634167193e-01   +4.555727122787987e-01   -1.000000000000000e+00   +1.258574859821582e-01   +6.212949192926155e-01   +3.478266358256188e-01; +3.911825583742278e-01   +5.972525876335518e-03   +4.333208408325788e-02   +2.939289224576832e-01   -3.029332175155583e-01   +5.505688032463573e-01   +8.281223132392875e-01   -2.145794272934101e-01; +3.549583346332372e-01   -3.520080926531868e-01   +2.067076248516942e-01   +2.919011306464394e-01   +1.588715202158975e-01   +9.794575263875706e-01   +3.431842729048714e-01   -7.320668939942732e-01; -5.101330638246157e-01   +6.820164189816315e-01   -3.810236865329003e-01   +5.822025911594220e-01   +4.366499865253549e-02   +3.047947777427115e-01   +3.596206050635971e-01   +3.455374572554922e-01; -2.644574591707824e-02   -8.258447259010995e-01   -6.919870707642749e-01   +7.245323992789940e-01   +6.933040817819662e-01   -5.900107040588457e-01   -1.048897099808333e-02   -8.275012827250157e-01; -1.095222915573479e-01   -4.198855337121294e-01   +2.817060702017069e-01   -1.616296109186539e-01   +6.252000041223192e-01   -5.992713142967229e-01   -2.728026981253189e-01   -3.776339465949164e-01; -6.731982418943070e-01   +5.471939470693422e-01   +4.665436862279922e-01   -1.735566480325628e-01   -3.962635830037269e-02   +2.341981032048882e-01   +3.693853531695860e-01   -4.953008841343484e-01; -4.835242995928163e-01   +3.723182210790023e-01   -2.316952151963549e-01   -9.639714469202182e-02   +3.671031208496608e-01   +9.462622240510951e-04   +6.394205088152227e-01   +1.586518595149735e-01; -5.628371302194934e-01   +3.077554699568042e-01   +4.602338395011029e-01   -1.850037390615800e-02   -4.063802164021363e-03   -6.905718170479528e-01   +5.366454684116216e-01   +2.377050322382992e-01; -5.646060819691696e-01   +2.161908531092682e-01   -4.032175213054586e-01   +5.304516355707524e-01   +4.867510161028500e-01   -1.461368317180195e-01   -3.407551443111483e-01   -2.629469869116083e-01; -6.557087803887327e-01   +3.484205315994636e-01   -9.469051528895636e-02   -4.415243040553172e-01   +4.751377295871542e-01   +3.035897348006257e-01   +2.254012342862115e-01   -7.637760555161886e-02; -7.908271044126818e-01   +2.289101794677745e-01   -9.304806214788904e-01   +1.599554812387068e-01   +3.464402195778384e-01   +2.380238509855884e-01   -9.095782783236347e-01   -8.901638162548515e-01; +5.789963089879800e-01   +2.459139131263087e-01   +6.987760382017355e-01   +1.576372853275756e-01   -1.220829437821077e-02   -4.313578412785708e-01   +4.679531851077013e-02   +3.023188999688063e-01; +1.149365450620053e-01   +1.587267164072829e-02   -8.946928513893219e-02   -5.007785355592682e-01   -5.006601325231161e-01   +6.789032464311995e-01   -6.030655610981888e-01   -3.998812440311431e-01; -3.033454517126331e-01   -1.053251524010734e-01   +3.155468943068029e-01   +1.325590007609211e-01   -4.656744994785116e-02   +3.268670400670193e-01   +1.513648936828254e-01   -5.423887836651561e-01];
L1I_L2I_iGABA_netcon = [-1.845104214281914e-01   -9.722693108429359e-02   +4.363151985440232e-01   -7.308058063559547e-01   -4.501668399803970e-02   +5.131519125510928e-01   +3.438549083176509e-01   +1.000000000000000e+00   +8.036289046070075e-02   +8.828252375356092e-01   +7.520696291103023e-01   -1.648944061350969e-01   +6.685230050810779e-01   +1.034902602276985e-01   +1.146923822809975e-01   -1.404970696605940e-01; -5.917823567811791e-01   -7.579531732298272e-01   +3.673456940351629e-01   -2.023880353791299e-01   +5.134507349225940e-02   +2.684457087931545e-02   -2.094887491538898e-01   +2.344262908543181e-01   -6.859627549516389e-01   +4.220854422240435e-01   +5.832526753076975e-01   +1.720786761066528e-01   +1.004434200379187e-01   -1.589560523519892e-01   +2.171412054555397e-01   -4.122549038275361e-01; +1.187937069247828e-01   +3.430341816093523e-01   -1.569036935879052e-01   +2.579397171301536e-01   -5.922443129992315e-01   -3.351486249882439e-01   -1.658951696472664e-01   +4.636573649729070e-01   +3.790231595776921e-01   -5.505344704221956e-01   +8.568582799845222e-01   +2.147153149874547e-01   -4.558021122069497e-01   +2.957279790123162e-01   -6.187666101635282e-01   +5.876613442904368e-01; -3.980904309026435e-01   -1.959745300763177e-01   -5.292833322446705e-01   +2.802687256990919e-01   +3.660001713122752e-01   +2.882151854709388e-01   +3.732649437480829e-01   -1.722011636851422e-01   +1.415028681549556e-01   -3.420817928478700e-01   -1.192154775464788e-01   +3.311486249591045e-01   +3.212578261716639e-01   -6.262286626090613e-01   +6.912382347530688e-01   +1.899346583615033e-01; +1.885954207423723e-01   +4.347171216020640e-01   -3.898097586330454e-01   +3.791130802832768e-01   +1.911123784305930e-01   -2.197556200405963e-01   -7.653424592345210e-01   -1.146367578800697e-01   -5.397245276882982e-01   +7.124104407830438e-02   +7.589877969303891e-01   -1.303485139232223e-01   +4.533576039560886e-02   +4.652810806077730e-01   -9.798923938472097e-02   -5.689998373644385e-01; -1.691473689533078e-01   -4.915255639857902e-02   -6.842152018101778e-01   -1.502636233898199e-01   +3.624582996672416e-01   -3.820331968805133e-01   +4.783872884534217e-01   +1.752266430345230e-01   -5.869081858260645e-01   +3.944828844798077e-01   -2.262922360470647e-01   -1.939420121871203e-01   +5.933777599566366e-01   +3.698934765720129e-01   +5.903210572183092e-01   -1.351909599168041e-02; -2.863096969871491e-01   +7.959664156258798e-01   +8.482532196327631e-01   -1.920378366860263e-02   +5.374890252451588e-01   +3.904318626597465e-01   -4.604289888229151e-02   +1.345261037750674e-01   -6.203950753748748e-01   +7.124445772352501e-01   +1.324534983257958e-01   +2.634917391489194e-01   +3.680836186967360e-03   +1.407379000601345e-01   -2.661906961079046e-01   +6.213951199462348e-01; +2.197095901176963e-02   -4.938422148570685e-01   +3.358302837364861e-01   -3.639588879061155e-01   -3.999502908337033e-01   +5.637349810185920e-01   -1.252685338057419e-01   -1.073495815580373e-01   +6.007789893583846e-01   -4.876301216162192e-01   +3.681555038098024e-01   -4.179841609300745e-01   +3.987558599089535e-01   +6.122910273622552e-02   +4.177640462420896e-01   -1.746883798909827e-01];
L2E_L1E_iAMPA_netcon = [-1.789763820518839e-01   +9.804932379070332e-02   -3.382166623423647e-01   -1.172798639693857e-01   -8.476438895202945e-01   +8.924105578613353e-02   +7.621190572639607e-01   +3.606197164197799e-01; -2.802132743056914e-01   -1.215691647174551e-01   -2.903482213167426e-01   -4.406935903002788e-01   -4.708057558658880e-02   +4.576206338652192e-02   +1.164340320906732e-01   +1.807555106616481e-01; +2.629078148483106e-02   -2.667311410527128e-01   +1.002648810247418e-01   +4.530218251435718e-01   -6.017064131897865e-01   +3.047401155132879e-01   +1.195232975995539e-01   +3.202237739798412e-01; +3.145059231498709e-01   +1.113666134255362e-01   +1.918221853476132e-01   +4.911766835294429e-01   -1.124165003205941e-01   +5.124616820854746e-02   +4.923482789627774e-01   -8.756841334880152e-01; +3.414444135132643e-01   +2.926175750092357e-01   +7.829598444759990e-02   -3.143269873541836e-01   +7.017439015885666e-01   -4.040269064009008e-01   -6.949671178262447e-01   +1.438548278033673e-01; +1.859009505922811e-01   -1.481182568496512e-01   -3.334651280864753e-01   -7.665235081601931e-01   -8.183083583245403e-01   -7.260379256412136e-02   +1.216263739724546e-01   +2.681744838762561e-01; -5.755856785958658e-02   +1.786416307566099e-01   +4.023294970705462e-01   +3.765962595680478e-01   +1.927664266598759e-01   -5.749396386414115e-01   +5.350432398043199e-01   -3.632433664944728e-01; +1.216414798061811e-01   -4.089163320022792e-01   -6.127210190886553e-01   -1.704417052509724e-01   +3.821855191571480e-01   -1.887095274165785e-01   -7.164451249383281e-01   +4.888023472788865e-01; -4.647857813941643e-01   -2.050047389591990e-01   +5.757232336753709e-01   +2.298331550087109e-01   +4.088023157567511e-01   -2.610460211437459e-01   -6.287522630097050e-02   -5.009702346777882e-01; -5.654399253657797e-01   -9.644098937937950e-02   +7.605139983652312e-02   +6.019487171406156e-02   -4.412785058643267e-01   +8.475681234246784e-01   +2.513383334770794e-01   +6.946540217756114e-01; -3.012612145760685e-01   +2.413225704633480e-01   -1.000000000000000e+00   -3.303899617521819e-01   +3.008155357107285e-01   -6.076969387200846e-02   +5.158634173500432e-01   -2.091967596049587e-01; +7.454734186652697e-01   -4.748029127080220e-01   +3.357306420356797e-01   -1.027334578975067e-01   -3.665241364777637e-02   -2.804692392185464e-01   +4.554866664039673e-01   -2.515697785347059e-01; -6.186721850235350e-02   -5.027125755366291e-02   +7.372939472650476e-02   -5.091843442772369e-01   -3.885409191758333e-01   -2.810884695355788e-01   -4.290338115001284e-01   +4.474356933697605e-01; -4.117801579870801e-01   +8.488959873979547e-01   -6.365835575565285e-01   -2.385595453213079e-01   +2.548853561413472e-01   -5.380745564503704e-01   +1.353447872509421e-01   -6.290084196516364e-03; -6.330360224399804e-01   -4.145270397926996e-02   -1.923031988924677e-01   +7.566141221739976e-02   +6.127567498058104e-03   -6.035002565500120e-01   +3.029719156419581e-01   -4.514608204378366e-01; +2.056282488483639e-01   +1.177952358792620e-01   -1.826636578036266e-01   +3.531658033803178e-02   +1.967496857110135e-02   -4.484071460210394e-01   +8.370897264099575e-01   +4.592476070998723e-01];
L1E_L2E_iAMPA_netcon = [+3.589015448130355e-01   -1.860055039697893e-01   +3.185578098981575e-01   +4.754851033371121e-01   -5.973833091178047e-01   +1.188924120636508e-01   +5.150487279878478e-01   +5.548304582765663e-01   +7.368799148923507e-01   -6.019824708317516e-01   +3.876716684329258e-01   -6.991555237163307e-01   -5.220910408929779e-01   +7.126030709825987e-01   -3.815832149076099e-01   +3.568474556593650e-01; -3.703499988472633e-01   +2.544614241810415e-01   +5.306873666270210e-01   +5.563044891531624e-01   -1.018410072089330e-01   +2.542672069984548e-01   +1.852344247906609e-01   -2.329872304693502e-01   -2.914978111897281e-01   +8.118035202752029e-01   +1.426757766150758e-01   -3.789733153112719e-01   +1.252706480672623e-01   -9.250543047980569e-02   +4.855764554870854e-01   -7.767186642891157e-01; +4.866302838103276e-01   -1.409345109571805e-01   -3.164358112892839e-01   +2.879099001381201e-01   +4.538675192108046e-01   -1.979682149403343e-01   +7.949626210084986e-01   -5.770079811386031e-02   +2.484615430001998e-02   +8.832941538650664e-02   -6.801708844732296e-02   +3.039934725016893e-01   -2.836910126738371e-01   -4.521853317277594e-01   -1.066184956784828e-01   -2.063323245468290e-01; +6.227019316911505e-01   +4.725539915497343e-01   +8.075756861547556e-01   -1.319957756237766e-01   +5.575651359313758e-01   +2.927179936401011e-01   -7.478297214716235e-01   -8.910143412352267e-01   -5.195979236218218e-01   -2.731920096296286e-01   +4.879048730062572e-01   -6.459665315627314e-01   +1.761384941965660e-01   +9.906385787100046e-02   -4.341645896997093e-01   -8.106062315245262e-01; +3.365626203231494e-01   +2.351468117954960e-01   -3.938001319299941e-01   -1.514124559358571e-01   -2.541922207442383e-01   -3.082343541209439e-01   -3.781507622943373e-01   +4.100970265218723e-01   -2.786641202661348e-02   -5.922415784858925e-02   -1.340589679603020e-01   +4.238943311692446e-01   +3.407330250713448e-01   -1.310338481016210e-01   +1.545911193930365e-01   -7.371095602069321e-01; -1.035933125542165e-01   -1.391522992216491e-01   +1.229560298707334e-01   -4.983375481626167e-01   +2.825993044557333e-01   +6.734731263671323e-01   -5.765455964439051e-01   +2.878009369972410e-01   -8.727564014621786e-01   -3.331843411507031e-01   +4.472762485260880e-01   +4.211911302321927e-01   +5.133290421489964e-01   +4.774166070420767e-01   -1.334295812655370e-01   +2.217762422699184e-01; +6.958312637959473e-02   -5.543178541889634e-01   +6.732720600751563e-01   -6.112357380669158e-01   -5.687091923371832e-01   +4.689781462364872e-02   -7.710007176919567e-02   -8.555099190172608e-01   -1.771469792696486e-01   +6.866554552122516e-01   -8.572944009499096e-02   -2.993598516358744e-01   +7.339345277212639e-01   +6.531364270440922e-01   -6.164728852745357e-01   +1.723461862439646e-02; +5.106329820087258e-01   +1.909692594359127e-01   +5.167875364550834e-01   -9.845723281938943e-03   +6.260915019214701e-01   +9.863361814461259e-02   +3.852668822137730e-03   +5.679493222165417e-01   -1.589916561445239e-01   +6.869866965018608e-01   +3.305465046474719e-02   +6.181321256710272e-03   -1.000000000000000e+00   +4.299772373065882e-01   -6.395478387389664e-02   +4.261310594387837e-01];
L2I_L2E_iAMPA_netcon = [-2.721424672747157e-01   -2.668590201609683e-02   +3.577815871836995e-01   -2.799361119048863e-01   -1.069102796984042e-01   -5.625754440355278e-01   +9.903416567467399e-02   +7.865800032326975e-01; +8.032226563259212e-01   -4.358580274783528e-01   -5.736970300337284e-01   -9.463057694060496e-01   -5.776463953989175e-01   +3.078060689713450e-01   -3.080277347843595e-02   +3.294633934619635e-01; -5.812530566856483e-01   -8.275392649638734e-01   -8.423548417834832e-02   +6.880028642501469e-01   -1.211432803829872e-01   +1.902593691470549e-01   -9.822574029469494e-02   +3.927682580751121e-01; -5.258724792729816e-01   +6.289725902061767e-01   -1.832982312860483e-02   -6.908774226073550e-01   +5.442436799552330e-01   -5.322130234583703e-02   +4.515620703137141e-01   +4.349380773456855e-01; +2.008683917690412e-02   +7.366242333616907e-02   -7.092304054087289e-01   -1.099568111227177e-01   -3.723672233846563e-01   +1.889507295692009e-01   -7.404407168557570e-01   +3.091411134420657e-01; -4.617466045656576e-01   +9.289225595481049e-01   -2.531850989663919e-01   +1.286766498404542e-02   -4.619209578534100e-01   -6.399401426141279e-01   +3.432793882887732e-01   +1.506902447667202e-01; +3.741569735568652e-01   -4.134712491178930e-01   -1.449626977793954e-01   +7.236604454426380e-01   +9.030667695823005e-01   +6.807506636341767e-01   -8.069865504486413e-01   +1.465605273913881e-01; -2.374810280381889e-01   +5.605779372894613e-01   -3.048897052115144e-01   -4.130637409149335e-01   -1.000000000000000e+00   +9.101170694691371e-02   +4.226226131235145e-01   -2.699364925041369e-01];
L2E_L2I_iGABA_netcon = [-7.969176130227351e-02   -2.967858354262629e-01   -1.829728723269729e-01   +7.076236639745687e-01   -3.440750696475798e-01   +1.350657437247625e-01   -9.454464792753804e-01   +1.938722743057738e-01; +8.924468919476263e-01   +1.646054354492441e-01   -2.836394364473458e-01   +2.807069802408326e-01   -2.079332925763221e-01   +9.602705080372008e-02   +2.637850339479234e-01   -8.305969492195121e-02; +4.990953529330625e-01   +3.127117701076971e-01   -4.989811111512514e-01   +4.750813405585121e-01   +4.620149371605026e-01   -2.746329589580089e-01   +4.960640124259824e-01   -3.360241210519892e-02; +9.597978229121218e-02   +5.845207926978032e-01   -5.649757181267159e-01   -7.303115542638968e-01   -5.535577609115065e-02   +4.998593987308063e-01   -7.281588789379501e-01   +1.949563728273551e-01; +1.359162391721364e-01   +7.365112975659214e-01   -2.537119807740292e-01   +3.088232526028571e-01   +8.698975735751926e-01   -6.730404981435576e-01   +6.015662552412596e-02   +8.037207851437691e-01; +3.704150410811554e-01   -3.250040460975977e-02   +9.122680940439603e-01   -1.726467306326256e-01   -2.525635884754037e-01   +4.885563574668442e-01   -1.583071176420931e-01   +1.532650233446076e-02; -6.300938571655792e-01   +2.418294391037270e-01   -5.417946319172161e-01   +2.584088956606045e-01   +2.953658030860113e-01   -5.599868557591080e-01   -7.250819940765711e-01   -5.112087980235149e-01; +1.770489324234109e-01   +3.613492344411185e-01   +1.694473127889323e-01   -2.980170270569230e-01   -3.623268953422941e-01   +1.000000000000000e+00   -2.695804084217631e-02   -1.754826468092801e-01];
L3E_L2E_iAMPA_netcon = [+5.014728877197766e-01   -6.142505250408233e-02   +7.227013135960322e-02   +2.903779753714434e-01   +5.959707149658596e-01   +4.465779019176364e-01   +4.388871664669119e-02   -2.724071587968478e-02   +3.697882574525977e-01   -1.063894123658119e-01   -3.094155828917102e-01   +4.506789231359098e-01; -2.996506843572793e-01   -6.599193431982319e-01   +3.824985930324727e-02   -4.588532290723867e-01   +5.276144584913481e-01   +5.137837150996989e-01   +4.069720819075094e-01   -3.598314433236907e-01   -3.792452245594161e-01   +5.349618559833568e-01   -6.191744812967855e-02   -3.436079687793515e-01; -1.834254443321578e-01   -3.363615917784268e-01   -5.840764046477396e-02   +1.425123041001241e-01   +9.721408927649833e-02   +6.518413105597081e-01   -9.966456229754925e-02   -4.461546337847990e-01   +8.418228454900047e-01   +2.610445135794839e-01   -3.718696013050237e-02   +5.169245974937844e-01; -3.870808710096385e-02   -5.034327879764602e-01   +3.496959523590530e-01   -3.871382628681680e-01   +3.693408297258723e-01   +3.434740590708634e-01   -1.908647091049639e-01   +2.417862807712249e-01   +5.660477481740447e-01   +5.603981981568484e-01   +2.368791462293805e-01   -3.373293905825505e-01; +1.101191644149799e-01   -6.021823623565995e-01   +4.122841025760473e-01   +4.366833149736959e-01   -5.008111981252162e-01   +3.451914375967876e-01   -3.924234407920822e-01   -2.668476097052701e-02   -2.094485299390064e-01   -5.545483439920883e-01   +3.473101736748472e-01   -1.220854216599226e-01; +2.297854258778789e-01   +2.778154359696471e-01   +5.676397340636671e-01   -2.597275858182372e-01   -1.176840362000831e-01   +5.759340844003639e-01   -3.230895311991166e-01   -4.281585486009396e-01   -4.783853593730130e-01   -9.464179574102602e-02   -5.178678914806569e-02   -6.618243906754053e-01; +5.882584397218877e-01   -1.316122569193764e-01   +3.430073265435445e-01   +1.853049569275925e-01   +1.495856597760152e-01   +4.648159401775996e-01   -6.722176827822544e-01   -2.518325763365007e-01   -5.548955039536877e-01   +5.653668040128779e-01   -1.129874092434420e-02   +1.000000000000000e+00; +2.932559207182748e-01   +6.830742777895582e-02   -2.083561525333963e-01   +2.373908729202636e-01   +6.223218865213234e-01   -5.932737625347934e-01   +3.491622643179216e-01   -6.582847582717647e-01   +5.486876456529695e-01   +3.178302527272086e-01   +6.506226315196442e-01   +8.544712736964495e-02];
L3I_L2I_iGABA_netcon = [-5.210704427007314e-01   -5.618321212531456e-01   +6.608458220772180e-01   -2.942594234384269e-01   -5.713177464608196e-01   -1.354824571444816e-01   -2.222145789408997e-01   +4.994287105467094e-02   -6.959711892254750e-01   -5.760459909304826e-01   -1.048405709526405e-01   +2.407156409167719e-02; -4.477107544624205e-01   -1.686768374345073e-01   +3.218840704984975e-01   +3.704186868692499e-01   -4.999127194445422e-01   -6.367201907697423e-01   +4.260725286203947e-01   +8.881832313841397e-02   +3.360457785344761e-01   +5.250434934872720e-02   +7.186666431783963e-02   -1.424007346121958e-01; +3.594971339473338e-01   -4.079102856019998e-01   +3.158905041121217e-01   +8.119812666902489e-01   +6.103748163775014e-01   +4.856919964368683e-02   +6.213532438141656e-01   -1.462093760943043e-02   +1.838320533646304e-02   +4.218691504393256e-01   +5.508936044253906e-01   +1.532838617302694e-01; -3.810006193545912e-01   -5.472956624070245e-01   -1.474300937429724e-01   +3.370265358885312e-01   -1.381870071838873e-01   -8.746648964052052e-01   +4.857532229450562e-01   +4.528144758496382e-01   +4.068809327636147e-01   -8.183722248492320e-01   +5.992553180982946e-01   -4.746141015648457e-01; -2.738037063506556e-01   -5.209094190210998e-01   -5.867421320885837e-01   +3.450406436300965e-01   +1.546588400852911e-02   +1.444461610804090e-01   -5.843243326523736e-01   -3.534759041237938e-01   -5.730763028502559e-01   +7.247146741323053e-02   -1.558777555073810e-01   +1.419928248615838e-01; +2.745025330482034e-01   -1.969739212537160e-01   -4.314739368978316e-01   -5.827069376011424e-01   -2.660837358729736e-01   -8.926063586218363e-01   +5.047888113203880e-01   -1.290989188080156e-01   -1.582564139378638e-01   +1.000000000000000e+00   -5.661039126686029e-01   -2.347200857303942e-01; +1.795807927467560e-01   -3.047431267260213e-01   -2.500356303585225e-01   -5.359009936096014e-01   -2.642375482568380e-01   -1.138695905678563e-01   -6.354211776290839e-01   -3.887766081546377e-01   +4.653424125341933e-01   +2.015754270106043e-01   -5.662070973087027e-01   -6.313399053110953e-02; +4.197224311461393e-01   +5.696941543103822e-01   +2.343294097522428e-01   +2.520453500093104e-01   -7.360815863127617e-01   -2.335827724758955e-01   -2.836700959813745e-01   -1.396953344681235e-01   +2.437468791481276e-01   -3.538916494476980e-01   -3.064518529296603e-01   -3.048283109916087e-01];
L2E_L3E_iAMPA_netcon = [+1.548293320396758e-01   -2.921044490204274e-01   -8.649776731712852e-02   +5.564598464993588e-01   -3.923919516235000e-01   -9.382765049300201e-02   +4.111445455778975e-01   +7.782028219886880e-01; +3.502041481287199e-01   +6.322788853203948e-01   +4.076518286766805e-02   -9.274401899898375e-02   +6.795417728462084e-01   -1.000000000000000e+00   +2.978825502367896e-01   -5.834764030623293e-01; +4.046963116212984e-01   -6.315232274761982e-01   +2.710761412671266e-01   +2.211688712568791e-01   +7.313877552797140e-01   -5.881831854010892e-01   -3.698466929114719e-01   +2.817271941415918e-01; -4.016501910384629e-03   +6.864714892717663e-01   +1.040224604802589e-02   -2.534880357862040e-02   -8.639303864435141e-01   -6.765993857752289e-02   -5.884403008081995e-01   -3.274319425944957e-01; +7.404307272065039e-01   +4.993104694809876e-01   +7.209538151625123e-01   -8.045022354885696e-01   -2.863180504342938e-01   +3.194423037154081e-01   -8.996737009591543e-01   +9.370944918620264e-01; +2.248300932688953e-01   +2.044154739405760e-01   -1.242528003269612e-01   -6.379015111096815e-01   -4.914882543450482e-01   +2.161251178212891e-01   -8.266901261889489e-02   +7.241179787939332e-01; -6.250387725141242e-01   -2.273751043276419e-01   -2.254034740795232e-01   +3.195536581561139e-01   +3.176661659433165e-01   -2.953873775483046e-01   +6.362471807838274e-01   +3.702130574007475e-01; +3.353676068072108e-01   +6.963405406904150e-01   +1.551930863237048e-01   +6.631337962735712e-01   +4.269601538269743e-01   -1.218577496920752e-01   -5.302569669625964e-01   -2.293340910129804e-01; +9.357376679610693e-01   +2.396004252678607e-01   +6.405281819215702e-01   -1.443869675073784e-02   -8.681249875580559e-01   +4.311114613314519e-02   -8.521497940546431e-01   +5.441957676490414e-01; -7.343665055887870e-01   +4.461536057600398e-01   +1.602898017610769e-01   -4.659531711503669e-01   +2.460353285565924e-01   -2.233555048764089e-01   +8.356590939009182e-01   +3.462837516818218e-01; -6.430460507902407e-01   -1.359512583149340e-01   +5.124973115374495e-01   -6.284090276545508e-01   +1.509540038193251e-01   +7.131739600438298e-01   +6.363111417943688e-01   -3.420846370841444e-01; +8.903245184278183e-02   +1.414106901038482e-01   +4.567913312427697e-01   -2.955132142583014e-01   +4.054808493845709e-01   +4.502984763907603e-01   +7.415428138969259e-01   -2.175662263266862e-01];
L2I_L3I_iGABA_netcon = [+3.040970762123305e-01   +3.866941483452891e-01   -4.686964595445838e-01   +5.180498710647962e-03   +2.120837391164764e-01   -1.797436917287145e-01   -5.628003906847429e-02   +5.400867429939535e-01; -5.385953354504310e-01   -8.821141975050267e-02   -1.203239040793049e-01   +5.542575730329575e-01   +2.577663076878590e-01   +4.483560202455755e-01   +3.175151989197402e-01   -5.265889215041998e-02; +1.285906857380806e-01   +2.836461442303810e-01   -1.938483530583330e-02   +5.974910305972336e-02   -2.890675714266659e-01   -7.545842199878280e-01   -1.051682946179167e-01   -3.571388339984512e-01; -6.947523844554604e-02   +3.484877264344920e-01   +1.746939382578447e-03   -1.350413032807717e-01   +2.061190884828103e-01   -6.527313587015349e-01   +1.842095728627807e-02   +2.877444559720839e-01; -5.555792207755086e-01   -3.470928379117509e-01   +5.104253816521483e-02   -3.004174571135544e-01   -3.511102978379694e-01   -3.975324632775459e-01   +2.747000406673668e-01   +4.328793259565850e-02; +1.760675941766084e-01   -3.332730952456224e-01   -5.041064215252022e-01   -3.629275867617920e-01   -1.688230916617606e-01   -5.628600511356616e-01   -2.996496701024938e-02   -3.963503298364315e-02; +4.843045247550515e-01   +5.346172646627194e-01   -1.898187669603836e-01   +5.024891516733344e-01   +9.463666504594075e-02   +5.848835077661095e-01   +1.367979707200442e-01   +2.803194973858156e-01; +3.928368341465824e-01   +8.757795940659332e-03   -3.023462766498307e-01   +9.872484368034294e-02   +3.407644640484803e-01   +1.763674100501034e-01   -8.066476046320473e-01   +2.322278482042228e-01; +1.297973558644496e-01   -4.215643389820268e-01   -5.886493945281126e-01   -3.896210770116392e-01   +7.416280048019933e-02   +1.323102865868462e-01   -9.446345242430954e-01   +7.591556485246007e-01; -3.541717429070327e-01   -6.583901109910175e-01   -5.784781312906366e-01   -3.821072607543082e-01   +1.729309618803545e-01   +1.711719827083605e-01   +4.065753848193987e-01   +1.907472829718432e-01; +4.015274537795905e-01   -1.513695914512090e-02   +6.010555644698237e-01   -4.111930763678976e-01   +1.000000000000000e+00   +6.608786209599824e-01   -1.530190604555582e-02   -5.520691548300743e-01; -4.396122166602074e-01   +2.630455080259311e-01   -3.676950717461341e-01   +1.980794139022385e-01   +7.189522346837013e-01   -1.255192356259932e-01   +1.832896304322521e-01   -4.123288963837470e-01];
L3I_L3E_iAMPA_netcon = [-2.338164458629486e-01   -5.780089850643496e-01   -7.503703670432684e-01   +2.859960847950558e-01   -5.885666475059577e-01   -1.677550404707383e-01   +1.297554634029056e-01   -8.846160794092002e-02   -1.688292467796126e-01   -4.827595700688559e-01   -1.238894291671978e-01   +1.536896702408045e-01; +9.139919229603560e-02   +6.991424979449230e-01   -1.990340487006608e-01   -1.871761673382927e-01   -4.528189174259323e-01   -6.334173298265343e-01   +4.725387614180438e-01   -1.495971420934183e-01   -3.630449065345121e-01   -4.834092031665882e-01   -9.801267588715165e-02   +3.915416739614846e-01; +6.633976192777873e-01   -1.396068910425498e-01   -8.287283788751902e-01   +8.034673132849413e-03   -1.610794043935654e-01   +4.063446659128825e-01   +1.111315703639037e-01   +1.284278068824961e-02   +2.138967027161333e-01   +3.983034180674001e-01   +1.256488770692658e-01   +6.834847569141125e-01; +2.230382965878171e-01   -2.315436539505938e-01   +4.124557901954169e-01   +4.385540043063670e-01   -2.161841974185351e-01   +5.796909078579319e-01   -6.391429366616994e-01   -2.230121554272393e-01   +1.359213615086286e-01   +4.685697786234724e-01   -1.350323359718646e-01   -5.421579278034540e-01; -4.750808669837973e-02   +3.513759214059671e-01   +3.178785551487427e-01   +1.208121477890936e-02   +5.081095531246706e-02   +6.224546119353638e-01   +4.489710779123375e-01   +7.740000662853613e-01   -3.075919491546213e-01   +1.141119503623806e-01   -7.807077405719911e-01   +2.538977774238644e-01; -2.230560615086358e-01   -9.681081611844847e-02   +4.924000505881521e-01   -5.617397564908062e-01   +4.452437707587115e-02   -3.231796758911081e-01   -8.349087485311268e-02   -3.080134593059505e-01   +3.111967114556640e-01   +5.114606700709542e-01   -1.016792836609671e-01   -1.909555374169028e-01; -5.435927917297046e-01   +1.666568894969125e-01   +5.884922647383175e-01   +7.738795007598444e-02   +6.126131992555304e-01   -1.883434580418809e-01   +7.616454040001008e-01   -3.727708229437866e-01   +3.474047133461821e-01   -4.920455837923212e-01   -5.685517958519017e-02   -7.181017761024324e-01; -5.327403728648298e-01   +1.142581449143464e-01   -1.619977753692277e-01   +4.523540673936636e-02   +3.266966719288971e-01   -3.867398162110036e-01   -8.512796430946731e-01   +6.204767918472687e-02   +7.484348312956453e-02   +4.874499739833488e-01   -1.671672247329086e-02   -4.480589514560763e-01; -3.112117433744682e-01   -2.105241919544253e-01   +5.553134235923973e-01   -7.915300856657990e-02   +4.205835658625394e-01   -4.723253855031448e-01   -1.667673955673902e-01   -1.768615422342613e-01   -6.463630753328549e-01   -2.054944294153969e-01   +6.545540530428344e-01   +1.420855813321897e-01; -3.333680333795187e-01   -2.976404069277356e-01   -5.141668037890088e-02   -2.939419700019273e-01   -3.290213648556939e-01   +6.296694896325585e-01   -5.551832956515114e-01   -3.033323373287058e-01   -2.186238617608437e-01   -6.799137472970213e-02   -1.000000000000000e+00   +1.151075572360718e-01; +5.337572142153653e-01   +5.773349680552013e-01   +3.004030446895614e-01   -3.400854261803872e-01   -5.815136473600268e-02   -7.210661898967826e-01   +7.674650264000455e-01   -6.857843636189989e-01   +4.027869690560132e-01   +6.003281208875169e-01   +5.552001110264693e-02   -5.569404288229372e-03; +6.603261417834105e-01   +6.987367729350705e-01   +2.387098089110015e-01   -5.974295236733034e-01   +5.674710562842621e-01   +2.640458767880245e-01   -2.959147460350285e-01   +1.795309493299660e-01   -1.043293440195497e-01   +2.381159453628151e-01   +5.848269376656655e-01   -7.434417860149194e-01];
L3E_L3I_iGABA_netcon = [+3.676030655595957e-01   +3.618171940655414e-01   +8.355939771533233e-01   -2.240974046676349e-02   -4.940025784592462e-01   +6.358890625643497e-02   -3.457809927136913e-01   -2.492937920695342e-01   -9.890963273766501e-02   -3.626118499716898e-03   -6.001730292962313e-01   -3.458782913885105e-01; -2.647617686618711e-01   -6.482013461412356e-01   -5.405803514737657e-01   +8.123604220974397e-01   -7.675716291105157e-01   +2.927475254053107e-01   -3.402818237043656e-01   +3.509538353719510e-01   -5.202961824066767e-01   +3.862376091321709e-01   +1.651561820804025e-01   -3.088910623162351e-01; -4.418578637749349e-01   +1.476455229009011e-01   +4.992975547625766e-01   +4.341478810980123e-01   -5.778737033187995e-01   +5.691051848536104e-01   +7.685599667106258e-01   -2.560024325962990e-01   -3.015500403556537e-01   +3.953028467885734e-01   +3.983146410661580e-01   +4.635473559061019e-01; -1.505056781912222e-01   -3.587340410470947e-01   -4.918015869426874e-01   -2.359799446296748e-01   +3.349304618262146e-01   +6.929966992266267e-01   +3.554252573688033e-01   -2.780849432334048e-01   +1.189881157307992e-01   -9.984601709923012e-02   +2.508807016913566e-01   +1.082985191369371e-01; -6.968433018645825e-01   +5.743272138003725e-01   -1.639514170730589e-01   -2.974036249509801e-01   -7.938589513958481e-01   -5.709669401288152e-01   +1.223165042189301e-01   -8.629635022504677e-01   +5.537869571223621e-02   +1.420986790134099e-01   -5.628630484592827e-01   -3.212614190043891e-01; -5.259403701481598e-02   +2.386758538861194e-01   -8.267154167608637e-02   -6.902159784352702e-01   -5.115214832147520e-01   +5.800249705118343e-01   +1.668649306725766e-01   +4.663920307664699e-01   +1.558469258601738e-01   -2.009931525437690e-01   +7.094145414454510e-01   +1.344315306556652e-01; -4.238562498768934e-02   -2.659420010262236e-01   +1.285420089479748e-01   -9.413731952975651e-02   -4.454531565036509e-01   -1.014216515482402e-02   -6.725834774626854e-01   -6.739173284132622e-01   -7.726296616969832e-01   +1.183316606294695e-01   -1.484294269334412e-01   +1.898445481705320e-03; +6.205495026901207e-02   +1.692338623743434e-01   -2.443443189940992e-02   +3.997694031276072e-02   +3.312465010070514e-01   +4.881290139150610e-01   +6.690185126281873e-01   -3.062250020207988e-01   +7.397249469501811e-01   +1.407313043109938e-01   -5.449213613070343e-01   +6.987579480556498e-01; -5.128426594606700e-01   -2.311734499562111e-01   -5.283453672377473e-02   -5.686993743711444e-01   +2.366221653989334e-01   +2.138341403598051e-01   +3.299285041924759e-01   -2.440069094730520e-01   -6.517484759455752e-01   +4.590249584315420e-01   -3.827557633524565e-01   +1.405836684898909e-01; +5.480380515232635e-01   +6.769955985556445e-02   +3.096595317279080e-01   +6.978502985141425e-01   -2.960534660389585e-01   -4.689695535533119e-02   +5.316798250172458e-01   -2.328870189258993e-01   +5.179415598715228e-01   -2.976472744285384e-01   -5.956923636954838e-02   -6.683552800993516e-01; +8.162690343793737e-01   +5.215417071448439e-02   +5.974797052512092e-01   -1.712553377945693e-01   +6.355099625648228e-01   -2.370442019407933e-01   -8.005578472091282e-02   -2.787270164534321e-01   +4.920257028947417e-01   +1.853953413754477e-01   -4.372460656675213e-01   +3.387643493293675e-01; -4.158983523651640e-01   -6.657294319998545e-01   +8.764469668792298e-01   +1.115265767414797e-01   +4.905479340976731e-01   -3.533302396593598e-02   +1.000000000000000e+00   -1.719685196539102e-01   -3.398072501949240e-01   +2.792665342689790e-01   +2.101164457720861e-01   +8.203653158375448e-01];
L2E_Input1_iAMPA_netcon = [+2.698801526704011e-01   -1.000000000000000e+00   +1.588612580252748e-02   +2.112168355423270e-01   +3.280490912273001e-01   +6.421282891732470e-01   +3.563472478748159e-02   +1.995866205157991e-01];
L2I_Input2_iAMPA_netcon = [-6.468975933738611e-01   +5.066181812052148e-01   +2.411092107932163e-01   -4.358919488650864e-01   -5.112990137885067e-01   -9.154285935381354e-01   +5.234564089185378e-01   +7.321797291125488e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
