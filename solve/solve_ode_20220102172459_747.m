function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-5.339441474601778e-04   -2.204004174953464e-03   -3.170662407039354e-03   +4.828209073124498e-03   +2.216786303091868e-03   +3.116298036149843e-03   +4.671491202942277e-03   -1.528635140802621e-03   +1.731441018288755e-04   +6.482674269165045e-03   +5.166515679982928e-04   -1.897205189991670e-04   +4.699550345503678e-03   +4.301951980247559e-03   +7.783886877168574e-03   +1.094358153241209e-05; +4.576646474539672e-03   -5.752941764190250e-04   +4.212212502020892e-03   +5.346082604532714e-03   +2.469922102618502e-03   +3.349404568430828e-03   +6.229589009489715e-03   -3.598164948641483e-03   -7.387159209985123e-05   +7.754541419796041e-03   +8.080684007336251e-03   -6.989186806741065e-04   -6.940459826858352e-03   -1.540679843995280e-03   +4.071703425738806e-03   -1.382179373446090e-03; +1.580448830787943e-03   -3.442235279997052e-03   -4.529520383743545e-04   +5.161083958690750e-04   -1.988253233704436e-03   +2.758656796954515e-03   +6.228635296614924e-03   -1.506476426269724e-03   +6.466740868930647e-03   +3.254598411622696e-03   +4.777553638938550e-03   -1.480996881460029e-03   +4.021368194901459e-03   +7.459358794409302e-04   +3.021568098017977e-03   +3.940652813477565e-04; +4.692512321816397e-03   +3.684008989636376e-04   -5.227862557556299e-03   -3.857331447046178e-03   -3.006478426436547e-04   +4.310692797893722e-03   +2.329298603129239e-03   +8.994437842449965e-04   -7.228995683319882e-04   +1.420279141390316e-03   +4.265032462186790e-03   +6.335454239680214e-03   +1.331379543097677e-05   +3.118676833118103e-03   -2.376349317582483e-05   -9.382660429187032e-03; +2.845600379413785e-03   -1.292137960729195e-03   +4.594655262175253e-03   +2.340765431354753e-03   +5.004528554178263e-03   -4.166855837049889e-03   -2.474615345220762e-03   +3.868474591589528e-03   -2.428592317409184e-03   +4.515956053516638e-03   +4.011355156056379e-04   -2.053148727523064e-03   +3.745514980040109e-03   +1.900242314073298e-03   +2.677676294478734e-03   -1.575963523257140e-03; +5.176420192129914e-03   -9.734542568099461e-04   +6.103811607747889e-04   +3.235907988856114e-03   +4.376901670013860e-03   -3.945540047146379e-03   -6.244502075287281e-03   -7.556345829668354e-03   -2.400572384001061e-04   -1.295482200307004e-03   -3.356757765211673e-03   -5.489954896466227e-03   -2.637321288096585e-03   +3.160845569338331e-03   -5.555641967578372e-03   +3.502047716806483e-03; +3.633163919299448e-03   +4.055071760070987e-03   +2.252402864562539e-03   +4.329200928921604e-04   +3.624191473637304e-03   -1.082899407150638e-03   +3.073203010767077e-03   -1.886284726349145e-03   +6.845276862512866e-03   +9.678312664419246e-04   +3.759210933235433e-03   +3.866396073807786e-04   -5.428082507083446e-03   +4.105734403971079e-03   -1.027124285373825e-03   -2.389854649330019e-03; -1.883490371393315e-03   -4.896486935682145e-03   +5.446748476964349e-03   +3.538099094908563e-03   +2.102831093838304e-03   +9.914616904166944e-04   -1.010577651025644e-03   -4.713516908553223e-03   +5.900780492502929e-03   -1.617718594416089e-03   +6.183808599453330e-04   +4.306433160631663e-03   +5.105952494619539e-03   -3.815472996125019e-04   -1.819232975669290e-03   +5.494408432016578e-03; -3.339930690389540e-03   +2.862450028876206e-03   +2.143411881827463e-03   +2.793236794617409e-03   -3.082162336461241e-03   +2.912770965347357e-05   +3.258018973713409e-05   +8.771926611761207e-04   +3.709491437127030e-03   +2.253257570033122e-03   +3.398632239534010e-03   +5.477897724239766e-03   -4.960832214189194e-04   +2.126471908288255e-03   +2.014800567056033e-03   -3.249025421533814e-03; +3.259368902374723e-03   +2.637928840433977e-03   +9.043468952961821e-03   -2.146691832397394e-03   -6.525726718333479e-03   -2.790494871485020e-03   +3.545400320246228e-03   -4.931178301892378e-03   +7.772767584927329e-03   -1.478905441550412e-03   +2.095963894202055e-03   -3.676174058754134e-03   +1.868122573649334e-03   -1.528327886248436e-04   +1.493248866433359e-03   -2.614267338070004e-03; +6.356198645488524e-03   -1.506581481850279e-03   +1.958280616943327e-03   -2.719128882622082e-03   +1.761838133688582e-03   +3.166507028282316e-03   -2.449514789452194e-03   +4.309752226717329e-03   -1.964845857784607e-03   -9.554320863639778e-04   +5.288055709685965e-03   -8.605651947849709e-04   +1.049049436766277e-04   +2.212216491137311e-03   +1.077221268766002e-03   -1.247778473313609e-03; -2.110967095174028e-03   -3.949082918608565e-03   -3.200735895893401e-03   -2.169953420231977e-04   +4.830635491924639e-03   -4.593588663255919e-03   -1.069340572995919e-03   +2.900472933392306e-03   +6.687411273455268e-03   -5.679499931451502e-03   +5.426124104696089e-04   -3.009090420618212e-03   -1.751414832611308e-03   +3.337776381424319e-03   -4.994931515486302e-03   +3.677152125300671e-03; +9.735905618549990e-03   +6.961866464519142e-03   +1.888762207766346e-03   -1.876176495015888e-03   +8.977992153169135e-04   -2.955167794839353e-03   +1.886172255887526e-03   +1.099136708678025e-02   +6.586870125981680e-03   -1.164240124657627e-03   +3.473791436757218e-03   -7.451249690633402e-03   +4.716686653685204e-03   -2.913133166180993e-03   -2.290897937429745e-03   +1.391238784315662e-03; +7.082486307604408e-03   +5.661254382581396e-03   +6.423738675038170e-03   +7.451968218741875e-04   +1.575526734615572e-03   +1.521796128281276e-03   -1.724226834182848e-04   +8.704613652367535e-03   -3.040245380303916e-03   -3.803945971042519e-03   -2.829028523128014e-03   +6.420655845586072e-03   -1.444290901980824e-03   -2.085532130920797e-03   +2.041804163344347e-03   +1.978871065100808e-03; +2.754203054894302e-04   -2.069227872628842e-03   +1.114566630716567e-04   +2.764889751825262e-03   -2.474500539364301e-03   +9.010805777853851e-04   +1.060978415102627e-03   -1.279808965682749e-04   -3.190329658900960e-04   +6.195921489322948e-03   -5.111258760560344e-04   +4.693207007547408e-03   -3.459690578444635e-03   -1.123446992141039e-03   +2.093973551537607e-03   -8.226548373206310e-03; +3.298801918082844e-03   +3.601707338520279e-03   -5.674912927049464e-03   +1.637128502816836e-03   +8.634979039929189e-03   +1.728022407423581e-03   +4.313592045526917e-03   +3.470362695479488e-03   -1.635989866534650e-03   +7.206626168192874e-03   +2.608732114879647e-03   -1.207730708512576e-03   +2.514180797338278e-03   +1.412335918099401e-03   +3.909234246025350e-03   -2.605090923492424e-03];
L1E_L1I_iGABA_netcon = [+3.977060190157275e-03   +5.082715899519390e-03   +8.660696132108090e-04   +1.837660300147437e-03   -4.041526592131658e-03   +6.450176952175353e-03   -2.239796917221243e-03   -5.604713315051911e-03   +3.766410909271639e-03   -2.921162662861769e-03   -2.094569698727800e-03   +3.023109063828203e-04   +3.201824262053758e-03   +5.687870513270521e-03   -2.229709234788242e-03   +2.774996472442393e-03; -2.733229668780143e-03   -4.871542590560891e-04   +9.348579505694307e-03   +2.208749099271189e-03   -3.499495957035462e-04   +1.870425754665464e-03   -3.951312283837310e-03   +3.558575378538338e-03   +1.439819542050905e-03   -9.224682261243212e-03   -3.967136360251556e-03   +1.472038975456497e-03   +2.074392273225166e-03   +2.649033361836378e-04   +3.694776792928424e-03   +1.933689652306990e-03; +7.775756330425643e-03   +1.277114694466136e-03   +6.677263888868252e-03   -3.437380100669660e-03   -1.981106187956422e-03   +2.745248363033651e-04   -1.709553248052811e-04   +5.388913081105659e-03   +8.128541480510024e-03   +1.376483667067675e-03   +6.618889600514918e-03   +1.993208214614901e-03   +2.998279937951075e-03   +5.691280225633215e-03   -5.144542413203080e-03   -1.247215813983093e-03; -1.625260201561513e-03   +5.873520833838959e-04   +2.343284202384064e-04   +1.429832960418454e-03   -3.903955894507403e-03   +5.991038716909424e-03   +5.565975203481302e-04   +1.481185747773055e-03   +1.381777439285394e-03   -6.173965938478057e-03   +2.923178859677979e-03   +1.904815570073149e-03   +2.453846975903968e-03   -7.083615607265370e-03   -1.638138586942552e-03   +6.648571700493698e-03; +3.212810842861781e-03   -1.151967064424739e-03   +3.753841186927908e-03   -3.316169346585688e-03   -8.105140491264153e-03   +7.662351716503497e-03   +1.869087954431549e-03   +7.987141338391500e-03   -7.009642725374369e-03   +1.950757095338439e-03   +3.718605081296018e-03   -2.928042943439178e-03   -5.508935129929570e-05   +1.665871681003968e-04   +7.812243857093791e-03   +6.738420061879429e-04; +4.788777883540467e-03   +6.570739825545301e-03   -1.390889399638448e-03   -1.622107157527437e-03   +1.019650309486268e-04   -3.428424240641595e-03   +9.453294786380014e-03   +2.774310417783893e-03   +2.719191170432372e-03   -1.760509776847666e-03   +2.285127321743473e-03   -2.387516416826739e-03   +2.410702848391705e-03   -3.382728303266083e-03   +6.638433174404072e-04   -1.460959775712233e-03; +3.687211101381465e-03   -2.269176263169398e-03   -3.391885691273508e-03   +9.655615162254636e-04   +2.037653950608744e-03   +3.395476959559995e-03   +6.849959757482544e-03   +6.019801394019405e-03   +4.047126257917360e-03   +4.328024045900948e-03   +4.259710252650234e-03   +6.362693379739287e-03   +9.987201328368646e-03   +3.129748166797358e-03   -1.729122507002216e-03   +3.880720913922621e-03; -1.927834007422074e-03   -2.527135631227606e-03   +9.088684600953713e-04   -4.220107209402925e-03   +4.340690621880943e-03   -5.128750702475831e-04   +3.594355427027078e-03   +6.584497775129417e-04   +1.741995103042314e-03   -1.692732328087802e-04   +5.100065124744726e-03   +5.035717674672562e-04   +2.564761690885960e-03   -1.981255726262018e-03   -1.120428384819334e-03   +3.900457453276479e-03; +6.785683996354026e-04   +5.791403846733292e-03   +2.862932694517529e-03   +4.874310598768919e-04   +2.540076223417170e-03   +1.458797975655418e-03   +1.203200476656630e-03   +8.283434679036585e-03   +3.025409589912093e-03   +1.328763399867046e-03   +1.710703566526284e-03   +1.408316071750262e-03   +5.113673857660692e-03   +1.856542814288743e-04   -1.942387953442778e-03   +4.953633360048944e-03; +1.759838392081271e-03   +4.476802918507076e-03   -5.355274791031059e-03   +1.785024414290350e-03   +2.434861473698756e-03   +3.270971042764872e-04   +1.079272539229726e-03   +2.003323799060169e-03   +7.372274005866689e-03   +3.725078744707365e-03   -2.102040467062145e-04   +1.058050934949870e-03   -5.726189647750022e-04   +3.895499293167647e-03   +3.775885634294343e-03   +1.931156077945226e-03; +4.742038565307998e-04   -4.138716356830538e-03   +3.101702618897616e-03   -1.342359311747914e-03   +4.136058126063324e-03   -2.692311612545350e-03   +8.201677028089273e-03   +5.723894492969376e-03   +4.033812024628981e-03   +2.153203396842373e-03   +1.316967384244743e-03   +6.287889120385018e-03   +1.733520520457770e-03   -9.125615252252373e-04   +1.622227903394396e-03   -8.343651802504128e-04; -4.810196920480011e-03   +4.179055223730165e-03   +1.821781408591654e-03   -1.949392826781008e-03   -4.039253758752901e-03   -2.415337027296269e-03   -1.508138785009027e-05   +9.022544986965201e-03   +4.994096714051909e-03   -1.020750271876970e-03   -8.262835617123536e-03   -6.657341139536131e-03   -6.603227466061290e-03   +4.244407756629351e-03   +8.091884431435698e-04   -8.228681008932564e-04; -3.459895369185373e-03   +6.297387495545129e-03   -9.194181033336921e-04   +8.540303944576267e-04   +9.705642813076258e-04   -7.454756532590451e-04   +5.347902176744357e-03   -1.762473993112440e-03   +4.605732961523983e-03   +2.060080709339671e-03   +4.488540567956253e-04   -1.750690612091704e-03   +2.139119423271106e-03   +5.613913502002566e-03   +6.696329069638824e-03   +1.411334420761538e-03; +5.002840995841616e-04   +1.484506774399153e-03   -1.323599061154325e-03   +1.260203271991213e-03   +4.011209860629208e-03   +6.113727995229182e-03   +1.970016888159899e-03   +3.088367486377940e-03   -3.678194226090370e-03   +5.432625661909833e-03   +2.893512000786488e-03   +4.652111657882731e-03   +2.680791373495259e-04   +1.643251151106082e-03   -1.618227815451974e-04   +1.942752153190288e-03; -2.561988036082588e-03   -3.442607177147584e-03   +1.643796426803421e-03   +4.640713885231533e-03   -9.689814619474773e-04   +7.825624987089807e-03   +5.642986469728059e-03   +2.411113150730577e-03   +1.318654095385949e-03   +1.007912545095181e-03   -2.487256058280045e-03   -1.150552096122072e-03   -6.512013685682207e-03   -2.307956991075990e-03   -5.376923860131120e-03   -5.394609521702270e-03; +1.711500373391997e-03   +5.727857666008131e-03   -1.877678455396480e-03   +2.476712744091125e-04   +4.710328406845449e-03   +3.548598376429572e-03   +5.359792516696283e-04   -4.048240900980274e-04   +3.247930385952927e-04   -1.483536398196400e-03   -1.308990945393738e-03   -2.864162481369604e-03   -3.507480444082923e-04   +9.755940344523633e-03   -5.120295466480539e-04   +5.229809883874302e-03];
L2I_L1I_iGABA_netcon = [+2.046934850447976e-04   +2.615841483838314e-03   +1.463623093753124e-03   +1.802309541655183e-04   +4.996158706844080e-03   +1.256948575589132e-03   +2.869128359039700e-03   +4.299274568093526e-03; -5.650868895432380e-04   -2.571496489939945e-03   +4.270680374057699e-03   -1.409085887553562e-03   +1.683895727799128e-03   -4.860204468176665e-03   -6.757332355903916e-04   -2.612326884413977e-03; -1.104819673048597e-03   +3.135363915359699e-03   +6.672179754857600e-04   +3.649736750259952e-03   -1.984321308069380e-03   +6.893250377066609e-03   +4.392209578758951e-03   +2.104491404607697e-04; -1.663291569392390e-03   -2.367430956000454e-03   +2.874453661813158e-03   -6.147378386408807e-04   +4.149993814101433e-03   -4.778944369815642e-03   +3.915874381687657e-04   -2.158694554660757e-03; -3.213487702715470e-03   +4.530627289980028e-03   +4.031070223015356e-03   +4.452820099767212e-03   +4.447077459429616e-03   +9.360989606805726e-04   -2.635047615866146e-03   +3.663840405890623e-03; +5.042968546180808e-03   -2.513659557757438e-03   +2.480534570166414e-03   +2.693487640602166e-03   +8.033215345562434e-04   +2.358218442590992e-03   -2.683099626324733e-03   +5.590565437296687e-03; -1.793551221099868e-03   -8.069851771765718e-03   -2.720906925710277e-03   +6.322501917941876e-03   +1.163355872514024e-03   -4.787466588018678e-03   -3.300188476850892e-04   -8.604506431817349e-04; +2.210663958608403e-03   +5.029733168994757e-04   -3.554874905115496e-03   +4.305827393793409e-03   +4.373062614826935e-03   +2.152671746322603e-03   +4.802645368409950e-03   -5.176375304179823e-03; -9.859370271681116e-04   +5.969348382689028e-03   +9.795223178851447e-04   -4.920975426131239e-03   -1.485457546834157e-03   -5.658482601483365e-03   -1.167515943755372e-03   +2.777082340613145e-03; +1.436784291803276e-03   +6.198833365630680e-03   +5.628941835764630e-03   +2.287136265027505e-03   +1.854980699938869e-04   +1.503970630512387e-03   +5.125813837312925e-03   -2.655224874466520e-03; +3.722290520298471e-03   -3.773612431410468e-03   +1.182680226855383e-03   +3.649116937501721e-03   +3.088583768070079e-03   +5.240921535456382e-03   +7.962064527880224e-03   -1.846578379982722e-03; +6.745147226347910e-03   +5.702866789265446e-03   +3.771759072215530e-03   -3.423250124394211e-03   +9.837865520885038e-04   +2.665694393587608e-03   +2.662745390885245e-03   -8.568151707475209e-04; -4.217117158838104e-03   +1.374396913607957e-03   +2.486775120389479e-03   +3.907161955950224e-04   +3.746925414766462e-03   +2.242630609458783e-03   +5.195086607279766e-03   +2.224307546542608e-03; -2.762831540404893e-03   -2.449549788298296e-04   +2.977622090198708e-03   +5.492276778481128e-03   +1.575577389174129e-03   -3.994534840184346e-03   -5.477523247153518e-03   +3.545930360297901e-03; -4.260561004694231e-03   +3.999828168043953e-04   -2.163776933408663e-03   +4.338051861089239e-03   +1.382271765837199e-03   -1.376223015103252e-03   +6.633357441022625e-03   -1.050051309307470e-03; +1.917235824390223e-06   +6.512701524186394e-04   +4.760589076207318e-03   +4.120009414057055e-03   +1.155242012800986e-03   -3.420007725178972e-03   -1.577419702897293e-03   +4.645746826411915e-03];
L1I_L2I_iGABA_netcon = [+3.877365407836975e-03   -1.042224580123054e-03   +2.166508577954245e-03   +2.207760630558915e-03   +2.758322593683534e-03   +5.086757326634468e-03   +3.832617207717240e-03   +6.426989964606372e-04   +1.397171280160015e-03   +2.703022379995230e-03   -6.229916126722331e-03   +2.913050808665226e-03   +7.099687732007546e-03   +3.269181968595980e-03   -4.709409503482592e-03   -2.814813449444487e-03; +1.929403362677628e-03   -2.523696161562804e-03   +2.830502578969683e-03   -7.427856175242504e-05   +6.719406945963208e-03   +6.947631857981352e-03   -2.391603503660984e-03   -1.098197258326434e-03   +2.640374928690290e-03   -1.731584239771601e-03   +5.540754208012510e-03   -1.411864282540287e-03   +1.367308970104701e-03   -2.875508288967721e-03   -4.551729687798670e-03   -2.610816165006966e-03; +3.828336623758482e-03   -2.970148953748074e-03   -2.428594724549296e-04   +4.280288559068877e-03   +1.853512741388985e-04   -3.037094026490604e-03   +1.984844625076440e-03   +2.535565447521608e-03   -7.231033088866779e-04   +7.740495141248793e-04   +1.244534515067424e-03   -8.275014692289662e-03   -5.290088046345983e-03   +9.622450283878639e-03   -2.611445430115545e-04   -9.177106748732927e-04; +3.164683205631447e-04   -3.042287684436242e-03   +3.125877271871855e-03   +4.187217392515443e-03   -8.008119614334076e-03   -8.635357872844238e-03   +1.431540209364448e-03   +8.768995283385908e-03   -1.022925020496316e-03   +2.735388487307130e-03   +7.760855545197265e-03   -9.813477008832681e-04   +1.235456454116374e-03   -7.336320405932085e-03   +3.285862849176873e-03   +6.204476235053240e-03; -1.106012468434959e-03   +7.657732625000216e-03   +3.367106079339634e-03   +4.369993979685296e-03   -3.370195636870166e-03   -7.100136194799300e-04   -4.142824305589226e-04   +4.574130447957925e-03   +7.348581931931376e-05   +2.870726741597168e-03   -6.451318203252942e-04   +1.004091114533293e-04   +3.185117713594348e-03   -1.691112577189297e-03   -1.674970741769472e-03   -9.396829751381495e-05; +3.039467365559802e-03   +2.890835282238114e-03   +2.288291906560369e-03   -4.806180769709804e-03   +6.978592594535285e-03   -5.642742662054593e-04   +3.924061255241341e-03   +1.245366950020767e-03   -2.797292286185317e-03   -1.663823111442668e-03   -8.781757889494647e-04   +3.813726252009968e-03   +8.702471038286042e-04   -1.665730003198277e-03   +9.356423242837537e-03   +2.567155095289327e-03; +3.494609578598064e-03   +6.034465043924900e-03   +2.343784717937428e-03   -1.220835596494015e-03   +4.332989561643748e-03   +1.787584941041435e-03   -1.786834023224183e-03   -1.390826389263048e-04   +3.948302343321992e-03   +5.875997106280398e-04   +5.775387654003399e-04   +2.844754131762893e-03   +4.134969217041103e-04   -1.681880675601836e-03   +3.816806720942592e-03   -4.201129815808185e-03; -6.235635777214266e-03   +6.781161590373888e-03   +2.886620109998980e-05   +3.352499854869287e-03   -3.143909778311722e-03   +1.018123691200687e-03   -2.163149144258567e-03   +3.928166473192737e-03   +5.938188568230119e-03   -8.507673318969893e-04   -5.069837390015738e-03   +1.478859051996892e-03   -4.236788261807067e-04   +1.026729154484486e-03   +8.086662484601752e-04   +3.530835911754895e-03];
L2E_L1E_iAMPA_netcon = [-7.836527963416386e-04   +5.857724059188782e-03   -2.850507350643699e-03   +2.116790678732515e-03   +9.538246228246583e-04   -3.064969921490509e-03   +4.186089714601813e-03   +8.174382042153107e-03; +7.185330954726947e-04   -1.392364427557290e-03   -8.882535082942549e-04   +6.176434940830694e-03   +3.012582269243049e-03   -3.939333808455022e-03   +2.717072328439262e-03   -3.033506737230107e-03; -1.958977136274609e-03   -3.973066717711279e-03   -4.507543626852020e-03   +2.010440399321956e-03   -5.484130381469990e-03   +4.517415258692242e-03   -1.338287373307777e-03   -2.346179778308235e-03; -7.445249066765735e-03   -2.742468866079065e-03   -1.448748687342950e-03   -1.226653542115808e-03   +4.301604416710790e-03   -2.813048531709554e-03   +1.974571306419277e-03   +4.220579392075320e-04; +2.825589940431022e-03   +2.789106214956477e-03   -8.351129502621618e-04   -2.033422937231058e-03   +2.061004845461739e-06   +1.054307802386669e-03   -2.491998769916027e-03   +8.872055956118303e-04; +9.973670425887619e-05   +3.198956243177966e-03   +5.367303639433558e-03   +3.406885829313497e-03   +2.100671647525262e-03   -1.438306907290644e-03   +6.512535307938895e-03   +7.910100839697579e-03; -1.790752399801736e-04   +1.726791809241154e-04   -3.605418932452900e-03   +4.285665591308668e-03   -5.663882923381075e-03   +8.954857704234123e-04   -7.201177545536841e-03   +6.880949410440363e-03; -6.188797082208206e-03   -5.187242672577271e-03   -4.981796665114209e-03   +5.399195773079830e-03   -1.207791707136657e-03   -1.950699605022060e-03   +7.124102690795954e-03   -2.058331657260899e-03; +7.247540326350240e-04   -1.966968220093132e-06   -7.067630604185740e-04   -1.969647841150298e-03   -2.022823715788067e-03   +3.626642867400541e-03   -9.978307300212901e-04   +5.805963539492694e-03; +4.198235215108966e-03   -2.465934189342259e-03   -3.592964793187636e-03   +2.614551884876192e-03   -5.274744632315381e-04   +9.848706085325036e-04   -7.245158936081918e-04   +4.963048135944958e-04; +4.166467595808831e-03   -2.200793226223430e-04   -4.957618056227993e-04   +8.731584404596594e-04   +4.467724782788534e-03   +2.935991032549752e-03   +2.574739554570206e-03   -4.826035331078195e-03; +2.029926296329924e-03   -1.191715196234916e-03   +1.261881436165740e-03   +4.010725850909760e-03   +2.689045103094855e-03   +1.520168462378182e-03   +9.974189848527756e-03   -3.131647961941190e-03; +5.686116621125888e-03   +1.969994385415048e-03   +7.177362557430458e-03   +5.657276306545297e-03   +3.608276474478395e-03   -2.519898055538296e-03   +6.245971250427927e-03   +5.617761456203813e-03; -3.161073230564854e-03   +1.537752126500104e-03   +1.235553726337175e-03   -1.992622734482896e-03   +5.687794098563476e-04   +5.742368695008321e-04   +4.300657531247002e-03   +2.344581340141273e-03; -6.382211226073083e-03   +5.109717135287726e-03   -7.060501496703826e-03   +5.608722202404908e-03   +2.527235040220375e-03   -5.539171644454631e-03   -7.794808190901509e-04   +2.098290739110724e-03; -2.854147712271798e-04   +1.345637276059528e-03   +3.321317245228262e-03   -1.744912026825004e-03   -1.680729390644761e-03   -3.150980450048696e-03   -2.528229930531864e-03   -2.269412607242517e-04];
L1E_L2E_iAMPA_netcon = [+5.211355810230528e-04   +3.022534768411008e-03   -3.736537593757543e-03   +2.052956634338558e-03   +3.075086170291620e-03   +7.410023285410832e-03   +4.763198311416414e-04   +3.089162038871679e-03   +2.071135937988015e-03   +1.671407502720351e-03   +2.587665215463152e-03   -8.653563504927690e-04   +6.339015909244745e-03   +1.298392243859547e-03   +1.086101591499409e-03   +1.297423210607829e-04; +1.433539854358511e-03   +6.941739410318219e-03   +5.574850277861616e-03   -2.337401801131505e-03   -1.695718078607672e-03   +2.835566374900531e-03   +3.953597747415878e-03   +1.483093359948265e-03   -4.558157175827591e-03   -1.971246692983421e-03   +1.631828761766815e-03   -1.551965088413966e-03   -3.571495989696782e-03   +2.529986976247094e-03   +4.882465934192701e-03   +4.646041101493722e-04; +2.638041346472117e-03   +4.185508939468255e-03   +3.920873561821264e-03   +7.636592141737222e-03   -4.532547737616250e-04   +1.021486254558749e-03   -5.710053588083713e-04   -1.414415182052426e-03   -3.228120287795286e-04   -8.476043124091620e-04   -2.423318269539747e-03   +2.985521756120963e-04   -7.234158085496323e-03   -9.701485740457776e-04   -5.312935920010539e-04   +2.233764672163381e-03; -6.533297878180653e-03   +4.427493493727458e-03   -2.048300323744548e-03   -4.172535763012816e-03   +3.225249406985540e-03   +8.857035029525144e-03   +4.694885008465743e-03   -5.928276386387712e-05   +1.882329276197000e-05   +4.274152982563855e-03   +5.021847848615858e-03   +2.523190741573106e-03   -2.834584094691343e-04   +4.988049634755735e-04   +4.558158900114745e-03   -1.905862878424318e-03; -7.489414716931478e-04   +1.102205578966808e-03   +1.279194239136593e-03   +2.218584747528754e-03   -2.984979786405217e-03   +4.334134001938953e-03   +2.159525232702056e-03   -1.594396766710911e-03   -2.566675858247270e-04   -6.527414515400563e-03   -2.563622217158855e-03   +8.872648398868122e-04   -1.683748024435307e-03   -3.505514268433371e-03   +8.319101584182103e-03   +1.373707559674767e-03; +3.516725669962775e-03   +2.366084359986664e-03   +1.001532232870619e-03   -2.234691272472445e-03   +5.197618743859174e-03   -5.626263007299969e-03   -1.190569191803261e-03   +3.780152843060425e-03   -3.011889642031322e-03   -5.432627461939697e-04   +8.311875567668978e-03   +4.319183720106361e-03   +1.619777055792342e-03   -8.258580829448673e-03   +9.543976253386277e-04   +6.035899494975658e-03; +3.067157087558465e-04   -8.757707335699103e-04   -2.839020339005127e-03   +2.621369164178335e-03   -4.971191461804968e-04   +3.721283726466078e-03   +6.878640679169976e-03   +4.959176416924452e-03   +9.073992552458289e-05   -3.156425931144278e-03   -2.534349301035813e-03   -2.524324056628960e-03   -4.312805623701907e-03   -2.801742810695223e-03   -1.439717343813913e-03   -1.965906628645079e-03; -6.199307854881493e-03   -1.063356166606165e-03   -1.237863235909642e-03   -1.353188702340912e-03   -1.733549178353655e-03   -2.105450054245530e-03   +5.532274835646448e-03   -6.271298703674933e-04   +4.473606577072290e-03   +3.213051541277394e-03   -2.867786031568745e-03   +9.156234996004304e-04   +1.932396153222959e-03   -2.004481813927360e-03   +2.351903330497893e-03   +2.292878263636992e-03];
L2I_L2E_iAMPA_netcon = [+3.462579976770006e-03   +7.510816630147888e-03   +1.498630057806353e-04   +6.192246491373691e-03   +2.812908594617692e-03   +4.891217214885027e-03   +8.490041911727898e-03   -2.178435725564216e-03; +4.433653767228451e-03   -5.206919713092279e-04   -2.638992704326106e-04   +5.792959959554304e-03   -2.820091213293948e-03   -9.157610980384645e-04   -1.845044048453723e-04   +2.845880090234025e-03; +5.822780326525119e-03   -3.387901994301741e-03   +3.954450928479734e-03   -2.823023336714981e-03   -1.581056302807180e-03   +2.157089256733109e-03   +6.541442961425488e-04   -2.724186618592196e-03; -1.278169030976941e-03   +2.253325265477826e-03   +7.367864794382244e-03   -2.013706808482094e-03   +3.922437622857942e-03   +3.380571512396110e-03   -6.249934545415661e-04   +8.673689693130569e-03; +3.848932850552002e-03   -9.258893778362961e-06   -2.581676217792857e-04   -3.332500364125747e-03   +5.922698552888354e-03   +2.174874800658301e-03   +1.485782333723430e-03   +2.038160397944552e-04; -8.147298549274575e-04   +6.497251763858809e-04   +7.135645781104469e-03   +2.141843512093045e-03   +7.516128288294788e-05   +1.486307563211939e-03   +6.972891241178487e-04   +3.448024839928544e-03; -2.032853526475770e-03   -1.516537680832091e-03   -2.189461765815563e-03   -8.350307850909983e-04   +5.343631413781460e-03   +1.084967247373528e-04   -7.779810947347361e-04   +2.026067721422696e-03; -3.425921190840503e-03   -2.229244824787251e-03   -2.280719800972551e-04   -6.557409284606611e-03   +1.677810660601807e-03   +1.024425589116227e-03   +5.904071043875611e-04   +2.151723256777883e-03];
L2E_L2I_iGABA_netcon = [-9.158714497768032e-04   +8.461577053257701e-04   +5.262540258950598e-03   +3.805881218163381e-03   +7.671795847719338e-03   +4.803551547375006e-03   +1.274079631634074e-03   -8.024631351261587e-04; -1.464227620389152e-03   +4.406223768121611e-03   +1.938551275056445e-03   +6.192912878333267e-04   +2.880389451751083e-03   +4.387278632913013e-03   +5.597004764157855e-03   -1.748648532615996e-03; +6.369143923664717e-03   -7.698271287944287e-04   +2.314658934387075e-04   +1.492656865196776e-03   +3.395733274886288e-03   -3.466152267471297e-03   -2.922087536029610e-03   +3.210756803440754e-04; +7.815813906008591e-03   -1.546533498315797e-03   +8.837974371275640e-04   +5.856145954399607e-03   +5.980441714775946e-03   -1.740979688610563e-03   -5.067377017319567e-03   +1.519899267349230e-03; +2.039248863032101e-03   -1.081744647708697e-03   +4.254869567508191e-03   +8.084506075271464e-03   +8.348645646592568e-03   -1.655170406472731e-04   +4.217524499163647e-03   +4.295769656777281e-03; +4.721288432811178e-03   +1.028619834154987e-03   -1.620696845530273e-03   -2.739471646029278e-03   +2.587451279245474e-03   -1.764769454577518e-03   +7.935479927327261e-03   +1.826170443726747e-03; +4.880801863018570e-03   +5.924865935049779e-03   -5.033160718668746e-03   +1.716161196159232e-03   +2.111725303588860e-03   +1.203865360625795e-03   +2.820894412742327e-03   +3.647202682291794e-03; +1.066637862036599e-03   +1.897105017306377e-03   +3.877339586853439e-03   -1.643033249103792e-03   -2.679149198384874e-03   +1.113723463357438e-03   +3.810141843577017e-03   -3.122977540601641e-03];
L3E_L2E_iAMPA_netcon = [-1.594454075650407e-03   +8.722270304518944e-03   +1.015906446743763e-03   -5.053738959594597e-04   -4.194075548816903e-03   -1.131469202644740e-03   -1.998237924230182e-03   +5.146196570853770e-03   -1.667540158348038e-03   +2.904319332723939e-03   +3.947370542517660e-03   -2.454189316450986e-03; +3.995286958006705e-03   +2.876778621290265e-03   +3.806315142040037e-03   +1.534274841682925e-03   +3.061066151879040e-04   -2.137380000277121e-03   -2.071731733582890e-03   -1.940416640655654e-04   +2.443841911802241e-03   -8.420575508685229e-04   +1.927768504266568e-03   +3.219076554111157e-03; +1.538710598166256e-03   +4.701856111596546e-03   -1.332485430067370e-03   +2.690884960903521e-03   +2.995889808162167e-03   +1.091705853275580e-03   +2.833386021526029e-03   +4.642143664525899e-03   +8.452819845844108e-04   +2.243055342303968e-03   +2.318479993853520e-03   +6.502827004508404e-03; +1.166033845202609e-03   -1.576219718135751e-03   -1.342804389611412e-03   +1.633604139440925e-03   -3.870906357707984e-03   +2.703310160329919e-03   +9.763211254290284e-05   +3.864952911561787e-03   +5.038279689329709e-03   +5.372066589553082e-03   +4.324993953591495e-03   -9.790900450055758e-04; -2.413955406494302e-03   +3.119051903257409e-03   -1.083360653557856e-03   +2.132239785865949e-04   -3.698669329767204e-03   +3.157475197464541e-03   +3.285522451085308e-03   +2.238609525885637e-03   +3.026923440142538e-03   +7.881273304808593e-03   +7.758666935629466e-04   +2.509419067226515e-03; +1.511739842080599e-03   -3.097776827977847e-03   -1.477807856294222e-03   -5.862224108990882e-04   +3.045063596069861e-04   +6.847009206346121e-03   +6.323012775903566e-03   +6.912475927081851e-03   +3.314893228313795e-03   -6.227793331392843e-03   +3.051784609229724e-03   +1.556263273320718e-03; +6.381089030660442e-04   +3.453590846987761e-03   +5.863589433117032e-03   +5.494019847547275e-03   +9.995539732105170e-04   +4.318725712310266e-03   +3.547623854434758e-03   +9.715634458665880e-03   +4.728998226387173e-03   +8.736839992957610e-04   +1.298138742393784e-03   -5.585563110069965e-03; -2.712094474976992e-03   -5.483636096159000e-03   +1.734463567216119e-03   +1.814657908025794e-03   +5.344103142632467e-04   -1.061809977482176e-03   -3.238852409672521e-03   +3.688434622012539e-03   -2.641879131668767e-04   +2.065174578642474e-04   +1.436449737017341e-04   +3.926752560556690e-04];
L3I_L2I_iGABA_netcon = [+1.122047707743069e-03   -1.219774435603668e-04   -1.053950080398842e-03   +2.426587812754240e-03   +3.020209489078680e-03   -2.916835502654289e-03   +2.321747266620691e-03   -7.638360153757486e-03   +2.220433078120814e-03   +5.047564749005239e-03   -4.015903934324101e-03   +1.571240183253002e-03; +4.336849785149793e-03   -4.901874640078506e-03   +5.459019776799534e-03   -2.301199639124033e-04   +5.188544852304117e-03   -5.886785745608050e-04   +2.952740929997211e-03   -1.427522079999401e-03   +5.288116352421516e-03   -2.610415835355222e-03   -6.509398652827871e-03   +2.724598453710426e-03; +6.273811875700182e-03   +4.704752776508597e-03   -1.255495669637627e-03   +1.431003275550096e-03   -4.426591794268032e-03   -2.192025436150952e-03   +4.050880585828025e-03   -2.160437373841343e-03   +6.760454621003074e-03   +8.251441873112443e-04   +1.134940928791948e-03   -4.587769397105964e-03; +3.565137709909227e-03   +2.199359183376682e-03   +3.450207327853089e-03   -4.081532906543525e-03   -1.577581423277860e-03   +9.131595065287979e-03   -1.822415372335864e-03   +3.815861372129958e-03   +3.246806185308905e-03   -5.311669496546705e-03   +1.519367120538921e-03   +1.797556923498008e-03; +2.134578431508240e-03   +7.196632344579487e-04   +3.906310201559357e-03   +3.328518930498918e-03   +1.008391089390788e-03   +3.754665965765276e-03   -3.702393171545319e-03   +6.257744871284541e-03   +3.596689479308049e-03   +8.037761292039326e-03   -5.704746259534479e-03   -4.525862099639814e-03; +1.323159216551621e-03   -7.191618042464286e-03   -2.068909240751046e-03   +1.870792405836732e-03   +5.103119004454195e-03   +4.137442624556193e-03   -6.902690625558325e-03   +7.044446608888034e-03   -1.196357588283260e-03   +1.504521215745491e-03   -4.167936560592415e-04   -1.923591408361411e-03; -5.325624472331313e-04   +2.061443861458199e-03   -2.617053798871276e-03   -2.664828139940865e-03   -1.124915825891153e-03   +1.884552073204973e-03   +6.405726773008010e-04   +3.095603457187253e-03   +6.581843967815003e-04   +4.241913368147150e-03   +3.566746974665607e-03   +2.185855339579338e-03; -3.795998598416439e-03   +3.245501784639164e-04   -3.785915709608143e-04   -5.537335370765926e-04   +5.643106286681784e-03   -1.278779175303900e-03   -4.974926024985708e-04   +3.944153400262476e-05   +3.370740274745003e-03   -2.306906421552039e-03   +6.967569249943534e-04   +3.729789598890933e-04];
L2E_L3E_iAMPA_netcon = [-8.079543754816361e-04   +1.584335897787225e-03   -1.832900975721268e-03   +3.843922736213597e-03   -1.904405948551734e-03   +2.957118975835534e-03   +2.117888357919596e-03   +5.126255735367118e-04; +3.019330294033652e-04   -8.937477363750814e-04   +2.481486714393595e-03   +8.228890347747844e-03   +6.470190074160438e-04   +6.463697723335068e-03   +4.066489270850903e-03   -5.215850668112724e-03; +1.377364676709710e-03   +1.928456983356296e-03   +3.699349696080846e-03   +5.039512488746344e-03   +3.858898771358387e-03   +4.517062773656292e-03   +2.574485297048802e-03   +7.815576379735291e-03; +1.612819622996706e-04   -2.561704108028735e-03   -7.794343954205802e-04   +9.760960537801382e-04   -2.040239235979011e-04   +4.873698984837048e-03   -5.900172280991359e-03   +7.627809036149525e-03; -2.337215093461867e-03   -3.648576837956720e-03   -2.017507346484820e-04   +3.532054499130254e-03   +4.730331706734525e-03   -1.776279544414613e-03   +5.765586239653226e-03   -2.117981981569545e-03; +5.611239028185014e-03   +3.099978152210137e-03   -4.192877338086536e-04   +2.634215583326542e-03   +4.171821857774629e-03   +4.880749582543972e-03   -5.341416973529912e-03   +1.997528638861667e-03; +4.351912198533975e-03   -2.053979168460995e-03   +1.142944565324257e-03   -4.585970330483719e-03   -6.194756976706584e-04   -1.872281215569114e-03   -2.182819482428460e-03   +4.990285411049436e-03; +4.940652196370169e-03   -1.481765673564600e-03   -1.311254171205203e-03   +1.176618713456082e-03   +3.964608722788585e-03   +1.849565341878231e-03   -8.281621313723426e-04   -1.543600524995144e-03; +1.276883031495581e-03   -7.508820573534372e-04   +3.054056579430758e-03   +3.803793010939874e-03   +1.871662463515899e-03   -3.286321153879404e-03   +2.318224339510610e-03   -3.759898256302693e-03; -1.598958890071251e-03   +1.844856867095186e-03   -4.512189300502341e-05   -6.168454037367288e-03   +4.128561884870095e-03   -2.649358040535745e-03   +2.488972561365590e-03   +7.733001395351304e-04; +6.032626996999195e-03   -1.232334422250811e-03   +3.074753696276769e-03   +2.653608837240578e-03   +4.596499479439526e-03   +5.765315799676204e-03   +1.907288493519497e-03   -4.041698352931173e-03; +5.299433510043802e-03   -1.391988328158491e-03   +4.623461588287040e-03   -1.862584255396704e-04   -8.254513111267685e-04   +6.062230938410050e-03   +8.959003723844887e-03   +1.898365968583994e-03];
L2I_L3I_iGABA_netcon = [+1.858826452380558e-03   +4.024885868674376e-04   -2.307661083857661e-03   +1.234590887464445e-03   +7.942956514716791e-03   +1.534834842501659e-03   -1.112440488302877e-03   -2.258315375390527e-03; -1.087549893751004e-03   -4.767429565581095e-04   +5.428731381788623e-03   -2.828556255634608e-03   -3.679118283640983e-03   +7.478008278167244e-04   -5.750103858082271e-03   +7.569965334401320e-05; +8.596636188540880e-04   -3.473322416148333e-03   +3.975647279992202e-03   -1.593878198159434e-03   +3.795502923717507e-03   +1.031251684805569e-03   +8.023631151174247e-03   +2.568909755022266e-03; -3.675735659405579e-03   +4.346730239197606e-03   -3.936279355581908e-03   +5.541371046925758e-03   -6.928218712947264e-03   -1.180913601889118e-03   +4.032584439212440e-03   -4.051593146321599e-03; -1.219173229732058e-03   -4.557539636324139e-03   -3.661169836109812e-03   -9.897153712463982e-04   +2.202787386344107e-03   +2.368531665180502e-03   -2.332278529047681e-03   +3.547988516495306e-03; +2.300697571342789e-04   +1.519619207795701e-03   +2.758014937344275e-03   -1.783697175194867e-03   +2.016541445617353e-03   +5.985016830714683e-04   -9.852780331719695e-04   +6.409819192146063e-03; -1.684380121354946e-03   +4.012095373300761e-03   +5.531503317790030e-03   +2.854440038812177e-04   -3.645142001938423e-03   -2.505133144643830e-03   +4.012799059290754e-03   +4.428616244456338e-03; -5.276486814909070e-03   +3.523474699344872e-03   +7.788249436154001e-03   -1.875939844719361e-03   +1.903216490198223e-03   +4.685449576639316e-03   +9.689155105731439e-04   +3.237971426191054e-03; +4.014701719546538e-03   -4.321583796363465e-03   +2.207113480654668e-03   +3.828600041935408e-03   -2.842217909658119e-03   -1.285050499538301e-03   -1.784049062566336e-03   +3.578496070480780e-03; +3.628149725872061e-03   -1.442693168012181e-04   +4.615945122091266e-03   -1.041495813631459e-03   +6.116676879059028e-03   +4.627575004921964e-03   -1.687379338322591e-03   -1.787592028519297e-03; +2.203706253771370e-03   +3.218635013032596e-03   +3.294112388473356e-03   +1.028759364714706e-03   +1.693348445992370e-03   +3.955446491192012e-03   +5.594778437701455e-04   +5.970613823301257e-03; +6.125090740936865e-04   -4.247005807660229e-03   +9.958238153470172e-04   -1.321070256943878e-03   -6.255417663710698e-04   +3.303069136051748e-03   -2.094692985314938e-03   +3.786440580608227e-03];
L3I_L3E_iAMPA_netcon = [-1.285270851799399e-04   +2.418459285707684e-03   +3.354497636391316e-03   +2.584839195830520e-03   +7.912842045153034e-03   -2.415483298606692e-04   -2.852323856301164e-04   -4.947931513884648e-03   +7.709256002183160e-04   +3.304047575442789e-03   -2.283069653960975e-03   +2.403437038947877e-03; +4.377667424860210e-04   +7.256433914878554e-03   +2.330048830992527e-03   -2.216216089319603e-03   -4.301264553338764e-05   -5.804172015106935e-04   +5.369024742251350e-04   -7.756961032415724e-04   +6.785941226968923e-05   +3.282648794845643e-03   -6.714727754786659e-04   +4.984207689980437e-03; -1.599667590825006e-03   +6.683043178344865e-03   -2.511599105661794e-03   +5.026830019240829e-04   -8.422648371406741e-04   +5.617787213730606e-03   +3.754880564741347e-03   +7.766881802383850e-04   -2.613750816483785e-03   +1.321139178860490e-03   -5.276637999663667e-04   +2.569704820091287e-03; +3.747082738930729e-03   +3.129771357910059e-03   +2.868247002292228e-05   +8.597877648116655e-04   +8.938128547943153e-03   +3.864783130748898e-03   +9.979293874886803e-04   -9.794425525593107e-05   -2.940349717138827e-03   +6.375103157444622e-03   +1.076556144122032e-03   +5.672655671172306e-03; -9.227182916460352e-04   +4.408034018581541e-03   +5.270824168685921e-04   -1.890043586800628e-03   +1.663040923756030e-03   +2.808471300531201e-03   -3.727301408945099e-03   +1.348244320389425e-03   +5.683549130036102e-04   -1.274807122668406e-03   +5.039759606779360e-03   +4.735430614205890e-03; -3.800375823759473e-04   +3.099658914087642e-03   +1.356381472424353e-03   +6.413437006318498e-03   +1.065432410578552e-03   +2.724933187339604e-03   +5.075902827823787e-03   +3.418606566773758e-03   -1.318585804312930e-03   +3.920904881720848e-03   -2.188374281116949e-03   +1.057869523610585e-03; -2.954712769544298e-03   -2.930077591914588e-03   -1.871991690247998e-03   -1.020230561615834e-03   +2.360037168912795e-03   -1.012216835372351e-03   +1.887935025144935e-03   +1.440433221335460e-03   +3.373706733898002e-03   +2.426968680944674e-03   +1.947287902911152e-03   +6.363963185096204e-03; +4.661710646338693e-04   -4.841026935302953e-03   +2.938820130010923e-03   +3.155365541690050e-03   -1.884771060243373e-03   +1.035634096267320e-03   +4.310240640119645e-03   -4.466645839180952e-03   +1.404190154515928e-03   -4.965903766608174e-04   +5.240226379295915e-03   +3.380827746674107e-03; -1.650864257816241e-03   +3.153169282646619e-04   -1.391342893634087e-03   -6.148367568883647e-04   -4.545106120891693e-04   -6.655447070260153e-04   -4.483344101199503e-03   +1.000636713720083e-03   +3.646858113186666e-03   +2.808862524262010e-04   +3.267855863603901e-03   -3.463804981139464e-03; +2.423180497474160e-03   +5.812091164900160e-03   -4.546343030924873e-04   +4.648010740208682e-04   +3.277270812192963e-03   -3.766173593578565e-04   +2.111099286658248e-03   +2.663983658693700e-03   +3.734736446005679e-03   +5.105663485864228e-03   +2.626479106933886e-03   -3.426434198891887e-03; +7.093129082865737e-05   -2.405521287796742e-04   +4.440074464042835e-03   -3.955405914742543e-04   -5.833560279173157e-03   -6.090129190952299e-03   -1.233851596548994e-03   -1.469441089557053e-04   -9.855851637047563e-04   +3.970656227785356e-03   -1.378794170607938e-03   +5.419614104076567e-03; -2.335621770614250e-03   -2.672974047416510e-03   -7.188760733718050e-03   -1.417987694095446e-03   -3.078532440379114e-03   +2.854012427625053e-03   +1.361477430384868e-03   -2.206205992655158e-03   +1.404802338432193e-03   -4.469008819740766e-03   +4.559335216070698e-03   -4.480927236796056e-03];
L3E_L3I_iGABA_netcon = [+6.252866617469544e-05   +6.591290267066209e-03   +4.304502604632769e-04   +5.892315015692869e-04   +1.321585297790570e-03   +6.044838056473462e-03   +3.580359792565593e-04   -3.311306388310432e-04   +2.440996747232150e-03   -1.669368651187165e-03   +2.530340132418518e-03   +2.151151474021085e-03; +2.976101675713479e-03   +1.214839690368826e-03   -2.559429485606608e-03   -5.591137167950607e-05   +1.990483732911347e-03   +7.080464427993932e-04   -1.468998784936880e-03   +1.815499303802346e-03   +3.065492918533641e-03   +6.034296486336772e-03   -3.127929004502011e-03   +3.432649420221536e-04; +1.258311157177350e-03   -2.157314153282157e-03   +3.529218258952650e-03   +1.400795683208657e-04   +2.049553580841248e-03   +1.456225652669920e-03   +3.027070941067557e-03   +6.187416996588074e-04   -4.440805986588672e-04   -1.418090358764667e-03   -2.614842950745779e-03   -1.973438100940332e-03; +1.490174526958271e-03   +4.999447085579482e-03   -4.275091527766544e-04   +7.724584194458817e-03   +3.311355683771753e-03   +1.268666316402828e-03   -2.124601683269011e-03   -2.532965256907792e-03   -5.329919640668764e-03   +8.296207039260711e-03   -1.326007947039122e-03   +2.621291324788872e-04; +3.931012953215777e-04   +2.446933534790824e-03   +1.551797828821599e-03   -9.501757067873177e-04   -1.888223980044066e-03   +6.107660644642798e-03   +7.412113508806166e-04   +7.240060219576784e-03   +2.654306882312238e-03   -8.739490607635996e-05   -4.480214144957154e-03   +5.882611258890598e-03; +4.924379366195196e-03   +4.713334141520972e-03   +1.019290146839175e-02   +3.561840967723890e-03   +1.635327335630803e-03   +3.985247885452712e-03   +7.585063938928582e-04   +9.717994874367799e-04   +5.831057445486162e-03   +7.271416968595751e-03   +3.784441189224301e-03   -1.052125811867975e-03; -2.556573560448722e-03   -7.058555047889143e-04   -2.087952071429846e-03   +2.941181455426295e-03   -6.133973154722069e-04   +3.629560171550242e-03   +1.718520218227200e-03   +4.486320840488497e-03   -4.424810102871201e-03   +1.208428132814624e-03   -4.862562716670266e-03   +5.063258434844862e-03; -6.750776576221384e-03   +2.272375957697656e-03   +2.317774716811907e-03   +7.348952511847150e-03   -2.940800775843057e-03   -3.668690451710311e-05   +5.285507878886635e-03   +6.042016115820779e-03   +9.910452530744170e-04   +4.546951155193357e-03   -3.554702454864994e-03   +7.147029381981453e-03; +5.542052833159129e-03   -2.809254680029594e-03   +2.950270224811198e-03   +4.741771931839945e-05   +5.464457722276333e-03   +7.445513833532152e-03   -6.526337419192581e-04   +3.639182081032977e-03   -2.182228060987273e-03   +4.819456114332768e-03   +1.913974951085592e-03   +2.579486664080692e-03; +3.617930906701395e-03   +2.395165348242232e-04   -2.173015361791089e-03   +9.831995946163329e-04   +8.571839879463297e-04   +4.235034696750563e-03   +3.684428581289206e-03   +1.604950713096114e-03   +4.503032019729535e-03   -2.611794241160845e-04   +1.976262266573663e-03   -3.905231759479900e-04; +4.712591191513253e-03   -1.793813910683389e-03   +2.909624953191399e-03   +3.385958516924680e-03   +3.105829562214888e-03   -1.589146342991559e-03   +5.603986370824825e-03   +4.002732471586260e-03   +4.264193257225957e-03   +6.822812694345677e-03   -3.630361514624028e-03   +4.571570187101885e-03; +3.444827929400212e-03   +6.132034340018261e-03   +1.128658661610653e-03   +1.483787111268551e-03   -1.718916058401924e-03   +5.098447304343965e-04   +4.767590525368600e-03   -4.961869209534662e-03   +7.527647966566285e-03   +7.026477787813058e-03   -4.378657130169593e-03   +2.580873729220125e-04];
L2E_Input1_iAMPA_netcon = [+1.832122272353594e-03   +5.861692332152245e-03   +6.469540882486609e-03   -6.770731012269074e-04   +6.374974538732154e-03   -2.627014472447514e-03   +2.812043962642870e-03   +2.932654506321427e-03];
L2I_Input2_iAMPA_netcon = [+2.314728166518014e-03   +6.073227584052800e-03   -6.057257576678399e-04   -4.289004479948269e-03   +1.309337892922399e-03   +6.310913875612154e-04   +3.914924975227011e-03   +4.720302594997377e-03];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
