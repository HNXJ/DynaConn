function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.901730296583561e-01   +8.284272366192531e-02   +8.854628353646826e-02   +2.309661009866026e-01   +8.889254043392794e-02   -1.425966361369463e-01   -1.464968698072034e-01   -2.963613418392279e-01   -3.606915825557668e-01   -5.508626584800831e-03   +1.444425056761501e-01   +1.912448654773151e-01   -1.330124079625952e-01   -2.567367660809610e-01   +3.152942627885105e-01   -1.481358905041945e-01; +2.628631483916464e-01   +1.650575227332221e-01   +4.783047671384477e-01   -4.251505615334126e-01   +4.629135760980335e-02   -1.650919448305188e-01   -2.734502782097969e-01   +1.060367852039717e-01   +1.357200256611757e-01   -3.274088430607647e-02   +1.608106121406407e-01   -1.604591006460552e-01   +1.248302493921909e-01   +8.737748867569181e-02   -1.125983020570963e-01   +2.260995239309709e-01; +9.358403483314164e-02   -1.035193483738057e-01   -1.330356466445478e-01   -1.180556259507908e-01   +2.841310225493233e-01   +3.687856281226216e-01   -1.351515382115417e-01   +3.739843507306937e-02   -6.039531931887816e-02   -1.148677114345471e-01   +1.735397926409094e-01   -2.777556894597714e-02   -1.625732050330164e-01   +3.370366469295411e-01   +1.859533774712631e-01   -2.352713750348868e-01; -8.239349797481937e-02   -1.328590821576167e-01   +1.924519151730528e-01   -1.560241468835646e-01   -3.623614425584802e-02   +2.517250641972276e-01   +2.660764160252764e-01   +1.344864207295367e-01   +1.019747352660612e-01   +2.567745776716405e-01   -1.480030266771606e-01   -4.741843913691806e-01   +2.694849451152823e-01   +1.424521654300142e-01   -5.615654340238746e-02   +1.808268105461497e-01; -7.807624263827206e-02   -1.404835706022753e-01   -2.180482869451231e-03   +2.819136242625786e-01   +1.397119157489101e-01   +1.258662841054794e-01   -1.307476916288650e-01   -3.277346440874188e-01   +4.249986314490409e-02   -9.659724167810668e-02   +7.210899996465994e-02   -2.990242133623953e-01   +4.900564616898453e-02   +1.025437924068544e-01   -1.144095603480356e-01   -1.878138416606408e-01; -1.536470109736706e-01   +3.698588265182305e-02   -5.759331734528281e-02   +8.012293234205509e-02   -1.451459728297125e-01   -5.873434687027010e-02   -6.162259795089510e-02   -1.649046399888936e-01   -8.954247197842909e-02   +1.007917757550158e-02   +2.560255705907710e-02   +1.587150933530576e-01   -2.916566185255581e-01   -4.699388264410951e-02   +2.515713483293150e-01   -1.135158782464252e-01; -6.431462117252665e-02   +1.291772458639031e-01   +2.165404851441142e-02   +1.695607679610012e-01   +2.144431238623535e-01   +2.431602986326531e-01   -6.705503208328384e-02   -6.861562769103796e-02   +1.011028060846098e-02   -1.557356323079201e-01   -4.058906170274436e-01   -3.070841166876310e-01   +1.603850987565617e-01   +3.980908314064671e-01   -2.612495674877074e-01   -6.558066509669785e-02; -1.362444511796762e-01   +1.354246001377607e-01   +1.884922484938393e-01   -6.012285377029769e-02   -2.008719742946685e-01   +5.118213728708256e-02   +6.660187699268774e-02   -1.165616941880239e-01   +1.018713334769764e-02   +1.852264021439357e-01   -2.069555823614537e-01   +5.406632179681318e-02   +2.299351724346555e-01   -6.225050638112041e-02   +7.124507379073308e-02   +9.951462164480940e-02; +1.812613940938078e-02   +6.182511107647367e-02   +6.161536607096947e-02   -1.196378848506277e-03   -5.115571493638159e-02   +2.162065682413313e-01   +6.395793783954470e-02   +1.609984136180291e-01   +3.762948713324031e-02   +4.209496116134080e-02   -2.027926571981164e-01   +1.243794567436299e-01   +1.545834432999471e-01   -3.209961718700713e-01   +3.998495293777875e-02   +3.071196808844760e-02; -2.919389252387616e-02   +1.403595188742887e-01   -7.304985509399042e-02   +3.534753767748042e-01   -3.532182953812673e-02   -1.907842767852092e-01   +5.475652037200318e-02   -2.349323327831779e-01   +1.926934783594601e-01   -3.156247090065148e-02   +1.455792939035400e-01   -2.164511964936414e-01   +1.544666553943979e-01   +2.150422754034148e-01   -3.014736557654992e-01   -2.594310791387999e-01; -1.787056933062146e-01   +1.337125412401198e-01   -2.129186310411233e-01   -1.037439461401561e-01   +7.719767717666547e-02   -1.811322868409746e-01   -2.985049630601790e-01   +1.635553773652076e-01   -4.497091028095349e-02   +7.224203136353618e-03   +1.581700079904593e-01   -3.083954568070613e-01   -1.820439356578704e-01   +8.448695477903855e-02   -2.355909409143572e-01   -2.607899347277595e-01; +3.469053776239487e-02   -1.923871571427360e-01   +1.748086158955634e-01   +1.874814810872878e-02   -2.572042699581374e-01   -2.025063129569068e-04   +6.033818572970528e-04   -1.982497912719066e-01   +9.940569415372709e-02   -1.834342121055033e-01   +2.590995789667958e-01   -6.733330848930599e-02   +7.690082696917830e-02   -1.750901006543708e-01   +3.013205014331222e-02   +5.957845030315310e-02; +1.470894365602996e-01   -2.231375498283530e-01   +5.153088332541155e-01   +6.050357402285038e-02   -9.827232184903384e-02   +1.542244536596701e-01   +1.031647139510231e-01   +9.374184561832836e-02   -2.885515547375274e-01   -3.939276493854986e-01   +3.076847319219528e-02   +4.365720206028108e-02   -4.124170997905653e-01   -2.593562732019051e-01   -6.239999069873321e-02   +2.253628421166798e-01; -1.884448908031426e-01   +2.522634829639723e-01   +2.078352283520689e-01   -1.371074776722094e-01   -5.265640690289463e-02   -1.578751523775024e-02   +5.471615268529204e-02   +1.154194541033041e-01   +1.479069210452317e-02   +7.735570496071040e-02   -2.832535896607163e-01   +6.088930271856122e-03   +1.716133464174911e-01   +5.432026436331204e-02   -2.450252536748322e-01   +1.472002063261618e-01; -6.030437734094941e-02   +1.116249329895147e-02   +1.757567231518049e-01   -1.574713558942886e-01   +1.349491068664072e-02   +3.613462419732501e-02   +1.932803717513008e-01   +2.178177609548097e-01   -7.061340238470278e-02   -2.540012236510311e-01   -1.342744108212797e-01   +5.861904171387201e-02   -3.959279086568110e-01   +1.798576819365669e-01   -3.976194568362108e-03   +2.472338606988704e-01; +1.442554558598618e-01   -3.095965580883889e-01   -1.718002197846291e-01   +1.674455316181405e-02   -3.814675826317779e-01   +2.046532573908121e-01   +3.840217705706690e-02   +1.000349111333036e-01   -2.579897524160454e-02   +2.360582535022470e-01   -4.890875014545953e-02   +2.430462926336258e-01   -2.028569673689954e-02   +3.011587462139526e-02   +1.961659998067358e-01   +2.796900697748607e-01];
L1E_L1I_iGABA_netcon = [-2.714770429358448e-01   -1.569327548398528e-01   +6.696784685630990e-02   -1.925455688192076e-01   +2.729788195732248e-01   +1.873038128320092e-02   -7.356350533759506e-03   +2.259535803333431e-02   +6.397062643091964e-03   -1.774707819736846e-01   -1.176521104183973e-01   -4.451850407427194e-02   -1.424022122162343e-01   +5.581735924168091e-02   -4.967805732385670e-02   +7.504114626502231e-02; -5.800520492291465e-02   +8.540359005009239e-02   -2.004853560669093e-01   -1.170220293657238e-01   -4.333360569898989e-02   +1.609267279558796e-02   +3.531527150966483e-01   +2.702442745171313e-01   -9.213772935186516e-02   +6.145708493470108e-02   -1.425116418016373e-01   -3.846785670425363e-01   -4.636871532004209e-01   +6.128927285141535e-02   +1.689396055158221e-02   -4.652609390776301e-01; -2.914515723260411e-01   +1.229994533534976e-01   -2.202725622733102e-01   -2.326028446320814e-02   -1.543703319796294e-01   +1.918985420573105e-02   -1.971072454335311e-02   -1.092544313917496e-01   +3.232193332450033e-02   +5.619852025515089e-02   +1.184085961404098e-01   +1.645752499676042e-02   +1.553998944348030e-01   +5.554078319713171e-02   -1.740735565851633e-01   +1.302210266306433e-01; +1.852620320183010e-01   -3.275040943783660e-01   +2.748921359502720e-01   +2.091537873586086e-01   -1.270852741081028e-02   -5.219111373268317e-02   +2.230329643223073e-02   -1.246655139123386e-01   -1.156680008966457e-02   +1.076831227640447e-01   +1.862325371002848e-01   -3.328395068337348e-01   +7.536741824582183e-03   -1.861958218169545e-01   +1.049157566475689e-01   +1.548255606265836e-01; -1.266888717858261e-01   -3.731057771602321e-01   +3.081335795735190e-01   +2.434473697972714e-01   -9.374252854163315e-02   +1.088699865407083e-01   +8.304982310355052e-02   +1.230907737012854e-01   -2.738144383862984e-01   -1.333481582730837e-02   +1.902883607133735e-01   +2.109835892059809e-02   -3.184902592160268e-01   +3.915811615412109e-01   +9.194035336483367e-02   -4.152584950285488e-02; +6.334017870973835e-02   -1.749119741347763e-01   -3.436847815769377e-01   -3.124268126727620e-01   +2.842772478325591e-01   -1.260072973678958e-01   +1.576450865508687e-01   +2.661974312864674e-01   +4.127894826700127e-01   -7.543941228729256e-02   -2.258745645071042e-01   +1.706145186686436e-01   +1.814259391966727e-01   +1.328661831998283e-01   +1.775916283440144e-01   +1.755984220585272e-01; -8.285449595177607e-02   -1.256089429844728e-02   -7.185083844261717e-02   -1.134698124465875e-01   +7.074802385483983e-02   +1.318150229986810e-01   -9.565893273464243e-03   -3.241733431560331e-02   -1.079115288276914e-01   +2.529101715303567e-01   -2.177184788207873e-01   -2.085719575991770e-01   +2.024142887423309e-02   -3.351555665023546e-03   -1.914947957550942e-02   -3.235516381378570e-02; -1.890147527560166e-01   +1.554134880182330e-01   +1.725302837473416e-01   +4.950977923664257e-02   -1.737804009360245e-01   -1.840214918342960e-02   -1.129195262836001e-01   +1.088657949342230e-01   -3.863575506448017e-02   +2.543256087665682e-01   -6.668993314350377e-02   +3.228921416137720e-02   -4.726806370028264e-02   +2.479317641760243e-01   +4.207058093282549e-02   +1.379452172395605e-01; -1.477140261695560e-02   -1.938482578693425e-01   -1.543006293420270e-01   +6.626358545589847e-02   +1.189342992898933e-01   -2.328013619337521e-01   -1.088205107403550e-01   +2.522863697606704e-01   -4.605969522355081e-02   -1.296832329084792e-01   +2.012620262102208e-01   -2.570921340382549e-01   -1.476926816953323e-01   -1.179282501199842e-02   +2.639753886741021e-01   +1.468534587001933e-01; +8.925688280241336e-03   -3.549376749286693e-01   -6.069210507396355e-02   +3.864652108411085e-01   -5.460442439320363e-02   +2.929765055803474e-01   -2.149758424738925e-01   +5.378455267372217e-03   -1.717859952572081e-01   -1.089663838691659e-01   -3.331046266511782e-01   -9.969778029699872e-02   +3.746558721666142e-01   -1.948941639279861e-01   +9.969774887512577e-02   -2.408024572263654e-01; -1.900888439078846e-01   -2.845622156629029e-01   +4.911302729990030e-02   +1.443520191406295e-01   +2.233540336180485e-01   -9.123494864238313e-02   +1.688099222735218e-01   -2.363005155573126e-01   -2.143648014260155e-01   -1.158984666133109e-01   -5.998098748494810e-02   +8.759063001194700e-02   -1.401638067500085e-02   +1.464793880020716e-01   -9.951837631358856e-02   +1.298773827679028e-01; +3.250211277131146e-01   +4.662629154917837e-02   -2.538634394307782e-03   -2.421526779407399e-01   -5.242391019411353e-03   -6.477120190592825e-02   -6.577633539814731e-02   +1.529085603855691e-01   +3.723804494269869e-01   -2.492102223306138e-01   +6.022703981662060e-02   -5.982392199837741e-02   +1.439709260783564e-01   +9.413333034536749e-02   +1.706208312251000e-03   -8.163800080027241e-02; +3.160850351252373e-02   -2.285894978339942e-01   -1.480012928990067e-01   +1.339622197638582e-01   +4.695442494199367e-02   -5.928942555950423e-02   -1.820387300663143e-01   +2.198338107512316e-01   +2.614753265857837e-01   -4.648369064526588e-02   +1.202440938992756e-01   +1.650009487844683e-01   -1.104341497139040e-01   -2.340314802660822e-01   -1.328779309994437e-01   +3.039757113919312e-01; -1.938021903034778e-01   +7.149068154585731e-03   +1.518435960840382e-01   -2.404092097311487e-01   +9.522912199220240e-02   -1.784739836318326e-01   -6.014796898586281e-02   +1.348050709538928e-02   -2.297339992568587e-01   -2.621817846371962e-01   +2.909516294278892e-02   +1.692304652179306e-01   +2.260765856708928e-01   +1.294832789195100e-01   +5.549045250173987e-02   +1.057927966723339e-01; -2.375846367842630e-01   +2.397809740491995e-02   -9.108064038311257e-02   +1.519642360516489e-01   +3.370978268094302e-01   +2.945038998366459e-01   -4.585802933193021e-02   -1.290030141141418e-01   -5.672815282234284e-02   -1.006436610998653e-01   -1.991498189180082e-01   +4.429734980527480e-02   +2.530691572015848e-01   -2.052443631389878e-01   -1.189456608597491e-01   -8.542133339952074e-03; -4.144802893412326e-01   +2.252134283168452e-02   -1.342307557941333e-02   -1.768883802934732e-01   +3.999417602019104e-01   +1.862893983028338e-01   +1.943110423015769e-01   +1.584166665136595e-01   +4.021578678645854e-02   -1.444635805631831e-01   -1.325631405830876e-01   +2.712394899048637e-01   +2.672906565190361e-01   -3.999890362752665e-02   +2.387367401607242e-02   +8.018527180468238e-02];
L2I_L1I_iGABA_netcon = [-2.257868239621726e-01   -1.795186543080207e-01   +4.648452475620475e-01   +1.114601714049659e-03   -3.317570373365549e-01   +1.935518400096837e-02   +2.514497978986414e-01   -9.243579203625102e-02; +1.397697735992656e-01   +1.908141825002592e-01   -1.992055140041330e-02   -7.844527041404756e-02   -2.707959677851554e-01   -7.148615744216139e-02   +8.630362966042046e-02   +1.297221374714140e-02; -2.632430421103774e-01   +5.506315143393541e-02   +2.090752953368074e-01   +1.348234739121074e-01   -4.526520331465819e-02   -2.957050882470494e-01   -3.137376390368433e-01   -2.986266154217938e-01; +1.222990550430206e-01   +1.952821961431197e-01   -9.889904704055720e-02   -3.869292317261793e-03   +1.151696145303533e-01   -1.149251014011508e-01   +6.127957028095224e-02   -7.031648956965598e-02; -1.245007753112254e-02   -3.825773369578346e-01   -1.470496913969193e-01   +4.201389087084099e-02   +1.883422843125730e-01   +8.339748969635355e-02   -1.145290682786416e-01   -7.021301680158296e-02; +4.007814723687759e-01   +6.461490619633065e-02   -9.629783102981547e-02   -2.555925733030327e-01   +1.182226508341702e-01   +2.961078303504899e-01   +2.133086963422020e-02   -1.055782125337370e-01; -1.839105721770520e-01   -2.328884764716057e-01   -1.976040368615020e-01   +2.568991544004096e-01   -2.434673068299135e-01   +4.346560940792414e-02   -1.198783311681694e-01   -2.523317567730796e-02; -6.496171596555841e-02   +2.630576929549681e-02   -7.128103392663743e-02   -7.219607830306730e-02   +9.325918857358029e-02   +8.888920119922449e-03   +1.833324100957711e-01   +3.880824198555658e-01; +2.835571426894007e-02   -2.686171608487588e-01   -1.894340308524435e-01   +1.455839135256655e-02   -6.007509717812259e-03   -4.174104506110837e-02   -4.088724773619146e-02   +7.035666420571249e-02; +2.303257046394235e-02   -5.872306351523936e-02   -8.792153171493283e-02   +3.010091867582278e-02   +3.100925146259925e-01   -1.466555044414590e-01   +9.982983334078152e-02   +2.005794353568609e-01; -8.262811731602471e-02   +5.669036341577734e-02   +2.710508629427912e-01   +1.405646412460758e-01   -2.185638538763546e-01   -1.348420693581619e-01   -2.856041541516130e-01   +4.197381939581420e-02; -2.962301206560318e-02   -4.511528601860887e-02   +9.324140690356000e-02   +6.890255635691352e-02   +6.275436515696076e-02   -2.017702193268058e-01   +1.849031998046798e-01   +9.903527469666086e-02; -7.977196949838423e-02   -3.727579105833444e-02   +6.706753050476538e-02   +1.460714820375971e-02   -2.687097821346545e-01   +1.254867935709689e-01   +8.103118537759794e-02   -1.463235468168127e-01; -3.344085096583811e-02   -1.061183190457269e-01   -3.453339256576243e-02   +2.026099347414511e-01   +1.414644395145340e-03   +5.882540475602824e-02   +4.431214571408107e-03   -2.644089130184833e-01; +1.851085251047752e-01   +2.399647194564763e-02   +2.080355885690935e-01   +2.143691916579771e-01   +3.646023519498544e-01   -1.579917524404787e-01   +9.777369251780032e-03   +1.046535971853645e-01; +2.896371668685651e-01   -2.685996035104789e-01   +8.137751063615976e-02   -8.611101282588679e-02   +4.784843222202741e-02   +8.678341022170499e-02   +8.232180578302895e-02   -2.967211459386473e-02];
L1I_L2I_iGABA_netcon = [-2.593602597242751e-01   -3.492824822562913e-01   +5.352137252139474e-02   -9.600368776392967e-03   -3.559602952979524e-03   +9.930764842432084e-02   +1.402551097384491e-01   +1.729319508393683e-01   -4.171583700153346e-02   +3.157898573876165e-02   +1.111187578629666e-02   +1.173520154202324e-01   -2.268714064086075e-01   -2.085005509457535e-01   -2.537491843879133e-02   -2.469779392654933e-01; -2.758909926785766e-01   +2.800639723266493e-01   -2.144553181802289e-01   -1.799809648780692e-01   -7.726160241292528e-02   -1.672945413430909e-01   -3.562579144760848e-01   +1.477282548779277e-01   -1.922506318524641e-01   -4.371352234724910e-01   -1.759723109859884e-01   +1.658932890587855e-01   -1.716233030517061e-01   +7.650598757840149e-02   -5.879053192375017e-02   -1.939865421170052e-01; +1.789958840185664e-01   +6.829666190542580e-02   -3.088041649603372e-01   +1.597320116805792e-01   +2.395287828244553e-01   -1.581992069068012e-01   +2.141464269249493e-01   -8.247251714508119e-02   +1.938841099208334e-01   +1.878866948098692e-01   -1.024745727037311e-01   -3.837681115905438e-02   +1.717344575954727e-01   -2.626904643587863e-01   +3.125411008526450e-01   -3.245009660071763e-01; +6.473346366155451e-02   -2.758327663274911e-01   +1.435753794006493e-02   +2.968036226084262e-01   +1.184990529126848e-02   -1.877640505478776e-01   -1.261903437082795e-01   +4.388090419247745e-03   -8.974074392620929e-02   -1.856004533278368e-01   +9.740527200629623e-02   -9.982623424213488e-02   -4.580592943997687e-03   +1.429201165939572e-01   -2.765011649504294e-01   +1.194970826785097e-01; +8.498762737099916e-02   -3.650167406112695e-02   +1.962474003317351e-01   +1.030573680933092e-01   +1.366626521739080e-02   +1.038951332642402e-01   -8.475581228635921e-02   +2.728454539313976e-01   +2.444996561053972e-01   +1.305386584588580e-01   +2.314957437043464e-01   +4.083318205068096e-01   +5.430201354718571e-03   -1.876603061579488e-01   -1.629249413075715e-01   -1.432460044685638e-01; -1.959785781218323e-02   +1.761443877170674e-02   +1.590727257189924e-01   +1.409278565576755e-01   -1.077544208163754e-01   +1.549717800792610e-01   +8.202681525589672e-02   -3.873393357506633e-01   -7.281849854486094e-02   +1.963207347775992e-01   +1.668332789884747e-01   -5.811118088112477e-02   +3.611063515627513e-01   -5.649776857356219e-02   +2.691888373460359e-02   +8.856988707842624e-02; -6.008367027898763e-02   +5.221963364262155e-02   +3.909802378651706e-02   -2.614522566652676e-01   -2.769509995343220e-01   -2.783853978356616e-02   -2.013879747833597e-01   +9.329639893213518e-02   -1.080128380796338e-01   +9.501423428702629e-02   +3.484195923399087e-01   +1.500867408880682e-01   +1.298713275442719e-01   -1.495244687874611e-01   -8.423776389897060e-03   +6.498754145406629e-02; -5.115258806461302e-01   -2.682331921385821e-02   -1.488707895258804e-02   +3.628442096660356e-01   +1.658796000962564e-01   -5.845616859094366e-02   +5.646780540120584e-02   +1.214287253984793e-01   -1.797738098329082e-01   -2.109826034812627e-02   -1.085291497175552e-01   +1.264315191653734e-02   -1.784725496109356e-01   -2.603341446287790e-02   +2.406673913975178e-01   +9.510254151791407e-02];
L2E_L1E_iAMPA_netcon = [+1.701380467339474e-01   +1.882367706319602e-01   +1.211969786184275e-01   -2.737468978929385e-01   +1.454433087180162e-01   -4.325908890981771e-03   +5.632717779087654e-03   -1.125441011682023e-01; +1.092724362769502e-01   +3.673241999073207e-02   -2.904653005391216e-01   -6.254314611554893e-02   +1.214829214231797e-01   +2.685164794508684e-02   -2.583475689617853e-01   -9.112123636881490e-02; +1.433046205266083e-02   -2.340212041324592e-01   +2.148492985467402e-01   +2.856690987732449e-01   -2.172906840144326e-02   -8.067454973827701e-02   -4.042990449350743e-02   +3.664247252183220e-02; +1.066114503465745e-01   +1.678768266198220e-03   -2.250676516934049e-01   +5.969814526656719e-02   +7.456274613450886e-02   -1.469281554032927e-02   +1.336055952394145e-01   +1.143221581645762e-01; +2.675134590607635e-01   +5.097913357959132e-02   +1.516664048394142e-01   +1.108389849441131e-01   -3.613299597917418e-01   +9.385650605960213e-02   +1.416646495276212e-01   -1.012779840720031e-01; +1.343138906743111e-01   -4.776856798520734e-02   +2.054455897807117e-01   +2.537477370291044e-01   +1.160437962926758e-01   +7.239881823724527e-02   -3.519087510832517e-02   -4.172269157178589e-04; +2.579479656266710e-01   -2.919670516140632e-01   -1.166626902976712e-01   +3.699088462009104e-01   -4.710558112082559e-03   -1.529385537107937e-01   -1.178760440513129e-01   +1.523983619812885e-01; -2.546568847837741e-01   +1.900787141805182e-01   -1.625361007203752e-01   +8.871288229649099e-02   +2.404510561416363e-01   -2.383981707181847e-02   -8.573717326441840e-04   -1.463642145977347e-01; -1.962255142898244e-01   -1.324947629519121e-01   -1.940934664089251e-01   +2.752212983309653e-02   +3.834124145847373e-02   +2.465447780391433e-01   -9.032363735494467e-02   -6.909101692109565e-02; -5.469738896574337e-02   +1.175980534897754e-01   +3.761791113777930e-01   +3.250629682208716e-01   -1.153494119641387e-01   -3.209485505278642e-02   -1.376083932630958e-01   +2.222139955937412e-02; -1.291780901183673e-01   -5.028285540660922e-03   +4.047164966062373e-01   -2.294817565079196e-01   -1.725957138619663e-01   -6.871815140666263e-02   +1.434518067047088e-02   -4.103072903100509e-02; +2.963115295397204e-02   +1.633901904742341e-02   -2.202828871198696e-01   -1.896067122238560e-01   -2.205407842501888e-01   -3.537294214806653e-01   +3.149518382144134e-01   +1.553520645946919e-01; +3.935874026459314e-02   -4.964180309694174e-01   +9.027276823526029e-02   +2.416839304690292e-01   +2.434010181659709e-02   +1.564051319182659e-01   -2.881096916081330e-01   -7.967686419306062e-02; +6.160838048679994e-02   +1.043415251729566e-01   -2.164640705646871e-01   -1.097900467377357e-01   +5.146696141611466e-02   +3.816449448166020e-02   +3.932693409227767e-03   +1.400668434856724e-01; -1.720615012779801e-01   +1.672710934954482e-01   +1.979113194806702e-02   +3.206725705140862e-01   +5.238829390167229e-02   +1.481634321779810e-01   +1.159494699269074e-01   -1.940340820805356e-01; -1.647347499239628e-01   -1.248210450000097e-01   -1.078952583410730e-01   -1.389605911504424e-01   -1.698593459083529e-01   +1.770820575544926e-01   -2.363145014401574e-01   -2.844734404460618e-01];
L1E_L2E_iAMPA_netcon = [-1.234262642772712e-01   +1.896727165252019e-01   -5.864963465275939e-02   +4.379122002340859e-02   +2.847284796822933e-01   +7.738831102002799e-02   +2.193804025158082e-01   -1.426859370443500e-01   +2.602542523400140e-01   +5.398082450190806e-02   -3.011318564887502e-02   -1.562246544800694e-03   +1.450643374243240e-01   +2.894832433667015e-01   +8.524859288419698e-02   -1.540804613353305e-01; -1.900014720582721e-02   -1.793222758294168e-01   +2.906744231436692e-01   +1.236686611473250e-01   +1.230621824504999e-01   +2.454940154304035e-01   -3.898888871725480e-01   +2.397287269152976e-01   -1.985628313283698e-01   -2.454691724670203e-01   -1.371227210015256e-01   +1.176185098091404e-01   +1.331297203205218e-01   -4.483202137141545e-02   -6.655259261921649e-03   +1.619738158289380e-02; +1.027889434127636e-01   -1.254385229540472e-01   +5.336737149633540e-02   -9.977548728108640e-02   -2.217800258751311e-01   -1.074152907406438e-01   -3.823398423870248e-01   -6.743252016997625e-02   +2.790637315628480e-01   -7.455810472035204e-02   +1.462489954120220e-01   -4.958109697046979e-02   +2.044960803829764e-01   +1.883550399822375e-01   +1.222615602348400e-01   -3.726036117738817e-02; -2.866732247548383e-01   -1.329898821284782e-01   -1.381477604654172e-02   -1.196684880187671e-01   +9.530747651315427e-02   -8.550424110587448e-02   +7.593612592573828e-02   +7.729979776412593e-02   +1.173400317394043e-01   +3.469560721909752e-01   +3.369820190211647e-02   +7.074260284255508e-02   -1.102983660304008e-02   -9.123017390780862e-02   +6.435815076284851e-02   +1.523272197301400e-01; -9.249180269556258e-03   -2.087739249926901e-01   +2.582747330160541e-02   +6.591548381915982e-02   +3.321641501040716e-01   +1.316837747947845e-01   +8.865091593514210e-02   -4.173232711587710e-01   +1.671975849129854e-01   -6.006228620308930e-02   -4.097721391537867e-01   +2.948384627977443e-03   +8.281425153486115e-03   +2.553404926975665e-01   -9.292123598605824e-02   +9.690747793278291e-02; -3.946807238207324e-02   -2.645587196371545e-02   -1.342748411736720e-01   -1.415592177394893e-01   -1.290059419103243e-02   -6.894447070484443e-03   +1.369981855043825e-01   -2.617219940933130e-01   -2.020491098234165e-01   +7.660559878550094e-02   -9.423753615250420e-03   -2.159966745924894e-02   +1.512842279733680e-01   -4.435041128060628e-02   +3.423026550722915e-01   +4.307115968226659e-01; +1.908076633801081e-01   -4.162373031360823e-02   -3.866743997220414e-01   +2.709787942169876e-01   +1.720584230330618e-01   -4.462379353616841e-01   -7.284348518481819e-02   -1.251135886400438e-01   +5.242324493109249e-02   -9.995985106574422e-02   +2.363984023114557e-01   +2.647167522658532e-01   -2.692285761529336e-01   -2.450961374941046e-01   +2.400503984193809e-01   +1.511711875690369e-01; +4.126776769589242e-02   +8.158807065895773e-02   -1.883589237769711e-01   +1.389250740374125e-01   +3.729909084738263e-02   -1.608626599152683e-01   -9.634974627719985e-03   +1.407717286740258e-01   +1.275157385805115e-01   -1.948259713247600e-01   +1.672121280876283e-01   -9.121159574441198e-02   -1.793691275134283e-01   +2.641210927765700e-01   -2.255911272431257e-01   -2.248990508833232e-01];
L2I_L2E_iAMPA_netcon = [+1.945697246941628e-01   +9.977423785294924e-02   +2.443071364096368e-01   +1.967850014429328e-01   -8.327103719289272e-02   +1.658300565864200e-02   +6.227779729563614e-02   -2.706352482292849e-01; +5.821798490626010e-02   -1.416696228480032e-01   +3.196523782712687e-02   -1.582961897219118e-01   +2.538672975258389e-02   +2.314769249166415e-01   -2.128498704980843e-02   -1.971504199963512e-01; +3.505991303008538e-02   +2.415243662127305e-02   +5.930584206235033e-02   -2.561626887934754e-01   +9.110139895317092e-02   +1.078540856915960e-01   -1.163389766202645e-01   -7.313103735050756e-02; -6.657762937938204e-02   -2.626022924031113e-01   -3.677703392572597e-01   +1.516140989856810e-01   +4.404632504864706e-02   -8.600626884994949e-03   +2.309490265461870e-01   -1.100027888125446e-01; -2.657359307552946e-01   +2.104590764465669e-01   -3.473921123023332e-03   -7.414245598723147e-02   +1.835146592779038e-01   -8.972306311242671e-02   +1.016000820830227e-01   +6.073568963916954e-02; +1.274100707911310e-03   -1.916868354953147e-01   +2.706730669153860e-02   -4.103581713022539e-03   +1.658725019814872e-01   +1.768027254525423e-02   -3.520297164225633e-02   +2.854345947257478e-01; -2.364709131138190e-01   -1.188919154530777e-01   +6.133455263308025e-02   -9.227498442381004e-03   +1.981732993350785e-01   -1.092720464485111e-01   +2.717215643190438e-01   -1.838038926326128e-01; +6.894327300196562e-02   +1.561134665009963e-01   -5.855389933783798e-02   -1.962673651062680e-01   +2.057457807471617e-01   -2.488627849801221e-01   +4.932104887699092e-02   -7.948854731946667e-02];
L2E_L2I_iGABA_netcon = [-1.253109270738955e-03   -2.178003238030856e-02   +1.079273291406305e-01   +1.115056001121763e-01   +6.090478787721090e-02   +3.629827554323021e-02   -1.599435560779628e-01   -3.420726138315904e-01; +9.334340377476349e-02   -2.414484009508204e-01   +2.868097897423812e-02   +3.991867156448250e-01   +3.923907125428156e-02   +2.595238468734222e-01   +1.700573299820166e-01   -2.797520646399082e-01; +3.603351958237299e-01   -2.674231545577890e-01   -1.931746180477485e-01   +4.853099205849057e-02   -3.375864434492839e-01   -2.484162208141480e-01   +1.987917152429939e-02   +2.647304154147975e-01; +7.062882408963075e-02   -3.470154266400279e-01   -4.544444974301028e-02   +8.016932869604977e-02   -3.358766708045192e-02   +1.459931889363284e-01   +2.667618705879495e-01   -1.212103689882286e-01; -2.662969338266822e-01   +3.434609739503795e-02   -9.358993020835056e-02   -7.980660097202445e-02   +1.883583702411937e-01   +9.212523060389807e-02   +3.192708168351731e-01   -1.123364389600940e-01; -1.308227819703961e-02   -1.593263121498370e-01   +3.012483158262529e-02   -1.281393852612353e-01   +1.713424438594160e-01   -2.030520903072431e-01   +2.351461572571637e-01   +1.836410332612745e-01; +4.909359880042195e-02   -2.147988488088947e-01   -2.593212817404414e-01   +8.963760753478672e-02   -3.371733706316442e-01   -9.704070327180718e-02   -7.463660689426432e-02   -5.951336343317308e-02; -2.607793454233286e-01   -2.695648257853088e-01   +1.440933143108027e-01   -9.873634191492534e-02   -7.100524002108732e-02   -3.044986657428767e-02   +1.405142865722608e-01   +4.542346279683765e-01];
L3E_L2E_iAMPA_netcon = [+1.086915666841901e-01   -1.421180415302658e-01   -1.835346371230291e-01   -1.390269071801581e-01   +4.983270537295000e-02   -1.923516963432862e-01   -1.874336810418538e-01   +1.580077232902145e-01   -1.119104736963499e-01   -8.357987343313784e-02   -1.077779811574908e-01   -1.927860961137403e-01; +2.343819747877896e-01   -2.154187192243297e-01   -1.756750269437303e-01   +1.111850687883595e-01   +1.056401600381930e-01   -9.587429392596521e-02   +4.061091289205999e-02   -3.281368004158544e-01   +1.463050268072124e-01   -4.770096154903475e-01   -4.272722971961502e-02   +4.517447732552955e-02; +1.385103886154316e-01   -2.150539716732691e-01   +9.908478279073278e-02   -1.581076206908849e-01   -2.193142966763942e-01   +2.392839118662528e-01   +3.874499948870468e-02   -1.030681559932146e-01   -2.924554404918990e-01   -1.134575658966434e-02   +6.302851176516200e-02   +6.845253214648281e-02; +1.550373198292809e-01   -7.421545673667011e-02   +9.085410121299962e-03   +2.843664683147096e-01   +6.554191810971927e-02   +1.248606357484299e-01   +1.183407013068919e-01   +8.948752629109798e-03   +8.905446421513806e-02   -2.289846706907671e-01   +2.037410955843360e-01   -4.780552040014564e-02; -3.117342762341186e-01   +8.751382131481564e-02   -2.018838341854795e-01   +1.237408589785949e-01   -4.244060758672598e-02   -3.811278754814590e-02   -2.172753432766051e-01   -2.011192150654100e-01   -1.109548200475464e-01   +8.220252049147306e-02   +3.040022270736939e-01   -9.788951743117442e-02; -2.705032061262777e-02   +1.676282974289125e-01   +1.198949572691382e-01   +1.590659498187916e-01   -1.834698061203589e-01   +2.131449664309905e-01   -3.132645945698953e-01   +2.085290599548495e-01   -6.449608767961873e-02   -3.155692294848491e-01   +8.893202881579006e-02   -1.617710131974352e-01; -1.220785828520186e-01   +9.965568970265551e-02   +7.420365645478691e-02   -2.870658678571339e-01   +1.840059274123006e-01   -1.319805325627305e-01   -1.127681894744801e-01   -1.666502337320315e-01   +1.518411044177340e-01   +2.112967374824654e-01   +1.228845710351117e-01   +5.675363318892143e-02; +9.178430800266357e-02   +2.416246563224986e-01   -2.117515869750725e-01   -5.768819940011983e-02   -1.041364522466256e-01   -1.431618699064478e-01   -2.789534787712482e-03   -1.080782977720269e-01   -6.954823388197168e-02   -8.359269947960324e-03   +4.824159197395508e-02   -6.837385024732183e-02];
L3I_L2I_iGABA_netcon = [+5.244974704199543e-02   -2.543032627909774e-01   -1.214496815277521e-01   +9.791791063767413e-02   +2.906842207265389e-02   +7.377290998912035e-03   -3.890660035811633e-01   +1.184022537487987e-01   +1.582019613246395e-01   -1.558488701214198e-01   -1.899444266557379e-02   -1.116810330318317e-01; +6.829168178541498e-02   +1.231843001967654e-01   -2.900621366651013e-02   -1.761548389216782e-01   -5.743754043035204e-02   +7.304641797808518e-02   +1.377495462194648e-01   -5.273857528930913e-02   +1.001585874330463e-02   +2.580462807384015e-01   +3.400162744831935e-02   -5.348834017728681e-02; -3.259577096754641e-01   -3.223358155459889e-01   -4.785506367107334e-02   -2.404136420031287e-01   +4.563566445079827e-02   +9.227781762453895e-02   +1.235233489081182e-01   -2.374426186570360e-01   +1.356222165224190e-01   +1.308603243660307e-01   +3.128306860252313e-01   +1.312752875599923e-01; -1.973041826180754e-01   -2.879840007928795e-02   -1.985277141752739e-01   +1.410163329588879e-01   -5.045727201316013e-01   -1.059003649417818e-01   -7.074388104294875e-02   +1.830000869654885e-01   -7.001544747122805e-02   -7.085435984834107e-02   +8.001318162756668e-02   -9.241145005695808e-02; -1.356029993084728e-01   -3.610207019582656e-02   -1.944666218815205e-01   -6.585620528816341e-02   +1.004824551837734e-02   +2.102011528038786e-01   +2.091916266618057e-01   +2.298465643661590e-01   +2.657499447052425e-01   -3.855273262519416e-01   -1.950933909096598e-01   +6.298465713529808e-02; -1.061351949044342e-01   +1.981436915471417e-01   -4.191291901387331e-03   -2.740359395963551e-01   +6.765307297140458e-02   -3.826523756893984e-02   +1.816820586266036e-01   +9.985793806803725e-02   +3.464485746424004e-02   +2.889666440060011e-02   +2.164349020087184e-01   +6.950612447054914e-02; -3.174027127966236e-01   -8.458690981839104e-02   -1.241668455159069e-01   +1.209978022724136e-01   -9.287741977508418e-02   -6.364473504753405e-02   -1.318911072852456e-03   +4.972134528827669e-02   -4.768843962825055e-02   +2.648736404383440e-01   -1.640656310793071e-01   -1.681516385924643e-01; +2.630219890146244e-01   -1.529095606202708e-01   -4.782679170047315e-01   -1.667664501891962e-01   +1.624953437639260e-01   +9.044558345927586e-02   -4.751689452730579e-02   +6.523930352484249e-02   -1.903590599102947e-01   -6.113677620175822e-03   -5.631363899992113e-02   -3.469807624690564e-01];
L2E_L3E_iAMPA_netcon = [+2.152680933247601e-03   +1.070621411209621e-01   -6.963494632363551e-03   -3.255915652902534e-01   +5.169588650392009e-02   +3.834015434252479e-02   -2.708202668161969e-01   +1.964876274934685e-02; +4.962393495536625e-02   +8.901898643993197e-02   -4.621954254296456e-02   -1.345574226319434e-01   +3.023546216886630e-01   -2.729216282786736e-01   -3.468691241290582e-01   -3.301511927268902e-02; +2.821203051004346e-01   -1.457346462120187e-01   +9.697353769650338e-02   -1.306834903059726e-01   +7.804917711808462e-02   -2.838017762114535e-01   -1.395742355919626e-01   -8.906041126675415e-02; +1.578779314251346e-01   -1.442353027389611e-01   -2.026518448885800e-01   +7.153353191517359e-02   +1.081929711572944e-01   +3.793703450130789e-01   +1.446792401233011e-01   +1.907809928325152e-01; -1.168517646070266e-01   -1.758016075538226e-01   +4.299756942193312e-01   +5.943881184390679e-02   -6.855915687425207e-02   -7.123612528153250e-02   +2.246468798412032e-01   +6.567972186872136e-02; -2.362191750206702e-02   -3.131209608144782e-01   -9.692295478709978e-02   -4.654902320307453e-02   +2.373347330548995e-01   -1.800940898009585e-01   -1.422832451773109e-01   -2.814423601976936e-01; -1.356166705881597e-01   -3.533689223131508e-01   +3.981557255642504e-01   +2.873569923987800e-01   -1.409148628794379e-01   +1.792960575929794e-01   +3.235140157744297e-02   +3.602904432797268e-01; +1.533278753941157e-01   -3.505137247829592e-03   -2.203747558242869e-01   -6.192878074297464e-02   +1.981638375375410e-01   -1.824329071553543e-01   +9.783149608901406e-02   +1.739662357625595e-01; -2.926970898036721e-02   +3.291404024459502e-01   +9.665788222565995e-02   -1.483431929938657e-01   +6.391151364175879e-02   +1.237537360155920e-01   -3.209614129930555e-02   +8.638209624728441e-02; -8.717943606356866e-02   -5.822965652953165e-02   -1.930276424379112e-01   +2.570072531897425e-02   +1.057307717678017e-02   -2.669235190564349e-01   -2.079871403371302e-01   +1.395154079502434e-01; +1.153614461265707e-01   -4.099819557910738e-02   -2.702205924211278e-01   +4.069349664701912e-01   -3.131713719223161e-02   -2.070053325694126e-01   +1.488619515672584e-01   +2.436646931055763e-01; +6.459133681862611e-02   -4.677848832068993e-02   +1.924781918520386e-01   -3.226165113680729e-02   +2.077275467809939e-02   -1.001127840769698e-01   -8.292296339481621e-02   -7.460195409777365e-02];
L2I_L3I_iGABA_netcon = [-1.388029670732511e-01   -3.630464050168790e-02   -2.157397279682730e-01   +3.454088643220343e-01   -1.120384181390512e-01   +2.443616530795116e-01   +1.087407329212390e-01   -1.244790271973218e-01; +8.913204253352283e-02   +9.131180374988834e-02   -1.116651688630820e-02   -4.450551807193019e-02   -3.036712488922594e-01   +4.011090943914943e-01   +1.953094698195727e-02   -2.610879714234001e-01; -9.944913573680150e-03   -4.083498499780128e-02   -9.586811650236460e-02   -1.657353314075572e-01   -1.835760750940743e-02   +4.204585319977188e-02   -5.086295460522733e-02   +2.064460185671117e-01; -3.384981143880857e-01   +5.062457832187930e-02   +4.737637642658249e-02   -3.365729499389336e-02   -5.285920733012626e-02   +3.241165147300797e-01   -5.853554708822582e-04   +2.312242757469556e-01; +3.123133761891789e-01   -9.628612893248389e-02   +1.924169229371506e-01   -7.274187484094422e-02   -1.158819175355116e-01   +1.294085405227814e-01   +1.084323139158810e-01   +1.610010802246919e-02; +1.708495212393774e-01   -1.389808011280679e-02   -2.331990848839884e-01   -1.505865261693007e-01   +3.089919498598798e-02   +1.917449279484187e-01   -2.446809136758040e-02   +8.960436419513601e-02; -1.159858811243354e-01   +1.611698501158890e-01   -1.691953625868881e-03   -2.420509819203459e-02   +3.228068088486149e-01   +5.006895085703022e-02   -1.377238870309431e-01   +2.119644587449121e-01; -6.297443289811973e-02   -1.707124399843543e-01   +3.775764623154563e-02   -2.460367050227232e-02   +2.137484449182721e-01   +2.612739760263471e-01   +3.007271537630465e-01   +1.474631442155460e-01; -1.631215422582552e-02   +1.229914883425884e-01   -3.312709917255031e-01   -8.127271963704268e-02   -3.860607552662021e-02   -4.259187464465504e-02   -1.625224335788874e-01   +2.478742249398802e-01; +2.030988837235114e-02   +4.931515736525267e-02   -2.329708846303085e-01   +7.845322195354271e-02   +1.278658162528486e-01   +1.163263090089626e-01   -1.999430934099863e-01   -1.035281003188775e-01; -8.419932974954761e-03   +1.245990710923327e-01   +5.231574189779104e-02   -1.322092547616600e-01   -2.834881793886369e-02   +2.449616933370512e-01   -1.668093792523741e-01   -4.196620499866320e-03; +3.934454628699747e-02   -8.678050354968780e-02   +5.540862965091956e-02   -1.455091111112596e-01   -3.344067810250285e-01   +1.414550280825424e-02   -6.267131607942809e-02   +1.691717230597245e-01];
L3I_L3E_iAMPA_netcon = [-4.400968453082756e-02   -6.735581197496256e-02   +4.456466055474958e-02   +5.818331615866319e-02   +5.173038483582625e-02   +2.622830565032649e-01   +2.779777076059942e-01   -1.098590971843161e-01   +3.325399958071978e-02   +2.752402448497002e-02   +5.440224706905342e-02   -2.778375841459690e-01; -1.256426361191021e-02   +5.867066723618526e-02   -2.678898757847278e-03   +7.543041827577686e-02   +2.878273950266898e-02   +1.549612300823117e-01   -9.879788339540128e-02   +1.674525493593187e-01   -1.820952117746910e-01   -1.492044873012911e-02   +1.254152450567357e-01   -1.236722020713973e-01; +1.854341571925204e-01   -1.699333131127310e-01   +6.146549267985818e-02   -8.838014891091488e-02   +1.171447133846734e-01   -4.008234426690697e-02   -1.193521435279186e-01   -2.083680174154939e-01   -1.234595580472740e-01   +1.831683855542656e-02   -1.055090474359787e-01   +1.883529338568242e-01; +8.866870815034499e-02   +2.548677612310530e-01   -2.498106719089927e-01   +3.016828622154338e-01   +2.240612173961754e-01   +5.418964852287829e-02   +4.992116716882045e-02   -1.634072862068733e-01   +1.638250701350793e-01   -9.412267555965198e-02   +2.184657799085875e-01   +3.762048723458368e-02; -3.080872417238038e-01   -1.538355642865394e-01   -8.427887260809595e-02   +5.238776583555976e-02   +2.812949991935020e-01   -1.215805277766450e-01   -6.571106280307683e-03   -9.956191114483129e-02   +1.337872106084289e-02   -8.728126991610891e-02   -1.334804599401851e-01   +3.375598647559271e-01; -1.019343502836925e-01   +3.307187314712597e-02   +3.098862338065515e-01   -3.206708679005097e-01   -3.330414562048756e-01   +6.289295272164816e-02   -1.946963731625548e-01   -9.450646868551263e-02   -1.283427261543152e-02   +5.323245599524584e-02   +2.838018327308758e-01   -1.842289788645521e-01; +8.376054893417066e-02   -3.997194801900902e-02   +9.848037869423752e-02   +1.334868808156502e-01   -9.853579463607905e-02   -2.709139313572082e-01   -2.206047695914752e-01   -3.340517792037794e-01   +3.421207590450723e-01   -3.741153481387053e-01   +1.511689539658090e-01   +3.464548796412398e-02; +1.523049570368565e-01   +1.939642998583375e-01   +1.981158878919675e-01   +6.535309289177529e-02   +1.654833061772820e-01   -7.672279262414897e-02   +1.670274635293399e-01   -2.537859118447307e-02   -1.069848370932442e-01   +7.759503936874555e-02   -3.016444727741495e-01   +5.477080162996657e-02; -3.953341203361846e-02   -9.578060457749556e-03   +5.783184924126143e-02   +1.763248339892060e-01   -4.621882545957549e-02   +1.645656276544121e-02   +6.461543962222924e-02   -5.753275180101793e-03   -1.317856359718882e-01   -2.552929448165804e-01   +3.042518865426898e-02   +9.711231101204915e-03; -9.249253319488607e-02   +2.823782971631082e-01   -3.488878024342926e-02   +7.224854467421432e-02   +2.046479476018378e-01   +1.394739388740155e-01   -2.026944043872753e-01   +6.151439118980836e-02   -1.385774758999184e-01   -5.453297393791499e-02   -1.348948183872845e-01   +3.927356523770452e-02; +2.112615775563079e-01   -6.141950982904759e-02   -4.532158567892154e-02   +1.413888375675778e-01   -3.641183036000709e-01   +6.891702731842797e-02   -5.441510999664054e-02   +3.650806974888524e-01   +4.530991542535199e-03   +1.213464484223250e-01   +1.385416477819765e-02   +4.986035435160909e-02; -1.919119772604691e-01   +3.589824226654362e-02   +8.203192109798982e-02   -8.027781074495645e-02   -2.232752919426351e-02   +8.743945181167288e-02   +1.741962340245481e-01   +2.800483931749038e-01   -1.604731376065725e-01   +1.987595173463606e-01   -1.780721874387694e-01   +2.103724770588167e-01];
L3E_L3I_iGABA_netcon = [+6.695989372027329e-02   -1.591935134340187e-01   +7.986642837853467e-02   +2.007789969090790e-01   +1.316788342034481e-01   +2.330074696824330e-01   +2.677551005280895e-01   +3.774765446995446e-02   -2.621143297893884e-01   +1.298066428775661e-01   +2.260154509461584e-01   -2.094183136590582e-01; -1.045072238603974e-01   +2.743545265490077e-01   +1.725205375999872e-01   -9.484760465789333e-02   +1.260652198002379e-01   -1.969556432291775e-01   -8.108242899931373e-02   -9.984323092745379e-02   +6.469502749201847e-02   -3.262541056324675e-01   +6.649460103083288e-03   -2.295048422243424e-01; +5.461025526786735e-02   -1.394327909179890e-01   -8.812262635990538e-03   +8.227010056767924e-02   +2.398004152915316e-03   +3.846319577627744e-02   -3.259206681693469e-01   +9.969227358340788e-03   -3.287298879292801e-01   +6.086973667759889e-02   -2.907134582774886e-01   -2.722392755347690e-01; +4.755882449741522e-01   -4.327511446688330e-01   -9.174809705069070e-02   +5.870161884832127e-02   +5.997098391793913e-02   -1.065179529289872e-01   -4.666550116886103e-03   +4.910250156391346e-03   -9.904242852281324e-02   -8.964383670674603e-02   -1.894029695514530e-01   -1.639993339135739e-01; -8.278310444776081e-02   +2.031108464068617e-01   +3.909640735688714e-01   -1.771996853795202e-01   +3.926912641972441e-02   +1.486518290013691e-01   +3.192000217600353e-01   +6.825967468158962e-02   +8.483423589728561e-02   +6.855626416287657e-02   -3.455463305633264e-01   -2.405135840952776e-01; +1.279937414548464e-01   +1.757145020358832e-01   +4.626513795110187e-02   +4.784921435083966e-04   +1.343269112121581e-01   +7.982314779229377e-02   +2.219027648551878e-02   +1.119229117131001e-02   -2.311146421538224e-02   +2.694152496406591e-02   -1.984984437626681e-01   +1.662105392463497e-01; +2.318906434927519e-02   -5.587886748869730e-02   -2.256370288532649e-01   +3.099088322845131e-02   -3.072176113945789e-01   -7.972897553280824e-02   +2.403118216179002e-01   -1.035545307030198e-02   +9.420669343454013e-02   +1.962545621195640e-01   +2.095233776734693e-02   +2.875394656584890e-02; -1.359682959102878e-01   +1.799422126403310e-01   -3.337647623183218e-01   +3.103356382629043e-01   -1.493626224995360e-01   +5.688181848658213e-02   -1.287955949280162e-01   +2.375871032241078e-01   -4.742764380514897e-02   -1.062954074357012e-01   -2.713884087097582e-01   +2.099728530174647e-01; +2.254753408257300e-02   -5.807550592580239e-02   +4.783407836054834e-02   -2.326748572948589e-01   -9.855637473476311e-02   -9.650042796400080e-02   -2.171624737871058e-02   +1.466328117270217e-01   -1.937276471153355e-01   +3.666615862459837e-02   +1.144488804151195e-01   +1.137393174760873e-01; -1.024783656757070e-01   +1.870370530910691e-01   -3.237730292403336e-02   -1.318513106268882e-01   +9.299511906885145e-02   +3.740512938485064e-01   +3.561457271064843e-01   +3.151544456973081e-02   +2.746076726215660e-01   -4.225937912444640e-02   +1.496431523753171e-01   +2.458159294298119e-01; +3.625928087673763e-01   -2.437517896956867e-01   +2.918999863316315e-03   +1.396092015981678e-02   -1.854156077507568e-01   +2.024078306740335e-02   +1.365498815173671e-02   +3.093706809758995e-01   -1.324233770531620e-01   +1.067092810272985e-01   +3.137499667347416e-01   +1.297635103813553e-01; -2.292804714919008e-01   -4.185504001646426e-02   +1.456624172052843e-01   +6.708353744937320e-02   -1.496614942252057e-01   -2.214413311319345e-01   -1.117797135796514e-01   -1.902356956571847e-01   -3.556600361967509e-01   +2.130237769857565e-01   +2.592786328414557e-01   +2.471400621665491e-01];
L2E_Input1_iAMPA_netcon = [+3.456419200064104e-02   +1.173564766761965e-02   +2.489483878818637e-01   -4.617481512579988e-02   -2.622703374385867e-01   +3.131039795866805e-01   +2.367543440259735e-01   -4.764936209165475e-02];
L2I_Input2_iAMPA_netcon = [+3.396603886750444e-01   -3.202132318285730e-01   +1.527982645910596e-01   -9.660772403051233e-03   -1.429184674943298e-01   +1.014073096548465e-01   -3.895820607063347e-02   +4.158548307879886e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
