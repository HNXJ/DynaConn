function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-4.887166406297147e-01   -9.814230681724739e-02   -4.795347278894403e-01   +2.308783636243871e-01   +1.791616266534908e-01   -7.995654368432411e-01   -1.147026063197634e-01   +1.939994360710307e-02   +2.165321525063971e-01   +1.984908514487525e-01   -9.834914106509512e-02   +2.962026326722977e-02   -4.490879208288648e-02   +5.206515404624461e-01   +2.229168162045834e-01   +4.832925035537954e-01; -3.412959765573034e-01   -3.975688079015908e-01   -2.141635159269851e-03   -2.090203199869508e-01   +1.215571783511855e-01   -1.121087296719748e-01   -4.168206391191740e-01   -5.277030790336539e-01   -1.802856727981083e-01   +3.865936430670721e-01   +3.428583709102728e-01   +3.903658333182534e-01   -1.101761660387289e-01   -6.342079148970626e-01   -2.740659585238489e-02   +2.771274271376017e-01; +5.702452283040004e-01   -3.627918774956181e-01   +1.433765363811020e-01   -7.015135001559560e-01   -3.970899533861559e-01   +4.045924331284416e-01   -1.064871679377619e-02   -1.959981639528679e-01   +1.755044458068459e-01   +3.047642686641980e-01   -2.220282022439165e-01   -5.665649779895462e-02   +3.265777082618809e-01   +2.367373493882099e-01   -8.306102628024522e-01   +4.155757024450306e-01; +4.490228964428557e-01   +6.814920379938874e-02   +4.984877252145442e-02   -8.302322278770161e-01   -5.371445304803740e-01   +1.255786357803053e-01   -7.751952747045104e-02   +2.852711439902421e-02   +2.756036177777477e-01   +2.182332698694511e-01   -3.356748574683624e-01   +7.252062665929921e-01   -3.739139343354693e-01   -1.393216106361302e-01   +7.447552664138953e-02   +5.299900257673462e-02; +5.318077305514118e-01   +1.176269271151586e-01   -3.703338494852882e-01   +3.270979152558579e-01   -5.904235196602641e-01   +4.395810211190079e-01   +4.862461931615746e-01   +2.434635438831736e-01   -2.527491149159551e-01   -9.042163602173334e-02   -6.675546055408681e-01   +3.670854547739088e-01   -4.395319535224107e-02   -8.376012777490632e-02   +6.065233239516752e-01   +1.207672224336371e-01; -3.816035017634004e-01   -4.780320111511923e-02   -5.757383991097397e-01   +7.179026679165455e-02   -4.595263290701868e-01   -3.786232423613499e-01   +1.306412351874297e-02   -3.482488451893734e-01   -4.589990397577588e-02   -3.956617864720628e-01   -4.628390577236103e-01   -6.343539905403933e-01   -3.743058732124098e-01   +5.304208127356677e-01   +4.038964286364314e-01   +2.673947687977782e-01; -5.732745196153473e-01   -1.621679941282222e-01   +2.181655366765166e-01   -1.951259137333290e-01   -7.382429368364832e-02   -2.159339395086624e-01   +2.186851699375524e-01   +1.728039243921013e-01   -7.891309060409056e-01   -4.719434726121531e-01   -6.726502607633955e-01   -5.367880280836851e-02   +7.278074337292882e-02   -1.724287178999925e-02   -1.453557069575441e-01   -2.451068778852326e-01; -2.936845793711027e-03   +7.017581543958708e-02   -1.504881060078766e-02   +4.649609565509236e-01   +7.204478812120335e-02   -2.341680695843028e-01   -2.311639555745706e-02   -5.209321611100434e-01   +1.558908995729479e-01   +2.007332416789849e-01   +3.954141505917851e-01   +7.447255480991498e-03   +5.257867262846348e-02   -4.258848087467472e-01   +5.607760496651415e-01   -3.189846272590849e-01; +1.193761548044854e-01   +4.421381272719695e-01   +5.871097817546398e-01   +4.348343555410656e-01   -1.502724171943756e-02   -5.685748817425961e-01   +5.234128426070545e-01   -6.896904834305405e-01   +2.953272977953724e-01   +3.848334690812893e-01   +4.964507774469871e-01   -5.297821535436941e-01   -1.969257483285903e-01   +3.609221350608713e-01   +2.371719602885489e-01   +7.910948685410061e-01; +4.540977078299575e-01   +3.600834119988924e-01   +1.104190132165711e-01   +1.362071072737187e-01   +2.304540815647682e-01   +4.102970858221258e-01   +7.261208975816175e-02   -6.137617619430659e-01   -1.871617028492756e-02   -3.424965750608269e-01   -1.760691098288056e-01   -5.465315798748279e-01   -4.034872462636815e-02   +1.526297247809910e-01   +2.048092696236022e-01   -4.742756360141225e-01; -8.957130658220109e-01   +1.177403155993238e-01   +2.876778498431506e-01   -4.079165717282860e-01   -4.506669946931591e-02   -3.896715706763009e-01   +2.023681197667415e-01   +4.202556683644498e-01   +3.422164677758373e-02   -4.873270791827383e-01   -2.684404806253707e-01   +2.788415863156622e-01   +4.401548129514887e-02   -1.834183751195855e-03   +3.392058651799809e-01   -1.480145914110835e-01; -2.645691669257403e-01   +5.157068861480535e-01   +4.204260904030059e-01   +4.241310024934939e-01   +8.789863656900075e-01   +3.172758603087051e-01   -6.822810729760723e-01   -1.800235414910139e-01   -4.103035740935866e-01   +2.534649035539462e-01   +4.058526779725702e-01   -5.369507983987375e-02   +5.164323590082593e-01   -4.655009529156513e-01   -5.751642757625421e-02   +5.545571159019488e-01; -7.096163924832675e-01   -8.455089607080366e-03   +1.310979785071179e-02   -3.705818545911941e-01   +2.649984100280904e-01   -7.404350823011935e-01   -1.321022416039565e-01   -2.019303965515147e-01   +7.983675889801870e-01   +5.366391848293091e-01   +3.324647441925989e-01   +4.332708076892521e-01   -1.659107286735873e-01   +2.067704792126321e-01   +1.913451224249967e-01   +1.984962005734923e-01; +2.645063925216494e-01   -3.724434692171203e-01   -4.272690104469805e-01   -1.235275877714370e-01   +7.205319516429780e-01   -4.700575749663680e-01   -9.318934411059815e-02   -1.000000000000000e+00   +2.806519970676423e-01   -2.530605128923195e-01   -1.301971570943113e-01   -7.589117019041861e-01   -3.621326252484501e-01   -1.781698803750599e-01   -6.354039006296656e-01   -3.151445154801693e-01; -2.598272667804576e-01   -1.790232350651696e-01   -4.644189347411208e-01   +2.763551462106654e-01   +2.764814282442087e-01   +4.777542964459580e-02   -1.534995596775678e-01   +3.025638209762832e-01   +3.983671641397749e-03   -2.533654063985180e-01   +3.876687909066347e-02   -2.916824241757321e-01   -4.947617831189126e-01   -6.790301602642858e-01   -6.403325684251449e-01   -1.852812526942138e-01; +5.804531751515071e-02   +1.877494066130475e-01   -4.946899995412580e-01   -3.099438595490198e-02   +3.376426071164994e-02   -5.051643039309792e-01   +3.132486022688976e-01   -6.116368244872414e-01   -4.408265429535113e-03   +3.389603555640084e-01   -8.336743133233303e-02   -4.039368348407065e-01   -4.685137256365209e-02   -3.904311481730778e-01   +1.340259120045631e-01   -1.931143169606012e-01];
L1E_L1I_iGABA_netcon = [+4.917474999948339e-02   -3.392372049810649e-02   +3.228156338562349e-01   -2.283603824037430e-01   -2.051797815040457e-02   +7.297643239662668e-02   +8.696288008790757e-01   -2.897809480460536e-01   +3.797799151820168e-01   +1.250210349773710e-01   -1.855178109483409e-01   -4.181371569791941e-01   +4.029226218003022e-01   +3.476044329116079e-01   +5.070236149489682e-01   -3.177606867823121e-01; +5.376176375574128e-01   +2.676058116026031e-01   -7.273892989784250e-02   +9.353730347043809e-02   +3.532122772023203e-01   -2.738281322423498e-01   -4.789566598414197e-01   +1.191327672302460e-01   -3.605255185466846e-01   -8.500213189084003e-01   -1.811038743161664e-02   -1.196731575325112e-01   +1.549625222657855e-01   -5.631979946185353e-01   +2.362409345121229e-01   +2.110744347685827e-01; -7.452288379275178e-01   +1.559385870510842e-01   +8.381044014377345e-02   -6.318937309882542e-01   +2.799894476830732e-01   +8.104075573456329e-02   -3.294703875745509e-01   +8.101693921700671e-02   +7.494880835225790e-01   +6.682642648238429e-02   +1.988226266416893e-01   -6.140646681898263e-01   -1.725190085883723e-01   -6.666132000939424e-01   +4.799267508072079e-02   -2.698745711221183e-01; +6.836591803485288e-01   -3.999316915989256e-01   +3.132669852143924e-01   -4.673695894201157e-02   +2.603398886846366e-01   -7.010065488031392e-02   -3.861322524487426e-03   +6.013402294574693e-01   +1.180815813834285e-01   -5.341706867157382e-01   +7.117407355270295e-01   -5.811443347728131e-01   +1.009837316695614e-01   -1.657506925653887e-01   -4.835209204742680e-01   -2.531564178935156e-01; -2.168015364152236e-01   -8.023798463605369e-02   -3.197161539068477e-01   -8.708619625433591e-03   +4.178969259495600e-02   -3.381539841635183e-01   -5.959313503613465e-01   -4.299573192225937e-01   -6.374944360440318e-02   -4.545674350690483e-01   +3.850763213063979e-01   +3.850210134506775e-01   +2.334146534057577e-01   +1.162477189522331e-01   -3.154644175923131e-01   -2.593507123798161e-03; -2.508112304480394e-01   -2.653254409873827e-01   -3.010855853631562e-02   +3.668316046041992e-01   +2.884080431267922e-01   +8.287024571494994e-02   -6.696536441914829e-01   +3.862005257137014e-01   +2.812153776750430e-01   -4.861200630412690e-01   +3.370830688015918e-01   +5.176274720051368e-01   +1.524135466798484e-01   -3.285495663224388e-01   +6.197786362079306e-02   +3.877370190488547e-01; -1.899012548023875e-01   +1.516810387869714e-01   -7.395417450094038e-02   +2.665484057514917e-01   +5.717240568394627e-01   -2.962674085039775e-01   +2.246604928819065e-01   +3.573182794579993e-01   -1.694843395737489e-01   +3.495883502637437e-03   -2.400548285185036e-02   -6.330762957572413e-01   +5.274144851539225e-02   +1.175464627405471e-01   -3.737434805504214e-01   +2.456935245211216e-01; +1.254107825505211e-01   +5.205787472145553e-01   +5.877802698853991e-01   -4.081244468502416e-01   -3.650612174381318e-01   -6.654079311065925e-01   +3.669375973885397e-02   -2.360847288357044e-01   -4.081157639300911e-01   +2.365760382617623e-01   +2.670875772295976e-01   +4.307882645664287e-01   +4.636071831743030e-01   +3.204017438567439e-01   +3.785186098572189e-01   -1.622372111419124e-02; +3.995667722800011e-02   +4.444038510028652e-01   -7.053421398659437e-02   -2.334568122408658e-01   +1.631981176218529e-01   -6.338911101160354e-01   -4.063380935071425e-01   -6.733198507091911e-01   +2.558310597883400e-01   +3.025144209260719e-01   +3.723719664446842e-01   -3.917157449618202e-01   +3.323556239345304e-01   +2.626966746919331e-01   +1.311362900374546e-01   +4.963009575631420e-01; -5.777670446836919e-01   -1.798844616790185e-01   +7.104925597039708e-01   -4.669370298905177e-02   -2.602733842898631e-01   +4.483535321425088e-01   +7.245613038900767e-02   +4.559175262019484e-01   -3.879764571063375e-01   +4.847556830593640e-01   -4.030566556319339e-01   +1.391392418384936e-01   -2.329463842652910e-01   +1.424311081475632e-01   -5.753756336982201e-01   -4.788082308262868e-02; +3.545915383510003e-01   +3.018700653297325e-01   +7.589359278725782e-02   -3.921873753669295e-01   -9.026846418090460e-01   +8.186585391269929e-03   -3.339298476079238e-01   +2.026917004309565e-01   +1.661628182273850e-01   +4.131486176274621e-01   +8.518544264504607e-02   -3.699235787450325e-01   +9.485965390880419e-02   -1.528751552310043e-01   +1.804791852912821e-01   -3.198976764729267e-01; +3.022853459783989e-01   +1.464057374730295e-01   +1.816424236075785e-01   -8.984428432516789e-03   -2.293890969070714e-01   -2.111560463395653e-01   +3.466111603426947e-01   -1.125604344832169e-01   +2.290418044706656e-01   +2.106985310962506e-01   +6.707946882298197e-01   -9.295605698148449e-02   -3.409871201667932e-01   -3.946787910956345e-03   -9.153207990594836e-02   +7.283151340842264e-01; -1.685418385155967e-01   +2.887193620136289e-01   +4.623406650392404e-01   -6.621081275176645e-01   -5.116569160466699e-01   -1.459825898647571e-01   -6.226181286912412e-01   +4.025089232630418e-01   -2.817147873504464e-01   -3.541986245599081e-01   +3.937302572184719e-01   +1.929421354433331e-01   -3.634541141180369e-01   -4.113291238457444e-01   -6.089448461339859e-01   +1.515752070226856e-02; -6.312776779824225e-01   +2.612337998094735e-01   -4.640487181360484e-01   -3.709357459084214e-01   -2.305616950121741e-01   +1.646684175270121e-01   -5.276692401670067e-01   +2.546269667952864e-01   -4.969162085220362e-01   +8.120424974894343e-02   +1.003590643304779e-01   +2.891238920640950e-01   +3.415035275830184e-01   +3.234834800860937e-01   -1.104618539512373e-01   -6.438440714492917e-01; +3.896254888101971e-01   -1.904794211888280e-02   -4.874346757620711e-01   -4.289239461749700e-02   +1.318019384060906e-01   -1.168806388825898e-01   -1.504298560303541e-01   -7.729338784325483e-01   +3.507387632329598e-01   -4.336355936653140e-01   +3.176573130340187e-01   +5.775094258388505e-01   +1.269894424207040e-01   -1.001891490121932e-01   +6.049664016599000e-02   +3.215021907857408e-01; -5.013747822420911e-01   +4.641697781585630e-02   +3.601263292996190e-02   -3.693252410279708e-01   -4.316946939990418e-01   +2.082638804358378e-01   -9.309512629984903e-02   +6.472673243204803e-01   +4.567464080159354e-01   -7.033183988712324e-01   +5.826002641356032e-01   -3.499510441804457e-01   +6.952933382323572e-01   -4.575512423740286e-02   -7.087787056183086e-01   +1.120897896274897e-01];
L2I_L1I_iGABA_netcon = [+1.815364227654537e-02   -1.157185851424307e-01   -1.948354087537823e-01   -4.121014318317422e-01   +8.491598910503062e-02   -2.698786874281529e-01   +2.867896483297089e-01   -9.980074094823005e-02; +3.507742846952772e-01   +3.478509446711809e-01   -1.548212774733173e-01   +2.836477821936050e-01   +4.535492315059280e-01   +4.033136203017434e-01   -4.269500964710404e-02   +9.996908612807903e-02; -1.098883618962822e-01   +7.251044978745946e-01   -6.399747411500797e-01   +3.003555344994943e-01   +2.246525437435742e-01   -1.533105585610519e-01   -6.093856540837299e-01   -1.203797317404627e-01; +4.813671874221225e-01   -1.043684290724565e-01   +4.959404354570494e-01   +5.678054151905308e-01   -7.842546112847617e-01   +6.773434605147470e-01   +3.078103987922529e-01   +3.415871629512645e-01; -4.415103725169938e-01   -3.165770631349455e-01   +9.586017638995297e-01   +2.989134921398691e-01   +8.889959670179888e-02   +3.156881355310946e-01   +6.430927253652646e-02   -5.636968454431396e-01; +3.165769645231103e-02   +3.897757835824067e-01   -7.840314582270175e-01   +8.158216403718375e-01   +6.189470520382531e-01   -8.024186353225984e-02   +4.068440384134370e-01   -1.917284665259937e-01; -6.571320095934575e-01   +3.664521798401183e-01   -6.876222024965828e-01   -7.120706310015200e-01   +1.232803192897366e-01   -3.995726468211819e-02   +2.343125478714262e-01   +1.494953167514984e-01; +1.222106940966343e-01   -7.752822781276245e-01   +9.668275048673253e-02   +4.821831022857748e-01   +2.605177141986961e-01   +6.867334608077655e-02   +7.905495988008107e-02   +1.874513794463758e-01; -5.225097478708017e-01   +2.139363745904191e-01   +2.863915418743415e-01   +6.204492956938321e-01   +3.428598286882433e-01   -4.543580855384328e-01   +6.028220892292238e-01   -7.900538689254180e-01; +3.797297159674964e-01   +8.015688515541286e-02   +7.728936331828400e-01   -1.373665747180073e-01   -3.958508563335207e-01   +2.083548039826039e-02   +4.353282600318922e-01   -9.274385598161695e-02; +7.123359147316228e-01   +2.743694747989555e-01   -3.929130465290473e-01   +6.617193016452880e-01   -5.433907509936855e-01   +3.884529029114478e-01   +3.373841231609550e-01   -4.384458014645832e-01; +5.827897489288425e-01   +4.526151348106312e-01   -4.716458887127289e-01   -5.420599677496807e-01   +1.235548611985149e-02   +6.901288422570060e-01   -1.990694101089938e-01   -2.259421548731393e-01; -1.124281367018702e-01   +2.442413707182969e-01   -3.995415220011498e-01   -4.846445392540415e-01   -3.866260388574121e-01   +4.706137137262782e-01   +7.887281577056109e-02   +4.221622922731204e-01; -4.859189060536561e-01   -6.097962579532485e-01   +1.431372201248165e-01   +6.189717125595884e-02   -2.643101185372774e-01   +3.794867168028170e-01   -1.458460376264087e-01   -2.965420457241159e-01; -7.816403629972346e-02   -1.609486465824855e-01   -4.917544133015676e-02   -1.855692436540069e-01   +3.023798699987761e-01   +2.109304202032352e-01   +2.871037150891553e-02   +3.356646715021736e-01; +6.107697836052611e-03   +7.380553865906241e-01   +4.676235521025490e-01   +8.568168115794135e-01   +4.995508392863067e-01   -2.203020053784821e-02   -1.933555180518057e-01   +3.574815632311797e-01];
L1I_L2I_iGABA_netcon = [+3.163716418322893e-01   +8.934753423936546e-01   -5.555052041113883e-02   +6.570365606638755e-01   -1.342493839972496e-01   +4.975830909154040e-01   -3.283401311128352e-01   +7.239049907314855e-01   +1.045673514358219e-01   -7.222001203130293e-01   +7.259256988988654e-01   +6.329029362745351e-01   +9.258060578105437e-03   +4.724443341413864e-02   +9.323452320651654e-01   +6.182877459132294e-01; +1.902018317826143e-01   -3.052672372748364e-01   +5.812942101512644e-01   -2.085766839238557e-01   +6.311588330730327e-01   -7.184910928364689e-01   +6.266988345961161e-02   -6.735134702913314e-01   -1.745691178233111e-01   +5.593464093718717e-02   -1.122808638068148e-01   +6.151617695741505e-01   -7.631110358590532e-01   +4.471700714037303e-01   -4.207660762719891e-01   +2.444797434002671e-01; +3.376106275971562e-01   +4.889713731424886e-01   +2.328084084371455e-01   -7.853057798899805e-01   -7.279828545313942e-01   -7.109121869736247e-01   +6.255144592968359e-02   -5.235706820379116e-01   -3.238381900420272e-01   +7.688417257122119e-01   +1.135980272128652e-01   -4.995941720172851e-01   -1.670898809614424e-01   -5.617553466443764e-01   +2.368425842776573e-02   +2.322191494432535e-01; +1.018109735661776e-02   -6.209034732408308e-02   -7.236393731558866e-01   -5.704792960957008e-01   +1.032694293988439e-01   +1.928691841248141e-01   +7.985566704508651e-02   +6.068130117431094e-01   +2.840128121174023e-01   -2.420180576758810e-02   +1.214170704092466e-01   -2.002232013786515e-01   -2.696310553734003e-01   -3.600702846348002e-01   -1.971398552394351e-01   +2.929335522226212e-01; +2.898653569787000e-01   -9.020928959492867e-02   +4.836529813313344e-01   +5.081055091000520e-01   +7.737880408079443e-01   -6.305041316048791e-01   +1.624526875327345e-01   -1.247651053312771e-01   -7.671058730288995e-02   -3.889085828725405e-01   +8.648381057497755e-02   -2.027555481923407e-02   +1.542985757506929e-01   -2.956161852352857e-01   +3.554382076511906e-01   -9.788438337936813e-01; +4.478293453136915e-01   -4.903242657664412e-01   -2.647552643023897e-01   -7.012103749211336e-01   -2.690306221906530e-01   -3.659006665510279e-01   -2.416546663887120e-01   +6.291206952298999e-01   +4.037224904761976e-01   -6.288441136166512e-01   -1.600997675384771e-01   +2.844882978464168e-01   -5.417422504973325e-01   -4.697692893347512e-01   +5.144779793395612e-02   -2.413742826118499e-01; -7.520848432388770e-01   +7.397094837647963e-02   -5.452726751082382e-03   +7.454061898558432e-01   -4.573221035103764e-01   -4.965982668458586e-01   +1.635882543495448e-02   +8.305725249409041e-01   -6.003673239091594e-01   +4.307364729850298e-01   -3.510520022837068e-01   +1.044110969019292e-01   -1.516220010475863e-01   +4.334980257715461e-01   -8.908478469606432e-01   +1.086833634901062e-01; +1.639500131919860e-01   -5.034410145965903e-01   +7.846914001448269e-01   -1.069519792978278e-01   -3.438418959014650e-01   -3.907093483619680e-01   +9.724357148185414e-02   -4.045644248669726e-01   -3.561107004378109e-01   -5.111151259207253e-01   +2.979488079270280e-01   -5.088902507691334e-02   -1.845431968539617e-01   +1.027314382278528e-01   -5.750545145561260e-01   -3.044917375276331e-01];
L2E_L1E_iAMPA_netcon = [+1.696315926819212e-01   +3.524386379969604e-01   +2.082827206238030e-01   +1.583787215458363e-01   +4.917454426694461e-01   -4.441334079460373e-01   -3.765081435297379e-01   -5.125818652636025e-01; +6.882941900507556e-01   +2.971874976091680e-01   +4.469988078043072e-01   -6.655392654770201e-01   -4.064122584394266e-01   -1.203332193704554e-01   -4.804400309233606e-01   +4.480357450161360e-01; -6.621126837509160e-01   +2.608630147139424e-01   -5.196622772239943e-01   +3.932867902157309e-01   +2.050561440266294e-01   -6.085084352523404e-01   +3.288646275168619e-01   +3.862712121639656e-01; +9.734539497961107e-01   +2.442558354845645e-01   +2.623839205091283e-01   +7.303478755981386e-01   +1.263982819025512e-01   -2.014298329491574e-01   +5.439400314346290e-01   -4.281689034683139e-01; -5.613334899145003e-02   +5.548707204159015e-01   +1.364484850117352e-01   +8.608802645313979e-01   +4.515731246771362e-01   +9.216642800402318e-01   +2.254735279493410e-01   +3.355092703897559e-01; -6.441661126456865e-01   +8.223104493942085e-01   +3.418996868767840e-01   -3.420824499943878e-02   -1.142772380807512e-01   -5.299835578639922e-01   -3.498013913933078e-01   +1.059567033711013e-01; +3.845059502682849e-01   +5.440638472061993e-01   +7.610828613799173e-03   -8.172295119805945e-01   +5.287791257266349e-01   +5.325402562626583e-01   +2.227705886046573e-01   +6.325357664291582e-01; +1.477616242697537e-01   +3.753086958888460e-01   +9.769250682898160e-02   +3.370761635209132e-02   +1.169730123435662e-01   +5.353750394804342e-01   +4.156587620809709e-01   +4.032001644965821e-01; -4.193961511286893e-01   -1.893839305213938e-01   +4.530792968739564e-01   -3.381086037411453e-01   -1.621610474274981e-01   +6.625790875559314e-01   +1.833964366932009e-01   +1.872337008885819e-01; -7.540009806613009e-01   -3.983162370036342e-01   -8.239815231750477e-01   +2.731998099106598e-01   +1.886534504789856e-01   +3.115274372719140e-01   -1.135716185775878e-02   +1.000000000000000e+00; -4.526030979719114e-01   +8.254694508970106e-01   -8.727282206982048e-01   -8.418234128469124e-02   +3.532720446527047e-01   +8.044750754242451e-01   -2.111479997237085e-01   -3.237543287820575e-01; +9.720644535997598e-02   -4.165168356895363e-01   +3.149410251223652e-01   +1.833556724722171e-01   +3.538344128542362e-01   -5.935229971553414e-01   -2.094816445653662e-01   -4.897485968961070e-01; -7.252989644401470e-01   -3.169432807383778e-01   +5.888587441771099e-01   +2.198089818919884e-01   -5.151689576543178e-01   -3.835154495876562e-01   +2.368210134953574e-01   +6.762486826379067e-01; -2.836403910131499e-01   +5.893950574727801e-01   -1.704238786398552e-01   +1.425401291830367e-01   +5.515509445974585e-01   -1.534861745843637e-01   +7.513733914167678e-02   -3.270297874677362e-01; +2.321094216017551e-02   -1.549212917988075e-01   +7.248624666191589e-01   +9.116627871744891e-02   -2.536255876601826e-01   -2.158515877629375e-01   -5.170629619480210e-02   +2.304104886847850e-01; +6.625072921457973e-01   -7.502426050568851e-02   +5.617825505735887e-01   +2.654597153665845e-01   -5.195393686410534e-01   +2.174278106273812e-01   -4.996329593119669e-01   +5.879183523606188e-01];
L1E_L2E_iAMPA_netcon = [-1.363150559370635e-01   -5.308584458380616e-01   +5.126871219672555e-01   -7.567375077125452e-01   -1.556112820684641e-01   +2.606703827312310e-01   +9.402283909650348e-02   -1.726260081145153e-01   +1.368877880661107e-01   +1.713303543858381e-01   -4.876653950474669e-01   +3.334257100449521e-01   -1.462986716022401e-01   -3.625508632040707e-01   -4.291702495203820e-01   +4.491489082279064e-01; +1.596098018360806e-01   -2.597384236897818e-01   +7.505295205374919e-01   +5.443780050498936e-01   +1.123767168377400e-01   -5.107431514509733e-01   -1.731058807660598e-01   +6.581874458629394e-01   -2.935242459437802e-01   -3.140361672743645e-02   +5.159011839151653e-01   +7.351815950591312e-01   -4.952546391130482e-01   -2.009832750080028e-01   -2.436762783510560e-01   +1.326922352336736e-01; +7.038402526424203e-01   +4.932860514805376e-02   +2.731612114168429e-01   +4.278085351946913e-01   +7.369606863415361e-01   +4.038868146170279e-03   +2.925130306365130e-01   +4.431010280729678e-01   -2.033281481302625e-01   +5.243552370895429e-01   +3.641733309223151e-01   +3.065817784067915e-01   +5.245812065550233e-01   -8.672133433740323e-02   +1.045573156104383e-01   +3.113414760943767e-01; -2.308566031168100e-01   -6.589398469185604e-01   -2.106616087376754e-01   +4.117334535544360e-01   -5.896985749910995e-01   -2.028137434941693e-01   +9.063417993690995e-03   -5.546790363047440e-01   +2.593382356880541e-02   +1.549079545564351e-01   -3.238534474369121e-01   -3.271979222193659e-01   +6.746442681812757e-01   +4.707304440330400e-01   +2.326206130045692e-01   -5.235585392477291e-01; -3.162936510314989e-01   -1.271730120150320e-01   -5.225629386365891e-02   -4.791348642765771e-01   -5.908756641587694e-01   +1.972506461207805e-01   -5.020400892468265e-01   +2.477695053089029e-02   -2.693063209293318e-01   +4.505073149774979e-01   -1.529694713476629e-01   -3.094144469306128e-01   -6.371564243021886e-02   +3.789468764929774e-01   +5.586321702427659e-01   +4.420310052409271e-01; -4.970063958106446e-01   +2.455246272491598e-02   -5.199397738179335e-01   -1.922251076661526e-01   -1.750764670909940e-01   +1.000000000000000e+00   -4.752138046276043e-02   -3.313004662870420e-01   -6.788771533604180e-01   +1.551498634491588e-01   -5.134242350583859e-01   +4.630559617208146e-02   +5.658976746995397e-01   -1.162393621547433e-01   -6.328116649200162e-03   -1.559257094280682e-01; +1.521606262882378e-01   -5.350996915177010e-01   -5.875132264844981e-01   -1.000717801297365e-01   +4.819994802316319e-01   -3.604891319449393e-01   -1.057486475146477e-01   -1.832373844546006e-01   -5.127791415210096e-01   +8.495406425949058e-01   +2.590273758275421e-01   +2.046315200971562e-01   -4.784289250885821e-01   -7.942453672479374e-02   +2.071236373934872e-01   +2.734892449276905e-01; -7.961858731678099e-01   +5.384212138250210e-01   +4.363866305729103e-01   -7.086764337495806e-02   +4.177516150845663e-01   +1.643773991368200e-01   +7.752525441520953e-01   +1.670138300412524e-01   -1.350937141266480e-02   -4.709062554522846e-01   -2.394331029517699e-01   -1.522697480895053e-01   -7.306907395354171e-01   -6.036646340880065e-01   +2.570291181891347e-03   -1.840330464018590e-01];
L2I_L2E_iAMPA_netcon = [+6.031718329061553e-01   -4.532848852828097e-01   +2.931362221626172e-01   -3.784140105633912e-02   -3.563069837478818e-01   -3.896069357704433e-01   -7.211433904537023e-01   +6.127365500317696e-02; -6.026298802347404e-01   +4.493998826055234e-01   -4.822233718089154e-01   -9.373109923075473e-02   +5.009103500088166e-01   -8.027198129291486e-01   +6.602939692446959e-01   -3.368299825894338e-01; -2.761033674723380e-01   +1.283097415669555e-01   -4.544893849968106e-01   +7.157732325867189e-02   +9.552378262686447e-01   -5.125475038998111e-01   +2.942649941837301e-01   -1.708807946260588e-01; -2.991950181725100e-01   +2.743522598705841e-01   +2.425819932002110e-01   -3.849763540065110e-01   +3.475285589125905e-01   -6.405163950054447e-01   +2.368124630567049e-01   -2.399894267356160e-01; +9.523165437459102e-02   -2.322637714994750e-01   -4.008545556495172e-01   +3.174796980841561e-01   -9.370425729307499e-01   +4.996206968114976e-01   +2.623843979787018e-01   +4.038285834760236e-01; +5.221581255336084e-01   -2.512369634967957e-03   -7.922012945195049e-01   -5.885125739364296e-01   -2.112858455992384e-01   +1.266450556482116e-01   -4.020943537610260e-01   -2.685545317338169e-01; +8.302536630913955e-01   -1.869811919249421e-01   -1.115766184282376e-01   +7.376429174074212e-01   -7.387731970039352e-01   -1.188391009156128e-01   -2.343312246463428e-01   -1.109351130242163e-01; -6.315871951221363e-01   +3.687349063735334e-01   +5.486570284967185e-02   -4.245528598266739e-02   +1.210068142359329e-01   +4.302996222657122e-01   +1.898839799040515e-01   +1.879565971160334e-01];
L2E_L2I_iGABA_netcon = [+4.654982157838767e-01   -4.146859451965901e-02   +3.147799053873582e-02   +4.941798099453432e-02   +1.560884582979870e-01   -1.675272331349505e-01   +1.162456078709874e-01   +9.156804074759235e-02; +1.518689639202172e-02   -1.910767655713908e-03   -1.895260419839877e-01   +6.627820606359568e-01   -5.849796599975093e-01   +9.939161131792403e-02   +5.156657041663315e-02   -4.778514146832616e-02; -5.736780685425714e-03   -5.848813206828051e-01   +1.591409842305181e-01   -5.474554105866978e-01   +1.000000000000000e+00   +7.795107293378871e-01   +9.270071258510310e-03   +4.293842612398612e-01; -6.457113973652917e-01   +6.543646672437042e-02   -6.174871067706164e-01   +1.017563079921394e-01   -4.253108291380917e-01   +3.602314975636702e-01   -1.526798721094077e-01   -2.834553863826581e-01; -5.479273642196730e-01   -9.357657844864421e-02   +1.063973263890426e-03   -3.811803794063127e-02   +2.258859926371020e-01   -2.293994280151176e-01   -4.800473291978517e-01   -7.063698448793754e-01; +3.388559811502356e-01   +1.465701322434942e-01   +7.912384892001149e-02   -5.606085531390100e-01   +2.902484736660949e-01   +2.470781611496212e-01   +4.939993541751734e-01   +7.780579051009513e-02; -7.496041566568260e-01   -5.984568658775213e-01   -1.376133582779664e-01   +5.138492951354946e-01   -3.890118407953582e-02   +4.254778493098368e-01   -6.703764742928268e-01   -3.911597667193154e-01; +4.584697415981246e-01   -3.003560278063017e-01   -4.758848047433012e-01   +2.390274009580469e-02   +3.209605534947867e-01   +2.250230124483223e-01   -4.723708788944037e-01   -7.433054717871955e-01];
L3E_L2E_iAMPA_netcon = [+1.000000000000000e+00   +1.154652847523345e-01   -1.230075388687406e-01   +2.734436429628316e-01   -3.903459718578269e-01   +3.705725396319285e-01   -4.173192030432384e-01   -8.801206711874129e-02   +3.191170208045664e-01   -3.894509279005203e-02   -1.693771938154330e-01   -2.463484517024416e-01; +3.821208492059568e-01   +1.252749555120586e-01   +1.211374372254874e-01   +1.183455070528273e-01   +5.405392907485952e-01   +2.604072676661408e-01   +2.339159845545030e-01   -5.564737336118831e-02   +7.104465970836780e-01   -1.197578817454127e-01   +4.575745014596461e-01   -8.678192038715590e-02; -1.571787590219903e-01   +3.501083400905553e-01   -2.611932655174387e-01   -7.299387015652179e-01   -1.279950573515033e-01   +4.422204483308957e-01   +5.647899712637218e-01   +6.493249033738933e-01   -1.160266654898640e-01   -3.487046223684429e-01   -4.556230794649754e-02   -4.863336981280153e-01; +2.540061770159407e-01   -5.361427428814863e-02   +1.253788040199201e-01   -7.456759089558646e-02   +1.410955869621397e-01   -3.408576073759912e-01   +4.697928405386639e-01   -5.444620790017016e-01   +6.331639073541269e-01   -2.386090855958999e-01   +2.333385738685844e-01   +1.376955851921342e-01; +5.653699887657060e-01   -5.188137640706491e-02   -2.689915140981492e-02   +1.655081192787332e-01   +7.823325973441357e-01   +4.862222809762473e-02   -3.544232620054858e-01   +1.432297862659467e-01   +8.174302792580071e-03   -5.997950482698143e-01   +6.285118251390603e-01   +1.641779721285092e-01; -1.745347268092028e-01   +1.724881788353728e-01   -4.374625231112942e-01   -7.255521683380244e-01   -4.928243900893989e-02   -2.954515247600074e-01   +2.476876409923838e-01   +3.411454285439688e-01   -4.143744734788503e-01   +1.827659235115313e-02   +1.967321995295372e-01   -4.527966825845040e-01; -1.033564742149484e-01   +1.144949624034163e-01   -4.508940127621596e-01   -6.798758528855946e-01   -3.286741189047693e-01   -1.596613019977083e-01   -6.615842172386626e-01   +4.222978373771819e-01   -1.056609671667324e-01   +5.713242957138478e-01   -2.096344849443564e-01   -6.220579671861632e-01; +1.454269466137666e-01   +4.125586616196481e-01   -3.224366525636423e-01   +3.964977063443303e-01   +2.904525467151879e-01   +6.179049620130914e-01   +7.055960506962891e-02   -2.455023285852884e-01   +4.957480351173898e-01   +9.757638276093286e-01   -7.165860254422995e-01   -6.220468312550356e-01];
L3I_L2I_iGABA_netcon = [-6.977294048889531e-01   -3.861305430806505e-01   +1.206893840173704e-01   +4.331908080979938e-01   +6.283457498077072e-01   -3.026655638054787e-01   -3.420992965849592e-01   +3.767915819853650e-01   -6.273363907171166e-01   +4.335692780555253e-01   +7.198073268383146e-02   +6.927001504774716e-01; +1.738373203878002e-01   +5.549863708706837e-01   +6.215012019387669e-01   +6.572749226812413e-01   -4.027133389135083e-01   -4.781560437792897e-01   -7.959224049798337e-01   +2.136538564985949e-01   +5.998861727339225e-01   -8.785100473626675e-01   -7.136718126951778e-01   +3.265878761452263e-01; +1.720391290467094e-01   -5.745373649838471e-01   +7.287276010301458e-02   +4.895982545839518e-01   -6.889513834675318e-01   -4.667442110898186e-01   +3.767190607828665e-01   -1.958665225371363e-01   +5.772545266380738e-02   -1.969612062715469e-01   -3.642745747380568e-01   -3.680272419682601e-02; +3.020339653479456e-01   +5.780507603228625e-01   -6.496694684962333e-01   +2.183397258833734e-02   +2.724183096122436e-01   -7.111594785609010e-01   +4.515727486335871e-01   +4.103840611291875e-01   -1.687565308333548e-01   +4.777932144996772e-01   +5.151665865527074e-01   -6.900525594945300e-01; +2.308375131600403e-01   +7.862377341219806e-01   -2.722018806141770e-01   -2.415180745266483e-01   -4.221743354761743e-01   -8.648790089857417e-04   +4.083463820754086e-01   +4.317527289179336e-01   -4.731417329934396e-01   +6.977729161778000e-01   -1.873792814611286e-01   -4.132843513452734e-01; -6.970382084138218e-01   +5.841433303576869e-02   +6.178348182737506e-02   +5.873091892454489e-01   +1.716753952456602e-01   -3.116537532522877e-01   +3.242581896744630e-01   -3.779353356859021e-01   +7.401558301372640e-02   +8.698239038971231e-02   +2.971670665052328e-01   -2.313638513124008e-01; +5.670320436933687e-01   +5.844772975778685e-01   +4.531898613604735e-02   +1.223569742814478e-01   -5.817558393077873e-01   +3.763718363911248e-02   +5.739221667173494e-02   -5.131113366621900e-01   +7.528931649296297e-02   +4.848951585847238e-01   +2.478325575601110e-01   +4.061962451843918e-01; +1.123024256189240e-01   -3.365090205869335e-02   +2.381444645219544e-01   +5.953287924290782e-02   +2.302981734065513e-01   -7.553346607645794e-01   -5.356517524614353e-01   -3.043851957256078e-01   -2.091004069704404e-01   -3.725846628330178e-01   -6.377909354548555e-01   -4.619165802101806e-01];
L2E_L3E_iAMPA_netcon = [-4.521418114257762e-01   -6.314528035037935e-02   -3.394627176188951e-01   -3.985924064036957e-01   +4.856324232372632e-01   -5.788371124828093e-01   -4.072768697876150e-01   -4.617503675436521e-01; -9.836013324336480e-02   +2.635045745293327e-01   +1.042319728562383e-01   -1.756357421520864e-01   -6.776807768934801e-01   -1.505299503664440e-01   -3.152829897496666e-01   +6.136588467119248e-02; -3.217407728052732e-01   -4.138649339473501e-01   +4.630427045124644e-01   -4.773734245357862e-01   +1.215172016165134e-01   +9.834218508807764e-02   +7.539890834321973e-01   -1.882764522130015e-01; +3.402659592774185e-02   -7.001584301917934e-01   -2.569962827052644e-01   +1.236826967594613e-02   -3.203314236132658e-01   -2.008855082595459e-01   +7.233025176579871e-01   -7.791894930403233e-02; -2.781746691607681e-01   -1.000135586591076e-01   +3.086712193701172e-02   -1.874050473170169e-01   +1.388533731360715e-01   -6.714538355347816e-01   +7.785810043164980e-02   -1.000000000000000e+00; +2.878025130286925e-01   -1.472806214725529e-01   +1.756464812205702e-01   +7.220457688413842e-01   -6.939430135086121e-01   +7.609181712433653e-02   +6.814027497582753e-02   -1.494980180165217e-01; +2.637762892579106e-01   -1.876117626243699e-01   +2.954388646470623e-01   -6.035207142168464e-01   +2.283210344464582e-01   +5.020453520937403e-01   -1.925649420767751e-01   -3.959989559424599e-01; +2.229686038495027e-01   +5.106636859313475e-01   +1.172026479303746e-01   -9.495512474875833e-02   -3.731256125182371e-01   +7.285280012030283e-01   +2.942794650678200e-01   +9.208611410133030e-02; +2.356380661924219e-01   +4.035376391382563e-01   -7.424170156842533e-02   +7.713947647637255e-01   +4.840229478974112e-01   +2.145324912404561e-01   -1.838127072396760e-01   +3.737990880470730e-01; -3.950064143710078e-01   -3.889409922343584e-01   -3.852167893823099e-01   +4.779088002814381e-01   +6.026420897053113e-02   +3.306565688652063e-02   -1.762115087479899e-01   +4.965825914560325e-01; +3.746044445940431e-01   +4.101452372100587e-01   -6.660333887651172e-02   +2.263854512019818e-01   +5.045672239322948e-01   +2.053643965353002e-02   +4.594102056488196e-02   -2.975858446511249e-01; +1.178728864772621e-01   +1.271403457975850e-01   -9.283285629254723e-01   +2.558925507888435e-01   -1.359200679135962e-02   -3.499464964121969e-01   +4.027211098234487e-01   -3.174956978821444e-01];
L2I_L3I_iGABA_netcon = [-4.926333823367571e-01   -2.436055791286642e-01   +6.306122013505582e-01   +4.045072747780737e-01   -4.207393605196891e-02   +4.680865881718360e-01   -2.084007203976079e-01   +8.019313259778693e-01; +1.926231213926172e-01   -3.232858594747802e-01   +2.531687744980102e-01   +4.689953592688387e-01   +4.919071440918998e-01   -6.796466811354177e-01   +3.803597859644544e-01   -1.061299887756062e-01; -1.570324959463013e-02   +1.029037614687217e-01   -6.825232258661220e-01   -3.929624654762121e-01   +2.629873922733605e-01   -5.961976629510904e-01   +5.361945957817998e-02   -1.470466907131057e-01; -1.087821859660128e-01   -1.806848322959477e-02   -3.350020474321675e-01   +1.920096709273096e-01   -8.503873247991867e-02   -4.219032278627580e-01   -3.727943288094593e-02   -1.617777910932998e-01; -5.316138089068775e-01   -4.200407579229545e-02   -6.850590306694379e-02   +1.789881057576631e-01   -4.071849208496685e-01   +2.126556783905534e-01   +1.221807624416743e-01   -5.424486710508858e-01; -1.689307984331655e-01   +1.113476303706640e-01   +1.885358606181025e-01   +1.066555831286042e-02   -3.309891986636575e-01   +8.540545049325048e-01   -2.676507408591503e-01   +5.004233982901912e-01; +7.099951984623265e-02   +4.214223557591070e-01   -2.102770116667497e-01   +1.721510439106532e-01   -3.071448947919465e-01   +1.459132905040714e-01   -1.035351406319628e-01   +3.307163122187521e-01; -6.752029882531924e-01   -4.644337814247573e-01   -8.506399446003038e-02   -4.727491733638825e-02   -1.223183586633166e-01   -1.641497817254274e-01   -8.151150932169478e-02   +9.252288225649461e-01; -7.980241434914626e-02   +8.534258732549352e-01   -2.194230356309980e-01   -9.712754371509950e-01   +3.852909767032029e-01   +2.439298432313231e-01   +1.982030167222211e-01   -2.368133343324912e-01; +1.063368554391126e-02   +2.146352460083180e-01   -2.060617086684382e-01   +4.390091947279420e-03   -3.009075865085249e-01   +2.910753302122672e-01   +3.523585006572217e-01   +9.066043475093066e-02; +5.957462080699100e-02   -7.637254607965229e-01   -5.881700993582484e-01   +6.219077824759351e-01   -2.979837193082435e-01   +1.997335102180183e-01   +4.551071041350989e-01   -2.959787172672257e-03; -1.107801535256107e-01   -6.178840777469182e-01   -3.509217932398424e-01   -4.924194028265344e-01   -2.609534487063424e-01   -2.673618007441056e-01   -7.436372574937791e-01   +8.711558787728152e-02];
L3I_L3E_iAMPA_netcon = [+6.298293628124499e-01   -3.255689268495696e-03   +5.104918228786673e-01   +4.471501456140832e-02   -3.436430420914656e-01   +5.822508670740393e-02   -2.342631634723142e-01   +2.946743089289608e-01   +9.243469909950466e-01   -3.916369544703270e-01   +7.301990853833255e-02   +2.849230215276772e-01; -2.866325978717230e-01   +1.568757772353682e-01   -5.476527065125556e-03   +8.226096906703448e-01   -1.571859201479869e-01   +1.479312304817991e-02   -6.011106542702906e-01   -1.129704919545339e-01   -4.947521567749009e-01   +4.836199905006733e-02   -1.288685471608120e-01   +7.981487398252061e-02; +6.982359493743108e-01   -2.408052776525668e-01   +4.797989444023182e-01   -3.845861878967155e-01   -5.193016052051003e-01   -9.328791134291869e-02   +3.829379834420247e-01   +2.499219356611488e-01   -2.630760790207510e-01   -6.013871168431073e-01   +6.624117686005077e-02   +2.073513798758227e-01; -1.542776743701073e-01   -1.531018364969813e-01   +4.806003785831389e-01   +1.113456040530628e-01   +9.686643738272482e-02   +3.984964708215245e-02   +3.977878027608119e-01   +7.956150639037567e-02   -4.158150587631154e-01   -3.149310356335335e-01   -6.301829079436628e-01   +4.530601082700034e-01; -1.863570360909987e-01   +3.797240426610860e-02   +4.441987678370952e-02   +4.131667154534673e-01   +9.800736470582912e-02   -8.831953466494165e-01   +3.108775344822370e-01   +1.516820613984190e-01   +2.429521993274354e-01   -2.051766650526138e-01   +3.813488541720178e-02   -1.185674601013671e-01; -1.973278359480670e-01   +4.212706485209324e-02   -1.682060103778313e-01   +1.570682894610651e-01   -3.038888563008929e-01   +4.926399176149544e-02   +7.769691977555102e-01   -3.676629569893753e-02   -6.253317629668845e-01   +3.625758714423756e-01   -3.950953496311600e-01   -4.818533562658259e-01; +2.736416730723533e-01   +3.801978973653312e-01   -2.969328683957868e-01   -3.304000926462810e-01   -2.380458762742284e-01   -2.048641427949901e-01   -1.938161343700052e-01   +1.962253944279070e-02   -2.696926540838852e-01   +1.568825507608672e-01   +9.607876492169916e-02   -7.121886302437614e-01; +2.300515564375170e-01   +2.221684016257915e-01   -3.831022288641892e-01   -6.614162950326542e-01   -1.536740907768301e-01   -2.709216036643252e-01   -3.045822561032869e-02   -3.027820575676207e-01   +4.160281497490150e-01   +2.735421812294966e-01   +7.278316819601599e-01   -1.000000000000000e+00; +3.209256244798975e-01   +1.544933418870387e-01   +6.166725889238829e-01   -3.878750703030618e-01   +2.326284127397164e-01   -4.293106874027234e-01   -8.625643641521297e-02   -4.295785592149303e-01   +1.536555021323006e-03   -4.303395216469919e-02   -9.726006365739874e-02   +2.283825311401957e-01; -2.758092949118854e-01   -5.183163011068821e-01   +7.253266819153198e-01   -6.302167567945779e-02   -3.383260807205906e-01   -4.064882906795660e-02   +3.394052200683990e-01   -2.124174983880117e-01   -2.057646905756985e-01   -4.261190496688306e-01   +9.694878983471530e-02   +4.706605848081624e-01; +6.706189575239375e-01   +4.975857394156234e-01   -1.916701329959748e-01   -4.669141376827563e-01   +3.078047012513142e-01   +1.595941312556424e-01   +1.031836550276058e-01   -9.190454275087444e-02   +6.670151627928984e-01   -4.236325777504362e-01   +3.561099017995070e-01   +2.348441607641434e-02; +2.627622823924223e-01   -7.181320206034082e-02   -1.868836206190430e-01   +3.156544043415923e-01   -1.750814540131020e-01   -8.259789611434849e-02   +4.056295836554963e-01   -2.495231781825040e-01   -5.950454760153332e-01   +3.330414341300179e-01   -2.163674867178667e-01   +2.620218643501136e-03];
L3E_L3I_iGABA_netcon = [-6.363610333754116e-02   -3.373653163585880e-02   -5.168520415452980e-01   +6.906544203277394e-01   +1.339370229687752e-01   +8.601987208980842e-01   -1.917110521940990e-01   -7.628984784001056e-01   +3.647175413173847e-01   +1.846111223215997e-01   -3.906294549416833e-01   +1.346504550855282e-02; -7.043112210461208e-01   -1.118324938134353e-01   -2.715242842992130e-01   +1.130299630444152e-01   +6.202634681672196e-01   +3.604418648176256e-01   -4.835182774250692e-01   -1.822908618079671e-01   -1.688817786933356e-01   -2.471214473844780e-01   +2.096426541006632e-01   -4.648599460454943e-01; -1.302412437805985e-01   +5.910195765319226e-01   -2.564986343024602e-01   +4.809638793562767e-01   -3.497673438690510e-01   +6.741917269789348e-01   +9.469651923808948e-01   -6.674086053862827e-01   +2.466503747646198e-01   +2.208051607553853e-01   +3.424898681626976e-02   +1.281560884741018e-01; +3.453044396843902e-01   -2.716407060321169e-01   -6.029030498389736e-01   +1.221026703224596e-01   +1.484676397572491e-01   +5.742910298485115e-03   +2.652579771783680e-01   -2.755518697063399e-01   +2.279043096814396e-01   -2.898559248904366e-01   -5.763514176558242e-01   +7.113448041052026e-01; -6.721842701565944e-02   -3.130418750796243e-02   +2.695693196926050e-01   -3.299516296303595e-03   -2.680783195974516e-01   +2.035596591567477e-01   +2.715092393012573e-01   +1.991192131197074e-01   +3.950885350835989e-01   +2.909740503745475e-01   -4.025969863694607e-01   +7.365073056204569e-01; -2.588337112788257e-01   -8.594251759656851e-02   -5.712047602556947e-01   +1.110745732295464e-01   +2.138184544872229e-02   -7.969185582988147e-03   +1.821006538213413e-02   -6.315978430106061e-01   -8.299437796229273e-02   -7.958388177043914e-01   -1.395701689369782e-01   +2.809391077989246e-01; +6.396613617472242e-02   +5.524400145328516e-01   +5.169268760913068e-01   +2.493941191818002e-01   +1.422351695431058e-01   -1.974551413887096e-02   -5.124870803448945e-01   +6.965064481575631e-01   +3.940232952562526e-01   -3.235853427076231e-01   -2.090116477274678e-01   +1.105255915559500e-02; +6.202807145995580e-01   -2.385407824962421e-01   +9.857357758482910e-02   +5.196306019370976e-02   +7.797762955287943e-02   -1.203089869647976e-01   -2.352777704754672e-01   +6.256069502713655e-01   +1.519107443554178e-01   -7.103655158428057e-02   -1.332474762969697e-01   -4.488426200789191e-01; -4.283553005278389e-01   +2.092453884921274e-01   +4.057245721213718e-02   -1.923144126949313e-01   -2.799356485897951e-01   +5.869479011440468e-01   -2.544917076262764e-01   +8.961882580671108e-01   -4.981389599332110e-02   +4.320960573486241e-02   -2.594220193930183e-01   +1.384608705606041e-02; -5.415384934204496e-01   +1.999568896943787e-01   +3.036645886756491e-01   +1.004200407452409e-01   +5.888999634465811e-02   +4.581793616144136e-02   -5.544686788940278e-01   -5.429764620449440e-01   -2.516267120354530e-02   -3.980765785375839e-01   -9.987859488997601e-01   -3.162754417585096e-01; -5.493570828340490e-01   -7.516540818558820e-02   +3.500606940995304e-01   +1.073900547236592e-01   -6.377584054632723e-01   +4.115585405454066e-01   +6.962858712920974e-01   -5.087854232415625e-01   -6.837367163144740e-01   +1.873195949324136e-02   -2.503659740473934e-01   -1.151634362115288e-02; -8.142364702687335e-01   -1.522498240333435e-01   +4.799574495665528e-02   -6.369379047230286e-01   +6.244999837990781e-02   -3.480595107673021e-01   +8.505253359325392e-01   -9.623064899426332e-01   +3.312259680604320e-01   +5.240706943924225e-01   -1.378139353561895e-01   +5.487928232130546e-01];
L2E_Input1_iAMPA_netcon = [-4.438532218627789e-01   +4.971710953705986e-01   +1.196219487934546e-01   +6.097436225174542e-01   +4.383820523716768e-01   +1.084907485850594e-01   -5.397348327505046e-02   +7.077792511202488e-01];
L2I_Input2_iAMPA_netcon = [+5.807081912783736e-01   -1.101481922035117e-01   +4.735926453533630e-01   +5.113238196860832e-01   -5.206578556461192e-01   +9.429437730630670e-01   +5.209767330269122e-03   -5.032015086276187e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
