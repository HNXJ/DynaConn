function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.477068355314018e-01   +3.569616849380468e-01   +1.480885707227307e-01   +2.108341130099821e-01   +6.727202252517657e-01   +3.768720645683057e-02   +3.035200317560436e-01   +2.991981934728651e-01   +1.046334797421039e-01   +4.216233119940400e-01   +6.619393191373192e-01   +6.299732068713604e-01   +2.268166821078602e-01   +4.628135082597005e-01   +5.863897047587380e-01   -1.413192216416105e-02; +2.151540310891369e-01   +2.404787267228788e-01   +1.741920790568063e-01   +5.183686594418582e-01   +2.024950769426855e-01   +4.583282970369371e-01   +2.466447793886050e-01   +1.656028136814439e-01   +2.505974674076916e-01   +2.326658204537331e-01   +2.222990556954283e-01   +4.998324903943580e-02   +5.677502699812026e-01   +2.357706579298414e-01   +2.819180745975735e-01   +4.231230892268261e-01; +4.287866984271997e-01   +3.303193513895836e-01   +3.272365160218663e-01   +1.483196273091652e-01   +2.576550016119302e-01   +1.583358482488584e-01   +5.018941344903419e-01   +2.280767274176783e-01   +1.364943849619314e-01   +6.580671400430365e-01   +7.911522823959972e-02   +6.232122643022755e-01   +6.926899567376993e-04   +5.110834330362246e-01   +2.576818264274901e-01   +5.623696911579820e-01; +6.092694934400916e-01   +5.687738071453163e-01   +6.661325972670376e-01   +6.044001947304998e-01   +5.037708405465771e-01   +3.621684565576895e-01   +3.020930225830319e-01   +5.793398843639556e-01   +1.483522040856047e-01   +4.362166109960184e-01   +1.534739391955214e-01   +3.223497373782493e-02   +3.633796745878641e-01   +8.052408211374695e-02   +5.005397822305575e-01   -4.195849557738784e-02; +2.978631956851271e-01   +4.844385711542188e-01   +5.944910607607413e-01   +3.873280209127533e-01   +4.245331540154321e-02   +1.873143375649753e-01   +6.088330849233886e-01   +3.756376301079744e-01   +1.749396022323648e-01   +1.115897362483159e-01   +1.500230303351586e-01   +2.946571332886228e-01   +5.265282456501252e-01   +3.727567623814548e-01   +5.008265868285825e-01   +6.585497834095457e-01; +3.072906346137099e-01   +2.982775341263239e-01   +3.306869235904437e-01   +6.110460974332020e-01   +1.822726715718135e-01   +4.916606372477929e-02   +3.416084704229242e-01   +4.098272360969478e-01   +5.179706887357082e-01   +3.800444159639058e-01   +6.272186466430318e-01   +5.227576777025292e-01   +2.175267812528177e-01   +3.117185167136211e-01   +3.153523278252275e-01   +2.352686374249058e-01; +7.111393502202237e-02   +1.924873823233026e-01   +4.186220802833129e-01   +5.388404665536900e-01   +2.052754670166633e-01   +1.378847061225192e-01   +3.874816330378519e-01   +8.819723386944483e-03   +5.831238223160673e-01   +2.451911088717812e-01   +5.547432113405040e-02   +3.072099760687547e-01   +2.768010418092870e-01   +3.027777766073849e-01   +5.215301547033698e-01   +4.268769599370707e-01; +5.109199266426063e-01   +4.249305642317965e-02   +1.442412048846408e-01   +1.266811647219590e-01   +1.454827073336095e-01   +6.981677936488838e-01   +2.241016196982148e-01   +2.870485884201355e-01   +4.063648156364266e-02   +1.436862609369343e-01   +2.499372077436482e-01   +3.465880561578494e-01   +2.750828281433125e-01   +4.834584324273196e-01   +1.583495920734955e-01   +1.642785643142171e-01; +4.197428567195870e-01   +1.533787476087646e-01   +1.049560131390044e-01   +3.805124980114206e-01   +4.740064683561912e-01   +1.946706885817965e-01   +3.101174880001618e-01   +4.748263039427487e-02   +3.220586557306955e-01   +4.972321350325395e-02   +4.545459165646862e-01   +8.079306044718532e-02   +1.812824319471114e-01   +3.863870256741419e-01   +5.088193080514061e-01   +3.325057761358595e-01; +4.009768892344056e-01   +2.894352965413962e-01   +3.713753103418906e-01   +2.987322648163240e-01   +5.612343944407453e-01   +6.587085431950408e-01   +1.540938140700125e-01   +4.159294538308343e-03   +2.515061028574719e-01   +5.346580773758065e-01   +4.117081659072210e-01   +1.441260796644271e-01   +5.647987963744111e-01   +4.062899660390350e-01   +4.805639793681970e-01   +7.553219874179445e-02; +2.006349879172445e-01   +8.224868191188563e-02   +5.342434191420085e-01   +1.269223896854565e-01   +2.080543208414735e-01   +6.677171034918271e-01   +5.016546620005595e-01   +1.249837874510621e-01   +2.733665161250575e-01   +1.777369951360361e-01   +6.444270934905316e-02   +3.951822858554894e-01   +2.151697555332363e-01   +1.249435385805142e-01   +4.344862202588350e-01   +2.832371433252224e-01; +1.296065728780798e-01   +2.625295867615503e-01   +3.097378043241550e-02   +4.087217041421617e-01   +2.948680296807024e-01   +5.955748352433365e-02   +6.732141440487577e-01   +5.779480139065540e-01   +2.880005628284143e-01   +3.544468677295202e-01   +3.025993934671680e-01   +4.528234681850381e-01   +4.641459133095531e-01   +4.421816752316408e-01   +6.309072382746100e-01   +5.490785237954328e-01; +5.453248173520042e-01   +6.362334747046715e-01   +7.865438632968089e-02   +1.043038417291670e-01   +5.022172223057617e-01   +3.607326436715054e-01   +5.717324514931984e-01   +1.601076165285425e-02   +5.992948953201910e-01   +5.713724544573032e-01   +4.590499697748268e-01   -2.843335197908798e-02   +3.276990380390710e-01   +3.182746008282111e-01   +3.101234780744761e-01   +1.427709541616776e-01; +5.673401837332477e-01   +1.879302990826080e-01   +4.439703013373933e-01   +5.566370712121725e-01   +5.191619113207673e-01   +1.397260056856866e-01   +2.723913429343041e-01   +2.127508110927233e-01   +3.980491187084543e-01   +4.544994508983350e-01   +4.866962067201811e-01   +6.388765506423212e-01   +3.346225486553651e-01   +4.372132089829948e-01   +6.509465685516498e-01   +3.501959590266112e-01; +5.378099505101944e-01   +1.618268505177703e-01   +5.794918879623067e-01   +5.433182573675146e-01   +3.201483965209042e-01   +3.587291878162586e-02   +5.649565811601716e-01   +3.067062791433628e-01   +3.898167905791765e-01   +4.790475904876949e-01   +5.636363710042608e-02   +7.027084362554835e-02   +6.278078206014935e-01   +1.522167442540648e-02   +2.862621721034241e-01   +6.705262841608296e-01; +6.343963720799546e-01   +2.881177139577701e-01   +4.593643839541950e-01   +1.905177362236691e-01   +5.159250182479532e-01   +3.971214471573108e-01   +4.300451837284467e-01   +3.564188106400390e-01   +3.070140659345699e-01   +2.669474403057405e-01   +1.613472431609102e-01   +1.546059145616835e-01   +1.616677389829238e-01   +6.870312622812702e-02   +3.708997140257307e-01   +4.271970459525557e-01];
L1E_L1I_iGABA_netcon = [+4.002085470036620e-02   +5.797421803624981e-01   +6.625982920597392e-01   +4.811626563363305e-01   +4.184276430508850e-01   +4.534638268813115e-01   +6.901695253890194e-01   +7.471456626936639e-02   +5.856990430515335e-01   -1.076212832039859e-03   +5.387385889055180e-01   +2.267788681602695e-01   +1.816222698694179e-01   +6.777580781190519e-01   +2.292135471591818e-01   +4.193921544786484e-01; +4.637187698325334e-01   +4.049039456674588e-01   +4.207805969117321e-01   +2.133496782535200e-01   +3.736774748850256e-02   +5.006756803787904e-01   +4.366396172249002e-01   +4.988805028210413e-01   +9.650740249189126e-02   +1.547491770991127e-02   +6.556371261466506e-01   +1.781572449322471e-01   +3.654663348606287e-01   +3.591451416095140e-01   +6.022898349125917e-02   +2.868008025241888e-01; +4.128411087418326e-02   +4.184207275115396e-01   +2.876905943228190e-01   +2.168881229756977e-01   +1.498204467675067e-01   +8.205311936127289e-02   +2.558835115161637e-01   +3.812898735469636e-01   +1.842764200642604e-01   +1.152932885363249e-01   +4.606454997097784e-01   +4.113499580324622e-01   +4.019367184390620e-01   +2.620996332901137e-02   +2.938508192281604e-01   +3.347730954241527e-01; +2.624909464632416e-01   +4.745768129653199e-01   +4.749726044654903e-01   +4.000081134871891e-01   +3.608171940075101e-01   +6.441363789497083e-01   +5.350838128308780e-01   -8.886931112489643e-04   +4.811375635665194e-01   +6.312693914670975e-01   +3.884653978187255e-01   +5.235264306051969e-01   +1.661570201738703e-01   +4.179021790557207e-01   +8.769902500607052e-02   +1.011870122232356e-01; +3.106056658678619e-01   +6.392047930430992e-01   +6.031231623284876e-01   +6.523645128740347e-01   +1.650936916848833e-01   +1.457248998602190e-01   +4.439924645433546e-01   +3.437376029565197e-01   +5.048677119772438e-01   +4.936126673159269e-01   +5.878622597210864e-01   +4.639734268679331e-01   +1.565605247333972e-01   +7.276987383256947e-02   +2.846095332199962e-01   +6.573706185079933e-01; +4.407203995453498e-01   +4.580429392020942e-01   +4.874203340568724e-01   +5.155844170373857e-01   +3.749133503865978e-01   +1.464810182248810e-01   +4.380647743223248e-02   +2.323586674727190e-01   +5.846901604215107e-01   +3.248763695433649e-01   +5.416210152400377e-01   +1.005872983728525e-02   +2.567176264790111e-01   +1.546289363630177e-02   +1.716541338939990e-01   +3.590337346336476e-01; +1.838002552115455e-01   +4.695472835083618e-01   +5.290943880217772e-01   +2.393385831197078e-01   +3.907828186686149e-01   +1.383994705267085e-01   +5.635578893848204e-01   +4.800126132588844e-01   +6.972624137933353e-03   +4.715364610419782e-01   +8.982732328709067e-02   +4.616564140885959e-01   +4.496989944390390e-01   +4.794752476622772e-01   +1.893684804568821e-01   +2.989244672766510e-02; +8.214642503424274e-02   +3.291904300034624e-01   +1.921070109943214e-01   +1.113614708865496e-01   +3.910297849689573e-01   +3.909338384083060e-02   +1.387795718964456e-01   +2.918981748333202e-01   +5.079780889787899e-01   +2.540119869159435e-01   +2.398699438682441e-01   +2.138397282192820e-01   +2.745928589091790e-01   +1.069031707130738e-01   -2.824514793046545e-04   +6.171728763614113e-01; +2.941899356795021e-01   +4.676205793064941e-01   +5.983389120416844e-01   +4.043606661303137e-01   +2.850888556281200e-01   +8.116417429766067e-03   +7.045515489301010e-02   +4.764008532136865e-02   +4.438622517040257e-01   -1.105734459221828e-02   +2.313057276772692e-01   +5.556721371189887e-01   +3.734385011077447e-01   +3.098530870412170e-01   +5.655683409930107e-01   +6.748015244446883e-01; +2.664330763415396e-01   +5.413342718217294e-01   +1.955092888863172e-01   +1.133585053400394e-01   +4.627127191465157e-02   +3.432312389602944e-01   +1.809438212501430e-01   +1.085806144339431e-01   +5.056540578249240e-01   +1.404991892953610e-01   +2.857049570548171e-01   +2.869902433105970e-01   +5.184175786175071e-01   +5.529033695414919e-01   +5.115491136430681e-01   +2.499540445950618e-01; +4.081140627632902e-01   +3.296878156364582e-01   +3.325427386616102e-01   +2.090239900688104e-01   +4.165988132832607e-01   +5.588545386207082e-01   +5.187434526926127e-01   +5.523827667684859e-01   +3.815587809079361e-01   +3.393229240322966e-01   +8.320015019568770e-02   +5.486115077295951e-01   +1.452177673631052e-01   +2.091801281797043e-01   +3.103250095123483e-01   +3.089825787522074e-01; +5.007471295603503e-01   +9.446273278550532e-02   +1.308622321774566e-01   +3.368390399297947e-01   +5.137400560777519e-01   -7.499485422057941e-03   +4.440034447407106e-01   +3.565397283762372e-01   +6.733329430864646e-02   +3.276544273764991e-01   +3.182377496978271e-01   +2.668252636852482e-01   +1.382111158794011e-01   +4.570723770217795e-01   +5.600407589979411e-01   +4.960150234329208e-01; +2.469072508665599e-01   +3.328903074748090e-01   +3.183312654062870e-01   +5.279369104718903e-01   +3.030704855093586e-01   +2.002868968563634e-01   +4.812547647218838e-01   +4.525166023580602e-01   +4.754886025916625e-01   +6.343004784839146e-01   +9.961262387207913e-02   +1.890974079446723e-01   +2.204507040773882e-01   +3.718861970557159e-01   +3.335601482633642e-01   +4.550573507983207e-01; +1.768351834745792e-01   +2.746700499681126e-01   +4.101450224433370e-01   +3.624661455732854e-01   +4.784141241763327e-01   +1.248115818727348e-01   +3.217466357704788e-01   +2.381372747803373e-01   +2.182051316704674e-01   +2.955227595381157e-01   +3.014422287572883e-01   +2.611830488979283e-01   +5.781260915097151e-01   +6.303495894077573e-01   +2.117003332673558e-01   +9.938295666829673e-03; +2.120446451080482e-01   +1.539922921028150e-01   +2.697339858452328e-01   +3.691446167698960e-01   +2.831290246273774e-01   +3.236651094377785e-01   +2.076218199630030e-01   +2.159446066344107e-01   +4.498214991257707e-01   +4.472265157234360e-01   +2.818649892305614e-01   +2.127155692445350e-01   +1.029491371026577e-01   +2.717816048217188e-01   +5.131184615835815e-01   +4.903811613535570e-01; +2.061283878294956e-01   +3.208457108124198e-01   +3.131789404604255e-01   +1.357755606516166e-01   +3.495251276907452e-01   +5.916973582441576e-01   +8.617010476761630e-02   +5.227124562986613e-01   +1.253434360813831e-01   +5.317873119856746e-01   +3.058975278658062e-01   +4.342132018829804e-01   +3.070720557780918e-01   +6.403979921875926e-01   +1.302536501401888e-01   +5.198473399576996e-01];
L2I_L1I_iGABA_netcon = [+4.958305228094887e-01   +5.903747693702547e-01   +4.743090278234364e-01   +2.695188545281306e-01   +1.241124906730105e-01   +4.137903546482141e-01   +2.648335391498910e-01   +6.417137122286384e-01; +3.490356232984974e-02   +3.184437971499419e-01   +1.283718291901200e-01   +5.258702626573510e-01   +3.603543968361996e-01   +5.072697870800271e-01   +4.368620554543649e-01   +2.726479752611149e-02; +1.591783614764612e-01   +2.234403696555519e-01   +4.747727317671785e-01   +3.378449877440693e-01   +4.895844683339355e-01   -1.956425480576185e-02   +4.096164473763639e-01   +5.719673299811803e-01; +1.608960445762488e-01   +5.962146816618784e-01   +2.865067420607592e-01   +3.723928048102092e-01   +1.711652918838515e-01   +4.725624441571529e-01   +2.911908152843409e-01   +5.698043283592650e-01; +5.826869655590112e-01   +2.667749512894310e-01   +2.752460465770610e-01   +2.127977737938277e-01   +5.861337491321195e-01   +6.107234366147630e-01   +2.980306412450334e-01   +3.659002133046499e-01; +4.415390580599018e-01   +4.050112671701299e-01   +6.254198356704807e-01   +3.468755985805801e-01   +5.174427172771291e-01   +3.060532443713019e-01   +2.477019128798298e-01   +4.634493116918511e-01; +6.393492087860085e-01   +2.875327666254799e-02   +6.266361316445472e-03   +5.739791379892126e-01   +1.108355667846611e-01   +1.977866579260918e-01   +2.607585224200507e-01   +2.186504390398445e-01; +4.230402440204845e-01   +2.245897239050539e-01   +2.057502385802550e-01   +6.179745025159730e-01   +1.624320016286820e-01   +4.127251814245029e-01   +2.345730277384570e-01   +1.670311403329642e-01; +4.297736541488010e-01   +3.315431395619909e-01   +1.014366481526059e-01   +2.435974268697619e-01   +3.040775610904027e-01   +4.492795953154956e-01   +5.432871856966268e-01   +2.070475913395275e-01; +3.696434272053566e-01   +4.645914379527025e-01   +3.290802997466278e-01   +5.904719407674983e-01   +5.288873172823430e-01   +1.158850324301030e-01   +1.964782570809608e-01   +7.290182144165609e-02; +5.459797166574357e-01   +3.518766640391788e-04   +3.265030199214158e-01   +2.864893433965181e-01   +4.390064630573436e-01   +8.713659397738478e-02   +4.648744223545753e-01   -1.364224647308396e-02; +3.376434659601492e-01   +6.501473195336381e-01   +2.734300694119945e-01   +4.376396838315192e-01   +5.799221837622008e-01   +2.220587190283332e-01   +2.950346475303858e-01   +2.707859431332622e-01; +2.611758433549894e-01   +1.859381951567315e-02   +1.018058562344672e-01   +6.024859242774704e-01   +1.893795262071504e-01   +6.383269339445307e-01   +3.319839639245727e-01   +3.962303961827112e-01; +6.100348912875542e-02   +5.542141782826636e-01   +6.495417579206146e-02   +1.126514541892352e-01   +1.977227849643459e-01   +2.450888149566899e-01   +6.023637123588972e-01   +1.379487082016141e-01; +7.508330771111141e-03   +9.305506086683360e-03   +3.551680480183951e-01   +3.139331483943475e-01   +2.959373085039315e-01   +4.617021748238392e-01   +5.123132042072190e-01   +2.043546284208371e-01; +1.699311968629501e-01   +5.537112592067741e-01   +1.437664912228496e-01   +5.787337600556267e-01   +2.008207716036005e-01   +3.968456919380945e-01   +2.094142366077962e-01   +1.998855691699981e-01];
L1I_L2I_iGABA_netcon = [+7.015271681729911e-02   +2.614326188179160e-01   +1.064194066085684e-01   +2.705628076489146e-02   +6.478357042286913e-01   +3.527539463379565e-01   +7.173888030793199e-02   +3.917411094213936e-01   +2.525021683759834e-01   +1.065449644571700e-01   +2.301673866527303e-01   +5.144207517537263e-01   +1.640693495226283e-01   +6.261679205597674e-01   +1.269686240590954e-01   +2.298079576458962e-01; +5.296460969841927e-01   +6.444238096459415e-02   +2.915956882491875e-01   +4.854931719899350e-01   +9.906569396061542e-02   +3.712057311097434e-01   +4.333347045071756e-01   +3.457905434814828e-01   +5.930501702398918e-01   +6.042531560116849e-01   +1.454011279066798e-01   +1.513994389263426e-01   +3.413900804027412e-01   +3.320093548838649e-01   +1.803161029456442e-01   +3.030175337687285e-01; +3.454850034480816e-01   +3.480039463243437e-01   +3.455252964276065e-01   -6.622373419068385e-03   +3.752038487262773e-01   +7.803122936806992e-02   +1.592970847521318e-01   +2.010845217847529e-01   +3.463282079116470e-01   +6.233918360385612e-01   +5.704272582555663e-01   +3.130166249271627e-01   +4.263238122067138e-01   +2.474330684947725e-01   +8.364422170192390e-02   +2.695642400365934e-01; +4.058953955357766e-01   +3.172621897938737e-01   +5.185185363807291e-01   +1.695360104236784e-02   +3.301529516185200e-01   +1.506956594165208e-02   +2.639254460360199e-01   +4.261358143508543e-01   +4.237852827682171e-01   +5.580622210781320e-01   +6.013194263396108e-01   +2.743995080656036e-01   +5.083439858306238e-01   +1.126007726968005e-01   +5.503445096337777e-03   +5.482707381136210e-01; +3.114324699068872e-01   +4.980827750409970e-01   +4.376893018752797e-01   +1.762672546409380e-01   +3.774353864732746e-01   +6.166556710357061e-01   +2.560437925853122e-01   +2.095480094850731e-01   +3.123646166584132e-01   +4.960878136933815e-01   +4.613084653550955e-01   +4.503287268767483e-01   +4.453258047172118e-01   +1.469098347617349e-01   +4.486001818338783e-01   +6.660206087103678e-01; +2.167396429663387e-01   +2.783232457478924e-01   +3.830540838169708e-01   +4.838171378454821e-01   +6.497331491683961e-01   +4.472936606739316e-02   -5.144290244923747e-03   +4.862348642367493e-01   +5.131108968858291e-01   +5.365082994170046e-01   +4.499577604631644e-01   +2.630044628821443e-01   +3.567440784217634e-01   +4.149370749826740e-01   +5.394133140662165e-01   +5.292480949364411e-01; +5.480292790849537e-01   +2.703284821712236e-01   +5.914924386233102e-01   +6.143664183803256e-01   -5.361665342582929e-02   +5.368141378424405e-01   +4.124264928223136e-01   +3.451378704938233e-02   +1.000545342242061e-01   +5.362569914433607e-01   +5.999665171564809e-01   +6.278454431413777e-01   +3.462279300497871e-01   -3.663475881087456e-03   +4.001300846468300e-01   +1.847045615285036e-01; +1.809063371560634e-01   +1.147441971333628e-01   +3.866461491976908e-01   +3.634519678355896e-01   +7.060664091781593e-02   +6.051435934394281e-01   +4.546201420565371e-01   +1.688028992201921e-01   +5.694779797640184e-01   +4.071543155587881e-01   +5.005852991804232e-01   +4.328682035772398e-01   +4.738652087192176e-01   +3.512904546246171e-01   +3.137616605603111e-01   +5.922891622404693e-02];
L2E_L1E_iAMPA_netcon = [+3.318011894267238e-01   +3.674187921878618e-01   +5.647657088657280e-01   +2.002065036614895e-01   -1.457166898756925e-02   +3.926051821304266e-01   +6.730756475456316e-02   +3.181327303686966e-01; +2.285480744244792e-01   +8.902684650476227e-02   +3.671362251422823e-01   +3.459478304426941e-01   +2.245312360059720e-01   +8.639854025768512e-02   +5.604507867347202e-01   +6.472058362060265e-02; +3.589463108602355e-01   +1.321440104151291e-01   +3.281496161870749e-01   +5.829219327303087e-01   +4.568169244775176e-01   +5.813789982780612e-01   +5.322824062088887e-01   +2.495568080555755e-02; +4.721950534092295e-01   +2.052171970730945e-01   +3.750756704015228e-02   +1.254669171759930e-01   +2.478236156272352e-02   +5.953036537529218e-01   +2.978784361579930e-01   +4.985499383004173e-02; +3.051837515999810e-01   +4.777030381416228e-01   +5.448046860798558e-01   +4.774094875668021e-01   +2.962431840930768e-01   +3.939314719517704e-01   +2.152870099964565e-02   -3.288057326705648e-02; +5.876827344426994e-01   +6.860388565362066e-01   -1.174861027790364e-02   +5.886902154329057e-01   +5.418709890562473e-03   +4.902935600750972e-01   +3.145035739837619e-01   +4.989200873807241e-01; +9.810277102263278e-02   +5.214133088460159e-01   +2.681367945898112e-01   +2.818801457880926e-02   -1.144265078332477e-02   +5.879720520593178e-01   +3.806342208212150e-01   +5.607211875633668e-01; +3.107621789634406e-01   +6.553655233759500e-01   +2.927754163405051e-01   +4.977711958707685e-01   +4.534904798121382e-01   +3.578787554361623e-01   +5.674151928328423e-01   +3.319837636516870e-01; +2.339978799659668e-01   +1.129671412205160e-01   +3.070281923358124e-01   +2.099977288483270e-01   +6.234456770955070e-01   +5.307941013032461e-01   +1.385556053453637e-01   +3.965251506550183e-01; +2.274175510501825e-01   +5.712029027581974e-01   +5.615003601267725e-01   +5.727509003674059e-01   +6.572276403619621e-01   +1.898189888554578e-01   +3.322709420677954e-01   +1.834898872269106e-01; +4.757860935051789e-01   +4.192247216669646e-01   +2.990199221490663e-02   +6.396692335218612e-02   +2.818711067621036e-01   +4.954561521641468e-01   +4.354136247428669e-01   +7.801279218486150e-02; +6.177140023790346e-01   +2.447252938874679e-01   +1.512448551791486e-01   +4.058145967278820e-01   +5.710177251019877e-01   +6.788611614337775e-01   +4.246515293507793e-01   +5.665339350824390e-01; +2.905279115535931e-01   +5.611956183890888e-01   +5.589480504589079e-01   +2.614238697170351e-01   +6.149535509215244e-01   +4.031344150752236e-02   +4.373326222621141e-01   +5.798121658942537e-01; +3.379955538654745e-01   +2.452761504647551e-01   +4.488727299139377e-01   +2.623900246228044e-01   +1.042171926927193e-01   +5.467789946219742e-01   +6.346784058507710e-01   +2.083944738527325e-01; +4.260405474874269e-01   +5.250049493620853e-01   +7.795918794323163e-02   +1.604054988309666e-01   +2.774309022330188e-01   +6.274063838571634e-01   +3.954176398876976e-01   +1.535255750650835e-01; +4.321273939241508e-01   +4.204222823181474e-01   +3.657651623296144e-01   +6.554943983922792e-02   +3.599364853214207e-01   +1.678593584283286e-01   +4.743589053234808e-01   +8.090607694183323e-02];
L1E_L2E_iAMPA_netcon = [+1.852588521878535e-01   +3.335768358254622e-01   +6.858714431466861e-01   +3.716471419092123e-01   +4.293903606694529e-01   +8.105838881195596e-02   +3.695842634423483e-01   +5.397958107012089e-01   +4.055155620014455e-01   +3.342898549637264e-01   +4.832897042742806e-01   +1.953911862599659e-02   +2.949607257333556e-01   +2.809730568860364e-01   +4.680012932545933e-01   +6.206412792983383e-01; +4.829814213750241e-01   +5.883255942898330e-01   +4.909827779412226e-01   +1.953796866091178e-01   +3.505244573059463e-01   +4.190371571046997e-01   +5.123710276142798e-01   +1.262198055216035e-01   +1.273262180450676e-01   +3.357146394616287e-02   +1.185248384212932e-01   +2.359472602224753e-01   +8.234174646906658e-02   +1.718929091702505e-01   +8.116062901715443e-02   +2.338191066105384e-01; +2.637909888049910e-01   +5.860110898827768e-01   +6.448126011592007e-01   +6.185639627425303e-01   +2.510230866521480e-01   +5.603193278092272e-01   +1.237142335081030e-02   +5.536326154568322e-01   +3.826169077339260e-01   +2.594799638184870e-01   +1.077874072313380e-01   +5.747713569730940e-01   +7.902534869964196e-02   +1.246391430242966e-04   +2.697647310678711e-01   +3.744792906767522e-01; +2.961110947283092e-01   +2.752044970728612e-01   +3.663793227918838e-01   +6.662888934226540e-01   +3.415208247098816e-02   +1.457729832599648e-02   +3.946768936571090e-02   +4.321805373417605e-01   +6.086422452782287e-01   +4.773705458251359e-01   +3.962441988104328e-01   -1.980932917222661e-02   +3.854325001804521e-01   +1.176861858140029e-01   +1.528665101494888e-01   +3.762707837562691e-01; +5.743916597422104e-01   +2.035687933415190e-01   +6.742347190007594e-02   +3.904982201241756e-02   +6.622592043760261e-01   +5.637808967076724e-01   +6.062867811759581e-01   +2.744635920596912e-01   +1.781432169325274e-01   +2.518358383107858e-01   +4.555459072664501e-01   +5.832129420904615e-02   +4.481767798199323e-01   +4.643982145821524e-01   +2.429808857114504e-01   +1.456333189287909e-01; +4.835758582348894e-02   +3.968256273989656e-01   +5.117518944153304e-02   +1.658152217796451e-03   +4.711933392515574e-01   +3.431329530904197e-01   +3.926509521245698e-01   +5.731541942043490e-01   +5.623513657519521e-01   +4.828588980018423e-01   +1.170186949827069e-01   +4.868453195501855e-01   +5.093286068993297e-01   +3.252696717407091e-01   +1.114790207105989e-01   +2.243143896162508e-01; +1.876950956971051e-01   +2.745411286511170e-01   +1.790931740800682e-01   +1.667716395893365e-01   +2.201121979353261e-01   +8.472092222365127e-03   -1.258315559925570e-02   +5.246722864295600e-02   +2.839625106601739e-01   +3.542576761523187e-01   +8.812293388822048e-02   +1.687376840835351e-01   +6.608214624532037e-01   +3.766237513871901e-01   +5.904168076733981e-01   +3.004875712868609e-01; +1.512300154355228e-01   +2.778292158702404e-01   +6.300062914401824e-01   +5.187288695101416e-01   +6.234476174792019e-01   +3.647013010962923e-01   +6.333017178170420e-01   +1.565458752643851e-01   +2.769561615875581e-01   +6.034816857674989e-01   +5.848080215448073e-01   +1.381994134036726e-01   +2.982348984589655e-01   +1.902947080112000e-01   +5.508806268092500e-01   +3.104153282648888e-01];
L2I_L2E_iAMPA_netcon = [+3.992178222289907e-01   +1.438003527330952e-01   +1.340709507803413e-02   +3.103563238721406e-01   +5.428577981019795e-01   +4.212182593107026e-01   +5.414552214827473e-02   +3.822298013428981e-01; +1.232226040399831e-01   +1.843416104929805e-01   +6.045966383745430e-01   +2.360745413126422e-02   +4.121153794246833e-01   +1.758836262109439e-01   +1.264990228719653e-01   +4.277900220505084e-01; -4.893705283366417e-03   +5.785458009313271e-01   +1.747825418716371e-01   +2.761016390564011e-01   +5.949100163639037e-01   +6.754363385537397e-01   +4.887696074359458e-01   +1.863773870380194e-01; +4.948596107682633e-01   +5.919873374355042e-01   +6.406477486366079e-01   +5.157060138952628e-01   +5.877154384810372e-01   +4.113885098763139e-01   +2.604130609911874e-03   +3.325111078771740e-01; +5.168071561944880e-01   +6.020535368037415e-01   +1.751421534460021e-01   +4.592582898854579e-02   +2.449512064353040e-01   +6.246114209806580e-01   +1.885532559303729e-01   +6.186071075333877e-01; +3.878806628990786e-01   +2.278943798754260e-01   +5.071990095401795e-01   +4.073453338729939e-01   +1.337059524707552e-01   +2.174890108143876e-01   +1.060287428122950e-01   +4.968778913601136e-01; +1.217353151135340e-01   +2.479571471327081e-01   +5.403468603681253e-01   +7.331277425684300e-02   -2.300428321492463e-02   +1.921460248698579e-01   +3.039340920802806e-01   +6.383301067743350e-01; +3.497836178353249e-02   +2.982935861383418e-01   +3.236331671708270e-01   +6.689080953219960e-01   +4.988061276203045e-01   +4.192516953171345e-01   +6.695791301338230e-01   +2.186584870487597e-01];
L2E_L2I_iGABA_netcon = [+5.525990197835732e-01   +3.137776203342873e-01   +3.094982605653433e-01   +2.058973467961109e-01   +6.279751034643800e-02   +6.442211363661009e-01   +5.657120672430614e-01   +4.162380729472397e-01; +6.560700074689731e-01   +2.289985949858495e-01   +1.499847263050127e-01   +6.272109803573082e-01   +5.686399053643078e-01   +4.120472668515746e-02   +1.613457434639878e-02   +4.238823008911537e-01; +2.318987962386152e-01   +4.173459399516038e-01   +4.830177332482677e-01   +2.153318573652730e-01   +1.670389899539976e-01   +5.691807147107328e-01   -6.657822066282078e-03   +2.876599384980860e-01; +6.741304891993276e-01   +9.695870840108912e-02   +2.230368654265886e-01   +2.981061228248731e-02   +6.158517165516179e-01   +6.251123065695083e-01   +5.766578208055367e-01   +3.545686239116735e-01; +3.695686837743842e-01   +3.454333647108965e-01   +6.888388868550752e-01   +2.017874750282797e-01   +4.327541983005220e-02   +8.815247497425359e-02   +5.651469864890850e-01   +2.683439812755418e-01; +4.638027400360173e-01   +2.204541966527033e-01   +2.007160700589249e-01   +3.435068845919954e-01   +1.709414598237701e-01   +4.023195999058696e-01   +3.399685263652713e-01   +6.537361901035209e-02; +5.813511651918639e-01   +4.030168164898313e-01   +4.855192960546207e-01   +1.076946548882470e-01   +1.576776764600253e-01   +6.024445956973282e-02   +4.720196537520027e-01   +2.009590680462034e-02; +1.377299278205328e-01   +2.186742464334951e-01   +3.419016294867585e-01   +3.261976491882380e-01   +6.190548936776472e-01   +3.920746648402514e-01   +2.458177183951749e-01   +1.229124657293370e-01];
L3E_L2E_iAMPA_netcon = [+3.525011327279747e-01   +4.238661246580274e-01   +1.850008265467579e-01   -5.030212881377966e-03   +3.500925596638613e-01   +7.386243193933126e-02   +6.443920483732030e-01   +3.825117920510462e-01   +4.600892391688747e-01   +4.131647247845492e-01   +1.353806985487028e-01   +3.463237990965825e-01; +2.263092649162771e-01   +3.928849763960740e-01   +4.765024474823303e-01   +6.315968156247154e-02   +4.809352276057601e-01   +5.651954174631150e-01   +4.625382493754880e-01   +2.128575823006034e-01   +5.433289257017385e-01   +1.805719523008938e-01   +4.831004606838892e-01   +5.409586731996976e-01; +4.284105982784852e-01   +3.187609092296045e-01   +5.893262947777055e-01   +5.750903407381712e-01   +2.364017936197646e-02   +1.698548564927597e-01   +3.721678054282304e-01   +7.724098537900660e-03   +3.985938711903342e-01   +4.799968247457870e-01   +3.269312484408825e-01   -3.673392887156413e-02; +4.617551283355891e-01   +3.298640509883322e-01   +4.015677580912073e-02   +7.337720536536180e-02   +5.093502553044084e-01   +2.605046738642879e-01   +1.392356419012306e-02   +3.499117798870417e-01   +1.975637618588326e-01   +2.405270770566858e-01   +4.023989304447355e-01   +1.136889414313614e-01; +4.726663376875792e-01   +6.892389677287818e-01   +5.614297782183001e-01   +6.264264145257170e-01   +5.488476487804279e-01   +5.622276344977268e-01   +4.196496891374315e-01   +1.068444674649552e-01   +7.240493287414977e-02   +1.102703463436085e-01   +5.041611410688946e-01   +4.160086723759410e-01; +1.721254935108223e-01   +1.433858746526096e-01   +8.560731616768197e-02   +2.330375181926720e-01   +5.116466385584939e-01   +4.309391289643701e-01   +6.356405443479994e-01   +5.808085171841909e-01   +6.211682318080785e-01   +2.264410645440460e-01   +6.343195668273947e-01   +4.556348271502966e-02; +4.690729816201170e-01   +1.010961543425346e-01   +6.775893045809407e-02   +7.244626307326790e-02   +4.968857947567411e-02   +3.362232595226807e-01   +5.086885966148521e-01   +2.409798854937126e-01   +2.254397851906693e-01   +1.976671251965604e-01   +5.759070074553315e-01   +6.279289340200223e-01; +5.939925203315406e-01   +5.572167164204254e-01   +3.851514060873678e-01   +5.749351582243166e-01   +5.263509449868383e-01   +2.191745216561655e-01   +1.131632233255013e-02   +2.306443570072106e-01   +8.689935327674131e-02   +6.028375529752152e-02   +3.050712217016694e-01   +1.287744112663443e-01];
L3I_L2I_iGABA_netcon = [+4.006987744516138e-01   +6.451060922227767e-01   +1.143691549998246e-01   +3.489427228551489e-01   +3.494077028874690e-01   +4.766660968678801e-01   +4.756880228178085e-01   +8.978145166881513e-02   +3.341986307984875e-02   +1.443252693080610e-01   +5.639239906259480e-01   +1.563156928636904e-01; +3.838017486161147e-01   +4.701709606948882e-01   +3.683270847361563e-01   +4.538058006928303e-01   +5.270098591594899e-01   +2.468564949892155e-01   +5.763450225370923e-01   +6.914624848346296e-02   +2.354283741770137e-01   +2.421248757041322e-01   +4.114690062325141e-01   +3.517764553949101e-02; +3.185859507252325e-01   +5.131719460127229e-01   +3.702650961089535e-01   +2.872727760141152e-01   +3.582954946101183e-01   +2.986098021189393e-01   +3.341685613163164e-01   +4.314525233949234e-01   +4.393875993565717e-01   +6.113880139913797e-02   +4.245088364758047e-01   +4.763747309123987e-01; +4.614155239134897e-01   +5.869366118241475e-01   +6.325834501206784e-01   +1.298092493582466e-01   +4.012393277244580e-01   +6.780487758449228e-01   +4.377074162390804e-02   +1.200593879348060e-01   +4.015244414919650e-01   +5.319952326715506e-01   +1.272113515769883e-01   +5.109505419045742e-01; +2.940430865648172e-01   +5.387250275663767e-01   +5.296892453666778e-01   +4.967111028069517e-01   +5.924997690771737e-01   +1.962895158639904e-01   +2.735963877706662e-01   +4.934792623420718e-01   +3.526587164451591e-01   +6.698170339191278e-02   +2.409518696199499e-01   +2.388292959312722e-01; +3.988828901273582e-01   +1.182649813686454e-01   +4.102883967428490e-01   +2.424799054000076e-01   +5.180196685618995e-01   +3.784158240178526e-01   +2.845182895911239e-01   +3.629759078125226e-01   +1.842512229739899e-01   +2.021316956774576e-01   +3.725514339072201e-01   +4.587076676191757e-01; +2.926947831298093e-01   +7.519958722903282e-02   +5.644361999732701e-01   +4.203987677618808e-01   +1.903313949007830e-01   +6.200973682739950e-01   +2.355028307576291e-01   +1.490177316779139e-01   +1.605044139672285e-02   +5.594381666945776e-01   +5.923582745516726e-01   +9.682571501814026e-02; +2.887153223760384e-01   +1.555908483431594e-01   +5.911992724943876e-01   +1.116133021059718e-01   +5.149853074529771e-01   +5.681654623188984e-01   +4.994603852025862e-01   +3.550756657179864e-01   +3.011082581915174e-01   +5.210793855812420e-01   +1.453950949114359e-01   +5.304965444010534e-01];
L2E_L3E_iAMPA_netcon = [+3.864897669407078e-01   +1.617240054313673e-01   +5.564391306599397e-01   +4.413619521284582e-01   +3.474777321255158e-01   +3.101482819681963e-01   +3.517660946718448e-01   +2.190546485914448e-01; +3.413064275956668e-01   +3.401012642576003e-01   +4.590225717827431e-01   +2.493469572384160e-01   +6.212127191892398e-01   +2.443109445979007e-01   +3.741006550389060e-01   +6.314040853892472e-01; +1.679396749914495e-01   +1.521686956430035e-01   +4.586036120407651e-01   +4.766898279434294e-01   +4.123123517300239e-01   +5.266286054821853e-01   +3.815598411355072e-01   +9.735998509676853e-02; +1.218382138915347e-01   +1.450531555129587e-01   +2.655515156900297e-01   +6.181096955405589e-01   +2.722465448940495e-01   +5.040649800702641e-01   +4.132221910284727e-01   +1.934819457879486e-01; +1.407101397026944e-01   +4.395730529071290e-01   +6.413582784572179e-01   +3.813768169084207e-02   +4.975549916278011e-01   +5.056240282621912e-01   +4.829966268765548e-01   +5.227384212380481e-02; +1.138110157134895e-01   +6.069980017518753e-01   +4.825918859768404e-01   -2.015599422162515e-03   +6.214323675984237e-01   +2.658871579340173e-01   +1.981880868054410e-01   +5.106314830832470e-01; +1.629610555002562e-01   +1.656159993244073e-01   +3.570926359621394e-01   +4.544781581456678e-02   +1.984447132768223e-01   +4.597101756244720e-01   +3.912092087357575e-01   +3.493501333083757e-01; +3.869520240788566e-01   +6.587980593897080e-02   +4.048952131349998e-02   +5.191518583846561e-03   +5.253450335432301e-01   +3.514980792844695e-01   +1.221196691597140e-01   +6.368513659135694e-01; +6.314107503584347e-01   +4.699045806366611e-01   +2.449852422756530e-01   +5.201706399323544e-01   +4.829144867987087e-02   +2.339030310562679e-01   +4.273667452313687e-01   +2.567818873981334e-01; +4.960940887672383e-02   +1.674842294611522e-01   +5.418084546012807e-01   +7.103650625264793e-02   +1.934154546941933e-01   +1.447135659545769e-01   +5.912953933877393e-01   +6.315136546068076e-01; +4.800060234479500e-01   +4.882092559087082e-01   +3.386040433450682e-01   +4.279622977510745e-01   +2.896773380699064e-01   -1.272202997284843e-02   +3.098024073435984e-02   +5.570059045055764e-01; +5.283027607388103e-01   +1.768842656135658e-02   +5.974392181730418e-01   +5.538352789991874e-01   +3.837802204543373e-01   +6.872503820086176e-02   +1.927101395622672e-01   +2.562362379379908e-02];
L2I_L3I_iGABA_netcon = [+1.895323702158137e-01   +3.119306335459279e-01   +2.151463910984336e-01   +3.865937747028009e-01   +2.582689116749997e-01   +3.245118746314034e-01   +3.321502790858599e-01   +3.584867498027261e-01; +2.340223480064036e-01   +5.567070538889584e-01   +1.608024258177011e-01   +5.795248084791081e-01   -5.398334404795912e-02   +3.934355202295495e-01   +2.730665940300344e-01   +2.878510774400077e-01; +1.726641136867053e-01   +4.286315309688660e-01   +5.466145279266397e-01   +4.150345654436297e-01   +2.571325378420597e-01   +3.185343715499410e-01   +4.333569956780766e-01   +6.325327935960048e-01; +4.653167710192235e-01   +3.701837627785920e-02   +5.807220072500894e-01   +1.951100763273878e-01   +3.763949441294948e-01   +3.978179695262270e-01   +5.913743366343495e-01   +9.535742438121396e-02; +3.190215006831811e-01   +6.746297562119584e-01   +4.589663049872829e-01   +3.613622960721590e-01   +2.486066759448650e-01   +5.221032803409507e-01   +5.688945344474857e-01   +2.741110533579676e-02; +5.194087824398628e-01   +3.845502470345732e-01   +1.366267131994638e-01   +5.949704752095205e-01   +2.326584276267465e-01   +1.919741797612209e-01   +2.488343277534745e-01   +5.782783067576428e-01; +1.802825868462833e-01   +5.305514038937619e-01   +1.645628169426190e-01   +5.513334562976905e-01   +2.111942297345363e-01   +3.782743838162143e-02   +3.228962047885235e-01   +4.005179779708921e-01; +3.772595674537302e-02   +1.357234311039852e-01   +3.627028982440845e-01   +5.136388012455018e-02   +4.340363872053360e-01   +4.078586522254091e-01   +7.645649582823690e-02   +7.816770386406857e-02; +2.816969170928355e-01   +2.320984927673887e-02   +5.342704519965336e-01   +5.928460987966093e-01   +4.228379429670174e-01   +8.702135389081286e-02   +2.034150968896779e-01   +5.346084963132590e-01; +2.762710487437613e-01   +7.393965116094348e-02   +8.911686916824230e-02   +3.806327190475534e-01   +5.806466124048690e-01   +3.527750660449280e-01   +5.656669962227298e-01   +3.015142903398969e-01; +6.209946559202298e-02   +3.357751525683069e-01   +1.164120779282624e-01   +3.412105030495828e-01   +1.320242971595702e-02   +3.833472502119466e-01   +6.314851732461207e-02   +1.266553167884549e-01; +6.907290235332653e-02   +2.738705969629530e-01   +3.938801344832261e-02   +1.659342737741217e-01   +3.562168688228447e-01   +6.058620335485531e-01   +2.465781063704325e-01   +2.048644216851004e-01];
L3I_L3E_iAMPA_netcon = [+2.709462828162448e-01   +2.995130102765621e-01   +3.778022035437338e-01   +6.008891316282965e-01   +1.459291464448463e-01   +4.474432034780292e-01   +2.392663896267007e-01   +1.725047499538993e-01   +3.695928335372817e-02   +2.665958495512348e-02   +4.647646454261269e-01   +4.139057459295252e-01; +5.168286734662378e-01   +2.445371410557811e-01   +1.976772533031482e-01   +6.065521469160932e-01   +5.172170797550518e-01   +3.143188747505788e-01   +6.057702339328533e-01   +6.691463809001403e-01   +3.286868630404293e-01   +1.421582583405287e-01   +4.422870171919891e-01   +5.661931197839154e-01; +1.838239472136930e-01   +5.058832648837112e-01   +2.131097746301677e-01   +1.828886143314684e-01   +4.516275302603943e-01   +5.017348636294825e-01   +4.942050415676812e-01   +5.406528770327700e-01   +1.384416978446938e-01   +5.010924931946247e-01   +2.196306100746423e-01   +5.405536473081751e-01; +6.448366761394096e-01   +3.676488168022020e-01   +3.833515982029032e-01   +4.805491266629727e-01   +2.039703889638387e-01   +2.381489830120457e-01   +2.668580879602713e-01   +5.307662596149265e-01   +4.947649092984313e-01   +6.282344962619495e-01   +2.543829633593552e-01   +4.832966587570982e-01; +4.706200924332383e-02   +5.324033870019238e-01   +3.028634621052143e-01   +2.718292252838962e-02   +1.394346719389488e-01   +1.348409308735761e-01   +6.247010439120106e-02   +2.180996133624383e-01   +3.193506934412542e-01   +1.316971065697853e-01   +5.784833414869781e-01   +4.825628255847613e-01; +2.380177204807925e-01   +5.117929110081252e-01   +2.469320169909127e-01   +5.956109833478646e-01   +9.169917424457530e-02   +1.022416194702307e-01   +1.727263205210539e-01   +4.526420997467837e-02   +1.229969421018634e-01   +7.088701204730605e-01   +4.899523897739409e-01   +7.036964038102665e-02; +4.217242662991897e-01   +4.795976414888988e-01   +5.347570446557024e-01   +4.410976869993795e-01   +3.488943442468261e-01   +2.501626342635298e-01   +2.378044183079979e-01   +5.840119246166079e-01   +4.378160025774908e-01   -1.061727826521684e-02   +7.470565163701226e-02   -2.926767030748287e-02; +6.241275838079963e-01   +6.124409267637406e-01   +3.465156930141827e-01   +4.534145714972340e-01   +2.646523692391605e-02   +1.627189902685744e-01   +3.661513685249115e-01   +6.192903855812479e-01   +4.311731073276010e-01   +5.926719482038314e-01   +3.241789820570144e-02   +5.115877960624754e-02; +1.059802668531628e-01   +2.160459080616074e-01   +2.027226640500815e-01   +3.089135840841425e-01   +2.170928165336227e-01   +2.540900574110889e-01   +5.711207688783612e-01   +1.440611363132127e-01   +3.861612931340890e-01   +5.615815920957784e-01   +4.133962671680533e-01   +6.168304965593094e-01; +4.501172870789551e-01   +2.730142037170109e-01   +3.566981748275864e-01   +3.184060685393220e-01   +8.533436501350836e-02   +3.824091276073255e-01   +3.124377496228040e-01   +6.488703489923606e-01   +4.966910144796144e-01   +2.280180862997365e-01   +2.385697471854554e-01   +3.227872294481015e-02; +4.377254168575874e-01   +4.835092563077034e-01   +2.960114107376334e-02   +7.525608717429419e-02   +1.147853549976514e-01   +4.964262746504505e-01   +1.869530007923525e-01   +3.992846710093635e-01   +1.071961422454401e-01   +1.552682005220284e-01   +3.286382520919095e-01   +4.149674697069669e-01; +2.505128393621124e-01   +1.029096225136774e-01   +2.820549794617604e-01   +6.524797565923351e-01   +5.008987266873668e-02   +8.122353889853443e-02   +3.623823976444008e-01   +4.202720652812488e-01   +3.252556643891946e-02   +1.152552510390576e-01   +2.321925718275654e-01   +5.653804147753181e-01];
L3E_L3I_iGABA_netcon = [+5.519328932766945e-02   +5.089510764407503e-01   +3.176088689153517e-01   +5.229807852732978e-01   +5.065555425118046e-01   +4.017019616719602e-01   +5.446797856588381e-02   +2.775682650064680e-01   +4.287716951271101e-01   +5.827337223383522e-01   +6.031260874229410e-01   +2.525640708411173e-01; +1.037340522928023e-01   +1.215596706961743e-01   +6.027088016348003e-01   +2.926084951636413e-01   +2.116971942502239e-01   +3.871057614014982e-01   +5.314797499269502e-01   +3.742944376134365e-01   +2.573239753010357e-04   +6.233704975829462e-01   +4.424484893723260e-01   +5.403157022614383e-01; +4.590188533929888e-01   +4.485617026609182e-01   +5.623599923348153e-01   +4.928804235847777e-01   +1.505048696994822e-01   +5.684965676716880e-01   +2.596704581543097e-01   +1.624429260712469e-01   +4.193518825069127e-01   +4.153726550659843e-01   +2.204477048624704e-02   +1.930730065404894e-02; +4.534230062916231e-01   +4.517549159253068e-01   +1.731501750163005e-01   +1.206031207099944e-01   +2.379372364573578e-01   +5.825920813990733e-01   +2.296558014624139e-01   +3.043183644239171e-01   +2.735650135743554e-02   +3.073463645059349e-02   +5.346847623842503e-01   +9.814711192541614e-02; +4.117092204590086e-01   +5.728509497811978e-01   +6.792727542499695e-01   +2.862859960307044e-01   +4.578782924438672e-01   -8.346818493443504e-03   +5.154254427290802e-01   +1.628523977368696e-01   +2.480203916494794e-02   +5.755375816321413e-01   +2.830447763781003e-01   +3.113738640450272e-01; +1.539956491981791e-01   -6.171516768703861e-03   +6.878549256610843e-02   +6.289447018162635e-02   +3.301965568908780e-02   +5.570674292790859e-01   +2.211739420641193e-01   +4.964771108546501e-01   +6.017291863111069e-01   +5.654111385769214e-01   +5.735715199756840e-01   +6.318012514857248e-02; +5.826043734265584e-01   +5.918574401947074e-01   +3.347806293074259e-01   +9.325676174416868e-02   +4.001215771401858e-01   +4.651921201451054e-01   +5.705830842149799e-01   +5.751877945643936e-01   +4.625760152125225e-01   +6.214934181133679e-01   +4.490108156933291e-01   +1.059131967572750e-01; +3.391210773174184e-01   +3.714895011411145e-01   +4.078515023252550e-01   +6.088833096133450e-01   +3.441611057148016e-01   +1.624924189392643e-01   +2.059227500522001e-01   +3.316989002337086e-01   +2.820526021209886e-01   +3.293273743447414e-01   +3.807673709139712e-01   +4.170624694068978e-01; +5.673579827021816e-01   +1.878990131336480e-01   +6.069866426363815e-01   +3.422831186126915e-01   +5.203526950354018e-01   +1.977591028726464e-01   +3.670132463359361e-01   +3.039832769503766e-01   +3.451246198599997e-01   +5.864843429638059e-01   +4.931907239874977e-01   +6.632650660144870e-01; +3.673280815811412e-01   +3.258273914544312e-01   +4.307815752300539e-01   +1.422779841569939e-01   +7.526756845330169e-02   +3.725896732166870e-01   +2.857262729737783e-01   +1.285920637831159e-01   +3.568499320739665e-01   +2.901566622614201e-01   +2.708431266887403e-01   +1.686283411600981e-01; +3.431903302918614e-01   +4.906317016847269e-01   +2.357381043191572e-01   +5.616032317080244e-01   +1.507627556638354e-01   +2.614778718991703e-02   +1.664390018730577e-01   +2.801544189201689e-02   +4.160342082409121e-02   -1.877903264140100e-02   +5.687432370493732e-01   +4.291174645034852e-01; +1.214017747851442e-01   +2.851028148220554e-01   +2.551332556916878e-01   +2.256211110543911e-01   +4.346354753401441e-01   +1.508267394474658e-01   +3.854000434799046e-01   +2.946496096343237e-01   +2.548374947572490e-01   +4.696681110608371e-02   +6.282312084987096e-02   +9.451616346306668e-02];
L2E_Input1_iAMPA_netcon = [+1.460882808777212e-01   +1.360075591594078e-01   +3.597070288486958e-01   +2.617893049164649e-01   +3.825937591065532e-01   +4.233014088043404e-01   +2.792665426122952e-02   +3.907232069304907e-01];
L2I_Input2_iAMPA_netcon = [+2.843836037849340e-01   +2.381599682266862e-01   +6.158199600359308e-01   +6.196620429295587e-01   +3.476182011249845e-01   +3.383197316248415e-01   +4.120715213427650e-01   +5.069149101736016e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.5*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.5*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
