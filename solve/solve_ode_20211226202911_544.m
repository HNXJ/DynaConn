function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.021171374288545e-01   +1.985859210008162e-02   +9.946432121654487e-02   -2.148115459479617e-02   +7.960517274190507e-02   -1.819520541248549e-01   +2.521733141220786e-01   -1.560477959622711e-01   -1.018280884010239e-01   +1.971978234973548e-01   -2.071163982853332e-01   +2.600196018279622e-01   +1.242413423147441e-01   +2.948165893045638e-01   -1.753315317820597e-01   +1.132070518776749e-02; +6.531120140176955e-02   -2.062671809496204e-01   -3.969996386728871e-01   -7.589743288215725e-02   -1.230890405533482e-01   +2.662324174012444e-01   +1.198764112520517e-01   -2.410384240592861e-01   +7.701681045233198e-02   +1.484340781241837e-01   -2.262083325259799e-02   -2.400703745876815e-01   -2.174014610055919e-01   +2.553411225670920e-02   -1.516045800365542e-01   -4.306864122740953e-02; +1.051023568008353e-01   +1.542926207182426e-01   -5.964537587054331e-02   +7.222961553903695e-02   -1.391295618356208e-02   +1.959506446622368e-01   +4.737870203062781e-02   -2.350828480594923e-01   -1.863043224749762e-01   +4.808423533084633e-02   +1.050184817572170e-01   -1.498534244425054e-02   +9.941210878317185e-02   -9.026786137429073e-02   -8.100830578396684e-02   -6.111936257834318e-02; -7.687259455975581e-02   +2.195255484608163e-01   +1.050340696196854e-01   -2.468278099767793e-01   -1.384579984112436e-01   -7.972571620696884e-04   +1.069089790026959e-01   +4.323413083883321e-02   +1.919272187190588e-01   -1.661140773369692e-01   -4.385703977584444e-02   +2.252012981248196e-01   +2.940140041842403e-01   -5.909241175560515e-02   -4.839255646700923e-02   -9.548128892550814e-02; +2.403689094357075e-01   +2.819590530183858e-01   -8.429074924962435e-02   -1.427370148553900e-01   +9.417410065399506e-02   +2.629111252032963e-02   +2.110792455376109e-01   +2.884604318120098e-01   -1.374730927048276e-01   -2.632737250450544e-02   +6.325009524249814e-02   -1.649618976104023e-01   +1.070721024209993e-01   -2.129407812952937e-03   -3.374717040802629e-01   +7.418967766873191e-02; +1.676376719561369e-01   +1.238513923487583e-01   -1.532470526690169e-01   -1.505739774404844e-01   +7.695645620688896e-02   -1.753986716296546e-01   +2.615530286527950e-02   +2.743865406604552e-02   +7.462885139711181e-02   +8.006761677550703e-02   +1.164732861239266e-01   -2.209173790368681e-01   -6.490090270508247e-02   -8.198877180087000e-02   -2.390725273218050e-01   +7.871577551096481e-02; +1.925321426012259e-01   +1.684539073977090e-01   +1.912732631636437e-01   +1.582055419537372e-01   +1.736008605359292e-01   -1.501263155975331e-01   -4.674328536961846e-02   +3.679736100189755e-03   +5.498293295454777e-02   -2.074478904924876e-01   -1.358487161523242e-01   +1.326183615319205e-01   -9.219451876074201e-02   -2.692047691127893e-01   +2.487632273824866e-01   +1.891862031461553e-01; -4.804091228481013e-01   +4.152054499187217e-01   +2.334238996947110e-02   -2.584001946182102e-01   -1.138851229822969e-01   -8.930389085933087e-03   -3.425113462149034e-01   -2.977105629782333e-01   +1.525479075098175e-01   +1.348891403775415e-02   -1.393393596717885e-01   +1.525150574433551e-01   +1.960131041506138e-01   -4.905933522012574e-01   +2.182970125960198e-01   -3.533570759963334e-02; -1.034902068701539e-01   -1.676409019858053e-02   +2.365110272448024e-01   +2.886690721288647e-01   +9.724700531463855e-02   -1.516770838990130e-01   +2.000634177274195e-01   -1.317905913806062e-01   -6.086390745436617e-02   -3.831372775067577e-01   +2.079203738640778e-01   -2.497872019393660e-01   +8.428438134704382e-02   -1.279986438428873e-01   -2.743311917587523e-01   +4.745241120491228e-02; -1.034974778260657e-01   +1.444759236453069e-01   -7.539771231535926e-02   +8.454747418424037e-02   +2.547612817371281e-01   -8.353523809162097e-02   +1.554218847233864e-01   -1.003115731456190e-01   -3.064032040991520e-02   +2.409597773664087e-02   +8.702272296910847e-02   +1.474034495399095e-01   -1.988541479518615e-01   +3.711430759125477e-02   +1.467783173435347e-01   +1.785578888319686e-01; +6.886842374205497e-02   -9.266277291201383e-02   +1.995405963374176e-01   +2.594550109857772e-01   -2.665317515445311e-01   -1.083880224736934e-01   +1.083408522333614e-01   +8.549961479239146e-02   +1.669996001268211e-01   -6.834833964741560e-02   -6.140931396514515e-02   -1.035903251669403e-01   +2.146320397331393e-01   +6.072038980651809e-02   +2.851402537132603e-01   -8.002440540487990e-02; -1.009742367455759e-01   -1.635239357306231e-01   +1.182279523434106e-02   -2.322152778830575e-02   -2.676194600989063e-01   +1.808595989379790e-02   +1.137080813103286e-01   +1.005011211616896e-01   +1.990880012331037e-01   -1.425074801656459e-01   -2.364858700178753e-01   -1.978956698491266e-01   -1.040056742758552e-01   -3.922149010665402e-02   +5.102200453266308e-02   -1.275754309378769e-01; -3.109948575882450e-01   +1.746021034081835e-02   +4.414808103362942e-01   +2.674410872368583e-01   +1.104039263914630e-01   -9.439693125361895e-02   -1.535219800491395e-01   -2.122932920506108e-01   -1.479499460466666e-02   +1.925100576087719e-01   -8.100277394402562e-02   +1.978444198385968e-02   -6.958023404014733e-02   +8.043661772062215e-02   +1.258769283729289e-01   +4.424446375992359e-02; -3.307530820800472e-03   +4.799975050886429e-02   +5.728954481826599e-02   +1.034511305231734e-01   +7.262961946005855e-02   -1.709334676654306e-01   -1.613376479058160e-01   +1.652235175374633e-01   -2.712047683726327e-01   -1.064240846985349e-01   -1.767320536483223e-02   -2.235962285649994e-01   -1.833053748451280e-01   +1.659548418310194e-01   -1.046561817372005e-01   +1.004032331345511e-01; +5.407995905880751e-03   +1.658236815568195e-01   +1.537803049584722e-01   +1.361385216600141e-02   +6.036859079177423e-02   -1.929485304206177e-01   -5.189647152124287e-02   -6.930428033766886e-02   -2.458560510518508e-02   +1.742430459526471e-01   -2.495849250571500e-01   -4.825979596589915e-02   -1.748114511954023e-02   +2.325016897829014e-01   +9.594702918020812e-02   -1.185965726487943e-01; -7.182112194135538e-03   -2.366619564589527e-01   -7.641719883189270e-02   -4.639370551613843e-02   -1.430521448154925e-01   -6.234262696272490e-02   +8.336417704884228e-02   -5.133627101595367e-01   +7.925089188862107e-02   +8.198872654526037e-03   -4.088381330237528e-02   +5.125510430428383e-02   -1.735875188955387e-01   -2.087634037875150e-02   +1.445576455494324e-02   -1.531365126005020e-01];
L1E_L1I_iGABA_netcon = [+2.320149721793334e-01   +1.577400839244234e-01   -2.591793791241304e-01   +4.165609814668660e-03   -8.591590789130188e-02   -1.755673864722083e-01   +1.768678240125165e-01   +3.736552381891650e-01   +1.965133579002591e-01   +2.681356936612398e-02   -2.402044666715176e-01   -1.057319852536520e-01   +4.272906126849339e-02   -2.365512453304308e-01   +2.983797924422376e-01   -1.879262903113880e-01; -3.776477274039138e-01   -6.129625942474767e-02   -5.064973326694518e-02   -6.435525777331785e-02   -4.217502407667779e-02   +9.274088513508680e-03   +2.535223093436810e-01   -9.879408132233460e-03   +1.025447265479332e-01   -7.345172240545854e-02   +1.272639499594937e-01   +1.127254960544620e-02   +3.235587815683352e-03   -8.733367277984425e-02   -2.588318935258289e-01   +7.832353918465809e-02; +1.565996153661836e-01   -2.032701997474910e-02   +2.663925386368622e-01   -1.307988670409310e-02   +2.390800162247274e-01   -4.015652177549941e-01   -7.188740394293841e-02   +1.297282727495497e-01   +2.382568208922357e-01   -1.410204251907599e-01   -2.012335259700244e-01   +1.798404772516543e-01   -1.328207516653807e-01   -1.404648008907313e-01   -1.296954199683860e-01   -4.599561377123501e-02; -5.886289971526441e-02   +1.051617357730320e-01   -2.623603855005842e-01   +9.837899209157459e-03   +2.647861369451612e-01   -5.785026341379801e-02   +1.545589281480938e-01   -5.571904992331690e-03   -2.403667854808302e-01   -3.279760529380126e-01   +2.430779058197038e-01   -5.110547447021590e-03   +1.082573496842347e-01   -8.110871273218270e-02   +1.572724440085221e-01   +1.775341292463035e-01; +1.626162825782397e-01   -1.824432461690828e-01   -1.921285388116948e-01   +1.068638348972160e-01   +5.424616780582649e-02   -1.360228373764197e-01   -3.141357591780021e-01   -2.556340355191128e-01   +1.980095302161605e-01   +4.662987141903410e-02   -6.389966284830181e-02   -6.521203518127487e-02   +9.769622610046688e-02   +6.184738728070176e-03   +1.884318967506851e-02   +7.138415628652642e-02; +1.462297360933794e-01   +2.120238482888002e-01   -8.862409481735434e-02   +5.715679879666560e-02   +6.133445204569749e-02   -9.216885211486650e-03   -4.034461302025377e-02   +2.232318248317043e-01   -7.896025538110095e-02   +3.719216199789530e-03   -6.310993157587215e-02   -1.786005522000321e-01   +1.437468837511163e-01   +2.154823269325392e-01   +4.658734311387414e-03   +2.321996847294794e-01; +6.537733621179703e-02   -2.563495381155920e-01   -4.045967817462743e-01   +1.697751381391027e-01   -2.674443835107599e-01   -9.182907844498157e-02   +1.316165702103029e-01   +2.506468085695016e-01   -3.446081177304672e-02   -2.249181951199316e-01   +4.638290166871921e-02   -2.925391905832722e-02   +3.455615970299026e-01   +1.211772098321102e-01   -4.948368051290722e-02   +8.206105671368243e-02; -4.913559382827328e-02   -1.308982491261876e-01   +5.695588020821647e-02   +1.528405669374644e-01   +2.257891199659438e-01   +1.812054768982551e-01   -9.884214451173538e-03   +3.688154775229329e-01   -2.030587942144796e-01   +4.566741627311703e-01   +6.492290597292352e-02   +1.859176566432853e-01   -6.197731237942683e-02   +8.469897813522538e-02   -7.843679127092774e-02   -1.008433708006737e-01; -1.185412579956838e-01   +1.699817667544016e-01   -2.085718780393091e-01   -1.342191909029585e-01   +2.083251652539179e-01   +3.434530089386879e-01   -2.611031433571773e-01   -9.367676221122893e-02   +1.982483959768965e-01   +5.611961713165592e-02   +3.137517908556148e-02   +1.215576037791223e-01   -1.239247695588763e-02   -9.157468303439628e-02   +1.368983387217692e-01   -2.584969062767690e-01; -1.570322532940490e-01   -6.934172289764104e-03   +9.684181284421754e-02   -1.004953309093828e-01   -1.729197081175322e-01   +3.071829637503887e-01   +1.410449035579747e-01   +2.980507031997303e-01   -3.938128113085446e-01   +4.134686139043731e-02   -2.571625385728385e-01   +4.376411486012717e-02   -2.330093511649254e-01   +5.385460430396176e-02   +8.187117124239993e-02   +6.514661678224759e-02; +3.458801551917970e-01   -1.421731535504781e-01   -1.258502466027003e-01   -1.842412787535757e-01   +1.888746872087714e-01   +6.122237963910801e-02   +1.711648484491204e-01   -5.555141838008046e-02   +6.369537890714033e-02   -3.820334232525972e-02   +9.351240230738028e-02   +2.600290974430068e-01   -1.024316153414732e-01   +3.496075461015679e-02   +3.726785910733758e-01   -3.090039927020773e-02; +3.921539672597086e-01   +1.179065679067336e-01   +7.089824163118406e-02   +6.573931432049210e-02   -2.192567248001334e-01   +2.731409065075411e-01   -1.226515522176988e-01   -1.085611693770322e-01   -2.072305997262910e-01   +6.194385296706244e-02   +2.728644584907170e-02   +2.155178463820460e-01   -1.033424292259489e-01   +4.379244137872394e-02   -1.418425365983355e-01   +9.343215366426200e-02; -1.727164340968132e-01   +6.058459411284749e-02   -5.545131520936471e-02   +1.548921043560987e-01   +4.869864347121451e-02   +8.217304907667863e-02   -8.070356395054909e-02   -5.460049533069540e-02   -3.422641301900784e-02   -1.278084811900698e-01   +9.625079340837066e-02   -3.508686389789220e-02   +1.885509571435659e-01   +1.402708496291352e-01   +2.607403691998962e-01   +7.946239671077454e-02; +9.712124448003817e-02   -1.093339219602253e-01   +7.275512625461519e-02   +9.698334622036128e-02   +3.650467572622265e-02   -1.585494832293202e-02   -1.511727438164616e-01   +1.375918038430243e-01   -1.743347894470147e-01   +1.008531614800227e-01   +1.646558620454754e-01   -1.007393018423139e-01   -6.899914500404823e-02   +1.402993272468164e-03   -2.827207393016788e-01   -3.032230030178352e-01; -1.151586609337469e-01   +2.044757309468481e-01   +1.499673846343471e-01   -1.750832026283090e-01   -2.513382652047313e-01   +2.436929430799456e-01   +2.465176212558472e-01   +2.417350592238875e-03   -2.495578468151732e-02   +8.946905741416480e-03   +1.361607554676905e-01   -3.986507379752655e-02   -7.095644315167488e-02   -1.422097479602194e-01   -2.717115733606613e-02   +1.920830155883745e-01; -2.097509748531717e-01   -2.806804215673219e-02   +1.204103109986602e-01   +2.397803384920532e-01   +4.948029552760674e-02   -7.008569607302680e-03   +2.133412265577228e-01   +2.162467064021466e-02   +6.656968267325702e-03   +1.839555261329833e-02   +2.055059121734998e-02   -2.017107642623953e-01   +4.075827212191928e-02   +1.437474135585663e-02   +1.881684846771987e-01   -7.763174117252127e-02];
L2I_L1I_iGABA_netcon = [+1.764933110375391e-01   -1.192471742789409e-01   +2.810352924954936e-02   -2.755293422801883e-01   +3.830832668354267e-01   -2.618892849862050e-01   +1.206641861129306e-01   -2.313226973495610e-01; -1.528409618274888e-02   -8.763601177394624e-02   +2.970158796062656e-02   +2.517913780435641e-01   -3.401324062213570e-02   -2.488855307655666e-01   +1.768114560127410e-01   -1.658896671757357e-01; -9.485599488735623e-02   +3.090885543506039e-02   +6.697453496528562e-02   -5.551197527734869e-02   -1.093362791706791e-02   +1.216093167536821e-01   -4.157325096486617e-02   -4.240393309560549e-01; -8.416789165522130e-02   +4.787972093171384e-02   -2.049294398651873e-02   +1.152607885203650e-01   +8.694398126212853e-02   +1.360456062122100e-01   -6.861278534307005e-02   +2.206043761369715e-01; +1.094353243681394e-02   -1.836292630562091e-01   +2.580558889568116e-01   -1.388665227506215e-02   -2.973100902014630e-02   +1.642120109500421e-01   -1.491406090752805e-01   +1.768546352955626e-01; -4.028460518611082e-03   -1.147638733182533e-01   +3.044309721358750e-01   +3.461059354070436e-02   +1.694144828766893e-02   -1.558042049191121e-01   -7.816447015722222e-02   +4.757787164591420e-02; +1.580431611067346e-01   -5.969952787061117e-02   -1.170598817987028e-01   -1.757032255665929e-01   +3.054909488814190e-01   +1.742645715002207e-01   -3.971745245106055e-02   +1.183523895770726e-01; -4.521259166603546e-01   +2.962206798806151e-01   +4.000623933894730e-02   -1.874606982562827e-01   -2.519573979939782e-01   +2.188273176845024e-01   +4.052602189514984e-02   -2.780272042498280e-01; +1.988458318297271e-01   -1.308089114443242e-02   +6.109115650146251e-03   +6.822274275910728e-02   +2.187607773529377e-01   -1.822219795950506e-01   +3.037744558893393e-03   -2.015907477338913e-01; +2.884979789401025e-02   +1.509119380319288e-01   -2.145973999775992e-01   +2.433893641643841e-01   -1.300902747995617e-01   -1.996546300797039e-01   +6.397375553958651e-02   +2.749417095131682e-01; +1.323569243200829e-01   -2.674747747258182e-01   -1.382092184745201e-01   +1.297862344978511e-01   +3.331169778887484e-02   -1.220700730833038e-01   -7.829688778754272e-02   -2.401108201359227e-01; +6.752449815130007e-02   +8.142780451862322e-02   +1.680161531912298e-01   +1.830368584722891e-01   +1.928269551845226e-02   +1.000022778529596e-01   +1.054190177433012e-01   -2.947676641733258e-01; +6.647669371961933e-02   +1.101358501124011e-01   +9.959386300005003e-02   +1.089955020783545e-01   +3.426135825508899e-01   +1.683232788583265e-01   -1.583340863348685e-02   -3.010861063881749e-02; +2.108797765896405e-02   +6.017440743257182e-02   +1.484287434081382e-01   -1.925460240679701e-01   -8.312279460701431e-03   -1.390358736080381e-01   +3.103954830379671e-02   -1.009978701104126e-01; +2.449502699190954e-01   -1.671314148393046e-01   +1.358287971449846e-01   +3.486671837623975e-01   -6.457386493206185e-02   -8.464858251798080e-02   -4.827605141819793e-01   -3.428318845934044e-01; +9.315878449406438e-02   +4.073721686685487e-02   +4.528958975541912e-02   +1.669122460496427e-01   +1.863008973581118e-01   +2.838752399489639e-02   +1.145850833285333e-01   -4.498079406596561e-02];
L1I_L2I_iGABA_netcon = [-1.658999099182660e-02   +4.391282206981674e-02   -1.752689167091302e-01   +1.636565250112055e-01   -2.272809732059519e-01   -1.182947254479574e-01   -7.458661330590217e-03   -2.247468734735381e-01   -2.516479603016457e-01   +8.080185489170538e-02   +4.372938126689697e-01   -4.959030904061517e-02   +1.765303832337821e-01   -2.932315478448577e-03   +2.892038626857073e-03   -3.469100188132445e-02; +9.472805325506570e-02   +1.550302667280752e-01   -2.175775002142421e-02   +1.033466652684935e-01   -4.713118874937829e-02   -4.850911064782672e-02   -2.847430837174168e-03   +1.060782102428854e-01   +2.355194259299973e-01   +6.532461362196185e-02   +3.620344252224279e-02   -2.265967498835330e-01   -1.476153099939550e-01   -2.418619680293903e-01   -2.578170852902786e-02   +1.237714207256119e-01; -3.578451780769246e-01   +8.162206402202535e-02   +3.499229192650173e-02   +1.169752652693061e-01   -2.130808885047145e-01   -3.546371795079153e-02   -1.500773405273277e-01   -9.017752319667735e-02   -1.727932639890804e-01   -2.478496422832393e-01   -4.117406606783591e-02   -3.283038159333536e-01   -2.390296169839586e-01   +7.633236907936555e-02   +2.172443268984765e-04   -1.889818407670151e-01; +2.079770169154661e-02   +1.338451785817606e-02   +3.942899177432196e-02   -3.659452837170509e-01   +3.173793299872371e-03   -2.452870346484575e-01   -4.162074231774772e-02   +6.579375311764858e-02   +9.299563262953295e-02   -3.218860681850728e-02   -1.722142125420663e-01   +4.874117829994655e-01   -2.855758767532255e-01   -2.672357955901856e-01   -1.570851061852832e-01   +1.158175418515872e-01; +1.026286479659507e-01   -9.068231271436897e-02   +1.727182462275962e-01   -4.443289811488459e-02   +1.089955320918175e-01   +1.945129797085882e-01   -7.646800533172616e-03   -2.873159179395973e-01   -1.426108877917794e-01   -4.797699591992902e-02   -9.696570626767310e-02   +2.233937703946562e-02   -5.009799462642832e-02   -2.619461899424564e-01   +1.808713263351891e-01   +2.356676122363425e-02; +1.050804857409435e-02   -2.283534060919742e-01   +1.332349712574678e-01   -3.605611031434700e-02   -3.381307540130372e-01   -5.338455049332477e-02   +2.551465766240822e-01   +1.340151239192799e-01   -2.666624359486361e-01   -1.068978537914202e-01   -1.978641414032715e-01   -1.765418405928089e-01   -1.883742479302903e-01   +3.325488403627448e-02   +5.516524435986200e-02   +7.623315569344621e-02; +6.335226535292909e-02   +4.810233207500810e-02   -2.578492439895287e-01   -3.411307214004421e-01   -4.313248772909792e-02   +1.883974105140682e-01   +1.268095884263984e-01   +6.201140085489088e-02   +9.005232535028640e-02   -1.645734759782090e-01   -3.235285355117198e-01   -1.477410881965281e-03   +4.551598799393922e-02   +4.566103287266655e-02   -3.370281802309361e-03   +2.900579348794076e-02; -2.552291214903354e-01   +1.659484246739593e-01   -1.202366525611157e-01   -1.946207140511904e-01   +1.720718819848500e-02   -7.590003676763692e-02   +9.733225405764852e-02   -6.563719670237861e-02   -8.907195707379337e-02   +1.876727189712498e-01   -3.313469110623297e-01   +7.657479166247522e-02   -1.493041653643075e-01   +2.732589986584437e-02   +1.959255746974271e-01   +3.079770357221810e-01];
L2E_L1E_iAMPA_netcon = [-5.980273254788136e-02   -2.080995444487131e-01   -1.122396745974670e-01   +1.419738806205756e-01   +2.278467205567879e-01   +2.804548302221437e-01   +1.364050186179109e-01   -1.797552107770145e-01; -1.044393898346752e-01   -1.247821772833389e-01   +2.209866847357659e-01   +1.655143837718587e-02   -2.168143017681517e-01   -1.948985667192788e-01   +1.382527315164928e-01   -2.155074910536542e-01; +6.850044769640082e-02   -3.117672171680111e-02   +1.384731016588785e-01   +9.884976040265339e-02   +1.612735709854412e-01   -1.919854251971992e-01   +2.569927424874666e-01   -2.509744511942263e-02; -1.238182115722528e-01   -1.822232558912952e-01   -1.556317779370258e-01   -1.320588358959362e-01   -2.404113527005031e-01   -2.048171304222788e-01   +3.365732667915954e-01   +6.474396045659415e-02; +6.034660652398058e-02   -1.069445564239186e-01   +2.016505831033369e-02   +2.602269158945929e-02   -2.971052247979256e-01   -1.042321262168688e-01   +5.137966354780497e-02   +3.071998465290123e-01; -1.912707269184164e-01   +1.090476623655031e-01   +2.610803035709952e-01   -1.781055931576786e-01   +1.856227657876753e-02   -2.660896996027799e-02   -2.265932046208442e-02   -1.293689516841692e-02; +4.808866024640861e-02   +2.924069568144001e-02   +1.453293805684988e-01   +1.879030568663981e-01   +5.925953029248241e-02   +1.039761670910057e-01   +2.030349013725358e-01   +2.776315497082475e-01; -1.784747993816652e-02   -2.375582443865895e-02   -3.086991829987423e-03   +9.084012558313405e-02   -2.590693872504356e-02   -3.122583056650266e-01   +1.532516815100233e-01   +1.342158731074164e-01; +3.338247610481833e-02   +1.379896133037283e-01   -6.194673133019524e-04   -3.136101726350359e-01   -1.876644689703581e-01   +8.485500081096949e-02   +2.084687667879587e-01   +1.810049173309079e-01; +1.971980340252481e-02   +2.401683011062810e-01   +2.038591868126828e-01   -2.624330025630021e-02   +9.661512203269038e-02   -1.282209914758183e-02   -1.491854580916374e-01   -1.993052633576933e-01; +9.613096699856619e-02   -8.941205641830249e-02   -2.218734021288629e-01   -3.684411970694125e-01   +2.092021916188116e-01   -3.039546422038877e-01   -4.393807824692162e-02   -3.538789055028989e-01; -5.666447854799826e-02   -3.982209652252500e-01   -8.266447886766951e-03   -1.953860128106454e-01   -7.496887058558629e-02   -1.369994736836398e-01   +1.558347220649483e-01   +9.107105195769796e-02; -3.083730170389403e-01   -1.229663369227953e-01   +4.133738031617076e-02   -1.210594797320163e-01   +6.130538994565538e-02   -8.507851101935429e-02   +2.700316044246491e-01   +2.215536720535009e-01; -7.218962144934259e-02   +1.370468291963770e-02   +1.112597049916781e-01   -4.233817725090155e-04   +1.450776144367993e-01   -4.251668712613219e-03   +2.211684563096568e-01   +2.267938648518209e-01; -5.095415247225922e-02   +2.832130017346516e-02   +1.753321520330441e-02   -5.565073633664906e-03   +8.310058223168393e-02   -3.538785611087773e-02   -7.986850566014085e-02   +3.669761185243222e-01; +3.678841274768566e-02   +3.081633961985758e-02   +4.736084369179877e-02   +2.744249224057042e-01   +7.302654557207973e-03   +3.135586136581610e-01   +3.384665051330001e-01   +4.629675363130343e-02];
L1E_L2E_iAMPA_netcon = [-2.158059956529561e-01   +2.503894045934074e-01   -3.303528194171483e-01   -1.270817165773894e-02   +7.359726693395811e-02   -1.833429520513541e-01   +1.456841395414726e-01   +3.124797749302436e-01   -8.053070024224590e-02   +2.044096216493630e-02   +6.262950082675733e-02   +1.288924312064725e-02   +2.553630973988081e-01   +8.762764374624879e-02   +1.908247244987444e-01   -9.905390380676282e-02; +1.872573758271854e-01   -1.187642070908801e-01   -1.239960633375357e-01   -1.408521266523485e-01   +7.449610214655089e-02   +5.698695059857765e-02   -1.051245657227429e-01   -1.419757647080128e-02   +1.260568439463058e-01   +4.197743086230148e-02   -2.132167437667836e-01   +1.149860589997681e-01   -1.154081659364339e-01   +1.272084797291145e-01   +3.494764409384597e-01   -3.883291318639259e-01; -3.870158665348005e-01   +7.288237334051217e-02   +8.957014190913708e-03   +4.596746739775682e-02   -1.200913739571832e-01   +2.038791291690864e-01   -1.183119707040530e-01   +1.563004668456869e-01   +8.540553779814983e-02   +6.479198049939441e-02   -1.570864191671588e-01   +6.128948166628014e-02   -1.926735537958217e-01   +1.032012189935715e-01   +1.093528290102041e-01   -2.776852365007657e-01; +2.271657120962065e-01   +9.598710186874990e-02   +5.685102725651624e-02   +3.116897446046887e-02   -3.289935410758922e-02   +1.882757115396013e-01   -1.605305132453597e-01   +1.575922804951569e-01   +3.079293820880530e-01   -8.223842545138946e-02   +5.541781316101300e-02   +2.795944957499435e-01   -3.573349900138413e-01   -1.997824422383489e-01   +2.368330624923820e-01   -1.699542363306991e-02; -1.430202292413927e-01   +1.729012214909606e-05   +1.770873683566191e-01   +1.169307541265920e-01   -2.806843207040089e-02   +6.711987992871833e-02   -1.982180881866864e-01   +1.895237512128830e-01   -7.534467055084307e-02   +3.917271444913784e-01   -1.599989328241306e-01   -3.230454229009387e-01   +1.951075273719124e-01   -8.278357911584540e-02   +9.602132348014460e-02   +1.932379290631201e-01; -2.090137773328338e-01   +2.764436167291895e-01   +7.367954912980416e-02   +9.516671444572038e-02   +1.551787535016272e-01   -1.370467620188001e-01   +2.335908136578370e-02   +1.061301309581996e-01   +5.534365609759981e-02   +1.466800554855320e-01   -3.239536943855674e-01   +8.543409973467211e-02   +6.000186372093948e-02   +2.134074331560403e-01   -1.714176667901041e-01   +3.422704741828789e-02; +2.223666047767089e-01   -2.555746734183155e-02   -6.473483949169005e-02   -9.294441541086428e-02   +9.998411794652380e-02   +4.043710033352620e-02   -1.164050851059914e-01   -4.663280001740711e-04   +2.116532321677394e-01   -2.993626871815013e-02   +1.672525395236590e-01   -1.391856792560777e-01   +1.507849529068649e-01   +1.611083528609397e-02   +1.252648506966373e-01   +1.812991152043243e-01; +3.935681854580642e-02   -1.465584757510466e-01   -7.174940773092117e-02   -9.724807293054979e-02   -1.856585802139135e-01   -2.421883030422239e-01   -1.196398930565409e-01   +6.427131716327066e-02   +1.362014283239700e-01   -1.585444442997821e-01   +1.892388705161297e-01   -7.524190268217046e-02   -6.047340370095222e-02   -3.064479961190752e-01   -1.435625985895567e-02   -1.101522954676798e-01];
L2I_L2E_iAMPA_netcon = [+3.146351224016173e-01   -2.207970837999533e-01   +6.077510806349402e-02   +6.702748152384531e-02   +1.817842192022052e-01   +3.175802369661772e-03   -1.390929917680342e-01   -1.184764109084401e-02; +9.064721315189875e-02   +5.980198929295483e-02   -3.992443490026784e-02   -4.819864536384898e-02   +2.566307001986072e-01   -1.197560379303223e-01   -1.166002699041128e-01   -7.939928762956043e-02; -1.766790982553262e-01   +6.130291689636394e-02   -2.147574252417040e-01   -1.423857847670284e-01   -3.927403063808653e-01   +1.001388060374324e-01   +3.957631981709385e-01   -3.598908188116438e-01; -7.064640046038925e-02   -3.285014818835856e-02   +8.237339020888282e-02   -2.189466606849825e-02   -9.979965321249748e-02   +2.386033771476059e-03   +1.514835636313347e-01   +5.838038199034302e-03; -1.578060934417135e-01   +1.803200447790866e-01   -2.075228851501364e-01   +1.834368505723683e-01   +3.240243558083470e-01   -1.909611989977539e-02   +4.485926701375986e-01   -1.372021943256176e-01; -4.238643563553496e-02   +4.588135333689137e-02   +4.957010378574955e-02   +2.454900838153355e-01   -2.314400037028841e-01   -8.708943899327937e-02   +3.347877078661474e-02   +2.930341303314544e-01; +1.873320965246069e-01   -1.515327808044072e-01   -7.777952460333010e-02   +5.727204762382267e-02   -3.818894781869936e-02   +3.440831616039507e-02   -1.314650697372454e-01   +9.145119854690657e-02; -2.525649425760365e-01   -2.554497489761382e-01   -2.777772330818808e-01   +2.410645302581796e-01   +5.226280598952224e-02   -1.646223418494774e-01   -8.785339527559229e-02   +1.806968225321794e-01];
L2E_L2I_iGABA_netcon = [+4.742021040994884e-02   +7.056763153582765e-05   +1.613940955470236e-01   +2.210506706361173e-01   -2.839104846536629e-02   -3.319112781277523e-01   -2.579402629914069e-01   -1.548213788508811e-01; -1.516723994246838e-01   -7.329091950167807e-03   -1.057363836561010e-02   +2.020609394863025e-01   +3.103064947759972e-01   -1.503308847409754e-01   +1.603618345387418e-01   +5.952521663473727e-02; +7.021606738619735e-02   +2.911921631051685e-01   -7.891742954473117e-02   -4.628442952198827e-02   +1.821256121499124e-01   -5.976810300600823e-02   -1.157240632560684e-01   +1.038226459344644e-01; -2.238843423622585e-01   -7.863767449694947e-02   +5.298953873360351e-02   +3.167221906864081e-01   +9.642266655539161e-02   -5.803140781449838e-02   -8.402735271653440e-02   -2.364557581835497e-01; +3.558482986782328e-01   -3.183640016796958e-01   +1.231910724698241e-01   +2.474887575055625e-02   +2.004064733588898e-02   +3.145408139045407e-01   -4.094573382518341e-02   +2.204152075596364e-02; +8.505023080676358e-02   +3.900334165844553e-01   -4.070377991902316e-02   -1.115245430591889e-01   -2.266728167837548e-01   +1.154386303471212e-01   -2.250655794493055e-01   +2.222277074238596e-01; +1.162299465845877e-01   -1.777566342941002e-01   +1.459748074206167e-01   +1.141415811503915e-01   +8.128320947633133e-02   -6.752267085473804e-02   -5.581431211959480e-02   +7.285109681559833e-02; +4.089601079634046e-02   -1.428342604461314e-01   +2.160212118090609e-02   -3.455205579866908e-02   -2.130643427940234e-01   +2.570881335039467e-01   -4.653965125580859e-02   +1.088517524018693e-01];
L3E_L2E_iAMPA_netcon = [+2.166525048254007e-01   -6.173461158568638e-02   +1.322145677556016e-01   +7.153058529125404e-03   +2.809550767116938e-01   -2.402420356009631e-02   +1.822967853789082e-01   -1.139207339074362e-01   -2.854925872666981e-01   -6.119171105508465e-02   -2.241439221221402e-01   -8.906327626771179e-02; +3.061850567749638e-01   -6.465249288590935e-02   +3.352384723172043e-02   -8.616398864671962e-02   -7.643184253844625e-02   -1.337506401108777e-01   +7.213465304371719e-02   +2.441330635520070e-01   -2.901542072702821e-03   +2.097756716175704e-01   -7.986332421220210e-03   +1.991313729661400e-01; -2.225904392764992e-01   +1.369741929622079e-01   +5.958854710634817e-02   +1.699110490970858e-01   -7.455832974833333e-02   +3.464325583370760e-01   +2.485416711203810e-01   -1.103600053274349e-01   +3.326694119834155e-01   +1.389436983552352e-01   -1.232181150686616e-01   -2.095335115719459e-01; -2.012602917124178e-01   +4.437917426396890e-03   +7.260043739107216e-02   +9.337375906971354e-02   -1.239359724667729e-01   +1.782950991868655e-01   +1.987710071866876e-01   -1.499682149453754e-02   +1.023222306027776e-01   -2.145337224158294e-02   +1.451528286856027e-02   -1.389275172116729e-01; +1.010361384649390e-01   -1.066386100372386e-01   +4.306827001178411e-02   +1.722579395701976e-01   +4.032849419284310e-02   -5.322211517823630e-02   -1.890489666063458e-01   -6.155391673747104e-02   +1.829270490373566e-01   +1.407018982773636e-02   -7.906284854070469e-02   -3.719193969943355e-02; -2.086672963354726e-02   +2.120560202527307e-02   -2.512512093758476e-02   -8.985784659596151e-02   +3.101403390519247e-02   +3.178184061663703e-01   +2.047253523877183e-02   -1.354304029931435e-01   +1.353490705948475e-01   +1.371891334540994e-01   +2.859479923367658e-01   -1.534499256312753e-01; -1.840971393924888e-01   -1.090797613103466e-01   +1.344228840539105e-01   -1.169573407715928e-01   +3.947785387212430e-02   -1.886875049095031e-01   -2.541899957938210e-01   +1.141304258296133e-01   +3.609806032490580e-02   -1.366680282010325e-01   +1.447399963534465e-02   -3.436425999376931e-01; -5.135938049262634e-01   +8.132850589561613e-02   +1.215888640044470e-01   +3.368602032656029e-01   -1.898152944923106e-01   -4.493115964467730e-02   -3.058980864173994e-01   -2.418978761333063e-01   -5.338799450293099e-02   -5.204889921735886e-03   -7.031484143919291e-02   +7.224357690650296e-02];
L3I_L2I_iGABA_netcon = [-2.398766622781660e-01   +1.465945010209703e-01   -3.920522431249988e-02   +1.589497686598521e-01   -1.955472919162794e-02   -3.095070628215309e-01   +1.723492960056777e-01   +1.915501126019830e-01   +1.103036003461287e-01   -6.486500689514479e-03   +2.612353141160138e-01   +6.776069780448121e-02; +2.360049981959469e-01   +1.789705142988000e-01   -4.136178192323295e-02   -1.022236478399293e-01   -1.594245245849271e-01   -3.233619312898885e-02   +3.142226292436451e-01   +2.799223136754446e-01   -2.446024787703260e-01   -2.262627457291244e-01   +8.956828446603984e-02   +3.017544321863748e-01; +1.354915762956777e-01   -4.947686505943889e-02   +6.887818726509530e-02   -2.905523505086142e-01   -3.463234334393874e-02   +1.768799995005656e-01   +9.934783838580248e-02   +8.263397430256400e-02   -5.257898245965181e-02   -1.205756524272260e-01   +1.088473396714838e-01   -2.462744867607204e-02; +7.412041433317917e-02   -2.066265512533478e-01   +1.872053716724973e-01   +4.412634148291192e-02   -2.639719554871135e-01   +9.664530883879505e-02   -1.167205732353780e-02   -2.937196728474666e-02   +1.309212559110482e-01   -9.888400907541224e-02   +1.152627207808013e-01   +1.377786022833719e-01; +2.803433722956096e-02   -3.971486220072677e-01   -2.168481156191812e-01   +3.733972836407252e-02   +2.014688710315556e-01   +1.884604268804398e-01   -1.633032292281889e-01   +1.448408449543818e-02   +1.860769613635429e-01   +8.192320669726272e-02   +1.627279871529199e-01   +1.634210910703934e-01; +4.306779569021865e-01   +7.323057061677207e-02   -3.248835720735000e-01   +3.640635259141149e-02   +1.777406110583214e-01   -2.596338705713372e-02   +1.895933260773187e-01   -2.467011832295176e-01   -2.193601847034449e-01   +4.551279098605845e-02   -2.659663474214399e-01   +5.210425553047099e-03; +2.249812853004213e-01   +1.137958921144505e-01   -1.326003970746027e-01   -1.158313478033871e-01   -1.746671735922836e-01   +1.830149762539736e-01   +3.867986970407388e-01   +1.315057563185052e-01   +1.831636435021255e-02   +1.765108238496588e-01   -2.550329516617181e-01   -2.768158542331238e-01; -4.942793356029813e-02   +4.091736593808258e-02   +4.838026723565125e-02   +1.135438958694358e-01   -5.595741598823675e-02   -6.343334984322342e-02   +2.876221285242833e-02   -1.156487705104859e-01   -3.009355699453935e-01   +3.881824123108150e-02   +1.371495575503379e-01   +1.139820787267455e-01];
L2E_L3E_iAMPA_netcon = [+2.218823795324874e-01   -4.054900817182852e-01   -7.137925636147142e-03   -1.962481787962309e-01   +2.315334028479501e-02   +1.376136749320791e-01   +2.012891169750312e-01   +2.547689486067871e-02; -4.539355094965870e-02   -6.054862058485116e-02   +1.961071647720932e-01   -1.283871088693755e-01   +1.268119666938858e-01   -1.112802619253016e-01   -2.469409576877748e-01   +4.800414641269862e-02; +9.128206492358280e-02   -2.292893123145394e-03   -1.159631467823352e-01   +8.866380450635303e-02   -1.248254152169432e-01   -3.764049149626887e-02   +2.612035380690010e-01   +1.192929561220727e-01; +1.314448717701355e-01   -1.722759255947512e-01   -5.059132296887574e-02   -6.623521772976754e-02   +5.176520920358205e-02   +8.754583705937989e-02   -3.887339842690039e-01   +8.219999159866034e-02; +6.163780357031758e-02   -3.856617040686992e-02   +3.978298785803059e-02   +1.726921473452916e-01   +8.861063290560713e-03   +1.548345710153048e-02   +4.074926124073430e-03   -2.710251781185554e-01; +1.554207957242837e-01   +3.381981440176667e-02   -3.517543534083082e-01   -2.157711363155377e-01   -1.157279626259039e-01   +1.893476224334174e-01   -1.913952187957429e-01   -2.726748607255745e-01; +6.291946304487370e-02   -3.900058280434639e-02   -4.621258437532643e-02   -1.184393366193886e-01   -1.908429280938603e-01   -2.319999789303622e-01   +1.690815628441241e-01   -4.025011468896506e-02; +2.284121039947579e-01   +1.335768198907086e-01   -6.479471704369094e-02   -6.161705052746191e-02   -2.561966577016798e-01   +7.333804786940328e-02   +1.404365556243991e-01   +7.588693763819185e-02; +1.155899858096510e-01   +2.575296662057546e-02   -2.123768831390811e-01   -2.170469522138277e-01   +4.366956215871751e-01   +1.181504106253580e-01   -3.911018533507904e-02   -1.839050748802477e-01; +3.391515479380777e-02   -1.062927624141297e-01   -2.074429470353590e-01   -1.297198593326716e-01   +4.090100892820537e-02   +1.495822622631696e-01   +1.654715431798293e-01   +1.504448703925304e-01; -2.460169678654223e-02   -4.998917009446113e-02   +9.306643561570593e-02   -7.107707934883484e-02   +1.627410320469366e-01   -6.166613826370295e-02   +2.001728256825029e-01   +5.684435281893805e-02; -1.070735111540480e-01   +5.151105479641497e-02   +2.731428778263232e-01   +1.532661643069894e-01   +4.518948338468891e-02   -1.335385575257543e-01   -9.399459501987717e-02   -1.309728347268216e-01];
L2I_L3I_iGABA_netcon = [-2.342299458328187e-01   -1.069755218477255e-01   +3.639309879104397e-01   -1.340856834840363e-01   -6.392849777747588e-02   +2.136461701922190e-01   -6.890057956762369e-02   -2.190169860000132e-01; -1.039132723751057e-02   +3.719674271680741e-02   -1.769663131810691e-01   +2.709105212199940e-01   -1.837558876077459e-01   +2.441812345019537e-02   -2.097139409043107e-02   -3.316659281361846e-01; +6.675313887840302e-02   +1.602757227266376e-01   +2.204032452224887e-01   -2.267491202703469e-01   -9.791665989572640e-02   -3.918185977356527e-02   +3.336498534008103e-01   +3.109789006954864e-01; +1.849251278881942e-01   +1.319686693206763e-01   -5.366318587899130e-02   +2.829182913184534e-01   +1.009220073204659e-01   +1.393499091878632e-01   +1.527664316716163e-01   +1.548048229077075e-01; +1.371944496906189e-01   -3.043304858074715e-02   -9.867229914133299e-02   +1.473379371276742e-01   +3.224414668766956e-01   -7.055350570803248e-02   +1.592630543037500e-01   +1.184539434519789e-01; +4.080483511054193e-02   -6.314500128487585e-02   -6.246847888696443e-02   +4.212190534617211e-02   -4.881375792479831e-02   -2.311139204576125e-01   +2.511679813714484e-02   -1.304735240084293e-02; +1.084712699008082e-01   +5.110002797261948e-02   +1.326830321291176e-01   -1.221508671586703e-01   +2.415849890128142e-01   +2.901332241703403e-01   +1.610031373857945e-01   +2.629289188484048e-02; -8.389369381628781e-02   -3.112812540169321e-02   +1.321576600571133e-01   -8.672724525637389e-02   +3.708034479053121e-01   -2.028372303753538e-01   -3.587876942151307e-02   +3.981783090984471e-02; -1.573238921122480e-01   +2.042846191648958e-02   +5.328776258331398e-02   +6.365027262766360e-02   -7.745239819355493e-03   +1.729036671622569e-01   +1.302818715107278e-01   +2.032891844067973e-01; +1.724016539247348e-01   +3.477348677120447e-01   -1.275409946778137e-01   -1.851562924986382e-01   -2.051249412920721e-01   +1.880448514309003e-01   -1.166258040964198e-01   -5.898185573550628e-02; -4.025965787851146e-02   -5.546014475501307e-04   +3.890446441033542e-01   -6.410834910369623e-02   -2.654207277402530e-03   +3.209830659811229e-02   -1.798177777292054e-01   +1.495304406695218e-01; +1.724323750561330e-02   +2.210423627164935e-01   -6.391977282762099e-02   +1.448119315855783e-01   -2.078559165368155e-01   +6.586838749696503e-02   -2.870519283187322e-01   +5.395216820173400e-02];
L3I_L3E_iAMPA_netcon = [+2.659980161494135e-01   +1.054064736888004e-01   -2.100289794894468e-02   +1.546437744828695e-01   +1.413376065741116e-01   -6.080426017463898e-02   +5.521489654635978e-02   +1.849932399461895e-01   +5.595526424191349e-02   -3.288172683865219e-01   +9.543751244567623e-02   -2.202993080814629e-02; -1.289119569818258e-01   +1.197140673282795e-02   -2.996682139023047e-02   -2.541438287195278e-02   +1.927386552604887e-01   +8.035793714177404e-02   +9.859612156545330e-02   -2.358559535628501e-01   +3.855453318019267e-01   -2.677041888004347e-01   -3.061667773252609e-01   -1.162573336255876e-01; -4.284794456373354e-02   +3.316805178110630e-01   +1.397442439875763e-01   -1.736251697982266e-01   +3.380419795767635e-02   +1.640025582310435e-01   -2.158555585456169e-03   +1.931203023620804e-01   +2.273395536933324e-01   -8.454079486577726e-02   -2.264036476725993e-01   -3.041942764112285e-01; +6.563170682782749e-02   +1.470736291692729e-03   +2.834127295076894e-01   +2.031799416226045e-01   +4.886478291789034e-02   -2.450204164968296e-01   +2.319821068690825e-01   +9.702766979013400e-04   +3.908725746907510e-01   +9.204211310048650e-02   +2.053805123920019e-01   +6.823202289964966e-02; +5.767645914441240e-02   -3.299532875536486e-01   -3.797024854538794e-02   +1.218242328679624e-01   -1.812022113545151e-01   -1.342329731942725e-01   +2.651690619377223e-02   +2.576947211113654e-01   +6.554820551214274e-02   -2.242507262509890e-02   +2.909482845398519e-01   -3.740379489906065e-02; +2.368015153994968e-01   +1.727724654139843e-01   -2.311810109441210e-01   +3.300031404742892e-01   +2.913763620979358e-03   -4.067223397132309e-01   -1.833207140060772e-01   -1.805926889232091e-01   -6.388716104273619e-02   +2.247411640307365e-01   -1.364046049230068e-01   -2.422502866828691e-01; -1.452086261016968e-01   -1.356349902308935e-01   -9.355251797001926e-02   -2.471308839022231e-01   +1.674377503027618e-01   +5.554147381975167e-02   +1.960038072546803e-01   +7.609198972662498e-02   -3.111105608362577e-01   +2.496073990555763e-01   +2.856516715823247e-01   +4.053298117631679e-03; +1.335665588666982e-01   -3.329473977811112e-02   -4.797116340575427e-02   +8.025063910039335e-02   +2.694795041356433e-01   +5.930554190733572e-02   -1.019852387022003e-01   +4.026341061524906e-02   +8.649689105252159e-02   +2.349341549846474e-01   +9.086449068113442e-02   +5.776432899281077e-02; +1.970920784227049e-01   +4.684833533339394e-02   +1.140045466391466e-01   +1.114517999698153e-01   -1.289259172010001e-01   -5.583805715705714e-02   -5.533300340989113e-02   +1.654209786105960e-01   -2.553271511981917e-01   -2.834598079471102e-01   +3.095699320853254e-02   -5.055449989739398e-03; +1.553014042931472e-02   -5.398242031252122e-02   -9.204927933477765e-02   +9.481852493489784e-02   -3.190811240891125e-01   -1.651442409500981e-02   -1.504217133448778e-01   +3.530948479568522e-01   +5.230614627783128e-02   -2.456473490898732e-01   +2.344087967992960e-01   -3.432850354560975e-02; -1.529724154283181e-01   +1.309589275399003e-01   +6.324364191305502e-02   -7.388258627114944e-02   +2.392258740776319e-01   -2.136702178458340e-01   +1.138548432353279e-02   -3.092068671486682e-02   -1.836775237176963e-01   +9.578355212262120e-02   -2.853726363311582e-02   +2.659093557343209e-01; -8.231364811451625e-02   -7.513633546517631e-02   +1.977416128129022e-01   +3.339640994862488e-01   -7.213467318945180e-02   +1.653402508882876e-01   -2.191973133268471e-01   -2.075783630420759e-01   +3.576194079877339e-02   +1.771493565665932e-01   -8.038852135937087e-02   +3.970854349583844e-02];
L3E_L3I_iGABA_netcon = [-1.414224267574206e-01   -7.574643315684819e-02   +1.932398265388932e-01   +3.651565855653366e-01   +2.149618998384862e-01   -2.409468922519597e-01   -3.073106441678354e-02   +1.839509066003118e-01   +2.991865850811630e-01   +1.615344527166963e-01   -2.266715960333638e-02   -1.952397469444270e-01; +1.432107560718121e-01   +7.932558886722821e-02   +4.490518002727008e-02   +1.611610863619624e-01   +1.569080168553634e-01   -1.424057293365868e-01   -3.729630915059770e-02   +4.722661045978887e-02   -1.025921638709930e-01   -3.188427987776377e-01   -3.127550244949411e-01   +1.789882009363080e-01; -6.917829274166212e-02   +2.161809455183621e-02   +1.718931857164511e-01   -3.948296819115914e-02   -6.283533038718445e-02   +4.805062610485019e-02   +1.352258509535489e-01   +6.920327353895979e-03   +4.232348722980932e-01   +8.481119870949824e-02   -7.828967951558892e-02   +6.989488186511553e-02; +6.245164619254912e-02   -1.291830233653195e-01   -1.537648184782920e-02   +2.661803142912119e-01   +1.527446861476851e-01   -6.088142904095567e-03   +4.718624543114477e-02   -2.379073712066188e-01   +1.191733877378287e-02   -1.374692010492884e-01   +1.870428306676242e-01   +1.176022391131851e-01; +7.470850233964221e-02   +1.357445072937949e-01   +7.346034909634615e-02   -2.135469108464769e-01   -1.363127981645467e-01   -2.104760006774967e-02   +4.866267000585737e-02   -3.039287966855719e-01   -3.108652487166583e-01   +6.608190396161334e-02   +2.380286697899540e-01   -1.345872992881635e-01; +1.584252526751300e-01   -7.032066111301531e-02   +7.238394909503729e-02   +1.577307568233268e-01   +3.571391256678749e-02   -7.054519587027869e-02   +2.862418543146904e-01   +1.632031970569570e-01   -9.949239054802168e-04   -1.311870392969945e-01   +7.757161310093430e-02   +5.472024978038596e-02; -2.094460722604991e-02   -3.498682449095167e-01   +3.760669032059476e-01   +3.508142985314683e-02   +3.993992669520490e-02   +9.174855209200292e-02   -8.671758886187210e-02   +1.933285449745322e-02   +1.963424778124031e-01   +3.327486651973822e-01   +1.010291580321520e-02   -5.170109310648874e-02; -1.478566409229893e-01   -7.993093097459150e-02   -2.741091099206686e-01   +2.217458038737871e-01   -4.946301062166025e-01   -4.740751641077709e-02   +6.254063154842765e-02   +1.097559798645610e-01   -4.211828085926235e-02   -2.569007331922769e-02   -2.812922048618943e-01   +3.329662797069053e-02; -4.642514222082672e-04   +3.095666624017697e-01   -2.384149951624086e-02   +1.461023119558450e-01   +3.230227697320149e-01   -8.380974489774861e-03   -1.049618831654155e-01   +3.620453336478209e-01   -4.226157030433429e-02   -1.375617063401967e-01   -1.206469911925697e-01   -3.770964401153631e-02; -2.245951819475455e-01   -2.189306132267262e-01   +6.685039292203744e-03   -1.738164553651930e-01   -4.610556336340561e-02   -4.186059519166236e-02   +5.380186180112818e-02   +2.935054616865206e-01   -2.300652009183257e-01   -1.242583654060731e-01   +9.470199668200985e-02   +2.221458780694897e-01; +1.650340308491337e-01   -2.134157907929846e-02   +4.222022795159305e-03   -2.921214938389829e-04   -4.998172219478650e-02   +9.441528396889488e-02   -1.398193838013523e-01   -2.183509443244934e-01   -1.574355325204670e-01   -2.779011335648695e-01   -1.817227844339656e-01   +1.204915041203720e-01; -3.525328500766317e-01   -1.709516205967636e-01   -2.228441054635599e-01   +1.022701791294707e-01   +2.816928080156709e-01   -1.319125154960826e-01   +9.745307747672211e-02   -2.265625025448915e-01   +3.208308506892408e-02   +8.203933159550400e-02   -1.155812214454305e-01   -2.748171102703817e-01];
L2E_Input1_iAMPA_netcon = [-3.420920515799829e-02   -1.863590039358703e-01   -5.139186484408848e-02   +1.090292686302716e-02   -1.401173013688302e-01   -1.176130143639913e-01   +8.165857838244109e-02   -3.514376848809787e-01];
L2I_Input2_iAMPA_netcon = [+3.028756392763233e-02   +4.790113406299127e-02   +1.900753910379053e-01   +5.781305263755047e-02   +2.468605251686038e-02   -1.021771944814677e-01   -2.572676642136623e-01   -5.120966651304280e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
