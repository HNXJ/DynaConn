function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.778728530261430e-01   +1.830750867838615e-02   +2.586601310889236e-01   -2.896485487550969e-01   +2.531059136641920e-01   -2.379645741635751e-01   -4.356073241719619e-01   -3.934116834093995e-02   -6.799091096055537e-02   -1.452963197159718e-01   -2.027056243210359e-01   -3.584160099564148e-01   +7.855361856646123e-02   +6.008073992362798e-02   +4.414374237998137e-01   -4.764017293503442e-01; +5.562583838828890e-01   +3.023101453738211e-01   +3.793772030979748e-01   +2.579571718207798e-01   -1.863145983846026e-01   +4.269514488088110e-01   -4.476599077634667e-02   +5.788708353716843e-01   +4.734018393073418e-01   -2.253195830345305e-01   +2.736867995350560e-01   +5.524783809966980e-01   +2.180220090759874e-01   +8.800501027887546e-02   -2.100436047654930e-01   -2.461009046750787e-01; +4.067173019525643e-01   +5.244053920892930e-01   +1.560138521823279e-01   +6.756438036703752e-02   -5.414485658864018e-02   +2.060837350776465e-01   -1.375900736801867e-01   +4.090517616574081e-01   +1.210425108029518e-01   +3.762539345821868e-01   +4.003567643298982e-01   -2.967224971457224e-02   +1.856461018413559e-02   -6.515404655424648e-02   +1.313021290455997e-01   -2.971400067846027e-01; -1.414190320489275e-02   +3.998004622731113e-02   -4.376818712076547e-02   -6.366773261652521e-01   -8.423653973423197e-01   -2.811933084752511e-01   -8.081766429815740e-01   -1.478801955140255e-01   +3.289111323400429e-01   +9.237351226950179e-02   -3.954489868044991e-01   -9.913643572760011e-02   +2.946261616661528e-01   +4.501111671069589e-01   +1.484020903535535e-01   -6.037248809648909e-02; +3.745533663378435e-01   -1.191351496532622e-01   -2.147678143561232e-01   -5.241678048936182e-02   -5.290868944430138e-02   +2.261807191985157e-01   +5.599628015545474e-01   -6.793165518025740e-02   +2.989479344913999e-01   -4.584289677001702e-01   -2.614324685418939e-01   +8.531628997849267e-02   -7.881341473497770e-02   +3.349849615861165e-01   +6.182009639941771e-01   -1.712529277623405e-02; -1.706773256957650e-01   +2.184024559178967e-01   +4.322783368184757e-01   -2.631304902440676e-01   +2.955667423741322e-01   +2.872453851478493e-01   +1.350945490419266e-01   -7.171948983295176e-02   -5.683369542245952e-01   -5.061103306682014e-01   -1.413780071160051e-01   +7.171800191300508e-02   +1.241142041595954e-01   +2.502259130978995e-02   +3.183285635660332e-01   +2.660002814012660e-01; -4.706723980950466e-01   -1.110535566607961e-01   -7.560495671778106e-02   +3.473513785681560e-01   +1.520871384154464e-01   -5.808881513667282e-02   +3.014570636041071e-02   +7.670509055696714e-01   +2.865676444306060e-01   -2.484985981359884e-02   +1.577408267201632e-01   -7.205953798896432e-01   -2.144898430758522e-01   -2.174205146113221e-01   +3.759002477337904e-01   +7.129695869550348e-02; -9.623344617151025e-02   +9.385498545934072e-02   +4.916505265078728e-01   +5.439775959905386e-01   -4.087794969905923e-01   -4.557693498449416e-01   -1.318526978350773e-01   -7.650220720992661e-02   -3.021321440928151e-01   +4.837018277001544e-02   -1.854615792845743e-01   -7.448205550403897e-02   +5.372165728319865e-01   +3.638728551865343e-01   -4.316357670948396e-01   -2.224977413433580e-01; +1.383055978754362e-01   -1.269805318109185e-01   +3.015612202268879e-01   -4.334239988566184e-02   -5.234629554315942e-01   +3.876496069143087e-02   +1.816260238052909e-01   -6.514620518723727e-01   +2.223532728662595e-01   +2.020018553290438e-01   -3.494617501057374e-01   +1.568345197653984e-01   -3.446375121398180e-01   +2.762182735848277e-01   +3.500299236991521e-01   -2.007344200812526e-01; -5.787652632990786e-02   +5.019273964143520e-01   +4.448193346652268e-02   +2.091221423379048e-02   +3.572289284835207e-01   -6.256891406532840e-02   +8.825224601188723e-02   +4.191636211355355e-01   -3.154121311742274e-01   +4.738890188571172e-01   +2.281675116745622e-01   +6.436438359697549e-01   -1.577874659812292e-01   -4.088792305956321e-01   -8.936026278200827e-02   +4.985055492173298e-01; +6.066923560242085e-01   +2.302645802986576e-01   +3.729486620396497e-01   +3.375080557181312e-01   +4.008406852676417e-01   +9.781559052095151e-02   +8.983222925071019e-03   +3.744811868537450e-01   -4.678866076747108e-01   +7.041269900925420e-02   -5.655481330564598e-01   +5.154256171450425e-01   +5.989972568401346e-01   +1.092845754004947e-01   -4.266274570042177e-01   -2.953341281168507e-01; +6.848690513812289e-02   +6.055708263907734e-01   +1.130732358327488e-01   -1.237746402798296e-01   +3.929483662418417e-01   -1.249318105240186e-01   -4.029971834082644e-01   -6.417731506696742e-02   +7.145273836573590e-01   -1.407260800669304e-01   -3.875876353750067e-01   +3.186271152275361e-02   +3.301546303209723e-01   -2.647961114897948e-02   +6.128933981434285e-02   +2.342474613458490e-01; -6.275637704761558e-02   +6.236611858834634e-01   +4.721839746175610e-02   -5.103220357109520e-02   +3.921018615857333e-01   +1.984489216216467e-01   +3.941886385955026e-01   -4.990969856090640e-01   +2.745870868490308e-01   -3.457709773718415e-01   -1.002551179262599e-01   +1.534398546663481e-01   +4.209999287464918e-01   -1.230492323693831e-01   -5.374747470917591e-01   +1.873203997470830e-01; +8.781729447048908e-02   -3.306743927897198e-01   +4.659238161862621e-01   +9.855622714107516e-02   -8.057784167472112e-02   +6.062243575131121e-01   -5.957901935921162e-01   -6.301770781537641e-01   -3.026921890397231e-01   +6.069398307666460e-01   -3.495947601933584e-02   +2.308338006956915e-01   -2.437184176660239e-01   -3.616282969358080e-01   -5.654379365104275e-01   +3.516847383804269e-01; +1.790811524764148e-01   -1.183338020988199e-01   -7.444528702665172e-01   +3.595985430193297e-01   -1.812785836465787e-01   -2.635160755708401e-01   -2.058141976792529e-01   -3.074864929410915e-01   +3.244766191055885e-01   +2.547395489199479e-01   -1.024723042742023e-01   -4.263833865389385e-01   +6.007612519156039e-02   -6.532353519185873e-01   +2.647691151332296e-02   +2.633411962765111e-01; -2.017047776303002e-02   -5.596198577660646e-01   -6.977605425421152e-02   +7.661683399533149e-01   +2.703590341357412e-01   -2.054937504032931e-01   +1.025684268383162e-01   +1.787631826488298e-02   -6.619122436872588e-01   +8.508888510078254e-02   -8.986533776165846e-02   +5.165467497291861e-01   -3.205234320113894e-01   -5.420051377970012e-01   +2.140949662120731e-01   -2.525406674506564e-02];
L1E_L1I_iGABA_netcon = [+2.296371056430846e-01   -2.461085848872935e-02   +8.979990594797195e-02   -5.202704053268664e-02   +7.118118201500027e-02   +1.502648377424835e-01   -5.453936414672552e-01   +3.751178600098057e-01   -3.522129452982219e-01   +1.088975117373620e-01   -9.929149653860776e-02   +5.707575201111248e-01   +2.208360289545275e-01   -1.951890865464048e-02   -1.867671507926771e-01   -4.262139137634760e-01; -3.679532967645200e-01   +5.638571952415859e-02   +1.055468230921653e-01   +5.663639983240867e-01   -7.451567834301701e-01   -5.889436732433271e-01   +4.359738130092934e-01   -2.826638252330717e-01   +4.698126257597178e-01   +2.493517076284343e-02   -5.269582228058649e-01   +3.806879504324377e-01   +2.913988308852261e-01   +7.849027739300773e-01   -1.979162996293742e-01   +2.973130728169169e-01; +4.858275132637426e-01   -2.066511639965805e-01   +1.123750310988651e-01   +4.129744017436768e-02   -1.121334850679104e-02   -3.794939263918100e-01   +1.360928963849845e-02   -3.636518520688760e-01   -9.050033291391196e-02   -1.703927049796745e-01   +2.761314178503698e-01   -6.791309548161357e-01   -2.707062676403876e-02   -2.872154583535121e-01   -2.067067501093114e-01   -2.468134665699994e-01; +5.799025011038146e-01   -1.123967066433975e-01   +1.682056845947707e-01   -5.233737668332793e-02   +2.361412926076223e-01   -7.122489715857028e-01   -4.699189030929273e-01   +1.598683532544221e-02   -2.687908426248739e-01   -4.501975240910409e-01   -3.722902705621369e-01   -5.880324340564741e-01   +2.002039978269239e-01   -4.973939484647472e-01   -3.633951862495564e-01   -6.174290090756561e-01; -3.344460436399928e-01   +1.118869818090687e-01   -3.730344136111319e-01   +1.011803899601212e-01   -3.712715714701503e-01   -5.079820984307565e-01   -2.655397616373092e-02   -3.626773744439595e-02   +1.262677947027706e-01   +4.680902270357071e-02   -7.830950707462656e-02   +5.035014491916913e-02   +8.926169942498119e-03   -3.338858657519818e-02   +2.246034124717258e-01   -5.594336482729214e-01; -5.397127712875440e-01   +1.093957261416237e-01   +1.532880015309283e-01   +2.056022094257963e-01   -4.010372989756490e-01   -1.408204700016091e-01   +2.434670202898829e-01   +7.641391321889818e-03   -2.719085956768650e-01   -1.199760384563530e-01   +2.793768703569340e-01   -3.765979172534631e-01   +4.047751347922583e-02   -1.117063358542095e-01   +2.250798477048768e-01   -1.780854887429000e-01; +3.914563377267460e-01   +4.817323905338506e-01   -2.223592132254894e-02   -1.626599251409866e-01   +2.002116478631019e-01   -3.731052090970975e-01   +5.231059966718390e-01   -2.213817258158753e-01   -4.137118333703053e-01   +2.346186234866743e-02   -4.873313805046428e-01   +2.822169805743405e-01   +1.101233931456270e-01   +2.081159568946542e-01   +6.254955083278796e-01   -1.030243277199527e-01; -1.572805290419216e-01   -3.255585147913358e-01   -5.755095262350034e-02   -2.424495574823534e-01   +2.924559213948776e-01   -9.064539444456157e-02   +2.432917018340350e-01   -6.082027229130036e-01   +6.539804371724697e-01   +5.960175122796504e-02   +4.568920272592523e-01   +2.211528936488100e-01   +2.604693982934600e-02   -5.080686270436144e-01   -2.347582059965955e-01   +1.794091448352429e-01; -2.164542205830392e-01   -5.980216988345426e-01   -1.793579170590676e-01   +1.697146007927065e-01   -3.923306831060869e-01   -1.391034405736247e-01   -2.875510977738390e-01   +3.356539473843397e-01   +3.534443784936684e-01   +1.268805911340293e-01   +1.606012486492103e-02   +2.844088112841509e-01   +1.853627781973291e-01   -2.027966952848903e-01   -3.611424215875598e-01   -2.326104324252770e-02; -6.780405085485091e-01   -6.068964667525033e-01   -1.582168980948378e-01   +2.031421150377012e-01   -8.470944901533733e-02   -4.112808601075933e-01   +2.259675186754365e-02   +1.844770055234332e-01   -6.378472192871146e-01   +1.195437071408325e-01   +6.678759643091663e-01   +6.486103242169611e-02   +2.611230221108056e-01   -4.336169510515897e-01   -5.441001954598257e-01   +2.923186724296912e-01; -4.117963651759987e-01   +4.356471904115179e-01   +1.139167829325939e-01   +4.904222829291852e-02   -2.408220693626925e-02   -5.242477126520286e-01   -5.515582917794993e-01   +1.489106247223231e-01   +1.050382547005900e-01   -5.673516596954811e-01   -1.253167928228787e-01   -5.495010457629290e-03   +2.854538326023468e-01   +4.762612984245512e-01   +1.698164011308694e-01   -2.969674237171768e-01; +4.812127251667674e-01   -5.787403002261829e-01   -2.488392455890845e-01   +2.212042890752234e-01   -3.181040420392241e-02   -4.292348436918445e-01   -4.443019682092821e-02   -4.638453730174097e-01   +7.206768930296946e-02   -5.282179095851652e-01   +1.095921820374151e-01   -2.139946666703696e-01   +2.332860032944322e-01   +2.857991610573066e-01   -5.047462601000870e-02   -4.829620640172368e-01; -5.250567952158840e-01   +3.050037255002952e-01   -3.317921721824104e-01   -3.854641230698457e-01   +6.132034711752166e-02   -1.682425154965665e-01   +5.622471969679450e-02   +3.684213023838375e-01   -1.392085681660014e-02   -2.169338396378374e-02   -1.549057039429813e-01   -3.719124754167286e-01   -1.739372126436785e-01   -8.166651368187320e-01   -7.286112679541965e-01   -1.358869565496240e-01; -3.759407346095703e-02   -4.792604305136543e-02   +4.099382390289971e-02   +5.589612686011616e-01   -4.680567191752004e-01   -4.933410067085237e-01   -2.696216176217093e-01   +1.850924760359982e-01   -1.745131650165244e-01   +3.226349923025126e-01   -4.202250356105925e-01   +3.152948743540992e-01   -1.435271107038437e-01   -3.953103601498641e-01   +6.977531629186945e-01   -1.306741793452488e-01; +1.640646679201022e-02   -4.843608416696918e-02   +1.311288545257470e-01   +2.888178191517041e-02   -1.502600568758669e-02   -4.921229119396558e-01   +6.031122696101406e-01   +3.813645327950100e-01   -4.890683741627555e-01   +3.072778897142207e-02   -2.707887102892455e-01   +4.188503760589705e-01   +2.514512935226291e-01   -5.662440471653915e-01   +6.914562916012968e-01   +1.354787391396185e-01; +7.404705581982133e-01   +2.209220827119946e-01   +5.057221703418050e-01   +5.074357633452379e-01   +1.376428477394698e-01   +4.778825871820347e-01   +1.543105943473113e-01   +2.344066185021710e-02   -2.121097850833198e-01   -1.246975794867516e-01   -3.478674349431028e-01   +7.794586846534576e-02   +6.745828014202400e-01   +2.476369803029071e-01   +3.544169513626709e-01   -6.987190763136425e-02];
L2I_L1I_iGABA_netcon = [-5.495358214207762e-01   -2.326825016548418e-01   +2.394543601900681e-01   +1.339431485445102e-01   -3.862457604860874e-01   -1.289235487262974e-01   -3.552107351820344e-02   +3.335283774337414e-01; +9.135813422342670e-02   -6.987796068068622e-02   -4.438785902091743e-01   +9.447009551843161e-03   -5.556717536421518e-01   +1.470235550405297e-02   -1.735779384902553e-02   +2.941479928110455e-02; +4.988066646666515e-01   -4.251876948499862e-01   -4.090291086334206e-01   +4.266343184376369e-01   -4.426266489943681e-01   -6.757496878327930e-02   +2.781465133786743e-01   +4.043239110134511e-01; +2.689186472880853e-01   -4.606787087456843e-01   +2.752012112727739e-01   -1.137187219540167e-01   +1.237436834389883e-01   +5.383325773557543e-01   +2.113633850365780e-01   -6.450411483588886e-01; +2.742948748791524e-02   +1.604353354675887e-01   -2.707054491582202e-01   +4.719094443236347e-01   +5.912779689608594e-02   +2.289694380506749e-02   +2.639232539129534e-02   -9.277557405459920e-02; +7.356182950547790e-02   -3.207723672762964e-01   -2.121001919204929e-01   +1.776876907353195e-01   +7.422293528718600e-01   -7.181215813291200e-02   +5.982912635185481e-01   -2.345468443162735e-01; +5.569990996820912e-02   +9.722315871192241e-02   +4.167757009840644e-01   +5.315740692298008e-01   +2.849187598561935e-01   -2.330718069474857e-01   +1.345979643974240e-01   -3.817782783721183e-02; -5.694854854089412e-01   -2.183530850294477e-01   -1.296495670401179e-02   +7.272172168825448e-01   +5.118464934658156e-01   +7.533149974172701e-02   -1.780814697216583e-01   -2.371499760211828e-01; -6.489132490635233e-02   +4.668975623634911e-01   +1.038560138618192e-01   +3.059244047528564e-02   -3.282193090956295e-01   +3.170468678822291e-01   +3.918754921362044e-01   +2.834518027464597e-01; +7.555815050285744e-02   +3.668263310015010e-01   -3.684869767716015e-02   +1.984381026168834e-01   +3.606450398215519e-02   -3.518184827742828e-01   -2.042367610210785e-01   -4.406353734996783e-01; -1.632253166157892e-01   -5.120292046419761e-02   +2.571563764654914e-01   -9.671447403922608e-02   +8.751923099613095e-01   -3.767530745280275e-01   +5.007151199607429e-03   +1.775266310020611e-01; -9.994448537455917e-02   -1.370614431326105e-01   +6.176579449482657e-02   +1.720489043716307e-01   -3.232418956757603e-01   +1.515000374953414e-01   -2.294458131428407e-01   +4.892993706717889e-01; -2.161770915540746e-01   +3.730610896862136e-01   -5.834683007343002e-01   -2.515480798196216e-01   -7.524728518209606e-02   +2.243376005341839e-01   -6.761715543072142e-01   -3.592068679793577e-01; +1.742855490897824e-01   -5.602604836745873e-02   +2.085539768324710e-01   -7.617466429597891e-02   -1.774567322863993e-01   -3.053332388317196e-01   +5.641493226421040e-01   -3.867725476721934e-01; -4.442286457010401e-01   -7.233742938589560e-01   -3.906540155351107e-01   -2.621706579862368e-01   -5.144362513334944e-01   +1.636001116873899e-01   +3.805890483395796e-02   +2.683064259268163e-01; +2.619274152543695e-01   -1.898193093042547e-01   +3.991600277830594e-01   +5.552433432156122e-01   -2.503259923604585e-01   -4.342101133825846e-01   -9.454175122514652e-02   -5.134542395381718e-01];
L1I_L2I_iGABA_netcon = [+3.767990345521560e-01   +3.317536835214471e-02   +4.820037685802531e-01   -1.676229074257205e-01   -1.549594133473461e-01   +5.182110117915924e-02   -2.172313125347247e-01   +7.021046123320954e-01   -3.028666451046408e-01   +9.005812105766714e-01   +2.344128926359984e-01   +4.713898646892908e-01   +1.103922975728956e-01   +7.492584514415503e-01   +2.636429137090798e-02   +5.073278367793633e-01; -2.880335494935359e-01   -4.155394281988492e-01   -9.548036494841416e-02   -4.687986573473470e-01   +3.124602608248013e-01   +9.398065751635645e-02   +4.283833946126561e-01   +5.986034595650308e-03   -1.179103231224227e-01   -2.584844528744679e-01   +1.234026018125302e-01   +1.564840688848495e-01   +9.496016216116396e-02   +2.576074241356062e-01   -2.512776264232717e-01   -8.764665570006301e-01; +2.375200879531591e-01   -1.197763331070949e-01   +3.063695571156935e-01   +2.107197414434540e-01   -1.734614189957433e-02   -4.191445368005599e-01   +4.417663146506190e-02   -1.338282699602117e-01   -3.335081701857728e-01   -1.295186673722823e-01   +4.672845891377027e-01   +9.429473796136947e-02   -5.433770202322346e-01   -1.516287622323350e-01   -1.951878659243604e-01   +7.908052115074310e-02; -5.194321475569088e-01   +6.561825412646783e-01   -3.463660363746879e-01   +1.333126005069901e-01   +6.718050537690707e-01   +1.131714786713047e-01   -2.934608661280127e-01   +2.034498389940421e-01   -2.471268985832169e-01   +1.749750244248630e-02   -2.959100435324462e-01   -3.252230440083164e-01   -1.005558037482654e-01   -1.336920718530156e-01   +5.598822919537101e-01   -2.842641946264929e-01; +2.090873200744660e-01   -7.622529538777786e-02   -1.795710857521375e-01   +2.772323428800821e-01   -2.395196712770880e-01   +3.916219360628886e-01   -7.668009257542016e-01   -1.955291687425541e-01   +8.807576454865318e-02   +4.782352597974950e-01   +2.590516962904141e-01   -3.600551970228857e-01   -4.588415895877016e-02   -9.576256925889093e-02   +5.615903990417202e-02   -1.188767989627478e-01; +5.345769125690680e-03   +2.691983104542741e-01   -3.777836265814818e-01   -4.434254549693661e-01   +3.912908175874480e-01   +2.721656778444875e-01   +4.662485848626473e-01   -6.198930997773729e-02   -8.835419158258373e-02   -1.584867491047848e-01   +2.965457196100284e-01   -3.576473112843545e-02   +2.145412550667314e-01   -1.308533847008817e-01   -9.480355335822255e-03   +2.862242864409362e-01; +4.969161132451251e-01   +5.889370942751166e-01   +3.763376237542777e-01   +2.806291261732049e-01   +6.274201555948256e-02   +1.957524923966368e-01   -1.576553375236955e-01   -3.607636652314125e-01   -4.961978805055951e-01   +5.667277127097871e-01   +2.098084355729522e-01   +2.966373559275564e-01   +5.314326150531536e-01   +9.223121687559308e-02   +2.297886208434240e-02   +3.598286883902088e-01; +4.803753458386050e-01   -7.297238615081887e-01   -1.535618786612385e-01   -2.498450134561270e-01   -3.029469721909269e-01   +4.361908934832183e-01   +7.074636773606979e-03   +2.593801511933700e-01   +4.208447261019538e-02   -1.393324693110259e-01   +7.228852100787006e-02   -1.024634732738496e-01   -3.587568580529778e-01   +3.288657985100507e-01   -1.142982712727565e-01   +5.019109943935127e-01];
L2E_L1E_iAMPA_netcon = [+6.155212396173908e-01   +5.819637152283260e-01   +2.494948792050130e-01   +3.355894895125253e-01   -4.788494153662891e-01   +3.640786535329037e-01   +2.949078547291760e-01   +2.328068325595340e-01; -7.029807597205695e-02   +1.221834226750400e-01   +1.139181569962138e-01   -2.768281302513528e-01   -2.817236251823053e-01   +1.807689181264698e-01   -3.329187467332701e-01   -1.628215918562218e-01; +2.820409280233996e-01   -5.753778702650357e-01   +4.731158628718826e-01   +3.202054367359006e-01   -1.682426253181138e-01   +1.950277115754576e-01   -4.436629822285968e-01   +2.800678613142746e-01; -1.541633783617084e-01   -1.135464155464100e-01   -1.694078426471796e-01   +1.061725204374692e-01   -1.271073354551172e-01   +2.211027805041445e-01   +1.540367428865397e-01   -5.417055107241703e-01; -1.555334074243236e-01   +8.822342986366452e-02   -5.254601140637479e-01   -4.696559280190958e-01   +1.334554964925752e-01   -4.584383202380840e-02   -1.757032858051251e-01   -1.147248414267817e-01; +1.827526326356601e-01   -1.745304855718949e-01   +4.462802611633990e-02   -2.332541866458222e-01   -6.353268942791679e-01   +3.137350942819026e-02   +6.058840631412135e-02   +1.818367930996016e-01; -1.074403569861180e-01   -4.098560527320387e-01   +1.823391919630325e-01   +8.304517398508998e-02   -2.326181515067152e-01   -2.853393451012900e-01   +4.994423028924235e-01   -2.308330257920790e-01; +9.566102559201568e-02   -3.411806455918046e-01   -3.286132563692265e-02   -5.261425323845307e-01   +2.441437948512340e-01   -6.164523073059683e-01   -1.850180763733828e-01   -1.737830073466870e-01; +1.286161542801817e-01   +4.206738729177336e-01   +4.368900012450413e-01   -3.001682409488599e-01   +9.560664153045091e-02   +1.120141819144784e-01   +2.095121610995953e-01   -2.819564068677983e-01; -6.145802500407416e-02   +2.604115028033492e-01   +2.604919538986566e-01   +5.847045179353820e-01   +3.708254144744250e-02   +7.330596784815799e-01   +1.002772197270681e-01   +5.822757991728883e-01; -4.258377328357223e-01   +1.302643886462883e-01   -6.934966378339382e-01   -5.066640119028988e-01   -2.739812863430213e-01   +4.790519011926092e-01   -2.099812020986381e-01   -1.449465011775429e-01; +1.755199845491153e-01   -5.625129257788977e-02   +1.022437293566950e-01   -4.005514435943759e-01   -5.925893905290783e-01   -3.408534907762987e-01   +4.459949620900375e-02   -2.331296319462882e-01; +5.216104690184323e-01   +3.514419245911720e-01   -2.818624098214716e-01   -1.398721112119690e-01   -2.435910728024787e-01   -6.457520912649829e-01   -4.342039866048598e-01   +5.362999454460797e-01; -8.111484503972120e-02   +3.886870625462607e-01   -3.758174340568717e-01   +5.943957993869130e-02   -3.347352186029893e-01   -1.642619502381163e-01   -8.013702211986287e-02   -2.476159993339901e-01; -1.181049477251143e-01   -1.468840325191503e-01   +3.676227244494833e-01   -5.473367329051791e-02   -5.217209038950206e-02   -1.953674015208793e-01   +4.236212035484480e-01   +2.621734160633537e-02; +1.302926303779833e-01   -2.447618632881695e-01   -2.325533712588403e-01   +8.898718989038370e-01   +1.825093658942351e-01   -2.117092595297616e-01   +9.840596917063553e-01   -1.250891474535229e-01];
L1E_L2E_iAMPA_netcon = [+8.982878737714814e-02   +4.827286649058140e-01   +2.536358977752752e-01   -8.271558201349187e-02   +1.423894288911009e-01   -4.521909817377182e-01   +7.725252110938090e-01   +3.348576206465029e-01   +1.209833522891464e-01   +1.462029137567564e-02   -2.805563494239862e-01   -2.875512866938415e-01   -1.638144478092930e-01   +5.486499844009696e-02   +6.802352762347808e-02   +7.446848639416952e-02; -3.271929425948039e-01   -5.225319370917344e-01   -1.141905475159965e-01   +1.207140219543713e-01   +6.082627585482355e-01   +3.779624213793346e-02   +7.291718234924565e-01   +3.991540588346623e-01   -4.792630986332488e-01   +2.025630365211607e-01   +1.058204266624698e-01   -6.021784364588648e-01   -2.898265671183798e-02   -3.082342643706805e-02   +6.073956569454114e-01   -7.210144936099018e-01; -2.594505082328585e-01   -6.363899419407029e-01   +3.101057504057101e-01   -4.802543403616528e-02   -1.118905649589968e-01   -5.292670628897489e-02   +2.602453446180686e-01   +1.524108985358514e-01   -1.668756225313613e-01   -7.754276080526840e-02   +7.381182154690853e-01   +4.415248874123548e-01   +7.844665991946498e-02   -7.127436204678375e-02   +1.285782180404016e-01   +2.666612676955583e-01; +4.154302922350017e-01   +4.822811508922254e-01   +6.476658689749386e-01   -1.460755129261883e-01   +1.865961534474554e-01   +1.723889525624609e-01   -5.042057481631474e-01   -6.317723730851481e-01   -6.336374822193406e-01   -5.022728527437509e-01   +1.487488426029117e-01   -6.155951594382967e-03   -3.371091674519682e-01   -5.300247396818746e-01   -1.000000000000000e+00   -1.871694297058669e-01; -1.448368319917387e-01   +1.579209641225097e-01   +3.540476259688976e-01   -5.213648023028028e-01   -3.677438070130136e-01   -3.156611219274390e-01   -9.460157826009054e-02   +2.091618391436207e-01   +3.240403382050648e-02   -2.675764254047557e-01   -2.143844311061290e-01   -1.931012574813195e-01   -8.692380971717797e-02   +4.151238337353634e-03   +2.636827912963402e-01   -4.329683742065537e-01; +1.738344326412903e-01   -5.984112611169167e-01   -6.413556945861105e-01   -3.669732554964665e-01   -5.465662659512968e-01   +8.851560037037810e-01   -2.718352205795389e-01   +6.925573204429802e-02   -4.869328239998592e-01   -4.763174242964020e-01   -2.221035226128837e-01   -3.882498467831620e-01   -5.855849144095474e-02   -1.492771413117266e-01   +5.929336342649560e-01   +4.333761975367194e-01; -6.297624900072188e-01   -2.462961373178908e-02   +6.108023539385186e-02   -2.965856615085912e-01   -4.584551582673700e-02   -2.081212677322654e-01   +4.125519370666652e-01   -2.671855020341154e-01   -1.840774740317723e-01   +1.892456530012502e-01   -1.467784849299161e-01   +3.942869940070745e-01   +7.886504366853891e-02   +7.239803641407536e-02   -1.000774936691429e-01   -2.194282305743335e-01; -2.160997204431163e-01   -1.488495970702980e-01   -2.407072090217398e-01   -1.631746516716398e-01   +2.998383540828354e-01   +8.668883220106538e-01   +6.809328044011571e-01   +3.172656944533075e-01   +1.246473196055873e-01   +1.878544387938728e-01   -2.626780722043816e-01   -3.647432880702074e-01   -7.663110465141006e-01   +2.166764786868005e-01   +4.101616630019713e-01   -3.094884077840899e-01];
L2I_L2E_iAMPA_netcon = [-2.117301832710371e-01   +3.193769690484466e-01   +1.548552120689838e-01   -7.843961948052221e-02   -2.585927104876339e-01   -8.067678672862130e-02   +1.412430845935451e-01   +1.758539042252085e-01; +4.203029146900478e-01   -1.106118459512139e-01   -5.837571929369646e-01   -4.353415605346668e-01   -2.367425248341111e-01   +2.825967711697176e-02   +6.326309469667805e-01   +4.567256654514797e-01; -6.562026144089547e-01   -4.732081423756289e-01   -3.831571601869326e-01   -4.719959979441819e-02   +1.624554611260940e-01   -1.993849285284649e-01   +1.917769407168176e-01   +2.272600578620659e-01; +5.266003963798361e-02   +3.488529914324972e-01   +3.040706855913686e-01   -7.244699300823559e-01   +1.625254491612553e-01   -2.064249430782241e-01   -1.631775939014110e-01   +3.565900839038728e-01; +3.674142757271435e-01   -2.792200796072555e-01   -5.295044131522720e-01   -3.967632445386924e-01   +3.298327553998015e-01   +1.354492878794738e-01   -2.245568126165463e-01   -7.686763343416456e-02; -1.135083183002094e-01   +9.472783410375318e-01   -2.850522289095628e-01   +2.301712391877488e-01   -1.892489304563679e-01   -2.666254042511026e-01   +2.128079145357663e-01   +1.132154151868015e-01; +2.638483713278592e-01   +2.490039437474987e-01   +2.591307128436054e-01   +4.153504183221765e-01   +4.942374853814739e-01   +5.834868443537931e-01   -4.125118273338480e-01   +5.779696731473250e-02; -3.412050586327861e-02   -8.461953845295200e-02   +3.005428237651615e-01   +1.808595492048380e-01   -6.245971587350494e-01   +4.762330002349831e-02   +2.143031207952224e-01   +2.631214277371931e-01];
L2E_L2I_iGABA_netcon = [-5.151601341593159e-01   +3.005216053636190e-01   +6.188940398745185e-01   +1.459140938264177e-01   +6.462604916950525e-03   -5.090154086695116e-01   -6.232773425425481e-01   +2.065540123101362e-01; +4.295476462691898e-01   -3.442274853636321e-01   +8.380875045722696e-03   -3.931712893226857e-02   +6.330267229370604e-02   -3.401537714699523e-01   -2.814471869922911e-01   +3.801641654010783e-01; +1.828943855310582e-02   +1.567594433026026e-01   +2.186879641837136e-01   +1.028120101787083e-01   +6.038515194650501e-02   +3.720474338662718e-01   +2.292153676932336e-02   +3.776184349489236e-01; -3.780954683414705e-01   +5.345376032712916e-01   -2.103269937812560e-01   -5.431889031842825e-01   +2.313522184632794e-01   +2.306867841792033e-01   -5.519473570149800e-01   +3.411007071410184e-01; +5.226048517901507e-01   +6.126843828983140e-01   +1.687490014200578e-01   +2.709157244880812e-01   +4.392032705508038e-01   -3.558306573489459e-01   +4.650168692480219e-01   +4.626734667992604e-01; +1.105894194847463e-01   +1.761967971194609e-01   +6.990028546290599e-01   -1.703886295918268e-01   -4.241758159849067e-01   +2.385513296563669e-01   +5.494479294194955e-01   +5.094643326904008e-02; -4.341666775583370e-01   -1.374683589584683e-01   -7.212489966624853e-01   +8.914816440874791e-02   +1.439051982960854e-01   -3.169122917359578e-01   -4.479291185095886e-01   -1.000000000000000e+00; -4.648006816456687e-01   +4.040263143868471e-01   +6.134544161644692e-01   -4.489597323999917e-01   +1.214269318986248e-02   +6.004124689079823e-01   -4.137270460648876e-01   +1.680918304870735e-01];
L3E_L2E_iAMPA_netcon = [-1.724834500577601e-01   -5.222358416796917e-01   +3.543900040459460e-01   +2.077158296881396e-01   +3.202871784853395e-01   -5.767764500330048e-02   +7.044908179926229e-01   +5.029224614348673e-02   +9.625007958612339e-02   -1.925661665869456e-01   -1.860496002250457e-01   -1.390865622193287e-01; -3.992412887818800e-01   -2.995085290761926e-01   -3.960181568729046e-02   +1.735545710468206e-01   +2.066590818723749e-03   +1.147944689089396e-01   -2.101854254561518e-01   +2.994802634401241e-01   -4.243681871872211e-01   +8.051975732509299e-01   -2.957535729904192e-01   +2.205282947532779e-01; -2.447479842740627e-01   -6.837173632780319e-01   +3.034406576491863e-01   -1.806422106351350e-02   +6.092626558275511e-01   +4.054552266788504e-01   -4.801732056210767e-02   -3.853074241572350e-01   +5.561840553524741e-01   +1.418106084322208e-03   -1.708139450010784e-01   +3.992842639814284e-01; -4.455565519404557e-01   +1.606540546840646e-01   -3.132447687735285e-02   -1.860476206016232e-02   +1.455608783554458e-01   -7.679395958325300e-02   +4.204031950550670e-01   +2.462172909106584e-01   +7.482060273798838e-02   +2.782117022220558e-01   +3.799106878343287e-01   +1.391108605415158e-01; -2.732045718888015e-02   -1.891123636762699e-01   -3.370780676470631e-01   +2.073973984475896e-02   -2.161272695929987e-02   -3.192599640275799e-02   +5.858565021912891e-03   -5.945404351877667e-02   -3.429497516897229e-01   -4.533521930653625e-01   -1.913190860996760e-01   -1.709941009514751e-01; -9.585506393675108e-02   -1.210570777388042e-01   -3.067354761655316e-02   -6.694882869584631e-01   -2.139911370929651e-01   +1.405814053941460e-01   +1.269006389836389e-01   +2.738387100178959e-01   -2.372188073261723e-01   -2.303734257641765e-01   -1.353876820152806e-01   -1.399751563812462e-01; +5.847672067559934e-02   -1.806055008563484e-01   -3.851577652693633e-02   +2.825714917541094e-01   +4.788338853180718e-01   -1.688239672392898e-01   -5.955674350638112e-01   -2.309637648267329e-01   +7.914174138938940e-02   +2.433432463537523e-01   -6.066660919369751e-01   +7.460173856230747e-01; -2.033674761296195e-03   +8.382472667961296e-03   -2.476416149854890e-01   -3.374051302035747e-01   +2.752451730209934e-01   -7.036035184673897e-02   +1.763610418573782e-01   -2.320213674837686e-01   +2.149531615622934e-01   -2.140538371158096e-02   +1.618107426904597e-01   -4.780675068684179e-01];
L3I_L2I_iGABA_netcon = [+1.185620651436352e-01   -1.104083952601691e-01   +6.038437359210703e-01   -1.040800195311013e-01   -1.888881694385014e-01   +2.288176104068026e-01   -7.636806918223962e-01   -8.338569822368059e-01   -3.793434906279024e-01   -4.196503796038160e-01   -2.773181886149605e-01   +6.396583872494677e-01; -9.634222177982622e-02   +6.867919216501717e-01   +3.321017524962132e-01   +2.356258299150983e-01   -7.944364462244928e-02   -2.811384190791653e-01   +6.578512453180130e-02   +1.453174228641204e-01   +2.830929065743071e-01   +2.825099643786455e-01   -5.331344427452752e-01   -4.779498467387578e-01; -2.647434053509088e-01   -1.228079402221625e-01   -1.181324290919154e-01   +5.685215714523932e-01   +9.784851824480784e-02   +5.043446037564818e-01   +6.999341094971977e-01   -2.475586436575004e-01   +9.147779522318648e-02   +3.712992237367218e-01   +1.546600205344851e-01   -4.158044339169242e-01; +1.650152019699784e-01   -7.219224571979396e-02   -6.157101832331010e-01   -6.331195919285512e-02   +3.641424296272885e-01   -5.472215452877813e-01   +2.455933570850098e-01   -1.013968141679127e-01   -1.110147045211450e-01   -5.730933712216417e-01   +3.069523562127005e-01   -7.865697318062322e-02; +5.652683940821990e-01   -1.444352211020390e-01   -3.484278561850616e-01   +5.551925241431490e-01   -5.128879318317771e-01   +6.307562299907447e-01   -2.068717151359967e-02   +3.851293258512747e-01   -5.514769000515656e-01   +6.195820710206756e-02   +5.457085743631197e-02   -1.404081429799716e-01; +8.542921320399289e-01   -1.332622543932319e-02   -3.826941878261697e-01   -1.729695672017692e-01   +3.007523347959493e-01   -8.939260160569267e-01   +4.277800018788109e-01   -6.238361088794946e-01   +5.243050637976006e-01   +8.352885614072360e-01   +4.450721518272199e-02   +5.090848346537378e-01; +4.071923128061087e-01   +1.138571175404174e-01   -4.708264675707439e-01   -2.571898273544507e-01   -5.288060966740769e-01   -4.941175909078611e-01   -5.528430396950744e-01   -4.398213364726975e-02   +1.510406348460683e-02   +7.260084672168297e-01   -4.826964053201566e-01   +1.343955323763892e-02; +3.537989473944997e-01   +2.853205971482827e-01   -2.569380263760063e-02   +8.969874945016439e-02   -2.634632806171160e-01   +2.662264489539206e-01   -2.423407995279076e-01   -1.494331567981622e-01   -2.116424516864752e-01   -6.519710109700561e-01   -4.380617762715288e-01   -3.908382316553904e-01];
L2E_L3E_iAMPA_netcon = [+2.893969507426338e-01   +1.433647872456800e-01   +8.457452663582032e-02   +3.803812471330935e-01   +5.469470830040628e-02   -1.063221059586611e-01   -8.632719080911298e-02   +5.390506078500152e-01; -1.356788588338181e-01   +8.165145982125435e-03   +3.986030778011647e-01   -5.468542017837491e-01   +1.802069934722984e-02   -4.567046565364788e-01   +3.204491627428694e-01   +6.882871219650817e-02; -9.561644328827568e-02   -3.839465410146688e-02   +4.455392487675139e-01   -5.915072711006524e-02   +4.861883976820672e-01   -1.696050320338769e-01   +4.546012062976692e-01   +3.052378234299128e-01; +3.260952844639552e-02   +1.540224834296961e-01   -2.933914956177758e-01   -1.547497275962150e-01   -2.657196603518451e-01   -4.397579113413473e-01   +1.071842854928484e-01   -3.875768336429531e-02; +5.904661184313673e-01   +1.545483807315387e-02   +6.269222430094434e-01   -3.300543975630892e-01   +3.601518655352828e-01   -2.319198858082735e-01   -6.624434407428381e-01   +5.048742244313806e-01; -5.898925281363638e-01   -5.080816452588838e-02   +5.990659074354513e-01   -2.090064046303440e-01   +1.347405316280147e-01   +1.796799164113005e-01   -1.049954598812273e-01   +4.892707170711224e-01; -5.009048144300687e-02   -6.188548483001505e-01   -1.428140657582433e-01   +4.885743454289185e-02   +1.728433502577327e-02   -6.956233018096937e-02   +8.983379099979941e-02   +1.728552900301107e-01; -4.452375611303294e-02   +2.119257509008672e-01   +3.420773157539331e-01   -4.353775531282443e-02   +1.508769533286429e-01   +5.243572869068757e-02   -4.642783109783295e-02   -6.426043921412270e-01; +3.826351914022820e-01   +4.550328001685168e-02   +2.434488438058309e-01   -5.211907191725373e-01   -3.477577613348559e-01   -5.250402846185003e-01   -3.801649988289632e-01   -1.929851940109028e-01; -2.862216570459871e-01   +4.913664760812179e-01   -3.464798555742088e-01   +4.808896682868569e-02   +4.657461437795411e-01   +1.152739468301679e-01   +4.582570428851679e-01   +1.608971826864303e-01; +4.283820409908162e-02   -4.553040161330656e-01   +4.075837006926159e-01   -2.387792068411934e-01   +5.496247450118488e-01   +1.332586751991658e-01   +3.266765199259388e-01   -7.040526229728006e-02; +9.429770128459997e-05   +1.645432890510493e-01   +2.532954551829709e-01   -6.971026030167110e-01   -1.816326590257681e-01   -2.022888251559795e-01   +7.089789187149881e-02   -4.323131312029602e-02];
L2I_L3I_iGABA_netcon = [+8.797341973514344e-02   -2.986441135995038e-01   -2.616921000713357e-01   -2.105755937009433e-01   -2.157798690660702e-01   +1.905033897940011e-01   +4.580492172650786e-01   -3.766032290766731e-03; -5.808258006633690e-01   -4.596193311771572e-02   +6.851281099587834e-01   +2.276984667260234e-01   +3.278118535347579e-01   -2.539813624847872e-01   +6.103336759317129e-02   -3.651616949979412e-01; +4.330439736674632e-01   +1.829963797805889e-01   -5.522498289113598e-01   +6.342635540401038e-02   +3.441560721974748e-01   -2.839497855167917e-01   -1.632520633534267e-01   +6.752695256543609e-02; +5.830768607875341e-01   -2.441171006289744e-01   +3.644093592057851e-01   +6.178085362605800e-01   -5.583951294877169e-02   -3.826305129398254e-01   +4.422336884166619e-01   +5.489316547342832e-01; -1.902249194706790e-01   +4.008575113406513e-01   +3.781915608826273e-01   +3.047024930857263e-01   -1.103674720110184e-01   -2.640014650937162e-01   +7.619852177621471e-01   +1.491788743263700e-01; +6.488437401761763e-01   +2.895266445039387e-01   -2.369055321093340e-01   -1.856404606592726e-01   +8.797203792306121e-02   -8.687736128434753e-02   +4.644604029702754e-01   -8.956729511091285e-01; +6.727907238818073e-02   +2.497762541726782e-01   +1.554706625841314e-02   +3.003646895785391e-01   +4.760623888542257e-01   -2.717840727352527e-02   +3.424758348510539e-01   +6.419509196528462e-01; +4.794449315166810e-02   -2.843011537760703e-01   +4.930927578196727e-01   -1.993092765156710e-01   -1.683717011244708e-01   -1.385774293364536e-02   -6.432063447906800e-01   -1.137588245746227e-01; -3.842560978032377e-01   -2.132692674816859e-01   -2.964361813781399e-01   +8.748254276662928e-02   -2.439365768473820e-01   -3.174856056980254e-01   -6.369726396692476e-01   +3.801689357218469e-01; -4.963243523066384e-01   -3.564752213519668e-01   -1.591531838347811e-01   -5.311936355953664e-01   -8.347300364309654e-02   +4.420918912380523e-01   +6.229207266933199e-01   +4.709327322918015e-01; +2.604768423049436e-02   -2.984482736569495e-01   +5.408173744755153e-01   -6.342088458182128e-01   +6.630686639466948e-01   +3.014576371785210e-01   +7.778737068276756e-02   -3.996305819379420e-02; -2.073871827601285e-01   -5.511266086995912e-01   -3.258917613127021e-03   +1.401664588396057e-01   +7.727682939029794e-01   +3.596486757511121e-01   +1.421126255497549e-01   -5.803977518375897e-01];
L3I_L3E_iAMPA_netcon = [+4.028487179506945e-02   -6.182433246183271e-01   -4.549891937722295e-01   -3.171948897526075e-01   -1.966159606616465e-01   -9.059640471461111e-02   +2.787190383193047e-02   -1.170192337986177e-01   -1.104388566521866e-01   -2.706740072798903e-01   +1.541625126034600e-01   -4.111941145556041e-01; +3.758276055516394e-02   +3.267086530852543e-01   -4.131813248026894e-01   -1.906122483501613e-02   -2.676323218875333e-01   -2.189112869795331e-01   +5.150042728324346e-03   +6.918137318811028e-01   -4.875385137615008e-01   +1.107805085845684e-01   -2.045657028690867e-01   +1.939313415981994e-01; +1.101767879025949e-01   -2.932554580878750e-01   -6.775496868721823e-01   -4.139733013287750e-01   +7.763528775465242e-02   +5.208600953158995e-01   +2.920995942495248e-01   +2.314969059776869e-01   -2.962005437258163e-01   -5.347191545439818e-02   +3.391591900680067e-01   +1.901250953749903e-01; +7.214582780417109e-02   +4.396034025831193e-01   +1.305972728123396e-01   -2.707823140713260e-01   -4.077011655906154e-03   +8.437120003203061e-02   -5.951173971470435e-02   -4.489299475534897e-01   -4.081173884742824e-01   -1.789380328875038e-01   +4.791259593528084e-02   -2.144638472864209e-01; +2.748985071125817e-01   +3.174160381562873e-01   +1.018294590498500e-02   +3.940192037724969e-01   +1.100380351075515e-01   +4.855214154694672e-01   -1.085059603809328e-01   +5.622095687416970e-01   -2.841590653887205e-02   +3.547352254547660e-01   -4.547349020071246e-01   +3.088494617027168e-01; +1.570997021163379e-01   -2.004487913372278e-02   -7.140360162563673e-02   -1.871534695574590e-02   -1.830155616334769e-01   +2.892189357429096e-01   -3.039535577028128e-01   -3.624135054334868e-01   -3.650229965128611e-01   +1.280645389925331e-01   +6.192960391483509e-01   -1.771959880833049e-01; -3.758283515619867e-01   +1.979028899578388e-01   +1.327331166574641e-01   -4.458371904209107e-02   +1.992470160140112e-01   -2.500213112385394e-01   +6.333186865463347e-01   +2.767141065311548e-01   +7.741706996391164e-02   -9.286537852184765e-02   -7.457375784106139e-01   -3.186803130814440e-01; +4.369928414589620e-02   -1.589345919515927e-01   +3.548193177254687e-01   -2.014723163262571e-01   +3.856017252090652e-01   -4.377986107201390e-02   -4.976723719155732e-01   +1.059057660253777e-01   +1.297592777498106e-01   +8.458890660559476e-02   +7.319659511571064e-01   +7.477737762309727e-02; +1.656790364749994e-02   +2.286135748692423e-01   +1.888943147118833e-01   -6.803702109988374e-01   -1.352655292905244e-01   -2.037690096995263e-01   +1.020184241005259e-01   -5.179621678874111e-01   -2.205896983794381e-01   -4.309923235257555e-01   +1.785565130997396e-01   -1.083988525518537e-02; +3.489483376843718e-01   -6.648264352366772e-01   +4.365510700187969e-01   +9.826304741173482e-02   +3.300867012778879e-01   +2.939029563564003e-01   +1.165038409923311e-02   +1.549525066605560e-01   -3.554598766117402e-01   -3.894034642267904e-02   -7.871751574978519e-01   -3.871382409106904e-01; -5.393946341641663e-02   +4.714595546591763e-01   +1.635456563358831e-01   +3.979799791821494e-02   +1.405591506243107e-01   -2.952338391311570e-01   +2.872119672661450e-01   -5.889479353520839e-01   +7.573627417345752e-01   +2.822928838770339e-01   -8.103917454537368e-02   -2.927773887282847e-01; +3.589898477883879e-01   +2.752037695402775e-01   +4.945092705247793e-01   -2.048945540269414e-01   +6.201961766238395e-02   -5.727305756271429e-02   -3.101606226321556e-02   -5.481484471105424e-02   -1.176578319883898e-01   +6.773687310880525e-02   +7.944212089061305e-01   -3.953422406668222e-01];
L3E_L3I_iGABA_netcon = [-1.758794157397348e-01   +8.602992533832243e-02   +4.120651767470296e-01   -2.570670284170335e-01   -6.055070722394968e-01   -2.348440522399610e-01   -3.223585376559492e-01   -8.625888543995014e-03   -4.188324475021322e-02   +2.043654867386999e-02   -1.045198296813129e-01   +5.171012635659016e-02; -3.218759606485720e-01   -2.541079579232571e-01   -1.362215588570345e-01   +6.990896705654944e-01   -3.268810724258857e-01   +3.469431364165741e-02   -4.255215443171105e-01   +1.608721625198177e-01   -5.759409819017808e-01   -1.270874154660613e-01   -5.928059605761076e-01   -1.308124944359703e-01; -3.072024136826028e-01   +9.258781413220613e-02   +2.327467020508792e-01   +2.069129140905652e-01   -3.249728477427338e-02   +2.498808762605420e-01   +4.278615357051542e-01   +4.557595565501335e-02   -3.784267573858406e-01   +3.905184240512962e-01   -2.872075535955000e-01   +1.164616153645794e-01; +1.018123778493147e-01   -5.162538907920831e-01   -1.397454898575567e-03   +1.857068974301289e-01   -6.565150609190412e-02   +1.809836691056561e-01   -4.010021952555938e-01   -1.269507429613793e-01   -1.122764199836660e-01   -3.905850632387804e-01   +5.715491128970203e-01   +6.266888909807683e-01; -7.376509080162630e-01   +2.857165219103579e-01   +3.776270403674626e-01   +2.123285923518373e-01   -5.295932500769754e-01   -1.746555333480570e-01   +2.687630182856487e-02   -6.128757273363220e-01   -5.808973470704308e-01   -2.896747282902692e-01   -4.389855650081674e-01   -2.379320441407860e-02; +4.282196310058830e-01   -4.423042492941546e-01   -1.925318251369535e-01   -1.162054106265571e-01   -1.524626452898424e-01   +6.017592158223116e-01   -2.151759376549975e-01   -4.862941716817253e-02   +3.322709493951266e-01   -3.442725813341436e-01   +2.818212656880349e-01   -2.000594827730590e-02; -2.843843728319828e-01   -3.825872616512931e-01   -4.778760994948388e-02   +3.838831033596498e-01   -1.924575822346626e-01   +2.915034684554193e-01   -1.242929421610616e-01   -3.962162421307374e-01   -3.333967767804881e-01   +2.082669655263579e-01   +2.164140287997550e-01   -1.169014405690724e-01; +3.745308989547896e-01   -3.814717799294732e-01   -5.182875380301937e-01   -3.693349761247667e-01   +4.561749753847253e-01   +1.121107786032891e-01   +7.598052134258405e-02   +3.783967511929101e-01   +4.022300565759571e-01   +2.864138094321209e-01   +1.179122358203092e-01   +2.532833494619001e-01; +9.882501374929878e-02   +4.680882199196594e-01   +3.856759969723600e-01   +5.827168945067848e-02   -2.041785232219438e-01   +3.754155450453277e-01   +5.706383463289106e-01   +2.956100416823928e-01   -3.433686785888337e-01   +8.287165021509534e-02   -7.792334975591947e-02   -3.891216360200342e-01; +7.984326173566584e-01   -1.040651022404179e-01   +3.385670479329399e-02   +4.126472460137118e-01   +3.964490527972784e-01   -3.672666345990987e-01   -6.637192959052159e-02   -1.943737730882809e-01   +4.272192303712941e-01   -1.701456903835786e-01   +3.036474572337700e-01   -2.917091585333467e-01; +8.163933534528696e-01   +2.067032215850251e-01   +4.119693382418017e-01   -7.758708418734463e-02   +5.077899473264615e-01   +4.858778382300214e-01   +9.603882751229260e-02   +1.195257732243937e-01   +1.261776564777116e-01   +1.005138861899575e-01   -1.263156712299749e-01   +3.268783671157507e-01; -4.037649469702325e-01   -5.870105425140612e-01   +6.905406200982185e-01   -4.754249381066000e-03   +4.981591916253461e-01   +4.719148571174374e-01   +7.587770841863426e-01   +3.278287022793418e-01   +2.522859957386910e-01   -4.271440086119063e-01   +5.981618505859450e-01   +3.981567451663771e-01];
L2E_Input1_iAMPA_netcon = [+2.290469411292536e-01   -7.029265403076334e-01   -2.180406009263793e-01   -3.387259162404052e-01   -3.663347511413744e-01   +8.473604183300961e-01   +1.468538707952435e-01   +4.086637387403643e-01];
L2I_Input2_iAMPA_netcon = [-3.607398128551744e-01   +2.228779755845270e-01   -6.906699903903588e-01   +3.262363690761264e-01   -7.423074326192113e-01   -5.663213677337576e-01   +3.867923639792716e-01   -2.029440423093878e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
