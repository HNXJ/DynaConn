function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.981592255750297e-01   -2.745283019510144e-01   +6.614912945744685e-01   -3.289355403264189e-01   -2.691060773930365e-01   -2.396930286884691e-01   -5.049971948122630e-01   -5.597032816705197e-01   -4.740060496375260e-01   +3.769718933013512e-01   +3.702813333333083e-01   -4.503382130971947e-01   +3.615708186147460e-01   +1.292062394017555e-01   -2.521710015462002e-01   +4.677516071784135e-01; +7.672727457304590e-01   +6.635088905000692e-01   -5.898235646650257e-01   +7.748785294127887e-01   -2.651279828007908e-01   +9.658651593976597e-02   +4.045233616648637e-01   -3.376656564618322e-01   +4.903404875743967e-01   +4.164347861222772e-01   +6.504008825808884e-02   +2.224861475191095e-01   +7.296018288582689e-01   +2.453718391557247e-01   +7.800987443009150e-01   +2.304409569347710e-01; +1.529187669611007e-02   -2.575960923734534e-01   +1.770561137932620e-01   +3.271672369350648e-01   -5.849480655279068e-01   +1.852600890027783e-02   +2.387234242188948e-02   +8.796252909720989e-02   +2.672994099854211e-01   +4.335294626458082e-01   +6.770313175324799e-02   +3.857750558057164e-01   -3.188950196546732e-01   +5.059236542668956e-01   -3.641569153605728e-01   +5.180946970803708e-02; +1.776626598223502e-01   -4.514017789613011e-01   +6.300381014258567e-01   -7.741210706172107e-01   +4.215773047195938e-01   +1.045760691327137e-01   -5.928295650939430e-01   +2.239997190418362e-02   -3.418274414453366e-02   -1.846857458840317e-02   +5.908503802281584e-01   -2.537675263725943e-01   +4.164213549633256e-02   -4.187435425424385e-01   +3.573928044548666e-01   +3.693427344156913e-01; +2.135764300961489e-01   +6.955657292932341e-02   -1.033520613946524e-01   -3.935458463012158e-01   -1.492631950896226e-01   +1.319131226072045e-01   +2.443082835109431e-01   +4.180250830070915e-01   -9.741996114808743e-02   -5.392731782626768e-01   -3.333381659340360e-01   -1.868218954465481e-01   -2.732749146244432e-01   +8.944111369177101e-01   +3.636899029410489e-01   -3.459599634245571e-01; +4.523752553181880e-01   +3.463860551366281e-01   +2.276591745838031e-01   -3.423520362691868e-01   +1.998528763923920e-01   +4.903256094073905e-01   -3.539041268003055e-01   -5.470779203709426e-02   -1.535738544514425e-01   -1.863403487024156e-01   -2.081331014818340e-01   -4.424410784867587e-01   -3.774308937117639e-01   -4.220216868098561e-01   -3.081569405442394e-01   +2.385590396369179e-01; -5.543686705432564e-03   -4.850526373226949e-01   -3.575468746882287e-01   +4.178822188530628e-01   +6.846021655469957e-02   +2.203273697690624e-02   +2.504863603431530e-01   -3.111571783548913e-01   +4.853587432069417e-01   -2.890068617811558e-01   +4.340257108892782e-01   +3.148894749301901e-01   -5.008237499239967e-02   -6.374003300845404e-01   +1.370765234188341e-01   +6.588639052199832e-01; +2.507823802340322e-01   +1.894813650930295e-01   +3.658539053055637e-01   +5.087542410647563e-01   -5.700822908161826e-02   -1.000000000000000e+00   -2.841876652725666e-01   -1.042655748469569e-02   -3.052189489235489e-02   -3.327468932596206e-01   +5.853579232562680e-02   +9.218434283839307e-02   +4.360471073446860e-01   -9.629199092391240e-02   +4.744310155535884e-03   +1.863350669929567e-01; +3.861477345141868e-01   -6.911127899456800e-01   -2.762092216818059e-01   +1.133270048085702e-02   -2.855197818830348e-01   -1.116408651831430e-01   +5.376790393801711e-01   +2.571956885336180e-01   -4.186361780192248e-01   +4.779420577958004e-01   -2.478422537809460e-01   -7.696071931333254e-02   -1.685406767789808e-01   +5.982724819209544e-01   -2.902996528147345e-01   -1.770771231701038e-01; +4.243831894578129e-01   -4.327773820057664e-01   -6.599656196774388e-01   +4.298777030672728e-02   +2.578502471712312e-01   +3.869273137273018e-01   +5.829393118056628e-02   +2.433903021574340e-02   +6.912870632883984e-01   -6.306517542457873e-02   -5.150478701698273e-01   -6.073926909578184e-01   +6.083692709012051e-01   +6.954992525411563e-01   -9.301790824174266e-02   +6.147986276692567e-01; +2.338454998173393e-01   +2.866740606140639e-01   -1.667802545317549e-01   +1.533475386936698e-01   +4.979300853599065e-02   +5.835772458229499e-02   +6.671267691301086e-01   +7.189381173184116e-01   -2.234685556667827e-01   +4.698079261432752e-02   -3.784457248517974e-01   +8.751975359013847e-02   +1.862737867270753e-01   +9.365796403666402e-01   -1.381226448959430e-01   -3.216158482800524e-01; -1.418205284923606e-01   -2.400892608985131e-01   -2.366095218420085e-01   +2.898283918882372e-01   -2.082353394783067e-01   +9.111667774190756e-02   -7.420173906903643e-02   -7.792314977926869e-01   +5.979534329895571e-01   -1.946138741127912e-01   -2.507310841389854e-01   +7.101261330767528e-02   -5.708164274533669e-01   +1.365301646392066e-01   -4.278918546872143e-01   -4.262337895021790e-01; -5.300208615068167e-02   +5.689384752725948e-01   -1.696064220258749e-01   +4.476397289018311e-01   -7.502652903202925e-02   +6.108688283898267e-01   +5.562971185980294e-01   +5.375409683510149e-01   +3.146717311264170e-01   -3.213048948435577e-01   -1.449531457569179e-01   -3.055276992727779e-01   +2.873155625694603e-01   -6.690725233790489e-01   -8.368607514766289e-02   +6.741861357499589e-01; -3.393073266498034e-01   -8.958101645286691e-02   -6.556222280384675e-01   +3.936661831403051e-01   +2.735572639361318e-01   -2.193396546223006e-01   +1.388402724838339e-01   +2.620171508360392e-02   -8.261478196419005e-02   -6.507005457686472e-01   -7.290389921631071e-01   +8.546760032747761e-01   +4.084899889812464e-01   +3.916157404312405e-01   -1.029279197697060e-01   -6.805511009546172e-02; +1.510206819762721e-01   -1.604437401428804e-01   +2.326636088618193e-01   +1.152519747852908e-01   -7.258671494314884e-01   -3.759992490575290e-01   -1.261197867595417e-01   -6.025716701841737e-01   +3.314806071737125e-01   +1.453784261036330e-01   +2.398781796413098e-01   -1.546815144368315e-01   -3.230589924747678e-01   +5.672897948501987e-01   -5.518942148140599e-02   -5.052567294915096e-01; -2.136200590070350e-01   -3.777461983559807e-01   -1.171822423105221e-02   -7.553248919903255e-01   +8.741803080275175e-02   -1.902385867370837e-01   +7.729469541439850e-01   -2.883505540454773e-01   +2.702182743673509e-01   -5.068346581949233e-01   +1.009852458610490e-01   +1.053850991227974e-01   +7.691968405682366e-01   +1.271132248751384e-02   +2.983469389653569e-01   -2.397497714986896e-01];
L1E_L1I_iGABA_netcon = [-2.915731474683159e-01   -6.045482822444968e-02   +3.814641221717170e-01   +1.122235051742266e-01   -1.758885067385358e-01   +3.232048332760286e-02   +7.094764171200169e-01   -1.352782583862010e-01   +3.594859246725575e-01   -3.016500514033130e-01   -3.753656426196619e-01   -2.453857913778660e-01   -2.326373762462142e-01   -2.803655107424963e-01   -6.206554386609715e-02   +5.752116161275144e-02; +1.207982776618806e-01   +2.661576845332072e-01   -1.189238993566225e-01   +2.642647249304331e-01   -2.501453785099641e-03   -5.804804159317329e-01   +1.695458166227297e-01   -9.956384116369552e-02   +3.626594041300071e-01   +3.229566405112383e-01   +9.816320233068135e-01   -5.574121242143672e-02   +3.135307345349863e-01   -1.887828378205639e-01   +7.604247173357866e-02   +6.340156931839730e-01; +7.030849909730345e-01   -2.905745790350699e-01   -4.461838389513996e-01   +4.503803373552639e-01   +3.782635898059929e-01   -6.589454401822478e-01   +2.628088885040586e-01   +1.567111486119865e-01   +4.687904742930527e-01   -3.485845523854334e-01   -1.556566375310469e-01   +2.874602015839272e-01   -1.529432987730443e-01   +3.332022572076800e-01   -2.318790819039419e-01   +2.630369896693176e-01; +3.913314213722442e-01   -4.542955706838078e-01   +1.193856202084067e-02   +1.675649487834488e-01   -2.859525023214063e-01   +3.412552046067156e-01   -1.000000000000000e+00   +7.038179232993615e-02   -7.953305490205000e-02   +2.803480303425243e-01   +5.898452973857773e-01   -1.061706913838082e-01   +6.954584060511383e-01   +2.843346675851186e-01   -5.140802727048589e-01   -2.323525062689422e-01; -4.637402498747575e-01   -7.561934104414149e-02   -6.289748188561198e-01   -6.918154100988197e-02   +3.237015909097352e-01   +7.552333830112855e-03   +2.001196921299229e-01   +1.079042838467560e-01   -4.968137965813232e-02   -2.479452838662655e-01   +1.933208311474189e-01   +2.248136873563264e-01   -3.562682869052914e-01   -1.984573950563040e-01   +6.579071862968655e-02   -2.244808779841530e-01; -7.249715748956788e-02   +6.667591148741221e-01   -1.844052614361745e-01   -1.596708467927737e-01   +4.734893306167461e-01   +3.279723238779167e-01   -2.058767407238769e-02   +8.285038488455986e-02   -2.433324597652561e-01   +8.432728013759447e-02   -2.177806310591115e-01   +1.485164484057891e-01   +9.488568519597282e-02   +6.338177359967229e-01   -5.123321436726375e-01   +1.492459758362541e-02; +7.513777937826545e-01   -3.932592401433246e-01   +3.100230998992335e-01   -4.153091199915043e-01   +1.933861216296348e-01   -6.550783421559071e-01   +1.343094503939336e-01   -6.388256674753167e-01   -3.503389880786120e-02   +2.728953413525986e-01   -6.358269013101833e-01   +2.834102796791577e-01   -4.295679543693087e-01   +5.019057987335320e-01   -2.407128629882511e-01   +3.124391305509768e-01; -4.368053065259296e-01   +4.420634274574501e-01   -2.219444685420984e-01   -3.892567805816317e-01   +1.342444113488567e-02   +1.627090208297455e-01   -2.542161428932322e-01   -1.528709234380726e-02   +3.033387939517193e-01   +3.116932144394250e-01   -8.192470948175764e-01   +4.561464740288062e-01   +4.265255097917571e-01   -6.847981925395898e-01   +3.394074282864475e-02   -9.038817741734033e-02; +4.460010354314192e-01   -2.440574207344642e-01   +4.269158961677106e-01   -6.273567381590351e-01   +1.233106600673621e-01   +4.017430747507613e-01   +7.392867201775728e-02   +3.649116922024681e-01   -1.723188149438466e-02   +1.390426875094116e-01   +3.759562186467941e-01   -3.583204607569952e-02   +5.545968235676874e-01   -1.381453357174263e-01   -7.777818985721278e-01   +4.612557861328650e-01; -4.960800752690508e-01   +5.655887455808684e-01   +8.816566605291413e-01   -2.011220419503899e-01   -2.385693645423196e-01   +4.890400861714337e-01   -5.152024702283170e-01   -4.762155901036380e-01   +2.934584259378979e-02   -3.161332213091490e-01   +2.705171544627306e-01   +7.884962346370272e-01   +2.469053034713897e-01   +8.459584639678362e-02   -1.879029143042408e-01   +6.591366064935952e-01; +1.082991052915043e-02   -2.694219645546120e-01   -9.571766238351150e-02   -1.593191150215029e-01   +1.896249662662624e-01   +3.317195818983036e-01   +2.937387811820957e-01   -3.501111631761145e-01   +2.762393283910945e-01   -3.412128813581398e-01   -4.506396187773758e-01   +1.426181502694905e-01   +2.088747132976170e-01   +1.342231376460412e-02   -2.601658341018091e-01   -1.072468661630852e-01; -5.028630366161929e-01   -4.417066483589377e-01   +1.495478359093678e-01   -1.746420514350470e-01   -8.792231468815891e-02   -2.085351700537044e-01   +3.748767563276958e-01   -9.797346824947804e-02   -2.258975753552547e-01   -1.792290712801678e-01   +1.673662082007355e-02   -2.216490443097354e-01   -1.953540970914313e-01   -1.720648910883444e-01   -2.180031701802692e-01   -5.340587627912703e-01; -1.699297302846889e-01   -8.480247822775692e-01   -3.737789370427388e-01   +5.188185353755137e-01   +4.377564419578883e-01   -9.245444944911375e-02   +1.443673209850047e-01   -5.766217978914068e-02   +1.169258932715169e-01   +2.134117758430162e-03   +2.307803547424190e-01   -3.871206207660828e-01   -1.634014011706091e-01   -9.289422358778365e-01   +5.699837677633636e-01   +2.957404561268606e-01; -4.381046590788767e-02   -4.914390818365439e-01   +1.968190146424769e-01   -4.943352823166077e-01   -2.068222132540432e-02   +5.013451715276672e-01   -3.058078644970372e-01   -7.042499977758427e-01   +3.790695398578252e-01   +3.602789165338557e-01   -7.938371072677002e-01   +2.692251664361312e-01   -8.043829030694348e-04   -4.809491586606137e-01   +8.938235286732783e-01   -7.187423042649536e-01; +1.323606014185112e-01   +3.048619439932626e-01   -3.125293486305986e-02   +1.944004465174762e-01   +1.656466606352390e-01   -1.187466698470903e-01   -2.330271220651187e-01   -8.881404009661376e-02   -4.818572370297589e-01   -1.438356056450223e-01   -3.874451936155464e-01   +6.660376582449536e-01   -4.114019067510104e-01   -3.985087725137308e-01   +1.206193189243529e-01   -1.970233169935538e-01; +2.246196689618868e-01   -7.443473479470583e-01   -5.258534788940650e-01   +3.892083809446611e-01   -2.319305140842436e-01   -3.052159132655403e-01   +1.202009194560173e-01   +3.862090359974657e-02   +1.764579726849853e-01   +1.494729181290827e-02   +2.612071114380960e-02   +2.019644419791275e-01   +1.865235925000743e-01   +1.624528144203075e-01   -2.511202499017666e-01   +7.056501547074065e-02];
L2I_L1I_iGABA_netcon = [-2.520749587271599e-01   +6.739432283181441e-01   +6.546746152114350e-01   +7.708953559929555e-03   -4.782325518283419e-01   +7.025421835883636e-01   +3.912885425843023e-01   -1.973497524914196e-01; +2.802187005051477e-01   +7.775942051866632e-01   +1.278901878748561e-01   -8.089595570089683e-02   -1.158602430798731e-01   -1.729612379605260e-01   -1.330026650821182e-01   +7.418490121971919e-03; -8.831533351705987e-01   +6.667708676335273e-01   +7.068042024949360e-01   -5.734640094783792e-02   -3.433361552693802e-01   -6.465998712953135e-01   -9.027383033590307e-01   +8.218854475821079e-02; +4.047858549605544e-01   +7.991997435470358e-02   +2.528762843752950e-01   -1.578127561378079e-01   +4.167711591140086e-01   +1.563288213841449e-01   +9.684755165051003e-01   +3.648746332625522e-01; -6.970663756897429e-02   -1.468764475219956e-01   +1.246966218274194e-01   +1.163427552975058e-01   -5.824920929696215e-02   -5.767409941572325e-01   -3.279233999555584e-01   -6.761998337656307e-02; +5.241242868415201e-01   -1.421214871108817e-01   -5.682858050742021e-01   -3.556763479143542e-01   -3.961660550286024e-01   -3.365030475221868e-02   +6.002046390525533e-01   +1.337700795057675e-01; -7.878151779220225e-01   -2.282759417332993e-01   +1.662720208881533e-01   +5.372610647818365e-02   +4.428942303323021e-01   +3.960086377829785e-01   -1.114364640769421e-01   -5.958059038081620e-01; +1.431517303369752e-01   -3.774776646787295e-01   -5.466412070696763e-01   -5.306187707763353e-01   -6.466312496045518e-01   -2.234339631451263e-01   -3.287961382533175e-01   +3.430738816028754e-01; -2.571895658354553e-01   -6.556126331945219e-01   +1.303709924655904e-01   +1.118735198398881e-01   -9.496499797753787e-01   -3.044093309681614e-01   -3.544146206746100e-01   -2.078704821057801e-01; -1.454981211742568e-01   +1.807915978885511e-02   +1.676518062950158e-01   -9.001924750903981e-02   +1.771573206626111e-01   +4.661374176862735e-01   -2.566885700303194e-01   -5.025093132787662e-01; -3.992064934555400e-01   -1.869054523194054e-01   +4.679435929150822e-01   -3.456339488453101e-01   +1.003953929245629e-01   -5.373211263970763e-01   +1.152824910402185e-01   -4.309296618713596e-02; -5.365485808144687e-01   -4.450885787628477e-01   +1.194491809170278e-01   +2.114625823728505e-01   +3.759333547936995e-01   +1.425714434983276e-01   -6.506230808952927e-01   -3.579082331337081e-01; -4.863616741256509e-02   -1.785916928890535e-01   +2.196434975818214e-01   -4.587881502716525e-01   +2.403893366902369e-01   +5.791661269767409e-01   +4.042769211143029e-01   -3.904467706152807e-01; -5.042582442476391e-01   +6.231436661773548e-01   +3.739685304737068e-01   +2.915812991831712e-01   +3.042501852855832e-01   -3.616391607132107e-01   -1.000000000000000e+00   +5.708812030088575e-01; -5.779385971260688e-01   -3.998472755978258e-01   -8.196297957990438e-02   -1.692942395476139e-01   +2.744755118709643e-02   -8.659943104137538e-02   +3.873621626480815e-01   +2.031870113189583e-01; +2.553647450885694e-02   +3.723957323913915e-01   -2.576521661526136e-01   -7.315011281305162e-03   -1.335780047607631e-02   +2.433298608866845e-01   -5.924786983032028e-01   +3.786269186095868e-02];
L1I_L2I_iGABA_netcon = [+4.494169429336157e-01   +8.559084191877556e-02   -3.531484740877485e-01   -5.309197825382866e-01   +1.846492326372479e-02   +5.035547297800401e-01   -3.764453648917257e-01   +2.275322294299950e-01   +5.393279000077804e-01   +5.054723405676596e-01   -6.163494516758898e-01   -1.410495974939668e-01   +7.146908143014549e-03   +3.507562838112298e-01   +4.204480022678055e-01   +3.714741034857361e-01; -3.969977478315055e-01   +1.285328393859223e-01   +8.046366892575318e-03   -9.371488487729146e-02   -5.247086299328574e-03   -2.442830454161393e-02   +3.884887440195161e-01   -2.898404000623762e-01   -1.353187433447172e-01   +4.449943392402655e-01   -8.294182004653399e-01   -2.542436084914342e-01   -5.999971399591006e-01   +5.204424887553668e-01   -1.444022939051320e-01   +3.909378259453511e-02; +1.016855837631620e-01   +4.833891530524800e-01   -5.242391297509469e-01   -2.636876823329968e-01   -5.235722014753817e-01   -1.346924145595842e-01   -5.305259410604932e-01   +5.237268540402690e-01   -7.907739133369343e-01   -1.136972994839771e-01   -2.046397436459046e-01   +3.048988195456037e-01   +6.643706002290515e-01   -1.512591684257081e-02   +2.594967751217272e-01   -7.187762083184784e-01; -4.723476982379208e-01   -1.983830652688919e-01   +8.600279865544826e-01   -2.885818404373663e-01   +6.610342004673761e-02   +2.964652152029427e-01   +8.798833783603832e-02   -2.949327677780995e-01   +5.257292827640772e-01   -6.849934837308012e-01   -4.911972591879890e-01   -1.911534828733554e-01   +4.406398312479827e-01   -2.980484232133040e-01   -7.619037316438229e-01   -5.547104306926143e-01; -2.187980943009076e-01   -5.339916928734452e-01   -3.494330262281629e-01   -2.944784320412830e-02   +6.553638840632720e-02   -6.485860730875868e-01   -1.539354875131545e-01   +6.387188321588446e-01   +9.600289735811152e-02   -3.779204427519894e-01   +9.766337870558991e-02   +5.227858691078783e-01   -1.334118355830303e-01   +5.746380243677611e-01   +1.506520912335099e-01   +1.429997496050299e-01; -3.264742155402640e-01   +2.604797375690583e-01   +1.897686104458339e-01   +3.183312421778556e-02   +1.074643760981513e-01   -9.591887690627250e-02   -8.672074130242816e-02   +2.547353651457660e-01   -8.496782079351970e-01   -1.597262181780141e-01   +1.165181739873759e-01   -1.390297029788696e-01   -2.647367679152532e-01   +1.264512795534150e-01   -3.672396350018460e-01   +3.080490191105902e-01; +5.960237950603757e-01   +3.431552120513224e-01   +5.357879232645368e-01   -6.721552910374379e-03   +4.979635891171628e-01   -3.497892029122819e-01   -2.886940188739197e-01   +3.990632329863316e-01   +8.679122113634354e-01   +3.239199104873599e-01   +2.942413769053854e-01   -1.000873705698076e-01   +4.907845716108048e-01   -5.109651300177994e-01   -7.556580633654604e-01   -5.575918258470853e-01; +7.771121092179121e-01   +1.076612022436116e-01   +1.015975687241200e-01   +2.562390602143236e-01   +5.066510981736365e-01   -5.082777085811778e-01   -8.549420058822371e-02   +8.521554799978583e-01   -3.225724843478706e-01   -4.769121544163332e-02   -6.635376753129710e-01   -6.523954075016268e-01   +7.044883557756215e-01   -1.840690254696993e-01   +4.117287646905320e-01   -1.597291399489770e-02];
L2E_L1E_iAMPA_netcon = [-3.034101906541510e-02   -1.523653254406208e-01   +1.292205578703015e-02   -7.688079251730429e-01   -5.381917128482902e-02   -9.635292424011599e-02   +4.679548344018133e-01   +5.607035441729011e-02; -8.746071873590229e-02   -6.007974689488383e-02   +2.258234910144842e-02   +3.761899466237406e-01   +4.754740524018545e-01   -3.066793174322265e-01   +2.133527134804461e-01   -4.044205653543598e-01; +1.737596412454604e-03   +2.000129838944777e-01   -7.762738686319007e-01   -6.830132545422152e-01   -5.932562304324424e-01   +2.747144564095831e-02   -1.831921269054761e-01   -6.148783875572628e-01; -2.250765224419135e-01   -1.672835243879983e-01   -4.862837736796573e-01   -3.838827973863091e-01   -2.902735956708299e-01   -5.802915870469902e-01   +2.271754321754323e-01   +1.134464484374327e-01; +4.320174568744048e-01   +4.220410820807288e-01   -2.432055678321984e-02   -2.773354611111523e-01   -2.978224427449593e-01   +3.187218948347454e-01   +7.575023978173556e-01   +2.881875077542743e-01; -5.856169357121208e-02   -8.960306866707153e-01   -7.356625074063834e-02   +4.058416642842056e-01   +9.513999237439424e-02   +3.533784490280493e-01   +2.119144923868419e-01   -9.117425685893200e-01; -2.622280051944793e-01   +5.777998568730216e-02   +5.220963858277723e-01   -4.626599953915946e-01   +5.564455900419487e-01   -2.188382704028551e-02   -4.424058680558187e-01   +7.100343887958205e-01; -4.958393836776580e-02   -4.927807889209356e-02   -3.737074659406532e-03   -7.022534986827191e-01   +3.512449219354092e-01   -5.674401536538746e-02   -1.500510602762330e-01   -1.448842221792111e-01; +1.152318462048537e-01   -4.232413254747398e-02   +3.659006267172165e-01   +1.780618092015097e-02   -7.786715250082268e-02   +5.464626370991803e-01   +4.030091983505944e-02   +2.387673568427111e-02; +4.506962748104982e-01   +6.689873984984444e-01   +5.049801725356697e-01   -3.476433415804881e-01   +3.921018267344576e-02   -4.611006361217831e-01   +3.258250675991412e-01   +2.135951395418263e-01; -3.581900900198401e-01   +4.428024327499052e-01   +1.070266453589856e-03   +1.739274889738537e-02   +6.249340285330335e-02   -1.000000000000000e+00   +4.789015474321190e-01   -4.600760216543777e-01; -5.263579702389035e-01   +8.720745813299518e-03   +5.891217183942743e-01   -3.232108791028789e-01   -2.830080336481870e-01   +6.654994374685199e-01   +9.026063556952164e-02   -2.435191747871374e-01; -6.862313476846671e-02   -3.147882494965011e-01   +6.805668532633944e-01   +2.717187468096178e-01   +1.512418656108595e-01   +1.212253007237672e-01   -4.529279896077943e-01   -3.220331408838975e-02; -2.264220067859255e-01   +1.111164102809736e-01   +3.250262265801359e-01   -2.644792880781518e-01   +2.038684327648177e-01   -6.524398304758567e-01   -4.687427484653245e-01   +3.162333274298516e-01; +2.544969887906764e-01   -4.950708203989111e-01   +1.979298881299653e-01   -4.249436673447306e-01   -6.581615267867403e-01   -3.927501040246835e-01   +2.180946099041882e-02   -2.279297192756681e-01; +3.400144244741624e-02   +1.505244997818130e-01   -5.711777231500997e-01   +3.566929489957299e-01   -2.071852694106058e-01   -5.758234185418530e-01   -2.283730883647700e-01   +1.754198682591045e-01];
L1E_L2E_iAMPA_netcon = [-1.143751776341456e-01   +3.829636425700598e-01   -3.939835348600330e-01   +5.057987651113709e-01   +4.318644935685509e-01   +6.538958102193612e-01   -3.622917296558679e-01   -6.607599002812718e-02   -4.551372866093593e-01   -1.254373396290357e-01   -1.947354612240908e-01   +1.000000000000000e+00   -1.982944515240183e-01   +6.342076861570603e-02   -4.314201688736805e-01   -1.275474509350738e-01; -4.797876342215078e-01   +1.212809960630882e-01   +5.294483709950675e-01   +5.636283450230549e-02   -1.955705667588076e-01   +5.256586280465878e-01   +2.965065891796920e-01   +7.115747624763888e-01   +1.440340047864285e-01   -1.468841377236149e-01   +1.547096471289847e-01   +8.318679755811396e-01   +3.379995106973979e-01   +1.216001985562147e-01   -8.818451276373114e-02   -1.096540750025287e-01; +1.097589306355064e-01   +3.035418086287183e-01   +2.084023991310484e-01   -5.990466779203666e-01   +4.554761701030795e-02   -2.828401060143553e-01   -3.857758005053552e-01   -1.653016750004003e-01   +6.384457755353399e-01   +3.420355396661068e-02   -5.003836606576249e-02   -2.410527287370378e-01   -4.879354333445144e-01   +3.205397674591112e-01   -1.164532071660046e-02   -2.550094613260195e-01; +1.072526349256858e-01   +2.794945024896995e-02   +1.524638385426703e-01   -1.715382973847596e-01   +3.058368566415684e-01   -4.212846602827366e-02   +2.784469267215050e-01   +7.012976036273899e-01   +2.719161712326818e-01   -1.060049461057739e-01   +1.159641063429784e-01   +2.210404994316311e-01   -2.317001883053901e-01   -6.501241130579867e-01   -1.317210014754737e-01   -9.055924320528009e-01; -6.284567849522975e-02   +3.984560949769268e-02   +2.033193950335470e-01   -1.635526778260039e-01   -2.252114563238314e-01   +2.558523070199316e-01   +2.590179282257442e-01   +5.646990951129623e-01   -6.086286816444298e-01   +2.895821150154430e-01   -4.067988865502823e-01   +5.849712204120536e-02   -2.467265654941693e-02   +1.857809516178082e-03   +5.177111819983733e-01   -2.394292986787964e-02; -2.320227428481287e-01   -6.183719871776888e-02   -1.904475211837482e-01   +3.824598633377970e-01   +4.600627611100588e-02   -6.543834301165767e-01   -3.234239892964402e-01   +3.387233831387342e-01   +3.103684354431809e-01   +2.747724723385927e-01   +2.954626312232859e-01   +1.769115335807385e-01   +6.726865154957725e-01   -2.423042207978922e-01   -7.600865507777006e-02   +5.837654422000911e-01; -1.168220419362112e-01   +2.326782260522596e-01   +4.587820985490198e-01   -1.852125048436231e-01   -1.456859462679993e-01   -4.301501441004484e-01   +3.578711365551805e-01   +2.020888025832331e-01   -3.424698583530169e-01   +6.968648020923746e-01   -6.622892389198016e-01   +2.385735256139550e-01   +1.925687520613785e-01   +2.601473621251089e-01   -2.967507105643284e-01   +6.972595081664993e-01; +2.857824041334018e-01   +9.603500929381144e-02   +1.003536538633954e-02   +3.630577331348933e-01   +5.942195638121318e-02   -2.208209562421524e-01   +2.898688570544858e-02   -2.235879401290150e-01   +4.234939858121636e-01   +7.214084912759665e-02   -4.646113184046028e-02   -4.470107319886531e-01   +1.283574237488636e-02   +6.962255726362494e-01   +1.345110103964721e-01   +4.110307375710058e-01];
L2I_L2E_iAMPA_netcon = [-1.507065480555702e-01   -3.686065841836874e-01   -1.000000000000000e+00   +6.492617221169135e-01   -1.381208068917145e-01   -9.323755157187787e-02   -1.264605531683000e-02   -3.011158550612446e-01; -3.090687550648856e-01   +2.811493135226769e-01   +5.383591034688604e-01   +1.796550959295089e-02   -2.845207350705555e-01   -5.169814310846965e-01   -1.841050486831566e-01   -5.720982107030759e-02; -6.826234691640458e-01   +1.944350494012170e-01   +1.480159974022472e-01   -5.595395526036464e-01   -3.819061215349367e-01   +3.818648052373005e-01   -2.339790878693690e-02   -1.898317841780716e-01; +1.900234213926277e-01   +1.312953138001741e-02   -5.822645799195827e-01   +7.613240191824289e-01   +2.011721800450043e-02   +3.276685262799641e-01   -1.819435973229507e-01   -5.333317755377945e-01; -1.054683907216291e-02   +1.022966003076472e-01   +2.713510303856013e-01   -1.546521935196774e-01   -7.081111370644837e-01   -3.565222167563685e-01   +2.100814702061506e-01   -5.440837760951159e-02; +2.469128712353891e-01   -1.164640248079842e-01   +6.656640269381808e-02   -4.987830837432059e-01   +1.903278142384082e-01   -6.065725863958799e-01   -4.101279900844172e-01   -2.788398112988751e-01; +1.652599528191911e-01   -1.542403530146901e-01   -1.641086191606514e-01   +1.723931466512567e-01   +2.005547890392923e-02   +1.379437990639637e-01   +1.291872110900845e-01   -3.169809297090593e-01; -5.892863187147331e-01   -5.587918094603813e-01   +2.900666483878603e-01   -4.118892192862296e-01   +7.368904056164397e-01   -7.243649970957401e-01   +5.302703166690755e-01   -3.480488824616233e-01];
L2E_L2I_iGABA_netcon = [+7.882634367151049e-01   +1.145502238339132e-01   -4.211946346965187e-01   +4.189382176776149e-02   +9.228016999231923e-01   +3.258258844345357e-01   -7.730530379911973e-02   +3.376808818769638e-01; +3.531818673475773e-01   +2.719625547070630e-01   +6.471424022679517e-01   +7.128640575386875e-01   +2.654727737379788e-01   +1.998173744742288e-01   -6.153639155934509e-02   +5.384449149087919e-02; -3.451478488502002e-01   +6.872120509237782e-01   -3.287672407812114e-02   -1.386971813714188e-02   +7.279538165946644e-01   -7.185390676614990e-01   -4.531526617485802e-01   +5.051539406235799e-01; +3.909733787626563e-01   +7.815006564785751e-01   +9.255613027532694e-02   +5.421972113556132e-01   +3.708619109296648e-01   -9.951370016570531e-01   -5.317290602698017e-01   +4.928592220848352e-01; -6.452528230729813e-01   -5.632886825895251e-01   -6.863596370621849e-01   -5.874367509066872e-01   -9.988671346197685e-02   +2.126415916623767e-01   +2.891002263263720e-01   +4.602480065452885e-02; +8.938970063116630e-02   -5.424950188160302e-01   +5.813301370553390e-01   -7.762320038828865e-01   +1.992938054991961e-01   -4.493149234309135e-02   -2.192787158755362e-01   -3.315545407544248e-01; -4.624522734222181e-01   -5.843724695137896e-01   +4.771850230176811e-02   -6.061928199732741e-01   +2.431994904268337e-01   +6.799344659814232e-01   -1.508441172425546e-01   -3.524577062054818e-02; +2.125256204400835e-01   -3.469656891198267e-01   -7.468364772535403e-01   +1.030461179471868e-01   -1.478066331059286e-02   -1.351379038485871e-01   -2.695186063245168e-01   +1.291951053316512e-01];
L3E_L2E_iAMPA_netcon = [-1.380997876414639e-01   -3.288454310175552e-01   -2.102827422365859e-01   +2.368467615110083e-01   +5.328452568759123e-01   +7.930329965206766e-02   -5.408865650897444e-02   +2.738041618669687e-01   +4.806307753939183e-01   -3.412785626132653e-01   +4.023549687280831e-01   +2.346426811896120e-01; +6.604454060617254e-01   +5.583295694653079e-01   +1.140481849442694e-01   +7.084168704633738e-01   -1.955372541610457e-01   +5.398524671532109e-01   -6.338815574282394e-02   -2.138085680208039e-02   +6.424543014173757e-01   +3.737834016072703e-01   -1.757941522899813e-01   +5.228321801673478e-01; -3.349880522626589e-01   +2.970472758649236e-01   -2.419666880051323e-01   -6.964589344368780e-02   -5.494828665547579e-01   -3.888505860913292e-01   -2.085957323619840e-01   +2.494696388303269e-01   +2.178082649990815e-01   -4.464139877848413e-01   -4.765162554066345e-02   +4.697386022271494e-01; -4.570174412303982e-01   -6.181317303595052e-01   +1.264421720314141e-01   -4.501217912060624e-01   +1.232242079001296e-01   -4.859937168237117e-01   -2.884013105811967e-02   -4.770267513917724e-01   -2.263710731663751e-01   -4.660777660925524e-01   -1.888582475845053e-01   -1.263420278081842e-01; -5.559246038607960e-01   -1.000000000000000e+00   +7.638359561627996e-02   +4.946733415158371e-01   +7.055094347419336e-02   +1.484331391950245e-02   +4.740652360265980e-02   -4.166954202346786e-01   -4.978694747257090e-01   +4.310037739368285e-01   -3.525777597743600e-01   +3.612599083920841e-01; -1.356758010912182e-01   -3.489733932861210e-02   -2.949119634340669e-01   +4.247510537937395e-01   -2.794581321436732e-01   +2.237144820182412e-01   +6.763273904062379e-01   +4.329033951645389e-01   +5.060303212251660e-01   +1.215114543893529e-01   +8.062989826024825e-02   -1.243378547828531e-01; +5.745108150640204e-03   +1.593847780662985e-01   -2.047868803044196e-01   +1.024990752695289e-01   -2.926781132295974e-01   -8.336213451500649e-01   -8.826831282414176e-01   +6.007288522324910e-01   +8.959209825412796e-02   -5.227611969226223e-02   -3.488369195539111e-01   -4.064408031979452e-01; +2.598036423395922e-02   +1.231309897383879e-01   +4.313904709664711e-02   +2.496858396526518e-01   +6.422718824357729e-01   -2.220451638345317e-01   +3.736670449311277e-01   +3.311145781126161e-01   +1.040016879516343e-01   -6.902796480638952e-02   +7.097635342624031e-01   -2.635038251181563e-01];
L3I_L2I_iGABA_netcon = [+9.112282248087035e-01   -4.239134553536866e-01   -4.166298168232480e-01   +1.413691025674942e-01   -1.621745074467407e-01   -8.587339851412351e-01   +3.792307397370842e-01   +4.033648849691667e-02   -6.721454792591705e-01   -9.311336835048277e-01   -8.007479445926280e-01   -7.781090736398191e-01; -2.341838643605877e-01   -6.526877828969297e-01   +6.999283750211047e-02   +3.006968223050922e-01   -8.429832327060098e-01   +3.964005059734310e-03   +2.038941242902592e-01   +5.072348984733812e-01   -2.592374972725430e-01   +2.572178580948312e-01   -3.925284475255973e-01   +6.003525008389259e-01; +6.280008896956113e-02   -5.985065969774930e-01   +6.098538805842452e-01   +2.432905442895879e-01   +7.854010344443589e-01   +1.864379801776823e-01   +7.950483584966697e-02   +4.051348061420944e-01   -9.052589664686689e-01   -4.856082410294196e-01   +2.387222571125064e-01   -4.842399724783505e-02; -4.201158245325284e-01   +6.879516767864544e-01   +4.496264671915380e-01   -3.269687569240700e-01   -2.972310018136304e-01   -4.912249649856552e-01   +6.190775039948203e-01   -4.715396081139832e-01   -1.655251718268976e-01   -2.178519038350130e-01   +9.490002299404456e-02   +3.210962307791758e-01; -4.419602404054034e-01   +2.533250556045261e-01   -5.872132286122952e-01   -6.320955173793333e-01   +6.389199913201287e-01   +6.140057331043577e-01   +5.338478086913100e-01   -1.711083940712663e-01   -4.974313556366772e-01   -8.384070219694796e-02   -4.441891047807336e-01   +1.116217490778634e-01; -4.265291799680086e-01   -8.866658630810978e-01   +3.709625236998266e-01   -3.490790668302719e-01   -5.150917690369423e-02   +5.526270496015371e-02   -3.705497533726874e-01   +3.383908254332014e-01   +6.614699756792364e-01   +1.011756110424737e-01   -3.656936432057360e-01   +7.562724494550183e-01; +6.906919383634542e-01   +2.032063741648249e-01   +5.023077416323705e-01   +7.222804945096235e-01   -4.386019189588482e-02   -5.138408619549393e-01   -3.565757375760362e-01   +3.004185634573115e-01   +6.932351949669854e-01   -3.661993436859918e-01   -4.982138697003101e-01   +7.267043290980295e-01; +7.751494495245964e-01   -4.159757598026869e-03   -4.240241342923566e-01   +1.257375183666850e-01   -1.903999481344329e-01   -4.445388429957539e-01   +5.897320647264899e-01   +7.464969117926923e-01   -1.000000000000000e+00   -6.634337964003780e-01   +3.133234236078968e-01   -4.445599201146007e-01];
L2E_L3E_iAMPA_netcon = [+1.955091663879885e-01   +7.313573443071486e-01   -1.647717287444765e-01   +6.070776032752759e-01   +7.634990045082284e-01   -1.792686397841018e-01   +5.911389667778612e-01   +2.031788626323237e-01; +2.378026418717120e-01   -1.660362091094717e-01   +4.367238906517637e-01   -1.809641404747664e-01   +2.869836690213982e-01   -9.267513887672960e-01   +3.838061391901872e-01   +7.939156305619585e-02; -4.645838043974367e-01   -3.113858964686238e-01   -5.567982081614240e-01   +5.872680004990081e-01   -1.310528802174161e-01   -2.510714452544087e-01   -7.937646156071718e-01   -5.221960927801449e-02; -4.243591251089363e-02   -1.457566161177279e-01   +8.553462183903010e-01   -2.073992424569732e-01   -1.140380166640079e-01   +1.353239194989795e-01   +2.275176998186193e-01   +3.752758987091449e-01; +1.619352239820795e-02   +4.798288960784513e-01   -7.279071549036331e-01   -5.655946419381611e-02   -5.357713620522213e-01   +7.000678995406947e-01   -1.263605386572550e-01   +6.470456694876799e-01; -7.903858256340986e-02   -1.363796740564831e-01   +6.011950846899710e-01   +7.567513244280326e-02   -1.070613332828880e-01   -2.532506514790597e-01   +6.745964310053622e-02   -8.805858502798264e-01; -1.925594319397118e-01   -3.319576541455353e-01   -1.235185416415162e-01   -8.978131113361523e-02   -4.631100058778811e-01   -3.344245610442761e-01   -7.419634167716126e-01   +7.387909945889302e-02; +1.260335478939737e-01   +4.970767291851431e-01   -2.161258802491484e-01   +3.224315018445433e-02   -3.108032617859565e-03   +3.294855261287913e-01   +3.925201231152676e-01   -5.493416935545754e-01; +3.312477416609219e-01   -4.512753456113819e-01   +1.347681957546823e-01   -2.419893107697410e-01   -8.367712959549096e-02   +5.945016418507564e-01   -1.556993433169105e-01   -3.336369616788110e-01; -2.978383612241243e-01   +4.209612552684902e-01   -1.000000000000000e+00   -3.536723389154571e-01   -9.971584616187088e-01   -2.209313508028421e-01   +4.618745308969356e-02   -6.656415364986777e-01; -8.630441549111807e-01   -1.023225838914929e-02   -1.741505236677623e-01   +5.727091384110210e-02   -1.082496827021184e-01   +3.848770281091218e-01   -2.426635370128978e-02   +3.366318113766083e-01; +4.156141052469723e-01   -1.242995761376694e-01   +1.895615262727655e-01   +5.819187761407497e-01   +9.791016686050837e-02   +4.374752454049308e-01   +4.504347394799236e-01   -1.597214961611219e-01];
L2I_L3I_iGABA_netcon = [+4.729976686372717e-02   +2.332216788115621e-01   -4.736650654035300e-01   +1.180539347876549e-01   +4.183571125340721e-01   +4.772445776853890e-01   +1.580405911929553e-01   +1.374142674552287e-01; -3.285798144422078e-01   +6.572490715347969e-01   +2.139716850338500e-01   -8.618605850606077e-01   +1.092884690678357e-01   +9.380208341430483e-01   -8.346636667959819e-01   -3.418658233348641e-01; +6.231261957336418e-02   -8.983359466901450e-02   +1.038209410902858e-01   +5.222591742149484e-01   +4.574243065106497e-01   +1.954467762039437e-01   -2.352524732702680e-01   +1.837824897547470e-01; +3.053621722089502e-01   -3.213648663647366e-01   -4.854281964933873e-01   -2.842612968517452e-01   -6.526099239305319e-01   +5.538198920999582e-01   +9.381891008750003e-01   -5.792842370114692e-01; +8.733401432853427e-02   -5.833980802633532e-01   +1.719380908968244e-01   -7.120084723867846e-01   +2.362209402248951e-01   +4.375871587248208e-01   -7.041220244244627e-02   -4.309244586388109e-01; -5.864164405331920e-01   -1.403569286933698e-01   -7.228335793078784e-01   +4.858293584897191e-01   +9.824122531396740e-01   +8.762449295544482e-01   +9.104874216840657e-01   -1.974409701230501e-01; -9.669298068765264e-03   -7.745735026177480e-03   -1.780751784830383e-01   -4.274272730074534e-01   +3.625912763973321e-01   -3.553136888000672e-01   +4.321614183837171e-01   +7.336295391881729e-01; +2.368525383259777e-01   -5.745863293392364e-02   +6.704116515575309e-02   +3.548790779865129e-01   +2.953174179463571e-01   -2.269124904282119e-01   -5.507973142098419e-01   +4.831827480748487e-01; +1.606519252687349e-01   +2.986882298489344e-01   +8.636246367396836e-01   +1.718467138103713e-02   +4.712732738543494e-01   -7.788286253822263e-02   +8.110763806145781e-01   -5.142615626007142e-01; +1.961472471002687e-01   -9.716717294064183e-01   +1.858214471961910e-01   -6.174990992709440e-01   -4.640396447185005e-01   -4.278500978213695e-01   -3.916362578893084e-01   -4.209933752602336e-01; -3.803100167680720e-01   -1.395067239844250e-01   -1.850460863997448e-01   +3.836866991979604e-02   +5.151614369410871e-01   -5.410560934081670e-01   -3.709117595253675e-01   +2.051651269648870e-01; -4.240588437617233e-01   +5.787036726705508e-01   +6.303814350427873e-01   -4.866639758531623e-02   -2.116535218630646e-01   -2.412647183804101e-01   -5.379663283412186e-01   -1.088286512851536e-01];
L3I_L3E_iAMPA_netcon = [-7.767795177944434e-01   +8.017260546469099e-01   -4.030209705779514e-01   -3.142055129629825e-01   +2.187298791437330e-01   +4.486722387760336e-01   -7.340316209510311e-01   -8.192483930116318e-01   -5.634049845497104e-01   +3.190869730066944e-01   -4.130817473030154e-01   +8.625421003086722e-02; -3.509125828909818e-01   +8.973581910286500e-01   +4.791587582109664e-01   +5.816314893435771e-01   +5.123281739449563e-01   -5.330901715170058e-01   +4.405697628404446e-01   +3.678688464128088e-02   +3.881306047096497e-01   +1.263919434239646e-01   -2.825461044446874e-01   +6.851463332019442e-02; +4.244894407676313e-01   +5.300184295670239e-01   +3.294214653196732e-02   +4.137002673243474e-01   -2.002853852003855e-01   +4.554775279480929e-01   +1.423930420214054e-01   +6.480360132854855e-02   +3.227374999125943e-01   -1.367467678643242e-01   -1.318807742323497e-02   +1.075435117229066e-01; +3.075907664128354e-01   +3.342914213064586e-01   -1.072208532349675e-01   -1.014609873768491e-01   -3.057073550028739e-01   -3.764817612198443e-01   -8.027810780025905e-01   +4.746775361553586e-01   -2.460718093260165e-02   -4.620290901886973e-01   +6.223852472237096e-01   +1.013048693287902e-01; +5.183416604536566e-01   -4.598731157041537e-01   -3.202719752123789e-01   +2.700219455813609e-01   +3.114386169315997e-02   -1.432105850795830e-01   -3.789749245909036e-01   -1.122714099005173e-01   +8.611456696303146e-01   -8.584802836578644e-01   -6.302089022700321e-01   +5.339962572721964e-01; +8.674498800424655e-01   -9.633189467174561e-01   -6.884860607723334e-01   +2.404321596341581e-01   +3.008958488920228e-01   -6.317920900171266e-02   -6.254285316733342e-02   -4.740893936918433e-01   -1.061223477456615e-01   -3.688878847574727e-02   +5.492438344159126e-01   -9.593912525336380e-02; +1.236662287217089e-02   +8.241552343409332e-02   +5.704212731481366e-01   +5.493965066914205e-01   +3.197454168902019e-01   -8.162454455017716e-01   +2.522679084243967e-01   +4.593836250544077e-02   +1.456164237915527e-01   +7.681770121884354e-01   -2.609935861779323e-01   -3.784737659395938e-01; +2.581466013301503e-01   +2.037176561389361e-01   +5.900033876362594e-01   +3.837644167631946e-01   -3.110278043984533e-01   -1.259359923956538e-01   +3.143177067586514e-01   -4.468174985033190e-01   -3.555743567266612e-01   +2.030280168359072e-01   -8.677064894283254e-02   +2.696589450455882e-01; -1.128323850708979e-03   +4.061955418242266e-01   -4.964352733202719e-02   -1.000000000000000e+00   -5.222240625920722e-01   +6.223680812307854e-01   +2.804997176098737e-02   -2.401745887606099e-01   -3.707570564938457e-01   +5.973797577630431e-01   -4.243829456242003e-01   -4.959546648510569e-02; -6.010030554201427e-01   +4.229549053247006e-01   +2.620300027985842e-01   -5.079193801367660e-01   +6.700772800463116e-02   +2.929332161641088e-01   +3.193794846131324e-01   -4.034243084086316e-01   -2.791975108735175e-02   -2.847885308078964e-01   -4.174924987327270e-01   -9.546999739922811e-03; +2.507118113286129e-01   -1.069496443320301e-01   -3.213708213828406e-01   -2.371226062140188e-01   +2.909933625480979e-01   -1.432670361621361e-02   -4.689333695750889e-01   +2.607292924124537e-01   -2.636107739930246e-01   -3.522200618085395e-01   +2.658969000369355e-01   +6.346939824984797e-01; -4.211750488145455e-01   +5.858665644708308e-02   -1.169246950328675e-01   +2.022486233368351e-02   -1.409284200204312e-01   -6.470396709600919e-02   -7.574782814234811e-01   +6.739445297189889e-01   +1.665375484239109e-02   -3.188273319858893e-01   +1.894911810850435e-01   +1.628405606605780e-01];
L3E_L3I_iGABA_netcon = [+2.461420277489494e-01   +4.032948802945402e-01   +2.591440857046970e-01   -8.931836630636089e-02   +3.179837668659035e-01   +2.413414182993295e-01   -2.495086756454591e-02   -4.068513691874165e-01   +4.279419154202214e-01   -4.626691184195149e-01   +6.266037410748883e-02   +5.711643591395714e-01; +5.064473319378734e-01   -1.835932855568301e-01   -7.230910126179664e-01   -2.260048479260993e-01   +5.366988775154011e-02   -2.625640692775172e-01   -3.742388281686354e-01   -2.223413731736257e-01   +2.317817556487637e-01   +2.133755782811202e-02   +3.417287947735210e-01   +9.736175885301145e-02; -2.516908816742092e-01   +2.910305244327624e-01   +1.575148083598557e-01   +6.998757283010676e-01   -5.715513270014860e-01   -2.163719726965034e-01   +7.173829566807660e-02   +3.047904840275302e-01   -1.552564649479487e-01   +1.000000000000000e+00   -8.590142306145435e-01   -1.624251832167483e-01; +3.231405171971142e-01   -3.196951877866975e-01   -3.963531095083502e-01   +2.190717558380364e-01   -3.209026451837731e-01   -3.992601744284375e-01   -4.557469308775827e-01   +3.015728171045610e-01   +2.824904036030209e-01   -5.769378990862632e-02   -1.463693735180618e-01   +2.012928108042567e-01; +2.375246368917392e-02   -5.936793053892044e-02   +7.372868025890220e-02   +3.689815201689438e-01   +1.452859864175251e-01   -4.449956333924645e-01   +8.180463334045594e-02   +7.513169203300172e-01   +5.149463960309087e-01   +3.557374770529834e-02   -4.434867337329967e-01   +1.602057673357306e-01; -9.710484905487567e-02   +3.223008834335004e-01   -8.319861651888928e-02   -2.271697505819910e-01   +5.203411083540818e-02   +3.398847314505576e-01   -2.849508457694390e-01   +7.775915074099068e-01   +7.025497528941117e-01   -6.075560111117503e-01   +1.029685269971912e-01   +2.678902932422437e-01; -3.147248249871490e-01   +9.266304798926671e-02   +4.526190561342663e-01   -3.032173240073551e-01   +6.713158815634671e-02   -2.655494155071100e-01   -8.951261489356486e-01   +4.122647825549877e-01   -3.209983319668868e-01   -3.020959177873186e-01   -2.820606527226249e-01   +6.132491668874901e-02; +1.200024241344522e-01   +6.977551499800690e-01   -4.946722237930947e-01   -6.341297435034704e-04   +1.050247743408865e-01   -8.200764104702154e-01   +9.108877089134421e-02   -1.078216010365018e-01   +4.404436299282566e-01   -7.313143753910946e-01   +3.068416233296783e-02   +1.756859659973430e-01; +1.231149419664166e-01   +6.593566557084816e-01   +4.035483467616796e-01   -1.663616634187114e-01   +4.815234703815906e-02   -2.666006157064944e-01   +2.577152569423986e-02   +7.100756600156010e-01   -6.534296312241407e-01   +2.200502071713907e-01   +6.212517181541762e-01   +1.630171143570208e-01; -3.310403266628879e-01   +5.251085685450273e-01   +7.213255843672097e-01   -6.376377697947379e-01   +4.071562141712832e-01   -4.049899486012868e-02   -4.972538992115889e-02   +2.773545222072337e-01   +7.707526160357122e-01   +9.016006163667447e-01   +3.125255477816074e-01   +1.939129201012402e-02; +3.798487834905341e-01   -2.646575334418788e-02   -4.929328296807738e-01   -4.327619258108932e-01   +4.728933002537958e-01   -7.278188526533999e-02   -3.023459016851417e-01   +3.383670363188082e-01   -4.029176920022684e-01   +1.105740548876791e-04   +7.884289802144663e-01   -3.588385380544116e-01; +1.930172155092240e-02   +1.505336663716534e-01   +5.111026042862858e-02   +1.918060214324755e-01   +3.155890126570102e-01   -1.612069295127034e-01   -1.525082831891334e-01   +4.301941273150515e-01   +3.261412611639263e-01   -6.955575100217873e-01   +6.023757170432039e-01   +1.773290742776348e-02];
L2E_Input1_iAMPA_netcon = [+8.371825738999432e-01   -2.647960310859638e-01   -8.206543816167603e-01   -5.455790732028069e-02   -3.733101337702889e-01   +3.426695820094081e-02   -3.663683799332935e-02   +1.415703231311480e-01];
L2I_Input2_iAMPA_netcon = [-8.534845799383675e-01   +1.364184114058206e-01   +3.329366897102632e-01   +2.134633249377467e-01   -1.604526436918995e-01   +8.472675347881999e-01   +3.120811013081308e-02   -7.849975599131160e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
