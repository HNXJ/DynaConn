function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.144699591018532e-01   +9.466058805715002e-01   +6.990542021622261e-01   +1.546570081893079e-01   +9.201209085416726e-01   +2.189781027362813e-01   +7.404826825845336e-01   +3.027491216493606e-01   +5.322959744488206e-01   +8.292191612931609e-01   +9.694090506656740e-01   +9.646332856222961e-01   +6.970456116309169e-01   +3.725543177235133e-01   +2.981870836171965e-01   +3.773757589368766e-01; +3.466610387805844e-01   +1.239383321215324e-02   +1.425917795254134e-01   +1.753850630730282e-01   +7.222640796435621e-02   +8.093722742302154e-01   +7.946140125080310e-01   +7.579318416977553e-01   +7.846989577509992e-01   +1.825982586522593e-01   +4.659307849686918e-01   +6.548002714567615e-01   +3.766355643814094e-01   +2.757790341434124e-01   +6.858053002704192e-01   +9.525681594857527e-01; +2.074771677246926e-01   +4.684063827400899e-01   +8.392554971527587e-02   +7.021068629821349e-01   +3.136509200603950e-01   +3.829587497521126e-01   +6.642362841008256e-01   +9.538081987700398e-01   +4.869420826478160e-02   +9.244973685168618e-01   +8.708476560060605e-01   +2.086369400108040e-01   +5.408136338506027e-01   +7.565477142923920e-02   +7.737784981543100e-01   +8.134624786405301e-01; +2.304186468673212e-02   +4.902587815852776e-01   +4.325656134654718e-01   +8.338939522372207e-01   +6.295936017094360e-01   +8.573097156531698e-01   +4.399022988391504e-01   +8.286572170285781e-03   +4.618241935183611e-01   +4.196049796316560e-01   +9.462797058684771e-01   +8.982740809184145e-01   +5.175869342101788e-01   +1.505936079213801e-01   +7.201122605058867e-01   +8.907636669410575e-01; +7.655794144763699e-01   +5.157084387505977e-01   +8.947563461771302e-01   +8.066741763493318e-02   +9.060150942901826e-01   +3.223762045944708e-01   +5.753552020971081e-01   +4.058897951770678e-01   +9.380990502052762e-01   +3.008294560214158e-01   +2.331052956226032e-01   +4.884693234547134e-01   +7.640395841274297e-01   +3.659066539975159e-01   +2.777070155848381e-01   +6.930026950754183e-02; +5.715813224719395e-01   +2.875760997298655e-01   +7.323211343015645e-01   +8.357940967172250e-01   +7.971623703606966e-01   +3.798338459554149e-01   +5.185725901621733e-01   +1.535293336739867e-01   +4.736093550223322e-01   +3.473610466507272e-01   +9.175783103203868e-01   +6.633942377228133e-01   +8.053990088756845e-02   +7.165064190704437e-01   +1.317163141844417e-02   +9.025616176558946e-01; +5.770255291633536e-01   +5.649719368351894e-01   +6.809465163131296e-01   +5.422170824582966e-01   +6.420670329288823e-01   +6.372008190943416e-01   +7.237197820244057e-01   +8.209101805836574e-01   +7.792679156326016e-01   +9.712202082250881e-01   +6.333270297206774e-01   +5.266845279255089e-01   +4.790406440591642e-03   +5.328516609927479e-01   +1.551209857475779e-02   +6.666644629819272e-01; +3.888399279484138e-01   +5.110542074788231e-01   +2.029981340738224e-01   +9.625769162851271e-01   +4.393039438260945e-01   +3.863165303308977e-01   +2.208226309137609e-01   +2.883773224055431e-01   +1.099730811402507e-01   +5.312922675490013e-01   +2.841693702695757e-01   +7.088377192649536e-01   +4.029962515412212e-01   +2.326407537816761e-01   +9.355678673467809e-01   +3.462954998728289e-01; +5.553320740191089e-01   +6.777673185618392e-01   +5.294895326093620e-01   +6.772859736241792e-01   +7.491375224046136e-01   +6.886987296670971e-02   +9.984512726222183e-01   +9.774817609852114e-01   +5.214725749130178e-01   +7.910602745978779e-01   +8.549224811196039e-01   +7.192988645181966e-01   +6.622396223985184e-01   +4.715482558668450e-01   +9.332865606964998e-01   +8.371461969292725e-01; +1.831498481034014e-01   +6.162734253511013e-01   +8.307803920399373e-01   +3.346689705716447e-01   +8.263821733334278e-01   +1.726170129092893e-02   +6.189517174215579e-01   +6.262177826322132e-01   +6.362015362238529e-01   +7.940591243325825e-01   +1.665407196623707e-01   +2.945489598357391e-01   +3.682181259266261e-01   +7.163518631864740e-01   +3.718437971044687e-01   +1.977143342995386e-01; +1.173501589733400e-01   +5.645982438988915e-01   +1.749859574830919e-01   +2.203611044614651e-01   +3.413773543368888e-01   +8.795911180670741e-01   +9.808435257759016e-01   +7.440565110657168e-01   +5.787286584717897e-01   +1.433625534730946e-01   +8.269002273927484e-01   +1.169680817240110e-01   +3.935966117062518e-01   +5.135182897342907e-01   +1.088841991506460e-01   +8.412770800238141e-01; +5.867673369898269e-02   +5.051024321465044e-01   +5.170426033500736e-01   +5.679809048014688e-01   +1.395496749010062e-01   +1.561962936931295e-01   +4.952409290119553e-01   +8.730162362995156e-01   +8.357280023946935e-01   +4.563009479175115e-01   +2.162970839886633e-01   +3.241938850672062e-01   +1.336747724370109e-01   +5.135519516629078e-01   +7.193443342021432e-01   +4.248991168872351e-01; +9.341124222975182e-01   +6.664945444484821e-01   +3.556976869206931e-01   +7.451914695315494e-04   +5.057582046972683e-01   +9.142618294713891e-01   +5.214557015041911e-01   +3.289619050148629e-01   +1.162785138128097e-01   +4.579759448593814e-01   +2.670482008524934e-01   +4.557752713457522e-01   +3.385853283075239e-01   +3.862642754926148e-01   +4.483293084104117e-01   +5.596436086253727e-01; +7.457884089467240e-01   +6.335662686105947e-01   +6.469264693490663e-01   +5.884754162675582e-01   +4.137699522983710e-01   +5.576291994688182e-01   +8.534907291344593e-01   +9.829456971346204e-02   +5.190437775015957e-02   +9.556222251561103e-01   +8.892152384599213e-02   +7.151113172388149e-01   +1.219838484891091e-01   +4.781858962514238e-01   +1.238921023811109e-02   +4.469207778619411e-01; +2.446049448675660e-01   +1.442863744206755e-01   +2.798360690688970e-01   +8.913159524070546e-01   +1.721919394138665e-01   +9.220304916791209e-01   +2.545688575181403e-01   +4.510980318078078e-01   +5.166600783635075e-01   +5.362787223714952e-02   +9.169121179623768e-01   +4.053851468973778e-01   +3.685332483647825e-01   +7.399800162440778e-01   +1.236944687605755e-01   +7.600880892348078e-01; +2.048939986958551e-01   +1.778983284682640e-01   +4.351643457046431e-01   +2.551235810461069e-01   +4.938012696939965e-01   +5.964361556309286e-01   +5.813164441375187e-01   +2.399774495288547e-01   +6.968468699447807e-01   +3.573949845011802e-02   +7.268331877378917e-01   +2.426267540635047e-01   +2.518704148419054e-01   +7.026324846333430e-01   +6.588593959826800e-01   +9.709319990825964e-02];
L1E_L1I_iGABA_netcon = [+8.433904953819784e-01   +7.529426768059894e-01   +8.744709882142834e-01   +4.365056057612510e-01   +9.182667562380498e-01   +7.778933340277795e-01   +3.215699205997608e-01   +6.420711771087567e-01   +9.376328263340805e-02   +2.667224203538181e-02   +1.287389494011883e-01   +5.190209295759046e-01   +8.702571115745547e-01   +5.756959715759654e-01   +1.667019806985566e-01   +6.272469547975629e-01; +6.201246884929082e-01   +9.964672582071685e-01   +3.090533682708191e-01   +1.479336081031692e-01   +8.828270722506889e-01   +2.737895503290736e-01   +9.625678494236144e-01   +4.296785489625646e-01   +2.926725812209212e-01   +5.138447364956498e-01   +4.226222095196729e-01   +2.040595251141656e-01   +8.050653309904248e-01   +2.888906644651418e-01   +5.473370760338798e-02   +3.371741500734054e-01; +6.717195422433418e-01   +3.709292390561165e-01   +4.330962858538058e-01   +6.536865750124788e-01   +5.854481229140390e-01   +5.266139861835104e-01   +3.525320254644299e-01   +4.796510376465848e-01   +3.270730406833401e-01   +8.636614904999861e-01   +4.805445175719656e-01   +7.759014286228048e-01   +6.464035782771428e-01   +1.323864156296939e-01   +2.123144378942916e-01   +1.570234282696227e-01; +7.820402624068944e-01   +5.033886887684220e-01   +3.813592085747177e-01   +7.223943041632593e-01   +8.346981996171987e-01   +4.033456366662813e-01   +3.203385914767143e-01   +1.009405340204780e-01   +4.820273751144688e-01   +5.833615368094113e-01   +6.728451952496152e-01   +3.926509526029081e-01   +7.340070407289809e-01   +5.031388840509973e-02   +2.029512742199230e-01   +4.005613094894018e-01; +3.090949320359172e-01   +7.564004504709322e-01   +6.570120365224045e-01   +1.612023035892523e-01   +7.760053656175245e-01   +7.805870036065163e-01   +9.088240467492466e-01   +8.063489774780165e-01   +2.410804889603878e-01   +4.219296079786906e-01   +3.571534663095889e-01   +6.654235567727874e-02   +6.661334161703412e-01   +6.220122789069111e-01   +2.178070975425534e-01   +9.128986287370220e-01; +3.299775170589989e-01   +1.278502538358611e-01   +2.382741635676230e-01   +3.423771577372602e-01   +7.863604599607673e-01   +2.584742159051206e-02   +8.850068513509478e-01   +6.362136906070738e-02   +4.533892237997784e-01   +7.132673673989269e-01   +4.974484970490767e-02   +7.572127173167389e-01   +8.801569173080933e-01   +6.056348945892555e-01   +5.797160351804850e-01   +1.479456351910823e-01; +6.341216028664773e-01   +5.181402434286515e-01   +6.859855079086155e-01   +1.051281483844141e-01   +7.003728763143950e-01   +4.118774743805284e-01   +3.536060061549558e-01   +9.542740474249934e-01   +7.582112581407103e-01   +2.339026075086171e-01   +2.895424748564752e-01   +4.543063294216034e-01   +8.525606112145375e-01   +3.724801969372654e-01   +3.302233818437305e-02   +4.647630735765312e-01; +9.015945143148150e-01   +9.057444421126116e-01   +3.268161293373184e-01   +4.139665396498646e-02   +1.810622596119311e-02   +8.252312666782884e-01   +7.499213795267893e-01   +7.728458382456839e-01   +7.165054839847402e-01   +5.865954185233652e-02   +7.932777235141676e-01   +3.203107437937071e-01   +4.039314743243592e-01   +8.314151386582145e-01   +7.945371382160998e-01   +7.640244870385207e-02; +3.701475607722639e-01   +9.841300719618019e-02   +8.807254554483832e-01   +4.781484080733539e-01   +3.293545373356249e-01   +5.918553686445428e-01   +1.259629120547922e-01   +4.417682237943642e-01   +2.367573957612431e-01   +9.746357155521261e-01   +6.509925012651653e-01   +2.781470685348367e-01   +1.044670543947695e-01   +5.201294793835468e-01   +1.348599730399241e-01   +3.409441674993424e-01; +8.822086316049197e-01   +1.786364873246910e-01   +9.986297926945369e-01   +4.777827171239265e-01   +9.468851401098345e-01   +2.139063486023919e-01   +6.001274387259974e-01   +1.648724155898202e-01   +6.993376746946890e-01   +9.694026923759765e-01   +7.093606373728302e-01   +5.835481436018710e-01   +4.030982563315177e-01   +8.011441830779980e-01   +5.836418284232288e-01   +4.963844672378016e-01; +1.240597194988853e-01   +1.720080562845612e-01   +6.818755385338525e-01   +5.454583397894980e-01   +3.990325242188244e-01   +2.959038994478091e-01   +4.376182645441014e-01   +7.979622017169795e-02   +3.054750169325209e-01   +1.369012085840245e-01   +7.644243189219265e-01   +9.128370606335749e-01   +3.402078929045022e-01   +5.708269132222705e-01   +8.474638506374396e-02   +4.902717120491701e-01; +8.854673117413601e-02   +5.341653479341336e-01   +3.451602108754595e-01   +6.526941093520555e-01   +6.329290936400060e-01   +2.688110689298128e-01   +9.590980291514825e-01   +7.417923881894670e-01   +4.686746425145799e-01   -5.128310645025605e-04   +3.853853357544680e-01   +4.510094895012466e-01   +1.149716090178192e-01   +7.146560004531689e-01   +2.293184671360690e-01   +1.282887012360202e-01; +5.464633995370340e-01   +9.790037683635630e-01   +5.599958365945666e-01   +3.484024994980426e-01   +8.587289751368150e-01   +9.282744801898787e-01   +9.646632645858434e-01   +5.433830062750040e-01   +4.439443112901409e-01   +9.355497655646542e-01   +3.628221565720883e-01   +9.800757705729042e-01   +8.514410865045471e-01   +7.329803797768167e-01   +4.530014200491475e-01   +8.412692428454563e-02; +6.111182311163426e-01   +8.432011163074531e-01   +8.905929094046571e-01   +2.559791689017130e-01   +3.763536145903692e-01   +5.529798647370565e-01   +2.426447729149838e-01   +4.854479154858403e-01   +7.339926809243144e-01   +7.398776599374222e-01   +8.119782384593091e-01   +1.102808011710416e-01   +8.916140013540965e-01   +4.538713608005139e-01   +1.792691300634784e-01   +6.740810500745855e-01; +7.284997487852856e-01   +6.711619426781209e-01   +6.469053087383930e-01   +1.764069106746127e-01   +2.039710781893182e-01   +4.324927566297604e-01   +7.703440499610396e-01   +8.946371242953045e-01   +8.758868933374931e-01   +4.312844145190813e-01   +3.866358288701651e-01   +4.157293074077352e-01   +6.866025318091883e-01   +2.826081984186868e-01   +4.157333853719940e-01   +1.207808325419688e-01; +9.902056608676877e-01   +8.340144079169085e-03   +3.771058045853258e-01   +4.772901557240845e-01   +9.111410480625769e-01   +3.288366598914556e-01   +7.124952914640026e-01   +5.824574491898094e-01   +9.129328686209227e-01   +9.443610155043224e-01   +8.719672637467537e-01   +3.848663702099858e-01   +7.431063566337204e-01   +1.524890676308459e-01   +9.661485523667682e-01   +9.894491018666329e-01];
L2I_L1I_iGABA_netcon = [+5.745420388347635e-01   +5.631249972584101e-01   +1.097818073276011e-01   +4.587861692868744e-01   +7.967012964378868e-01   +9.793907489356509e-01   +2.234749477314536e-01   +7.586983719753506e-01; +5.573468258077167e-01   +9.527500683720393e-01   +1.193206749762837e-01   +5.668371817981076e-01   +5.418526916998109e-01   +4.223572433677429e-01   +6.587474696144115e-02   +5.049392406182315e-01; +6.119205023490085e-01   +8.921009029208934e-03   +4.334191628727631e-01   +8.176165512458027e-01   +2.576201124601781e-01   +3.939896376253430e-01   +8.356619673490499e-01   +8.268906705702905e-01; +4.668728722661653e-01   +1.279896148005103e-01   +9.338273256762156e-01   +3.553555444542126e-01   +7.814984741689128e-01   +4.610207676481352e-01   +4.220726451265407e-02   +9.271742894291058e-01; +4.344373512064986e-01   +8.526040013907694e-01   +1.400203858710389e-01   +2.484901699804963e-01   +7.780608919137915e-01   +1.231086115250522e-01   +9.091357114664451e-01   +7.111270254098823e-01; +6.452028534011159e-02   +2.184312787365095e-01   +8.261483593742228e-01   +7.706363011848675e-01   +1.446529859451448e-01   +4.553445356341976e-01   +4.497673395380094e-01   +7.967014345260826e-01; +6.467965359196010e-01   +7.085587977948649e-01   +9.320573079161815e-01   +1.568097589258459e-03   +8.240805453541710e-01   +2.657328081850951e-01   +2.846871775938810e-01   +9.585601812977017e-01; +4.245734387428330e-01   +7.737192976819640e-01   +5.725489215492151e-01   +2.752302217367552e-01   +6.229256300869751e-01   +9.318358828438902e-02   +7.548186424092539e-01   +9.520600723749112e-01; +7.557979369786153e-01   +4.215539493723343e-01   +4.983711284736356e-01   +2.383505675721916e-02   +4.580542957362007e-01   +6.609975530581090e-01   +9.268889247588129e-01   +2.967863536054776e-01; +3.076605710194648e-01   +7.245574473252946e-01   +9.310343307284853e-01   +6.699890029395081e-01   +4.831760278146028e-01   +9.456212395501967e-01   +1.410875710683973e-01   +3.510130391578589e-01; +5.989688906553569e-01   +4.573787332477652e-01   +8.621651337601822e-01   +9.673768184103948e-01   +2.185512955678660e-01   +7.647000646134420e-01   +9.564006376341631e-01   +5.419284853197874e-01; +3.346557184781082e-01   +8.051731824414269e-01   +2.524395338134064e-01   +9.456562285209003e-01   +8.570761932428949e-01   +4.237093118172066e-02   +3.045623941958041e-01   +2.140154131956223e-01; +6.435766263472505e-01   +4.282460286754471e-01   +4.601948899654543e-01   +4.702389562351227e-02   +8.794939519854066e-01   +2.609406761547498e-01   +2.085521360326392e-01   +8.124735010338972e-02; +2.148934356562555e-03   +1.490646303171597e-01   +7.407418361859727e-01   +2.862033190143314e-01   +8.452175018467971e-01   +6.353275807539955e-01   +4.639253329971646e-01   +5.052050075233474e-01; +1.436111184584450e-01   +8.036503756254870e-01   +7.527961446538453e-01   +4.885552166804870e-01   +4.420362297488464e-01   +8.931635922571982e-02   +5.963658046458321e-01   +1.938243025397211e-01; +2.469787354582045e-01   +3.796225705396923e-01   +2.300791974961195e-01   +8.872219293880963e-01   +5.429843999280117e-01   +7.542123776177610e-02   +5.534590221083189e-01   +1.448986416003042e-01];
L1I_L2I_iGABA_netcon = [+6.981429982926283e-01   +8.670614884487996e-01   +6.152782804349721e-01   +5.447317929693887e-02   +1.441554060792849e-01   +2.349532345782332e-01   +8.400621938327257e-01   +3.698272266166279e-01   +7.076155831916787e-01   +3.827316229848602e-01   +2.394457678084758e-01   +6.668755701427218e-01   +1.671149781779964e-01   +5.698280296955914e-01   +4.333926401996457e-02   +4.818890747462857e-02; +5.984342698689450e-01   +7.979196773218871e-01   +6.097914573596961e-01   +5.817945435852465e-02   +7.456310041610061e-01   +5.550650545428820e-01   +1.982342464248579e-01   +5.583566769588310e-01   +1.875909804379562e-01   +7.202594930614242e-01   +5.118415287699355e-01   +3.298819501397612e-01   +1.150063249435904e-01   +8.103245807946627e-01   +4.418965290911660e-01   +9.204803252726649e-01; +1.634307110087629e-01   +6.272700881674745e-01   +3.131339641286067e-01   +5.971227889255267e-01   +9.507997155685944e-01   +1.148167432217788e-01   +6.167400991220671e-01   +8.300365613039179e-01   +2.299720405445417e-01   +6.400908213868910e-01   +7.326079707892815e-01   +5.529396166385980e-01   +7.373392435094639e-01   +6.748045804398680e-01   +9.187814085634416e-01   +1.733007173290318e-01; +4.832939810191583e-01   +4.716115908870545e-01   +1.420964269716746e-01   +6.578553647345758e-01   +2.648952933180322e-01   +8.179797282703251e-01   +1.541602094543444e-01   +7.090251118390998e-01   +9.982579520189326e-01   +9.986309023434822e-02   +7.719250940821235e-01   +5.324356890641083e-01   +2.105159057222979e-01   +4.433765806925733e-01   +8.845995669361801e-01   +7.432846060946069e-01; +2.857442347969714e-01   +2.063167568700988e-02   +6.037150842837198e-01   +4.796402992787844e-01   +9.620129940990853e-02   +6.510500228272318e-01   +5.831599901155188e-01   +1.153849947241434e-01   +9.044159020391063e-01   +4.927572515834733e-01   +6.766556094723685e-01   +9.017764327964184e-01   +4.826732545282466e-01   +8.932166521080326e-01   +9.202260273769207e-02   +4.756457357838509e-01; +4.036364611041753e-01   +1.176772409452218e-01   +8.901919406554751e-01   +9.785342032415043e-01   +2.291800804447692e-01   +2.363795512966169e-01   +5.442150739406934e-01   +7.406523597985426e-01   +1.036716223794472e-02   +5.616320644135961e-01   +8.134516850942083e-01   +2.836727054214233e-01   +5.067233713975361e-02   +7.835601493645590e-01   +6.758690828395595e-01   +2.472913250562294e-01; +4.901255464196215e-01   +7.191778458638967e-01   +5.622663249893857e-01   +8.641563408501338e-01   +8.954980981342300e-01   +3.025750382705041e-01   +6.821853104392228e-01   +9.250198172689912e-01   +8.351414633046346e-01   +5.665762114568123e-02   +4.172245953808142e-01   +1.385599795007387e-01   +5.725962715755770e-01   +5.817420399316593e-01   +8.485420544093352e-03   +6.642341710252579e-01; +8.625160555552920e-01   +6.812160149029612e-01   +6.319573372671105e-01   +9.530980463402908e-01   +1.982719135176520e-01   +3.311621008239106e-01   +6.976796030607669e-01   +9.236605224976940e-01   +2.519297992247526e-01   +8.952987772585652e-02   +4.986323218170301e-01   +9.569857384828907e-01   +4.917065427016412e-01   +6.150680680509294e-01   +1.208388141154117e-01   +6.075533694973916e-01];
L2E_L1E_iAMPA_netcon = [+3.678330835374458e-01   +5.634522343767004e-01   +2.007552208953364e-01   +5.152174083414931e-01   +2.901011427110586e-01   +7.496918039848344e-02   +2.778547935317078e-01   +2.657283255787252e-01; +4.371105021347991e-01   +1.921480762129080e-01   +1.368251072183132e-01   +6.856948689441613e-01   +6.186963133101220e-01   +5.958285305776920e-01   +9.276783846441666e-01   +9.053964576491461e-01; +7.190798424831351e-01   +6.122869485889060e-01   +8.156810632621017e-02   +2.073296032827256e-01   +8.649846953102918e-01   +7.860375569298263e-02   +7.636050535115192e-01   +1.592760050185653e-01; +1.922241896042459e-01   +7.401149102075320e-01   +9.176875413087765e-02   +9.722404102519200e-01   +8.211409850184184e-01   +3.968465538523010e-01   +2.634820401053101e-01   +5.539721603201173e-01; +3.979620228377312e-02   +8.341894134012311e-01   +5.525417353653791e-01   +3.508011253117717e-01   +2.072599252754455e-01   +5.997720138648158e-02   +2.417943357365275e-01   +4.225966060070631e-01; +3.150904736440880e-01   +2.798309815733846e-01   +7.315588388095227e-01   +1.837458743015741e-01   +7.507502537940390e-01   +1.290304479210751e-01   +1.653132101917414e-01   +5.475846592819230e-01; +7.898918213786514e-01   +6.076572260177098e-01   +5.444478571298594e-01   +2.387146106205581e-01   +1.985935063241739e-01   +2.431333049916361e-01   +2.878777685192446e-01   +7.535741763283202e-01; +4.706966869480576e-02   +5.467965147701515e-01   +5.395837384477842e-02   +2.550813970364280e-01   +5.790412334458421e-01   +9.449320559786778e-01   +5.643124095254798e-01   +1.300925187216539e-02; +2.160599991731217e-01   +2.755598223513623e-01   +6.334256581487657e-01   +2.212378441599509e-01   +8.774484440361990e-01   +2.028759195546468e-01   +4.045229258524211e-01   -9.154098264751770e-05; +2.748235344819188e-01   +3.393591483505956e-01   +9.943650469222309e-01   +3.465475677225251e-02   +7.131390681853634e-01   +3.265974727700584e-01   +9.880134223645931e-01   +2.024618006895582e-02; +7.888237131921929e-01   +5.666826111993960e-01   +9.145058087093950e-01   +3.576203153370096e-01   +7.010774655915316e-01   +8.656091653200846e-01   +5.441211075991685e-01   +3.592471984579571e-01; +9.913257557521949e-01   +7.435676929023453e-01   +7.681548206671976e-01   +8.985566390854414e-01   +4.673659212574451e-01   +9.229565605485874e-01   +9.270940894416619e-01   +4.255059264724627e-01; +9.562345020597247e-02   +7.713182237882695e-01   +1.918018303680736e-01   +1.401669696223268e-01   +5.047934126867604e-01   +2.431203306871248e-02   +9.935912735239056e-01   +5.455928834589345e-01; +1.952932798191884e-01   +3.985662994673719e-01   +3.229486873936506e-02   +9.556723230670213e-01   +7.985230625088370e-01   +3.649737332370027e-01   +8.354967008220230e-01   +4.920885451531369e-01; +1.166014194089068e-01   +1.482729644208218e-01   +3.738503445713803e-01   +9.032433030333655e-01   +9.391301494574429e-01   +5.284119267151428e-01   +1.808118612167340e-01   +9.219287447026964e-01; +6.466328508769840e-01   +2.071979099588739e-01   +5.756867636285991e-01   +4.107281293319252e-01   +7.837570636582231e-01   +4.063709951407922e-01   +3.130394826964192e-01   +4.150498309975829e-01];
L1E_L2E_iAMPA_netcon = [+4.986369523065023e-01   +4.495818739022054e-01   +6.156222419390057e-01   +4.897023459853743e-01   +2.307689466231194e-01   +7.223804999599093e-01   +6.943816764262702e-01   +6.326678920983201e-01   +5.227685017335455e-01   +2.404458433171921e-01   +8.779581497234663e-01   +1.738390417957044e-01   +1.366240471407124e-01   +2.427336513582425e-01   +1.842146776760258e-01   +2.355003707867572e-02; +8.393382206350821e-01   +3.694488011585905e-01   +1.027827829357195e-01   +6.603278727546260e-01   +8.374882670037312e-01   +3.816214893726832e-01   +9.799805456848637e-01   +6.259842446372782e-01   +6.740439582440489e-01   +7.308804779837340e-01   +6.583316565044720e-01   +3.036838203420434e-01   +2.837641271235083e-01   +7.477967000656687e-01   +1.464683944299040e-01   +2.505599785241107e-01; +1.845883372817622e-01   +3.004388496075301e-01   +7.535859486643928e-01   +1.774011663116039e-01   +7.338223816497295e-01   +3.844448238696970e-01   +7.520720649794651e-01   +4.074052396191726e-01   +7.775308616978709e-01   +1.353346908974326e-01   +5.374002612611295e-01   +1.097624729304683e-01   +6.199879048096831e-03   +9.364178861171777e-01   +1.335830553858751e-01   +9.886238977596791e-01; +3.354950988759406e-01   +2.325021172301830e-01   +5.375499341353707e-01   +4.786394987081214e-01   +4.904474394024549e-01   +7.142514244924963e-01   +5.528326181110721e-01   +4.256278372743572e-01   +4.634648431514649e-01   +4.197561431815798e-02   +2.519018690419662e-01   +4.519517649676493e-01   +3.065246926741794e-01   +2.983916131585250e-02   +1.726356349552092e-01   +6.300751561258913e-01; +6.945599896210122e-01   +1.370865976048118e-01   +4.427583119398708e-01   +4.989448235928247e-01   +8.498902556192447e-01   +8.393274019137565e-01   +2.922221342141032e-02   +5.114172525755100e-01   +9.083697693733416e-01   +6.490939523879172e-01   +1.058375135774979e-01   +5.845881623271355e-01   +9.037930154413456e-01   +4.363564788312021e-01   +9.228894377971754e-01   +3.567194637535831e-01; +6.925374032697083e-01   +1.001143327684271e-01   +7.439832901403245e-01   +6.002883316786133e-01   +7.147183568527318e-01   +6.685126532171723e-01   +1.965388613134071e-01   +2.580407945688497e-01   +2.384336712775147e-02   +1.996053245758760e-01   +9.721867823066220e-01   +2.250923487363241e-01   +2.944244782295940e-01   +8.314313886263880e-01   +2.601007025116212e-01   +9.406498918114960e-02; +3.687072072503710e-01   +2.263602436088005e-01   +3.875202631414963e-01   +2.412268002808242e-01   +5.214281243862748e-01   +6.495233003483964e-01   +9.423567278058792e-01   +4.225577862681210e-01   +4.808943869758946e-01   +9.728118830183086e-01   +5.978082144497566e-01   +1.103826492942925e-01   +8.331636217659786e-01   +9.988009398102593e-01   +2.064335583767621e-01   +4.095969457695142e-01; +3.268547811930340e-02   +3.474446263456408e-01   +5.263341107991152e-01   +5.165471649359367e-01   +9.395693388717461e-01   +5.644501406297994e-01   +3.965075858760862e-01   +5.238047806835721e-01   +2.710664663387478e-01   +8.206300674927870e-01   +8.186759104821216e-01   +5.611635073234967e-01   +7.442489806918731e-01   +9.197265783907811e-01   +6.128375732782220e-01   +9.308799038941000e-01];
L2I_L2E_iAMPA_netcon = [+6.776723049107141e-01   +6.152353547724618e-01   +4.147119138921274e-02   +7.942422633202898e-01   +5.234851695624909e-01   +8.256800836527325e-01   +6.460104866220243e-01   +3.854575202860265e-01; +2.396423049926643e-02   +9.436113851750321e-01   +5.436225330512935e-02   +9.312767758461072e-01   +5.457703428164778e-02   +1.077443155096952e-01   +4.082326871073191e-02   +1.675353849934161e-01; +7.353472405291805e-01   +9.647864742508981e-01   +4.020697093883671e-01   +9.361439023966852e-01   +2.869860106747919e-01   +2.311708133196569e-02   +5.679721147126746e-01   +4.443305103200177e-01; +2.131802150838435e-01   +3.700808129338330e-01   +9.836088763639550e-01   +1.460602799067343e-01   +7.085103605364726e-01   +1.285216368082153e-02   +3.054872322664502e-01   +8.739767455987452e-01; +8.598291298452035e-01   +7.952981360377143e-01   +7.124343363892117e-01   +3.192544369016724e-01   +8.796048740631739e-01   +3.356703886526715e-01   +2.611490512309252e-01   +4.105648540361565e-01; +1.571826087406939e-01   +7.282748871147827e-01   +9.887097493185976e-01   +4.288940630350966e-01   +3.656101587989521e-01   +6.634982756705304e-01   +7.218396749717249e-01   +1.616526715338408e-01; +6.694814032964589e-01   +9.533321882375210e-01   +6.458717354046087e-01   +7.029655105554712e-01   +5.613333449646204e-01   +5.948377076686276e-01   +3.052908212071724e-01   +6.620123368440486e-01; +9.348983584674485e-01   +1.116485153583707e-02   +5.004687981792780e-01   +6.153149460933843e-01   +8.838197627261751e-01   +7.961278086266238e-02   +8.966931343247684e-01   +9.260647801557459e-01];
L2E_L2I_iGABA_netcon = [+6.129979680744276e-02   +5.197539033228264e-01   +3.536655824655289e-01   +2.600947396672285e-01   +4.185258218690353e-02   +8.917323223337537e-01   +3.431184451293806e-01   +4.513998026897594e-01; +3.547477352894249e-01   +6.894257568162482e-02   +5.575489943480648e-01   +9.841075661834827e-01   +3.610537849252217e-01   +5.407747754455768e-01   +9.354330018668965e-01   +6.715621182596456e-01; +9.330236940281105e-01   +1.846670295265026e-01   +6.911284460078413e-01   +3.489467889316220e-01   +3.648166117372862e-02   +7.168309645595556e-01   +9.179725577275887e-01   +7.699998315824259e-01; +2.398078919108700e-01   +3.162992217019542e-01   -6.163736336185882e-03   +4.018501624891035e-01   +4.856672311672621e-01   +7.103387622904807e-01   +7.253888788832107e-01   +9.268068538567131e-01; +1.037829972117934e-01   +2.450072907603320e-01   +4.789767922319181e-02   +7.529815961917115e-01   +7.231222888416245e-01   +1.675223451813659e-01   +4.447280987205273e-01   +6.596341827955381e-01; +7.156253377106977e-01   +3.221309557183129e-01   +3.078460665498966e-01   +1.028891527031180e-01   +1.395960312492051e-02   +3.522095437149520e-01   +1.527710552171207e-01   +5.018339345896284e-01; +6.258539541994890e-03   +8.808047405473407e-01   +8.692845233286636e-01   +5.903189927662063e-01   +5.171550792453026e-01   +3.797121026302108e-01   +8.333159644057588e-01   +3.429786562980642e-01; +1.842579221399163e-01   +3.007488127525942e-01   +6.266985566552987e-01   +1.222419562749736e-01   +2.399400912548562e-01   +7.576703971695014e-01   +2.581233924306918e-01   +9.454310297137588e-01];
L3E_L2E_iAMPA_netcon = [+8.036687839493561e-02   +1.618408348387026e-02   +3.689112331478646e-01   +4.958868747134471e-01   +1.884945082640967e-02   +9.542940356144625e-01   +3.600996755025705e-01   +1.354118762159128e-02   +2.052224543436204e-01   +6.100402671183354e-02   +2.435446097102228e-01   +1.000000000000000e+00; +9.514324471619166e-01   +9.771759880550194e-01   +1.163922961571387e-01   +6.534392730245933e-02   +8.055968860656454e-01   +3.881740803714398e-01   +2.243839350738916e-01   +1.222083340744362e-01   +3.562864843010312e-01   +7.406653912618392e-01   +5.325357988703375e-01   +3.451974639274318e-01; +6.629879798837136e-01   +7.255743558473968e-01   +5.144236770769193e-01   +8.627786288442625e-01   +7.938592124537032e-01   +6.637180020181195e-01   +7.246012424882140e-01   +6.692795078336109e-01   +8.883095360936962e-01   +9.899134226767466e-01   +3.337510427172424e-01   +8.223874415176561e-01; +1.699289623474529e-01   +8.707111676284408e-01   +6.135341067544201e-03   +9.965363793424745e-01   +4.225628168291687e-01   +5.833399782362417e-01   +7.721743925378586e-01   +5.071759174539282e-01   +8.100407484784209e-01   +7.675418680088568e-01   +6.729419748238128e-01   +1.112143724607673e-01; +1.953885096652420e-01   +8.147190996530742e-01   +8.696532818371052e-01   +1.228689562128733e-01   +6.288535439692713e-01   +5.869240931561716e-02   +3.443096193388847e-01   +7.142052397519008e-02   +3.184060201172534e-01   +8.815395800781115e-01   +8.740723912977828e-01   +7.744469205161304e-01; +9.953198775739456e-01   +3.151449215544850e-02   +9.042769103101679e-01   +9.965515993619553e-02   +5.675855172210166e-01   +7.572387679959024e-02   +5.774826137874077e-01   +5.358770540656164e-01   +5.991624274645238e-01   +3.499439354351606e-02   +9.836894554269817e-01   +1.510810225275540e-01; +9.250178111347720e-01   +9.706843720118807e-02   +1.136714367585184e-01   +1.491460550853498e-01   +8.966018201384658e-01   +2.268088271357818e-01   +6.435683083560110e-01   +6.777531808759425e-01   +6.976235786432456e-01   +7.932172622045203e-01   +1.440898911949101e-01   +7.314238082456904e-01; +9.818761658393815e-01   +8.645386880465480e-02   +4.471832665209852e-02   +1.281653538439295e-01   +7.481232080445215e-01   +4.207291167192422e-01   +3.670949964308354e-01   +5.871060466943316e-01   +1.782869316682010e-01   +7.065696647941705e-01   +8.784858418421749e-01   +1.095595147211682e-01];
L3I_L2I_iGABA_netcon = [+7.677523691221723e-01   +5.361186554486569e-01   +5.981451491540543e-01   +3.047558057657642e-01   +9.662532204051480e-01   +1.146858769668831e-01   +2.972748108443304e-01   +7.961318668338282e-01   +9.146270189337742e-01   +9.935122547298747e-01   +3.084143548772534e-01   +9.966927905160949e-01; +6.375394786471210e-01   +4.521834427949815e-01   +5.617365214994260e-01   +7.623105600651573e-01   +5.430450448151372e-01   +6.944824311143097e-02   +1.696676934432276e-01   +5.175725371408019e-02   +3.865598225168974e-01   +2.871946743071592e-01   +4.422956001707377e-01   +9.136874164789645e-01; +7.967615321773891e-01   +1.139284394577605e-01   +6.804264711839572e-02   +6.477883897852031e-01   +9.812767065809789e-01   +5.211505457986492e-02   +7.232046754026085e-01   +1.808204467298802e-01   +7.504998807745834e-01   +5.163365384894235e-01   +2.092849302563493e-01   +6.912542826703397e-01; +9.610495511576430e-01   +7.203165040202101e-01   +7.682103183849501e-01   +3.319689232351259e-01   +1.235111508460892e-01   +1.301998431900410e-01   +2.991816789550185e-01   +2.458143863642223e-01   +8.798825337450927e-01   +3.599817099841419e-01   +9.398472294891651e-01   +2.212856367149555e-01; +7.160165283970988e-01   +1.874285019648500e-01   +8.668396619834543e-01   +9.720359103590892e-01   +1.670629456087199e-01   +4.921610144219800e-01   +6.777337024971921e-01   +2.616994002971148e-01   +3.927273490435650e-01   +5.179984058693208e-01   +2.898133478948425e-01   +3.153443999669946e-01; +6.424585650593099e-01   +3.235111385422058e-01   +7.089590474702147e-01   +5.337627145190587e-01   +3.338702552345520e-01   +4.674088737962774e-01   +7.460521279525673e-01   +6.486495256041835e-01   +1.670091400888364e-01   +5.016109697679042e-01   +1.224230744653266e-01   +2.361987641081826e-01; +5.116218551090056e-01   +9.657305739199062e-01   +1.079477496178636e-01   +7.514487466298400e-01   +5.318382315910712e-01   +1.583346073626573e-01   +7.458490687901664e-01   +9.767146127591239e-02   +4.360679751962634e-01   +1.888531861952634e-01   +6.961013731809090e-02   +7.081671418500207e-01; +9.512596187524699e-01   +7.001222303659269e-01   +6.658529687142382e-01   +2.688626107104644e-01   +6.926584379423918e-01   +1.380701210835207e-01   +7.838648799645280e-01   +4.702615898666733e-01   +8.568581419363209e-01   +4.788100913194407e-01   +7.296647399215686e-01   +3.755751536600339e-01];
L2E_L3E_iAMPA_netcon = [+6.574788174880334e-01   +3.875271398537454e-01   +2.350644167891787e-01   +4.660062516745948e-01   +9.037266161647269e-01   +9.503836063453693e-01   +7.620636306271895e-01   +3.547941950382987e-01; +3.829468535264781e-01   +2.258003903066964e-02   +9.055725762432141e-01   +2.848008673931876e-01   +6.796564358232677e-01   +2.476380390465687e-02   +9.034873908688892e-01   +6.627636591051712e-01; +3.080877790376769e-01   +3.304122568404347e-01   +4.861631422724697e-01   +2.770103235788303e-01   +8.429326184154220e-01   +5.017237060782068e-01   +7.955048943587530e-01   +5.927754299059451e-01; +1.567773558459621e-01   +4.855903119643812e-01   +5.959326102916934e-01   +1.432840396857233e-01   +9.598896196348022e-02   +3.389833373807133e-01   +9.556582888694958e-01   +5.457163083442738e-02; +7.766338648353329e-01   +2.624747523793170e-01   +9.559511894799667e-01   +1.413614886663297e-01   +7.339624353000881e-01   +6.727650853618126e-01   +5.346808017367506e-01   +2.156964550286230e-01; +7.089726609354776e-01   +5.251036788844626e-01   +8.503420209189561e-02   +2.632494272062048e-01   +5.432647911802292e-01   +1.686294170104960e-01   +1.633539377959001e-01   +6.014132247633621e-01; +1.719465368829084e-01   +4.149552688106156e-01   +2.212149443090298e-01   +6.105498942694086e-01   +2.565732618943299e-01   +2.266675404482599e-01   +1.339754895801572e-01   +2.694797913338727e-01; +4.481676914667694e-01   -3.723412854999017e-03   +1.535010872635718e-01   +1.070545395461664e-01   +7.152586391713622e-01   +1.184299111969607e-01   +3.207748315940319e-02   +1.093367193434518e-01; +8.375741020010687e-01   +8.928320882958765e-01   +3.904045800841480e-01   +4.840657377835089e-01   +3.606071499619655e-01   +9.927096615348571e-01   +6.820425079267213e-01   +2.102381804266249e-01; +6.989984149549475e-01   +2.396800744137206e-01   +1.858942439259086e-01   +8.927528777774695e-01   +8.538023120699066e-01   +1.402037047852806e-01   +5.865887951529937e-01   +8.736008225453791e-01; +7.644988359446266e-01   +7.928937869251786e-01   +7.635631070921339e-01   +1.886536090313816e-01   +8.193096490078532e-01   +7.694532843222549e-01   +2.983786105311030e-01   +4.594773777215382e-01; +9.805868040595964e-01   +5.771730542199580e-01   +2.277908671572633e-01   +5.118938034064684e-02   +6.103436311532244e-01   +6.332758722094712e-01   +7.431392360668934e-02   +7.269188804526783e-01];
L2I_L3I_iGABA_netcon = [+5.886792545865350e-01   +1.470572220199369e-01   +3.444539795823043e-01   +3.695173557587116e-01   +5.989360207395975e-01   +5.067106948892710e-01   +7.733370283920515e-01   +2.648894499394907e-01; +8.455379183454086e-01   +9.892632270482140e-01   +4.684001260592720e-02   +5.370012421357186e-01   +4.785791735823353e-01   +2.382203222424848e-01   +1.787758250145899e-01   +5.861360346836120e-01; +6.043885574476847e-01   +4.809516045094890e-01   +9.424315867797621e-01   +9.740130045106026e-01   +3.767417183828069e-01   +2.733538565542784e-01   +4.539529462095351e-01   +6.800259767166627e-01; +7.440742332435597e-01   +3.556795696204560e-02   +8.666614329735640e-01   +9.964234297288749e-01   +9.786784899977373e-01   +4.052673136535730e-01   +3.059495724835677e-01   +4.163370668395208e-01; +8.487765806830899e-01   +2.703506566625650e-01   +1.335192477560542e-01   +4.147470555375728e-01   +1.386748682317326e-01   +2.617065025275233e-01   +3.878544126535606e-01   +5.115852647394726e-01; +1.452114271028924e-01   +6.750273114402687e-01   +5.904069571945433e-01   +4.494342574240239e-01   +2.704172094628381e-01   +8.546923086279440e-01   +8.027874472441960e-01   +8.137922531532537e-01; +7.427713927519805e-01   +1.446867566100488e-01   +6.326887650329843e-02   +2.538529294910636e-01   +2.261757857318556e-01   +4.791227524681915e-01   +7.772237689102613e-01   +5.449515970015866e-01; +1.702011127946588e-02   +7.724045203987701e-01   +9.473303499067020e-01   +5.991974414498586e-01   +7.931611359585107e-01   +3.428019914145039e-01   +6.462661883883428e-01   +5.887925964772804e-01; +2.280671618631274e-01   +2.670622041376505e-01   +4.967770064666916e-01   +7.761893634183906e-02   +8.181021050971529e-01   +6.385612061154012e-01   +2.428628755980157e-01   +5.346670441925755e-01; +5.372939136528797e-01   +8.812275747635701e-01   +2.650997745036112e-02   +9.119735175631940e-01   +7.934916574248253e-01   +4.155821493101018e-01   +6.074035298799420e-01   +5.399429125672889e-01; +7.191162684151692e-01   +3.697765797876298e-01   +5.725814217473273e-02   +4.730173700793382e-01   +1.125195632019409e-01   +5.446912335433715e-01   +4.191641401087480e-01   +1.508365840408777e-01; +4.345492171348251e-01   +1.108563143861269e-02   +3.004451133199130e-01   +5.080440937730070e-01   +6.322118753289200e-01   +3.412082616045751e-01   +2.952559279760131e-01   +7.029664492265087e-01];
L3I_L3E_iAMPA_netcon = [+6.366219701448447e-02   +7.731601976704061e-01   +5.533478127441748e-01   +5.718916977870117e-01   +9.190891140138245e-01   +8.366130041957515e-01   +8.511611087283680e-01   +8.629982564721026e-01   +5.325438175869749e-01   +9.887262320580140e-01   +4.816972802737015e-01   +3.509690526428735e-01; +9.216285167439443e-01   +8.391661930454379e-01   +8.442619042202721e-01   +9.357940820536653e-01   +5.926919480009528e-01   +3.929555143019058e-01   +6.288079240443585e-01   +8.560463480031062e-01   +5.675556074986714e-01   +7.001218918476952e-01   +7.390570457943867e-01   +4.000650337886006e-01; +1.799518386588995e-01   +5.942158551889805e-01   +9.688904366230392e-01   +7.794092104477991e-01   +5.761241360904347e-01   +6.933699178793784e-02   +4.448084937569703e-01   +9.476448550715469e-01   +9.794962485582781e-01   +8.441582980172042e-01   +5.938631256704713e-01   +9.874295191535462e-01; +5.424938993254912e-01   +7.668203035642572e-01   +4.652565869365980e-01   +5.957010365585598e-01   +6.576606060960010e-01   +3.743497450860898e-01   +2.351408744448748e-01   +6.955871677657386e-01   +9.687858408066046e-01   +7.385668767036867e-01   +2.624348107345018e-01   +2.965677700794984e-01; +3.992457676706186e-01   +6.586237110335083e-01   +7.763520772170388e-01   +5.672596728635478e-02   +4.355507676522101e-01   +8.496220559368676e-01   +5.061141961656165e-02   +3.633572867109409e-01   +5.604268730670254e-01   +9.945583193788973e-01   +6.059320341273419e-01   +2.247147755549763e-01; +9.354891299384801e-03   +5.889615018831805e-01   +2.235527709011195e-02   +5.433305965438058e-01   +9.350964843264475e-01   +2.669141284124179e-02   +7.113548763875097e-01   +3.725956413224455e-01   +5.317459628941542e-01   +5.063154351500000e-01   +2.305424979588195e-01   +3.301226226147524e-01; +1.033815147793441e-01   +2.514661101553026e-02   +6.776567201530014e-01   +8.644138496221015e-01   +1.031138048671928e-01   +4.220659046720198e-01   +8.486034690430660e-01   +8.413729645947048e-01   +4.801954366814328e-01   +1.894007684848765e-01   +1.940071826226335e-01   +1.645947354346398e-01; +8.557126457854874e-01   +6.927733577570758e-01   +8.356102950603527e-01   +3.371372078100359e-01   +4.096291662976448e-01   +2.544995182311440e-01   +4.053372449679972e-01   +3.847506582883562e-01   +9.006292668205892e-01   +9.602667667363251e-01   +2.008817275618520e-03   +3.825093388172821e-01; +3.384561578607200e-01   +3.274995487427618e-01   +6.849577223424687e-01   +1.778710700219117e-01   +8.921461420493513e-01   +7.317844181279468e-02   +2.858647221584893e-01   +7.700091475990264e-01   +4.816980106025153e-01   +4.507232565562849e-01   +6.462683854900065e-01   +5.263265421465333e-01; +1.497097878322340e-01   +7.688079593725411e-02   +8.953889330237456e-01   +8.812126209479613e-01   +7.395441384961376e-01   +9.191719127419895e-01   +2.617870892569241e-01   +7.742747108304894e-01   +4.859803841290408e-01   +6.055710322660476e-01   +4.001153896224904e-01   +5.959893622782932e-01; +8.079887022832553e-01   +7.450361209079194e-01   +9.515672170334803e-02   +8.426220877850628e-01   +9.587791403723105e-01   +2.680572555777823e-01   +5.055360337874524e-01   +4.327720657744248e-01   +3.129038761778575e-01   +6.450403037717450e-01   +2.718024685207721e-01   +1.693294534913302e-01; +6.547170113699188e-01   +9.656326652358049e-01   +7.037441455888538e-02   +8.348457978177871e-01   +9.710111887549747e-01   +1.007640844523666e-01   +1.157937100763892e-01   +4.867673252144909e-01   +8.589301303893437e-01   +7.654738969155307e-01   +3.711472167468459e-03   +7.391191032634575e-02];
L3E_L3I_iGABA_netcon = [+4.381474545311931e-01   +7.150498730236032e-02   +6.878853596306284e-03   +4.947363941617373e-01   +5.433198764324019e-01   +2.525050167067882e-01   +7.180567159758721e-01   +7.621399094863900e-01   +3.790237008223791e-01   +4.480410627010458e-01   +2.005613679027470e-01   +6.495326496041151e-01; +5.862850831204403e-02   +8.080757425594419e-01   +1.317211310869985e-01   +1.923505175878064e-01   +2.108264864947114e-01   +3.337730063039159e-01   +2.205316279633839e-01   +8.880611514033635e-01   +6.105563559549091e-01   +3.942212087281120e-01   +8.288463390724171e-01   +8.988880070159617e-01; +6.253823063747692e-01   +9.089358755732019e-01   +3.094607656191657e-01   +6.426944498524092e-01   +2.710693825582881e-01   +5.923021686499914e-01   +4.981561929179901e-01   +7.324428589578587e-01   +1.676656935816797e-01   +6.689269510111628e-01   +4.473919267178448e-01   +8.368905823308788e-01; +7.997214422416734e-01   +4.254867491739391e-01   +2.380341613225672e-01   +2.550983307809179e-01   +1.317907006728187e-01   +4.821958537715404e-01   +4.744616368374536e-01   +6.962038495478352e-01   +1.060151152688056e-01   +3.292686877919339e-02   +4.305997864923355e-02   +1.705336549641715e-01; +4.012752704194144e-01   +1.844738810807812e-01   +6.475804187455040e-01   +9.487859961411289e-01   +1.636767466394476e-02   +8.984279338458474e-01   +4.298202864082842e-01   +6.463762245670638e-01   +6.252426891997810e-01   +7.873643496319598e-01   +7.686356857581702e-01   +1.602411029435092e-01; +8.835209575740550e-01   +1.831159475076101e-01   +8.068054214997471e-01   +2.887821405374852e-01   +1.465209346258860e-02   +2.953552112800841e-01   +5.553902600347265e-01   +6.187300545731402e-01   +9.519969024061740e-01   +3.780564160740105e-01   +9.737894007484922e-02   +1.360622157847834e-01; +7.224454982490917e-01   +6.717380515057161e-01   +7.414081730877619e-01   +1.490022526132434e-01   +9.793853277580125e-01   +7.919638740544360e-02   +2.062141629992956e-01   +7.763434063005126e-02   +6.659447265679572e-01   +6.502669322474365e-01   +6.530518173935255e-01   +1.589152885380657e-01; +1.966384524425565e-01   +5.230836107051374e-01   +1.224698794905870e-01   +8.706867203493570e-01   +6.468930802881100e-01   +3.921826669432373e-01   +2.764798304593399e-01   +5.476366946655258e-01   +4.716276204058142e-01   +4.971616760478205e-01   +2.712053081047938e-01   +3.946444850554339e-01; +3.739039460372913e-01   +7.770464149745547e-01   +1.722215379360841e-01   +8.861946458150433e-01   +8.156036746498186e-01   +1.984083724819064e-01   +8.132865829786269e-01   +8.847466577907827e-01   +3.408786464680710e-01   +2.142393759113694e-01   +4.381979525616584e-01   +6.652091846699845e-01; +2.118771163470342e-01   +2.994653512584259e-01   +2.728126617217430e-01   +6.680974897408187e-01   +2.770408245871216e-01   +7.229657025256802e-01   +9.428621133009443e-02   +9.861613330023931e-01   +5.906773034182311e-01   +2.158842277801899e-01   +8.486426063601091e-01   +2.236654299066965e-01; +2.590297886404669e-01   +4.735003558840020e-01   +8.132657571718361e-01   +9.981983828165065e-01   +1.303567550070787e-02   +4.203782293712691e-01   +3.136714057387782e-02   +7.095064511930659e-02   +5.469877184467645e-01   +4.511385283818021e-01   +9.018758947551297e-01   +6.440286395760306e-01; +9.923432177151494e-01   +7.068874743692563e-01   +5.905259255792555e-01   +2.682129384963342e-01   +1.020747327037746e-01   +2.673267722156952e-01   +6.456686408880816e-02   +3.230942848709698e-02   +3.985869924323172e-02   +6.285525638413608e-01   +2.841508120934275e-01   +6.120178801338149e-01];
L2E_Input1_iAMPA_netcon = [+9.935053508749345e-01   +9.896200388635351e-01   +9.984883606007674e-01   +9.861361743605860e-01   +9.861499221552968e-01   +9.984990440384061e-01   +9.830983154550271e-01   +9.977592482152233e-01];
L2I_Input2_iAMPA_netcon = [+9.917423917169210e-01   +9.994363717550039e-01   +9.857541918108363e-01   +9.943186788464607e-01   +9.891174004693238e-01   +9.890511394977258e-01   +9.964824192276869e-01   +9.966152553305960e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
