function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.649982279845670e-02   +1.158591724475397e-01   +1.346556914590610e-04   +9.961442263285183e-02   +9.842598140526662e-02   +2.474469828634839e-02   +4.925811312981725e-02   +4.786797675526909e-02   +4.594478001758998e-02   -2.050846733879055e-02   +6.698370707703225e-02   -8.399045645050568e-02   +1.839945259719544e-02   +1.069996508768629e-01   +4.027508916440285e-02   -7.349005099454273e-03; +3.137135202045400e-02   +1.027947673287088e-01   +7.171370960035436e-02   +1.009346791239246e-02   +2.337464861166801e-02   +9.490369760068809e-02   +4.967777127796165e-02   +6.433639496854986e-02   +9.821337121947728e-02   +2.029779108051877e-02   +4.348403526592043e-02   +4.235093913673056e-02   -6.774846626103181e-02   +6.012316339726714e-02   -4.452927520010296e-02   +3.722317778225007e-02; -1.019880339201910e-01   +5.220295208833627e-02   +3.365633820230465e-02   -5.582850222410556e-03   -1.089948107867072e-02   +1.429536297175223e-01   +2.180780376860652e-02   -3.186703839638784e-02   +7.539283047587131e-02   +6.303903314181894e-02   +1.227388147709150e-01   +6.041680058396627e-02   -4.258824716946665e-02   +9.752663109122711e-02   +5.618093090036765e-02   +3.789403070076851e-03; +6.514301709743206e-02   -2.234989065322817e-02   +2.615946082972737e-02   +1.183652204608388e-01   +1.180619504448079e-01   +4.625500868260290e-02   -3.094221746134766e-03   -3.435925730102125e-02   +6.490404484442309e-03   +1.359837831228717e-01   +8.494155627002002e-02   +2.985065293271908e-02   -7.746139306084342e-02   -8.608953599250537e-03   +9.170167858890034e-02   +9.345097115124079e-02; -4.689670540095173e-02   +1.036006183899316e-01   +2.644517864676384e-02   -1.631763230418568e-02   +1.285366387260432e-03   +4.686166283577316e-02   +4.241444658150858e-02   -2.576105882965110e-02   +1.136667533500983e-02   +1.445972072091722e-02   +6.641714056149371e-02   -1.455883328492003e-02   +8.439471249722062e-02   -5.517819622147248e-02   +7.751425068105813e-02   +1.416719027862330e-02; +4.048943036830743e-02   -7.237251606862982e-02   +1.336194616037572e-01   -3.559420034510032e-02   -3.403940052035397e-02   +7.141013303904098e-03   +1.371044238469888e-01   +2.628253944594163e-02   +1.099394956069330e-01   -3.198765485932056e-02   +4.180885598373331e-02   +3.318738109763976e-02   +8.327860896021186e-02   +9.175786807024341e-03   +1.504506325111504e-01   +2.482635308639315e-02; +7.129221813330777e-02   +5.560626220315196e-03   +2.743270239639185e-02   +1.110509441911777e-02   -1.352408583551280e-03   -2.490237438909649e-02   +4.368846226975146e-02   +7.416610160790503e-03   +8.738390691042192e-02   -1.462820297949884e-03   +4.834407938504863e-02   +5.538404100608604e-02   -4.581221793679044e-02   -6.962674506083146e-03   +4.329245399561155e-02   +1.584952681316497e-02; +9.801032576263562e-02   -3.547622637229476e-02   -5.847608608343064e-03   +6.616766564588743e-02   +5.212051370668677e-02   -6.835716516454975e-02   -5.394791609247836e-03   -3.339144732187521e-03   -2.220104394369644e-02   -1.237415887070012e-02   -9.454986176245253e-03   -5.366331291356195e-02   +1.420352684042244e-02   +1.152095202467726e-02   -1.854777373416772e-02   -8.034640276354482e-02; +6.064441615900837e-02   -5.534181802184993e-03   +7.721269556327656e-02   -5.409114983692204e-03   -3.298317822556716e-02   -4.766387754778491e-02   +2.474546957622769e-02   +4.866335339368182e-02   +1.133837065260542e-01   +2.459427015172367e-02   -9.149462840379632e-02   +5.935844596786351e-02   +5.096679833658827e-02   -6.419420674810186e-02   +1.723595077664097e-02   +1.034762602265277e-02; +1.255445745619438e-01   +2.663685954046716e-02   +1.164734516597200e-01   -5.501022535560396e-02   +1.436860066881633e-02   +6.272521541400959e-02   +4.206778102609351e-02   -1.489642742449619e-02   +5.213759514280474e-02   +3.261049367150956e-02   +1.374779922747706e-02   +4.325702233155873e-02   +5.203557282794123e-02   +2.009315860123573e-02   -5.362413687194616e-02   -1.331142921020902e-02; +5.778655750004480e-02   -8.507888609565836e-02   +3.718999220291991e-02   +1.025475773505732e-01   -9.082302767412563e-03   -4.603070951463115e-02   -1.440729502710290e-02   +1.005145992595942e-01   +4.659947347250634e-02   +5.413838973957959e-02   +3.255008253468471e-02   -1.473034327090467e-02   -1.874238410639075e-03   +7.980622232946220e-02   +3.701198127637163e-02   +1.087398208402375e-01; +3.891844456621668e-02   -1.821085006705506e-02   -3.437242006374286e-02   +4.455625852304673e-03   -1.008546635872253e-02   +5.424302779055908e-02   -1.886256832267671e-03   -9.636251615491405e-03   -7.241347392325702e-03   +7.854188927678324e-02   -3.541511654999791e-02   +1.291831906522582e-02   -3.155320486797197e-02   +9.150440206186537e-02   -7.662940918092048e-02   +5.814007908172471e-03; +3.749113497087296e-02   +1.100524756409497e-01   +6.301818197091907e-02   +7.287934285711210e-02   +1.063637397938740e-01   +2.180533957017398e-02   -5.645163724626924e-02   +9.682047248295285e-03   +6.630278347023821e-02   +3.084905766524117e-02   +6.188172202749814e-02   -3.979621664629850e-02   -1.918984995150189e-02   +7.368792699176956e-02   +9.986430076087795e-02   +7.512070406625537e-02; +3.605092811923630e-02   +1.531350445392387e-01   -1.316088910425277e-02   +6.717173064532360e-02   +2.437198512297368e-02   -3.916982225120333e-02   +1.054868479502535e-02   +3.693135032937291e-02   +2.009277552781286e-02   +1.378872442135765e-01   -5.604070510838537e-02   +9.738596912109834e-02   -6.809965982234804e-02   +4.779921027561367e-02   -5.126826216011712e-02   +8.063858347290354e-02; -1.894618261628692e-02   -5.416578700930301e-02   +4.284083880804470e-03   +2.631561953822317e-02   +7.400857110000239e-02   +5.267279106318051e-02   -2.737850254018711e-03   +1.757992107494682e-01   +7.465977093156104e-02   +4.743694650980942e-02   -2.286716782291329e-02   -5.108186998009377e-02   -3.991041074241641e-04   -5.579656505658734e-02   +2.531439125700792e-02   -2.166283603690792e-02; +1.095354480480260e-01   +1.333925824975297e-01   -4.035137287942081e-02   +3.199115830605218e-02   +7.153174905265382e-02   +9.651958864444427e-02   -3.295080455613437e-02   +4.153761296961045e-03   -4.380480296141140e-02   +1.262256691832376e-01   +5.413349055358707e-02   +3.544339099087095e-02   -3.135049583657643e-02   +6.139338977254157e-02   +9.378895756490513e-02   +2.297347455260739e-02];
L1E_L1I_iGABA_netcon = [-3.321382412598180e-02   -4.081371696431267e-02   +1.949715931601029e-02   +2.606016947308718e-02   +1.386645980454165e-01   +4.294570659791568e-02   -3.244916421599797e-02   +1.063941803807743e-01   +6.724120372000653e-03   +2.810930055622918e-02   -3.725980075301118e-02   +1.104842150183876e-01   -3.580612436235637e-02   -3.093052823374109e-02   -1.873091927718537e-02   +6.516508495725951e-03; +1.062507616924433e-01   +1.121399835861774e-01   +1.965762355287442e-02   +2.688589072409361e-02   +2.906560916902902e-02   -8.563764207482145e-02   -3.877539725097276e-02   -2.807146124209855e-02   -5.887198422814462e-02   +1.115216726618109e-02   -6.908992956381901e-02   +1.287633089702978e-01   +7.698118401377800e-02   -2.820388335195328e-02   +5.947000163161286e-02   -1.818137886906584e-03; -7.412859697505603e-03   +1.007063400135135e-01   +7.576518772025895e-02   -3.524702956679251e-02   +8.180500423310025e-02   +6.691380664732791e-02   +6.850339777834061e-02   +3.979888540519234e-03   +1.169157447730048e-02   +1.097979056301668e-01   -1.411824552428262e-03   +1.121877066238131e-01   -2.322153628818155e-02   +1.465618706986765e-01   +3.529438867949754e-02   -2.979279592183001e-02; +1.059030313841299e-01   -3.701883391879605e-03   -3.299037563989388e-02   -7.209201271002298e-02   +4.881639571878653e-02   -3.551543879086303e-02   +7.294088803128865e-02   +5.807404410414703e-02   -7.234652303798347e-02   -1.990134553003624e-02   +1.250059443256830e-01   +7.030125655336315e-02   +7.068396685217634e-02   -3.985985291615711e-02   -1.898173415467768e-02   +6.543718549531125e-02; +5.665690520769778e-02   -3.270941851390097e-03   +1.296532910868315e-02   +3.120974883086846e-02   +5.134004246412827e-02   +9.013517223780884e-02   -1.370090353788602e-01   -4.717180877079453e-02   +6.915930715417810e-02   +6.855089845647653e-04   +1.049739692689870e-02   +8.999752659739635e-02   -4.227072628091855e-02   +1.453926387397816e-02   +7.202404991414373e-02   +5.090556950447610e-02; +7.550993920851495e-02   +1.213428783525811e-02   -8.187457173742255e-03   -2.589770856264204e-02   -5.527617341536706e-02   -5.669516301719650e-03   +5.618117826935165e-02   -7.898237675959668e-02   +7.106842990036208e-02   +1.315941049750512e-01   -1.049189217128655e-01   -4.349015018515044e-02   +1.828250182010636e-02   -6.875505206456051e-03   +2.809007574491030e-03   -2.142987606972643e-02; -1.152828548796941e-02   +1.209930301885132e-01   +1.620386170737001e-01   +4.474021555031342e-04   +8.494056887026566e-02   +8.903142913571219e-02   +8.448092358621076e-02   +5.249554106936783e-02   +2.860095977449398e-02   +5.748560363903564e-02   -6.822529764572002e-02   +3.573985483113774e-02   -3.829600482626594e-02   -8.626054920516560e-02   -2.360127493026543e-02   +8.254468600637418e-02; +2.698112184255153e-02   +2.985229747911560e-02   +1.737499600715938e-02   +1.089904118267916e-01   +5.836232689316823e-02   -2.422407121061984e-02   -5.306407431137305e-02   +7.299616680597376e-02   -4.781105242190330e-02   -1.256110871230691e-02   -8.337366125859705e-03   +4.606021217486553e-02   -3.846274776765748e-02   +6.350378775047164e-02   +4.083682825618522e-02   +6.459870338642844e-02; +1.495677576679578e-02   +9.402608091439807e-02   +1.093414818648052e-01   +8.102036776975868e-02   +9.191152668318424e-02   +6.752943500513686e-02   +1.270607050668965e-02   +6.866389111543923e-02   +2.903028614043034e-03   -5.785777532156358e-02   -1.024974669760015e-02   +8.002415857411296e-02   -2.627656644270765e-02   -3.979486922058588e-02   +6.231145436088344e-02   +1.482039213283817e-01; -3.821366547401603e-03   +7.259552632724500e-02   -2.134227208587504e-03   +2.971206926480813e-02   +2.638718856745898e-02   +1.120387837176871e-01   -3.911923069301085e-02   -8.010713462224797e-02   -4.455975681512637e-02   +1.623173693277609e-02   -8.117145626098200e-03   +1.020745899542319e-01   +2.551189083762530e-03   +9.059504334329752e-02   -7.623236411464870e-02   +9.411859777536791e-02; +2.280701542238213e-02   +9.808337867005680e-02   -5.211873450332388e-02   -1.902186019282701e-02   +1.533370023001032e-02   -9.170181520718744e-03   -1.425149131248689e-02   -5.301610499481503e-03   +9.820534891525343e-02   +1.060929258120250e-01   -6.788085718092751e-03   +3.295120594072636e-02   +3.786344268367640e-02   +3.574288311478858e-02   +1.140715551692530e-01   +4.057858227027440e-02; +5.434806810659730e-02   -2.327474210992424e-02   +6.592742509226344e-02   +8.497003772484280e-02   +2.622468673207907e-02   +3.174594358187978e-02   -2.973059941414263e-02   +1.812149469931712e-02   +4.740839775815588e-02   -2.745471225681778e-02   +7.021285083119816e-02   +9.318840497596242e-02   +7.046696502116050e-02   +4.856968779497842e-02   -6.506397069916321e-02   +6.613737700479162e-02; -5.757870162996453e-02   -7.012999275840615e-02   -4.753382768865241e-02   +7.817049591065986e-02   -9.084481583716287e-03   -2.523680492315283e-02   +9.865982213967565e-02   +4.860595846247860e-02   -7.997974842232332e-03   +7.923677077182803e-02   +7.271052234118629e-02   -2.212855100457524e-02   -1.133529560993488e-01   +1.039691959682104e-01   -7.369944589446102e-02   +6.705498524097643e-02; +5.464069027212990e-02   -2.024323649515049e-02   +4.562156896663822e-02   +2.668993715847415e-02   -4.167169410017317e-03   -5.072029927636486e-02   +6.358868148043786e-02   -1.442953907529900e-03   +9.143525388366387e-03   +1.148285656678097e-01   -8.168487786221294e-02   +6.851402181671459e-02   -4.320281542303643e-02   +7.917188002316478e-02   -3.422378429699169e-02   -5.538685806704538e-02; +3.027082291349292e-03   +7.647834713345131e-02   -4.609608034709198e-02   -1.233387498332830e-02   +2.900915420910642e-02   +8.762208942464704e-03   +3.977776600837091e-02   +9.587266477530262e-03   +5.652472318909714e-02   -5.619775089784132e-04   -3.362534080578706e-02   +4.522589250845931e-02   +4.846476808741419e-02   -5.163818500019658e-02   -2.513720419790635e-02   +5.723918035227777e-02; +3.838561817644482e-02   +1.405097638926251e-02   -5.173543727581238e-03   +5.378166003566669e-02   -2.165752029150027e-02   +1.012696219022905e-01   +1.078825882538289e-02   +6.537279803574270e-03   -4.360626392360438e-02   +5.578442652104038e-02   -6.850851276594556e-02   +8.204076402352577e-02   +5.496912671496799e-02   +2.718929649852724e-02   +3.188686500949382e-02   +5.461561488417950e-02];
L2I_L1I_iGABA_netcon = [+1.467443015782187e-01   +1.102634888949905e-01   +6.493222158725760e-02   +4.446844116110854e-02   +9.057968819362686e-02   +5.889267775336264e-02   -8.717036659949030e-03   +2.914435210099046e-02; +4.023022654363244e-02   +7.973824514085230e-02   -6.434790372178906e-02   +6.089472894812103e-03   -4.829131079583102e-02   -3.724382502212895e-02   -5.307235665103137e-02   +6.428986384857960e-02; -3.334853825127976e-02   +3.124772872181227e-02   +1.941597862838274e-02   -5.016172927551629e-02   +4.789810402745978e-02   +6.592979302136244e-02   +1.186041744142475e-01   +5.999331275665128e-02; +4.195063012884917e-02   +1.067226372799024e-01   -1.649645310440711e-02   +7.469936747272510e-02   -3.245110010185852e-02   -3.075423942517995e-03   +6.444222376874437e-02   -4.425696783799593e-02; -7.262871103554278e-02   +1.393475848864086e-02   -5.975637990564407e-03   -7.635302242312185e-02   -1.737038579577488e-02   +6.271376810705741e-02   +1.278341034199452e-01   +5.686438625921689e-02; +3.297632358360696e-02   +3.192664307383213e-02   +5.402483059238605e-02   +1.877258187339742e-02   +3.292612115552571e-02   +4.484216844649748e-02   +1.005101463772713e-01   +1.469843828017027e-02; +4.925947008720617e-02   +7.743990819324901e-03   -1.231845855600641e-03   -7.818205670186264e-02   -2.151356842221873e-02   +5.945812399201385e-02   -5.398085888400384e-02   +2.572004461141126e-02; +3.598509062129974e-02   -3.099448121901644e-02   +2.104613534509292e-02   -3.920713587078340e-02   -3.048557124371007e-02   -1.038268126272168e-01   -5.221557741891376e-03   +3.461149425181879e-02; +1.110221721480760e-02   -5.118688828767136e-02   +5.283031891788972e-02   -5.060944213751337e-02   +4.457391937089290e-02   +3.037045553941344e-02   +8.161997459916367e-02   +2.989523732259775e-03; +2.362893652438849e-02   +9.069802475750845e-02   +2.420067311418436e-02   -2.924164639159077e-02   -2.442578050720995e-02   -6.099063229019899e-03   +3.839984528315822e-02   +5.452480048590015e-02; +5.097479597064938e-02   +9.274932189860152e-02   +1.685116258221477e-02   +1.752108534427061e-02   +3.874979453156589e-02   +8.729290414494613e-02   -3.455925632014233e-02   +8.438999681236650e-02; +1.157761470954665e-01   +8.566481562258064e-03   +1.503097541374050e-01   +6.354212459776201e-02   -2.767152413830985e-02   +4.079199286579566e-02   -5.840280012123383e-02   +1.943717908557088e-02; +4.869132140531557e-02   +3.666660439661550e-02   +4.236318163036362e-02   -1.812303043086980e-02   +7.474194984043447e-04   +3.186268476299663e-02   +4.143713838302192e-03   +4.204068716296398e-02; +5.257398809828934e-02   -5.654363867812928e-02   -1.498262954356469e-02   +9.911090591256626e-02   -1.489305313052301e-02   +4.397484750742944e-02   +1.667272036865387e-02   -1.587735306880658e-02; +1.032473109610445e-01   +5.150725645146841e-03   +6.307715056956210e-02   +8.325529971560471e-02   +7.595350873173000e-02   -4.292474438794981e-02   +2.708889328830196e-02   +2.915064562411408e-02; -5.748337053787335e-02   +3.865923758786782e-02   +4.991390710895398e-02   -6.163720454014003e-02   +4.751258955073501e-02   -3.028895484133862e-02   +1.160515404561045e-01   +2.164019023440974e-02];
L1I_L2I_iGABA_netcon = [+1.048119642809157e-01   +1.083057029859249e-01   +6.162116492139293e-02   -2.580260190200780e-02   +5.549939688503337e-02   +4.235835536224131e-03   +3.760893283474203e-02   +1.494742628592483e-02   +1.333023490743694e-02   -7.823567795465014e-02   -7.004177721104871e-02   -3.378755835450828e-02   -8.179661045302516e-03   +2.465573788944200e-02   +1.114598027406276e-01   +1.264207448549657e-01; -5.446207297076074e-02   +2.416488779359961e-02   -9.692940457811756e-02   -8.667628404128265e-02   -3.707287446504604e-02   -5.000200572168986e-02   +1.300198379259129e-02   +4.203293205938650e-02   -7.900906463934657e-02   +1.612419921437415e-03   +2.268546217917800e-02   +3.823325870838569e-02   +4.190533546333622e-02   +1.260773584476295e-02   -1.187835718502744e-01   -3.615607826026934e-02; +6.345961340957865e-02   -4.230155764093065e-02   -1.310328063233716e-01   +5.134167038122735e-02   +4.680227735252716e-02   -1.791042221863860e-02   +1.087037363107953e-01   -3.770732426251538e-02   -4.651737534986794e-03   +1.126188294275142e-02   +8.267701555010630e-02   -2.167018311632671e-02   -2.792868670901283e-02   -3.753667792223371e-02   +3.896044763379351e-02   +3.593566870822611e-02; +2.272490250180177e-02   +2.634812341480199e-03   +5.161571485854720e-02   +5.790620760268897e-02   +2.385539342259993e-02   +9.448901100096477e-03   +3.498580814329592e-02   -3.692332560853288e-02   +4.399895093397639e-02   -5.255036884253422e-03   +2.165661799940881e-02   +4.578091464181148e-03   -5.244849747467566e-02   +5.026952984068214e-03   +1.226654270231183e-01   -2.600762505706187e-02; +3.911729053026003e-02   +3.496546665903567e-02   +2.561914962476723e-02   -5.157832619698537e-02   +1.047869851857570e-01   -5.086568475169789e-02   +7.810520573930332e-02   -9.516014279681712e-03   +1.117889196180223e-02   +1.642630139762082e-02   -2.116209314517774e-02   -8.578323299428106e-02   +1.065540190645264e-01   +4.244026781175611e-02   +2.200204016487201e-02   -3.183320834329890e-02; +9.730645672717694e-02   -6.663172781907993e-02   -1.039532580676870e-01   +1.165475867400247e-01   -4.922712165868093e-02   +8.973847778988679e-03   +3.851301544968612e-02   +1.258773610455661e-01   +6.232047077184195e-02   +4.213112397277467e-02   -6.356902036575710e-02   +9.211468532579267e-02   +5.395952516858802e-03   +4.974340113044548e-02   +1.569830998548877e-02   +1.082092846252489e-01; +1.872020694276667e-02   +1.160283041463116e-02   +1.405007018312428e-02   +3.277848857185443e-02   +6.379104873293612e-02   +1.145296191905969e-01   -3.214350324799072e-02   +1.497382711653666e-02   +8.961240631809042e-02   +1.060317081882901e-01   +4.301142210480932e-02   -4.631071701953807e-02   -9.892018099143057e-02   +2.841770088168460e-02   +1.255345315165736e-02   +4.193402979749102e-02; -2.700289502491376e-02   -5.943921382404102e-02   -2.989466448073408e-04   -5.816335166568522e-02   +1.375135797631573e-02   -6.357570781430849e-02   -1.406822252158600e-02   +5.124481571706532e-02   -9.557445578776448e-03   +7.235939361566285e-02   -4.863508242185577e-02   +1.622853718393030e-02   -5.983014385316152e-03   +3.060935231995031e-02   -3.148457489810690e-02   +1.320619340389539e-02];
L2E_L1E_iAMPA_netcon = [-2.801061625612342e-02   -1.633985599671531e-02   -1.128505221410951e-02   +4.476887362869120e-02   -2.260517733072559e-02   +6.961853784824534e-02   +1.736873328765168e-02   -1.757380955423934e-02; +9.137248862126787e-02   +8.383032218512677e-02   -1.451027665796829e-02   +4.422235874076075e-02   +1.451623985502204e-01   -1.979799311820652e-02   +4.036241683533448e-02   -2.669402454752774e-02; +8.427766126350962e-02   +2.001821203500974e-02   -1.611797612801207e-02   -1.599637545413048e-02   +2.124177776506554e-02   +1.153480801420411e-01   -3.847031208082190e-02   +8.956371275440000e-02; -3.336985478452964e-02   -1.043989527083584e-01   -3.490651549806626e-03   -1.699407284497923e-02   -7.623379294009709e-02   +5.680197508323125e-02   -1.767202375088182e-02   +4.046856322938122e-02; -1.065310471246507e-02   +2.350260210235280e-03   +7.658406138191980e-03   +6.565198711011713e-02   -3.562358231456442e-02   +3.105676638093683e-02   +6.297479262587920e-02   +3.583974247037040e-02; +9.219632570818564e-03   -4.597212844975319e-02   +6.259495283097208e-02   +4.369841144843471e-02   +1.153287161685502e-01   +5.796756318921659e-02   -1.286629759740474e-02   +6.486956192330012e-02; -3.712603805331658e-02   +1.102861232628557e-02   -9.067789165183784e-02   +6.378244165853426e-03   +5.080933936057369e-02   +2.945025062468042e-03   -4.544475644808388e-02   +4.245251082475369e-02; +8.705534159150013e-02   -4.772856365538481e-02   +9.824066243558292e-02   +2.636554755047425e-02   +8.504974779913242e-02   -6.295457660084923e-03   -5.987635204236409e-02   +1.819236806890688e-02; -7.733958641570091e-03   -2.589718911914077e-03   +4.130752355670644e-02   +1.295903525475011e-01   +9.758990512220603e-02   -4.807775621149942e-02   +1.632167472586888e-02   -2.003130994333564e-02; +3.660836927660465e-02   +6.327715655146757e-02   +7.721897732976378e-02   -4.896571588191227e-02   -4.351436685875995e-03   -2.475135111423080e-02   -3.560621918866425e-02   +9.303538760333702e-03; +6.462386264300662e-02   -9.102672305031746e-02   -2.002934845431025e-02   +3.829865446727026e-02   +1.236737120897815e-01   -5.383488721633423e-02   +3.879102826410435e-02   +4.255152893632857e-02; -2.286552841191456e-02   -9.132377530940808e-02   -5.021813986374215e-03   +4.233383018961386e-02   -3.027470092325446e-02   +5.110540809060443e-02   +3.584013557234682e-02   -6.191425446602941e-03; +3.854231697770594e-02   +1.532271812497190e-02   +7.808469422371433e-02   +7.124993665693967e-02   +1.242686352127364e-01   +3.682670796171891e-02   -5.863152152589651e-02   +4.519009763548577e-02; +6.981963548762460e-02   -4.149452441356120e-02   +7.766243043890614e-02   +8.558736424170976e-02   +9.325945459446265e-02   +3.536058311339422e-02   +7.139928286530878e-02   -7.774609352469980e-02; +2.003728271294131e-02   +2.001967713971255e-02   +5.636911681871858e-02   -3.375724623209780e-02   +1.671146271715809e-02   +2.817351021491335e-02   +1.243912736392174e-01   +6.130835722176282e-02; +1.270593188553648e-01   +9.562186563321007e-02   +4.814667194449999e-02   -2.474904688724432e-02   +8.161367982451553e-02   -5.779250428594788e-03   -2.856329077381665e-02   +5.430762867772387e-02];
L1E_L2E_iAMPA_netcon = [-2.600912301963935e-02   +6.605210400020692e-02   -3.732249189808683e-02   +6.802945256682917e-02   +1.416692808052539e-02   +8.580682507517065e-02   -5.137503384265123e-02   +6.236881175965783e-02   +2.965562662366039e-02   +5.800386076013919e-02   +1.599594134928462e-01   +5.001977287832218e-02   +1.543614260703886e-02   -2.027602802522007e-02   -1.303330179816610e-03   +2.760129756820631e-02; +2.830965581266220e-02   +6.213127630484867e-02   +1.673676029704459e-02   -1.207708241803366e-02   -1.280290248005062e-01   +1.005567256620834e-01   -6.012668241265760e-02   +2.520592848258359e-02   -7.043114827444216e-02   +2.287389506811219e-02   -9.934502287175925e-02   -5.531533630943167e-02   -3.772849875744837e-02   +2.591471075572648e-02   +6.401084090484584e-02   +4.757361571003758e-02; +3.178310998358208e-02   -1.220567710760614e-02   +6.436874443923933e-02   -1.216661529205529e-02   +7.055953749640037e-02   -1.314080870964345e-03   -9.163464642052560e-02   +1.619495173584957e-02   +5.464918038416222e-02   -2.504801579958293e-02   +5.703236512506932e-02   -6.476569467015712e-02   +2.317428558996650e-02   +5.485966195820070e-02   -3.654090865387100e-02   +1.645648971289487e-01; -6.662510081327153e-03   +6.025659638384243e-02   +6.007568580652926e-02   +5.996010323021497e-02   +6.874503515520944e-02   +5.459106136964639e-02   -2.699848384259247e-02   -3.525021665361894e-02   +7.679464106638760e-02   +1.099878969473645e-02   +9.294260721221204e-02   +3.069101385705316e-02   -3.976126074044999e-02   +3.078016944933238e-02   +1.146111274843903e-01   -4.583100215575604e-02; -7.642171345032332e-02   -6.322196798584340e-02   +9.201697662327334e-03   +1.777386828592089e-02   +4.620579198198156e-02   +8.587297904912004e-02   +8.694581694440813e-02   -2.900831956903219e-02   +6.291855588432504e-02   +4.475150043341386e-02   -3.226266252976647e-02   +1.355868432858993e-01   +8.472722333101032e-02   +2.232307560539322e-02   -9.666398223435606e-02   +1.374974917457055e-01; +4.969910221719044e-02   +1.000396145905689e-01   -5.521368427385622e-03   +5.935726036807935e-02   +6.752566201500143e-02   +3.372081656179155e-02   -2.874872621576545e-02   -1.339190507580133e-02   +7.719852050818983e-02   +2.746650236295194e-02   +1.012763405503476e-01   +2.446809730500489e-02   -3.137918200610504e-02   +7.697325176007022e-02   -5.199366070882259e-02   -2.474508439735336e-02; +3.092890154758007e-02   +7.326955232076852e-02   -1.567777193881395e-02   -6.957689452509822e-02   +7.481717512030857e-02   +2.966668619415904e-02   +3.449251656839170e-02   +8.415943582437849e-02   -6.259990897383287e-02   +6.726082789716632e-02   -1.095528105147538e-01   +5.014479962115180e-02   +6.894741872463250e-02   +3.725090989711029e-02   +5.782611297535637e-02   +4.392868749959448e-02; +4.606784944705167e-02   -5.161846671374719e-02   +1.296800220492847e-02   +6.456796277664280e-02   -3.684360453879307e-02   +8.404436351796519e-03   -5.453495484207478e-02   +5.623973179299605e-02   +7.134715124746724e-02   +9.566678753273478e-02   -2.847886328783904e-02   -7.387600411083408e-03   -4.746397490643402e-02   +7.464165985368942e-02   -7.569436651191416e-02   -7.703309623250688e-02];
L2I_L2E_iAMPA_netcon = [+2.095914864491207e-02   -3.922783700708387e-02   -1.951120802842358e-02   -9.262853078231038e-03   -6.407759573019162e-02   -7.755888362747873e-02   -3.323358745308604e-02   +4.650530802473309e-02; -4.644678678469275e-02   +2.500994532097538e-02   -6.767235555523513e-02   +1.009938066415503e-01   +5.962506243632953e-02   -2.134496924696724e-02   +5.550262196400490e-02   +2.562781191351799e-02; +6.045104107654082e-02   -4.807978143560232e-02   +8.402908130057918e-02   -4.298039751592694e-02   -4.586412124769681e-02   +6.566281160115503e-02   -4.285040716751237e-02   -5.326452748908486e-03; +2.523808333426539e-02   +2.121526382492661e-03   +9.461452155041000e-03   -6.205199855836535e-02   +8.169769619591986e-02   -4.347999175562169e-02   -3.560992190245846e-02   +1.123203477602971e-01; +9.529412440400450e-02   +1.313927014897774e-03   +1.359033749123512e-03   +1.205741765222213e-01   -4.942291991401415e-02   +4.449844428931079e-02   +1.252442324074264e-02   +3.484943934767693e-02; +3.197932145522685e-02   -3.836391528047622e-02   +3.099459854796928e-02   +3.105017507747600e-02   -5.570753506144496e-02   -1.008866399658224e-01   -2.161214834814176e-02   -5.757056161580244e-02; -5.335799428398538e-03   +8.109068825927189e-02   +5.527804508088667e-02   -1.014832261698611e-02   +6.206660681436076e-02   -4.022653512752907e-02   +1.044664770995086e-01   +1.271484467936248e-01; -9.577373169976694e-02   -4.818862010645183e-04   +5.447533977137718e-02   +7.723293249078567e-02   +1.395261246594274e-01   +1.617249110463628e-02   +3.022824542198325e-02   +4.143556417145339e-02];
L2E_L2I_iGABA_netcon = [-5.117067524683874e-02   -2.390333977384789e-02   +6.135964267570528e-02   +6.702209353832722e-02   -4.896138576824243e-02   +3.870560729989989e-02   +9.136586808120178e-02   +2.455372697807136e-02; +3.001334097752938e-02   -6.584143593320760e-02   +1.158546815868385e-01   +2.258220753087073e-02   +5.883241440572233e-02   -6.948936885607052e-02   +6.708259550617550e-02   +3.006229317555620e-02; +3.346317667798426e-02   -6.839197757085724e-02   +4.743926126336715e-02   +4.447966984596188e-02   +4.233012092523795e-02   +4.928631054730233e-02   +1.789887036742037e-02   -6.146789004976947e-03; -3.394044339634420e-02   +7.527293360750992e-02   -5.551582707343810e-02   +2.160906759645807e-03   +3.906200674263854e-02   +1.149149295997660e-01   +1.168670426845413e-01   -2.027698366548592e-02; +3.268372590399236e-02   +1.223635937832799e-02   +8.922826060045522e-02   +2.443161420151222e-02   +2.514840371963092e-02   -1.266803029163898e-02   +1.388000893386841e-02   -2.216754668106738e-02; +4.494064814176978e-02   -2.735612352230717e-02   -5.533409611995656e-02   +3.947701521148884e-02   -2.562123106454373e-02   -2.069296291394923e-02   +7.132866145316924e-02   -9.972907037287863e-03; +2.957794887629828e-02   +2.788368466346886e-02   +6.832396582876837e-02   -3.115036084091726e-02   -6.224818483142207e-03   -4.582789797483589e-02   +3.053248934325729e-02   +3.812440307225281e-02; +3.886183930876305e-02   -7.313357688569215e-03   +1.519112348119284e-01   +8.204944624417503e-02   -7.121157882669449e-02   +4.806339638043842e-02   +1.082581789897369e-01   -1.042740879958191e-02];
L3E_L2E_iAMPA_netcon = [+7.174582389354549e-02   -6.638159328332356e-02   +1.973914310573005e-03   -5.270731507934175e-02   +1.057361397807285e-01   +6.379843410862691e-02   -2.005083177045270e-02   +1.161093410656463e-01   -6.509955967305500e-02   -9.399690816108853e-03   +2.630571026155885e-02   +6.916076870135515e-02; +2.685358686073212e-02   -3.051751772180545e-02   -7.501154192014241e-02   +4.539748205376624e-02   -2.879425140845378e-02   +9.908230359720736e-03   +4.608354700923591e-02   +1.548023867289224e-02   -4.525407824652522e-03   +2.422985515730253e-03   +4.974675055135040e-03   -6.113531169395232e-02; -5.800531075964694e-03   +6.665706223720688e-02   +3.375244272838427e-02   +7.757371447012289e-02   +1.949792806427371e-02   -4.058352667409527e-02   +5.930797868703307e-02   +2.375994644458843e-03   +3.960896778356561e-02   +7.189848492425656e-02   -7.582288706841333e-03   -2.121569705370792e-02; +1.095053529813985e-03   -8.318267964444893e-02   +6.346197237845577e-02   +2.904449076127753e-02   -5.607758960044210e-02   -2.254706734541509e-02   -1.948666807529780e-02   +3.509041298753213e-02   +6.404704610421908e-03   -3.726318047708110e-02   +2.798486426823445e-02   +1.239146193629307e-01; +9.734222179302164e-02   +2.131762314611719e-02   +4.770907037190662e-02   +3.289461948334386e-02   +3.040508635859013e-02   -1.123727092649258e-02   +2.669644608321951e-02   -7.832148536706063e-02   -8.514589099016684e-02   -5.873731445944943e-03   +3.470536779653911e-02   +2.884138514555868e-02; -9.436307108236891e-02   +9.164197568161167e-02   +7.813783134359434e-02   -4.005605548988556e-02   -2.495527926119849e-02   -7.853301259806944e-02   +3.983758017201307e-04   +1.966655231895449e-02   +2.674926297803629e-02   -5.796128360945074e-02   -2.781688449623075e-02   +8.721741539283889e-02; +9.479445759318252e-02   +8.703431260463733e-02   +8.488532266460333e-02   +6.335921800674613e-02   +2.489704943266040e-02   +3.331970580297938e-02   +1.185265898122896e-01   -4.885420437460601e-02   +2.463348554644761e-02   +1.102725201221911e-01   +4.399982444447222e-02   +3.685462530126660e-02; +5.461309320328051e-02   -7.951127673344445e-03   +1.058403097521625e-01   -9.659268411112098e-03   +4.708187951055098e-03   -1.877706010930764e-02   +1.425613382474786e-01   -3.247256103689406e-02   -3.423200422279071e-02   +1.109855166237183e-01   -1.622123524751492e-02   +5.270973257276879e-03];
L3I_L2I_iGABA_netcon = [-9.457714844004347e-02   +5.542806998326503e-02   +1.049078984360740e-02   +3.875847230460222e-03   +7.342610185512098e-03   +1.730172929956203e-02   +4.989178044136749e-02   +7.524965524703499e-03   +4.039950665789010e-02   +2.355895090918688e-02   +1.455332497609748e-01   +1.518763509867847e-02; -1.589589062624976e-03   +9.177973792908174e-02   +1.060207555183795e-01   +1.055456870376205e-01   -8.657031642620353e-02   +9.189698397540418e-02   +1.520281151340130e-01   -3.615952415417110e-02   -3.681939297921367e-02   -3.369738878400007e-02   +2.158030926471324e-02   +8.756995280489415e-03; +7.744530611216632e-02   +5.322879696723339e-02   +4.610699597088418e-02   -1.384692013905499e-02   +7.418725812825913e-02   -6.160123725579260e-02   +2.296801557876107e-02   -7.453493523339366e-02   +7.028767359491644e-02   +2.018419940020143e-02   +4.746731827126725e-02   -9.924728925826728e-03; -5.474145154432820e-03   -2.376028365270228e-02   +5.708125159432975e-03   +8.585895069199334e-02   +1.234599274019181e-01   +1.994959014183865e-02   -6.058194903536196e-02   +2.926628900707026e-03   +9.922907106214851e-02   +7.452849111658265e-02   +4.536629466290391e-02   +5.071640260324357e-02; +4.706693744196264e-02   -6.052999698744105e-02   +1.404338615431258e-01   -1.693417620116934e-02   +5.285215449612141e-02   +6.885427750504333e-02   -7.496619399817890e-04   -1.429636550153281e-02   -6.264699206364513e-02   -3.950133193948645e-03   +3.194221112771747e-02   +2.690955696840778e-03; -6.616758310105184e-02   +4.893089344856405e-02   +1.129367627665272e-02   +4.271652422828293e-02   -2.912971888123227e-02   +2.737882115665760e-02   +1.001130364945617e-01   +4.309901636033654e-02   +1.953195232292664e-02   -3.065062305874539e-02   -1.431550980377837e-02   +3.558892636100551e-02; +6.460269304777527e-02   -3.231693662310033e-02   +1.124702604585816e-01   +5.144091938235307e-02   +1.061671191585437e-01   +1.286713015174584e-01   -8.726115002731626e-02   +6.974783062397762e-02   +1.185225407704543e-01   +5.951703622579766e-02   +1.055221046788730e-02   +3.865143933201242e-02; -3.963757009531663e-02   +5.767595081771640e-02   +5.394893368718506e-02   +1.260106896355058e-02   -1.848840422972495e-02   -9.138711532507005e-03   -2.174595128050599e-02   +7.921583480612975e-02   +5.391443670749881e-02   +4.209304605106200e-02   +8.349911860742390e-02   -3.665977520813624e-02];
L2E_L3E_iAMPA_netcon = [-1.706870042484696e-02   +1.232385575918208e-02   +5.370774738562670e-02   -9.430157536139613e-03   +1.079850498191271e-02   +1.143930259814068e-01   +1.279186709502582e-01   +1.021081264926829e-01; +4.117409324331268e-02   +2.120440313780137e-02   +1.265858771906422e-03   +5.016839290073725e-02   +2.967109260390739e-04   +1.326219490932083e-02   +6.182848784320987e-02   -7.924840308729461e-04; -8.017581173089780e-02   -1.304148375172087e-02   -3.713512821262968e-02   +7.428541425530373e-02   +1.142126238982935e-01   +7.895521008400243e-03   +4.215434326565589e-02   +6.351233807783525e-02; +7.294595118375914e-03   -1.768918066370176e-02   -1.254169198326240e-02   +9.067596923902209e-03   +3.006338567176109e-02   +1.222985636016617e-02   +1.123397632511533e-01   +8.700687935546987e-02; +3.076964522749880e-02   +4.557764756693276e-03   -2.764623153721351e-02   +8.746154430572201e-02   +9.220412593297027e-03   -7.997089504796434e-02   -7.418070355088419e-02   +4.533118524086364e-02; +4.042614505098591e-03   +1.046568187964313e-02   +9.746217806143438e-02   +5.071905338254768e-02   -6.036260811624566e-02   -1.413640370070225e-03   +4.967657564472241e-02   +3.396869658071858e-02; -4.294116702836840e-02   -5.533890340032138e-02   +1.000230960201770e-01   +1.028002801642639e-01   -2.675987523195928e-02   +1.865778526651531e-02   +5.764023081179044e-02   -6.305626307681486e-02; +4.125380106324791e-02   -3.011605165690663e-02   +8.205765118111878e-03   +2.325046330502504e-02   +1.420799311844093e-02   +8.810271798162075e-02   +2.014459108721469e-02   -3.761205019782587e-02; +3.242365535078612e-02   -2.764711594796021e-02   +8.868490312304131e-02   +3.808423614924587e-02   +4.543072423022664e-02   -3.894555106534035e-02   +1.685085963459596e-02   -1.627853914666864e-02; -7.018735348875366e-02   +7.462356356515254e-02   -7.988455974389583e-02   +2.978554467685318e-02   +5.895361675978487e-02   +5.957993346019649e-03   -1.269605490319800e-02   +5.039648205577010e-02; +9.640926941993366e-02   -3.467660770128387e-02   +3.177407763021953e-02   +1.165695422460678e-01   +9.653405109200427e-02   +7.413389349684184e-02   +3.733401516527775e-02   +1.438730347518435e-01; -5.495181115371699e-02   +7.296511714257500e-02   +8.099694537387947e-02   -8.029084493268068e-03   +6.248990432831290e-02   -6.730362617152078e-02   +6.801098756780569e-02   +3.632264686968265e-02];
L2I_L3I_iGABA_netcon = [+3.542841488180679e-02   +1.045549637556660e-01   -3.348412881702306e-02   -8.160813027652969e-02   +1.150079025945607e-01   +6.989974067681363e-02   +8.035653067593722e-02   +8.647311161460373e-02; -4.637288169858748e-02   +4.412839335123377e-03   +1.400310516127713e-01   +1.073452158310289e-01   -5.235961160958635e-02   -1.929616363024554e-02   +9.893539149067093e-02   +1.318239119800189e-04; +7.196130658382707e-02   -4.021339645507778e-02   +9.023410670910748e-02   +8.244804217252349e-03   +5.183164000050004e-02   +5.985248669825075e-02   -1.206539296263177e-02   +9.848420772273023e-02; -1.059692281538037e-02   -1.179824409780786e-01   +7.014927729837722e-04   -5.914095801887563e-02   -3.492946765057673e-02   -2.998876720252495e-02   -5.797704027372087e-02   +6.343987512102597e-02; -4.969565424864766e-02   +5.345840088732583e-03   +1.471053012188496e-02   -5.788902875619761e-02   +9.515106733298702e-03   -3.969693351213510e-02   +5.053849165544227e-02   +1.391049231618168e-02; -1.216049457346987e-01   -3.497506548768745e-02   +9.181511383386792e-02   +4.543058661150977e-02   +4.493935016197129e-02   +9.285718954629499e-02   -2.150912007127863e-02   -4.866033025826844e-02; +4.879426616705648e-02   +9.884855170340431e-02   +1.183682443342209e-01   -3.117256941585658e-02   +9.614780897087812e-02   -1.810177408215256e-02   +7.239397447045059e-02   -1.206963008469442e-01; -2.234295991416947e-02   -3.140939951768033e-02   +2.179767929416697e-02   +4.066642727900850e-02   -6.023121367108675e-02   +1.335891931509194e-02   +3.554568758174411e-02   +3.788522449470996e-02; +4.351652457847678e-02   +1.423726755936722e-02   +3.930858336093182e-02   +1.129036717913403e-01   -2.057644226496708e-02   +7.173621566596615e-03   +9.795625979921957e-02   -1.231394380630648e-02; -2.686479112177433e-03   +3.442967540473398e-02   -8.204026120752826e-02   +1.048817492549221e-03   +9.751008057995968e-02   +6.775901127357473e-02   +1.751015974262389e-02   +1.715433958814061e-02; +6.639803310588309e-02   -2.093546757813033e-02   -6.018468363114017e-03   +7.875620937118721e-02   +6.647035973425514e-02   +1.340081158811404e-02   -2.021084643051233e-02   +1.237119395957888e-01; -4.512308379877828e-03   +4.051778737965136e-02   -1.015219251557543e-03   +4.623244392107573e-02   -4.633933701809931e-02   +4.028274734556496e-02   +2.560649634913614e-02   +9.656703061692537e-02];
L3I_L3E_iAMPA_netcon = [+1.038593415866101e-02   +2.138022425271992e-02   -6.953304502489477e-02   +1.356410968875297e-01   +1.695237631269701e-02   -2.796559046888034e-03   +5.641933265805119e-02   -4.533807816026003e-02   +3.834756201957414e-02   -6.016892451672674e-02   +4.089634306000192e-04   -3.193986584715151e-03; +7.660569316092394e-02   +8.308985059374258e-02   +8.826381697831157e-02   -5.104143404051809e-02   -4.095542891461625e-02   +4.841067663797045e-02   +7.661453956518784e-02   +9.686879985903873e-02   +3.264047932472701e-02   +6.006882318123456e-02   +4.273344637340795e-02   +1.240920741673137e-01; +2.950359512382185e-02   +1.854242063741058e-02   +4.836582836657912e-03   +2.477316150184618e-02   -6.425336945747875e-02   +5.293729627998089e-02   -3.649015918204148e-03   -2.185208001246721e-02   -1.989785276167793e-02   -1.986059847141550e-02   -1.301488607708005e-02   -1.073986210312929e-02; -2.160063685718854e-02   +6.401175716534162e-02   +2.412212428452326e-02   +4.248868949090319e-02   -5.358818791612845e-02   +9.545902008317800e-03   -8.736695525960489e-02   +5.800245228542864e-02   +5.400454752986295e-02   +7.120364203698069e-03   +7.572601223746177e-02   -4.120918393424870e-02; +9.667923705501451e-03   -6.750635948083664e-02   -7.337776717495718e-02   +3.526099441018638e-02   -7.720719469525834e-02   -5.215677873054497e-03   +1.340454865614580e-02   +6.607321327726087e-02   -5.917206880803043e-02   +3.671260106439010e-02   +9.366267905100950e-02   -2.393677543731543e-03; +6.605434829197918e-02   +3.454434133824469e-02   -1.360406223955796e-02   +2.823587054744716e-02   +1.165958078560849e-02   +2.086056361397518e-02   -3.112274938977003e-02   -3.994804573101710e-02   -2.207977815199900e-03   -6.757350402588555e-03   +8.304784183334439e-03   +8.282470719668902e-02; +1.505843432263918e-02   +7.378671521755317e-03   +7.909117723188427e-02   +2.401934798661155e-02   +1.981794467924775e-02   -5.510488659222426e-02   -9.444583976642665e-03   +3.037268444716414e-02   +6.175512323656597e-02   +1.436366023942438e-01   -7.425477929952802e-02   -5.403584165988200e-02; -3.243477451534575e-02   +8.757058233255456e-02   -2.795661699021880e-02   +1.138795117230039e-02   +9.628218035539328e-03   +1.341675562043061e-02   +2.321014445324090e-02   -2.929676977860552e-02   +1.221216787467381e-02   +8.477401530638126e-03   +8.049391151784419e-02   +6.473454268197648e-02; +4.164015041459769e-02   +8.634405770929307e-02   -7.172605401946482e-03   -3.888149015307457e-02   -1.339209325838309e-02   -5.622967500701251e-02   +6.392859582093244e-02   -3.742899706029554e-02   -4.028911773132324e-02   -2.876886421917116e-02   -2.565372200756626e-03   +3.693301224663595e-02; -9.633230453408954e-03   +1.868223280283160e-03   -6.371647637681018e-03   -3.586528412739884e-02   +2.106025437982464e-02   +1.322690471482405e-01   +8.173778142555658e-03   +2.555419943242641e-02   +2.042965734815790e-02   +5.482459823159806e-02   -5.689413833477240e-02   +7.497203140951700e-02; +7.085678424674599e-02   -1.437456396548444e-03   +9.159184407747259e-02   +2.600471867631367e-02   +2.281866009457242e-02   +3.959502679450640e-02   +5.207853400197219e-02   -7.019230415114155e-02   -6.699427675257008e-02   +5.890091725294702e-02   +1.120157928074556e-01   -1.897019486817333e-02; -4.603752042758123e-02   -3.226943687067260e-02   +1.129054451261662e-01   +1.359250013443378e-02   +1.480702443830466e-01   +1.248083323911715e-01   +5.172763477529885e-02   +3.085355220359313e-02   -6.963912163579063e-02   -6.315708346302842e-02   -5.526737388231052e-03   +1.569882723886235e-02];
L3E_L3I_iGABA_netcon = [+6.213031104437733e-02   +3.444969040649525e-02   +8.488716176014054e-02   +3.830271913675228e-02   +4.669710965644462e-02   +8.343490300078793e-02   +9.612867092997347e-02   +2.711485063707646e-02   +3.341135572448788e-02   +8.480389372455061e-02   +8.889216997909208e-02   +3.957991177487187e-02; +1.261891677102372e-01   +7.836513692222390e-02   +1.205069752567552e-02   +5.937543544723645e-02   +7.009550321495384e-02   +1.072214714420144e-01   -9.163095090294873e-02   +1.801055010829525e-02   -1.097660648871012e-02   +1.102953055679733e-01   -6.176779081060387e-03   +1.405607916952751e-02; +3.989734134095745e-02   +1.196510226930893e-01   +7.347120234144006e-02   +4.306797654837683e-02   +1.005652222848391e-01   +1.385497602383615e-02   +9.165954501673833e-03   -4.047546710016118e-02   -5.859401070246573e-03   +7.470889446373578e-02   +1.051134358271113e-01   -1.776635858543263e-03; +8.325367029961428e-02   -9.713434316943349e-02   +7.537912475432132e-02   +5.621221159542893e-02   +1.507509411082526e-01   +1.669281608421787e-02   -4.215122883889267e-03   +9.039417413535314e-02   +9.247300340680373e-03   +1.037111686356911e-01   -8.365881564027347e-02   +1.229120123545071e-02; +1.712685328067795e-02   +1.336832269903310e-02   -5.063629600003407e-02   -4.115559394571960e-02   +4.463923754236156e-02   -6.041952969918506e-03   +2.855427173448434e-02   -1.218621648547826e-02   +2.967931894032759e-02   +4.991097317651366e-02   -5.429865355480967e-02   +3.755318116758485e-02; -1.010823481457530e-02   +1.061780643371119e-01   +1.207085332058736e-01   -5.737829196723553e-02   +6.287208871317501e-02   +8.669980283562262e-02   +6.947409902791321e-02   +2.348142070211488e-02   +4.077655283178581e-03   +7.981403650080779e-02   +8.406508033010303e-02   -1.234546946097535e-02; -3.912148297423210e-02   +6.812326283660763e-02   +5.782071510556236e-04   -3.989329329747365e-02   -1.612794960653637e-02   -2.709255406986778e-02   -3.782893881210166e-02   -1.507752365379403e-02   +1.220245923745320e-01   -4.700004610744939e-02   +5.372156571269830e-02   -4.203170413578265e-02; -4.773849803911993e-02   +7.102057775895556e-03   +8.244944349588776e-02   +1.157749013130910e-01   -5.206014826718800e-02   -3.053961232142683e-02   -1.702212693881613e-03   +4.732483832352200e-02   +3.950310755025958e-02   -7.551930160388479e-02   -3.148762927371043e-02   -6.103401352903624e-02; +1.511605977663482e-02   +5.510402331854801e-02   +3.430111410771865e-02   +1.364764476630727e-02   +4.796928565820078e-02   +4.701327322141630e-02   +4.547504855128737e-02   +1.090294199467753e-02   +1.568441034796152e-02   +7.826736061429107e-02   +2.230350448892781e-02   +5.900781907477438e-02; +7.429878896450613e-02   +2.965180145940680e-02   +3.308327257617875e-02   +3.323293474213192e-02   +1.468046981872999e-01   -4.574225373618857e-02   +4.788801585800882e-02   +3.654546802859080e-02   -2.188906357707140e-02   -3.892871815429369e-03   +4.623100491937870e-03   +4.207826918772097e-02; +5.489187740374316e-02   +3.975144143517367e-02   -4.453919829617782e-02   +6.544523625471758e-03   +1.194745386425998e-02   +7.849480001257558e-02   +5.619715885646801e-02   +4.521809177340982e-02   +3.875028760963613e-02   +1.250888840755399e-01   +1.865524228190645e-02   -4.519147590478249e-03; -1.260835738116813e-02   +6.457073981846315e-02   +1.047941678651853e-02   +9.286297601464999e-02   +1.087234601756026e-02   -4.187120867414341e-02   -1.751422157298990e-02   +8.532973392637783e-02   +5.275719831996432e-02   -1.150877917848157e-02   +6.555954864689285e-02   -1.520847150352515e-02];
L2E_Input1_iAMPA_netcon = [+4.940457321928821e-02   -5.375956505913732e-02   +9.812878701229921e-02   +8.377546515497328e-02   +6.173398711248340e-02   +4.448897147711318e-02   -7.924219924489004e-02   +7.482373666179914e-03];
L2I_Input2_iAMPA_netcon = [-2.045188861684551e-02   +6.941904687088279e-02   +4.204148059562113e-02   -1.410674776570725e-02   -8.025885284135885e-03   +4.417046264293443e-02   -8.561881584754672e-03   +8.429497664554297e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.3*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.9 + 0.6*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.3*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.3*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*1.0 + 0.8*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.3*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.9 + 0.6*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.3*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.3*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*1.0 + 0.8*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
