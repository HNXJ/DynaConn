function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.123692511123861e-01   -9.870734358529352e-02   -1.113334814025752e-01   +7.808374684753547e-02   -1.422210150152146e-01   +2.196142584871383e-01   -2.576023171202456e-01   +8.765650965137045e-02   +1.536383470100883e-02   +1.152166619302650e-02   -8.708659414129145e-02   -8.655856416492902e-02   -1.101137229956528e-01   -2.874738293719689e-02   -3.729410436237383e-02   -1.231805570118770e-02; +3.346838524012910e-02   +6.104808686817596e-02   +6.270994438177681e-02   +8.473279335970266e-02   +3.183674928770153e-02   -6.854458147291714e-02   -1.945230334578738e-01   -3.946155113417971e-03   -1.550137752658704e-01   -3.299700946559427e-01   +7.463200533023086e-02   -1.585569217902272e-01   -1.714308182144338e-02   -5.684035185247015e-02   +1.747058639065706e-01   -6.727942179676656e-04; +4.017574715736573e-02   +1.095661226604308e-01   -2.311407660123417e-01   +2.514703594810803e-02   -1.836615400901780e-02   +2.192939864247143e-01   +5.695323041441473e-02   +1.357564609298675e-01   -1.199510907290154e-02   -1.742455538662622e-01   +1.052823948649149e-01   -1.389430866564328e-01   -2.223201017225869e-01   -1.696979649748554e-01   +7.529244578272205e-02   -1.817863304052842e-01; -1.044056017869677e-01   -1.635143593453810e-01   -1.267074761870738e-01   +5.917415022962100e-02   +1.850636831916297e-01   -9.942179761447034e-02   +1.329273450159658e-01   -2.006275985517495e-01   -9.885607713314157e-02   +2.058229662519213e-01   -9.121043779984048e-02   +2.720545185579692e-02   -9.215955897922372e-02   +4.563915558301815e-02   +2.835583108690762e-02   +7.457861892222299e-02; +1.541924215127147e-01   -1.013203082518208e-01   -8.882137830714261e-02   -2.489358937755099e-02   +1.447130225481524e-01   +3.992651127431046e-02   +1.976533033289717e-01   +2.000902663446365e-01   +5.155796298779246e-02   +3.512477735664778e-02   +6.561350639350347e-02   +3.682190191676861e-01   +6.471564545589177e-03   +2.763627066988760e-01   +1.414300503790025e-01   +3.803106699253455e-01; +1.671417386138690e-01   -7.606252736864244e-02   -8.852329603930451e-02   -1.552814522009663e-01   +1.794903744468904e-01   -2.458880569816500e-01   -1.749282352616082e-01   +1.633900359189110e-01   +1.655592841881297e-01   -1.228880791679553e-01   -3.139241055212878e-01   +9.133237097784756e-02   +1.479296954154365e-01   -1.053122473732879e-02   -1.566883989593504e-01   +9.460984693520620e-02; +6.970603310688661e-02   +2.403643169686196e-01   +4.906323836085811e-03   -2.699198556783768e-01   -8.641455629242431e-02   +4.989254388039301e-02   -3.868179189934698e-02   +1.756876439834836e-01   +1.201022341152322e-01   -3.647741103471484e-03   -2.185474816860605e-01   +5.228086186837973e-02   +1.124183160039668e-01   +9.320505813226045e-02   +2.081515568301281e-01   +1.319238069421545e-01; +2.324529896960783e-01   +9.219572926252967e-02   -1.584004474976422e-01   -3.090624066666300e-02   +2.844209897356235e-02   +2.172790859545803e-01   -8.769715801177413e-02   -1.695203042303026e-01   -1.081967570893099e-02   +6.153064155221791e-02   +3.796420707708903e-01   -5.691520748668487e-03   -2.788801879578114e-02   +2.537142048482984e-01   -1.114859450076644e-01   -1.929769646560818e-01; -1.645693524972446e-01   -7.682894086869864e-02   -7.340322329699143e-02   -2.154667992232347e-01   +4.801288620466777e-02   -9.529741743562328e-02   -9.037730498981503e-02   -3.438176724232260e-02   +1.120276736066815e-01   -2.407014745444511e-02   +2.124846193609422e-01   -1.374211029364461e-01   +2.699085286005137e-02   +1.086364846905616e-02   +1.398355585214340e-01   +1.268183434907993e-01; -5.939364783985025e-03   -2.237645496760156e-01   +5.811617662432634e-02   +9.875583224274492e-02   +1.282560917268385e-01   +1.508555583404204e-01   +2.372121036092978e-01   -1.542307917778847e-01   -2.256789471693101e-01   +5.024447674779002e-02   -1.931998294444036e-01   +1.056747680994654e-01   -1.948942785002706e-01   -9.122400824134362e-02   -4.418133475535558e-02   -6.212631070257805e-02; +6.946914242408325e-04   +2.381184921097905e-02   -3.044356494339319e-01   -1.205138078028690e-01   +5.688224382787295e-02   -2.390272948714241e-02   -2.777304198350012e-03   -4.514571241330636e-02   -7.390666656531018e-02   -9.961473178297967e-02   +3.966264188770579e-02   +4.548161742191359e-04   -1.170486570363533e-01   -1.569737931619348e-01   -3.981705813184429e-02   -4.868388614157736e-02; -1.340307965834702e-01   -7.519959342888696e-02   -5.844035974467690e-02   -2.641760994012371e-01   +9.924315067592263e-02   +8.987556655441591e-02   -2.160082865715219e-01   -1.177317616662576e-03   +6.279417945230244e-02   +7.961666555913482e-02   +3.945454548359930e-02   +1.283716289748346e-01   +2.214204281348683e-01   -1.427938000981519e-02   -8.871137060573184e-02   +1.645627117583213e-01; -1.031740898030150e-01   -1.715769913637979e-01   -2.132536103194027e-01   -1.259194411537552e-01   +9.306091545685065e-02   +2.017821553736515e-01   -1.383753782847851e-01   +6.316636989525887e-02   -1.834738787884385e-01   -2.394192186374087e-01   -1.890116600418928e-01   -1.507354894041662e-01   +4.147070585630078e-02   -7.776450617280085e-02   -6.215799975887106e-02   +6.414394266046063e-02; +1.019902550508882e-01   +1.353496920801455e-01   -2.665549359737754e-01   +2.080424473356285e-01   +1.168849260240664e-01   -7.097289880892203e-02   -1.525962406266452e-01   +2.155612912313628e-01   -2.692365248702699e-01   -9.772013936828036e-02   -2.959707322272892e-02   -1.906195634835467e-01   +1.302547460850673e-01   -2.366287728242904e-01   -1.104112222017859e-01   -1.194371416797616e-01; +9.582249893355825e-02   -7.286048798163362e-02   +2.075314815577021e-02   -3.038033887626553e-02   +8.773058264956163e-02   +4.304059610961733e-02   +1.359034547023626e-02   -3.183684354726765e-01   +1.706298674882099e-02   +3.925413020517684e-02   +3.195355009090393e-02   +6.110631830261801e-02   +1.933970462793876e-01   +1.256361162304152e-01   -2.783982214356734e-02   -2.123070698775394e-01; +2.539491337466043e-01   +1.716267115315047e-01   +1.059498891603208e-01   +1.830662108994024e-02   +8.495609832870799e-02   -2.556544025127395e-01   +1.365587633654894e-01   +8.052244106218603e-02   -2.219219359906055e-01   +6.424699187737146e-02   +4.951790976712596e-02   -2.207167305639668e-01   -5.414954896450609e-02   -1.621546987794931e-01   +6.289128289463566e-02   -1.063449859626686e-01];
L1E_L1I_iGABA_netcon = [-7.977951775285543e-02   +1.064146949243787e-01   +5.567075762275049e-02   -1.511200516764353e-01   +2.589074733634454e-01   +1.591190864841621e-01   +2.032817218738099e-01   -2.309526387471638e-01   +5.222699852617031e-02   +8.250318901246172e-02   -1.493528610527976e-03   +1.216856144515058e-01   -2.055551228193785e-02   -1.351266767001399e-01   -1.731456232235836e-01   +5.413464824441622e-02; -4.196476799649240e-02   +2.179710225861464e-01   +1.214289264949979e-01   +2.264033728273084e-01   -1.951646109754442e-01   -1.150598855915517e-01   -8.411773274079340e-03   +5.737586917131686e-02   +4.319807945119871e-01   +8.219475381364350e-02   -1.427092757376169e-01   -8.646702046896673e-02   -7.377129025243426e-02   +6.929636375419351e-02   -8.127402341047446e-03   +2.735095284820958e-03; +4.564660508550176e-02   +1.313608819645411e-02   +3.851461702538726e-03   -1.193040947324775e-01   -7.260475056746424e-02   -1.053411734585252e-01   +1.080230088147164e-01   +1.532030929829343e-02   -1.401141276589419e-01   -1.468320599989628e-01   -1.334164300320189e-01   +1.725549671977923e-01   +5.070340117483596e-04   -2.623310130655616e-01   -6.708838471401279e-02   +1.993927120085957e-01; -9.682163241205594e-02   +3.979329998713873e-02   -3.225485853013590e-02   -9.873811520292489e-02   -1.970627129606969e-02   +3.960446163912263e-02   +1.185673365742113e-01   -1.033585646517477e-01   -1.890391700906618e-01   -1.608621097070402e-02   -1.558309242764623e-01   +7.248335308280754e-02   +5.427195236476401e-02   -3.798593650233677e-02   -2.186679646961190e-02   -2.204369019517756e-01; -6.158465952608120e-02   +7.985369057865090e-02   +2.725248538743130e-01   -1.365739271479119e-01   -1.100013077320865e-01   -1.698341960005868e-01   -1.381106025492808e-01   -4.809443104318514e-02   +2.646279385926197e-02   +1.660072713936738e-01   +8.283764247693745e-02   +1.147825429435556e-01   -1.253995316723079e-01   +3.082535901266303e-02   +6.257973532925427e-02   -3.248276178707460e-01; +7.681486699935844e-02   +1.345888123290249e-02   +1.044185002907189e-01   -1.431036072183889e-01   +3.641430653020732e-02   +7.871027264011116e-02   -6.760507336222388e-02   -3.346043817319364e-02   -3.928592425043170e-02   +2.747924073073986e-01   +8.905121386804390e-02   -1.341814295730455e-01   +1.629274943595662e-01   -1.845668387070906e-01   -8.466773635140670e-02   -1.156942097221394e-01; -1.025571276070744e-01   +8.301572644422121e-02   -2.092978803799816e-01   -1.477676965807142e-01   -2.409732372160979e-01   -5.241263684017264e-04   +2.026252328623759e-01   -1.990585776643948e-02   +1.184627651241068e-01   +1.125947984213367e-01   -1.321071126899560e-01   -7.417218640950346e-02   -2.016929722645705e-01   -2.391684809190423e-01   -5.284555815012429e-03   +1.791582412429859e-01; +7.291887135294794e-02   -4.318558707031334e-02   -8.233429047761123e-02   -8.892652057906278e-02   +2.020802371844040e-01   +1.796527726680766e-01   +6.900500886109714e-02   +1.023711149580794e-01   -3.030154518119293e-02   +1.518639271329761e-01   +8.060787624453822e-02   -1.283320997010027e-01   -2.408032018963019e-01   +2.133457455878076e-01   -1.125189022978326e-01   -1.159761956889775e-01; -1.657454968183618e-02   +1.738422929588392e-01   +1.463935255261720e-01   -1.434443973337607e-01   +2.458261753354445e-03   +1.530251049810661e-01   -3.193841449260112e-02   +5.638556432131369e-02   -2.771535936649752e-02   -1.477517202006801e-01   -1.387299111145893e-01   -1.193356927557017e-01   +1.172201359201071e-01   -5.557889948282266e-02   -2.555630258236165e-01   -3.052291005151836e-01; -3.452002921849444e-02   +5.955088214189842e-02   -1.142695208355672e-01   +3.882050850049586e-02   +1.328088039400747e-01   +9.835631691443805e-02   -8.913155832855879e-02   -2.207709933888655e-01   -3.585527041036773e-01   +1.340785275279211e-01   +2.642364371918975e-02   +2.461469674212028e-01   +3.013958341676639e-01   +1.264584908139579e-01   -2.821070584500574e-02   +5.101202447278334e-02; +1.645297204562129e-01   -2.122955762561419e-01   -4.223167461848087e-01   +2.627080282453899e-01   -7.860919068464073e-02   +1.065350344993507e-01   +5.594998483971436e-02   -1.482201027001462e-01   -3.866506186521509e-01   +6.895154824574061e-02   +1.010287123753732e-02   -1.451583936456771e-01   +3.563944003635646e-01   -2.192119386975258e-01   -1.938204347242746e-01   -1.584374408706264e-01; -4.780092544499008e-02   +1.721062769644878e-01   +8.471380678124966e-02   -2.258730123861925e-01   +5.039284726252637e-02   +1.910576909143102e-01   +6.481563020633743e-02   +1.388883549291402e-01   +1.774889916110840e-01   +7.948360514296762e-02   -4.441532518558038e-02   +4.314894751718371e-02   +1.045939031214683e-01   -2.104009554668974e-02   -2.325360988949839e-01   -1.007104977051603e-01; -7.035846906201165e-02   -2.602203616136486e-01   -1.313115253112982e-01   -3.890535712217357e-02   -1.046841112914923e-01   -2.039453364691160e-01   +1.952075140637182e-02   -1.249446075013114e-01   -1.463037692900467e-01   +1.470013374786232e-01   -6.349226257271545e-02   -6.208540294210496e-02   -2.590687657370939e-02   +3.146945071550453e-02   +1.813319267837159e-01   -2.213093751966852e-01; -3.366771317707358e-02   -2.236009013946661e-02   +1.730479999193974e-01   -6.644034860902001e-02   -2.399712171778034e-01   -1.488020600403014e-01   +1.119415805345344e-01   -4.369487089790870e-02   +3.402589688580095e-01   -2.655434723427433e-02   -2.567138272173711e-01   -5.615210213133659e-03   +4.837624115417732e-02   +1.292255004562342e-01   -6.451801854470668e-02   +1.421751346869662e-02; +3.168498893189582e-02   +2.306419856903132e-01   -3.190222362116865e-01   -1.129654665480610e-01   -2.324891714119404e-01   -8.290344882344886e-02   -1.087867644571099e-01   -2.331698827184435e-01   -3.204149254545995e-01   +3.783135335354071e-03   -3.684235976955656e-03   -6.257396623135826e-02   -1.128318475291169e-02   +4.396326835903038e-01   -2.194051590793019e-02   +1.733018772541494e-01; -6.003307770421729e-02   +4.398295990512675e-03   -1.537004179140950e-01   -1.738568980033266e-03   -1.817163124864797e-01   +7.687334191349912e-02   +1.269905922264686e-01   +6.166105502835455e-02   -2.346448568478723e-01   -8.195887938258782e-02   +6.563086959101642e-02   +4.436564895718658e-02   -7.867935800915306e-03   -1.338045291208074e-01   -2.133797708601808e-01   -1.187756738705495e-01];
L2I_L1I_iGABA_netcon = [+5.261654467371236e-02   +2.701310494196487e-01   -1.251021510539248e-01   -2.263451126213440e-01   +2.861589957057200e-01   -4.109857879971465e-02   -4.413102747775156e-03   -1.718641527020206e-01; +3.170268658825417e-02   -2.066473789693005e-01   +9.719318975410715e-02   +1.854367976325774e-01   -1.289884086738259e-01   -1.817034745244165e-01   -2.928523825496048e-01   +3.937411158276798e-02; -2.508014022935512e-01   -9.768546893494898e-02   +1.132394004316259e-02   -1.345367694445989e-01   +1.181539582801142e-01   -1.960593908941687e-01   -1.828606867152348e-02   +4.759322787969446e-02; +2.244330812085633e-02   -3.055770478297207e-04   +6.964232414004021e-02   +1.597179745091285e-01   -9.017849724574367e-04   -1.499610614380465e-01   +2.666103207834576e-01   +2.952665466513996e-01; -8.849917131643388e-02   -1.707688173220416e-01   +2.277876499897374e-01   +2.498336129647903e-01   +1.276343025797813e-01   -5.030290700427727e-02   -1.670633051946557e-01   -2.281424464553583e-01; +1.133835835792186e-01   +2.213931140001806e-01   -1.929843211761052e-01   -1.294315399127202e-01   +6.384745831284566e-02   -1.228551979754827e-01   +2.445124182928653e-01   -8.713160693382177e-02; +9.056825703046900e-02   +1.388355413040698e-01   -5.414856775847167e-03   -7.456431439972322e-02   +8.901747401320034e-02   -1.248729970312168e-01   -9.763923208240868e-02   +1.941832940667803e-01; +4.270098576442713e-02   -9.207627575474192e-05   -1.229035138727476e-01   -8.557453969205900e-02   -1.554463037210355e-01   +1.566591939493246e-01   -5.811172932437165e-02   -1.521129743041437e-01; -7.714395809788513e-02   +6.293940717814296e-02   +1.308279295772297e-02   -1.652788549202077e-01   -1.014363044115840e-02   -4.705665895125240e-02   +3.839870582597430e-01   +1.453266611602973e-02; -6.091012591746982e-02   -1.400904388196537e-01   -1.457591081840343e-01   +7.407134489628453e-02   -1.880356920376546e-02   -1.331194250641261e-01   -2.219507830829854e-02   -1.070113766897655e-01; +4.827343928293636e-02   +1.782059250159706e-01   -3.471699782045640e-01   +3.197988688743386e-01   +3.520126032279852e-02   -3.600826919873347e-01   +1.081034421883907e-01   +6.761204260203280e-02; -9.121477223076638e-02   -1.047761140406827e-01   -2.324023064419218e-01   -1.340834948881436e-01   +1.128038673848210e-01   +1.329963398945753e-01   -1.625051578298560e-01   +1.086577620062338e-01; +4.281637857995543e-01   -3.803587332911783e-02   -1.751716678277687e-01   -2.763377138488386e-02   -1.314060060966336e-01   -5.979100019180036e-02   -4.005377864984958e-02   -9.548940764844660e-02; -7.829546544859786e-02   -5.988294506946630e-02   -6.820459168903660e-02   +5.847520417191700e-02   -2.104428528796200e-03   -2.245261392902848e-01   +3.625104323811765e-02   +1.334903112057300e-01; +1.950043286743652e-01   +4.770623686672099e-02   -2.492024137539830e-01   +3.741141742533705e-04   +6.916846842573815e-02   +7.222246278544539e-02   -1.578560492429520e-01   +7.883250034315595e-02; +3.356498952827120e-01   +6.060154595372462e-02   +5.656957115554470e-02   -3.103681558728796e-02   -1.166648902961920e-01   -6.462022844736501e-02   +2.106157804369899e-01   -3.263822705449297e-01];
L1I_L2I_iGABA_netcon = [+5.279244600977709e-02   +2.321347254931249e-01   +1.352142100540523e-01   +5.586433771174928e-02   +1.660540446725871e-01   +6.339869766057932e-02   +1.391809640652790e-01   -1.642801237515998e-01   -6.210663666140916e-02   +9.757983353166976e-03   -2.630966885450879e-01   +2.235258817141841e-01   +2.187741062344127e-02   -2.497966175142599e-01   -2.896615968305994e-01   +2.186202726992112e-02; -2.690579071717343e-02   -1.046230789684683e-01   -3.601615186935965e-02   +3.618091985567142e-01   +3.008087851712917e-01   +6.467971889809815e-02   -5.333277410060594e-03   -2.412919884500562e-03   -5.752815282225876e-02   +9.929309245429574e-02   +2.069804317725683e-01   -3.409897218575376e-02   +2.077030702423305e-01   -8.623119867032336e-02   -1.785922181751829e-01   -3.985549076156936e-03; -2.646391563585843e-01   -1.095157407609611e-01   -1.147758357930651e-01   -2.593750655823184e-02   +2.410234843541523e-01   -2.503582965110400e-01   +8.490415015555142e-02   +2.371096215930391e-03   +1.951650740687376e-01   -8.438294566055418e-02   -2.417277399581960e-01   +4.515245099466112e-02   +4.877911387137464e-02   -4.517534921990109e-02   +1.550491503303457e-01   -8.809680015161199e-03; -1.793043662979042e-01   +1.152924676566241e-01   +1.489019200204149e-01   -7.541948537102094e-02   -2.298542866904014e-01   -2.664882459201478e-01   +1.429789588016753e-01   -2.828104510758843e-03   +1.339045316750823e-01   -1.619336666318247e-02   -8.862465969845548e-02   -2.490991662061369e-01   +1.247122180083107e-01   -1.736145797483506e-02   +6.903326827196506e-02   -3.989325613849452e-01; +8.472281203325777e-02   +2.615384881995542e-02   -1.325330735493767e-02   +1.890727140651797e-01   -1.160637182536908e-01   +1.338013565634119e-01   -7.914685437691983e-02   -3.239021505974216e-02   +1.068832089832370e-01   -2.055931644071695e-01   +1.051033621893187e-01   +1.697561245382641e-01   +4.142108193207998e-01   +1.483320411175707e-01   +1.591875754954652e-01   +3.133948929030881e-01; +1.750893116454977e-02   -1.087413347279632e-02   +3.355109884344533e-02   -2.133678872474820e-01   +3.454060621615355e-02   -1.498394378354049e-01   -1.485670491554259e-01   +1.838526357081469e-01   +2.316136594700227e-01   -4.001093893947252e-02   +1.352339572080689e-01   -7.589204749498057e-02   +1.369746384059266e-02   -3.732044463401230e-02   -1.488860455520490e-02   +1.214499282165518e-01; -1.143714670617736e-01   +5.180791345971991e-02   -1.305224659010801e-02   -3.630937914900648e-02   +1.583627905540730e-03   +1.007352087531105e-01   -4.121149308899975e-02   -2.571352282137913e-01   -5.069169716622955e-02   +1.037841174244745e-01   +1.017884458823136e-01   -1.874466734366557e-02   +6.307264956264054e-03   -1.411137306440408e-02   -1.440550492350829e-01   -2.909619969448168e-01; +1.357771367182752e-02   +1.003758013048614e-01   +8.633838015843699e-02   -5.601213478535502e-02   +2.428620950018216e-02   -1.068166234863010e-01   -3.769289270810294e-02   +2.174299561334302e-01   -9.475732440776891e-02   -1.899350010017016e-01   -2.097256278468250e-01   +1.535887692403905e-01   -7.900736893746449e-02   +1.150114730449174e-01   -5.684317708564829e-02   +2.937706002101474e-01];
L2E_L1E_iAMPA_netcon = [+1.026119130151718e-01   +1.120797035996229e-01   +1.526076843662801e-01   +1.293383505430044e-01   -6.219180769106149e-02   -2.836538853659261e-03   +4.991571621400444e-02   -6.075718522256273e-02; +4.508706310829070e-02   -2.371059885704188e-01   -3.154198676766705e-01   -1.216993832598967e-01   -3.941473390513992e-02   -1.074154577769727e-01   +4.615922459084265e-03   +1.624977473471915e-01; -8.428234703196150e-02   -2.127263163704712e-01   +4.843885520482039e-03   -2.046842085532211e-01   -2.216479087824396e-02   +8.525221719104975e-02   +9.972510694213799e-02   -1.175202813545667e-01; +1.785097509280840e-01   +1.787455295213687e-03   +1.496462058956281e-01   +9.652832823003563e-02   -5.740282898767799e-02   -2.340292876326839e-01   +2.874716830665805e-01   +8.443077534809086e-03; -5.088576331033344e-02   +1.126029446943257e-01   -2.602999767608528e-01   +8.849339441319765e-02   -8.694295190346021e-02   -1.757710147853825e-01   -8.974281612200202e-02   +1.443489225915288e-01; -2.617953520624687e-01   -6.283216059180301e-02   +1.195042252901388e-01   +1.955461163854122e-01   -1.339971485545370e-04   +2.661439070572886e-01   +1.251820835013828e-01   -6.014759227073087e-02; +1.096345680350302e-01   -1.204457341711745e-01   +1.238936138010160e-01   -3.365936269618386e-02   +2.833402654817581e-01   +1.959490203604480e-01   +4.531716849505913e-02   +1.519307534666355e-01; -3.263676636040356e-02   +2.602326682698746e-02   -5.315068644404922e-02   +1.356598563815119e-01   +2.404399994463974e-01   -2.627148392152821e-01   -7.514362259840243e-02   -7.032387838179829e-02; -1.023577364738958e-01   +2.038877300749548e-01   +3.330673940708032e-02   +8.655512096115188e-02   +1.461267594596705e-01   -1.625670988568559e-01   -1.664268622056707e-01   -2.250514428298804e-01; +5.676198841348401e-04   -1.838665957737086e-01   +3.825753344950819e-03   -1.275343931413203e-01   +2.941296208126158e-01   -1.320346798993453e-01   +1.444622484875520e-01   -7.440527606758737e-02; -1.556681621591978e-01   +3.391825103658194e-01   -8.590700582322575e-03   +2.400663617102428e-02   -8.667059312445566e-02   -6.977431732117947e-02   +1.616295360192465e-03   +1.410678566622538e-02; -4.578138586669500e-02   -1.059049499785667e-01   +4.350914451615954e-02   +3.302025775092295e-01   -7.824429995324374e-02   +7.749580709940326e-02   -8.259727983749457e-02   -8.579919881511801e-02; -1.346305358033520e-01   -1.009902538118405e-01   -1.170812299078093e-01   +9.176666591102244e-02   +1.331032538088400e-01   +3.844413465314717e-02   +2.309707335297253e-01   +1.569894870032118e-03; -1.808162698118910e-01   -1.009245506787408e-01   +1.283501911211905e-02   +2.266668565073817e-01   +2.907430462578725e-02   -9.733321641916914e-02   +1.516940343571914e-01   -5.747141162557463e-02; +2.423369117010278e-01   -6.636662106189123e-02   -9.054610406277741e-02   -1.245068846477285e-01   -1.157036048929643e-01   +1.541440024604862e-01   -2.672772240346920e-01   +6.123161157912349e-02; +1.257228378809832e-01   -2.041585379227344e-01   -2.958514431346252e-01   +1.492784170198552e-01   +2.489187914908975e-01   -2.072870881607971e-01   +5.142185726136263e-02   +2.769501620105647e-02];
L1E_L2E_iAMPA_netcon = [-1.883901700407012e-01   -1.118315709730159e-01   -2.338115299958283e-02   -5.895345980316383e-02   +8.403011512817551e-02   +1.577344624496971e-02   +4.463651363549117e-02   -3.529674410996615e-02   +9.528863192588588e-02   -1.918401911765468e-01   -1.637713083724948e-01   +9.664240745166199e-02   +8.236795131451261e-02   -8.082005435353044e-02   -1.081346627503839e-01   +3.680816263987416e-02; -2.882336688021023e-01   +2.259614600967341e-02   -1.897313474264619e-01   -1.939690476610335e-01   -1.969745871035655e-01   -9.177398930993105e-02   +5.136939503455570e-02   -1.460733280922172e-01   -1.005437663630264e-01   -8.802544678949889e-02   -1.430552445504714e-01   +1.553185281721392e-01   -3.061900301487794e-01   +2.163243051045964e-01   +2.690165084541318e-01   -9.883256102931619e-02; -3.336475497902208e-01   +1.251335260369527e-02   +2.034476439664147e-01   -3.099700449040335e-01   +1.479828166010608e-02   -2.258075640296759e-01   -5.417434154937910e-02   -6.036577666235446e-02   +9.222749889883033e-02   -1.045630272156558e-01   +1.687802770899161e-01   +1.328087592209852e-01   -1.369749637058977e-02   +2.374478061144396e-01   +1.758880531494891e-01   +1.131661762433694e-01; +2.533265192606231e-01   +1.070504977800755e-01   -1.372445240968461e-01   -8.546514402068431e-02   +3.987215025063566e-02   +5.543194297697129e-02   +5.213379340123969e-02   -1.075103163853853e-02   +2.455524482444477e-03   -6.215768667894002e-02   -5.590486242919253e-02   -8.793921075207242e-02   +8.507942463550275e-02   -2.757336900183516e-01   +3.094006888990368e-02   +5.328436967880352e-02; +3.375199446211168e-02   -2.894318638755880e-02   -3.060997662883394e-01   -3.245977813306657e-03   -8.021322047512690e-02   -1.355305728382340e-01   +1.138440780048847e-01   +7.953083512396690e-02   +1.946676736700561e-02   -1.154386219934034e-01   +1.982805366836091e-01   +6.093717709373597e-02   +3.732877267932579e-01   -4.482084727155718e-03   +1.060581601065014e-01   -3.064344356783165e-01; +6.854383920267347e-02   -9.620651221587283e-02   +1.481444524631671e-01   +1.679354409548285e-01   +2.787062118749313e-01   -9.130325824023379e-02   -4.140420152564003e-02   -2.472240537725851e-02   +4.203505515951887e-02   -2.074692363536183e-02   +8.892990733821809e-02   +1.933841309057143e-02   -3.651567523384732e-01   -1.273362523215147e-01   -2.554263348690065e-01   +1.830835719143944e-02; +1.815996176815947e-02   +1.373356036468852e-01   -1.386754089572361e-01   -1.851474725044787e-01   -2.793155499088650e-02   -3.573923252017554e-01   -1.675502915072722e-01   +6.047181041871907e-02   -7.721199577358108e-02   +2.258218030789894e-01   +1.673826043275798e-01   +5.659883009492394e-02   +2.233189575682700e-01   -1.170973811123137e-01   -2.492500400045532e-01   +4.641319516744699e-02; -1.545882292340388e-01   -1.479351409305531e-01   +2.388205826330522e-01   -7.724626948201524e-02   -1.296011565851481e-01   +1.808657235848791e-01   -3.492655681793645e-02   +1.516758097589839e-01   -1.321472096724181e-01   -7.171087432702795e-02   +3.029914911475763e-01   +1.285454178160729e-01   +2.868524789511269e-01   -1.856525791948788e-02   +2.043129007768773e-01   +1.506613906810251e-01];
L2I_L2E_iAMPA_netcon = [+1.904469120746770e-01   +2.864142886610709e-01   +8.306214885607165e-02   +1.738398528100900e-01   +1.149749366223072e-01   -7.528416088946245e-02   +1.277278462416680e-02   -1.563903786348529e-01; +1.306661369860874e-01   -1.265248355593160e-01   -1.149592803881024e-01   -2.515462809397379e-02   -1.555180025471394e-01   +2.146832850749569e-01   -8.484639351641314e-03   +1.272010949440935e-02; +1.447640329674353e-01   -6.381735865448324e-02   +8.460056604989959e-02   -3.282970862194361e-03   -1.376616009798405e-01   +8.317114309759175e-03   +2.890519865313641e-02   -1.870073582656272e-01; +5.392294261258781e-02   +5.380785483695814e-02   +1.961139708828811e-01   -1.975922407214275e-01   +9.702170587614424e-02   -2.674798283236535e-01   +1.604990303929318e-01   -4.229037625986971e-02; -3.212206345173501e-01   +3.011304077375855e-02   -4.829785738280247e-02   -2.808642835433770e-01   +2.045094077577676e-01   +3.535170664312334e-02   -2.692168043933202e-01   +3.508635553621979e-02; -1.751666989630659e-02   +6.821249469446712e-02   +8.109002603586198e-02   -8.713397627488496e-02   +1.482607303013841e-01   +1.544551717524873e-01   +3.301160775283540e-02   +1.995197622860558e-02; +2.420504613421089e-01   +1.706381044858929e-01   -1.632301907653254e-02   +3.100061701659463e-03   +1.803395776648314e-01   +2.158224782539256e-01   -2.762971983080398e-01   +1.255679623382720e-02; -4.795567944720768e-02   +2.218022828903668e-01   +8.581787169328893e-02   +6.211441450580942e-02   +1.129932161695476e-01   +1.469423337862991e-01   -1.288548772498409e-01   -1.055759469192757e-01];
L2E_L2I_iGABA_netcon = [+2.177087759585270e-01   +1.354345534303814e-01   -5.461891885113777e-03   +2.151931168982850e-01   -1.685953823725765e-01   -3.290049138297669e-01   -6.712354945332129e-02   -4.709212227259427e-02; -9.275419289026421e-02   +3.207290829572540e-02   +1.594910603984104e-02   +1.348631384020575e-01   +6.490076587735726e-02   -4.530006573951798e-02   -1.086169680821343e-01   +2.654636477999016e-01; +1.662489297911268e-01   -1.976039488083274e-01   -8.307131299118260e-02   +1.459515528429120e-01   +1.664127343099081e-01   +2.949142325865733e-02   -3.860646763758972e-02   -8.126033599315316e-03; +1.032415742245309e-01   +1.514836439334378e-01   -1.908793358037733e-01   +8.075046932767022e-03   +7.363725019819287e-02   -3.887406587393159e-01   -2.654480771422080e-01   +4.800122608700356e-02; +2.721746807615274e-03   -2.343350038652227e-01   +1.343372392293881e-01   -4.558924870504168e-02   -1.592857993256712e-01   -2.130613876613550e-01   -9.568997853217887e-02   +5.162745920870329e-02; -7.793033496236577e-02   -2.485696069197686e-01   -2.156150186721541e-01   -1.041822785936491e-01   -3.275493540444094e-02   -1.444284097723649e-02   -1.277338841248142e-01   -8.852457484334203e-02; -8.144734334588849e-02   -1.276806732687123e-01   -9.728490365445824e-02   +6.975908210105172e-03   +2.020133081841411e-01   -2.321080997974079e-01   -7.772725603237082e-02   +1.462596625188281e-01; -8.709026604660221e-02   -5.102670515088432e-02   +1.651897921107821e-02   -8.333961413597528e-02   +2.660176692951823e-01   -1.557703427430615e-01   -1.054596271169446e-01   -2.538441559685498e-01];
L3E_L2E_iAMPA_netcon = [+2.363402101774883e-01   +6.904290504548173e-02   -1.485346851074631e-02   +7.365602683275044e-02   -3.124183526257494e-01   +2.571151849583838e-01   -8.485671589389289e-02   +2.919573083946458e-01   -2.005744593160914e-01   -2.206979666978452e-01   +4.892837923596588e-03   -2.739995183976031e-01; -1.017303036689058e-01   -2.074655648508602e-01   +5.927195282222687e-02   +7.155418567856170e-02   +8.432518855775620e-02   -6.936291893703968e-02   -7.202939307368775e-02   +1.156484072944728e-01   -1.480332988148229e-01   +5.678854357587220e-02   +3.916852340600949e-02   -2.189651240485648e-01; +5.134081687746011e-02   +1.462065005316942e-01   -3.201478303023802e-01   -6.121278059191240e-02   +4.718443354880653e-02   +1.206855681005154e-01   +3.460289689152233e-01   +3.222836485310105e-01   -9.181427543973467e-02   +6.289244168022211e-02   -1.880275889021340e-01   -5.690393844125317e-02; +2.786543221471733e-01   -7.249498072258659e-02   -6.244659632786707e-02   -1.105201214584271e-02   +1.325822604119617e-01   +1.371598554197507e-01   -1.041421499283377e-01   +4.250018928588993e-03   -1.024847522036846e-01   -1.139708689586560e-01   +2.439090475830948e-01   -2.737527530140800e-02; -5.414835681455070e-02   +6.338818428494727e-02   -7.513456221481027e-02   +7.844540888015809e-02   -5.905049541009993e-02   -4.292653318991430e-02   -1.034728040462817e-01   -1.523007047156628e-01   +1.763287327899289e-01   -7.880114517430674e-02   +2.161548141464663e-02   +1.044141149251338e-01; +2.076133831294169e-01   -5.512513933329410e-02   -1.065243978196265e-02   +1.126741301338705e-02   -1.645015880961968e-01   -1.577333808649519e-01   +2.046567563025917e-01   -1.926591215736862e-01   -8.151711698424159e-02   -2.207077475394989e-01   -8.081418493989692e-02   +1.228556487614433e-01; +8.873282914009106e-02   -1.670698842274023e-01   -2.092913981396929e-01   -2.107745832478434e-01   +1.102115839205215e-01   -1.548314823049975e-01   +3.893658109956154e-02   +1.861552801792715e-01   +1.505721808006930e-02   +2.564297567521207e-01   -3.872376278674828e-02   +1.411391145200085e-01; -8.181523869428073e-02   -1.475522458216216e-01   +1.731857516290191e-01   -8.444737704239236e-02   -1.038540892469884e-01   -3.022293454122487e-01   +8.485785094068599e-02   -1.655552315638259e-01   +2.196814586660689e-01   -3.253675773666978e-02   -3.619718627786573e-01   +2.225944736460433e-01];
L3I_L2I_iGABA_netcon = [+9.594771979195588e-02   -1.408033839782882e-02   -1.365719164196517e-01   -1.717820854107001e-02   -1.997224181384814e-02   +1.914063229811362e-01   -1.371466837576190e-02   +2.570537145964087e-01   +1.627169104625251e-01   -1.017128959158609e-01   -2.493825121422754e-01   -1.142948450034673e-01; +2.024248716675023e-01   -4.115845378284790e-02   -7.303049984001896e-02   -9.389674176628646e-02   -1.866064624781878e-01   -1.133206517725210e-02   +1.438351956563504e-01   -1.433189742695098e-01   +1.782846437142113e-01   +8.480701599212914e-02   -3.221867846966266e-01   +8.989422407629140e-02; -1.201072403982124e-01   -5.076978042248980e-02   -5.138608160529719e-02   +5.153479213330146e-02   +2.929646036064840e-01   +6.769023852504183e-02   +1.478143328427441e-01   +6.537693907014297e-02   -3.366950779311726e-01   +1.367679232744649e-01   +1.427354130677141e-01   +1.735557191093274e-01; -1.811916053806259e-01   +1.377564608664102e-01   +1.737254479514734e-01   +4.852286688866107e-03   +8.222672229956900e-02   +1.691761782149420e-01   -1.495657580861515e-01   +1.543775620115407e-01   -1.347227069298944e-02   -1.412153682852167e-01   +2.283281523058319e-01   -4.632950888448256e-02; +2.842718155662831e-01   -3.663516657525828e-02   +1.456503535298249e-01   -4.319764293331074e-02   -1.109165864322784e-01   -1.291092230874137e-01   +1.001002482524997e-01   +1.627024865920804e-02   +2.119202373790681e-01   -2.898048207431006e-02   +3.270336310200840e-02   +3.896844035190430e-03; +9.603014263462462e-02   -2.771145294968780e-01   +3.435044854412226e-01   +3.001995722639206e-02   +4.563185145466423e-02   -2.605605239848788e-01   +6.109108814278164e-02   +3.076191105390396e-01   +2.289218724155773e-01   +1.485433652103442e-03   -2.019944614151397e-01   -1.618158788366657e-01; +2.947394764854360e-02   -5.715684042189584e-02   -1.761066082900892e-01   -9.513342367381060e-02   -7.263535257375452e-02   -2.219797320583783e-01   -8.451402658995597e-02   -2.367926062224578e-01   -1.462170326179209e-01   -9.556935771201593e-02   +1.534821816156832e-01   +1.427587158741080e-02; +1.152051599313113e-01   -1.665533058204581e-01   +1.676802902556267e-02   +8.154068740715743e-02   +1.554589533207656e-01   +2.343168384906670e-01   +1.061769064533295e-01   +1.800759847861039e-01   -1.830621802628052e-01   +2.328529435410015e-02   +2.548729064028927e-01   -2.583018675086867e-01];
L2E_L3E_iAMPA_netcon = [+3.135485230390977e-03   +1.704498014578718e-01   +1.694896938949217e-01   +1.301419555292169e-01   -3.680881012705374e-02   +2.971753285139944e-01   +9.999294743472577e-02   -6.204269875296903e-02; -4.851234447689759e-02   -6.060623569500408e-02   +2.503516702755732e-01   -2.351884217938207e-01   +2.205578975288213e-01   -1.001433005509023e-01   -2.091320285860761e-01   -8.731782249663114e-02; +2.157353542274277e-02   +6.074469100907536e-02   +1.968779490542878e-01   +2.666618077891285e-01   -1.800915624496185e-02   -1.553608162965499e-01   +1.472163999472868e-01   +1.378432590328853e-01; +1.644168054874250e-01   +2.767757426317697e-03   -1.111417183776275e-01   +1.139816482704736e-01   -1.529741446972699e-01   -1.256248971218645e-01   -2.887336189251762e-01   +3.301544150936452e-01; -1.009633520907851e-01   -3.216169367049149e-02   -1.916576505409693e-02   +8.207696421746966e-02   -1.038062290592140e-01   +1.778524712798218e-01   +3.199406484758600e-02   -1.602302594437207e-02; +7.753788567994295e-03   -1.475200671921504e-01   -7.302884548381190e-02   -5.477626120003120e-02   -3.318685376539348e-01   -7.452911213059678e-02   -1.933164345003340e-01   +5.009111158711250e-02; +9.602717996469394e-02   -1.490948444769656e-01   -1.948516494814985e-01   +2.021033831424141e-01   +8.600008569381754e-02   -1.982146811523149e-01   +1.491631899042234e-01   -6.562986543591640e-02; +1.580848102488380e-02   +2.372390464031143e-01   -1.991871815910540e-01   -1.233518048189406e-01   -3.165349101875529e-02   -5.029590338633334e-02   -1.410371030479877e-01   -1.344505502042121e-02; +1.229742286060403e-01   -2.682434189833909e-01   -5.342077016335717e-02   +1.066482128510982e-01   +3.512506995942244e-02   +7.175473534527874e-02   -2.403243646409893e-01   -3.591091320204308e-02; -1.561719652682352e-01   +3.590820493971542e-01   +2.043072781954850e-02   -3.469991071976296e-01   -5.861024327810048e-02   +9.465758908873759e-04   +2.201074283859948e-01   +1.067417026315273e-01; +2.759263360296384e-01   +7.225575616231224e-02   -2.015615843212929e-01   +6.729725021245886e-02   -3.609177650319383e-02   -1.154756338920457e-01   +1.310683579244073e-01   -1.048308043693305e-01; -1.366385077318120e-01   -7.819814030690297e-02   -1.184577691691989e-02   +4.827545668367461e-02   -2.672283328199711e-01   +5.000068149604131e-02   -1.675996496743744e-01   -1.900425087270460e-01];
L2I_L3I_iGABA_netcon = [-1.279902881419344e-01   -6.596952794958426e-02   -9.526148184218673e-02   -2.138482655971764e-01   -2.296573738613987e-01   -1.130846708845495e-01   +9.139198388620196e-02   -6.011958488370735e-02; -1.333949295118574e-01   +1.226371486724182e-01   -1.951015402467512e-01   +9.333453713929991e-02   +1.514874006341878e-01   -6.773090955022973e-02   -1.848125095781972e-01   -1.341833583617482e-01; +9.821305238364988e-02   +1.807750054757936e-01   +3.365212444425358e-01   +2.416116021770331e-01   +2.474999440000982e-01   +2.171593151451142e-01   +4.555815450291585e-01   +9.921298207546719e-02; +1.638232308943726e-01   -1.817292224111565e-01   -2.401568267465612e-01   +1.873934359516183e-01   -1.253074867891077e-01   +2.840942414175830e-01   -2.166264825187491e-01   +5.166225053010462e-02; +1.454266289194784e-01   -3.624584564642259e-01   +1.059502215947839e-01   +7.464540995420764e-02   +8.434156189404507e-02   +3.692574921568432e-01   -1.757750264151917e-01   -3.625570014201559e-02; +3.208162258676123e-01   -1.395373321847026e-01   +1.335954359857686e-01   -1.636409884600473e-01   +1.454881092888245e-02   +9.818701631423249e-02   -9.113453385286895e-02   +9.169552767750236e-02; -5.349339538469207e-02   +4.340626827689788e-02   -1.675942550564457e-01   -5.083006326662580e-02   -1.682790507598198e-01   +6.808250694286564e-03   -2.296956392424341e-01   -1.344461682436560e-01; +1.324202083883055e-01   +1.379722981105102e-01   -4.150963554694802e-02   +1.696316579181719e-01   +2.052183841945055e-01   -2.824776850575270e-02   +1.870663889997961e-01   +6.053137286932786e-02; -2.896056550573620e-01   -1.846690642000544e-01   -1.663435696752998e-01   +3.104400895157993e-01   -7.172339615394654e-02   +1.723085605592869e-02   -1.421557455077602e-01   +1.788053006852595e-01; +7.440009457546448e-02   -9.693519720784617e-02   -2.959496984692560e-02   +1.352374530545016e-01   +3.154832260749940e-02   +2.691614205626540e-02   -1.049344591882882e-01   -5.945207121570152e-02; +3.165562355439734e-01   -1.263313909272912e-01   +3.036005637788411e-01   +1.741894187398889e-02   +1.090352584892886e-01   -2.699197905692842e-01   -5.318659504229559e-02   +7.758517594157185e-02; +1.367843233773682e-01   -2.784209571118571e-01   -4.969944305368261e-02   +4.845355000018169e-03   +6.213797320573205e-02   +3.162048309467855e-02   +9.251073249459105e-02   +2.391197375495863e-01];
L3I_L3E_iAMPA_netcon = [-2.845417251215590e-01   +1.905718031576215e-01   +2.438958303034839e-01   -2.383061941840063e-01   -1.031536312057374e-01   -3.154085186279056e-01   -2.155058871143556e-02   -2.138773180518508e-01   +2.457812391942629e-02   +9.053864199677661e-02   -9.377699446722493e-02   +6.433785031886685e-03; +8.797968290670470e-02   -1.843919253098061e-01   -3.931861902530491e-01   +1.036826964127912e-01   +5.009050860525670e-02   -3.164930705685953e-02   -3.032029812165466e-01   +7.451320597357033e-02   -3.827580291696736e-02   +1.379912156222778e-01   +2.716508489486699e-01   -9.048230478530218e-02; -7.826540061321080e-02   -2.982828019573032e-02   +4.097704511237169e-02   -8.283321185124981e-02   +1.250165378844780e-01   +1.690473306959443e-02   -4.068102943210117e-02   -2.419315137564854e-02   -9.289559444996795e-02   -1.405556012604761e-01   -1.683116704297182e-01   +2.474922002460551e-01; +7.666679948387087e-02   -3.107591361173417e-02   -8.489711285996371e-02   -5.818769357370125e-02   -2.431442468090255e-01   -2.811543869296829e-02   -2.207708254720085e-02   -3.388411769292623e-01   -2.164519616110188e-01   -2.886443975624346e-01   +1.602212259177098e-01   -8.074718436012636e-02; -2.778561068285976e-01   -3.975175810982635e-02   +1.202901812847118e-01   +1.957653518592621e-01   -1.111206395730397e-01   -1.139021730595699e-01   -2.326106750652579e-01   +2.663440690336139e-01   +8.292917766678773e-02   +4.928666597625508e-02   +2.367460539309908e-01   +3.753095615804627e-02; +5.418998601679337e-02   +4.268207434732448e-02   -2.730908684481430e-02   +1.088479388057769e-01   +4.348163142349640e-02   -4.073744539279135e-02   +2.158034165148719e-01   +6.212058747997356e-02   +7.898250073000974e-03   -6.352849690180751e-02   +1.788531063073770e-01   +9.727807180771905e-02; +2.116904133568951e-02   +3.238900258902916e-02   -5.982956696173138e-02   +5.431914711018934e-03   -8.117181626936454e-02   +1.388240811618194e-01   +1.517257902818290e-01   +5.145299305642830e-02   +1.770282464414476e-01   +2.677899484776530e-02   +1.898301165395843e-01   +3.144591387603313e-01; +1.622546154164074e-01   -6.817885659959484e-02   +4.879816821832305e-02   +3.119767738098275e-02   -1.447808416423393e-01   -1.939043037641463e-01   -1.258234904695941e-01   +1.377446412491385e-01   -2.379771610376390e-01   -7.146602789370644e-02   +1.612497339209914e-01   +5.408025544618092e-02; +1.580413689285856e-02   -4.478888823032295e-02   +2.479869844401169e-01   -1.012955277370420e-01   +4.723696199868725e-02   +5.891767141040651e-03   -7.034164475857686e-03   +8.447998639538726e-03   +1.815879816528310e-01   -3.938954412560509e-01   +4.747077728083630e-02   -1.655669055257199e-02; +1.877445671334107e-01   -1.031745441643427e-01   +2.060069059106495e-01   +7.877500684145425e-02   +3.358150004261090e-02   -3.015297922217989e-02   +4.369189588950727e-02   -7.309110078836895e-02   -1.430245491948284e-01   -1.110865619923097e-01   +4.468587280989714e-02   +2.259583072707185e-01; +6.937846099699474e-02   -1.918951837518010e-01   +3.338260707495142e-01   +2.178589838218840e-01   -1.100587883296753e-01   -1.204447852150103e-01   -3.414087695052753e-02   +1.404457795988395e-01   +5.754911892902539e-02   +1.817902265785928e-01   -1.274566028051458e-01   +8.142750299554032e-02; -2.572202825995686e-02   -2.669110372842856e-01   +1.120640173196376e-01   -5.413234912223247e-02   +3.805921359225823e-02   +1.953960263646942e-02   -1.444669183307493e-01   +1.912443400432657e-01   +3.428022294252805e-01   +2.303279380747148e-02   -1.956471484517172e-01   -9.863418989938388e-02];
L3E_L3I_iGABA_netcon = [+2.058646039931558e-01   +6.622418247715527e-02   -1.871407284619482e-01   -2.202592628172030e-02   -5.984904559691434e-02   -2.589169947456492e-01   -1.426986053193556e-01   -1.157232074682228e-01   +7.535000022440067e-02   -1.354106943720330e-01   +1.715376206725890e-01   +1.412114147736458e-01; +1.359589463204865e-01   -3.815851598955288e-02   +5.227309214594138e-02   +8.121006336482792e-02   -1.517568856017588e-01   -2.213943384782233e-01   -2.639782370552581e-01   +1.253044717637937e-01   +2.738319210837957e-01   +1.311929820135893e-01   +2.403781044077923e-01   +5.908316649784823e-02; -3.534384724842931e-01   -6.989165567140779e-02   -2.024590448679421e-02   +2.642263883357267e-01   -2.751420486186250e-01   +3.443982294442252e-02   -3.504840422960867e-01   +6.491387436926345e-02   -9.411258630690797e-02   +2.083719096060190e-01   +8.661072107224999e-03   +1.567432287273177e-01; -2.638880396710558e-01   -1.287339600531639e-01   +1.313712297191915e-01   +1.515234438336915e-01   +4.958394422539052e-02   +4.999304685797373e-02   -1.038952398648736e-01   +1.478004479612768e-02   -1.279604410550479e-02   -2.344255840691722e-01   -1.346879374617125e-01   -1.432239628037096e-01; +5.271351165933852e-02   -4.055402561846428e-02   +1.926610406554187e-01   -1.284491911503859e-01   +5.812547885724278e-02   +1.350511941428681e-01   -2.006507490177288e-01   -2.436085207800620e-01   +1.054638951996751e-01   -2.947128203076431e-01   +5.105153557661922e-02   -1.239620647693653e-01; -1.882824783085005e-01   +3.136636445682782e-02   -2.081772930278489e-01   +1.064803332716119e-01   -1.418657432055035e-01   +2.878848528086278e-01   -4.362735372203130e-02   +1.408478502203835e-01   +2.247558735338155e-01   +3.341271628910602e-01   -5.735382835054504e-02   +1.655296424139400e-01; +1.315978508644265e-01   +2.870777847262800e-01   -6.296258204653175e-03   -1.748888694702493e-01   +2.041915802398413e-02   +1.169687957866018e-01   -1.877017005538235e-01   +2.473186029419273e-02   -1.716825544765774e-01   -7.607016759719663e-02   +1.137598729532397e-01   +2.174150649946896e-01; +2.609718461697071e-01   +3.188309276364452e-02   -9.235969157600556e-02   +2.735152403667233e-01   +6.382277640627854e-02   -2.134174248386951e-01   -6.748671754547209e-02   +2.358724910159737e-01   -2.434384534440286e-02   +2.189906380856177e-01   -7.572157058425133e-02   +7.405380384238430e-02; +1.869347747184191e-01   -4.398401477543154e-02   +8.526925893448900e-02   -6.099701683273859e-02   -1.213422132780561e-01   -2.530542303771343e-01   -6.163218406522671e-03   +2.568465455198450e-01   +7.242609920688604e-02   -2.344498917207167e-01   -2.676639035187925e-02   -1.582917845517832e-01; -1.606111673001247e-01   +9.222572962774603e-02   -9.721872371428417e-02   +1.624450790930712e-01   -1.383742933863987e-01   +2.451959952288718e-01   +1.814539951616007e-02   -6.471885103137473e-02   -1.373397078797241e-01   +2.494114514099829e-01   +3.933939187160345e-01   +7.861234518937676e-02; -3.082750542761020e-01   -4.196185522000818e-02   -4.110011787079128e-01   -4.593780240739955e-02   +2.308945354464796e-01   -2.695825705205029e-01   +2.890382184537272e-01   -1.291666566999309e-01   +1.665155337309859e-01   +1.368138539061620e-02   +7.949772494468732e-02   +2.695696442172726e-01; +1.374103861852631e-01   +7.051155377064976e-02   -5.732702674069139e-02   +2.306586900304083e-01   -1.348009746875517e-01   +7.348470760510996e-02   -8.783860828267070e-02   -1.918086742377778e-02   -9.053510059774837e-02   -2.325468112014682e-01   +9.274688547040447e-02   -1.456407126091126e-01];
L2E_Input1_iAMPA_netcon = [+1.354655166582481e-01   +9.601948792372121e-02   +2.326244409269187e-01   -1.996182606845946e-01   +4.961625998973541e-02   -2.035870702976240e-01   -3.900821818969093e-02   +1.417825191381811e-01];
L2I_Input2_iAMPA_netcon = [+1.172263704895244e-02   +5.042128721824077e-02   +8.416967252725732e-02   +1.109590342131156e-01   -1.321757456670415e-01   +2.023619175079767e-01   -1.848354578594564e-01   +3.227873082794114e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
