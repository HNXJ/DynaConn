function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-4.708191215120747e-02   +3.960161202533388e-03   -1.041043509749589e-01   -1.240223034422817e-01   -3.266777721086381e-02   -1.826958743532145e-01   +4.661292646531422e-01   -2.795923878032459e-01   +1.815988163829425e-01   +4.833240534246013e-01   +2.630495867696448e-01   +7.856055207968110e-02   -1.605994216231617e-01   +1.730432956312049e-01   +4.338938359364396e-01   -6.786950456302770e-01; -3.652900014516922e-01   -2.913550750192497e-01   +9.813268225485380e-02   +3.478257344487783e-01   -1.620681625404694e-01   +2.351124869058219e-02   +3.568254935502569e-01   -1.154188580814073e-01   -3.545955632931987e-01   -3.408978865162713e-01   +3.208777605133707e-01   -2.796731868870317e-02   -3.811793235572320e-01   +1.370121109911136e-01   +1.167928482002192e-01   +2.234046548065700e-01; +4.513798982530345e-01   -2.961198472380516e-01   +4.202264380734387e-01   -1.960874141950765e-01   +3.916132646836171e-01   +1.191355359135742e-01   -2.423847099239890e-01   +3.790796204427440e-01   -1.357808134860056e-01   +3.867334807696067e-01   +7.232164421334661e-02   +1.039446877392969e-01   +4.710635236072702e-01   +1.979315435791276e-02   +4.924555885948613e-02   +1.047757152880401e-02; -1.385076406992355e-01   -3.181376615940649e-01   -2.524835894220275e-01   -4.634930601095019e-01   +9.935662234470610e-02   -1.555454586354959e-01   -1.546545350191603e-01   -4.737439718639477e-01   +4.634012022904363e-01   -6.048847709501614e-01   -1.820130237079458e-02   +3.184420780668983e-01   -9.550286592559061e-02   -1.848324353728659e-01   +3.010324071250713e-01   -3.359849382701229e-01; +1.497972260638706e-01   +2.236031861287138e-01   +3.286375976983046e-01   -5.679523921088583e-02   +1.074828719166190e-01   -2.207342303465229e-01   +4.669845711131826e-01   +4.636140701459247e-01   -1.152280886405205e-01   +8.904705140042529e-02   +3.603231182673504e-01   +3.200213143370705e-01   +6.093409522360710e-01   -2.957697054535229e-01   +1.664555570254928e-01   +1.652592216564451e-02; +7.084942551370107e-01   -4.513032601889831e-01   -2.616962538777202e-01   -3.104726110668359e-03   -9.253669383973978e-02   +4.045001525163425e-01   -3.220842138253480e-01   +3.903712415311539e-01   -2.424701048387622e-02   -1.810393716944130e-01   +1.123572341014896e-01   -1.204237961633036e-01   -1.494898307392875e-01   -3.817426423487223e-01   +2.073412685386096e-01   -4.645214977302699e-02; +2.609845627058306e-01   +2.639631655311883e-01   -5.692418513243318e-02   -4.327760746302039e-01   -4.736549509790939e-01   +3.701356280487178e-03   +1.282088793412105e-01   +1.948954017747903e-01   -4.673457531172656e-01   +2.138828521074774e-01   +2.181625411885331e-01   +3.503577536539173e-01   -1.346286761585024e-01   -7.309596862221027e-01   +2.359887206112737e-01   +3.787751975153815e-01; +1.310898142699456e-01   -3.514456499636295e-01   +1.427158608965573e-01   -6.547577795795768e-02   +1.099124176186604e-01   -6.431969011030089e-01   +2.752652817877571e-01   -1.923115845833285e-01   -3.205145750905896e-01   -3.018427405714625e-01   +1.662281590062941e-01   -2.263622288910839e-01   +2.272873622046743e-01   +3.371343893232723e-01   -1.374235833814633e-01   +5.078294021311456e-01; -7.831126930194171e-02   +1.592885699384233e-03   -2.524794515392752e-02   +2.407468037248194e-01   -1.410327694930726e-01   +5.162463749925588e-01   +8.258863733166219e-02   +2.827757392659094e-01   +8.322314046730778e-02   -2.123954056066452e-01   -1.786145545799458e-01   +4.851446751528459e-01   +1.237631953369018e-01   +9.222131066529488e-02   +3.058080723785014e-01   +5.733877480917452e-02; +1.887319221878349e-01   -1.827969678432198e-01   -2.871477964823370e-01   -3.645636680667644e-01   +5.103641235296646e-01   -5.214012955539673e-01   +1.635770448330502e-01   -1.062415520431218e-01   +2.957496958322423e-01   -4.013888135999037e-01   +5.315850083180153e-01   -3.784672398536542e-01   -2.100167285163126e-01   -3.682321771090553e-01   -2.994226060186371e-01   +4.296517807317294e-01; -2.374063614701677e-01   -4.367968324736925e-02   -3.048354153107113e-02   -8.762572177513976e-02   +1.866127095569018e-01   -2.547594199142014e-01   +7.596109172212923e-02   -1.982403840678131e-01   +3.800400104507544e-01   +5.449208639744291e-02   -3.259418962092072e-01   -3.321868241761569e-01   +1.833352415773203e-01   -3.088089301993474e-01   +1.585287541500054e-02   -6.288739530669928e-02; -8.523772785621898e-02   -2.392401918125085e-02   -1.503104059984993e-01   +6.577327461861300e-01   -2.001324258974223e-01   +5.645422704088624e-02   -3.824225713988590e-02   +6.470610934486137e-02   +2.069837301781293e-01   +7.208913374447747e-02   -3.895053970353438e-01   +1.700165404669289e-01   -3.367748920912147e-01   +5.015473513134774e-01   +5.871013996002140e-01   +2.589212828795898e-01; +3.710452364792378e-01   -3.576596577170917e-01   -6.614310554119900e-01   -6.866315512054656e-02   +2.970360060678821e-01   -4.156139932792182e-01   -9.769301061545799e-02   +4.360982457252555e-02   +2.523582382965422e-01   -4.720043315500425e-02   -5.369043854515417e-01   -1.508124886373551e-02   -4.478395635887089e-01   +1.946558294823285e-01   +2.746271777091563e-01   +3.709352504091383e-01; -5.413883320470416e-01   +2.398081324401407e-01   -4.512106960444933e-01   +4.660533204225986e-02   +9.095487156031154e-02   +1.538538279419059e-01   +5.322294345570980e-01   -3.022662941674919e-01   +4.713759685343168e-01   +4.262083109589918e-01   -8.591357502829008e-02   -1.070343707262332e-02   +3.873257648891719e-01   +2.375822415489526e-02   -1.368767964175160e-01   -2.245043379916558e-01; +2.592519197870093e-01   +7.259733773624111e-02   +3.601737314783292e-01   +2.033237141489745e-01   -3.850747609294576e-02   +5.459251085879224e-02   -3.604078786422169e-01   +8.759708291969950e-02   -1.492096876763027e-01   -1.067957718001486e-01   +4.325261059004716e-02   -2.382221088296891e-01   -4.672211771384980e-01   +8.249873452843456e-02   +3.892550409267624e-01   -4.697292503403261e-01; +2.140509400322049e-01   -1.968390673781956e-01   +3.531550931164079e-01   +7.627759576752697e-01   -3.943325581074163e-02   -1.303317774284986e-01   -6.063676852076726e-03   +2.070228943554142e-02   -1.562313314700323e-01   -5.174733395082319e-02   -6.281394419958224e-02   +1.433955113380146e-01   -4.138772294021782e-01   -4.935762967935459e-01   -2.222384240960809e-01   +3.022492797078268e-01];
L1E_L1I_iGABA_netcon = [-2.303875482121905e-01   +2.291832708526793e-01   +3.827207389300916e-01   -6.907001808230434e-02   -6.256658491029808e-01   -6.153796739958618e-02   -7.989033451768358e-02   -1.097540510304176e-01   +2.594111284640981e-01   -4.325669994045110e-01   +1.508449279659037e-01   +4.744772816557177e-03   -4.744542861453975e-02   +2.213483330063735e-01   -2.010762362167247e-01   +3.915491671308051e-02; -4.244299183763131e-01   -6.000703064194363e-01   +1.083920094567168e-01   +2.464375988094348e-01   -6.671245382749019e-03   -1.753591830179068e-01   -5.910184365806500e-01   +7.471943052984240e-02   -2.699157994922143e-01   -8.363675643795065e-02   +2.696629638533212e-01   +1.138593640234948e-01   +2.519145552920941e-01   +1.058805445976391e-01   -2.536545818982784e-01   +3.046818143697781e-02; +6.308817040220679e-01   +3.272598740764133e-01   +8.112805720653944e-02   +9.858957903817175e-03   -2.717178108478420e-01   +3.108495486956396e-01   +3.431191475525810e-01   -1.238737218081080e-01   +2.086002564699972e-01   -1.439021202323184e-01   +5.554277051289563e-01   -1.545507947104142e-01   +3.112993102913960e-01   -2.176931605174751e-01   -6.748867389605369e-01   +6.597644580380505e-01; -5.168919427294735e-03   +2.472623434829706e-01   +6.781067527706213e-01   -4.282950884908898e-01   +4.043193304537014e-01   +3.436487359874990e-01   -1.547830274541904e-01   -4.022200322951014e-01   +1.993011134474788e-01   +2.530136676204688e-01   -5.262825552559498e-02   +1.372642320426860e-02   -2.550678392317771e-01   +2.022388137837925e-01   -4.448761344359685e-02   -5.365868260988269e-03; -5.372839748687586e-02   +3.804705985284775e-01   +4.284018887319013e-01   -4.011961301332045e-01   +2.204941138437468e-01   +1.774088311314846e-01   +3.289723007645874e-01   +3.466597620732463e-01   -3.818785998038250e-02   -2.673629819560526e-01   +2.299399567955014e-01   -3.151736449355241e-02   -1.024405708677205e-01   +3.001118925033738e-01   +1.186578852304495e-01   +3.834064493469277e-01; -3.993637423970713e-01   -3.971767279822518e-01   +1.303073514264607e-01   +2.340891429429196e-01   -2.895878415232191e-01   -3.628467960434997e-01   -5.101340670510859e-01   -9.833185910491026e-03   -2.590892080245508e-01   -1.430005571232248e-01   -9.415217345520518e-02   +1.465032491108909e-01   +6.509713818788621e-03   +2.746607669894188e-02   -4.337681270486322e-01   -2.983160770903682e-01; -2.652814031535674e-01   -1.113368196479415e-02   +9.468609488806894e-02   +4.558225544556606e-02   +1.213202090454847e-02   +1.876965122598561e-01   -1.401103158648461e-01   +5.182193251050387e-01   +1.329543299582593e-01   +2.407731295521776e-01   +2.705546086108290e-02   -3.139667207199762e-01   -1.655169525771622e-02   -5.113832084095277e-01   -1.199942486724995e-02   -5.430048149732847e-01; -3.882611330583266e-01   -2.758096389697582e-01   -9.444523921516210e-02   -3.272553616287182e-01   +3.048466810541817e-01   +5.944602522859231e-01   -7.681415344868794e-02   -4.058084417611824e-01   +7.326212413398046e-02   +5.129320010687604e-01   -1.180213558895381e-01   +3.381455641640557e-02   +1.457242067765217e-02   +3.971677665262580e-01   +2.985091775638402e-01   -2.964077216440441e-01; +2.657624500838038e-01   +2.418120828176722e-01   -3.186040336900109e-01   +4.985437108761993e-01   +3.694314500678355e-01   +1.985602738372637e-01   -3.399301471837802e-01   -1.088698618899420e-01   +3.546731217697080e-01   -4.529074424925914e-01   +1.612515965444889e-01   +7.718570074255452e-01   +1.156261765017639e-01   +1.321248938695889e-01   +1.234464124831284e-01   +4.285724512752651e-03; +1.441858932882010e-01   -2.097436772687135e-01   -4.289049343837823e-01   -8.105120113926285e-02   -6.368601327226681e-02   -5.664268852356223e-01   -1.473906317276013e-01   -2.068982407784619e-01   +2.398881222271583e-01   -5.589374625857759e-01   +2.815565185384805e-01   -4.243872685968785e-02   +3.712917868047953e-01   -4.862787579223647e-01   +9.991674568039702e-02   +4.943054601150690e-02; +3.704857439560622e-01   +4.002090358078827e-01   +2.512222300906859e-02   -1.176584181305287e-01   -1.237536892002003e-01   -4.135236754320952e-01   +6.558459858217108e-01   -4.004749377985244e-01   -7.002526899066013e-02   +1.626237731708416e-01   +2.588029159541814e-01   +5.482322761527658e-01   +2.232681242337784e-01   -2.179113801004291e-01   +4.217309903117109e-02   -2.597465099258931e-01; -9.321294502434936e-02   +4.800497637087901e-01   +2.825413543243115e-01   -3.492598964527924e-01   +5.185389327013398e-02   -1.558670701973397e-01   +4.543388641542719e-02   +3.405375753414029e-01   +1.214850917647775e-01   +1.348380574925026e-01   +1.340150267998893e-01   -5.173986786415873e-01   -2.441031597933801e-01   -2.316735476817756e-01   +2.074978817737540e-01   -7.518167161708209e-02; -3.702189855279424e-01   -1.006074925870502e-01   +2.463432815621600e-01   +1.457656442315556e-01   +6.013696477014344e-01   -2.954029752448422e-01   +5.203257263287406e-01   -4.299801498418808e-01   -2.535216487990098e-01   +4.068028275895027e-01   -2.262704800131919e-01   -2.093609844257759e-01   -2.366224825125642e-01   +3.253466611780397e-01   +1.561457793642547e-01   +2.254908689100920e-02; +9.984991931467553e-02   -1.115667016498669e-01   -3.838570005471676e-01   -3.973390867188464e-01   +2.905438254025869e-01   +1.314765109455035e-01   +4.064087767984320e-01   +6.228200637570912e-01   +1.861078651925650e-01   -1.644729263566415e-01   +4.682611809452065e-01   -1.465453968494178e-01   +3.711088713786769e-01   -2.303572414938210e-01   -2.268076678527683e-01   -4.965651922897901e-02; -1.841859243013507e-01   +2.317043459204152e-01   -2.330229344583314e-01   +1.910296467782533e-01   +2.506746098797051e-01   -2.584220116104082e-01   +2.330647806920961e-01   -4.313328690735050e-01   +1.391668007534773e-01   -2.630893811625988e-01   -1.704519466493489e-01   +4.116872572507874e-01   +6.761360558725923e-01   +1.257212052587578e-01   -6.611432878157403e-02   -6.435797391548649e-02; +2.569318330106667e-01   +4.958191432138885e-01   +4.176900624947563e-01   +8.456337308149584e-02   -2.980177227227143e-01   +5.696237985952948e-03   +1.601565052287075e-01   -5.846147122737938e-01   +7.389446119314497e-02   -7.927395127054362e-02   -6.757003711607834e-01   +2.438625525584562e-03   -2.012311498040412e-01   +3.576565750173488e-01   +4.259594948185412e-01   +3.095397631626501e-01];
L2I_L1I_iGABA_netcon = [-2.030066280194068e-01   +1.673305956540933e-02   +2.660758728129164e-01   +2.459315692683078e-01   +4.991055360736809e-01   -6.527351881849491e-02   -1.578982180519168e-01   +1.830045325558521e-02; +3.394309372284344e-01   -5.739751381119240e-01   -2.733889209855056e-01   +1.703083669448026e-01   +2.872500570961521e-01   +2.615792673184560e-01   -3.785074906608618e-01   -4.840044604928773e-01; +2.635439963114670e-01   -8.562037823549662e-02   -3.416933856384852e-01   +9.081633930324254e-02   -6.612932797830061e-02   +6.340514411773304e-01   +4.065633644647065e-02   -4.934327285886166e-01; +6.121040107303672e-01   +7.110691140909760e-01   -1.846627858884378e-01   -6.239239790126486e-01   +2.899727510017012e-01   -6.292990436737442e-02   -1.510510352214558e-01   -1.640187803467361e-01; -6.318359144112534e-02   -5.654667945117231e-01   +3.801742614544861e-01   +5.778147990186031e-02   +7.910746338069581e-02   -2.181486077411087e-03   +6.181219367439859e-01   -3.131309608972656e-01; -4.796437879115403e-01   +2.104488834743362e-01   -3.899406678668793e-01   -3.541760611428684e-01   -2.392087463365784e-01   -4.207089388982804e-01   -5.153753882100716e-01   -7.836402964127290e-02; -2.208851472741409e-01   +3.544827197952243e-01   +2.300265602497620e-01   -1.582270735531277e-01   -2.608135208679110e-01   -2.929845520218932e-01   -2.431917638064390e-01   +3.583492224840762e-01; -1.077567880094823e-01   +4.581300845990818e-01   -7.594224834985203e-02   +5.319146932131953e-01   -2.248274143227507e-01   -3.060141751716200e-01   -1.456350014502533e-01   +4.783890930713249e-01; +1.537008422916129e-02   -2.964699310397742e-02   -2.053554295831255e-01   +1.936940193794788e-01   -1.916062699631338e-01   +5.769883401506563e-01   +1.162870697937462e-01   -2.351054679452704e-01; -4.210682361374785e-02   -3.434724133515816e-01   -3.424123087449014e-01   +6.658238793520216e-02   -4.688256877209806e-01   -3.165963844229263e-01   -2.319217052080052e-01   -4.901467440064248e-01; -3.714238905395497e-01   -6.674530346248572e-01   -2.715636313249341e-01   -4.261051951390130e-02   -5.132389198111060e-01   -3.749744451304625e-01   -7.075617349434752e-01   -4.722577908833148e-01; -5.241208534536401e-01   +3.460826535945359e-01   +4.714476227377939e-01   -6.448207007155202e-01   -7.320004758382616e-02   +4.555138210197678e-01   -6.256486011017416e-01   +1.414962254855773e-01; +4.755707992396795e-02   +4.502645725685082e-01   +1.412192734083833e-01   -1.886082809250555e-01   -3.040660187743117e-02   +3.504060846505655e-01   -2.376382908862255e-01   +3.616959544891562e-02; -9.594054238240005e-02   -7.923225132167278e-02   -2.420347227659320e-01   +3.741759159317533e-01   -1.699051405367125e-02   -1.432293812881570e-01   -8.355937692596191e-02   -3.539293908412093e-01; +5.115834814430734e-01   -1.482887120542685e-01   -2.299320466395217e-01   -6.934221700699809e-01   -2.958059941442651e-01   +3.654764157904738e-01   +6.818843982071179e-01   +6.684062320719995e-02; -2.366077773983806e-01   -1.437768020304765e-01   +1.237127708372312e-01   -3.948245875440474e-01   +3.494652284685515e-01   -1.625787676462218e-01   -6.611784851523879e-02   +2.265477263802547e-02];
L1I_L2I_iGABA_netcon = [-1.878273883729598e-01   +3.324420294961156e-01   +2.081094005771321e-01   -4.042198209359243e-01   -2.845696683363330e-01   -4.290367283072712e-01   +3.964418107722298e-01   -5.418659323986674e-01   -3.318963174509278e-01   -5.384043014458357e-01   -4.703175284035815e-01   +4.622761763701431e-01   -4.789107184097215e-02   +4.986760572053817e-02   -1.582516073743499e-01   -2.578963054998572e-01; +4.734902644629448e-01   -2.075196160197768e-01   +3.113901789259292e-01   +3.224210592800592e-01   +4.253968176733909e-01   -2.146734064647355e-01   +7.152195902271228e-01   +1.316453700690594e-01   -1.547528969785292e-01   -2.772210086857081e-01   -1.165947370087763e-01   +2.075129426639465e-01   -1.426927504670157e-01   +1.581952236021791e-01   -5.618038808595837e-01   +1.787726092613251e-02; +4.825509750528908e-01   -1.033073957083914e-02   +6.393226170339563e-01   +1.784110171787872e-01   -3.356478538258797e-01   -5.192809875184279e-01   -3.541562463093977e-02   -3.786504705713969e-02   -2.376415229146178e-01   -3.388410831638852e-01   +8.690960231034814e-02   +1.151115946901539e-01   -4.522118725359969e-01   -9.149416500206925e-03   +1.787919445991372e-01   +1.212357155352722e-02; -1.617295822782798e-01   -4.666411304847118e-01   +2.372992285691011e-01   +2.566951583328181e-01   -2.848322960852034e-01   -4.629409707566103e-01   +1.035389099397145e-01   +5.942791375525834e-02   +3.162279891560795e-01   +1.754110124896228e-01   +2.974886641321968e-01   +2.208101183441481e-01   -3.356100279105480e-01   +7.746422056017720e-01   -3.231588813987454e-01   +3.027694343156929e-01; -1.681001883811605e-01   +1.699535835613085e-01   +5.276599679279700e-01   +3.908009403758810e-01   +7.313357468547468e-01   +3.091166134956611e-01   +9.412105717773650e-02   +2.441617238712730e-03   +7.639018705983057e-02   +3.756906843312798e-01   +2.543725179965898e-01   -2.316961243286953e-01   +1.872981153356401e-02   -1.299050066438404e-01   +3.580137819456825e-01   +5.194928452770409e-01; -1.301350723164758e-01   -1.781290824278100e-01   +7.956549450064009e-02   +2.637709458383682e-01   +1.766241290424456e-01   +2.963162171924511e-01   +2.272920899814153e-01   -1.132747606951608e-01   +7.441742629871864e-03   +8.197265607641055e-02   -2.471962049152944e-01   +1.688626551277433e-01   -3.233642781806108e-01   +5.321060829954409e-01   +1.839005493851005e-01   +1.800930314093092e-01; -3.720368035341327e-01   +5.695247451549040e-01   -9.175442116649792e-02   -2.136945228050627e-02   +4.794153771637614e-01   -5.407709357042996e-02   +5.356324649839296e-01   +1.995317810171918e-01   +3.446469890663706e-01   -3.488574651810522e-01   +2.363746288733571e-01   +1.361024377982075e-01   +2.621188826111157e-01   -1.348198870632745e-02   +2.801045198810264e-01   -8.152046049403761e-02; +4.644818131695632e-02   +1.051310863350761e-01   +3.443055034274743e-02   -1.728034521654394e-01   +2.738929217324706e-01   +8.737824156601585e-02   -1.775447204460631e-01   -2.750731992577500e-01   -3.553507883275213e-02   -5.281263780981064e-02   -5.509710262647842e-01   -2.095663221759931e-01   -1.694546148208942e-01   -1.046394588602003e-01   -1.826631515875824e-01   +2.264254551384706e-01];
L2E_L1E_iAMPA_netcon = [-6.979032124466191e-01   +4.504611366676485e-01   -1.550195900823210e-02   -2.680874621677282e-01   +3.284390175913035e-01   +2.909392488996069e-01   -2.558446037536455e-01   -1.865129132881725e-02; +2.336812743874434e-01   -2.057308057330554e-01   -1.940296583013543e-01   -3.045961415232225e-01   -3.186114474477394e-01   +6.369932408961395e-01   +6.811143652026674e-01   -1.953417708895806e-02; -2.693783682234454e-01   +6.448866261883173e-01   -6.685492662487678e-02   -5.783487175080243e-02   +1.963720447136687e-01   +3.928876474181874e-01   -1.707381651440413e-01   +5.185270169667205e-01; -2.075109002559488e-01   -2.535285701254887e-01   -1.618949392750214e-01   +4.864784761801926e-01   +3.505762353176339e-02   -1.624022513125122e-01   -3.230937235239803e-01   +4.504265641085499e-01; +1.017833464359144e-02   -1.394215777241739e-01   +4.273909476546248e-01   +6.227089212043127e-02   -4.373861556209744e-01   -7.824945216675355e-02   +2.670923649602731e-01   -1.390096411640987e-01; -5.167663322288645e-02   -1.717889110396479e-01   +1.278888953848389e-01   +1.263002622926913e-01   +1.118578011867073e-01   -7.969734077165008e-02   -8.340438251511496e-02   -5.467524566992008e-02; +1.886367100276005e-01   +1.231837300581430e-02   +3.055297198502838e-01   +6.328922546183524e-02   -4.519366481327040e-01   +1.157138570279636e-01   -1.659598083094568e-01   +3.052605543088627e-01; -1.041915447097717e-01   -7.510783171930489e-02   +4.381866379104882e-01   -1.716778503184371e-01   +3.610540122800580e-01   +1.017769930506168e-01   +7.320489252290102e-02   +1.785621830253852e-01; +2.197337361159767e-01   +7.340514634094836e-02   +4.403055676697756e-01   -1.726513948112224e-02   +2.732627046461570e-01   -4.643673216440131e-01   -1.967522593832816e-01   +2.673400353025033e-01; +5.142281155907172e-01   +4.624013125130146e-01   -4.295308157370242e-01   -3.603219467077632e-01   -1.285906813082794e-01   +2.905495790095992e-01   -1.571454105123766e-01   -6.974249665325172e-02; +6.459847699705665e-02   -4.020139774026005e-01   -1.175006451946451e-01   +1.610145981890628e-01   +1.819260351548974e-01   -5.830027759880992e-02   -2.842249269482523e-01   -4.312256775264302e-02; -1.101882839009155e-01   +3.272220716971044e-03   +2.084643675406331e-01   -5.664696276511176e-01   -1.100081049824480e-01   +5.061052031185677e-01   -7.291251534593427e-03   -9.567006432762250e-02; +4.724410264081793e-01   +3.133139014900296e-01   +4.247968635464139e-01   -3.375755533023463e-01   +1.247206102943653e-01   -4.488695459817362e-01   -2.411749180347626e-01   +3.671314082015578e-01; +9.508114027671108e-02   +2.998607931331616e-01   +8.079242760837162e-01   +1.714605377663760e-01   +1.520509012656258e-01   -2.362321528439198e-01   -3.825717048422681e-01   +4.977784062878804e-01; -3.532331518378135e-01   -5.767035493564961e-01   -9.177493333533290e-02   -6.037430463416272e-01   -8.372988728174770e-02   -3.017974830608001e-01   +4.595412586772449e-01   +3.182467567936302e-01; -4.063330247043732e-01   +4.325018697573897e-01   -3.531155594339527e-01   -3.321921630514336e-01   -4.253542836959264e-01   +3.315799294976719e-01   +3.046331780768995e-01   -3.205826121710478e-02];
L1E_L2E_iAMPA_netcon = [-2.476490768242579e-01   -2.905191052160029e-02   +3.834551603825663e-01   -3.963955223213128e-01   +1.188208304561350e-01   -6.007481071306395e-01   -2.106717764077366e-01   -4.499200217494906e-01   +4.601281256686465e-01   -9.512157268212296e-02   -5.437217420380348e-01   -4.851454551036410e-01   -1.557300931308726e-02   -3.059415823937354e-01   -1.784959576445123e-01   +8.703275553327350e-02; -4.731383430140942e-02   -1.542893365743561e-01   +2.494482713570513e-01   +4.591203493359558e-02   -9.752262778721942e-02   -5.258515055803198e-01   +9.457472331613632e-02   -5.558229359653163e-02   -3.452418943130282e-02   +1.546872933284159e-01   -4.341574408954651e-01   -6.127781554062833e-01   -3.042562291648474e-01   -9.856052592629409e-02   -3.182362163782782e-01   +1.088736601353977e-01; +3.984171942537172e-01   -4.292220121357705e-01   -6.115462955690501e-02   -1.119816990285739e-01   +6.836688605583569e-02   -5.458129322336566e-01   -2.355164101265773e-01   -2.008200827621546e-01   -6.062759208532822e-01   +4.676085197800549e-02   -1.120691796226548e-01   -7.551402063682455e-02   -2.379264755121358e-01   -2.618265476742808e-01   -1.870686040667031e-01   +5.019917942000691e-01; +2.244639605134791e-01   +2.160757147325891e-01   -5.123918321398108e-01   -1.928124078652039e-01   -5.778455737034566e-01   -5.599611520290698e-02   +4.237547065066316e-01   -2.827068383951010e-01   +2.700246441664219e-02   -1.688007517497035e-01   +1.156055337321816e-01   -5.805792435757228e-01   -1.119898509563634e-01   -4.810501568174895e-01   +2.892282073429867e-01   +3.545362707971095e-01; +1.813095636753314e-01   +4.132953305369301e-01   +5.582724611675419e-01   -6.601481330956840e-02   -2.414211134955463e-01   -4.170498427406847e-01   +9.018962115274337e-04   -1.096084435629733e-01   +2.405986610464456e-01   +2.725052022275253e-02   -1.240706799142131e-01   +9.403320224309138e-02   -1.936386502943746e-02   -5.192333178445941e-01   -1.983857677133350e-01   +1.474619819744504e-01; -1.098859275521622e-01   +1.474164019056767e-01   +2.454403723919382e-01   +1.325833129232413e-01   +3.820716165658874e-01   -1.221518195662668e-01   -1.936065522102781e-01   +4.817377978285790e-01   -3.800982271410686e-01   -2.396970614046764e-01   +5.629986995566139e-01   -1.324292173234201e-01   -5.210748859723062e-01   +7.855683504242333e-02   +1.228628131568693e-01   +3.544056870718001e-03; -1.603803482855765e-01   +7.359433492484554e-02   -4.383904532221838e-01   -1.476480713361565e-01   +1.484015517976127e-01   +2.190827873545352e-02   +1.718414844535448e-01   +2.956271321437302e-01   -2.938930984555520e-01   +1.672575628763799e-01   +4.116602824721545e-01   -4.723875407673687e-01   -3.502950735836652e-01   +2.230794129614697e-01   -1.347520094525808e-01   +1.342841443013635e-01; -6.844777947679047e-02   +1.615149341912799e-01   +1.885505738579257e-01   -1.304753746688300e-01   -2.069776604025549e-01   -2.909439436355530e-01   +2.534523416881266e-01   -1.009194244583192e-03   +2.097727640890413e-01   +5.044487064153853e-02   -1.432295544204532e-01   -2.588523654942271e-01   -3.495324260137621e-01   +3.546869819816988e-01   +2.332111682989854e-01   -5.783123506692092e-01];
L2I_L2E_iAMPA_netcon = [+2.390585317173253e-01   +1.262880403380690e-01   -1.370745696668873e-01   -2.082001250551724e-01   -5.621696838159525e-02   -3.289382175001174e-01   -6.727607103309180e-02   +2.474220067437429e-01; -1.079425011217452e-01   +1.519776369081723e-02   -5.787596759079893e-01   +3.594556768661549e-01   -5.470023027365730e-01   +2.763970074174448e-01   -2.103632203593977e-01   +2.828416908986125e-01; -6.607524180170492e-01   -3.571959023844674e-01   +3.508781606872423e-01   +2.149997950180597e-01   -3.621470432305494e-02   -5.102378066746075e-01   -6.798750396723129e-01   +2.917305939358789e-01; +2.877569849473213e-01   +2.035744433406955e-01   +2.611039168757630e-01   -1.303339901397708e-01   +5.884371203307508e-01   +3.326735346911067e-01   -1.469189445318845e-01   -6.123944829588553e-01; -2.957475637933223e-01   +1.547508517851642e-01   -1.665257613542076e-01   -6.306655848219218e-01   -5.369550476559636e-02   -6.913114466513236e-01   +3.434290331308255e-01   +5.964354827307640e-01; +7.099870604669092e-02   -2.183783096480006e-01   -2.136438497150714e-01   -6.922091594988516e-01   -1.439466632897939e-01   -4.892389501631201e-01   +1.747206950166090e-01   -2.555969535975993e-01; +3.438745959785568e-01   -5.202003647876666e-01   +4.224826872041483e-01   +4.938791658669587e-01   -2.918292835193464e-01   +2.938132512623219e-01   -3.125783437546390e-01   +2.668471692167972e-01; +7.345622674533787e-01   +6.842612332903842e-01   -8.638607599084104e-02   +1.222754020997192e-01   +1.401224178782553e-01   +1.494669991485245e-01   -7.776159546430731e-01   +4.265465554939761e-01];
L2E_L2I_iGABA_netcon = [+8.746290209392717e-02   +2.831249560897223e-01   -2.629939754560470e-02   -2.700603734173918e-01   -2.157472995364232e-01   +1.152672922803750e-01   +1.386183082265404e-01   +9.588614864878567e-03; -2.461482951025707e-01   -3.026396273191872e-01   -2.694267037521798e-01   +3.727284753010500e-01   -2.114152205870626e-01   +1.853342868092868e-01   +3.396104163501783e-01   +5.984017403819113e-01; +4.392564186087529e-02   +3.488860897706768e-01   +7.504768566560684e-02   +5.372604787756380e-01   +2.729705405670817e-01   -1.875150266144626e-01   -1.207831888151673e-01   +5.732316426455301e-02; -2.381593887790771e-01   -5.171014128718234e-01   +2.535696245674509e-01   -3.803287153916733e-01   +1.686393609969037e-01   -5.559580048483829e-01   -4.766338390674293e-01   -1.283643489063407e-01; +2.370514243642344e-01   -4.143062288012998e-01   +1.161183093318468e-01   +2.478285264187377e-03   +4.711910953650182e-01   +1.934222402621439e-01   -3.542697356327373e-01   -6.279959698667749e-01; -1.334826286102024e-01   -2.215007655649566e-01   -2.130454003358115e-01   -3.028663274854968e-01   +6.325729894041858e-02   -1.366568212486611e-01   -6.653851989914509e-01   +2.761871696887914e-01; +3.943402771098208e-01   -2.037644521389819e-01   -3.162774155154338e-01   -5.987975766628433e-01   -1.843261092704906e-01   +5.000133399713093e-01   -1.689740336970449e-02   -1.015460993099396e-01; +4.380199490942681e-01   +4.646827101624070e-01   +3.588128721925307e-01   +6.514087160390115e-02   -1.466920690922431e-01   -3.219462570714042e-01   -4.405803475103898e-01   -4.829769124935545e-01];
L3E_L2E_iAMPA_netcon = [+5.097439443947486e-01   +1.556663096361121e-01   +1.480624781988398e-01   +1.656386784388055e-01   +3.828052049533492e-01   +1.168276367390314e-01   -3.060340407983856e-01   -2.461710981808475e-01   +4.218573955873542e-01   +4.443567915745977e-01   +1.007713654701347e-01   +2.013526786445912e-01; -1.430408215844516e-01   -5.230986891891772e-01   -4.661139089297645e-01   -5.451188096872341e-02   +4.278688634534321e-01   -2.025421236007165e-01   +3.868649859767367e-01   +2.910704121534323e-01   -5.552240675850306e-01   +2.256681076113161e-01   -2.743722901545890e-01   -2.049745819579255e-01; +4.769325590635085e-01   -9.388174624599888e-02   +4.023883557196419e-02   +1.137511523487525e-01   +2.765978283972250e-01   +3.928910669124529e-02   +1.554113881055222e-01   -9.975464013020865e-02   -6.580634640687129e-01   -9.559643048927904e-02   -6.559987360150712e-02   +8.193409344767001e-01; -5.362625762477399e-01   -8.243755537465666e-01   +6.625063137548307e-03   -5.148522835109846e-01   +3.487141486508343e-01   +1.094611880666136e-01   +5.292115265538996e-01   +1.550558866793167e-01   +2.248949921164683e-01   -2.983281312804882e-01   +2.295075305079571e-01   +1.054341983683736e-02; -5.445586480022760e-01   +3.355575748468327e-02   -2.163997379356311e-01   +1.429405232746338e-01   +4.946775922173460e-01   -2.149992903414745e-01   +4.512061297444542e-01   -1.409040499843499e-01   -3.231402419150398e-01   +3.572724067996484e-01   +3.589627060631950e-02   +9.965963976920073e-02; +1.041879553563372e-01   -4.301821376655684e-01   -2.961162790133428e-02   -1.716270147829464e-01   -1.985522427621139e-01   -5.117438011387368e-02   +3.668639954096192e-01   -2.184513285679764e-01   +7.071102195057779e-01   -1.163784836753867e-02   +5.638457387299688e-02   +2.490248045462133e-01; +1.692542860585049e-01   -6.016694030088079e-01   +2.104956136723233e-01   +2.193498675560083e-01   -4.463719465106367e-01   -2.593405220584372e-01   +2.416488336250824e-01   +1.877434428653142e-01   -2.408253938482366e-02   -2.679817685893879e-02   +7.390940759829209e-01   +2.101865397312962e-02; -6.375641464926599e-01   +2.888355172963839e-01   +4.418662010299689e-01   +3.109229080795841e-01   +3.950642964997820e-01   +1.069897895762065e-02   +6.151544187008027e-01   +8.195115860596809e-02   +1.123447705755697e-01   -1.073392437819547e-01   -4.918625244929375e-01   +4.203173583464473e-01];
L3I_L2I_iGABA_netcon = [-5.652981757411474e-02   +7.770913138302891e-01   +8.228252969687450e-02   +6.532735550232345e-01   -3.429446299900781e-01   +5.361799214795528e-02   +4.053666833389695e-01   -1.496873880027907e-03   -2.534799056126129e-01   +1.486834571515217e-01   -1.641507100555785e-01   +3.845600774877986e-01; +4.295134606346407e-01   -1.791806013326471e-01   -2.522913902963232e-01   +2.552650697507141e-01   +5.369118269192844e-01   +1.615005364616036e-02   +7.105889823983534e-01   +2.427169142640694e-02   +1.766765144093005e-01   +2.024746365514753e-02   -2.674934132459968e-02   +2.634838642956087e-01; +1.193661446724723e-01   +2.447498839053659e-01   -5.186051984728004e-01   -8.420719957154162e-01   +4.669529052299488e-01   +6.665143514591394e-01   +3.074536842753630e-01   -4.748286024768951e-01   -3.940398096076617e-01   -3.548092347210210e-01   +2.450884480478065e-01   +3.337441311316240e-01; +5.102288682150269e-01   -1.280974558108937e-02   +7.272499689489913e-01   +1.566279887995450e-01   -2.628860225420719e-01   +6.695945953238473e-02   +5.683020538677362e-01   -3.611312975051115e-01   +1.545837503695016e-01   +6.285989600965066e-01   +2.209800859989803e-01   +1.989869717459797e-01; -2.602564985894214e-02   -3.894009424570850e-01   +7.962285632200902e-02   -2.980066362050717e-01   -7.491853988089647e-01   +2.141882540788829e-02   -2.943065860274662e-01   -3.740202864476892e-01   -2.591875972714444e-02   +2.301406721111031e-01   -1.915606330622074e-02   +2.485650809892175e-01; +6.958986825122935e-01   -5.070726885242990e-02   +4.301956853707994e-01   +7.520870983885357e-01   -2.486434732039170e-01   -6.935258436930494e-01   -4.938515168092524e-01   +2.985810545488713e-01   +4.234137606219962e-01   -2.156067462561608e-01   +2.744901555362162e-01   +4.194488066657600e-01; +4.290550294360783e-01   +1.885643604314984e-01   +4.562449082110415e-01   +3.243813305939801e-01   +7.494924456881006e-01   -1.051991510541188e-01   -3.340566281273175e-01   -1.445481046296504e-01   -2.551524775745614e-01   +2.629229199770448e-01   +5.896805734531015e-01   +1.719758261360361e-01; -1.062731452816298e-01   +1.478877304623030e-01   -3.672789797666444e-01   -1.172788681341075e-03   +4.678678492450375e-01   +6.418959976195050e-01   -2.238977710025557e-01   -4.125760498242592e-01   +1.515693432677626e-01   -2.539476844036351e-01   -1.553428386440538e-02   +1.492387558719732e-01];
L2E_L3E_iAMPA_netcon = [+8.976120060790349e-02   +3.217588275942552e-01   -2.584884314456935e-01   +7.668539970898601e-02   -6.898954710911524e-02   +2.917883193793792e-01   +1.375451674318416e-02   +2.448411118568070e-01; +2.786042008240046e-01   +1.317576833725996e-02   -1.045404344728248e-01   -2.038823656256826e-01   +3.148914697628409e-01   -9.945142861208853e-02   -1.534605741687219e-01   +4.474766032987690e-01; -2.283806449150560e-01   -3.535505979955972e-01   -2.398819510192546e-01   -1.106203764514953e-01   +5.315890503162771e-01   +2.880548347116381e-01   +4.094341804278654e-01   -7.041411768182397e-03; -5.077657433600999e-01   +1.206030601455777e-01   -1.400295999414007e-01   -1.900245140575679e-01   +1.220049499532280e-01   -5.318119746302963e-01   +3.848875491252049e-01   -3.078075460202694e-01; +5.684286704094765e-01   +8.097813075777235e-02   -2.321954411577203e-01   +3.611252132569639e-01   -4.675568393473469e-01   +6.785926371311940e-02   -2.067119357088826e-02   +5.205449902433415e-02; +3.053969075511542e-01   +1.178360947962301e-01   -1.183920353684822e-01   +3.868673502222143e-01   +4.606249724686160e-02   -3.656745237153743e-01   -3.224766358757068e-01   -2.806829874354773e-01; +6.010616814338008e-01   -7.846257606940187e-02   +6.320102149396369e-01   +1.627839388560038e-01   -2.695049290645971e-01   -2.142301228134227e-01   -1.755081718518649e-01   -1.231985651262614e-01; +2.761964797007997e-01   +4.153654140490619e-01   +1.606165535923915e-01   -4.597728231652631e-01   -1.571474946099455e-01   -2.894964873224503e-03   +1.123768466081691e-01   -1.547138490528014e-01; -3.248957385433289e-01   +1.007550030385503e-01   -3.298084137429268e-01   +5.988332862970909e-01   +3.727349563826998e-01   +4.086518871253430e-02   +3.461751958976178e-01   -4.811638726384044e-01; -1.667574563586713e-02   +1.834367115624388e-01   +1.005237469327119e-01   +5.405185054553240e-01   +6.131447544007158e-01   +2.386245365702493e-01   -3.176755306169731e-01   -6.633256843072136e-01; -1.290717120941842e-01   +7.215174539746838e-02   +3.898795687215441e-01   -1.339125216947886e-01   -4.902949380311638e-01   +5.305993185826960e-01   +1.385071735868965e-01   -1.501675984468804e-01; -5.524339092788874e-01   +3.925050841767951e-01   -5.349216061634852e-02   -2.113635473291521e-01   +5.562607534488351e-01   +4.727619296253445e-02   +2.650906107536309e-01   +2.760945789716374e-01];
L2I_L3I_iGABA_netcon = [-4.137794792106779e-01   +2.359203370883964e-01   +2.375178691499992e-01   +1.759343504979046e-01   -3.264066584954871e-01   +2.894511920663688e-02   -6.691391194155123e-02   -2.139552504127313e-01; -1.300223756250321e-01   +4.728052533434886e-01   +4.636310991879758e-01   -2.028271892419667e-01   -2.460160411269159e-01   +3.246266208046248e-01   +2.903592416218549e-01   +1.052374047031864e-01; -6.135550879607121e-01   +2.501141972400254e-01   -5.291685665063172e-01   +5.596378521543012e-02   -1.256880936258052e-01   +1.720665977771086e-01   +3.898296322456050e-01   +3.377709097611682e-02; +2.479516441103550e-01   +2.601303720087160e-01   -7.381864869572276e-02   -2.206535028310090e-01   -5.637261795335704e-01   -3.262647603085254e-02   +1.615749824849842e-01   +1.595715557149667e-01; -9.775012609608290e-02   -2.653311673206075e-01   +3.981009246961000e-01   -1.100253565770785e-01   +4.178226290039098e-01   +5.559863209758287e-01   +4.841733569532663e-01   +3.112541240574924e-01; -3.550196103008530e-01   +1.866468518979544e-02   +5.254992060543792e-03   -8.390572518634536e-02   -1.743256253730388e-02   +5.159299170086167e-02   -2.886949369453942e-01   -1.339781950040671e-01; +1.452792487603883e-01   +2.432387820402035e-01   +2.422285448696072e-01   +3.270585193963735e-01   +2.679595086677546e-01   +2.692736430113766e-01   -1.616024329381263e-01   -5.560948727274921e-01; +1.496742457690446e-01   -1.562769246802667e-01   +2.798410887996424e-01   -1.390578084793455e-01   -2.012931526492826e-01   +8.087467583223032e-02   -3.112922032142645e-01   +2.996198135586727e-01; -2.362931512683017e-01   -1.243778292181344e-01   -3.789372331438101e-02   -1.666445147840764e-01   -7.760607666677326e-02   -3.971348357716143e-01   +5.138272510781924e-01   +5.952592786224294e-01; -2.999070508597297e-02   +7.075024175577613e-02   -1.121992333414077e-01   +3.269223164778226e-01   -1.116832421765963e-01   +2.179187435471135e-01   -2.678523547609192e-01   -1.424098354532315e-01; +5.419880757339822e-01   +4.184770502280249e-01   +4.533982022673557e-01   +2.152393874478463e-01   -4.974413909773162e-02   -1.572833588389590e-01   +2.048571226238058e-01   -2.648691673561350e-01; -2.991744743679562e-01   -3.169387529517267e-01   +5.549357104788037e-01   -2.033679175763197e-01   +1.356471427966009e-01   -2.889836226016173e-01   +9.364368954544759e-02   -4.247546960202253e-01];
L3I_L3E_iAMPA_netcon = [+1.861975208592546e-01   -1.474782131794646e-01   +1.489005161514128e-01   +4.011663983001584e-01   -3.170286893446880e-01   -2.067526574859340e-01   -9.031255060580734e-02   +7.394594893554400e-02   -1.927883567001950e-01   +1.948205252377710e-01   -3.165239663116133e-01   +9.078511458424678e-04; -2.091403906566567e-01   +4.073710331036981e-01   -2.719228801928829e-01   -1.620012347297262e-01   -3.784041580756856e-01   +8.772260113970344e-02   +2.647774107352561e-01   +8.819717553382803e-03   -3.646017829129752e-02   -1.799950633451301e-01   +5.228791612201526e-02   +6.189701333144747e-01; -2.204925099197518e-01   +1.720297771912732e-01   +7.432092621273774e-02   -1.716041359790645e-01   +1.183147339626712e-01   +4.193637116052891e-01   +3.575948717017945e-01   +5.185035935251647e-01   -3.072771321872402e-01   -1.326394652658865e-02   +1.775428777226528e-01   -2.568866843117760e-01; +9.819943188462374e-02   +2.234276227573851e-02   +1.443652674518121e-01   +3.653071011525043e-01   -1.783558603196767e-01   +4.499684612970726e-01   +2.615560960678637e-03   -2.105109871494492e-01   +1.768759376116866e-02   +3.394703471640365e-01   +2.617849983646973e-01   -4.014415724400563e-01; +1.947890458046765e-01   +6.309301647141967e-01   +2.912140711164964e-01   +1.216330916116946e-01   -2.905666077595252e-01   -4.573665255880923e-01   +2.621876150300755e-02   -3.601327606472380e-01   +5.143971651923600e-01   -8.640121907659136e-03   +1.549745143113823e-01   -1.979231980504859e-01; +2.328074848111582e-01   -2.146679466557197e-01   +9.919824681780764e-03   -3.240858641696868e-03   +3.341356035111299e-02   -1.567877897476896e-01   -1.047691469734535e-01   -3.129221919360113e-01   +4.421417894035988e-01   +2.184032997495502e-01   -3.314838174237889e-03   +3.192413591653143e-01; +5.394343743308988e-01   +3.112685529662072e-01   -4.459090981848020e-01   -4.328736131967365e-01   -8.918764639679377e-02   +1.274922279100366e-01   -4.708142489136687e-01   +6.688779654538321e-02   +2.478792304532097e-02   -6.871709424112725e-02   -3.930879667413521e-01   -3.111975993706622e-01; +1.873775111780530e-01   -1.457172365889018e-01   -1.913768658684866e-01   +2.167638998521979e-01   +7.066977382522120e-02   -1.996860274549964e-01   +5.080719500124719e-01   +3.565565531355676e-01   -5.368399920110678e-04   +1.045814448369485e-01   -1.760158397857312e-01   -2.349722631759501e-01; -1.444604163665666e-01   +2.239170189564156e-01   +2.505413675890390e-02   -1.830920639582939e-01   +2.001612344262445e-01   +9.456769309128217e-02   -7.953634786341681e-01   +5.938247294709124e-01   +6.714104561308352e-01   -1.970722320575912e-01   +5.538701198810562e-01   +4.032647093086804e-01; -1.555510531257772e-01   +3.569929213265037e-01   +5.428669535213503e-01   +2.285450693638872e-01   -1.490170554591427e-01   +4.761979259997452e-02   -1.106593223732214e-01   -2.977415607512962e-02   -4.344201807400451e-02   -6.005133748173811e-01   -5.167331809713296e-02   +1.847304927145056e-01; -2.358194147885974e-01   -2.023333284965079e-01   -2.723412255275137e-01   +3.771913822625265e-01   -3.956793871575039e-01   -4.568108311678711e-01   +1.360490578835511e-01   +1.660208839658416e-01   +4.205994827244507e-02   -2.278870782461073e-01   +3.445858504831494e-01   -6.151849286238160e-01; -4.840664495872283e-01   +3.129653270099251e-01   +8.414221301366581e-02   -3.344760156131709e-01   -2.796814615450882e-01   +5.830130054025861e-02   +1.012655560297127e-02   -4.641546536199653e-02   +3.644704144946542e-01   -4.053294874203972e-02   -4.111844546732549e-02   +2.208461217737043e-01];
L3E_L3I_iGABA_netcon = [-1.781594827113068e-01   -1.786666120238612e-02   -1.561708114736021e-01   -6.413289112294890e-02   +2.103185324431506e-02   +9.644010190955365e-02   -4.883008375838464e-02   -1.912788344213598e-01   -9.005224822567542e-01   +2.221030683145662e-01   -1.308685608965912e-01   +2.162564661983789e-01; +9.048759986779240e-02   -3.622136453161328e-01   -4.830067913402068e-02   +2.257812335234537e-01   +2.473457232026637e-01   -1.037116602642225e-01   -5.842346971036444e-01   -5.217336470449593e-01   -5.260807027943657e-01   +1.623578834078418e-01   +1.292037256794313e-01   +2.272766246834971e-01; -6.382549060323530e-01   +6.125638862171887e-01   -8.327789083836622e-02   -6.404265501362967e-02   -6.309999489029447e-02   +1.868337670296191e-01   +4.924854164887587e-02   +1.693730812464564e-02   +3.435206327414391e-01   -1.062959189610662e-01   -1.143084752022847e-01   +5.729943878194198e-01; -8.601386607477890e-02   +3.136921156858838e-01   +5.343424429223012e-01   -3.424646989333073e-01   +1.656056785338469e-01   -3.291529785380611e-01   +4.367353358521209e-02   +2.195129463099186e-01   -6.039931718172513e-01   +2.283282583336370e-01   -5.449316973439414e-01   -1.895810940392688e-02; +2.147402764737395e-01   +3.904644432802954e-02   +8.211900699349484e-02   +2.124754900449683e-01   -4.396023563936738e-01   -2.796590583198132e-02   +1.166630847977940e-01   -5.349840462562760e-02   +2.671394138485907e-01   -6.113049706243261e-02   -4.043255933447083e-01   -2.345740026352982e-01; +2.069379030489114e-01   +2.678468396329274e-01   +1.534371304369678e-01   +1.598149338989737e-01   +1.678272212274923e-01   +1.525151114710863e-01   +8.410987826873483e-02   -7.942786637825536e-03   -3.886159871456483e-01   +3.670927233352458e-01   -7.767828430195944e-02   -6.895648089094922e-01; -3.467057139576839e-01   +9.720723421462610e-02   -1.050658485937003e-01   +4.939923989394752e-01   -7.762767371215212e-02   +1.735094165541007e-01   +8.368266092113608e-04   +2.205747598533102e-01   -2.562430641119267e-02   -1.080646558241416e-03   -3.608105581458912e-01   +1.609921020709639e-01; +3.580533922802933e-01   +5.338335251315864e-03   +4.363007127765735e-01   +4.014688979745076e-01   -4.937153444772284e-01   +2.404275415216046e-01   -1.013270412022769e-01   -2.452178904881663e-01   +2.428649340899118e-01   -4.776543663674009e-01   +2.425886847319669e-02   -4.039970664795809e-01; +1.993143443806326e-01   +2.570963160475971e-01   +3.065048427903241e-01   -1.097976103922930e-01   -1.171474245984109e-01   +4.755700467493084e-01   +2.264110231529274e-01   +2.436942039439766e-02   -2.425182282349932e-01   +1.352137591054484e-01   -4.056866628642466e-02   -3.345603815567954e-02; -1.168337113126282e-02   -5.147533509479019e-01   +1.905460430332498e-02   -5.885604497359982e-01   -1.324025499438257e-01   +4.506972807539749e-01   -1.164588734288030e-01   +2.029637977702271e-01   +2.592640501038405e-01   -1.229382024760098e-01   -4.003047599462617e-01   +1.846064047389091e-01; +3.872736655786016e-01   -4.272150072609413e-01   +9.619332054458779e-02   +4.708059537237038e-01   -2.788049320675178e-01   -4.630743445633611e-01   -2.013477516211248e-01   +3.895772198648548e-01   +1.747734017332974e-01   +4.106605681713043e-01   -3.605000210085198e-01   -1.864639534325312e-01; -3.488898169032207e-01   -7.552456552443593e-01   -4.770412880913799e-01   -3.406670008040655e-01   -9.563292841761827e-02   -6.526343514240428e-02   -3.101706129667852e-01   -1.750492273831116e-01   -1.852180124807007e-02   +1.605329640845505e-01   +4.600937878346059e-01   -5.082911958217207e-01];
L2E_Input1_iAMPA_netcon = [+5.591232473034174e-01   -6.201515700818315e-01   +5.858008078546358e-02   -1.226803892087684e-01   +1.766716574704274e-01   -2.395622539658809e-01   -1.440315396863674e-01   -6.981643579017057e-01];
L2I_Input2_iAMPA_netcon = [+4.036084418153007e-01   +1.145165075161406e-01   -1.294085358906451e-02   -1.385360678868697e-01   +7.953526876841703e-01   -7.627423218728663e-02   +5.959463108571278e-01   +3.463456828678972e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 100*(sin(2*t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 100*(sin(2*t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
