function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-4.276239957877606e-01   -4.910937745197008e-01   +6.598419727038880e-02   +1.158786429988311e-01   +2.694315754941811e-01   +5.742274463184672e-02   -5.779288492451932e-01   -1.778616667588837e-01   +4.853755098326130e-01   +7.589827923267364e-01   +9.333753726755591e-02   -1.685708963545515e-01   +5.652460224522966e-01   -2.530863390458532e-02   -4.000331900542114e-01   -9.688328643375703e-02; +1.494365434070356e-01   +4.672223654252927e-01   +9.817380741809917e-02   +2.055897835597583e-01   +4.627457974977880e-02   +6.755582645545752e-01   -3.965309438262224e-01   -2.215987685971265e-01   +5.666019193095126e-02   +1.761644997225105e-03   +1.671371826709651e-01   +4.429667932541578e-01   +2.123723400356711e-01   -6.678885809750987e-02   -1.457914545769137e-02   +1.635570485850787e-03; +2.298383244821838e-01   +1.954625206668551e-01   -1.764612408460523e-01   +2.718812520271534e-01   -4.162905632186875e-01   +4.541073721918573e-01   +6.450640662747114e-01   -4.055817999770771e-01   +3.866683195968060e-01   +1.843445494044856e-01   +3.185413223080050e-01   +1.720003629856662e-05   -1.399713556542345e-01   -5.108673375660483e-01   +2.896727844256480e-01   +5.989815247200480e-01; +4.420665843802690e-01   -2.504633773126717e-01   -1.514579216360574e-01   +4.381281826967219e-01   +1.306570913838183e-01   +6.526260893842887e-01   +5.963050562512130e-01   +3.582726761591384e-01   +1.124962124396244e-01   -2.481606098148082e-01   +4.428302881306679e-01   -3.262645885064412e-02   -2.711971087146555e-01   +3.140304236317972e-01   +2.024295797241032e-01   +9.435711197152726e-01; +4.441798474159759e-01   +1.506558874026850e-01   +7.054715414216872e-01   +4.118285191902024e-01   -4.090495583326149e-02   +1.630495735303649e-01   +1.788100539451244e-01   +1.341232431398459e-01   +1.085223645322095e-01   +4.414564991532593e-01   +5.249647126228397e-01   +1.326594193296033e-01   +4.223146112152500e-01   -1.394208803699149e-01   +1.757203441216955e-01   +1.631671648838836e-01; -1.854337856391130e-01   +9.381432557665249e-01   +5.820589480076971e-01   -3.239133521310411e-02   +3.716384233168118e-01   +3.271854489667067e-01   +3.942191685919227e-01   +2.912395082241803e-01   +9.191393307072131e-02   -5.191216813620567e-02   +1.519641133399493e-01   -2.061811244765332e-01   +2.168943331600424e-01   +2.842020472385366e-01   -2.193364311918252e-01   -2.012288204639875e-01; +1.731668285086933e-01   +5.035762947105222e-01   +8.188283007670152e-01   +3.785066080539032e-01   -3.819365346737691e-01   +1.428384145147923e-01   +2.666706700581429e-01   +5.181597751105928e-02   -7.146960930159489e-01   +2.675983133423982e-01   +1.884400480572458e-01   -1.125146319762388e-01   +4.504162594518157e-01   -2.988111108754126e-02   +6.134835942498463e-01   +5.015255270739164e-01; +1.347831219967160e-01   +4.545120030421884e-01   -3.111146115121864e-01   +2.864143698088129e-01   +3.989233899953322e-01   -9.894798652320243e-02   +7.210752753859943e-01   +3.206536943329983e-01   +2.956298781083564e-01   -2.023112340921179e-01   +2.496144004450133e-01   +2.210999828419232e-03   -3.103348591979084e-03   -3.553601922258931e-02   -3.176222174791229e-01   +2.601593067452424e-01; +3.352514007517444e-02   +6.589883722526418e-01   -2.201687957000902e-01   -4.409509889473178e-02   +3.372465968037094e-01   +3.872725529009831e-01   -1.606014370235809e-01   -3.206672299116911e-01   +3.806786971923006e-01   -6.761238435605831e-02   +3.263400598602177e-01   +8.413236127409902e-02   +3.414370552839789e-02   +4.589409644051237e-01   -2.953929180773958e-01   +7.311504737469268e-02; +4.537474298493042e-01   +2.194137543649982e-01   +3.812167341802920e-02   +4.229621315830588e-01   -1.961450767332139e-01   -1.206560059849860e-01   +2.529030629544978e-01   -2.413283148521443e-01   -1.617005801001321e-02   -1.957374644711700e-01   +8.558725683434193e-01   +2.921378909566011e-01   +3.227474494731885e-01   +2.718858551423125e-01   +2.176483922615859e-01   -1.808387238767344e-02; +3.537517080273840e-01   +9.232636658563328e-01   -7.808199763349853e-02   -2.240418698550326e-01   +3.681435933695584e-01   -3.963509505935975e-03   -2.145926560205893e-01   -2.528441871420520e-01   +3.115191955566738e-01   +5.508220955156744e-01   +1.236445163096462e-01   +2.037302222630331e-01   -6.293018934783247e-01   -1.528020780287581e-01   +1.930649246042216e-01   +1.543354739491420e-01; +3.613471105484847e-01   +2.815977527543436e-01   +1.009744801678574e-01   -3.168904971775258e-01   -1.236022999282931e-01   +2.781341677569662e-01   +1.549348776353555e-01   +1.106038498837465e-01   +1.967600793309329e-01   -5.613926223191273e-01   +2.752125442745472e-01   +5.120175476783430e-01   +7.342610199549228e-01   +2.639303844287214e-02   -5.429763454637525e-01   -1.049565950052971e-01; -3.963435034679928e-01   +3.201237758331440e-01   +1.217104237965249e-02   +2.604730342633324e-01   +6.481995264941440e-01   +8.554126275731236e-01   -3.200524999793060e-01   +4.223959567858969e-03   +2.685577840832423e-01   +4.798407591936970e-01   +2.178454832938254e-01   +3.462017640732864e-01   -1.885519176319435e-01   +2.942966511583297e-01   +1.157346461559313e-01   +1.849574616526079e-01; -5.858194055148290e-01   +4.748821601637550e-01   +3.179830810428124e-01   -6.881324438025611e-01   +2.580544379194219e-01   +2.370815930486138e-01   -1.992558440682485e-01   -9.140681777308060e-02   -3.576144602951143e-01   +2.486089282603106e-01   +7.005070776466841e-01   -5.326856999424499e-02   -9.173976329939978e-02   +4.278334689414121e-01   -2.265865320237944e-01   -3.434355024664661e-01; +4.099651659971936e-01   -2.087328614524132e-01   +3.930906271691292e-01   +2.818136325541302e-01   -6.393858309633806e-02   -2.553249780936899e-02   -1.133687639246618e-01   +2.271247834549954e-01   +4.467748330400302e-03   -1.825662535809587e-01   +1.426864589553348e-01   +6.977493736273277e-02   +7.170211571954006e-01   +1.011955367986161e-01   +8.966066257077998e-02   -7.174341419015633e-02; -1.000000000000000e+00   +4.451029515498286e-01   -4.977231415516065e-01   +6.346134160548611e-01   +6.746356774599561e-01   +3.729679831027456e-01   -2.143183539690884e-01   +5.814187253656472e-01   -3.387218896297576e-01   +3.858976849946162e-01   +3.311159399939717e-01   +3.219756467233846e-02   -4.579629926725359e-02   +2.158134161565840e-01   -6.397802473652058e-03   +3.714277227453296e-01];
L1E_L1I_iGABA_netcon = [-4.055344245949450e-02   +8.909216046714343e-01   -5.801984183961729e-01   -4.008095876728804e-01   +4.654502976920681e-01   +2.106258632255172e-01   +7.087277577061474e-01   +1.690511715589592e-01   -6.691077717283427e-01   -4.908385437467661e-02   -3.568139252118011e-01   +7.116375693002914e-01   +9.481578140315691e-01   -4.710234681022896e-01   +7.152575971821943e-01   +7.231161957861583e-01; -2.027255784005065e-01   +2.345784986010697e-02   +9.283922169732183e-01   -4.864116979924535e-01   +4.540491887924366e-01   -4.374073276957673e-01   +6.056329339401419e-01   +6.963148777627481e-01   +2.968000802064072e-01   +5.321302522279584e-01   +2.075133586351119e-01   -2.296712248984450e-01   +3.595901882546370e-01   +5.979304689138154e-01   +6.294175680293060e-01   -1.343879964299635e-01; +1.250319348147933e-01   +5.165016750929060e-01   -4.421599604035398e-01   +5.047916030904843e-01   -3.803168464118575e-01   -3.031234933697984e-01   -1.321374362718183e-01   -3.046134145131821e-01   +2.678698777638193e-01   +2.829318163638439e-01   -3.234721646307639e-01   +6.102063480189236e-01   -2.903829530885704e-02   -5.362056687327672e-01   +7.083017144214057e-01   -8.504350317983839e-02; +4.238029941583183e-01   -2.554865772264800e-01   -5.162390022922942e-01   +1.542146751763651e-02   +7.116068377117224e-02   +7.531796006732219e-02   +8.337931942613074e-02   -2.001037562540637e-01   +1.891167319740105e-01   +3.499533167689050e-01   +3.744625191370142e-01   +4.381290618645027e-02   +1.519147313563918e-02   +3.377931354967827e-01   +4.532608231768375e-01   -2.436670840948966e-01; -5.305965190153283e-02   +4.167774026633744e-01   +4.985656805252049e-01   -2.333152863559488e-02   +6.125620823964752e-01   -3.566182310905633e-01   -2.113363392896127e-01   -5.130772650643466e-01   +2.377093970551674e-01   +5.539816002997571e-01   -2.392057140470298e-01   +7.421450731258691e-01   +7.914393411929755e-01   +3.226091722536660e-01   -4.079511731740397e-01   +1.621491653546695e-01; +3.009263049996234e-01   +6.766897681929382e-02   +1.553511953384021e-01   -5.645441595703924e-01   -2.149529554442337e-02   +4.278332964322611e-01   -2.613046737269459e-01   -3.979767214174179e-01   +5.353319125730414e-02   -1.763319757720958e-01   -2.198575831780868e-01   +5.760363512262704e-01   +2.178632303358474e-01   -1.625242981723867e-01   +3.266390911955406e-01   -2.162621158587985e-01; -9.067772144706731e-01   -4.512298753180667e-01   -2.642528817101437e-01   -6.356564847058779e-01   +5.585196873467990e-01   -8.817605499943632e-02   -2.406458566552628e-01   -3.535618850831482e-01   +6.982211346316300e-01   +4.825845423562082e-01   +6.185818752905184e-01   +1.442053198257892e-01   -3.181061590318543e-01   +5.998016138041937e-01   +7.349150469717896e-01   +2.302888131867332e-01; +5.127445700142119e-01   +2.432706320683464e-01   -2.877910539440602e-01   +1.058666379694620e-01   +1.051648940660764e-01   -3.020570016799137e-01   +9.115695823025864e-01   +1.055567864408245e-02   +7.036522064375271e-01   +1.424463694085149e-01   -2.994806062357951e-02   -2.186692051407845e-01   +9.795231045916458e-01   +5.334080670879889e-01   +3.044004587286661e-01   +8.817446871319433e-01; +1.414229870255408e-01   +8.530024909341154e-01   +2.040761965999202e-01   -2.533811761731868e-01   -5.876091238901494e-01   +6.880282640290039e-01   -1.476344768376874e-01   +2.211142231287884e-01   +2.054260735067661e-01   -6.226503635616943e-01   +2.586738790561652e-02   -3.129479646968806e-01   -3.172141145607960e-01   +4.307579372908911e-02   +8.069076345454879e-01   +1.225167265296442e-01; +4.884558866899962e-01   +8.135762065605532e-01   +2.292691179089704e-02   -4.026130114571457e-01   -8.190625894293113e-02   +2.294248140846277e-01   -2.013574278456960e-01   +5.895810420808740e-02   +5.998949665585024e-01   -5.275729220924804e-02   -5.769871464807945e-01   +1.608715488482792e-01   +5.932717662304355e-01   +1.703648456175098e-01   -1.435016668158114e-02   +2.728333140043731e-01; +2.729194608750631e-01   +3.466754324270510e-03   +2.531750769561855e-01   +5.652103825759541e-01   +2.278834691892987e-01   -1.575765118965463e-01   +2.326668932528537e-01   -2.397099475818016e-01   +7.127387744615549e-01   +4.398942933147615e-01   -5.272936869204196e-01   +6.225094669971327e-01   +5.858547246404613e-01   +2.438799276453037e-01   +2.996237858664833e-01   -6.318658753005614e-01; +2.551592460851732e-02   +1.026090874003652e-01   +6.747578078076985e-02   -5.386687588806662e-01   +2.525800198713768e-01   -2.887868811065085e-02   -3.193340231852951e-01   +1.663789782570998e-01   +2.323998017417875e-01   -6.059679477603427e-02   +1.596027317425634e-01   -9.135044702488379e-02   +5.054156250544577e-01   -1.360037834910511e-01   +4.743025849911229e-01   -1.979251210244470e-02; +5.885333277472518e-01   +1.516724281889276e-01   +1.214042884628661e-01   +2.357451260375295e-01   -7.230016470439636e-02   -1.889698111973806e-01   +2.202768982710071e-01   +1.529778142966823e-01   +3.908456993424960e-01   -1.219570780914018e-01   -2.080771618202575e-01   -4.569698082194119e-01   +4.159673140693800e-01   +2.513250871110155e-01   +2.206163474353712e-01   +2.063188312532270e-01; +5.731183017557452e-01   -1.228711811334925e-01   -2.438296337115662e-01   +3.106290030035365e-01   +1.750534958506235e-01   -1.226067197881151e-01   +2.833646222835163e-01   +2.270196130274189e-01   +6.833685623286891e-01   +2.887946035302159e-02   +1.306648023862137e-01   +3.390252916836747e-01   -3.250803098275836e-01   +1.497383654700849e-01   -3.369164447536963e-01   -5.439496894298444e-02; +8.380204135583072e-02   +4.495255582189464e-01   -1.969799799344109e-01   +1.425094839989575e-01   -2.467931956625207e-01   +1.712224088593521e-01   +1.537898099495867e-01   +1.395236828070762e-01   +5.598076305505902e-01   +1.516092122429456e-01   +7.879781462722329e-01   +1.463103509502288e-01   -2.319946881610853e-01   -8.662043899860079e-01   +9.933616951816144e-01   +2.598739144637231e-01; -4.296234150894529e-01   +5.254332074462154e-01   -1.611121578356644e-01   -2.132411121316300e-01   -1.540223987929950e-01   +4.027182524652677e-02   -1.036571172511135e-01   -1.289383488303401e-01   -1.195839265243337e-01   +1.633719611102646e-01   -5.260865205684339e-01   -8.400295540456015e-02   +4.419627569163417e-01   +2.251507123248444e-01   -1.331323285160503e-01   +3.283077322326019e-01];
L2I_L1I_iGABA_netcon = [-2.371272642688187e-01   -2.857774934553090e-01   +5.824289889075526e-02   +5.793368494896515e-01   -3.582021117957602e-01   +5.002942746974798e-01   -1.716423035238062e-01   -1.903488274884559e-01; -6.027554588184415e-02   +5.973159296494336e-01   -5.383075586354354e-02   -1.115593844601135e-01   +4.003030039771343e-01   +6.198830151271442e-01   +1.052347814251802e-02   -4.072784402949602e-01; +4.219941486127409e-01   -1.704331963851047e-01   -1.174984260520002e-01   +3.052275838812882e-01   -1.559332421421887e-01   -8.585002554559643e-02   +6.080369593323003e-02   +3.558598029939422e-01; +1.818453535239845e-01   -2.701637310285108e-02   +5.841107354692008e-01   +4.677064283493191e-01   +1.311918465962900e-01   +4.098630781762789e-01   +2.955454308916957e-01   -9.311961402241911e-02; +1.610741312253962e-01   -2.331159982861014e-01   +5.713860561962255e-01   +4.649203220779973e-01   +7.442728290940321e-01   +5.116665569014023e-01   +2.469497404678430e-01   +3.432733256610268e-01; -1.595078912275269e-01   +6.654356719458010e-02   +4.307802364131024e-01   +5.532065548285028e-01   -2.377088060818034e-01   +4.351157458946525e-01   +5.905813513692786e-01   +7.258164365636933e-01; +5.406341372759667e-02   +6.770514433199790e-02   +1.066506312877376e-01   -7.115596211925848e-02   +6.724949585147644e-02   +6.497116480010345e-01   +5.447319161670170e-01   -4.942016685742748e-03; -1.896943759218215e-01   +6.044103605428945e-01   +7.965768294720284e-02   +1.281847612032189e-01   +6.202485313265679e-01   -1.369357240904824e-01   +4.734300420190734e-01   +1.128313569235761e-01; -5.991683843555431e-02   +7.676752538257270e-01   -6.276961768514646e-01   +4.746337032427479e-01   +3.678566696715135e-01   +4.910866161889420e-01   +2.128658763441924e-01   -2.870181295851682e-01; +2.865765106685477e-02   -2.147535426157617e-01   +3.430461239987700e-01   +2.431898331499111e-02   +1.022445916223663e-01   +3.180308791013221e-01   -5.767979173560461e-01   +6.214752147613388e-02; -1.428506804279886e-01   +1.575767525343942e-01   +2.779900339782854e-01   +4.672221173673305e-01   +1.543824903896616e-01   -8.067008077411682e-02   +8.973691153942713e-02   +1.599816968073455e-01; +3.590627434345065e-01   +3.742747990899847e-01   +1.844888760919259e-01   -9.480233891009425e-02   +4.550411498204714e-02   +4.537766810900882e-02   +6.304967797173487e-01   +3.642060752622175e-01; +4.782593114783067e-01   +2.554398947547740e-01   +1.969860121071310e-01   +2.026309386164389e-01   +3.711299737662364e-01   -5.029540093167776e-01   -3.704376922059235e-01   -3.545639433294069e-02; -3.199847786167038e-01   -3.637297619342273e-01   -1.003928846764045e-01   -4.696270034888970e-01   +2.843056831180982e-01   -2.279373514019200e-01   +5.787884837633780e-01   +4.655376208238752e-01; +5.415671272482206e-01   +3.279608127671193e-01   +3.578701202242008e-01   +2.895828774175065e-01   -4.452579524102994e-01   +6.860318432351079e-01   +7.770346243948153e-01   +1.557504505697005e-01; +8.666265764572888e-02   +4.522039403847886e-02   +4.341188295200510e-01   +4.738184482768330e-01   +4.001445471363700e-01   +3.701811312983736e-01   +4.086506044613462e-02   -9.998369461649772e-03];
L1I_L2I_iGABA_netcon = [+5.801146591697798e-01   -3.019018381300650e-01   +1.484361371924764e-01   +3.629752925247073e-01   +8.089452944995860e-02   +1.595796328223261e-01   -3.273838924157409e-01   -1.644558875438810e-01   -1.749166176799466e-01   +4.293523427119627e-01   -2.346774751073888e-02   -1.525813630619511e-01   -1.769393743215563e-01   -1.001466317439407e-01   -7.264077516319964e-02   +1.994580840189312e-01; +4.045198564582261e-01   -4.583746971963355e-01   -2.095220005124214e-01   +6.335607352570893e-04   -2.772298352299313e-01   +1.129891616553925e-01   +2.591771163073024e-01   +4.122458644450409e-01   +4.399190210554006e-02   +6.985407562696613e-01   +4.096787912151440e-01   -1.819105773270658e-01   +1.189147686056183e-01   -3.792897412428318e-01   +4.952498891918847e-01   +3.868394494102746e-01; +3.720955183401109e-01   +2.652711302377940e-02   +3.390127132966292e-01   -1.565921960632020e-01   +3.609577813365965e-02   -5.065960731755244e-01   +1.946046642859152e-01   +7.241999722242957e-02   -1.472422875208462e-01   +1.046978751452242e-01   -4.710469688551966e-01   +6.492320766753178e-02   +4.389495127242271e-01   +5.069722706516245e-01   +5.502045184512832e-01   +3.374730044127841e-03; +3.721975356780726e-01   +4.904994687742951e-01   +3.598842858028102e-01   -1.826701302815208e-01   +4.734055176639616e-01   +7.464301914343976e-01   +4.464878873696531e-01   -9.414125340491603e-02   +1.556418191043512e-01   +7.472859762842493e-01   +2.982995425006427e-01   +5.324921661983507e-01   +9.979680925710925e-02   +8.350933499060798e-01   +1.962070745520233e-01   +5.842905345025493e-01; -4.132718799251506e-01   -4.187362773565836e-02   +2.763033158741452e-01   +2.693089394855631e-01   +2.941673071556716e-01   +5.436172510588519e-01   +4.962876625816238e-01   +4.852812978006603e-01   +1.349158037676543e-01   +3.911695229181191e-01   +1.992454159310138e-02   +1.665849873876212e-01   -8.909908535555729e-01   +4.397226430620090e-01   +4.526659389381980e-01   +8.140330969533341e-01; -5.051096270043551e-02   +5.524977795947461e-01   -5.552292585101559e-01   +2.463343022185592e-01   -9.254147495848054e-02   -2.230164909194877e-01   +4.165630822959109e-01   +4.780535899186373e-01   +2.443769872383782e-01   +1.730183824091737e-01   +1.081970541686625e-01   -1.916301768881391e-01   +4.539969389744642e-02   +1.000000000000000e+00   +2.503660921402866e-01   +2.563076112843725e-01; +1.237817254112571e-01   +2.694960139489824e-01   -2.792897880924120e-01   +3.796108594338553e-01   +5.292271938607614e-01   -4.966450580110653e-01   +3.087211767971090e-01   -2.962799571671937e-01   -3.037659509193610e-01   -2.461334133825612e-01   +2.905822256920595e-01   +4.332497913130791e-01   +5.172982255315454e-02   +1.021275457146309e-01   +1.282039446829325e-01   +1.934436071626590e-01; +2.814146937742415e-01   +2.022638341998656e-01   +1.538614539557046e-01   -1.589503364675405e-01   +7.443230688132638e-02   +3.302091650666737e-01   -3.771777202830448e-01   -2.290788635936752e-01   +1.476083638259267e-02   +1.171928189593468e-01   +1.636235729948663e-01   +5.782317767738624e-01   -2.073080637068010e-01   +9.322724361035403e-02   +1.512753360703249e-01   +5.214476240282226e-01];
L2E_L1E_iAMPA_netcon = [+1.168521990156187e-01   -7.047118298992719e-01   +3.887710583747051e-02   +5.242524344178154e-01   +4.060540738523971e-01   +1.202413907174615e-01   +5.456953341467631e-01   -1.514186340131030e-01; -1.099220895925155e-01   +1.532924190723390e-01   -5.142148791499924e-01   +3.026834922955779e-01   +3.583518153018194e-01   +3.146623555021983e-01   +2.384343429640235e-01   +1.382120068136860e-01; +6.117488814875258e-01   -7.544183622071422e-02   +2.822498805841631e-01   +1.393136758557278e-01   -1.871637648562753e-01   +5.848458051160907e-02   +6.969360657014716e-02   +2.158629014399642e-01; +3.839381174557792e-01   -2.464990357076536e-02   -2.810045738198319e-01   +5.080981344301958e-01   +1.799816561591977e-02   -5.309158709520287e-02   -3.074553277689581e-01   +2.301773556012262e-02; +1.363129133774974e-01   -6.052850679925057e-02   +2.740509406928245e-01   -3.228794034438148e-01   +1.509968948809401e-01   -7.883675234896688e-02   +3.435828853313744e-02   +4.172771547046840e-01; +8.578025512881410e-01   -2.473674637125427e-01   +6.396636629630235e-02   +6.911226603920906e-01   +4.782734434489959e-01   +5.653045939237366e-01   +3.078359675350899e-01   +2.906525206079242e-01; -4.881357733861861e-01   +8.087044546425403e-01   -1.245283888564484e-01   -2.627402609925463e-01   -1.239415964963119e-01   +3.502687224509303e-01   +6.790208860188056e-01   -3.071777784850827e-01; +1.515366557449630e-01   +2.405783071153269e-01   +8.408105139112305e-01   -1.386752453950464e-01   +2.256980391268614e-01   +2.336856337979670e-01   +5.771172446437154e-01   -1.342654472442570e-01; +2.146170976851745e-01   +9.755583734955060e-03   +7.138427541687608e-01   +7.740620340155520e-01   -4.887363486496500e-01   +4.485307172211925e-01   +5.803777596498573e-01   -1.909836651181742e-01; -3.605925044133537e-01   +2.176655243549470e-01   +3.068668374895698e-02   +3.384628813488630e-01   -1.290016306159515e-01   -3.011994098811175e-01   -2.780297585827121e-01   -2.881629812043688e-01; -1.146690308837103e-02   +7.740747645872273e-01   +6.517178125621562e-01   +1.755462403932257e-01   +1.306970431169397e-01   +1.548804567092195e-01   -1.243741253506454e-01   +1.928421002154359e-01; +7.163850377697484e-02   -4.229489261170450e-01   +6.558853620837047e-01   -6.453034902151003e-03   -3.850159471820894e-01   -3.145781214224087e-02   +6.135498020307699e-02   -5.270342755912797e-01; -3.246946630048774e-01   +2.936740470752860e-01   +3.644693741706689e-02   +8.593807508731242e-02   +5.008453466905417e-01   -4.492793728347399e-01   -8.577550796980422e-03   -2.477475952229428e-01; +9.873396189853000e-02   +8.498982737098582e-01   -1.119691078672524e-01   -3.357463945147923e-03   +6.369895375836193e-01   +2.028364022536104e-01   -3.887222797529001e-01   +3.206256722107078e-01; +1.731353685132484e-01   +4.222945584397992e-01   +8.355640779687357e-02   +1.028678456780414e-01   -1.695826815241126e-02   -3.102391247394363e-02   -2.702591169970336e-01   -2.616840545181259e-01; -1.936187754249627e-01   -2.863379509501462e-02   -6.571438331125853e-01   +6.684794799859721e-02   +7.218013178557670e-02   +1.759166838788404e-01   +6.946753078839860e-01   -1.054315436594624e-01];
L1E_L2E_iAMPA_netcon = [+3.999654323428821e-01   +2.876692617650368e-01   -1.563735142064510e-01   -1.973914131738448e-01   +3.141991614551858e-01   +3.349052062916095e-01   +3.613001733527165e-01   -4.466349201856454e-02   -8.078048472966874e-02   -1.117802932611669e-01   +6.122878846598069e-01   -1.932279702653710e-01   -3.514541046056360e-02   -1.846292968653866e-01   +5.765604557006723e-02   +1.405065948280302e-01; +3.890850676437592e-01   -1.076199839737846e-01   +1.550193966597578e-01   -2.456878171756958e-01   +3.062780684055433e-01   +1.290153349851272e-01   +7.125107642878751e-01   +3.301184598291680e-01   +4.438629743372435e-02   +2.954838400200115e-02   +3.920356094228765e-01   +1.939306289064280e-02   +7.174924197427769e-01   +5.276363882884143e-01   -1.180073732833547e-01   -5.967207008680027e-01; +9.761175646172233e-01   -7.535006431781466e-02   +2.035658576049124e-01   +3.990908690071512e-01   +3.447219115519631e-01   -4.091108518006188e-01   -2.188323543764765e-01   +9.069242458659893e-02   +2.109969709691860e-01   -2.060517434342691e-01   -3.780450763779006e-01   +2.206728021210737e-01   -3.076819766752266e-01   +6.436424865181545e-01   +1.379587025518988e-01   +9.673445956625293e-02; +5.582590845985108e-02   -1.914817109504776e-01   -1.902542440021228e-01   +3.297225850584595e-01   -8.897968930784853e-02   +7.016214547212596e-01   +6.681738041548676e-01   -3.412457886707193e-01   +6.027717940225931e-02   +2.698218668448803e-01   +5.419399675856129e-01   -2.246147399192454e-01   -1.167405101547815e-01   +8.072578191907096e-01   +4.337610762877770e-01   +8.186780126977425e-02; -2.241032726301064e-01   -4.171984518215718e-01   -1.145655154771968e-02   +2.465993483414647e-01   -1.042172735448267e-01   +1.965145037357333e-02   +3.663402274058241e-01   +4.320016495184924e-01   +5.797844662344088e-01   -2.905603222660165e-01   +8.928205420527258e-02   -4.127062668231479e-01   -4.654099852905326e-01   -1.572863360231737e-01   +6.131353739932480e-02   -4.339280587196243e-01; -1.270064134645862e-01   +5.989670581819716e-01   +6.166457233329040e-02   +6.024782336512486e-01   -1.325468436200255e-01   -1.258774464060151e-01   +7.680520725636130e-01   -8.830821480125239e-02   +2.908824690868432e-01   +2.702115757043524e-01   +3.375450063879333e-01   +1.595641356084070e-01   -1.590899063659340e-01   +7.523036634406405e-02   -2.510899169086200e-01   +7.855337169246965e-01; +3.034354335329327e-01   +3.439683079071634e-01   +2.619975915295001e-01   -1.765761177920692e-01   +2.268584652739740e-01   +4.628010163247764e-02   +2.980515135356424e-01   -6.652499227843549e-01   -3.180020353805126e-01   +1.611448182260983e-01   +4.256510216967883e-03   -6.687621193338297e-02   -7.874083359341493e-01   +6.000241861644229e-01   +4.930992832274857e-01   +6.414975669881724e-01; +4.785678275504381e-01   -5.344998510776548e-02   +6.074311109983307e-02   +6.525166171664518e-01   +5.419009781405131e-01   +3.163075673627472e-01   -1.265261609994315e-01   +3.124012277556541e-01   +9.887766252791701e-02   +3.377600001484610e-01   +2.507097964341430e-02   +2.113117502624726e-02   -6.549937364234468e-01   -1.669458730110353e-02   +5.630726092227456e-01   +1.834710884519039e-01];
L2I_L2E_iAMPA_netcon = [+1.384101438618158e-02   +7.155870045069437e-01   +4.329929338233182e-01   -3.745417677520825e-01   +1.726004630928858e-01   +2.087909302247969e-01   -1.696956148412252e-01   +4.927870791857528e-01; +4.533793780400338e-01   +4.640294429541317e-01   +4.226801108518357e-01   +1.000000000000000e+00   +2.206156065620605e-01   +2.188796366996874e-01   +4.942071969302645e-02   +3.791216157823739e-01; +8.780172209486113e-02   +2.016722421879190e-01   -3.637575919768593e-01   +3.963181006774548e-01   -2.766080812266678e-01   +2.643813814456549e-01   +3.961260517538023e-01   -2.456572423688539e-02; +4.898385222532737e-01   +5.436703154395459e-01   -5.156071836961440e-01   +3.125120790414281e-01   +6.035634056488730e-01   +1.652439096829070e-01   +2.874036054785594e-01   +4.053604031383802e-01; +3.423019117044750e-01   +1.672927750791416e-01   -3.504065466141031e-01   +1.748056341645474e-01   +6.002190934831430e-01   -1.816711031173209e-01   +9.787273483812080e-02   -1.784651736150306e-01; +2.984584608595017e-01   +2.984502026359927e-01   -3.530863668233399e-01   +5.129221170875686e-01   -4.217462354087280e-01   +1.073244665688492e-01   +2.312712807083485e-01   -8.894637785701569e-02; +5.376365940004568e-01   -2.549607130208593e-01   +3.266696488609707e-01   +5.397309580371198e-01   +1.456707220145315e-01   -3.450805628192685e-01   +6.019421094285787e-01   -7.413222681191235e-01; +2.883499175276711e-01   +3.505753100917362e-03   -6.037394224549789e-01   +1.619429982416354e-01   -2.961337655182150e-01   -2.206052737716739e-01   +5.897939866988334e-02   +7.769937565340470e-01];
L2E_L2I_iGABA_netcon = [+3.849359936916196e-01   +5.095278146628576e-01   -1.352975582849081e-01   -1.619707431138009e-01   +8.722472091032744e-02   -4.640342269990433e-02   -2.422619659055055e-01   +5.971157535899545e-01; +2.784732196439068e-01   +3.325449389969082e-01   +1.531017163324087e-01   +9.251407217303425e-01   +4.308598871842914e-01   -3.638208112528625e-01   -4.757145524140397e-01   +2.146018469024467e-01; +2.859706592469490e-01   +6.709236790167331e-01   -7.853883526131642e-01   -3.753022812003580e-01   +5.656925210842793e-02   +7.908290980507277e-01   +8.894537133990195e-02   +7.624077899277207e-02; +2.952545329153378e-01   +2.208413224894022e-01   +1.668901767946681e-02   +7.091676449378463e-01   +5.439756729344127e-01   -7.101917437265920e-02   -2.691835238667031e-01   -1.200564474144057e-02; -2.600855126358154e-01   -6.710617896607848e-02   -2.352104991188652e-01   +5.494825395862294e-01   +3.689351815322008e-01   +1.014890769940605e-01   -1.148961576290561e-01   +2.735189424495830e-01; +1.000000000000000e+00   +5.431080575295120e-02   +3.672718512488469e-02   +2.488200970891321e-01   +2.140315027623128e-01   +1.533789499919933e-01   +3.875711183053089e-01   -4.747052846263604e-01; -1.412484177259324e-01   +2.016098925772841e-02   -1.374139683566216e-01   -1.767490269351535e-03   -2.427710768781586e-01   -3.883819410877416e-02   +2.682910457537543e-01   +7.695916504314185e-01; -1.167829825268255e-01   +2.194551468446608e-01   +4.764785766955496e-01   -2.819622120125054e-02   +5.732666180488534e-01   +3.409093370176131e-01   +1.660686972454200e-01   +4.974001402000989e-01];
L3E_L2E_iAMPA_netcon = [-2.029141000092688e-01   -3.593685744671580e-01   -2.545945259223397e-01   +2.468360172838650e-01   +9.771609921160785e-01   +5.217872067191824e-02   -5.738442286215080e-02   +9.534915093742834e-01   +3.270438424102087e-01   +3.169237823369862e-01   +3.396180409321603e-01   -5.446684452731693e-01; -2.117252773266672e-01   +2.939633360565623e-03   -2.665580264493949e-01   -8.431404503037017e-01   -4.453208344720250e-01   -1.599971520387149e-01   -1.075639779714740e-01   -2.580986864433120e-01   -2.065055943221762e-02   +5.725690208530532e-01   -8.045575033348416e-02   +5.866613490412849e-01; -7.476024976685759e-01   -1.355185103026844e-01   +6.335687860493561e-01   +9.390756124088223e-02   -5.330906170784835e-02   -5.673303037615400e-02   -2.790558459499104e-02   -6.695549945522519e-02   +5.422592125837509e-01   -4.252126524225909e-01   +8.309132986085773e-01   +3.842116586234840e-01; +5.197533775814730e-01   +3.607724840871317e-01   -2.066843184745828e-01   +4.991535362918650e-01   +7.453248205597158e-01   +3.004449365380676e-01   +2.263356500737182e-01   +6.720276239195917e-01   -1.695840704156456e-01   -2.431378752691916e-02   -3.231454105171770e-01   +2.524106475909944e-01; +1.065138357996460e-01   +4.845065672089582e-01   +6.363920008603260e-01   +9.273812588406739e-02   +4.081944209096501e-01   +5.638811414162964e-01   +6.303310445046084e-02   -8.298714570979715e-02   -4.774296525167158e-01   +5.068785629095089e-01   -1.182111201426984e-01   +1.356520520252162e-01; +1.138708820766397e-01   +2.869335582424543e-01   +4.259216216402635e-01   +1.602137870018788e-01   +7.732333219771690e-01   +5.046944237360614e-01   -3.734508933991554e-01   +5.968365886238969e-02   -5.383863231711458e-02   +1.836817761328920e-01   -9.698917258106546e-02   -1.971143330474347e-01; +4.982946493779634e-01   +4.822470446940278e-01   -1.516594027873142e-01   +7.272491960561289e-04   +2.496916252465888e-01   +4.886487176079973e-01   -2.772389935642432e-02   +2.681862190654406e-01   -2.423723685245753e-01   +2.313965345130241e-02   +8.055963600309657e-02   +4.307985012773951e-01; -1.666675416332131e-01   +7.723859003191497e-01   +1.578609844153294e-01   -6.646911039681154e-01   +3.542845991433282e-01   -1.929002112631519e-01   -1.256636132811511e-01   -6.659027030051493e-02   +3.314052409502901e-01   +1.693882284457073e-02   +6.489884272494337e-01   +1.198145367245797e-01];
L3I_L2I_iGABA_netcon = [+6.643609079930008e-01   +6.314950778142174e-01   -5.459409100623220e-02   +1.722782250467930e-01   -4.541345932912481e-01   +1.124263724817826e-01   +1.000000000000000e+00   +4.379716528146624e-01   +1.355704905711488e-01   +4.275961044459093e-01   -2.336238170310071e-02   +1.128614748589328e-01; -4.060799779624660e-02   +9.103873766203484e-02   +7.955562550610698e-02   -1.164349736011770e-01   -1.064716810224787e-01   +2.023661117612552e-01   +1.850509131558303e-01   +8.229504327246072e-02   +2.148447002865579e-01   -1.446997287417415e-02   +1.010701641834331e-01   +3.973668028480373e-01; -7.647602831642934e-03   -1.825777886987900e-01   -4.642128234598134e-02   -2.497716372026694e-02   -4.464617033003040e-01   +3.391998708201098e-01   +1.207763305981599e-01   +9.013886389705614e-03   +2.212251234564920e-02   -1.629888308382791e-01   -1.479458037646338e-02   +4.169824262299243e-01; +4.963561656188410e-01   +3.738171076017352e-02   +3.358937985346699e-01   +2.128033439766240e-02   +7.047207879762211e-02   +2.785304965531414e-01   +8.383586838535576e-02   -5.623245459973702e-02   +7.786411991539265e-02   +2.706488099545874e-01   +3.123778383994255e-01   +1.346550372151389e-01; +1.624560707401089e-01   +3.541294189237775e-01   +3.394809688597922e-02   -2.442228036216104e-01   +4.685773589894341e-02   +3.148695408104696e-01   +9.214234881771433e-02   +1.260545525965156e-01   +2.079194030083837e-01   +1.158874936999034e-01   +1.399289630779997e-01   +2.638220047884683e-01; -8.557829520042509e-02   +6.201595991552055e-02   +2.143648898831488e-01   -3.125467898683366e-02   -9.572707424356497e-02   -1.080247069663950e-01   +5.942076198206264e-04   -5.063223294087339e-02   +1.177263309607812e-01   -8.981457499664919e-02   -7.709617550679920e-01   -1.001379222709692e-01; -1.066466739941781e-02   +1.761416418650354e-01   +3.401538667607061e-01   +2.918500552921475e-01   +2.548091012634335e-01   +4.053357452920981e-01   +3.830553861470821e-01   -3.710852800019468e-02   -3.813189755632409e-01   +7.647146007621469e-02   +4.797006677381490e-01   -1.867870965950831e-01; +1.279952749979259e-01   +1.422045831516531e-01   +1.201900095189826e-01   +3.951601529146799e-02   -6.597781711625986e-02   +4.812152756774291e-01   +6.329156790856753e-02   +3.587470288077583e-01   +3.827899993160044e-01   +5.780923054164528e-02   +1.161629919323241e-01   +2.921014774838022e-01];
L2E_L3E_iAMPA_netcon = [+7.045081341394560e-01   +3.176067323332666e-01   +3.954131167690918e-01   -4.604554333069101e-01   -5.109955413398727e-02   -4.752661749745037e-02   +6.039661181513988e-01   +3.574131022170233e-01; +3.581044841968234e-01   +2.456262567163814e-02   -1.550468651589377e-01   -2.022422408465452e-03   +9.351679542258423e-01   -5.092971028124597e-01   -6.929813609567813e-01   -4.538104366899952e-01; +1.986374796405403e-01   +1.560016458313683e-01   +2.808629941375396e-01   +1.310005061964931e-01   -1.022622580904011e-01   +2.555688246697063e-01   -7.481170080791624e-02   -2.584639346585683e-01; +4.782130219949852e-01   +3.832387310376319e-01   +7.440265677342038e-01   +8.380013600201239e-01   +6.294199681898888e-02   +5.202439305272830e-01   -2.844764736535650e-01   -4.432230784352657e-01; -4.031838479522508e-03   -1.244060860687129e-01   +2.422283611368526e-01   +3.827978115833186e-01   -1.058758426448332e-01   -1.601958584855757e-01   -2.338643233554616e-01   -5.701965050478258e-01; +2.100745812699373e-01   +3.553521239222456e-01   +1.847356036494147e-01   +5.300769256943370e-01   -2.466845539903129e-01   -5.902689731018518e-02   +6.485187645112421e-02   +2.203537597871043e-01; +9.216173128466762e-02   +6.131249403751440e-01   +7.230417621891313e-01   -3.007030316305940e-01   +5.956922880340019e-01   +1.358040589528330e-01   +5.050426504511726e-01   +1.358175415042180e-01; +3.234053181198809e-01   +3.926444420926939e-01   -9.349453276833770e-02   -8.433867090583008e-02   -2.577975772309740e-01   +1.529985532191688e-01   +3.030327509970395e-01   +5.037177242470582e-01; -1.920116607161097e-01   +5.478460028697412e-01   +4.577351201170091e-01   +5.505152483655199e-01   -6.644831431234953e-02   -1.880687963182870e-01   +2.422495515957196e-01   -1.141868184738385e-01; -1.187637983306517e-01   +2.491363696429797e-01   +5.166008463317470e-01   +1.332555000581512e-01   +1.812938151517972e-01   -5.525677915537528e-01   +6.255697956087879e-01   +1.725690202578814e-01; +6.139820343208446e-01   +4.721187563968942e-01   +4.376917983666265e-02   +3.556505094786609e-01   +2.954502168429342e-01   +7.131004016035656e-01   -3.593458280362582e-01   +1.837260095874123e-01; -1.916771378239036e-01   +2.384287708330967e-01   +6.640808149008293e-01   -9.211317770978150e-02   -1.549585039018003e-01   -2.264753859722578e-01   +7.326361193960639e-02   +2.513814558587151e-01];
L2I_L3I_iGABA_netcon = [+8.857704368589722e-02   -4.233282410925233e-02   +3.390252255562971e-01   +2.088199993055165e-01   +3.017238729256932e-01   +6.675844344992307e-01   +5.940153432182504e-01   +1.801989010786651e-01; -2.807226184271961e-01   +3.660571354954103e-01   +5.615493256432013e-01   -2.158156043662756e-01   -2.277431139555674e-01   -8.821767322905066e-02   +4.928715428038074e-01   +4.869558624655592e-01; +2.970358041782061e-01   +8.084047689964542e-01   +4.372565194097460e-01   +1.292244028404248e-01   +3.379441716616063e-01   +3.615166360620518e-01   -1.011364205591029e-01   -2.688345344935452e-02; +6.399255573833071e-02   -1.430810845544332e-01   +2.633175723043849e-01   +5.749571432577084e-02   -1.822578658637480e-01   +1.562338561871723e-01   +3.776692572920243e-01   +1.987183038689499e-01; -3.218491089826844e-01   -2.247167351052223e-01   +6.523417599964267e-02   +3.616487747998559e-01   -1.223007272447602e-01   +2.124224941334248e-01   +2.156598512693822e-01   -3.232237310750550e-01; -6.184701494021923e-02   +7.350094723106024e-01   +3.414959625577279e-01   +2.842489449864511e-01   +3.533173817825749e-01   +2.916914024707305e-01   -4.474489782291255e-01   -3.487558506745817e-02; -1.354363796267814e-01   +1.000000000000000e+00   +4.987930939776169e-01   +2.126885897533486e-01   -2.726051069872841e-01   -2.558003884836179e-01   +5.993909028506901e-01   +3.496364048549458e-01; -2.690199153891837e-01   +3.717906142536359e-01   +4.316649522796323e-01   +2.035756160362228e-01   +1.336331140280565e-01   +4.881250447153742e-01   -3.478333543402203e-02   +6.074750864610589e-01; -5.241953351838010e-01   +6.982116325135914e-01   +2.299395253802919e-01   +5.178754221148295e-02   -3.516762892784044e-02   -1.031798452906250e-01   +1.305177470491552e-01   +3.083497832926264e-01; +3.589306766141111e-02   -4.453763305903964e-01   +6.063365847483537e-01   +3.315962548927157e-02   +4.847684022856275e-01   +1.964155655087946e-01   +1.494875355641901e-01   +1.320959009667645e-01; +4.596368275622235e-01   -4.385939737891231e-01   -7.159271241951044e-01   +5.294965857473245e-01   +7.769271428357116e-02   -2.115896892292522e-02   +2.675920656099671e-01   +1.080672995324443e-01; -1.796660649743393e-01   +5.747786895342222e-01   +9.274721970222448e-02   +2.615936308124187e-01   +3.199768129662794e-01   +4.763186065723777e-01   -8.763094052504893e-02   -2.286293980171156e-01];
L3I_L3E_iAMPA_netcon = [+2.633979235082727e-01   -9.422669794154863e-01   +1.200650646382305e-01   -8.404521438889867e-02   +9.814030807127266e-02   +3.470779462336436e-01   +2.637053459480075e-01   +2.861339832193298e-01   +8.131305031817234e-01   -6.537247544032788e-02   +3.448904733137180e-01   +4.468182745054056e-01; -2.825310843403379e-02   +3.527016739967082e-01   +8.776915806654811e-02   +3.659558683836068e-01   +5.200785972099103e-01   +1.311428104383432e-01   +5.522992157842559e-01   +9.587981807629218e-01   +5.194189634070056e-01   +6.313606288359305e-02   -6.721382232845520e-02   -3.920692161563403e-01; +1.642791951820095e-01   +2.176757833699887e-01   +3.924556852754750e-01   -1.054721993614165e-01   +8.424676475928787e-01   +3.269435076911679e-01   +4.987856821826834e-01   -3.295400121271438e-01   +6.859960280842657e-01   +2.191966739167151e-02   -2.168011031844161e-01   -5.162754418641632e-02; +1.056345293578150e-01   +5.830040470605773e-02   +1.611624436898974e-02   -2.032981524820510e-01   +3.958041867959897e-01   +2.557659659856229e-03   +1.834958566410513e-01   +6.608595202176564e-01   -2.308643124370351e-01   +4.285567608779033e-01   +8.765582500213305e-02   +5.655966967570514e-01; -3.697008907851230e-01   +1.915159036846644e-01   +7.967445522606245e-01   +6.550004420810726e-01   +1.806426804246711e-01   +2.635911963301005e-01   +2.435821926274384e-01   +1.753985993183451e-01   +4.390893040101443e-01   -5.465974566230351e-02   -5.347570008481025e-02   +1.926625596178156e-01; +2.240914185539220e-01   -1.987337076254896e-01   -4.534873044281256e-01   +1.258750775721020e-01   -4.857591472077052e-02   -3.859740636278234e-01   +5.495507202810128e-01   +7.893114485389893e-02   +2.336725787275355e-01   +6.083673493591683e-01   -1.616121604674041e-01   +8.415242892413799e-01; +2.739587689146633e-01   +2.560444551970653e-01   -1.147847802107468e-01   -3.641091653119592e-02   +3.673929965737281e-01   +5.839115885059153e-02   +2.954479701008367e-01   +1.819604687345092e-02   +2.812492472939501e-01   -1.552259914238729e-01   +1.210631438749636e-01   -2.836796090949286e-01; +3.662613252046268e-01   +3.660626386366498e-01   -1.277281864797367e-01   -1.491098821902950e-01   +4.344288372842462e-01   +3.999513637840221e-01   -1.976621498558494e-01   +1.389089819221429e-01   -2.214564722327806e-01   -3.961132561900662e-01   -7.048462659536646e-01   +3.788676115876148e-01; -2.845997202950493e-01   +5.198507933281246e-01   +3.857594448056786e-01   +8.156172677097303e-01   -5.726364987785999e-02   +6.971535342317836e-01   +4.402608246238869e-01   +1.884977205969872e-01   +3.091172565814694e-01   +5.178193063180777e-01   +1.901247624680674e-01   +4.305232246512324e-01; +9.439664946624552e-01   -6.853878187193069e-01   +3.541669174381230e-01   -4.427888699732431e-01   +1.750766422505395e-01   -3.356524318755478e-01   -3.262345165072708e-02   +3.306748059232861e-01   -2.707035897641704e-01   -1.567197853731279e-01   +5.908610422410082e-01   -2.491994711818389e-01; -3.535743895570579e-01   +8.075436387673816e-01   +4.356974132633631e-01   +1.874015804452804e-01   +1.688117648156433e-01   +9.259480874229131e-02   +6.420518244226290e-01   +4.112339802811890e-01   +3.906649536268896e-01   +2.570018028908404e-01   -1.613226329067623e-01   +5.972915278652657e-01; -1.740490009347778e-01   +3.039503481090514e-01   +1.962231104104060e-01   +6.803374432129089e-01   -2.626997390615259e-01   -1.425862764670559e-01   -2.386314370674190e-01   +5.264763146257510e-01   -1.499044758050287e-01   -1.069784408361536e-01   +8.481752222431900e-02   -1.303598380671434e-01];
L3E_L3I_iGABA_netcon = [-7.636202052519842e-02   -1.234558996531096e-01   +2.384243857643263e-01   +2.281283807047838e-01   +1.385070180930590e-01   +5.517894733974013e-02   -2.548467021074694e-01   +1.416811634520116e-01   -5.513936780056491e-02   +3.728227300019152e-01   +4.976346711671896e-01   +1.862705719357698e-01; +3.408588732281586e-01   -3.806835219257283e-01   +2.347168908835209e-01   +2.587617313472360e-01   +3.603521579847240e-01   -3.004381542863936e-01   -7.523773781943613e-02   +3.094558939184426e-02   -2.035776355135127e-01   +3.262792442973111e-02   -4.478394330078972e-01   -9.989798049281215e-02; +3.121640128977067e-01   -2.635154859464711e-01   -3.634263026687010e-01   -1.247262653898037e-01   -8.815795203504108e-02   +4.481955311728539e-01   +3.477871866997997e-01   -6.802861697917613e-02   -8.119077270524337e-02   -1.687047036121165e-01   -2.267101389255662e-01   +1.494977438129080e-01; +1.388669724534824e-01   -2.726553951844511e-02   -3.091714651517086e-01   +4.429800894878601e-01   +9.179760037560571e-01   -2.040439836115590e-01   +2.171386638428368e-02   +1.232781786825958e-01   +9.324752401896966e-01   +2.575520467199295e-01   +5.331082995412391e-01   -1.959172234577186e-01; +1.515876250465253e-01   +3.015777313110889e-01   -8.956159740396898e-02   +2.428057758955866e-01   -2.035762688246670e-01   -1.338641246384278e-01   +2.508186084429243e-01   +4.404741331901503e-01   -2.307843686644664e-01   +7.741982283788913e-01   +3.305457378570544e-01   +1.167475645454179e-02; +3.418410483217970e-01   +1.582364752536270e-01   +4.977340470219273e-02   +4.788656069725827e-02   +1.650805206725133e-01   +2.844575204362294e-01   +3.817956086897719e-01   +7.915459071963955e-02   +2.148869959887113e-01   +4.029298408740098e-02   -2.194469776114464e-01   +1.642046104358647e-01; -3.181518376043136e-01   +1.274781928321370e-01   +2.156148929708550e-01   +6.544693731962196e-01   +9.345767410525846e-02   +4.948799543653788e-01   +3.739103374699319e-01   +8.326569999986173e-01   -2.457652817479507e-02   +3.212722981416832e-01   +3.053905605804902e-01   +2.882826136907575e-01; -7.151395782651196e-02   +2.030736748486618e-01   +5.239892083574755e-01   -2.479506557090953e-01   +8.315938345543823e-02   -3.987542420567248e-01   -5.969943400363283e-01   +4.838529301922053e-01   -2.889275284471837e-01   -5.660364464114189e-01   +4.689650389769149e-01   +1.788761131893892e-01; +3.477351078411522e-01   +3.409416288130419e-02   +4.063530646937238e-01   -4.494773069827433e-01   +3.181945498567741e-01   -1.644368749253949e-02   -5.208613938672557e-01   -1.423121814617051e-01   +1.464571844194779e-01   +4.565713976825960e-01   -1.298945948949963e-01   +5.425352209417792e-01; +3.488278165344497e-01   -5.972279493649674e-02   +6.825648804763214e-02   +9.229504025813333e-02   -4.126133108993766e-01   +1.729366126495760e-01   -4.053875713385001e-01   +1.824262840804266e-01   -1.769391650099529e-01   +5.768516235344168e-02   +3.706441422030098e-01   +2.010761191068660e-01; -1.442234657402141e-01   +6.900234227200612e-02   +1.807192407104015e-01   -1.269192981707436e-01   -1.008712399350605e-01   -6.725602427500511e-02   +1.213371368058698e-01   +3.766391696535598e-02   +1.568327165401814e-01   -5.118903967605470e-01   -4.720844184209328e-02   +4.674729698577334e-01; +2.283476069750236e-02   -1.837299800690945e-03   -4.016226760465134e-01   -2.584435019148341e-01   +9.751022901703876e-01   -4.812090943520300e-02   +4.895666155041619e-01   +5.278959500944450e-01   +2.763399637633170e-02   -3.836477840131788e-01   +1.957600605380879e-01   -5.965028552933096e-01];
L2E_Input1_iAMPA_netcon = [+7.048224709373403e-01   +8.924184885116205e-01   +8.484342758130030e-01   +2.477041621970081e-01   +2.449254002878392e-01   +7.450022539358786e-02   +7.094412571271199e-01   +6.075754184087152e-01];
L2I_Input2_iAMPA_netcon = [+4.992877058118530e-01   +8.477028780683150e-01   +1.298922291169015e-01   +3.637768801564374e-01   -4.841671904498826e-02   +6.501452451857820e-01   -3.012634263243792e-01   -2.704773604025424e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
