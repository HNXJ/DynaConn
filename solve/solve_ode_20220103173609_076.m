function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.423060503574347e-01   +2.536720706893171e-01   +1.208763086964623e-01   +3.829370926276178e-01   +3.017237319222307e-01   +2.979058869377429e-01   +5.818931085301623e-01   +4.758886026031756e-01   +3.388583468037611e-01   +3.267260980984483e-01   -7.204230065082901e-02   +4.844979147791010e-01   +2.167666334249958e-01   -2.083327186134131e-01   +8.728053740620327e-02   +3.665590025012522e-01; +6.770606387324241e-01   +3.309313473528672e-01   +4.706512302119928e-01   +2.790779270507406e-01   +4.659174951576379e-01   -1.114990284604029e-01   +2.380942076892144e-01   +1.177157166467513e-01   +6.631919469632366e-01   +5.360063895847655e-01   -1.113220825219825e-01   +7.164378744179066e-01   +3.291530052264656e-01   +3.899498458958439e-01   +3.428945104715982e-01   -2.332071836288495e-01; +2.272836259136759e-01   +5.780805651272891e-02   +7.892507363889186e-03   +1.485050460162438e-01   +5.626879162332359e-01   -7.535021385675666e-02   +1.746016611957252e-01   +2.297800798123230e-01   +1.127618554667489e-01   +6.344550726273813e-01   +8.108045026292087e-01   +7.174585074431215e-01   +8.682373564751146e-01   +4.739604743911729e-01   +2.546914339407208e-01   +5.880428123480804e-02; +4.373296998140032e-01   -2.275509434680713e-01   +3.284222973225156e-01   +7.142428011573441e-01   +5.560341714708023e-01   +8.345262705710654e-01   +3.287365986360105e-01   +4.016781365108662e-01   +6.351813311248504e-02   +1.510917389734126e-01   +5.242998952143245e-01   +4.629480483810584e-02   -4.116511948550620e-01   +4.990796337105455e-01   +1.487745650134866e-01   +1.028311925120525e-01; +2.928613567688265e-01   +3.521399470559516e-01   +1.521562549067706e-01   +3.520368484627806e-01   +3.775973384900752e-01   +6.549320311506501e-01   -1.693409431398624e-01   +2.109067534479132e-01   +6.526536318651744e-01   +6.729361721858688e-01   +5.443837784198780e-01   -6.762546277400205e-02   +5.073841759375335e-01   +1.679838578194563e-01   +5.954329456278028e-01   -2.990260266019560e-02; +4.738245517771221e-01   +1.901198476761046e-01   +8.164752656367178e-01   +3.008989464124738e-01   +2.941138788621168e-01   +8.570965345664704e-02   +4.544386528838825e-01   +2.262053127408570e-01   +1.835877416059767e-01   -8.206616846276463e-02   +5.190985110465137e-01   +4.966806065652184e-01   +5.535678540755976e-01   +4.594537957853204e-01   +5.870732995136602e-01   +3.788772204137275e-01; +3.191812693347361e-01   +4.574086733897018e-01   -7.169385541485807e-02   +4.979076020516772e-01   +7.397017113843497e-02   +4.186564498291791e-01   +1.509640675672644e-01   +3.241154149279679e-01   +4.784201647717625e-01   +5.179790573736450e-01   +4.339281555986743e-01   +4.024534408642902e-01   +1.560456591670946e-01   +2.280991310625287e-01   +4.181593142688132e-01   +4.133990171175977e-01; +2.649303293449526e-01   +2.138699137092730e-01   -1.010768634258498e-01   +4.320855414648486e-01   +4.035415518866874e-01   +1.196814457650170e-01   +2.346004069729618e-02   -1.514403031461080e-03   +3.861622140523353e-01   +3.971390554376385e-01   +6.831385337367917e-01   +2.157230334078086e-01   +3.551841290170138e-01   +3.754152903143428e-01   +2.453719698563129e-01   -7.665576533748784e-02; -9.330638624934169e-03   +1.429490951368781e-01   -9.801079117467451e-02   -2.361907075204456e-01   -1.598184593637452e-01   +1.715844788202832e-01   +5.098734537060288e-01   -5.494363904760220e-02   +7.395672650185417e-02   +3.288568514459878e-01   +4.976508045980211e-01   +3.496609942525121e-01   +6.630309961057136e-01   +2.713623030281477e-01   +1.924231832879369e-01   +1.698637337991661e-01; +1.630714495856446e-01   +1.331234045714368e-01   +6.332136337036127e-01   +9.572692696886650e-01   +2.210197469827769e-01   +3.947609705957539e-01   -1.402301702050158e-01   +7.334987790529658e-01   +2.741204831442804e-01   +4.766130953488419e-01   -1.772411946600310e-01   +6.350681035650351e-01   +4.694634504710020e-01   +2.641097342729483e-01   +1.480087205149492e-01   +1.233181136753510e-01; +2.980276247855903e-01   +7.408436388796789e-01   +6.095851403682838e-01   -5.701945363474043e-03   +9.303792015768925e-01   +6.964681619953315e-01   +3.847131946478830e-01   +1.495011964271335e-01   +2.467157710543664e-01   +8.733635786979441e-01   -1.118885749809259e-01   +7.437087910095472e-01   +5.204151153778735e-01   +1.537675879144522e-01   +3.063752902549996e-01   +5.260535736191797e-02; -2.650291249607370e-02   +2.108036593969598e-01   +5.333608751700867e-01   +1.000000000000000e+00   +3.095004397735564e-01   +6.766933542488803e-01   +5.417023033361350e-02   +1.408196058055750e-02   +4.158120229285335e-01   -6.606736951228915e-03   +9.153037501017058e-01   +3.536741046200395e-02   +1.907402184923719e-01   +3.244952521556102e-01   +1.082757204496552e-01   +6.410792952188288e-01; +5.876276328295048e-01   +5.187142801617326e-01   +4.701919336260062e-01   +7.365450988656274e-01   +1.336761223123304e-01   +4.727997053484607e-01   +5.322911800964337e-01   -2.857682382867917e-02   +3.215400502121901e-01   +8.427243454419495e-02   +3.179513919108929e-01   +1.852948740379780e-01   +3.533556928498670e-02   +3.592796864959069e-01   +3.434224623628821e-01   +3.399687869623186e-01; +1.836032235373233e-01   +5.817630112931654e-01   +4.159898007551366e-01   +3.864128041742617e-01   +5.551657731226729e-01   -4.545206923373707e-02   +4.479795316772853e-01   +1.530148097088047e-02   +4.794569600491038e-01   +7.927810930953565e-01   +6.474252971421436e-02   -3.300370688412667e-01   +6.973382181461360e-02   +2.320139373534114e-01   +1.444567277660551e-01   +2.577076819026352e-01; +2.532663426312853e-01   -6.162141557468905e-03   +5.260617163269345e-01   -8.168518261372897e-02   +3.112585640286868e-01   +2.068659060719319e-01   +2.878685726962781e-01   +2.672108368770763e-02   +1.855183088651798e-02   +3.279635091263449e-01   +5.182502726846976e-01   +1.336621913283470e-02   +6.121300230156800e-01   +3.090008749056509e-01   +7.831210379642941e-01   +4.182070421994021e-01; -5.067330288976397e-02   -1.937087354390986e-01   +3.564447096875760e-01   +5.279560582389821e-01   +6.046855491003530e-01   +4.663905881155006e-01   +5.135878035505044e-01   +4.917583300891408e-01   -7.470243591626502e-02   -8.806717808085361e-02   +1.469637682250882e-01   +6.095623992346814e-01   +6.230337234648243e-01   +5.249987337373730e-01   +4.217582338320109e-01   +1.244133041212140e-01];
L1E_L1I_iGABA_netcon = [+4.581496098149395e-01   +5.418249745580952e-01   +5.081213886392520e-01   +2.437025967481209e-01   +4.968176021810847e-01   -4.764472158158158e-03   -6.051331465870301e-02   +2.942259121845357e-01   +2.449989359204222e-01   +6.572327575713807e-02   +2.835048903391010e-01   +6.998469030461121e-01   +8.423530445932390e-02   +1.905236755940056e-01   -1.466248690607398e-01   +5.664324220995370e-01; +1.284920771687692e-01   +1.281784040232475e-01   +2.304944556370328e-01   -3.177882919747180e-02   +4.151312733330286e-01   +4.249067855213943e-01   +7.629919248473563e-01   +6.826478917324065e-01   +2.794628874573862e-01   +5.708435331475669e-01   +2.101962673195970e-01   +4.113032017629610e-01   +1.042672523044005e-01   +5.302185168955141e-01   +4.076238517911794e-01   +2.505842905214930e-01; -9.853667484215105e-02   +7.884548258249462e-02   +2.962596619486312e-01   +2.301793210411114e-01   -1.070640845915777e-02   +6.158121413259745e-01   +3.441256393072231e-01   +4.647549593653423e-01   +4.165497919186422e-01   +1.047898088536957e-01   +3.071285838151266e-01   +1.444574720670452e-01   +6.564723813068933e-01   +1.175111368353694e-01   +5.070097829981763e-01   +4.576816286069330e-01; -3.472951377031759e-02   +2.825691675369141e-01   +8.139755071270670e-01   +2.839668035066572e-01   +4.479970049180312e-02   +2.579137720798500e-01   -8.701284297881900e-02   +2.605409389773469e-01   +3.368591205296792e-01   +9.920895573768002e-02   +5.209804189749008e-01   +3.209231367934979e-01   -2.619031248381797e-01   +3.123510004553013e-01   -6.520454104129621e-02   +2.825114284482547e-01; +5.215895107564568e-01   +1.592845810936614e-01   +2.594762762558611e-01   +8.067906427752610e-01   +5.323376261402590e-01   +3.757696843337179e-01   +1.094653392186759e-01   +1.304509837036066e-01   +3.200530764105850e-01   +4.811592258942553e-01   +5.869816378140440e-01   -9.797760126410594e-02   +6.190640583640061e-01   +6.654337653858300e-01   +3.472335015663396e-01   +6.782485847752499e-01; -5.763423214402043e-02   +3.968119179079671e-02   +7.004744050296398e-01   +3.255356687982782e-01   -9.304889230389514e-02   +2.139675498093011e-01   +4.849295228212493e-01   +1.487264918396113e-01   +6.290460524858749e-01   +4.564294108002007e-01   +2.215731041412221e-01   +2.186834375173256e-01   +2.014393242402552e-01   +1.840479529005946e-02   -2.063376971204653e-02   +7.327415825908427e-01; +1.371710371162156e-01   +5.777193141424360e-02   +5.327214081974119e-02   +3.577296297843934e-01   +2.811489775944233e-01   +1.159205700160735e-02   +3.843522143518113e-01   -7.031508490478516e-02   +4.862542590389332e-01   +1.105819443900075e-01   +1.475348722882399e-01   +4.160612646160740e-01   +4.199393688321699e-01   +3.870616362483444e-01   +3.897413240453264e-01   -8.833970472974542e-02; +5.669596296660703e-01   +3.442371730916757e-01   +3.610501320711692e-01   +4.733351092376972e-02   -1.389921043429403e-01   +1.657266469475049e-01   +4.206406274972969e-01   +2.296254491048542e-01   +2.890522852566086e-01   +4.961911493218265e-01   +5.746332837189230e-01   +2.219329010586771e-01   +3.808511669814749e-01   -2.523372666880679e-01   +4.306685224100114e-01   +6.481889935091331e-01; +3.022192269980941e-01   +8.012960358105324e-01   +4.305051047500233e-01   +5.245370748487257e-02   +1.387740018335267e-01   +4.987274930802694e-01   +2.213380002258914e-01   +2.277933597463110e-01   +5.917519869062734e-01   +1.303456477899605e-01   +9.643686025986356e-02   -6.370345021967770e-02   +7.365650065671270e-01   +4.644199701956260e-01   -8.582869803366268e-02   +4.803593203834220e-01; +6.427783711144283e-01   +1.584780068110223e-01   +5.822110452967729e-01   +6.578580969455966e-02   +5.139319143914218e-01   +3.714181618966220e-01   +3.344289332771300e-01   +2.938700838182020e-01   +1.834580164211812e-01   -2.755690489847620e-01   +1.770978268762017e-01   +4.651629726694770e-01   +3.501220812170512e-01   +2.930714320201066e-01   +4.920635982524924e-02   -3.817112282747259e-02; -1.630051830822279e-01   +5.111542534863827e-03   +5.767896506153511e-01   +8.180455935829634e-02   +2.874661943157397e-01   +2.392658379617233e-02   +2.165874980887579e-01   -1.733044934256945e-01   -1.480340403132764e-01   -1.691898014060959e-01   +4.366793365075346e-01   +2.441609702838259e-01   +4.751382962887167e-01   +5.754468450278797e-01   -3.643665628827220e-02   +5.734884913837945e-01; -1.912213336143237e-01   +1.000000000000000e+00   +4.659846551496121e-01   +4.105099139768931e-01   +7.261155675884374e-01   -3.191614881025792e-01   -1.878132922100873e-01   +1.569562463591366e-01   +6.764486187738036e-01   +7.897539669243558e-01   +2.773874142680410e-01   +7.310418912346077e-01   -2.123051657554821e-01   +5.742193607597789e-01   -3.776080763224038e-02   +7.081514583147222e-02; +3.126250473153576e-01   +5.549617812550293e-01   +5.598046181423825e-01   -5.524400391528909e-02   +6.431583845984344e-01   +2.757420837721234e-03   +5.846340473981591e-01   +5.427793833474485e-01   -3.015854550156984e-01   +1.852526029227582e-01   +2.162773619117372e-01   +4.063746575350040e-01   +2.427341223264726e-01   +2.441860572805532e-01   +2.998972457231089e-01   -9.485045076767609e-02; +3.480162252770366e-01   -7.960425704151496e-02   +3.482094088137859e-01   +4.456333805134636e-01   +2.996373449610695e-01   +4.591373424539112e-01   +4.407885899846942e-01   +7.014830761860534e-01   +3.321097426676736e-02   +5.926121777956388e-01   +5.758904370423245e-01   +1.661397157133011e-01   +6.355849586537775e-01   +3.106580528736251e-01   +4.282855517150381e-01   +7.774110725314803e-01; +3.242177561386879e-01   +5.303148577643481e-01   +7.220131008843355e-01   +7.382119442935109e-01   +1.822167120198940e-01   +5.234822257190577e-01   +8.986173854458739e-02   +3.556812457108254e-01   +3.776335643144721e-01   +4.458054252227497e-02   +8.163806819243590e-01   +3.978180211667892e-01   +5.307110706355215e-01   +3.943270116037372e-01   +1.611767511409561e-01   +4.582902998079187e-01; +8.432242032565015e-01   +4.470901580589407e-01   +6.281527854883190e-01   -1.305226582708286e-01   +4.756851109399884e-01   +4.870988224863491e-01   +2.396316444783821e-01   +4.459436916342031e-02   +3.185740340851496e-01   +5.719294673759423e-01   +6.548055201478490e-01   +3.574648064550716e-01   +2.643298113146922e-01   +4.114641493247878e-01   +4.922625455242263e-01   +1.980046008033782e-01];
L2I_L1I_iGABA_netcon = [+5.885863139548800e-01   +4.183107066256376e-01   +5.574255390620552e-01   +8.237137853367898e-01   -1.662514552569578e-01   +2.089832771141220e-01   +2.171807846185217e-02   +1.536356536477110e-01; -2.753486789546762e-01   +3.697050349230587e-01   +5.114570816285557e-01   +3.402199383281042e-01   +4.053493528286018e-01   -1.410059293210312e-01   +2.609909405192825e-01   +3.963162112748916e-01; +2.784537190488491e-01   +1.193439592076032e-01   +5.152833140200032e-01   +6.194343554238912e-01   +1.941555344131320e-01   +1.368921471587260e-01   +2.548660699056267e-01   +6.688659558403631e-01; -3.952388109214973e-01   +4.253438386813350e-01   +3.979276130475685e-01   +3.794427103909760e-01   +7.053466472819855e-01   -6.677638587705959e-02   +1.004769360877426e-02   +4.922340605179968e-01; +5.668818927393492e-01   +3.233430494028514e-01   +6.661976009763615e-01   +5.282646427919998e-01   +1.400600547008868e-01   +3.401988519957562e-01   -4.311729850268700e-01   +6.244535054760416e-01; +3.480192106050586e-01   +5.232164889990335e-01   +3.215613476182926e-01   +6.907079398848220e-01   +5.568778002733956e-01   +4.727217271772695e-01   +5.032567298170835e-01   +1.947559088128610e-01; -9.789153474613796e-02   +1.562056312431549e-01   +5.677068907950920e-01   +9.382940630222159e-01   +4.610184709548126e-01   +4.720937470296372e-01   +1.864152098895373e-01   -4.376260646743560e-02; +6.535509724209650e-01   +1.969007553871859e-01   +4.348821793603936e-01   +7.213994235397134e-02   +4.525220953420245e-01   -1.279579365091666e-01   +4.519289943541949e-01   +4.569764316983652e-01; +1.225531199819544e-01   +5.130800656202165e-01   +3.806643835924493e-01   +9.359602503698869e-02   +8.615071175651722e-01   +3.009689198323862e-01   +1.627505517505154e-01   +5.181266974881193e-01; -3.221557059958137e-01   +7.068382711276163e-01   +6.193074796689150e-01   +1.830883326714607e-01   +3.546576209825535e-01   +3.258254271661508e-01   +8.859993132707531e-01   +1.998693586644789e-01; +3.880848943064238e-01   +3.817704948402900e-01   -3.538098312333739e-02   +8.320798640234837e-02   +9.115332946910785e-01   -4.189164839003100e-02   -1.285121630136949e-01   +4.683126313186506e-01; +4.477639618429143e-01   +3.974022806710877e-01   +5.372087158239953e-01   +1.750176485135239e-01   +5.326451659313660e-01   +4.291377387601713e-01   +2.207715804641215e-01   +7.068681273723696e-01; +9.269786488867326e-02   +1.528233357014754e-01   +3.029097161386864e-02   +8.120021575827038e-01   +3.317836474965664e-01   +5.344738547038287e-01   -2.395938641242636e-01   +2.067598386230612e-01; -4.079786195411832e-02   +3.789367370742893e-01   +1.721685208410197e-01   +1.970705325025274e-01   +5.220781850740699e-01   +1.821929591658712e-01   +1.354632504631030e-01   +1.722280734882661e-03; +3.207783041863751e-01   +2.444404302188234e-01   +5.974956351621448e-01   +1.569353139342273e-01   +1.126242148054116e-01   +5.619797949294887e-01   +3.374208395131268e-01   +1.443310979021773e-01; +3.447069639990188e-02   -1.233210676053080e-01   +6.070145456035928e-01   +7.275114007244380e-01   +3.310423256854107e-02   -1.263924679750427e-01   -3.381194862423532e-02   +3.585694086778752e-01];
L1I_L2I_iGABA_netcon = [-1.939179355448311e-01   +5.040925783305074e-01   +6.015468049075514e-01   +2.248611316050233e-01   +3.565925515198317e-01   +4.039727901491462e-01   +6.743143560094419e-01   +5.012324176538082e-01   -5.290283421664159e-02   +8.845432048445138e-02   +4.987368861605254e-01   +3.492982067264175e-01   +8.364921385617018e-01   +3.244607942998003e-02   +1.854457307249368e-01   +6.233349919989690e-01; +1.086829237027215e-01   +5.021122490406484e-01   +3.862352389920197e-01   +8.682702797767373e-01   +2.911507014201040e-02   +2.070192859975904e-01   +2.739683313970390e-01   +3.377607173901137e-01   +3.176510926598795e-01   +2.698287508875001e-01   +5.217808441889279e-01   +1.118426646695310e-01   +7.224037604918927e-01   +6.387300930322989e-01   +3.215393765027670e-01   +2.754729652842161e-01; -2.400064598041831e-02   +3.454141488041775e-01   +4.552886623651937e-01   +3.801963405191484e-01   +5.735539269914657e-01   +2.457774171349721e-01   +2.433730682734340e-01   +1.701935865975719e-01   +2.303476055467045e-01   +6.735718163177558e-01   +4.631159462425956e-01   +3.212040714650567e-01   +4.421182527384535e-01   +5.531977119461675e-01   +2.741103031592373e-01   +7.818583074593334e-02; +2.176349143806155e-01   +7.987328045336359e-01   +5.259387610097102e-01   +2.477510133975891e-01   +2.671918729640106e-01   +3.884957338620063e-02   +2.341263009573899e-01   -7.842642232173529e-02   +4.296033572112213e-01   +5.074217100974047e-01   +3.932420525394841e-01   +8.885161087164851e-01   -2.009531077424881e-02   +6.794516835139723e-01   +7.254056665600161e-01   +8.912969955066430e-01; +5.499788309347297e-01   +6.164105438643055e-01   +1.000000000000000e+00   +2.512691071580374e-01   +5.294392885056056e-01   +2.903823530365401e-01   +2.923289809910918e-01   +2.167118941739251e-01   -4.513809622401345e-03   +6.711120184377648e-01   -1.540883755873767e-01   +4.974341378910924e-01   +3.464206387992672e-02   -1.372699117006667e-01   +1.400693702315568e-01   +3.739346267154703e-01; +6.056416241174352e-02   +9.898420011120961e-02   +5.128230387733937e-04   +7.915737054226089e-02   +7.786229697361027e-01   +3.524676729701477e-01   +1.100663467782517e-01   +1.621466599711792e-01   -5.056981241513807e-02   +7.360907912841489e-01   +2.345114438222348e-01   +5.757266067452251e-01   +3.928357249970605e-01   +9.675016921135016e-02   +5.192318397854034e-02   +5.839631257679484e-01; +4.298368907946735e-01   +7.358730673634829e-01   +3.932017438319008e-01   +6.020350117955492e-01   +1.495414282025695e-02   +5.306768541324436e-01   -5.138655060798902e-02   +2.130953137807972e-01   +2.615094136113483e-02   +1.097730641980500e-01   +7.461346507835149e-01   +5.578654471892019e-01   +2.444190040699680e-01   +4.692291229489473e-01   +5.387066358179046e-01   +3.410520580317741e-01; -9.705544469104102e-02   +2.977798932200758e-01   +3.949306337222818e-01   +2.949102148025092e-01   -5.972858497018074e-02   +3.928902061221546e-01   +4.861352311827157e-01   +1.327871292931915e-01   +5.985025626899522e-01   +9.996304863509536e-02   +1.549279932409869e-01   +2.030055693040777e-01   +2.398773578563766e-01   +4.216892825546208e-01   +1.563620778851821e-01   +4.551201724805189e-01];
L2E_L1E_iAMPA_netcon = [+5.760042109450629e-01   -1.886843837315004e-01   +2.334625146499898e-01   +4.805726309710272e-01   +2.952499236423149e-01   +3.034466385917481e-01   +1.030748964549657e-01   +5.830485451487442e-01; +2.177307587398169e-01   +3.998653762881622e-01   +5.079011750598130e-01   +5.299066200366688e-01   +2.478430033917610e-01   -1.474013595822882e-01   +4.545967248539142e-01   +1.824293840448655e-02; +3.591598057051704e-01   +1.718871533545183e-02   +4.684682760754108e-01   +3.051278273141945e-01   -1.625579492315156e-01   -2.628145495608097e-02   +1.475461656703412e-02   +2.013260084859579e-01; -2.161552447340084e-01   +2.352799704257337e-01   +2.540582140210511e-01   -1.873593956532784e-01   +3.984411689168142e-01   +3.237567305206833e-01   -1.387094536633688e-01   +2.046347136233901e-01; +9.657515007271841e-02   -1.907930003123879e-02   -3.615120132165660e-02   +5.861050123006483e-01   +3.141739107877817e-01   +4.988323100828023e-01   +2.008721632551806e-01   +2.535467386648044e-01; +5.049175028749281e-01   +6.699322748214019e-01   -2.555624186323287e-01   +3.090455844532766e-01   +3.113475007523117e-02   +2.727439202126376e-02   +8.749786377262887e-03   +1.053907324187716e-01; +8.477269434088094e-01   +6.989690998018645e-02   +7.097944988474895e-02   +1.546526420073270e-01   +4.369609259468105e-01   +1.710780376080590e-01   +1.378701725475817e-01   +3.286468049810343e-01; -1.455303346312592e-01   +1.152523659021935e-01   +1.874334720723953e-01   +2.089897178386680e-01   -7.502455414414240e-02   -1.069439971053527e-01   -1.706621796607751e-01   -3.176585950610306e-02; +4.257256142715928e-01   +5.097895760811563e-01   +2.626087818524939e-01   +2.195557299939860e-01   +2.558263075530325e-01   +3.755165447602790e-01   +1.223957536769564e-02   +2.642612092232587e-01; -1.223298487606982e-01   +5.076574804364153e-01   +2.259517339759705e-01   +1.354964403513017e-01   +3.379482452577597e-01   +2.814498623106677e-01   +5.143027457818685e-01   +3.076239026584769e-01; -9.137230243589773e-04   +2.835977259856740e-01   +1.000000000000000e+00   -3.054073415254036e-03   +2.766574933374504e-01   +1.136344510559166e-01   +6.521246480108853e-01   +2.883839926501223e-01; +7.248742439192510e-01   +3.457552849573782e-01   +2.591982709409383e-01   +3.048654854951602e-01   +2.787117075823763e-01   +3.221963436006288e-01   +1.721547914719216e-01   +5.168197170219107e-01; +4.309569752754222e-01   +2.924799628680997e-01   +2.381904947400301e-01   +6.903996132528345e-01   +3.256450479971524e-01   -4.310005529098006e-02   +1.674497607227166e-01   +1.589142959495568e-01; -9.136465096898234e-02   +1.460150287437764e-01   +2.412592256412429e-01   +1.884714433596672e-01   +2.768206875650797e-02   +3.534778799697245e-01   +9.332963221159115e-01   +4.509563099768952e-01; +2.672725653486667e-01   +1.447974529774931e-01   +2.016300511857556e-01   +8.089385550773764e-01   +2.657103433773238e-02   +2.635463046168333e-01   +1.761942182124475e-01   +6.649234247901408e-01; -1.197532582640976e-02   +3.923414483273718e-01   +3.605817178482475e-02   +3.045199404181154e-01   +1.153605112081779e-01   +4.304371388439412e-02   +1.962488056289380e-01   +1.936595819301478e-02];
L1E_L2E_iAMPA_netcon = [-5.020458987364203e-02   -2.459736136130756e-01   +7.060932129122437e-01   +5.000729647438453e-01   +5.334393980658977e-01   +2.803676211834888e-01   +3.684682633119323e-01   +2.422469455880639e-01   +4.505892672538140e-01   +5.876098876254224e-01   +5.863539469948346e-02   +4.965421842497206e-01   +7.803162744098868e-01   +3.766651978722523e-01   +5.251263594249735e-01   +1.984145752353408e-01; +4.294594604397963e-01   +2.862204770744872e-01   +2.470440889301729e-01   +2.665786298668706e-01   +1.515830269119121e-01   +6.188132017592607e-01   -1.075716939065529e-02   +2.491172542721721e-01   +1.895427532068409e-01   +5.741260347420422e-01   +4.227141290720648e-01   +1.994183298889546e-01   +4.648909677464613e-01   -4.169416008700243e-03   +6.231974380407139e-01   +1.039127505782430e-02; +4.910150122245935e-01   +1.821331703687838e-01   +5.552410914038360e-01   -2.854015990331902e-01   -8.083442611159489e-02   -2.841705023034743e-03   +4.104177095271868e-01   +5.718677334000580e-01   +1.954052196966144e-01   +2.645941419230065e-01   +4.765571339393748e-01   +1.000000000000000e+00   +6.163504374138451e-01   +4.676381253382320e-01   +4.610581250008530e-01   +7.527273219029169e-01; +1.967826774759949e-01   +8.486054437922559e-01   -2.240839257172740e-01   +7.103651235137066e-03   +4.306890578478369e-01   +5.817017654677491e-01   +6.578036033435373e-01   +9.159229272893468e-02   +9.098869031640914e-01   +1.851299210289884e-01   +4.509255744956281e-01   -5.780074701237285e-02   +3.152350776587858e-01   +6.119343317492590e-01   +1.190729291653209e-01   -2.369081598751269e-01; +3.918345689251477e-01   +2.264254686112971e-01   +1.042122865336169e-01   +9.294250671007322e-02   +7.961392908956906e-03   +1.114561203917541e-02   +5.294938728116154e-01   +6.104587139548352e-01   -3.655835347637839e-01   +2.124621997293004e-01   +2.249323027147009e-01   -7.418183428528277e-02   -1.115947765637693e-01   +3.902472430650792e-01   +2.889820890129847e-01   +9.228928741331680e-02; +2.789142369110282e-01   +4.634821633880396e-01   +6.171403274325606e-01   +8.889278843016356e-01   -1.550637910396291e-01   +5.480330294670185e-01   +8.965126149116652e-02   +5.412063462583743e-01   +3.508256708209246e-01   -1.023918847714938e-01   +2.856239934931884e-02   +2.123443791398173e-01   +7.138908024060591e-01   +6.521230335226555e-02   +5.460909820805693e-02   +4.272926707299805e-01; +2.531875062688201e-01   +2.684461381633963e-01   +6.647298067069175e-02   +1.827116321390576e-01   +4.007391722560467e-01   +2.678855371265985e-01   +2.391829818386947e-01   +5.817902431068465e-01   +2.062639444960396e-01   +2.790981269680997e-01   +6.308747008962702e-02   -1.785378030822417e-01   -1.938880175894830e-01   +3.134331113089276e-01   +1.017226615030692e-01   +1.724040645679118e-01; +4.668353054613759e-01   +2.637031491869861e-01   +5.550444284421890e-01   +2.975425739443295e-02   +3.675028531877999e-01   +5.344014863207484e-01   +5.315738852601679e-01   -4.858702367779875e-02   +4.237315517688760e-01   +7.419439073875524e-02   +2.365184254241223e-01   +3.322824374970729e-02   -8.400894689128717e-03   +5.035842875595408e-01   +6.939588479516633e-01   +3.705868110642555e-01];
L2I_L2E_iAMPA_netcon = [-1.021081891189558e-01   +2.004354556635096e-01   +4.294925409706785e-01   +2.695121967643953e-01   +9.205122189614494e-01   +4.052133612903441e-01   +3.478451502015623e-01   +5.822362349926176e-01; +3.580481819180648e-01   +3.470128016972077e-01   -1.051412034474517e-01   -2.443448226489869e-03   +4.229154286789980e-01   +6.662091125947525e-01   +1.065992320132134e-01   +5.527338224805590e-01; -4.203474126814906e-02   +3.546331617192471e-01   -2.239944723276181e-01   -6.379849504897228e-04   +9.302447616640813e-01   -5.019952434586594e-01   -3.673969217859880e-01   +4.005001649809570e-01; +5.461961369332158e-01   +9.570784198089745e-01   +5.184557004916092e-01   +6.303072458069352e-01   +4.131095078444531e-01   +3.034031866049410e-01   -1.998777231164416e-01   -2.217770705079732e-01; -3.070644330388642e-01   +4.790756855206714e-01   +6.346344584927521e-02   +7.539270288805500e-01   +7.800730757417663e-01   +4.435170952441855e-01   +5.715069519534999e-01   -9.315464186239381e-03; +6.650412416924296e-01   +5.367110804035864e-02   +3.098899967005883e-01   -8.831079756067180e-02   -1.798493497452210e-02   +9.102471740208328e-01   -2.458586903248135e-01   +1.174571574097371e-01; +2.014539218546898e-01   +6.834416817570929e-01   +6.264624585637114e-01   +6.262013067541594e-01   +6.720860737428809e-01   -3.614067534195400e-01   +1.418745101561512e-01   -3.161597167170958e-02; +8.044938149913412e-01   +7.810401975874528e-01   -2.814597058219293e-01   -1.873101731274512e-01   +2.959463469067719e-01   +3.893505149502127e-01   +7.841053228529760e-01   +6.705766727846650e-01];
L2E_L2I_iGABA_netcon = [+2.655271076327189e-01   +4.089027149141147e-01   +5.927842849719331e-02   -2.573653212104843e-01   +6.396432429686859e-01   +6.302910425877212e-01   +4.336854011339251e-01   +5.907206770013773e-01; +6.324947198880819e-01   +6.152746440570862e-01   +8.008345417093995e-02   +4.889405837408300e-02   -1.344808366356624e-01   +7.072910916627505e-01   +5.394817726839811e-01   +2.682892678785372e-01; +8.973236228121305e-01   +8.936705632927500e-02   +7.574655606065669e-01   +5.364863328925016e-01   +5.134274566709752e-01   +8.431314421189015e-01   +9.820047343338623e-01   +2.291582680906070e-01; +6.654307924065544e-02   +2.349284926166594e-01   +8.911311855101399e-01   +4.711635413613335e-01   +5.911489319957622e-01   +5.151391678839226e-01   -1.575876127548684e-01   +4.481355342330718e-01; +1.109770230985258e-01   +6.155230329736102e-01   +5.874582982027462e-01   +9.172642474068640e-03   +3.181380189521613e-01   +3.817032712150239e-01   +7.710948903673417e-01   +4.135007784537097e-01; +2.237863784664368e-01   +3.807898650311736e-01   +4.492673624357491e-01   +2.996926192306847e-01   +2.081250725565149e-01   +5.295713930991260e-01   -2.767968094933382e-01   -3.903025778310701e-02; +1.301252445973834e-01   +3.142228010752431e-01   +2.590684854786955e-01   +8.387289326382616e-01   +2.190899372249571e-01   +7.149485540413868e-01   +6.564144926049281e-01   +3.208084158036416e-01; +3.577396014311490e-01   +2.861874310153265e-02   +6.518675945401619e-01   +3.634380214331507e-01   +4.959358916751535e-01   +1.151226436280826e-01   +6.111943287952532e-01   +5.757887109076605e-01];
L3E_L2E_iAMPA_netcon = [+1.168559909180041e-01   +5.763000034072193e-01   +8.822201199168134e-02   +5.782941487818837e-03   +6.986777411826817e-01   +6.145328353830242e-01   -1.436589293945458e-01   +6.037886580630929e-01   +3.269387779642217e-01   -1.009833123895995e-02   +2.430551663898873e-01   +5.237837720665240e-01; +4.299734867277813e-01   +3.199045076160065e-01   +1.756692634270622e-01   -4.582458657018462e-02   +5.019237517294004e-01   +2.297435796960018e-01   +9.976451491443658e-02   +5.027269220715597e-01   +4.989441804387079e-01   +4.431613965058452e-01   -3.839526617985005e-01   +8.958900709648215e-01; +1.307713136118123e-01   +2.570220690764363e-01   +6.093783730506992e-01   +4.044755550383178e-01   +8.176334141555929e-01   +4.360351928651215e-01   +4.171473241343957e-01   -1.377211085685679e-01   +5.814558109700936e-01   +2.062279972740845e-01   +2.720205065097384e-01   +5.749562149771809e-02; +5.719191931641762e-01   +1.317572198769448e-02   +7.327312918556245e-01   +2.415319586491123e-01   +3.567850988955176e-01   +4.972928523853496e-01   -8.041692340694953e-02   +3.148527471346849e-01   +1.570670658262873e-01   +2.835008951783397e-01   +5.103625631332214e-01   +8.376572363977256e-01; +1.721157678398164e-01   +2.709731195258507e-01   +2.265599139125207e-01   +4.805603576122351e-01   +3.419512299408223e-01   +6.026119276161228e-01   +3.874161476760572e-02   +5.181260906184660e-01   -1.187336405679399e-01   +5.746204744899998e-01   +1.232428527731681e-01   +3.831539946446444e-01; +1.795326136246937e-01   +3.985790567401241e-01   -1.611634824984938e-01   -4.423850860989764e-02   -2.775633117648616e-01   +8.250328007866355e-02   +5.810765738128000e-02   +6.470520790496646e-01   +3.089479744145335e-01   +4.335733273942775e-01   +1.659984079702330e-01   +4.092234341413742e-01; +2.034282257978039e-01   +7.638905504425720e-01   +1.779771704322885e-01   +8.937362391294794e-01   +4.960068024051133e-01   +3.560190248052159e-01   +5.449075175186664e-01   -2.758155642687504e-02   +1.974815716533169e-01   +6.980715070925180e-01   -2.257821385377561e-01   +2.524960920382437e-01; +2.108677550991349e-01   +4.216545918888868e-01   -3.231121359023542e-02   +4.038250858405967e-01   +2.768109869082401e-01   +1.001009856683949e-02   +2.628525839868364e-01   +1.912733434327636e-01   -7.992757969381900e-02   +7.922486189657950e-01   +4.703688274835133e-01   -2.787968736909507e-02];
L3I_L2I_iGABA_netcon = [+4.361039978772352e-01   +3.434223436610284e-01   +6.511844547582433e-01   +4.196744839967536e-01   +2.472910443822560e-01   +8.878797830261155e-01   +2.288490353624065e-01   +6.534918524697977e-02   +6.358862257710249e-01   -2.371600901478711e-01   +5.115351996852000e-01   +6.330771510566108e-01; +5.511899247515152e-01   +5.152687266264275e-01   +2.114717926859508e-01   +4.592844487826582e-01   +3.693582465438918e-01   -2.103909098897254e-01   -1.307988720178846e-01   +2.157567919369737e-01   +3.543224855689016e-01   -1.630248602893510e-01   -3.579570416166854e-01   +3.442569865614084e-01; +1.949448115826182e-01   +3.660119231654724e-01   +8.313706642447455e-02   +9.851844389186279e-02   +3.025579590750224e-01   -1.272591414254227e-01   +4.259459111560707e-01   +4.660891135659286e-01   +5.234820929673752e-01   +2.518296524333478e-01   +2.835940845181812e-01   +2.768410281146388e-01; +4.297154087992293e-01   +1.440874586084931e-01   +3.935422461295389e-01   +5.229324209983978e-01   +5.268996331463587e-02   +7.419953816635780e-01   +4.322799062341916e-01   +9.522525101373884e-01   +2.731953852759472e-01   +3.131473389690744e-01   +3.924997783279435e-01   +7.545362923642366e-01; -4.978610810925983e-02   +3.380049005690732e-01   -8.435919939413894e-03   +1.923566088709722e-01   +1.919798825804568e-01   +4.279949563571951e-01   -1.348662678928902e-01   +4.107377328368863e-01   +3.203585900392056e-01   +2.939756595178817e-01   +3.226462893958255e-01   -6.422395916646867e-03; +1.737597378301142e-01   -7.592005851277248e-02   +1.528558577236360e-01   +6.173539752127674e-01   +7.491327284880227e-01   +7.979270047128219e-01   +6.381969108088691e-01   -2.659962198223725e-01   +2.043138597057685e-01   +7.175335201108434e-01   +3.435535022922229e-01   +3.956941998081794e-01; +2.435745071108315e-01   +2.308626094787191e-01   +1.155559476068411e-01   +8.621234862567066e-02   +5.824478421135932e-01   +2.664364197773834e-01   +2.739931391200707e-01   +3.555181497317529e-01   +9.989776699159938e-01   +1.031145943919631e-01   +6.708299951397517e-01   +5.792669647865899e-01; +2.115677494619112e-01   +4.209516207289291e-01   +4.048622607704878e-01   +5.094414097815325e-01   +8.084740857969537e-01   +2.855097831137342e-01   +4.809858953564421e-01   +4.367453389914924e-01   +5.815379324819844e-01   -5.360430678518956e-02   +3.467947159021361e-01   -3.423049294350737e-01];
L2E_L3E_iAMPA_netcon = [+8.062900828659150e-01   -6.038151386277727e-01   -3.280210672073088e-02   +1.889714246733495e-02   +3.416438935786392e-01   +6.366803796713774e-01   +5.019261122366949e-01   +2.720521535363903e-01; +3.944126440397554e-01   +8.285074712796570e-01   -1.919012300938784e-01   +4.569643468934979e-01   +6.329555032531428e-01   +1.985762396698305e-01   +1.537188654201554e-02   +2.434361020020551e-01; +4.304684858585791e-01   +7.066488860049320e-01   +1.777431320928539e-01   +6.661945022185134e-01   +5.772535712533502e-01   +8.288828928249317e-01   +4.642820807655884e-01   +3.596161561239863e-01; +5.804694345358735e-01   +3.352288891352534e-01   +9.345720087716740e-01   +5.080622226389836e-01   +4.882520220768399e-01   -2.384572853962743e-01   +4.751777090630802e-01   +4.481077882073592e-01; +8.582328485353516e-01   +8.392760577017344e-01   +3.364656147864452e-01   -9.839186509292450e-02   +2.464135935925419e-01   +6.051779126549075e-01   +1.457189278197366e-01   +5.363631930897544e-01; +8.600878326679920e-01   +1.488322471537412e-01   +7.807884521645443e-01   +3.853648853405425e-01   +5.942659761475139e-01   +4.856146719873238e-01   -1.637499395619254e-01   +1.000000000000000e+00; +5.116582909943557e-01   +1.320973231210671e-01   +3.131755447356199e-01   +5.504033488268339e-01   +7.290224037276047e-01   +3.542718867518594e-01   +4.369304504957512e-01   +4.124775417417197e-01; +2.143204818516068e-01   +4.366731588357035e-01   +7.388417624996531e-02   -2.204004400990688e-01   +4.801828187805058e-01   -5.249892580069361e-01   +2.186440915928573e-01   +9.570807807809290e-01; +4.712952572414577e-01   +2.314700383896960e-01   +2.979023474991312e-01   +3.243232752328449e-01   -1.686682068368680e-01   +7.509866316703174e-01   +2.976959407188490e-01   +6.123172493539785e-02; +2.044162694213505e-01   -1.996694604689819e-01   +6.105337604797275e-01   +4.994956807364777e-01   +5.026985152194341e-01   +8.629813702054946e-01   +8.441496854566060e-01   +3.994767532875964e-01; +6.842789462100601e-01   -2.838452103419225e-01   +3.433877201312595e-01   +3.463452633120450e-01   +2.907744498783901e-01   +3.229131561524341e-02   -1.897870692073000e-01   +7.721626731685863e-01; +2.999057772097378e-01   -2.724273618804442e-02   +5.513495609510430e-01   -1.401100451476892e-01   +8.036010984067254e-01   +3.694789402373784e-01   +7.234944147429743e-01   +5.643236693418880e-01];
L2I_L3I_iGABA_netcon = [+2.324255367803678e-01   +1.893976773783230e-01   +5.199841188426826e-01   +5.404469884033822e-01   +2.345120766164798e-01   -5.227646582389539e-02   +1.573399748125771e-01   +4.247681982046129e-01; -6.457493354585557e-03   +4.595156863044283e-01   +3.265203860169156e-01   +7.093104250778077e-01   +2.655064037253336e-01   +7.022988869246155e-01   -2.595797804247851e-01   +4.843373217362903e-01; +2.692588493429748e-01   +7.538175620517173e-01   +1.462108095926394e-01   +4.525492569706663e-01   -2.827352723741404e-01   +2.029531050157305e-01   +5.450151457896211e-01   +1.578691039462924e-01; +1.758492736279221e-01   -1.677787063276183e-01   +4.405015195838352e-01   +2.831450406326955e-02   +1.328034230134295e-01   +1.913056490587832e-02   +4.823552003122717e-01   +4.053773066991829e-01; +1.816113255760883e-01   +3.859891209472974e-01   +3.114163897743630e-01   +2.223685726982889e-01   +2.144601859184191e-01   +5.077835938076283e-01   -1.414638538465462e-01   +1.960896211053321e-01; +4.779771951427844e-02   +2.245388353848226e-01   +1.310998823123476e-01   -3.338951819106178e-03   +2.930359293613874e-01   +6.246180123091085e-01   +7.050333792973636e-01   +2.190190698234122e-01; +9.123738810220917e-01   +4.696897664400619e-01   +2.312553009737039e-01   +4.008504898401853e-01   +8.325496345610929e-02   +3.339444546725110e-01   +6.435151932300094e-01   -2.616379602556687e-01; +5.157248969454299e-01   +2.239228012847984e-01   +5.277770378514998e-01   +6.609352640736041e-01   +4.893545338789873e-01   +5.287577201548533e-01   +1.519409081184612e-01   +2.671993884940693e-01; +5.187876909698759e-01   +5.509930100811758e-01   +4.044771523947224e-01   +2.318622975320398e-01   +5.634719670027903e-01   +3.574802296402339e-01   +9.406079887856558e-01   +2.154168202732238e-01; +8.912230486599437e-01   +5.259024934856030e-01   +7.715262162027868e-01   +3.820941241872706e-01   +4.023091024629856e-01   +3.596290249944817e-01   -5.812563883309325e-02   +2.049484792199890e-01; +4.621792999706494e-01   +5.511839458361096e-01   +2.356697324821552e-02   +3.523380416842385e-01   +2.977565099541170e-01   +1.434481188866177e-01   -3.783979648969412e-01   +6.695589400802515e-02; +3.391614503474384e-02   +2.938257435762672e-01   +3.023319299658304e-02   +1.130814149041008e-01   +2.323718970480384e-01   +9.692097595591269e-02   +6.908726969775916e-02   +7.000759669795504e-01];
L3I_L3E_iAMPA_netcon = [+5.135509174588599e-01   +1.130782218458475e-01   -4.612520662246639e-02   -1.030455843232044e-01   -1.661478026770159e-02   +2.897369989207886e-01   +5.085764257516650e-01   +2.719435281566386e-01   +6.628111005302406e-02   +5.625572828758160e-01   +8.182868455806594e-01   +5.935455725748791e-01; +8.428134726349880e-01   +4.153709735046608e-02   +8.917066322111100e-01   -1.784492808758361e-01   +7.545983489303204e-01   +1.853736139904585e-01   +4.749857988018248e-01   +2.317825212811887e-02   -5.218307337275044e-02   +4.360904169470208e-01   +3.256367363458331e-01   +4.373261228101785e-01; +3.556748793969395e-01   +1.946784332872772e-01   +5.335215847909619e-01   +5.377943751047716e-01   +2.820315580131251e-01   +3.261720917037170e-01   +9.821448841957617e-01   +1.548580462954118e-01   +1.270237923015988e-02   +4.102873203189298e-01   +2.923123935800234e-01   +1.120732872366037e-01; +7.932646927286076e-01   +9.184748727171614e-02   +8.596275681567762e-01   +4.162552214980063e-01   +3.882355069852715e-01   +6.432293251145724e-01   +8.029313929275400e-02   +4.088500927661137e-01   +4.772808465514318e-01   +1.027526915094809e-01   +8.840666280685650e-01   +3.055668273992564e-01; +3.852452461575296e-01   +3.547393858495982e-01   +1.935391340951962e-01   +3.562307151058131e-01   +8.185480916821700e-01   -2.337450865208806e-01   +2.143224410738921e-01   -2.937626788077323e-01   +3.797342203532434e-01   +2.913540936772949e-01   +1.960902550948478e-01   +2.795392767444604e-01; +1.935372134032296e-01   +3.166279110495657e-01   +1.676210145618699e-01   +5.975811121895477e-01   +3.799298611226586e-01   +7.669113335448816e-02   +5.381008975563670e-02   +8.634594225449164e-01   +3.796938655357944e-01   -8.689893485080612e-03   +6.866875756834081e-01   -9.252891159525246e-02; +3.641325409838599e-01   +9.159583882746173e-01   +6.164619420199214e-01   +3.966009108278798e-01   +4.306290426068035e-01   +1.001137889722867e-01   -3.494037216640025e-02   +1.437504275841345e-01   +4.938278653301472e-01   +6.428901672057987e-01   +5.378016807529107e-01   +6.452312042177366e-01; +6.534618905075773e-02   +4.684840789297086e-01   +4.410217542413824e-01   +7.858405176728144e-01   +5.173159400396637e-01   +3.290156691818162e-01   -1.166306144161056e-01   +2.216602312659912e-01   +3.950495683946771e-01   +8.588590429197827e-01   +5.284602313029564e-02   +5.478898448524691e-01; +2.477772616768875e-01   +4.860643913169831e-01   +8.388118066403702e-01   +2.790002612203146e-01   +1.090541342034404e-01   +5.215487043710615e-01   +5.436474340146362e-01   +9.414563576994526e-01   -1.242053843711907e-01   +3.868478281311868e-01   +5.004396215730293e-01   +5.735772698844475e-01; -1.692255787277037e-01   +4.804154150726679e-01   +6.190240730081447e-01   +4.244108054687833e-01   +6.991576422837442e-01   +2.931243691790058e-01   +4.772741203059818e-01   +2.914894443862168e-01   +1.883687063076936e-01   +6.081459420023116e-01   +5.464595718161763e-01   +6.445087543263210e-01; +6.199470100988469e-01   +3.194581027225905e-02   +5.597745919453295e-01   +9.856287071874353e-01   +4.089025543328071e-01   +4.574828511998034e-02   +8.042215619981892e-02   +9.400165724805529e-01   +8.120536277626065e-01   +1.277339626728579e-01   +7.423384661998094e-01   +7.007810915220759e-01; +1.796763448422888e-01   +3.846923442752659e-01   +5.221960723124927e-01   +1.126936162597298e-01   +1.287426305028503e-01   +4.446271404064833e-01   +7.093588483931460e-01   +6.311842781115747e-02   +2.376424732837932e-01   +2.639158329364545e-01   -8.578965930779336e-03   -3.739650441042593e-01];
L3E_L3I_iGABA_netcon = [+5.512144633131948e-02   +9.271322710152108e-02   +8.962822527397901e-01   +9.859260780337709e-02   -1.597181844179150e-01   +2.398624750301500e-01   +4.049977441185900e-01   +3.981769041505064e-01   +2.191187462683056e-01   +3.255555104602382e-01   +2.487823572961028e-01   +2.278440228109317e-01; +6.418035534886252e-01   +1.311206590457332e-01   +3.092319817799049e-01   +9.312240308131912e-01   +5.979494146767257e-01   +1.553626987185020e-01   +7.446268511097116e-04   +2.965912589811350e-01   +4.394549381980974e-01   +5.879916360855586e-01   +9.787235953376082e-01   +1.932753110557031e-01; +1.301024687626739e-01   +1.057952448105823e-01   +5.940173421981400e-01   +3.674060643694400e-01   +7.570599621775431e-01   +7.778692451809590e-01   +2.678489361224287e-01   +2.821014025944372e-01   +9.584696898498830e-02   +5.573470838863824e-01   +5.842607306269013e-01   +7.824848577201471e-01; +3.100941765276164e-01   +4.658622830082926e-01   +8.867187882448060e-01   +2.735767321109349e-01   +7.534154600821365e-02   +6.812293486347938e-01   +4.885058953526189e-01   +4.505334103282821e-01   -4.972692413642018e-03   +3.354910833349179e-01   +6.072782429683774e-01   +3.022109135014874e-01; +1.569203052847062e-01   +5.252393424743513e-01   +4.772715791891923e-01   +4.660679671445944e-01   +5.520433004690090e-01   +3.422895258838367e-01   +3.088545959133815e-01   +6.693614039652278e-01   +3.706672207236908e-02   +3.307134694398239e-01   -1.253233009610663e-01   +6.421608528616672e-01; +5.641771567052482e-01   +1.653562526296324e-01   -2.254888198304112e-01   +3.147263378091151e-01   +8.424143329783148e-01   -9.875879186896379e-02   +2.235703772426889e-01   -8.424305047401590e-02   +4.485999476854232e-01   +4.301722945461195e-01   +2.501178480646313e-01   +4.111075577157385e-01; +3.504086103397787e-01   -1.694184676285450e-01   +2.579301383739273e-01   +4.937470661926830e-01   +6.114664205179655e-02   -1.259866572753151e-02   +3.394952958088103e-01   +6.284318126088413e-01   +4.666976297825965e-01   -4.121893820256465e-04   +5.844188300548452e-01   +3.487098848354631e-01; +3.935342757709653e-01   +1.178330329597676e-01   +1.820390555818920e-01   -4.341608027256483e-02   +5.231119461739278e-01   +3.430939247430942e-01   +3.388140842973845e-01   +3.812687165019015e-01   +5.652038684672741e-01   -1.420100426938014e-01   +2.791902153686115e-01   +5.835112410209194e-01; +3.594621369288369e-01   +1.879696201931221e-02   +8.613644024019421e-02   +5.234283130066155e-01   +2.614417398385990e-01   +3.438202816008714e-01   +7.214089502402152e-01   +5.748891276158755e-02   +2.682391551792757e-01   +3.252564526184787e-01   +8.224893311845548e-01   -7.612013555367871e-02; -2.385302988281837e-01   +9.688439170413037e-02   +4.549574609356497e-01   +2.272346460979471e-01   +3.839213765165285e-01   +3.624414688242880e-01   +2.433646168172533e-02   +7.500311152677817e-01   +1.031724143096912e-01   +2.396823508181858e-01   +1.210231347863051e-01   +5.980556301853039e-01; +5.379290756283712e-01   +4.092575391867495e-01   +7.876602012758391e-01   -7.756162381969040e-02   +2.946673034804604e-01   +3.074389741303987e-01   +1.890045083030868e-01   +3.619112751819272e-01   +2.885134193388061e-01   +5.165270638707097e-01   +6.599121666020186e-01   +2.270047278949742e-01; +3.370467926414825e-01   +4.958658592985286e-01   +4.921597788972812e-01   +7.739418952809402e-02   +6.211895388052990e-02   +2.690483118706034e-01   +8.332154780535304e-01   +5.496176728030270e-01   +1.000000000000000e+00   +5.837681313691783e-01   +2.858064578249663e-01   +3.533571217871911e-01];
L2E_Input1_iAMPA_netcon = [+4.811106471639902e-01   +6.198083391684958e-01   +3.794376191578370e-01   +7.204361189747789e-01   +4.716886737758344e-01   +1.000000000000000e+00   +6.565943080188825e-01   +4.408084991494391e-01];
L2I_Input2_iAMPA_netcon = [+9.079125348791977e-01   +5.315225579778079e-01   +9.705982074128553e-01   +4.425015486163376e-01   +2.673622003347604e-01   +7.117033553455563e-01   +4.009256841241933e-01   +4.449009626793263e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
