function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.289265145097340e-02   -2.754786160780798e-01   +3.785660086333031e-01   -1.351942435003862e-01   +1.144476787858803e-01   -6.618644380495448e-03   -1.373401545838092e-01   -1.576587295281392e-01   -3.967270611498304e-01   -3.109450228649126e-02   +3.365003261148274e-01   +1.348298698875173e-01   +1.289776056780405e-01   -2.653998699991653e-01   -1.225524703676839e-01   -9.759324263446334e-02; +3.787893350524676e-01   -2.124319125076329e-01   +2.856410490669238e-01   +1.988458817411686e-01   -1.796393380838224e-01   -6.577853696132323e-02   -1.436106753422369e-01   +2.734309045781425e-02   -3.906143796105244e-01   -2.932614326161133e-03   -6.659170296697485e-02   +3.487402854241575e-02   -3.385494332423383e-02   -7.345299604507305e-04   -6.527384521436926e-02   +4.739901764908527e-01; +3.460644212717728e-01   -4.860396633922770e-01   -7.847645579296075e-02   +2.551474986862300e-01   -1.189745282100817e-01   -2.670457198260381e-02   -2.637837418266821e-01   -3.251281833412193e-01   -3.120908401258288e-01   -3.429404100921162e-01   +2.838196358335251e-01   +3.899821013983346e-02   +3.513733982413962e-01   -1.074774644926247e-01   -2.894630595512182e-01   -3.870058000396769e-02; -5.897584025307276e-02   +5.262132710077179e-02   -1.423860714014233e-01   -1.828216760071530e-01   +3.686140272659302e-01   -4.404133199372139e-01   +3.809334997233213e-01   -1.363885446967644e-01   +3.052141858369725e-01   -5.424209159395629e-02   +3.515195962852576e-01   +1.969838082141687e-01   +1.488610517749104e-01   +9.749982098463406e-02   +2.751686342505374e-01   +1.612649919368773e-01; -3.006874354126164e-02   -1.296665207361897e-01   -3.586484704921523e-01   -1.652025638874111e-01   +5.182798040181624e-03   -3.024249931728406e-01   -1.163416005505834e-01   -1.418777130105048e-01   +1.082631780839510e-01   +3.038121014497236e-01   -6.602107831664217e-02   -2.779276557359999e-02   -3.688170603788966e-01   +3.779621334944696e-01   +1.189844259620477e-01   -5.248493001407487e-02; -1.011877548865305e-01   +2.651284990371528e-01   -3.630319128044707e-01   -1.624904301086110e-01   -5.329742670737574e-02   -1.458435140895099e-01   -4.532349540492393e-01   +1.758841157097877e-01   -1.712390935059755e-02   -5.595120446784573e-01   -8.614799449684618e-02   -1.431250169434643e-01   -3.614207470846015e-02   -1.275422151535798e-01   -4.081792557691876e-01   +2.700445628375213e-01; +2.537919013598806e-01   +1.584149743076863e-01   -2.595298825254211e-02   +9.533994030483187e-02   -2.627125102309309e-01   -4.061918772287666e-01   +2.622667693588783e-01   -1.535942729435171e-01   -3.958733073439709e-01   +3.063165711293183e-02   -3.125342510989521e-01   -4.670121172028404e-01   +2.146761514724507e-01   -2.710246461136530e-01   -2.861218312563339e-01   +1.654407226706714e-01; -2.034450599686340e-01   -1.511271831732078e-01   +1.897753577319880e-01   -1.896053565512590e-02   +1.189735417128544e-01   -2.460104874332171e-01   +5.766791759925005e-01   -1.690338243714226e-01   +3.932506706206393e-01   +1.125721864813615e-01   +2.414834572231959e-01   +1.148152443417441e-01   -8.457567381915125e-03   +1.666105847763758e-01   -2.237930883716236e-01   +1.103437713867185e-01; -3.722176448240865e-01   -6.059401858645408e-02   +4.554298667665716e-01   -3.117114220915072e-01   -1.789362724702256e-01   +1.882851348292655e-01   -2.662016512115978e-01   +2.647438486218124e-01   +7.149770360445659e-02   +2.312697008145810e-01   +2.568603398340868e-02   +4.368799543579122e-02   -1.691733436790761e-02   +8.830466364206757e-02   -1.146234898196631e-02   +9.773984269965592e-02; -5.468734753520571e-02   -1.658644659239565e-01   +8.328095524125390e-02   +1.139845174165795e-01   +2.759765736663518e-01   -1.636145270436465e-01   -2.801030363492170e-02   -5.281868717140390e-01   +1.156291236457221e-01   +4.520962408865876e-02   +2.036363776993117e-01   -1.612474498865225e-01   -9.541140595221423e-02   +1.391112251518343e-01   -2.295667437073889e-02   -3.304277140764930e-01; -1.543701773670519e-01   +1.309449612686686e-01   -1.914917851419511e-02   +3.706118806112985e-01   -3.544563705115893e-01   +1.744085939978048e-01   -1.439619242064176e-01   -1.313577270442182e-01   +6.741339888570484e-03   -4.987794843879489e-01   +1.652548703407999e-01   -6.583529025767909e-02   -3.651314675559965e-01   -3.879158964966350e-01   +1.291711489524202e-01   +2.907627732117751e-02; -2.510560884177961e-01   +1.094894938259461e-01   -2.049852328669359e-01   +1.350469090438239e-01   +1.393548403651073e-01   +4.399732309470579e-01   +3.622517837716497e-01   -1.357073032862169e-02   -2.666883022805547e-02   +4.107531072891757e-01   -4.709250179759111e-01   -3.131823988640818e-01   -9.862231859017487e-02   -3.892838664449779e-02   +1.678288085672339e-02   +6.071698034591892e-03; -2.200586453580618e-02   +1.088604339768420e-01   -3.107638624502962e-01   +1.352668736671630e-01   +4.585110905896526e-02   +6.671018842297660e-02   +1.094166209281661e-01   -3.102413985772050e-02   -2.639502522631093e-01   -3.481770936746091e-01   +2.480919933053582e-01   +1.378612687788667e-01   -2.558770242566375e-01   -2.094572179987786e-02   +3.564878297468940e-01   +2.475800957698800e-01; -2.214784465347299e-01   -6.328879138775832e-02   -3.984131706173820e-01   -1.263831838534227e-02   +1.332512034760385e-01   +8.528147678842371e-03   -1.532959737856343e-01   -3.623534997313658e-01   +3.216286956317544e-01   +1.430202539433631e-02   -1.354702005222880e-02   +3.769497423713673e-01   +1.804685835162716e-01   +9.020541781405153e-02   +4.639313198045472e-02   -3.674128934483871e-01; +2.836299292057300e-01   -2.533230525958252e-01   -2.071618151412859e-01   -2.675844865840894e-02   +3.146172303843943e-01   +3.760336830687181e-01   +3.026962004185944e-01   +1.702794027877504e-02   -3.491847856688388e-01   -2.595534579249104e-01   +3.738475444031413e-01   +3.217343333525743e-01   -2.105971637276353e-01   -3.966137893018788e-01   -4.455713079247352e-01   -4.370158176775195e-01; +1.005277403512031e-01   +5.766042189673898e-02   -2.098380776571130e-01   -3.024225799714240e-01   -9.768897918287767e-02   +1.182816861213000e-01   -1.563783938898033e-01   -2.434457951952795e-01   -1.304692308355737e-01   -2.327940968049741e-01   -1.855628736254982e-01   +1.649846968506234e-01   -2.167626449509402e-01   -4.490494380187662e-01   -1.542768593737734e-01   +3.142175935421865e-01];
L1E_L1I_iGABA_netcon = [+2.220559932802724e-01   +1.906285984354578e-01   +1.775391603473285e-01   -1.624528683949201e-01   -2.635421474539911e-01   -2.951518303602146e-01   -4.342015356842595e-01   -2.217731560222417e-01   -1.577551939657132e-01   +6.412772901042987e-03   -3.923119788912906e-02   -1.706282656215860e-01   -1.404265270128416e-01   -3.112442145626779e-01   -3.293261740024950e-02   -1.214742012644579e-02; -2.828722783377451e-01   -3.121913686690611e-02   +8.001273356995831e-02   -1.510369510740044e-02   -7.929749214230199e-02   +2.706063192877075e-01   -9.934451597916122e-02   +3.592466599493038e-01   -2.686084680171811e-01   +3.432652209484528e-02   +8.596509966340571e-02   +3.501584491972095e-01   +1.755321289309067e-01   +6.069331062513811e-02   -3.913301976148256e-01   -1.295225563997516e-01; -5.029710088907117e-01   +1.671597361262649e-01   -1.526383817452173e-01   +2.888856310670204e-01   -2.258518489547606e-01   -3.544177921605993e-01   -1.056370545848747e-01   +5.692073853531234e-01   +1.998113381831187e-01   +3.485436342212904e-01   +2.049547082838548e-01   -3.117257493856946e-01   -4.379477409116415e-01   +5.734572622158356e-02   -1.120871127142736e-01   +1.002484702867396e-01; +7.766784166909163e-02   -3.012084061435532e-02   -1.049661490320126e-01   +1.466140311280473e-01   +2.276226129705452e-01   -1.441293137203505e-01   -2.363106117358540e-02   +1.073085923687161e-02   -4.854356993429348e-01   +7.601978378622823e-03   -1.726152524910224e-01   +7.747619029573433e-02   -1.527234205180491e-01   +1.383100685709295e-01   -2.927798712051190e-01   -3.456581616136984e-01; +1.066422541456199e-01   +1.678319555123767e-01   -1.813890456282176e-01   +1.792922937240684e-01   +4.326985587397883e-02   +3.764742061916822e-02   -3.346053913727236e-02   +2.777328116347372e-01   +2.950253864154144e-01   +5.641916113949478e-01   +8.570071711839308e-02   -1.717102607763798e-01   +3.792933629158396e-01   +4.589231117959361e-01   +2.606359460191541e-01   +1.252204725386721e-01; +1.963187551759982e-01   +1.110881985823686e-01   +1.649925842114879e-01   +2.232437276448075e-02   -1.740277380778574e-01   +3.236724540141888e-01   -1.206761774764449e-01   +4.026791462418197e-01   +7.154851018135082e-02   -3.257205936141007e-01   -2.952760357179297e-01   -1.552850594855330e-02   +4.526598011860980e-02   -3.085810111028418e-01   +2.144387173506951e-01   +3.835669935394335e-01; +5.383319179995399e-02   +6.240154388517663e-02   -2.110031378063632e-01   +1.839242537331062e-01   -7.932647943543567e-02   +1.303380533603465e-01   -2.964413991157561e-01   +7.726120669591580e-03   -1.278045520947798e-01   +1.189300548865768e-02   -1.136365920121917e-01   +9.084349786155932e-02   -2.443791312078732e-01   +1.011588644097604e-01   +3.427861754844137e-01   +6.848018450853480e-02; +3.637787460116549e-01   -3.357956841909152e-02   -5.811376474656711e-02   +6.650886453739574e-02   -4.819707935056718e-02   -2.362721874438834e-01   -2.136158272801494e-01   -1.857576861673387e-01   +1.424869588130636e-01   -2.008472159967319e-02   +6.325714437793140e-02   +3.433713802015098e-03   +3.023406321707682e-01   +9.383728960400584e-02   +4.923282512517380e-02   -4.249546850718481e-01; -2.558151280640806e-01   +1.876275188160319e-01   -1.046779969172011e-01   -2.151206902898645e-01   +6.290431124867979e-02   +1.393595333983805e-01   +4.613897471925502e-01   -3.088079358910053e-01   -2.555749395719071e-01   -2.370083550491947e-01   -2.197534280492566e-01   +1.370351049122883e-01   +2.553712948233257e-02   +1.926428463038257e-01   -1.688144721040071e-01   +2.713528877299473e-01; -4.168351232985393e-02   -3.544809554218402e-01   +1.346915392189863e-01   +3.694460807358634e-01   +1.342369405182137e-01   -6.915109676096018e-02   +7.399834401906977e-02   +2.399830939024609e-01   -3.937053790582931e-01   +1.246430273094864e-01   -1.145652967899340e-01   +1.886942913079827e-01   +1.239147177661312e-01   +1.365643616340267e-01   +4.405440782563762e-02   -4.966066026004873e-02; -6.658644666175252e-02   -2.537626538679857e-01   -2.454019009784074e-01   -2.657449283843095e-01   -2.337632312165417e-01   -2.455628584466132e-01   +3.151830210462229e-01   +1.935097169832465e-01   +2.594698414789116e-01   -3.278051818846152e-01   +3.963091681338790e-01   -3.822160690634274e-02   +1.189905597596567e-02   -3.655896223013561e-01   -1.291576775039487e-01   +7.701223845913076e-02; +5.494940076133774e-02   +2.643218712439331e-01   +2.250603676425316e-01   +2.445859550585310e-01   -3.113847223012110e-01   +4.057812691111848e-01   -7.634441134672051e-02   -1.776736371246655e-01   +2.452349979216341e-01   +7.501900749530407e-02   -1.374311619820693e-01   +3.660273851665879e-02   -2.088324430824810e-01   +1.591516757564853e-01   -2.431543790812461e-01   -1.021398940135841e-01; -2.991169066199791e-01   -5.113359848367066e-02   +1.979764106284129e-01   +2.205528035828845e-03   +2.367410411564715e-01   +4.196846434760828e-01   -1.631122930785932e-01   +2.504656403433317e-02   -3.607772613121134e-01   -2.948169689954850e-01   -6.220575652599090e-02   +1.093348809633643e-01   +5.266348518367857e-02   -2.530251348050040e-02   +2.338489826003817e-01   +1.540355217286941e-01; +7.373195523644291e-02   +2.736471779287254e-02   +4.173409069536822e-01   +4.722660362823822e-02   +9.977808985750722e-03   -3.479964510755237e-01   -2.352209230097921e-01   +4.628315315399935e-02   +2.323806725996091e-01   +3.365469441233348e-02   -1.611856896677066e-01   +2.299333418717019e-01   -2.954957403134859e-01   +2.027621671169931e-01   +2.015990572833199e-01   +1.354330147880980e-01; +1.241535737694973e-01   -4.861183107924279e-02   +3.638734905214610e-01   -2.677407585104659e-01   -2.937710070565899e-02   +2.201717199591335e-01   -1.166117531466757e-01   -6.441952774804229e-02   +2.304339271224494e-01   +2.152429286082674e-01   -3.083166666329143e-01   -1.305253846893079e-01   +2.513637281913707e-01   -1.285285075125527e-01   -3.332844832672799e-01   +2.294874087954415e-01; +2.801577211729829e-01   -6.330481275109387e-02   +2.974859884126868e-01   -1.346531473554346e-01   -8.714816183341947e-02   -6.762181570304659e-02   +3.743282333227252e-01   +1.401058738220105e-01   -1.715459448631820e-02   -3.420929262951879e-01   +1.907920607245643e-01   +1.725132522491378e-01   +9.996198437524226e-02   +3.943644540891130e-03   +2.406623416532279e-01   -1.755096667350627e-01];
L2I_L1I_iGABA_netcon = [+1.529606533207389e-01   +1.584445620642804e-01   -1.750367136070612e-01   +2.515231065110390e-01   -2.720513771481491e-01   -2.753266620856181e-01   +3.693274807893325e-01   +1.404519107610205e-01; -1.581111071857555e-01   -1.534599212984177e-01   +1.819513479262999e-01   -2.909972919537255e-01   -6.487447076467191e-02   +4.741873073991343e-01   +4.464855049133785e-02   -6.738589109265067e-02; +1.817619871554328e-01   -5.197116338579328e-01   -7.249934202826180e-02   +2.111292141191800e-01   +8.951623144329027e-03   +1.127155498711951e-01   -2.723922515582399e-01   +3.955617881969364e-02; -1.441800655014918e-01   +2.346205275943082e-01   -3.602678889411847e-01   +5.786814734854027e-01   +3.059885258997389e-01   -1.158596266919233e-01   +8.653184493115731e-02   -1.783144853577265e-01; -2.660282588695390e-02   +1.596570845971154e-01   -1.782470940138921e-02   +2.957828616252643e-01   -9.759918578994581e-03   +1.520074375034326e-02   -1.769108412490512e-01   +1.555405499005489e-01; +2.666633455797921e-01   -4.010095926884692e-01   +5.148378836344576e-01   +3.265999363169154e-01   +3.702071873025599e-01   -3.938882748453998e-02   -9.562151393899583e-02   -1.032075024262774e-01; +2.716064260753677e-01   +7.239111212626309e-02   -2.184195442950377e-01   -3.238914261368927e-01   +3.037076284596877e-01   +1.341413818555734e-01   +3.176387068265276e-01   -4.303012495830328e-01; +2.869657314632461e-01   +3.199235183357066e-02   -1.218126544090846e-01   -2.611140523487876e-01   +3.241431514863456e-01   -1.102861526096872e-01   -3.880394954366914e-01   -1.347607849517691e-01; +3.034070987345907e-01   -2.929791191407921e-01   +2.015880345762672e-01   +1.012564794652476e-02   -2.421302141263332e-01   +1.037476328471624e-02   +4.423546532813865e-01   -1.343930698958997e-01; -4.009026312625361e-02   +3.078282541418491e-01   +3.102242995974389e-01   -5.254699767604465e-01   -2.753001748077635e-01   +1.653598995012905e-01   +7.161810389518766e-02   +4.283965402946077e-02; -1.363230661108284e-01   -1.340125163449435e-01   +9.936431988763952e-02   +4.771094841901706e-01   -3.166290888836340e-01   -1.521024941596351e-01   +3.072686397916108e-01   +1.971167943624559e-01; +1.457556761377449e-01   -2.858921545479631e-01   -1.340177901764250e-01   -2.174608357482855e-02   +3.733205627550992e-01   +1.769063259706186e-01   -2.441560218906169e-01   +4.741275833197717e-02; -1.957103984421497e-01   -1.268134654312548e-01   -1.886436948284521e-02   -5.615256375300327e-02   -1.472376680210207e-01   +3.466966532683818e-01   -1.733769405122713e-01   -1.143019929405372e-01; +4.608425442597944e-01   -7.054735179962116e-02   +2.906577783509159e-01   +1.977693465682020e-01   -9.590645292791927e-02   +4.474633434001992e-01   +2.061540310982521e-02   +3.478667113171681e-01; +1.876905849610900e-01   -2.847505548389098e-02   -2.382793868753446e-01   +1.438650386235446e-01   -7.575109512217897e-02   +3.162192611631329e-02   -3.233597022311023e-01   -2.558154603078033e-01; +5.747779144109341e-02   -1.722116305374738e-01   +5.271354768857629e-03   -3.583853336149512e-01   -8.018510540115986e-03   -4.384348090789819e-01   -2.333105007876900e-01   -2.083094856535292e-02];
L1I_L2I_iGABA_netcon = [-1.390420734767161e-01   -2.696353367122899e-01   +1.814034928118308e-02   +4.200695397288853e-01   -4.075066272120502e-01   -1.222255151159323e-01   +1.700242330342002e-01   -2.951774229724866e-02   +2.818218956478730e-01   +3.565166309880814e-01   +4.453556667558426e-01   +1.583006076079703e-01   -1.689932424936451e-01   +2.523194984253069e-02   +2.271198363808879e-01   -2.601659060057953e-01; -3.362756804095133e-01   -4.100464108738595e-01   -2.271674428657578e-01   -3.204157024331714e-01   -3.566941324778412e-01   -2.979902803664470e-01   +1.660661965235062e-01   +5.974711497764738e-02   +1.257147948017505e-01   +2.161272955103916e-01   -2.398174739902372e-01   +1.373925345852517e-01   -3.671236934467180e-02   -4.662003918397279e-01   -1.714299677649406e-02   +7.452914359810098e-02; +2.878411570088434e-01   -3.104905302801582e-01   -1.204405690205183e-01   +4.442863312879408e-03   +2.392857630773550e-01   +3.103961367654537e-01   -7.831615772760354e-02   -6.629115791164064e-02   +1.520707902882777e-01   +4.412277487227104e-02   +3.583324320310948e-01   -9.058201341466551e-02   -3.061416609832744e-01   +4.097709355041134e-01   -4.088698466405895e-01   -5.847976252535581e-03; -2.961120393985991e-01   +2.075366454268520e-01   +2.187261999126085e-01   -2.153286076827301e-01   +2.241101505543550e-01   -1.322312277468750e-01   -1.631029578851380e-01   -4.104194579169704e-01   +1.915826204774237e-01   +1.843756595581168e-01   -1.634445108218655e-01   +2.082026980287648e-01   -2.917262676214248e-01   -4.158205830321512e-02   +1.102466475890023e-02   -5.317574054613849e-01; +1.377029970295880e-02   -1.132379802419525e-01   +4.060887767154190e-01   -3.584917591868028e-01   -1.945848285808821e-02   +1.681500462522726e-01   -1.683594479039283e-01   +3.105159594898668e-01   -1.578467345500262e-01   +1.035730419755403e-01   +1.159155256569688e-01   +3.028973195804934e-01   +6.227460400852300e-02   -8.131106978085056e-02   +1.112433616995095e-01   -1.949447507193026e-01; -2.308597541363802e-01   +1.963205133964858e-01   -4.021861298023638e-01   +1.237187839442674e-01   -1.261507574545188e-01   -2.502978902902623e-01   -3.868991214942977e-02   +5.882482926005878e-03   -2.439146225636708e-01   -1.082244237198493e-02   +6.311674405853006e-02   +4.426952694785241e-03   +2.008442050584531e-01   +1.724181719817509e-01   -1.230218526299566e-01   -1.084321002987347e-01; -1.858592263071887e-01   +3.718178345679152e-01   -1.590204648651675e-01   +3.853304953529300e-01   +1.493949799653431e-01   +2.199590612024222e-02   +1.556238350955350e-01   +1.391667620387814e-01   +1.480730241733840e-01   -2.977352252813208e-01   +1.144745276691293e-01   +8.777221459408396e-02   +1.837274323015903e-02   +3.091960072347255e-01   +2.119537124909666e-01   +1.941621924846984e-01; +3.827934337713174e-02   -2.843656947800162e-01   +1.592375918677990e-01   +2.761120276242341e-01   +1.866751459446858e-01   +4.204245925390842e-01   +3.486592017304552e-01   -1.055322288512671e-01   -6.204507382099532e-02   +2.641872164219596e-01   +1.962185124600553e-01   -1.001836047389454e-01   -8.133064395839493e-02   -2.216201050410160e-01   -6.713904902001053e-02   -1.411239166771353e-01];
L2E_L1E_iAMPA_netcon = [+2.555748142375549e-01   -4.958873443745954e-01   +8.254964494884384e-02   +2.602601127679433e-01   +1.294773280517692e-01   +7.443373762033698e-02   +2.483114452386929e-01   +9.484607207780171e-02; -1.563357687886962e-01   +1.364371187601632e-01   +3.965504207561890e-01   -9.273837688322709e-02   +7.889633013458963e-04   +1.316052898266953e-01   -2.078236291101478e-02   -3.802786307491703e-01; -1.745864812296994e-01   -1.720643967590668e-01   +2.746295161938521e-01   -5.655045822055826e-02   -2.941703625981128e-02   +8.971061899975423e-03   +1.369815976804672e-01   +6.842364952525214e-02; -1.363185411668046e-01   +8.361708473254369e-02   +4.877730933248376e-02   -1.869762036265241e-02   +1.586957107815326e-01   +7.133934873558134e-02   +8.153281488465203e-02   -1.208428185103700e-01; +6.204744873205373e-02   +3.105133985902871e-01   -3.940017876134394e-01   +4.074461670154677e-01   +3.345603893186715e-01   -1.337695677833523e-01   -7.873212584462025e-02   +2.529195852757416e-02; -1.750056865362046e-01   +1.295469676448447e-01   -2.170796754765752e-01   -4.226444900510147e-01   -2.492098615345282e-01   +1.667077425540018e-01   -2.291739152490104e-01   +1.147069366979679e-01; +7.556923270398586e-02   +3.161297529503907e-01   -1.540733935694656e-01   +9.429506323405000e-02   -3.607542098674654e-02   +6.381368410748131e-02   -3.273292160876782e-01   +1.030328697364549e-02; -4.205647352082789e-02   +4.567677024402297e-01   +2.933727595672281e-01   -6.309640356968710e-02   +1.335214004200269e-01   -1.921487739563619e-01   +4.866600519651776e-01   +2.577423086602659e-02; -2.478858749183866e-01   -2.288673829973259e-02   +1.593289243729765e-01   -3.343661906504750e-01   +3.020590276599773e-01   +4.769090719063207e-01   -2.597819339020586e-01   -2.626058123410560e-01; -4.024000097221799e-01   -6.037136944546548e-02   +7.444386424651275e-02   -2.203093506728668e-02   +3.944905894855781e-01   +2.675716427217011e-01   +4.434665477964235e-01   +2.075002337808590e-02; +3.069697717494891e-01   +3.106948293016816e-01   -3.403743142615315e-01   +4.781305764284437e-01   +8.541555458522174e-02   +3.785203955708111e-01   -3.613413511480269e-02   +3.049444211465159e-01; +2.056668376939676e-02   +1.707671774248572e-01   +3.112169380111212e-01   -3.347858632983938e-01   +3.577136974368303e-03   -1.454916534301430e-01   -7.181967143951944e-02   -3.425248798915360e-01; +3.407939439579382e-01   -1.222124124236755e-01   +3.653044514330447e-01   -2.348227087062899e-01   +9.479905183532730e-02   -3.687314886242951e-03   -7.081773674951772e-02   +1.794960594818629e-01; -3.517285636139858e-02   +5.406367657261389e-02   -2.137463169340895e-02   -2.463132607778604e-01   +1.719305702476661e-01   +2.780319441450088e-01   -2.394754410978354e-01   -1.867692409409052e-02; +1.516122670686096e-01   -3.877901665176313e-01   -3.772162316030772e-01   -3.303236636003226e-01   +2.299430782263228e-01   -2.839372435307990e-01   +5.524098611126388e-02   -2.244909074356284e-01; -4.284236760772112e-01   -1.831524130806499e-01   +5.475308703996210e-02   +1.933281460886443e-01   +1.454023541832636e-01   +3.447441432495696e-01   +2.876022463917645e-01   +1.253829592765368e-01];
L1E_L2E_iAMPA_netcon = [+4.820774190680251e-02   -1.889712077911572e-01   +1.108677814725942e-03   +2.443032799640081e-01   +4.830935775396433e-01   -2.682357915061960e-01   -1.847588364104783e-01   -3.744281113300040e-01   +1.894399923439896e-01   +2.836541393307921e-01   +2.212637803375782e-01   -9.434649788768035e-02   +4.758391638624584e-02   +3.198896962223449e-01   -1.258904470327289e-01   +6.984409952982368e-02; -3.399573489638924e-01   +7.882253246127791e-02   -1.157362162641564e-01   +1.376774965094973e-02   +1.324451614151335e-01   +5.212843227613154e-02   -2.810049779475809e-01   +2.487562774487007e-02   +2.361740233326572e-01   -3.266788932539983e-01   -1.832613660435799e-01   +7.701850207377020e-02   +4.067606601210023e-01   +2.359919264200925e-01   +1.250625582394753e-01   -2.157030647138112e-01; +3.253616322846550e-01   -4.071725453549396e-02   +2.538719658499000e-01   -1.647246919765291e-02   -5.131693399570205e-01   -5.276830144035759e-02   -2.115150554170223e-01   -5.654799526966410e-02   -3.865038947772603e-02   +1.682512413890310e-01   +3.747585086423033e-02   +1.133782994373961e-01   +2.089755829284126e-02   +7.014463658786803e-02   -2.593841882707102e-01   -4.893330932260116e-02; +3.161971827387088e-02   +2.751774273937599e-01   +3.977970739443087e-02   -2.700460758869367e-01   -1.147790547639577e-02   +1.289694695793112e-01   +8.559573347155081e-02   -2.312979256958738e-01   +4.192866327836767e-01   +3.000972853215580e-01   +2.831512760540201e-01   -4.985780672775909e-02   +8.506146367210392e-02   -1.848959262637559e-01   +1.264976723116965e-01   -6.385202041313362e-03; +1.550916776145448e-01   +2.311939020322914e-01   -2.852398911031531e-01   -1.464674377936727e-01   -2.726023294142561e-01   +2.928664834250150e-01   +3.532148173193431e-02   -1.026905088684284e-01   -3.343377107528850e-01   -2.938414106748301e-02   +2.362238195018814e-01   +3.203481836572223e-01   +1.692737351557482e-01   +3.104034160134522e-02   +2.558176878891350e-01   +2.056811186613893e-01; +5.487818061885076e-02   -3.365095412939574e-01   -1.008939388449415e-01   +8.362552454758256e-02   -1.277506882661799e-01   -1.185283677971766e-01   +3.175829548334030e-01   -1.331167261373159e-01   -2.878839759175972e-01   -3.570890683793095e-01   -2.751671682398238e-01   +2.539861947280930e-01   -5.121499538733042e-02   -4.823123615730717e-01   +1.603890669808847e-01   +5.730227797746052e-02; -7.867407801276344e-02   -2.140379299846290e-02   +4.148525533684174e-01   -3.220192833822767e-01   +1.828526780628596e-01   -1.139533411846444e-01   +1.051776055682966e-01   -4.133423407763694e-02   +3.585725153095398e-01   -3.102448258776115e-01   -2.771147064702681e-01   +1.424675035331243e-01   +1.310051399878060e-01   +3.537610408419883e-01   -3.350611410477869e-01   +1.779103346189183e-01; +2.408901896210403e-03   -1.363699681329756e-01   +1.497659033335346e-01   -1.775369157123994e-01   -1.397241118690669e-01   -1.726543913577162e-01   +1.265125134272601e-01   -3.475480656903371e-02   +8.695863232493285e-02   +3.328692069478219e-02   +1.232954543079277e-01   -1.197116204365484e-01   +6.567921938551749e-02   +3.710827746130389e-02   +3.743993386203984e-02   +3.421394292171547e-01];
L2I_L2E_iAMPA_netcon = [+3.965789632440527e-01   -7.653501368825638e-02   -3.777407309242503e-03   +1.124684602553088e-01   +9.112933420000302e-03   -5.341436729534538e-02   +3.397118654827982e-01   +2.706759908818467e-01; -2.865047705674225e-02   +4.974566949278136e-02   -3.944957247709901e-01   -1.035162637383709e-01   -6.509382809519723e-02   +1.362856602909689e-01   -3.102130819698578e-01   -4.261869653596257e-01; -2.291275090145663e-01   +1.571950381490607e-01   +1.856762257204548e-01   -5.669474084217370e-03   -3.323223162142807e-01   +1.176614059014714e-01   +1.068508201366655e-02   -3.255287589286099e-01; +1.952959745947729e-01   -5.241528909297927e-01   -2.731323558375549e-01   -1.541686920629385e-01   -6.192483963546300e-02   +1.478098898039663e-01   +1.831635068972151e-01   -6.724282511332243e-02; -7.274030583356945e-02   -1.626534329430392e-01   -8.836971916416889e-02   +1.027653862926060e-01   +4.257322893267396e-02   -1.034650128056641e-01   +2.402301301487509e-01   +1.600367648558557e-01; +3.060488924402593e-02   +2.696083302978664e-01   -9.233485589244889e-03   +2.473725897614240e-01   +2.722716850968006e-01   -3.155195988669638e-01   -6.710354922459751e-02   -1.047581497915867e-01; -3.129592220533091e-01   -2.904948474484624e-01   +2.074230258232118e-01   +2.102172186240606e-01   +1.010352092269108e-02   +2.301787473362880e-03   +8.667919367239293e-02   -1.464565242499065e-01; -9.935603733261920e-02   +2.430671712716648e-01   -1.941462901872954e-01   -1.274932030107613e-01   +2.404377999988685e-01   -2.534741299460931e-01   -2.175987279323258e-01   +3.721740257909104e-01];
L2E_L2I_iGABA_netcon = [-8.471909837936918e-02   -3.833857682912209e-02   +1.781042165557964e-01   -3.414234452663472e-01   +2.082910327402459e-01   -2.571655682182902e-02   -1.861112892212302e-01   -2.612093114416663e-01; -4.685710559085307e-02   -3.392841442967896e-01   +7.986232760485176e-02   +1.141666659643289e-01   -7.960930956488269e-02   -4.383345147391541e-01   -3.700624635186783e-02   +4.579659284851810e-01; -1.845751281273822e-01   -8.782344169924822e-03   +7.862837592603002e-02   +1.279621441286090e-01   +1.696132816729940e-01   -1.417331823337064e-01   -2.225821319911059e-03   -3.137895871854818e-01; +1.984718658894262e-01   +2.941218691019543e-01   +2.008810459396803e-01   -1.115625465546313e-01   +2.687281997856603e-01   -3.931667231662965e-01   +2.750048900576075e-01   -7.171487749805593e-02; -5.030138819242962e-02   -4.504041442788443e-01   -1.474153013211362e-01   +3.823563238439223e-02   +5.607822427119993e-01   +2.029464105614180e-01   +2.805511849383385e-01   +6.760370240529220e-02; -4.713989562732461e-01   +1.879515009177516e-01   -1.288457948950919e-01   +3.345333444936668e-02   -3.707237910143949e-01   -1.016750567202095e-01   -9.837346409476921e-02   +2.370261838559220e-01; +3.289077405259123e-02   -1.584493763878565e-01   -3.077013855580919e-01   -3.521960492600151e-02   +2.756270677703196e-01   -6.737383048619940e-02   +1.043173280715112e-01   +6.534106921499531e-02; -2.133088387093740e-01   +3.600354613236652e-01   -3.230111422049811e-02   -7.972815512504405e-02   +2.263778349390114e-02   -5.053002984198389e-01   -1.919304347096368e-01   -2.097005007050022e-01];
L3E_L2E_iAMPA_netcon = [-2.274061265976521e-01   -2.712287144389689e-01   +9.877978183033036e-02   -3.612562717946317e-01   -1.206739520272948e-03   +4.552909033452190e-01   -3.961167109370717e-02   -1.692504141547582e-01   -1.760479898018103e-01   -7.421677450697749e-02   +3.079432046660241e-01   +2.358941243072171e-01; +2.451887212164883e-03   +4.562165115155588e-01   +1.283313328726086e-01   -4.424156015601866e-02   -5.178542197602380e-01   +3.006198193329894e-01   -2.337383829182343e-01   -3.745709841314001e-01   -6.593296172053291e-02   -4.905148144069159e-02   +1.451964652045266e-01   +1.242826380888825e-01; +1.804455962819203e-01   -4.998602616576639e-02   +2.866625790472740e-02   -9.940852361011626e-02   +1.743988007572768e-01   +6.701906687320441e-02   +2.995310858502371e-01   +1.881806468966825e-01   -1.094488439228090e-01   -1.776250110247294e-01   -2.418603543675897e-01   -3.686649070855148e-01; +2.114565020235468e-01   -3.508176487121297e-02   +1.552631588284180e-01   -6.676547163200885e-02   +1.273815238607361e-01   +4.781939203079920e-01   -3.783669476691814e-01   +4.190551022108138e-01   +3.884700675663184e-02   -1.678987807412478e-01   +3.628635310824184e-01   +2.706197197592858e-01; +2.520866530499960e-01   +3.673669680929731e-01   +1.442775049739584e-01   -3.802582614015804e-02   +2.732881587142288e-01   +3.552088274017896e-02   -4.218925309337435e-01   -4.043172416271217e-01   +1.783433232740944e-02   -2.386509045045216e-01   -2.571055793769693e-01   +1.641593849700674e-01; -2.906085286812758e-01   +2.792194663603689e-01   +5.652937301763138e-02   +4.578210256493350e-01   +1.826741311712007e-01   +4.220010828471551e-01   -3.051036822356562e-02   -1.513944311318083e-01   -3.665108797201234e-01   -7.585861440568123e-02   +1.859055057170488e-01   -1.180812696109476e-01; +1.352546326387407e-01   +1.997324732656916e-01   +2.535039284135082e-01   +2.615455276535535e-01   -6.955942756204331e-02   -4.726590263120029e-03   -9.399242601204930e-02   -2.802998331804363e-01   +4.002364953840895e-01   -1.654870136421573e-01   +1.008247809821147e-01   -8.812488269806434e-02; -4.695541515518009e-01   -2.245879738814506e-01   +9.239747325061257e-02   -6.977540149011943e-02   +1.357555568765282e-01   +2.392477240641145e-01   -1.445009384387403e-01   +1.847604308863966e-01   +3.055192617857613e-01   -2.459843629537640e-01   +3.736841407914557e-01   -3.605288098459477e-01];
L3I_L2I_iGABA_netcon = [+4.263893480359188e-01   +1.708127058101070e-01   -2.607635483040942e-01   +5.672486299050270e-02   -2.144694237973890e-01   -5.120123388348863e-01   +4.303789857767632e-02   -3.650726728146753e-02   -3.226000788801082e-02   +2.599482537658749e-01   +2.218665972784792e-01   +2.462671463722760e-01; +2.626436625729360e-01   -3.849432019769190e-01   -1.620412108466084e-01   +3.108064001515936e-01   +6.097005553565876e-02   +6.447323791973814e-02   +2.830857437103673e-01   -2.148568671963356e-01   +1.417804473750713e-01   -4.846848676356447e-02   -2.863146304543307e-02   +1.465347562162234e-01; -1.862786198258001e-01   +1.064796503888641e-01   -2.269329720749343e-01   +3.667455273323489e-03   -4.275054220282407e-02   +3.205307004709812e-02   +1.599722298945344e-01   -4.062455804180388e-01   -9.476503313930246e-02   -2.800930758315253e-01   +2.909981024514218e-01   +2.609857042705794e-01; +1.233375002029179e-01   +5.423712280506765e-02   -8.938471164050327e-02   -1.347824920052220e-01   +1.566592605760750e-02   +1.208455308852879e-02   +3.334429637859021e-01   +3.133588998495218e-01   +3.399491676468769e-01   -5.522384546437886e-03   +3.627152808162597e-02   +1.954156073246703e-01; +1.904341688607443e-01   -2.319747290296156e-01   -5.439261592687105e-02   +1.129221881825187e-01   +1.910899668152050e-01   +3.217569083638241e-01   -5.175081946300202e-01   +8.205409643119287e-02   -3.544739315548866e-01   +2.889500263090248e-01   +3.893128269008539e-01   +4.444648699445383e-01; -3.612458966307200e-01   +2.243041561983138e-01   -1.459261533585238e-01   +5.947602400370211e-01   -4.558675977942758e-01   +6.204432293956980e-02   -3.702404590763331e-01   -1.007558826508375e-01   -2.244977908262972e-01   -6.136979275558013e-02   -2.724006281000464e-01   +3.893938486670190e-01; +2.922828722195704e-01   -2.383381669256829e-01   -2.286208873123938e-02   -3.178464773621842e-02   -3.048549579040469e-01   +2.334300611829994e-01   -2.599031087047157e-01   -2.642264125940018e-01   -5.972362919778852e-02   -4.010433455829009e-01   +2.163898722758720e-02   -9.955903198019533e-04; -2.113514851647971e-01   +8.990219931765406e-02   -1.719561558001168e-02   +5.597247728274996e-02   +4.221406532979746e-01   +3.690412724581492e-01   -9.613874519531536e-02   +2.973918150844860e-01   -3.016382694964500e-01   -2.592160523764370e-01   +2.251810102473287e-01   -2.372793145360124e-01];
L2E_L3E_iAMPA_netcon = [-5.510838318275826e-02   +4.208919691725925e-01   +1.287230953497236e-01   +3.910491144689427e-01   -1.252025202364090e-01   +2.085558644125960e-01   +4.399983417207581e-01   -4.227863937807823e-01; +1.660032631921200e-01   +8.684532007395987e-02   -3.151063203668635e-01   +2.294675229398373e-01   -1.741085786794774e-01   +3.488680297163321e-01   -4.270760512042820e-01   +2.996599039412043e-01; -3.579602662875264e-02   +1.736554983823170e-01   -7.070536035090567e-02   +3.870962140616068e-01   +1.167482830995382e-01   +3.733684380231944e-02   -1.843952968533237e-01   +2.773442154441169e-01; +2.036651768446394e-01   +2.149788161138521e-01   -2.553826828357710e-01   -2.275654011822059e-01   -4.633516181636863e-02   +6.268335394984439e-02   -1.573656432481570e-01   -5.204397168977842e-02; +1.160253150036278e-01   -2.571631242874031e-01   +2.771635880740543e-01   -7.111869065493853e-03   +6.463306711522009e-02   +2.798242619684138e-01   +2.634352903435097e-01   -3.672971084629983e-02; -2.045045196120288e-01   +4.871905137302290e-03   -3.635099487600518e-03   -1.409458293919716e-01   +8.164699059560578e-02   -1.159786212632477e-01   -2.459195279076805e-01   +2.602035036267297e-01; +2.237468257464128e-02   -2.029886779744310e-01   +9.451499984502174e-02   +2.100784131086429e-01   -2.255939511127743e-01   +8.586676680608205e-02   -3.215407825201155e-01   +1.160108563102068e-01; -2.016473047734274e-01   +2.532582968715026e-01   -3.543641429634151e-01   +1.580500092807257e-01   -4.089544181791172e-02   -1.243087490424713e-01   -5.502446383986093e-02   -1.152915128292684e-01; +1.590576719565344e-01   +9.559594120916372e-02   -3.213615623072030e-01   +6.366784327409326e-01   +1.625678018256371e-01   +1.798141469852451e-01   -9.454641903891986e-02   -1.489556960357744e-01; -4.763145897796353e-01   +2.337195464727060e-01   -2.419016557984980e-02   -5.783682824331135e-02   -3.912821283239677e-02   -1.269399400669103e-01   -4.184572589862130e-02   -1.745202394729687e-01; +2.106337960012371e-01   -8.536705193545312e-02   +2.700913705353572e-01   +1.975619430050771e-01   -4.717496246243597e-03   -3.065252287763370e-02   +1.086673316115646e-01   +2.552923068328188e-01; +1.881453786659882e-01   +1.045362432354004e-01   -2.458883898016841e-01   +3.293244520077446e-01   -1.820043684275239e-01   -8.720898484410416e-02   +1.474335506521608e-01   -1.460172066097285e-01];
L2I_L3I_iGABA_netcon = [+8.644168414586076e-02   +2.568037693470802e-01   -9.464156649751986e-02   -4.274683058347467e-03   -7.708564547307560e-02   -2.121548865245410e-01   +1.241028639535855e-01   -1.730761624942592e-01; +2.524184894420547e-01   -1.210136921693228e-01   -3.956209528941022e-01   +3.661178073691210e-02   -2.225359867121383e-01   +2.194294193543488e-01   +2.608834584884611e-01   -2.373579558968134e-01; -1.133309600480667e-01   -4.983064971711221e-01   +1.301452506281403e-01   -3.635842998178912e-01   +6.329129078234448e-01   -1.822051848057050e-01   -5.935072341260585e-01   +2.060043640469966e-01; +2.100907483481864e-01   +7.969162931808876e-02   +7.231099888391604e-02   +6.086585964295254e-02   -1.845322148986703e-01   -1.876851247313220e-01   +3.176989882878788e-01   +1.500970402425975e-01; -3.452200521358340e-01   -3.445327196767550e-01   -2.711910404415634e-01   -1.145282746277971e-01   -2.969139514532690e-01   +4.492647628545630e-02   -6.220097783933293e-02   +2.823964625988260e-01; +3.449068158747328e-01   +3.788842798835473e-01   -1.598385341031814e-01   +2.979633608547033e-01   -2.732894561236358e-01   +6.977257211334789e-02   -2.644255980837397e-01   +2.683011741512186e-01; +1.620783036857359e-01   -2.826092703495600e-01   -2.727387002975634e-02   +2.703998504693859e-01   +2.982148675864583e-01   -5.508501898346752e-02   -3.509164296693253e-01   +9.215832759469494e-02; -1.100247200178562e-01   +5.170698882528835e-01   -5.809593891848989e-03   +2.513152721479198e-01   -3.295878563526256e-02   +1.538132814264854e-01   -1.902730157632489e-01   +4.638872832402552e-03; +5.860375830986219e-02   -1.626580282933860e-01   -2.692813669187336e-01   -4.306307526273881e-02   +3.421932818735556e-01   +8.955667809198714e-02   +1.927619711276659e-01   -1.993022473103351e-01; +3.304394547147507e-02   -2.585053732914667e-01   +2.663345489089038e-01   -4.422604185028808e-02   +6.615099178172101e-02   +2.599136577269852e-01   +9.735874308674276e-02   +2.274153622522342e-01; -3.080705064650671e-01   +2.961279779804827e-01   -4.231641555351140e-02   +3.229724355984804e-02   -4.601266784631790e-01   -1.815874316478966e-01   -4.532427577106504e-01   -9.092575698205943e-02; -2.178241394243495e-01   -1.871150626420552e-01   +6.063686722279409e-03   -2.433073848060367e-01   +3.669706933596538e-01   -1.043941580561484e-01   -1.003084138410168e-01   +1.012809421495925e-01];
L3I_L3E_iAMPA_netcon = [+6.648119106396935e-02   -1.660719460718590e-01   +3.095649305985514e-01   +1.499904166527280e-01   -9.245335319117887e-02   +2.961665767461955e-01   -2.173026335252876e-01   -3.426737444189431e-02   -5.509703630221600e-02   +1.416752258843315e-01   -4.429666329985956e-01   -2.030967734123435e-01; +1.007815379827429e-01   -5.111000112657452e-02   +2.668852216178752e-01   +2.487676232946409e-02   -1.173257082619247e-01   -2.864694097023552e-01   +5.034389840793684e-01   +5.369805101458658e-02   +4.257827192922395e-01   +1.258015198255113e-01   -3.337286028326840e-01   -3.750636641025198e-01; +1.791615667552075e-01   -2.608206778993996e-01   -3.499001369175692e-02   +3.977188656324624e-01   +2.100664986047901e-02   -4.104682596284465e-03   -1.030766254770067e-02   -3.688864285439851e-01   -7.693227670130602e-02   -2.273325129785150e-02   +2.615771577442692e-01   +4.423297283843803e-01; +2.294029208865845e-01   -8.061138046279209e-02   +3.609322953169568e-01   +1.438431831368380e-01   -8.589494978930383e-02   -3.315344413871877e-01   +3.008216037221931e-02   +2.765881041996648e-01   -2.094999856815658e-02   -1.156604099677427e-01   -1.214127384932385e-01   -2.586133417738166e-02; -4.378990678198303e-01   +1.363505766230061e-01   -3.251716631415951e-01   -3.067571914421806e-01   +1.853052469246572e-01   -1.095653427022440e-01   -1.771682454267858e-01   -4.388406484931776e-02   +1.784506405185210e-01   +1.789676774312024e-01   -2.970515807202002e-01   +1.873700409076668e-01; +7.419350940835422e-03   +1.186754066667939e-01   -2.285909019825942e-01   -1.037564604376335e-01   -1.911054004945101e-02   -2.342137396766649e-01   -1.749147138808941e-01   +3.592080954680367e-01   -2.693931619353266e-01   +1.237146177405828e-02   +1.132623917751924e-01   -1.305906508593738e-01; +9.894083856116115e-02   -6.539750594222571e-02   -2.581914498035760e-02   -3.172808210842749e-02   +5.964092477368698e-01   +1.514357737408545e-01   +1.889395247583291e-01   +1.112014921326946e-01   -6.616326904444281e-02   -2.211131955511831e-01   -8.754751411561471e-02   -1.061809306156142e-02; -4.800648202188669e-01   +1.301964917529992e-01   +6.407650885297364e-02   +4.208824850202091e-01   +1.216526828084614e-01   -7.983638886330828e-02   +2.739116065094051e-02   -1.854055997261410e-01   -2.823372059256590e-03   +8.054252171757029e-02   +1.141614011012066e-01   -3.015187990001533e-03; -2.229533057007883e-01   +4.219414978794257e-01   +1.668523961517532e-02   +1.000139269657546e-01   +1.426477178408457e-01   +2.291658490189421e-01   -5.421785705369044e-02   +1.029310229682769e-01   -1.702837104159776e-01   +1.580947136654349e-01   +3.463255735416609e-01   -2.480429119507684e-01; +1.358305368230333e-01   +3.451915747563694e-01   +1.453659800332284e-01   -3.284335135531757e-01   -1.871487344633521e-01   +1.373453507305080e-01   +1.079922913956905e-01   -7.785680553900162e-02   +4.370619317413680e-01   -3.464239413331270e-01   +4.128055946664680e-02   -3.747979338485247e-01; -2.306848149461297e-01   -1.709477895919317e-02   -9.571471108421492e-03   -2.356154318892684e-02   +1.508360830850398e-01   +3.476242987186322e-01   -2.543930878661623e-01   +2.417320651081286e-01   -1.374974030830671e-01   -9.284018461918836e-02   -1.351779774254095e-01   +7.808249114947630e-02; +3.760980821366186e-01   -1.525286971237718e-01   -1.594108915486911e-01   -4.282006525453417e-01   +1.364142569085306e-01   -2.393478906399684e-01   -1.893071652588716e-01   +1.567356616108233e-01   +2.461631605723169e-01   -1.449744526056132e-01   -2.841506136746709e-01   -4.162750258926439e-01];
L3E_L3I_iGABA_netcon = [-1.970924091772304e-01   +4.312192476333380e-01   -3.110414917040659e-01   -2.995205595999541e-01   -6.250828615543527e-02   +1.467435935195781e-02   +1.027557715979279e-01   +1.549155926623194e-01   +1.610844336390310e-01   -2.138214935309278e-01   +2.290900381047452e-01   -9.594309339755261e-02; +1.114089001445521e-01   +4.938383866829466e-02   -2.691551036632289e-02   +8.899661466886966e-02   +1.613120173819277e-02   +1.017668357959765e-01   -1.482613279088782e-01   -2.362507188965569e-01   +2.308326386601505e-01   -3.581260626439898e-01   +3.942659856077548e-01   -1.423147651500898e-01; -1.368681374195853e-01   -5.534228362363781e-02   +3.838600646078139e-01   -5.164623121449680e-02   -1.333482242841773e-01   +1.612871064932108e-02   +2.355419755104479e-02   +2.990224933073832e-02   +2.839219333035922e-01   +2.653427090402756e-01   +2.374060273805728e-01   +5.986272116756847e-02; +5.924359938165558e-02   -3.821150322999232e-02   -1.700601256501842e-01   -1.625383359787040e-01   -1.644194968539768e-01   +2.114529412920543e-01   -2.545031965427822e-01   +2.303429941686451e-02   -3.516697977462437e-01   +3.276821682735543e-01   +9.517238904929184e-02   +1.350914633034792e-01; +1.313319074982267e-01   -8.288062207189843e-02   -2.598078777907952e-01   -2.779833935024026e-02   -6.677736439550763e-02   +8.718216038197474e-03   -3.439492956875320e-01   -1.411755599646029e-01   -1.677882555512559e-01   -6.696981215749948e-02   -2.287664713116515e-01   -1.487104639864320e-01; -1.181730276637260e-01   +1.177626749856470e-01   -2.049308008190387e-01   -2.073223278694141e-01   +2.005514137418208e-01   +1.542915401169522e-01   +1.542102887526173e-01   -1.826903776762367e-03   +8.472061966426250e-02   -6.612108140847078e-02   +1.488777012154672e-01   -1.787588173906451e-01; -1.435527605391451e-02   -4.068335977035023e-02   +1.149015053085744e-01   +3.935183189522379e-03   -2.190833215656280e-01   -3.649434709466977e-01   -1.744355595409535e-01   -9.699519040303539e-02   -2.031336210071620e-01   +2.299419987121311e-01   +8.202991791032786e-02   +1.152974985747889e-01; -1.701671958104907e-01   -5.204424046617290e-01   +6.599893423509279e-02   +5.479729753854499e-02   -2.683134248424260e-01   +1.129822515296293e-01   -2.485018911773335e-02   +3.277827582439862e-01   -3.312673300758625e-01   +3.045200831528801e-01   +1.225280109212853e-01   +1.309465782478257e-01; +1.889667560495623e-01   +2.269546391730656e-01   +4.010756039447044e-01   -1.803960189727874e-01   -3.833688061640920e-01   -2.734797216533271e-01   -3.652434188995493e-01   +1.336235289480351e-01   -5.316651422117236e-01   +3.445090138201510e-01   +8.987352522462785e-02   -2.027434985747943e-01; -3.493456661822353e-01   +1.221751147412409e-02   -3.491703285936563e-02   -1.473916220291284e-01   -1.050219982917139e-01   +1.417597815513948e-01   -4.943677677869305e-01   -2.273047777600965e-01   -5.550302658872677e-01   +1.119145568166342e-01   +2.306890130384643e-01   +4.348823600059842e-01; +4.519166647108011e-01   +2.433128512062600e-02   -1.855539790950028e-01   -2.713726199014355e-01   -3.981693074242459e-02   -6.163140235440591e-03   -9.456755605676291e-02   -5.834780182840130e-02   -3.452885815332176e-01   -1.299321381239734e-01   +4.841932735373589e-03   -2.364224776127239e-01; +1.856860951737106e-01   -1.464687066722221e-01   +6.900041957018666e-02   +8.950575386182341e-02   +4.779316685020517e-01   -3.331176592805191e-01   -8.736769548357649e-02   +1.625006431596522e-01   +3.615399048735048e-01   +1.737443661387532e-01   -3.343751316363003e-02   -2.619386318803973e-02];
L2E_Input1_iAMPA_netcon = [-1.957485500508157e-01   +4.057937401217657e-01   +1.052005648950773e-01   +8.183529113094951e-02   +1.535210075702544e-01   +4.432528202550070e-01   +4.041953415438893e-03   +2.187505627837130e-01];
L2I_Input2_iAMPA_netcon = [+3.950440163101371e-01   -2.488819534136075e-01   -2.646866979397642e-01   -1.917066292239062e-01   +2.637279137158544e-01   +5.428807407901833e-02   -6.354964398306731e-02   -8.398950179386393e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
