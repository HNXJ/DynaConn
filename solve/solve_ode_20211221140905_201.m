function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.586212380944791e-01   -3.245455077315926e-01   +2.230456439275103e-02   -6.635127189476893e-02   +1.664385164178058e-01   +1.129754632928508e-01   -1.096945561390751e-01   -7.123392369297231e-02   +6.819373470112772e-03   -1.411600659826228e-01   +1.451259358271442e-01   +6.985151160966012e-02   +3.787919822198723e-01   -2.435814996783275e-02   -1.597587354565171e-01   +3.310354156349217e-01; +1.088222686801380e-01   +3.634995380081020e-01   -1.619301092275974e-01   +3.929430072545351e-02   +4.202671332401722e-03   -5.742869917896293e-01   -5.219114076790238e-03   -2.121351203264612e-01   +4.836147779403064e-01   -2.280412951371580e-01   +5.079933820066400e-01   -5.829530894152109e-02   +5.751486154319044e-01   +2.881963041811195e-01   -1.814161203596866e-01   -5.008843847804543e-01; +1.820464892620217e-01   -4.046689753422185e-01   -3.077564899184104e-02   +5.967313598361305e-02   -1.142738828020881e-01   -1.994944885135607e-01   +5.089124425145455e-01   -7.297704014212210e-02   +1.791970645498388e-01   +2.031249894536520e-01   +5.755244592704961e-02   +2.481836156104507e-01   +3.482556246092471e-01   +8.211685373982684e-01   -1.750494612555702e-01   -4.743228715627618e-01; +7.870937825707497e-01   -7.174225180430815e-03   +4.606491067118731e-01   -1.488406911295108e-01   +1.098408255052753e-01   +4.050470955001587e-01   +4.208991307786688e-01   +5.935285723396022e-01   +2.882456636896591e-01   -2.654155604311856e-01   +2.602960045695446e-02   -7.737207552749539e-02   +4.306384040022797e-01   -1.673521137631768e-01   +2.995462994156267e-01   -3.615176796654528e-01; +7.508543612215066e-02   +2.757695459677963e-01   +5.803476620795121e-02   -3.580857860337493e-02   -4.448928620161733e-01   +1.338786450887393e-01   -8.165240219119616e-02   -2.665305184471311e-01   +3.032605375825287e-01   +4.239782814701420e-02   -2.979160711653744e-01   +4.677889838569399e-01   +4.735592477874314e-01   +2.323931438478082e-01   -2.523864009105530e-01   -5.198787214093875e-01; +2.771842745027976e-02   +6.742468852878070e-01   -2.435986984360783e-01   -1.960705140649434e-01   -6.598029267015011e-01   -5.407084393335528e-01   +3.947148480810479e-01   -3.037143100309068e-01   -2.037620776578999e-01   +2.599487369837881e-01   -5.587545517279020e-02   +1.715224417311346e-01   -3.508265317071456e-01   -1.661124386678719e-01   +3.658241375807155e-01   +4.087326796418041e-02; +3.068579337397699e-01   -8.030030498864182e-02   +1.400820372542619e-01   +6.325284676160040e-02   +8.941194323356766e-02   -3.305478707771345e-01   +4.306958568450821e-01   +1.752270329601496e-01   +3.467058130284126e-01   +4.788673286072814e-01   -1.331951599199687e-01   +5.129755635431554e-01   -6.824678512802118e-02   -1.849770286128549e-01   -5.401386561622104e-01   +4.090284145380997e-01; +3.313764583082811e-01   +2.165344032138785e-01   -2.072462211511420e-01   -8.670833745756847e-02   -3.102139223510287e-01   -5.487415903567621e-01   -1.711302444827223e-01   +4.844566504288261e-01   -2.921132843205860e-01   -1.785723628712668e-01   +2.347385704134496e-01   +3.644344036633728e-01   +4.912581594109524e-01   +2.376552944609116e-01   -2.774136339308989e-01   -2.654389017297071e-01; -4.066148954051729e-01   -7.316047064826506e-02   +1.760050392640251e-01   +5.084916497541364e-03   +1.750394612575865e-01   -8.601020970055531e-02   +5.657656754412388e-01   +1.708269202014714e-01   +1.147226068865388e-01   +5.760702072816451e-02   -2.402979431639921e-01   +1.814652446273861e-01   -1.077764227359556e-01   +9.239507867272140e-02   +3.324810399499472e-01   -1.064664822318289e-01; -2.449669211337346e-01   +6.107739598086647e-03   -2.435040260071123e-01   -2.398060345942151e-01   -1.409979532706578e-02   -3.450111036324708e-01   +5.522860423323032e-01   +5.110794973865446e-01   -4.253578285533848e-02   +1.909715456812060e-01   +5.347288530454331e-01   +1.640820998278754e-01   +5.306211556300526e-01   +2.767450359437325e-01   +8.573439515188706e-02   +5.527602370158813e-01; -1.657858570256678e-01   +3.959234684192416e-01   +6.413169934960640e-03   +2.670492259979724e-01   -1.950622408732622e-01   +2.926563550500098e-01   +5.940243263284732e-03   -3.373210601655710e-01   -3.628286244612617e-01   +5.900869631252812e-01   +8.913359928739567e-02   +3.398572129038481e-01   +1.784902423183787e-01   +6.887455796434461e-02   +9.320408964374227e-02   -4.000171926554210e-01; +1.618472779481711e-01   +6.851713523887788e-01   +1.123479128441994e-01   +3.442774578356940e-02   +9.849552346216404e-02   +9.301460441578149e-02   +2.836480629973902e-01   -5.768254057207109e-01   -2.362196084262673e-01   -4.495139787903642e-02   -1.823750194931252e-02   -1.702817175236950e-01   -2.632268531389179e-01   +2.314532613816613e-01   -4.968070894923032e-02   -1.493149093511175e-01; -1.085692133067795e-01   -3.864512714151352e-01   +1.314689922291180e-01   +2.171272934566889e-01   -2.612692013929484e-01   +2.151740066281792e-01   -1.556600495736633e-02   -3.598614849644387e-01   -2.758160106155014e-01   +2.276935689255187e-01   +2.370174047158847e-02   +4.505615039957230e-01   +1.035491641747632e-01   +1.698210796053349e-01   +1.095023457518466e-01   -2.966538306838535e-01; -2.302719951931466e-01   +3.515778569140480e-01   -4.273074967103598e-01   -5.378821749252862e-01   +2.618711870309272e-01   -1.406038209665962e-01   +3.113926010715461e-01   +1.204218914079883e-01   +1.745022289402894e-01   -8.521347368924936e-02   -3.557822902993316e-01   -1.240561755257521e-02   -2.935331412142201e-01   +6.800465308363708e-01   -7.714557337532232e-02   +5.401026436185326e-01; +5.290075042975094e-02   +2.281726805425591e-01   +2.964500046612090e-01   +3.350327952240768e-01   -3.207025062774134e-01   -2.828852379668845e-03   +3.114114991862988e-01   +9.765577537872859e-02   +1.002021256076046e-01   +3.678917814273371e-01   -4.211920003372262e-03   +2.189120894263356e-02   -1.853398461018740e-01   +7.466396624741140e-02   +9.879859555488639e-02   -1.527179739831237e-02; +1.914807293051473e-01   -8.847106142639395e-02   +3.827000650452755e-02   -1.112478727844995e-02   +1.768725856258266e-01   +1.276279135997486e-01   -2.420243808995759e-01   -3.085100225230608e-01   -1.287260870800950e-01   -4.407256648239080e-01   -3.851195442570974e-01   -4.632496169404851e-01   -6.451828389271050e-02   -2.878033979950607e-01   -2.453506889325563e-01   +3.247192788527246e-01];
L1E_L1I_iGABA_netcon = [-4.847993303052024e-01   +1.097189710989406e-01   -4.195172821190659e-02   -9.469328047855943e-02   +2.599924766781822e-01   -5.797476095142801e-01   +2.949131957277818e-02   +2.618622881363459e-01   +1.960685582856583e-02   +1.614569498802739e-01   -2.809905800306177e-01   -1.410534987767617e-01   -9.913557832171227e-02   +1.104476213440426e-01   +8.802125429455122e-02   -3.454076188866022e-01; +6.649980177596928e-01   +1.301116950406405e-01   +3.355413675740299e-01   +3.753065238683889e-01   +3.761748131226629e-01   -4.139198439764100e-01   +4.991436376806881e-02   -4.834033349559221e-02   -4.488897091379840e-01   -1.617095467452442e-01   -1.572435802777624e-01   +4.349923762514946e-02   +5.194367818599238e-01   -3.887298917363701e-01   +3.129987512005044e-01   +2.489470453938096e-01; +4.916195502190008e-01   +2.500060457288475e-01   +6.247435073525009e-01   -7.085945695562182e-02   -4.641815611069176e-01   +1.619458416376046e-01   -4.123373081155399e-01   -3.825235637274684e-01   -3.433648751177437e-01   +1.899654782337748e-01   -2.935805597519464e-01   -3.857957071238292e-01   +4.811655173937470e-01   +5.904619905791781e-01   -6.741640141379965e-01   +1.710440686271052e-01; +1.943218983078527e-01   -2.421296711276353e-01   -2.032171596193763e-01   -5.359766948497916e-02   -1.698662377105690e-01   +2.966230542945238e-01   -5.927182336506523e-01   -3.976150358333436e-01   -1.715311716743411e-01   -3.185654198501446e-01   +2.937982344006391e-02   -1.574339211100175e-01   +4.702056324309323e-01   -1.171188960401593e-01   +2.664545718045723e-01   -8.775489322748803e-02; -1.419753697465836e-01   -1.663531606243936e-01   +3.182132025972930e-01   +2.418427101492257e-01   +1.533482953264246e-01   +3.358729504747888e-01   -1.070957829726043e-01   -2.031562958839604e-02   -3.348219967103140e-02   +1.624981977612804e-01   +2.563184477762340e-01   -1.715595471164102e-02   +2.986165246654868e-01   +1.717761544821029e-01   +5.751374898425798e-01   -6.214199873642271e-02; +2.223052476091599e-01   -7.657258350534141e-01   -2.226034982465293e-01   -5.313418487540168e-02   -2.117118595569595e-01   +6.774093355394691e-02   -1.112737287212441e-01   +2.888162733869120e-01   -1.227145365589262e-01   +1.528545859855951e-01   +7.235723618635473e-02   +7.099604083995488e-01   +2.633529859082739e-02   -1.048537658958355e-03   +1.826630994561536e-01   +1.248839872842070e-01; +2.823878809203330e-02   +1.794249326276833e-01   +2.927820190482189e-01   +4.098599940913726e-01   -2.876943155732836e-01   +3.786211046270131e-01   -1.205621250925917e-01   -2.043034591390365e-01   +1.305202734240944e-01   -3.091385337610684e-01   +3.665614706519651e-01   +4.186288338876775e-01   -3.746910721166544e-01   +1.200517321901218e-01   -2.927362336742548e-01   +5.046898876018069e-01; +2.607483343728704e-01   +1.246874802662960e-02   +1.565796791451691e-01   +3.073507639727134e-01   -4.470302718516954e-01   +1.572120585319766e-01   +3.229386062852863e-03   -3.242497556835390e-02   -4.419845087867903e-02   -1.787106664703819e-01   -1.486758696530502e-01   +2.394997095435281e-01   +3.608038042277684e-02   +1.828543474651421e-01   +3.277323069809620e-01   +2.079122369015483e-01; -1.394195602344612e-01   +9.751894213367116e-04   -2.344433754676820e-01   +2.868071529629161e-01   +5.419272729026953e-02   -8.108685047645878e-01   -5.070246897721384e-01   -7.014675202646753e-01   -9.992933378950963e-03   +9.606121510203973e-02   -2.576852012253867e-01   -1.643758077140574e-01   +2.757423023205517e-01   -1.066793858109395e-01   -2.878704303796286e-01   -1.364476837774456e-02; -2.060021703248172e-01   -2.210761098024102e-01   +3.321709946920028e-01   +2.430170591470384e-01   +2.612548745759966e-01   +5.377364998680437e-02   -5.125716658513039e-01   +2.442821080480192e-01   +6.929277477288101e-01   +9.053853517336988e-02   -3.657043828363268e-02   -1.283834353124081e-01   +9.009087544948861e-02   -6.168339037569004e-01   +6.284747670349943e-01   +4.217077338900308e-01; +7.350560225325602e-02   -1.806368972118146e-01   -1.083244577041391e-01   -2.046825954145015e-03   +7.272372943586694e-02   -2.159946493012623e-01   +1.867818591267756e-01   -1.671143422543305e-01   -4.455597328577296e-02   +4.046258971928912e-01   -8.796598771114206e-02   +1.562626113528756e-01   +2.621089840462650e-01   -1.571069091929014e-03   +1.478727817672058e-01   -2.180789775938129e-01; +1.243538915983061e-01   -1.028130357086161e-01   -2.173356519771446e-01   +6.158731333319400e-02   +5.642380844007796e-01   +1.149291349584253e-01   +3.307207022248927e-01   +2.250403647632695e-01   +2.580318702885248e-01   +3.630644901136006e-01   +6.605079398423861e-01   +1.652620203139079e-01   -1.035639175927120e-01   -2.711497707103443e-01   -1.171360868592618e-01   -7.796168862987979e-03; +4.482553953381119e-01   +4.566909077274701e-02   -2.315390501903822e-01   -4.809750338087101e-01   -1.593416426222950e-01   +1.053172028387151e-01   +2.944027304278881e-01   +4.470323660909321e-01   +1.149651264592643e-01   +4.481605067979373e-01   -1.163170942255897e-01   -4.135206747849527e-01   +2.550641868795626e-01   -1.897012995898867e-01   -3.863438455555905e-02   -3.471288832727374e-01; +4.158939320611232e-02   +4.642735130102278e-01   -9.033080222148433e-02   +9.135492597498893e-03   +9.819450306969828e-02   -1.574618736211094e-01   -5.478941628476609e-01   -2.084863688855534e-01   -5.010970361581059e-01   +1.489021421133783e-01   -9.413030263708290e-02   -3.489061272775589e-01   -1.978226229533619e-02   -5.196681766788206e-02   -7.116664815463276e-02   +4.337657590997518e-01; +9.408877865845287e-02   -1.674069794635373e-01   +4.201022822241816e-01   -2.886008870675046e-01   -3.525123548622163e-01   +1.366977565927643e-03   +2.082853363756589e-02   +2.996176566375842e-01   -4.555455072175753e-02   +1.297112641813785e-01   -2.371316608834991e-01   -1.175252860632129e-01   +8.341679492827925e-02   -6.187452971338682e-02   +5.818939957681498e-01   +7.132785936921230e-01; +2.426554277765078e-01   +3.762491717839257e-01   -1.681297734183834e-01   +8.580521630684360e-03   -3.035595885230965e-01   +1.943621596658361e-02   -3.206503848868885e-01   +5.909030946860917e-02   -2.308641770393359e-01   -5.572508180924009e-02   -1.478673257533539e-01   +1.207448599908994e-01   -4.984402595753232e-01   -4.463701704112911e-01   +5.244249046483762e-01   +3.323239485725292e-02];
L2I_L1I_iGABA_netcon = [-1.903696170467389e-01   -2.408202523690828e-02   +5.161619371985222e-01   -6.919885768432592e-01   +9.302224265435803e-02   +1.212232869134726e-01   +2.189703153632309e-01   +1.639967097259799e-01; -3.409203433192148e-01   -2.764061212449994e-01   +3.745790732343425e-01   +4.345668591899826e-01   -1.779050968028392e-02   +2.508773451264954e-01   +2.965299257657266e-01   +1.975405589919721e-01; +1.569408227249911e-01   -9.986402376120472e-02   +1.168450018640110e-01   +2.039072992973453e-01   +4.245559310217583e-01   +1.006602345817737e-01   -6.619986554367424e-02   -2.777601542901454e-01; -1.574954496365191e-01   +6.530004334875368e-01   +2.371441804647702e-02   -7.147614489973653e-02   +1.177117676768300e-01   +9.348240538695290e-02   +3.841620346885981e-01   -6.917077404925825e-01; -2.716651007833475e-01   -4.053968732059235e-02   +3.306279495664858e-01   +3.328048965062155e-01   +7.769924249100463e-02   +9.901024941338689e-04   -1.072533543830709e-01   -7.995167744981128e-02; +3.693153920969614e-01   +7.863470339218787e-02   -6.430192939629149e-01   +6.648219054137250e-01   -2.993048700268232e-01   -1.902623850718010e-01   +2.743176763019962e-01   -6.492661315827923e-01; +6.568766895760560e-02   +3.056440787721543e-01   -3.541479024987484e-02   -3.557557537290709e-01   +1.093560578274201e-01   -7.607514996436096e-03   +2.828712598928923e-01   -2.788217358223757e-01; +2.900340337539950e-01   -4.172614002677441e-01   -1.056744054759086e-01   +2.363457930805734e-03   -9.673584269147527e-02   +6.195550549523254e-03   +4.848044531557159e-01   -6.474004774671313e-02; +4.022425781167941e-01   -5.081785194586131e-01   +1.940629277237698e-01   -1.186633451748712e-01   +2.383297231069580e-01   -2.459943170766959e-01   +2.243310643016562e-01   +4.963300836863464e-01; -1.213961832011103e-02   -1.054646683600959e-01   -3.429349267145827e-01   +7.011101248296210e-02   +5.597981130400380e-02   -2.972662607400479e-01   +8.520697761709412e-02   -5.261140695272071e-01; +6.196952765072451e-01   +5.643993801181729e-02   +2.333801344799229e-01   -8.852376608572031e-02   +2.401716796340351e-01   +1.604945086361949e-02   +2.974692890417346e-01   -2.733014662195083e-01; +2.570497499124034e-01   +2.407303595893638e-01   +2.448235425454164e-01   -6.985726306600828e-02   -5.871540057375049e-01   +2.171035577163420e-01   -6.814832957737320e-01   +8.795540239629611e-02; -3.544097867847304e-01   +4.767485344152377e-01   +3.847894350318106e-01   -3.565397048178716e-01   +2.069538328185017e-01   -1.873680878009069e-01   +1.648491233102741e-02   +2.117284908248963e-02; -5.334767311676589e-01   +4.206111632870589e-01   -8.213602265950359e-03   -8.304796381922265e-02   +1.595610009204817e-01   -3.905971547958222e-01   -1.799819864443669e-01   +3.947096235497914e-01; +3.050522128916861e-01   +4.182523628717848e-02   -3.872727230087403e-01   -3.923598777544250e-02   +3.887345054891347e-01   +2.219503921906669e-01   -1.234708585253718e-01   +4.352859536204010e-01; +4.715394140989278e-02   +3.402770996754112e-02   +3.767328077636731e-01   -2.833862397065244e-01   +8.895714328400403e-02   +3.011715927841165e-01   +2.879351965602855e-01   -4.567485136110610e-02];
L1I_L2I_iGABA_netcon = [+2.936973314434350e-01   -3.888457799918497e-01   +9.812085483432713e-02   +5.446586013661592e-01   +3.047493116105333e-01   -4.037585027920109e-01   +6.651614276645113e-03   +8.914887054519968e-01   +3.542873854980738e-01   +3.733764577193325e-01   -3.811889353506494e-01   +1.298174767565601e-02   +1.325968064833468e-01   -1.689514425177735e-01   +4.795729047611456e-01   +5.343272660638064e-01; +3.255553347096297e-01   -2.663362502454931e-01   +5.824144096010405e-01   +6.887237486600298e-02   +3.914238612335745e-01   +2.001888143345616e-01   +5.584320667277466e-02   +2.419444839486101e-01   -3.664379172447008e-01   +4.436391674836094e-01   -1.182963508196185e-01   +8.985867055888960e-02   +6.757432124119317e-02   +2.656363208820740e-01   +6.816035332232841e-02   +3.583190787711247e-01; -3.032623280479980e-01   +3.054595167035379e-01   -3.358742034033970e-01   -2.363600144299876e-01   +1.744435269236602e-01   -5.305301935323706e-02   -1.733268429257974e-01   -7.567493377204981e-02   +1.363822238880372e-01   -5.964456934722983e-01   +9.446513821531091e-02   +4.079127360850635e-01   -4.374169753396959e-01   +1.534074176361677e-02   +1.756474983445189e-02   +2.595778695430589e-02; -2.524297045915252e-01   -1.082923477524253e-01   -1.689183830419026e-01   +1.124122602263346e-01   -1.516457923452909e-01   +3.437104530234795e-01   +2.688665686704120e-01   -2.544365823448580e-01   +2.536533934808455e-02   +2.440980549433759e-01   +4.294121891311437e-01   +8.749772242606042e-02   -2.443404144579469e-01   +6.609039056478265e-01   +3.359089814398628e-01   +9.410443403211777e-02; -2.758884733138968e-02   +3.581647404150031e-01   +2.187939537574103e-01   -1.098100562834058e-01   -2.496910254322240e-01   -9.220955532478929e-02   +1.021534717936702e-01   -6.789023685789923e-02   -3.046936268257608e-01   -3.185913386582782e-01   +2.013021840889226e-01   +6.868398241971312e-01   -1.271303983800513e-01   +3.001051482667335e-01   -4.291025921100256e-01   -3.778221364934822e-01; +8.963566478907740e-02   +9.229176605725534e-02   +2.402381547926720e-01   +9.495162442969157e-02   -2.253810333722203e-01   +4.276260906682747e-01   -7.538612048961960e-03   -4.515436078399263e-01   +9.991117417587296e-02   +5.327649672866734e-01   +2.586376200634530e-01   +4.873373842528604e-01   +1.044053361611085e-01   +2.490232573835481e-01   -2.157682622995957e-01   +4.277794832253888e-01; -6.152227203972120e-02   +1.965909155743893e-01   +3.135084851632886e-01   +1.248888391322313e-01   -1.754773205225133e-01   +5.334304557949373e-01   -1.068440436027642e-01   +1.460653441230587e-01   +4.103899125751843e-01   -1.308724409823393e-02   +1.163441731103691e-01   -1.564971425336578e-01   +1.804253496341384e-01   +1.608970749220059e-01   +6.170252569094592e-02   +9.975409786861400e-03; +4.824593304054177e-01   +2.591219851481720e-01   -3.701718687822496e-01   -4.616948641302813e-01   -9.088172861805656e-02   +2.090893890848911e-01   +3.542023164566292e-02   +3.178681756130438e-02   -9.242756199145269e-02   +2.517221437394714e-02   -3.179703835915104e-01   +1.245165794525150e-01   -3.664022293812849e-01   -5.818116201569288e-01   +9.730894317519784e-02   -8.366454716830982e-03];
L2E_L1E_iAMPA_netcon = [+3.433255582832040e-01   +2.136101552280720e-01   -4.632958820658535e-01   -1.720934321229224e-01   -4.346827869068168e-01   +5.855487124477412e-01   +7.885753101061672e-02   +4.451478324952577e-01; -1.046815619358591e-01   +5.652143254735769e-01   -1.972691178685916e-01   +2.703538475135307e-02   -2.432626030152736e-01   +1.654160106921327e-01   +8.928487865331125e-01   +6.536182124514348e-01; +3.299345750840765e-01   +1.642452657194607e-02   +6.476629330587724e-01   +3.148687516073052e-01   +3.238131820899827e-01   +3.709081982155864e-01   +1.615479633986033e-01   +8.418530011349558e-02; -3.735332048767281e-01   +1.136798418116794e-02   -1.788055103866328e-01   +3.844906729903788e-02   +6.221979369589522e-02   +1.235964234731009e-02   -1.149604558160971e-01   -6.076249619582352e-01; -3.687440986750593e-01   +5.893246469259956e-01   +4.088232691399470e-01   +5.403629909960160e-02   +8.061129369403663e-02   +1.020266516734416e-01   +1.448317304467801e-01   -4.419719820482251e-01; -1.670387715963939e-01   -1.128796447188997e-01   -1.386259450075971e-01   -2.723516395885217e-01   +3.334825948746988e-01   +2.719734535931791e-01   +4.956115928681956e-01   -5.320500461072453e-01; +2.969714150787954e-02   -5.274921096588070e-02   -2.310174382444984e-01   +3.224154422291218e-01   -8.429364374606392e-02   -1.922617808125424e-01   -3.365632661897303e-01   -2.673587890551198e-01; +1.695479088780790e-01   +2.381387305848612e-01   +3.036415305699294e-02   +2.858351877331516e-02   -2.523184898178125e-01   -2.143490493889397e-01   +9.237788588373191e-02   +1.075552699659173e-01; -2.538241762147285e-01   -1.112039854262257e-01   -2.436271465443184e-01   +1.610597709186252e-01   +2.703983282062789e-02   -2.950554981603602e-02   -8.149349623423944e-01   +2.210457964851506e-01; -1.819437943565709e-01   -7.451189981151680e-01   -2.257681543447135e-01   +6.674567311341463e-01   +3.532446586972025e-01   +6.364729024865791e-02   +4.152546905243625e-01   -2.753664415457728e-01; -1.418478830033433e-01   -1.685019021545811e-01   +2.487232034922486e-01   +4.148891266200616e-01   -4.695224514941425e-01   +2.723135668865813e-01   -1.371713556576266e-01   -2.335910844347015e-01; +6.464257419303386e-01   -2.958565350920113e-02   -2.537897821218760e-01   -1.592524628276837e-01   +5.139657031466034e-01   -3.868070925639441e-02   -1.044918038649332e-01   +3.808137431373042e-01; +1.203620358554712e-02   +3.401380276871221e-01   +5.221025272177661e-01   -1.744628838821699e-02   -2.078907626672472e-01   -4.228142256231729e-01   -6.159427101336722e-01   -2.663548703032214e-01; -1.228297835992366e-01   +7.522723733605564e-02   +6.567589525926913e-01   +2.820691094794861e-01   -3.781712861799005e-01   +2.879622357280395e-01   +8.533117231688282e-02   -2.207882740523796e-01; +2.045522909491844e-01   +3.023316268195134e-01   -3.176939984826336e-01   -2.874607600280483e-01   +2.004222640397502e-01   -2.870677460358858e-01   -9.068387725702257e-02   -1.542256344035265e-01; -2.310424006334421e-01   -5.489588749344960e-02   -1.668682143059672e-01   -2.464324509845979e-02   -2.574371597580201e-01   -6.230668341206742e-01   -3.190502987330009e-02   -5.143421498248664e-01];
L1E_L2E_iAMPA_netcon = [+2.095105548659700e-01   +4.635774624495198e-01   +4.742417184108272e-01   +1.574457964993142e-03   +2.717442178549919e-01   +6.750217192544778e-01   -7.286784569016588e-03   +5.966433412147034e-01   +5.357378158094799e-02   -3.741974670932036e-01   -1.746038195066738e-01   -3.075090461762971e-01   -6.252191923303614e-01   +4.101972651063074e-03   +7.208003740417847e-02   -3.087258954566384e-01; -3.478489123839969e-02   +2.534336913770281e-01   -1.828314897204451e-01   -1.318203716373675e-02   -6.557156815125911e-01   +1.778406231253965e-01   -1.453235794004424e-01   +4.699405730230244e-01   +4.153894872392402e-01   +3.195708545297342e-01   -2.882476861132744e-01   -9.370142321200667e-02   +6.993329309320887e-01   +3.877291830115145e-01   -1.928311985505671e-01   +1.968553733717633e-03; -4.987726678627428e-01   -4.448620742406552e-01   +4.803832613977890e-01   -3.158485893123628e-01   -2.111236995564129e-01   +5.100482275475520e-01   -1.214516429879862e-01   -2.006699390845319e-01   -4.346617338368673e-02   -3.430831699872595e-02   -5.790370211962859e-01   +2.157147273227664e-01   +2.483307837683069e-01   +9.464506267957846e-02   +3.222841069082532e-01   +3.557290797644441e-01; -5.680991354295589e-01   +3.617011991322350e-01   +8.139845241331597e-03   +4.726697644481663e-01   +2.561927688690833e-02   -6.992988243772896e-04   -8.031378140632708e-02   +9.358575597471382e-02   -3.817889023158132e-02   +4.376625033866025e-01   +3.196713351510826e-02   -8.518604170554364e-02   -4.726424403556442e-01   +2.269779907992684e-01   +2.927775572029068e-02   -4.058714376024936e-01; -2.395410854522020e-01   +1.615501075938778e-01   +4.899994440935436e-01   +6.266308129381220e-01   +8.254689312150376e-01   +2.146693254753665e-01   +3.990171407249711e-01   +7.031614293051366e-03   -1.768359309316719e-01   -6.474661939978006e-01   -2.493110371310001e-01   +5.362078785109458e-01   +8.659623071045533e-02   +3.585193525287394e-01   -2.536702773310048e-01   +1.654334634479031e-02; +2.410112198227888e-01   +6.506308133269020e-02   +1.403818718794767e-01   +3.218406263337623e-01   -4.044504243986022e-01   +8.847647868966000e-01   -6.662923122368963e-02   -1.996251469977807e-01   +4.582612149797535e-01   +1.352885767986622e-01   +5.393595023959392e-02   +4.797951280319928e-01   +3.366895246531088e-02   +1.448773924282422e-01   -8.190174886457166e-02   +3.069001565827353e-02; +5.179215449119359e-01   -2.825806404883601e-01   -5.408394195057668e-02   +2.346544397889385e-01   -1.042154994747608e-01   -7.742658934955297e-01   +2.875388646975843e-01   -6.576799146000842e-01   -1.615469783535506e-01   +2.623123222604075e-01   +6.876470385081452e-01   -2.707841224321951e-01   -4.278348373757062e-01   +6.122984561621213e-01   +6.758642503822654e-01   +2.372848348284765e-01; -2.620042773440280e-01   +2.233624894162806e-01   +1.758884832972206e-01   +3.250197103593223e-02   -8.711837443125259e-03   -4.974805046881188e-02   +3.087956703846947e-02   +3.118181578858910e-01   +9.177165950865569e-02   +4.273510443070420e-01   +5.412381025858309e-02   +2.393212425291019e-01   -2.412736194915536e-01   -7.173493298904043e-02   -3.308292391487636e-01   -3.341505598731914e-01];
L2I_L2E_iAMPA_netcon = [-6.675111047561566e-02   -7.890273393771735e-02   +3.567762580027134e-01   +1.487510778375908e-01   -5.462622619773176e-01   -3.236703512148936e-01   -8.410822723073302e-02   +2.903212115624588e-01; -1.087550200073538e-02   +4.478603081166365e-02   +3.726076696205617e-01   -4.242501393847690e-01   +1.652056788576805e-01   +2.734524991892090e-01   -2.527312774166950e-02   +2.522667372298836e-01; +1.023138362268798e-01   -3.293901717484659e-01   +3.260324634334366e-01   +3.917437048345310e-01   -7.062088424446091e-01   -5.734695664153742e-02   +4.524670674872973e-02   -6.706181058332786e-02; -9.869955066287876e-02   -1.012195534995590e-01   +6.603732395027696e-02   -1.201375942470809e-01   -4.241679223810017e-03   +2.141514847870018e-01   +1.619373938163256e-01   -6.803009044926478e-02; +4.434196887941964e-02   +2.904150513005577e-01   -9.801078952919388e-02   +3.406995687066013e-02   +2.721328235368410e-01   +5.564480171979423e-01   +2.938283514059997e-01   -7.216570816856351e-02; +1.676354671652876e-01   -4.316026254169886e-01   -3.334230175609921e-01   +2.801865914587696e-02   +6.345593085790040e-01   -4.749873874512582e-01   -2.545125020086255e-01   -2.423472437425544e-01; +1.553906573924015e-01   -4.777248761703788e-01   -1.064373064555359e-01   -8.217002212697708e-03   +7.063927135499489e-01   +2.469175857694531e-04   -3.998085878135688e-01   -7.881521523904317e-01; -6.463637302383257e-01   +2.893078151612567e-01   -6.247666548289302e-01   +4.113113304326693e-03   +3.537414042733360e-01   +2.619783876226227e-01   +7.577764166531717e-01   -2.829601074860226e-02];
L2E_L2I_iGABA_netcon = [-6.676759681869342e-02   -8.146981880516388e-02   -3.638587452628214e-02   -1.531560008417305e-01   -1.263242903554101e-01   +1.936351935749408e-01   -1.408261679726429e-01   +2.644321404612862e-01; +1.198670701889522e-01   +1.921060522620450e-01   +5.548009855935503e-01   -2.362832836336878e-01   +4.934620554399906e-01   +2.997119740683243e-01   +1.910018725832454e-01   +4.640093993973275e-01; +1.828246606649820e-01   +1.470258355188127e-01   +5.221406107540721e-01   -1.929801955513738e-01   +1.891465454871107e-01   +8.371432179823977e-01   +6.567370298948182e-01   +5.587517151479682e-02; +2.860977092501749e-01   -1.223738306104177e-01   +6.801408206259684e-01   +3.432332254642320e-02   +2.410321959925817e-01   -8.702879887856532e-03   +3.434961781581878e-01   +7.272385342977342e-02; +5.015930204634164e-01   +2.546907067418043e-01   +3.135432503246203e-01   +3.171728294217127e-01   -2.963419076478487e-01   -5.973968949441970e-02   -8.739078554637332e-02   +5.547309746812863e-02; +1.084941848918429e-01   -3.583937811359647e-01   +2.862131034798334e-01   -2.791889859371340e-01   -1.494513324904974e-01   +9.486988983057251e-02   -2.844652404966305e-01   +3.615452581169618e-01; -3.524350762833870e-01   +4.423692394149727e-01   -2.019092562597766e-01   +3.085031412871309e-01   -2.878146839175282e-02   +6.583155967395310e-02   +4.673497205443569e-01   -1.867837888397098e-01; -2.932565684344454e-01   +2.535590471631688e-01   +4.123456192779578e-01   +2.814769717524122e-01   -1.126079401480563e-01   +4.456971258202207e-02   -1.279705073591814e-01   -3.535501657163984e-01];
L3E_L2E_iAMPA_netcon = [+5.636197677061976e-01   +7.427003794988427e-02   -8.742131337870686e-02   -5.137387322840240e-01   -1.947476525800532e-03   +3.238823625052166e-01   -2.928490464938870e-01   -4.023342168480666e-01   -1.804759056632690e-01   +3.850683778588842e-01   -3.063762450803760e-02   +4.496022738279000e-01; +2.738727940521232e-01   +4.357613570055830e-01   +1.837296365369814e-01   -2.688711653222860e-01   -1.552454239847663e-01   -2.141568245432611e-01   -5.357128440975676e-01   +6.113744519911152e-01   +4.078231784640589e-01   +2.981206841406696e-01   +1.347473405261251e-01   +3.023700243248213e-02; -2.251413696521498e-01   -2.556080495801586e-01   +2.001862057806515e-01   -4.490432006898219e-01   +5.495935915554591e-01   +9.364768750974041e-02   -2.518904788322176e-01   +1.527461409920124e-01   -4.209698204508169e-02   +4.034675339255048e-01   -3.633117781835229e-01   +3.768463727604308e-01; +2.154598427899842e-01   -2.649869432115776e-01   -3.902082096545986e-01   +2.959512170281874e-01   +3.741211363798713e-01   +5.427966260006145e-01   +3.946451632443586e-01   +1.962717149681280e-02   -9.047667783719768e-02   -6.534633016681823e-01   +2.138557383364030e-01   +7.458889568546946e-01; -2.150275198200901e-01   +3.012912308831197e-01   -4.766421355197232e-01   +2.990460440544091e-01   -3.696326367676965e-02   +2.031849058363342e-01   +4.498537284967525e-01   -3.313569286550712e-01   +1.231488774332615e-01   -1.267101656526181e-01   +7.795349220525966e-02   -1.828072986083421e-01; -1.094014682757991e-01   -4.865759011262887e-01   +2.055954744050909e-02   -1.824807996490544e-01   +3.167656801220616e-01   +5.379306617006431e-01   -1.511431896860949e-01   +3.816455603017126e-01   -6.661330283634783e-01   +3.906981294198045e-01   -6.752142298863570e-02   -7.152510451717050e-01; +8.664558261513573e-01   -1.661495898363005e-02   +7.382565077146665e-03   -2.724880660968502e-01   -3.224368407802777e-01   -3.692646189633439e-01   -3.270487158586227e-02   -6.918145279674237e-02   +6.585069319949923e-01   +1.261634441387093e-01   +2.832010032959876e-01   +1.168466904382509e-01; -4.071809040108131e-01   +2.669735745785736e-01   +4.362112233635946e-01   +3.913835666860448e-01   +3.011383646737097e-01   +1.103052614058633e-01   +5.305426045433248e-02   -3.696084814731996e-01   -3.832755875611267e-01   -3.703366079806324e-01   -3.356677583974906e-01   -2.565914102692480e-01];
L3I_L2I_iGABA_netcon = [+3.809665560551297e-01   -3.601614939677719e-01   +3.631988577420617e-01   -4.341628549442600e-01   -1.172698027904295e-01   -2.003067490755716e-01   -6.913760599516864e-01   +1.560168963994355e-01   +4.819649337356896e-01   -1.768912234005386e-01   +5.020903866590575e-01   -6.369379472899468e-01; -1.724000863001526e-01   +4.234869098747320e-01   -1.730372657285580e-02   +6.620565138119905e-02   -2.769345495761224e-01   +2.247044965654250e-01   -2.617311762143861e-01   +7.655403449098657e-01   +4.663346959838811e-02   +1.225123407764283e-01   +1.778986669206782e-01   +8.766950356668515e-02; +6.321419918143463e-02   +1.810977550877255e-01   +1.568359747505443e-01   +4.473771442117105e-01   -3.638354568164816e-01   -1.984513883655173e-01   +5.042555915878941e-02   +6.290287204723735e-02   +1.829551773272073e-01   +6.359480757388940e-01   +3.566562464026219e-01   +6.654732987023033e-01; +9.607933040898964e-02   -3.005762355551790e-01   +2.531388676047585e-01   +3.646094075294775e-01   +8.056449119601249e-02   +5.306562912573296e-01   -1.424105342576959e-01   -4.960886259536632e-01   -1.966365161915336e-02   -2.089385691748540e-01   -5.612569271663621e-02   -4.396527521533696e-01; +8.782007826522893e-02   -6.442645451037246e-01   -4.110030732492411e-01   +1.574762261825959e-01   -6.609024202662589e-02   +1.856141931794759e-01   +1.173216485793905e-01   -1.034472257677535e-01   -1.781874075942299e-01   +5.913640997497760e-02   +2.320687408738305e-02   -5.570894679547017e-02; +9.474373718163828e-03   +2.382652185627622e-01   -1.652596817321128e-01   +5.528587150586254e-01   +1.253250703830662e-01   -1.263415228747031e-02   +3.355723646195277e-02   +5.046156050659688e-01   +7.658686663087516e-02   +5.045014078268553e-02   -5.831036981345765e-01   +6.436320500140569e-02; +4.993375675264076e-02   -3.615289606762306e-01   -8.779562025207686e-02   -1.399598431536095e-01   +2.876594804657150e-01   +1.078061088502921e-01   -6.064702331188103e-01   +1.207415500637399e-02   +2.007931196736861e-01   +4.972757096557930e-01   -4.357954916015604e-02   +3.816362352240724e-01; -5.237774708027718e-02   -2.891595710489372e-01   +4.397279227135624e-01   -8.802745236433152e-02   +1.526696109702369e-01   -4.060782262870672e-01   -2.031149790766751e-01   +6.120123933472147e-01   +5.178727406071941e-03   -6.881362953096667e-02   -9.513891873961103e-02   +4.458266832114669e-01];
L2E_L3E_iAMPA_netcon = [+2.300133648582373e-01   +1.730159934891075e-01   -2.984538892319942e-01   +1.146358213193357e-01   +4.227444540767245e-01   +1.972611326628249e-01   -9.223881601077401e-02   -3.235941151313908e-01; -4.202095669884480e-03   -3.538845258842722e-01   +3.123227914465561e-02   +3.670956351683302e-01   +3.277396998682999e-01   +1.844496333078819e-01   -2.996921676389719e-01   +1.777917934666293e-01; -5.676280161088859e-01   -7.500380308871469e-01   +4.513201818446647e-02   +5.478754123627946e-02   +1.507928668311372e-01   +6.897160163506028e-01   +3.668349908416259e-02   +8.995498486844501e-01; -3.357518611674425e-01   -1.630069355028374e-01   +5.043986068833204e-01   +5.936588467597277e-02   -2.296112366963352e-01   +5.668800581960128e-01   -1.566591246394386e-01   -5.432097763921491e-01; +4.797378375050415e-01   -1.898777091146312e-01   +1.093489274520143e-01   +8.657131003161470e-02   -5.549575238775784e-02   +4.784309229208000e-01   +7.219245280228034e-01   -3.653003200478740e-01; +4.358879235640138e-01   -6.320893026879771e-01   +8.385717929025880e-01   +4.533532422810780e-02   +1.988511327462051e-01   -2.144135104696449e-01   -3.204005618390662e-01   -8.776021514592759e-02; +1.384077693165594e-01   -8.043139613738134e-01   +4.937224465127895e-01   +1.130383126879472e-01   +2.162148350773607e-02   -2.627990299583207e-01   -2.130690699860857e-01   +3.233710630340493e-01; -1.167077493893644e-01   +5.277630918049825e-01   -2.490566139983369e-01   -1.506626746963326e-02   -2.447740152027626e-02   -3.595909503530742e-01   -4.332066341306806e-02   -3.651933242490903e-01; +5.775402211571437e-01   -3.819317382189843e-02   +4.318624827306387e-01   +1.370296783477834e-01   +1.861382806428533e-01   -9.106433379269736e-02   -4.115720462748440e-01   +3.985551285117203e-01; +4.688349483281673e-04   -3.343974659163979e-01   -6.452468846805869e-02   +3.553617676243662e-02   +2.807092251746329e-01   +2.990379213937829e-01   +2.168798732076812e-01   -3.713297001344092e-01; -3.469395036724746e-01   +6.905446902377046e-01   -2.755796297238440e-01   +3.171496971545161e-01   -5.282330822233788e-01   +4.108573987233406e-02   -5.698475742466147e-01   +2.790646878310439e-01; -6.016405666221375e-01   -3.422565213885156e-01   +4.008437397167639e-01   -5.906733309123306e-02   -2.790800969409098e-02   -3.735378640082612e-02   -1.633690813561669e-01   -4.577150658021231e-01];
L2I_L3I_iGABA_netcon = [+2.936467324754248e-02   +4.321468700008605e-01   -4.740501865499139e-01   -1.707520377746730e-01   +7.412636052511001e-02   +4.160957741167302e-01   -2.946083515397061e-01   -1.436416347652916e-01; -2.534027408555562e-01   +8.805096933249343e-01   +4.795069607210561e-02   +2.952104784659861e-01   +8.882603940882761e-02   -1.435945426961830e-01   +5.617467405598295e-01   +3.352420719975953e-01; -8.494690533300944e-03   -7.390451810443852e-01   +3.095182802843316e-01   -5.016979631263097e-01   +3.450230307036752e-01   +5.680608112302629e-01   +1.174043340622230e-01   +6.777260207668707e-01; +2.415762906156152e-03   -3.221715270668628e-01   -4.213747517082896e-01   +1.894294605436672e-02   +6.480574712902680e-01   -7.318563993419970e-01   +3.744473161217181e-02   -1.258610512540901e-02; -1.477805812113224e-01   +1.479483040788111e-01   -1.921238561270117e-01   -4.275583259005098e-01   +1.981969321264611e-01   -5.382053060437866e-01   -1.621409322415065e-01   +1.190737430137458e-01; +7.137190512721870e-01   +4.187071383866659e-01   +1.523229348782972e-02   +1.665854740619005e-01   -3.858755377310609e-01   +2.529349836899030e-01   -4.622811798978491e-02   +1.151354799024723e-01; +2.223890008835632e-01   +7.768223969117652e-02   -1.860178372694815e-01   +6.010503214959237e-01   -6.617693075377639e-01   -1.820345177789914e-01   +5.099118306820272e-01   -5.100454656318948e-04; -3.868098274679583e-01   -1.979540399426432e-01   -2.268217626253409e-01   +2.333633127971813e-01   +5.097805224078432e-01   +5.262372756476282e-01   -4.238261026944065e-02   +1.282165520550910e-01; +2.550540690746859e-01   +7.106833816523853e-01   +1.139022294141236e-01   -3.818962585474662e-01   +2.803295558698315e-02   +3.204437700495452e-01   +8.766877018378338e-02   +1.401570934104769e-01; -2.024237953155079e-01   +2.450651503105828e-01   -1.401662661837239e-01   -1.272096354057162e-01   +3.794442810076254e-01   -5.435019676862782e-02   -5.174724699731679e-01   +1.833760966877217e-01; +5.300274021596291e-01   -6.567485852488528e-01   -1.229580575554122e-01   -2.814487178857640e-01   -1.012332691586423e-01   +1.832917287039180e-02   -1.516244791858997e-01   -3.936862954579577e-01; +3.195000719192829e-01   +8.700757806328728e-02   -5.894141765681914e-01   +3.509620801490765e-01   -1.346544613380795e-01   -4.104225492534145e-01   +3.260999260246273e-01   +2.542885100617652e-02];
L3I_L3E_iAMPA_netcon = [+2.174485495622634e-01   -1.603615048470605e-01   +6.563124893725783e-02   +9.974662672046217e-02   +3.216561436444411e-01   +3.471832595507741e-01   -4.250379530612481e-01   -1.235037459115556e-01   -1.251567061241746e-01   +2.389799719747454e-02   -1.577018513262933e-02   +1.645614155942186e-01; -3.590518223785648e-01   -4.513119564005133e-01   +4.217590155725070e-01   -4.958596172632668e-01   -2.203955027525138e-01   +1.923290670851965e-01   +1.528915231130292e-01   +1.775862479118254e-01   +2.303541560945550e-01   +3.728314091111690e-02   +4.854010867456084e-01   +1.082776303745563e-02; -1.833092450701976e-01   +5.607553787488109e-01   +4.878484829375955e-01   -1.300907402268215e-01   -8.120086308323134e-02   +1.158121344686520e-02   +5.210608849469691e-01   +3.125358978718052e-01   +7.862493368685466e-01   +4.097536972778787e-01   -3.587974656848762e-01   -2.255848457405537e-01; -1.624493310545606e-01   -2.832498560588037e-01   +1.181130361090237e-01   +2.412653441301644e-01   +1.999657383233830e-01   -5.471088374811475e-01   -3.126961189929872e-01   +2.595599330128624e-01   -4.911923036949369e-01   -8.542089092692992e-01   -2.069828525529903e-01   -4.950690383286792e-01; +4.008478235244270e-02   -3.098052042486926e-01   +3.018119284656075e-02   -1.924806649497860e-02   -5.053484813623813e-01   -1.527821909550164e-01   -5.259383198020130e-02   +2.188496700250323e-01   -8.267866407451921e-02   +4.991282583954273e-02   -1.761368625990865e-01   +1.910908509726773e-01; -2.073329416706331e-01   +7.756062932890431e-02   -3.994163881624507e-02   +4.247016930313872e-01   -8.856436971814290e-02   -3.539827011870488e-02   -4.412874995778374e-01   -1.415634994813213e-01   +4.464013702307446e-01   +3.396056896322016e-01   -3.226865862139952e-01   +3.893605221016144e-01; -2.774334975766445e-01   +3.510886819427602e-01   +4.635609585240399e-02   -3.048766171731424e-01   -7.073037922580699e-02   +9.692629714185377e-02   +3.730476984400600e-01   -1.309642444144324e-01   -1.733848895507810e-03   -2.588346124488379e-01   -5.830703655587790e-02   -4.905781022112143e-01; -5.380821334383441e-01   +4.582892202196622e-01   +2.988345859614531e-01   +3.794147401961940e-01   -4.139773181927964e-01   +1.202215495296726e-01   +9.465298697282465e-02   -1.362987639243035e-01   +5.762144904953749e-01   -4.074243235831776e-01   +4.354098347601008e-01   +3.736772802168726e-01; +3.033150766322447e-01   +2.171326637457011e-02   -1.716459663554216e-01   +5.808317988334962e-01   -3.321314930781921e-01   -5.955556118984598e-01   -2.687315213476472e-02   +1.078227707074873e-01   -1.741072881021752e-01   +5.114334304134449e-01   -1.154348369333762e-01   +3.000464432103344e-01; -4.246441029200488e-02   -1.161713801739810e-01   +2.579961626562391e-01   +3.430996129806611e-01   -1.177449094301210e-01   +2.063673424408423e-01   +1.734000330692425e-01   -5.304388653048930e-02   -2.858931620999118e-01   -3.239571300398458e-01   -3.686357840112183e-01   +6.183737277901996e-01; -6.135289866157073e-01   +5.035123142295667e-01   +6.176347096821276e-02   +9.040546118501307e-02   -4.022179147689202e-01   +1.700159509942669e-01   +1.520295532543809e-02   -2.123589963299596e-01   -6.321001174479429e-02   +3.833322201014048e-01   +7.559774770162395e-01   +7.465213524288325e-02; -6.930633783572113e-01   -1.322155610356445e-01   -3.028024465051584e-01   +1.485261412053846e-01   +2.613847678598608e-01   +1.107363580428263e-01   -4.438332722328033e-01   +1.940210333127043e-01   -4.846186888939444e-01   +5.560487440624282e-02   -1.387728029569398e-01   +4.491526982893851e-01];
L3E_L3I_iGABA_netcon = [+7.824982178434961e-02   -2.023789925173012e-01   -2.088567670316203e-01   +3.292928988338281e-03   -3.588212102765210e-01   -6.404881630245186e-01   -8.741730562747319e-02   +6.501197375027503e-01   +4.795543974732677e-02   +5.582189621095278e-01   +2.035069942665900e-02   -1.753527397469191e-01; +1.847001264876998e-01   -3.336954957636878e-01   +3.793623630314562e-01   +4.097185537599511e-01   +4.357276867563986e-04   +8.322542810401912e-02   +3.904806585746669e-02   -2.682221149342208e-02   +4.706875479798761e-01   +8.737984571495876e-01   +2.943099897029723e-02   +3.241411059777648e-01; +1.360187098901289e-01   +1.614973815946977e-01   -4.111430048761022e-01   +2.654436215370375e-02   -4.052896035176135e-01   +4.893823795827807e-01   -6.189847028747577e-01   +5.899205609237800e-02   +1.160497465490667e-01   -2.123041167490706e-01   -2.830428650220834e-02   -3.983804531379413e-01; +1.318016474533493e-01   -1.866338428480029e-01   +3.594976469103079e-01   +1.174395070982298e-01   +2.404042894842858e-02   +1.166373461459582e-01   -7.245247867839036e-02   -1.209835588563260e-01   -3.514941910767763e-01   -6.322463763138302e-02   -1.649497675738615e-01   -2.546703491067470e-01; +8.946573387547070e-03   -5.026107448270840e-01   +3.346296499632306e-01   +4.991249255075576e-01   +6.520401543680621e-01   +7.353745952257046e-03   +1.254617174363217e-01   +5.749581504189238e-02   -6.052917758155643e-02   -3.634344135964792e-02   +4.814651404450841e-01   +4.451577888968630e-01; -9.247280836010979e-04   -1.511988232689047e-01   -1.331284898445144e-01   +8.099127220149353e-02   +3.204509225664513e-01   -6.152673673817896e-02   -2.461579632363342e-02   -5.531077171849050e-01   +3.655368377949071e-01   -1.696472938933799e-02   -3.436779200688683e-02   -2.167648697019170e-01; +1.146114897096897e-01   -2.799353757517161e-01   +3.528857587734324e-01   +1.825170137884438e-01   -5.731086922013486e-01   +9.654707639209159e-02   +1.460978940802869e-01   +6.681144393945396e-02   +1.149635747514779e-01   +2.718331571035476e-02   -3.035461670012221e-01   +2.966110521614646e-01; +2.735821712023261e-01   +3.375484904636258e-02   -7.245244379260897e-02   +3.985087323532463e-01   +5.130788459470622e-01   +2.416489142188250e-01   -5.214106286325384e-01   +1.097357150961642e-02   +5.088593201838101e-01   +2.783515048281437e-01   -1.853980554825966e-01   +2.969184956390326e-01; +3.605332932371444e-01   +2.152484138464767e-01   +5.842912238667227e-01   +6.247674632485418e-02   +2.278647390238376e-01   -2.911845179394118e-01   -5.097005139607935e-01   -7.169041594808709e-02   +8.488419565367882e-02   +2.218866086702205e-01   -3.772662191998740e-01   -4.031461925240554e-01; +2.453841085184090e-01   +2.402773600283385e-01   +3.642349313580997e-01   -1.242921756870199e-01   +3.905482179549298e-01   +1.040308179838808e-01   +3.552445905535688e-01   +2.307434141607445e-01   -7.718631483359308e-02   +1.808546690772905e-01   +3.383593697928289e-03   -7.587871864749852e-01; -2.097833415637616e-02   -2.034800832883374e-01   -2.960258145594992e-01   -2.153459536414198e-01   +6.541253682970454e-01   -6.495432291432975e-01   -5.340667387831021e-01   -8.073630270464666e-02   +2.913140604719500e-01   +1.271409910231962e-01   +4.032672273063480e-01   +9.551964044539243e-03; +4.750407126373410e-01   +2.501075625858309e-01   +1.011827264969023e-01   +7.320817043294560e-02   +9.577633907589173e-02   -2.302060410740019e-01   +1.276324219955536e-01   -7.729067070891615e-02   +5.306551742080297e-02   +6.068786801434107e-01   +3.879268287415307e-01   -2.278736465025040e-01];
L2E_Input1_iAMPA_netcon = [-1.369323857519171e-01   +3.036465899948390e-01   -5.504276416688323e-01   +1.116658835427871e-01   +2.186079045052683e-01   -2.204425134589029e-01   +2.726645406177070e-01   +1.284513411749463e-01];
L2I_Input2_iAMPA_netcon = [-8.506525715885300e-01   +8.203179363983139e-02   +5.338706187764639e-01   -2.406070434883639e-01   -5.436651107458366e-01   -5.350767218213165e-02   +6.309922553239384e-01   -3.329451270408991e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
