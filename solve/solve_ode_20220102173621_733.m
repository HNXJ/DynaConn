function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.935914894454339e-01   +4.458018664028884e-01   +4.010317924792342e-01   +1.077418457129712e-01   +4.302806324285710e-01   +2.582790487387658e-01   +4.624532240891289e-01   +3.417512300569319e-01   +4.616256235361978e-01   +2.419943909680036e-01   -1.046888802187308e-02   +4.209018598721949e-01   +2.424406396276040e-01   +6.053371220529501e-01   +3.166690254719429e-01   +2.054607599433832e-02; +1.310048366392054e-01   +2.271666079205885e-01   +2.114226727208516e-01   +4.440649538344564e-01   +2.794580476489453e-01   +1.703136676250366e-01   +4.807243761998411e-01   +5.478942556247597e-01   +1.058634665538625e-01   +1.272431005090537e-01   +1.101961028028540e-01   +3.544820475676314e-01   +3.938280967150866e-01   +2.968102682023538e-01   +5.479417144889499e-01   +5.965599610265619e-01; +5.601935805293279e-01   +2.168323786338612e-01   +5.450712275350035e-01   +5.439714860475462e-01   +1.674203999007810e-01   +2.683143975147380e-01   +5.778569138611356e-01   +2.724699863887399e-01   +5.308800511630930e-02   +5.622994224826598e-01   +4.627375930226893e-02   +2.464226405778533e-01   +1.514354829625645e-01   +5.739785406919623e-01   +5.099519629898907e-01   +2.435960124284939e-01; +5.902783702905243e-01   +1.709854414784378e-01   +7.550037691494859e-03   +5.097478544423965e-01   +6.289956957824092e-01   +3.272156923950761e-01   +1.632305461303382e-01   +4.846894896604908e-01   +6.299702515431137e-01   +2.832359708089507e-01   +5.919642928106382e-01   +8.598207340174595e-03   +5.694292716746501e-01   +2.869695288308482e-01   +6.154350525539497e-01   +5.697520617493237e-01; +1.424556948300925e-01   +1.090835851216296e-01   +3.355229267279354e-01   +4.022598189886083e-01   +4.530890801924264e-01   +2.605696817347864e-01   +1.075645136307715e-01   +1.130857406547501e-01   +1.309863840956604e-01   +3.568350568133639e-01   +5.783382886424340e-01   +7.356559298427481e-02   +2.365597648940927e-01   +4.912149380835088e-01   -1.504458477342289e-03   +1.727041224744603e-01; +2.886829798918890e-01   +5.512286621563964e-01   +5.625895999532335e-01   +1.539574171775827e-01   +6.759240489341714e-02   +3.903175722605734e-02   +1.839454281128016e-01   +2.529592641482134e-01   +4.165701829563797e-01   +5.378917957213439e-01   +2.629012180903180e-01   +6.529636593275463e-02   +4.155892695324396e-01   +3.172795651902795e-01   +1.527906512052101e-01   +5.968794347681203e-01; +3.103015457859584e-01   +5.493928951435663e-01   +5.323806569566246e-01   +6.979000892848364e-03   +5.337568880243952e-01   +4.430625361310622e-01   +3.512554414966199e-01   +2.074297497336835e-02   +5.423542593883615e-01   +1.487627840233708e-01   +8.121707831182999e-02   +2.694349728389147e-01   +7.760723474272667e-02   +3.698670925093671e-01   +3.541346609664023e-01   +4.977030510718439e-01; +4.775800150028835e-01   +1.931884860105028e-01   +9.818696927976359e-02   +4.009592838854237e-01   +4.452752570928910e-01   +3.454569710791525e-01   +1.169932119570598e-01   +3.995712072768431e-01   +1.933890512102540e-01   +1.720920803775791e-01   +4.620045162423599e-01   +4.071750075047382e-01   +4.419701090099158e-01   +3.330501809483160e-01   +1.461130845492742e-01   +4.834864568596681e-01; +4.705082201676121e-01   +4.341112057522837e-01   +3.848505780871542e-01   +1.984050841168963e-02   +5.719815320104185e-01   +1.778638561039452e-01   +6.571828627117123e-01   +2.329344389011689e-01   +2.518061896696960e-02   +2.330531525928709e-01   +1.824020801767409e-01   +3.626519349179156e-01   +2.428511399998227e-01   +4.197471879262578e-01   +4.848184656373986e-01   +3.125306555796343e-01; +3.394582900965978e-01   +4.853446590489259e-01   +9.658322383599577e-02   +5.260338962331618e-01   +3.831272596395879e-01   +4.813553097713822e-01   +4.504554582633128e-01   +5.255045581694092e-01   +1.228293243584591e-01   +4.109494738366383e-01   +5.805906711832403e-01   +3.456234386489324e-03   +4.731393577387595e-02   +4.116855783300969e-01   +1.279261688575680e-01   +2.429906827775609e-01; +2.887263655628824e-01   +5.754093263523369e-01   +1.765403730952913e-01   +4.137481483646786e-01   +3.947226223031989e-01   +1.361901153049453e-01   +1.485496644394268e-01   +3.141902069385248e-01   +4.357063436689969e-01   +5.403723165679897e-01   +3.749032236891857e-01   +5.293145414595811e-01   +3.857044654893789e-01   +4.917149812622312e-01   +2.706891737545851e-01   +4.261721201851149e-01; +4.296327298029247e-01   +1.272320289209258e-01   +2.197394742970447e-01   +6.145980174615612e-01   +3.254325460179230e-01   +4.743971139676479e-01   +3.380104105005488e-01   +1.420043116609915e-01   +4.985004807553763e-01   +9.139409215539399e-02   +4.229130459534737e-02   +2.931374046803222e-01   +4.496239510124438e-02   +4.411296701845034e-01   +7.053769868411199e-02   +5.172278393380585e-01; +6.120222134844627e-01   +4.625471185624100e-01   +3.691435325619007e-01   +5.898339383437869e-01   +1.296730107334519e-01   +4.104652350149100e-01   +4.307531167564667e-01   +1.118868716658700e-01   +5.732369989892355e-01   +1.787054277935866e-01   +9.808867967297306e-02   +6.342407946169486e-01   +2.874239375641520e-01   +1.938502011696338e-01   +3.684215738210221e-01   +5.186131899282088e-01; +5.543165733922055e-02   +5.907095533751404e-01   +6.930613774015228e-02   +4.009032371937133e-01   +3.385241667281350e-01   +4.670763161477071e-01   +4.686695215092818e-01   +3.516792871446859e-01   +4.793523359927095e-01   +3.198367172273304e-01   +4.432882073234127e-01   +3.182051941211537e-01   +2.415782902859945e-02   +1.689905271569464e-01   +1.086198914046281e-01   +2.364330227042162e-01; +2.624418599021171e-02   +3.197294758292740e-01   +2.946209434646588e-01   +4.655081683897506e-01   +3.140001340870590e-01   +6.187889970330527e-01   +6.971351854510410e-02   +5.112595211653791e-01   +2.729799377919754e-01   +6.496255065363578e-01   +1.854418065299798e-01   +2.781088772063735e-01   +2.450575377376082e-01   +6.351337454956827e-01   +8.158567101944941e-02   +3.285339742576612e-01; +4.238411816128762e-01   +2.129016159541136e-03   +4.787323290688187e-01   +5.102159581104876e-01   +4.622338942502998e-01   +4.071677404638945e-01   +2.141550737696550e-01   +9.861603486563812e-02   +5.206982172360239e-01   +4.508133260500886e-01   +4.378790541337019e-02   +5.127196611348359e-02   +4.463195474969266e-01   +5.663568601841565e-01   +4.534483000564559e-01   +5.554838221151673e-02];
L1E_L1I_iGABA_netcon = [+1.774575067368210e-01   +3.927619622345910e-01   +4.219186768132610e-01   +3.378705247566770e-01   +5.480524904482915e-01   +3.887083902509281e-01   +5.923272890470703e-01   +5.653208953063696e-01   +1.997027334976510e-01   +1.242088065137488e-01   +2.578939298669014e-02   +1.495470068583968e-01   +3.437678170982652e-01   +2.107620073281682e-01   +4.649017165204365e-01   +5.157934116126670e-01; +3.989377637544588e-01   +3.927373723773963e-01   +4.005778765414961e-01   +1.498022520628481e-01   +3.947411812520564e-01   +4.019067462918827e-03   +6.057111808973831e-01   +3.041539820120609e-01   +1.290350521394856e-01   +6.103757308582922e-01   +2.794757320950892e-01   +8.205857404658091e-02   +1.092516287129163e-01   +2.298366002379023e-01   +3.515269938686547e-01   +3.589651236680120e-01; +1.448966635093022e-01   +1.038422141161239e-01   +3.046299942472230e-01   +5.077544631340872e-02   +5.965111190760578e-03   +3.651647595041675e-01   +8.240897514201427e-02   +1.453442109080269e-01   +4.457556644884643e-01   +1.940420385133701e-02   +5.094569722723381e-01   +2.891121580753241e-02   +8.450874383341231e-02   +3.200841918687544e-01   +5.695902517861549e-01   +6.600209329042298e-02; +1.673240953471227e-01   +5.409638130351400e-01   +5.950982494282208e-01   +4.058746522803993e-01   +4.055127570420538e-01   +3.422340321392812e-01   +1.343747776857552e-03   +2.455324248117565e-01   +1.412342677386798e-02   +7.558376323569241e-03   +6.921271388097426e-02   +5.048840305126333e-01   +4.900731891437888e-01   +4.553823021892963e-01   +3.648318696177955e-01   +2.717186601420455e-01; +7.646616620965832e-02   +1.208558272975198e-01   +3.898742284034019e-01   +1.490557447114013e-01   +4.266931974153977e-01   +7.926842484213981e-02   +3.618778789984402e-01   +1.738891895809298e-01   +4.792366692443238e-03   +5.524628481326394e-01   +7.746206644485680e-03   +4.525861087576735e-01   +1.771121313657079e-01   +3.975668171108993e-01   +6.169060230749426e-01   +2.450385789276413e-01; +6.362983464813546e-01   +4.447809782603876e-01   +1.884353620295346e-03   +3.822280266204956e-01   +4.849293238248336e-01   +3.809657603010114e-01   +5.588660330808226e-01   +5.616681403495273e-01   +5.924019738412448e-01   +2.468321607287592e-03   +4.784161090536363e-02   +5.020694824149842e-01   +5.742896466676589e-01   +8.598737074290486e-02   +4.560318179570956e-01   +2.912122032171933e-02; +2.469429949762392e-01   +1.844494464600418e-01   +4.356014916461299e-01   +5.498644612124047e-01   +6.971165175711988e-02   +5.183337984515953e-01   +1.806426286448336e-01   +3.107453221272786e-01   +3.785774512386987e-01   +4.194265646678452e-01   +7.009687760056092e-02   +5.606795015775619e-01   +4.344931753056248e-01   +8.568626521122602e-02   +1.615072527860681e-01   +2.840394013759219e-01; +5.546542579107138e-01   +4.806144274158619e-01   +3.393997209114297e-01   +5.282730432616234e-01   +5.445150933424319e-01   +6.371935863108139e-01   +1.373489694391014e-01   +2.637924891615943e-02   +1.496451228265198e-01   +3.695140819998702e-01   +5.433661401721970e-01   +5.200662253160108e-01   +3.076049540318949e-01   +4.199904825987640e-01   +1.762869201171587e-01   +5.233854565496058e-01; +5.844623372755255e-01   +1.497575284025837e-01   +3.660221452928226e-01   +5.569706982982824e-01   +3.763245050840083e-01   +5.292897162145007e-01   +1.272543997969043e-01   +4.433932919815133e-01   +3.646843456964697e-01   +2.628895094775431e-01   +4.940876675742078e-01   +2.767293980445266e-01   +3.395734209028522e-01   +5.521528693033270e-01   +3.678034067664694e-01   +2.596911302540069e-01; +3.450637366540075e-01   +1.669219947789484e-01   +5.026251963023990e-01   +1.743445263081518e-01   +5.050992368222141e-01   +2.716034396838894e-01   +3.807629464868469e-01   +4.458217047604207e-01   +2.601210307382662e-02   +8.380640952454543e-02   +4.797315533225271e-01   +2.271852007493005e-01   +5.870586180969050e-02   +4.495128914221981e-01   +3.452925796241169e-01   +1.208096619076512e-01; +3.231159420336318e-01   +1.036537677356369e-01   +2.383426600639055e-01   +4.969041114699789e-01   +4.735418096071131e-01   +8.091886238770311e-02   +7.741391584918164e-02   +3.455452549918266e-01   +4.369716384422710e-01   +3.930425181718403e-01   +3.156483308586547e-01   +5.866977124859982e-01   +5.455495297804114e-02   +4.081385936608157e-01   +1.252019529649354e-01   +9.596556803716555e-02; +4.117772740228182e-01   +5.072709772855249e-01   +2.973185027422011e-01   +4.854257681107363e-01   +2.465667432550838e-01   +2.093068612852334e-01   +8.205296859025241e-02   +3.759298840886901e-01   +3.037222095494069e-01   +2.443417422294300e-01   +6.344039328613094e-01   +4.821175708292915e-01   +3.755010719444755e-01   +9.658545060560089e-02   +3.745248650471292e-01   +4.782693364039373e-01; +5.981276547223593e-01   +2.679172373859904e-01   +3.401816053683774e-01   +1.861820972806257e-01   +2.061413240185818e-01   +5.021084526400829e-01   +1.149315084558657e-01   +1.253513956431289e-01   +2.694530155019117e-02   +3.226023178045880e-01   +1.538042602117135e-01   +4.624234548952615e-01   +5.827371859825178e-01   +5.316168926238086e-01   +4.662986695183639e-01   +1.871642294764753e-01; +1.810818619672782e-01   +5.427067765509049e-01   +1.426406659028954e-01   +4.065175763861991e-01   +4.028361099064026e-02   +1.258402195048953e-01   +5.122635271314850e-01   +1.100522815067722e-01   +1.313073019395164e-01   +2.390732900395657e-01   +1.995463085199827e-01   +5.405053290070247e-02   +3.608811661318755e-01   +3.788802449024213e-01   +6.924549060479467e-02   +5.116008785004930e-01; +2.369175813239079e-01   +2.861243793828585e-01   +6.218805629925982e-01   +4.696866451105566e-01   +5.810013571625922e-01   +5.991784684233334e-01   +6.519027013868528e-01   +3.874478559470722e-01   +1.304671329316940e-01   +4.639405098374051e-01   +1.519418441859748e-01   +5.964766056575840e-01   +4.628184098992148e-02   +1.362300322863956e-01   +4.614745200917887e-01   +3.620487896297798e-01; +3.048265421978681e-01   +1.804275968320080e-01   +3.421626020027537e-01   +6.370434774552088e-01   +2.597147611835572e-01   +2.260491032036110e-01   +2.133993555542535e-01   +6.424988844402643e-02   +2.322358196508279e-01   +1.812441707926625e-02   +5.073877600370914e-01   +6.447186434226023e-01   +3.573129463938234e-01   +1.810496960058495e-01   +6.569743736879841e-02   +1.831539489568954e-01];
L2I_L1I_iGABA_netcon = [+5.518217143740426e-01   +3.761225990633330e-01   +5.531097174573132e-01   +2.334233416633527e-01   +7.030876608550621e-02   +3.285499585820492e-01   +4.333728583412326e-01   +3.446054857539722e-01; +4.263431752136392e-01   +4.941519177277627e-01   +1.850959876945258e-01   +3.615802332265164e-01   +3.474432587580794e-02   +4.770295275908034e-01   +5.017633742606612e-01   +1.779685066449965e-01; +3.955332654213968e-01   +4.943681884980349e-01   +2.010307807356550e-01   +5.228110810669839e-01   +3.849246779002613e-01   +5.583523767136561e-01   +5.619414904654637e-01   +4.805387662086837e-01; +3.398629957623692e-01   +4.874787883029300e-01   +5.096381486129775e-01   +3.290222069857691e-01   +1.460991074981359e-01   +5.572548572026810e-01   +1.552894156405309e-01   +3.430715502267686e-01; +1.949302779776197e-01   +2.417095635843872e-01   +4.503206685831893e-01   +4.753245483095769e-01   +4.162207936463868e-01   +3.668601431625624e-01   +2.154916983478479e-01   +3.458649849194286e-01; +2.234001367463865e-01   +4.059254523154369e-02   +5.179536121376713e-01   +5.676737619141096e-01   +5.110745698372454e-01   +2.133079279299533e-02   +1.377638393039479e-01   +4.932532902413195e-01; +3.061153849661034e-01   +1.720457957749027e-01   +1.751885197481266e-01   +6.105838906940956e-01   +2.273982512110712e-01   +1.626389474230586e-01   +3.654783085516951e-01   +4.541118350495179e-01; +2.481160167646231e-01   +3.554300190000051e-01   +5.637036064707244e-01   +4.819459225867070e-01   +4.125800586712995e-01   +5.559616664206558e-01   +1.982428371078740e-01   +2.949024722589620e-01; +9.967203150909380e-02   +5.045153765296108e-01   +2.641038575941804e-02   +2.456478728602322e-01   +4.512822346966118e-01   +1.964212261437773e-01   +6.081844630262814e-01   +4.677007686915721e-02; +6.245426023813527e-01   +5.709032889486666e-01   +2.826150299838191e-01   +2.129796102109309e-01   +5.070532100923157e-01   +1.879294194598091e-01   +3.362890667807642e-01   +6.688435981453678e-02; +1.147211957407536e-01   +4.048624132193525e-01   +2.716802938929472e-01   +3.392605861125642e-01   +8.525948790229604e-02   +1.922553864795299e-01   +2.471631863981338e-01   +2.600266717953915e-01; +1.380622118277161e-01   +8.757092719291348e-02   +5.035922255265246e-01   +1.184859531618639e-01   +3.517258258423610e-01   +3.029746251487608e-01   +4.731084377950019e-01   +3.724753402750419e-01; +5.288661914475492e-01   +4.349882652838380e-01   +5.509225542486961e-01   +1.784949952235815e-01   +5.829865378173656e-01   +4.493266169490707e-01   +8.270408568166288e-03   +1.852798264804904e-01; +1.524971891417519e-01   +3.245972464977765e-01   +5.977727205691913e-01   +6.046064574735681e-01   +5.120418038148198e-01   +3.261188824953118e-01   +8.397623289087215e-02   +5.506479089650410e-01; +8.354641093028585e-02   +2.834300982182077e-01   +4.205703674634821e-01   +3.097690912021727e-01   +5.108234713506584e-01   +2.147094719644771e-01   +5.520334967568821e-01   +1.448882369829185e-01; +2.273639149996069e-01   +4.726106640735783e-01   +4.321915640710511e-01   +5.152451808257665e-01   +3.173668456576258e-01   +5.766868260466741e-01   +3.090626848270445e-01   +6.368682577151411e-01];
L1I_L2I_iGABA_netcon = [+2.624660931804564e-01   +1.422357360800364e-01   +2.359579594088684e-01   +1.335525069483070e-01   +5.962508197216057e-01   +1.971387537350022e-01   +4.795825771799143e-01   +6.077064451744491e-03   +2.830364557773702e-01   +6.204141822122342e-01   +5.097064383414970e-01   +1.545543213645349e-01   +2.429813194324113e-01   +3.055031784274931e-01   +2.134259412525528e-01   +6.411994651341026e-01; +3.424578836567202e-01   +3.131676553163183e-02   +5.109677157916978e-01   +3.237250799049016e-01   +1.011536628794859e-01   +3.716932586105809e-01   +2.437714713778030e-01   +4.040296803259036e-01   +5.718796063047882e-01   +1.627088918832209e-01   +4.663743611523098e-01   +3.858474252679216e-01   +2.843022772969945e-01   +3.054040179845449e-01   +5.619069323836676e-02   +4.248736731331191e-01; +1.687061917608735e-01   +3.428315765185542e-01   +1.626981808358683e-01   +4.524653668626137e-01   +4.755557795475091e-01   +6.187382084637342e-01   +3.978920449228957e-01   +5.286172228744009e-01   +5.741967735562845e-01   +5.539884470448478e-01   +3.780226897954821e-02   +3.405463204149372e-01   +5.343336182217681e-01   +1.025362045446536e-01   +2.350079080032052e-01   +3.686333705553064e-01; +1.290115373103415e-01   +3.775031277375733e-01   +6.172352105215758e-01   +4.638637951943004e-01   +4.977870232223559e-01   +4.272398946942667e-01   +2.746780789057991e-01   +2.869131359844541e-01   +5.228677381980623e-01   +2.119776535459970e-01   +1.151519174643822e-01   +1.861746427834512e-01   +2.564049517800777e-01   +6.200831345651704e-01   +3.567477300095050e-01   +2.064633265119295e-01; +5.351552297253107e-01   +3.006850933525388e-02   +5.091931393795862e-01   +2.940963024331533e-02   +5.356174318652968e-01   +1.276300443642147e-01   +2.714447557739855e-01   +4.238261122470650e-01   +5.663995775910285e-02   +3.164127259424158e-01   +3.757116567298510e-01   +2.959530239659959e-01   +3.693648378240922e-01   +1.505355162527997e-01   +6.433573577315982e-01   +2.267721811232343e-01; +2.605540901728904e-01   +5.486833028241737e-01   +5.680992068674977e-01   +4.631950047804582e-01   +5.458238983573143e-01   +6.312004036254905e-01   +1.297583494925275e-01   +3.478297236036924e-01   +5.072685398749290e-01   +4.267410183112166e-01   +2.289732326861021e-02   +2.652190711775941e-01   +3.062267962093255e-01   +3.354787145965548e-01   +2.842462187941518e-01   +3.518661696981276e-01; +3.634898216420254e-01   +2.906651534855046e-01   +6.420348198581780e-01   +6.467726621069872e-02   +5.686147731264669e-01   +8.241790228080691e-02   +3.120181160383927e-01   +2.495133758998189e-01   +2.759874844117245e-01   +5.716171155716698e-01   +1.102534981382698e-01   +2.924503211884718e-01   +2.779630013421086e-01   +1.668685973906453e-01   +5.253101134530606e-01   +3.010892152713332e-01; +5.179005916651649e-01   +5.622576842897885e-01   +5.082640105161029e-01   +3.672498546239170e-01   +5.748668026263424e-01   +4.587536885826703e-01   +5.993185615258774e-01   +1.778994257409361e-01   +3.998935580550348e-03   +4.598768408269337e-02   +2.929945067951138e-01   +5.389270022395248e-02   +5.548123939496379e-01   +2.454718652170905e-01   +2.011417198742607e-01   +1.926334402442409e-01];
L2E_L1E_iAMPA_netcon = [+3.482362174617603e-01   +1.438764907354099e-01   +5.146222723302555e-01   +1.490932778706175e-01   +3.445112589311624e-01   +3.788686474420926e-01   +7.729390573415248e-02   +5.972781753497783e-01; +3.044053147313612e-01   +5.026575899802919e-01   +5.939873132010995e-01   +4.908545486678451e-01   +1.891277922414583e-01   +1.531868300169683e-01   +2.145609867121021e-01   +6.264808149055529e-01; +4.603145297779692e-01   +1.889392755350148e-01   +6.202955228404472e-01   +2.361241105109106e-01   +4.038455860450250e-01   +3.677674234433784e-01   +4.410323319185371e-01   +2.764437884062585e-02; +3.369803594837398e-01   +2.018849406257066e-01   +2.449731475655553e-01   +6.249446416316191e-02   +3.645469782859743e-01   +4.216535729857500e-01   +3.924084857775519e-02   +5.316265982436401e-01; +4.032546091068374e-01   +4.438173625377996e-01   +5.383237213647213e-01   +3.727099333642971e-01   +1.414577473064391e-01   +3.003868668880164e-01   +8.841322149540015e-02   +2.208442615548788e-01; +4.787729760358254e-01   +6.857587840834209e-02   +4.517664039813969e-01   +1.285729057096869e-01   +3.407352904711159e-01   +6.923011873461672e-02   +1.887695002170224e-01   +1.119958996882501e-01; +3.176112879825362e-01   +3.604283127200662e-01   +3.089500703408924e-01   +4.253450128834141e-01   +1.573892322009144e-01   +2.488624268475383e-01   +5.763114559242843e-01   +3.184327428554810e-01; +5.873030111649180e-01   +3.224335233621653e-01   +3.777694507776753e-02   +2.279011277484725e-01   +3.044553242242116e-01   +6.238648960330118e-01   +1.011823454737728e-01   +5.873707240992556e-01; +4.286660076434471e-01   +1.964985520420101e-02   +4.892955591845998e-01   +5.128562022000369e-02   +4.656413337374014e-01   +4.338520117423325e-01   +5.830937306171698e-01   +1.202184123266512e-01; +2.552059872206695e-01   +6.772669592775676e-02   +2.780012208040693e-01   +2.565839996642546e-01   -3.116327817431293e-03   +1.122403631584833e-01   +4.388559902712822e-01   +2.233347976582692e-01; +2.572624656432927e-01   +1.061588428769105e-01   +5.562868098754947e-01   +6.656043383029624e-02   +2.401501645723966e-01   +4.361676959202105e-01   +3.946229608100927e-01   +3.598345898993848e-01; +3.776138576305454e-02   +6.398584630451242e-01   +6.752645899727647e-02   +1.474179620214475e-01   +1.155397606444571e-01   +3.032791310147399e-01   +1.125283955607563e-01   +3.949863450848964e-01; +3.174212519709978e-01   +2.271411450684598e-01   +1.964930219136857e-01   +1.483482108189025e-01   +2.342871582143026e-01   +6.285525446185742e-01   +1.572721958627007e-01   +5.370303846780214e-01; +6.317558381916291e-02   +3.963510110434487e-02   +5.304342449487695e-01   +2.526635116997756e-01   +5.893334494680506e-02   +1.675350616595848e-01   +3.215108436088045e-02   +3.899351156467137e-02; +2.155653292159250e-01   +2.144857980155304e-01   +5.042104870229870e-01   +1.323753374423426e-01   +3.030325669274032e-01   +5.305637285583554e-01   +7.269624155806231e-02   +5.395037956198863e-01; +5.599896232627321e-01   +2.732593252729534e-01   +1.719636927722192e-01   +2.190168568834204e-02   +5.943072020582999e-01   +5.704886081152265e-01   +1.998201537376001e-01   +5.336139041125008e-01];
L1E_L2E_iAMPA_netcon = [+5.810949359088915e-01   +4.292922151930652e-01   +6.162108282697133e-01   +5.405632966682302e-01   +1.118062550972832e-01   +1.621225917845824e-01   +1.507409340821844e-01   +1.166807887172678e-01   +4.139122194742120e-01   +3.331209927873174e-01   +1.703455312575743e-01   +3.177134313907904e-01   +1.074759911269919e-01   +2.044838576967242e-01   +3.829873557557074e-01   +2.975473381829428e-01; +3.383529340787861e-01   +1.756894685945266e-01   +6.171321629911906e-01   +4.967990293285335e-01   +4.459676071963409e-01   +3.998130649483230e-01   +3.204131186037574e-01   +2.622107966894390e-01   +5.662517025336189e-01   +2.453634444910626e-01   +5.375220092634669e-02   +1.276072688750344e-01   +3.944666470964603e-01   +6.232560850971589e-02   +5.948248586538192e-01   +3.685638739847715e-01; +1.142609132866445e-01   +5.837097257888015e-01   +2.521355263802109e-01   -8.285272425684179e-03   +6.046866366971549e-01   +5.023417056651494e-01   +3.322281915796519e-01   +5.197792936376386e-01   +1.903158325230699e-01   +2.003864707650027e-01   +2.866454902705458e-01   +1.392091439336275e-01   +6.507144704215457e-01   +2.700510813487303e-01   +4.231907183200733e-01   +4.702419143773869e-01; +1.229557342007077e-01   +1.241348528461289e-01   +4.425068405362454e-01   +2.197151147457942e-01   +5.609420126980791e-01   +5.673312913757669e-01   +6.456701469747095e-01   +2.178543766492726e-01   +2.227714814418054e-01   +1.174050367247109e-02   +4.559803569885072e-01   +1.123410326077941e-01   +5.724193932821871e-01   +4.843070540347543e-01   +3.647618660511124e-01   +5.583841487701366e-01; +2.883711278266717e-01   +4.180133698098856e-01   +3.808699502956190e-01   +5.716543888962649e-01   +3.625546698015609e-01   +5.934041456014076e-01   +2.345965391526756e-01   +3.370186536385325e-01   +3.992896356531304e-01   +5.194011410731987e-01   +8.094191854771854e-02   +2.160293658842870e-01   +1.747041486118856e-01   +2.646136607764130e-02   +5.466345972332368e-01   +2.844902312808031e-01; +2.682446131494521e-01   +5.327365117025749e-01   +2.196593715196651e-01   +6.003286281602446e-02   +1.797899945608386e-01   +3.924682416605197e-01   +4.648172409742004e-01   +2.667685745177689e-01   +3.632777954428520e-01   +5.988196227620043e-01   +5.699544703191117e-01   +2.287725589031060e-01   +1.351493966946203e-01   +2.192554806009079e-01   +5.131815239737595e-02   +5.881006947706204e-01; +4.458871753410252e-01   +8.307984981454816e-02   +3.832195418408986e-01   +4.555120252583502e-02   +5.616673574185136e-01   +7.956497358941891e-02   +1.847851826147017e-01   +5.142506197770035e-01   +1.155937012246734e-01   +6.262499568381060e-01   +3.583551759361444e-01   +2.447635369745272e-01   +6.306572530651136e-01   +3.764410879511036e-01   +3.445878450299410e-01   +5.678515114080675e-02; +8.835125354112418e-02   +3.154450271936339e-01   +2.581692994689259e-01   +1.602861384607543e-01   +1.047045593764454e-01   +5.592809763503147e-02   +7.213491234256128e-02   +3.390345746184760e-01   +5.749149076042688e-01   +1.497194643518384e-01   +5.363944540940848e-01   +4.336327737493820e-01   +7.332589110347783e-02   +6.049147524019215e-02   +3.296813278384723e-02   +2.982080400289968e-01];
L2I_L2E_iAMPA_netcon = [+4.631371167152010e-01   +3.531381466122231e-01   +5.459035126323458e-01   +4.977378381385475e-02   +2.469255245232480e-02   +5.068899297671158e-01   +5.221048865387781e-01   +1.881699897753547e-01; +1.866464171681741e-01   +1.413479532566210e-01   +4.195453591720107e-01   +6.344746910464529e-01   +4.867539860425913e-01   +5.661308825897198e-01   +2.373599302774471e-01   +2.948290626245144e-01; +2.906697872334645e-01   +1.919041163765613e-02   +5.929734118038208e-01   +5.531744962316351e-01   +3.747370684093128e-01   +4.239865276297329e-01   +4.160362106822370e-01   +2.999083104481302e-01; +1.001981234784156e-01   +3.990030052543029e-01   +3.654156778245452e-01   +2.649767600850528e-02   +4.594615290293840e-01   +5.999895453738666e-01   +4.678190737715341e-01   +4.971709320037957e-01; +2.525375749468957e-01   +4.111817977331894e-01   +3.383165860470025e-01   -7.616888176168209e-03   +5.800809129587529e-01   +1.500651638980698e-01   +2.092371361180525e-01   +5.315215998526045e-01; +5.628010427885308e-02   +5.020577276204675e-01   +4.832591362384443e-02   +3.079018090782490e-01   +9.114192281931275e-03   +6.483366835983877e-02   +3.791454696099231e-01   +2.182077336832798e-01; +5.019149605081012e-01   +1.284658380834006e-01   +3.895314941179300e-01   +3.891655567941730e-01   +4.490336988488344e-01   +3.033808765263319e-01   +3.214239231356247e-01   +1.850835003177561e-01; +1.552166353312193e-01   +5.477400202011760e-01   +1.402925150232430e-01   +5.702587742802717e-01   +8.747667225856283e-02   +6.203325879294310e-01   +2.384685217022607e-01   +2.665560284723577e-01];
L2E_L2I_iGABA_netcon = [+3.481455719841625e-01   +2.267630662303612e-01   +1.401342465779947e-01   +6.146501689935604e-01   +4.558351710319414e-01   +5.486445663939238e-01   +5.798846375644457e-01   +6.616560025329379e-02; +7.709182215617508e-02   +5.241421099368674e-01   +5.095211777220259e-01   +4.098465428490951e-01   +2.428262086735243e-02   +7.149969279746110e-02   +5.789438656820086e-01   +1.459710256014357e-01; +4.333720952887242e-01   +1.106365416157004e-01   +1.244491296498001e-01   +1.733091451980567e-01   +5.915450498771310e-01   +6.285476513680858e-01   +3.272622494361089e-01   +3.854847968760995e-01; +6.500727326544760e-02   +1.973707497418707e-01   +3.897646830390248e-01   +4.448407982824283e-03   +5.523599041559366e-01   +2.005186659199922e-01   +5.911604439485567e-01   +3.629579969088182e-01; +1.429006854558619e-01   +2.210130594894465e-01   +6.425831267481883e-01   +2.950452434033907e-01   +2.580338065052363e-01   +3.481723864849205e-01   +1.183946593981079e-01   +4.237300531125076e-01; +2.773306266412535e-02   +5.889224352663927e-01   +6.328029554150930e-01   +2.278492650639325e-02   +2.344300254681782e-01   +4.925451582378416e-01   +5.201882212036422e-01   +3.524462222954493e-01; +4.845866861030049e-01   +1.543262791708787e-01   +5.847298361297949e-01   +4.256134552500485e-01   +1.858006298821279e-01   +3.877131816470039e-01   +3.736558170063702e-01   +4.444090768470744e-01; +5.840396588591409e-01   +1.441020497713662e-01   +5.963003595772892e-01   +5.168077893067449e-01   +2.244591479716831e-01   +3.559126167717926e-01   +4.621337799821168e-01   +1.644369168121638e-01];
L3E_L2E_iAMPA_netcon = [+1.512794224831887e-02   +4.989788810559884e-01   +1.034001119466099e-01   +3.032955232209911e-01   +3.802996440767217e-01   +2.181048063534745e-01   +2.518145815548614e-01   +1.698413066972460e-01   +5.068199867614467e-01   +2.955783863029695e-01   +3.710322090585362e-01   +5.496973584165296e-01; +1.734034662087289e-01   +2.640171536840357e-01   +6.426137956220365e-01   +4.842549507601088e-01   +2.826082101944719e-01   +3.962275959385353e-01   +3.755475302046544e-01   +1.184883967866156e-01   +3.973447055212501e-01   +3.868646532588085e-01   +4.708333196802183e-01   +4.979295928272633e-01; +3.419394337684506e-01   +2.632933581806960e-01   +4.068124711747656e-01   +1.376335243605898e-01   +1.844858843576658e-01   +1.616149064250787e-01   +1.760196235357699e-01   +1.139624559194607e-01   +1.971402624348289e-01   +4.560261695291791e-02   +5.005684919884086e-01   +3.105779025479551e-01; +5.686441734451746e-02   +4.957035372883362e-01   +4.944161117699276e-01   +2.903020375577953e-01   +1.960966510413174e-01   +1.195617626137982e-01   +4.055764972125599e-01   +9.917456155502491e-02   +3.175670663254934e-01   +4.470896796611270e-02   +5.019569478476933e-01   +2.470639531549454e-01; +6.023466093243709e-01   +5.226027169073104e-01   +5.201061088971771e-01   +5.350342347484669e-01   +1.388839587967919e-01   +1.982152745742491e-01   +5.688606694186722e-01   +2.522958575817002e-01   +9.163182840811986e-02   +6.203588017573247e-01   +2.322003562509702e-01   +4.054633462887339e-02; +9.724241005423523e-02   +2.316971420212889e-01   +1.770419581289849e-01   +5.823542804636189e-01   +4.933341272930877e-01   +1.138428472903825e-01   +4.245601508835215e-01   +1.282369986634381e-01   +1.405256761159430e-01   +4.883781510367408e-01   +4.331994038159797e-01   +4.118895084197327e-01; +1.031049521608643e-01   +2.561412466474466e-01   +4.245301683007103e-02   +5.719577818208499e-01   +3.359227035144751e-01   +1.337633718400116e-01   +4.649234577610764e-01   +5.154838380113441e-01   +4.330875321746023e-01   +9.875665014091004e-02   +3.104429549996950e-01   +4.619038218318103e-02; +2.815407453346241e-02   +3.946479659143311e-01   +2.826439515420685e-01   +3.626003231452817e-01   +1.149456798117153e-01   +1.155079567861397e-01   +1.703557013076464e-02   +1.282730746566706e-01   +3.624698237524616e-01   +2.977799316110348e-01   +2.646313674657763e-02   +1.406353242758116e-01];
L3I_L2I_iGABA_netcon = [+1.423477387350592e-01   +9.194900997311579e-02   +3.688427303286287e-01   +2.002487481427977e-01   +4.892375402781060e-01   +5.836110752566921e-01   +4.889101180664761e-01   +1.210061474050460e-02   +1.751803066116417e-01   +6.044552597321105e-01   +4.070215325649426e-01   +5.606813021611254e-01; +2.756654380589267e-02   +4.220144885796383e-01   +7.082868845915508e-02   +3.921020161617459e-01   +4.258782183038075e-01   +5.160279615321439e-01   +5.946211622341944e-01   +2.818556036693485e-01   +5.645619479697490e-01   +3.322477771387170e-01   +5.422226053415146e-01   +7.851685054915827e-02; +3.740822440044003e-01   +4.000175134913336e-01   +2.308933499637505e-01   +3.582375006020595e-01   +1.149872788702369e-01   +1.048690842931392e-01   +1.650440208496501e-01   +7.724696314050560e-02   +1.451622793295292e-01   +6.412998587454883e-01   +5.570456551171840e-01   +3.091883915860610e-01; +2.810756526291922e-01   +2.655248189319760e-01   +6.065318069267369e-01   +6.480874232517778e-02   +3.098168639691933e-01   +2.617338255113615e-01   +3.016419332544896e-01   +2.586641512917755e-01   +2.303049159336096e-01   +2.878143748990944e-01   +3.429484349920190e-01   +3.724756729631502e-01; +4.454584715218177e-02   +1.797949845447951e-01   +4.987172899396259e-01   +4.760991245412083e-01   +1.159834745416198e-01   +2.411295161670891e-02   +5.428987520583559e-01   +4.300873188007503e-01   +5.631379787872928e-01   +4.476903350784417e-01   +1.634416947511255e-01   +5.514329749068587e-01; +4.098318462391738e-01   +3.617734657219423e-01   +4.752828021540119e-01   +4.727068629606007e-01   +3.980726187428080e-01   +4.347875854447347e-01   +1.530631832573217e-01   +2.008196777568897e-02   +3.865309647756836e-01   +4.163881274125579e-01   +6.432709183518078e-01   +2.583322922553303e-01; +2.655633775451994e-01   +5.594506568818254e-01   +2.735584749780632e-01   +4.357352150287877e-01   +2.044601139370358e-01   +2.396302392343680e-01   +4.091980365397046e-01   +6.146260311062413e-01   +4.672245218465898e-01   +3.867756363142388e-01   +4.657444368383856e-01   +5.828177959664775e-01; +6.188551807567746e-01   +5.517524472253316e-01   +5.922538550503813e-01   +1.372656136317021e-01   +5.677937147912291e-01   +2.717201694097831e-01   +1.128335839155807e-01   +3.693564262056325e-01   +5.009235412237725e-01   +1.890863537288470e-01   +5.305435025420232e-01   +4.529469076055566e-01];
L2E_L3E_iAMPA_netcon = [+6.309199755587407e-02   -5.935447634396756e-03   +4.616881175370821e-01   +1.491179985822479e-01   +4.187968842261212e-01   +6.208417710158677e-01   +4.216222603568062e-02   +1.335905819531199e-01; +4.879938931344319e-01   +1.392411763881220e-01   +6.377429861932528e-01   +3.088102604343644e-01   +5.719567376490411e-01   +1.341388575312196e-01   +6.171195084653792e-01   +5.295098608934754e-01; +1.503137470346204e-01   +1.387393371178367e-01   +1.203512751838414e-01   +4.501601730405307e-01   +3.663327277115892e-01   +2.718995887536947e-01   +1.980036606606425e-01   +5.950599402534438e-01; +5.275900995627090e-02   +1.512938951710989e-01   +2.331287150109291e-01   +3.500989246890153e-01   +5.327620733127042e-01   +4.182841680719935e-01   +1.951791331145456e-01   +1.897423766016718e-01; +5.113252498194076e-01   +2.304317335686904e-01   +5.620585528787608e-01   +1.898393026217121e-01   +2.288594736175565e-01   +2.628905613135878e-01   +5.191933410076262e-01   +5.782978645191680e-01; +6.028212243330942e-01   +4.899095819102708e-01   +2.208026587017086e-01   +5.415363775341315e-01   +2.831618910344921e-02   +4.916801259502514e-02   +6.123818692371812e-01   +6.186761838501993e-01; +9.930123431573908e-02   +5.816083354838933e-01   +4.297124247757518e-01   +4.375226844473573e-01   +5.920858760384652e-01   +1.666745764119110e-01   +1.499843585230110e-01   +1.776430093561052e-01; +2.165254747298862e-01   +3.528207896395608e-01   +4.313112039494925e-01   +3.576286634764221e-01   +2.269233247517904e-01   +1.891240739125166e-01   +2.542262501693847e-01   +1.951737716451840e-01; +1.638380403836237e-01   +3.318009036383288e-01   +1.961948912581659e-02   +2.222940257943999e-01   +6.162474137622346e-01   +3.983322438576742e-01   +4.749272849349220e-01   +2.863066077730567e-01; +1.587599243943315e-01   +3.478636629802153e-01   +2.794306705005145e-01   +7.509580507922842e-02   +2.851723763216577e-01   +4.707928222865041e-01   +2.724897823569133e-01   +3.172867908804224e-01; +3.317055386468956e-01   +4.045241028864561e-01   +1.187408565760071e-01   +5.852106295435239e-01   +3.438159782684228e-01   +3.089416108254736e-01   +5.970192923913945e-01   +1.059007955000772e-02; +3.780370711253992e-01   +1.522720722700200e-02   +4.434703099867719e-01   +2.520198440329817e-01   +4.148843374947925e-01   +7.368767331164902e-02   +5.886154959259586e-01   +7.367919869894009e-02];
L2I_L3I_iGABA_netcon = [+3.065373545402533e-01   +4.797906558473709e-01   +3.756055160186338e-01   +5.361197527982486e-01   +2.124772457651077e-01   +5.000575850166634e-01   +6.710651883656540e-02   +4.313108027967419e-01; +3.409377594340198e-01   +5.821321959876344e-01   +2.637248667073826e-01   +2.764075035334891e-01   +3.375047581904813e-01   +1.556490536755565e-01   +2.155088202077064e-02   +3.474233066464293e-01; +1.840761793167945e-01   +3.605452576365892e-02   +2.462329292356338e-01   +3.939660312295290e-01   +5.130244001434400e-01   +9.896205057664791e-02   +2.410048544951374e-01   +5.757180808053353e-02; +3.594157166835991e-01   +2.850769064378778e-01   +3.190008577796110e-01   +1.776485702396419e-01   +4.781757540562056e-01   +4.847000887016303e-01   +2.147167766680165e-01   +2.128644207611280e-01; +4.378733793751483e-01   +4.203223937550150e-01   +1.327821520139460e-01   +1.198702836351334e-02   +4.342297121468761e-01   +1.881446155701579e-01   +7.201554812164109e-03   +3.027602488089025e-01; +4.202262010373197e-01   +3.756706665741896e-01   +4.416479348057329e-01   +7.252979899090423e-02   +5.489943573991709e-01   +4.073970902448654e-01   +1.247271420807846e-01   +4.863267701641964e-01; +2.129530965878730e-01   +1.812206557932300e-01   +5.912234020062174e-01   +1.322133874776628e-01   +1.231527069255103e-01   +2.965319506095910e-02   +3.648843106370767e-01   +2.120927704809926e-01; +1.946736660384658e-01   +3.864599576127964e-01   +2.727649046093440e-01   +3.040683512101789e-01   +3.385464639098204e-01   +2.748844332098790e-01   +2.584823088200028e-01   +4.255606896765232e-01; +3.451720409579815e-01   +6.109980112714692e-02   +2.409116747111389e-02   +9.328574378983906e-02   +3.991994572148796e-01   +1.017115893754955e-01   +4.205372782513707e-01   +4.797170805501125e-01; +3.566813659211361e-01   +3.436509115349276e-01   +3.969514645813094e-01   +1.506077057388694e-02   +5.998314199132275e-01   +1.335897654465687e-01   +5.986553168781504e-01   +1.596525649859785e-02; +2.804390087530835e-01   +3.862179263456240e-01   +5.518930586679174e-01   +1.422907853022307e-01   +4.191954451981797e-01   -7.567863599253717e-03   +2.685821177722507e-01   +6.083953339858182e-01; +4.749324211851004e-01   +3.837409238707475e-01   +6.787973292770244e-02   +3.805988710634894e-03   +1.502850086237613e-01   +3.902940372870443e-01   +7.340919424280187e-02   +1.970993846810598e-01];
L3I_L3E_iAMPA_netcon = [+4.579886945613880e-01   +4.877335124731441e-01   +4.118424687270616e-01   +1.627469548550318e-01   +5.540350986784367e-01   +4.747792245435230e-01   +2.454762793052264e-01   +2.295175995080387e-01   +1.100856841746060e-01   +5.345321366715688e-01   +3.712208574110097e-01   +5.208249315935272e-01; +6.175956500205505e-01   +1.051575442994923e-01   +6.598238608515178e-01   +2.790629792866183e-01   +3.740960563797607e-01   +8.398251016113074e-02   +1.255707141910057e-01   +2.398152266879004e-01   +1.414926027737070e-01   +2.372821900507888e-01   +3.226303304869448e-01   +3.867501096167487e-01; +3.202671956656546e-01   +2.858470145845740e-01   +6.272261772680900e-01   +5.356642119786557e-01   +1.175214790007690e-01   +1.283928690419167e-01   +3.083144588340587e-01   +8.780100196163210e-03   +3.664595426485445e-01   +5.118478267752266e-02   +5.370813477481168e-01   +4.485667547349959e-01; +4.059430876552004e-01   +5.389698054255238e-01   +5.012649565955835e-01   +1.356975930706649e-01   +2.450869311783948e-01   +3.332152690229978e-01   +1.211358966088587e-01   +2.121021913414175e-01   +2.373281319431445e-02   +4.362784370538751e-01   +2.856837139923433e-01   +2.067830301067808e-01; +5.712331251720221e-01   +1.185960275013086e-02   +6.897991691393127e-02   +4.640012115889427e-01   +1.451414088122778e-01   +2.706969219316416e-01   +9.726601922011879e-02   +5.312667765385715e-01   +4.934801471022016e-01   +2.428590231993571e-01   +5.705187011138055e-01   +1.055702837765604e-01; +4.051288610624534e-01   +4.571606607048322e-01   +1.593401653098959e-01   +5.257587469651095e-01   +4.212239253223257e-01   +2.352835292024661e-01   +3.736618113053720e-01   +1.849632031290315e-01   +3.210793975624878e-01   +4.191049971614913e-01   +1.282263488395485e-02   +1.058719986727970e-01; +3.262763627890595e-01   +2.300869859554018e-01   +1.599343431209018e-01   +3.847521176802104e-02   +1.222386164932943e-01   +2.261880068567725e-01   +4.358477904458730e-01   +1.061014162917875e-01   +8.085583071273029e-02   +3.981370863041298e-01   +2.404177796471209e-01   +5.751249960382276e-01; +5.449380047810640e-01   +5.591356936780820e-01   +6.110962110797331e-01   +1.598813248493248e-01   +4.299397772520888e-01   +4.151835043356990e-01   +6.488140058792072e-01   +4.049390957682799e-01   +4.159205682241174e-01   +5.579312182515740e-01   +2.014429053222840e-01   +4.954251070208141e-01; +1.596819352599602e-01   +7.817880519679701e-02   +3.000259944463850e-01   +5.915558300866036e-01   +8.127035906827187e-02   +4.226446256625386e-01   +3.106158476279200e-01   +2.355456430317016e-01   +3.635947704620291e-02   +1.945063302183072e-01   +1.722582677615718e-01   +6.018528136689071e-01; +2.988905202898401e-01   +5.327311516182660e-01   +4.814414349661560e-01   +5.269137231081685e-01   +2.369209337790329e-01   +1.735181053088008e-01   +4.321999697859052e-01   +6.126745393077099e-01   +1.670436151842438e-01   +1.822129123652622e-01   +2.323046534637520e-01   +3.736202946097006e-01; +1.734951773268932e-01   +5.851770154075511e-01   +1.316882443155137e-02   +4.502443879564963e-01   +6.180112602610047e-02   +2.384503845492952e-01   +4.537068472932035e-01   +3.592186413849106e-01   +3.159255546640855e-01   +5.341804094941918e-01   +1.707901862781263e-01   +6.087832350598461e-01; +2.507891507237711e-01   +4.260886179096754e-01   +6.367172250870052e-01   +1.231254274532419e-01   +8.682139126124583e-02   +6.301091727309566e-01   +5.103762859051022e-01   +2.538002219334102e-01   +5.057442632478557e-01   +4.165981064058697e-01   +1.731486988120725e-01   +5.174773953993173e-02];
L3E_L3I_iGABA_netcon = [+3.659457855544657e-02   +5.747022601856787e-01   +3.460776264997314e-01   +3.098299045964143e-01   +3.154361698569993e-01   +5.492808527373149e-01   +4.038274618289961e-01   +4.593930259802931e-01   +2.856008126883424e-01   +5.775700117301018e-01   +5.099639481132046e-02   +1.237528494067048e-01; +2.527143647038143e-01   +4.718323718981636e-01   +5.104615504398682e-01   +2.757954240979608e-01   +5.125500402676576e-01   +2.928921408411339e-01   +4.887333894057294e-01   +5.748776786274167e-01   +3.848607799968292e-01   +2.045094490479985e-01   +6.473616594378571e-02   +2.035772939590164e-01; +4.436120139853092e-01   +2.445703083566505e-01   +4.548185299213972e-01   +1.241171481956812e-01   +3.239882140911574e-01   +1.817740025681076e-01   +6.302384240627198e-01   +2.704877795266621e-01   +1.994117446362450e-01   +2.450102654843383e-01   +6.091193265069444e-01   +3.500362979387694e-01; +2.574060052394481e-01   +3.920569388686720e-01   +6.281475872540921e-01   +1.507456794949049e-01   +8.307117041955166e-02   +2.318484211847074e-01   +2.073930658347560e-01   +2.046771718814667e-01   +2.325281701380356e-01   -9.260712996169183e-03   +1.866698988813682e-01   +1.880331631416345e-01; +4.793100013559483e-01   +4.253848061766869e-01   +5.897818748881801e-01   +2.748600018951299e-01   +5.673045781552953e-01   +6.254334722807112e-01   +3.346533004863816e-01   +1.505489799829303e-01   +6.404430672054131e-01   +3.179914651156519e-02   +1.473339093442438e-01   +1.092826186463110e-01; +2.971243683856093e-01   +3.816451971980621e-01   +2.225228244941263e-01   +4.238709053427739e-01   +1.605215888512193e-01   +5.540886840099221e-01   +8.325290695452946e-02   +3.901835406405078e-01   +2.486246038905997e-01   +4.375026702675414e-01   +2.115417622348451e-01   +1.878170445559410e-01; +6.211764044730900e-01   +3.539189765956555e-01   +3.158763693256456e-01   +2.989285760021861e-01   +4.033434646696026e-01   +3.561646494684789e-01   +5.640316351648663e-01   +1.764330048617073e-01   +5.044102719118988e-01   +5.617304030423176e-01   +6.140530738854618e-01   +6.134546488629001e-01; +4.500525082394894e-01   +1.741782520523615e-01   +4.067496066223034e-01   +3.963065463290252e-01   +3.015670448446118e-01   +1.547115002559362e-01   +4.983131121076187e-01   +5.735226543281459e-01   +5.737375489440495e-01   +4.632829161225643e-01   +5.914696387337488e-01   +3.727876068227324e-01; +4.352218467016576e-01   +4.856224906220072e-01   +5.701093865372717e-01   +7.958190388934436e-02   +3.334765789747445e-01   +7.695660596635685e-02   +1.924130734450927e-01   +5.329976041579404e-01   +2.641395393462356e-01   +3.609353968071741e-01   +2.313143068140647e-01   +5.978356562419614e-01; +1.847688779431320e-01   +2.010540467957048e-01   +5.098161342700711e-02   +7.478491093839429e-02   +3.912223296486653e-01   +4.724410690886689e-02   +2.111929683863755e-01   +3.402734864754219e-01   +6.185217009561759e-01   +4.875493429750718e-01   +1.813293116277099e-01   +1.368757398288613e-01; +3.583810483115971e-01   +3.430201720158099e-01   +4.934065210742368e-01   +2.051664185202560e-01   +3.836576488831522e-01   +6.324951280955807e-01   +5.669039561713967e-01   +2.047322724418016e-01   +5.247167798946163e-02   +4.141224229186313e-01   +4.222363734924005e-01   +2.863032658671380e-02; +4.862979406683598e-01   +4.073388597358946e-01   +1.444559833544270e-01   +2.703215760928985e-01   +5.498851187958551e-01   +3.232344487703701e-01   +3.591860271865391e-01   +4.342043281160115e-01   +2.365021359950668e-01   +4.841355629786668e-01   +3.203551631553299e-01   +2.143329139362831e-01];
L2E_Input1_iAMPA_netcon = [+6.507499601634869e-01   +6.374199213400303e-01   +6.361876125653763e-01   +6.608939028359786e-01   +6.360258217136040e-01   +6.327618993070302e-01   +6.347157241581709e-01   +6.411024865477124e-01];
L2I_Input2_iAMPA_netcon = [+6.553377987573830e-01   +6.546921461813506e-01   +6.424160270408384e-01   +6.559497565454500e-01   +6.342675512318161e-01   +6.188001219207456e-01   +6.581150920696875e-01   +6.412055037237401e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
