function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.530313729605647e-01   +6.722949010651226e-01   +8.545445435357353e-01   +2.528795492070907e-01   +3.252764571711924e-01   +6.399583264703589e-01   -2.870261521332748e-02   +3.760776123575868e-01   +3.245522018878355e-01   +1.284117002310801e-01   +3.902849290406505e-01   +1.615390235453323e-01   +3.965952817086769e-01   +2.418782339450634e-01   +2.262179128511275e-01   -8.277261838787299e-03; +5.005500055469114e-02   +8.144480162285747e-01   +7.584539109703575e-01   +6.849829991176863e-01   +3.163858949393804e-01   +6.173611123513570e-01   +6.199031160278704e-01   +1.578534010332639e-01   +9.807411645041482e-02   +7.203808455341082e-01   +5.285898774308109e-01   +6.164765402075416e-01   +4.193301231306580e-01   +2.493712697409594e-01   +5.603041607546715e-01   +3.153244450541080e-01; +2.093516318581194e-01   +2.092564204518393e-01   +4.253365974918021e-01   +4.017929506993260e-01   +6.254604531735621e-01   +4.359737224771446e-01   -7.690467867199152e-02   +6.166967900413067e-01   +3.570982036071310e-01   +4.432827838134911e-01   +7.637422663074869e-01   +2.835644141997719e-01   +3.607809339610234e-01   -8.857213115769168e-02   +3.062075162538092e-01   +8.577477334600074e-01; +1.997213606913185e-01   +6.158760316119556e-01   +1.629925203170030e-01   +2.780763412955419e-01   +7.837906165483945e-01   +7.276498293599923e-01   +1.881802255338810e-01   +5.730624307195150e-01   +6.716514288052344e-01   +2.685129919073773e-02   +1.824077127935963e-01   +7.382215119091809e-01   +4.890015041299958e-01   +2.093619826841589e-01   +5.792522089915147e-01   +4.442191370052193e-01; +5.993042231058242e-02   +6.034839751331512e-01   +7.398534141912969e-01   +6.946098013764841e-01   +4.561815336323216e-01   +3.460272704639138e-01   +3.971417415124417e-01   +2.793931594486109e-01   +2.828388637674908e-01   +4.740950992911839e-01   +1.965439175985988e-01   +6.048804573914918e-01   +3.323517937128506e-01   +7.191467506508675e-01   +1.680144249528729e-01   +7.887434652656659e-01; +1.048801966602069e-01   +1.753932495225234e-01   +7.208410193113381e-01   +7.795876825154880e-01   +5.526427268686196e-01   +8.125476389461355e-01   +2.792751611178095e-01   +3.888609414921015e-01   +7.797210856453816e-01   +8.613941824595470e-01   +7.671880207861780e-01   +1.097082105450453e-01   +3.788217811386485e-01   +1.119901115887451e-01   +8.031116248964354e-01   +3.612677527062225e-01; +3.327225006804412e-01   +6.317062884599349e-01   +6.365591020823441e-02   +3.139153212102519e-01   +6.941498426825898e-01   +4.492904969533346e-01   +3.967336996367147e-01   +5.229009450864057e-01   +8.920347659422319e-01   +8.232181036420104e-01   +6.123845147232513e-01   +1.157272819068244e-01   +3.842163543663475e-01   +3.981116140166790e-01   +5.933105381139295e-01   +7.836256342805779e-01; +5.549518241669459e-01   +6.221200286691601e-01   +7.377102808028904e-01   +3.866030696861366e-01   +5.195170122748307e-01   +5.120079919384758e-01   +8.164218587898590e-02   +4.210901524151363e-01   +9.778014224525677e-01   +7.776625640142122e-01   -1.358235791316348e-02   +6.961392865662959e-01   +6.872980922501815e-01   +5.441585974426105e-01   +2.226285073856180e-01   +7.765789132547242e-01; +4.539124481840923e-01   +2.579573253227173e-02   +2.130640469988669e-01   +1.999980782558915e-02   +3.754637934209648e-01   +1.034651749695449e-01   -9.371148582940934e-03   +5.241537246087974e-01   +5.083182327450076e-01   +7.331982597486451e-01   +6.609675415513189e-01   +4.530550231832453e-01   +2.595211083458147e-01   +1.526332433255073e-01   +8.673454659093992e-01   +7.378104532751196e-01; +5.915202711218575e-01   +5.244738865073565e-01   +4.787071027334124e-01   +2.173990153342999e-01   +4.263748885189846e-01   +2.260504391642445e-01   -1.033772426530395e-02   +2.347139453821248e-01   +1.569362017359819e-02   +7.450804791031618e-01   +1.082593342769738e-03   +1.268941649467498e-01   +2.930152610169044e-01   +7.014023521137955e-01   +2.781524860100191e-01   +6.587946410647108e-01; +3.218264712167082e-01   +3.803477811652373e-02   +8.085700746218951e-03   +2.053620055600330e-01   +7.471556628254487e-01   +5.316806836776268e-01   +1.759711324750032e-01   +2.112484089733274e-01   +1.714348118213034e-01   +8.063266557445395e-01   +1.130728668851144e-01   +7.358936745488490e-01   +5.218417069181404e-01   +7.335779825671200e-01   +1.344690546026997e-03   +5.288809138157594e-02; +1.666281482477850e-01   +5.612850403216714e-02   +8.569377277568737e-01   +5.146648620774358e-01   +6.079666715748427e-01   +4.760006102085407e-01   +6.121709509774115e-01   +2.755945644894126e-01   +6.119688755762650e-01   +1.192347432864783e-01   +2.004051363142056e-01   +7.120212255577820e-01   +2.046388401422443e-02   +4.862735225220009e-01   +3.489428358597310e-01   +3.886389143927026e-02; +3.470916105951978e-01   +3.030375674605660e-01   +5.398489178542206e-01   +2.118317301401025e-01   +1.289515844389586e-01   +3.762246663099219e-01   +4.060733678432735e-01   +6.252808522939558e-01   +2.979112222767467e-01   +8.418838856556600e-01   +2.023230463903939e-01   +3.807216402079064e-01   +2.319989492210633e-01   +2.126492296391291e-01   +2.086049349485140e-01   +1.993737747055951e-01; +1.263314169190319e-01   +8.124635093880996e-01   +6.430113427747065e-01   +6.350603396742203e-01   +7.425980396680942e-01   +5.497338102710380e-01   +2.178499718631959e-01   +6.889693939405072e-01   +4.109160716738963e-01   +4.238843175320006e-01   +6.882626016038846e-01   +5.340833357835814e-01   +5.071921157295682e-01   +4.129955340348260e-01   +6.941557669828281e-02   +3.496079517633454e-01; +1.237553187940404e-01   +2.197610998527625e-01   +3.411547942049001e-02   +3.551354206099024e-01   +2.464766068768646e-01   +6.061207978713751e-02   +6.076820261701006e-01   +2.470214761629537e-01   +6.930818341494395e-01   +4.567021633393927e-01   +8.759480899059188e-02   +6.596885168765571e-01   +5.361219349311657e-01   +1.512570111793907e-01   +6.499558969375164e-01   +1.616078861491723e-01; +4.792201082914331e-01   +1.503458858540912e-01   +2.999815840087096e-01   +6.158032260372028e-01   +4.577369883765551e-01   +5.922379659815530e-01   +2.476833280361022e-01   +1.331209950732515e-01   +5.380671187152672e-01   +3.902895081125423e-01   -2.203052090255172e-03   +3.118031309366455e-01   +1.946097683348663e-01   +8.563371606570325e-01   +8.422443700570020e-01   -3.555680489408966e-02];
L1E_L1I_iGABA_netcon = [-1.956309313445322e-03   +2.606262984481428e-01   +8.977569356660876e-01   +1.483471779284362e-01   +3.868009740336729e-01   +1.449584894487586e-01   +2.486870687108837e-01   +2.162791286481855e-02   +1.694516819622744e-01   +1.417193360488540e-01   +4.270899431663628e-01   +9.095709041978722e-01   +1.499622612056279e-01   +6.580134863852932e-01   +9.277292633510634e-02   +3.907139875986937e-01; +7.660632627107206e-01   +7.236208865951287e-01   +4.859103165598559e-01   +7.770163327273605e-01   +6.212984693065450e-01   +7.598009004998232e-01   +5.786060223431578e-01   +7.279244655434559e-01   +8.146486546480992e-01   +8.911607968384068e-01   +1.614601532348929e-01   +9.852439826851267e-02   +5.145338815947594e-01   +8.512333965610983e-01   +9.480914211241733e-01   +1.788647242146954e-01; +2.302490634322195e-01   +8.040557915347020e-01   +6.732352354571494e-02   +4.597949858882593e-02   +1.113642881213903e-01   +1.975313467621090e-01   +5.292763577362755e-01   +8.610699517594411e-02   +5.009685648024624e-02   +9.627828436974842e-02   +5.346903371622902e-01   +4.091018033396908e-01   +7.552463965307429e-01   +7.240480591344162e-01   +7.983368504128877e-01   +7.677515352207186e-01; +2.964239180486876e-01   +5.480883992329368e-01   +5.798378226305811e-01   +7.517924228262554e-01   +6.762494092324077e-01   +5.728268365993650e-01   +6.627450618428270e-01   +8.454287566805202e-01   +1.207833316884340e-01   +2.451267802809216e-01   +4.382022349781649e-01   +2.881183525143529e-01   +7.761458362607351e-01   +4.684882158238198e-01   +8.720912776969897e-01   +4.920676734168550e-01; +7.211303648984406e-01   +6.031821535255129e-01   +8.888451489075896e-01   +3.524528039393198e-01   +8.449108142614683e-01   +5.096420535561939e-01   +3.503769245619175e-01   +4.401370616221781e-01   +2.361368357284218e-01   +3.113257270409529e-02   +5.534299247664227e-02   +5.889354062808875e-01   +8.372243903965758e-01   +8.038375615480312e-01   +1.878792878191309e-02   +1.601398072106035e-01; +1.639164527821019e-01   -4.202869228273340e-03   +3.261536001928089e-01   +2.037627873359684e-01   +1.000495037002228e-01   +4.117497821142929e-01   +7.981544867957004e-01   +3.122565940097589e-01   +5.288287086177538e-01   +4.583111291757537e-01   +8.696048484170065e-01   +1.043623453755493e-01   +2.130004083116702e-01   +1.908585557082078e-01   +6.814983609126131e-01   +3.370132803166667e-01; +6.918539244345319e-01   +4.759069053959405e-01   +3.162882665618592e-01   +6.715463033256304e-01   +2.777680080520239e-01   +8.093373909365174e-01   +5.691616572578975e-01   +5.863157538782265e-01   +7.904635426232871e-01   +5.562766269209319e-01   +7.831680168335640e-01   +2.403010508685657e-01   +7.168619971790485e-01   +5.653773184529858e-01   +9.083691802062530e-01   +7.752485705067527e-01; +9.168985951549226e-01   +7.978833751488054e-02   +5.903846201406640e-01   +4.523097268701928e-01   +6.376608915482175e-01   +2.249811006923848e-01   +3.111085884325920e-01   +5.122151630596674e-01   +1.965934738115963e-01   +7.845076744639214e-01   +7.015388806912942e-01   +7.642060010148919e-01   +2.416484384313937e-01   +6.457202459131763e-01   +4.646819993459121e-01   +5.975780171870494e-01; +5.452550730273069e-01   +9.682123756913703e-01   +4.419695246342077e-01   +9.052688485130004e-01   +1.606512463091169e-01   +6.162693455345729e-01   +5.374814775423039e-01   +8.690058773407321e-01   +8.850532929173994e-01   +6.123803310614319e-02   +2.100394758840491e-01   +2.415359488743395e-01   +8.989932649088802e-01   +3.674828227454557e-02   +1.057642789710375e-01   +4.265430415803915e-01; +2.074853301840670e-01   +4.097286506494525e-01   +5.366023772684075e-01   +1.932062370397823e-01   +9.005293871949808e-01   +3.787800110878041e-01   +3.350687922891425e-01   +9.450224378182174e-01   +8.453508449251322e-01   +8.430405701723970e-01   +8.191452590890310e-01   +9.233631090663768e-01   +4.387695862848267e-01   +3.964574013289857e-01   +2.998281591783493e-01   +7.505570495809886e-01; +1.608107685566636e-01   +1.689141982887350e-01   +7.184370872276401e-01   +7.646538257125474e-01   +2.107461007715218e-01   +6.247713516274503e-01   +5.543523246839985e-02   +4.188399128179364e-01   +3.792062934948541e-01   +6.217060824739581e-01   +3.224526012851391e-01   +8.484154204594804e-01   +1.258848566929751e-01   +4.749281707387656e-01   +4.071148035721798e-01   +3.810391998862662e-01; +1.789548713130106e-01   +9.040523615577892e-01   +6.599677273989878e-01   +5.430090799849921e-01   +4.189106442756869e-01   +8.205610665244535e-02   +1.098704273016433e-01   +3.711873087488581e-01   +1.816392575940194e-01   +4.813074064111437e-01   +1.958812160586048e-01   +3.574678021620898e-01   +3.668685220072290e-01   +8.417281653329042e-01   +5.211698517929481e-02   +4.518934606813943e-01; +9.179674724475135e-01   +1.620515234994355e-01   +4.570079761034258e-01   +4.863726486195252e-01   +5.195347499603968e-01   +5.690726404776573e-01   +1.502335605441674e-01   +4.460007197962508e-01   +4.261474769722229e-01   +3.256283754011083e-01   +8.969626451352881e-01   +8.840119013226352e-01   +7.511490653463136e-01   +5.464458164049546e-01   +2.723687607062486e-01   +7.040981326321074e-01; +4.474459220082314e-01   +8.319749410381946e-01   +3.282758595098956e-01   +3.746216354830823e-01   +6.814114967162499e-01   +1.886174596392153e-01   +2.578288048821214e-01   +5.790288694380787e-01   +3.150179392770507e-01   +4.777137082073042e-01   +2.039855773926229e-01   +1.368809783685178e-01   +3.020476504569095e-01   +2.461860308038029e-01   +4.950775718520422e-01   +8.570815934867572e-01; +5.675979954440068e-01   +5.860201361085448e-01   +6.323167903365693e-01   +5.745062781314026e-01   +6.509001655286245e-01   +1.117247498850374e-01   +8.326357227192132e-01   +2.230970281317427e-01   +8.208025273962440e-01   +5.259436374388932e-01   +7.213983591279902e-01   +4.826672241668734e-01   +2.576897177098585e-01   +4.664235485514561e-01   +7.694353201100514e-01   +4.398367518695557e-01; +3.746175581645244e-01   +5.553793751659903e-01   +5.779393975402063e-01   +2.788008871053069e-01   +4.223609750660960e-01   +2.933361707756594e-01   +5.028396992175059e-01   +2.187548543538014e-01   +8.260643325070899e-01   +2.381660942028403e-01   +2.638719704240391e-01   +1.505115180901563e-01   +5.144718177898901e-02   +4.032536027188487e-01   +9.664214555458084e-01   +9.287688629495360e-01];
L2I_L1I_iGABA_netcon = [+5.765063093995442e-01   +4.246176771658813e-01   +6.263698440299487e-01   +5.634594656417197e-01   +8.621851010847498e-01   +5.309500330873795e-01   +8.751976585051160e-01   +1.018733016589025e-01; +4.382662617512723e-01   +1.671829336980234e-01   +2.700453269311883e-01   +9.155823863227428e-01   +2.169625996304822e-01   +4.639251921323945e-02   +7.612609144320964e-01   +5.739579779817051e-01; +9.963627541309010e-01   +5.276827148263301e-01   +5.604067834178090e-01   +7.053218991543913e-01   +6.572329441858609e-01   +6.069768884393690e-01   +2.715858011749360e-01   +2.912976682325648e-01; +3.285870284590919e-01   +2.030375346697234e-01   +8.501697481998096e-01   +4.362581341482630e-01   +7.390356424578074e-01   +3.706363273002631e-01   +8.993477669778206e-01   +1.663871335980090e-01; +6.783829213555237e-01   +4.836219909519499e-01   +5.716437410697043e-01   +1.656273679451171e-01   +9.380193154732496e-01   +3.032915395088432e-01   +5.123007433784499e-01   +1.565474280088040e-01; +5.705576121581596e-01   +5.565674187739451e-01   +7.060092706374819e-01   +1.191915662655047e-01   +1.880192810449798e-01   +8.433361788605234e-01   +8.374154240926893e-01   +5.341201563607508e-01; +7.747006206674191e-01   +5.334705402256339e-01   +2.511552556148559e-01   +2.273702836583895e-01   +7.080520629530959e-01   +1.438741151056285e-01   +6.434352429920902e-01   +4.030024378293622e-01; +8.976400468633339e-01   +4.214745039723635e-01   +6.373122446736690e-01   +7.995681373339439e-01   +1.333332674584406e-01   +4.384638823329546e-01   +4.137851845468640e-01   +2.310662320857352e-01; +6.653131507763527e-01   +1.356135315194808e-01   +4.112776973144022e-01   -4.194451470980023e-02   +7.045416512693063e-01   +3.801909076608626e-01   +7.420685501089783e-01   +6.636451536556935e-01; +4.509383731333255e-01   +7.590318155048378e-01   +6.053238042910762e-01   +7.576048157490637e-01   +4.040959348976824e-01   +8.089932787054224e-01   +7.660180896048291e-01   +1.956219558684208e-01; +5.095497816568397e-01   +4.998124487337051e-01   +5.195227436557320e-01   +3.683902728446842e-01   +8.670013745802278e-02   +7.859553538564015e-01   +5.586433801032110e-01   +3.700258264756661e-01; +7.058130051991736e-02   +3.625985616392226e-01   +4.131011205285651e-01   +4.039707907708877e-01   +4.124147496549893e-01   +4.651374778944045e-01   +2.646884774457428e-01   +5.325848058960503e-01; +3.628534143038055e-01   +1.371811657237500e-01   +6.522301824839232e-01   +7.557229528358815e-01   +2.057137446604337e-01   +6.621584736445386e-01   +3.519653861163462e-01   +7.316108466047998e-01; +4.015136687186586e-01   +4.421533319454808e-01   +6.141985797936854e-01   +3.072103554668854e-01   +7.354076596743867e-01   +3.467115146361168e-01   +3.506503640203745e-01   +2.899608591614816e-01; +5.821828728490258e-01   +1.409250894494359e-01   +2.196544011847637e-01   +2.047155872683188e-01   +5.479922394666916e-01   +5.376005833891527e-01   +2.709300712602071e-01   +6.848210360521810e-01; +7.262958869238119e-01   +1.042830279666571e-01   +6.893927578674187e-01   +3.737794577426348e-01   +3.629737366829026e-01   +5.201320162258515e-01   +1.978630685593254e-01   +2.886100793567019e-01];
L1I_L2I_iGABA_netcon = [+4.917168227140432e-01   +1.442506384545922e-01   +7.630441291625160e-01   +2.471755537510724e-01   +4.681349879449921e-01   +2.753819744961214e-01   +8.827092120760681e-01   +2.845366480895390e-01   +5.292914527014778e-01   +7.902716536657748e-01   +3.945462056113948e-01   +3.779540456166661e-01   -7.739837460160688e-02   +6.724153805113188e-01   +6.089504142152188e-01   +3.990626401157963e-01; +3.373263485483436e-02   +2.200678901195908e-02   +3.016403975435850e-01   +2.793488709225160e-01   +8.778363473491702e-01   +3.937849392355359e-01   +3.046083000673401e-01   +1.798946344571981e-01   +4.934398150078094e-01   +1.927856009482139e-01   +2.935946961480744e-01   +2.969001032957838e-01   +9.813719653452605e-01   +2.207727071687286e-01   +7.534921505004348e-01   +2.543753939605167e-01; +3.057109374785208e-01   +6.274828914977026e-01   +2.839546806073753e-01   +6.945267393542669e-01   +2.542449408525158e-01   +5.625554482384103e-01   +8.036131818277927e-01   +9.467222210079042e-02   +7.593696057292441e-01   +4.598042201182538e-01   +5.355786790616432e-01   +8.160437444617571e-01   +9.024424546159168e-01   +6.385084986597107e-01   +3.666219962881113e-01   +2.473060170741211e-01; +9.019325287713125e-01   +9.846433666785760e-02   +6.764873582422883e-01   +9.357214104151350e-01   +4.328005679558389e-01   +8.587608568151287e-01   +6.071054418094619e-01   -4.043083964475743e-02   -5.580094933817440e-02   +2.839188630586771e-01   +4.103512719902606e-01   +4.582813830493126e-01   +2.703363925257824e-01   +4.754594706253466e-01   +2.223414262555780e-01   +2.459526222890546e-02; +8.566007719305408e-01   +8.227813479200672e-01   +7.855423666908787e-01   +5.680166408552790e-01   +2.633464686999670e-01   +6.734392900132911e-01   +6.462855772438099e-01   +6.406538097982764e-01   +8.768468217409890e-02   +7.240396471908352e-01   +2.537089482832289e-01   +5.208927499040024e-01   +6.957067652217291e-02   +2.077948407477194e-01   +6.898053280871734e-01   +9.551555257287917e-01; +5.292064327451899e-01   +5.732655952342565e-01   +1.206657041328313e-01   +3.161124804064314e-01   +8.999134540390352e-01   +1.246692065796427e-01   +6.998112629536231e-01   +6.510480272103414e-01   +4.570570726872354e-01   +7.459575255795997e-01   +3.779495045571403e-01   +5.083746954216716e-01   +9.000471818676028e-01   +1.326649670533977e-01   +2.401749691783212e-01   +1.322013094166111e-01; +8.961677473862154e-01   +7.744092025477624e-02   +3.990055813443840e-01   +2.966012124345077e-01   +5.176183162104762e-01   +8.514047251725527e-01   +8.410817756031765e-02   +2.053136926237804e-01   +8.010014616461647e-01   +9.417578538914850e-01   +8.969849390610812e-01   +8.183769026708602e-01   +1.361694855741672e-01   +1.992024428585214e-01   +9.410169258231599e-03   +5.486045181640806e-01; +9.185713593932513e-01   +3.819195459691868e-01   -5.352620766851783e-02   +8.300557267511803e-01   +1.487386104382082e-01   +8.927987556904864e-01   +7.712392870238457e-01   +6.274613124644254e-02   +8.708774008057661e-01   +3.197290547430166e-02   +8.966997122773060e-01   +4.934148253465387e-04   +7.993255127039330e-01   +9.290394064984521e-02   +9.519262703037891e-01   +6.426678096456769e-01];
L2E_L1E_iAMPA_netcon = [+3.077962983963143e-01   +9.212888377823419e-01   +5.829268076774448e-01   +6.241046953031822e-02   +3.819733583326377e-01   +3.162024494429463e-01   +8.826183557284498e-03   +5.862305942971648e-01; +1.915050074765832e-01   +1.405875385443826e-01   +7.079679306995018e-01   +8.690295227876749e-01   +3.784011225798650e-01   +5.395459539242673e-01   +1.617185377045297e-01   +7.651995698667310e-02; +4.820853672731145e-01   +8.385112672817445e-01   +7.200500928411462e-01   +2.271941096418557e-02   +6.221426332843674e-01   +2.070806818134946e-02   +4.151635841684695e-01   +8.685810856701505e-01; +3.955868483413484e-01   +6.416362656723410e-01   +6.642606358840757e-02   +5.304090717536725e-01   +2.635834868768500e-01   +5.891934074072455e-01   +1.439666227718473e-01   +4.704598250029640e-01; +8.381036138160056e-01   +6.098805600011725e-01   +7.242875534721018e-01   +5.097618719624746e-01   +6.976618310338760e-01   +3.472048357407019e-01   +4.042151302330143e-01   +4.819142639758184e-01; +4.402722712510740e-01   +5.955341174440050e-01   +5.234714353031179e-02   +6.206179689442789e-01   +6.315796779282963e-01   +8.386953645845749e-01   +2.642124052772002e-01   +7.276828201975673e-02; +4.548365845438608e-01   +2.958998314384356e-01   +2.665123185681383e-01   +3.902868410969871e-01   +4.083221004376583e-01   +2.452825206187559e-01   +5.561499027872114e-01   +2.606054498899465e-01; +7.613317696154561e-01   +1.553758933849008e-01   -1.068558856448600e-01   +9.740739731328524e-01   +5.427356358379860e-01   +3.696951993711328e-01   +5.929494695409770e-01   +6.234443649545136e-01; +7.765820670242410e-01   +6.216301172777866e-01   +7.004250713437185e-01   +1.048210562019683e-01   +3.464748481432916e-01   +1.915495020858272e-01   +1.160103282998546e-01   +9.576090244221553e-01; +2.965749337663172e-02   +1.904622905127211e-01   +1.880788178265143e-01   +2.184684431198262e-01   +9.168040492752554e-02   +5.234834797971142e-01   +8.667155268488502e-01   +8.683904760491055e-01; +1.493336567288676e-02   +1.870414422345971e-01   +5.627736091941975e-01   +3.977120871537034e-01   +2.147818781365100e-01   +4.078384030297574e-01   +2.487896535908522e-01   +6.393503645068775e-01; +3.591451300297245e-01   +5.739900880322801e-01   +5.865037443054471e-01   +4.468800790019191e-01   +6.726226683232345e-01   +3.431628016676907e-01   +6.374356000148036e-01   +5.196420945251671e-01; +6.815061582854414e-01   +7.168385259310689e-01   +5.517038673937159e-01   +1.844133788859620e-01   +2.078287618355451e-01   +9.554890376597677e-02   +1.089201402015892e-01   +5.436934059406824e-01; +6.835490233146645e-01   +7.923775551463197e-01   +1.396649295366017e-01   +8.901761792608528e-01   +5.121381036645296e-01   +7.486712429600980e-01   +4.330691090522253e-02   +1.458544728726217e-01; +8.902545540373022e-01   +2.029801736997627e-01   +5.139397308745924e-01   +5.852846786012394e-01   +3.728926354047681e-01   +1.881568085475910e-01   +6.742641835860865e-01   +4.895934943714261e-01; +7.656259124750596e-01   +5.640392626149946e-01   +7.404868014713435e-01   +3.237330219665614e-01   +5.180134622074839e-01   +8.527544899021169e-01   +6.682614022892626e-01   +1.853651858950107e-01];
L1E_L2E_iAMPA_netcon = [+7.386517203774829e-01   +3.824110390060532e-01   +5.589441563290887e-01   +1.801017259190558e-01   +8.760696316212541e-01   +1.815770713607182e-01   +4.865973066548296e-01   +4.442492781450583e-01   +9.743487939398210e-01   +5.214270252947614e-01   +5.079878739821406e-01   +4.340667270599843e-01   +5.379334594996186e-01   +3.483037534713859e-01   +5.807366047779878e-01   +3.209406135499018e-01; +7.024628792477265e-01   +1.824452650350157e-01   +1.958791437651062e-01   +5.348463998540796e-01   +7.856912133091634e-01   +5.550329978253871e-01   +8.943219976174908e-01   +2.651422688681156e-01   +3.040666528224762e-01   +2.876387403030634e-01   +5.954255078042611e-01   +5.713300385746964e-01   +5.615458144527035e-01   +8.429540529604899e-01   +3.930053373500850e-01   +5.079819126898474e-01; +7.578215563113764e-01   +6.816479535529890e-02   +1.202080465354040e-01   +9.028408063400580e-01   +2.312877601354924e-01   +3.573447084353772e-01   +8.030948831831608e-01   +3.405670132158362e-01   +2.217295820759917e-01   +5.976069703079621e-01   +7.485005351225449e-01   +4.091233792042299e-01   +7.484769013938987e-01   +8.093036413127688e-01   +7.341059993360737e-01   +5.662707480701302e-01; +5.853672641943470e-01   +7.599265489952192e-02   +4.897747902376947e-01   +3.395513262144766e-01   +3.737047258606436e-01   +7.752586816755159e-01   +2.720306155409586e-01   +1.379578977235993e-01   +5.446110642905813e-01   +5.035973241645426e-01   +4.168164926702263e-01   +9.379897585117963e-01   +6.302258092265879e-01   +2.750488166323502e-03   +7.024755306702193e-01   +7.697328060646336e-01; -7.441933526942545e-03   +2.237045529150060e-01   +1.414491109425481e-01   +6.365281238735770e-01   +1.322713594017780e-01   +3.645988349201445e-01   +9.329058538936212e-01   +3.331570160594923e-01   +1.439759359646842e-01   +7.118551338493353e-01   +1.076799248510984e-01   +4.626614770626408e-01   +8.987525551144696e-03   +5.899334689341580e-01   +4.413475568136307e-01   +2.146525952047452e-01; +5.883030335324102e-01   +3.579386371104398e-01   +4.269863146101053e-01   -1.474093514107988e-01   +8.107051582761463e-01   +1.142841937292882e-01   +4.362678869821300e-01   +2.039949671878347e-01   +7.049035419824234e-01   +2.420323148899635e-02   +7.062886555936193e-01   -2.590572638262339e-03   +6.744703344978167e-01   +4.907232183872089e-01   +7.145139342843271e-01   +2.916756715137109e-01; +2.435466843618082e-01   +6.791778051169828e-01   +3.393425390218971e-01   +3.510122203066637e-01   +2.557107583330009e-01   +7.713148102967652e-01   +9.408840435786423e-01   +3.341347274811485e-01   +6.210512402202544e-01   +7.047818627634931e-01   +2.025436216352303e-01   +9.505195302740563e-02   +8.052892964077360e-02   +3.164046913515981e-01   +2.669586778331431e-01   +7.546478814517010e-01; +1.396340269322549e-01   +3.751321887236264e-01   +2.533697814064190e-01   +4.733478053188840e-01   +1.000000000000000e+00   +4.372973650015665e-01   +8.808977299718389e-01   +7.745078294598478e-01   +3.637482770906780e-01   +6.201117618797036e-02   +3.565244208281504e-01   +4.235867588516436e-01   +3.166730571210501e-01   +6.420932753359710e-01   -2.658228709789390e-02   +4.757466669181122e-01];
L2I_L2E_iAMPA_netcon = [+3.116125329646644e-01   +2.559456322562954e-01   +3.239155301642946e-01   +5.511339640832943e-01   +1.440508356768548e-01   +7.916769086644119e-01   +6.707036703787547e-01   +2.007230717417975e-01; +4.458455207332473e-01   +1.938356171830878e-01   +6.884664672106394e-01   +2.549962859438234e-01   +6.360141177206318e-01   +8.575543361639466e-01   +3.208490619933969e-02   +4.677190852879866e-01; +6.323802942805331e-01   -3.619026973312969e-02   +6.366422087838919e-01   +5.568519780213120e-01   +1.712293338503578e-01   +6.049228415830357e-01   +7.727616338909421e-01   +2.135154087901766e-01; +4.881860633810096e-01   +2.012726823767148e-01   +1.376600008258512e-02   +9.227726059907719e-01   +3.264836459257981e-01   +6.296193886524961e-01   +9.483391410765292e-01   +1.675360689518936e-01; +8.732742460907446e-02   +3.629079590842958e-01   +4.629010929788235e-01   +8.256339046171358e-01   +8.904818753699640e-01   +5.245949571098540e-01   +7.250303902025683e-01   +1.458214532476112e-01; +8.293595938721253e-01   +4.670174168665409e-01   +8.528035797901424e-01   +8.781258247915305e-01   +6.842501135388603e-01   +7.968975653873711e-01   +8.020388829225572e-01   +5.395855763646377e-01; +6.668397030642691e-02   +5.295516218526644e-01   +8.575271043933353e-01   +7.819180411703976e-01   +1.093993172705361e-01   +6.976133456827135e-01   +1.666871483552859e-01   +8.801276456475843e-02; +5.964578168962503e-01   +4.253362715202754e-01   +1.403279088001664e-01   +3.387060936445906e-01   +6.526910772792628e-01   +4.315250889927953e-01   +9.826393359756368e-01   +7.137557195471238e-01];
L2E_L2I_iGABA_netcon = [+3.820983546223394e-01   +6.250015786372020e-01   +5.553419172743952e-01   +6.727311063546418e-03   +4.524192447055638e-01   +5.064208357476503e-01   +2.563326825037743e-01   +6.815429707651455e-01; +5.211501614712842e-01   +2.631128667589279e-01   +1.009011528550991e-01   +5.169868581002880e-01   +4.875750326266058e-01   +6.403597704249933e-01   +5.267736341870877e-01   +4.418707644289394e-01; +5.917782379237438e-01   +6.194156227303621e-01   +4.228727708788305e-01   +6.478884687962080e-01   +3.301671793851159e-01   +3.091697471691606e-01   +1.116325977352870e-01   +9.341303772491644e-01; +6.683462029909836e-01   +5.959687507936091e-01   +4.442357597153666e-01   +8.576487795385611e-01   +2.594397218650860e-01   +5.190283986782365e-02   +1.369073811596585e-01   +4.098243320916282e-01; +5.047838514628198e-01   +7.493528862698029e-01   +4.832787475929009e-01   +7.109489801465699e-01   +4.330875681753908e-01   +7.823470032588853e-01   +6.205392038801140e-01   +3.970905025606063e-01; +3.429632913534204e-01   +2.177170125528314e-01   +4.116285033702778e-01   +3.848677828402711e-01   +7.440039184131518e-01   +8.203371317272499e-01   -5.294756174136188e-03   +3.977309732666133e-01; +1.023116596679697e-01   +4.483270862948792e-01   +8.293672778058289e-01   +5.488758196099359e-01   +5.301102320036047e-01   +3.688415260087788e-01   +9.159262694238214e-01   -1.360418409982531e-01; +8.918630763713001e-01   +5.891297673429249e-01   +8.225902173651642e-01   +5.289843479616326e-01   +9.182945008846088e-01   +5.720465788805013e-01   +3.200478970779399e-01   +3.054885111328055e-01];
L3E_L2E_iAMPA_netcon = [+2.758944204827639e-01   +8.453378284518868e-01   +4.678231821132667e-01   +6.246700473449980e-01   +1.804216777960379e-01   +4.255887248307781e-01   +2.826432977532142e-01   +6.896164203890294e-02   +1.476044040509640e-01   +4.953759289992763e-01   +1.280108039561314e-01   +4.852881866274178e-01; +3.182964412035379e-01   +4.148633512757788e-01   +1.281050208932421e-01   +2.558020433950097e-01   +5.494843651716059e-01   +8.748933169741617e-01   +7.433662698942156e-01   +5.190707135111521e-01   +2.316821902607867e-01   +1.549079955667012e-02   -2.463117744971783e-02   +7.782637731105420e-02; +7.404324672587157e-01   +3.453366479412747e-01   +4.719993488825541e-01   +1.169628101025926e-01   +8.371944120351149e-01   +8.793679993425779e-01   +5.386206944932229e-01   +6.243559353952873e-01   +7.127529431055738e-01   +2.658209487309217e-01   +3.279252540838089e-01   +9.138695072949844e-01; +9.716115961002039e-02   +4.154282742793987e-01   +2.595589063851753e-01   +7.899981005028255e-01   +4.749653870386255e-01   +5.901901460417659e-01   +8.407792869601832e-01   +3.410167035537705e-01   +8.130390943377499e-01   +7.397338879441229e-01   +4.091625443274993e-01   +1.390492963471072e-01; +1.469885016515156e-01   +7.218478068553181e-01   +3.987472999637032e-01   +5.908672420790982e-02   +1.542874317816983e-01   +8.788198921133453e-01   -3.098145704901099e-02   +5.621237143424332e-01   +1.021745381775028e-01   +8.499790789331731e-01   +2.056800398532281e-01   +1.843182369287918e-01; +3.034331949286330e-01   +3.968030746111074e-01   +7.959698953503747e-01   +9.259046464571814e-01   +3.736927179206434e-01   +8.666284564313973e-01   +4.163600096709399e-02   +3.098893281690301e-01   +5.099875207545976e-01   +7.429961498825551e-01   +5.327130400720299e-01   +7.953993970907540e-01; +2.423514064208912e-01   +4.561998758407855e-01   +5.038339444673404e-01   +1.667216249069078e-01   +6.608072192546186e-01   +4.822519817024248e-01   +6.870509290380584e-01   +1.354160011546995e-01   +3.474289768930243e-01   +4.441210847277124e-01   +9.656579550802257e-01   +6.864259550741372e-01; +5.568319204454473e-01   -3.912208171789096e-02   +3.558243367510327e-01   +1.147435678648775e-01   +7.886766365314006e-03   +8.519583789158245e-01   +3.443417498912241e-01   +4.405391524249928e-01   +8.803766485934283e-01   +9.805162576291505e-01   +8.512978656887020e-01   +2.216734401256403e-01];
L3I_L2I_iGABA_netcon = [-2.155875184575118e-02   +3.688447648498635e-02   +9.235828359671280e-02   +6.067125583506308e-01   -1.848107151901807e-02   +5.082960949076254e-01   +7.592125798423378e-01   +4.203534118142546e-01   +3.803928810118468e-01   +9.082544839310469e-01   +8.033876796874301e-01   +6.591022402850610e-01; +4.017614664678200e-01   +3.628868842745160e-01   +2.839822579004643e-01   -4.853753657831848e-02   +5.032715436154104e-01   +6.051081586662598e-01   +4.819160657320676e-01   +8.789381427851353e-01   +1.945215229973114e-01   +9.340746667866275e-01   +1.970604689866521e-01   +5.595530430204017e-01; +3.261858700412290e-01   +5.716652684456407e-01   +2.829533087981056e-01   +7.534258564751611e-01   +2.421102244654141e-01   +8.353194453001741e-01   +8.483833017886745e-01   +8.901473646240687e-02   +6.533557120407311e-01   +4.234154091780843e-01   +1.379932546914207e-01   +5.881962176286173e-01; +6.029961833636197e-01   +9.530013992460160e-01   +2.351387741228596e-01   +1.816175537002494e-01   +1.714102198396801e-01   +5.679497054016367e-01   +1.435535286978575e-01   +1.817845151181825e-01   +9.597424820630618e-02   +3.894038462424532e-01   +5.194418245474985e-01   +7.238050858113063e-01; +9.235447457746465e-01   +1.008073094269566e-01   +4.641551895116821e-01   +8.989697154974117e-01   +4.372228047631664e-01   +8.592614817360117e-01   +1.406215752971873e-01   +4.808166935945652e-01   +5.560473509435543e-01   +7.015286411758856e-01   +7.151011631758498e-01   +4.326842164083389e-01; +8.789084104827858e-01   +2.004624234267084e-01   +1.308080821639571e-01   +6.934716799766890e-01   +8.410739804447671e-01   +7.519570721716743e-01   +9.098435941392313e-01   +5.910046224229459e-01   +1.189781405557796e-01   +8.016925454715860e-01   +3.336503908488528e-01   +5.539251215141777e-01; +4.261922935178213e-02   +4.846510505503175e-01   +8.628181988167473e-01   +5.964356631123332e-01   +9.370006281531080e-01   +7.131145997825268e-01   +7.596013444527142e-01   +7.308111838725549e-01   +5.717883071001308e-01   +3.711238607960046e-01   +3.182738521271585e-01   +4.678773849049732e-01; +4.054487031355046e-01   -3.575032343610939e-03   +7.726398159050830e-01   +2.166701392861330e-01   +3.902821741614904e-01   +8.143285690815882e-02   -3.813008415661837e-02   +8.091211480833664e-01   +4.072138712855761e-01   +5.060841808778849e-02   +7.300556643752188e-01   +4.679853147324287e-03];
L2E_L3E_iAMPA_netcon = [+8.791642299852077e-01   +1.904448734704092e-01   +4.278337385449166e-01   +7.546973169998130e-01   -4.970266957111230e-02   +5.851359105755252e-01   +7.754081023395842e-01   +1.546474148762186e-01; +3.649154236543081e-01   +4.738329905884958e-01   +6.785570993031661e-01   +5.745304197365123e-01   +2.749893421731252e-01   +1.272667648189551e-01   +7.867772756069251e-01   +3.953675394128149e-02; +5.974353917177366e-01   +4.588829259407484e-01   +8.635571921650618e-01   +5.429792717663466e-01   +8.963013023916639e-01   +4.606053120775267e-01   +9.649391591927916e-01   +4.108797796133722e-01; +1.975216590124450e-01   +9.061978522145413e-01   +8.405063420888328e-01   +3.222380833003810e-01   +2.733985362959764e-01   +9.458826632817634e-01   +2.245162466168322e-01   +4.436605593203856e-01; +7.761069213782087e-02   +2.512562556311025e-01   +7.119453724702401e-01   -8.436236910715174e-02   +2.507328013492359e-01   +5.004142947256701e-01   +4.355589610601938e-01   +5.709223532673703e-01; +3.387520157189774e-01   +8.343594858327890e-01   +2.154278316763917e-01   +7.736700345553177e-01   +5.690320666611661e-02   -2.140176248467440e-02   +4.739207073226819e-01   +1.850220701881306e-01; +4.106045094174418e-01   +7.437330065136156e-01   +6.932397491569049e-01   +2.585060113037642e-01   +7.225370292798492e-01   +1.842616542138027e-01   +6.803344540887899e-01   +8.311503281100013e-01; -6.102291420498045e-02   +4.660737134786683e-01   +8.559622480773219e-01   +4.099486751917393e-01   +1.062162475222458e-01   +6.976371396144844e-01   +8.912879585209484e-02   +3.337302192067551e-01; +1.000000000000000e+00   +8.816951897301299e-01   +9.677968046238671e-02   +1.539804331094340e-01   +5.486440153498206e-02   +8.542471192205169e-01   +2.524373615496276e-01   +8.638009991691179e-01; +1.240691646772330e-01   +3.789289636293909e-01   +7.375914544304749e-01   +3.089880412256323e-01   +3.862066585152179e-01   +8.285363388198480e-01   +1.288830829198385e-01   +8.196710207600584e-01; +6.649905408666625e-01   +3.361756269698495e-01   +3.356955891997493e-01   +2.665581633474935e-01   +9.651276143722710e-02   +3.120145283873558e-01   +1.761745730259055e-01   +1.793444062169494e-01; +1.108936070032186e-01   +5.754794954933022e-01   +8.224683706688941e-01   +4.571094079919191e-01   -9.637891051200873e-02   +6.702587813136884e-01   +7.863464357891504e-01   +7.059702949886892e-01];
L2I_L3I_iGABA_netcon = [+3.365375553471525e-01   +7.122022915477971e-01   +3.333433611201456e-01   +6.431199659557993e-01   +5.426049335767030e-01   +3.007068862880444e-01   +3.998318118257687e-01   +4.706128376372288e-01; +3.392888303106953e-01   +5.473726421256463e-02   +4.563524734513028e-02   +8.087542940397390e-01   +7.353461318754496e-01   -3.264884642928960e-02   +9.694410546014913e-02   +6.050872863342476e-01; +3.218227574884452e-01   +5.601058352560223e-01   +3.610410972240182e-01   +3.075666766881512e-02   +7.705082834016591e-01   +6.795102906443679e-01   +2.171179736844015e-01   +5.337511444853449e-02; +5.599208537467024e-01   +7.991349836191013e-01   +5.147573626094706e-01   +4.738365848006946e-01   +5.199952205634083e-01   +6.157109137821088e-01   +3.938361623967344e-01   +7.166157508196108e-01; +3.377845584543063e-02   -9.982657235612230e-04   -8.985476577844690e-03   +6.806536106976490e-01   +1.890131261312423e-01   +6.451665201514677e-01   +4.332148021135506e-01   +2.103608326841905e-01; +5.433176405114912e-01   +4.369834110236119e-01   +4.409735617919913e-01   +6.872867361824837e-01   +2.986563777951230e-01   +8.386609271595588e-01   +5.248798440755625e-01   +1.652523446441112e-01; +2.548219844968983e-01   -5.155482875083267e-02   +3.553351465532907e-01   +9.804694823474834e-01   +7.995952216930702e-01   +1.776355963491945e-02   +3.020759636484682e-01   +8.406263175426140e-01; +2.375833998013818e-01   +8.853346820639398e-01   +8.857069981531107e-01   +9.218382634356070e-01   +5.194320994220145e-01   +1.365552347647060e-01   +6.476089208068548e-01   +4.325561122149853e-02; +2.435092418001946e-01   +4.954344602637190e-01   +2.562365165737545e-01   +1.950050686483295e-01   +4.300638941250591e-01   +3.981943482408955e-01   +5.919039419991791e-01   +4.830630061861150e-01; +3.919170477522077e-01   +1.731728130169387e-01   +1.575531966445970e-01   +3.604570596361104e-01   +8.946985256462779e-01   +4.779799760300382e-01   +5.043569226581405e-01   +9.394151050319274e-01; +4.979120261832864e-01   +7.311364154755212e-02   +2.469329023122868e-01   +5.889420622909632e-01   +4.809003013614738e-01   +7.066082165645009e-01   +9.623847550654885e-01   +6.317699089728449e-01; +4.009225619070180e-01   +1.355838050396200e-01   +6.665427863505311e-01   +3.635420639257216e-01   +1.584943928002233e-01   +2.356073388467156e-03   +3.594805450539341e-01   +5.714266362908785e-01];
L3I_L3E_iAMPA_netcon = [+1.366004720995525e-01   +5.748455491352840e-01   +6.651810351617898e-02   +1.848591552665385e-01   +1.751096345404844e-01   +6.913047541981076e-01   +6.299106631414605e-02   +3.414440617487401e-01   +4.397618747612278e-01   +3.647522540366594e-01   +5.030520960286442e-01   +8.993759497372544e-01; +2.647056943475735e-01   +7.435261485690997e-01   +2.137596645259686e-01   +2.723942998352210e-01   +6.986346631307998e-01   +4.846687659173800e-01   +3.420079687790983e-01   +3.657561087513309e-01   +6.605952900761562e-01   +2.401381691422601e-01   +6.550373281371329e-01   +2.290838477221227e-01; +4.348554876157580e-01   +2.823746145068983e-01   +7.135325045498759e-01   +8.290879776969540e-01   +5.882692433010553e-01   +6.293618607439672e-01   +9.733097830331123e-01   +4.412217259549497e-01   +3.068592834070103e-01   +4.037721140104807e-01   +8.231247264396074e-01   +8.118899243302911e-01; +5.164422124798471e-01   +1.030442919576729e-01   +5.481282825716602e-01   +7.151366486681560e-01   +4.317999957770934e-01   +6.045043691174574e-01   +5.280342120717205e-01   +6.667088102117189e-01   +4.439426965550811e-01   +1.666353666657749e-01   +3.446609626173254e-01   +4.790551953241846e-01; +8.731610508005703e-01   +7.613532468967593e-01   +5.310825120401477e-01   +4.790967955353634e-01   +1.782543342049957e-01   +2.493772303817369e-01   -5.332179408559519e-02   +2.588917687775282e-01   -2.079163127129406e-02   +2.027138144974520e-01   +7.747152000121745e-03   +4.316630037706148e-01; +3.341514004706883e-01   +1.250209014899054e-01   +6.281331257108358e-01   +4.657659008937264e-01   +9.271246420827433e-01   +5.518657458665771e-01   +2.296663819825593e-01   +2.012054637903742e-01   +1.628125672222815e-01   +5.412676080976669e-01   +2.489524438797732e-01   +1.222563661951147e-01; +5.419453804854463e-01   +3.140491850535854e-01   +7.665335330031718e-01   +8.586816454363402e-01   +1.497826212810608e-01   +1.149852127706103e-01   +3.588188135887860e-01   +5.042459308714816e-02   +8.684746907289095e-01   +6.987316357666539e-01   +3.326255954242644e-01   -1.372748556947620e-02; +2.852843433611888e-01   +4.089825783960950e-01   +2.874433808330881e-01   +6.134602856363612e-01   +7.758685911399610e-01   +2.054624347455040e-01   +3.460738249618388e-01   +2.503758114644835e-01   +2.721487145068954e-01   +2.555965813521014e-01   +5.838922393361752e-01   +4.916147381178875e-01; +3.963308811226001e-01   +4.231234478963343e-01   +3.984714200083432e-01   +6.080498304553437e-01   +5.872998294564297e-01   -4.979027104633792e-02   +1.288627916536033e-01   +5.369182245557928e-02   +3.532437083503435e-01   +2.137304005823479e-01   +7.508050404230017e-01   +9.168317074971603e-01; +7.400349160095399e-01   +5.725713591497480e-01   +5.397514013104574e-01   +4.318645690350672e-01   +4.171711135028690e-01   +3.282208544374256e-01   +4.990590253047503e-03   +6.536548806407120e-01   +1.071801307134926e-01   +8.217651724738899e-01   +3.789147453536901e-01   +1.379242939648009e-01; +1.165533716525949e-01   +2.693680951034484e-01   +5.400009502858586e-01   +1.857165484215780e-01   +2.474735931038892e-02   +5.005407812187087e-01   +4.307951751784157e-02   +7.646102925595974e-01   +6.894552815539565e-01   +2.225436949331891e-01   +5.999231977405369e-01   +3.098063318740968e-01; +6.140030108715917e-01   +6.862817462357418e-01   +4.201635285176696e-01   +5.534734931090680e-01   +6.561361669904451e-01   +3.555252881918524e-01   +3.204617475195283e-01   +8.724757255760539e-01   +5.407227787339692e-01   +2.611255874677436e-01   +4.299675433604578e-01   +4.450973209802606e-01];
L3E_L3I_iGABA_netcon = [+3.493412973763182e-01   +7.824690216314892e-01   +6.480350523222010e-01   +9.345935398801234e-01   +4.958748867976590e-01   +6.976405411087304e-02   +2.941818730784415e-01   +6.303169162989765e-01   +6.571804997884250e-01   +3.496062710577053e-01   +4.458421215826136e-01   +3.181989149720075e-01; +8.788604060332266e-01   +3.215001860133288e-01   +5.740132853788862e-01   +9.531307304407154e-02   +8.481088974678912e-01   +3.949708942378033e-01   +8.503572133221478e-01   +5.806980768818504e-01   +5.210498464866669e-01   +7.946020309025763e-01   +2.426240713169778e-01   +4.897600270219575e-01; +7.257536551054615e-01   +3.889732840379073e-01   +4.442761454277953e-01   +5.366060236639328e-01   +5.666047835189758e-01   +5.229655654946804e-01   +2.234829864486303e-01   +8.954269861109836e-01   +4.982575980282298e-01   +1.922583901144076e-01   +8.063456063078702e-01   +8.859952297989029e-01; +2.129872125571863e-01   +6.052060467226257e-01   +2.516765342076005e-01   +2.961225318806362e-01   +1.325978286127109e-01   +6.007306787844050e-01   +3.106556705433746e-01   +8.941375182751571e-02   +2.217125538407401e-01   +5.004448195619933e-01   +7.438954710777639e-01   +6.169843711749449e-01; +3.421175412639484e-01   +6.173444360491974e-01   +5.605923905796384e-01   +3.199139313420792e-01   +1.493647268602061e-01   +7.074486797796846e-01   +8.382960846917307e-01   +3.051021581923095e-01   +1.826406031385774e-01   +7.644630041341379e-01   +5.962664334107336e-01   +2.584250509215821e-01; +4.101089342059211e-01   +7.736591411747409e-01   +6.910966453081046e-01   +5.069843357475610e-01   +7.408828767713380e-01   +8.573972466513058e-02   +3.288138567386865e-01   +2.146626452407151e-01   +8.888089474297187e-01   +9.056236111646566e-01   +8.150148456515306e-01   +2.566640125227582e-01; +6.145800139047757e-01   +7.541707358952681e-01   +1.934073574664829e-01   +6.446380903496118e-02   +4.134079081102014e-01   +5.648217439525552e-01   +6.373804081450271e-01   +1.811535556552664e-01   +9.006707860844857e-01   +6.156283013422508e-01   -2.888131941004680e-02   +2.964913236283782e-01; +5.144535463336966e-01   +3.910166792038228e-01   +9.041994701149569e-01   +4.840548913706592e-01   +1.496372662387934e-01   +3.845185369938464e-02   +6.027825643872023e-01   +1.086758224070571e-02   +6.159658210890870e-01   +8.046094539014653e-01   +2.961549939906719e-01   +9.790950266080373e-01; +2.844863819912588e-01   +5.561830103451937e-01   +2.871804778864128e-01   +7.377705163436478e-01   +7.629261449609239e-01   +1.328022323610035e-01   +3.577428299648707e-01   +6.265801437333750e-01   +6.211598891754321e-01   +7.487933775621026e-01   +6.928745561765862e-01   +6.365275433741685e-01; +7.141177205855846e-02   +1.108782845615485e-01   +3.181541590880573e-01   +5.281749717642615e-01   +6.327657270791710e-01   +1.907365596598539e-01   +2.865273037346756e-02   +3.213403328494894e-01   +7.013668187669876e-01   +1.895360946649068e-01   +5.798501184459471e-01   +7.619894317138377e-02; +8.953885990553978e-01   +7.482543001723271e-02   +6.807835465105162e-01   +4.829405714759236e-01   +3.671095946054648e-01   +8.235378514252414e-01   +1.328156096711402e-01   +8.362188433024996e-01   +2.601240160182710e-01   +8.833062972612948e-01   +5.370229150411722e-01   +7.272266443950660e-01; +6.613427969682026e-01   +8.295079863486373e-01   +5.213749059457411e-01   +8.301747448669182e-01   +8.202931715282170e-01   +4.930040928250849e-01   +8.806675073156716e-01   +8.810925861976071e-01   +5.257609599437483e-01   +7.816529135180936e-01   +4.691096594040439e-01   +9.387556274463893e-01];
L2E_Input1_iAMPA_netcon = [+9.118365718923583e-01   +9.727940990243963e-01   +8.704684617358998e-01   +9.172921982217312e-01   +8.387124272014479e-01   +9.730910123311092e-01   +9.313354083861890e-01   +9.142922177507898e-01];
L2I_Input2_iAMPA_netcon = [+8.809903795409547e-01   +8.838959866690999e-01   +1.000000000000000e+00   +8.707897799018958e-01   +8.704540330867421e-01   +8.566929668770926e-01   +9.015150689649423e-01   +9.239365891137430e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
