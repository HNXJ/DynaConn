function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+8.102728574861011e-02   +1.290903167117541e-01   +5.206170784161422e-01   +3.075470293433499e-01   +5.171538875919350e-01   +3.843409167959195e-01   +3.869222139902550e-01   +5.552252584769670e-01   +6.206824945852552e-01   +1.127684607019207e-01   +2.440348037898491e-01   +3.523938922222037e-01   +1.677772760503914e-01   +4.469930950920176e-01   +2.555292248902618e-01   +5.863227054225487e-01; +1.953651627063050e-02   +9.144468915054663e-03   +9.675847085526972e-02   +2.084082434572257e-01   +4.566274208257292e-01   +6.012789430192454e-01   +3.452302077448655e-01   +3.640644829582635e-01   +2.736895003922188e-01   +1.567499757614330e-01   +3.099308024863390e-01   +5.379118711658828e-01   +3.763918202474335e-02   +3.776789027789741e-01   +2.459196609156386e-01   +6.178874069309924e-01; +2.448342406404440e-01   +3.703509697505846e-01   +2.660179153942464e-01   +4.346390647663529e-01   +8.027168717370461e-03   +1.578435773355515e-01   +4.914286454174179e-01   +2.061876711978188e-01   +3.086267893801967e-01   +2.560492834076296e-01   +6.247199851611569e-01   +1.656806536574507e-01   +5.203265209511005e-01   +4.270111024027241e-01   +4.861074927151027e-02   +6.356154575446198e-01; +2.641365285585219e-01   +3.811115348981282e-01   +2.698690881972495e-01   +5.287228669366841e-01   +1.555736430643485e-01   +5.453218158115432e-01   +3.855224758469364e-02   +3.138339539766825e-01   +1.327478106234985e-01   +5.459604102380352e-01   +2.472399459598601e-01   +1.173514359647636e-01   +4.561193464410880e-01   +5.004827954240174e-01   +6.282057007817138e-01   +6.569233323725597e-03; +5.778521942543825e-01   +2.469012375081189e-01   +1.109588891566152e-01   +3.183497680431931e-01   +8.217685797441726e-02   +4.816715615150964e-01   +2.670340025953606e-01   +3.193573034814512e-01   +4.469828317485652e-01   +9.733145855241183e-02   +1.792958862883361e-01   +1.419943319449623e-02   +1.763957667958960e-01   +5.710465770012225e-01   +2.280336772261691e-01   +5.628114769013340e-01; +2.995426060818769e-01   +7.982527339724207e-02   +1.325943795939976e-01   +4.124241236676228e-01   +5.129668171236258e-01   +6.248329261436432e-01   +5.878918706477076e-01   +1.253228819288841e-01   +5.841985501475921e-01   +5.398492923055026e-01   +5.288983094526311e-01   +4.555775577865684e-01   +5.535129047571361e-01   +2.421350923731469e-01   +6.436936120152732e-02   +4.479467652228938e-01; +1.030617347929050e-01   +1.916173936729816e-01   +3.429749705883292e-01   +3.298743752190889e-01   +4.654625237744598e-01   +4.167869232127130e-01   +1.965071341295855e-01   +9.602011289582722e-02   +3.699577134642112e-02   +7.461526634515518e-02   +1.610873774171788e-01   +3.523281403743417e-01   +5.088277691119442e-01   +4.055746697955410e-02   +3.956848982453008e-01   +1.570134773760621e-01; +3.430450943492693e-01   +7.648736099077992e-02   +3.437702817372503e-01   +3.418234142758796e-01   +1.144372472648830e-01   +5.569996888372605e-01   +4.669971267666161e-01   +2.838616446999488e-01   +5.527198616546134e-01   +3.289241494490599e-01   +9.008478238975592e-02   +6.209984273350535e-01   +4.103624911353932e-01   +1.709004253872572e-01   +5.434864528430688e-01   +3.469126023078060e-01; +3.061863166462789e-01   +4.760447613338379e-01   +5.739910189759225e-01   +5.966078980602004e-01   +4.504830334968873e-03   +5.861726349773221e-01   +4.197886321156969e-01   +5.408657344973786e-01   +2.696167033182643e-01   +3.245006138360632e-02   +2.014818672581256e-01   +2.853859139636039e-02   +1.555569037528364e-01   +3.689062592738451e-01   +4.079259864596795e-01   +4.925522368013936e-01; +2.067352087644539e-01   +4.172821008100471e-01   +2.524655376721365e-01   +3.395091131985099e-01   +1.354035560869089e-01   +1.639242230152105e-01   +2.514848768251998e-01   +5.256013406347458e-02   +6.044913794443024e-01   +6.284582152035850e-01   +5.338916805090906e-01   +6.030859790004611e-01   +5.937196830041636e-01   +4.843216709258371e-01   +5.607596162684483e-01   +2.557934703125407e-01; +3.170315065420057e-01   +4.324233529228184e-01   +2.602146101620350e-01   +2.634829227872455e-01   +2.943545773586867e-01   +1.945403231544572e-01   +3.032471878914948e-02   +3.948431889173640e-01   +1.216098099830172e-01   +3.224277079102538e-01   +3.456750792776889e-01   +3.533948191069070e-01   +8.846607748803217e-02   +1.520707374595006e-01   +6.092435604281538e-01   +5.465437869723373e-01; +2.388877256720423e-01   +1.896114113846545e-01   +3.082662484257881e-01   +5.115210577587969e-02   +1.892989934943135e-01   +3.407195824771411e-01   +3.124660689313171e-01   +4.788780631516180e-01   +1.635604358441602e-01   +2.836633236612432e-01   +5.558353299749500e-01   +2.066563488110219e-01   +4.286707674506338e-01   +3.796316952308144e-01   +3.225891374436262e-01   +3.694656185671957e-02; +4.144346577057541e-01   +5.011104078213819e-01   +2.206585603124462e-01   +5.172656557160717e-01   +1.543892068420631e-01   +1.356543891212501e-02   +5.260704669882649e-01   +5.689062953809971e-01   +3.361819196622903e-01   +1.783022066800598e-01   +5.422778960652446e-01   +5.080750125825559e-01   +3.183247845771224e-01   +4.309936148952581e-01   +5.121040314842517e-01   +6.294619476909196e-01; +2.663000183013594e-01   +3.847370717720901e-01   +7.949863975981732e-02   +2.773039251520661e-02   +4.438143357312129e-01   +5.648889513793955e-01   +6.810997988705089e-02   +4.563920986921067e-01   +1.252073599639362e-01   +3.828716187745564e-01   +1.309702292799237e-01   +3.530818036150900e-01   +5.329414670011080e-01   +6.210576827367018e-01   +6.554693848381893e-02   +1.597722315450149e-01; +3.769606779821956e-01   +5.648648535776085e-01   +4.117216730406548e-01   +9.710906306757147e-02   +7.781980240198424e-02   +5.052372321300673e-01   +6.196864154382289e-01   +5.225102411003787e-01   +3.304395563551625e-01   +3.911293574278196e-01   +5.077775289219668e-01   +3.693909588676518e-01   +3.551426105998972e-01   +5.770085652872721e-01   +3.156700606644934e-01   +2.655428400230619e-01; +1.121547273875850e-01   +5.026076249505407e-02   +5.999807702836962e-01   +4.161250287157507e-01   +4.239540239529018e-01   +4.764291476249138e-01   +1.795890320898580e-01   +4.808235067802479e-01   +5.730329864383026e-01   -2.121157515702575e-03   +4.132032914529714e-01   +5.830334318838556e-01   +3.894450132253781e-01   +2.801033446682126e-01   +5.433524090166779e-01   +3.400609186432255e-01];
L1E_L1I_iGABA_netcon = [+2.926853357302535e-01   +6.412924161662801e-01   +2.315437942683937e-01   +3.323765015693328e-01   +5.986491329675744e-02   +3.467003939517252e-01   +1.007943888566867e-02   +3.609101257350959e-01   +3.434341377596341e-01   +1.486184867394722e-02   +3.265327307359138e-01   +2.456301485871714e-01   +2.202694290498841e-02   +2.070412576644245e-01   +6.074832917236520e-01   +6.242102198716333e-01; +2.083179149873438e-01   +2.932960771161283e-01   +2.993008833661525e-01   +1.715671567758229e-01   +1.161962537323377e-01   +1.957794354362150e-01   +3.158211821606431e-02   +2.732898116857851e-01   +5.889963377071374e-01   +3.238161821527317e-01   +6.172696926208981e-01   +3.683866454052481e-01   +3.282064650142318e-01   +1.069680749802499e-01   +2.869066849175928e-02   +9.740732118606414e-02; +1.145032127832030e-01   +1.238602753094272e-01   +6.710775228916449e-02   +3.575092955113677e-02   +4.922560654381395e-01   +5.966675836676941e-01   +5.937834513730079e-01   +2.672514032457453e-01   +1.121040027935730e-01   +3.849096290212836e-01   +3.840872494982048e-03   +5.050543579565965e-01   +4.758024419257382e-01   +1.163546897235472e-01   +4.943362998045484e-02   +2.473632862970293e-01; +3.464279455941058e-02   +3.444482185007224e-01   +1.652706198302080e-01   +4.688194039664179e-01   +9.383493781244484e-02   +2.721024222044356e-01   +2.755512505903765e-01   +3.940863112870893e-01   +2.803698217849621e-01   +1.872878924049034e-01   +3.661038238427185e-03   +5.179108784997571e-01   -6.602159054639540e-03   +3.977115741933712e-01   +4.831242279826508e-01   +8.906823068028558e-02; +5.731089081823417e-01   +1.047602555031686e-01   +2.090176539157873e-01   +2.816088570491967e-01   +1.920076707334951e-01   +2.309972235748826e-01   +7.982357793464152e-02   +1.218803078622176e-01   +5.435476538044980e-01   +2.887154555691634e-01   +8.983825152858697e-02   +4.740012861106522e-01   +2.388100147524759e-01   +2.159037601294000e-01   +1.194469021925365e-01   +2.744069507194820e-01; +4.807728310411780e-02   +2.809885132051249e-01   +5.460251030380631e-01   +2.539121468623291e-01   +7.730322719231575e-02   +2.347919292595345e-01   +5.775560281815929e-01   +2.549179382248678e-01   +4.800238606518303e-01   +2.807334825567400e-01   +5.683188023799767e-01   +5.557798815389678e-01   +3.397945484078875e-03   +4.805077002510948e-01   +3.078793944275847e-01   +2.647286197555052e-01; +9.570861521617222e-02   +1.310571180166703e-01   +2.028671151514548e-01   +5.961220762803769e-01   +4.300309122217108e-01   +2.646634850552588e-01   +3.297656228753851e-01   +5.717530232376805e-02   +6.350104570822722e-01   +4.533106380663913e-01   +6.034438870543012e-01   +1.242354715223126e-01   +4.147340046946498e-01   +4.604361897026178e-01   +3.529668758171729e-02   +3.786659813306286e-01; +4.957251541267945e-01   +2.926307919515626e-03   +5.502694829146559e-01   +4.216093804675337e-01   +4.835039009172957e-01   +4.516705038110304e-01   +2.313081280304781e-01   +6.783074267567424e-02   +2.464137326872463e-02   +3.224833027443877e-01   +2.182377646709344e-01   +9.274871156626725e-02   +6.270777768720894e-01   +3.837053103096506e-01   +6.109809794107818e-02   +1.838903896377950e-01; +1.353741198965204e-01   +2.189944320422139e-01   +8.886562874414895e-02   +1.240646825012325e-01   +4.256539916452666e-01   +5.681590945106926e-01   +5.748887092786367e-01   +3.796845738202108e-01   +1.200334450575081e-02   +6.058945002442887e-01   +4.976354305594496e-02   +3.857724582462849e-01   +4.607642191495951e-01   +9.109249357739430e-02   +6.730429670449997e-03   +2.422827624063341e-02; +3.612900462186840e-01   +6.273123851815381e-01   +4.762026004434720e-01   +1.370318299677049e-01   +1.842084575419941e-02   +6.328378828539368e-01   +6.288125736281114e-01   +1.616010898172591e-01   +3.057138672780670e-01   +4.888740525910769e-01   +2.926009439389640e-01   +3.839437733834501e-01   +3.422951312287500e-01   -6.674373879859244e-03   +2.188295786112185e-01   +5.545662746941608e-01; +8.888364442970026e-02   +2.866297245938592e-01   +1.626829602260562e-01   +4.940634912744379e-01   +3.996576062545359e-01   +4.577449646843954e-01   +8.969618760921237e-02   +3.863935907035432e-01   +4.787028139202060e-02   +4.544560672152382e-01   +6.994849798511107e-03   +3.988856675575447e-02   +1.119231444737034e-01   +1.873805308820496e-01   +2.554112590794570e-01   +2.186057255177093e-01; +2.350031019209487e-01   +1.622832811329586e-01   +2.455127921501782e-01   +5.152704167847058e-01   +2.292628857380125e-01   +4.340768513246623e-01   +1.930927205936965e-01   +2.890794757022532e-01   +4.863516973701790e-01   +8.317269979353806e-02   +5.337319798147506e-01   +4.989152434250090e-01   +4.655050946652632e-01   +2.679449247972572e-01   +1.027110502596605e-01   +3.104147302107612e-01; +5.740334210421123e-01   +3.454842727857154e-01   +1.681322014668815e-01   +5.288504358320856e-02   +5.843885161951560e-01   +4.303082785345606e-01   +4.006297724515574e-01   +4.314903738539823e-01   +2.590135968010054e-01   +7.676108366398145e-03   +5.736411692778319e-01   +6.348520172424045e-05   +2.967883345307770e-01   +5.099759436255932e-01   +1.683697912143355e-01   +4.010164121553109e-01; +5.004708883305818e-01   +1.506412893972869e-01   +4.231137300796424e-01   +6.112348658884749e-01   +3.662468596293350e-01   +4.809923087715463e-01   +6.075669461640458e-01   +1.708595392126309e-01   +5.108214979049837e-01   +8.136775440571642e-02   +2.302735717058135e-01   +4.727857909934362e-01   +4.588832038215623e-01   +3.382251197045245e-01   +5.957442978992454e-01   +6.260230035389815e-01; +1.055594753777279e-01   +3.122036949432178e-01   +2.757941348503637e-01   +6.044151205192334e-01   +3.923338486652060e-02   +1.008825159925753e-01   +6.308293591629484e-01   +4.198756429844094e-03   +2.847725052651203e-01   +5.059585824194170e-01   +2.519504270238865e-01   +3.477434941892295e-01   +3.862195929620050e-01   +1.034672598479798e-01   +3.479077645675132e-01   +4.503699880890823e-02; +1.652588222116101e-01   +6.156112848448156e-01   +4.576561400614621e-01   +1.467605024673293e-01   +2.571047588527443e-01   +2.411421051911034e-01   +6.716330487645009e-02   +8.575524323910290e-02   +1.903302976545098e-01   +3.282574847102453e-01   +2.470047052683813e-01   +4.433323119302320e-01   +4.875934517277565e-01   +5.103378269583527e-01   +5.485642529042989e-01   +4.439110540432806e-01];
L2I_L1I_iGABA_netcon = [+7.207550087138589e-02   +9.529680378808399e-02   +5.401442418623760e-01   +6.156475818669007e-01   +8.987867423310560e-02   +1.558630000662973e-01   +2.786634513092908e-01   +4.522063982430431e-01; +1.724658638337060e-01   +3.355057083297070e-02   +5.314026244601620e-01   +8.990506719719193e-02   +5.068353544914705e-01   +5.859736177657515e-01   +5.705099306595036e-01   +4.091737759817768e-01; +5.746085369450846e-01   +4.166932550332396e-01   +2.843846636219893e-01   +7.667180427525103e-02   +5.195472530147119e-02   +4.582407250203538e-01   +5.033231645833888e-01   +6.153324002140812e-01; +3.802010411765814e-01   +1.595624635761396e-01   +4.025202442438822e-01   +4.768662499478200e-01   +2.084161754441151e-01   +4.059975856511646e-01   +1.769603367597641e-01   +1.455898801905997e-02; +3.630257877444629e-01   +3.462254696395304e-01   +3.102723324894098e-02   +2.429534573362945e-01   +4.831443472348079e-01   +6.274861495937126e-01   +2.214103523358410e-01   +5.573971209902209e-01; +2.189672626623275e-01   +6.403219117837239e-02   +5.111237715080301e-01   +2.664038436714383e-01   +2.734181239080709e-01   +2.936673371274758e-01   +1.917501654273984e-01   +5.349615896416557e-01; +4.318853864160576e-01   +5.548984769893569e-01   +4.621624290035007e-02   +3.834307615651539e-02   +4.715865952856527e-01   +2.760264083688153e-01   +1.839130986650031e-01   +5.205648241020414e-01; +6.342987776762631e-01   +3.714760447775041e-01   +1.438758298191305e-01   +3.835702228084632e-01   +2.879362750149727e-01   +3.011325609491056e-01   -2.098421033751736e-03   +1.317615156360781e-01; +7.332868594283093e-02   +3.161316029681507e-01   +6.387039649374950e-02   +6.147153437637378e-01   +5.766247196445887e-01   +6.027318174613420e-01   -2.487434658291233e-03   +5.140480073656560e-01; +4.672328663684055e-01   +6.301063745001035e-01   +3.439296190616770e-02   +2.693549328515623e-01   +5.951936658764841e-01   +6.240734383783069e-01   +2.984252777711174e-01   +2.224632922374339e-01; +1.264281407367559e-01   +3.268845296553020e-01   +2.021363109988449e-01   +4.649710347084308e-01   +5.783362521572222e-02   +2.412350467033355e-01   +1.201863959919292e-01   +2.278541094594027e-01; +1.591638087056765e-01   +1.003067136057307e-01   +4.312106758791746e-01   +4.439003072691355e-01   +1.379894592443056e-01   +4.505418991862086e-01   +2.256072732553437e-01   +4.219335286113363e-01; +2.009252362859165e-01   +3.070484174322470e-01   +5.000034641577101e-01   +2.303388646976768e-01   +4.218906981079879e-01   +6.583609673130228e-02   +8.992682475923579e-02   -2.845904842957382e-03; +5.605024623109839e-01   +1.109623884936342e-01   +6.393279347843587e-01   +6.172268872621821e-01   +5.664170155078584e-01   +2.311029284471077e-01   +4.294947045948047e-01   +2.165946120477431e-01; +4.442763956172804e-01   +2.871507487125566e-03   +6.104198421719834e-02   +4.234367862725363e-01   +4.568472483440668e-01   +4.064317140415354e-01   +5.494926741360971e-01   +5.926092604553320e-01; +6.082927010196115e-01   +2.327445698099401e-01   +4.523646498594744e-01   +4.249228442109227e-01   +1.280968931207796e-01   +3.572955711647304e-01   +4.812554186123421e-01   +3.623048357599370e-02];
L1I_L2I_iGABA_netcon = [+4.827588569491479e-01   +4.342075293914071e-01   +5.855764498459863e-01   +5.613997575098341e-01   +1.722288678687440e-01   +3.913118650980115e-01   +4.119860900249716e-01   +5.819484576741147e-01   +2.774385108684330e-01   +3.038572477303904e-01   +3.680458950368911e-01   +1.413639498442592e-01   +1.340874736879291e-01   +5.556338032003458e-01   +1.926138550450888e-01   +4.296953019193939e-01; +1.279168446146758e-01   +4.901404000740371e-01   +1.365055725259526e-01   +1.693052001249405e-01   +6.295898384288036e-01   +5.038461439643198e-01   +1.697720558887321e-01   +2.505634366820101e-01   +1.941132527541338e-01   +2.537016236280353e-01   +4.163782105727801e-01   +2.707377655837707e-01   +4.702317234842590e-01   +1.550657603593980e-01   +4.417307655782078e-02   +1.232790928225561e-01; +2.068146816591556e-01   +3.614503764166353e-01   +6.193492141777054e-01   +5.604153763940445e-01   +1.949322811119971e-01   +1.604051811744769e-01   +1.816914360161460e-01   +1.715190995860851e-02   +7.040480559784340e-02   +6.316180582275199e-01   +5.168707121760838e-01   +7.676467533363555e-02   +2.785031675358170e-01   +3.184520111843031e-01   +6.762885760064735e-02   +3.605198277281471e-01; +2.933230022725598e-01   +4.211504155272016e-01   +3.549203747418540e-01   +5.926911062591553e-01   +6.278042173731166e-01   +4.169214026774409e-01   +2.976525938029953e-01   +5.078624446031635e-01   +8.431355046485677e-02   +4.222169302830100e-01   +5.238817242216338e-01   +1.315958080099814e-01   +4.417144829197168e-01   +2.121506131199779e-01   +4.948462923205989e-01   +2.707873386408364e-01; +4.597131613255624e-01   +4.507442098444751e-01   +1.823619175296169e-01   +3.425060870082535e-01   +4.499537097299161e-01   +3.983430097302192e-01   +5.127882188124069e-01   +5.545397219623855e-01   +2.305800366790887e-01   +5.671367775344834e-01   +1.917660268873393e-01   +6.419252157579005e-01   +4.191838508113743e-01   +3.478484801128472e-02   +6.274552764663174e-01   +3.124604019670237e-01; +3.204222942749744e-01   +3.299319094330865e-01   +3.893956372564134e-01   +1.640152048744596e-01   +3.609966305033471e-02   +3.630797533542632e-01   +3.532861727103440e-01   +4.916958023185183e-01   +2.325270755799199e-01   +2.741807210520509e-01   +3.408113426652499e-01   +5.362075978903036e-01   +5.672825352075188e-01   +1.393227135214542e-01   +1.066003914681220e-01   +3.807997819765782e-01; +1.823140095616638e-01   +2.800069449184410e-01   +5.989551783082827e-01   +6.199486576981779e-01   +5.059391195815582e-01   +2.366265501677084e-01   +1.764304300510681e-01   +2.198545010316670e-01   +5.012883574262447e-01   +3.525247040299394e-01   +6.081499591465902e-01   +5.450296887789279e-01   +4.198167705994529e-01   +6.268003293255516e-01   +1.898612847713719e-01   +1.215462584003121e-01; +2.002034813857335e-01   +3.196303265951014e-02   +1.810093459685518e-01   +5.525781060325653e-01   +6.053842350685091e-01   +1.590219587288819e-01   +5.923241224128071e-01   +5.722366278529962e-01   +4.593448692190122e-01   +5.403438856400353e-01   +3.500008901882477e-01   +4.913944241948324e-01   +3.521790753874902e-01   +2.501555262651227e-01   +1.960213114330994e-01   +3.426455395763569e-01];
L2E_L1E_iAMPA_netcon = [+3.174747619775762e-01   +1.430411531293979e-01   +6.718294616939793e-02   +2.224948587139841e-01   +2.222973009848121e-02   +2.885487212055465e-01   +3.973858721763764e-01   +3.050361514792958e-01; +4.352675835580006e-01   +5.573800575917495e-01   +7.600085778223291e-02   +3.185846979490095e-01   +2.768982019006215e-01   +1.609233412788633e-01   +3.784664293357080e-01   +1.407992090050936e-01; +3.034671249822227e-01   +1.427109776077424e-01   +3.875352977863712e-01   +5.911489403557386e-01   +3.795901917953206e-02   +1.636155001900353e-01   +5.931883185947882e-01   +2.189287760429310e-01; +2.720500248134515e-01   +5.219843153772913e-01   +2.532162672001324e-01   +2.451031610378285e-01   +9.596615610614732e-02   +5.586781801895556e-01   +6.330515108347956e-01   +1.920849504760218e-01; +1.239898415335664e-01   +1.083373187088546e-02   +3.845639718863146e-01   +2.680678344841912e-01   +2.126540999682971e-01   +5.463006360259467e-01   +4.554477593746107e-03   +4.889586243711962e-01; -9.965082184373350e-04   +5.539880294935133e-01   +1.543386944657929e-01   +4.966873486805117e-01   +3.457349259030172e-02   +1.503753147560941e-01   +4.775513871652503e-01   +5.988283606027716e-01; +2.278594960979428e-01   +1.733338510016776e-01   +3.996886217669998e-01   +3.280208285573001e-01   +4.166559456357383e-01   +1.656227886445295e-01   +6.314807028077255e-01   +1.333931957528381e-01; +1.155486921308614e-01   +6.252682743589598e-01   +4.715591532890765e-01   +1.157573086840680e-01   +3.639784382992293e-01   +2.861936575516945e-01   +4.357244010862185e-01   +4.895131304561930e-01; +1.540860387845054e-01   +4.753656848278042e-01   +5.312505097508381e-01   +6.016268116332707e-01   +7.182458819672781e-02   +4.120667187660156e-01   +3.286225297061542e-01   +2.614345965760701e-01; +6.263486848182911e-02   +2.256527786742973e-01   +1.806861821763860e-01   +2.060900450385707e-01   +5.683892710243710e-01   +1.656421427888366e-01   +2.752367175487924e-01   +5.376997682126030e-01; +1.169806887037530e-01   +1.156102447101473e-01   +1.120899643916409e-01   +5.886580479814358e-01   +3.570755668641389e-01   +3.183806755672230e-01   +1.202061685564427e-01   +2.042947256480555e-01; +4.947845623343248e-01   +4.493012600479354e-01   +2.048369342746159e-01   +1.343433076543992e-01   +1.836471020604594e-01   +1.594158326217593e-01   +3.533942984517821e-01   +4.350030355367787e-01; +1.047359263431579e-01   +4.997416749300553e-01   +3.142401987048172e-01   +5.657593420069930e-01   +4.988282396250152e-02   +2.138408644046343e-01   +4.023163522894531e-01   +1.425806279988391e-02; +3.716774801798721e-01   +1.652727669748321e-01   +3.390693980804445e-02   +3.997477886019738e-01   +1.183765930290000e-01   +4.327523946657544e-01   +8.498423367946417e-02   +6.001450637473529e-01; +5.426041524117446e-01   +5.527200817008383e-01   +1.533031530657248e-01   +4.088215330907728e-01   +1.394677803284351e-01   +3.689684369534824e-01   +6.067721951829439e-01   +3.813515747618558e-01; +2.280965498764203e-01   +2.232845994303994e-01   +3.063832378294588e-01   +6.938028952752733e-02   +2.194254904092378e-01   +3.941661415210197e-01   +6.714444286535859e-02   +1.167545143745716e-01];
L1E_L2E_iAMPA_netcon = [+2.209761287336629e-01   +5.955104447826962e-01   +2.174853937766758e-01   +1.436035684119469e-01   +4.592205971502468e-02   +9.440145408625347e-02   +5.653488508606785e-01   +1.908993537446336e-01   +3.414251374240426e-01   +5.796466721981845e-02   +2.124216856644966e-01   +5.895119750343161e-01   +4.610931218601062e-01   +4.726820319576210e-01   +5.343606571499085e-01   +9.435742330689609e-02; +3.474745857127038e-01   +4.327252915802028e-01   +2.342077607296519e-01   +4.355290767905293e-01   +3.538589694281831e-01   +1.234588649144414e-01   +5.745140789107081e-02   +6.108886514175601e-01   +2.505436374402474e-02   +3.908742487181880e-01   +6.515769348360007e-02   +4.377343013015792e-02   +5.602562828138794e-01   +2.679785333411464e-01   +2.643638412216557e-01   +4.870104673299822e-01; +3.861475889919590e-01   +1.926220750619842e-01   +3.796973132141104e-01   +3.623299646909238e-01   +3.596416152711731e-01   +2.243900380736213e-01   +5.477202899099458e-01   +4.845059018271371e-01   +1.039387970356064e-01   +4.645621065695649e-01   +4.487041085598482e-01   +1.714623307369559e-01   +1.228642560475062e-02   +4.255818685509067e-01   +3.229864183490703e-01   +2.563230243621586e-01; +4.229243998501908e-01   +2.483878239604639e-02   +3.945820613237582e-01   +2.967725128292975e-03   +3.138628820726546e-01   +1.301486474541688e-01   +1.266508977186940e-02   +2.338387838806263e-01   +3.978006181933089e-02   +2.308476374351086e-01   +4.898166234614714e-01   +1.118801276306621e-01   +3.936325201155353e-01   +2.128952347215056e-01   +6.336162132288448e-01   +5.312248629704742e-01; +1.710123432594022e-01   +2.507682336733345e-01   +5.292058242454730e-01   +5.250619930481946e-01   +3.251394251088423e-02   +2.293968925056168e-01   +4.743395743852610e-01   +6.190178971550311e-01   +2.093841278108590e-01   +5.940788488156062e-01   +6.116966974309541e-01   +6.443100698367467e-01   +2.896499830611057e-01   +9.007165216458990e-02   +3.368851919998273e-01   +1.899396132972375e-01; +3.442049190867193e-01   +2.114129150148713e-01   +1.684036219507998e-01   +3.285347388709979e-01   +2.120655322628720e-01   +1.466881334958537e-01   +1.714351301990472e-01   +1.332596150232233e-02   +1.145363713090312e-01   +4.104902198451478e-01   +5.972235599966030e-01   +5.523655571417554e-01   +4.831181289228108e-02   +4.052366264091983e-01   +5.448243738250291e-01   +4.064280158743097e-01; +2.332357567334110e-02   +3.774347544421618e-01   +5.799926369566877e-01   +2.874379210442229e-01   +9.538068535724392e-02   +3.171188122215637e-01   +3.492127721938144e-01   +4.790826900775148e-01   +2.589868100629661e-02   +1.917904686312903e-01   +5.300186761559279e-01   +5.828843803430247e-01   +3.864039393932592e-01   +5.837950704028982e-01   +4.510103550840226e-01   +1.298783586364954e-01; +4.700546155395332e-01   +4.907661992471651e-02   +7.496904307387182e-02   +2.114856187022837e-01   +3.212683358412086e-01   +5.191769979725560e-01   +6.352093663751109e-01   +5.290497515203088e-01   +3.820095652465643e-01   +3.210868362330680e-01   +2.747964589968034e-01   +4.845483369032844e-01   +8.893662903022241e-02   +4.640718912013997e-01   +4.236054905521507e-01   +6.125157232116610e-01];
L2I_L2E_iAMPA_netcon = [+3.209047071680379e-01   +5.019454798785171e-01   +5.310782370995974e-01   +3.886202427121293e-01   +3.111463736777403e-01   +2.130500400330868e-01   +2.225813974458867e-01   +2.038176802900182e-01; +6.129517811968985e-01   +5.385078901353788e-01   +5.794502359157130e-01   +2.800188638635031e-01   +4.304453722361616e-01   +6.178605793406541e-01   +3.797518957145636e-01   +2.817496012482997e-01; +6.249665409841760e-01   +6.427268499806950e-02   +4.181104126805344e-01   +5.798456868741483e-01   +3.394067181812803e-01   +3.614613949071437e-01   +9.793875287100609e-02   +1.082839780051102e-01; -1.514627503061586e-03   +4.888869742184530e-02   +1.197790141083590e-01   +1.857636741885189e-01   +6.271407523047710e-03   +1.140629368323058e-01   +3.409181961253298e-01   +2.650777099581569e-01; +1.434848672458016e-01   +3.701440576364685e-01   +2.151826117104119e-01   +3.842036982204746e-01   +4.835400109862619e-01   +1.517788076410576e-01   +1.189051608417915e-01   +5.666361295618622e-01; +2.435140282124415e-02   +5.489290121695228e-01   +5.544541355976689e-01   +5.942031170675959e-01   +4.312190589985340e-01   +3.484068124485246e-01   +1.934715100268910e-01   +5.351704406064797e-01; +1.682555971991996e-01   +3.561499523291328e-01   +2.692451329764953e-01   +1.342296605852501e-01   +5.769916172751947e-01   +1.986010417190034e-01   +6.026740555281992e-01   +5.932147043514848e-01; +3.027500584408700e-01   +3.512574153671509e-01   +4.797234573418113e-01   +3.614628291253723e-01   +5.451214216236320e-01   +2.492131173427070e-01   +1.457700889709987e-01   +4.807478637131826e-01];
L2E_L2I_iGABA_netcon = [+6.157206515497755e-01   +1.823464438266627e-01   +6.226167328461080e-01   +4.125056332619112e-03   +5.466028502768552e-01   +1.419420315186766e-01   +5.192467785415382e-01   +4.485245863113014e-01; +6.465419008809692e-01   +1.532299417897576e-01   +2.067130509207857e-01   +3.132329238891379e-01   +2.020209194123702e-01   +3.720228848756646e-01   +5.804230166321793e-01   +9.812590110802022e-02; +1.034596104221349e-01   +5.144410524614174e-01   +3.980522560073206e-01   +3.902751382723799e-01   +5.460228420822445e-02   +4.083297123029394e-01   +4.482397338172747e-01   +4.475993650104187e-01; +3.810952372490015e-01   +5.297421898111614e-01   +1.554321635993345e-02   +4.921487973162118e-02   +4.007656083279215e-01   +1.332284986138317e-01   +1.001724059010567e-02   +4.015690079305579e-01; +2.446351106647605e-01   +6.040735036309686e-01   +2.877216230569747e-01   +2.787849746088338e-01   +5.573179327401340e-01   +1.944278295098503e-01   +3.668825964787452e-01   +5.428672415738733e-01; +5.651284220560987e-01   +1.647644482330440e-01   +2.482156128209153e-01   +5.833440175549306e-01   +1.913146074150206e-01   +3.587495240231411e-01   +5.425510549225113e-01   +2.267818712341869e-01; +6.395492700534260e-01   +3.698163774690095e-01   +8.961481377764827e-02   +4.525261035143932e-01   +2.407182194403274e-01   +2.792617600570990e-01   +5.993764275727821e-01   +5.849081442070185e-01; +1.827036957169968e-01   +3.983885551702534e-01   +2.684125645057063e-01   +5.981158386843592e-01   +6.323992725483277e-01   +5.749885659611010e-01   +1.184391651950848e-01   +4.876966690869607e-02];
L3E_L2E_iAMPA_netcon = [+3.112010624379004e-01   +5.034810570041189e-01   +2.014802670445249e-01   +5.357908417508409e-01   +6.287290970272955e-01   +7.139155514133505e-02   +4.485339266517536e-01   +1.605740853525573e-01   +2.652962752070834e-01   +5.254346825386075e-01   +4.848411176950402e-01   +3.069267192818210e-01; +6.002333458586694e-01   +2.327747445382294e-01   +4.388375413086691e-01   +4.819853626815634e-01   +4.455672776635115e-02   +1.420093680693293e-01   +8.881644871704125e-02   +3.855011306125787e-01   +1.394874621375549e-01   +3.575719959861257e-01   +3.951918209553570e-01   +9.485882008590371e-02; +3.179360016881335e-01   +7.234188578003903e-02   +2.676555392931519e-01   +5.553226959604365e-01   +2.303767438693927e-01   +3.889854407521457e-01   +6.042633216581790e-01   +4.559518196383726e-01   +2.838081239148983e-01   +1.866991680877298e-01   +3.506854980587361e-01   +1.407997524082646e-01; +4.607160718326821e-02   +4.122120434863151e-01   +1.774360843237378e-01   +3.676483867381797e-01   +3.223413380854818e-01   +3.179924640989921e-02   +9.763352415727349e-02   +4.116785217305920e-01   +4.013377029413756e-01   +4.902884887417481e-01   +4.733585518125604e-01   +5.703289322750273e-01; -8.249735884763069e-04   +2.805191176666525e-01   +3.688820225535153e-02   +3.681973621610540e-01   +2.346861552450756e-01   +5.311751454439227e-01   +7.225241823493322e-02   +5.140993139303141e-01   +4.951984818113401e-01   +1.256426180847271e-01   +5.974333653946511e-01   +8.137551426103192e-03; +1.761505728572575e-02   +2.748009460546204e-01   +4.704521821159694e-01   +5.859759304319492e-01   +4.199688428648100e-01   +4.304664540132367e-01   +2.365956288696014e-01   +2.902204191350722e-01   +4.816689061039863e-02   +4.023982125694283e-01   +1.822522389259410e-02   +2.988834742409506e-02; +2.664826648439328e-02   +6.040637998630457e-01   +5.577527454480967e-01   +5.395213389066316e-01   +4.287005272089742e-01   +3.440265109623510e-01   +4.455180284851881e-01   +7.566719969900379e-02   +4.855818884624761e-01   +4.673930804955292e-01   +3.409237312045126e-01   +1.654465936464952e-01; +2.103670181887862e-01   +1.646137985597241e-01   +6.106843130147015e-01   +4.689726180411701e-01   +4.921357972676550e-01   +1.000009130557017e-01   +4.691481998424434e-01   +3.588986889890859e-01   +4.021364653835120e-01   +4.072609120262261e-02   +2.402473960511482e-02   +4.413277724047684e-01];
L3I_L2I_iGABA_netcon = [+5.595660486226013e-01   +6.224180047207765e-01   +2.905638549618523e-01   +6.223028020099334e-01   +5.405412267411277e-01   +1.523457611058049e-01   +2.719221088297120e-01   +6.690729260545220e-02   +3.286983809823218e-01   +6.139665942607589e-01   +6.916892012830754e-02   +6.148759293897367e-01; +4.732211074521054e-02   +1.879657203570509e-01   +5.908078586655882e-01   +3.255221427065663e-01   +4.424255383397486e-01   +4.510214973017577e-02   +6.355649168224856e-01   +1.663427894896479e-02   +1.415697422555043e-01   +6.216234329129006e-01   +5.766906798559834e-01   +1.626991380634225e-01; +6.379203611594105e-01   +1.487747341473703e-01   +1.303286186831879e-01   +6.129946355846569e-01   +3.504832851297863e-01   +4.984659730425319e-01   +1.932511636521582e-01   +3.572468650776465e-01   +4.182447262765026e-01   +2.361962584732389e-01   +4.391053652110881e-01   +1.797994850674313e-01; +6.033147131007348e-01   +3.724872799931230e-01   +3.793949545505050e-01   +5.842987377562359e-01   +2.031081598671203e-02   +4.340656045730854e-01   +4.434604814432164e-01   +3.542365193782001e-01   +1.445600522315870e-01   +5.231250196940973e-01   +4.576920673752973e-01   +1.642004625730644e-01; +4.148294291539825e-01   +1.504004799026346e-01   +5.462444553851356e-01   +2.658819779259162e-01   +6.104879045325924e-01   +4.734135963710025e-01   +4.710553198646035e-01   -9.625962806084913e-04   +1.288386651002704e-01   +1.482532245699038e-01   +1.645281115547486e-01   +1.831185593243534e-01; +2.732138950974984e-01   +1.354783658125885e-01   +3.757024185574341e-01   +5.844104217316761e-02   +4.918497082194323e-01   +1.851662647364216e-01   +6.171644540492019e-01   +1.421200059253039e-01   +3.582235695119192e-01   +5.697103866780053e-01   +5.329287163579127e-01   +5.272030571461974e-01; +5.676736818150646e-01   +3.938255984608098e-01   +4.258865525014913e-01   +5.739543873507221e-01   +6.288312696673262e-01   +1.898335234394506e-01   +5.262038141555205e-01   +4.210762899119949e-01   +1.846234711293589e-01   +9.269553047375395e-03   +1.851722731835335e-02   +4.971724818104061e-01; +5.339624510025561e-01   +6.240056858483922e-01   +5.241668676087957e-01   +6.204099820646842e-01   +2.616339742224468e-01   +1.162251208457036e-02   +4.676619397565717e-01   +3.585712127736816e-01   +1.421620186435456e-01   +5.383228552848196e-01   +2.425985298162790e-01   +4.128267086258134e-02];
L2E_L3E_iAMPA_netcon = [+5.997722791471418e-01   +5.614760654652338e-01   +6.172189575537605e-01   +4.001104686586450e-01   +4.321144796341461e-01   +4.390556071516862e-01   +3.600639619488363e-01   +6.058906877967372e-02; +2.876151682700526e-01   +2.763115614354130e-01   +3.328534831040184e-01   +3.819081765854247e-01   +4.119560074689327e-01   +1.570501405351983e-01   +6.553134251584412e-02   +5.088262538808741e-01; +7.728221563539073e-02   +6.461893333743979e-01   +5.684787521317102e-01   +3.245724772422900e-01   +1.132991468413123e-01   +2.213574977030186e-01   +6.361669224152788e-01   +7.200900075090487e-02; +5.315838607389533e-01   +4.126967371928855e-01   +4.192993184366876e-01   +4.176977802956932e-01   +5.595297342140210e-01   +3.583354979267243e-01   +9.924194202616500e-02   +1.314669356306604e-01; +5.346376194583020e-01   +3.349723029841001e-01   +3.746015311346301e-01   +5.207352299710059e-02   +4.083532571022266e-01   +5.314362306941856e-01   +4.398244802903916e-01   +5.929526782059542e-01; +2.256829111695597e-02   +4.845997287706197e-02   +4.208203973490311e-01   +3.490947392368733e-01   +4.736478884215413e-01   +3.877878458285794e-01   +3.698960884606748e-01   +4.290342481286977e-02; +3.452218056926976e-01   +3.242653043006046e-01   +4.494862730086120e-01   +8.565297575781267e-02   +6.380813655179391e-01   +3.789390289662708e-01   +1.330265685082996e-01   +3.210871325629698e-01; +6.178944826045170e-01   +5.286074546808042e-01   +2.260286359515754e-01   +5.648240044481944e-01   +1.164597857083193e-01   +6.366657639400942e-01   +5.321694845653766e-01   +3.636376147744514e-01; +6.332558160637773e-01   +4.685905050320979e-01   +3.841638325963558e-01   +4.310785946281830e-01   +2.248796430328027e-01   +3.283625247094118e-01   +5.900056115853753e-01   +2.518967161842513e-01; +2.033180678619234e-02   +5.221074122544191e-01   +4.207857963534720e-01   +2.040449537435345e-01   +6.219579830706984e-01   +4.033610233871445e-01   +2.687706514607203e-01   +2.490200462699869e-01; +3.941562288166607e-02   +3.176409879450380e-01   +3.560503516070562e-01   +5.202912243317066e-01   +4.757362394440702e-01   +6.073948302952057e-01   +2.128548382075355e-01   +5.136950993511753e-02; +2.692377768513650e-01   +5.416261298539957e-01   +4.907511190581679e-01   +1.138426009248181e-01   +5.745647363486142e-01   +4.398361594733301e-02   +4.723847076750776e-01   +8.957557089436562e-03];
L2I_L3I_iGABA_netcon = [+1.107907119600434e-01   +3.484993903831667e-01   +5.584839901441068e-01   +4.838542311906147e-01   +3.089543493028155e-01   +1.065398377416319e-01   +6.824297878880063e-02   +4.679632649338716e-01; +1.031809828096795e-01   +6.109222326180088e-01   +3.075245560795277e-01   +2.386563500553614e-01   +3.514981628073530e-01   +6.233749268846928e-01   +1.873440492928381e-01   +4.032633415961862e-01; +5.542393283414698e-01   +3.894966907407637e-01   +5.967250748018541e-01   +2.916153552388309e-03   +3.782194017735370e-01   +3.701234486688186e-01   +2.995118092403025e-01   +8.598552705362555e-02; +5.200609112892913e-01   +6.338695485686379e-01   +5.842841121769695e-01   +3.975374447866262e-02   +6.213387454831527e-01   +3.422984677166063e-01   +5.520854293839507e-01   +1.203789699094872e-01; +1.264312297090579e-01   +1.331033502404627e-01   +1.262569822766758e-02   +1.811454099041474e-01   +6.166711050844750e-01   +1.078474414086791e-02   +4.592479887877972e-02   +2.229371757654704e-01; +1.007988457991668e-01   +5.649578515904855e-01   +1.996459866376350e-01   +2.055688085573857e-01   +1.605368453587602e-01   +2.187957828651270e-01   +2.287226244499270e-02   +2.999814739112391e-01; +3.851399155301661e-01   +3.743562315623699e-01   +3.767160244831578e-01   +2.415162438650186e-01   +3.790094811208003e-02   +1.936913039465478e-01   +5.314958094298543e-01   +5.858247148275783e-01; +4.829425416603638e-01   +1.301708427675920e-02   +3.049794320156745e-01   +4.783304442956151e-01   +7.344251641438503e-02   +5.341736228073952e-01   +1.333076193304641e-02   +1.775004482013514e-01; +5.360105597699878e-01   +3.318862876068223e-01   +6.168263423159774e-01   +2.486838974302314e-01   +5.536087585226337e-01   +6.179571266887768e-01   +4.556749947697586e-01   +3.249243288006876e-02; +4.328805929958648e-01   +4.620619073762479e-01   +3.563295593528901e-01   +5.438447469968313e-01   +5.046317796175834e-01   +6.122091518381960e-01   +5.017053442399125e-01   +2.340280766194895e-01; +5.647172359807229e-01   +3.036420260865529e-01   +3.800606543603984e-01   +1.472493334527940e-01   +3.594314191192466e-01   +2.610947082817680e-01   +1.825368040407915e-01   +2.685266948163086e-01; +2.486701701353794e-01   +6.061593385873104e-01   +5.873822171664217e-01   +1.066489031763146e-01   +1.613099655046645e-01   +6.249819575421206e-01   +4.655560601464420e-01   +4.748217460973019e-01];
L3I_L3E_iAMPA_netcon = [+2.032613980752078e-01   +3.084249204261514e-01   +6.411763358987872e-01   +1.205855811781381e-01   +5.882161017581810e-01   +5.707173271951586e-01   +4.901124006385251e-01   +2.045673425815098e-01   +4.571113235597891e-04   +3.677840012919469e-01   +3.880852444895692e-01   +6.143041658428790e-02; +4.792158088511757e-01   +1.455291881850223e-02   +3.101267491511660e-01   +3.450296905951471e-01   +4.618180850393835e-01   +3.631837080943029e-02   +6.332823888484264e-01   +7.268036032849952e-02   +3.021285058272454e-01   +4.564824981228010e-02   +5.521733960094296e-01   +2.133946884739126e-01; +3.660923450862033e-01   +5.696365033632528e-01   +2.355119909368144e-01   +4.659505228689146e-01   +2.798113559821017e-01   +7.515229449569720e-02   +1.055907042088282e-01   +4.835536677564974e-01   +5.526698240962549e-01   +6.048566357534533e-01   +4.558783812362708e-01   +1.828489545343384e-01; +5.931207103667625e-01   +2.691407716187605e-01   +5.443571115549526e-01   +5.486561002513285e-01   +1.684141554919177e-01   +5.265934009171530e-01   +3.734708366388353e-02   +1.433248243740335e-01   +6.602234701491573e-02   +5.423857366329831e-01   +1.881252907295357e-01   +2.200313872419604e-01; +5.055034637568276e-01   +1.949019457079437e-01   +5.686069102315087e-01   +5.419723894903598e-01   +6.305022516541418e-01   +1.551881901839398e-01   +2.243800022321810e-01   +2.462488188838310e-01   +3.257921561409862e-01   +4.350735740945720e-01   +2.721981408454421e-01   +6.344176970823721e-02; +2.208117362934809e-02   +6.216406962833982e-02   +2.249462749268598e-01   +5.903946231094628e-02   +7.478543317883542e-02   +7.085344092398581e-02   +1.583525500829766e-01   +3.151070076696350e-01   +2.725247690734585e-01   +2.791205311110034e-01   +4.744028069380743e-01   +5.345417496575499e-01; +1.203839409203244e-01   +3.352909225540637e-01   +2.493430921062065e-01   +5.677980807904160e-01   +1.387636949145647e-01   +5.555780906218345e-01   +1.743421528385385e-01   +5.590140455275314e-01   +1.624727337152888e-02   +2.192955098361601e-01   +9.684940283316479e-02   +4.605666795564514e-01; +3.211515245572939e-01   +2.525602618973198e-01   +3.251913444562982e-01   +3.395223664855794e-01   +3.366533203154930e-01   +8.993681031791666e-02   +5.690212567860822e-01   +2.937621863696566e-01   +4.974112091397443e-01   +5.755627670897147e-01   +5.898085437630171e-01   +2.138141519995552e-01; +3.050114483969792e-01   +3.438288923734505e-01   +8.735737287523337e-02   +2.161241428346314e-01   +5.407887268298569e-01   +1.577511793262177e-01   +5.490522470733139e-01   +3.192323649454200e-01   +5.685907822686211e-01   +1.340488361324813e-01   +1.068312177243688e-01   +3.763958007237838e-01; +1.614547306493665e-01   +9.613308344399324e-02   +1.633835229167209e-01   +4.991999200034426e-01   +1.481328873607698e-01   +2.087439857228388e-01   +4.997186060251895e-02   +4.040191239555557e-02   +5.536433924370985e-01   +1.301925736972021e-02   +3.778539034827675e-01   +3.189287955343939e-01; +5.718990563938682e-01   +3.206416146691141e-01   +6.274495133008295e-01   +2.603306863863522e-01   +6.337514278880763e-01   +4.292196563646249e-01   +4.182363565480333e-01   +3.451143565504062e-01   +3.598023934808204e-01   +3.328363170629971e-01   +5.842264249573018e-01   +4.917475151141074e-01; +3.696481018542250e-01   +4.532956936855342e-01   +3.215696889992208e-01   +1.984542390676320e-01   +3.870671030967325e-01   +1.317136024180516e-01   +5.070437043260484e-01   +1.371611885544307e-01   +4.587141229503024e-01   +6.323891569211172e-01   +4.959517336509514e-01   +3.395208109699306e-01];
L3E_L3I_iGABA_netcon = [+4.615310464694440e-01   +2.405446848576527e-01   +4.643158189208200e-01   +5.647713824358236e-01   +5.967229201531093e-01   +5.198439928757894e-01   +3.228466144306285e-01   +4.066621123004120e-01   +5.878338257004555e-01   +6.090137171983305e-01   +4.602089996749870e-01   +4.287554545845451e-01; +2.410579316316785e-01   +3.006744533130742e-01   +6.183793853495267e-01   +5.489817736377683e-02   +1.095124135068016e-01   +4.994361027324956e-01   +4.208914712744141e-01   +4.372247277107156e-01   +2.368428704380929e-01   +2.256295039528618e-01   +5.810161405867993e-02   +1.805195953921540e-01; +4.009508455570495e-01   +1.360479716878334e-01   +1.920253960820080e-01   +5.765541603508213e-01   +6.324334089503788e-01   +6.253549706680617e-01   +1.958856303291822e-01   +5.693514180027103e-01   +5.620492863119677e-01   +3.995633789271682e-02   +4.412720725023141e-02   +2.557991373993467e-01; +3.337720862954115e-01   +2.938310585899892e-02   +3.310549743241668e-01   +4.624269575862223e-01   +3.193874238786349e-01   +6.069485169337714e-01   +2.263624099021126e-01   +6.220568344103755e-01   +6.163280636716043e-01   +5.100462022216724e-01   +2.215793497370465e-01   +1.517241655310642e-01; +5.213607198966776e-01   +2.779932735888771e-01   +1.040901746654777e-01   +2.178898621507772e-01   +1.671268521562034e-01   +5.108418975022854e-01   +1.676903912062707e-02   +3.148398116454624e-01   +5.894291382527082e-01   +2.442407494387696e-01   +5.505107426154330e-01   +5.219607832913620e-01; +3.435209495422374e-01   +3.142665506087284e-01   +4.907655151356676e-01   +3.348960674037051e-01   +5.224570241061581e-01   +5.527318841539947e-01   +1.323553474005053e-01   +5.373256388017477e-01   +1.059048911168512e-01   +5.720135557143906e-01   +3.160906333290617e-01   +3.031766588578472e-01; +4.840352588432191e-01   +2.038984701369781e-01   +1.797480610020760e-01   +2.626710753533226e-02   +2.790512741113724e-01   +3.791147971133492e-01   +5.391547896928122e-01   +3.774156939236853e-01   +1.743000419165338e-01   +2.935035157007798e-01   +3.688784936541383e-01   +4.888734916143652e-01; +3.764536314914875e-01   +4.956029385959217e-01   +5.450620347168341e-01   +4.869692373591014e-01   +6.244870431076990e-01   +2.739036985335056e-01   +3.194465531271150e-01   +5.163746917570783e-01   +5.458653630216591e-01   +4.270631119830572e-01   +3.553204902051337e-01   +3.450894968248899e-01; +5.820172917748474e-01   +1.069868497656852e-01   +6.963897903029170e-03   +4.911970542382153e-01   +3.987863500936154e-03   +6.021619461933804e-02   +4.574632928156656e-01   +1.883593496998158e-01   +5.174997373819776e-01   +2.457495834541576e-01   +4.044450682194740e-01   +9.486447578457836e-02; +1.773822696673249e-01   +4.763053952860619e-01   +4.499227238970691e-01   +4.337533515474479e-01   +1.702102271204102e-01   +2.953983149902099e-01   +1.099301776417222e-01   +1.503750349331011e-01   +6.076261102166527e-01   +5.492511793378996e-01   +6.749014304202593e-02   +4.711596450286391e-02; +3.796705414603203e-01   +6.257733751214613e-01   +2.550848068727817e-01   +1.162473967190465e-01   +5.364708458047042e-01   +2.912695970742918e-01   +1.926280540119201e-01   +5.173306021167406e-01   +1.683071944776329e-01   +1.656981510184905e-01   +1.540693091862712e-01   +3.576989227460430e-01; +2.698690667010109e-01   +2.431879972743029e-01   +4.185489419024357e-01   +5.102063142272872e-01   +2.327337849361852e-01   +4.120608470987770e-01   +2.835979457567193e-02   +4.626519015503301e-01   +2.466106227215576e-01   +2.821592846327536e-01   +4.171439786295332e-01   +2.171356473595605e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last =  5.6 * ones(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  5.6 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = -10*((exp(-10*((t)-( 50))^2)));
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 10*((exp(-10*((t)-( 50))^2)));
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 10*((exp(-10*((t)-( 50))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = -10*((exp(-10*((t)-( 50))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
