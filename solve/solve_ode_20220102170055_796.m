function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.799440587214544e-03   +2.376852550778146e-02   +4.099183868477877e-02   +3.414398769679399e-02   +3.427491801842800e-02   +5.720354996918363e-02   +1.930801237698612e-02   +8.581610034740870e-03   +1.472312858195542e-02   +2.208650782550300e-02   +3.340205305275873e-02   +1.583772006165892e-02   +2.303609236225557e-02   +3.771676713586498e-02   +2.373886470826625e-02   +2.851618468458973e-03; +2.249396028977301e-02   -4.065004491072989e-04   +2.578882193603680e-02   +3.339534036113803e-02   +1.190470454712829e-02   +1.651827682170517e-02   +4.994437829399876e-02   +5.245738373909357e-02   +4.029820350398151e-02   +1.426677675839785e-02   +5.139181674456948e-02   +9.744833435513620e-03   +7.265766158820408e-03   -5.111367425648322e-03   +2.505245603402668e-02   -1.766352932637314e-03; +3.099840435785438e-02   +3.048541420351909e-02   +4.784223517638873e-02   +2.833929741749518e-02   +1.710353286720030e-03   +4.945658457015948e-02   +4.015591798009542e-02   +2.700528977711820e-02   +2.420482993417367e-02   +2.154839286748944e-02   +2.758211887387720e-02   +1.233662617972259e-02   +2.096055938667790e-03   +9.444310364607744e-03   +4.159682198050026e-02   +3.021119046584852e-02; -3.607468022420101e-03   +1.526737963172027e-03   +2.182477289384815e-02   +3.765471573170364e-02   +1.491685484001606e-02   +3.722603431325717e-02   +2.683378380024823e-02   +5.141058499961865e-02   +2.641388970798983e-02   +1.072384465843544e-02   +4.161723571926067e-02   +4.333537477516208e-02   +1.088520394999007e-02   +4.800226688578056e-02   +1.267136312309480e-02   +1.617861321758802e-02; +2.590710422412728e-02   +3.259069702145125e-02   +3.467108262146575e-02   +3.553202208142772e-02   +2.183687856152238e-02   +5.090294686504612e-02   +2.369837714846298e-02   +1.609131703448393e-02   +2.940944029579223e-02   +4.915756665371535e-02   +2.005091512102648e-02   +4.051105615079151e-02   +1.106783402097006e-02   +1.673811583246547e-02   +5.405084132937477e-02   +9.447061552507522e-03; +2.799444490639698e-02   +1.962804079245357e-03   +4.561568827169950e-02   +1.186720320049210e-02   +3.081052054117383e-02   +2.005076245567334e-02   +1.783355021206673e-02   +8.925257538838728e-03   +2.280592284148383e-02   +2.951157327915417e-02   +3.877882829843270e-02   +1.273781155659322e-02   +2.422533081791380e-02   +2.668961622645201e-02   +2.532682448100332e-02   +3.949630693590722e-02; +1.325812146436898e-02   +3.604718038583549e-02   +4.914470749872413e-02   +3.217893079946900e-02   +2.509043956704494e-02   +2.825290750221857e-02   +1.625346076672692e-02   +5.047504449984627e-02   +4.864079785420836e-02   +1.992263435357934e-02   +6.146673934012966e-03   +1.300952686977641e-02   +2.149216374867108e-02   +4.439181545723700e-02   +2.335218542032539e-03   +1.344432247651693e-02; +3.627138602505089e-02   +1.954369928634545e-02   +4.185764325072545e-02   +3.572274913500206e-02   +3.320649432580425e-02   +9.252940625387581e-03   +1.404989717062979e-03   +3.040870456209992e-02   +4.355864078773881e-02   +3.641576252135843e-02   +1.588667189335114e-02   +3.770782966648635e-02   +9.647122555719426e-03   +8.130537974332632e-03   +3.419371109393461e-02   +3.489205069791141e-02; +5.460928186740162e-04   +3.915436810526936e-02   +3.015971853456115e-02   +3.051135501874671e-02   +5.299901369991884e-03   +4.496280020527563e-02   +1.821538722145993e-02   +2.390275315546054e-02   +2.608748025591608e-02   +2.581549302999711e-02   +8.409279271682311e-03   +4.781352860922710e-02   -1.101572718562748e-03   +4.252108092678029e-02   +1.645347599153118e-02   +1.793148413553967e-02; +2.695172016766860e-02   +9.133007285899867e-03   +4.590579566392110e-02   +3.959020233506118e-02   +3.347290511920938e-02   +1.314153950573073e-02   +3.926310093397104e-03   +1.508124875441719e-03   +3.781999261352024e-02   +2.064201321941866e-02   +2.912305218938939e-03   +3.152562208331630e-02   +4.769648507191157e-02   +1.596925745163470e-02   +4.910953668137705e-02   +3.232651795853690e-02; +2.403421737543662e-02   +2.532768177032072e-02   +2.728958177819343e-02   +4.506527465979349e-02   +4.033683304548237e-02   +6.960159334091180e-03   +3.335602308344848e-02   +3.487071183577374e-02   +1.257152377034062e-02   +1.397735482077768e-02   +3.628724744052537e-02   +4.783946225233379e-02   +6.587729010084505e-03   +3.022925053206118e-02   +4.153446295951137e-02   +9.175620047102961e-03; +2.928831132428660e-02   +1.325703986584979e-02   +1.420152422218682e-03   +1.324766783871178e-03   +4.861889054801345e-02   +4.955034371860670e-02   +3.123822592997725e-03   +3.699277531968680e-02   +3.500932034792837e-02   +1.608114228117425e-02   +8.279183989265273e-03   -1.790011403145113e-03   +4.684311019118094e-02   +7.795783377652455e-03   +2.724597747969115e-02   +2.598923761957616e-02; +3.469609373633517e-02   +3.544676196204589e-02   +4.366432837066329e-02   +1.040341838986530e-02   +3.689308841931608e-02   +3.325753520216167e-02   +3.760063198510396e-02   +4.144799367439096e-02   +4.108512908222216e-02   +2.058502195160303e-02   +2.167504567963224e-02   +5.561941314077736e-02   +4.324263166935551e-02   +3.740701970157079e-02   +2.567179459784768e-02   +4.641043655083796e-02; +4.404026486143075e-02   +3.490095052718563e-02   +1.583652994551246e-02   +2.893151497250819e-02   +2.617066329766666e-03   +1.311510078072581e-02   +6.598133173098400e-03   +1.157522049774893e-02   +1.384589465188659e-02   +3.823252454463272e-02   +1.031417621579929e-02   +4.863907462698448e-02   +3.243947621786648e-02   +3.053806624284144e-02   +1.802781880672948e-02   +1.549086095100151e-02; +3.280355990667699e-03   +2.564131410719754e-02   +4.607158414519805e-02   +2.744118967434827e-02   +1.785799606953590e-02   +9.078320034720148e-03   +1.305885800575294e-02   +2.561041271492555e-02   +1.315846766103686e-02   +5.467811556236742e-02   +2.111625548930558e-02   +9.101473760089713e-04   +2.136278399043293e-03   +4.400654956087895e-02   +4.782875392105943e-04   +3.156529076674965e-02; +4.390777251982329e-02   +1.194611348687526e-02   +1.156622862125773e-02   +5.063493746031663e-02   +2.090188980634215e-03   +2.347356952703463e-03   +4.183381595388524e-02   +5.734667971966220e-03   +2.331655790701300e-02   +4.576259013791309e-02   +3.833222830834788e-02   +5.203763353575518e-03   +3.721035220493324e-02   +4.231390188992582e-02   +5.208401551249426e-02   +4.703278993715812e-02];
L1E_L1I_iGABA_netcon = [+2.569612828680479e-02   +3.476148085509104e-02   +2.145177220035835e-03   +1.642809045430055e-02   +4.389388031160109e-02   +2.467468433288189e-02   +1.975932667981015e-02   +1.217608441630357e-02   +6.064564826039082e-03   +1.355547453311615e-02   +2.080806140610366e-02   +2.542475628568891e-02   +1.552360807124661e-02   +4.674241361882983e-02   +6.399385643872268e-03   +2.172408766144367e-02; +8.801094861668739e-03   +4.115459576469988e-02   +2.580530506352485e-02   +4.581977910842034e-02   +2.471992265298473e-02   +2.451394456150460e-02   +1.174899607749980e-02   +3.058413899661312e-02   +2.388653258944505e-02   +6.266988668620132e-03   +1.256079111874346e-02   +3.806690453042855e-02   +1.861108402455219e-02   +3.423739313851207e-02   +3.003982845350786e-02   +4.006638043807392e-02; +3.055413356633075e-02   +5.513811245400101e-02   +4.456690558194921e-02   +3.554866225583997e-02   +6.588244613625245e-03   +2.268785531622761e-02   +3.490405066062056e-02   +4.415480205580156e-02   +4.751106449447972e-02   +5.281431292640896e-02   +3.442059573316843e-02   +3.120154026736538e-02   +5.121869908355536e-02   +4.348073183828219e-02   +2.126954936677311e-02   +3.560505674727616e-02; -8.134944486380192e-06   +7.799239247803709e-03   +4.746850620208227e-02   +6.686983886745672e-03   +2.517735745175168e-03   +3.522529764239905e-02   +4.022970677023856e-02   +2.453744595601424e-02   +2.539113558206770e-02   +4.944858054901018e-02   +3.168359278483656e-02   +5.885958130607816e-03   +1.878859695799771e-02   +1.547291118724074e-02   +6.300607658488810e-03   +5.408188524171151e-02; +2.879003455494238e-03   +4.968407209841602e-02   +2.384222608520505e-02   +4.709406828381955e-03   +2.838510889856699e-02   +4.295323304961219e-02   +3.566819922671121e-02   +2.045679629167750e-02   +4.477398517747635e-03   +4.800825022041562e-03   +3.885812048178015e-02   +7.685104623944856e-03   +4.169286453292497e-02   +2.270803125486779e-02   +3.517475373413616e-02   +2.439969452530034e-02; +4.383658419527273e-02   +4.246091042253264e-02   +2.374799589548090e-03   +3.618653023422822e-02   +1.770116977205944e-02   -2.900786050043510e-03   +3.578157180335017e-02   +1.741137019014834e-02   +4.366713998694279e-02   +1.129301260427912e-02   +4.380982026996900e-02   +3.168613940513527e-03   +2.239485350228184e-02   +3.202760754787517e-03   +3.566524030219134e-02   +1.170256294616032e-02; +2.350160381550403e-02   +1.411394523837820e-02   +8.192549576489135e-03   +1.518759461339540e-02   +9.430683714563882e-03   +2.375978355723114e-02   +1.137940220441585e-02   +2.641121087583585e-02   +5.178872608986414e-02   +1.066574738434354e-02   +4.175295992588783e-02   +5.131844137187719e-02   +5.742160777812728e-02   +3.048368476614156e-02   +2.717181637119637e-02   +1.367566272614642e-02; +1.664351244463473e-02   +5.084083349940456e-03   +6.010057972379833e-03   +9.412552035212785e-03   +3.721454956782195e-02   +2.844233195823139e-02   +2.600512614969063e-02   +2.884671553676325e-02   +1.729295177291747e-02   +2.015637537959531e-02   +4.289390371627507e-02   +5.991679067579238e-02   +2.769925395718369e-02   +2.168660777727005e-02   +4.277588075138528e-03   +3.340109380274623e-02; +1.745659667651052e-02   +2.941890209146843e-02   +1.714250738701850e-02   -4.811375828956035e-03   +1.370454567167690e-02   +3.821453115030753e-02   +4.576131533561181e-02   +4.962760457862008e-02   +2.040890988350092e-02   +6.082546178958940e-03   +3.811618484762858e-02   +2.033783794029167e-02   +4.746931662427931e-02   +5.071143660934651e-02   +2.811002957197677e-02   +8.748347844754409e-03; +3.977865248223748e-03   +1.938955872466583e-02   +1.275337274220936e-02   +3.144084789690228e-02   +1.722115061791905e-02   +3.721154170304466e-02   +1.789967177058783e-02   +1.274658030230299e-02   +5.094660106606326e-02   +4.599757925403906e-02   +8.148116667125855e-03   +2.751802866006532e-02   +4.056081209818727e-02   +1.176675291198017e-02   +3.694622304251496e-02   +1.548050850005127e-02; +4.769955065453317e-02   +5.080417999726575e-03   +1.277094963717553e-02   +2.283868024549649e-02   +3.517589766005423e-02   +3.244724178995839e-02   +2.606156739529048e-02   +5.334906004457070e-02   +1.607967943713196e-02   +1.546230843319465e-02   +2.577696794990365e-02   +2.876400928161837e-02   +9.715977348365282e-03   +5.298565265569136e-02   +4.498736837761882e-02   +2.037851415952482e-02; +9.123799705012516e-03   +5.194908506710093e-02   +2.938680397891200e-02   +4.903545567063469e-02   +4.985371813910194e-02   +3.640652710374639e-02   +2.470719356061031e-02   +6.566796083657248e-03   +3.787770387571456e-02   +2.396565536457108e-02   +9.367390586495609e-03   +4.126301375979980e-02   +3.470016033309872e-02   +3.067766639288776e-02   +4.129133535633717e-02   +1.119838823749964e-02; +3.810652573642218e-02   +7.738200508862127e-03   +3.123342693896743e-02   +7.372446966298908e-03   +2.937478289901406e-02   +3.020459446675493e-02   +2.910207187695303e-02   +1.026259105918059e-02   +4.127243022085337e-02   +4.382523507035180e-02   +1.494822383454265e-02   +4.496138055593844e-02   +4.849843555484671e-02   +3.726234379535050e-02   +1.825697883819778e-02   +6.580519100747320e-03; +1.539502272511246e-02   +1.310248109759032e-02   +8.676851042342303e-03   +4.632315977255957e-03   +9.367992519381182e-03   +4.856716693590882e-02   +4.671379037475988e-02   +4.140240243718618e-02   +2.274723538873710e-02   +3.103351174102648e-02   +4.532801167407150e-02   +3.845492003192728e-02   +3.281951043097814e-02   +4.310493575919798e-02   +3.458773139989742e-02   +3.930225764908514e-02; +2.113322915839677e-02   +7.684701182576687e-03   +2.116757832517812e-02   +4.448313943779693e-02   +2.931008616333149e-02   +2.863554580911839e-02   +3.336577183884183e-03   +1.592778434838392e-02   +1.145247696516965e-02   +3.006684641279453e-02   +1.463140835635357e-02   +2.253687924310282e-02   +1.542794309903206e-02   +7.790985766104881e-03   +6.779485820986337e-03   +1.531547320052514e-02; +2.513365167816741e-02   +7.220190865658401e-03   +1.161946009225710e-02   +4.608889823280909e-02   +5.035914774361111e-02   +3.573201154251717e-03   +1.295607157255987e-02   +4.303516622890825e-02   +4.420096925810066e-02   +6.723689106679883e-03   +1.625682960897034e-03   +2.797888778631202e-02   +3.817114701748430e-02   +2.740348354081394e-02   +2.161324416662732e-02   +2.563235166192320e-02];
L2I_L1I_iGABA_netcon = [+5.209023644726918e-02   +2.006021062584843e-02   +1.404774445345700e-02   +4.620780500930659e-02   +5.456937003146831e-02   +4.539900072930099e-02   +1.932616088874844e-02   +4.241496983022447e-02; +4.211910101899095e-02   +4.778084508394628e-02   +3.111643320434966e-02   +1.640030476238935e-02   +2.196466747378698e-02   +3.707507062222557e-02   +4.627589005532341e-02   +1.427242237562505e-02; +1.031007674729004e-02   +1.229274318174029e-02   +1.210460827966887e-02   +5.073222350468203e-03   +4.530225841345112e-02   +4.986933530434007e-02   +7.253946739232931e-03   +3.133540256101072e-02; +1.441868828513112e-02   +3.896699235647354e-02   +3.711968282957224e-02   +3.290348311972098e-02   +3.008047337293456e-02   +2.794136880578068e-02   +2.618698426636632e-02   +4.655433578535340e-02; +1.407924514627838e-02   +5.722055576694571e-03   +3.086463262750879e-02   +3.377682377927547e-02   +2.293444904285971e-02   +4.212376970205305e-02   +2.276315665933346e-02   +3.060293751572837e-02; +3.948433672095288e-02   +3.383540653466392e-02   +4.801682301149104e-02   +2.662054941520863e-02   +1.380586553040810e-02   +3.372115715984116e-02   +7.308163333469344e-03   +3.723704284667418e-02; +2.240689703044787e-03   +2.211970120505013e-02   +1.859788935691904e-02   +1.213506673042363e-02   +4.337288030506327e-02   +1.317783652072407e-02   +1.169234038827985e-02   +3.785333519463091e-02; +2.986555581980359e-02   +2.289947550900349e-02   +4.211675233800161e-02   +2.653820614783037e-02   +1.518896766833344e-02   +3.406409454722152e-02   +2.269055054402105e-02   +1.495503707563622e-02; +2.738350388341729e-02   +3.267865715851626e-02   +1.160732913318953e-02   +9.564375586021469e-03   +1.437336564136956e-02   +9.455146134749629e-03   +2.289170313828805e-02   +5.193187706271948e-02; +2.418721936968673e-02   +3.631677047231514e-02   +5.614577688317428e-03   +2.072805135350583e-02   +8.714598137017481e-03   +3.439548090033111e-02   +4.791296065239967e-02   +3.715819406766032e-02; +2.595908518621272e-02   +4.442601850355629e-02   +4.084544138997628e-02   +1.743561661970327e-02   +3.945177511698326e-02   +4.428080217792170e-02   +5.013270765497671e-03   +2.061187541240520e-02; +4.208727659305977e-02   +2.621863434538753e-02   +3.740436746354849e-02   +2.545463643811715e-02   +4.901527385852836e-02   +8.065393838322214e-03   +3.297786142629367e-02   +1.623433915181483e-02; +2.263675789410874e-02   +5.009056655337168e-02   +4.378615831761907e-02   +6.297238262605118e-03   +2.641068329054010e-02   +1.853583911005485e-02   +1.497976922797450e-02   +3.410155126272524e-02; +4.122254222982867e-02   +1.397780665713375e-02   +5.098692280583071e-02   +2.867388462318723e-02   +4.699137933937398e-02   +1.116857692310957e-02   +4.511412142364049e-02   +1.359853811576461e-02; +5.293818612145816e-02   +1.371243362410317e-02   +1.475821075854109e-02   +5.176696301811829e-02   +3.590297583866380e-02   +4.891866770658336e-03   +2.346687274672204e-02   +4.036844284022951e-02; +8.405952056580113e-03   +3.781844504788007e-02   +3.044637974519140e-02   +3.621534257294499e-02   +4.612229317817765e-02   +4.119902491620865e-03   +4.881500336266686e-02   +1.495459118097814e-02];
L1I_L2I_iGABA_netcon = [+3.362605016032440e-02   +3.231207509636402e-02   +4.432170600123484e-03   +4.806366686537430e-03   +3.012009912621845e-02   +1.766394140678466e-02   +5.252691859494575e-02   +3.356411034320344e-02   +2.415883402993067e-02   +4.252249349496525e-02   +6.208620887706069e-03   +1.036778053858289e-02   +7.007525387222150e-03   -1.709813952902990e-03   +8.787078822668890e-03   +4.919676058650407e-02; +3.863109737408430e-02   +3.379325703048312e-02   +2.195887404687735e-02   +2.562900113143202e-02   +4.690754357675875e-02   +2.326787130204620e-02   +2.827155294619400e-02   +5.201232301699604e-02   +2.689766184529640e-02   +4.904459799450103e-02   +3.669864745567040e-02   +1.784438806533666e-02   +2.666971057560290e-02   +6.771647072316471e-03   +3.029142109063881e-03   +4.263335780134320e-02; +4.753056184611926e-02   +3.229696611368432e-02   +1.201694516503843e-02   +4.123246966774822e-02   +1.546955448620376e-02   +4.779985508401361e-02   +3.279918692547489e-02   +3.352103783829517e-02   +1.986103837012381e-02   +2.532378578278700e-02   +3.246284640670768e-02   +1.994399226438306e-02   +2.246943774704636e-02   +8.282794151960978e-03   +3.015051059734803e-02   +8.729538730296540e-03; +2.283690684595178e-02   +1.186223198960534e-03   +3.169994645042724e-02   +4.257684680667410e-02   +1.201613958132858e-02   +4.572970676697470e-04   +1.793425543916328e-02   +1.651122719603526e-02   +1.185752809120881e-03   +3.345798450990296e-02   +2.433965789050815e-02   +2.318237383090278e-02   +1.680533661183737e-02   +2.118290273459241e-03   +3.790848682278852e-02   +2.197544309202934e-02; +6.942055131746079e-03   +4.139751206800602e-02   +3.795597932839732e-02   +3.378647038999737e-02   +3.254834166276541e-02   +3.249907114610330e-02   +3.145468224461162e-02   +4.677441284379900e-02   +2.977851533238629e-02   +4.423737971562389e-03   +1.208568836278540e-02   -3.508119743205414e-03   +1.578850240502734e-02   +4.958280407615610e-02   +5.034899330079508e-03   +3.261509086536155e-02; +3.089252585502322e-02   +3.400427921940406e-02   +6.115860790584193e-03   +4.851085478411999e-02   +2.967785093945636e-02   +4.851005413186472e-02   +3.317834600669919e-02   +4.266985989247461e-02   +3.369129484701631e-02   +2.945514168226339e-02   +4.537349656493568e-02   +3.960358223864701e-02   +7.516021703911037e-03   +5.508441115589846e-02   +3.287877257506563e-02   +4.561365907647037e-02; +4.493930312861998e-02   +7.563812938156729e-03   +4.134137126740101e-02   +5.169882320796506e-02   +2.029072897650818e-02   +5.540786737108475e-02   +2.938899368863526e-02   +2.172986229092769e-02   +1.259040177432033e-03   +2.926664391549482e-02   +1.821333078648641e-02   +1.557086922307312e-02   +4.175364036179148e-02   +2.120761854378147e-02   +4.905243213599696e-02   +3.049549991827145e-02; +3.891097268630218e-02   +2.164216696235405e-04   +4.271515568762611e-02   +3.767444016385335e-02   +4.955869071038045e-03   +3.911159902354636e-02   +3.695979390076823e-02   +3.965871799183637e-02   +2.716115920352664e-02   +4.583732067168379e-02   +8.708689536297992e-03   +2.598392113529050e-02   +2.683853617669254e-02   -2.286760195041962e-03   +4.586441640365853e-02   +4.508847785404679e-04];
L2E_L1E_iAMPA_netcon = [+4.414816400602801e-02   +1.936631016729434e-02   +5.479044400673381e-03   +5.318861930109532e-02   +1.335171972025143e-03   +2.044771136288632e-02   +3.433350966286600e-02   +3.177933594910009e-03; +4.617546150705452e-02   +4.743126878576888e-02   +2.998344996130386e-02   +2.012131974775394e-02   +2.887257633985404e-02   +1.406928410721118e-02   +4.827305629507709e-02   +2.344015088934196e-02; +3.168939571536368e-03   +9.194956885242240e-03   +1.025165820510028e-02   +1.098809156234721e-02   +2.741773821661599e-02   +4.513926196275034e-02   +2.050508793840636e-02   +1.202428684309067e-02; +1.514371741881643e-02   +4.012674339219090e-02   +1.455556483363404e-02   +3.703390670446357e-02   +4.570196053099894e-02   +1.838212508703421e-02   +4.766823343783944e-02   +4.910080331452725e-02; +9.183641850769583e-03   +5.455948108005963e-02   +3.205905714730877e-03   +9.463722231654812e-04   +4.973174399335314e-02   +4.801903705585389e-02   +3.555010766531154e-02   +2.017858001836054e-02; +3.885520161349566e-02   +2.388825627319792e-02   +4.914971305011854e-02   +4.293416536055194e-02   +3.105497227108679e-02   +6.715440964121416e-03   +3.522346364751940e-02   +3.426130160361695e-02; +4.833992468879507e-03   +1.731192669749916e-02   +1.026062269754924e-02   +1.866716604460558e-02   +4.556763373485738e-02   +2.183887385479654e-02   +9.317674712678888e-03   +1.727952851456910e-02; +3.021592282654229e-03   +6.489354370253067e-03   +2.411501623970848e-02   +3.458027859925156e-02   +1.966141441236488e-02   +4.705190208372013e-02   +4.671934289130004e-02   +4.643296604998595e-02; +2.100379339387315e-02   +4.578219328364171e-02   +2.257895022339100e-03   +1.498911678633640e-02   +7.719543648521430e-03   +5.407321762222577e-02   +2.437354505915212e-02   +2.851660170888328e-03; +1.198388068142048e-02   +1.248218057366169e-02   +4.448418993620878e-02   +2.124906081110494e-02   +4.994223073500514e-02   +9.060623838039459e-03   +8.735359903540874e-03   +4.582080176331787e-02; +2.812429481016502e-02   +1.872996691905453e-02   +6.597002182320244e-03   +3.543448866714865e-02   +2.254123725739858e-02   +1.561399626342983e-02   +3.401334626383845e-02   +4.209477197050586e-02; +1.406091622524108e-02   +2.311082304403429e-02   +4.207333073278895e-02   +3.725702257033053e-02   +3.280714649545603e-02   +7.848146798658737e-03   +5.161312129777414e-02   +8.018323277452942e-03; +3.478820437548642e-02   +4.433602615607234e-02   +7.451184766630961e-03   +7.841004627610603e-03   +4.901390040079098e-02   +3.721762045129520e-02   +2.585947003936579e-02   +5.020157451574613e-02; +2.287601045860469e-02   +3.473411419551760e-03   +4.053471197862583e-03   +4.448409933813455e-02   +3.735167652683903e-03   +1.450683572879484e-02   +5.074240905185321e-03   +3.638175893434782e-02; +2.060486768796950e-02   +8.428416568955738e-03   -8.372497638807501e-04   +4.554436149886405e-02   +9.226960169592718e-03   +1.913212578485519e-04   +2.203686022342866e-02   +9.900711365084806e-03; +9.814232513861093e-03   +2.585199889551978e-02   +2.742252357811191e-03   +2.381694991000903e-02   +9.706207883160659e-03   +2.855341493858229e-02   +4.067398254113517e-03   +4.563890821373083e-02];
L1E_L2E_iAMPA_netcon = [+1.044549783103100e-02   +1.171727252451750e-02   +5.094238874961771e-02   +5.030297004216925e-02   +1.766919035009008e-02   +4.779931479490901e-02   +2.546386503981475e-02   +5.184812939993163e-02   +9.979952510526462e-03   +3.153074404786655e-02   +2.843978605554188e-02   +4.009858531983059e-02   +2.187547208371825e-02   +3.589060806604641e-02   +3.104684851944380e-02   +2.466459040302946e-02; +1.839439392758579e-02   +3.818834556104182e-02   +6.005065429474892e-03   +1.038411919955069e-02   +6.048684064011954e-03   +3.594715037649550e-02   +5.611757000796280e-03   +1.352774649623635e-02   +1.577108379928207e-02   +1.519384365907889e-02   +1.432951617553181e-02   +5.023515870267029e-02   +8.150712101672892e-03   +1.155681121910936e-02   +3.238199910871876e-02   +1.487662984776268e-02; +1.846033972335288e-02   +3.127235583711934e-02   +4.843869119483996e-02   +4.525375913808496e-02   +4.554607970779161e-02   +6.203990006360793e-03   +1.827888419769962e-02   -4.850642412095025e-03   +2.334857647213643e-02   +3.674150954642729e-02   +1.634774753292026e-02   +4.344176037639914e-03   +3.599301810923105e-02   +3.047185296986437e-02   +5.103981803072857e-02   +5.988320744012842e-03; +3.553356304948888e-02   +1.898232906841052e-03   +1.174463142449266e-02   +7.754799044442425e-03   +3.564084435630876e-02   +1.521624144462231e-02   +5.246393028063198e-02   +5.225426283999866e-02   +4.071823090301909e-02   +4.187242128676115e-02   +1.753190294856379e-02   +2.857933216570172e-02   +5.019108164557166e-02   +1.945246860795078e-02   +4.800171669212950e-02   +4.509534327771197e-02; +7.853524038920862e-03   +5.435989837419562e-02   +3.925742415864367e-02   -1.476285144153324e-03   +1.352508341125723e-02   +4.009004902957144e-02   +4.550830341886124e-02   +8.037680058447070e-03   +2.511452540193732e-02   +2.132715988847356e-02   +2.935037638591277e-02   +4.021846842686244e-02   +1.530589127407539e-02   +2.907382566034991e-02   +5.102975532844338e-02   +2.367654222292454e-03; +3.382901775255276e-03   +4.705584355893069e-02   +1.411961118112537e-02   +4.899557419686948e-02   +5.118304985242970e-02   +4.456768512755283e-02   +2.393621998461958e-02   +4.223440825549957e-02   +1.641944984707403e-02   +2.668061445612295e-02   +4.733520340309474e-02   +5.107064502763266e-02   +4.684514317850736e-02   +3.310394574426938e-02   +6.856926197575220e-03   +2.963534192847372e-02; +1.735628892247475e-02   +7.248626161736780e-03   +3.632996727768974e-02   +6.512963133992922e-03   +1.817405689421507e-02   +2.550214663952429e-02   +3.676632954552955e-02   +2.965183920961503e-02   +2.861680095265894e-02   +4.218533788928075e-02   +3.914388492019440e-02   +3.907659507644060e-03   +2.213686409889287e-02   +3.265189089981825e-02   +1.607371383768724e-02   +1.401399755961552e-02; +4.619651261764656e-03   +2.965812167405947e-02   +2.469649657169709e-02   +2.136005765099266e-02   +3.335582609333530e-02   +5.218203288166719e-02   +5.234386845765747e-02   +2.853626793110929e-02   +4.618918837747994e-02   +2.208417464865345e-02   +1.780909732620236e-02   +5.260967753558685e-02   +3.784408661422647e-02   +4.098040256353336e-02   +1.272205032770944e-02   +1.105632083649491e-02];
L2I_L2E_iAMPA_netcon = [+3.720670326171119e-02   +2.002922519199976e-02   +4.640989181675524e-02   +2.392366203718093e-02   +4.162377791142100e-02   +1.896450913908035e-03   -3.045623051710313e-03   +4.729353138320371e-02; +8.825580438247136e-03   +9.389876085386469e-03   +1.231374161539989e-02   +3.857036319357797e-02   +3.643930399966841e-02   +1.725747133513163e-02   +3.382672074222461e-02   +2.738560780329062e-02; +4.317481606932609e-02   +4.155142623639186e-02   +4.635498499471508e-02   +3.610824524263956e-02   +2.521899628271606e-02   +2.704866555234005e-02   +2.093326479656381e-02   +3.450466300588838e-02; +1.808232743174600e-02   +1.260146679003961e-02   +5.022399866584665e-02   +2.431442519074972e-02   +5.200280656429000e-02   +7.423906982623767e-03   +1.833731116963961e-02   +4.374918998463272e-02; +2.916578747409033e-02   +4.518428711040891e-02   +2.843692476944214e-02   +3.269574980316101e-02   +4.842221955813172e-02   +3.484341079317725e-02   +2.431702906952786e-02   +3.633333734541255e-02; +3.460754713995702e-02   +2.907312163798711e-04   +4.665084309150518e-02   +3.832091987625512e-02   +2.548724312374927e-02   +1.532737636136015e-02   +6.969611540849293e-03   +3.905868740782052e-02; +5.379053130698370e-02   +2.782620983864463e-02   +4.599435507231994e-04   -2.460774356377935e-03   +1.093868938862371e-02   +1.165684501892375e-02   +1.020275374449493e-02   +1.101579529002353e-02; +4.626708727415033e-02   +8.811879956107877e-03   +2.715804743909857e-02   +3.158815187490559e-02   +4.778991238517536e-02   +1.348095479742500e-02   +4.615872933471333e-03   +6.609293405551416e-03];
L2E_L2I_iGABA_netcon = [+5.105636370427838e-02   +9.325102752490657e-03   +1.295950371901509e-02   +7.016849288363300e-03   +3.675098801645623e-02   +2.046560418273492e-02   +3.793326114380181e-02   +5.007136773681697e-02; +1.344333645389741e-02   +2.118156864334952e-02   +1.390414913124461e-02   -2.755697299667693e-03   +5.271893890617720e-02   +4.049813060780572e-02   +3.875440002336840e-02   +2.904208249045281e-03; +3.586919622349662e-02   +2.059461935397852e-02   +2.521056858778680e-02   +9.695317032913682e-03   +1.244564536506637e-02   +1.576563725240225e-03   +5.455872668596080e-02   +4.501071467279148e-02; +3.729364140627620e-02   +2.387304453509681e-03   +8.323931400185811e-03   +3.943990758709873e-02   +4.875828516989109e-02   +4.079064771089453e-02   +2.209833521796775e-02   +3.154639737112798e-02; +9.241606248991353e-03   +4.245557267028448e-02   +3.642656355231525e-03   +4.217242858572250e-02   +1.873121443577985e-02   +1.934348503013191e-02   -2.680392555928380e-03   +1.469905065101918e-02; +3.835931572059097e-02   -6.641190526084104e-03   +2.505990105257121e-02   +4.368920376656513e-02   +4.404937993448144e-02   +1.911795005623286e-02   +5.043217908804572e-02   +3.784045219518161e-02; +5.887990539783622e-03   +5.563323265974172e-02   +1.095353421237596e-02   +1.193434102162318e-03   +4.041582507718965e-02   +2.243055306163429e-02   +2.636464549437018e-02   +2.866134568012743e-02; +4.211205584041398e-02   +1.611407487294233e-02   +2.846215122060168e-02   +1.653130484607247e-02   +1.942323837974377e-02   +4.072194029355987e-02   +4.973845583641524e-02   +3.427506754827570e-02];
L3E_L2E_iAMPA_netcon = [+2.164563791918563e-02   +3.311566748010646e-02   +8.006750720029843e-03   +2.421870494138966e-06   -1.692537890798134e-03   +5.315276385340122e-02   +1.642934259600669e-02   +4.552298593024284e-02   +5.051954480969215e-03   +8.378429547311796e-03   +1.910649639933625e-02   +4.965702734611918e-03; +1.175054307516707e-02   +4.902513609465773e-02   +1.530365835553806e-02   +2.218275057357111e-02   +2.839999384487540e-02   +3.133819106269787e-02   +4.237124956482741e-02   +5.181494208680117e-02   +3.209852257834818e-02   +4.946963872084375e-02   +2.044340136065432e-02   +1.727757289323646e-02; +5.362767043258983e-03   +4.074820581290501e-02   +7.481417282854006e-03   +3.746941953434405e-02   +2.068581299856772e-03   -7.838155431375371e-04   +3.252436641578679e-02   +5.151740941297329e-02   +3.448139225700043e-02   +2.505804744809767e-02   +1.527576050415763e-02   +3.493805833012625e-02; +5.933508694888542e-03   +1.739026065878153e-02   +4.545609495453273e-02   +2.136380827125807e-02   +1.274505969263664e-02   +2.506481091883119e-03   +1.908121571453617e-02   +1.096920285153790e-03   +7.721449009533533e-03   +1.772697937002317e-02   +9.298635144106136e-03   +1.652770763172033e-02; +4.566790719457900e-02   +2.077056958063042e-02   +1.926513431326440e-02   +4.625391654023123e-02   +4.117872945788262e-02   +1.447050642816203e-02   +5.177197088329969e-02   +7.914425126728783e-03   +3.855775263598890e-02   +2.025672831116640e-02   +4.143614650371143e-02   +1.845995098746283e-02; +4.444953097378650e-02   +3.058632767763903e-02   +2.716944782623223e-03   +2.103243627278147e-02   +3.416623413024310e-02   +5.147679782385613e-02   +5.269056735725498e-02   +1.958040739748541e-02   +2.764882367215961e-02   -4.757507946640845e-03   +3.185522822739894e-02   +9.379280064733962e-03; +3.512688158524883e-02   +1.967634442938573e-02   +2.889850791747348e-02   +1.384352013275788e-02   -6.777505397481077e-04   +2.409705176366688e-02   +2.688361181280876e-03   +2.096617054505826e-02   +1.558358041579101e-02   +5.137999396030176e-03   -4.129328915131864e-05   +2.043091310132024e-02; +4.543247776339123e-02   +1.036862066697511e-02   +1.496535960098648e-03   +1.660454547906663e-02   +2.927964946694364e-02   +5.934220742039013e-03   +4.395395084079814e-03   +2.175526885301429e-02   +2.268597505653178e-02   +4.395796127212911e-02   +8.494672288218272e-03   +3.219574070252401e-02];
L3I_L2I_iGABA_netcon = [+5.374281207241435e-02   +3.631166373888942e-02   +3.587260951378022e-02   +1.897835044602924e-02   +4.938649609056714e-02   +2.318343410941777e-02   +6.175288083260953e-03   +1.441058546917484e-03   +4.557349190885258e-02   +2.886304786344082e-02   +8.227004906282668e-03   +4.101033236154836e-02; +4.260043457511330e-02   +5.173791416788012e-02   +4.201817934504190e-02   +9.468827287582204e-03   +2.354825132387591e-02   +3.962184423535781e-02   +5.765272067987506e-04   +5.380881510327955e-03   +2.995519464464454e-02   +3.697172228234466e-02   +3.417553025097706e-03   +3.543491185174101e-02; +4.637169305555899e-03   +4.040362205516681e-02   +5.277346808823370e-02   +8.368605271208304e-04   +3.612910168015875e-02   -3.187097201256953e-03   +3.769614158839474e-02   +5.310035606846108e-02   +3.585711474122789e-02   +3.643502022699025e-03   +3.199187879376699e-02   +2.578387450897647e-03; +5.612797544254561e-02   -4.737242305595642e-04   -1.298955752244551e-03   +3.655585424757687e-02   +4.887742774479293e-02   +3.033789773691280e-02   -3.262090396768276e-03   +1.106371689063106e-03   +4.948828362062309e-02   +4.492344395845103e-02   +4.631024284240326e-02   +3.259902460692755e-02; +1.197673480261110e-02   +5.617071975001336e-02   +1.683424431493652e-02   +2.234930748553368e-02   +2.610575376848209e-02   +5.263478013984586e-02   +1.655729342616035e-02   +5.381379901700159e-03   +4.453751035916671e-02   +2.915804226762881e-02   +9.271803479838421e-03   +8.310563941680650e-03; +1.259498299298986e-03   +3.236915885007488e-02   +1.061054860260075e-02   +1.399873674909959e-03   +8.625140938363805e-03   +3.037989811869446e-02   +4.024589451677300e-02   +8.130054031302686e-03   -1.171544929425753e-03   +4.241419198384476e-02   +3.767675486706279e-02   +3.296792179185186e-03; +3.316112683919578e-02   +4.716493461461055e-02   +2.806548884955024e-02   +3.472614120780065e-02   +2.737961996651320e-02   +1.001851281784528e-02   +3.083170545751434e-02   +5.132866507961352e-03   +5.083539258010572e-02   +1.645688813401914e-02   +2.496951759485184e-02   +3.467616064108550e-02; +2.923790477307904e-02   +3.988532769587761e-03   +1.585922449563609e-02   +2.717256182569062e-02   +2.199006700251250e-02   +5.641996268851740e-03   +1.218273151044368e-02   +1.214744372306127e-02   +3.309864908527801e-02   +5.151453649205033e-02   +1.296615322404262e-02   +1.726723209829997e-02];
L2E_L3E_iAMPA_netcon = [+3.262656118890548e-02   +2.898394523331858e-02   +1.467518793553752e-02   +4.011034956987355e-02   +5.929562738234691e-03   +3.112020759576594e-02   +3.819145407519766e-02   +5.172995942069077e-02; +2.248920373439468e-02   +4.048863090072667e-02   +3.881454373303096e-02   +3.511908562506055e-02   +7.304569572890315e-04   +3.272525784235304e-02   +4.705727395498862e-02   +3.243635063921821e-02; +4.135627783280499e-02   +4.772916814900187e-02   +4.282344564099574e-02   +4.828439975902823e-02   +3.747007238444123e-02   +3.619335678534541e-02   +3.800786326296745e-02   +2.812871954616753e-02; +2.472731913887282e-02   +4.790803819175483e-02   +4.492162617314125e-02   +3.034018357481695e-02   +2.498125222621957e-02   +2.689508736043328e-02   +1.498733998680985e-02   +6.533889964213082e-03; +5.642043032229076e-03   +2.866241375069777e-02   +1.517817079584058e-02   +6.194686312021067e-03   +6.141729203524627e-03   +2.959059056323966e-02   +4.751364469652587e-02   +3.859454323134297e-02; +3.142902274556465e-02   +5.581155954523780e-02   +4.604085427577517e-02   +2.976693400999839e-02   +2.468848757195555e-02   +5.050321220430520e-02   +3.470107016585497e-02   +5.111413429135452e-02; +2.158357666416250e-02   +5.311761210836511e-03   +2.596541347214558e-02   +3.995354696098343e-03   +1.911696424482081e-02   +4.870170178634849e-02   +1.731116176995218e-02   +3.656498147335929e-02; +4.752264758837197e-02   +3.661702698140658e-02   +2.667474944771367e-02   +4.077095798023660e-02   +1.940634013217616e-02   +3.925408816748611e-02   +2.599380154092788e-02   +1.981961054898728e-02; +1.926550169191679e-02   +2.533212173414847e-02   +5.106373861848397e-02   +2.986695128788495e-02   +3.147521283762955e-02   +1.137381042253181e-02   +3.111692749504952e-02   +3.219670461521514e-02; +1.314184202302312e-02   +1.034159230817823e-02   +3.991062911653459e-02   +4.764465848945340e-02   +5.113331106194428e-02   +2.739483183186494e-03   +6.783956555128652e-03   +3.283258799042631e-02; +3.281478174390178e-02   +1.357533103631204e-02   +3.763303876262897e-02   +3.835356870735770e-02   +4.315892899228893e-02   +5.632355565104388e-02   +1.011634766886255e-02   +2.200864672452326e-02; +3.893941582760323e-03   +3.293499799824566e-02   +1.911267910456832e-02   +4.016255516930518e-02   +2.322746328047869e-02   +8.704739390574699e-03   +3.520675366411904e-02   +4.468176721379136e-02];
L2I_L3I_iGABA_netcon = [+4.986289885641913e-02   +2.113082371043179e-02   +1.421338116681968e-02   +3.009733759939743e-02   +4.417011394570929e-02   +4.318691047956100e-02   -2.474048008682624e-04   +2.616042168105336e-02; +2.343501412363745e-02   +2.399648652604144e-02   +4.008193950967839e-02   +1.159605556747476e-02   +4.166588800254410e-02   +4.398664938426303e-02   +2.682764253046243e-02   +1.814777835515629e-02; +3.451671550668828e-02   +4.192805512552022e-02   +4.818709235647929e-02   +3.152255434752248e-02   +2.075634031017466e-02   +3.192125462617067e-02   +2.682828719151537e-02   +3.823054402919869e-03; +1.088032732176999e-02   +4.084952670730171e-02   +1.187638146597246e-02   +2.613610073268499e-02   +8.356768507794848e-04   +1.693787384786360e-02   +2.175181254291517e-02   +5.287901136980707e-02; +1.790808705393155e-02   +2.193080038743278e-02   +2.863417815630907e-02   +2.488714994007786e-02   +1.860844119396812e-02   +3.077463578584272e-02   +5.974940055355035e-03   +5.418235467265485e-03; +2.288133360084053e-04   +1.493465128283505e-02   +1.690076527920982e-02   +3.893694648343060e-03   +2.036545410876570e-02   +2.526401526620866e-02   +2.679684957304092e-02   +4.449367075707881e-02; +2.059075881811329e-02   +2.487687157081422e-02   +4.983407125709988e-02   +3.609714857708830e-02   +4.194635600143756e-02   +1.764613183643532e-02   +2.264005483712608e-02   +2.019631051521464e-02; +5.293501414490187e-04   +4.727371448630552e-02   +1.526222407088834e-02   +3.980346709855106e-02   +5.502101741891632e-03   +3.731377888025676e-02   +2.809020928751471e-02   +3.728263295044448e-02; +4.197452240311183e-02   +2.453313284219065e-02   +4.673663634799367e-02   +1.017234369892469e-03   +2.686619753179495e-02   +1.411234967143764e-02   +2.065404235875088e-02   +2.865356612803987e-02; +4.022646142789914e-02   +2.839912858144690e-02   +3.382070291027837e-03   +2.684150929365441e-02   +2.743889421443248e-02   +1.348684908290970e-02   +1.102631740150444e-02   +1.698818997465077e-02; +3.769975315069477e-02   +4.849974428516422e-02   +3.049208960802532e-02   +3.659967816430038e-02   +1.830561402841301e-02   +2.436799986590872e-02   +4.785956929141062e-02   +1.043728496394029e-02; +3.527444789805644e-02   -3.884556351175916e-03   +1.527461477357915e-02   +5.357572075319621e-03   +5.946263494632477e-03   +4.680668091723689e-02   +2.883787343117113e-02   +2.914614770252822e-02];
L3I_L3E_iAMPA_netcon = [+2.158830047196418e-02   +4.747742323728925e-02   +8.248194838124183e-03   +3.002411496128823e-02   +3.770752269544294e-02   +2.246731075941517e-02   +1.640415570992878e-02   +8.567566579189030e-03   +2.296395484014240e-02   +1.890297966606014e-02   +1.503646598899026e-02   +6.850770750951815e-03; +2.241126972534380e-02   +3.416284398885257e-02   +1.454683295692822e-02   +5.358313218294917e-03   -2.628221733861541e-03   +2.836510238519115e-02   +3.255580041484108e-02   +2.518718182304465e-02   +1.868461379273414e-02   +2.798769137803347e-02   +3.692967974629947e-02   +2.712584989006765e-02; +3.191648519996405e-03   +2.444305381984264e-02   +2.773824168078091e-02   +2.898411751786327e-02   +2.608459619656872e-02   +2.133029906874789e-02   +2.172214342322930e-02   +1.976450675984347e-02   +2.263804394841192e-02   +2.923140101461365e-02   +2.162520144895092e-02   +2.858542938166389e-02; +2.407874114337891e-02   +3.673991329553801e-02   +3.316271930864128e-02   +2.667981301181039e-02   +2.673914843222799e-02   +4.856402037098986e-02   +4.097464386593676e-02   +7.506184267411940e-03   +4.869845137272723e-02   +4.923505295322692e-02   +1.110712956656669e-02   +3.199370032875103e-02; +3.715186737551406e-03   +2.447575633944982e-02   +1.077896893322851e-02   +4.753949925197079e-02   +4.004388529265979e-02   +2.908713916968173e-02   +4.945598799902511e-02   +1.627373136077913e-03   +5.110746347980295e-02   +2.809321322593770e-02   +1.371601860376700e-02   +6.771007702847390e-03; +1.556854440715193e-02   +2.471400904202033e-02   +4.088683289212649e-02   +2.506073041526372e-02   +5.324113223133837e-02   +2.711214414720445e-03   +4.458103154826578e-02   +1.391381673315697e-02   +3.521470488113610e-02   +8.103394620114323e-03   +1.473387322496853e-02   +1.096906349929908e-02; +4.097061064133455e-02   +1.915620214165612e-02   +2.018028842373281e-02   +1.471680291468349e-02   +2.895324786580231e-02   +7.523803652567227e-03   +2.429653806535085e-02   +5.009422971063519e-02   +4.721417549017361e-02   +5.289742069553374e-02   +2.925811552793083e-02   +3.602718070584617e-02; +3.941518537190616e-02   +8.184576159023129e-03   +4.042094268600600e-02   +3.590821992985105e-02   +4.962003815508923e-02   +3.013182105982112e-02   +4.383531556943304e-03   +2.785391432320462e-02   +2.780169555864816e-02   +1.676486431919706e-02   +1.176189320548816e-02   +4.836174474141917e-02; +7.030852876334215e-03   +4.491961663773715e-02   +3.277351092419179e-02   +3.423953005723965e-02   +2.006848125093506e-02   +3.804303289269950e-02   +1.078563160292557e-02   +3.932682303244923e-02   +3.840945940021177e-02   +2.324489626805002e-02   +1.681776730782324e-02   +8.966624465292426e-03; +4.963193495306649e-02   +4.592305071964101e-02   +2.029226921737380e-02   +1.570488907937099e-02   +2.469718935968090e-02   +4.507288647332577e-02   +3.196918345731616e-02   +4.956198866460629e-02   +4.041947805253883e-02   +1.863815306139615e-02   +4.695323995742516e-02   +1.381069366167035e-02; +2.411129339689350e-02   +2.147828936339076e-02   +5.372855023943698e-02   +4.446711242700362e-02   +5.139077896000599e-03   +2.970873538892114e-02   +4.109441316146245e-03   +1.310010059381189e-02   +3.193621225965010e-03   +4.838676190643557e-02   +3.976543159344957e-02   +2.022283456988346e-02; +2.996804209605955e-03   +1.222331643537619e-02   +5.910945697561856e-03   +3.056093650031542e-02   +2.566988492336251e-02   +1.646009250946494e-02   +4.164876010710433e-02   +3.695513290965522e-03   +1.753292052266124e-02   +9.281187046348699e-03   +3.779262082681677e-02   +1.655338830136695e-02];
L3E_L3I_iGABA_netcon = [+3.255774806483992e-03   +1.989966591807847e-02   +1.434921470953250e-02   +5.184552285316774e-02   +4.022383272324170e-02   +3.380724081772725e-02   +1.780077773640379e-02   +3.724667503450497e-02   +3.047147453321032e-02   +3.934691640904431e-02   +2.735558771366692e-02   +1.040649907536159e-02; +3.941704627370451e-02   +3.749155312424391e-02   +1.791315917344786e-02   -9.560758343738589e-04   +1.654540455727760e-02   +3.697840556362597e-02   +3.207472730537391e-02   +5.364644305111875e-02   +4.085122875541006e-02   +2.363593692280379e-02   +1.483858690676680e-02   -2.357494242163548e-03; +2.837517078124153e-02   +5.093256192913200e-02   +5.094031386345363e-02   +4.585273101908451e-02   -1.051883842442025e-03   +4.081638449057460e-02   +3.246997768122704e-02   +3.491312493645848e-02   +2.089772764021683e-02   +2.096405495167703e-02   +1.621066426712137e-02   +3.629712242202075e-03; +1.756542861483397e-02   -1.610296978732734e-03   +9.236800769374826e-03   +4.372568040162159e-02   +3.917913664400290e-02   +1.970369091655472e-02   +1.982902378573582e-02   +2.360278411716879e-02   +5.417643744571678e-02   +2.281165659687575e-02   +3.971679689888717e-03   +3.567969580459765e-02; +2.167333404349344e-02   +2.338235143035965e-02   +5.577683728065368e-02   +8.615518353064077e-03   +2.095851021147722e-02   +4.101376014923482e-02   +5.372276997698906e-02   +4.804076355271436e-02   +1.561209730063267e-02   +3.430253766085375e-02   +4.649476333527996e-02   +2.031372047784689e-03; +3.492446564353058e-02   +1.933481280756890e-02   +4.131570767585419e-02   +1.649980942924015e-03   +6.201631069255357e-03   +5.531481269681392e-02   +1.560374394501524e-03   -1.631370252279411e-03   +3.989166577323862e-02   +3.300366457575431e-02   +8.252288637721299e-03   +7.233600356724735e-03; +2.900484725630415e-02   +2.028919599011245e-02   +2.840558072321469e-02   +3.253582092207637e-02   +2.910227581835743e-02   +2.200848546133896e-02   +1.486930475849569e-02   +2.512137866132181e-03   +2.369741816004781e-02   +5.204334452096060e-03   +1.362325512618733e-02   +3.099792035007171e-02; +1.103389732684818e-02   +6.012328544159265e-03   +5.805661034811554e-03   +4.877740238765042e-02   +2.162616784573045e-02   +3.990002700979178e-02   +2.944554458541638e-02   +3.788710663745194e-02   +4.101550527168966e-02   +4.545633526760699e-02   +9.496099490418033e-03   +3.537069501034808e-02; +1.261917748840242e-02   +7.939789193787437e-03   +4.430461800021679e-02   +2.619946765304029e-04   +5.170944458161870e-02   +4.853859144860749e-02   +1.176713252707218e-02   +4.435313646066613e-02   +8.793857480293744e-03   +1.635373077401201e-02   +2.427230670190287e-02   +2.900412643810930e-02; +4.204291958843174e-02   +1.694074234025360e-02   +4.691354024779119e-02   +1.249945700439553e-02   +2.019524739659060e-02   +5.589887721698068e-02   +3.610177355908769e-02   +2.591013869677757e-02   +4.961076078647499e-02   +5.106819797671842e-02   +1.196161396668787e-02   -2.431939854825794e-03; +2.593298516611098e-02   +5.186508840468793e-03   +1.864895310990690e-02   +1.145742177449467e-02   +3.177260623884950e-02   +2.366495773658726e-02   +5.193944109745691e-02   +3.781928128296952e-02   +2.661234012095963e-02   +1.181370637897830e-02   +4.466851172437875e-03   +4.437470611145060e-02; +3.789493728945267e-02   +3.245252890316382e-02   +5.250869008930483e-02   +3.774321219765942e-02   +5.022530851027259e-03   +2.230879786515922e-02   +4.969462955257201e-02   +2.962091054593172e-03   +3.752837402095512e-02   +2.351073812552654e-02   +2.690061810271677e-02   +2.353676524383914e-02];
L2E_Input1_iAMPA_netcon = [+5.205406024751583e-02   +5.249903573044282e-02   +4.454089107924455e-02   +5.097011876701708e-02   +5.430473366221599e-02   +5.849066677313090e-02   +5.359242400759881e-02   +5.180763465336379e-02];
L2I_Input2_iAMPA_netcon = [+4.623911749580104e-02   +5.288337537901128e-02   +5.560759563680367e-02   +4.888197185540812e-02   +4.770717077553277e-02   +5.823065872213191e-02   +5.388412825038835e-02   +4.777869061846870e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
