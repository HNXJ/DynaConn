function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.693729928911661e-01   -3.710612598188176e-01   +3.701254096724731e-01   +3.560123641538276e-01   +1.534633104994452e-02   +1.067353001391040e-01   -7.524929214621491e-01   +3.300776955942546e-01   +6.364643440538340e-01   +6.062631030071093e-01   +3.605054751448499e-01   +2.829397611704184e-01   +2.169525239013082e-01   -1.007766598776554e-01   -4.178843384476527e-01   +1.542063309580426e-01; +6.366689523833884e-01   +2.506826104531334e-01   +8.272764337301648e-02   +9.029969684370623e-02   -2.580299927273911e-01   +6.771777889768091e-01   -7.120395970923669e-01   +7.425948498644593e-02   +5.119187310204310e-01   -4.955414475075594e-02   +7.453632903606425e-01   +3.771780205320056e-01   +3.866309617468310e-01   -1.985046687131841e-02   +5.972203593667663e-02   -9.396633838122029e-02; +3.916358861939181e-01   +2.361389707515134e-01   -1.899038405763982e-01   +3.592185539900155e-01   +4.962227811807546e-02   +2.318351476795772e-01   +4.075718657780514e-01   -1.115229802893953e-01   +3.199318083463609e-01   +2.876150380643900e-01   +3.102180521465882e-01   +3.385018935866038e-01   +1.490121371772643e-01   -4.687531078033521e-01   -1.817651677578871e-01   +1.584195767119496e-02; +7.411865516484620e-02   -2.421055393480627e-01   +4.542104502027405e-02   +6.842814580748621e-01   -2.183117532727330e-02   +4.752269752054270e-01   +7.395114454922616e-01   +8.143976384807808e-01   +5.202298351403830e-01   -1.982103005284160e-02   +5.758733695584275e-01   +3.241472440005289e-01   +1.369662083399536e-01   +5.214654817054815e-01   +1.326760681955140e-01   +8.257150828384481e-01; +1.162096579176240e-01   +2.398780038537314e-01   +5.115121813498111e-01   +5.675653845209808e-01   -1.464191753095480e-01   +3.156992787870371e-01   +1.395752147089098e-01   +1.104227268097229e-01   -6.966606884573975e-02   +3.916682912059667e-01   +6.173160105666921e-01   -8.440886641342930e-02   +5.833753625823137e-01   +3.176788303987840e-02   +3.067261189709589e-01   +7.716651887930090e-02; +1.203399231111737e-01   +7.188410957418242e-01   +2.606226126742053e-01   -2.279247869029199e-01   +5.443946505434871e-01   +3.168461105382730e-01   +4.803936888209886e-01   -2.721240533091294e-02   +3.763210505409653e-01   +2.999626642957273e-01   +3.481542170216193e-01   -4.121470608594582e-01   +2.848837558911886e-01   +3.475194382761913e-01   -1.280031823583536e-01   -5.161688696126571e-01; +3.473809305297652e-01   +2.734077569711210e-01   +5.653724998375792e-01   +1.794202233053579e-01   -3.850266568756731e-02   +4.976566026466874e-01   +2.787999899712986e-01   +1.765991614624030e-01   -6.089646450338044e-01   +4.042831476325996e-02   -1.442023245354020e-01   +2.362214372602129e-01   +4.175339383754570e-01   -1.209207786124719e-01   +4.223874683717403e-01   +6.854410828160491e-01; +6.271499234389777e-01   +1.735674900672649e-01   -1.985281074259534e-01   +1.378563432366944e-01   +1.554754271383826e-01   -8.997282362736314e-02   +1.773276882295532e-01   +6.630373631752495e-01   +3.770266252905076e-01   +2.762314397108151e-01   +4.093214971598775e-01   +1.855923718967057e-01   +1.397824634254580e-01   +2.628474180913800e-01   -2.064756779404595e-01   +2.776589728958907e-01; -4.383521788245848e-02   +5.753309462848097e-01   -3.936302938538896e-01   +1.967583897595162e-01   +2.953622886136881e-01   +5.098435131344196e-01   -1.725855103702303e-01   -2.852667782048531e-01   +3.150139488743581e-01   +1.991264008783915e-02   +6.309213741380916e-01   -1.270202977908260e-01   +2.524343260529066e-01   +2.947305887830962e-01   +7.752203331860662e-02   -7.167473492495631e-02; +1.579111605728923e-01   +6.309042988122128e-01   +3.839812721124770e-01   +3.666158526454538e-01   +7.055014814941422e-02   +1.882746021654292e-01   +5.229902775672127e-01   -9.645482943988987e-02   +1.933590832344356e-01   +1.853085322576456e-01   +6.486943391015682e-01   +9.871132052248741e-02   +6.385609252038631e-01   -8.189477175918075e-02   +6.161812902675162e-02   +2.368602282876006e-01; +1.930055397637703e-01   +5.925398788051010e-01   -2.713463230633263e-01   +1.957546774708286e-01   +6.642178629526653e-01   +1.534020448285549e-01   +2.767166761007596e-01   +1.131334416787318e-01   -5.997155347838638e-02   +5.188636348272764e-01   -4.759933857992411e-01   -8.035104820565894e-03   -6.353649096264569e-01   +2.834239947420532e-01   +3.291962858183974e-01   +3.311516206985563e-01; +2.556208534159694e-01   +2.200909758113744e-01   +1.427926025095440e-01   -8.572064010656147e-02   +3.069043651532271e-02   +7.123505165043797e-02   +3.986536703489733e-01   +1.711200020314455e-01   +7.094979379265115e-01   -4.660511811044447e-02   +3.695918713030142e-01   +6.193593458791351e-01   +7.132386706804925e-01   +1.141016333649333e-01   -1.179038160439683e-01   +5.288751842525394e-02; +2.769850055180556e-01   +1.744781018435025e-01   +4.372783222377452e-01   +9.325040282986205e-02   +8.972225758648327e-01   +5.308397971005737e-01   +1.960048322895254e-01   +6.526918349395190e-02   +6.464793820495235e-01   +2.266516958128491e-01   +4.802808266790913e-01   +5.450905395674214e-01   -4.327856373033105e-01   -6.516655796388715e-03   +1.393986530448263e-01   -1.293446885417777e-01; -8.688922005156381e-02   +3.581530545449684e-01   +2.347984751008021e-01   -6.848198451360159e-01   +2.721914905652219e-01   +6.104935781624566e-01   +1.816057975198745e-01   +4.073456973463130e-01   -2.184585941359432e-01   -3.986205765522496e-02   +5.188322275245317e-01   -9.364946835863605e-02   +1.345374040828014e-01   +6.035353224821953e-01   -1.298199651557632e-01   -1.372747587128432e-01; +5.411421647172361e-01   -2.848145263455389e-01   +6.888214163958539e-01   +3.421007069125970e-01   -3.206781926857822e-01   +5.725479872173592e-02   +4.995522157280297e-01   -9.538341872019754e-03   +5.863035319205734e-03   -1.243274788837390e-01   -1.616376790266088e-01   +2.970780658960775e-01   +5.937463372928269e-01   +1.158097411233779e-01   +1.259968357712079e-01   -2.780593967057167e-01; -5.771497747248039e-01   +5.184969724935494e-01   -1.100687570706514e-01   +5.326539018249848e-01   +6.166640289692719e-01   +6.625015740616034e-01   +4.329042384861732e-02   +9.029784081147283e-01   +4.819895768111469e-02   +4.299476578511446e-01   +5.338547165194694e-01   +3.857713696258565e-01   +1.644425627713818e-01   +3.533160262308788e-01   +5.649837532887720e-01   +1.400659604890040e-01];
L1E_L1I_iGABA_netcon = [+7.728934182502720e-02   +4.111731900695114e-01   -3.936474810840231e-01   +3.068330711388136e-02   +6.594366783798391e-01   -1.869581616398250e-01   +3.775993946928236e-01   +3.643817897822236e-01   -6.753009158006611e-02   -9.711996176047132e-02   +2.449267620539252e-01   +2.683382425949354e-01   +9.096198314987211e-01   -4.160491926073343e-01   +1.867085605241513e-01   +8.629051746476500e-01; -4.772181974273608e-01   -1.420619596799007e-01   +5.715486572070645e-01   -2.466670346667436e-01   +3.900284762572413e-01   -3.423994046451918e-01   +3.888188399996126e-01   +3.981489993701599e-01   +4.044941790390555e-01   +5.351281077537313e-02   +3.985780473683246e-01   +2.144491634467182e-02   +5.055761176285389e-01   +2.279272799639804e-01   +2.812686924146052e-01   -1.260844895169070e-01; -1.088194532661976e-02   +2.711609758633990e-01   -2.247774156474156e-01   +4.715185834681614e-01   -2.198501719138930e-01   -2.060012959890575e-01   +6.140188259691481e-05   +8.744447697129473e-02   -3.136131446131666e-02   +3.388188646637893e-01   +5.330537420749524e-02   +2.018445514794551e-01   +7.104227419390360e-02   -9.016676180085778e-02   +5.787715778946103e-01   +2.485414893965441e-01; +5.440110998817382e-01   -2.653073625254847e-01   -3.943963648833715e-02   +2.370217055696053e-01   +1.045276426607143e-01   +4.739125486878759e-01   -1.486124888405015e-02   -1.175837552781817e-01   +1.253161944241574e-02   +3.210550438362771e-01   +2.259165832598599e-01   +4.086150021789480e-01   -2.269978794304531e-01   +3.434394646308951e-01   +8.336409623702670e-02   -2.066092813942596e-01; -6.884728897786484e-02   -1.282223397545635e-02   +5.588002025883596e-02   +4.142626606223232e-01   +4.658798470951136e-01   -2.088987283280788e-01   +3.204342868514455e-01   -3.872659508890611e-01   +8.548317812272488e-02   +1.897753649090152e-01   -2.973356588481408e-01   +6.319934154117611e-01   +3.722536903522501e-01   +3.768021874863859e-01   +1.155576335346228e-03   +1.514057657890611e-01; +1.824575257539540e-01   +1.980387934278274e-01   +1.733847884926769e-01   -2.322473449644528e-01   -2.350986936598070e-01   +6.678196551477834e-01   +4.601697455172039e-02   -3.762261014779412e-01   -2.463379054113006e-01   +1.232074862686156e-01   -4.440667516952978e-01   +5.160896627684892e-01   -1.960932916093364e-01   -4.495333409618570e-01   +4.258953191777624e-01   +1.249692740512026e-01; -8.671084342817793e-02   +5.300718299983520e-02   -1.898778572366578e-01   -2.403628431790169e-01   +5.044998539372302e-01   +3.132461115438394e-02   +3.491253664237435e-01   -2.097271157496206e-01   +6.612466218404475e-02   +2.963905318945826e-01   +5.551904477340563e-01   +1.986929095604263e-01   +5.460529193773496e-02   +5.532991054687032e-02   +9.294767137427502e-01   -3.553427169712741e-01; +2.661975687278463e-01   +2.212845894765291e-01   -9.536887855880578e-02   +1.157875890329016e-01   +8.853310916031695e-02   -1.254002117134521e-01   +5.864615665380601e-01   +1.106321873545305e-01   +5.170238051729320e-01   +1.776489501375397e-01   +1.255793255236969e-01   -1.586537960931144e-01   +4.532093614157653e-01   +3.041314856846480e-01   +2.918295637237003e-01   +6.120995439926756e-01; +5.595872208459276e-01   +5.346978417851832e-01   +1.213088569586848e-02   -2.265257383186805e-01   -3.861837170394387e-01   +3.561350083259722e-01   -8.973329814800507e-03   -1.280343583140019e-01   +7.889319816377899e-02   -5.491328377245052e-02   +1.611677381225430e-01   -1.826289215647159e-01   -1.834863322414587e-01   -9.642378978255367e-02   +4.805743682027931e-01   -2.068104709583233e-01; +3.059628777167183e-01   +4.604099034347331e-01   -1.182655381362279e-02   -2.029362126036653e-01   -3.038316286059731e-01   +1.018670991257771e-01   +1.149627604029040e-01   -4.621051687756290e-03   +3.274806995272638e-01   +1.847190143221704e-01   -5.499837300903638e-01   -7.735140532478782e-02   +3.943407334946806e-01   +5.209985955856855e-01   +2.833523821594328e-01   +4.934616664564379e-01; +2.757684738928310e-01   -1.122559657842166e-02   +1.017155267419245e-01   +5.176446372990100e-01   +2.067499505048314e-01   +4.257426969036843e-02   +1.870489663385751e-01   -1.127499395245115e-01   +5.188828763452439e-01   +3.536068942370340e-01   +1.196251581146672e-01   +6.467971524812358e-01   +6.506564860113300e-01   +3.772094879531628e-01   +2.795492147905229e-01   -3.118192014784322e-01; +1.742548616998626e-01   +3.782012250551084e-01   +1.198606288175066e-01   -5.896384674939842e-01   -2.238080181278650e-01   +1.891456754251009e-01   -4.691915861089524e-02   +3.195325596161849e-01   -1.492714911611025e-01   -1.848537107864684e-01   +3.015953650417271e-01   +2.099699494080997e-01   -9.010103520300045e-02   -1.218770628967706e-01   +2.888557697016300e-01   +3.053287547146467e-01; +4.037434220821405e-01   +4.912285020500433e-01   +1.551249448141440e-01   +3.915798449955664e-01   -1.971092166774734e-01   +3.213289646433189e-01   -1.545390922330117e-01   +2.534577931119938e-01   +5.182975941519280e-01   -1.431137338396573e-01   +5.008682867517832e-02   +4.158364216343436e-01   +2.399487350072064e-01   -5.065504646448923e-02   +4.748986556073186e-01   +4.049908708708297e-01; +4.918522939797279e-01   -2.811827165577550e-02   -6.579651182971551e-02   +1.720648981373732e-02   -2.031650963465237e-02   -1.118232949976869e-01   +1.541822039031684e-01   +3.433273868982091e-01   +4.543147835475059e-01   -2.475602376748393e-01   +3.093832336172772e-01   -1.608673594325585e-02   -3.189819986201060e-02   -7.727653783517002e-02   -3.029633436380304e-02   -2.160593369761771e-01; +5.347057755530739e-01   +1.937603787354139e-01   -1.880209172207251e-02   +4.603812667280720e-02   +5.897550876713829e-02   +1.426991569362231e-01   +2.844023957314681e-01   +3.945723880929842e-02   +4.179597649636753e-01   -4.870357953638979e-03   +2.703562281508476e-01   +5.825097347189406e-02   +1.471227340719389e-02   -4.181739940006023e-01   +7.373746832770207e-01   +3.916748241907365e-01; -1.164992737090586e-01   +1.007852136627359e-01   +7.464228554727212e-02   -3.063104367755388e-02   -8.126815064820078e-02   +2.486707265801314e-01   -5.505349166891598e-02   +4.637640061364902e-02   +5.619219597112384e-02   +2.128302720387086e-01   +3.740162095582229e-02   +7.930003360817657e-02   +1.233362645881513e-01   +2.396644750173377e-01   -4.463385789942282e-03   +6.449552486129820e-01];
L2I_L1I_iGABA_netcon = [-2.323577322614466e-01   -2.804271938658953e-01   +9.079894753539003e-02   +3.545819065625968e-01   -4.476913453575267e-02   +2.150781786767147e-01   +4.668326628987927e-01   -3.614837834446106e-01; +2.952833396609690e-01   +6.472781321973665e-01   -7.387377549685560e-02   +8.070069507087885e-02   +5.475639897886786e-01   +4.185710557557748e-01   +3.466907429287335e-01   +2.634451088969934e-02; +7.716395778767170e-01   +2.999696024758121e-01   +1.620380874755485e-01   +3.240037628793231e-01   +4.594253617344306e-01   -3.884216310453779e-02   +1.133392976387358e-01   -4.324010930887124e-02; +6.119022555516288e-01   +1.594216751627943e-01   +7.752089564900759e-01   +1.776113882590811e-01   +4.747041921550879e-01   +3.882521131030132e-01   +4.901294521251151e-01   +2.595961051931630e-02; -4.599065335462124e-04   +7.916249699634080e-03   +3.828567095926554e-01   +2.815483847562466e-01   +2.718928635230318e-01   +1.437441326185173e-01   +9.342062596937341e-02   -1.777751672904306e-01; +4.551836674512070e-02   -2.009841021414848e-01   +1.505951627317796e-01   +2.353153355349771e-01   -1.671391428223712e-01   +2.063235361313614e-01   +3.371481770854214e-01   +5.376488390805106e-01; +6.084066739793929e-01   -1.106178051155735e-01   +3.246172444856456e-01   -5.741304397250658e-02   +3.210341144326929e-01   +7.087096426563743e-01   +4.407425244728101e-01   +1.922840989319130e-01; -8.139964733280295e-03   +4.039609122552167e-01   +1.126291749635409e-01   +9.151357217509345e-02   +2.736645306837803e-01   -5.980278895449756e-02   +9.022991136741973e-02   +1.440545472295533e-02; +2.106308089720735e-01   +1.000000000000000e+00   -6.433638984902759e-01   +3.402001185328142e-01   -1.373928460550366e-01   +2.280013876845279e-01   +3.476721631798389e-01   +3.218207169106380e-02; +7.007847488442451e-02   -7.402238464248403e-02   +1.658930928900461e-01   +2.523084424839033e-01   +6.751195179374716e-01   -1.700523242644615e-01   -9.483399742065765e-02   +3.902932362983724e-01; +1.872132462335421e-01   +1.558398269358862e-01   +3.272947918985696e-01   +2.374906138769132e-01   +7.376106801840833e-02   -4.957669205974583e-02   +5.135268575779572e-02   +1.760612186247666e-01; +3.759105497701465e-01   +2.469079577019104e-01   +3.817151835895861e-01   +2.246109364682977e-01   -2.558458180235490e-02   +2.074668438209279e-01   +3.896605335663738e-01   +5.113039805472983e-01; +4.870086166369060e-01   +3.481932614041546e-01   +3.513362427508282e-01   -2.734135636807179e-02   +3.570718556914567e-01   +1.291301485882442e-01   +4.015057709500196e-02   +2.569280698574455e-01; +1.927298493726079e-01   -1.287544075886379e-01   +2.129359734701917e-01   -3.960309632915536e-01   +2.900471522759077e-01   -4.919007598066346e-02   +4.302851071449112e-01   +3.348694700857866e-02; +3.491874245402385e-01   +6.991720092864828e-03   +3.179716737693254e-01   -3.256536644759039e-02   -5.581047670455599e-02   +8.348492849135464e-01   +2.753520862456075e-01   +5.699772621650129e-01; +1.329593819800350e-01   -3.061114347797340e-02   +8.882712647705918e-02   +3.894178575458507e-01   +1.909492147845878e-01   +2.187282299313463e-01   +2.298235478202262e-01   -1.763247036977821e-01];
L1I_L2I_iGABA_netcon = [+3.795027254686855e-01   -1.479004457164509e-01   -5.118006471574287e-02   +3.806762402391137e-01   +1.040546386547212e-01   -1.012508939984681e-01   +4.040002928451537e-02   +3.249914374183612e-01   -1.186288948182134e-01   +4.006279347240517e-01   -1.108140184508013e-01   +2.770391303681433e-01   +1.740706874084698e-01   +8.828755719603552e-02   -1.152244688911959e-01   +1.789486191286029e-01; +3.059809646217039e-01   -1.038789609833368e-01   +6.084995449375290e-02   -3.760486802712990e-01   -3.784539970443625e-02   +1.880087083819132e-01   +4.062883208381275e-01   +2.514991201973218e-01   +3.082952072119600e-01   +6.585696933730513e-01   +2.150950905348085e-01   -7.173057077106275e-02   -1.057912686906362e-01   -4.388910614664761e-01   +4.105029940576193e-01   +4.036333338584974e-01; +2.868333695952589e-02   -2.166344301962897e-01   +3.025678441902498e-01   +8.028232504174339e-03   +1.033064938213599e-01   -1.668164585463184e-01   +7.031048476750676e-01   +3.979392802620840e-01   -2.300699376628856e-01   -1.649713436214524e-01   -1.696766113159441e-01   +1.949127124956610e-01   +3.633427341003267e-01   +4.815943004021400e-01   +7.936212319414573e-01   +1.620121097781099e-01; +3.260985204703499e-01   +4.952890717856858e-01   +4.007543207996920e-01   +4.288146613527684e-01   +4.162779304705810e-01   +5.779648556319917e-01   +5.325920980522023e-01   +3.555022251426009e-01   -1.638959746556719e-01   +7.133022322235997e-01   +5.273892691941401e-01   +2.440483206107273e-01   +2.560691843445312e-01   +2.025448284378370e-02   +3.894708313309962e-01   +4.447775886914215e-02; -3.277156242879058e-01   +5.272870327891539e-02   -1.085099202957115e-01   +3.563461684158298e-01   -6.542671208489452e-02   +7.624094974423439e-01   +7.069729942564084e-01   +4.117216249832663e-01   +4.855573674830401e-01   +4.088045971002285e-01   -2.968564883135998e-01   +1.666988354911637e-01   -4.566964548762365e-01   +9.272452259718288e-02   +3.043769440120396e-01   +4.486003522748088e-01; +1.863254727605845e-01   +3.588308174669759e-01   -2.283417966992765e-01   +4.871385924202888e-01   +2.179474361182097e-02   +1.296645678048473e-01   +2.932683284201756e-01   +1.819684297655933e-04   +4.608379088284700e-02   -5.765024568164158e-02   +3.363231943948351e-02   -2.581523938965428e-01   +4.919694067927762e-01   +1.000000000000000e+00   +2.399420363485609e-01   +2.334396911913812e-01; +3.904596459751961e-01   +4.026655217613823e-01   -4.534399864996977e-01   +2.432183538605784e-01   +3.908724265429094e-01   -3.328470638464254e-01   +3.174141688472598e-01   -1.646817766928643e-01   -6.610984300875471e-02   +7.317292483126317e-02   +3.934193631641767e-01   +3.811195991193835e-01   +1.215507711727452e-01   -7.306851962063976e-02   +2.021316449340854e-01   +2.846703394710206e-01; +4.204190557343973e-01   -7.545878615670369e-02   -9.350216038220963e-02   +7.960826200903770e-02   +7.719824481187620e-02   +4.257701739936725e-01   +2.025884896213659e-01   -4.019556912095133e-03   -1.341944090193114e-02   +1.805171537380554e-01   +2.681296421344820e-01   +5.261354207753461e-01   +9.067638325714866e-02   -1.958747251570929e-01   +3.144143284870889e-01   +3.240840006409123e-01];
L2E_L1E_iAMPA_netcon = [+4.077661746967806e-01   -1.101241577473708e-01   +1.981262032395451e-01   +4.390988110758065e-01   +9.865334624892272e-01   +6.237661767877458e-01   +3.877573601938644e-01   +2.248519541950603e-01; -1.000899675978863e-01   +3.090938047550531e-01   -8.365644193351325e-02   -8.305814188877443e-02   +5.877266122620159e-01   +2.524828181206147e-01   +4.822619878940003e-01   +1.340800533875049e-01; +1.744567813158871e-01   +5.009797884996231e-01   +3.021390066294711e-01   +1.020651806046568e-01   -5.545250377489849e-02   -3.118667828651795e-01   +9.936713764647773e-02   +4.234106075153621e-01; +5.777668536022165e-01   +1.500072601357108e-03   -1.741793242646548e-01   +3.665061881796828e-01   +1.093646667512579e-01   +1.817259958707436e-01   -2.237106503806304e-01   -2.532400917699838e-02; +9.785157490976433e-02   +1.311723109670385e-01   +6.369262196816092e-01   -1.352485081631248e-01   -1.621900289305258e-01   -1.006537163936554e-01   +6.083198784586397e-02   +3.158481629750517e-01; +4.264455203889798e-01   -3.402943745229309e-01   -4.237699989972386e-03   +4.250913282083081e-02   +2.392649943906041e-01   +5.462452947647291e-01   +3.206151748367925e-01   +4.458304750206296e-01; +3.871972591194864e-02   +4.664853236926678e-01   +1.319912154836136e-01   -3.924558897790424e-02   -2.267831945747928e-01   +5.036876519596329e-01   +6.372616221060298e-01   -2.493468992923343e-01; +3.706056108267390e-01   +6.111811350258181e-01   +9.323546327058919e-01   +2.727890587143020e-01   +1.101239366280181e-02   +4.569415193385574e-01   +3.979888228125295e-01   +2.401870386852248e-01; +4.152810061859732e-01   +1.493822537867151e-02   +2.450255077128179e-01   +7.167954741750200e-01   -1.861029163075248e-01   +5.534877347878282e-01   +6.197840859715362e-01   -8.854099873070671e-02; -7.702933788834374e-02   +1.220867286043871e-01   +1.588661809764996e-01   +1.759376854166033e-01   +9.170874485540711e-02   -1.652895448948617e-01   -2.536298669866109e-01   +3.474434224343905e-01; -1.147955348300875e-01   +6.084691911522272e-01   +7.659937898136199e-01   -1.911317073390407e-01   +7.767365321588506e-02   -8.933396682354361e-02   +1.704159841840267e-01   +2.385026078974590e-01; +1.422870288026003e-01   +1.513541496630379e-01   +5.864084311425738e-01   +2.319563421876621e-01   -1.609909080486722e-01   +3.035991907239841e-01   -1.694534766659647e-01   +3.958744177850236e-02; -9.498557595240711e-02   +3.561332986093093e-01   +9.436398564482794e-02   -3.252515899814084e-01   +7.122016470346694e-01   -2.434484716925780e-01   +4.003124791555027e-01   -1.318121577613364e-01; +5.571720032912067e-02   +7.758513949947020e-01   -4.195174047080065e-01   +1.603885888953608e-02   +3.046039895420412e-01   +3.062674950218410e-01   -3.535944608987638e-01   +8.561283910957820e-02; -1.010452141948311e-02   +1.057654597116872e-01   -1.476818806166539e-01   +3.151830243694527e-01   +8.619317689012415e-02   -9.220419232617855e-02   -1.771077884206113e-01   +1.120851732818753e-01; +6.653871463716667e-02   -1.959953526173230e-01   -3.931224520403495e-01   +3.530368789585630e-02   +2.492747968841450e-01   +4.569143035504915e-01   +5.179210913213113e-01   +2.937881238597905e-01];
L1E_L2E_iAMPA_netcon = [+2.958078921041613e-01   +3.381410068979241e-01   +7.374001049266228e-02   -7.324313774040024e-02   +4.831950369181588e-01   +1.145025210350386e-01   +7.533621413946934e-02   +8.072118682027963e-03   -3.626510803335692e-02   -1.316698200653162e-01   +3.402431209588631e-01   +5.752558862583561e-02   +2.474017275804404e-01   -5.748695304618906e-02   -3.054418355890563e-01   +4.240118205553622e-02; +2.928542032018795e-01   -2.438780685794674e-01   +6.368785481404982e-01   +7.920238924166835e-02   +1.941503729233774e-01   +2.211567981984063e-01   +6.141490062419671e-01   +3.678877824741662e-02   -2.020178931201411e-01   +1.244775921272761e-02   +2.167740220144313e-01   +5.707883287242818e-01   +6.185237017157531e-01   +1.922969754568751e-01   +4.483714462690495e-02   -2.942796234577307e-01; +6.826287844011969e-01   +1.158946884780894e-01   +2.585978915795398e-01   +1.673069766857176e-01   +1.099397275204143e-01   +5.144974733131404e-01   +1.753406402942358e-01   +2.747533238433171e-01   +3.351830279404913e-02   -2.891166291509811e-01   +2.139559818757561e-01   +6.615152419861515e-01   -8.720437206721925e-02   +5.094331998927288e-01   -1.078373667961377e-01   -9.974913992094389e-02; +9.726942289785689e-02   -4.781316599292920e-02   +7.422617561088377e-02   +1.815318383626515e-02   +7.219998567987121e-02   +6.616292647348503e-01   +9.964497672693062e-01   -1.645290173486137e-01   -6.579041939781938e-02   +3.858764555656481e-01   +3.097975254223180e-01   -3.140283383025559e-01   -1.975698960538017e-01   +7.027945612458405e-01   +2.458462150428442e-01   -2.447701853819477e-01; -2.372752387618995e-01   -4.414001092092210e-01   +2.972545391955088e-01   +1.617175441557883e-01   +2.605122499469873e-01   +1.694128444292579e-01   +2.665863513458022e-01   +3.345690906554760e-01   +3.081965240833486e-01   +1.413977635557350e-02   +7.940266131629961e-02   -3.571009897666519e-01   +3.722115919344350e-01   +1.378813994357371e-01   +3.883090456104303e-01   -1.014498248037432e-01; +1.913360530368590e-01   +5.281563362813425e-01   +2.665910964348319e-01   +5.359859771531353e-01   +1.323370326015262e-01   +2.438968676439043e-03   +7.972230503234479e-01   -6.924427334622779e-02   +3.048911729251185e-01   -7.014012426716724e-02   +4.590512824674954e-01   -5.670638704018258e-02   -2.380015901502749e-01   -1.939403750514122e-01   -8.540353922557856e-02   +3.629224357905404e-01; +2.678276076178644e-01   +4.133839492617616e-01   +4.954039744700302e-03   +4.076166164973616e-01   +4.271580305497826e-01   +2.911002024197504e-01   +2.619462567135136e-01   -2.513295294699059e-01   -3.576401208618002e-01   +2.860368625597753e-01   -8.863336774515392e-02   -6.970215366441791e-02   -2.361108441355148e-01   +5.216431720387442e-01   +7.214536298681131e-01   +2.479074635988961e-01; +3.601138088859760e-01   +3.848670493802900e-01   +4.673804481700882e-01   +5.319727972049767e-01   +3.381032054711812e-01   +5.425512653133350e-01   +4.674721103897653e-01   +1.438633409882709e-01   +3.665662778442570e-01   -6.263271551556890e-02   -1.146953108423022e-01   -1.470445435202814e-01   -6.524184568112571e-01   +1.434728486707406e-01   +3.570816827182534e-01   +2.739838613774939e-01];
L2I_L2E_iAMPA_netcon = [+6.753793873827746e-02   +6.557466210725793e-01   +4.418737319008711e-01   +1.145020156989864e-01   +4.265593580454645e-02   +4.822074317321026e-01   +1.161899023902551e-01   +5.401787593590205e-01; +5.783663052660505e-01   +2.794897309058873e-03   +7.205667033180739e-01   +6.236937584285652e-01   +3.099798780255060e-01   +1.764698843147320e-01   +1.303400644625045e-01   +1.074734996416107e-01; -9.701558906168670e-02   +2.679529810183068e-01   -1.029087723260161e-01   +8.832094424538324e-02   -3.002320053147632e-02   +4.901681446921288e-03   +3.270119507740983e-01   +1.322974015490956e-01; +2.719267896488672e-01   -3.681409791019725e-02   -2.582120678944240e-01   +3.354300760557605e-01   +5.795556084510854e-01   -1.528927088236119e-01   +3.784838318879084e-01   +2.686064994871087e-01; +3.880820311356180e-01   -7.624543422243618e-02   +1.258985978520187e-01   +4.443597277094038e-01   +6.607577059917049e-01   -1.603025265843771e-02   +5.477735652202951e-01   +1.091140554319225e-01; +3.926513221115614e-01   +2.530159536298646e-01   -4.920994554440623e-02   +6.760953079300973e-01   -1.252264853035494e-01   +2.386974408732284e-01   +3.667444482818328e-01   +1.264506826222258e-01; +3.638458544788530e-01   -4.167500021299748e-01   +4.383936289663961e-01   +5.751231445031140e-01   +1.036563673937115e-01   -2.884262568172248e-01   +7.582169371427281e-01   -1.255978741246425e-01; +2.262491496409798e-01   -5.891961347995453e-03   -4.392144908678990e-01   +1.389231463404886e-01   +4.112191460522985e-02   -1.730055593150387e-01   +2.570918362236165e-02   +6.424757102628924e-01];
L2E_L2I_iGABA_netcon = [+1.277341218209855e-01   +4.953068189272180e-01   +3.897090530816922e-01   -4.465119531191762e-01   -3.423945790257218e-01   -1.348581813182880e-01   -2.892446328936168e-01   +5.709163874128887e-01; +1.828172141260462e-01   +3.203685504553708e-01   -1.470544557492469e-02   +7.665279834240367e-01   +6.175236683569055e-01   +1.177788943430556e-01   -4.517258885797307e-01   +1.607898635616699e-01; +1.967663747059591e-01   +7.918981381679067e-01   -3.073995382215264e-01   -4.896481397429133e-01   +1.598334195793205e-01   +6.948005341344735e-01   +3.079887580313914e-01   +1.526382220006266e-01; +9.171163219969714e-02   +5.146453561209315e-01   -3.953663438414744e-02   +6.513008086368812e-01   +9.185657607182011e-01   -4.228964325418893e-01   -3.516127382260479e-01   -1.561049462951538e-01; -2.830086802583874e-01   -4.306546468599186e-01   -1.476443696319175e-01   +2.768076615840917e-01   +8.850793052672949e-01   +4.349347452749486e-01   +7.213374200132718e-02   +2.420123473628485e-01; +8.103524999432010e-01   +5.292201116725050e-01   +3.961816298906108e-01   +5.783660600466852e-01   +4.928295161962509e-01   -3.788929770586121e-01   +4.868422847013793e-01   -2.641479975993741e-01; +1.840478458438868e-01   +1.626848186044587e-01   -3.109100826063627e-01   -1.004028949479099e-01   +1.754799822365126e-01   -5.118005881237243e-01   -1.376404901866260e-02   +7.920741373371859e-01; -4.505558683177180e-02   +5.203081513530721e-01   +5.769095096837632e-01   +7.423720729054706e-02   +1.007953319202994e-01   +4.327094943980523e-01   +4.281601002254657e-01   +7.590091394826969e-01];
L3E_L2E_iAMPA_netcon = [+4.788841007420696e-01   -2.729666668275519e-01   -5.819700365114813e-02   +3.614324154374364e-01   +3.975077698157528e-01   +4.377486625388897e-01   -9.878125331365352e-02   +7.154183001448402e-01   +3.639995770554952e-01   +1.370570721013682e-01   +1.346246379604565e-01   -6.083100523387838e-01; +1.477655891998921e-01   +4.082321930596575e-01   +2.378708639569188e-01   -7.688702719228913e-02   -1.638852648932968e-02   -1.744227001936570e-01   -2.234056482309363e-01   +1.592020247886927e-01   +1.480183550441143e-01   +3.062131526797165e-01   -1.425940269505105e-01   +4.461290284216498e-01; -4.874889283125625e-01   -3.509309545082268e-01   +4.047091170102248e-01   +3.157411793238957e-01   +4.032608370269492e-01   -2.019591737199640e-02   +1.038879252571496e-01   +2.351792186509170e-01   +7.018595112253166e-01   -4.530020986109706e-01   +8.540824763041217e-01   +4.156070313666594e-01; +4.646752183448825e-01   +2.634140916451561e-01   +2.523993291241652e-01   -4.893993459670094e-02   +4.454570814857808e-01   +7.739574303500622e-02   +6.467564396604678e-02   +4.712572649705956e-01   +1.231428589821582e-01   -2.110756130134728e-01   -2.329237320890510e-01   +5.353919820930344e-01; +1.281240291450663e-01   +3.496770463740070e-01   +1.664959759528956e-01   +6.555078931804429e-01   +4.447137979564448e-01   +4.999625426196465e-01   +1.025309023292125e-01   +1.681094910995786e-01   -2.182932483532369e-01   +4.490921842266433e-01   +4.338494095803395e-01   +5.314957691451250e-01; +4.823944991802901e-01   -2.414530386759536e-01   +1.741335252623283e-01   +1.005291747983228e-02   +2.942802263319013e-01   +4.624302999078314e-01   -2.915319410217275e-01   -1.750633998079000e-01   +1.228747075014642e-01   +1.744382117425946e-01   -4.580305680562283e-02   -3.773557030034563e-01; +1.757509163038688e-01   +1.769930375045857e-01   +3.669139849978348e-01   -6.002195975166129e-02   +3.711896978983660e-01   +3.246029998958339e-01   +5.385592601436048e-02   +2.497507447573505e-01   -1.346974891686814e-02   +4.440917946698043e-01   -1.733737756400716e-01   +5.280934424377923e-01; -1.653055482549048e-01   +7.433353986132183e-01   +2.247086715115983e-01   -8.325483249414388e-01   +5.650019937252800e-01   -1.364577579978655e-01   -3.790479445626798e-01   -1.089218669246826e-01   +2.465986800635306e-01   +2.283745002829964e-01   +1.814973659340982e-03   +5.909489705439537e-02];
L3I_L2I_iGABA_netcon = [+8.971493676939849e-01   +6.675753306411772e-01   +6.239534463184257e-02   +3.900279425552902e-01   -5.852144842521440e-01   -1.009998006929127e-01   +9.785611049428413e-01   +6.465610776438713e-01   +6.521144645649786e-01   +9.893436852699770e-02   +2.112700534809902e-01   +1.825744495358491e-01; +2.136881483373779e-01   +7.261406030102294e-03   +1.655828454994566e-01   -3.940189269546680e-01   +4.999681435360976e-01   +7.805804098013636e-02   +2.005233680142864e-01   +5.282847717042717e-02   -1.326474339102004e-01   -2.834060295522286e-01   +1.453987651036120e-01   -4.469893708590290e-02; -4.890628496714908e-02   +2.306224328842066e-01   +9.590526912763706e-02   -2.289585066714214e-01   +3.205291304877643e-02   +3.087502613606787e-01   +3.453253679401126e-01   +2.442723201828450e-01   +2.113782096869733e-01   -2.187011099347215e-02   +1.120901044614828e-01   +8.574200864155386e-01; +5.312235889165147e-01   +2.039797689486974e-01   +7.336570262114392e-01   +1.667286548502847e-02   +2.382679752764436e-01   -2.461815442890212e-01   +1.512985143299715e-01   -9.912972262688535e-02   +3.972569103680160e-01   +5.512043107918208e-01   +5.394770127315889e-01   -3.922552469216044e-03; +4.220635205165414e-01   +2.545514838813367e-01   +7.031860051650467e-02   +5.042271430085214e-02   +5.598441130313783e-01   +5.484803798329120e-01   -8.120494192041568e-02   +7.385660389927137e-01   +6.835159861259706e-01   +4.322024400764279e-02   +4.096490355893938e-01   +1.477833646956775e-01; +6.036309708068595e-02   +4.110087873842996e-01   +6.758695734885483e-01   -8.702501918107113e-02   +3.993715818872754e-01   +1.864941255228403e-01   +5.295128654220722e-03   -1.457489682252464e-01   +5.523631042680569e-01   +3.937222857666914e-01   -3.361590605996568e-01   +1.735336445921594e-01; +5.501088494377673e-01   -9.200301295087518e-02   +6.064062397359614e-01   +9.448066899651303e-02   +6.712416966549543e-01   +7.466946432654890e-01   +2.928503961003347e-01   +3.355069867327978e-01   -5.503675309179614e-01   +6.458508885647872e-01   +1.595191289763930e-01   -3.123437231500462e-01; +4.725671423769975e-02   +1.459084038487867e-01   +5.971134400343688e-01   +2.132579638639470e-01   +3.331061441946588e-02   +3.350557588161623e-01   +6.591637408177120e-01   +6.314861140406804e-01   +4.276726954625974e-01   +3.587215026741897e-01   +2.037283591809161e-01   +3.189203698534230e-01];
L2E_L3E_iAMPA_netcon = [+4.878214684450010e-01   +2.810300709984396e-01   +6.925174334846576e-01   -5.055302125041535e-01   +1.377830406628212e-01   +5.630466552289142e-01   +7.577219201054606e-01   +7.069126709340311e-01; -9.314909531468997e-03   +1.129208799519550e-02   +1.079374115148141e-01   +4.494204610814840e-01   +5.793349493388493e-01   -2.730003039988651e-01   -3.293291659501606e-01   -5.600323966940248e-01; -1.277594621221715e-01   -1.314061315179512e-01   +1.303157733457745e-01   +2.987980599986123e-01   +4.371230749400611e-01   +1.435947761888779e-01   +1.909157952223678e-01   -2.927903642383452e-02; +2.430178306913782e-01   +1.939121803538028e-01   +7.377634719148433e-01   +8.233583927160408e-01   +2.095152701565110e-01   +6.503161328105374e-01   -2.687700537218579e-01   -4.828655200092903e-01; +1.249467715949331e-01   +2.248515262269333e-01   +1.638459426517185e-01   +5.301416157133239e-01   +1.501172429012195e-01   +2.395594660032271e-01   +1.445063664674352e-02   -3.501003418476791e-01; +8.009073064180305e-02   +4.351152935905018e-01   +4.903330660097018e-01   +5.725068430397657e-01   +2.492772984440191e-01   +1.203453436460158e-02   +3.706135487557166e-02   +2.119134568505621e-01; +2.371510212853299e-01   +7.697517575088713e-01   +5.189848084053346e-01   -2.700397089087674e-01   +1.859573804369808e-01   +1.388265888832684e-01   +1.064830650266212e-01   +6.586409321934847e-02; +3.568907057465824e-01   +3.297355151993540e-01   +7.845081236929731e-02   +3.110828809887712e-01   -1.875247043361769e-01   +1.013096427278495e-01   +1.666528069727781e-01   +5.968091208945966e-01; +5.177525499628464e-02   +4.998929225985757e-01   +5.494276155569986e-01   +5.036435173628955e-01   +1.341581618597019e-01   -8.931470579759945e-03   +6.801757713717514e-01   -2.007051639709310e-01; -1.681105367660310e-01   +1.197675148075936e-01   +2.979830573660514e-01   +4.118468577438592e-02   +1.480087479664957e-01   -3.250065374886644e-01   +4.119181568891587e-01   -8.662196391108440e-02; +3.847862755854217e-01   +3.372330674801599e-01   -2.691539220103986e-01   +9.014529850592089e-01   +2.480107904601047e-01   +6.707186230067333e-01   -2.606937890413424e-01   +2.961090722756192e-01; -1.504045603031243e-01   +5.712656818987502e-01   +3.379255088132078e-01   +3.539567583995420e-01   +8.368139178171845e-02   +6.149966554788400e-02   +1.305618225392526e-01   +8.560530892841690e-02];
L2I_L3I_iGABA_netcon = [-3.374087274968706e-02   +1.589481298775829e-01   +1.495859271427814e-01   +1.068050660678786e-01   +2.578506129752497e-01   +8.616596004418914e-01   +3.481703009342225e-01   +4.199420621632054e-02; -3.736212490746131e-01   +1.801562502900582e-01   -5.844228269461099e-02   +1.071067398720510e-02   -1.774823570474946e-02   -4.136778451636397e-01   +4.958673409423167e-01   +2.014266621403132e-01; +4.741304380382401e-01   +9.930694619740099e-01   +8.709425640620262e-02   +4.665122742570143e-01   +6.163353563955792e-02   +6.021676567704601e-01   -6.898325619466555e-02   +1.548778424816786e-01; -1.290071487357231e-01   +8.826127495178505e-02   +9.534700831393504e-01   -2.182808834220430e-01   +1.053859778706425e-01   +6.427415773949035e-01   +5.151300622960253e-01   +1.017618074612155e-01; +2.982146168059402e-01   +2.882009054997463e-01   +4.325164208260482e-01   +2.732209315915595e-01   +1.073550778831472e-01   +3.044045613191066e-01   +3.451302539059708e-01   +8.773713943841813e-02; +3.579936357610747e-02   +3.624654656623377e-01   +4.778496476809526e-01   +4.068525109042664e-02   +4.690734334661728e-01   +7.843709980704872e-01   -2.047830346364502e-01   +1.750482692406798e-02; +1.107937450694169e-01   +5.416689879919763e-01   +3.401842559544708e-01   +3.350859077684418e-01   +1.471085112934103e-02   +2.880461934785748e-01   +1.000000000000000e+00   +6.486244657149836e-01; -4.476764954237700e-01   +3.663328167530123e-01   +4.462341556167534e-01   +2.371037797039994e-02   +7.117510494040219e-02   +4.168496132989847e-01   +1.837137191456294e-01   +6.228307139042383e-01; -3.610871268973862e-01   +5.865015938071826e-01   +7.527512544119751e-01   -5.565081442594956e-02   +3.052822917034786e-01   +4.340716306268377e-02   +3.553867129464560e-01   +2.592250892115696e-01; -9.075111290418192e-02   -1.065893465059350e-01   +5.085532015994959e-02   -1.131026320876786e-01   +1.460405834658792e-01   +6.590765780074218e-01   +1.752275847777655e-01   +9.263751260525745e-02; +4.151275536671795e-01   +2.364372450563892e-01   -3.112181053964213e-01   +2.388830633014412e-01   -4.241317698829347e-02   -3.579141375966772e-01   +3.621733763668613e-01   +4.426566699141073e-01; -3.813974777123504e-01   +6.037053437414445e-01   -1.089656332877136e-01   +6.230493668907995e-01   +2.956023804942857e-01   +2.348967636100447e-01   +8.523816212706975e-03   -3.555365346454722e-01];
L3I_L3E_iAMPA_netcon = [+1.329663864703175e-01   -2.849542244014994e-01   +4.503133466658983e-01   +3.142933411019061e-01   -1.006752970160202e-01   -1.722039458860410e-02   +4.005061249257922e-02   +4.209995643323485e-01   +3.310791047042118e-01   +5.920658317824640e-01   +1.381053612408834e-01   +5.537265372413254e-01; +2.196125464804521e-01   -1.639381367528357e-02   +3.570521027612483e-01   +8.006963424566708e-01   +3.285403689663504e-01   -1.610293083531540e-01   +3.171495525414088e-01   +5.928471281437524e-01   +5.274570957307155e-01   +5.319259657236752e-01   -1.482054669076503e-01   -1.938315721792608e-01; +1.159575046621309e-01   +5.937178869455261e-01   +2.084640828246073e-01   -1.440149600509310e-01   +9.988340355028262e-01   +3.380577419201855e-01   +4.876303258278011e-01   -1.689710050270545e-01   +1.891990044483886e-01   +2.963866484818826e-01   -7.082645395682098e-02   +2.645024236570966e-01; +2.028797573963975e-01   +2.069854412144847e-01   +3.492173772003593e-01   -1.339506202789169e-01   -1.193524468910513e-01   +2.231591751048462e-01   +1.235261021155229e-01   +2.759865794768128e-01   +2.476118942981957e-02   +1.467030954970394e-01   -1.132028288381306e-01   +3.648550671492927e-02; +4.595290790270450e-02   +2.156153830770499e-01   +1.000000000000000e+00   +4.936022588028222e-01   -6.905813054402874e-03   -2.185413491046456e-02   -1.103651338788642e-01   +4.056282609695329e-01   +2.396032147777397e-01   +2.664793166277064e-01   +2.211131258371757e-01   -1.179912498366685e-02; +2.581709272114108e-01   +2.241527096422853e-02   +9.379062291377727e-02   +2.781967661659473e-01   -3.633338178769840e-02   -3.010794506265151e-01   +3.607069395659563e-01   +5.653190151961700e-04   +4.136091504152531e-01   +2.869152867919137e-01   +1.192407524829861e-01   +8.669757697550494e-01; +1.221080368785916e-01   -4.037847519638642e-02   -3.108982889998921e-01   -1.446607287563028e-01   +2.492942440702084e-01   -9.207737283532873e-03   +4.190578648726797e-01   +6.243846883437944e-02   +2.494496078449187e-01   -5.033916826809386e-02   +3.116042754799896e-01   +2.104369611405412e-02; -4.577367157064249e-02   +1.804398670336974e-01   -1.576082423603483e-01   +3.299032966256650e-02   +5.070724794660780e-01   +3.806279160757935e-01   -1.521524450172008e-01   +5.951528153690363e-02   -3.447370238859513e-01   -4.986294984822897e-01   -1.425268430650068e-01   +3.245872442460738e-01; -2.946921260337045e-01   +6.293980335490272e-01   +8.212466065118140e-02   +4.252157195221953e-01   +7.663398334993270e-02   +4.752143619826524e-01   +3.400194904046972e-01   +4.995113687595106e-01   +2.629075199506872e-02   +2.760298007318445e-02   +1.395739401953427e-01   +6.054060028213000e-01; +8.945736902389311e-01   -4.636141493205512e-01   +6.700304613624622e-01   +1.887363856423734e-01   -1.172750158668992e-01   -3.160730109621157e-01   +2.977627194756821e-01   +2.852761835674975e-01   -2.302273973416970e-01   -1.071498636255394e-01   +5.887397394113483e-01   -1.878247873772171e-01; -3.224601658831645e-01   +5.200138470813191e-01   +6.730149696280950e-01   +2.056876768451927e-01   +1.152292676715950e-01   -5.383749390542154e-02   +4.384410014135806e-01   +5.369398300075739e-03   +5.358795159932593e-01   +9.833150047016007e-02   -2.028141865839644e-01   +4.008740620254161e-01; +5.300629057248954e-02   +1.977000243411498e-01   +1.762743794435097e-01   +5.573271462011251e-01   -2.671941430030376e-01   -2.538665012687962e-01   -2.941951276869970e-01   +3.877488441177410e-01   +1.965363206220015e-01   -1.113371665249628e-01   +4.262062565838954e-01   -7.707965601264639e-03];
L3E_L3I_iGABA_netcon = [+8.002780531523498e-02   +2.673197831051306e-01   -5.489718845486860e-02   +1.948347551947020e-01   +1.105779332887344e-01   -7.292090180273637e-02   -1.621776519921201e-01   +1.133261648108472e-01   -1.348259239770481e-01   +7.165494605611125e-01   +2.101129413393489e-01   -5.034113721489629e-02; +1.022647099989611e-01   +2.722681696262748e-01   +3.260197599784678e-01   +1.691431755658490e-01   +5.738323799760174e-01   +1.165356744721521e-01   +3.813851936084248e-02   +7.778759186478401e-02   -6.994934476463849e-01   +1.791830004707841e-01   -5.480442956897179e-01   -2.180530621527238e-02; -1.039655498806268e-01   +1.536887324460848e-02   -2.430116125984970e-01   +1.530936470108601e-01   +1.628768999331305e-01   +2.340141606102109e-02   +4.230984916286575e-01   +1.760942792883744e-01   -2.016544031182035e-01   +1.332897891545547e-01   -4.698161173911098e-02   +1.394989450844765e-01; +1.485727619826241e-01   +1.279948553626128e-01   -4.205980708182286e-01   +5.864564962712813e-01   +8.549047753010652e-01   -4.156367222456666e-02   -1.145805701490009e-01   -9.646188965140259e-03   +6.659577606521159e-01   +5.470451168205658e-01   +1.443514165814551e-01   -2.286736458710823e-01; +2.491265580724596e-01   +1.944289559353797e-01   -1.089201135126864e-01   +1.887749269333523e-01   -5.528179422147354e-02   +3.959087912531283e-02   +1.531350127916972e-01   +5.056412165021393e-01   -3.138952049597537e-01   +4.032993666497016e-01   +4.102788540151399e-01   -6.082503458110556e-02; +7.663017792754269e-02   -3.200717424210734e-01   -1.309804261392983e-01   -9.250040703860657e-02   +4.067158058936791e-02   +1.668525934802770e-01   +1.997059566579898e-01   +4.400900925422028e-02   +3.783736839325850e-01   +2.421394493463703e-01   -1.561728022789174e-01   -1.453191439995563e-01; -6.992013305998504e-02   +1.194683898805008e-01   +1.838384040130215e-01   +6.427209974483049e-01   +4.508247648826057e-02   +2.741333183756164e-01   +3.034868195565994e-01   +4.594666011606185e-01   +5.501567954808589e-02   +4.323073216719965e-01   +3.604645618078794e-01   +4.367520128928585e-01; +9.402630655022538e-02   +2.552139187744085e-01   +4.373249493765724e-01   +2.099655094434746e-01   +7.513911338263191e-02   -4.331255870151656e-01   -3.192116263278128e-01   +5.321557179889902e-01   -9.577653612668972e-02   -1.780399459307487e-01   +2.564726858063939e-01   +4.393704170606868e-01; +4.610359178608400e-01   -8.606811916287808e-02   +4.659267453007542e-01   -1.235308595200974e-01   +3.657591169979864e-01   -9.660181780018429e-03   -5.861697154632238e-01   -9.655464124271200e-02   +3.682760832003209e-01   +4.162634095040856e-01   +8.980164201658131e-02   +5.312594521565195e-01; +8.952101902581622e-02   +4.575647515058950e-02   +2.754877045016407e-01   -3.724845770528468e-02   -6.290784694186008e-01   -1.281524946145134e-03   -1.329641483199683e-01   +2.632723790059685e-01   -1.408824349025008e-01   +1.292684724240125e-01   +1.211854920937800e-01   +1.652873887045520e-01; +1.647482938898465e-01   -1.266387109049961e-01   +3.252825564836019e-01   -1.566073832679763e-01   -1.002200216185468e-02   +1.031225519987099e-01   +2.252236203531621e-01   -1.405818351534349e-01   -1.655814700846825e-01   +4.276536254389280e-02   +8.837709353615296e-02   +1.386443581688920e-01; +2.694169721452802e-02   +2.197866907326571e-03   -3.977000674988498e-01   -6.248182545539396e-02   +9.876649041435698e-01   +2.777828902661223e-01   +4.324198001074697e-01   +2.474887532124199e-01   +3.667879214742631e-02   -2.713264541069527e-01   +2.209243033407622e-01   -4.592022234194931e-01];
L2E_Input1_iAMPA_netcon = [+9.725063105942855e-01   +9.929931877728143e-01   +4.767226584936631e-01   +6.729721662076358e-01   +7.181425928357228e-01   +2.823604798769918e-01   +7.761775136020596e-01   +7.331978539986544e-01];
L2I_Input2_iAMPA_netcon = [+5.658605937856004e-01   +5.475809176051565e-01   +7.391711136018895e-01   +3.611520931105536e-01   +1.832656718386377e-01   +1.000000000000000e+00   -1.383314008280539e-01   +2.855248403621962e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
