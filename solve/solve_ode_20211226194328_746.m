function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+9.102016465737243e-02   -4.846463768870114e-02   +3.756100860693063e-01   +5.329922447526628e-02   -2.824930848297264e-01   +9.824088649062257e-03   -2.092359022824671e-01   +1.724885258192617e-01   +1.131094220885980e-01   -3.981353492748836e-01   -7.114098404554947e-02   -2.818419670432952e-01   +3.456196981824895e-01   +1.375309549650626e-01   -2.705501688670016e-01   +1.850557309665697e-01; +2.796037796432868e-01   -1.220939825333421e-01   -7.544656936401346e-02   +3.451745523228241e-03   -2.193111212458938e-01   +7.236631714221482e-02   +4.119625829277276e-01   -2.598719465036991e-01   -1.174046497202111e-03   -2.209475949573418e-02   +3.178726964973905e-01   -1.324473232725329e-01   -4.636289562735506e-01   +6.532313453785765e-02   +2.088595409970868e-01   +1.659363313955400e-01; -9.007841505407538e-02   -4.341548963107536e-01   -6.208665095282058e-02   +1.897541239559840e-02   -1.798962633973903e-01   -2.015569091584286e-01   +2.620744626718368e-01   +1.388392565699409e-01   +2.170151489657267e-01   -9.781329432380642e-02   -3.449228679656403e-01   -1.608808708765082e-01   +3.306922507228914e-01   -1.773969174915145e-01   -3.891823362243543e-02   +2.157931981308156e-01; +2.494458539256612e-01   -2.391695629413529e-02   +2.351734936922730e-01   -1.732809918836329e-01   -1.919132596393906e-01   -1.363878137649534e-01   -7.836874623496437e-02   +2.625776613559689e-01   -2.686003277026425e-01   -1.427879070468140e-01   +2.526986647596184e-01   -3.042812564319413e-01   -3.779945355182354e-01   +1.771610352829942e-01   -5.970177354992810e-02   +3.052888773701434e-02; -5.782807215397795e-02   -2.327450228937889e-01   -1.975902862185575e-01   +2.138283614798168e-01   +3.611092915445354e-01   -1.322944525015770e-01   -2.545029008790962e-01   +2.409102655089077e-01   +6.666814067291743e-02   +3.297612386831116e-02   +3.382328995596305e-01   -8.223617136900289e-02   +4.738068464958572e-02   -6.270059447722633e-02   +2.660660481752404e-01   -5.171491848380621e-02; +1.110788610670151e-01   -3.385558264508731e-01   +3.398333317907468e-03   +1.179228720106983e-01   -5.613431808512143e-02   +3.211800509718778e-02   +4.225631860980443e-01   +4.059973531422209e-01   +3.067618144522821e-01   +2.049979587766738e-01   +2.658165189274924e-01   -2.842792144185493e-01   -9.641899220298865e-03   -2.886868807253215e-01   +4.282716141269998e-01   +1.631257136882698e-01; -1.567444444522044e-01   +1.523789320856933e-01   +1.424127248648105e-02   -1.204368986668828e-01   -3.602661228200629e-01   +2.376810760465511e-01   +1.716906952755318e-01   -2.785302798025175e-01   +3.037038036758720e-03   -2.230083234499990e-02   -2.397713176522578e-01   -7.664368627453544e-02   -1.537009553762114e-01   +3.527622068524431e-01   +9.622620453592839e-02   +4.441714587051017e-01; -4.850802244440965e-01   -7.173370547605136e-02   -3.036727073593576e-01   +7.702647625257904e-02   +3.339535888929518e-01   +3.488554044199682e-01   +2.416657283222075e-02   +1.289924574132094e-01   +1.805043226788706e-01   -2.462727352260912e-01   +2.045251050213964e-01   -4.904301690115645e-02   +2.511718233424401e-02   +2.836483270863396e-01   +1.828813121578910e-02   +2.139652460079989e-01; -1.094107681233668e-01   +5.605132899344756e-02   +2.388768067800232e-01   +3.391446034891341e-01   +2.138956649084054e-01   +4.317419622591888e-01   -1.891797208513525e-01   +4.173232154706017e-01   -2.981266885334624e-01   +3.272784566531499e-01   +2.436537371394794e-02   -3.498414089399774e-01   +1.008968904563521e-01   +1.585534336519620e-01   +1.166345058939764e-01   +3.327248333773151e-01; -1.739186832852660e-01   +1.792185521654958e-01   -4.508679799005310e-01   -7.661734681653462e-02   +2.723016078541062e-01   +9.541319853949337e-02   +1.508773775322222e-01   -3.954738800363634e-02   -4.527687271865598e-02   -2.255838869598040e-02   -5.280303419200924e-02   +3.670350232997100e-01   +4.274717062358385e-02   -5.320786480179333e-02   -3.429541271113261e-02   -1.623303245704218e-01; +1.929088961433923e-01   +1.601669313233857e-01   +5.890840917872668e-02   -3.615409489125593e-02   -1.096397967257507e-01   -2.579754239867543e-01   -2.783362753315219e-01   -1.476782480477186e-01   -2.059463284832517e-01   +2.243762398630931e-01   -3.843972677685409e-01   +8.662727434610457e-02   +6.610706761171493e-02   +1.439240768885106e-01   +1.977399693574609e-01   +4.707327988702023e-01; -2.191218040657028e-01   +2.341920382569002e-01   +2.233399711694587e-01   +6.676571676249043e-02   -3.769591435508522e-01   +1.659353933577476e-01   +6.776600750080769e-02   -2.580118796626167e-01   -4.266688277644061e-01   -3.202730281202754e-02   -1.871592541550307e-02   +5.783625210441978e-02   +1.208238267217847e-01   +4.658047537802149e-03   -2.777429363142722e-03   +6.615826185834530e-01; +9.358808211335461e-02   +1.155494416794913e-01   +9.592909960170215e-02   -5.528512911970736e-02   -3.707854386218590e-02   +2.711363272465824e-01   +6.538162419682803e-02   -4.461307328886217e-02   -5.711425539347080e-01   +1.365495902425160e-01   +1.791700634074657e-01   -2.158899327080014e-01   -1.366587393602668e-01   -1.395793993668285e-01   +1.533426838831606e-01   +1.035231161106532e-01; -1.507724749743042e-01   +3.126926079084998e-03   +9.014200836545834e-02   +2.857292006663809e-01   +3.302424473906145e-01   -3.490683497768035e-01   +1.906196485601750e-01   +1.112100600389534e-01   +6.621691961231278e-02   +5.157796475979703e-01   -2.856097017718203e-01   +8.209868760073130e-02   +1.920120663604863e-01   -3.059893106459761e-01   +2.094582907450535e-01   -2.935593652910539e-01; +8.035200661477247e-04   -1.452302256875852e-02   -1.357181164380846e-01   -2.670137683554145e-02   -6.464066226369861e-02   +2.376928320584408e-01   -1.732152481713725e-02   +5.893217024499821e-01   +2.728154030973817e-01   -2.530686433631177e-01   +2.953127209181638e-01   -1.373108834936506e-01   +1.560007794368687e-01   +2.776149389520263e-02   -4.554671412986582e-02   -1.032046018686391e-01; -2.071344703656519e-01   +1.175731552685033e-01   -7.920553760909534e-02   +2.112139804352853e-01   -1.757729547089082e-01   -1.955515533253887e-01   +2.485777520173127e-01   -4.059161462797129e-02   -4.066063985273000e-02   +1.212648430936461e-01   +1.179835872936956e-02   +1.153984356105683e-01   -1.826068158244370e-01   -1.930760125896497e-01   +2.617584066800699e-01   +3.734491392707909e-01];
L1E_L1I_iGABA_netcon = [+1.440368461060818e-01   +2.901953570891863e-01   +4.089967197236983e-01   +2.041560159434996e-01   +6.831829021609592e-02   +5.339202724253322e-03   +1.875952019271344e-02   -4.018352014125606e-02   -2.039125609657749e-01   -1.768887178122817e-01   -4.774736854704922e-01   +2.639545960328238e-01   -1.571220835899521e-01   +1.540975191688091e-01   +6.634117209508815e-01   +2.803022851565885e-01; +1.482180376948016e-01   +5.312571435439415e-01   -1.653084570765645e-02   -9.432915621244969e-02   -1.639710854705116e-01   -3.560815734583534e-02   -2.001349910071847e-01   -4.840664584557576e-01   +6.800257435266113e-02   -6.282099365349522e-02   +5.569169227480666e-02   +7.457923243439592e-02   -3.696773380498928e-01   -1.255021223789158e-01   -2.769276062854172e-01   -3.260878735641372e-01; +4.108855627409955e-01   -7.363082406451686e-02   +8.022984264129103e-02   -4.577709231074763e-02   +3.145720653521532e-01   -3.403156349015178e-01   +7.381905505773009e-02   +3.046068516938154e-02   -8.106230961523393e-02   -3.050987238681349e-01   +1.459705518662217e-01   -2.002199824535470e-01   +3.748023340191563e-01   +1.320810797905198e-01   +1.787341710524723e-01   -2.018178236309458e-02; +1.619076259697153e-01   -9.901027862333742e-02   -4.082735106349435e-02   -9.026007828557706e-02   -1.295919553007578e-01   +1.016899538759705e-02   -5.269543601093526e-01   +1.877125312694780e-01   +4.265009129899815e-02   -9.620199454209877e-02   +9.546465951964718e-02   +4.557203940787097e-01   -8.132746426488903e-02   +8.166695466518537e-02   -1.263857656339783e-01   +3.083471884004535e-01; -4.642792451611082e-01   -1.080439431625235e-02   +4.430418769644308e-02   +3.820443730218342e-02   -7.398081606231177e-02   +3.836039461024411e-01   -3.009967487747456e-01   +1.174045210017654e-01   +4.180170937197713e-02   -1.221564797431908e-01   -2.424563787828538e-01   -2.736022493281960e-03   +2.960021479028522e-01   +2.112233200351044e-01   -3.324420769740010e-01   +4.036863631793486e-01; -1.938202920296343e-01   +1.551185344449419e-01   +7.920688663211065e-02   -1.369434741545837e-01   +2.213216154757905e-01   -3.962604454699641e-02   -1.200867644973377e-01   -3.384775185343638e-01   -1.370975474506217e-02   -1.212259042506699e-01   +7.633896500997732e-02   +7.876402529024813e-02   -3.437594846408857e-01   -1.254992682952454e-01   +4.160555096171407e-02   -2.115947988296839e-01; +2.658659612403072e-01   -2.187637703188484e-01   -2.152186705385634e-01   +2.498830180272713e-01   +1.845720335643432e-01   -3.162223176340819e-01   -3.085877642010904e-01   -3.172490437362186e-01   -1.563192019878477e-02   +2.285959583655631e-01   -5.061231743927600e-01   +2.553472772444242e-01   -9.297157835477175e-02   +1.270249000176417e-01   -2.425043939623252e-01   +2.253233859282889e-01; +3.507258029801689e-01   +1.953383579066984e-01   -2.966609464762110e-02   +1.001451944316341e-01   -4.635569243193491e-01   -1.587063051560432e-01   -1.816305681323473e-01   -7.562295394839205e-02   +7.014243727296546e-01   +1.879168245353735e-01   -6.305443743931972e-02   -1.138943930644038e-01   +2.545888011260878e-01   +1.834974668487134e-02   +1.564959207347790e-01   -2.028676075535298e-01; +1.866864638726182e-01   -2.754013301385079e-01   +1.658219726434581e-01   +5.611006416098318e-01   +8.134374927409496e-02   +1.090120551643664e-01   -2.884912618671995e-01   +3.435411251585453e-01   +3.351026208563822e-01   -1.077702595734484e-01   +1.890073153146324e-01   +2.700401335992033e-01   +3.629457615432045e-01   +1.458759125756687e-01   +3.309337786868685e-02   +2.174355340793174e-01; +1.315216447192950e-01   +1.075733862216108e-01   -3.503321997495986e-01   +2.389611406685769e-01   +3.003790300518956e-01   +2.993272254828457e-01   +9.798719285326206e-02   +1.415152713874420e-01   +4.076075415510202e-02   +1.516002794956318e-01   +2.006001363800898e-01   +4.482698602268090e-01   +4.075261680048856e-02   -3.875256560589798e-01   +3.552610871032337e-01   -6.284683539050457e-01; -2.334196308431603e-01   +2.224282773808182e-01   -1.750236428605708e-01   -2.292085702652105e-01   +4.784281266186411e-01   -2.931787123631666e-01   +6.449975692624205e-01   +4.753114833782759e-01   -1.149205947918882e-01   +4.590984428560307e-01   -2.789643651935371e-01   +2.118722123172200e-01   +1.090355791922521e-01   -1.927740082938289e-01   +3.054083409474415e-03   -2.430665541475724e-02; +3.348739797937569e-02   -3.643364425076601e-02   -4.064875925292640e-01   -1.766901487667832e-01   -1.942342954670558e-01   +1.808955350237076e-02   +2.010647540600567e-02   -2.192498746478450e-02   +3.553805046944349e-01   -3.587716346705548e-01   -4.518075916091152e-01   +2.408326322788077e-01   +4.861071005135493e-02   +3.766810766102468e-02   -1.146870249756375e-01   +4.937661992757640e-01; +8.877303006046763e-02   -2.647055541930920e-01   -2.757131980927885e-01   +1.225259964229266e-01   +4.599242625756169e-01   +1.226846546225747e-01   +1.351168896536786e-01   +4.436327338941158e-01   +1.876533347783256e-01   +2.600514579208169e-01   +1.582332594582674e-01   +3.626339627021177e-01   -2.834272348880207e-02   -3.322525673301251e-01   +1.443886975366546e-01   -3.703450560810209e-01; +5.980778900592081e-01   +4.121347468120735e-02   -6.165939068046470e-02   -8.295527675338879e-03   +5.604157219882382e-02   +6.074629425110718e-02   +5.888442225247317e-02   -3.926738218088720e-02   +8.688352694661050e-02   +3.076991243797561e-01   -1.297522841024562e-01   +4.203285502019715e-02   +7.666104738032489e-02   +1.877735505377023e-01   -2.568566622996660e-01   +1.321364800081291e-02; -6.044729570044774e-03   -2.515335074656920e-01   +3.210014061930785e-02   -2.743841927123214e-01   +2.054480178956679e-01   -4.456563483291341e-03   +8.032995131464550e-02   +4.921916902527685e-02   +3.348947133247341e-01   +3.225959784396861e-02   +1.750481922646123e-02   +1.339263987106128e-01   +7.286604455922543e-02   +8.060964987523729e-02   -2.478042359270140e-01   +2.005054925707385e-01; +8.960479959158021e-02   -2.181481782217780e-01   -4.555356042765049e-02   +1.911076694346746e-01   -1.315040177525296e-01   -1.776575493368900e-01   -1.768251757529541e-01   +2.516545726332799e-01   +1.809305957487362e-01   -1.532200200506448e-01   -9.286740789334320e-02   +3.155698688385020e-01   +4.696102623958820e-02   -2.373168597426408e-01   -2.825405227990441e-01   -2.964853368645344e-01];
L2I_L1I_iGABA_netcon = [+1.800072981611734e-01   +4.310915635457638e-01   +8.115399491550067e-02   +2.069793873363336e-01   -1.142424357579191e-01   +7.796123018232226e-02   +4.706313282708133e-01   +3.604052532093124e-01; -6.484849465865464e-02   +1.071355968351834e-02   -3.373910529165101e-01   -1.031204741702292e-01   +4.136370056196518e-01   +1.404310764076056e-01   -1.100372177037017e-01   +1.292813583870350e-01; +1.592721688194264e-01   +1.943003812876579e-01   -2.639961869476902e-01   +3.026718184275653e-01   +3.017189885882222e-01   +1.143199034450049e-01   -7.402329921891312e-02   +2.914068641734855e-01; -1.939212403166488e-01   +1.601027365519297e-01   +2.367332137736418e-01   +2.331255714871869e-01   +2.529422906449655e-01   +1.452291841578400e-01   -8.202388872642086e-02   +6.319080698516552e-02; -2.449114632946671e-01   +2.751415070374020e-01   -9.026030980413827e-02   +8.350542281725915e-02   -1.190079172901476e-01   +4.695039774710961e-01   +3.469239092779242e-02   +1.978727240326087e-01; +4.421346325938189e-02   -1.420125083130034e-01   -1.744500262295145e-01   -2.568516540019265e-01   +1.588055410147466e-01   -2.852842704809147e-01   +5.184294266334394e-01   -1.520824623653522e-01; +1.800133875749502e-01   -6.669999982211969e-02   -1.319038118561910e-01   +5.826728894824182e-02   +3.059828536548945e-01   +3.279953779953305e-01   +2.599208194460778e-01   +4.300934009157088e-01; +3.597202814704859e-02   -2.499360324706821e-01   +1.652977086589847e-01   +4.437635324153506e-01   -9.075655096743648e-02   +1.519500625719412e-02   -1.489141205936827e-01   -6.659986203801287e-02; -1.682543535362433e-01   +2.282525293618170e-01   -1.227627118839847e-01   +2.720955244999379e-02   +1.242484106243888e-01   -1.306928272953305e-01   -5.024161516204233e-01   -1.313479115108512e-02; +7.948049019157272e-02   +2.278642422688441e-01   +2.618181851736417e-01   -5.414710711307323e-01   +1.924333831537792e-02   +1.203720817342306e-01   +3.629140886954332e-02   -4.354567050574841e-02; +1.169548602594785e-01   +8.947541259629728e-02   +2.531831882949649e-01   -1.126721246888756e-01   -4.786256867460346e-01   -4.059697641394041e-01   +3.420198727639448e-03   +8.280702479456192e-02; +6.123576107112445e-02   -4.231336555571156e-02   -1.654155783805521e-01   -2.054335974923315e-01   +8.329342878769967e-02   -1.661659195756292e-02   -3.474919189829685e-01   -3.836966872984322e-01; +2.618494215223960e-01   -1.186949567198581e-01   +2.395522722005163e-01   +1.412693639617192e-01   -1.139123684984711e-01   +1.857013900188874e-01   +5.003762294518062e-02   -1.148399356490347e-01; +1.244709063421366e-02   -4.059437537454688e-02   +1.263294704582085e-01   +4.012183319339493e-01   +1.408251990574963e-01   +8.047949197906604e-02   -2.760701261037094e-01   -1.007295932010028e-01; +2.804622059220178e-01   +2.625901264821537e-01   +5.946505631043678e-01   -2.736549241972754e-01   +3.945189199216049e-01   -2.113745622445147e-01   +2.285292485602181e-01   -1.256713979210748e-01; -4.355138305871323e-03   +3.106089950723931e-01   +2.717986827422059e-01   +1.352895651112799e-01   -1.924492485061193e-01   -6.473169125971751e-02   +5.517789555807013e-01   -1.905146370769615e-01];
L1I_L2I_iGABA_netcon = [-2.223543144975818e-01   +5.295967040501878e-03   +3.366959443355294e-01   +2.573631152561802e-02   -1.455667306483278e-01   +3.126834698798288e-02   +2.720546657383134e-01   +1.143634903739711e-01   +1.778672201297738e-01   +1.836903657905939e-01   -2.756415473618579e-01   +7.942289843044316e-02   -2.717354987743598e-01   -1.775609151090051e-01   +1.100226309242310e-01   +3.815245237917976e-01; +1.899532874644232e-01   -1.057513667323105e-01   +3.341684039928330e-01   -7.041121363653415e-02   -5.301300666160196e-02   +1.598026821086564e-01   -4.363722457947216e-01   +7.875582205893975e-03   -1.626748088487653e-01   -6.203456324630962e-02   +2.015156149622203e-01   +3.147137865248552e-01   +4.207006854300581e-01   -5.051081885396847e-02   +1.728867940666335e-01   -1.850750280773648e-01; -5.621719591532284e-02   +2.517256979648096e-01   +4.870631740562175e-01   -4.129905005142163e-01   +1.065849932346774e-01   -1.684955849950414e-01   -7.650573163555802e-03   -1.394723204417460e-01   -4.544540488565414e-02   +9.836935193539670e-02   -1.601025715672835e-01   -2.706846519211729e-02   -6.797062413995905e-02   -3.738418560081561e-01   -5.750229004087125e-01   -2.934285815961453e-03; -5.924328257637453e-02   +2.053844112116817e-01   -1.139071659117661e-01   +6.030900375342724e-02   -1.096667231358409e-01   +2.285202514835628e-02   +1.606385176515137e-01   +1.976505994440962e-01   -4.194811310877780e-01   +1.721036145131217e-01   +2.271786586650433e-01   -3.440269988003193e-01   +1.304695356963190e-01   -1.652542949031215e-01   +3.346821412300613e-01   -1.206850856160565e-01; +6.599948197105306e-01   +3.852421993039239e-01   +2.805788429865053e-01   +5.099128967588202e-01   +9.151476342449917e-02   -9.562186864546432e-02   -5.302480782054743e-01   -2.249146125909796e-01   +2.683415303274786e-01   -1.565429633371208e-01   -3.425853216832549e-02   -1.355259560685620e-01   -1.371609477847111e-01   -1.274497282930012e-01   +2.720423047192325e-01   +4.398367561386101e-01; -1.673541479843687e-01   +1.584585686232465e-02   -1.789836659221665e-01   -4.639701318602416e-01   -3.972786442774638e-02   +1.793564003737360e-01   -4.990446792881918e-01   +3.197817878734673e-01   -1.357580312489356e-01   -2.460894447492004e-02   +1.764237135493330e-02   +3.127454291609930e-01   +2.131471864343723e-01   +3.138390112046603e-01   -1.772826890454438e-03   +1.790188427473779e-01; +1.178248493907313e-01   +9.128266624082522e-02   +1.093493065194768e-01   -1.040671606303795e-01   +3.710012651698938e-01   +1.146378438866434e-01   +1.240001091616962e-01   -3.045843707737117e-01   +4.081923756070207e-01   -4.886975809134908e-02   +3.882412062082818e-01   +7.593515705839275e-02   +3.252850810903708e-01   +9.622852776140571e-02   -1.012073119063405e-01   -1.968666665907630e-01; -1.001311511296868e-01   -1.407256193540814e-01   -2.704802494966713e-01   +2.797651955596133e-02   -2.459317509852493e-02   -1.751178433179533e-02   +1.080084440756013e-01   -4.891596078184306e-01   +2.285951970338263e-01   +1.043255201829334e-01   +3.582074939063302e-01   +2.798858981010048e-02   +9.316270169046591e-02   -1.242748866938911e-03   -1.265873216470240e-01   -4.404940984183855e-02];
L2E_L1E_iAMPA_netcon = [+1.740742542425812e-01   -4.017294606682028e-01   +1.857711364812960e-01   -4.052309963062007e-01   -1.069799925129857e-01   -1.108247124556100e-01   -3.034988008380507e-01   +2.951769658442746e-01; +2.217740333095968e-01   -4.864357269531102e-02   -4.950817246697274e-01   -4.667427671043236e-01   +3.199973174467702e-01   -4.404184887579592e-02   -1.053031958796355e-01   -3.603770696267282e-01; +1.348396935626198e-01   +3.442375063713347e-01   +1.574366203492409e-01   +6.798791377978264e-02   +2.355599510700779e-01   +9.284716634744061e-03   -2.026533614834084e-01   +1.591542120863482e-01; +2.684780728683058e-01   +8.753362575931824e-02   +4.570038944154305e-01   +7.731069032968885e-02   +3.522974053676337e-01   -3.056836808589115e-01   -1.809715259114488e-01   -3.695191934626486e-01; +3.255887672645911e-01   +5.738224236123258e-01   +2.583078567041813e-01   -1.798137692332663e-01   -2.655636949886645e-01   +1.026830241369870e-01   +1.205605642948972e-01   +4.334674497692291e-01; +3.708086839497696e-01   +2.357935088934910e-01   +2.590140530949978e-01   -1.778943445403327e-01   +3.583994487027663e-01   +2.703121829875882e-02   +2.215073662057605e-01   +4.368576321572623e-01; -1.588224302566056e-02   +1.507390465337430e-01   +1.212699485018523e-01   -3.271463036399991e-01   +1.639485960939235e-01   -5.375923657329630e-01   +1.856564285143278e-01   -3.801413854620624e-01; -8.513874008687750e-02   -7.275467355903217e-02   +5.657082196289354e-03   +2.464237467246919e-01   +2.498547196614389e-01   -1.527734826067241e-01   +2.928227740865296e-01   -4.843294784448057e-02; -2.620818015016402e-01   +2.204049378385886e-01   -4.027800352006873e-02   -2.610739616991006e-01   +2.090965544100303e-01   -9.590499898322627e-02   -1.128536381331959e-01   +2.804992957993792e-01; +2.365601759788098e-01   +5.395132207430203e-02   -9.134456642325875e-02   +2.490017180293103e-01   -9.869572429304985e-02   -1.737521706835345e-01   +3.908285017786851e-01   +5.742431095323047e-03; +3.232360664829177e-01   +1.559170617836893e-01   +5.630725572570807e-02   -4.136021636697759e-01   -4.357547503951802e-01   +7.752553986812590e-02   +7.925666134716186e-02   -2.444664524925985e-01; -1.460039701533036e-02   -2.708094211575945e-02   +6.478752804868337e-02   +5.615309817071329e-01   +2.227227682325613e-01   +2.572125815053014e-01   +1.749407131344488e-01   -3.104387227600156e-01; +8.777826747160440e-02   +4.270215384331869e-01   +2.944681145662512e-01   +2.899346552071591e-01   +3.017753832858011e-01   +2.781012912110900e-03   +2.876577299819244e-02   -2.698088869869572e-01; -1.128368511408210e-01   -7.966191575665697e-02   -3.288780231436360e-02   -5.398212740178205e-02   -1.828698295846759e-01   -2.473640340305003e-01   +3.724888365753229e-01   -1.241481828367414e-02; -4.334769975972839e-01   +1.686747165549299e-01   -1.513210178720575e-01   -2.119026186282186e-01   +2.479107322743923e-01   -7.682812798747951e-02   -9.486467844486592e-02   -1.722905552766609e-01; -1.790378556998797e-01   +1.468738652365915e-02   +7.701099634759748e-03   +7.195291571243950e-02   -1.435403739134811e-01   -1.658383611151029e-01   +1.435642767402099e-01   +2.244624318315782e-01];
L1E_L2E_iAMPA_netcon = [+3.516421760155961e-01   +2.017757037673595e-02   +8.785148521387290e-02   -2.670097326472845e-01   +4.762264123257590e-02   +6.946701721426639e-02   +2.064785312168563e-01   -1.770584751141584e-01   -1.221447350916312e-01   -1.065276564347894e-01   +1.017387939675883e-01   +1.079199802575559e-01   +1.546050296015243e-01   -1.984853957118943e-02   -7.745480281612527e-02   -1.586990679203348e-01; -1.015716143649330e-01   +5.386420794447010e-01   -2.315373380414376e-01   +2.708284131293820e-01   +2.859785063524463e-01   +7.174663377504320e-02   +1.585248674599979e-01   -1.603325214306595e-01   +2.023620759264112e-01   +3.522100722274098e-02   +2.283979463736993e-01   +7.036069116404543e-01   +7.303247044430222e-03   -3.199815500915982e-01   +1.794820157528726e-01   -1.094420616645611e-01; +1.382449466258781e-02   +2.618321521700453e-01   +8.425067208790557e-02   +1.420523541777109e-02   -9.176511634039382e-03   -3.203728422094165e-01   -1.525686455746462e-01   +1.125751895388910e-01   +1.419427030740436e-01   -1.813794489968339e-01   -5.039602849564985e-01   +3.462652160839004e-02   -1.555536480311577e-01   -2.525896540444673e-01   -1.232231138843595e-01   -2.233294773443801e-01; +6.781039603225765e-02   +4.386873748075986e-01   +2.170304192982539e-01   +8.218958155173428e-02   +1.126046455574574e-01   +2.705287894386842e-02   +1.265509053991738e-01   -1.104635102486050e-01   +1.700104842850277e-01   +7.865710495488765e-02   -1.548277508558135e-01   -9.655409413454046e-02   +6.362762294159448e-02   +4.346220424366445e-01   -1.560390531590983e-01   -3.946371958866033e-01; -5.923190879007832e-02   -1.091947634755514e-01   +8.494703656959481e-02   +3.220616243573488e-01   -1.306456436414137e-01   -2.297892744379849e-02   +2.040524403141968e-02   -3.720364339556181e-02   -5.710251695520457e-02   +2.340869817615649e-01   +3.562334513595594e-01   +1.675467095964815e-01   +7.909223079750974e-02   -3.643063128780088e-01   +8.723839794742894e-02   +1.946816740431253e-01; +3.716209966092210e-01   -2.486864932686744e-01   +1.819604281580712e-01   +1.365446720159517e-01   +4.003385924573069e-01   -2.756956215487298e-01   +1.133316330836499e-02   +1.104436252229363e-01   +2.419841123156825e-02   -1.630869960843898e-03   -5.381184803234065e-01   -8.734877323172223e-02   -3.313638252029187e-02   +1.523067016192909e-01   +4.348843416548685e-01   +1.514132051506136e-01; -1.868752714611565e-01   +1.240482448186131e-01   -4.513713715622443e-01   +4.784106690444085e-02   -1.109537793155914e-02   -2.684734679689165e-01   +2.067590715079269e-01   -6.091531971517181e-02   +2.906757883668034e-01   -3.324913188208785e-01   -1.923095723854238e-01   +1.482713217063844e-01   -9.079430609847332e-03   +3.251584564202110e-01   -2.138646320949631e-01   -1.947200774823005e-01; -4.788445761088471e-02   +2.164138958194795e-01   +2.013013869055504e-01   -7.073581791429126e-02   +7.777225278614654e-02   -4.173854529419799e-02   -3.590550572689481e-02   -1.473446383073010e-01   -5.566836161600877e-03   +4.084481853605769e-01   +1.097311788503695e-01   -2.802780912745809e-01   -3.822709455406810e-02   -4.258450051692630e-01   +2.131538976230641e-01   -2.279191125141317e-01];
L2I_L2E_iAMPA_netcon = [+1.358998465187621e-01   -2.944580482046980e-01   +1.447982337705516e-01   -1.339892499419504e-01   -9.211118808601929e-02   +2.673425877918281e-02   -1.977320180847125e-01   -6.979493205167223e-02; -2.511435147705047e-01   +1.375964618739738e-01   +1.709556657016489e-01   -2.320379488562690e-01   -1.969102607431030e-01   +2.463721555091661e-02   +1.517250116869724e-01   +1.345960088436602e-01; -4.431788552792827e-01   -2.601933158241203e-01   +2.103102151359366e-01   -5.857248162183108e-02   +6.775872826496600e-02   +2.592703120184310e-01   -8.152969887569508e-02   +3.934742871759356e-01; +1.339089587967740e-01   +2.088208646818985e-01   +1.945139880980273e-03   +4.387831358094072e-01   +1.476990211102001e-01   -7.512164211071731e-02   -1.845155603224697e-01   -4.742791704165220e-02; -4.797609835309068e-01   +3.030527587277957e-01   -5.894075075320626e-01   -1.512750902538632e-01   +3.147680230300916e-01   -5.354855460851200e-02   +9.453646556763705e-02   +2.905321699266914e-01; -4.432322852036821e-01   -5.409078490956844e-02   -1.792878136097981e-01   -2.877933664459002e-01   -5.083118340499902e-02   +3.730720162017078e-01   -5.416061395499114e-02   +8.419287341379474e-02; -1.872880213705271e-01   +3.751918584703046e-01   +1.940398801932875e-02   +1.660480645947930e-01   +6.669019711850721e-02   -9.898039455257045e-02   -1.609885406987232e-01   +4.222048995082067e-01; -4.987611805525881e-03   +5.326398908873213e-02   +1.893396281219561e-01   -6.091937204256215e-02   -1.490375487559814e-01   +3.168060899744609e-01   -4.635355435960774e-01   -1.709831651721383e-01];
L2E_L2I_iGABA_netcon = [-1.367491257324665e-01   -1.329313253712791e-01   +1.886954559960172e-01   -1.609946664536470e-01   -1.019230180767241e-01   +3.747796681601013e-01   -3.747029268362139e-02   -4.351076338291422e-02; +2.866338342394117e-01   -4.428112815830779e-02   -5.007404288169957e-02   +2.485516689074719e-01   -2.631827767233424e-01   -5.335506754797147e-02   -2.099731343413686e-02   +1.611132042101614e-01; +6.414615841849054e-01   -3.816843569684437e-01   +1.792083491200245e-01   +2.475849300759551e-01   -1.695308341228845e-01   +1.773113115592665e-01   +1.708759638900585e-01   +7.395691989636255e-02; -1.897926363884679e-01   +8.582407905817187e-02   +1.618742921380691e-01   +4.910382723626047e-02   +8.192614577343570e-02   +1.245112648784858e-01   -3.140674888344804e-01   -1.263927239848555e-01; +9.231864708102841e-02   +1.092702713966831e-01   -2.865017682248064e-01   -2.926716683592904e-01   +2.672416665475730e-01   +6.243717949644494e-02   -9.165067120243676e-02   +2.792793552909418e-01; -4.633230718690776e-03   -4.140682430097582e-02   -3.499524608185588e-02   -1.185700519687288e-02   -9.402924100962898e-03   -4.699547017753697e-02   +3.025114091032222e-01   +1.070871388027599e-01; +2.968591103479991e-01   -3.593826967790115e-01   -5.995087851313177e-02   -1.049748240422583e-02   +4.710990163037442e-01   -2.643118273187848e-01   -5.376360601322103e-02   -4.826017234239537e-02; +1.234906606696087e-01   +2.771618862242181e-01   +2.048790569416834e-01   +2.278733270529407e-02   +1.417935742519505e-02   -1.957025211137569e-01   -3.674394249144132e-02   +2.826308827554507e-01];
L3E_L2E_iAMPA_netcon = [-1.840115341447747e-01   -4.442670667296991e-02   -5.526012130513187e-02   +1.660616187407944e-01   +3.173017123369937e-01   +4.304286710779725e-01   +4.208311914619475e-02   +6.432994796943908e-02   +4.107793806173237e-01   +4.553304792452716e-01   +1.511791078809657e-01   +3.438658274126581e-01; -1.399184024302953e-01   -5.569741816852361e-02   +1.898006513938801e-01   +3.296379763858326e-01   +1.246781151952129e-01   -1.016369979164487e-01   +5.228011355239980e-02   +1.015869536804997e-01   +2.377222236860845e-01   -9.981315181364223e-02   +1.006356610562883e-01   -8.052551494364778e-02; +4.070104025902283e-01   -1.301791448208512e-01   -5.259407351673184e-02   -2.081521127441937e-01   +3.918347658598320e-01   -2.218335092320357e-01   -7.888766459888159e-02   +3.274469550990644e-01   -3.546135226519493e-01   +1.613615074215875e-01   +3.692653071359743e-01   -2.141220639421759e-01; -4.018493975424669e-01   +2.450537964712576e-01   +1.358335796438889e-01   +7.815968071167526e-02   +2.984775417043483e-01   -3.339212538357763e-01   -1.530439365942547e-01   -1.202266870492506e-01   +3.256236028091906e-01   -1.620904001709348e-01   +1.591755165769321e-01   -1.447198733120393e-01; -7.745291677620883e-02   +1.112214123601929e-01   -9.575962805551848e-03   -8.706579779181207e-02   -3.293330608906034e-01   +3.348511455670482e-01   +1.054120786573758e-01   -1.394857585349121e-01   +3.676559050475071e-01   +1.284323115263848e-01   +2.601472565194868e-01   +6.603712453165689e-02; +2.629892268845985e-02   +3.177167915873281e-01   +2.744832794645213e-01   +6.742063074103971e-02   -5.118663434988041e-01   -1.812422425113621e-01   +1.577751627492096e-01   -4.510538576367534e-02   +5.027394989033883e-01   +1.272732667068686e-01   -1.582680797159727e-01   +2.534696280493332e-01; +1.558792790377265e-01   -3.319898499022003e-01   -2.314208399111334e-02   -1.364624909835153e-02   -1.627825499290894e-01   -2.765405731329737e-01   -4.392014535239004e-01   -1.968711736651110e-01   +3.402036161937817e-02   -1.975565478596127e-01   -1.370133692617442e-01   -8.163853985429530e-02; -7.559080543561489e-02   +1.820847277610939e-01   +1.553286678008175e-01   -5.745221956558843e-02   +1.781533216071147e-01   -1.167447245816425e-01   -1.331733073919745e-01   +2.577649710271348e-01   -1.328948951541844e-01   +7.217568925473934e-02   -2.033606871900608e-01   -8.439754645003895e-02];
L3I_L2I_iGABA_netcon = [+1.509887225108207e-01   +1.752478857989203e-01   -5.479697793609832e-01   +3.131945326490032e-02   -3.634562588898902e-01   +1.375169961472704e-01   -3.208161025562103e-01   -1.304742067865384e-01   +2.827163267911502e-01   +1.605755425270343e-01   +1.934436974462531e-01   +6.375882617019227e-03; +4.141695499625851e-02   -4.029358073643047e-01   -2.297397913566671e-01   +2.118640773643025e-02   +1.968286463096367e-01   +3.788584491529188e-01   -6.299616643471137e-02   +9.433583909116094e-02   -1.555538546599163e-01   -5.075795955776621e-01   -1.324617487996871e-01   +2.376475621010041e-01; +1.898297019702331e-01   -3.418081213971984e-02   +3.771658421192031e-02   +4.928074399469046e-01   +9.504358800056768e-02   -2.432734079645006e-01   +5.020903707853903e-02   +3.303338061058774e-02   -1.336491413227739e-01   -2.034791128469752e-01   +5.084922365236872e-01   +1.999371753160363e-01; -1.807334835507451e-01   +1.423932517148854e-02   +3.295686017356171e-02   -4.531517841427862e-02   -1.488287871146595e-01   +9.507045621764419e-02   +6.665097932182112e-02   -2.808474768591254e-01   -2.511180513722223e-01   -5.786168887977624e-01   +3.319438346440111e-01   +2.264198670604122e-01; +1.930916135354486e-01   -2.395774212807927e-03   +2.316056771295795e-01   -4.123634549785912e-02   +2.866435097949397e-01   +1.760226589674102e-01   -2.401756062836392e-01   +8.628116096609247e-02   +3.426991688026871e-01   -5.362765537344097e-02   +2.043858576029116e-01   +6.367497252981894e-01; +6.129310186372295e-02   -1.797280567315922e-01   +1.266613383660084e-01   -1.112544567691867e-01   +1.771220441523199e-01   -1.389230317689278e-01   +1.779082334924663e-01   -3.776200372224470e-01   +3.886809439937858e-01   +4.424686841855053e-02   +3.696794331736766e-02   -4.751209568517836e-02; +3.846313660453525e-01   +2.978303096592558e-01   -2.448668831696437e-01   +1.003286831710094e-01   -2.309087206887726e-01   +1.015160897274072e-01   +6.362989570884856e-02   -2.100052009690413e-01   +3.739778461602520e-01   +2.329312561363822e-01   -6.000990002515878e-02   -1.646652827267999e-01; +1.043313251842401e-01   -5.342695367914981e-02   +1.199279068255882e-01   +9.798334586404034e-02   -3.343755556433277e-01   +1.344966008145478e-01   -1.095648234209157e-01   -3.360430404702747e-01   +1.603376628809364e-01   -6.731328190973521e-02   -3.864425930135329e-01   -1.150206309412052e-01];
L2E_L3E_iAMPA_netcon = [+1.518638514395039e-01   +1.453173985750195e-01   +2.196650107347455e-02   -2.321684170301508e-01   -1.038197664535335e-01   +3.156732951441991e-01   +2.274669696060976e-01   +1.911468085376726e-01; +6.983344955504672e-02   +2.265253463062386e-01   +2.279050198769013e-01   +3.445592702480873e-01   +1.434398029231493e-01   +3.025469629084601e-01   -1.471999739855361e-01   -3.651417628161582e-01; -1.265377713005737e-01   +2.728950410048585e-01   +3.074746567831177e-01   -3.692168493277259e-01   -3.286330180729184e-01   -4.377408257630497e-02   +6.430974968810399e-03   +1.369993805865808e-01; +1.554092097562338e-01   -3.978864012282476e-02   -3.744866756943832e-01   +1.857537246777113e-01   +1.340769077940032e-01   +5.143193723306384e-01   -9.464802091496560e-02   +8.945844728231714e-02; +3.432277879733619e-01   +1.239084895247061e-02   +2.985428361156262e-02   +3.839768874631787e-01   +5.331363110293194e-01   -1.261529956045845e-01   +2.314153331473005e-01   -3.385287683331036e-01; -1.418064182811314e-01   -1.230932242975844e-01   +2.557011865762321e-01   +3.831500741960548e-02   -3.279013480351818e-01   +1.956164314757141e-01   -1.291809936982856e-01   -3.076259554975418e-02; -2.332944765422269e-01   +3.571611765683991e-01   +1.431639809692846e-01   -1.307782756258467e-01   -1.271332513035021e-02   +2.574694597569811e-01   +7.985041733568590e-02   +9.086399983402502e-02; +3.830642497244031e-01   -2.180062104479532e-01   +2.640356801932762e-01   +3.097368990963925e-01   +1.302423520588773e-02   +1.358383621421463e-01   +3.680762417626056e-02   -2.002325814168702e-01; +4.431303935190716e-01   +8.455587548445864e-02   -1.747925297941143e-01   -3.681374168154706e-02   -1.452831722212207e-01   -1.485778956473557e-01   -2.141390083318143e-01   -3.127890977459785e-02; -2.334111713505108e-01   +3.571944189873543e-02   -3.645784497055025e-02   -1.166140062632659e-01   -3.950818373847116e-01   +9.433142997351798e-02   -3.853290335169483e-02   -2.248392549208893e-01; +2.483522488592137e-01   -3.806398311461463e-01   -2.264025018392046e-01   +3.171333377285579e-02   +7.178517684566246e-03   +2.223338042454532e-01   +3.362950862664568e-01   +3.776262728637758e-01; -1.375557343317827e-01   +2.958176388878339e-01   +8.867090797744100e-02   -3.341657385818039e-01   +2.858168843294305e-01   +1.004179342763927e-01   -2.605472016426790e-01   +3.272355519326638e-01];
L2I_L3I_iGABA_netcon = [+4.055678294405657e-01   +5.369539338419328e-02   +2.681126623183809e-01   -2.132587425376878e-01   -1.409541348259851e-01   +2.603013463497877e-01   +1.392697893808034e-01   -4.405926882786322e-02; -2.515581865825694e-01   +9.982065663732304e-02   -2.139567801655701e-01   +2.355212802237758e-01   -1.276099027121104e-01   +3.837040915825647e-01   -2.580217672142400e-01   +2.565767145777127e-01; -4.237375693227705e-01   +3.711104872260652e-02   +2.600936089071800e-01   -2.023547499461413e-01   +2.025966210801593e-02   +1.160067616432370e-02   -4.577094739084951e-02   +2.583775004759552e-01; -2.738219587494793e-01   -9.307603654845269e-02   +4.244919890473635e-02   -1.503929300976513e-02   +1.934172056575875e-01   -1.389432510982500e-01   +4.841123920228585e-02   -3.308373288080963e-01; +1.747970850101083e-01   +4.495865511783970e-01   +3.549488474930582e-02   -7.894799008164152e-02   +3.271491720291725e-01   +2.051135526050550e-02   -9.165576255224418e-02   -1.941559428815596e-01; -7.650792502614269e-02   +3.812281269272557e-01   -1.953065174767472e-01   -2.998320952413108e-01   -1.307784906215068e-01   +8.446582243054768e-02   +1.317797114905063e-01   +1.998388606770494e-01; -2.261155719694824e-01   -2.594553722161871e-02   -4.137686386837370e-01   +9.619669329423167e-03   +1.725118501251050e-01   +2.559909633105469e-01   +1.441005550508290e-01   +1.968573551251848e-01; +3.091327252059611e-01   +5.630938647006911e-02   +1.561926079864225e-01   -3.096910792561182e-01   -1.345153192215565e-02   +2.212396032049758e-01   -1.291822282757500e-01   -3.019477751639014e-01; -6.350089140420978e-02   +1.857316181578168e-01   +6.040191927903843e-02   -3.558677089512076e-02   -1.715782637950437e-01   +4.540572933308807e-01   -1.499341337732585e-01   +4.588121062123292e-01; -2.447011841130367e-01   -7.817319223806467e-02   -8.320889228673420e-02   +5.247016135889282e-01   +7.670823132693393e-02   +2.317759440061531e-01   -1.452150256653967e-01   +8.634821925472384e-02; +2.773091378784687e-01   +1.298313432546876e-02   +1.864117999859750e-01   -1.793388424175602e-01   -3.879314101499702e-01   +7.219456889013284e-02   +1.993163180850101e-01   +2.607212200281891e-01; +3.394768440339784e-01   -3.555755866192709e-04   +9.738592379121241e-02   +7.248135242941856e-02   +1.838618611030412e-01   -1.166210917531206e-01   +5.221007810067163e-02   +8.922539296870241e-02];
L3I_L3E_iAMPA_netcon = [-1.651331112417175e-01   +1.143968582331831e-01   -3.202543700124764e-01   -1.602415275965915e-01   +3.855199393580877e-02   +9.645156377665706e-02   -3.932071338801974e-01   +7.175896093344442e-02   +1.005499017238082e-01   +2.389716048688302e-02   +1.239021497031121e-01   +8.566015174466146e-02; -1.911992012386629e-01   -6.278637373066719e-02   +3.786971271502285e-01   +1.032856356525966e-01   +2.725140505108852e-01   +2.078535359948075e-01   -1.722867587545377e-01   +2.618720581532504e-01   +2.065339123696122e-01   +2.952771038753951e-01   +2.054373563712831e-01   -5.409294958600071e-02; +1.096225305462414e-01   -6.950193805776241e-02   -2.282092321904194e-01   +3.052923792727875e-01   -1.949707485279655e-01   -1.696590801139745e-01   -1.572595104650565e-01   +1.976880256795283e-01   +8.638959042733994e-02   -1.471075420007764e-01   -8.553526317921707e-02   +2.023287916517274e-01; +5.199383513545747e-01   +1.740573506077470e-01   +7.172090769926470e-02   +3.984402535490622e-01   +5.186036660629636e-01   -1.434731841399835e-01   -2.040250889117060e-01   +1.944888070797589e-01   +2.862907268947176e-01   +4.928440646568492e-02   -3.123465235698296e-02   -1.142633536520421e-01; +2.407670685929933e-01   +2.373201340579748e-01   +1.969450109498485e-01   +2.634751767594823e-01   -9.083629985215215e-02   +5.444370811292272e-01   +6.456392880957615e-02   -2.796651085658820e-02   +6.950429817816765e-02   +2.253744385966716e-01   +5.363856859847840e-02   -1.086336355748128e-01; +1.278568591725662e-01   +2.790704365582949e-01   -3.321825543893204e-01   +3.803023005186740e-01   -9.184943259994548e-03   -2.652207424996674e-01   +1.130125467505064e-01   -2.704528526475415e-02   +1.164476325134984e-01   +2.582464266780500e-01   +2.075978274870318e-01   +1.676037578236408e-01; +2.200718877869266e-01   +1.471855988844187e-01   +3.053994878798376e-01   +3.717281450345832e-02   +2.984377927474681e-01   +3.288024204625425e-02   -9.035419460669239e-02   +1.263369775747080e-01   -8.250396244495469e-03   +1.757998104679081e-01   -1.690408705368971e-02   -1.305663239580526e-01; -9.275161217421748e-02   +1.311576751088965e-01   +1.663160463721359e-01   -2.103141307227746e-02   +7.559829992930986e-02   +1.544248515250905e-01   -1.383931509885865e-02   -2.581422395031783e-01   -5.765798565239838e-02   +2.884298235536295e-01   +8.073802232601181e-02   +1.626345930231428e-01; +6.483163759703159e-02   +3.798213375818860e-01   +3.771214079395611e-01   +2.198667219490810e-02   -1.935248114814214e-02   +2.600786447202730e-01   +2.380321559729141e-01   -1.098208006102677e-01   +2.393789953353982e-01   -8.655315421088025e-02   -1.132570264484644e-01   -2.243538960508069e-02; +5.081782277508797e-02   -1.948657517487569e-01   +1.367808899759933e-01   -2.860745695780533e-01   -1.763134000122873e-01   -4.327032678330380e-01   -1.039046591560718e-01   +4.428657060048080e-02   +2.394749450081209e-01   +5.885494141761315e-02   +2.806230892764957e-01   +3.290737766018211e-01; -1.753782864554882e-02   -1.069852654128479e-01   +9.071254832096910e-02   +2.885522915986480e-01   +1.009611036276867e-01   +2.404254970830292e-01   -1.328408169671483e-01   +6.647569781291766e-02   -2.582065888724807e-01   +6.995415314698580e-02   +2.391277648378269e-01   -8.068079346624182e-02; +2.126958891844780e-02   +4.011186593774281e-01   -4.183539741909680e-01   -1.084243864338147e-01   -6.782724559260209e-02   +1.591696037896976e-01   -3.631665227813791e-01   +1.600011728734108e-01   +3.177990278644069e-01   -1.808229917992866e-01   +6.767145901888304e-02   +4.655562500028906e-01];
L3E_L3I_iGABA_netcon = [+3.456685835301452e-01   +3.851493761208519e-01   -1.162955100077644e-01   -9.655416386409701e-02   -9.193696409910274e-04   +1.566749855288918e-01   +1.963064013400734e-01   +1.312790672535989e-01   -2.807861267233506e-01   +1.822334403786853e-01   -3.145211891644568e-01   +2.224249276645552e-01; +3.587584488827948e-01   +2.220857107795575e-01   +2.735768604660040e-02   +2.055097262265322e-01   +2.788658076988446e-01   -3.490791334205125e-01   +1.660150879899585e-01   -3.462538658283233e-02   +5.397206238891572e-01   +3.431336856139485e-01   +5.275818776716092e-01   -6.426516639875245e-02; -1.483204628559215e-01   -1.262694473220198e-01   -1.448637700909959e-01   -1.702371897254144e-01   -7.676989896137647e-02   +2.598675188104482e-01   -6.546028631648632e-02   -1.530202153513602e-01   +3.082035294995832e-01   -2.002379487074048e-01   +8.361968971182993e-02   -3.232240403920803e-01; +9.975805379190637e-02   +1.954109201264965e-01   -1.622768577041984e-01   -2.734160766102863e-01   +3.852231332856452e-01   +3.355572686787813e-01   -3.045125293103508e-01   -1.536536049708285e-01   -1.719019545059389e-03   -2.270496223953633e-01   -7.599087604882052e-03   -1.555781176350914e-01; -1.657350912694163e-01   +3.450839195728892e-02   +5.984429691683003e-02   +1.745553332072692e-01   +8.049993845441737e-02   -6.274338038852607e-02   +5.811995409237869e-02   +4.722954950676102e-02   -4.505796856118922e-02   +1.606987337825816e-01   +2.109247781362209e-01   +2.399436233945479e-01; +5.582752357069906e-01   +8.842962443131451e-02   -3.114013724668198e-01   -2.185444274906210e-01   +1.305327966544354e-01   +9.874228618296947e-02   +2.240574235527625e-02   -4.171930133592062e-02   +2.934643346046431e-01   -6.413904324053350e-02   +1.905306541720818e-01   -2.546133642447558e-01; -7.010871205169728e-02   -2.860870291611053e-01   -2.757067216992586e-01   -2.163716661145722e-01   +7.645560418537314e-02   -3.918477085247163e-02   -1.458392206103871e-01   -1.175300478465618e-01   -2.500904631591841e-01   -1.423214500880750e-01   -1.061232672008704e-01   +1.411602235791394e-01; +3.400145666762372e-01   +1.768625847373628e-01   +5.507923056936832e-02   +1.607409534860885e-01   +2.863448122452122e-01   +1.285918723247499e-01   +3.387444758460973e-01   -1.691854318753432e-02   -5.488456884338969e-01   -1.055595436979774e-01   +1.707578890444802e-01   +2.191640602450385e-01; -2.564925942956273e-01   +3.550009608702571e-01   -4.764870346344584e-03   -4.887863746428021e-02   +1.131133567444570e-01   +3.367862015012328e-02   +1.968583891425015e-01   +1.904107348845981e-01   -1.909766877539103e-02   +1.487802302757418e-01   +2.293483298080701e-01   +9.923095208656926e-02; +1.096425115123946e-01   +1.986053638904070e-01   +4.816864231738527e-01   +8.033147627745087e-02   -9.154138737957304e-02   -6.329789372358048e-02   +3.312429370644596e-01   -3.667537378533296e-01   -2.389730655661141e-01   +1.442534217815576e-01   -2.278469957327716e-01   +3.797879189951762e-01; -1.947806569808916e-01   +1.108086088352870e-01   +3.561160138576919e-01   +3.032940203970950e-02   -3.608903639270360e-01   -8.610963073285553e-02   -3.299485415328199e-02   -7.980410110193506e-02   -1.430466887328907e-01   +1.470395551194598e-01   -2.755553900237705e-01   +1.178191776311596e-01; +1.851095563564509e-01   +1.582101974165049e-01   -2.110954210001339e-01   -4.040589644195184e-01   -1.858244855476123e-01   +1.160664548315236e-01   +1.870261049229407e-01   -3.218264657706423e-01   +1.153610866702028e-01   -1.231095581782287e-01   -1.336023024681635e-02   -3.929578912836135e-02];
L2E_Input1_iAMPA_netcon = [-1.486159712543582e-01   -1.354025643670495e-01   +9.596656705565254e-04   +2.587820224103984e-01   +1.478665206892240e-01   -1.793319642226326e-01   +1.394845310137947e-01   +3.408168129831378e-01];
L2I_Input2_iAMPA_netcon = [-5.405976251889689e-02   +3.254398624904679e-02   -5.788747342873063e-01   -5.509064075018530e-02   -5.841166198164199e-02   +6.215899996532000e-03   -5.063085242858499e-02   +1.717927538212835e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.5*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.5*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
