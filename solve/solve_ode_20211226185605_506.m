function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.433198424603499e-01   +5.677734986880659e-02   -6.026053792098407e-02   +1.449872215749967e-01   +2.298755402332112e-01   +1.020096175009287e-01   +1.655083611241548e-01   -7.581289866805717e-03   -3.118311238630402e-02   -2.931408690761158e-03   +2.788227390227279e-01   +1.748045721460410e-02   +1.872070103579898e-01   +2.344672512261413e-01   +1.487394582832147e-01   +8.220294276973208e-02; +2.426754000416839e-01   +1.130142774002394e-01   +9.068928070061211e-02   +1.745987790045307e-01   +8.461408004443838e-02   +7.293946219109987e-02   +1.903232207062994e-01   +1.811385005456800e-02   -1.916492249516828e-02   +3.757615407785631e-02   +7.706187970160894e-02   +9.266334844036130e-02   -6.267495386156824e-02   +2.578148766233271e-01   -2.656932880923439e-02   +2.212362813518756e-01; +1.986484117228490e-01   -1.373626589296323e-03   +2.474174221530658e-01   +1.135768487483857e-01   +2.172234363209166e-01   +1.252248344075070e-02   +2.424558631472581e-01   +3.537566417957989e-02   +1.388749884321076e-01   -3.445055138703566e-02   +4.216837938661330e-02   +2.136570542078366e-01   +5.161581822308772e-02   -1.351963547380369e-02   +1.981443222654726e-01   +5.131486086892269e-02; +1.435005788669636e-01   +8.088266875736536e-02   +3.132758312837311e-02   +1.544456934734762e-01   -1.586707170100716e-02   +2.357178039340897e-01   +1.767346550973152e-01   +1.106391112684303e-01   +2.023498419366907e-01   +1.192133722098947e-02   +1.469984371463980e-01   +1.524855165721094e-01   +1.825731164315208e-01   +2.226036211684491e-01   -3.659397244787860e-02   +5.775875793123545e-02; +4.590694983058107e-02   +1.914725088447206e-01   +4.885605100790481e-02   +6.762031869434798e-02   -5.933677923930580e-03   +1.044798741797747e-01   +9.331293778502328e-02   +1.342272044039078e-02   +1.914299727139484e-01   +1.303004149561401e-01   +5.312373322588425e-02   +2.370189502874038e-01   +1.203247497736323e-01   +1.721542374545452e-01   +8.529951505671260e-02   +1.633728689651331e-01; -2.385244860833428e-02   +8.838001402878065e-02   +1.231187056528366e-01   -7.242602374289413e-02   +2.517345089389381e-01   +2.110977873290422e-01   +1.290648029893231e-01   +1.921294439888213e-01   +1.019518787894270e-01   +6.976518487303615e-03   +1.053231445444694e-01   +8.715157722318177e-02   +1.169747493755211e-01   +1.358021046994077e-01   +1.131704868136097e-01   +2.915427899340946e-01; +2.341921338102741e-01   +6.348852208143341e-02   +1.936362511030099e-01   +1.730776832074509e-01   +1.212759765238093e-01   +2.560447133220368e-01   +1.615632048172510e-01   +1.009513920565600e-02   +1.015394536136196e-01   +2.244166808744922e-01   +3.023815721922283e-02   +5.913420610436627e-02   +1.493085441129888e-01   +4.695212466088303e-02   +1.732232131798823e-01   -1.243702385205394e-02; +4.135129470334453e-02   +1.747193160946686e-01   +1.038063648517482e-01   +1.295544621534570e-01   +1.405016615229130e-01   +2.017151461645492e-01   +1.397395289056510e-01   +9.926872529519876e-02   +2.205305951624312e-01   +7.138840832483129e-02   -1.233407374036675e-03   +1.494328362284148e-01   +1.233723915587662e-01   +5.686554435662639e-02   +8.184581268306641e-02   +5.447701074172047e-02; +2.182496165624964e-01   +2.113589234654494e-01   +9.301503312489925e-02   +3.123318267323510e-01   +5.633139299451686e-02   +3.724628767485855e-02   -6.559098619276227e-02   +3.862013525366418e-02   +1.281159494975308e-01   +1.475432102234825e-02   +6.645849282442855e-02   +1.051920309057147e-01   -3.542461964985705e-02   +2.404794482844418e-01   +9.761619834258571e-02   +1.319057563695486e-01; -7.269388760599324e-02   -1.544475983848824e-02   +2.181441565740421e-01   -7.241408371196381e-02   +1.685479751624412e-01   +2.147674240234074e-01   -1.313598955544401e-02   +1.364504574237693e-01   +9.121740906353883e-02   +1.149408738337637e-01   +2.228931826537527e-01   +5.698219288953997e-02   +6.530515413754971e-02   +8.388358545586397e-02   +8.444357277457343e-02   +1.394561056703447e-01; +1.295940811083263e-01   +4.881525451004189e-02   +9.340882763320457e-02   +1.640352558411791e-01   +1.637791149314833e-01   -1.591985742906347e-02   +1.553169387872468e-01   +1.804204291184525e-01   -3.250621064905582e-02   +1.175612465980336e-01   +3.104919002686357e-02   +2.093652796326754e-01   +1.363723970921855e-01   +1.081876192892986e-01   -2.147993667742501e-03   +1.091564548734171e-01; +9.183287527822094e-02   +8.997685502700364e-02   +1.397644973048941e-01   +5.085114227599826e-02   +1.935040498728343e-01   +1.120990930653971e-01   +1.096337493593826e-01   -9.087816525656637e-03   +2.059174623146389e-01   +1.399879302988863e-02   +1.881105500603967e-01   +1.266047038371760e-01   -1.485555170206776e-02   -4.553563239404853e-02   +1.694788743915427e-01   +1.159719865636544e-01; +2.272966879777840e-01   +1.534928377956953e-01   +9.617305274471050e-02   +6.622121865196184e-02   -7.227432254749369e-02   +1.738754614935450e-02   +1.023567476971805e-01   +1.135415673560102e-01   +9.876439885477115e-02   +4.089228048920596e-02   +1.274069567050896e-01   +5.855115511500437e-02   -3.082968380310990e-02   +7.921600126051678e-02   +2.559088569354830e-01   +1.141690208775605e-01; +8.163233313591380e-02   +5.326467822963737e-02   +1.098844362557002e-01   +1.433392448318294e-01   +3.020709933024850e-02   +1.021987537644170e-01   +2.538066787219455e-01   +2.601366037450631e-01   +2.408599928407983e-02   +8.505771172319714e-02   +2.318234999328055e-01   -3.644240910588313e-03   +8.590036340688581e-02   +6.027202540887557e-02   +1.372954606324689e-01   +1.736828051790518e-01; +1.279002127020153e-01   +1.498756949764789e-01   +8.014129660026466e-02   +1.847207131704732e-01   +7.419641075243283e-02   +8.242759685238056e-03   +1.819744307496786e-01   +1.867918310674209e-01   +4.314509454905358e-02   +9.802436211693454e-02   +4.476476204495956e-02   +3.423397413452156e-02   +1.260785412931955e-01   +1.496187323460290e-01   +1.972207624518538e-01   +1.218700378211000e-01; +8.365686199678075e-02   +1.000218663030173e-01   +5.332286607253273e-02   +2.138188647758496e-01   +2.927404872524840e-01   +1.071024714477848e-01   +1.982343266339173e-02   +1.659639984739640e-02   +5.355271815202900e-02   -5.357564801239588e-02   +9.407661569277818e-02   +1.665554198287525e-01   +2.336103381372257e-01   +6.272288272882276e-02   +1.235847556884604e-01   +1.240072188174020e-01];
L1E_L1I_iGABA_netcon = [+8.529761034172514e-02   +9.097849926306266e-03   +8.030915731543235e-02   +1.049867320775577e-01   +1.149594246998105e-01   +1.326438752226525e-01   +9.215251184092506e-02   +1.796786634692252e-01   -5.848465457651059e-02   +1.797037225520827e-01   -2.658843251286063e-02   +1.203206544450031e-02   +2.263146409372163e-01   +1.158758016324988e-01   +2.313579735240284e-02   +1.659771814831648e-01; +1.108042523894969e-01   -6.232611739795883e-02   +6.670200820604226e-02   +1.399935689409121e-01   +1.063521248483205e-02   +1.093374409877498e-01   +8.372948981400655e-02   +9.226911749830868e-02   +1.601543790193087e-01   +1.269635250717523e-01   +1.679261469510271e-01   +4.378630019798025e-02   +5.547858384930829e-02   +1.746496268330488e-01   +1.673148371658434e-01   +9.729357192626692e-02; +5.570407784096713e-02   +1.863163507946085e-01   +9.368201524743761e-02   +2.056040133611979e-01   +1.278494634575496e-01   +1.067762807642610e-01   +3.485013938553268e-02   +2.181560422210403e-02   +1.011260095850164e-01   +1.727827133596668e-01   +1.025195211012136e-01   +9.343297529309694e-02   +2.090181097160965e-01   +4.011248670279650e-02   -3.582455756056676e-02   +1.561000537698107e-02; +6.264810210303756e-02   +1.111086065657634e-01   +3.522271726410136e-02   +3.339802875057429e-02   +1.849248989147570e-01   +4.489600361223194e-02   +2.104888423804311e-01   +2.270514579944697e-01   +9.485980693207401e-02   -1.811226798315847e-02   +1.588673356453079e-02   -3.032224449976027e-02   +1.414358844302573e-02   +2.125709998159118e-01   +1.319416335989258e-01   +1.854139883487826e-01; +2.725474265642510e-01   +2.168133066950065e-02   +1.002486625706697e-01   +5.303644785406967e-02   +1.600815183701511e-01   +5.453426754734955e-02   -1.052904464419032e-01   +8.029453076880480e-03   +4.611694013886501e-02   +1.488788044558339e-01   -3.358075521161209e-02   +1.049104084759618e-01   +2.185794783697090e-01   +4.180595879302775e-02   +9.859863112943434e-02   -1.369068426140067e-02; +7.743672900484480e-02   +1.795541125750547e-01   +9.440848608601046e-02   +8.119123120834862e-02   +2.251572783184356e-02   +1.063468324703372e-01   +1.514918900612128e-01   +1.355516189071359e-01   +8.688406915715190e-02   +1.301320903648664e-01   +1.379043061666859e-01   +1.986965747685720e-01   +1.927337799968329e-02   +1.114445380723036e-01   +5.541413285659294e-02   +2.036734117250936e-01; +7.701634651518742e-02   +1.275768231602815e-02   +1.148946905748392e-01   +2.251270446532548e-01   +2.083411777203110e-01   +1.077569957805222e-01   +9.065070312726775e-02   +1.821626001439524e-01   +5.348836525831026e-02   +1.020204583180570e-01   +1.096233875109167e-01   +4.264517735822958e-02   +1.516947110267006e-01   +1.096578162839959e-01   +3.400675156498270e-02   +6.736289613051230e-02; -1.797889502732860e-02   +1.515562484371478e-01   +4.764768325269569e-02   +1.919131541698316e-02   +2.626178150678233e-02   +1.474995981902621e-01   +1.946219733457133e-01   +7.295136866827256e-02   +8.175118426247757e-02   +1.030741392985483e-01   +1.879299856103425e-02   +9.290376162231020e-02   +6.963035451482368e-02   -1.048841629095613e-02   -1.069746805257325e-02   +3.822787585375308e-02; +8.679928983752178e-02   +1.889140061638073e-01   +5.689616038005294e-02   +1.306885445470657e-01   +5.773088959472742e-02   +1.676360400249073e-01   +2.307293070706499e-01   +1.414991324933672e-01   +1.073706213756987e-01   +6.318952468096109e-02   +2.201982646191185e-01   +3.094562378885327e-02   +6.301420996206204e-02   +3.146045665206507e-02   +1.650263882654526e-01   +2.300331837010145e-01; +3.859143554662854e-02   -1.078293715492231e-01   +1.607756511590859e-01   +9.398524985911229e-02   +3.064710618238952e-02   +1.134269141383853e-01   +8.569247029174033e-02   +1.634483658483303e-01   +9.464449131980156e-03   +2.298185336433010e-01   +4.012153820648964e-02   -6.232446420446156e-03   +1.344729436268776e-01   +8.120363580046142e-02   +7.331986246967998e-02   +1.447648690479747e-01; +1.534154581762510e-01   +9.038618708488304e-02   -5.956838710815945e-02   +1.196282367138161e-01   +7.585832744361415e-02   +1.988919696103358e-01   +7.212784510285832e-02   +2.899211228778301e-01   +1.722212268726873e-01   +2.302389610861624e-01   +1.528791273195805e-01   +2.609734382116778e-01   +2.046851872554619e-01   +5.472436646757677e-02   +2.444820675267963e-01   +1.444825514428843e-01; -7.136957666039325e-04   +1.965584902825649e-01   +1.867119929147779e-01   -5.712913248145815e-02   -8.119342640767076e-02   +1.395809622011950e-01   +1.251246138760150e-01   +1.704979303169428e-01   +7.132097947899016e-02   +4.787241980103232e-04   -4.836735110446632e-02   +1.036196774261290e-01   +1.657613641023313e-01   +1.291418917203316e-01   +3.343336457839750e-02   +7.098210790506776e-02; +4.186084449883502e-02   +2.715408110245275e-01   +1.041142801527114e-01   -7.792712889545746e-02   -3.543464536352982e-02   +1.566089999607557e-01   +1.263401368429593e-01   +1.962610115424587e-01   +7.978611841517766e-02   +7.472322552455575e-02   +9.420955198862757e-02   +1.328753267834168e-01   +1.324876917116136e-01   +1.806111991198499e-01   -4.737241625834308e-03   +1.651573258674734e-02; +1.900192008103735e-01   +3.846156152817858e-02   +1.209189135400803e-01   +5.322231013295468e-02   +1.042269054965750e-01   +3.575455380645817e-02   +2.329247202936750e-01   -3.060566834521817e-02   +1.660422049421716e-01   +2.195413772862072e-01   +1.111668284539141e-01   +1.391783704043792e-01   -7.887665240978720e-02   +1.090964718660740e-01   +1.767363961638260e-01   +1.038159947609531e-01; +1.249283012004949e-01   +2.857766359051498e-02   +7.385629090473896e-02   +2.897332761668177e-02   +9.521824440613869e-02   +8.431252153912391e-02   -9.575038689558666e-03   +2.541953534975850e-02   -3.151274784798212e-02   +1.092503337928711e-01   +9.135353167612195e-02   +1.641018059332595e-02   +1.639569873955312e-01   +2.135098443046809e-01   +2.896458530677091e-02   +2.344947135445786e-01; +1.283665172606602e-01   +1.760778366060471e-03   +5.913018829526943e-02   +4.239420915555167e-03   +7.719142980890088e-02   +2.362776882107789e-01   +1.231172823707431e-01   -9.621808650896013e-03   +3.161409688147985e-02   +2.152365849218399e-01   +5.410316506254007e-02   +1.707046841538130e-02   -3.193286013799350e-02   +2.320407372542951e-01   +2.032797066519007e-01   +3.709648492658343e-02];
L2I_L1I_iGABA_netcon = [+1.041453164297345e-01   +9.630425921502012e-02   +1.495903494463593e-01   +9.533675930450888e-02   +1.871512669230182e-02   +1.152186387059426e-01   -1.334020947926001e-02   +1.818475507630361e-01; +1.985308543669739e-01   +1.074990888388859e-01   +5.391335127647240e-02   -2.933023756118891e-02   +1.448546517089500e-01   +2.284258867943064e-01   +1.597570342189489e-01   +9.567763659665876e-02; +8.495245755441701e-02   +1.038396217887534e-01   +1.111319853189804e-01   +5.872561418207702e-02   +1.551955010018429e-01   +4.001534909486543e-03   +1.574620358927311e-01   +1.668524962716559e-01; +7.635097169353361e-02   +1.059848746869062e-01   +1.240166142825718e-02   +2.192933802084332e-02   +6.047159259783468e-02   +1.645522334285740e-01   +2.081642790580430e-01   +2.510438638721034e-01; +9.097702934639193e-03   +2.967308447037872e-02   +1.938114092783534e-01   -7.881687243125940e-02   +2.755534450394161e-02   +1.861132588337202e-01   +1.996813791179230e-01   +2.268516285585485e-01; +6.872401321348676e-02   +1.619534181124361e-01   +2.291608535128104e-01   +1.650695262178011e-01   +8.463617687730844e-02   +1.264336269650878e-01   +9.449565340629620e-02   +1.325730196832952e-01; +2.979931908306139e-01   +6.165956910638660e-02   +5.725890334628410e-02   +6.747678549643618e-02   -6.299818972275779e-02   +2.865095520840405e-01   +9.744533025210461e-02   +2.195520974145950e-01; +9.481802390223054e-02   +2.242205568868337e-01   +6.331156616407893e-03   +1.881700128519126e-01   +1.738589811786294e-01   +1.190723921402421e-01   +1.805068882374087e-01   +4.900933540159219e-02; +3.891419580541237e-02   +4.816323847402411e-02   +2.498122464196763e-01   +1.792903966255508e-01   +1.137794841299630e-01   +1.062156290822752e-01   +1.808293798897750e-02   +1.521091660803023e-01; +1.573087954274081e-01   +1.294882813874321e-01   +3.288643965941082e-02   +4.007535681501660e-02   +2.491655892431256e-01   +1.443536048659032e-01   +7.091660545562875e-02   +1.724773140932589e-01; -3.065125610670149e-02   +4.656639151787494e-02   +1.616046124534395e-01   +1.163356119990458e-03   +1.252354439721655e-01   +7.876918662562958e-02   +2.244254944908021e-01   +5.483281537405001e-02; +4.397254608131471e-02   +1.230474922854992e-01   +6.317462469545304e-02   +4.402539963629543e-02   +1.569391775242210e-01   -1.242984040490107e-02   +1.955376820125648e-01   +1.832332525517434e-01; +9.343841504213657e-02   +5.437920097477837e-02   +6.729314375984868e-02   +1.668398018367526e-01   +1.256191773945233e-01   +1.524176069896332e-01   +8.560635196916284e-02   +3.101467081673985e-02; +9.706034740019989e-02   +2.541697321881612e-01   +5.477824365326639e-02   +6.298372837741205e-02   +5.755120004837284e-02   +1.207954062957625e-01   +2.108492304257767e-01   +7.743622650287890e-02; -2.270838608648268e-02   +1.373572127129109e-01   +8.785984042678903e-02   +6.496639248628967e-02   +6.535517349705475e-02   +1.080392222870426e-01   +1.533552932463233e-01   +2.207581211712125e-01; +2.863730516066648e-01   +2.828878616386715e-02   +6.819398781364508e-02   +2.622465576647246e-01   +2.603601331987969e-01   +2.079688717466650e-01   +1.423562226044703e-01   +2.357278295132692e-01];
L1I_L2I_iGABA_netcon = [+1.799475924803428e-01   +1.181603099690626e-01   -4.353129881858881e-02   +9.363973232415332e-02   +1.526636766596096e-01   +6.598529635884248e-02   +1.549654503971169e-01   +2.930225396496256e-02   +5.430748540731681e-02   +2.686196060180343e-01   +1.962947004802803e-01   +5.130852123713286e-02   -3.828248805316273e-02   +1.486389818404920e-01   +1.175316088265651e-01   -1.397945144143822e-01; +2.120294297450020e-01   +1.831704071373797e-01   +6.701440307794826e-02   +1.408813745628809e-01   +1.276672028346352e-02   +2.484514724584875e-01   +5.049909790109928e-02   +2.580301726746111e-01   +2.029883079582259e-01   +2.547205901649238e-01   +7.054123274087513e-02   +5.796745830788499e-03   +2.073142578852213e-01   +2.202330015568372e-01   +2.344281593520123e-01   -2.177331045181286e-02; +2.846389889795656e-02   +1.135384588227108e-01   +3.194715436493385e-02   +1.124729824733636e-02   +1.898199884818440e-01   +1.991083951571155e-01   +1.141054369567825e-01   +1.475320961781850e-01   +6.961898465784946e-02   +7.530966996194703e-02   +9.476131815528003e-03   +5.977538354747244e-02   +1.724498937690583e-01   +2.675661355930136e-01   +4.915182103353431e-02   +3.565663586484722e-02; +1.522865202537462e-01   +1.748945068951036e-01   +2.198039082873539e-01   +1.369752347386516e-01   +9.704609221765594e-02   +2.980757886928111e-01   +8.575574478812219e-02   +1.251098387510825e-01   +2.471336661936122e-01   +1.550225668164390e-01   +3.045451294250399e-01   -3.927517336905739e-02   +1.090443598503474e-01   +1.208669552448499e-01   +3.852670673599257e-02   +5.286505089560666e-02; +1.593268278096337e-01   -3.423202335656941e-02   +1.301702037739579e-01   +7.534240966381525e-02   +5.803977654358410e-03   +8.773839838215178e-02   +2.732319857556571e-01   +1.559226411866178e-02   +9.167020267514038e-02   +1.053802430581126e-01   +8.503654975374964e-02   +9.816183693700592e-02   +1.413973711383812e-02   +8.228400531495889e-02   +4.792026867823963e-02   -3.720099540894428e-02; +3.175135771986272e-02   +7.488723673725228e-02   -3.355467149461935e-02   +7.088496839427927e-02   +2.343305947865122e-01   +2.276532557376403e-01   +3.042800542432897e-02   +2.529114714867069e-02   +1.171647750664605e-01   +4.886941304376448e-02   +3.149777870552195e-02   +1.186431644640165e-01   +1.384985262183493e-01   +1.640263907725043e-01   +1.813046197048660e-01   -4.946304312602767e-02; +2.071511615204780e-01   +2.046881785949306e-01   +1.333112509791119e-02   -7.517794081747640e-02   +4.374871839507983e-02   +1.380206163285388e-01   +3.934882419346205e-02   +5.532401642789245e-02   +1.163856326830337e-01   +4.194513512239113e-02   +2.135840719639142e-01   +8.998335230939668e-02   +2.309358706054247e-02   +8.954326716489060e-02   +3.399025472521847e-02   +1.773519186050249e-01; +1.759425949010650e-01   +8.545755815188119e-02   +1.915095637104477e-02   +8.818110266393359e-02   +2.455162160158787e-01   +8.617045049450699e-02   +1.324583601106319e-01   +1.816726787952652e-01   +2.514554558515419e-01   +7.387727653587386e-02   +4.882413688119781e-02   +1.317628262851158e-01   +1.129911357083045e-01   +1.919863783011290e-01   +1.934163202321690e-01   +7.389102047515082e-02];
L2E_L1E_iAMPA_netcon = [-7.383475729760695e-03   +1.976181306290119e-01   +1.626748188220617e-01   +9.498299131399274e-02   +2.756745790654423e-02   +1.076454564244555e-01   +1.177161971487394e-01   -5.376697593342592e-02; -1.967756848769895e-02   -6.365433716548151e-03   +5.147045343203843e-02   +2.915017667338406e-01   +1.386692007560325e-01   +5.100997963958587e-02   +1.618510937697955e-01   +2.926220713109616e-01; +2.479459610098298e-02   -6.403150014621080e-02   +2.927246231689500e-01   +1.329314418264739e-01   +1.165888421288299e-01   +1.176552830846284e-01   +2.215427658041737e-01   +6.324833744039669e-02; +3.893884356331256e-02   +1.539646334312638e-01   +9.393483665596525e-02   +7.027604703326334e-02   +1.919370893274552e-01   +1.215541633355707e-01   +2.041162163981782e-01   +1.748144156300458e-02; +2.325023586636892e-01   +1.503904654541938e-01   +1.684604172756737e-01   +1.860373726544304e-01   -3.644763293514560e-02   -2.811933586921781e-02   +1.131908245730289e-02   +2.812946046868551e-01; +2.626530993354467e-01   +2.566587690116511e-01   +6.675394462547081e-02   +7.436242089933792e-02   +1.530769314472022e-01   +1.824581636159113e-01   +1.010946513315921e-01   +1.531907458998090e-01; +6.163534379276629e-02   +1.837921874303857e-01   +9.328407545499898e-02   +1.502303566999645e-01   +1.184793821048701e-01   +2.261892668080312e-01   +3.072204801612919e-01   -4.486243877609299e-02; +9.556535921714364e-02   +5.892980620954402e-04   +6.379574737477493e-02   +2.581132686574222e-01   +1.509070551098262e-01   +7.317984264207981e-02   +3.628337954346875e-02   +8.696437360856418e-02; +3.107999690769760e-01   +6.985852617524908e-02   +1.563666185316361e-01   +1.788633928772650e-01   +8.632862642048357e-02   +1.138429765793327e-01   +9.106886911523522e-02   +1.630998059672256e-01; +1.528275282866806e-01   +9.573025545025959e-02   +1.784443545740473e-01   -9.287154753246051e-03   +2.352384514381127e-01   +3.469250616380401e-02   +1.321119586960090e-01   +6.345691882862348e-02; +2.829545102282886e-02   +1.640281155992726e-01   +9.349387187332249e-03   +5.473463434447393e-02   +3.145133558188534e-01   +2.366078813301397e-01   +4.608160081062293e-02   +8.476557572317461e-02; +1.679958348035085e-01   +6.558709284455187e-02   +5.768111730476122e-02   +1.103437466644845e-01   +4.371543818716248e-02   +5.556897002823787e-02   +1.644743268505516e-01   +1.265355769073700e-01; +2.274130788357961e-01   +7.599951337495266e-02   +1.534767836106439e-01   +1.875664273454192e-02   +1.466651656985251e-01   +1.971616874445391e-02   +1.522110012568480e-01   +1.009098835111283e-01; +1.805731696724112e-01   +1.916305830820559e-01   +1.549155159208456e-01   +7.335476186280140e-02   +1.195826271623697e-01   +2.261826552959889e-01   +1.627550667794629e-01   +1.029172966226890e-01; -2.590066734044905e-03   +1.491081942010393e-01   +3.313622606895894e-02   -1.097533095806596e-02   +1.046057434443602e-02   +2.356556932395713e-01   +5.414516687298523e-02   +1.146950761598131e-01; +8.931851964049639e-02   +1.738081404425454e-01   +1.048808054840819e-01   +8.006940958875181e-02   +8.819790746512518e-02   +7.907799766409995e-02   +7.267589698373489e-02   +1.148272216043394e-01];
L1E_L2E_iAMPA_netcon = [+1.293922472131177e-01   +1.147599981543455e-01   +9.122288994035442e-02   +5.134832742538729e-02   +1.357518420493850e-01   +2.165457153742662e-01   +1.039522077195115e-01   +2.938791577195038e-01   +4.015784394948078e-02   +1.720712865254693e-01   +8.417182843049432e-02   +1.092555297351481e-01   +1.032195762768765e-01   +6.816138637516184e-02   +1.670918579550050e-01   +9.377998571108404e-02; +1.694285544566203e-01   +3.081936778182762e-01   +1.171180229438534e-01   +2.197243969293856e-01   +1.138883812482407e-01   +2.018798279167737e-01   +1.384398395658256e-01   +3.643183801153140e-02   -1.198128069968695e-02   -6.346609451424703e-02   +1.023041773082705e-01   +1.271407623680558e-01   -2.309094904129479e-02   +3.147226690844118e-02   +2.685730637766158e-01   +1.390023411715206e-01; +3.938538302195426e-02   +2.979797590989933e-01   -1.480234689471676e-02   +9.845532389787794e-02   +4.437524332408833e-02   +1.585147447152255e-01   -1.003731107978215e-01   +1.884337287016398e-01   +1.253575539955965e-02   +1.289694002387772e-01   +1.328767460538643e-01   +1.608350886021331e-02   +1.336962605903114e-01   +1.601665077341858e-01   +1.712235231610776e-01   +2.085262909398278e-01; +1.808079742536214e-01   -6.322100820551263e-03   +1.570331930166649e-01   +6.821098418352801e-02   +1.939526910913526e-01   +5.012682513911984e-02   +1.558321773115093e-01   +1.909158722564037e-01   +1.499404665895557e-01   +3.014841355164444e-01   +1.527833886250562e-01   +5.616325032337931e-02   +1.890694064317092e-01   +1.121688222134602e-01   +1.188629661526975e-01   -2.804956995298109e-03; +1.112317060524729e-01   -6.482000546014922e-03   +7.517191290732106e-02   +1.643506897697072e-01   +1.346112784277846e-01   +1.170629296747509e-01   +1.130343192826601e-01   +2.949781970116046e-01   +4.704761013728730e-02   +1.389127207475389e-01   +1.919327308902376e-02   +1.800963577046627e-01   +1.966316664255759e-01   +1.883379103714698e-02   +9.001727222286948e-02   +2.019131426400203e-01; +1.631860418977799e-01   +2.424617412282037e-01   +1.529678626413331e-02   +2.551196156860734e-01   -2.252604041018896e-02   +1.147364027286234e-01   +1.652467103590642e-01   +1.677115865617685e-01   +1.425980852727928e-01   +1.018029717130904e-01   -8.184280933374882e-02   +5.715813241211289e-02   +2.544188656698283e-02   +1.190696368680800e-01   +1.703774777655663e-01   +5.101903716889186e-02; +2.029569905543021e-01   +1.151958339299043e-01   +5.886556437415293e-02   -1.017920992264209e-01   +2.401613571247430e-01   +2.314439509847323e-01   +1.274250623985578e-01   +1.916158197843919e-02   +2.371239811571828e-03   -1.401663549869762e-02   +2.475895763100120e-01   +4.450020504355126e-02   -7.240085460615672e-02   +7.417865487371161e-02   +1.292952633938562e-01   +6.859847219664886e-02; -4.804800109060078e-03   +1.004246412286195e-01   +1.288201162487575e-02   +1.116880358725127e-01   +7.968945424376750e-02   +2.352081625074071e-01   +1.833314911053422e-01   -3.510524550368802e-02   +1.911458972680537e-01   +1.067378300757292e-01   +1.291146097735050e-01   +2.309162039186988e-02   +1.903004856297514e-01   +8.566234768302075e-02   +1.868544439894128e-01   +2.099656363715878e-01];
L2I_L2E_iAMPA_netcon = [+2.205922555604443e-01   +7.676126018616504e-02   +1.850737942961132e-01   +1.381928802696290e-01   +2.026299897063073e-01   +3.480872569084062e-02   +5.291939537910013e-02   +3.454549636845240e-02; +2.161789322957602e-01   +9.412843976723106e-02   +6.573948423150132e-02   +1.100107959895950e-01   +2.234498137344308e-01   +3.525781816242440e-02   +1.420588548781316e-01   +1.143178679053428e-01; +2.020087691451565e-01   +2.330235315014210e-02   +1.352344341662239e-03   +9.832071232818450e-02   +1.415851676806158e-01   +1.280024381755839e-01   +9.989963128808377e-02   +1.992465417338900e-01; +7.552760509923447e-02   +1.518169973502844e-01   -7.460805345922818e-02   +4.321456507957498e-02   +2.310586987147154e-01   +2.038887446822515e-01   +4.169627728727850e-02   -5.291023828447585e-02; +9.595669889340737e-02   +9.868013762765376e-02   +6.813831310294989e-02   +5.383284629617975e-02   +1.178287532064954e-01   +6.833063016662191e-02   +2.422829958168324e-02   +1.110766816904143e-01; +1.912237965336262e-01   +1.496822101643875e-01   +5.544668093957116e-02   +8.857501124456389e-02   +2.027054101944498e-01   +2.096340240320665e-01   +1.859223016673734e-01   +3.186104172588061e-02; +2.877268560411348e-02   -1.161321000573941e-02   +2.060126034335623e-01   +8.443092614200436e-02   +1.057762314931252e-01   +1.591630156182796e-01   +2.281196601671541e-01   +2.531848171579335e-02; +1.927941382233666e-01   +2.961661732962466e-01   +1.362615823904011e-01   +7.225198256441426e-02   -4.336675162761847e-02   +4.430615388813542e-02   +1.241490865715882e-01   +2.054554458669294e-01];
L2E_L2I_iGABA_netcon = [+2.075882905060721e-01   +1.438683968486810e-01   +1.962537904990543e-01   +1.727772053367523e-01   -4.176919750163038e-02   +2.697226947805239e-01   +1.573191100312608e-01   -1.137620442745615e-02; +1.722274194939886e-01   +2.597681891697489e-01   +2.330833965942948e-01   +6.893719336331681e-02   +1.674152652790022e-01   +1.379653761573569e-01   +7.034476157540592e-02   -1.331096289886294e-01; +1.928888690743794e-01   +5.941126832285504e-02   +1.401774239262657e-01   +1.930071649534768e-01   +1.698543731102885e-01   +1.184872452422829e-01   +1.345395925239862e-01   +2.172716108867808e-01; -1.070077418698790e-01   +1.750661770499392e-01   +1.190349662567234e-01   +7.030952036989330e-02   +1.195360556504653e-01   +8.932420393527171e-02   +1.563322429673179e-01   +1.657541506835221e-01; +1.551915715810673e-01   +7.195138840653115e-02   +1.893402024811253e-01   +1.119577929969866e-01   +1.034937402375687e-01   +8.159001577440933e-02   +6.565568457128669e-02   +1.582510921351448e-01; -1.029700705019939e-01   +2.055851741545461e-02   +1.577054891463237e-01   +1.723157100704011e-01   +1.701536462304489e-01   +2.503990562673537e-01   +1.737859672535343e-01   +1.074884985557954e-01; +2.313788053061465e-01   -4.046555967453892e-02   +1.436116601209250e-01   +9.972773714441951e-02   +1.715827346523214e-01   -4.835110223850478e-02   +1.290419926150587e-01   +7.417717791014160e-02; -3.038798759980314e-02   -3.010530562111774e-02   +1.521344250693636e-01   +1.703945506422459e-01   +1.336296842716212e-01   +8.087603884262240e-02   -2.489451097563557e-02   +1.577393427954202e-01];
L3E_L2E_iAMPA_netcon = [+1.454156268256549e-01   +1.909943279594158e-01   +1.706285284333301e-01   +9.697335274223397e-02   +2.615992410619463e-01   +9.712897609759413e-02   +2.157243054703843e-01   +3.742438528190382e-02   +9.445073845203553e-02   -2.798974423876809e-02   +5.145609901257357e-02   +1.761182263166983e-01; -5.628595745742377e-03   +8.311224312469814e-02   +5.115641473974904e-02   +2.848735002114104e-02   +1.428583367638814e-01   +1.442521911959557e-02   +1.948001478900839e-01   -7.953558919985648e-02   +4.549129230974240e-02   +1.565155547627579e-01   +3.656587791603221e-02   +1.239081735228353e-01; -5.349549094230952e-02   -9.309729047056634e-02   +6.771779847140648e-02   +1.485970082384075e-02   -7.623658734125048e-02   +2.061793872617966e-02   +1.686450200520059e-01   +9.544233599775248e-02   +7.225818297493650e-02   +1.206359734346754e-01   +2.132689575747878e-01   +1.479986651776991e-01; +1.137350721682345e-01   +1.465728032261788e-01   +1.196755816882199e-01   +1.796404986416366e-01   +8.322318286177000e-02   +4.176783401042009e-02   +1.400490463392913e-01   +2.596023498340046e-01   +1.341907756845097e-01   +2.162707473306414e-01   +1.428864862182624e-01   +1.372570586524460e-01; +1.600781538694225e-01   +1.461043095369632e-01   +1.940610800725758e-01   +1.731349407902501e-01   +1.188425006053829e-01   +1.939520032617663e-01   -6.887209481378764e-02   -4.533722429084271e-02   -1.183692690205084e-02   +7.610670870573813e-02   +1.582706232079513e-01   +1.819070912721823e-01; +4.463788767010747e-02   +1.503553120579431e-01   +2.252165045075362e-02   +2.218497383760127e-01   +1.445372614609139e-01   +7.006414257354149e-02   +8.654120692520437e-02   +2.366577314191730e-01   +8.903924473517977e-02   +8.565384487591399e-02   +1.927555282944555e-01   +1.326974138899516e-02; +1.560735553891694e-01   +2.115794714374577e-01   +1.504458648292300e-01   -7.756454964622476e-02   +1.280222150916411e-01   -1.362794994446670e-02   +7.907679139907588e-03   +1.343541379369924e-01   +1.692325401254734e-01   +9.035015802549838e-02   +4.595635256903138e-02   +1.179258265432477e-01; +1.407005171813619e-01   +1.492123414319368e-01   +6.343668363510729e-02   +1.106396497387503e-01   +1.839139491863961e-01   +2.168152807974319e-01   +1.061648419176684e-01   +1.008829279206880e-01   +1.591599733396395e-01   +1.913838224755160e-01   +3.107794572971966e-02   +1.309123528831045e-01];
L3I_L2I_iGABA_netcon = [+7.485750202649880e-02   +7.681459989785575e-02   +1.725356897704554e-01   +1.045910802211329e-01   +2.079295911568603e-01   +2.330384168210715e-02   +1.711959952033162e-01   +2.688496568135374e-02   +3.935062312385321e-02   +1.007535053528152e-01   +4.979995780702815e-02   +2.228874987633370e-01; +1.391652290517471e-01   +6.047593470792732e-02   +5.198005854405913e-02   +8.487998462934798e-02   +1.075698896525735e-01   +1.331573626522016e-01   +5.897324975071912e-02   -2.413090585535310e-02   +8.692238536740063e-02   +1.370524028004410e-01   +1.017146193385902e-01   +1.440046100556663e-01; -4.336108954650936e-02   +5.724604878771304e-02   +9.213821087347814e-02   -2.052509081320614e-02   +1.946526230194031e-01   -5.269485641387552e-02   +8.670927756137554e-02   +1.772615336963132e-01   +1.222394455168012e-02   +9.685192311983871e-02   +6.785675817975025e-02   +2.398582340559531e-01; +1.241556664199548e-01   +1.169683062052062e-01   +2.486583499332505e-01   +1.511464416896854e-01   +7.573843100156359e-02   +1.941857008974056e-01   +8.069586204894590e-02   -5.500793032427585e-03   +1.848636140431081e-01   +7.441439417220830e-02   +1.467314160023950e-01   +1.377695937174665e-02; +4.156944680109122e-02   +8.276973166122494e-02   +9.896922188752794e-04   +2.578919461170724e-01   +8.993383534184900e-02   +9.732101293009955e-02   +1.506233088928226e-01   +5.249362756064128e-02   +2.406205479171456e-01   +9.433830985149108e-02   +1.111688160370125e-01   +7.400498855421511e-02; -2.224186716448655e-02   +1.789199634989879e-02   +1.845468646997007e-01   +1.401538212040684e-01   +1.124605688614341e-01   +1.095218266715165e-01   +6.679607133898516e-02   +1.013674067792199e-01   +2.045250358682870e-01   +1.260336149198704e-01   +1.298718633213960e-01   +7.670751741324094e-02; +1.460242271499752e-01   -3.626857708293267e-02   +1.332814850177944e-01   +1.173874133525755e-01   +1.362438092009687e-01   +6.733227676396827e-02   +2.250226126134402e-01   +1.663518690016299e-01   +6.093710979994769e-02   +1.094777743426117e-01   +1.953958850969261e-01   +6.716735853483626e-02; +1.230108411188877e-01   +1.345712288172455e-01   +5.901234268164480e-02   +1.069388396734065e-01   +4.373878036500570e-02   -5.622209433905105e-02   -1.539447469209546e-02   +9.497184198035077e-02   +5.368537142559290e-02   -1.203791909010552e-01   +1.045383237008202e-01   +5.670466807333362e-02];
L2E_L3E_iAMPA_netcon = [+1.180145329008100e-01   +2.891146932120381e-02   +1.727718883904683e-01   -6.653534000896630e-02   +1.488409192177188e-02   +1.718861917534774e-01   +6.880727612014370e-02   -4.974120549429355e-02; +7.497945468169800e-02   +1.759231270430671e-01   +2.889346224987363e-01   +4.434347679619818e-02   +2.486710745878605e-01   +1.193220574157494e-01   +1.325952282309622e-01   +2.027893224389008e-01; +1.830454967013286e-01   +1.755245115529154e-01   +1.608413677894694e-01   +6.236915161158431e-02   -5.560195761378002e-02   +1.843413461750506e-01   +1.529926413931895e-01   +2.454122998838915e-01; +6.597006961241172e-02   +9.652452740055122e-02   +4.788243468631159e-03   +1.388552089726484e-01   +7.297170927937573e-03   +2.328910422075965e-02   +1.521406912112724e-01   +2.573511686607979e-01; +1.643191411086712e-01   +6.728087079428581e-02   -5.680333052612709e-02   -5.347722906139592e-02   +7.748052017475413e-02   +1.010180421783496e-01   +1.270646381567205e-01   +2.282383952029878e-01; +9.180884187637260e-02   +2.286148325529107e-01   +2.083104294552235e-01   +1.113676539549644e-01   +1.123749726616411e-01   -7.777892609137629e-02   +1.602665210340188e-01   +4.596208274464352e-02; +1.431566794270526e-01   +1.023902440825905e-01   +1.323793569802435e-01   +5.319109247238516e-02   +6.536394996245953e-02   +7.991253234685082e-02   +1.229370070514187e-01   +7.869123161989335e-02; +1.309017526072205e-01   +1.251866598558009e-02   +3.152133402767846e-02   +7.510497616914635e-03   +4.647535508445420e-02   +1.453149845868229e-01   +1.399339426657207e-01   +1.054447543132209e-01; +1.958726311325701e-01   +1.219464188570815e-01   +1.415326717221662e-01   +2.331183330064241e-01   +1.709451419492363e-01   +1.463335342257120e-01   +2.356822605428059e-01   +1.166379705774576e-02; +2.044879987220463e-01   +2.115909843100414e-01   +8.739658076398998e-02   +1.844645212557826e-01   +1.446560095706643e-01   +7.576685451513680e-02   -1.294556548823658e-02   +1.071072940266485e-01; +1.266184916596624e-01   +1.049508610134792e-01   -9.809974557864504e-03   +5.906437535743130e-02   -3.495281675564279e-02   +1.688206402641395e-01   +1.745753979116009e-01   +1.722415398600645e-01; +2.366351637910421e-01   +2.297127703291075e-01   +9.799737169955210e-02   +1.234348229959639e-02   +1.836141276633023e-01   +1.965232883831437e-01   +1.296699773773471e-01   +1.718687571668573e-02];
L2I_L3I_iGABA_netcon = [+1.032005544400667e-01   +1.012551901585721e-01   +9.671823813478944e-02   +2.287607373542156e-01   +1.362031769719136e-02   +5.765886899663387e-02   +9.335217270069554e-02   -1.583067735682929e-02; +2.271913921288400e-01   +9.327445030201602e-02   +6.552426341992032e-02   +4.118445914618134e-02   +2.446833019898544e-01   +4.316714276461215e-02   +1.592315169922490e-02   +6.972355798158475e-02; +1.220328838007666e-01   +1.262789302722774e-02   -2.118494593106401e-02   +3.738759881492815e-02   +5.064113365675949e-02   +2.244626711104888e-01   +1.046655476702176e-01   +1.420916659378205e-01; +2.837087983986761e-02   +1.364595809803179e-01   +2.387576366663439e-01   +1.909508965774475e-01   -2.765482774492567e-02   +1.553568444377005e-01   +8.404364430163752e-02   +2.194083687987866e-01; +8.019688481187379e-02   +1.076884188652181e-02   +6.330921799622699e-02   +5.785315140860890e-02   +1.022115475260025e-01   +1.693615433256308e-01   -4.991227536479693e-02   +9.192094935194875e-02; -1.499015979324273e-02   +1.921490126841111e-01   +2.019527486884090e-01   -3.883479001261483e-02   +2.836719672014375e-02   +7.839003454833780e-02   +3.689218821402705e-02   +1.689435532012451e-01; -1.125740796302512e-02   +1.456954849147550e-01   +1.681778029318251e-01   +1.464762583277426e-01   +8.719732850072480e-02   +4.558969643517426e-02   +1.809683537600210e-01   +3.107475524715604e-02; +1.779254446031016e-01   +1.733582808438612e-02   +1.154086158073268e-02   +1.697351048726843e-01   -8.003796461309498e-03   +4.027588563664277e-02   +8.093054718923698e-02   +1.265458532247647e-01; +1.486687615780307e-01   -8.494761896806216e-03   +8.468994048955683e-02   +1.084230334055230e-01   -2.531800545329289e-03   +3.524599399697145e-02   +4.072826405965815e-02   +1.397796165103390e-01; +1.318314909175596e-01   +2.445616688840486e-02   +1.945654771756890e-01   +1.495086430080338e-01   +1.652783365876514e-01   +1.980665331614112e-01   +2.050193596623985e-01   +9.956303281976348e-02; +5.988747032026662e-02   -2.988952293886269e-02   +1.209319309248032e-01   +7.491004875093921e-02   +1.155453557667720e-01   +2.446494684812663e-02   -9.516581209065728e-02   +5.940935410338928e-02; +1.986136801023332e-01   +1.229678457150235e-01   -7.794916392110231e-02   +1.049164061645577e-01   +4.616884959877189e-02   +1.551877755207051e-01   +2.301112567896844e-01   +1.081782216335658e-01];
L3I_L3E_iAMPA_netcon = [+1.386033530328568e-01   +1.505181503012168e-01   +9.713544156005514e-02   +6.028458782057648e-02   +2.623743064811263e-01   +5.559751428731559e-02   +2.122291753939570e-01   +2.256656936651081e-01   +1.290352971098519e-01   -2.986976585791367e-02   +7.528124444180462e-02   +3.793168057856901e-02; +9.632367675812245e-02   +4.513516750800096e-02   +1.065428787572681e-01   +2.150777060525089e-01   +2.338988216066529e-01   +3.444577306512130e-02   +9.960951977948847e-02   +4.218761391200657e-02   +1.164734700288353e-01   +1.489675037490388e-01   +2.139791918191123e-01   +1.850745912839932e-01; +1.194963038248101e-01   +1.368116852370160e-01   +1.771843404472671e-02   +1.689377567356969e-01   +9.920688463626127e-03   +1.911382114466584e-01   +1.928545837048608e-01   +1.468618596922189e-01   -4.426488990771582e-03   -3.486870096610697e-02   +1.186377812271515e-01   +3.648267080156969e-02; +6.501924185896196e-02   +1.155860836820913e-01   +2.511032753605992e-01   -4.143484100339532e-02   +4.291648129989932e-02   +9.564070058062463e-02   +2.064208044578022e-01   +1.359197502514220e-01   +1.409741604535229e-01   +8.423620500720791e-02   -7.973189119076907e-03   +8.431446983679616e-02; +8.316005328557942e-02   +1.849091664022910e-01   +6.428395013647395e-02   +1.723183267516215e-01   +1.052842364792663e-01   +1.413104179196399e-01   +1.612676138099374e-01   +1.648719710954880e-01   +1.587976993474043e-01   +1.178510319813099e-01   +6.544969204190086e-02   +1.519831334554736e-01; +9.035564919124921e-02   +1.120797668451711e-01   +2.315921985884639e-01   +1.718112934873293e-01   +1.344130859231816e-01   +2.672313797124675e-02   +8.611385774622470e-02   +6.269657301720935e-02   +1.694301331395914e-02   -4.628377936666403e-04   +1.126562134505690e-01   +2.822867768383064e-02; +1.224025051189721e-01   +9.389121675479151e-02   -2.198540111068951e-02   +1.870826087840665e-01   +2.396367110334520e-01   +1.481005353999773e-01   +2.549122749104204e-02   -1.880594160141805e-02   +2.369274900189736e-01   +4.765950620374013e-02   +6.754925072795726e-02   +8.661932611667164e-02; -1.161780130885657e-02   -9.042657689845635e-03   +1.961898391891714e-01   +1.472271447273887e-01   +7.948230419418091e-02   +1.490367530194110e-01   +2.794968549300967e-02   -3.465516035581482e-02   +1.550700270430289e-01   +1.681980132600625e-01   +3.774232547983034e-02   +8.012871665508185e-02; +7.656435985467488e-02   +9.105858997923501e-02   -7.172347367905382e-02   +8.873058759245854e-02   +1.961272918957657e-01   +5.400496280376028e-02   +1.907341651888560e-01   +1.654787565391374e-01   +5.112042198218368e-02   +1.576488050236679e-01   -7.235973051246081e-02   +1.286147978596016e-01; +9.634443166403417e-02   -2.061642439460718e-02   -4.349840971209759e-02   +2.353546716072407e-02   +5.501840402582026e-02   +6.396207446506089e-02   +1.164205627410751e-01   +1.991452980520399e-02   -1.958655975413072e-03   +1.854556904755167e-01   +1.989312748258699e-01   -4.598412557120637e-02; +1.194589854837855e-01   +1.431877417416371e-01   -5.952030685682758e-03   +1.904567986075881e-01   +5.938229614172908e-02   +8.538333246026114e-02   +9.927644087511016e-02   +2.141502842372996e-01   +1.415972360221560e-01   +1.136825187860016e-01   +3.125339246870885e-02   +1.302449948164107e-01; +1.690040025335228e-02   +4.817725331594464e-02   +7.985189650672708e-02   -1.565882062165119e-02   +9.714587724890549e-02   +1.065944018649217e-01   +4.392709835424324e-02   +1.898064285294196e-01   +4.102793137963827e-02   +7.117573414162352e-03   +9.338736320025527e-02   +4.341154056384053e-02];
L3E_L3I_iGABA_netcon = [+1.617354478164705e-01   +4.759304357294342e-02   +1.159336431177657e-01   +1.002276206627049e-01   +5.632226416425174e-02   +1.553012430902322e-01   +7.585953607840296e-02   +2.593782907420311e-02   -4.315208100370505e-03   +1.744634849674683e-01   +1.671604778142129e-01   +1.548876658846915e-01; +8.950747557363765e-02   +4.199785403668477e-02   +2.336487807384047e-02   -2.730757337974304e-02   +1.364165121679417e-01   +2.373022078687212e-01   +2.329507884508505e-01   +1.213959519902115e-01   +2.776554189496410e-01   +8.589523475429622e-02   +1.965430982012648e-01   +1.984928203754090e-01; +1.395730645588268e-01   +9.126392015594263e-02   +2.339739942353958e-01   +1.082358333553714e-01   +2.329895530599045e-01   +5.166283341618912e-02   +5.950211147000700e-02   +1.889190336879246e-01   +1.726383624558552e-01   +1.824360092280391e-01   -4.253173079198570e-03   +3.543838179126269e-02; +1.957047233661301e-01   +2.393375900907868e-01   +2.093477557043524e-01   +1.327891196148333e-01   +2.102813454684683e-01   +1.276903430176150e-01   +2.196276327081575e-01   +1.118669546570154e-01   +1.629196298532092e-01   +9.191017088196657e-02   +1.477304121577780e-01   +1.919476254619211e-02; -2.804467554484387e-02   +2.086604891819065e-01   +2.126201637449316e-01   +1.108620506633831e-01   +1.333829855067021e-01   +1.878627557179491e-01   +3.088913729140477e-02   +1.333895179449989e-01   +6.602059232816221e-02   +1.456550962689599e-01   +2.298096596354296e-01   +6.896982922446469e-02; +3.862388117874201e-02   +2.149626450753822e-02   +2.040955908404065e-01   +3.010823301761805e-01   +1.900116198612059e-01   +3.332090826917586e-02   -5.452361314297957e-02   +2.134685787866411e-01   +1.871174245572503e-02   -2.210928042011334e-02   +1.148928749526091e-01   +7.973916583329139e-03; +2.471948488266953e-01   +1.361706676120062e-01   +2.002016790804052e-01   +3.879838097534606e-02   +1.647711600970240e-01   +5.854412376502868e-03   +1.674013445400913e-01   +2.482490289543005e-03   +4.164380482653082e-02   +7.938260153342264e-02   +1.486091041662263e-01   +1.427603449736731e-01; +1.114968317259395e-01   +1.244009869402775e-02   +7.262943561608237e-02   +1.849365884362700e-03   +3.050418705119878e-02   +2.464648524310331e-01   +1.083783186662605e-01   +1.838342562589775e-01   +1.415267595282473e-01   +2.278382624208896e-01   +2.481092025632281e-01   +4.958316812124327e-02; +5.533883059766284e-02   +2.418384314737179e-01   +8.228827196654967e-02   +1.160100986467700e-01   -1.491964589948867e-02   +6.743299918259713e-02   -4.164166232877629e-02   -1.772858665989309e-02   +1.620816585865570e-01   +2.147482563679682e-01   +1.902686992176361e-01   +6.879051040100323e-02; +7.412523724762485e-02   +2.349457761957629e-01   +5.398487465682771e-02   +7.337684578534631e-02   +2.597233291950673e-02   +3.412533494047118e-02   +1.616078212430336e-01   +1.228721422423845e-01   +1.760527269034234e-01   +1.556751559855708e-01   +7.288757479476685e-02   +2.385807451406833e-01; +1.335197678971149e-01   +1.716482695818516e-01   +1.106986677561067e-01   +1.311986483865974e-01   +1.014495599269117e-01   +3.482300446260102e-03   +1.050694897919092e-01   +1.624022255397755e-02   -2.910482924712389e-02   +2.496957681513069e-03   +2.742160887618297e-01   +7.536187842506646e-02; -1.278226251422308e-02   +1.871264250267129e-01   +1.575016405867729e-01   +1.971532772122454e-01   +1.862703236421956e-01   +1.969021319114014e-01   +1.647545921561884e-02   +6.815951340184362e-02   +2.072182757369797e-01   +2.001516270095335e-01   +4.842413368515832e-02   +7.075139135761108e-02];
L2E_Input1_iAMPA_netcon = [+2.204504898959468e-01   +9.416542040297110e-02   +4.765655641476686e-02   +1.985624862289638e-01   +6.063625377696688e-02   +9.911028044887971e-02   -5.274034747594079e-02   -4.566104618236592e-03];
L2I_Input2_iAMPA_netcon = [+1.043898252557116e-01   +4.613035017187650e-02   +2.094613089975718e-01   +2.034102767394394e-02   +1.595059084724219e-01   +2.509474351197009e-01   +1.436581548167212e-01   +9.923257817531445e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
