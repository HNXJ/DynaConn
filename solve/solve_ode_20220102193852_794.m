function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.968303189352667e-01   -7.747093203513940e-02   +6.278933035079720e-01   +2.312756995876498e-01   +1.243632175874076e-01   +6.063829219937913e-01   -2.494717263745166e-01   +4.203228007204080e-01   +2.585816623221776e-01   +8.876359237102689e-01   +3.545254706035732e-01   +3.050245442998520e-01   +1.335678675876770e-01   +2.108301231427991e-01   -1.702292028766510e-01   +1.133939641209616e-01; -3.008652181576422e-02   +3.929776629073128e-02   -1.936419126313408e-02   +8.261935194900392e-01   +1.728552964022203e-01   +3.260035237100286e-01   +8.767847848036915e-02   +5.396781582739699e-01   +5.391269092664377e-01   +2.443540434836310e-01   +6.787544113984656e-01   +6.755913438557383e-01   +2.928811852992448e-01   +3.348978165511556e-01   +2.456446089981693e-01   +1.713554217111665e-01; +7.726896722066496e-01   +2.228950885303718e-01   +6.981240323428037e-02   +4.867172431927968e-02   +2.417035615093553e-01   +2.411715592293465e-01   +6.561452596183607e-01   +2.890504254834785e-01   +2.506356009410613e-01   +4.281418875696897e-01   +3.958989073271007e-01   +8.456265512846690e-02   +2.677767169319674e-01   -1.931974947481953e-01   +1.074744249426074e-01   +2.290760131076514e-01; +3.480208468034601e-01   -1.700764925616795e-01   -4.351820028066646e-02   +3.031598896412658e-01   -6.041318851320268e-02   +1.475142673927426e-01   +8.518425902587294e-01   +7.105136509225272e-01   +2.923115753788522e-01   -8.765151328074114e-02   +4.461998967774085e-01   +4.884629073057454e-01   +2.520949744458609e-01   +4.684042210767409e-01   +1.943732343379104e-01   +5.349906376413209e-01; +6.901757608108585e-01   +5.088130106488991e-02   +7.507186033734171e-01   +6.955355168139643e-01   +5.112666655032366e-02   +5.118991305757815e-01   -7.825232738701725e-02   +5.077338080859385e-01   +2.035470747443060e-01   +3.561397669219969e-01   +4.673014794769809e-01   -1.153014256743699e-01   +1.978934079118466e-01   +3.978785340756171e-01   +5.612655849420681e-01   +2.352601576751918e-01; -9.542339629763213e-02   +7.128112120148505e-01   +5.207821869745823e-01   +1.577416124217974e-01   +6.617565791907272e-01   +3.969918047499354e-01   +1.000000000000000e+00   +3.186324110287535e-01   +3.453231416616921e-01   +3.590971577963363e-01   +4.490356669396729e-01   +4.255243314217983e-02   +6.988405444179504e-01   +4.837213780200083e-01   +1.737510868823854e-01   +1.379370893358977e-01; +6.084568231079712e-01   +5.490674719287236e-01   +3.658765767582122e-01   -1.323673534194795e-02   +2.220960750580470e-01   +1.867984654041298e-01   +2.563163110133694e-01   +1.677902949830031e-01   +5.138858138657597e-01   +4.643036900498691e-01   +8.654798594323251e-02   +2.336442162942214e-01   +3.442256480329358e-01   +3.431184698602713e-01   +5.452445644298818e-01   +2.671294678685339e-01; +4.933433575415170e-01   +5.208765290432678e-01   +1.362601831034068e-01   +9.358319419728806e-01   +1.616789922843229e-02   +3.754613427424471e-02   +4.660309187459830e-01   +6.974636351359780e-01   +7.448145155473495e-01   +5.461846943513677e-01   +4.286478610773176e-01   +6.554001711330260e-01   +1.651595806812372e-01   +2.148936770069401e-01   +3.651422142382385e-01   +4.654773418843375e-01; -2.191076548504441e-01   +7.441832574140999e-01   -1.332468743215267e-01   +4.364128988958724e-01   +1.292353815522480e-01   +5.653715653321737e-01   +2.419210020676413e-01   -1.929935673623663e-01   +2.376845899062888e-01   +5.553431655334692e-01   +9.219296095894216e-01   -4.570511962585366e-01   +5.064826542014913e-01   +4.078039753750325e-01   -6.284312801281589e-02   -9.177306238751319e-03; +2.468157668376783e-01   +2.891600264455738e-01   +5.761349545405103e-01   +4.650099088027981e-01   +7.587168008684455e-01   +3.379909316844244e-01   +5.743247442922365e-01   +3.160978741040852e-01   +1.692307584155438e-01   +4.985751252855890e-02   +1.740476023795575e-02   +1.566508539986468e-01   +8.339997109477760e-01   +1.825991175940857e-01   +8.365829205939490e-02   +4.674890136439204e-01; +7.945402157491181e-03   +8.107327986966937e-01   +3.731539761143181e-01   +3.601578304396025e-01   +8.032370497547997e-01   +8.932591521718269e-01   +7.198550730476003e-01   +1.629668845032168e-01   +2.322576605460835e-01   +5.934802594950157e-01   +1.495638759363067e-01   +3.898815629568683e-01   +4.731252397876507e-02   +5.597691232171319e-01   +7.325478670819527e-01   +4.935422263654501e-01; +5.643710505341493e-01   +9.147521485727066e-02   +1.584384966403102e-01   +1.533291990225783e-01   +2.743709780424568e-01   +5.116310468722001e-01   -9.127815413668235e-02   +3.561814727385809e-01   +7.922404997098312e-01   -3.504841127349605e-01   +9.761412765485102e-02   +5.939042176166722e-01   +2.237692828064438e-01   +4.519160664913164e-01   +8.225445056163462e-02   +2.703786498767562e-01; -3.203171415338732e-01   +5.110786115235980e-01   +6.717615216072883e-01   +6.299317032121965e-01   +8.256873770312787e-01   +6.487570825846054e-01   +1.124831863569831e-01   +5.065276106215341e-01   +9.484627606215368e-01   +5.875999096176838e-01   +3.176456428559014e-01   -2.112101138253066e-02   -2.906442921639564e-01   +8.032886221432661e-02   +1.716783960527358e-01   +1.568244500018409e-01; +1.747023785930738e-01   +5.436738303388280e-01   +4.221744409222049e-01   -2.100045790978913e-01   +3.072503904338199e-01   +7.459152214477256e-01   +1.495072745069889e-01   +4.602807916531443e-01   -4.639059722564121e-02   +5.320342206182382e-03   +7.926207233893477e-01   +7.220450333279834e-01   +8.599356855630461e-01   +3.266853429612860e-01   +4.770568440957182e-01   +2.830925609929631e-01; +5.403882469548389e-01   -8.082113320855296e-02   +6.015920427990122e-01   +6.933973413244440e-01   -1.621635425711687e-01   +7.675668728495248e-02   +5.710518152108379e-01   +6.157256945825219e-02   -9.087951170656984e-02   +2.275619693305437e-01   +3.760809072447368e-01   +3.183376797413762e-01   +3.835093244965364e-01   +2.302564173429975e-01   +2.666864395917102e-01   -9.952321403041088e-02; -1.200811594550179e-01   +3.657229560715085e-01   +3.309875001551288e-01   +5.716763878499480e-01   +8.222817769679444e-01   +6.990472123178453e-01   -1.886746005071928e-01   +6.810164087673207e-01   -7.188549790366351e-02   +6.749588278073468e-01   +6.005753485318495e-01   +3.605726952439335e-01   +4.310055536816561e-02   +8.390860611666120e-01   +7.262016106296163e-01   +1.369961643655238e-01];
L1E_L1I_iGABA_netcon = [+2.871265367378053e-01   +4.190493027508151e-01   +1.603076737728630e-01   +1.009781639132546e-01   +3.891785935436879e-01   -1.515244634099899e-01   +2.679836875146038e-01   +1.943619404480925e-01   +1.227734785574485e-01   -7.667898707025408e-02   +1.971552392707812e-01   +6.401199097857289e-02   +4.839795714227302e-01   -2.568741289821936e-01   -4.462501055086142e-01   +9.903086288558144e-01; -1.817547348171195e-01   -1.844810266743782e-01   +2.598296869147576e-01   +1.067646939594990e-02   +4.837868606348557e-02   +2.329872696141634e-01   +5.292430165871620e-01   +2.917524839475282e-01   +5.551886935568582e-01   +9.751464384082069e-02   +5.158189512059008e-01   +1.477774707654374e-01   +7.231617354668155e-01   +1.515514954390489e-01   -3.287811225954897e-02   -9.662394280970329e-02; +3.904763145203081e-02   +2.627938036499564e-01   +1.970376147832260e-01   +4.400519969085477e-01   +3.303650685391397e-01   -3.097600918596407e-02   +1.348006637436863e-01   -4.571145352470682e-04   +1.553328876069245e-01   +7.690122733399913e-01   +3.466480408384423e-01   +1.251906707897842e-01   +1.438796414087152e-01   -2.788750160714928e-01   +2.826494128930295e-01   +5.341486302077251e-01; +6.354002738069993e-01   +5.144269809690571e-02   +5.059510879687561e-02   +2.833979499608851e-01   -1.317425797532171e-01   -1.432443972678344e-01   +2.480327555234724e-01   -2.013984609542683e-01   +8.648266745970974e-02   +1.716574090256292e-02   -1.377057552661679e-01   +3.692918043643682e-01   -3.622846865540298e-02   +5.043795294436170e-01   +3.352181090601514e-01   +8.842689597806104e-02; +1.934543084708914e-01   +3.414924133111849e-01   +1.625663501179624e-01   +8.208786482796770e-02   +7.070345553340543e-01   -2.718099405023266e-01   +1.771654207613500e-01   -1.390946384501816e-01   +2.727196032552560e-01   +2.533360634818209e-02   -6.458472629135838e-02   +3.546746347649876e-01   +3.321796208109140e-01   -2.088801384478560e-01   -7.871400203598761e-02   +3.387786459589083e-01; +6.168560351211105e-02   +2.344122644824157e-01   +4.086955463722923e-01   +1.764524052009716e-01   +1.900283256439542e-01   +3.584381120663193e-01   +1.868165673124796e-01   -5.386707928945491e-03   +6.539431683475977e-02   +1.680605410196775e-01   +1.104294755850375e-02   +3.958695607174276e-01   +1.729575939189869e-03   -2.420316404211412e-01   +5.145050434861450e-01   +5.665545547238812e-01; +7.914098564556088e-02   +1.041644106734266e-01   -1.380703088172224e-01   +1.706956857923299e-01   +3.427414062564415e-02   +2.864936959827525e-01   -1.154972639577903e-01   -2.615757406831033e-02   +3.679981692896644e-02   +2.287429862942938e-03   +2.789141266334563e-01   +1.113937818835461e-01   +4.714980025225839e-01   -3.134406648844681e-01   +3.624444067960177e-01   +6.787403801587347e-02; +2.670771255854600e-01   +5.542363503246160e-01   -4.628354545399929e-02   +3.172966952683990e-01   +6.371980470081537e-02   -1.000388136905493e-01   +3.310643644298179e-01   -1.202522486519557e-01   +5.862886194921245e-01   -6.016700526269424e-02   +1.820572441122322e-01   -2.183913234117694e-01   +3.466440671697232e-01   +2.077509281614976e-01   +3.829828269034568e-02   +2.186315047236620e-01; +5.001589188157783e-01   +3.688736986326674e-01   +3.805091515797167e-01   +1.354087122069864e-01   +3.864240523566968e-02   +5.342892094855748e-01   +2.420531510925010e-01   +1.347112413748337e-01   +3.615079379162159e-01   +4.203062613624068e-01   +1.065803953646114e-01   +3.799558697995784e-01   -6.821775865048521e-02   -7.338079416219620e-02   +5.466600843631537e-01   +3.098216263806929e-01; +2.327703042055159e-01   +4.497508204923751e-01   -1.979154016215841e-01   +3.213977833037234e-01   +2.244111049742994e-01   +4.355174837587804e-01   +1.212786767313485e-01   +1.241853869482290e-01   +5.089214704598494e-01   +1.119986850512174e-02   -1.132462376168566e-01   +3.662201535778422e-01   +3.041170274945102e-01   +4.849817805612787e-01   +9.088299905370559e-02   +6.311734016032953e-01; +1.749034165001150e-01   +1.092178372171673e-01   +3.863190973096886e-01   +1.564726087780897e-01   +1.836841778687989e-01   +3.048882142266189e-01   +3.409888837497943e-01   -1.218451482070779e-01   +3.396239648887559e-01   +2.886065330348536e-01   +6.828285898669195e-02   +4.042537767833555e-01   +3.738365421730625e-01   +1.844865204617949e-01   +4.302833789005552e-02   +1.595221564381015e-01; +4.862513733827643e-01   +2.636289391695097e-01   +5.770721298260516e-02   -2.905200089608937e-01   +1.553991212436563e-01   +2.066362321582726e-01   +1.745473241433987e-01   +3.401625712249138e-01   -1.206341279885366e-01   +1.625838543189718e-01   +4.376470839186711e-01   +5.155225293144692e-01   -2.198555077758057e-01   +1.659622740097004e-01   +9.356770620236593e-02   +2.278060068972406e-01; +2.993299921732414e-01   +3.697994869842053e-01   -8.401225341998753e-02   +6.382448429789145e-01   +9.636040051550716e-02   +1.133404757774443e-01   +1.187008669432974e-01   +3.247643779690636e-01   +1.800920146476551e-01   -1.462609001709867e-01   +3.797447799875287e-01   +2.741876816438433e-01   +9.988777257830203e-02   +2.028444101585070e-01   +4.962576471590854e-01   +4.738378972047777e-03; +3.583851643169303e-01   +1.447750683658934e-01   +3.133845390506451e-01   +4.256969617615329e-01   +2.672626958824907e-01   +1.875422733158022e-01   +3.199577730258010e-01   +3.416296555511522e-01   +3.056639522669144e-01   -1.292362369734256e-02   +3.251800997016346e-01   -1.379864147646181e-01   +3.863430374421658e-02   -2.313077241195214e-02   +1.470658581833511e-01   +7.060033362644068e-02; +3.860030882054974e-01   -1.334551747848736e-01   +1.813615673980137e-01   +9.686159822809223e-02   -1.509552410716400e-01   +1.642483287226418e-01   +2.242523319533790e-01   +1.429149338156072e-01   +2.929194149431600e-01   +1.404132795893028e-01   +4.816722040541594e-01   +3.558293733273363e-01   +9.247587954585276e-02   -1.481749645839264e-01   +3.712581696440043e-01   +1.762563119586866e-01; +2.910570254851390e-01   +9.572442201969600e-02   +3.456799176824027e-01   -5.643968258024637e-02   +4.792940585001909e-01   +2.108248800765895e-01   +2.124898744233462e-01   +3.549310115951224e-01   -1.781893920472573e-01   +3.803304732430700e-01   +2.980992561536430e-01   +4.963758187985790e-01   +1.682145183271080e-01   +1.385304209811882e-01   +3.628808015430203e-02   +4.237000735724390e-01];
L2I_L1I_iGABA_netcon = [+3.116072448133698e-01   +4.339759153733572e-02   +1.953803125338081e-01   +4.755431214691379e-01   +5.573459339830759e-02   -1.471440531945868e-01   +1.260997720941312e-01   +2.101015592129552e-01; +4.744645097331486e-01   +8.424623929069602e-01   +3.321203167123575e-01   +3.620060523403112e-01   +3.994990287857064e-01   +3.693667206494175e-01   +3.734710529490788e-01   -2.355913159309854e-02; +3.624212961673007e-01   +1.437610302861539e-01   +7.360877726145511e-01   +2.965088505538931e-02   +5.900475388288869e-01   +1.372883841980736e-01   +5.294302687780345e-02   -3.218015192258212e-01; +6.259167864650580e-01   +2.660946662586631e-01   +3.586650361805474e-01   -5.911672579665836e-02   +7.790968565818914e-01   +4.492152588062506e-01   +6.328750352840435e-01   +5.877344734644586e-01; -3.665136969146823e-02   +6.362100437845414e-01   +3.684370745970840e-01   +3.498647213177409e-01   +4.748223197750606e-01   -8.353997290943732e-02   +5.459769104894058e-01   +2.453048385645866e-01; +3.110098111337142e-01   -8.810908380949636e-02   +5.136729144378994e-01   +4.475132658286389e-01   +2.536957414659856e-01   +6.390462474570587e-01   +3.345835912043966e-01   +5.097671466754949e-01; +7.183032140232879e-01   +6.222502456335038e-01   +5.914302286821773e-01   +5.534455553616661e-02   +5.540675509073821e-01   +2.125937073011646e-01   +5.473164742360589e-01   +8.519334053850636e-02; +3.011114022749938e-01   +2.721013004710050e-01   +4.034895594001494e-01   +2.388668404479109e-02   +2.559225940501751e-01   +4.497199821689329e-02   +2.070542799358101e-01   +4.004996326589951e-01; +7.413418139134410e-01   +9.699440127972921e-01   -5.032014922994197e-02   +7.480266842426136e-01   -1.107110012285399e-01   +3.599176922780842e-01   +1.308759187701743e-01   +3.105012167020005e-01; -5.485756060644926e-02   +4.716773457377079e-02   +1.515706290806567e-01   +6.599796157309790e-01   +6.969319484550397e-01   -3.526386270771961e-02   +6.772152511371307e-02   +8.510420569308741e-01; +3.154129918274122e-01   +1.828434135992660e-01   +5.591531092509441e-01   +5.758438520712097e-01   +1.649890419796824e-01   +6.155833652132794e-02   +4.204205258997932e-01   +2.830684016997640e-01; +9.172438927654199e-02   +4.985139265240149e-01   +4.810539571627055e-01   +5.193158680620338e-01   -9.211686534762661e-02   +3.883273332770679e-01   +1.633873757091821e-01   +3.555926041983867e-01; +1.319021096068828e-01   +6.752543818514251e-01   +8.679184211467813e-01   -3.221865609330997e-01   -1.562662633353988e-01   +9.469186510221664e-02   -1.641871724906361e-01   -1.356490631983887e-01; +2.168991594733883e-01   +8.310812167911327e-02   +1.770339774497268e-01   -2.550986887841064e-01   +4.626035683882416e-01   +3.186531494403858e-01   +2.709717130645773e-01   +9.760181665140086e-02; +6.889819076430450e-01   +7.117155077706137e-01   +6.580526261515713e-01   +7.389447119544328e-01   +3.624893810846311e-01   +9.323603695988556e-01   +4.613135282629235e-01   +7.191404998901778e-01; -1.542684282742788e-01   +4.651668473878247e-02   +6.548519874975156e-01   +2.983178946007075e-02   +1.354854018075063e-01   +1.593927067627464e-01   +2.759231851599790e-01   +6.290696584842622e-01];
L1I_L2I_iGABA_netcon = [+1.816049392445716e-01   +4.469201809585991e-01   -9.900600491276154e-02   +5.280276313010988e-01   +2.452252566051332e-01   +2.824398196517199e-01   +4.372214787115162e-01   +5.131286925592865e-01   -2.786436789092505e-01   +7.158904171079776e-01   +8.857953422693092e-02   +5.206175150794298e-02   +5.387260115454446e-01   +2.891890204613702e-01   +2.488092584652085e-01   +4.165728749276777e-01; +1.516289678258379e-01   +3.385426647125298e-01   +1.725682212372571e-01   +3.069853670817826e-01   -3.608080991389556e-01   +2.935565830655517e-01   +7.602386952945496e-01   +4.191511324929523e-02   +4.608950106748122e-01   +5.041938689985156e-01   +2.952462246332278e-01   -1.609559501088281e-01   +1.850251970270890e-01   -3.450697583566329e-01   +1.193930131702735e-01   +4.616258612514179e-01; +2.065246573498839e-01   +2.196576415463206e-01   +4.766814777192213e-01   +2.998981846666162e-01   +3.383510400996074e-01   +3.577856914866239e-01   +3.928601386801281e-01   +4.613595701509751e-01   -3.561440231363655e-02   +4.381326944180501e-01   +9.902296315995648e-02   +4.137670927522870e-01   +3.184523872143742e-01   +5.867649354788822e-01   +5.292836284081885e-01   +8.121975585390684e-02; +4.317391372908150e-01   +2.533063289413312e-01   +2.030202941406722e-01   +2.304101978516059e-01   +6.845756246966016e-01   +3.941548348060189e-01   +5.724068228665974e-01   +6.785522789397449e-01   +1.134646127061474e-01   +6.314856110561451e-01   +2.955950206320291e-01   +3.934093863548078e-01   +4.045145757518449e-01   +1.017789762750197e-02   +5.195434095379412e-01   +7.234464471431051e-02; +1.456795383081700e-01   +2.378132515533274e-01   +2.383469812400861e-01   +3.335595824965356e-01   +2.223958932376000e-01   +9.814519884479271e-01   +4.533309985059613e-01   +3.858362297423909e-02   +5.554936931702328e-01   +7.276873046503991e-02   +9.268970606282442e-03   -1.302056738371303e-02   -1.734228387506491e-01   +3.390632190155909e-01   +2.766244079547359e-01   +6.565408513134974e-01; +2.046417737734167e-01   +4.337226034171011e-01   +5.946025517163660e-02   +9.711790351163219e-01   +1.843795878989423e-01   +5.866652416335190e-01   +4.748004802597117e-01   +1.970031639692280e-01   -5.162216559442759e-02   -2.920823102336031e-01   +4.478811055255957e-01   +3.669284075504426e-02   +4.563089256310641e-01   +6.613144970528045e-01   +3.677408499067349e-01   +3.281410454059126e-01; +6.599229835298600e-01   +8.187832084423818e-01   +1.675361569825885e-01   +4.418803429187830e-01   +2.147803870961859e-01   -4.716186388093131e-03   +5.843860528600667e-01   +7.892696135401102e-02   +1.311979214951670e-01   +5.135584024112440e-01   +3.759066969042015e-01   +1.703589595247948e-01   -1.449115176323747e-01   +2.648982680515220e-01   +2.442318873204277e-01   +4.953909965518274e-01; +5.855527816852675e-01   +1.597909082969770e-01   +2.768985888827021e-01   +3.003162364742794e-01   +2.369613407239901e-01   +5.864113297267053e-01   +2.978461195044175e-01   +2.073047560431830e-01   -5.241780067648738e-02   +1.475093281293345e-01   +7.482191371703112e-01   +4.131599999115026e-01   +5.317601277086859e-01   +6.885327481535064e-02   +3.835631891649046e-01   +2.434439341195968e-01];
L2E_L1E_iAMPA_netcon = [+4.646620226667403e-01   +2.051442532568875e-01   -5.311450737296965e-02   +4.800582989614241e-01   +7.457369060821978e-01   +4.016402291294794e-01   +3.086198866427374e-01   +1.466984206047360e-01; -5.236534423084482e-02   +5.519968638584890e-01   -6.998501191714968e-02   +2.184477713445327e-01   +2.657374540075113e-01   -2.273522205500822e-01   +3.461975335428361e-01   +6.514089350426047e-01; +1.157487466260956e-01   +7.980386545766466e-01   +4.370595711026177e-01   +3.032341073515202e-01   +8.949523958114231e-02   +3.627304439409624e-01   +4.675798506305127e-01   +3.133237269816823e-01; +6.037310824301432e-01   +1.616829458376488e-01   -1.865726861612057e-01   +5.835237436290418e-01   +2.591651745865226e-01   +7.520209408157028e-02   +2.134370074759362e-01   +1.603423422795222e-01; -1.713210188027334e-02   +6.050195633636237e-01   +3.586478520294044e-01   +2.091832866916493e-01   +5.214661792785660e-01   +1.580915917603313e-01   +5.751031162024244e-01   +7.594603887643125e-01; +3.699288424050023e-01   -2.190116294287563e-01   +7.046682394534997e-01   -1.245812573488264e-01   +6.496010771802420e-01   +6.769444234558104e-01   +5.243022383336007e-01   +3.887078731220430e-01; +3.309995994315760e-01   +3.756588652910325e-01   -8.539966497416779e-02   +3.372223464830924e-01   -1.440939015738389e-01   +2.748371047376860e-01   +1.000000000000000e+00   +2.485698613684449e-02; +8.654486040725770e-02   +3.962344772125476e-01   +6.818751805143185e-01   +1.637609351298259e-01   +5.642816671437830e-01   +3.525109095704790e-01   +4.603539884839849e-01   +4.065769580379566e-02; +6.260764495693103e-01   +1.260143301301809e-01   +3.069362457996357e-01   +9.218974563222384e-01   +2.246199470541306e-01   +6.632403706578216e-01   +1.366733623103695e-01   +4.830981561120648e-01; +4.395503488580473e-01   +7.270953544055357e-01   +3.469640948355175e-01   +4.940071339879228e-01   +1.184670299008565e-01   -2.354464168519588e-02   +3.987447456098172e-01   +3.642460635549987e-01; -6.712838156400983e-02   +3.667363476103264e-01   +2.563235463500468e-01   +2.633451128780435e-01   +1.856392554636600e-01   +2.712586253271379e-01   -2.183682308817849e-01   +2.594457983259619e-01; +1.760730786327952e-01   +1.396358386432371e-01   +7.856872071574617e-01   -7.601062768632298e-02   +2.392442274304816e-01   +3.940420508897616e-01   -3.496502085322144e-01   +2.835748664649839e-01; +1.605011281038365e-01   +3.106687071053622e-01   +9.304639708388825e-02   +4.016972751020143e-01   +2.621452708781359e-01   -7.661643033108609e-02   +5.147298699091875e-01   -6.805104478976606e-02; +2.341979976922916e-01   +2.567614250929572e-01   +1.895986859102053e-02   +5.905296637638195e-01   +8.586541896407253e-02   -1.232450204948839e-02   +4.568896469847117e-01   +2.311436560687386e-01; +5.588744044050701e-02   -1.681121974721620e-01   +3.480462257026229e-01   +2.805002235963742e-01   +6.255871320399506e-02   +3.991804537590041e-01   +3.905182410539460e-02   +1.728847189358013e-01; +3.531632481865686e-01   -7.838724714500767e-02   +1.566234705412386e-02   +5.380817594355636e-02   +4.537709544473625e-01   +4.484296798189012e-01   +2.245589070807683e-01   +7.562172519462413e-01];
L1E_L2E_iAMPA_netcon = [+2.377656755077883e-01   +2.127463977929643e-01   +3.744018363292909e-02   +2.939507286305994e-01   +8.695799816558202e-02   +4.151571013112953e-01   +4.281476354540218e-01   +2.031816227165263e-01   +2.342165158373985e-01   +2.980266418608719e-01   +4.247081636582424e-01   +5.532066892186079e-01   +5.602811350946287e-01   +2.053685074852670e-01   -1.241394093672584e-01   +2.448871250734233e-02; +2.075662038056815e-01   -1.906952375657699e-01   +2.429481963815416e-01   +4.281931042922495e-01   +2.040269313865614e-01   +2.220717873990130e-01   +1.823656678180796e-01   +2.940093637567560e-01   +2.349135526570627e-02   +4.304448615371617e-01   +1.412901461463303e-01   +6.037883128655501e-01   +4.184983161545218e-01   +4.162868240552387e-01   +4.213000827483404e-01   +2.644345076151587e-02; +7.051579915883877e-01   +3.122204309650405e-01   +2.128212787320697e-01   -6.000631772205613e-02   +1.313929099365674e-01   +2.648733733363434e-01   +3.267601067126935e-01   +5.401114494534431e-01   +4.674686595282792e-01   +1.762416179374753e-01   +3.886839978458382e-01   +2.922460613364343e-01   +1.754832125806297e-01   +4.182846240458317e-01   +1.189777069208742e-01   -1.751342089940466e-01; +3.182961814199669e-01   +6.450489242587053e-02   +6.565640944890229e-01   +6.212153721172849e-02   -2.334577857872255e-02   +3.499050389023580e-01   +1.000000000000000e+00   -7.748545187185558e-02   +3.793013467230318e-01   +3.614826292936713e-01   +6.111448775627704e-01   +1.947447518199294e-02   +5.831402995470911e-02   +5.269711411811120e-01   +3.942726409635652e-01   -1.623269611360509e-01; +1.966245414782578e-01   +1.128023014577869e-01   +7.983602723394646e-01   +2.462326653639245e-01   +3.437646930141825e-01   +4.760763407641906e-01   +5.813021588960694e-01   +2.649683598350602e-01   +4.387558422617485e-01   +3.481507100835782e-01   +6.009989872952057e-02   -2.935154517094253e-01   +4.684400464407000e-01   +1.443410406174038e-01   +8.229314666011237e-01   +4.863776871040074e-02; +2.416562941762443e-01   +6.008643484021116e-01   +3.840666097058855e-01   +6.351673996128188e-01   +1.808299946846836e-01   -8.639063317869340e-02   +4.799691467719789e-01   +3.245207470198017e-01   +3.519896837988614e-01   +2.357217936119546e-01   +4.390235185958773e-01   +6.935243573813998e-02   +1.126518988160354e-01   -1.744423262194595e-01   -5.353317359455653e-02   +3.885466225199529e-01; +1.104724480912696e-02   +1.696259620397861e-01   +2.388745286896067e-01   +5.354143601293293e-01   +1.016997780087014e-01   +6.651238497339494e-02   +7.466945133763990e-01   +8.159183052427137e-02   -1.555751032409825e-01   +2.746639852982993e-01   -3.119262419173776e-02   -1.505465332371057e-01   -1.449171523809337e-01   +2.185851994543118e-01   +2.103588633964581e-01   +9.961679723480278e-02; +3.726099391126472e-01   +2.675197686474734e-01   +3.931144901006545e-01   +6.341559277692785e-01   +4.442509028786700e-01   +7.798207638566068e-01   +6.951338230522403e-01   +2.280489039471760e-02   -1.940640654845734e-01   +5.694767022517075e-01   +4.591148370070061e-01   +2.536717923969737e-01   -1.200366917228811e-02   +6.005905031139451e-02   +3.518824255675465e-01   +1.685757304281926e-01];
L2I_L2E_iAMPA_netcon = [+5.111756106068976e-01   +5.023259023828451e-01   +4.121002012335328e-01   +2.549593869426727e-01   -9.820527018048573e-02   +5.552145209418671e-01   +3.592402983777224e-01   +3.978558161547667e-01; +6.262413860560126e-01   +1.329025154734785e-01   +5.796840726862044e-01   +4.927309560782097e-01   +3.880339347871510e-01   +2.679685510660466e-01   +3.002173738374418e-01   +3.562929959218603e-01; +3.393993363277348e-01   +5.707598313092910e-01   +2.365415643729920e-01   -2.290016928698199e-01   +1.014283137289485e-01   +1.442419104032784e-01   +2.495249953143709e-01   +8.281467116432652e-02; +2.214546764997851e-01   +3.631415784192906e-01   +1.224260170597382e-01   +5.641203397691467e-01   +1.623206955870242e-01   -9.398822867250507e-02   +1.618087410303238e-01   +1.541242266651431e-01; +5.213269605116826e-01   +2.746651562784760e-01   +2.153341715045481e-01   +4.028273862303237e-01   +4.557177083321182e-01   +1.472879625541504e-01   +6.410073966578832e-01   +6.133886909562156e-02; +2.871285126771109e-01   +2.892003938979397e-01   +1.717862244881218e-01   +4.444910235492406e-01   +3.022550391481599e-02   +3.953494658046555e-01   +3.059312553174011e-01   +1.586518479175714e-01; +2.747877439153702e-01   +1.444721011232064e-01   +5.599000860297126e-02   +5.466210930446835e-01   +3.147793383454176e-01   +1.531219317338415e-01   +1.000000000000000e+00   +1.096982205357969e-01; +5.442391126988977e-01   +2.372989487117077e-01   -2.145416814231858e-01   +3.671636649809016e-01   +2.093316435936840e-01   +4.134227705382006e-01   -6.786634869462323e-02   +3.401901391204217e-01];
L2E_L2I_iGABA_netcon = [-9.937676137506479e-02   +5.990134207723175e-01   +5.412821557694832e-01   +1.519725943673477e-02   -1.912495312228941e-01   +4.059149090539689e-01   +1.197552444692757e-01   +5.196456528834644e-01; +2.435740441195664e-01   +5.459990680829897e-01   +5.029714448322955e-01   +6.130823891486391e-01   +4.802964573160548e-01   +5.308611223897063e-01   -3.117468024004103e-01   +4.266884769817456e-01; +2.186415967483637e-01   +6.620763534800693e-01   -1.645971511220319e-01   +1.303036337867490e-01   +5.621766315683978e-01   +5.917306702228136e-01   +8.003508229562697e-02   +9.880164196636113e-01; -5.127196068066948e-02   +4.657564601878508e-01   +3.270831326613061e-01   +4.396154604644618e-01   +7.276125264271597e-01   +1.278261444255388e-01   -9.870530769593452e-02   +1.070095179101221e-01; +4.179820975178594e-01   -2.986483015292123e-01   +5.906610930557460e-02   +6.920277687843291e-01   +6.451631634311790e-01   +2.992618744177699e-01   +1.495602964759610e-01   +1.389847083855106e-02; +1.571942607995269e-01   +5.902371873591197e-02   +3.461858998608167e-02   +4.519488675898042e-01   +2.841109681472996e-01   -1.627272580433678e-01   +3.345200487751862e-01   +7.573899827651728e-02; +4.891750251643315e-01   +2.560164526078865e-01   -1.634819335657310e-01   +1.438555190201665e-01   +1.775318505446960e-02   -1.622436430509471e-01   +1.730942317552620e-01   +9.032253393401782e-01; +3.264082842173933e-01   +6.287351260426964e-01   +6.340753290469010e-01   -3.652350442079972e-01   +3.735872587863108e-01   +1.427886333906805e-01   +6.675923214080239e-01   +4.294470587359265e-01];
L3E_L2E_iAMPA_netcon = [+6.310159075292681e-01   -2.611104389667153e-01   +1.136300119370116e-02   +3.134030235410843e-01   +5.729239483298060e-01   +4.131423412588844e-01   +3.392705236832997e-01   +5.649271864049856e-01   +2.438650886075565e-01   +2.434393006810282e-02   -1.677518758351874e-01   +4.365995762955754e-01; +2.807296796901209e-01   +8.435432938963126e-01   +3.623288264632399e-01   +2.061902982437571e-01   +1.978460052017392e-01   -3.426333868200455e-01   +4.964340598943282e-02   +1.616713841417624e-01   +1.175128082042762e-01   -9.816048032038485e-02   +2.291935358477271e-01   +2.819023238614520e-01; -4.118206182500588e-02   -1.701218166650129e-01   +4.069861976476154e-01   +1.621378066096896e-01   +8.317333303056613e-01   +4.809168299526582e-01   +3.894021961170115e-01   +4.656192845194883e-01   +4.280679892353518e-01   -2.909801062139656e-01   +1.732126106976270e-01   +5.728186372290002e-01; +2.668315400854748e-01   +9.058846231157387e-02   +3.204347488828717e-01   +5.126222405261650e-03   +4.554155933818957e-01   +2.829648149997327e-01   +3.638598961009472e-01   +2.298712899376163e-01   +6.118189156430467e-01   +7.522275533115522e-01   +1.983495355567165e-01   +1.617860326181244e-01; +5.180060112197777e-01   +1.800035084848692e-01   +3.029637637369954e-01   -1.335451343016582e-01   +7.958989493599800e-01   +2.616696610288278e-01   -2.540963012278975e-02   -3.074823805360432e-02   +3.551463971008998e-01   +3.696765313688676e-01   +5.443484380232922e-01   +4.274821251228184e-01; +5.140321554588329e-01   +7.485213780305489e-01   +6.458139422842500e-01   -1.479566730568047e-01   +4.147236434435281e-01   +8.642929657910567e-01   +5.133065522166745e-01   -1.243622431454889e-01   +1.619122794587639e-01   +5.105220445777878e-01   -1.139209075794324e-02   +4.164430871475521e-01; +4.594812748714309e-01   +1.187494146616673e-01   +5.560239651345674e-01   +9.693021279623738e-02   +1.148864955692531e-01   +4.907857094885827e-01   +2.216382658411744e-01   +4.029360821365288e-01   +4.540755341275963e-01   +5.678319033969271e-01   -3.760334360598565e-02   +2.254851455904031e-01; -1.486508270203312e-01   +6.913345292128874e-01   +4.117639639480752e-01   -2.942227966286193e-01   +5.938589531037402e-01   +3.642646586861488e-02   +1.196658811592209e-01   +1.010184371797142e-01   +5.575414438738772e-01   +5.463740786010716e-01   -2.200928795213430e-02   +1.024239228831170e-01];
L3I_L2I_iGABA_netcon = [+6.125083409323931e-01   +5.249551915750313e-01   +2.121277887301069e-01   +3.984607243878944e-01   -2.210586329769239e-02   +3.213621698027695e-01   +7.159609984913347e-01   +3.324081479801466e-01   +7.242099138886123e-01   +1.423621778939624e-01   +1.338824512647810e-01   +6.280637578404182e-01; +2.852631181501363e-01   +3.486847677992039e-01   -7.522593750648428e-02   +2.413043891577351e-01   +6.568804103638916e-01   +2.513878002438209e-01   +3.699202741929093e-01   -9.328919248666226e-02   +3.801611397555177e-01   +2.418982669144243e-01   +3.769340964714627e-01   -4.483990566162205e-01; +1.882409156502916e-01   +5.353387868455437e-01   +5.842160522039491e-01   -7.221572142695526e-02   -8.228335287682391e-02   +1.998985193407221e-02   +4.442518261382952e-01   +6.996141225204338e-01   +1.374663233982447e-01   +1.413062791190940e-01   -6.134865509762866e-02   +6.552962560713599e-01; +4.890953836676880e-01   +5.025937915233767e-01   +2.034706977252930e-01   -1.034598961878338e-01   +1.503434563272130e-01   +4.745508571824982e-01   +1.580001091275435e-01   +1.463178649579935e-01   +2.524521930298061e-01   +2.073837226261655e-01   +4.258660413629990e-01   +2.212285738201821e-01; +2.030665521611252e-01   +3.091584348786122e-01   +2.421674087761438e-01   +5.435014986001859e-01   +5.575772125281548e-01   +5.359859454956412e-01   +3.845339582235902e-02   +9.202272004411375e-01   +6.166819401999042e-01   -2.041994939401248e-02   +5.066720076406854e-02   +6.854490763854462e-01; -1.527324484263046e-01   +5.172361471136869e-01   +1.744950245295656e-01   +3.650243260833111e-01   +7.250157369479856e-01   +6.745153371724169e-02   +2.632945171021069e-01   +3.239431434345686e-01   +3.345043278570566e-01   +7.540926462159503e-02   +4.896272737307788e-01   +4.173310913542473e-01; +5.359680554783900e-01   +1.308223753459072e-01   +7.670749967928653e-01   -2.175851571891530e-02   -6.380061681751018e-02   +5.839285527365666e-01   +4.385465341130363e-01   +7.850997158985509e-02   -1.891090422554729e-01   +3.749981441200291e-01   +5.003035408781293e-01   +3.315278239579609e-01; -4.426193215357457e-02   +3.362905549708043e-01   +6.986465519863377e-01   +6.222057286469641e-01   -1.820540443809822e-01   +5.031359072955046e-01   +5.510283825674378e-01   +1.012295130848916e-01   +7.824901024247215e-01   +1.694738990848748e-01   +4.917526897292112e-01   +3.108109033426835e-01];
L2E_L3E_iAMPA_netcon = [+6.321870202776922e-01   +1.179492225933155e-02   -1.434377201413074e-02   +1.494121123758098e-01   +1.261148578596965e-01   -1.950239063510530e-02   +1.408410135088747e-01   -2.073343885443387e-01; +1.752750849442227e-01   +1.465551462942661e-01   +2.915173640818948e-01   +2.041573725334917e-01   +4.052783762057107e-01   +7.123252253262173e-02   -4.089648398968956e-01   -5.046711735155868e-01; +7.892016254517360e-01   +3.889421530527479e-02   +5.621108084776844e-01   +7.144826718787523e-01   -9.443573975246098e-03   +1.860814360608791e-01   +2.046797404840461e-01   +5.447091885550024e-01; +1.803495172708710e-01   +2.665022154929290e-01   +4.115340225156526e-01   +8.289882325832296e-01   +8.394744496929216e-01   +5.059783870866151e-01   +1.611496917274445e-02   +8.237899270379527e-02; +2.351860522701577e-01   +4.771042469282671e-01   +3.938518113012631e-01   +7.664938726526094e-01   +8.475070057050798e-01   +2.109172050501357e-01   -9.973899005428301e-02   +3.251806784415537e-01; +4.208653365339158e-01   +6.520168509624887e-01   +8.980624257793950e-01   +7.242320183137210e-01   +6.746704033292410e-01   +4.597767452992031e-01   +5.816377363361795e-01   +1.382426854476595e-01; -3.551049220388047e-02   +3.322330341199810e-01   +1.000000000000000e+00   +3.997018276178781e-01   +1.548619576197013e-01   +6.816325561092716e-02   -7.696662645930234e-02   +4.149752407178678e-01; +3.077141947504942e-01   +5.294335447739779e-01   +4.543696604250289e-01   +1.292117609405426e-01   +3.098258350489108e-01   +2.026710982156346e-01   +5.769366479961526e-01   +9.798724104285452e-01; +7.635875732367823e-01   +3.271576305847197e-01   +3.291292072369409e-01   +1.138999662991609e-01   +4.632273009636012e-01   -1.238726920358342e-02   +7.592710193109046e-01   -5.529467035427052e-02; -4.122812954244039e-02   +5.680905933921484e-01   +3.346678077672279e-01   +4.667169898594932e-01   +6.045241407104829e-02   -1.047480794361148e-01   +6.913235454716548e-01   +1.107477389749973e-01; +3.157865220413600e-01   +5.496711436148653e-02   -2.019704814674943e-01   +7.150062784002509e-01   +4.583375886173088e-01   +4.867559245687497e-01   +3.463188226708298e-01   +6.003883184234726e-01; -1.266843972949211e-02   +8.793774048077234e-01   +6.430360286461686e-01   +4.543887809911948e-01   +4.422188438469472e-02   +8.234622904823106e-02   +4.511266627624530e-02   +6.605537728309592e-01];
L2I_L3I_iGABA_netcon = [-2.780393919946945e-01   +1.405563578138505e-01   +5.790735746677239e-01   +4.236355533389319e-01   -1.462836927126551e-02   +6.881531925814439e-01   +2.816055846966791e-01   -2.774962734666274e-01; -3.524021476671101e-02   +5.079787562846867e-01   +1.800047482618921e-02   +1.073391184863342e-01   +2.836881907953185e-01   +1.288777497876858e-01   +1.521324860031987e-01   +3.629039239475761e-02; +5.866382446865659e-01   +4.542900025985372e-01   +1.309533382288076e-01   +5.666087684196381e-01   +1.607782746937502e-01   +9.849384324978284e-01   +2.455443990424359e-01   +8.861155211357516e-02; +1.441158767058218e-01   +4.486204181069202e-01   +6.170280985596659e-01   -2.250066719987101e-01   +2.306845993172641e-01   +2.666726430768350e-01   +6.842551736939391e-02   +4.355988193290089e-01; +6.638651248303117e-01   +5.226943538394143e-01   +1.234036532683857e-01   +3.796481746456175e-01   +2.508585949445718e-01   +3.106944662191774e-01   +1.061049619521244e-01   -1.013032292790426e-01; +4.570327057824590e-02   +2.862028324707956e-01   +6.991432931968585e-01   -3.972621873941385e-01   +1.384436624682335e-01   +6.294702949087524e-01   +6.856936834637403e-02   -6.889790753859040e-02; +7.022144912502054e-01   +2.006418808708034e-01   +3.346852133644760e-01   +3.965186765880584e-01   +2.149479437114090e-01   +4.232722305472541e-01   +6.199320630834305e-01   +2.615933791512450e-01; -2.610398481781223e-01   +7.125325263018217e-01   -1.341928582753087e-01   +1.443167324264268e-02   +2.137752967654473e-01   +1.313911954672201e-01   +4.714453336893782e-03   +5.807668948829817e-01; -3.916078061508743e-01   +4.911492283807656e-01   +4.831862827570541e-01   +1.571159702867418e-01   +2.115332382053308e-01   +5.421272219774650e-01   +2.892259778867143e-01   +4.568341004440386e-01; +5.349767945335526e-01   -1.075702528895922e-01   +4.914777131939823e-01   -9.562084213340098e-02   +4.196526800026623e-01   +5.828869657348038e-01   -9.037675415425925e-03   +5.089156935016312e-01; +6.927704812346051e-01   +1.753117309301295e-01   +3.747239027714051e-02   -5.847965374373158e-02   +6.043521521187002e-01   -1.676754619501389e-01   +4.516537357691111e-01   +8.115951258345148e-01; -2.225745578838643e-01   +4.066587450775860e-01   -2.255770186017858e-01   +5.198900917637852e-01   +7.364251780222922e-01   +1.371247730157581e-01   +1.696279745079537e-01   +5.850843340503233e-01];
L3I_L3E_iAMPA_netcon = [+5.609745316023383e-01   +4.691747634893003e-01   +4.527331595069153e-02   +3.275175955481833e-01   +3.076227383254446e-01   -8.288687982372936e-02   +3.306825315105288e-01   +2.137771297989951e-01   -6.267654806411017e-02   +5.356345677353208e-01   -1.053995896148747e-01   +5.492651946129079e-01; +2.544013885347131e-01   +3.009024151739863e-01   +4.353345858263610e-01   +6.327751914349136e-01   +7.918689109336866e-01   +1.518281877335862e-01   +1.486729676234699e-01   +4.286316502551484e-01   +6.543088576516377e-01   +3.092196241609286e-01   +5.932630733300952e-02   +1.752999231585142e-01; +5.650652827487930e-01   +6.918211798486928e-01   +9.102842235357540e-01   +3.699678232218014e-01   +6.150689760134004e-01   +2.829570350920393e-01   +5.335249281579327e-01   -2.080882546983727e-01   +5.546418361135852e-01   +7.594866648353438e-01   +1.350105289831085e-01   +5.057859714009274e-01; +3.225387699221033e-01   +5.652074356051179e-01   +4.195003410454027e-01   +2.364606714577731e-02   +3.043770429331432e-01   +6.788229960661161e-01   -2.863380794271199e-01   +4.229202591847777e-01   +1.925977219712676e-01   +2.086634332510266e-01   +1.803104568676890e-01   +4.365147684273235e-01; +3.160532772132719e-01   +1.703593239605063e-01   +8.373786322937348e-01   +9.904301445414692e-03   +2.871084964085203e-01   +2.108779632522563e-01   -9.915415947790607e-02   +3.189174916157295e-01   +6.163329418688704e-01   +4.806203197229083e-01   +5.572914650169231e-01   +2.342209101227481e-01; +8.944608052511811e-02   +1.514312518689770e-01   +4.048881194662300e-01   +1.033290843114092e-01   +1.267680511406855e-01   +8.403123725984606e-02   +3.930728025297954e-01   +2.026296864663373e-01   +2.866408273701690e-01   -1.548065574733999e-01   +3.397350598499315e-01   +2.867058846792464e-01; -1.659373844338417e-02   +2.009370865518680e-01   -2.806399516558091e-01   +1.118584122893387e-01   +4.620184910357473e-01   -3.091775631969338e-02   +4.798198424600233e-01   +4.487050274670166e-01   -1.658760305181816e-01   +2.892339091401430e-01   +5.561752874801824e-01   +2.428263587125547e-01; +2.248565738384615e-01   +2.898220359848734e-01   +4.303760511857896e-01   +2.474104108215121e-01   -1.393782995496485e-01   +3.353669868865292e-01   +1.474427535216928e-01   +4.184271403466800e-01   +2.104743142006022e-01   -2.029362518205619e-01   +1.596997476872675e-01   +4.628073354984632e-01; +1.054179885888967e-01   +6.660008684222775e-01   -1.009279054924764e-01   +3.879541270484647e-01   +2.311196193103969e-01   +7.696012232517633e-01   +2.091458599365576e-01   +6.185541013709904e-01   +5.336479013251570e-01   +3.945632788464163e-01   +6.596531102873588e-01   +7.706259011398491e-01; +7.558223741853523e-01   -3.333379016894152e-01   +7.812974444872683e-01   +3.240722980340560e-01   +4.560893998281905e-01   -3.187990865024505e-01   +3.716613477054920e-01   +2.421356431017047e-01   +3.319034913799918e-01   -1.018818529907376e-01   +8.032841137187147e-01   +7.576783314904199e-02; -1.211993678053135e-01   +2.646173400393889e-01   +6.039241846332646e-01   +3.916424001915967e-01   +5.850957972993616e-01   +1.845495138523797e-01   +3.318879591619105e-01   +3.494115465321854e-01   +7.994446262811401e-01   +1.030143919639389e-01   +3.663417003441541e-01   +4.307393339783013e-01; +1.889045450349759e-01   +3.022724571839792e-02   +4.093985936046360e-01   +2.776396924039644e-01   -5.776827647521292e-02   -1.174257970543842e-01   -1.123007782855816e-02   +2.023054559324284e-01   +8.937001262428501e-01   +4.805498324039838e-02   +2.542233286235489e-01   +1.306783404761983e-01];
L3E_L3I_iGABA_netcon = [+1.287495986104241e-01   +5.057197878242988e-01   +1.103714768455767e-01   +3.770423212913763e-01   +3.508396432381777e-01   -6.102746744148300e-02   -9.019715267411942e-02   +9.137333708938873e-02   +5.976436746343090e-02   +3.779735540235467e-01   +3.688721414546966e-01   +6.426598004412995e-02; +2.928290609392147e-01   +2.599873849257644e-01   +2.975549693501045e-02   -7.993441914665897e-02   +2.878611063029011e-01   +1.422556988239183e-01   +1.167562549925771e-01   +3.032137698941230e-01   -1.554976553155321e-01   +8.951158172974626e-02   +7.109242046190389e-02   -1.059184923141774e-02; +3.818770109615883e-01   +1.362468468110385e-01   -7.830362100647696e-02   +1.215840094043898e-01   +3.253602937813688e-01   +4.185854174961569e-01   +2.021842104161710e-01   +3.071195880482319e-01   -2.206539943456687e-01   +3.457379873426404e-01   -1.248283910671013e-01   -1.076685373576834e-01; +1.304443644438708e-01   +2.972599592144454e-01   -2.485931803573383e-02   +5.814308584910279e-02   +5.707236875094632e-01   +7.926869936874298e-02   -2.945526653077781e-01   +1.075721041519840e-01   +6.174960101665404e-01   +4.916733987999110e-01   +3.000858053155387e-01   +2.513324834111180e-01; +3.451447073232261e-01   +1.711934413356421e-01   +1.662699803621731e-01   +5.575959197445212e-01   +1.732710178095579e-01   +2.986729827507421e-01   -2.922450693622859e-01   +4.180878182585958e-01   +2.950804077664627e-01   +5.921331289219949e-01   +2.968460430338845e-01   +3.786181257930709e-01; +3.549503223764785e-01   +1.111120517193341e-01   -1.011467448906410e-01   -1.145410355542685e-01   +4.657414836869349e-01   +4.400157835433675e-01   +1.313834585611975e-01   +3.246068525213738e-01   +3.891894129798392e-01   +4.256756871636383e-01   +3.491668850618772e-01   +1.583598117708331e-02; +5.115877653511104e-02   +3.549941828983308e-01   +5.542505736051341e-01   +1.000000000000000e+00   +2.354008057624533e-01   +2.222134256576270e-01   +5.429167107608921e-01   +5.557359745932764e-01   +1.987425935118718e-01   +4.394829610129544e-01   +5.861688692541767e-01   +2.748995976058155e-02; +2.215628757861912e-01   +1.359149818515517e-01   +2.945637045528687e-01   +3.043123118794976e-01   +2.675049223082758e-01   +1.890776248501175e-01   +3.394041859514624e-01   +2.491259123980891e-01   +1.878979480305707e-01   +2.990033602674197e-01   +4.092276262518295e-01   +2.024835940521608e-01; +1.352330703145319e-01   +3.085336117522303e-01   +1.279854528411960e-02   -3.938736933753734e-02   +1.442103543024545e-01   +1.211942990143256e-01   -1.424433184110395e-01   +2.775428499414737e-01   +6.179887087154250e-01   +6.242955737170544e-01   +4.926491127270847e-01   +3.400483765933195e-01; -1.561426401136852e-01   +1.119287525573422e-01   +4.294500078991144e-01   +6.005017868808393e-02   -1.420415605430650e-01   +5.826756277585109e-02   +3.169336370116209e-01   +7.456390483781788e-02   +3.095706396279798e-01   -4.271782323977193e-02   +3.107542435684502e-01   +2.802590486043501e-01; -7.040908771601988e-02   +2.142201118021989e-01   +2.231379486407421e-01   -1.951431963518732e-01   +3.756744597569917e-01   -2.725648850763427e-02   +3.333096227808821e-01   +2.526605182114695e-01   +7.841222065510792e-02   +2.811730496874347e-01   +1.700245260609774e-01   +1.166708937240646e-01; +2.930690666409775e-01   +3.463107540617167e-01   -1.505754074576211e-01   +3.858026419959029e-01   +8.352640603500593e-01   +6.552440529506363e-01   +5.629622720198100e-01   +2.752033894819136e-01   +6.447403304397932e-02   -3.165353970736866e-02   +1.259997973102773e-01   -9.695961694874954e-02];
L2E_Input1_iAMPA_netcon = [+4.459699732773912e-01   +6.547663216372862e-01   +9.109027061930612e-01   +9.035113188720771e-01   +6.825564431830271e-01   +7.177085536388277e-01   +5.201261342563354e-01   +9.804824311718086e-01];
L2I_Input2_iAMPA_netcon = [+6.082093094301034e-01   +5.579490798413096e-01   +7.133727530369498e-01   +6.490839903423935e-01   +1.706374276841115e-01   +9.991578703606067e-01   +3.705599787555039e-01   +2.985434684684209e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
