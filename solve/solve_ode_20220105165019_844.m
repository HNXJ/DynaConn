function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+8.234021695655994e-01   +4.228664907658536e-01   +5.306037145428830e-01   +6.371695308094734e-01   +6.006517440710081e-01   +3.408819977363680e-01   +6.478819619727785e-01   +8.400636546117183e-01   +5.451439832606370e-01   +1.929880808849274e-01   +4.434055084856856e-02   +8.224500451536114e-01   +7.677383237217505e-01   +1.102664763630894e-01   -7.782510602243226e-05   +8.425903288922205e-02; +9.832853020174036e-01   +9.513074855540062e-02   +3.242431420072777e-01   +9.571586799508759e-01   +3.873453490726533e-01   +6.058740087368486e-01   +6.785294350360844e-01   +8.316391670044033e-01   +7.224999488597476e-01   +1.385142116610158e-01   +7.537870940265271e-01   +4.297834803699776e-01   +1.680322784134753e-01   +1.358071830911874e-01   +8.651471360366568e-01   +6.270032551128305e-01; +7.310559839440455e-01   +5.980642318883366e-01   +1.057149927388460e-01   +2.419736933237240e-01   +9.161679393639663e-01   +1.913993664341586e-01   +6.353275635237214e-01   +2.558478407969186e-01   +5.220977257042665e-01   +6.958957496211166e-01   +2.423416126476455e-01   +8.873218288324384e-01   +8.634747664035410e-01   +6.789044129783579e-01   +6.125094011944541e-01   +6.615640699671644e-01; +3.440113160195540e-01   +4.723515061543454e-01   +6.116370355639010e-01   +6.758630248751266e-01   +6.838831868792261e-04   +7.388311298310564e-01   +9.454546718086894e-01   +6.132529550836053e-01   +9.930899370123850e-01   +9.272955317125059e-02   +4.429995093298746e-01   +3.916211769888117e-01   +9.906826328570593e-01   +4.945538488695254e-01   +9.893604237961382e-01   +7.297656808559263e-01; +5.854758326642056e-01   +6.963313133354934e-01   +7.793907506927809e-01   +2.883656107083051e-01   +4.622565128200202e-01   +2.424901871648442e-01   +2.088678935623472e-01   +5.828708121770834e-01   +2.204257202870804e-01   +5.240690325768762e-01   +6.875416319168445e-01   +7.694780897762450e-01   +5.158395531143775e-01   +1.894059369652720e-01   +5.262617342380087e-01   +8.922943443395440e-01; +1.091534818980599e-01   +7.010417825538873e-01   +4.243153220876146e-01   +6.707037317976435e-01   +4.248450196622829e-01   +9.182441065402187e-01   +7.097540232859497e-01   +5.404106042284949e-01   +1.050219162236264e-01   +5.310492514836915e-01   +3.587918788564056e-01   +3.973552170041517e-01   +8.843726605988401e-01   +4.943302551706358e-01   +4.805551575863210e-01   +9.825909231995529e-01; +9.060129679503686e-01   +6.394626823838867e-01   +9.053057215618758e-02   +6.949718750662348e-01   +4.611178682271870e-01   +2.703714873355980e-01   +2.370173736849184e-01   +8.708124257929485e-01   +1.110592478523643e-01   +8.622951934018480e-01   +7.365944424186681e-01   +8.097898963687056e-01   +5.873830770402521e-01   +1.479341663875076e-01   +8.017253723307322e-01   +7.690130143796128e-01; +8.803450912177727e-01   +3.393286440948611e-02   +2.658210189906974e-01   +6.708465855073413e-02   +7.703117139063994e-01   +7.655871575000770e-01   +1.195130166686720e-01   +2.642131224147282e-01   +6.538813573077916e-02   +4.851963110732193e-01   +3.940481391828687e-01   +7.551724808645074e-01   +1.543755573125561e-01   +5.358373102788170e-02   +2.289645388122882e-01   +5.828159434766483e-01; +8.174567383493280e-01   +6.841157105040779e-02   +1.530613449341302e-01   +2.537434868255040e-01   +3.234676555972272e-01   +1.894508005133572e-01   +6.074883525840207e-01   +3.168512638419045e-01   +4.040871233678810e-01   +3.927549070600247e-01   +6.845519903401299e-01   +3.774658878056028e-01   +1.995911115112991e-01   +8.512250306324863e-01   +4.969968765353615e-01   +9.264911389326846e-01; +2.604125741535295e-01   +3.189059987517374e-01   +2.815091361080995e-01   +2.219777487819219e-01   +7.847024124862929e-01   +2.865149657734531e-01   +4.511310418065043e-01   +1.191983564337683e-01   +4.473736818330679e-01   +6.722386481814225e-01   +7.040838245215957e-01   +2.168552119301861e-01   +4.071357301303784e-01   +5.619040416645870e-01   +8.988908027227791e-01   +5.810488481918782e-01; +5.941081477246346e-01   +5.302523935451497e-01   +4.415044276476994e-01   +6.685668813685248e-01   +4.705165662055864e-01   +9.086891031357615e-02   +4.587293789473573e-01   +9.401539717096812e-01   +3.654152232368309e-01   +7.424422242350874e-01   +4.427567688878827e-01   +7.902697257508723e-01   +7.481998076011969e-01   +9.301743403632953e-01   +5.756703443617266e-01   +1.590768235354286e-02; +2.252643334831238e-02   +6.535385211962792e-01   +5.265925196958411e-01   +8.439569497534379e-01   +3.544987061004678e-02   +5.780552728695358e-01   +6.622812615643384e-01   +6.465752644954068e-01   +7.621642163998171e-01   +5.188001268395104e-01   +1.870023173259297e-02   +9.494406222266490e-01   +8.242007188204724e-01   +6.978241263732345e-01   +8.447226973020646e-01   +1.213785025761385e-01; +4.262246050862848e-01   +4.078284256411834e-01   +4.583553737800347e-01   +3.454814916832351e-01   +1.769723132898501e-01   +6.838021574258817e-01   +7.698858902129192e-01   +4.801050773518790e-01   +6.269277404285325e-01   +3.458158512020507e-01   +3.297709352378108e-01   +3.289058214811991e-01   +7.912719837902831e-01   +5.838845392327260e-01   +7.388590301155984e-01   +8.620477150520839e-01; +3.123600499138772e-01   +8.190585559926979e-01   +8.746797591928055e-01   +7.814991542205062e-01   +7.207591673562850e-01   +5.474467123630578e-01   +3.501560751467454e-01   +6.394274960405810e-01   +7.724606166538499e-01   +1.494725077044371e-01   +4.234813719585961e-01   +6.721196161215980e-01   +3.187257719277856e-01   +8.158335867327101e-01   +5.858392630704566e-01   +4.831786613659393e-01; +1.603302329324517e-01   +7.196951626910978e-01   +5.191870595744255e-01   +6.763771528351769e-01   +4.738000830675348e-01   +4.246630670219775e-01   +6.619760765144245e-01   +5.445449179587982e-01   +9.335759324410771e-01   +5.868739395524191e-01   +2.695484038520057e-01   +4.404909828224945e-01   +5.336915874917783e-01   +8.805036989232102e-01   +2.454378034061468e-01   +8.446943470800998e-01; +1.780328938310773e-01   +9.686200243039561e-01   +9.449976543557909e-01   +7.622492043447232e-03   +1.530274574306911e-01   +6.434976017973959e-01   +4.155105921334069e-01   +6.467796235897930e-01   +9.731434237448013e-01   +2.614424424309316e-01   +1.970147280365407e-01   +8.323471177493502e-01   +9.026054491678225e-02   +9.896807135679908e-01   +6.656143732401602e-01   +2.096449575977659e-01];
L1E_L1I_iGABA_netcon = [+5.511676598911559e-01   +6.946047338142476e-01   +1.049707117263922e-01   +1.772255510490056e-01   +5.546218913950217e-02   +1.790331700484082e-01   +5.961210080765152e-01   +9.964981707637915e-01   +3.388925171794051e-01   +7.791366286129693e-01   +6.827769744022931e-01   +3.652825372298853e-01   +7.827010263948831e-01   +4.327405465127322e-01   +5.933497630991925e-02   +9.759642683948808e-02; +6.312448375525258e-01   +4.990996686477953e-01   +1.422193874693422e-01   +3.984368527870859e-01   +1.778914039232699e-01   +3.604276671483119e-01   +3.006297919212195e-01   +3.304674116885615e-01   +2.938075566764305e-01   +3.381451966956548e-01   +1.313573932617353e-01   +3.690618066930075e-01   +1.007284064241351e-01   +6.547525814106675e-01   +3.148250184310773e-01   +1.418688735748536e-01; +3.261602068096033e-02   +5.348759562786801e-01   +1.664333109521941e-01   +1.332670128418219e-01   +6.613385205859251e-01   +5.637262729233005e-02   +1.342704276125806e-01   +2.970052952135168e-01   +7.456134977274302e-01   +6.075887787603568e-01   +7.223366524042015e-01   +6.840645396931901e-01   +2.934129034117953e-01   +1.108439949636472e-01   +7.721662824677850e-01   +1.692063128700691e-01; +6.147326676091203e-01   +4.434349831099198e-01   +6.221179618203628e-01   +2.952019544885116e-02   +3.320696004344620e-01   +5.218335626735070e-01   +2.115577027865280e-01   +6.283816961678758e-02   +1.081408109028546e-02   +7.408836116118822e-01   +1.103452334720653e-01   +5.978653967164512e-01   +2.362627285175313e-01   +9.325014738027163e-01   +6.954962849519319e-01   +1.951249695043658e-01; +3.632899236932473e-01   +1.237508519786493e-01   +5.737269335946653e-01   +9.380891134288109e-01   +8.982440558205504e-01   +3.345468715344962e-01   +8.960824004515435e-01   +2.978332456524777e-01   +4.787028077207638e-02   +1.052425216971838e-01   +1.165906882827890e-01   +7.881144965815813e-01   +5.303833022745869e-01   +1.856695225922999e-01   +1.247585424239522e-01   +3.174776270534596e-01; +4.977594302429217e-02   +4.912210876369810e-01   +5.265143153986317e-02   +3.017706849617271e-01   +1.174931907928240e-01   +1.742586585868646e-01   +7.193169980449281e-02   +4.485784843380213e-02   +6.678312464194532e-01   +1.268934018324890e-01   +6.400502406151262e-01   +3.682930481036873e-01   +9.218599083949196e-02   +2.672351502169811e-01   +1.283979649907807e-01   +3.172480360838496e-01; +4.878958105533052e-01   +8.521986844844547e-01   +9.323121396244789e-01   +2.962092960025002e-01   +9.886973232115736e-01   +2.100969897174330e-01   +2.432216393321939e-01   +5.052421710549365e-01   +6.041166676559676e-01   +5.492685672434366e-01   +3.288345806823468e-01   +2.059281533781628e-01   +4.058310735176407e-01   +7.980338820319079e-01   +9.218182348880674e-02   +2.171109640803724e-01; +1.921909485156132e-01   +8.745829535095520e-01   +7.278980446777290e-01   +3.347786532739133e-01   +5.418729686795544e-01   +9.056099686882076e-01   +5.425994792109765e-02   +7.610668321573755e-01   +5.265769324195609e-01   +4.852950322667391e-01   +6.538874935610737e-01   +8.725231721096294e-02   +1.035229601190071e-01   +4.879159972817783e-01   +8.997219925059015e-03   +2.513567107384043e-01; +1.221539793817635e-01   +2.704883781013415e-01   +7.376167654882504e-01   +4.683829494505828e-01   +7.057037134378173e-01   +6.748067913762299e-01   +4.405463116744953e-01   +6.320712663867351e-01   +7.288765365354923e-01   +8.903380147802422e-01   +7.505886533178038e-01   +7.722281555132480e-01   +1.115029771536767e-01   +7.692632279862959e-01   +4.235005403177668e-01   +8.937869587991113e-01; +2.063630093231663e-01   +2.091311153867798e-01   +6.280246398018233e-02   +6.476307309363165e-01   +9.990521632107195e-01   +4.682897518768233e-01   +1.424295936237136e-02   +9.065899727163515e-02   +7.076995422217091e-01   +7.996863814275942e-01   +5.840442768236392e-01   +2.075192999731497e-01   +7.856108744388707e-01   +3.969939421454758e-01   +6.551848852769592e-01   +7.024339363123976e-01; +1.468600942973893e-01   +5.639158077916585e-01   +8.594868348237736e-01   +2.414434266150739e-02   +2.885256330430878e-01   +9.123094935117043e-01   +8.967431527044605e-01   +8.029943443500152e-02   +7.807626465850218e-01   +7.348283847667123e-01   +7.411723573850624e-01   +3.890911871794975e-01   +2.912404154217887e-01   +2.730994973906892e-01   +7.229756735311672e-01   +5.549757188208175e-01; +1.889305436186995e-01   +6.387956395374924e-01   +9.331369644240612e-01   +8.425244550870624e-01   +4.135434762895793e-01   +1.034606262562703e-01   +1.950899226847071e-01   +7.756234608786482e-01   +2.885711718099988e-01   +5.288295574363088e-02   +2.341109115646301e-01   +5.519151118194279e-01   +6.039907599456715e-01   +3.747152458115306e-02   +5.302697655317709e-01   +1.846019737745538e-01; +4.325493880652551e-02   +4.161243899601591e-01   +9.836535422715713e-01   +5.578851599398975e-01   +4.663628037143621e-01   +7.440882735231262e-01   +9.322636875574331e-02   +9.056004002028220e-01   +6.903445719539296e-01   +7.226648609489900e-02   +7.344768154167703e-01   +2.288916760893450e-01   +9.635036314941425e-01   +6.738830829778200e-01   +1.078582285019406e-01   +2.113874154019865e-01; +6.354719653781460e-01   +2.066758582237855e-01   +8.573312794613421e-01   +8.539449442311395e-01   +7.645200448815035e-01   +7.374013493250297e-01   +3.072083698736872e-01   +5.329562868611577e-01   +5.561924158939304e-01   +8.714891394733298e-02   +9.706880313719647e-01   +6.417134189981298e-01   +4.319061109721398e-01   +4.297045072782622e-01   +6.327868461087038e-01   +7.742376852422521e-02; +2.819141398697612e-01   +9.485391424185636e-01   +7.859729630598965e-01   +3.487071141113429e-01   +8.172479214256381e-01   +5.615671874265766e-01   +4.558961736452296e-01   +1.085024178860616e-01   +3.953772659515717e-01   +7.965667121877644e-01   +8.673610826181434e-01   +4.833631368461329e-01   +6.953189670017106e-01   +4.504727039666120e-01   +1.282774548125818e-01   +9.142315587011985e-01; +5.377921083090825e-01   +8.084002846767097e-02   +5.141737706114688e-01   +4.459786917609098e-01   +9.984867538394429e-02   +1.855028264329347e-01   +1.015117789505864e-01   +8.277514093296111e-01   +6.197188983017190e-02   +9.427191982516200e-01   +8.615365341333041e-02   +1.517644997236840e-01   +7.576827898137496e-01   +6.084662130648145e-01   +1.341619948680066e-01   +7.065833019583677e-01];
L2I_L1I_iGABA_netcon = [+5.587237224514012e-01   +1.595429478285761e-01   +4.239601831440906e-01   +6.823439244604081e-01   +8.086509214565744e-01   +7.951726577894003e-01   +7.883909626455292e-01   +2.628840801548973e-02; +3.126143599233306e-01   +7.582300601246807e-01   +4.292605244595449e-01   +4.630831092412322e-01   +7.482161976169144e-01   +5.781155981892500e-01   +8.514500251500221e-01   +4.214600343368314e-01; +1.658460121426333e-01   +8.705722086268892e-01   +1.248160977998106e-01   +2.134029072590939e-01   +1.192568262666087e-01   +4.414835646804272e-01   +5.063072025147526e-01   +1.827509834766076e-01; +6.213370540568469e-01   +3.509888568816951e-01   +2.382770810703985e-02   +9.846906593494612e-02   +5.246331925891627e-01   +2.579272633947571e-01   +6.356314449825720e-01   +7.262205382793058e-01; +9.875711127622631e-01   +6.862017866310861e-01   +2.904142327438092e-01   +8.227074153203442e-01   +3.259125832723432e-01   +7.519621444762938e-01   +9.515788364849125e-01   +3.696330339322852e-01; +1.702880773407665e-01   +2.936669208298965e-01   +3.189820480792160e-01   +1.758512640858362e-01   +5.462806684137470e-01   +2.284005226980608e-01   +4.440962205504929e-01   +8.415978664539874e-01; +2.579503072304651e-01   +5.303705318815654e-01   +6.535117671008196e-01   +1.643551090370994e-01   +4.003467098495336e-01   +6.572693700516496e-02   +5.867965067294937e-02   +7.332910903962122e-01; +3.975598158386515e-01   +8.333951748506454e-01   +9.571343170735840e-01   +6.673617285551176e-01   +4.154131422758919e-01   +7.669564141349421e-01   +8.672522063618867e-01   +5.700843827827716e-01; +7.434017623137759e-02   +5.985227741079970e-01   +9.367741963196333e-01   +8.936735281266511e-01   +1.793808644254232e-01   +6.716943295953641e-01   +6.308598811606321e-01   +1.777106137348095e-01; +6.844124359566035e-01   +3.347840897533934e-01   +4.582582707294278e-01   +5.167816113220703e-01   +2.550748956425178e-01   +7.146579382128225e-01   +3.537205192522982e-01   +9.594878102920932e-01; +4.032852638781190e-01   +2.991204073406150e-01   +2.396298851663704e-01   +7.025918316892173e-01   +1.925655589199789e-02   +6.424359541740540e-01   +9.974011469309243e-01   +2.658219634475381e-01; +9.824488228381272e-01   +4.526561874881174e-01   +7.642312637008564e-01   +1.522188968861945e-01   +9.232319245283660e-01   +4.187921757855410e-01   +2.242960899359544e-01   +9.245443569509533e-01; +4.008854611873277e-01   +4.233552750004436e-01   +7.598114913383421e-01   +9.534750823787264e-01   +6.538401359694955e-01   +3.909835974195248e-01   +6.522801997972263e-01   +2.223578908919963e-01; +6.214309382906585e-01   +3.594404271726627e-01   +7.392447817860707e-01   +5.403643732062441e-01   +9.328680943362898e-01   +8.163972546249874e-01   +6.047628226459140e-01   +3.732616094588955e-01; +1.550344822180618e-01   +5.602371066149844e-01   +7.450241801715768e-01   +6.809193692339156e-01   +1.642499250551425e-01   +3.161550958777303e-01   +3.870049926086249e-01   +8.748618819558004e-02; +3.821758868513260e-01   +7.434799327736693e-01   +1.076601161602609e-01   +3.750448713615805e-02   +9.223125730689191e-01   +8.154825532507167e-01   +1.405714279389907e-01   +6.414787273783409e-01];
L1I_L2I_iGABA_netcon = [+1.817286689138052e-01   +9.109646316466992e-01   +2.757690657174978e-01   +8.700172489287600e-02   +5.337863694706095e-01   +1.069909627977547e-01   +9.887552912498927e-01   +4.117533081584359e-01   +7.200251301975770e-01   +2.180485369086639e-01   +9.221162434223464e-01   +6.743396572187464e-01   +1.064257814038083e-01   +5.567684352685534e-01   +6.301180512802624e-01   +4.841808141397698e-01; +4.582317042101666e-02   +8.003851391611931e-01   +2.478423680732252e-01   +8.029250949499966e-01   +8.867726725235274e-01   +6.149963156488135e-01   +7.672208567078143e-01   +6.013337723800517e-01   +9.967453353137121e-01   +1.266419635906814e-01   +7.704466299479225e-01   +4.778591342118090e-01   +1.813116819715660e-01   +7.719791528473681e-01   +1.009759076776982e-01   +8.946743958415143e-01; +7.229556603778452e-01   +7.443249276694474e-01   +4.517294946416669e-01   +9.893479954066048e-01   +8.977736128940160e-01   +9.406811164332014e-01   +3.365035992861046e-01   +7.497524174874086e-01   +3.546521778440005e-01   +3.084526128995957e-01   +4.316629713119911e-02   +6.239745411653900e-01   +9.980184203920785e-02   +3.123641834263336e-01   +3.918217398793305e-01   +1.381145734923784e-01; +3.481486532988141e-01   +8.130565403437683e-01   +2.268415556559943e-01   +6.694611145063566e-02   +6.254558519819238e-01   +3.529028284395366e-01   +6.626645059928223e-01   +5.841609400663201e-01   +9.715832523999951e-01   +7.253690669063012e-01   +3.788260654566064e-01   +2.371140421701005e-01   +4.905864955937156e-01   +1.783549197940900e-01   +5.534881634360690e-02   +3.889718630333220e-01; +6.604246347588746e-01   +3.835737419860994e-01   +8.045752588204976e-01   +9.400915065555839e-01   +1.371707765888805e-01   +4.106688055122733e-01   +2.458030499849166e-01   +5.516179662192882e-01   +3.474419093377505e-01   +7.831343519826912e-01   +7.045329588628928e-01   +1.780244884398643e-01   +1.925385200718253e-01   +3.386098445873666e-01   +5.008056399296391e-01   +9.276241719924634e-01; +3.844836441564071e-01   +6.176537916239124e-01   +9.860769899680686e-01   +1.693507109041237e-02   +2.184436635666901e-01   +9.842198160799654e-01   +2.944029939037867e-01   +5.813822674713568e-01   +8.863029434864320e-01   +6.926881834037011e-01   +7.276804457734162e-01   +8.290274431459455e-01   +8.938178038493034e-01   +2.097231690918995e-01   +4.314650816906411e-01   +9.186533954880823e-01; +6.280897197212104e-01   +5.764604599357280e-01   +2.940327282604593e-02   +6.845191866767215e-01   +1.817250759032351e-01   +9.451653829182596e-01   +6.789783684862728e-01   +5.109579032374013e-01   +4.547691350043020e-01   +9.079183400750652e-03   +2.256466241475846e-01   +7.653860059322669e-01   +9.987146864857990e-02   +5.101279943523804e-01   +9.974041152108317e-01   +7.145680161854838e-01; +2.277146919566145e-02   +5.280644852310773e-01   +5.360254007738278e-01   +7.830759543537724e-01   +4.294905425610392e-02   +6.771638098234047e-01   +5.266590733638399e-01   +8.200497767803569e-02   +4.147440509247348e-01   +8.445818374335673e-01   +2.693091417111421e-01   +9.344684175135494e-01   +4.462328638854586e-02   +9.053015086675230e-01   +8.104105815594957e-01   +6.176149574104161e-01];
L2E_L1E_iAMPA_netcon = [+3.429792468521309e-01   +7.579456858374605e-01   +5.890764190501826e-01   +5.020795168567487e-01   +8.485604252849874e-02   +4.687487390756903e-02   +9.235370741755181e-01   +4.754617070927330e-01; +9.364168752552877e-01   +4.138900115870572e-01   +6.608517947123962e-01   +4.890758118563984e-01   +9.737811091560575e-01   +3.436087771130251e-01   +8.012282501324670e-01   +3.641400142065366e-01; +1.240244433764438e-01   +4.928996422182679e-01   +4.846461430973144e-02   +8.782866992001088e-01   +6.513010087537966e-01   +7.370432802411452e-01   +2.863611309914008e-01   +7.880304750571046e-01; +7.307891767280943e-01   +6.958422898857138e-01   +3.487341545037458e-01   +3.524964294225214e-01   +2.311101070024083e-01   +7.957615561914323e-01   +5.441440760120052e-01   +7.810892971632292e-01; +6.468727107563873e-01   +9.737918143608882e-01   +4.495168631752029e-01   +4.489732373801036e-01   +4.023196707432348e-01   +5.449062990709486e-01   +9.842509997092778e-01   +6.676589726928531e-01; +8.331714773243601e-01   +3.279985919312795e-01   +2.394182934957277e-01   +9.638181681022167e-01   +1.210331175289138e-01   +6.869333798430196e-01   +7.149309543505699e-01   +1.331554350129003e-01; +3.971744154514571e-01   +8.377065082353482e-01   +7.150034404588085e-01   +4.244834433782527e-02   +2.690733045421738e-01   +8.943072124670275e-01   +8.384556040007183e-01   +2.041283823005674e-02; +7.497944442551733e-01   +7.402819072347032e-01   +8.561033704303137e-01   +9.740227146143932e-01   +2.560321524106447e-01   +5.414805654996754e-02   +4.345099955101135e-01   +5.594818602893810e-01; +8.348875111382345e-01   +9.535461103888543e-01   +2.826121929358886e-01   +1.876605932989661e-01   +3.332742407775128e-01   +3.040522466962913e-01   +4.712846304996750e-01   +3.014695969649007e-01; +3.236550642192416e-01   +3.281472873383589e-02   +7.306844018285130e-01   +6.666209615063425e-01   +1.506842041605147e-01   +4.554983466662696e-02   +5.612290496540989e-01   +9.392850571219540e-01; +5.512172420099090e-01   +3.559782511605493e-01   +1.394967701261850e-01   +5.869642609654381e-01   +3.483532792779556e-01   +1.953099220905052e-01   +2.695963779906891e-01   +9.815332853645622e-01; +9.806718801335994e-01   +6.618539979122149e-01   +8.382696762459398e-01   +6.755721027681929e-01   +1.201500507111651e-01   +7.183296267248200e-01   +7.484787870219913e-01   +2.870444348947047e-01; +5.486663421679263e-01   +2.815590047914330e-01   +1.389649376071056e-01   +3.597315960870213e-01   +8.831466705384782e-01   +7.222676240182051e-01   +5.043587699025079e-01   +7.997235356781525e-01; +3.303942190288782e-01   +2.302991531978042e-01   +5.875939987875700e-01   +6.198400586367051e-01   +9.528552478920872e-02   +8.776154163896611e-01   +6.475806969354629e-01   +8.950993093891733e-01; +6.192865102710078e-01   +7.104414066647847e-01   +3.667180249987421e-01   +8.112624776546282e-01   +9.309428062031678e-01   +5.806277713595219e-01   +3.072786085624426e-01   +5.977567654877163e-01; +3.615036297171713e-01   +6.234799749412417e-01   +8.055859933301076e-01   +2.056536734787111e-02   +3.999174624185609e-01   +7.238668670946029e-02   +1.392959967510093e-01   +8.841043420235879e-01];
L1E_L2E_iAMPA_netcon = [+9.439070707672029e-01   +3.720175502586172e-01   +6.678621880306301e-01   +4.851076576863947e-01   +2.472391902418539e-01   +4.514815035035256e-01   +1.233726203721699e-01   +4.974822678244636e-01   +8.830650014882173e-01   +3.248863839788039e-01   +5.144341705059793e-01   +8.571781225694713e-02   +6.317502763221632e-01   +4.292500470868530e-01   +6.131187688798084e-01   +5.039323890470403e-01; +5.486736731103418e-01   +9.369269550593318e-01   +2.082586214553390e-01   +7.572914443814356e-01   +7.850248490911846e-01   +2.054210077475189e-01   +4.065430412334883e-01   +6.933653450763467e-01   +7.196889794044252e-01   +2.456751822102639e-01   +6.576117597829697e-01   +1.633353109069117e-01   +8.590118847859368e-01   +4.920298164666653e-01   +8.196832074458882e-01   +6.125442812491401e-01; +7.285398748477215e-01   +8.296478191158371e-01   +6.530003318797625e-01   +4.166560237859441e-01   +8.831687051134820e-01   +8.988608442374034e-01   +2.756586827645051e-01   +8.338340972277525e-01   +1.945602984764139e-02   +3.431869436325948e-01   +9.519583858367293e-01   +3.242196394387080e-01   +9.757705200254587e-01   +7.099285213668650e-02   +8.863033372361296e-01   +8.194712860816025e-01; +5.766893379757442e-01   +8.496650213153772e-01   +7.182163664190305e-02   +9.722453901024599e-01   +9.127737484618027e-01   +7.631900547692909e-01   +7.171396315837169e-01   +6.113679246409524e-01   +6.747723882073984e-01   +3.749486218100093e-01   +7.225928570693866e-01   +3.017820766471818e-01   +5.697821009857466e-01   +8.870783889138415e-01   +9.305644776331596e-01   +5.319769877507288e-01; +2.569284813964595e-02   +3.714002303571777e-01   +4.070388653216342e-01   +9.892665045232514e-01   +5.579175128883685e-01   +8.838984659754902e-01   +2.823142254835768e-01   +5.750114871804173e-01   +4.384042508721646e-01   +5.453481054384061e-01   +3.995431341219772e-01   +1.103770236190952e-02   +9.970720650022272e-01   +6.472783835879854e-02   +1.918382529740850e-01   +2.023889586084490e-01; +4.477784361126388e-01   +5.926577075751785e-01   +6.664273767848143e-01   +8.640657510207045e-01   +5.986161752932502e-01   +2.866092933323020e-01   +8.956102857413268e-01   +3.247157285774915e-01   +4.365129215195678e-01   +5.633320776079933e-01   +8.336525248750918e-01   +5.409193909763776e-01   +5.536930821942651e-01   +4.363500711002593e-01   +2.587390504026756e-01   +4.549268273718323e-01; +6.473026260684439e-01   +8.740150120705952e-01   +9.358512740911319e-01   +3.886626105788085e-01   +1.476860978879650e-01   +6.717165499820906e-01   +8.267692756425651e-01   +4.557217690233389e-01   +1.158000224602618e-01   +3.953868665365527e-01   +1.346749864054855e-01   +9.594694338259441e-02   +5.151531558587895e-01   +8.256865278732367e-01   +8.970239501251165e-01   +4.284973845523933e-01; +5.217455608383172e-01   +9.341165239366962e-01   +8.100058424376803e-01   +4.536701310781634e-01   +9.009030180505438e-01   +6.639534666908077e-01   +3.905211438848116e-01   +7.147789849983903e-01   +8.140129224512310e-01   +3.974716870581976e-01   +6.046812321258691e-02   +1.472981361145285e-01   +3.315011077503795e-01   +3.930541226769569e-01   +5.937062518353206e-01   +9.659007680946710e-01];
L2I_L2E_iAMPA_netcon = [+6.188969409563563e-01   +6.953621788901487e-01   +7.333247146053711e-01   +5.905371738710775e-01   +6.695472496933006e-01   +5.490976860492128e-02   +9.857916837567184e-02   +8.487410964759308e-01; +6.967082782098339e-01   +4.260198820944623e-01   +4.298819211154167e-01   +4.588708579148548e-01   +5.002134894165574e-01   +1.529933717119694e-01   +9.078179287584383e-01   +9.167928183068399e-01; +7.213904214918460e-01   +8.369453515931853e-01   +6.943278901482606e-01   +5.112042342243815e-02   +2.186313715909559e-01   +2.023882548897974e-02   +1.098015784431859e-01   +9.872365236272499e-01; +3.469135121504405e-01   +7.308459119124183e-01   +9.454528676330084e-01   +2.287082494599651e-01   +5.728225391053730e-01   +4.345803730388414e-01   +5.174121870882454e-01   +5.035284445495334e-01; +5.178478610210494e-01   +3.602403515742704e-01   +7.835196910109266e-01   +8.338911122343403e-01   +1.218851616343214e-01   +8.316763193710289e-01   +1.433772863460264e-01   +2.708949854850604e-01; +5.571251567354859e-01   +4.543687000742923e-01   +7.060837354618585e-01   +1.474417469486928e-02   +6.712888426169505e-01   +6.160539023589471e-01   +5.593763888790005e-01   +1.008217051305347e-01; +1.576021405875554e-01   +3.869166868188046e-01   +1.095004962926115e-01   +8.640049510637390e-01   +5.998345596317409e-01   +5.195805260356701e-01   +4.694251319044492e-03   +5.078219372547191e-01; +5.633997834075409e-01   +7.750396880735629e-01   +3.900300007235510e-01   +7.903333050655781e-02   +5.578819568028544e-02   +8.637345476996292e-01   +7.670884049861006e-01   +5.842372032888997e-01];
L2E_L2I_iGABA_netcon = [+7.643198965761109e-01   +9.418900151716343e-01   +2.387886853931000e-01   +8.340055115445201e-01   +2.572555141833848e-01   +7.473435977911611e-02   +1.738156226555407e-01   +5.234417043547183e-01; +8.300497895568064e-02   +6.576214756702742e-01   +5.786110453790184e-01   +4.029688508735089e-01   +2.983296245238353e-01   +3.943908225511666e-01   +1.393409094639516e-01   +2.649131449775900e-01; +6.607196686063319e-01   +4.518571053896410e-01   +8.665150630039193e-01   +3.907530858576898e-01   +4.253176474786729e-01   +3.509396074270913e-03   +5.986458549672514e-01   +6.817920244315204e-02; +5.171994467055111e-01   +8.393043056168327e-01   +4.060593641834510e-01   +3.621212488484657e-01   +1.187005761798357e-01   +2.193893927271448e-01   +8.998711430830953e-01   +4.364810926192543e-01; +1.719428362247422e-01   +5.335685534143025e-01   +1.115162837094918e-01   +1.387646348685969e-01   +4.969862066628131e-01   +9.123816021851866e-04   +9.392523825259529e-01   +1.725125752390084e-01; +9.393298189924548e-01   +5.540014846447647e-01   +4.436308661660577e-01   +2.581933944333012e-01   +7.064765778549075e-01   +1.903417571528001e-01   +2.203046751807531e-01   +2.714215052863498e-02; +5.909051970520672e-01   +6.807834054496099e-01   +2.984320924305107e-01   +8.644538607051372e-02   +2.433912560534409e-01   +1.421440390744813e-01   +4.809912983018994e-01   +9.539426318125830e-01; +4.410786439018122e-01   +3.672579514449803e-01   +4.003535338969946e-01   +4.293910415421331e-01   +7.845301999560713e-01   +2.672643002181786e-01   +3.760196994568939e-01   +4.303460055080925e-01];
L3E_L2E_iAMPA_netcon = [+9.619537874988288e-01   +7.727446812279282e-01   +9.106132393079276e-01   +5.315269265014988e-01   +4.855669276309921e-02   +8.190456024397060e-01   +6.252114998354107e-01   +7.483807738929070e-01   +6.736864957489810e-01   +9.050860521652022e-01   +5.827554953603623e-01   +5.939834152896299e-02; +7.622283186825975e-01   +2.276668419375425e-01   +9.074474079529367e-01   +7.167814890695735e-01   +5.521885935888985e-01   +7.272207778750168e-01   +5.421383259412123e-01   +6.462120789738728e-01   +4.320781860000923e-01   +3.933366697550117e-01   +6.866477103479995e-01   +9.803557060576318e-01; +7.906771004971815e-03   +3.706596104729394e-01   +5.910606756908924e-01   +1.797709574799307e-01   +2.747933257827039e-01   +1.768097744728165e-01   +4.381324795726043e-01   +1.223392552403059e-01   +6.933711659205416e-01   +2.586963671439691e-02   +7.203413165880708e-01   +2.853208780682095e-01; +6.793401855294141e-01   +8.917309390224666e-01   +3.312876163809758e-01   +3.352691068833908e-01   +2.427526285035999e-01   +3.606169281693588e-01   +2.870376084038402e-01   +5.052842375657579e-01   +2.568412093303806e-01   +6.704718375937195e-01   +6.495057730625108e-01   +5.942554391142812e-01; +7.049727156334145e-01   +8.566813784598074e-01   +8.533572857680931e-01   +1.868454359981176e-01   +2.423669281343689e-01   +1.875959622804318e-01   +5.013425227978549e-01   +3.474147683026357e-01   +1.189387769202607e-02   +8.376614703607722e-01   +7.260170161409070e-01   +9.609063361719000e-01; +6.449484232600600e-01   +4.012934991221905e-01   +4.428147728665098e-01   +3.214207206932106e-01   +1.544905006654786e-01   +1.258908786831574e-03   +7.629297943820745e-01   +9.115046547919099e-02   +5.316676962440675e-01   +9.714128360040365e-01   +3.743392860617524e-01   +1.867883653925957e-01; +5.529350683506458e-01   +3.191480815622549e-01   +9.028210254812471e-01   +4.042580182447837e-01   +9.584894490576552e-01   +3.148552014622462e-01   +7.619014125272808e-01   +1.477052817788082e-01   +2.797697030446332e-01   +5.679015589368538e-02   +5.806268731936801e-01   +1.925236705858291e-01; +2.178959216207816e-01   +6.092136405757517e-01   +3.390315759264802e-02   +5.492986288006355e-01   +9.366832028113402e-01   +6.988415032904084e-01   +5.761637201141842e-01   +1.987340490490223e-01   +9.458466864808600e-01   +4.495935592158429e-01   +1.144809266884620e-01   +3.409548308627219e-01];
L3I_L2I_iGABA_netcon = [+9.335532578363970e-01   +9.277753111246750e-02   +6.179850123162262e-02   +2.783981901246220e-01   +2.551443904493838e-01   +4.038292939611254e-01   +5.295623784032105e-01   +1.086797674714984e-01   +9.126446334157605e-01   +5.850265875758905e-01   +2.084527897524647e-01   +9.084489231036279e-01; +3.903787171919987e-01   +6.161090901247371e-01   +4.948203438246391e-01   +7.457751000022866e-01   +8.577259428878776e-01   +9.885960092451086e-01   +8.291123793788313e-01   +2.711636173545668e-01   +6.389327274802551e-01   +2.839580781472345e-01   +3.175964794543518e-01   +5.514108453763944e-01; +2.725755012995862e-01   +1.130080305411603e-02   +6.433678250914642e-01   +2.380446358084279e-01   +9.112479077556882e-01   +8.999574080431828e-02   +8.571755113959990e-01   +5.234143245456412e-01   +2.546778677329880e-01   +8.273675496655346e-01   +1.335455136769259e-01   +3.415440346947723e-02; +1.527146358528553e-01   +5.732432189103384e-01   +2.222098025109424e-01   +9.571165669961821e-01   +6.991317160942364e-01   +3.219143582936682e-01   +7.884976860567255e-01   +9.725535016486402e-01   +9.023729164296518e-02   +1.918430174954552e-01   +6.724237845852924e-01   +5.414988475495520e-02; +3.970147723653460e-01   +7.884395226697027e-01   +8.377066604319019e-01   +6.212695714758460e-01   +7.265843281681479e-01   +5.125638728967170e-01   +3.186591260935706e-01   +7.091185126204556e-01   +8.381456697341243e-01   +4.414826457492613e-01   +5.706176026441933e-01   +8.057013378886245e-01; +3.751954532548761e-01   +2.362754444985278e-01   +9.707879655352226e-01   +6.010131883407270e-01   +2.293422118405970e-01   +5.963367989317191e-02   +4.520773228438695e-01   +3.104387783770768e-01   +5.842741695708323e-01   +3.932254842453449e-01   +1.707270259500848e-01   +4.514548100316650e-01; +1.295391803543608e-01   +4.478925158651174e-01   +8.469568935372264e-01   +1.734456069297393e-01   +5.745000332481963e-01   +7.254625194683908e-01   +7.522966902493895e-01   +2.932952885322196e-01   +9.480771680889697e-01   +8.267687882609408e-01   +1.478951526858104e-01   +3.812290600391976e-01; +4.347861283224567e-01   +5.693396578731214e-01   +5.060747643711749e-01   +8.990890205994252e-02   +8.108203443095419e-01   +5.575091105648861e-01   +1.107521944365256e-01   +8.492591286350024e-01   +6.124342174803436e-02   +6.780268713676580e-01   +4.755499197806963e-01   +7.902055445139793e-01];
L2E_L3E_iAMPA_netcon = [+3.651823442289902e-01   +7.566272538419749e-01   +7.359264448900250e-02   +5.177841205329650e-01   +7.572958650107363e-01   +4.326212652623949e-01   +1.999049113455324e-01   +8.759892803182746e-01; +5.309220062967406e-01   +9.972842684920511e-01   +5.917366638785773e-01   +9.952482671229483e-01   +9.958421149799208e-01   +5.434638081075895e-01   +1.938469064715964e-01   +7.863096833541847e-01; +7.129753217388235e-01   +1.874461070370066e-01   +9.110416259429862e-01   +8.566452155371030e-01   +9.628073390566172e-01   +7.119582942646887e-01   +3.262941809303362e-01   +4.657002771019008e-01; +8.708701138721601e-01   +7.812894517249729e-01   +1.916419781545557e-01   +9.614324885235973e-01   +5.352454769227746e-01   +1.568368298419039e-02   +8.793117141765394e-01   +8.130398397958000e-01; +3.284684770477049e-01   +1.950789235367526e-01   +4.321126285127655e-01   +6.784215667371598e-01   +9.648849675873218e-01   +8.011913051944728e-01   +4.707942788932461e-01   +8.974967036661284e-01; +6.493361371240594e-01   +9.921808618165657e-01   +7.489155434456527e-01   +4.024046614758022e-01   +1.168883863938796e-01   +1.422345130277887e-01   +4.041069918873794e-01   +4.284987673211484e-01; +9.760119645110183e-01   +8.017004931370182e-01   +3.956075601899875e-02   +9.337404434121546e-01   +5.028591903146513e-02   +4.790165463469515e-01   +1.798895119337680e-01   +3.343689100709329e-01; +7.640926987327805e-02   +4.243046184438255e-01   +9.464830422459191e-01   +4.797414394986222e-01   +3.027670666341402e-01   +2.549077004400647e-01   +9.685465545337135e-01   +5.963959589996320e-01; +5.881210613743704e-01   +7.280437433436290e-01   +7.633311270408530e-01   +2.305381623934797e-01   +5.809906629043559e-01   +3.692811526622935e-01   +4.081117449003100e-01   +9.004529579701992e-01; +4.127916604818107e-01   +4.973973040765776e-01   +5.578219941205604e-01   +3.963418390297769e-01   +5.319766753810975e-01   +6.616052139707104e-01   +8.438822895889329e-01   +7.018846087344673e-01; +3.091105304828669e-01   +8.087115213192494e-01   +1.833724401550043e-01   +7.047155308114381e-01   +9.004822231985633e-01   +1.681473071254788e-01   +6.163421579731551e-01   +3.782028587674079e-01; +2.635344128948321e-01   +3.565623456094412e-01   +4.998734375060961e-01   +5.584230342962571e-01   +5.400213150851118e-01   +2.794295620456215e-01   +3.753517248898696e-01   +7.350392361844639e-01];
L2I_L3I_iGABA_netcon = [+9.543342419365867e-01   +3.173634751790353e-02   +9.045708946016656e-02   +4.590061497568576e-01   +3.272752360929007e-01   +3.673756084913654e-01   +6.852562390743645e-01   +8.042348820497234e-01; +5.424096842379601e-01   +2.081809471316402e-01   +5.930267914949396e-01   +6.379281419003981e-01   +8.033117360711335e-01   +2.093914543788435e-01   +9.096965813101221e-01   +6.591890881862159e-02; +5.383337649443581e-01   +4.549273362920849e-01   +2.409434791317671e-01   +9.161458114896631e-01   +1.000000000000000e+00   +4.409024886563199e-01   +6.105257573317707e-01   +9.490030512014435e-01; +3.098032644756999e-01   +1.272975369419862e-01   +8.394815093150264e-01   +1.612798809647572e-01   +9.800371515250836e-01   +9.545373778288841e-01   +8.993802625820514e-01   +4.960282870920060e-01; +6.966102195209116e-02   +9.908918164089456e-03   +8.579432174062870e-01   +7.141995227331709e-01   +1.262354946681857e-01   +1.244129773864882e-01   +1.940084814075991e-01   +7.531969062219600e-01; +1.817819434406207e-01   +7.275806247854973e-01   +9.608837393655699e-01   +5.773146169747039e-01   +2.308539792417721e-01   +4.691637254582525e-01   +7.535677252298695e-01   +7.410157632610598e-01; +9.277168469648819e-02   +3.530865311339919e-01   +4.883818207451764e-01   +4.321898479525457e-01   +2.400302240699241e-02   +8.554293741311195e-01   +3.473282855550358e-01   +8.306796061301829e-01; +4.633883966680792e-01   +7.793306027341639e-01   +2.182961442790266e-01   +8.826988925393257e-01   +6.082635880176347e-01   +4.217661677896634e-02   +4.185930452620647e-01   +1.558736591124407e-01; +1.078129950453518e-02   +4.354607025654777e-01   +2.266887590144437e-01   +3.917336911039033e-01   +1.097839823041684e-01   +6.900460005643796e-01   +1.546877558415133e-01   +4.575583652939103e-01; +9.137164409588298e-01   +4.367369721025559e-01   +5.368152251879232e-01   +1.777492463418466e-01   +4.070171562266343e-01   +9.778345221976713e-01   +8.182601001833114e-01   +6.182088715994847e-01; +6.418880983262166e-01   +5.089355162244393e-02   +7.612914974686421e-01   +6.313501286072875e-01   +8.835855094322653e-01   +2.837563962715272e-01   +6.229758856425064e-01   +9.302964262184868e-01; +5.476825141910238e-04   +4.850333182454239e-02   +3.463849397841307e-01   +6.239532496364417e-01   +5.479958872840500e-01   +1.339077635725928e-01   +7.397263570062249e-01   +8.343176666354757e-01];
L3I_L3E_iAMPA_netcon = [+8.956055880432590e-01   +2.545849514726068e-01   +7.407647327732778e-01   +6.810433379745502e-01   +6.019344451772614e-01   +7.487159897089515e-01   +7.463006088467273e-01   +2.235571610167594e-01   +4.514207161284706e-02   +8.010805184812760e-01   +2.907933758040252e-01   +8.015701737526414e-01; +5.825958089522189e-01   +3.231611387336538e-01   +6.934069593106639e-01   +2.356614028299310e-01   +8.564458631024066e-01   +5.431713499676902e-01   +1.270041589382788e-01   +3.512057842009831e-01   +2.141110008986951e-01   +2.337074937904105e-01   +4.027827559259580e-01   +1.038871455001605e-01; +5.829377749150936e-01   +4.029372831447529e-01   +8.231030293826008e-01   +4.554891401131950e-01   +9.892628028132526e-01   +3.395357772471784e-01   +8.216131890852535e-01   +2.863513902429853e-01   +3.974944642412835e-01   +9.319711841893961e-01   +8.624367422834316e-01   +8.212687633300064e-01; +8.549269184565302e-01   +4.049325953309098e-01   +8.289649624805028e-01   +3.831465702670496e-01   +9.290384198154259e-01   +8.320737515203736e-01   +2.644112249311286e-02   +9.269163741188242e-01   +3.339497710090804e-01   +7.637618736668885e-01   +6.147407903921801e-01   +8.405424807051016e-01; +3.384703805069574e-02   +3.859267312351530e-01   +2.944580841009996e-01   +5.382336317537092e-01   +4.102853474805470e-01   +5.511935571382034e-01   +4.157169204503584e-01   +5.138642168151927e-02   +2.295888341176614e-01   +8.270420176364986e-01   +9.910365382061120e-01   +3.557992201787391e-01; +8.846703455808879e-01   +6.090377817627666e-01   +3.095098187596798e-01   +9.910401749278575e-01   +8.740096908572233e-04   +9.579271837379388e-01   +7.303267810756752e-01   +5.935771187410376e-01   +9.353935087637809e-01   +5.732152326219080e-01   +2.038698710178150e-01   +4.298915825566672e-01; +4.069590625259956e-01   +1.655021043195656e-01   +5.243006143502150e-01   +7.556463740466556e-01   +5.421301236995794e-01   +8.932830011133818e-01   +7.813872887283716e-01   +1.616605505475375e-01   +6.822482721785458e-01   +7.927842774497373e-01   +8.278531797941620e-01   +5.708971861717643e-01; +3.729528802739360e-02   +1.889556703892126e-01   +3.270103316110368e-01   +9.816966440908930e-01   +2.078621376195701e-01   +3.571886940697501e-01   +3.676048625296671e-01   +8.380082570111105e-01   +9.631119388323590e-01   +3.290637496901601e-01   +6.764889158790629e-01   +6.997274518334413e-01; +7.456273115577624e-01   +9.577164555995368e-02   +8.333211767841749e-01   +2.356564777856079e-01   +2.193995593441186e-01   +5.479580059464130e-01   +7.457826554928326e-01   +1.683434290004522e-01   +4.394817619530852e-01   +2.237462565003660e-01   +2.489716158773614e-01   +7.428875372599463e-01; +1.550880200161356e-01   +3.219515303595963e-01   +8.090928177085185e-01   +5.280476756668530e-01   +3.276154142568285e-01   +3.460645817053917e-01   +8.932852516686725e-01   +5.016289488087041e-01   +9.391566453954970e-01   +3.116594537026421e-01   +4.768948877523170e-01   +7.565062983135993e-01; +1.440383113290419e-01   +7.702367231247923e-01   +5.581254402179356e-01   +5.324279257495946e-02   +9.598358634972932e-02   +6.228845003373487e-01   +2.436781037668606e-01   +9.988321489403444e-01   +6.065110166450147e-03   +5.842984627009471e-01   +3.995356571125318e-01   +3.894919664230142e-01; +6.066366666919122e-01   +2.352347999685110e-01   +2.634121020193823e-01   +7.582209931806042e-01   +7.485100514787361e-01   +7.978075387152449e-01   +1.288378897032659e-01   +3.552070386212125e-01   +6.112490138669368e-01   +8.304186845992021e-01   +5.990788226806363e-01   +4.276849414108451e-01];
L3E_L3I_iGABA_netcon = [+9.554529249945575e-01   +8.847874805142826e-01   +8.004895954049083e-01   +9.858819604232192e-01   +9.016480716964720e-01   +9.610598341739159e-01   +6.533297996771811e-01   +5.008530766713445e-02   +1.078888211050966e-01   +4.520455898379615e-01   +8.297943541090158e-01   +5.803624188902581e-01; +5.729392547904585e-01   +4.380639253944144e-01   +9.869389861954929e-01   +5.596795378588912e-01   +9.944218297844430e-01   +5.419347751048263e-01   +6.662506956428001e-02   +4.663251770553468e-01   +4.608995096156293e-01   +3.339092849277576e-01   +6.257812314419409e-01   +6.362234268072446e-01; +8.499265875641077e-01   +7.818632743800237e-01   +1.593789436999840e-01   +9.333301375220113e-01   +6.525339716444785e-01   +3.169188280939251e-02   +2.750617897237508e-01   +3.243506016647928e-01   +4.511571970535765e-01   +5.869621844848009e-02   +5.398176000632248e-01   +6.507149731009817e-01; +2.760548960136673e-01   +1.494322295522515e-01   +2.369348517449270e-01   +7.202577680216764e-01   +1.076924690618740e-01   +6.961866662962050e-01   +2.819147881684869e-01   +6.308915260448900e-01   +5.506590267469189e-01   +7.404670071455436e-01   +6.502218219337659e-01   +8.642662666115861e-01; +6.227383362005152e-01   +6.210382046442903e-01   +7.019745236101808e-01   +4.848404041964953e-01   +3.726204066887676e-02   +5.196226243371009e-01   +8.798815420706062e-01   +2.289750394815561e-01   +8.056627890652346e-01   +5.066522328717246e-01   +7.259007981289253e-01   +5.619979377456478e-02; +5.899806394914338e-01   +2.599027583723837e-01   +3.765696884868596e-01   +6.395043442089643e-01   +6.184874600765178e-01   +6.074516013539949e-02   +4.450615890230940e-01   +5.796485336118556e-01   +7.012630121165526e-01   +2.006428762610275e-01   +9.437468626179149e-02   +8.176941570588460e-01; +9.642202294233763e-01   +4.453590378289094e-01   +9.747060019317380e-01   +8.879077861724746e-01   +5.664110770626353e-01   +8.890754736965064e-01   +7.574916755850769e-01   +6.037178038019499e-01   +8.722956622665162e-01   +4.267597425201627e-01   +8.787325455149771e-01   +5.283312312128596e-01; +8.660910732705139e-02   +8.447692469530615e-01   +9.710409292552994e-01   +1.980490077383591e-01   +9.623286687601378e-01   +3.300662401853919e-01   +6.020171606507871e-01   +6.001347860055314e-01   +5.210504068486541e-02   +1.675181569094461e-01   +1.274384846941728e-02   +6.953270762299115e-01; +5.010064540064636e-01   +1.970622314503452e-01   +6.428143529472220e-01   +3.962323251806313e-01   +7.474732313300826e-01   +2.288407698253226e-01   +7.827628106126688e-01   +4.481976661257347e-01   +2.182908915319795e-01   +7.511485605932769e-01   +2.921326680589828e-01   +2.127477745439234e-01; +5.213541780563872e-01   +3.031291518581645e-01   +8.597192464755985e-01   +9.923852716198985e-01   +6.625401641510202e-01   +1.134715683177486e-01   +1.142833882518922e-01   +3.408652488810741e-02   +4.593752943894859e-01   +3.671513257190930e-01   +1.788628936393955e-01   +5.439556397340541e-01; +9.081702943364192e-02   +4.813652481690786e-01   +4.012537825398999e-01   +4.017740344835940e-01   +5.235544489673758e-01   +3.119775910840504e-01   +9.780955975668387e-01   +5.128355006158964e-01   +9.583768113597095e-01   +9.426048863109946e-01   +9.261497746836984e-01   +7.036101726592597e-01; +9.054664782582144e-01   +3.378231165153290e-01   +6.307569710762910e-01   +6.581646681900770e-01   +2.598145168164218e-01   +2.279585339161806e-01   +8.484300119986037e-01   +4.074344968201477e-01   +7.915752347684608e-01   +1.538952396510249e-02   +6.839049695299602e-02   +9.559486451117322e-01];
L2E_Input1_iAMPA_netcon = [+9.978675437410878e-01   +9.999317384329190e-01   +9.980400175146267e-01   +9.984618683537070e-01   +9.970158578447497e-01   +9.981617126153940e-01   +9.973669056138230e-01   +9.967251882528915e-01];
L2I_Input2_iAMPA_netcon = [+9.982754461964969e-01   +9.985113661151372e-01   +9.994824431714439e-01   +9.999755432700631e-01   +9.996356194442878e-01   +9.977812254138683e-01   +9.996634708396859e-01   +9.976462495947810e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
