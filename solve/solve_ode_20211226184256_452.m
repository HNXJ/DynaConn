function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.908077205156801e-01   -2.018615078421771e-01   -7.855771029246764e-01   -1.895062748526090e-01   +4.648942221466156e-01   +4.191550591006137e-02   +9.969146213949809e-02   -4.376314280371696e-01   +6.796831556394111e-01   +6.007139850434421e-02   +5.119969411637404e-01   +6.950593575737478e-01   +6.740124852973242e-01   -6.112748105823217e-02   -1.044607202571146e-01   +3.083223548485619e-01; +1.356233568342917e-01   +5.069456246822832e-01   +6.962194472312078e-01   -2.497997900739349e-01   -3.562451340031245e-01   +5.255758782728098e-01   -3.252076506669570e-01   +5.872554091379101e-01   -3.129540713218625e-01   -3.875343081505791e-01   -5.595157083517037e-01   +2.626324535594984e-01   -5.716773722998442e-01   +2.955577166517265e-01   -3.089973691782472e-01   +7.751690893841945e-03; +5.704772947312119e-01   +3.914690746802761e-02   +4.183973532320646e-01   -8.025783178507112e-01   -3.588290601891594e-02   +3.847602852590611e-01   +3.951646077205755e-01   -4.766180850910139e-03   -7.960578390318437e-01   +5.153706895555137e-01   +2.449767454239840e-01   +1.156949301064776e-01   +8.894044309607767e-02   -2.239433704122017e-01   +6.765048175404783e-01   -3.662262327179362e-01; +1.146147337228352e-01   +2.717694299260258e-01   -4.014771615861598e-01   +1.835106578231340e-01   +3.536002267566111e-01   -3.821172978514780e-01   -3.235663763377037e-01   +5.666379988885643e-01   +2.077560484347268e-01   -9.685007536414737e-02   +7.311590285510743e-02   -4.482000935262035e-01   -1.357412839325957e-01   +3.154424558669859e-01   -4.004605037880585e-01   -2.034623803791958e-01; +1.232033470620224e-01   +3.231432511839224e-01   -9.351360528173611e-01   +3.359702043379140e-01   +5.559133353938320e-01   -3.461152593988052e-01   +3.759893396797026e-01   +2.413750201107167e-01   +2.114042655977530e-01   +6.571038883308066e-01   +6.856336708330486e-01   -5.835380688926994e-01   +9.868795459136370e-02   -3.855359521187382e-01   -1.714371715118033e-01   -7.250197885474959e-02; -2.573330776544109e-01   -2.411639647269618e-01   +4.641747589148084e-01   -2.945950631404349e-01   +2.916991938538416e-02   -5.612516108216319e-01   +3.063536268186814e-01   +6.947543603304386e-01   -2.120290487533770e-01   -2.190458736218634e-01   +4.765656215914836e-01   +2.470640434259234e-01   +6.944581645904679e-01   +1.461983449613040e-01   +2.846691859800826e-01   -3.155755960684823e-01; -2.193898407739427e-01   +2.916247494751300e-01   -1.427101224531799e-01   +1.629616141462183e-02   +2.617467299295207e-01   +2.472705162511167e-01   -3.887568700116560e-01   -2.219581391380676e-01   +2.596362436518523e-01   +4.478077641955442e-01   +1.417576841542187e-01   -4.207903518220040e-01   +4.325856010311421e-01   -1.476311448496617e-01   +5.643505299474202e-01   -2.500443848861647e-01; +1.829788965869205e-01   +2.251346487827519e-01   +8.087138023352050e-01   -8.652202389582238e-02   +1.505438287666514e-01   +4.180034356524918e-01   -7.528242157772919e-01   +5.816425790380925e-03   -6.231000063037263e-01   +3.988855278647544e-01   +4.048054780037724e-02   +4.724542055228267e-01   +2.945462556468646e-01   -7.644008624741952e-02   -5.219990858994133e-03   -3.016893571242109e-01; +3.521960144365914e-02   +2.497058783242298e-01   -1.040850049106117e-01   +2.542149046988025e-01   -1.696321180324363e-01   -9.954454546006736e-02   +7.589149716490301e-01   -9.119543955183050e-01   +2.131257431810930e-01   +2.189647841557585e-02   +2.080051891530179e-01   +4.974013516982358e-01   +1.282965737535687e-01   +5.709777346545898e-01   +8.594754556627611e-02   -4.967240607690367e-01; +1.218198391570433e-01   -4.111093218620460e-01   +7.127919245549380e-02   +1.345906108509234e-01   +5.768496097091064e-01   -4.966093906212384e-01   -5.523156539350117e-02   +3.273706945500890e-01   +2.618601865118463e-01   -2.447791855951062e-01   -4.942783714191614e-01   -8.375674240450310e-01   +7.203666841214441e-01   -4.417815820935617e-01   +1.604675905167803e-01   +1.959733361124564e-01; -1.941129193749871e-01   +9.133108572924135e-02   +1.078894794949757e-01   -2.292699136904583e-01   -3.654489125980355e-01   +5.751969546905064e-01   -3.853397087590845e-01   -1.127819356097780e-01   -3.510627884313471e-01   +2.500908359402684e-01   +4.845057033731773e-01   +1.871143284832631e-02   -2.131419447209833e-01   +2.799018832662908e-01   -5.709526053550343e-01   +5.346613680548055e-02; +3.419668780598522e-02   +1.738818000912372e-01   +6.049255100251038e-02   +3.471343496264901e-01   +7.366126224719113e-02   -3.381596912127930e-01   -3.850141721043333e-01   +4.248168521567942e-01   -5.818249282407127e-01   -3.885030131470453e-03   -3.362052677011087e-01   -3.247185628086419e-01   -1.107747721667876e-01   +6.545915163328697e-01   -2.078205973287907e-01   +1.476162976969590e-01; -1.543388357139670e-02   +6.832245112003933e-01   -8.140817900525750e-02   -2.871446433865918e-02   +8.410592144965363e-02   -1.000000000000000e+00   -4.888667230993697e-01   +3.702597360733655e-02   -2.877951756068686e-01   -2.716206196415645e-01   -3.793714848349590e-01   -3.335124790684871e-01   +9.008836665076149e-02   -2.747461775792996e-01   +2.313359380584302e-01   +3.937851808548405e-01; +4.828759685122602e-01   -3.855521749636921e-01   +1.878213621171023e-01   +6.051259863065900e-01   -3.917358056139457e-01   -1.317584993144932e-01   -2.015394879071719e-01   -3.926967706329956e-01   +2.666466862601161e-01   -3.854984197462835e-01   -9.017242953836409e-01   -1.240366856335696e-01   +4.380051448721735e-01   -4.257605585603508e-01   -1.541330010977553e-01   -5.697066122449949e-01; +3.575236758211844e-01   +5.819277900928042e-02   +1.010256469299998e-01   -2.640055529857484e-01   -1.549643509551370e-01   +2.210210278635370e-02   -2.681304375337905e-01   +7.194635409644295e-01   +1.556869473139868e-01   +1.776933157113933e-01   +5.064089911567143e-01   -2.079075985746889e-01   -4.163243386486272e-01   -5.733389013452911e-01   -5.425841887022553e-01   +1.521865662171974e-01; +6.486745558226861e-02   -3.293628326842798e-01   -2.049142786159781e-01   -1.660097569635900e-01   -3.805081288289221e-01   -4.407693194440782e-02   +6.451312165934261e-01   -9.102969083387746e-02   -9.968746103258819e-02   +4.970204562022442e-01   -1.344941008879338e-01   +3.992327342816848e-01   +5.293805428991698e-01   +5.175065258209035e-01   +1.638241372566040e-01   +5.666476427668374e-01];
L1E_L1I_iGABA_netcon = [+3.328884671819957e-01   +2.395528915532344e-01   -2.811652381560153e-01   +4.341390325373841e-01   +2.223682960304316e-01   +2.224245533421405e-01   +1.277804495060881e-01   -2.877001459761565e-01   -3.132553906506924e-01   -2.099705428376806e-01   +4.373390699652565e-01   +1.326197181447863e-01   +1.232730745184861e-01   +1.436524333561040e-01   -1.714200583587854e-01   -1.848693819832659e-01; +5.771643896064849e-02   +4.051309939828757e-01   +3.335413242956294e-01   -7.020983905816930e-01   +1.506309041033376e-01   -1.373620443785935e-01   -8.364163590693222e-02   +6.173466503948046e-01   -2.213530272161719e-01   -5.062895472446951e-02   +5.239574905330787e-01   -5.930223350214924e-01   -3.720138019265249e-01   +7.751719491844523e-02   -4.205864720655992e-01   +1.339707373761066e-01; -2.302670212827362e-02   +8.413597592684162e-01   -7.944400430820637e-01   +6.921293868496361e-01   +2.303247010289089e-01   +5.258965005220132e-01   -3.835706210046737e-01   -4.439160677950574e-01   +2.807230937313815e-01   -7.020507243760938e-01   +2.993633186238997e-03   +8.992672422171229e-02   +5.919392043721612e-01   +3.496139780124497e-01   +8.629919310185724e-02   +4.962141156238074e-01; +5.899805123573219e-01   -1.554507515632719e-02   -7.106865295002786e-01   -1.916503780637045e-01   +2.007730363885508e-01   -5.199023217510780e-01   +5.379606324795423e-01   -7.515771847492998e-01   +1.671753133318523e-01   -4.170088679154327e-01   -6.238738029669251e-01   +4.855135166729359e-01   -6.028127613006619e-01   -1.550247394705661e-01   -3.137650888841991e-02   -3.444841700245950e-01; -3.803184127776560e-01   -1.719908379527656e-02   -1.007897418261147e-01   -5.568444776121133e-01   +5.612653551229579e-01   +1.780499470290523e-01   -3.292910049458222e-01   -2.948364122257260e-02   +6.056663588410843e-01   -2.573766644113324e-01   -1.462109486736127e-01   -2.694692974310460e-01   +4.915156271224150e-01   -9.613308854610300e-02   -1.167774704333836e-01   -6.590773712076071e-02; -1.532213957655083e-01   -6.236920710225346e-02   +1.180473387492281e-01   +4.394094479735217e-01   -8.345347426505872e-01   -1.460595013439344e-01   +2.424340577274062e-01   -9.908552092423762e-01   +2.412264180523077e-01   -1.378793748626810e-01   -9.241031760834920e-01   +6.198589886051668e-02   -5.018071361233321e-01   +2.465475612828931e-01   +5.814364036768830e-01   -2.118101089319870e-01; +5.594992441776165e-01   -4.594765047328099e-01   -5.970911131375237e-01   -3.796054045851882e-01   -2.190881048850835e-01   +1.000000000000000e+00   +5.764215558615978e-01   -2.523058101709436e-01   -6.550075698776654e-01   -1.301423584997394e-01   +2.096353151121769e-02   -2.451770367517535e-01   -3.624109371455153e-01   +1.798419180912787e-01   +9.247555899268455e-02   -5.310296251369054e-01; +5.122642197351755e-02   -4.709947621636149e-01   +4.415209590068613e-01   -5.563596810678734e-01   +8.432676874190940e-01   +1.964056809486053e-01   -2.959590728822844e-01   +2.843093476826806e-01   -1.899260194477778e-01   +4.851246789050270e-01   +1.445217076523003e-01   +7.175028488730434e-01   -2.109854076864605e-01   +1.947871832962527e-01   -2.622473634602205e-01   +8.481559467242954e-02; +5.127570703805509e-01   +4.281223021016833e-02   +5.823201008388511e-01   +8.678637242686141e-01   -5.891071307265288e-01   +1.491418620831026e-01   +2.351077874355948e-01   -5.925957596302701e-01   +4.610249692174080e-01   +6.530387775483236e-02   -7.662785432554818e-01   +5.539804621578047e-01   +1.419380334623788e-01   +3.370757205859313e-01   +8.989661331248172e-02   +2.999088953660290e-01; +1.141872170087128e-02   +2.629888863967672e-01   +9.939599185072163e-01   -1.811553966360484e-01   +3.558233295175086e-01   -1.022951720586634e-01   -2.634144763709316e-01   -9.398987535288107e-01   -3.008951972547493e-01   -4.212349077285779e-01   +1.432441415536507e-01   -2.921783499869985e-01   +6.238661253496103e-01   -1.144868136944013e-02   -5.108523594625715e-02   -4.220508790986993e-02; +1.120847326053912e-01   -2.778297339368636e-01   -5.628334156503743e-01   -2.683006535684443e-02   +6.049775399385061e-01   +3.010326337432030e-01   +9.026669175090071e-02   -3.897760096946152e-01   -1.230289327703222e-01   +1.147838448929837e-01   +6.226868893545182e-02   -2.734813135234539e-01   -3.367564980558701e-01   -2.806281684241448e-01   -4.469572232961601e-01   -2.650381058141814e-02; -8.461995075990268e-01   +1.151323755830262e-01   -3.787833947652122e-01   +4.597163478929299e-01   +5.807038587282547e-02   -4.301104505419751e-01   -7.716564112610126e-02   -2.947951657537756e-01   -8.537990221421342e-02   -5.436616829993107e-02   -7.019005259472095e-01   -2.030817636179117e-01   -4.525893293589291e-02   -2.342422307160689e-01   -8.369496962991717e-01   +3.936024183342260e-01; -3.188024914387033e-01   -1.445924004035021e-02   -3.683775256305148e-01   -3.028659245221909e-01   +5.287983269474913e-01   -7.297414084458462e-01   -4.594757716571621e-01   +1.158078009724570e-01   -6.727845754757621e-01   -3.024699143616136e-01   +2.040251191137297e-01   +2.062545045935442e-01   -1.741354298316135e-01   -2.173813068563689e-02   +3.941878779886544e-01   -2.798352916844060e-01; +7.012378011291421e-01   +4.557764819466975e-01   -1.285105055010212e-01   -5.065446537934564e-01   -2.197349615079675e-01   +6.274787647447130e-01   +6.214833726824281e-02   +2.686825263403398e-02   -3.182779861575484e-02   -3.512121987729760e-01   -3.902599231160719e-02   +1.057621652433670e-01   +2.587150724159115e-01   +2.030314348566045e-01   +3.423512376943618e-01   -1.714994347865722e-01; -8.623434933273098e-02   -2.599234999557893e-01   +5.167478032937750e-01   -1.025324260559271e-03   +1.469419596190883e-01   -6.601806274020257e-01   +4.049166130971700e-01   -3.589475371711209e-01   -2.241860976684314e-01   -6.390001950205478e-01   +6.632910157350403e-01   +3.854599172746313e-01   -3.643243097899014e-01   -1.019764773305906e-01   -7.282205750447106e-01   +6.671841299117270e-02; +6.575810790614649e-02   -7.856339667471818e-02   -2.960818678220352e-01   +7.299237456669484e-03   -1.177363442541855e-01   +6.211104827281652e-01   +3.473064212273354e-01   -6.821819259802958e-01   -2.158283812122525e-01   +2.087900659132872e-01   +3.120111094519736e-01   +6.073315454045692e-01   -1.010997999866234e-01   -2.110443327864974e-01   -6.065067102655136e-01   +5.481703248477300e-01];
L2I_L1I_iGABA_netcon = [-6.116377802071000e-01   -6.349033428948946e-01   +2.041725842254069e-01   +3.645110143726560e-01   +1.872995091565807e-01   +6.190769076082016e-01   -4.628412830011392e-01   -7.859376158829587e-01; +4.094098695932691e-01   -1.033846829636093e-02   +7.512963824991460e-01   -1.297928636314029e-02   +1.828642110072483e-01   +1.837996873108213e-01   +2.691678283685863e-01   -2.345598724345239e-01; -1.713378504608617e-01   -1.318060320153713e-01   +5.590490122861298e-01   +1.419774831644257e-01   +7.363753872538685e-01   -3.029096526977155e-01   +6.147448963911453e-01   +3.159696019061634e-01; +2.314889403980621e-01   +3.309294137419686e-01   +7.714208264317391e-01   +5.408650323224899e-01   -4.231252028822519e-01   +1.138185633926997e-01   +1.986446074803072e-01   -7.161804364148119e-01; -9.514873285838320e-01   +1.000000000000000e+00   -1.160585648314352e-01   +1.052173516264000e-01   -3.755486360108606e-02   +8.062931464450641e-01   -8.205645158428085e-01   -1.631793718910357e-02; +2.327965357854508e-01   +8.086477892014031e-01   +6.089939612623762e-02   -1.866461388891054e-01   -2.441337601635838e-01   -1.034070863131519e-01   +9.549054699624457e-01   +6.903411601382196e-01; +1.575124273327360e-01   +2.515800764290611e-01   -1.794682967218997e-01   +3.683196027210527e-01   -1.706516038224754e-01   +2.791757441389745e-01   +4.179844336551907e-01   +8.182371788957862e-02; -6.887146853896173e-01   +7.735007139659451e-02   +5.693879770425070e-01   +8.418995069246848e-02   -1.810561836591549e-01   +1.903961796316221e-01   +2.403940310459833e-01   -2.549365963898362e-01; +5.436562614354721e-01   +3.535960645286721e-01   +7.191179297289053e-02   +3.955955702606270e-02   -3.529481503649864e-01   +2.630072753932395e-01   -1.664933299748638e-01   +2.946466676118916e-01; -1.260623075940515e-02   +1.192226276239956e-01   +6.919348088265279e-02   -5.185018101198005e-01   +4.572714704271321e-01   -6.666645913696770e-01   +6.505334121605776e-01   +1.243243469825858e-01; -7.480502514483842e-01   -2.402040970367209e-02   -4.427274886615118e-01   +4.120427168760295e-01   -7.277131283718760e-01   +2.024196392655990e-01   +4.251382197083227e-01   -4.362320902060448e-01; -1.751498894039539e-01   +2.462780705123623e-01   +9.368330181177248e-02   -2.366396165614054e-01   +7.268000523960364e-01   +3.406165313873823e-01   -3.058403260941954e-01   -5.168563912246546e-02; +5.277715077710251e-01   +7.113056840257453e-01   -2.473066642378785e-01   -7.031397251217639e-01   +8.745397355814004e-02   -3.284091899675636e-01   -9.876920028184735e-01   +7.060221675071431e-01; +5.261647311550144e-01   -1.487643786521790e-01   -6.766729496356630e-01   -1.709141159691260e-01   +1.700148910590011e-01   +2.661121004323407e-01   +3.336986395227624e-01   -2.628900558393477e-01; +3.597844289912097e-01   -8.071067572784902e-01   +1.917338669811676e-01   -6.964244840151494e-01   +2.583741290402617e-01   +7.258048439360774e-01   +2.253275501133946e-01   +3.263861452606672e-01; -3.079263194645974e-02   +5.605066888019958e-01   -3.410790314050351e-01   -5.729966748408907e-01   -3.406673592516036e-01   +2.273009278019442e-01   -7.964403029933433e-01   +1.956745845779429e-01];
L1I_L2I_iGABA_netcon = [-2.390801659995560e-01   +1.431032389912975e-01   +4.418221009802222e-01   +1.029777492301050e-01   +5.329651703787459e-01   +1.685863846225245e-01   +2.353532300436727e-01   +8.716827278796315e-01   -1.559944828238062e-01   -2.071715078053872e-01   -9.047323324997346e-02   +3.247734740371866e-01   +1.634006993322237e-01   -2.774035106655244e-01   -1.049168778127110e-01   -4.793594462750976e-01; -3.214843911952690e-01   -1.011037358026027e-01   +2.918802848455488e-01   -6.238624384393392e-01   -9.674349199946991e-01   -1.775423762375032e-01   -7.622138845004608e-01   -6.454636738062340e-01   -7.569297147378812e-01   +6.018496043667538e-01   -1.306865789288832e-01   +3.037493811595669e-01   -1.681473025146458e-01   +7.995270652418114e-01   +1.491850251074942e-01   -4.841572162353577e-01; +2.237520680596134e-01   -2.464850296264749e-01   +6.128065876989194e-02   +5.892994281244620e-01   -8.522116225849083e-01   -2.671668823525187e-01   -5.648359824461144e-01   +8.198177299763770e-02   +2.145128970929050e-01   -2.275966416458728e-01   +1.585966685194394e-01   +2.534219132314163e-01   -2.036308398054593e-01   +6.141702309667061e-01   +5.379179575633470e-01   +4.227199936720337e-01; +2.851194217079766e-01   +3.709683343033495e-02   -1.563665580778920e-01   +6.687419817750985e-01   +4.156111736466921e-04   +1.508569846248138e-02   -6.095570598363168e-01   -7.190807719258809e-01   +4.991964722272253e-01   -1.295476106872730e-02   -2.941309801861725e-01   +6.128558447291863e-01   +2.532389810439555e-01   -1.610319929532026e-01   -1.692128913465385e-01   +3.746694964980818e-01; -1.591049504177725e-01   +7.758639717795367e-01   -1.227413213497579e-01   +5.488934590844091e-01   +4.406095323771996e-01   +9.186315103874745e-01   +7.628913138344245e-02   +5.554492010540453e-01   -1.564823915557824e-01   -6.961279430713144e-01   -5.519991038620499e-01   +3.126518717461571e-01   +4.070638498378200e-01   +5.135313918526737e-01   -3.959791090145373e-01   -6.353824639145189e-01; -1.615254602350830e-01   -2.517910851444225e-02   -2.754173502445644e-01   +1.511618316345333e-01   +5.697325171326076e-01   +7.830329307624166e-01   -6.286159002207785e-01   -4.069467954970667e-01   +4.623384115171367e-01   +8.396978024027221e-01   +7.810441340486991e-01   -2.969928698775718e-01   +6.206407902262290e-02   -5.960863536121167e-01   +6.281160404072540e-01   +2.514699837483270e-01; +2.679300086512966e-01   +2.300681265003291e-01   +5.722973963602115e-01   +8.992502525787034e-01   -5.422496194380720e-01   +1.313705862887085e-01   -6.383365728973578e-01   +6.156310070388232e-01   -5.405232587082006e-01   -3.281106176130269e-01   +2.350575033020791e-02   -7.573177357807735e-02   -7.930933800915102e-02   +9.832049043095292e-01   -5.932875628246750e-01   -4.162388459190200e-01; -2.551181880289042e-01   -5.870800391504885e-02   -5.607589638097744e-02   +3.076131388204090e-01   -4.257899416403418e-01   +2.112823142150001e-01   -8.957550008414245e-01   -5.623006675253410e-01   +3.158373203871093e-01   -1.000000000000000e+00   +6.966865374547935e-01   +3.828536282304006e-01   -2.477274017624208e-01   +6.714505009345736e-01   -3.853745347088228e-01   -5.247760631663653e-01];
L2E_L1E_iAMPA_netcon = [-1.717912095225022e-03   -1.601077973229384e-01   -5.481557920749710e-01   +2.241475331050322e-01   +2.689684880119540e-01   +3.782163393808156e-01   -2.575827190252535e-01   +2.178139995713210e-01; -4.944435866751017e-01   -7.235348039437539e-02   -3.394348113061896e-01   -7.352259044455571e-01   +8.164772550857006e-01   +1.774920168296782e-01   +2.798416187966568e-01   -6.762369431567736e-01; -1.848202977162090e-02   +3.444567347352911e-01   -2.637619984960975e-01   -2.660380603597446e-01   -2.589140459181901e-01   -6.290431089224258e-01   +1.549453512360706e-01   -4.613553971470824e-01; +1.045070115122573e-01   +4.439604029455065e-01   +2.320992157217538e-01   +4.792007695705579e-02   +2.963241345196690e-01   -3.879967403120336e-02   -2.072304254087100e-01   +3.933066607065518e-01; +5.783421227655000e-03   -4.310711784394144e-01   -1.246477044074516e-01   +8.811118120922016e-01   +4.727067168311926e-02   -2.918525728457235e-01   -6.922059496297279e-01   -5.759578972138130e-01; -7.457995960416667e-01   +2.594796023558187e-01   -1.733307438232231e-01   -3.950361940576070e-01   +1.122182300993952e-01   +4.214597563004484e-01   +1.932919403698557e-01   +2.106283285995742e-01; -7.146974497982052e-01   +6.426263168490697e-01   +1.917492847345963e-01   -2.876373356579923e-01   -5.374049907300027e-01   -3.220361647726158e-01   -5.029863417278805e-01   -2.574649747878276e-01; -7.731815311804199e-01   -1.891274203158826e-01   -3.895032507010235e-01   +4.356273154762435e-01   -6.864167242212181e-02   +3.944411725387051e-01   +5.802047529480705e-01   +9.304736052361963e-02; -2.196634345089343e-01   +6.022870078750993e-01   -1.243136020587557e-01   +4.527667063554178e-01   -4.730464838064265e-01   +7.318081476169253e-01   -4.507440668904634e-02   -3.718077857325101e-01; -1.511874411451659e-01   +7.400488240186340e-02   +3.764829118707878e-01   -2.253061238875530e-01   -1.389149545863488e-01   -1.222082509248004e-01   -4.406475252401727e-01   -6.465032923352043e-01; +5.607723416891932e-01   +1.760330312238056e-01   +8.952453940218777e-02   +7.355514544324752e-01   +1.330002556047656e-01   +8.116594717971627e-01   +6.448527005186913e-01   -3.922433002111139e-01; -3.260448644935413e-01   +1.513062228342001e-01   -2.522648007051984e-01   -8.435855239369693e-01   -2.006761796027161e-01   +2.882597209870166e-01   +5.130780325968929e-01   -1.490946306658103e-01; -6.777839863357880e-01   +4.057124859458137e-02   -9.361753374818330e-02   -1.000000000000000e+00   -6.193101799790404e-01   -1.296985396710371e-01   +4.265963893014069e-01   +3.437599650963419e-01; -5.731084186053921e-01   -6.961482195869141e-01   +4.854524162835274e-01   -4.603624207880649e-01   -7.357252368512108e-01   -2.361407437890938e-01   -4.210084454172397e-01   -5.926457102616514e-01; -3.078185148339794e-01   +7.056777467249536e-01   +1.711461848456223e-01   +2.042849940620371e-02   +1.611577041183574e-01   +3.419940022558110e-01   -3.873198199442927e-01   -6.777766703246657e-01; -5.194497853286187e-01   +5.641873820002229e-02   -2.643371605620345e-01   +1.869947118033932e-01   +3.990437416900888e-01   -7.556839498125201e-01   -7.665010209107024e-01   +2.379561804774035e-02];
L1E_L2E_iAMPA_netcon = [-9.094154528271692e-02   +2.691925528366632e-01   +2.178823141301074e-01   -3.935707118937761e-01   -3.528934431217951e-01   +6.852848767153866e-01   -4.062458730490578e-01   -1.851097880770937e-01   +2.768651262512761e-01   +5.627066234875044e-01   +9.190831284079176e-01   -9.731103105074695e-02   -8.651150184199863e-02   -1.974253789878343e-01   -6.987244804261885e-01   +6.417051765489232e-02; -6.891967265594727e-01   +1.405059015046561e-01   +2.981615023892120e-01   +1.565524879716675e-01   +4.775882726895340e-01   -5.069111592396482e-01   -4.663417227474645e-01   -3.732903669204244e-01   -9.791230407840533e-01   -6.416132166512591e-02   +4.208591662370191e-01   -5.093667403976057e-01   +3.478940254079824e-01   -7.229523905159885e-01   -1.304066647253402e-01   +3.797473397768392e-01; -3.477551636073438e-01   +1.214199675128991e-01   +9.883483625359031e-02   -3.464664205752043e-01   -4.531363319804827e-02   -2.407587028857377e-01   -9.515115495096194e-01   -2.975976737190176e-01   -8.482758872534883e-02   -4.430494915421783e-01   +3.188857636926606e-02   -3.786404022999085e-01   +2.566489954262131e-01   -4.491597482462085e-01   +4.482389852302658e-01   +1.000000000000000e+00; +6.596064655417243e-01   -2.363971336880508e-01   -5.682391459667651e-01   -3.265625297613733e-02   -1.888946551106045e-01   +1.119704288414261e-01   +4.217044658055832e-01   -1.465986172917585e-01   -2.844971426270607e-01   -1.054783746004722e-01   +6.698156034351137e-02   -5.490069467295122e-01   -3.383136662195016e-01   -7.772874367610108e-02   +8.334997484037940e-01   +5.582924295168423e-01; -1.697257185367511e-01   +9.123192214249081e-01   -6.026655954126624e-01   -2.418728738512752e-01   -5.557254003393750e-02   +8.706609389734451e-01   -3.565857843879623e-01   -1.614185137802888e-01   +6.811091093524312e-01   +5.536214941802405e-01   +6.340645386116226e-01   -1.539579716106866e-01   +1.687908778462448e-01   +5.405628256571571e-01   -9.623892803670801e-02   -9.661292997349774e-02; +3.971979228455777e-01   -2.300877894546498e-03   +2.719606190626941e-01   +3.385882480524777e-01   -4.306150346475926e-01   -3.029387975198994e-01   -6.862879894173241e-01   +5.267845842788657e-01   +1.079846378832453e-01   -3.894119734339302e-01   +7.325350213565167e-01   +2.776611672201870e-01   -2.368399956465140e-01   -1.779013075144357e-01   +8.411907707140598e-01   +4.849200224809328e-01; +1.012438724108885e-01   -4.325665677959422e-01   +4.993266080055963e-01   +5.527924896931430e-01   +4.760253483496714e-02   +5.451785463811348e-01   +2.001540840695023e-01   -5.821067085867160e-01   +1.638962760022104e-01   -3.771897882093350e-02   -4.767510968204415e-01   -6.192944655480982e-02   -2.098720598901153e-01   -2.336819699188964e-01   -8.814701355685642e-01   -9.011642732881196e-02; -2.272977393944528e-01   -6.105825740123919e-02   +1.514637627559149e-01   +9.796067539387636e-02   -8.744864248013936e-01   -2.430582697921494e-01   +4.830256673764867e-01   +8.066186871153434e-02   -9.033836611632078e-01   +1.725239467793858e-01   +6.568369542546786e-01   +3.089081774920072e-01   -5.584294988080870e-01   +5.310050037883204e-01   -8.330425653032312e-01   -8.124229127635728e-01];
L2I_L2E_iAMPA_netcon = [+1.482953494982996e-01   +4.060454279955772e-01   -4.536049485364205e-01   +4.412203779694543e-01   -2.979690506299906e-01   +3.188596745419692e-01   -1.070639137737409e-01   -4.810113902633059e-01; +3.132527238190089e-02   -1.408489119600506e-01   -2.908983892566625e-01   +7.270140166030594e-01   -4.318889193153934e-02   +7.709095706631902e-01   +3.265905759554650e-01   -2.987409595583167e-01; +5.132536563865222e-01   +5.934912192863848e-01   +3.207211041628493e-01   +9.726328926975678e-02   -1.397983304296321e-01   -1.049018692784987e-02   +1.308486892161929e-01   -5.340415054815518e-01; -1.107443108537436e-01   -3.126194835826406e-01   +5.037787251748844e-01   +5.521922516571317e-01   +7.766478637185672e-01   -8.024487604639340e-01   -3.066467529184088e-01   -3.332544392945756e-01; -2.038280729272278e-02   +1.602360490150095e-02   +2.668604107792926e-01   -3.290581618823100e-01   +1.779251900589609e-01   +1.619990719452267e-02   -4.513090639508165e-01   +4.062872581597902e-01; -2.516335817974512e-02   +1.000000000000000e+00   +3.365932599591453e-01   -7.422861792850348e-02   -2.955463294092286e-02   -1.559286499884031e-01   -6.152382241367929e-02   +6.601197176894681e-01; +4.217007195190758e-01   -9.104849658011511e-01   +6.035322452488624e-01   -6.005844676877557e-02   +3.843427739918616e-01   -2.464425005222114e-01   -1.686681431672954e-01   -1.165385490347759e-01; +2.765398065083807e-01   +2.832380103583072e-01   +3.806256398463300e-01   -4.703547104502082e-01   -6.973675094449607e-01   +4.956817279255362e-01   -6.027331014024205e-01   -4.330076608214610e-01];
L2E_L2I_iGABA_netcon = [+4.277334927191984e-03   -7.505686658011684e-01   +9.897889288685553e-02   +2.028658943124327e-01   +5.695962585489813e-01   +6.312860781111443e-02   +4.030024311538565e-01   -1.020273337313248e-01; -1.711500686780615e-01   +7.008539823250864e-01   +5.109288050422224e-01   -8.084236188350480e-01   -2.036086586788053e-01   +5.347374049216876e-01   -7.411201545762560e-01   +3.897637680679704e-01; +1.238433261976668e-01   -1.203553333744065e-02   -1.221848270031510e-01   -1.277028147643643e-01   -3.477003183572310e-01   -5.476287930528724e-01   -1.794609193631236e-02   -9.622496652769102e-01; +2.227121256782587e-01   +6.544754173850692e-01   -6.882784208393241e-01   -9.229728545042526e-01   +6.229804916514572e-01   +1.000000000000000e+00   -4.285736985668954e-01   +2.307976519153341e-01; -6.869558110274743e-01   +3.362702865781388e-03   +1.341497371880047e-01   +9.976908238963057e-02   +8.801569269604694e-01   -1.309447889214445e-01   -5.732947896534306e-01   -1.263856033515653e-01; -6.246858996927821e-01   -8.733098834622430e-01   +1.815858081290748e-01   +4.940092674927401e-01   -1.521418481833675e-01   +3.239690993438190e-01   +4.057840185343842e-01   +3.964663461010515e-01; +2.976284137159642e-01   -7.510816770212090e-01   -1.876066412782948e-01   +6.017382033821518e-01   +4.235867832106102e-01   -2.621017939508220e-01   +4.742941914754888e-01   -6.599519802861370e-01; +3.702694059681962e-01   +6.043567286527645e-01   +1.881504636540158e-01   -2.432903602174903e-01   -1.506339502543323e-01   +3.929609650011828e-01   -1.836256528649877e-01   +6.450510931018143e-01];
L3E_L2E_iAMPA_netcon = [-2.124560099897353e-02   +1.000000000000000e+00   +2.653874582719907e-01   +5.303390210007874e-01   -1.489865081217903e-01   -2.837557085803598e-01   +2.175288018694219e-01   +1.907772094704527e-01   -1.576379155051916e-01   +3.241241479067298e-01   +1.317059525921960e-01   -2.315062646086453e-01; +5.635472234074100e-01   +3.508554352722950e-01   +7.591345701863529e-01   +2.318013412696889e-01   -4.697102843983385e-01   +7.831871687823699e-01   -6.392323664413964e-01   -3.223058246203646e-03   -4.479110682770875e-02   -5.264533488709149e-01   -4.690255136286743e-02   +3.020114250597721e-01; +4.812757237867621e-01   -2.859547134011106e-01   +7.190333417010332e-02   +7.095811526502324e-02   +2.817402467483287e-01   +2.829771458771916e-01   -4.138436840471781e-01   +3.205523141654424e-01   -3.419677884047963e-01   -2.685307378789886e-01   +1.674164730131794e-01   +3.470746919661603e-01; +2.223452970107228e-01   -9.249322558968005e-03   -1.592598024086276e-01   +4.944922529154056e-01   -3.601891222493486e-01   +2.132588987687592e-01   +2.729297245592317e-01   -2.477565497246753e-01   +1.155574699523677e-01   -2.503887754616451e-01   -2.908101164338499e-01   -4.717367984869553e-02; +4.097986139929643e-03   -6.876464166533672e-02   -3.366826505687023e-01   +5.471542125531915e-01   -1.950882782346875e-01   -4.626388332972818e-01   -2.175926924824449e-01   +7.835691767367732e-01   -3.859055462062859e-01   +1.288538850725047e-01   +4.239745801715452e-01   -1.654207442834742e-03; -3.605100451861465e-01   -6.291192735308034e-01   -9.383759069173883e-02   +3.237364558875584e-02   +2.825223763353323e-01   -1.941774899116262e-01   +3.243776136831463e-01   -4.935181775358620e-01   -2.684824213605271e-01   -5.614553462552142e-01   -4.621818264377984e-01   -8.500795565622180e-02; +5.629235691041212e-01   -1.134856309866661e-01   +6.132999384607196e-01   -1.569133949570793e-02   +4.317609796832645e-01   +6.750637747169913e-01   -1.053897791372759e-01   -2.570713406133043e-01   -2.452621587128163e-02   -3.134555516927686e-01   +3.197012702471742e-01   -5.812051003953589e-01; +2.744136812333198e-01   +1.948115849413989e-01   +4.557735460085895e-01   +2.694493997874088e-01   +7.116668749397201e-01   +4.365685114686935e-01   +8.219520686083387e-01   -9.724227933678019e-02   +7.123471517793909e-01   -9.018533795392061e-02   -6.258213979161176e-01   -5.707913202001554e-01];
L3I_L2I_iGABA_netcon = [-4.156400083540148e-01   +2.512033349292780e-01   +5.252657377463574e-01   +3.995075021066704e-01   +2.211587151657244e-01   +6.698172104105258e-01   +5.434062371128277e-02   -4.385369328893355e-01   +5.224422479906368e-01   +6.095287472245174e-01   +4.850680953220951e-01   -8.898478914543432e-01; -5.115915193431440e-01   +2.960990007461688e-01   -3.135741694613519e-01   -7.046517581562859e-01   +1.530027623575907e-01   +4.306009284323274e-01   +8.805782616394532e-02   -3.433435360274242e-02   -2.599328320064412e-01   -2.326261386365809e-01   -5.339660812756180e-01   -5.412920085565809e-01; -5.737875753792382e-02   -3.216810446379084e-01   -9.983192019588213e-01   +6.591842872067170e-01   +4.836951170557540e-01   +2.030605637467072e-01   -2.449485156920449e-01   +3.142351293290689e-01   +4.001199622885915e-01   +6.259539706066635e-01   +2.028137355724536e-01   -4.468050730044703e-01; -5.816212016992229e-02   +8.734416793049514e-01   -3.469923791051139e-01   -4.735109826158143e-01   +5.632989019038226e-01   -3.938683123484346e-01   +2.398948846801879e-01   +1.803860061419526e-02   -3.073067738891885e-01   -3.367282209277448e-01   -2.947169164744989e-01   +4.180292458058834e-01; +2.499453430922106e-01   +8.729192602225277e-02   -7.466688775791827e-01   -3.134374079698797e-01   +2.426429218294427e-01   -5.816120494752388e-01   +2.564072764029630e-01   +1.339024917414687e-01   +2.766651793577044e-01   +6.579119331799330e-01   -1.684734325841082e-01   -1.846002803457150e-01; -7.759010217041291e-01   +5.387391264346060e-01   -3.707830153193394e-01   -6.370049855107200e-01   +1.000000000000000e+00   +3.899240012593556e-01   -1.674596267631960e-01   +3.878457784088044e-02   -5.723332818647431e-01   +3.604612097339463e-01   +3.912593188193260e-01   -7.817076164400830e-01; -3.529512923274336e-01   +2.404969165581166e-01   -5.659675371271590e-01   -2.631941138258077e-01   +3.957704552768881e-01   -9.386161008080883e-02   -3.180738522579893e-01   +8.776431575533635e-01   +9.941872719872938e-02   +5.525839913303545e-01   -5.855033664267184e-01   +8.368236112027887e-01; +4.092117956805625e-01   -1.340779051324184e-01   -8.742199256441890e-04   -4.624424635098905e-01   +9.303772598199117e-02   -3.993760631939952e-01   +1.911594099256574e-01   -7.442981954602927e-01   -2.135979540706885e-01   +7.493004808639399e-02   +2.972197343847159e-01   -9.444833699591315e-02];
L2E_L3E_iAMPA_netcon = [-1.299030301146939e-01   -4.601036326383064e-02   +1.112132499978722e-01   -1.280872803810789e-01   -4.529411791125597e-01   +2.103765442676485e-01   +5.660054200508557e-01   -5.506916468128515e-01; -2.095175620379872e-01   +3.895451567835079e-01   +7.348341936256941e-01   -2.189079368786807e-01   +6.536217223894536e-01   +4.481113092941221e-01   +2.665299623600609e-01   +2.617654570684711e-01; +3.460612174876817e-01   +7.925408509812066e-01   -7.131385355690057e-01   -8.931856194105352e-01   -3.647302608193286e-01   +3.995980914886852e-01   -4.900823581566682e-01   -6.842545148050260e-01; -3.400152602329651e-01   -1.953896697722411e-01   +7.377847911190652e-02   +4.036938741883034e-01   -8.338527747593741e-01   +7.475739904369898e-01   +7.956691059401926e-01   -3.654899478408052e-01; +6.483818002370448e-01   +1.703368383038922e-01   +8.850663963952801e-01   -4.127285236910450e-01   +6.993472054539528e-01   +5.638894978146057e-01   +7.355665467897692e-02   -3.756441643636019e-01; +6.256482021623606e-02   +5.032472190915253e-01   -3.811271968672146e-01   -4.858890909774568e-01   -1.599796291742844e-01   +4.310453881395114e-01   -4.013878008245582e-01   -2.122273521419871e-02; -9.169560216392900e-01   -2.343489835057915e-01   +1.760812886106719e-02   -1.707853985286462e-01   -4.747368791411952e-01   +3.509090822370453e-01   -1.857926938345369e-01   -3.576815026723070e-01; +2.926832481696864e-01   -8.597327357446299e-02   +2.831175570382460e-01   -5.421974688923938e-01   +4.831226544127756e-01   -5.579850914861494e-01   -3.857766766046357e-01   +1.451636409293830e-01; -1.596131511784052e-01   +8.625551237453354e-01   -8.799430971525025e-01   +3.928898182317813e-01   +8.174833646861764e-01   +7.441243869232045e-02   -4.033671986059330e-01   +5.806402344855314e-01; -3.319228793905925e-01   +1.148454309180277e-01   +3.847921163099291e-02   +4.162518779428037e-01   +4.254463725125814e-01   +2.603708467647268e-01   -3.031650655885754e-01   +1.386661179487143e-01; +5.406741304506794e-01   -2.344015450778304e-01   -2.499734859653898e-01   +4.240660125931649e-01   -9.483914719341543e-01   -9.512926382974072e-03   -4.070818820678558e-01   +6.004017071499470e-01; -3.292505975286448e-01   -1.000000000000000e+00   +2.696411705487962e-01   -2.635328523740897e-01   +2.434543030847709e-02   +3.754819602542406e-01   -3.752301879203874e-01   -3.052976931245180e-01];
L2I_L3I_iGABA_netcon = [+1.565342841324748e-01   -3.446701309212860e-01   +2.927785586434071e-01   +3.230706159282186e-01   -3.039451978207823e-01   -1.101997633828869e-01   +3.644732367640769e-01   +4.665042041493030e-02; +8.919060176961872e-01   +6.217296314900996e-01   +3.020329906144089e-01   -5.560845330829988e-01   +7.150536990176476e-01   -2.128304174209843e-01   +7.557148776046877e-01   +4.887191764632354e-01; +5.841152312533254e-01   +5.575486828285813e-01   -8.410356520419549e-02   -8.070942192762844e-01   +1.713664655000445e-01   -6.561770345463735e-01   +2.888893273889410e-01   +3.724315425368762e-01; -8.970810817605238e-02   +5.436463277614624e-02   -9.578758387036265e-01   -2.634042804644689e-01   +7.082683207342281e-01   +5.888341674988736e-01   -2.516314512137787e-01   -7.099781882908666e-01; +3.541723766110447e-01   +3.133541977467875e-01   -5.123769633276644e-01   -8.106894479079461e-02   -1.075977868838049e-01   -4.169823228749094e-01   +9.030321193678480e-01   -1.242823843490708e-01; +1.238122131472842e-01   -1.422623515374664e-01   +2.224685424021984e-01   +1.000000000000000e+00   -2.251928222696850e-01   +3.819408166123016e-01   -1.298932697936593e-01   -2.021387750999891e-01; -2.510951075158848e-01   +9.993828967746959e-02   +2.615354752180696e-01   -6.809631881944650e-02   -2.566549034405278e-01   -1.021898621950374e-01   -4.359723175959236e-01   +2.063973282603702e-01; -5.073959180071749e-01   -3.266992752253160e-01   -6.595165178510413e-01   -2.095254622402297e-01   -6.042306427165175e-01   -3.946710356350799e-01   +3.043837764371018e-01   +3.095426291386379e-01; +2.556787647428462e-01   +3.014770339622951e-02   +6.069095037441268e-01   -5.046049439526632e-01   -2.888476175444822e-01   +1.340725190084417e-01   -3.624470063086895e-01   -1.914465334896214e-01; +6.598676002071350e-01   +4.495783924450265e-01   -3.459654996690373e-01   +1.800994713387830e-01   +6.269709152813441e-01   -5.225520463471532e-01   -2.167623408874085e-01   +6.217794102882809e-01; +5.761203585068105e-01   -6.946724201910274e-01   -3.589194253196181e-01   -7.350160956366028e-01   -2.554896271911882e-01   -2.112776419366296e-02   -1.449707021685910e-01   +4.410807318858280e-01; +3.974259358548001e-01   +4.946127466919596e-01   +3.472576391435869e-01   +3.970772372288469e-01   -5.512836986402119e-02   +4.119626945917726e-01   -9.652763078349991e-01   +6.354940064033685e-01];
L3I_L3E_iAMPA_netcon = [-6.910280119966496e-01   -3.273121304558453e-03   +3.302259668616200e-01   -8.365880965171202e-01   -3.805810600937586e-01   +3.186522502157559e-01   +2.223147764237790e-01   -2.114073423642238e-01   -4.440386975153033e-01   -2.623105496448179e-01   -6.790454452577929e-02   -6.231957366523342e-01; +4.347447054667928e-01   +3.929122650819584e-01   +1.787595176901678e-03   +7.568194717195335e-01   +4.658694159348170e-01   -2.454361181541790e-01   +1.896899420031737e-01   +6.174154250603526e-01   -5.802996198202082e-01   +5.615487937791755e-02   +5.684985594027138e-01   +5.669890945352795e-01; -1.343654609617912e-01   +2.253488028417472e-02   -2.971703360280109e-01   -4.668931836317385e-01   +2.127746723626785e-01   +7.885832879258478e-02   -7.404404349232259e-01   -2.474521466844171e-01   -8.839212505751053e-01   -8.618315568861405e-01   -2.888926295913801e-01   +8.469878615542545e-01; +6.904063390772897e-01   +6.373145601988374e-02   +5.816579819168387e-01   +2.201373771628775e-01   +3.949203433557504e-01   -5.035201977228058e-01   -2.900929286616830e-01   +2.490010506425498e-01   -1.462483856929926e-01   -7.958345929577983e-01   -3.405598522020757e-01   +1.790600835167173e-01; +1.460467359835806e-02   +5.962542773137945e-02   +1.445916934627133e-02   -3.137279163505969e-01   +2.150141680806307e-01   +9.912326261771494e-02   +3.251644628117962e-01   -2.935233263839396e-02   -4.595566684238023e-02   -6.963134094144989e-01   -2.616216218358541e-01   -1.136753416891754e-01; +2.198949454134502e-01   -3.787188828760122e-01   +5.379412524607979e-01   -3.940162736377854e-01   -1.243880151473943e-01   -8.078199483653501e-01   +2.585677318436964e-01   -2.519187268616341e-01   +4.496236313661887e-01   -3.891119928767577e-01   -4.899295772579335e-01   +3.485869506145929e-01; +5.205459871574856e-01   +1.610068125007256e-01   +6.148560192713928e-01   -5.125876065069013e-01   -6.335480163962124e-01   +2.137020744287119e-01   -7.110813436285958e-02   +5.267460212465176e-01   -5.427586163552567e-01   +3.268194000488434e-01   -4.008672351143296e-01   -2.275901945724426e-01; +2.968042061981065e-01   +2.290280886289490e-01   -5.518243722153545e-03   -1.158433287038372e-01   -1.196973615034945e-02   -1.648920508778488e-01   +6.048554651139327e-01   +3.680701576937040e-01   -1.555031122959134e-02   -1.724909797823650e-01   +7.104432002364289e-01   +2.151962288522410e-01; +6.475854228230091e-01   +5.279684653498287e-01   -5.203783365453526e-01   +1.929057919934946e-01   +3.305755132131353e-01   +1.000000000000000e+00   -3.580999695571616e-01   -5.378543593774170e-04   -5.665751166685851e-01   +2.698471295780388e-02   +1.421232086145459e-01   -2.703429464119695e-01; -6.100306187725364e-01   +2.261782337440866e-01   +4.089494456937767e-01   -4.309143556375785e-01   -2.629645116630820e-01   +7.424346674693350e-01   -6.065488990795798e-01   -5.342005658079151e-02   -3.942421039734573e-01   -1.723809713681483e-01   -6.912691894488275e-01   -1.898353593057084e-01; +7.409275901052740e-01   -8.476609318281142e-02   -2.238484918235987e-01   +4.250083231066260e-01   -1.785035914208555e-01   +4.632427096323734e-01   +1.881427023621726e-02   -4.977148750754624e-01   +5.308744776592501e-02   +1.735183174042914e-01   -2.345472115153164e-01   +6.842811433564666e-01; +3.606180508038473e-01   +3.058669484495216e-01   -6.722421766602173e-01   -2.016534484515990e-01   +8.389092097968130e-01   +3.072639051597418e-01   +2.128129713533357e-01   +8.687217047489048e-01   -6.001980262642900e-02   -7.202343096370550e-01   +5.461201950720938e-02   -7.009434634893524e-01];
L3E_L3I_iGABA_netcon = [-2.979464197748196e-01   -5.526085398487387e-01   +5.992597655506855e-02   +9.024164550231358e-01   -2.912995669405793e-03   -2.367473303290676e-01   -6.213515084022011e-01   +3.103390359714350e-01   -8.143273213908688e-01   -5.538306914660880e-01   +1.462508382311700e-01   -6.060301304155531e-02; +3.046281333380418e-01   +1.021392190383570e-02   +3.015434405090178e-01   -6.263965471802445e-01   +3.379171874841628e-01   -8.945985060730683e-03   +5.909659524385700e-01   +5.929620489640773e-01   -1.614017475428138e-01   -4.856898762431074e-01   +3.165499295564682e-01   +2.215610465871409e-01; -4.037227596439009e-02   +5.939166216046608e-02   -3.181773494971599e-01   +4.812285336805405e-01   +5.153422525776988e-01   -6.632583372040414e-01   -8.477044745944088e-01   +5.815544382488980e-01   +4.695893092244176e-01   +2.824735489785102e-02   -5.943771024722864e-01   -8.121177304481598e-01; -7.511574671819614e-01   -4.468662374976248e-01   -2.635973492298329e-01   -9.897335866275034e-01   -2.200812404817389e-01   +2.535989867600082e-01   +2.039970643099842e-01   +6.262532176140434e-01   -1.070740537654075e-01   -7.023850156983998e-01   -5.064121713530624e-01   -1.987091910293061e-01; +4.614003244925381e-01   +3.226134193462939e-02   +1.076015097435834e-01   +3.755452564749132e-01   -2.662914540153465e-01   +2.371748396158742e-01   -5.689013022160636e-01   -3.560968663690462e-01   +5.843448952630841e-01   +2.947338513082261e-01   -4.834619253698345e-01   +8.946313393907290e-01; +2.711600822043905e-01   +3.245885604587365e-01   +8.430496372837187e-01   +6.832583773771055e-01   -1.367782318810194e-01   +3.493894947451729e-01   +1.606109580851155e-01   -8.355921203591198e-02   +1.100277037796452e-01   -3.961514291453937e-01   -4.777835345698964e-01   +6.189327582101298e-01; -7.623540074036924e-01   +3.089429477415261e-01   -1.838095475404029e-01   -1.616598573747959e-02   +6.591567236968684e-01   -9.988686639147684e-02   +4.448258828015657e-03   -1.869870266053185e-01   +3.919253927807114e-01   +3.336646843876868e-01   -1.760034454364561e-01   +1.420758647981624e-02; -6.584361210704428e-01   +5.923823126718745e-01   -5.861823740298031e-01   +7.947923207888683e-01   +5.676309581366011e-01   -2.058281592826384e-01   +1.951741856985823e-01   +4.808992687411082e-01   -8.173398651424543e-01   +1.452642116182350e-02   +4.507221328290143e-01   -1.643637008584804e-01; +4.318747046460691e-01   +2.441502912277922e-01   +4.956951449522445e-01   +2.605224514369772e-01   +1.333217627396695e-01   -8.955824373106064e-01   +7.465696641342685e-02   +3.803656019098283e-01   -1.132864478320489e-01   +2.511346338633586e-01   +1.243496798222396e-01   +2.091505552214347e-02; -1.791788775486714e-01   -2.796561848206724e-01   -2.508416054395977e-01   -1.959322928601831e-01   -4.654563614630250e-01   +3.217621653419849e-01   +3.707491072380212e-01   -8.114608197430810e-02   -4.304498073566345e-01   +5.068906818450387e-01   +3.967747782537631e-01   -4.598566844962581e-01; -2.325887283766914e-01   +1.485211582266328e-02   -1.000000000000000e+00   -4.823619853385640e-02   -5.433711903944355e-01   -4.105952464999787e-01   +6.499208712045098e-01   -1.849516709108029e-01   -2.735679922544967e-01   +5.155846157771621e-01   -2.747394474543492e-01   -5.866263296100829e-02; -1.817324010616227e-01   +4.651574842373694e-01   +3.043073354675332e-01   +3.817905396239347e-01   -1.578544606256667e-01   -3.699728102313048e-01   +2.319059260918866e-02   +5.713736493057878e-01   -6.753122834024446e-01   -4.241265036703110e-01   +2.296120218743037e-01   -3.131231586986520e-01];
L2E_Input1_iAMPA_netcon = [+4.543762788525558e-01   -3.358335129003944e-01   +2.554134124291957e-02   -8.369971678912876e-01   +7.697538724943179e-01   +5.637866860927517e-01   +8.356515245590544e-01   -4.721942636349462e-01];
L2I_Input2_iAMPA_netcon = [-8.340211307597446e-02   +1.000000000000000e+00   -8.302016877345366e-01   -5.316950230808652e-01   -5.688124822209092e-01   -6.480057650467101e-02   +2.374221361282998e-02   -6.246411602812593e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
