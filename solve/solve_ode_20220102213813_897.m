function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-3.842522345050992e-01   -5.610123924311888e-01   +1.934138071600730e-02   +5.416840449378872e-02   +2.846189012454355e-01   +5.331213581861755e-02   -5.553130028220590e-01   -1.699558336219416e-01   +5.399970980577052e-01   +7.186718724883778e-01   +1.577353266727649e-01   -2.338704907018488e-01   +5.545085361113782e-01   -8.424545833305244e-02   -4.412381130182243e-01   -1.517973115687564e-01; +1.578036695792153e-01   +4.374873408489348e-01   +3.172825646582361e-02   +2.812899104101657e-01   +5.052113009423390e-02   +6.369773709847923e-01   -4.067343489893525e-01   -2.079905433515642e-01   +9.739587808582995e-02   -4.235797485753413e-02   +1.313691327154112e-01   +4.081102349062802e-01   +2.377586064204942e-01   -1.785224243649246e-02   +1.649145571833377e-02   -4.894517989427493e-02; +2.907586276466936e-01   +2.290548059335326e-01   -2.237719957067252e-01   +3.123598444806525e-01   -3.815900459551420e-01   +4.619342272879547e-01   +5.862950764826448e-01   -3.557255361940158e-01   +4.301276761065451e-01   +1.911885483385779e-01   +3.569275276776285e-01   +4.684329532214118e-02   -1.192882430321811e-01   -5.507747148206679e-01   +2.872264207673755e-01   +6.018353936951910e-01; +4.229803760882769e-01   -2.011703623289520e-01   -1.842360740932719e-01   +5.183116751993179e-01   +1.094782457423831e-01   +7.037914125855075e-01   +5.627185138025533e-01   +4.286684123855282e-01   +1.271102486662977e-01   -2.386019439536466e-01   +4.078885670217861e-01   -4.162849608941276e-02   -2.053290059119312e-01   +3.225070130297745e-01   +2.007241645551192e-01   +9.174101415361552e-01; +3.854738908444085e-01   +1.178271229052912e-01   +6.608465512347239e-01   +4.498675158209158e-01   -1.138553220976629e-01   +2.272229761483588e-01   +1.511273758607663e-01   +1.633586647627364e-01   +4.995659725525313e-02   +4.451572926681394e-01   +4.739184413735344e-01   +1.987290751242916e-01   +4.099059157974424e-01   -2.009803264798471e-01   +2.284273328219764e-01   +2.391264951995702e-01; -1.453033015434098e-01   +9.557323011245962e-01   +5.850370157192097e-01   +1.119019236543822e-02   +4.222430007241050e-01   +2.784135716545545e-01   +4.725641450278482e-01   +2.588936637078774e-01   +8.348580341846143e-02   -3.290260812361491e-02   +2.061094137099670e-01   -2.439007911233155e-01   +2.090717572112974e-01   +2.475089313140894e-01   -2.231059632379674e-01   -1.660136213266512e-01; +2.242836250370082e-01   +4.614632429826220e-01   +7.658772723492961e-01   +3.552234947523646e-01   -3.715113004832966e-01   +1.146644802397326e-01   +2.028842408177756e-01   +3.681858124672246e-02   -7.140977910279716e-01   +2.364153074909321e-01   +2.383554053161940e-01   -5.517480021182140e-02   +5.008842568966008e-01   +3.865023429038453e-02   +5.849884614262383e-01   +4.995757879949146e-01; +1.730399980318519e-01   +4.891240935348438e-01   -2.446935877010579e-01   +2.994722039167060e-01   +3.886415598098976e-01   -9.832022400123019e-02   +7.578683744059002e-01   +3.216768142269270e-01   +3.028941464022548e-01   -2.611694077256018e-01   +3.103695519412587e-01   -1.791154387515419e-02   -4.227798193560980e-02   +2.684419775121155e-02   -2.665034826507717e-01   +3.072139867430925e-01; +3.720643988433228e-02   +7.202046868158705e-01   -1.746016509860711e-01   -6.786427279487731e-02   +3.716044980834410e-01   +3.271458650447897e-01   -2.173263464688815e-01   -2.868773438474420e-01   +3.885435485298157e-01   -1.360150376988069e-01   +3.731563337483356e-01   +7.972550478049048e-02   -2.200059543749993e-02   +4.161101602489461e-01   -2.737989338881606e-01   +8.094043586759025e-02; +4.087752511774835e-01   +1.722362470303835e-01   -2.750658277086454e-02   +3.716133458900391e-01   -2.642438122426314e-01   -7.815698281623251e-02   +3.185030034533731e-01   -2.842254150090111e-01   +5.946063008835156e-03   -2.637214128223652e-01   +9.407669020323858e-01   +2.252844394125001e-01   +2.786525945010375e-01   +2.961956835936446e-01   +1.530892014290277e-01   -2.377504418525645e-02; +3.014913345349727e-01   +9.553641189019840e-01   -4.054860959287539e-02   -1.702713713480875e-01   +3.526661897462789e-01   +5.552397751641554e-02   -1.780749910460833e-01   -1.891341146983532e-01   +3.071792030185483e-01   +5.748355061307938e-01   +1.667893201254249e-01   +1.738714457223553e-01   -6.514194044171030e-01   -1.901257749449755e-01   +2.510363150894931e-01   +9.625523641233759e-02; +3.401373458384588e-01   +3.583342719947411e-01   +7.154097984808926e-02   -3.480634880150170e-01   -9.594245123341648e-02   +2.614005042588435e-01   +1.709964486684725e-01   +1.151487288844035e-01   +2.494546346072789e-01   -5.566256661141581e-01   +2.930993447800897e-01   +5.567149363806329e-01   +6.952894232077228e-01   +6.694802598339766e-02   -5.585492043119482e-01   -8.342423162810370e-02; -3.822286694492875e-01   +2.569836695903602e-01   +6.875596592578362e-02   +2.434322501574614e-01   +7.090641554195970e-01   +8.193200770311982e-01   -3.227213580711357e-01   +4.783251477245985e-02   +2.542407524137903e-01   +5.535315619635697e-01   +2.041282203919546e-01   +4.132017490461360e-01   -2.651556117095485e-01   +2.834758399293730e-01   +1.475003042916564e-01   +2.051465881636541e-01; -5.551249443877968e-01   +4.989136365598005e-01   +3.437638471708101e-01   -7.064167483947797e-01   +1.960348876562255e-01   +2.759308248808632e-01   -2.244254051281314e-01   -1.332464075836968e-01   -3.352975567110592e-01   +2.638433035796066e-01   +7.665283631261319e-01   -4.165167285436106e-02   -9.705380928679209e-02   +5.019824055112416e-01   -2.293580752223668e-01   -2.931525592321961e-01; +4.449630888900238e-01   -2.124999169738908e-01   +3.503293877065403e-01   +3.077692889640639e-01   -1.176433312480205e-02   -4.469135137113728e-02   -5.534459501994766e-02   +2.578525430334108e-01   +4.402730070855673e-02   -1.957885442919375e-01   +1.366301008623299e-01   +4.777405781726553e-02   +6.981361806927240e-01   +7.670189283801562e-02   +1.079616052749077e-01   -2.870690732497141e-03; -9.926088263505191e-01   +4.651911897811657e-01   -5.701907078140425e-01   +6.091929936905682e-01   +7.291769764679160e-01   +3.222658295363731e-01   -1.640940004190259e-01   +5.220073999816734e-01   -3.963302830356922e-01   +3.541828363612459e-01   +3.848911002658543e-01   -2.701760092554795e-02   -6.410660276740703e-02   +2.583322355050921e-01   +5.385927013959485e-02   +3.738078544328768e-01];
L1E_L1I_iGABA_netcon = [+4.967271492923482e-03   +8.587026803014015e-01   -5.115839637929432e-01   -4.158224327003648e-01   +4.176740578773074e-01   +2.515551548670494e-01   +7.116535533451298e-01   +2.189939771892545e-01   -6.203512483808459e-01   +6.670792203399278e-03   -3.573561724462950e-01   +7.361150185427825e-01   +9.503509368980234e-01   -4.834817618630672e-01   +7.611476624562872e-01   +6.588955558507127e-01; -2.146127095837232e-01   -4.195319870627116e-02   +9.515509149832294e-01   -5.072813530289615e-01   +4.414766956958685e-01   -4.519446181379027e-01   +6.608123981797179e-01   +7.559422340421307e-01   +2.295491967447278e-01   +5.056145299754031e-01   +2.175120618170728e-01   -2.682985928762146e-01   +4.042491792350322e-01   +5.401459378079710e-01   +6.966063601298407e-01   -1.950503328544828e-01; +1.653561866589906e-01   +5.351010808603924e-01   -4.237431748751611e-01   +5.045543388994878e-01   -3.486771378734670e-01   -3.581214951828949e-01   -7.674396867891939e-02   -2.888831964209053e-01   +3.173693050933422e-01   +3.555807607038659e-01   -2.705706306784271e-01   +6.320643884884889e-01   -9.030398450968603e-02   -4.890080751797833e-01   +7.165760417584630e-01   -1.216524921894391e-01; +4.190342313187182e-01   -2.671516309351848e-01   -5.112313397312791e-01   +8.548123277573481e-02   +1.293622327895198e-01   +8.357074527053966e-02   +1.217612816643562e-01   -2.137520129457829e-01   +1.529756336923328e-01   +4.018913103473762e-01   +4.375986445392717e-01   +4.357974099564783e-02   +3.253774871905327e-02   +3.530787262960285e-01   +4.131453249337808e-01   -2.977165931665335e-01; -6.355639695806228e-02   +4.449478041311600e-01   +4.274389579137399e-01   -2.917491451370470e-02   +6.755824844422669e-01   -3.388318303295758e-01   -1.740172252080517e-01   -5.396825424487963e-01   +2.949695252210887e-01   +4.983860711575052e-01   -2.357968958811152e-01   +6.883138982739434e-01   +8.414986876877433e-01   +3.297419157416933e-01   -3.477103724416293e-01   +1.677167714044453e-01; +3.035726259856987e-01   +1.401125766816731e-01   +1.476277782286033e-01   -6.020715819028510e-01   +4.622653122183518e-02   +3.892724108011429e-01   -2.404193145015776e-01   -4.099971187452800e-01   +6.456923911652115e-02   -2.214103874236804e-01   -2.424698738305564e-01   +6.361011590949988e-01   +2.380343950490210e-01   -1.730413394785960e-01   +2.966959549001927e-01   -1.763633406743849e-01; -8.582605008802060e-01   -4.024396075760237e-01   -3.237427012531133e-01   -6.080671677882354e-01   +6.140235537250235e-01   -6.768235485808090e-02   -2.724336997617164e-01   -3.164911075812960e-01   +6.755406931213471e-01   +4.394613099992597e-01   +6.581772740581340e-01   +1.486485541589812e-01   -2.828059104548162e-01   +5.605931565981055e-01   +6.869182985962021e-01   +1.727704199092212e-01; +4.420592264044040e-01   +2.402885349998272e-01   -3.532301183800161e-01   +1.635027504131128e-01   +7.538012381891379e-02   -3.736600781088179e-01   +8.669974891983055e-01   +1.038509680372828e-02   +6.975822365831590e-01   +1.300114144906865e-01   +4.172955713522225e-02   -2.083130447678345e-01   +9.305294247241216e-01   +5.519886221787150e-01   +3.476929412205693e-01   +9.317845801078315e-01; +1.056123043379951e-01   +8.752722444640185e-01   +1.712858922901824e-01   -3.190274119017258e-01   -6.006110566422832e-01   +6.841333877196525e-01   -9.789858676042011e-02   +2.076965474090863e-01   +2.348787574400482e-01   -5.566992782512159e-01   -1.254547121772354e-02   -3.496500484890045e-01   -3.447441874708914e-01   +2.926904374500951e-02   +8.663922450967940e-01   +6.330144875859472e-02; +4.288037855362288e-01   +8.600028695915873e-01   +9.459716123546627e-02   -4.089407846417328e-01   -9.360159445772598e-02   +2.527293234437772e-01   -1.701006100972977e-01   +8.841641257917027e-02   +6.600949423265385e-01   -5.475424493253624e-02   -5.576276800643077e-01   +1.668547306529812e-01   +6.002432217874438e-01   +1.590740455534799e-01   +3.235009480961547e-02   +2.278991626048181e-01; +2.823903900484395e-01   -6.669085175264836e-03   +1.893357878075693e-01   +5.217299087186322e-01   +2.823285029416498e-01   -1.825154711984995e-01   +2.521681324018302e-01   -2.274302826553035e-01   +6.567324581217910e-01   +4.197447245347016e-01   -5.781244727133283e-01   +5.613492831320996e-01   +5.971925388999237e-01   +3.166857860227370e-01   +2.837035454837594e-01   -5.655338638621428e-01; +5.884387731108914e-02   +7.450686768233650e-02   +1.248349960314969e-01   -5.031715939215387e-01   +1.811137994408086e-01   +2.899297292300237e-02   -3.922401690081931e-01   +2.000746788691314e-01   +2.216348183448353e-01   -5.537445547107696e-02   +1.565862311812972e-01   -1.417244148586767e-01   +4.806276113649800e-01   -1.790793468655221e-01   +5.041261597852316e-01   +5.085074844095774e-02; +6.424790915941043e-01   +1.800877837655941e-01   +1.315876695656516e-01   +2.152398589303082e-01   -6.621467569448997e-02   -1.694817602029523e-01   +2.691593266249205e-01   +9.721581628038695e-02   +4.039078719203927e-01   -6.121548793565179e-02   -2.158032620051263e-01   -4.183238079850954e-01   +4.043236812613800e-01   +2.343669524327111e-01   +2.520083837535311e-01   +1.919397606685981e-01; +5.372059219464169e-01   -1.076648331147016e-01   -2.168540266073626e-01   +2.730541165751418e-01   +1.066189052098800e-01   -1.586947630442793e-01   +3.109585741522666e-01   +2.091231276030260e-01   +7.347837872417198e-01   -4.013400758552746e-02   +1.762020743912463e-01   +3.532768667356070e-01   -3.430537633685543e-01   +8.177142300846404e-02   -3.237105651274856e-01   -2.594749309885652e-02; +3.117008446337668e-02   +5.083485664578511e-01   -1.380587839458935e-01   +2.032925261656946e-01   -2.580348176239348e-01   +1.851353658602342e-01   +2.004822127669389e-01   +1.098824816013570e-01   +5.553379553557942e-01   +1.034434316881430e-01   +7.967366415510443e-01   +9.023735950917665e-02   -2.572098342698167e-01   -9.224661856446037e-01   +9.651399300703456e-01   +1.998540356657191e-01; -4.233669617399071e-01   +5.383286849329336e-01   -1.288769425750902e-01   -2.291137990220177e-01   -1.934384260397690e-01   -2.676931804015857e-02   -4.493732395058227e-02   -1.276511472051707e-01   -1.910245181723624e-01   +1.805107226030179e-01   -4.851908239673522e-01   -1.387936190460053e-01   +4.209148375666036e-01   +2.803042526844367e-01   -8.582713620926224e-02   +2.947892925343834e-01];
L2I_L1I_iGABA_netcon = [-1.871146109862137e-01   -2.988175335504135e-01   +1.901876663388749e-02   +5.084384142316678e-01   -3.837273597725097e-01   +4.420088769654976e-01   -1.712058654275911e-01   -1.713921148870700e-01; -1.083588676670267e-01   +6.370152774557956e-01   -1.087868660597435e-01   -1.601317951396864e-01   +3.973955005064271e-01   +5.820261744221599e-01   -2.820237621526703e-02   -4.094085835952845e-01; +4.808326456778904e-01   -2.068855413872916e-01   -5.235051777372945e-02   +3.164057201159436e-01   -8.301894409712204e-02   -6.188669957795145e-02   +1.647648155628728e-02   +3.467555232554490e-01; +2.450341608620737e-01   -5.129160657922032e-02   +6.332538855601419e-01   +4.062928177040236e-01   +1.057549963492891e-01   +3.403205823143901e-01   +3.060389153767825e-01   -1.272719901467171e-01; +1.655838245702690e-01   -2.989921418702383e-01   +6.368726988642401e-01   +4.285059987702817e-01   +6.919924046830994e-01   +4.656627144313273e-01   +1.742684317527340e-01   +2.884901015257773e-01; -1.223217699966010e-01   +2.952331414463658e-02   +3.762512319924570e-01   +5.043341190829305e-01   -2.615524890928049e-01   +4.675344312411168e-01   +5.694824501501274e-01   +6.811737576861525e-01; +9.281607429652153e-02   +2.493797624661847e-02   +1.394386272659386e-01   -4.494867404476435e-03   +2.588363012459202e-02   +6.794833817737268e-01   +6.070498225588248e-01   -5.756990488475475e-02; -2.097381563616387e-01   +5.871484786795296e-01   +1.018508108478863e-02   +6.284034633866828e-02   +5.724367175929965e-01   -8.128147933417880e-02   +4.747900072176463e-01   +1.080135674418313e-01; -4.827000942721989e-02   +7.414112828060744e-01   -5.584967562014944e-01   +4.864414765904542e-01   +3.812841086425269e-01   +5.453612801175202e-01   +1.768528340224912e-01   -2.958680143789310e-01; +7.780244064777314e-03   -2.073310536634909e-01   +2.873954186872490e-01   -3.307917764238495e-02   +1.546333282496042e-01   +2.959020541711816e-01   -5.248833568863212e-01   +7.606184787467299e-02; -1.673289815264809e-01   +9.768960175957629e-02   +2.057421733472536e-01   +3.944235501519903e-01   +1.791924553873853e-01   -6.676077233307784e-02   +4.410342133908481e-02   +2.028218149857374e-01; +3.657429301790837e-01   +3.871762957168248e-01   +1.600089096729613e-01   -1.570228673457074e-01   +3.951297231307713e-02   +4.087391465135894e-02   +6.044718446757189e-01   +3.855713824439163e-01; +4.598673121186513e-01   +2.545869767587535e-01   +1.967997393841803e-01   +2.725866907362141e-01   +4.252206566588148e-01   -4.358122971324253e-01   -3.482916886669077e-01   -8.681495474258673e-02; -3.743400553554657e-01   -2.969694393822949e-01   -5.754474054022563e-02   -4.785706644670304e-01   +3.364638025715844e-01   -2.438172143104755e-01   +5.764817052319881e-01   +5.311578971683664e-01; +5.880189566104995e-01   +3.110826844815492e-01   +3.125426521801321e-01   +2.507104743827988e-01   -4.519475190936837e-01   +7.165459047146588e-01   +7.216428483538476e-01   +1.913593502336934e-01; +1.515484199479747e-01   +1.030564901029318e-01   +4.225464513622570e-01   +4.725090433347525e-01   +3.615799275065217e-01   +3.135681943532160e-01   -2.005858961366278e-03   -2.297303047434959e-02];
L1I_L2I_iGABA_netcon = [+6.063787893739542e-01   -3.707638343002289e-01   +9.012709796474541e-02   +3.171063739052355e-01   +1.341702654471270e-01   +2.346844607246329e-01   -3.807020820573853e-01   -1.707921093716520e-01   -1.757851002431270e-01   +3.917831236059992e-01   +4.651332324899499e-02   -9.120232198723610e-02   -2.164090578634983e-01   -9.540543072295447e-02   -1.198328152252912e-01   +1.781546908645408e-01; +4.128448435227915e-01   -4.676935661986003e-01   -1.698739479927673e-01   -5.134598194373161e-02   -3.185743930812677e-01   +6.249160753864796e-02   +2.401220805349324e-01   +4.789044480072078e-01   -1.205146553900325e-02   +6.677007401511429e-01   +4.371329594676704e-01   -1.966233013943496e-01   +8.844436024080432e-02   -3.561160554976101e-01   +4.580766575586568e-01   +3.201604885160153e-01; +3.777631136518065e-01   +3.890634787972971e-02   +3.836436529051228e-01   -1.268528595710529e-01   +6.556728011100302e-02   -4.453466932372839e-01   +2.462441469952119e-01   +1.026794438776624e-01   -8.129187138130316e-02   +7.581209493843470e-02   -4.673924823475707e-01   +9.954782029171194e-02   +3.731848516917604e-01   +5.150962923866401e-01   +4.962575716980780e-01   -2.815505169161363e-02; +4.337451105802597e-01   +5.504051363753820e-01   +3.660898208201031e-01   -1.508223336039621e-01   +4.608438236330085e-01   +7.270710182506780e-01   +4.318339198664652e-01   -8.706979253773338e-02   +1.316555890751789e-01   +7.855980066725780e-01   +3.674341447025499e-01   +4.989347167270187e-01   +1.472377554747502e-01   +8.774990756032850e-01   +2.664939708047706e-01   +5.489846060376843e-01; -4.905522800960080e-01   +5.940487424352096e-03   +2.441935158984287e-01   +3.233152733798266e-01   +2.943601018591920e-01   +5.423306949141319e-01   +5.690540613310280e-01   +4.683541151635277e-01   +2.093457563635913e-01   +3.670598310661976e-01   +3.262719990076536e-02   +1.558202703340659e-01   -8.539653208466923e-01   +3.790508416074595e-01   +4.461413787179149e-01   +7.741205835902154e-01; -1.183000898876880e-01   +5.548325723044547e-01   -6.352681396061398e-01   +2.759135192361878e-01   -7.239486841736829e-02   -2.340124945844702e-01   +4.167840263323048e-01   +4.133583778745567e-01   +3.143244918004971e-01   +1.475815655603072e-01   +7.520425035533344e-02   -1.564073068638028e-01   +1.017069452423729e-01   +1.000000000000000e+00   +2.590284566427984e-01   +2.766470107592461e-01; +9.311576617351423e-02   +2.698318647115001e-01   -3.039180922596877e-01   +3.864561009104281e-01   +4.786879167002910e-01   -5.090787818580972e-01   +2.976501099857203e-01   -2.314790056660039e-01   -3.011722277336537e-01   -2.865551457297554e-01   +3.011351287233628e-01   +4.222267051957755e-01   +4.444252126085516e-02   +9.340589163007705e-02   +9.679192498478086e-02   +2.093020788909309e-01; +3.234450556095383e-01   +2.730321835875479e-01   +1.190867437506002e-01   -1.769140254685458e-01   +5.260805232493792e-02   +3.022658973182949e-01   -3.375189435058017e-01   -2.958267023939156e-01   +5.406814075653010e-02   +1.042699610478197e-01   +2.351678233224123e-01   +5.332340976192043e-01   -1.483097650540085e-01   +1.567965270571757e-01   +9.742033399735651e-02   +5.006692158241668e-01];
L2E_L1E_iAMPA_netcon = [+1.161014327559994e-01   -7.445349086972017e-01   +3.085587181360677e-03   +5.928370277880505e-01   +4.644588377447395e-01   +1.539035283311343e-01   +5.593470630844967e-01   -1.756326122719381e-01; -1.016245037748157e-01   +2.057456633474444e-01   -5.320650056265535e-01   +3.498316093950158e-01   +4.113172842215930e-01   +3.765031475812828e-01   +1.815628215560929e-01   +6.829663612727491e-02; +5.903479356613053e-01   -1.119424316172312e-01   +2.421572128727753e-01   +1.392634436094607e-01   -1.529084189891692e-01   +8.902853971483068e-02   +1.388065166908369e-01   +2.706998648966292e-01; +3.352563082940886e-01   -7.723114694440117e-02   -2.661049621715382e-01   +4.976013023177304e-01   -8.854334351611981e-03   -5.569659122825540e-02   -3.499165958484676e-01   +2.566353251107811e-02; +1.975023334583307e-01   -1.114447479489995e-01   +2.666037799837701e-01   -3.514724972411197e-01   +1.358296145893005e-01   -1.280613184641258e-01   +7.373023583103917e-02   +3.678824801455833e-01; +7.957665391931986e-01   -1.787552808187925e-01   +7.783283581430119e-02   +7.598659100231575e-01   +4.878201916910360e-01   +6.238476145861275e-01   +3.557460407686112e-01   +3.387344095549179e-01; -4.995494386793465e-01   +7.510575747314896e-01   -5.405602328731174e-02   -2.214457070849665e-01   -1.114468649499428e-01   +3.009612603720664e-01   +7.344017982096467e-01   -2.478968735321674e-01; +1.904372066903425e-01   +2.666777513279682e-01   +8.384072830161611e-01   -1.229922732456211e-01   +1.704932449836103e-01   +2.958287240964643e-01   +5.913009752263606e-01   -1.167905027998331e-01; +1.928536659532621e-01   -3.804242447044202e-02   +7.041129764375060e-01   +7.190436022832450e-01   -4.374129552435074e-01   +4.979308210201652e-01   +6.333976033003228e-01   -2.397402357567336e-01; -3.165914008166532e-01   +1.799605718642083e-01   +8.627553151618444e-02   +3.421993004171904e-01   -1.250711964168878e-01   -3.420885610656954e-01   -2.941996051802143e-01   -3.008854931498551e-01; +7.890765962486807e-03   +7.896389370299300e-01   +6.261060260959193e-01   +1.141439002557466e-01   +1.236843616469528e-01   +1.450463898214173e-01   -1.588247712601090e-01   +2.060007841978877e-01; +1.220339277413347e-01   -3.765186332030029e-01   +5.997089339743868e-01   -4.300748484010422e-02   -3.655726147667174e-01   -3.709979947964367e-02   +7.784675493800887e-02   -5.061704002207481e-01; -3.237673430202902e-01   +2.744823965142729e-01   -5.638679004245556e-03   +5.855583923253239e-02   +4.856754834872850e-01   -5.004018757815787e-01   +5.864025445644477e-02   -2.429384035346696e-01; +3.975037274800583e-02   +7.919656227715509e-01   -1.464042997371935e-01   -6.219458006038128e-02   +5.840302862944247e-01   +1.634646125366339e-01   -3.847705750100963e-01   +3.216833475800261e-01; +2.447655036516949e-01   +3.693521856718177e-01   +1.382349687112549e-01   +1.408494244768707e-01   -2.103358976032014e-02   -7.509541561079930e-02   -3.325770860300190e-01   -2.011553706590752e-01; -1.248261793494839e-01   +4.018547312653165e-03   -6.256905688911196e-01   +7.833732297224301e-02   +1.368283106781859e-02   +1.803971026577053e-01   +6.238753499786234e-01   -1.585966435261713e-01];
L1E_L2E_iAMPA_netcon = [+4.070357187126616e-01   +2.148099060779601e-01   -8.390042498588395e-02   -1.357622320563983e-01   +3.662760481682750e-01   +3.010977199769798e-01   +3.362013087279175e-01   +1.399287289495125e-02   -1.100221461296738e-01   -1.485357525532223e-01   +5.432484392885110e-01   -2.168980378041706e-01   -9.887580132172774e-02   -1.131758169403373e-01   +7.474859639318311e-02   +2.125391614385702e-01; +3.631115084793806e-01   -1.615250015036335e-01   +1.721243996103229e-01   -3.063993372943453e-01   +3.040970625749521e-01   +9.291285265054100e-02   +7.242008982852659e-01   +3.634825310023141e-01   +1.060734867264240e-01   +4.073633567647179e-02   +4.203043398154535e-01   +5.733593933527270e-02   +6.557960298600420e-01   +5.167508757526253e-01   -1.148923781782571e-01   -5.653002015768063e-01; +9.903375398344577e-01   -1.384387479762348e-01   +2.165034242727479e-01   +4.263765505416401e-01   +3.284787388978199e-01   -3.637464933294103e-01   -2.152255557635833e-01   +2.831932802099363e-02   +2.504670944691196e-01   -2.526848616380984e-01   -3.166658890674386e-01   +2.741523441110863e-01   -2.755743632283021e-01   +6.841641381541020e-01   +9.843036709309942e-02   +3.701530367716269e-02; +9.391716960521290e-02   -2.393138373255247e-01   -1.443492964099306e-01   +2.707911593155167e-01   -4.967114535930495e-02   +6.939769620282434e-01   +6.183872277786709e-01   -3.173747302083511e-01   -9.371425647067111e-03   +2.869723353157347e-01   +5.451264467913951e-01   -1.758065729555151e-01   -5.339930698824630e-02   +8.676272731279339e-01   +4.124678437534379e-01   +1.514383484618082e-01; -2.964970386863494e-01   -4.141457898616616e-01   +1.988473845793889e-02   +2.631814847565292e-01   -1.493529305088079e-01   +3.007831481223161e-02   +3.609152654117528e-01   +3.678053406071577e-01   +5.422541010824535e-01   -2.534067198489739e-01   +5.095447641052231e-02   -4.435680590412715e-01   -5.282685423400871e-01   -2.024701698901142e-01   +1.304891058647987e-01   -4.585438920128269e-01; -8.886681520585799e-02   +6.144906800176421e-01   +7.023582349304774e-02   +5.868673464400970e-01   -1.448259480970202e-01   -1.612175416464309e-01   +7.671862959958409e-01   -1.391883238272421e-01   +2.182065138051708e-01   +3.013392547978215e-01   +3.622940664562908e-01   +1.873084131570140e-01   -8.653549280749413e-02   +5.188543943556598e-02   -2.903441790610366e-01   +7.958806636822924e-01; +3.089507870258094e-01   +3.912381812399946e-01   +2.993097189845464e-01   -1.515722716213777e-01   +1.584613362237182e-01   +1.050173429053337e-01   +3.434267570678238e-01   -6.560521309175060e-01   -3.005225088658440e-01   +1.790508924817016e-01   -2.010760900619966e-02   -3.014288777298047e-02   -7.374458218670987e-01   +5.428748736297719e-01   +5.000260817977054e-01   +6.174688695921724e-01; +5.234934961290540e-01   -7.969885040375244e-02   +9.347141371435114e-02   +6.165651193796764e-01   +5.586580046966676e-01   +3.370910654929903e-01   -6.158228512795758e-02   +3.046233766399687e-01   +5.315309197370696e-02   +3.113207180336489e-01   +8.451534063120329e-02   +3.484243896008259e-02   -6.268135986505915e-01   -4.211793956298854e-02   +5.527099197082755e-01   +2.286514161810703e-01];
L2I_L2E_iAMPA_netcon = [+1.099837019943223e-02   +8.031317913664842e-01   +4.478880928762434e-01   -3.269879488776888e-01   +1.484753717767364e-01   +1.729403850580052e-01   -1.959440671936910e-01   +4.961636448263536e-01; +4.945970499431439e-01   +4.149308378913165e-01   +4.996276366679020e-01   +1.000000000000000e+00   +2.944147448447302e-01   +2.479940273053685e-01   +1.227472780874387e-01   +4.327032905514508e-01; +1.025110603357243e-01   +2.647747202201877e-01   -3.831212616133837e-01   +4.753998091326172e-01   -2.193518924197873e-01   +2.915960098756010e-01   +4.231245923791540e-01   -8.394663446074070e-03; +4.935896133729500e-01   +5.241002003979045e-01   -5.942359459305061e-01   +3.026349254727312e-01   +6.766216845824469e-01   +2.058111275622161e-01   +3.690653536290773e-01   +4.130987358358216e-01; +3.894466942748687e-01   +1.913818440254739e-01   -3.762026066777797e-01   +1.992969961095612e-01   +5.927432196887439e-01   -1.829336471912114e-01   +1.456824469944474e-01   -1.784291925906681e-01; +3.465854799026659e-01   +2.609533619584135e-01   -4.107408391740371e-01   +5.295152946733888e-01   -4.782010824428685e-01   +5.960219346749961e-02   +2.719802455543168e-01   -4.322134574243690e-02; +5.331056233872836e-01   -3.228777338846757e-01   +3.009322444622314e-01   +5.546684645105091e-01   +1.296208253049280e-01   -4.137451001248253e-01   +6.446588718314857e-01   -7.675024958073210e-01; +2.687664064389956e-01   -3.509256326454171e-02   -5.763103554597976e-01   +2.138005813550560e-01   -2.465870459104922e-01   -2.085546992108505e-01   +5.168766148664012e-02   +8.202000608268103e-01];
L2E_L2I_iGABA_netcon = [+3.662105753072887e-01   +4.548752888032557e-01   -1.330208125133021e-01   -9.654288509681241e-02   +8.671977179809805e-02   +8.141213926180994e-03   -3.125176385475101e-01   +5.402487522471622e-01; +3.516921025027872e-01   +2.911841469798054e-01   +1.077062798738349e-01   +9.471590702630719e-01   +4.792055814083970e-01   -4.180135348130232e-01   -4.943147839545327e-01   +2.185433209676797e-01; +2.744342544498722e-01   +6.750913573580253e-01   -7.311625641579156e-01   -3.126832791589281e-01   +3.452918131747971e-03   +7.364814126844008e-01   +1.453108201620937e-01   +1.250104140457027e-01; +2.480296332420245e-01   +1.713057629196791e-01   -1.071694716550864e-02   +6.569223466552219e-01   +5.053370900964995e-01   -9.948001865147198e-02   -2.049262701467612e-01   +6.549448565198683e-03; -2.076133577937173e-01   -2.024692185988195e-02   -2.069822767018010e-01   +5.349612526035400e-01   +3.955938166609833e-01   +6.140428400082555e-02   -6.122423621952672e-02   +2.637830277984872e-01; +1.000000000000000e+00   +1.059224445979165e-01   -1.460293190550611e-02   +2.913351284249860e-01   +1.598767730449076e-01   +1.332263402172555e-01   +3.736258304971493e-01   -4.273156613589278e-01; -1.801790248391706e-01   +3.872751831310751e-02   -2.075469901418560e-01   -3.190258400896141e-02   -2.095557342387827e-01   -5.672509373143662e-02   +2.284828231278980e-01   +8.311538297886413e-01; -6.813312441097277e-02   +1.562623944433248e-01   +4.519138883074231e-01   -9.768621435295752e-02   +5.650978275290176e-01   +3.113784871743973e-01   +1.194884165154602e-01   +5.730537941391807e-01];
L3E_L2E_iAMPA_netcon = [-1.601206858207156e-01   -3.364924033144677e-01   -3.242147752473297e-01   +1.873449929956579e-01   +9.339612553315152e-01   +9.318669374002068e-02   -4.783967245591214e-02   +9.057285069041221e-01   +3.279477712418134e-01   +3.199050400038260e-01   +3.847512033664549e-01   -5.371740076020082e-01; -2.430787968785992e-01   -1.231779777779884e-03   -2.385212953779520e-01   -7.939077950630026e-01   -3.773185394228991e-01   -1.225894304061839e-01   -1.252251930159562e-01   -2.311003182980187e-01   -9.122004723256347e-03   +5.472207622491675e-01   -8.144160921377169e-02   +5.396190790841391e-01; -7.411172354841307e-01   -1.136324016473924e-01   +6.486311414711522e-01   +1.541695398962742e-01   -3.099620792732583e-02   -1.291638243604319e-01   -3.968446029522980e-02   -1.114312969066903e-01   +4.968913456914471e-01   -4.910722582103157e-01   +8.034690528824388e-01   +4.473589247429640e-01; +5.219008914308607e-01   +3.256272624028232e-01   -2.324222154066049e-01   +4.819109122914016e-01   +7.147411780962851e-01   +2.944097225377957e-01   +2.916588756548624e-01   +7.263420915169090e-01   -2.229763771175052e-01   -7.865392619059200e-02   -3.178092916755172e-01   +2.003722477826828e-01; +7.761365572576935e-02   +4.556270671995563e-01   +5.655586457741480e-01   +8.946388669978866e-02   +3.595202634820391e-01   +6.176108816372886e-01   +3.834929973254742e-02   -9.318550659151342e-02   -4.975802403045526e-01   +4.428633098285858e-01   -1.146903063792144e-01   +2.030367509935543e-01; +7.693071033548496e-02   +2.272348277788190e-01   +4.177263541867479e-01   +2.251572768387097e-01   +8.423541908238892e-01   +5.056168551010003e-01   -3.392874355683368e-01   +1.829210468945139e-02   -1.065890541212558e-01   +2.052861939724273e-01   -2.730129097209633e-02   -1.271879090207886e-01; +4.880806841831031e-01   +4.175395745940160e-01   -8.508462312044007e-02   +3.427779790910002e-02   +3.043908510883506e-01   +4.934029187987515e-01   +1.716191334420386e-02   +2.894113600455501e-01   -2.194011300826789e-01   -2.689260710326316e-02   +4.875916253673900e-02   +3.594853896835320e-01; -1.609584511569078e-01   +7.349233062742895e-01   +1.416102065479530e-01   -6.468471200577451e-01   +4.064851174011904e-01   -2.116340295661664e-01   -6.390941942655917e-02   -5.832893381323456e-02   +2.945434617798648e-01   +1.136889261833722e-02   +6.687229140751936e-01   +7.057752526238237e-02];
L3I_L2I_iGABA_netcon = [+7.204316905674970e-01   +6.534036419204201e-01   -8.904275716744091e-02   +1.924762132715461e-01   -4.788814725184810e-01   +1.231431316421507e-01   +1.000000000000000e+00   +5.012485969043046e-01   +1.367180783835813e-01   +4.024748735173274e-01   -1.853034541230689e-02   +1.430456720763313e-01; -2.319466458807233e-02   +1.307015353612948e-01   +7.992031926423841e-02   -1.535643497936193e-01   -6.152264824731342e-02   +1.482430193698978e-01   +2.572106493786496e-01   +1.293251904589122e-01   +2.063943914298905e-01   -6.784418428112435e-02   +9.215529572516809e-02   +3.793392280033901e-01; +4.902491030313084e-02   -2.088961187336936e-01   +7.004485523580028e-03   -6.138219064017221e-02   -4.174339279879139e-01   +3.988609748931517e-01   +1.936762383365364e-01   +2.310385409653932e-02   -1.094245708206068e-02   -1.228137051144188e-01   +3.389465432436852e-02   +4.558554044412860e-01; +5.854303735817238e-01   +7.171824832301638e-02   +4.006974878357266e-01   -3.709118082129798e-02   +4.326012904192108e-02   +2.463354490796526e-01   +6.677748481072564e-02   -9.444754358981193e-02   +3.220812438288705e-02   +3.315346982976374e-01   +2.817298737138977e-01   +9.150746896531854e-02; +1.748170818895932e-01   +4.224587087011801e-01   +1.203074644203469e-02   -2.153024585353110e-01   +6.617363628860476e-02   +4.052882395508620e-01   +1.668583088545632e-01   +1.803031327381621e-01   +2.092604272891149e-01   +1.790311075082464e-01   +1.804445810834196e-01   +3.029608435755323e-01; -6.302743761888685e-02   +9.407000148761430e-02   +2.481633708733976e-01   +2.798177545102782e-02   -5.772995903185107e-02   -6.235926438068687e-02   +1.844487590611150e-02   -1.191529213282556e-01   +8.460991238930153e-02   -1.629174123046909e-01   -7.579726067651702e-01   -7.642770072816385e-02; +6.127702971327350e-02   +2.329578549858907e-01   +3.243035860713114e-01   +3.217502587606558e-01   +3.314151528525224e-01   +4.242549385501310e-01   +4.445227264482253e-01   -4.978932723324936e-02   -3.828478738651210e-01   +9.647851881196230e-02   +4.504117692993849e-01   -2.398594040649288e-01; +7.006511253604118e-02   +1.631911304161239e-01   +1.523098072476918e-01   -9.743284107030219e-03   -3.240722010878500e-02   +5.371636528810377e-01   +7.477114946683321e-02   +4.435749385162325e-01   +4.277614496537904e-01   +2.423115245554153e-02   +1.222177463473169e-01   +3.494394462192416e-01];
L2E_L3E_iAMPA_netcon = [+6.513457257227747e-01   +3.830042033365580e-01   +4.209590460767662e-01   -4.087275911305908e-01   -3.144260215863024e-02   +2.052406206611317e-02   +5.825170888132238e-01   +3.086293956746529e-01; +3.197869940821368e-01   -1.956690423855300e-02   -1.387925074047965e-01   +1.074504574807631e-02   +1.000000000000000e+00   -4.768886741238778e-01   -6.714956483516701e-01   -4.629568155376124e-01; +1.352278532014550e-01   +1.655268232549714e-01   +2.178263420998335e-01   +1.731611675966197e-01   -1.166913349022699e-01   +2.078610436412058e-01   -8.048073461934344e-02   -2.724905730139192e-01; +5.358106790796127e-01   +4.432783664121941e-01   +7.380816599403373e-01   +8.565945316252863e-01   +3.493392052548594e-02   +5.851089305317535e-01   -2.363931763097246e-01   -4.179538415758910e-01; +1.289222433064970e-02   -1.436625583559695e-01   +2.574417684746282e-01   +4.211931005585373e-01   -4.515962878676540e-02   -9.023447614679750e-02   -1.949221767379220e-01   -5.327961582151486e-01; +1.782701576528494e-01   +3.463659349360410e-01   +2.044511607704952e-01   +5.964077660343416e-01   -2.072766046639954e-01   -7.391817648009358e-02   +7.744843536664912e-02   +2.926035392958167e-01; +1.029184546375548e-01   +6.097207022076360e-01   +7.083281967719254e-01   -3.143941948874995e-01   +6.464374110868798e-01   +2.005395408359798e-01   +4.992342841439791e-01   +8.822194526034283e-02; +2.805865780724642e-01   +4.546514763547312e-01   -1.067405860177273e-01   -2.910195473271766e-02   -2.950795150264944e-01   +1.408686863746977e-01   +3.738355763934112e-01   +4.945472912870066e-01; -1.512286516560403e-01   +5.689898676629499e-01   +4.158834422882398e-01   +6.052774406757082e-01   -5.237960843194277e-02   -1.181816912247994e-01   +2.096041748347013e-01   -4.774354218337530e-02; -1.557453303995802e-01   +2.223783100371233e-01   +4.917660417625108e-01   +2.049135384388612e-01   +1.848902286749706e-01   -5.202865766110246e-01   +5.589139230958059e-01   +1.926866132184814e-01; +5.979959564235164e-01   +5.069726821332561e-01   -6.031717644452369e-03   +3.333970999368327e-01   +2.741556476895432e-01   +6.886251979569589e-01   -3.419688883614968e-01   +2.266370497719813e-01; -1.564714230709619e-01   +2.724925028225775e-01   +5.977072195870137e-01   -1.378056198786765e-01   -1.037064075029511e-01   -1.970760158251187e-01   +7.011941355489519e-02   +1.849403144114772e-01];
L2I_L3I_iGABA_netcon = [+5.709000844121220e-02   -2.821562851949106e-02   +3.199605109130083e-01   +2.103713195697747e-01   +3.802054690577111e-01   +6.873798909435765e-01   +6.312563190584697e-01   +1.645088954784455e-01; -3.411266871047710e-01   +4.270701112356403e-01   +5.070764121898087e-01   -1.889940588995360e-01   -1.773614767728652e-01   -1.134666967873415e-01   +4.831210479712870e-01   +5.294908776601200e-01; +3.263643602189678e-01   +8.448825567771572e-01   +3.937245129557597e-01   +1.262885067901260e-01   +3.941434568966157e-01   +4.221320715483762e-01   -1.453873727531310e-01   -4.371885690443131e-02; +1.619956640863985e-02   -1.444506221440605e-01   +2.758175710710192e-01   +2.075749987404896e-02   -1.423614011482575e-01   +1.048669658218308e-01   +4.256974255764604e-01   +2.492157320843297e-01; -2.976260847191656e-01   -2.897162715285431e-01   +8.041044513598654e-02   +4.124146595836882e-01   -6.474463022981955e-02   +2.864259374330624e-01   +2.487288172011450e-01   -2.604557121297589e-01; -8.752504507678745e-02   +6.878037903768780e-01   +3.021725817161517e-01   +2.638199997993552e-01   +3.935217127788107e-01   +3.523182911866720e-01   -4.930920018856672e-01   -5.069511744857093e-03; -9.913581150098912e-02   +1.000000000000000e+00   +4.859913791414793e-01   +1.641984603955655e-01   -2.301672438914726e-01   -2.480643182296624e-01   +6.047922214479861e-01   +3.163023348859496e-01; -2.398021326060836e-01   +3.854980909625489e-01   +4.914084658732951e-01   +2.500097557116283e-01   +8.421224393145084e-02   +4.315150574100006e-01   -2.239433866379007e-02   +6.412497529676291e-01; -6.076730233500204e-01   +7.275178767413206e-01   +1.834906833843921e-01   +4.453409541687803e-02   +7.303976676901919e-03   -1.708471331967313e-01   +8.915012300325420e-02   +2.454528311141750e-01; +3.657387850271545e-02   -4.023788446844535e-01   +6.095353047645408e-01   +5.695760268601813e-02   +4.477026445901539e-01   +2.038745416610017e-01   +1.199037054660427e-01   +8.791563711368028e-02; +4.111979747827910e-01   -3.925659092851727e-01   -6.911925307219156e-01   +5.821142408166999e-01   +1.426817942310337e-01   -5.324791134944928e-02   +3.210643302103903e-01   +1.510610641871374e-01; -2.266187375186694e-01   +6.626267070274352e-01   +9.030096146310332e-02   +3.343101359559838e-01   +3.102446928481429e-01   +4.857004505749769e-01   -4.302565004227901e-02   -1.988010685703231e-01];
L3I_L3E_iAMPA_netcon = [+2.748861029789213e-01   -8.956604288741308e-01   +1.493710863603382e-01   -3.999233045717554e-02   +4.216980828809989e-02   +3.433097019597604e-01   +2.131854195043802e-01   +2.481680810255645e-01   +8.611414086853408e-01   -4.067910234155211e-02   +3.146557233126356e-01   +4.204111784174133e-01; +1.626879706076363e-02   +2.830877440403834e-01   +5.838652780178982e-02   +3.894907277004680e-01   +4.771466587161108e-01   +2.002632864624859e-01   +5.505168760051584e-01   +9.013613704769092e-01   +5.340951618995180e-01   +8.681106581780484e-02   -2.810114492132842e-02   -4.372287350740580e-01; +1.966251456540507e-01   +2.134233153999712e-01   +4.055541605134874e-01   -1.248255293556696e-01   +8.326355178578567e-01   +3.158179410099315e-01   +4.589343702274079e-01   -2.783631239372094e-01   +6.203358038315632e-01   -2.901658104603397e-02   -2.803139406985820e-01   -1.722930848873206e-02; +1.551571169399455e-01   +6.263366451757596e-02   +1.272645250417359e-02   -1.980522381286266e-01   +4.207214882787998e-01   -4.350598287235513e-02   +1.562771342161335e-01   +6.737515595983539e-01   -2.393661720534547e-01   +3.601203013002968e-01   +1.954488187476271e-02   +5.771957593537915e-01; -3.802665792244657e-01   +2.537023477373684e-01   +7.386581277660269e-01   +7.231221123538785e-01   +1.885839254499589e-01   +1.977531414503016e-01   +1.946231233959442e-01   +1.758464059422573e-01   +3.865793840610163e-01   -1.157182175671408e-01   -9.495565620198022e-02   +2.056364546769866e-01; +1.877089003492453e-01   -2.284828723372780e-01   -4.324993922698131e-01   +7.138496334127617e-02   -9.792872521090937e-02   -3.136572330230741e-01   +5.345326990510517e-01   +3.308343074289099e-02   +1.877037077534099e-01   +5.707169820313163e-01   -2.074356644245962e-01   +8.529854108943138e-01; +2.477689047350546e-01   +3.157669816057401e-01   -6.643106803308048e-02   -4.190780771353586e-02   +4.236576503271606e-01   +2.451548026089795e-03   +3.055864248985869e-01   -2.420210047275662e-03   +3.324190771409914e-01   -2.204204145446726e-01   +1.450937920291226e-01   -3.545444251818672e-01; +3.380876731771494e-01   +3.145428426999204e-01   -1.607382207433798e-01   -1.709059334112162e-01   +4.224114730952057e-01   +4.603948931876714e-01   -1.925826403370250e-01   +1.060887806451627e-01   -2.130431465382248e-01   -3.568227047736602e-01   -7.707137142601980e-01   +3.345821218517899e-01; -2.872954288281708e-01   +5.383015781339067e-01   +3.431330054964427e-01   +8.537922839733222e-01   -1.072904306465297e-01   +7.077167960902446e-01   +4.916383751589756e-01   +2.088048285191736e-01   +2.975445799356244e-01   +5.612772918957635e-01   +1.577885506906801e-01   +4.293476936877191e-01; +8.735332915662997e-01   -7.127410864434904e-01   +4.167228831898839e-01   -4.213378832523664e-01   +1.101382310187563e-01   -3.921077392533230e-01   +1.612209091946525e-02   +3.997565054416496e-01   -3.424211447396875e-01   -2.254980176781627e-01   +6.539273961008641e-01   -3.200014107604486e-01; -3.208974674399265e-01   +8.416651405631085e-01   +4.518539998780027e-01   +2.501578053972497e-01   +1.032822006382343e-01   +4.474321964586238e-02   +5.732374244978439e-01   +3.420182492377513e-01   +3.304701091682470e-01   +1.858484889585309e-01   -1.293439258572434e-01   +6.208852269630515e-01; -1.225559511258426e-01   +3.026114848438977e-01   +2.168078268326643e-01   +6.648141396557520e-01   -2.714136850084035e-01   -8.601905032703415e-02   -2.665121403368862e-01   +5.754737074469575e-01   -2.049396580213838e-01   -1.107846792718974e-01   +1.235758813727491e-01   -1.479474092075785e-01];
L3E_L3I_iGABA_netcon = [-7.838147212444281e-02   -5.238359278096181e-02   +2.798145576595737e-01   +2.600678581409708e-01   +1.879766074308351e-01   +1.260003138068441e-01   -2.947576872747278e-01   +1.041999483202040e-01   -1.022659843204346e-01   +3.856715514205721e-01   +4.351031877432253e-01   +2.412491693304086e-01; +3.291561438866694e-01   -3.285402168739597e-01   +2.907019540821960e-01   +2.405140371508837e-01   +3.131630253573389e-01   -3.588777182379416e-01   -9.302980957914002e-03   +7.432583717516869e-02   -1.841297086941830e-01   +8.316196711913978e-02   -4.828803444047450e-01   -5.338706787893090e-02; +2.615456330665667e-01   -2.457603283388067e-01   -3.873946584856560e-01   -9.011285355159605e-02   -6.955786133769949e-02   +3.810436119697281e-01   +3.514145759781366e-01   -1.327022139683086e-01   -9.818256918413570e-02   -1.784981662887375e-01   -2.201667141188380e-01   +1.793853492596712e-01; +8.958890373583880e-02   +6.451479465632615e-03   -3.407939487999262e-01   +5.122911086941541e-01   +8.672868271204036e-01   -2.419649288756966e-01   +4.485672935295518e-02   +9.224148880785184e-02   +9.157428049457031e-01   +2.793645578686724e-01   +4.642951547910489e-01   -1.393094483697069e-01; +1.792116067493914e-01   +3.557560106744880e-01   -7.233879684376839e-02   +2.263490254071562e-01   -2.477334907169743e-01   -1.822291993502604e-01   +1.964969380809226e-01   +3.940326766694574e-01   -1.984332631324358e-01   +7.497685144149544e-01   +2.894964591233631e-01   -5.698827086898431e-02; +2.771173143115171e-01   +9.974049974642450e-02   -1.925550408688556e-02   +4.068756767225078e-02   +2.322456348039999e-01   +2.830713956306154e-01   +3.629514947559866e-01   +2.328270900992116e-02   +2.668496230160476e-01   -2.463924991757144e-02   -2.749678419107069e-01   +2.190751096225786e-01; -2.809689479157724e-01   +1.254024379272825e-01   +2.158451644489379e-01   +6.132155700366234e-01   +1.218301754448897e-01   +5.599958874262260e-01   +4.118231600368319e-01   +8.012700995576187e-01   -3.004767335259338e-03   +2.933743448196237e-01   +3.460977709264655e-01   +3.007249610958054e-01; -1.188904968045209e-01   +2.298990420113830e-01   +4.686674357500668e-01   -2.097870131182764e-01   +7.299684959578724e-02   -4.214762595887342e-01   -6.622001522214719e-01   +5.528844473982929e-01   -3.510149488850373e-01   -4.967440515007860e-01   +5.310511535055772e-01   +1.365879877126021e-01; +3.567401987627998e-01   -4.974728110229062e-03   +3.973451993521482e-01   -3.974004547490754e-01   +2.484578058438038e-01   -9.459578560148854e-03   -5.766756088151740e-01   -1.690445062219608e-01   +2.050142593185637e-01   +3.918194112900160e-01   -1.964138559785465e-01   +5.055486051751795e-01; +3.052062578796108e-01   -9.819424096617899e-02   +9.204603852792161e-02   +5.108872657059885e-02   -4.001369994858769e-01   +2.388093648448814e-01   -3.470231514299688e-01   +1.482887814388104e-01   -1.086789201952927e-01   +1.489347273088435e-02   +3.301321217346537e-01   +1.436145750215657e-01; -1.214277541488821e-01   +8.527533747046648e-02   +1.970738511908562e-01   -6.509863742014692e-02   -9.081052385818911e-02   -1.373800665280428e-01   +1.223858227876196e-01   +4.579618465183361e-02   +1.886883778152832e-01   -5.632988509214358e-01   +2.009166935673789e-02   +4.683276466208702e-01; +7.961524182499646e-02   -4.156895626507801e-02   -4.340490262208416e-01   -1.857057814208699e-01   +1.000000000000000e+00   -3.917335741253701e-02   +4.703813847193446e-01   +4.977632733111020e-01   -4.276447584925495e-02   -3.729137490269868e-01   +1.943081476907268e-01   -6.087529898389221e-01];
L2E_Input1_iAMPA_netcon = [+7.445569098387709e-01   +8.308366512444347e-01   +7.803105596930868e-01   +2.374367507089830e-01   +2.724246628802691e-01   +1.187730695322542e-01   +7.107546349667782e-01   +6.388417199550646e-01];
L2I_Input2_iAMPA_netcon = [+4.786721278874534e-01   +8.637199958345464e-01   +1.871299214123029e-01   +4.042076618142882e-01   -3.728701673686080e-03   +6.679736270185052e-01   -2.372242049938399e-01   -8.340091986475207e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
