function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.523321273624254e-01   +1.160975465042983e-01   +8.085481389169498e-01   -2.636667268287672e-01   +2.952882937542436e-01   +6.582670142277187e-01   -2.046714830650302e-01   +9.813499482889217e-02   +8.796898442240941e-01   +3.660588731810433e-01   +1.148782785851552e-01   -5.545329845279969e-01   -1.031992347731326e-01   -6.348655811587061e-01   +3.655631671559988e-01   -3.325858987968708e-01; +4.346957954718201e-01   -7.814200406400559e-02   +2.074665917701893e-01   -4.040471212594772e-01   -2.849470676545575e-01   -6.343058777540451e-01   +6.551429235669497e-01   -2.818331217465688e-01   -3.782465284937384e-02   +2.264115892044863e-01   +1.057318059087260e-01   -1.133622332645274e-01   +1.385530241612063e-01   -1.629020089325208e-01   +3.146223884049005e-01   +4.863432253318596e-01; +6.201317454696007e-01   -2.210718501875592e-01   -5.118474684733669e-01   +2.753862092366413e-01   +7.817492921828734e-01   +3.269589753865190e-01   +2.930161793194933e-01   -4.145166888916273e-01   +2.166659590928477e-02   +2.318947944572504e-01   -5.901482125959499e-01   -3.068493073395133e-01   +2.876570483484420e-01   +4.564144695832836e-01   -5.770590324226411e-01   +3.192931786226565e-01; -1.613326818626831e-01   -3.846078615334993e-01   -6.440632504738583e-02   -7.687945756296150e-02   -4.750645628456738e-02   +3.081205733091891e-01   +4.304492491251695e-01   -7.961267615862333e-02   +3.400508635915075e-02   +1.779979888913783e-01   +3.300888188720276e-01   +2.698134615964872e-01   +1.577428251160884e-02   -1.573135729089903e-02   +3.186964229472152e-01   +9.796114515795300e-01; -5.788344862806152e-01   -2.071621501681924e-01   -3.488127966743277e-01   +1.388207189834759e-02   +2.375349184151931e-02   -2.199103111546044e-01   +3.680519544366568e-01   +5.001493248016714e-01   +1.733727336934824e-01   +6.116271811958123e-01   +8.982827671845001e-02   +1.679828369723789e-01   +2.562460019314363e-01   -3.184243996970377e-01   -1.628026158650862e-01   -1.567210485914289e-01; -4.241873227761517e-02   -4.568014351502567e-01   +9.184017879935530e-02   +4.721632130980539e-01   -6.751687064090559e-01   +1.455240552901016e-01   +7.480883025497320e-03   +3.038833393866761e-01   -3.765745206058479e-01   +1.639701769456766e-01   +5.268561639030564e-02   +2.228379235758722e-01   -1.384596566958204e-01   -6.308366577097305e-01   -1.862829186290471e-01   +4.147142054222273e-02; +5.988534947529760e-01   -7.083931109858929e-02   +3.934054897029072e-01   -2.403843475364498e-01   +1.364539824227736e-01   -3.248579061142249e-01   +1.187748771407446e-01   +3.577185374796242e-01   +8.694580549630088e-02   -3.596096888599978e-01   +2.017857596815528e-01   +6.799623967108115e-02   -2.752271268650141e-01   -5.069306795592733e-01   -4.110217592962173e-01   -5.323765489529091e-01; -2.679788919694962e-01   -1.900930331485076e-01   +4.918018212434139e-01   +1.426433796116084e-01   +2.168735846612478e-01   +2.313633896199920e-01   -2.594718092635324e-01   +3.493390352477290e-01   +2.572114358309304e-01   +8.072804555890307e-01   -2.307811544580146e-01   +1.225533181615362e-01   -1.691870499269794e-01   +1.416807373380371e-01   -5.177905427328365e-01   -1.662918481853676e-01; +4.682081051555246e-01   +3.601961740163594e-01   -5.102319274311947e-01   -7.277752397969345e-02   -3.030572226742382e-01   +3.899994545005653e-01   +3.050867133602088e-01   +1.729021878915303e-01   +8.453795299270983e-03   +5.222597760472012e-01   -8.130582436469862e-01   +3.655367475746724e-02   +1.155426429108295e-01   -4.811973191569610e-01   +2.548904687971136e-01   +6.969186837351034e-01; -4.067713381278053e-01   -1.930422995712041e-01   +6.614063664205387e-01   +3.023570612527381e-01   +1.902244683838628e-02   +8.696001932067192e-01   -4.597248136291811e-01   +2.444474198150372e-01   -7.906332529976673e-02   -6.141144217081549e-01   +2.889657457781772e-01   -2.235840355744039e-01   +5.427761748300401e-01   -1.787606015262628e-01   -1.180884703823301e-02   +9.571690035573693e-02; +6.761839242463994e-01   +2.034619832483747e-01   +6.343726404168550e-01   -1.360161035416806e-01   +2.948738311116538e-01   -7.329316378450219e-01   +8.080216665137530e-03   -2.052146860628527e-01   -2.045821879254806e-01   +3.878816820177262e-01   +4.332751201435392e-03   -4.607436556621881e-01   +6.668247336075637e-01   +7.072495074077731e-01   -5.120497708126177e-01   -2.883043533666445e-01; +7.777219741359004e-03   +7.258521670456372e-01   +5.957156249832374e-01   +2.227716390671649e-01   +6.546465389323108e-01   +1.759481130749987e-01   -4.284336686850095e-01   +3.914993385678783e-01   +4.773854917934113e-01   +2.198387168234620e-01   -1.247520753694149e-01   +5.210624120655882e-01   +2.832806614883476e-01   -7.841457506072291e-02   -2.811515228148476e-01   -1.949531191626441e-02; +2.445094641507088e-01   +6.586343913110833e-01   +1.750839098424082e-01   -3.588013197694801e-01   -4.207239996323582e-01   +8.800270590172632e-03   +2.296889951058709e-02   +8.228449606542759e-02   +4.002343565553885e-01   +2.967282884312342e-01   -3.153693777825070e-01   -8.496099478743883e-02   +1.528619386001435e-01   +3.284795366927382e-01   +8.084067619122063e-01   +1.780277745151427e-01; +6.726625857532789e-02   +2.868361926970967e-01   +5.071848412268803e-02   +6.310997245378059e-01   -4.246918607634058e-01   +1.359420917009695e-01   +4.935033818037995e-02   +4.528427899241065e-01   +8.579638922878213e-02   +4.249843522977383e-01   +5.316353864370336e-01   +5.193330383733619e-02   +4.885323363921369e-01   +1.102139532913183e-02   -7.828782693300301e-02   -3.572654503722484e-01; +7.411592094592785e-02   +7.275835208714709e-02   +9.935589462686156e-01   -1.213193826938815e-01   +1.432219010346341e-01   +2.688794299085210e-01   -5.645773127840826e-01   +5.936175615177322e-02   +2.135479973429631e-01   -3.411349516930702e-01   -8.650019016134436e-01   -3.770971622637888e-01   -9.632343040950909e-02   +4.358098681482903e-03   -6.359233729778412e-02   -3.646277488849067e-01; +3.419275732276084e-02   -4.118599386056463e-01   -7.801921246048513e-01   -5.879525412547966e-01   +9.556331642458425e-02   -4.658333996697276e-01   +1.716048011014459e-01   -6.002532026663709e-01   +7.362187526552755e-01   +4.864529258596823e-01   -4.443849380064802e-02   -5.973804398404642e-02   -2.035331443731477e-01   +7.045474372954796e-02   -1.907082164761193e-01   -1.312721383419480e-02];
L1E_L1I_iGABA_netcon = [-9.910363995799853e-02   +2.544344739626804e-01   -3.740122208315024e-01   +8.381139272813698e-02   -1.373589966629996e-02   -2.360786622131804e-01   -3.766280048483318e-01   +3.799272091905981e-02   +6.538191127038889e-02   +1.086432954586750e-01   -2.866529682716474e-01   +2.606307384665619e-01   +1.544846429271060e-01   +2.873875207246334e-01   +7.726997941679450e-02   +8.627849523665309e-01; -1.782158730062411e-01   +6.075726969359937e-01   -3.595178038807156e-02   -1.527774808649290e-01   +3.994839455274857e-02   -1.444277888180589e-01   -4.918642534751773e-01   -1.194538461057775e-01   +4.858487725718150e-02   +4.825211684070083e-01   +5.855055310867825e-01   +2.641715587816983e-01   +3.027517396795673e-01   +5.651156353014550e-01   +8.091390577147055e-01   +3.865761762347545e-01; +4.104571418160212e-01   -1.601675358093427e-01   -4.386973592608018e-01   -4.942523765408243e-01   -3.060017326698726e-01   +1.941424585096960e-01   -1.890582597644924e-02   -1.499494964463122e-02   -1.470445315202608e-01   +3.666550183687805e-01   +3.661502226609141e-01   -4.656156448065987e-01   +2.800961634240356e-01   +7.640746745329935e-01   -1.915734070687763e-01   -1.282106975515867e-01; +1.051875210020880e-01   -2.712013516306726e-01   +4.281233857831730e-01   +3.030278975848528e-01   +2.172595084176265e-01   -1.865045976062885e-01   +4.599469220497410e-02   +8.829961644844964e-02   +2.698517774020324e-01   -5.332955562735500e-02   +2.824348214830765e-01   -1.444361637277901e-01   +5.814441086986351e-01   +5.093979066102589e-02   -1.311671220507110e-01   +1.663061802663277e-01; -3.917385191479820e-01   -4.889750883790729e-01   -1.747889415025929e-01   +7.588581955269028e-01   +5.292233935433536e-01   +2.834008674314939e-01   +3.704778981595744e-01   +8.231005080115977e-02   -1.971295231218084e-01   +2.224240917646748e-01   +1.626943903630451e-01   -1.960117975133648e-01   -4.201305100144187e-02   -2.847305660367931e-01   +3.559668534420340e-01   -4.428629027270281e-01; +1.720318077277586e-03   -3.452695085120931e-01   -2.048834339720850e-01   -3.042520425892151e-01   +3.594435923499081e-01   -2.974471212943297e-01   -6.233290369605993e-02   +2.712546807783076e-01   +7.532881742002449e-01   -8.522612471201163e-02   +9.355429269414445e-02   +3.529035471406162e-01   +6.117202751791321e-01   +9.445965763150757e-01   +6.475012374269761e-01   +1.121995381093629e-01; -3.974008709633809e-01   +8.756889445783880e-02   +1.791064114590895e-01   +7.347879502013420e-01   +8.069022484474959e-02   +4.242259608201335e-02   -5.352584111089103e-01   +2.176911457551888e-01   +2.348077465933774e-01   +2.409432242682735e-02   +1.966963293547261e-01   +8.922164387732386e-01   -3.375842646930313e-01   +4.699274181957498e-01   +1.245160455689247e-01   -7.486536710901738e-02; +9.833902121748242e-02   +1.783896222227268e-01   +7.719502067921236e-02   +5.469973280866322e-02   +2.960428116079761e-02   +1.454577586918349e-01   +3.221410120072653e-01   +1.008299358894148e-01   -6.003112269130984e-02   -5.627416365190099e-01   -3.908676603823117e-01   +5.064022240581252e-01   +1.869198461718872e-01   -3.677278954733494e-01   +1.268026627683185e-01   +3.103522468525697e-01; +4.795332088319758e-01   -4.884299719709292e-01   +5.948555006446293e-01   +3.187437524377800e-01   +3.070149124106960e-01   +3.256402011027985e-01   +2.532051836775751e-01   -3.310167482704051e-01   -1.854649320354326e-01   +3.253573652069593e-01   +9.773238123097433e-02   -6.361846137951990e-01   -2.002976549465611e-01   +3.273097902984387e-01   +3.647195370958617e-01   -4.759576026213514e-01; -2.227594653560787e-01   +4.576128681834924e-01   +1.558309174841612e-01   +5.367107235824236e-01   +1.255370192188715e-01   -8.799780240808901e-01   +3.914579076515767e-01   +5.686952847635285e-02   +3.332824649084399e-01   +4.161913618704597e-01   +2.774589537405032e-01   -1.843586682759529e-01   -3.590039654952787e-02   +1.722605733725364e-01   -5.832907020773463e-01   +3.816788420537123e-01; -2.669311840754946e-01   -3.684924976794768e-01   -6.883532700808646e-01   +5.670747470862176e-01   -7.782353786267693e-02   +8.587850191383847e-01   +5.338226926690095e-01   +7.213144503900609e-01   +7.054551463711117e-01   +5.447260691833344e-01   -5.686884215993161e-02   +2.728572741600940e-01   +3.398707965661339e-01   +7.492021901730981e-01   +2.582803861891484e-01   +5.185010319080113e-02; +6.802033678945876e-01   -2.448323115235299e-01   +2.562109514934848e-01   +5.145399896314791e-01   +7.892895312645142e-01   -5.668869459475431e-02   +1.394922767000471e-01   -8.917239159445964e-02   +7.453715623745877e-01   +2.950369587170538e-01   -2.195927896106484e-01   +2.524151126959342e-01   +2.330325166980846e-02   +4.531772149455721e-02   -3.336651193572128e-01   +3.788031355397647e-01; -9.062490327551184e-02   +2.268108652987096e-01   -1.548779009895769e-01   +6.696913478365831e-01   -3.247622178205258e-01   +1.487953724494903e-01   +1.840419446428322e-01   +5.021854094516854e-01   +5.561922384981466e-01   +2.974686255141071e-01   -2.923002654983423e-03   +5.714394573408221e-01   -1.844347245318186e-01   -1.352537977781844e-01   -3.192545018804318e-01   -3.456149799303900e-02; +5.451677372041426e-01   -5.678999703502110e-01   +8.556710717718313e-02   -2.944582139088205e-01   -8.591737237008373e-02   -8.002275758118029e-01   -2.511104467383127e-01   +4.966609774534393e-01   +1.518022390268408e-01   +6.787334661797556e-01   +2.298942436050181e-01   -3.733914346562977e-01   -1.660797546766287e-01   -2.523518689238902e-01   +1.037939598308406e-01   -1.060843412479423e-01; +3.563898577892478e-01   -5.101915539649773e-01   +9.964776622913488e-02   -4.542564647121049e-01   +4.394068193432951e-01   +2.879846579982408e-01   +5.384135460148419e-01   -4.503735790192184e-01   +6.688925125890879e-01   +7.905456574023750e-03   -2.814781754294739e-01   -3.451393132315238e-01   -8.639898444310798e-02   -2.199586887058340e-01   -5.065265942667838e-01   +2.363485987140271e-01; +1.621726094355925e-01   +6.515271633705061e-01   -5.302677172840823e-02   -2.048174011137803e-01   +2.616829787208534e-01   -6.867532071591209e-01   +3.187020717505868e-01   +2.827456219096418e-01   -2.676097819655461e-01   +2.389837939773067e-01   -4.343495114108434e-01   +2.009496186563099e-01   -7.237132329900907e-01   +1.470098340262495e-02   +7.356129692954929e-01   -4.298826124473953e-02];
L2I_L1I_iGABA_netcon = [-4.596800668651945e-02   -2.278599778216830e-03   +2.621885649780236e-01   -5.531171595115305e-01   -5.582699599180072e-01   -2.799463032737946e-01   +3.658268847217134e-01   -4.113156191052638e-01; +1.115382523068373e-01   +1.726021703219592e-01   +7.236069993101601e-02   +6.392171471977679e-01   +5.210934475034964e-01   -2.787848031329139e-01   -1.168814802649901e-01   +5.327944694777956e-01; -8.672593539921337e-02   +7.096163666415807e-03   +6.491901408784618e-01   -2.196037430571051e-01   +5.031828782087564e-01   -5.215136746398737e-01   -2.493111030659125e-01   +2.950752456884541e-01; +4.065941845393273e-01   +3.082401648317896e-01   -7.572935541909073e-01   +2.861659882234115e-01   +5.077943944879167e-01   -3.850494528044126e-01   +7.352785226625418e-01   +6.192015873946533e-02; -3.611196814250994e-01   +5.890141031373398e-01   +1.696419134767889e-01   -7.542182476217074e-01   +7.195308327879088e-02   +1.280422695981520e-02   -3.016810434981838e-01   +7.244124816648927e-01; -2.427938731990384e-01   +3.468864665870552e-01   +2.986732962754720e-01   -3.598228605260939e-01   -6.567414958323985e-01   +5.859424276411391e-01   +9.610050765670379e-01   +3.121267222571214e-01; -3.174630147167006e-01   +1.000000000000000e+00   +3.367650610016477e-01   +4.157838150605345e-01   +5.970428806383755e-01   +1.440794907749672e-01   -4.148514564786410e-02   -3.152251023367967e-01; +1.765598206832925e-01   +5.513740481925166e-01   +2.494165842452471e-01   +3.463164012756201e-01   +2.673977265765488e-01   +6.106776193913978e-01   -3.677696279783843e-01   +1.693054930980677e-01; +1.598567590144664e-01   -4.789135941849713e-01   -2.214991467533048e-02   +6.606160789333140e-01   +5.586270053287381e-01   +2.772302494022246e-01   +2.257537699124559e-01   +2.166295666820222e-02; -6.758322796503500e-01   +1.408081527987113e-02   +2.625195788464935e-01   -2.638221729491751e-01   -3.271002955878125e-02   +2.088434156301847e-01   -8.246833205838503e-01   +1.576297101886665e-01; -1.929104063338284e-01   +5.796082270461996e-01   +3.219537350610892e-01   -2.523032760379348e-01   -6.007513755286525e-01   -5.778313156099463e-01   -2.335447075807643e-01   -6.471793308426338e-02; +6.976542339906594e-02   -5.489400332688791e-01   +9.824853370851691e-02   +1.282555526399431e-01   +1.525519854579033e-01   -6.345596222383622e-01   -4.546576806178050e-01   -2.087195402871507e-01; -1.228363087555537e-01   +3.571734438632815e-01   +1.275879134091749e-01   +4.829966528709263e-01   +4.374399795093975e-01   -9.024114157137762e-02   +1.073985179711702e-01   +1.917090168027702e-02; +1.578104110322091e-01   +2.341278305236774e-01   -5.324867116628590e-02   -4.755640028798673e-01   +4.929409205132149e-01   +5.282272427918538e-01   -5.057575713234844e-01   -9.138512558185242e-02; +2.598492307728196e-01   +9.694164567766903e-01   +4.543736293216559e-01   +3.266669322200370e-01   -3.064077069697424e-01   -7.182558510633512e-01   +4.867164925126935e-01   +3.794815635847436e-01; +2.534414807328730e-02   +8.533044541781917e-01   +4.825813562075221e-01   -3.426650634802998e-01   -4.941998920102589e-01   -4.526014391173097e-01   -4.345976468473634e-01   +7.886511915963610e-01];
L1I_L2I_iGABA_netcon = [+3.059124123883082e-01   +1.736255036683367e-01   -1.718387284630453e-01   +2.387935915857975e-01   -7.364044905227325e-01   +5.122621459769651e-01   -3.431223233488737e-01   +3.878639695343229e-01   +1.442427071471504e-01   -9.288635042678280e-02   +4.358318825508740e-01   -2.013905192754081e-01   -3.131875348956612e-01   -1.657434251100644e-02   +4.451187837035923e-01   -6.864192352192360e-02; -3.285243242771539e-01   +3.179607801177568e-01   +2.603256634014288e-01   -1.072869354803085e-01   +3.194444427988141e-01   +8.562574505164171e-02   -4.352455639078677e-01   -6.174892294271520e-02   -5.819846537814685e-01   +3.056357009414758e-01   -8.565452077401842e-01   -4.763031702624343e-04   +1.211372854094745e-02   -1.259812776980812e-01   +3.269326651773623e-01   -5.120833871798030e-01; +3.738306644261141e-01   +6.987409415932843e-01   -2.695037115060255e-01   +4.045072258244017e-01   +8.156548465832220e-03   +3.342824589618661e-01   +7.699409197256991e-02   +2.203507606303664e-01   -4.406047054764410e-01   +2.185987072983262e-01   +3.437705244459151e-01   -4.925047744351192e-01   +1.704955404473071e-01   -5.258078748590404e-02   -1.133516524186623e-01   +1.918447330346990e-01; +3.345554076127706e-01   -2.983334990598421e-01   -5.636936200284205e-01   +3.876332408435750e-01   +2.739169040476925e-01   +2.426668504162330e-01   +2.337874602040718e-01   +4.766112282008551e-02   +2.762969902632921e-01   -7.793761174118324e-02   -2.708789987588417e-01   -4.239627885798565e-01   +3.119543887544000e-01   -2.937295528881880e-01   +4.613484526780866e-01   -2.634169020441220e-01; -5.513393370632358e-01   +1.059374917198143e-01   +1.623711833558160e-01   -3.973028232234804e-01   +4.874657527068115e-01   -4.058115898728433e-01   -5.158396394309839e-02   +2.533079112355007e-02   -3.506130187071020e-01   -4.920726492037469e-01   +1.000000000000000e+00   +2.228706333015802e-01   +7.379360764630319e-02   +1.360470350467127e-01   +5.011370342153869e-01   -4.701666716308782e-01; +2.665933761174369e-01   -4.982611210648217e-01   -2.497482195593752e-01   -4.661475155461273e-01   +5.248177953433898e-01   -6.920270649899180e-02   -5.040432839594395e-01   +3.854475285297377e-01   -3.349453909069446e-01   +2.127903995393340e-02   -2.682583163192672e-01   +2.804742147368099e-01   +3.608209185578399e-01   -3.905753292686809e-01   -3.700403584649441e-01   +4.822721922005985e-01; -1.441260035984943e-01   +8.064321392915931e-02   +8.399631110043110e-02   +7.483594734486370e-01   +3.506622975218822e-01   -9.983411703680213e-02   -3.041411955983764e-01   -1.516133254313876e-01   +6.418419820578393e-01   +8.785331765912364e-02   -3.983117433094804e-01   +2.675675177605577e-01   -1.140059290135960e-01   +1.145313538757501e-02   -1.386191976112315e-01   +1.526640372589150e-01; +4.116533061091677e-01   +5.050201489052790e-02   -4.222552141065138e-01   +4.813785438891967e-01   -2.529040802401361e-01   +1.020264787750029e-01   +2.053400428286886e-01   -1.353455906222633e-01   +2.271120164113831e-01   +3.535141158939527e-01   -2.173127015919195e-01   +3.147444514832362e-01   +2.675234390566579e-01   +9.046613281890556e-02   +9.882671198421659e-02   -1.953687874860224e-01];
L2E_L1E_iAMPA_netcon = [-1.494850442310103e-02   +8.298796749981657e-01   +1.562626474634821e-01   -8.712759889864410e-01   +3.937633736501755e-01   -2.533211486178976e-01   +4.105029795805103e-01   +3.347952560857066e-01; +3.347119852226041e-01   -4.425310463942681e-01   +7.740066197066436e-02   -4.075873038366221e-02   -9.469027841227419e-02   -9.640873451518862e-02   +1.571450955211652e-01   +3.504847728431388e-01; +3.686795560429550e-01   -3.455267180230103e-01   -5.182060895070337e-01   -4.273737783052485e-01   -1.585801259445572e-01   +2.398486661233651e-01   +3.168887957818939e-02   +1.710387929443931e-01; -7.310276604730986e-01   -4.415756790841382e-01   +8.062413290954799e-02   +3.546313150253063e-01   +2.341643725626500e-01   -3.388944290272664e-01   +3.565026153939233e-01   +3.131307945944039e-01; -1.802899577164566e-01   +8.647947642365070e-01   +3.448272925541853e-01   +8.851375013961456e-01   +5.605584121151680e-02   +5.482939267235153e-01   +8.383599928313443e-01   -5.773029762601731e-01; +1.736057498168374e-01   +6.065876048632952e-01   -2.124714182131987e-01   -4.450569716866724e-02   +1.124391337906784e-01   +5.220784380562210e-01   -2.467594782595557e-01   +2.734174678263795e-01; -7.949158685300223e-02   -3.274387620128631e-01   -5.625789174664152e-01   -5.802925108576490e-02   +8.756942122220557e-02   +1.870487982520408e-01   +5.335065626454233e-02   +8.067175407144467e-01; +6.039178768828555e-01   +3.828241050249426e-02   -7.204558249064266e-01   +7.943184959358662e-01   +6.959893608643513e-01   -3.064979521165365e-01   -3.468016522519335e-01   +7.205407294071283e-01; -2.698379072256688e-01   -4.070894883114214e-01   -2.865797576769519e-02   +1.590855462592851e-01   +9.744452548189592e-01   -2.238528436073566e-01   +5.373653854483849e-01   +3.797114590389876e-01; +1.940734297322496e-01   -4.438267533133811e-03   -4.405103576244128e-02   -4.430853559969159e-01   +1.071036780187682e-01   -6.205013056514106e-01   +2.105939851696476e-01   -5.353996856587816e-01; +1.736665365164584e-01   +2.070930267770917e-01   -5.968753186352060e-01   -6.088121116990144e-01   -5.028951638816679e-01   -6.723096633310415e-01   +5.817228277232308e-01   +4.220520237311069e-01; -7.173119569582030e-02   -3.168676398191781e-01   -4.564193212006409e-01   -4.854648365875563e-01   +6.884805819735573e-01   +4.463050073523088e-01   -1.902263519389487e-01   -1.594589258408889e-01; +1.242950928967939e-01   -6.894480772480499e-01   +6.542618640233108e-01   -1.591421812496230e-02   -3.667623391313782e-01   +2.484804940295189e-01   +4.006195245470326e-01   -2.066059333669863e-01; +3.801836812021047e-01   +1.140718382446750e-01   -1.580553530583262e-01   +3.070338155137374e-01   -1.847486339631269e-01   +1.858748136666349e-01   +2.017080609060702e-01   +4.454691782051920e-01; +5.319751894954936e-02   -9.192022777060455e-02   +4.465402440800100e-01   -3.919149224305510e-01   +7.394588054780202e-01   -9.055599027380705e-01   -5.149051383577961e-01   +5.128666557293927e-01; +3.566855877259315e-01   +6.207428520351252e-01   +2.765562993411524e-01   +1.458689010823255e-02   -8.478863732944324e-02   +8.072210594705915e-01   -7.213940262461850e-01   -2.868373768861570e-01];
L1E_L2E_iAMPA_netcon = [-2.888692887699362e-01   +8.927695077732268e-01   -3.561109392896658e-01   -2.067236504414833e-01   +7.009224743186715e-02   +8.663140344455601e-01   +8.094317469356724e-01   -1.210136018910532e-02   +2.450138169872177e-01   +4.186767444301157e-01   -1.459074557157324e-01   +4.747341624050671e-01   -8.161920297899458e-01   -2.344048347136963e-01   +1.225324678298912e-01   +1.397231826650705e-01; +8.328725582752190e-01   -4.702491169165803e-01   -3.871731117562920e-01   +2.475989734333172e-01   +2.476007842282153e-01   -1.923431216690568e-01   -1.353060305542555e-01   -8.671058885092081e-02   +5.428510008829669e-01   +4.488930615435547e-01   -2.693402408819451e-01   -2.842232253656395e-01   -1.016802519343862e-02   +7.411931566045018e-01   +6.216260273398594e-01   -5.048965181267591e-01; -4.032711940366318e-01   +3.287317255816110e-01   +3.898336616090375e-01   -9.879031479829231e-02   +5.878350104024538e-01   +5.016378009306790e-01   -9.879280143490066e-02   +5.470559889732054e-01   +4.178078583887370e-01   +1.675222988250338e-01   +4.381390390720022e-02   +2.388153201680007e-01   +4.103500104283698e-01   +2.915592102465990e-01   +7.842020101373564e-01   +1.624784463698289e-01; +3.003489618100066e-01   +1.250073034316712e-01   +1.232284644357776e-01   +1.928005203796218e-01   -2.496916381039789e-01   +5.968418767103738e-01   -2.283547089285031e-01   +1.693408612203743e-02   -4.682209958827633e-01   -2.088908888467807e-01   -2.728723763786083e-01   +3.038824846654991e-01   -2.689843151996189e-01   +8.482458131531818e-01   +3.081662263680978e-01   -3.024534178353053e-01; +2.379805030045900e-01   +6.357025554206681e-01   -4.526658642633213e-01   -9.158980889782089e-01   -6.957647161386840e-01   +1.778603054003133e-01   +7.167249363277562e-01   -6.039704131378063e-01   +2.532583150466102e-01   -5.426614941096645e-01   +1.259132125523088e-01   -1.688229616025543e-01   +5.503494727251008e-01   +5.554293753675807e-01   +1.943855529655806e-01   -1.194425458221134e-01; -2.153822849591313e-02   +1.956719861560090e-01   +5.799987828949618e-01   -3.372152616803392e-01   +9.605876749412404e-02   -4.245728848994147e-01   +3.879848444276579e-02   -1.558875418204811e-01   +3.883373893636104e-02   -8.536959270425415e-02   -2.323512902453729e-01   +3.690491477437133e-02   -2.078232117911186e-01   -1.202088737061885e-02   -7.660054638327018e-01   +3.095603251389938e-01; -4.747472933570456e-01   -6.100145956731653e-02   +1.756728995999552e-01   +5.113319796457081e-01   +1.826312216970731e-01   +7.672300056988886e-01   -3.332607832210857e-01   +1.815826046673776e-01   -7.027917148142071e-02   -2.537948615279882e-02   +5.975425863305443e-02   -4.282572101846140e-01   -1.045052181026534e-01   -1.616905845780067e-01   -3.127716263862119e-01   -5.789831872135021e-02; +2.813815349875838e-01   +3.547175747250358e-01   -3.458915635072186e-01   +3.671838211506782e-01   +9.863428995484291e-02   -2.512205774448977e-01   -2.720388916863765e-01   +2.487993620395642e-01   +1.191002250332557e-01   +4.492013096072925e-01   +1.838775344515541e-01   +4.772212467039350e-03   +4.709071301279351e-01   +2.608049655590036e-01   +2.813851167402420e-01   +9.065836440534743e-02];
L2I_L2E_iAMPA_netcon = [+7.539376680578264e-01   +7.397124509980250e-01   -3.460224366268241e-01   +9.453960583195350e-02   +7.541840878144270e-01   +6.107834451988613e-01   +3.951364050415416e-01   -3.517982498391028e-01; +3.841897116072548e-01   +2.483743917621131e-01   -6.858087047206290e-02   -1.236375100485188e-01   +5.622226792222089e-01   -5.388804608929030e-01   -7.922515478191082e-01   -2.948366079200258e-02; -4.858273642891194e-01   +5.224097218112635e-02   -9.327692787404840e-02   +1.663560079548163e-01   +9.986406791905188e-02   -2.431781056447686e-01   +5.911322595624771e-01   +7.331586861678452e-01; -1.453405348341935e-01   -3.020472721289280e-01   +7.235522850529852e-01   +2.496848344096636e-01   +6.524538621026009e-01   +2.995053215508303e-01   -2.036368740086664e-01   +5.257361850472276e-01; -1.317422520349102e-01   +1.902463729955227e-01   -9.349873401317238e-02   +2.824837487371772e-02   -1.223726335261691e-01   -4.476665466781857e-01   +1.000000000000000e+00   -8.529905641171265e-02; +3.077480695601128e-01   -1.992654334926782e-01   +2.293198076406911e-01   -4.906157775300132e-01   -1.342987097113379e-01   -5.670248915523546e-04   +2.582640422351730e-01   -4.156522934896899e-01; +1.165175623081996e-01   +8.651566978370737e-01   -4.860019390075691e-02   -1.935534485994864e-01   +2.817984951832284e-01   +7.192132651955379e-01   +2.214516781223769e-01   -1.153288534401844e-01; +3.282706888082735e-01   -2.781225736691372e-01   -3.200097777312458e-01   +1.157672683169817e-01   -6.709832946422365e-01   -5.683107357252984e-01   -3.322433932011970e-01   -3.420721442259808e-01];
L2E_L2I_iGABA_netcon = [+1.343746866733891e-01   -2.898499263781183e-01   +6.851559287575537e-01   +1.768328090578997e-01   +2.355692612348655e-02   +7.773176510073266e-03   +2.219864837214082e-01   -6.489577520051903e-01; -6.614774632741223e-01   +6.415648437218662e-01   +5.181228369607289e-01   -2.919015472674578e-01   +2.873989743780789e-01   +7.397960386526916e-01   -3.422906625592321e-01   -1.237477894692298e-01; -2.627724383941737e-01   -2.073111461275637e-01   -4.442430791776419e-01   +5.648044620205360e-01   +2.579849550021466e-01   -5.899440651598799e-02   -6.703721230977905e-01   +5.672693571897147e-01; +4.553564137396461e-01   +8.858989070124300e-02   +9.040728155774033e-02   +5.644131495382477e-01   +6.816870684479103e-01   +2.368907549201233e-01   +3.697823499137781e-02   -2.743183308615431e-01; -7.239771327217156e-03   -7.037614952878596e-01   +3.615806772673778e-01   +5.473389217078135e-01   -3.042879218033244e-01   -3.402887607391490e-01   +3.266710275891028e-01   +7.083311263815774e-01; +3.011906976328902e-01   +4.987352340243165e-01   -3.183116675037235e-01   +3.629972222090551e-01   -1.359525406578848e-01   +4.473460010535997e-01   -8.667554464864161e-02   +7.079270323699890e-01; +2.978380387996609e-01   -2.430912927581828e-01   -1.000000000000000e+00   -4.743355717135899e-01   +6.733732514136794e-03   +4.433624073677857e-01   +8.782197544321425e-02   +3.487273476949610e-01; -3.329080669316070e-01   +3.601910815288208e-01   -4.529722803292676e-01   -5.245914224437606e-01   +5.929288918301291e-01   -1.449978416601050e-01   +7.389364013034010e-01   +9.447044710320121e-02];
L3E_L2E_iAMPA_netcon = [+2.439572203346812e-01   +7.643238475034331e-01   -1.457781614345421e-02   -6.823165498518392e-03   -5.214198292616814e-01   +7.644300017779215e-04   -8.263099200516316e-01   +5.283471528316528e-01   +2.600376021725344e-01   +3.781645220405605e-02   -6.536664322752215e-01   +4.228098102735133e-02; +1.807412263399975e-01   +3.968386261370329e-01   +1.312331137921123e-01   +6.914334195626569e-01   +5.851048043572932e-02   +6.924112843009154e-01   -2.297520826500034e-01   +5.753330941447312e-01   -6.615142712314277e-01   -1.677028044981799e-01   +6.176818606400269e-01   +9.808386212270981e-03; -1.288750181549093e-01   -1.000724844662253e-01   +1.180531481356526e-01   +5.502871206811738e-01   +1.102684803965455e-01   +8.885402974498569e-02   +5.457388787142995e-01   +7.829321956437030e-01   +3.700662802037713e-01   -1.369670786292048e-01   +7.144469455418861e-02   -1.108188399670116e-01; +2.576854853399431e-01   +1.487407300563565e-01   +6.290639107727020e-01   +2.046779600387380e-01   -2.953785150665256e-01   -5.158021181264433e-02   -3.401870064197285e-01   -1.740091045671381e-01   +9.086512155663737e-01   -1.767214760406058e-02   +5.362352253551761e-01   -5.672502651927804e-01; +3.410488920570751e-01   +6.504778118178446e-02   -7.162658963890212e-01   +1.011265002705250e-02   -2.231242186016504e-01   -3.745203439918886e-01   +7.105406327303952e-01   -4.766656572815610e-01   -2.959782812951246e-01   -2.009812851354822e-01   +6.094583703094020e-02   +5.338394459023268e-01; +3.843748965783197e-01   -3.198222539455728e-01   +6.724198517391056e-01   +5.293393806513143e-01   +6.921533323102314e-01   -7.495724539419285e-02   +4.976075002991142e-01   +6.309083263964940e-01   +1.217701695973267e-01   +6.274542248653369e-01   -6.547375559660409e-02   +5.395107701179100e-01; +8.104247309220157e-01   +4.908922243451534e-01   -3.859950992871348e-01   -4.359614252381703e-01   +4.275528819029393e-01   -2.072652145417989e-01   +2.005186722724714e-01   +2.469901417363078e-01   -3.296901740122097e-01   +5.620428256843946e-01   +2.046828042960301e-01   +2.225013355798446e-01; +4.055317697394372e-01   -9.721942930793432e-01   +6.279098447396065e-01   +3.640425026831942e-01   -4.704335957934112e-01   +1.630602926801676e-01   -1.132126025487607e-01   -4.598398449989382e-01   -4.979682165025168e-02   +2.273514355408514e-02   -1.574945812857082e-01   -3.034403386288482e-01];
L3I_L2I_iGABA_netcon = [+1.225962348541344e-01   +4.494768111438737e-01   -5.468488630732453e-01   -2.103713648415704e-01   +8.180606803955176e-02   +5.494951863494800e-01   -4.015544771051970e-01   -6.016064170297960e-01   +7.420391731928191e-01   +3.432196534176800e-01   -8.241728049815947e-01   -1.212197924317600e-01; +2.972733349253370e-01   -5.303782873069466e-01   +7.037110334801641e-01   -3.814013234296812e-01   +2.951387695385744e-01   +5.107134135129161e-01   +6.857981342765462e-01   -6.539146490835452e-01   +6.103311108338371e-01   +3.954856375842546e-01   -1.145779094018153e-01   +5.603045784504580e-01; +6.978956830943184e-02   +7.361541514687000e-01   -6.912571371240163e-02   +4.251647114753553e-01   -4.942282278892642e-01   -5.782127590465584e-02   +2.617329405500453e-01   +3.910000840799017e-01   -1.401475972992824e-01   +4.336046382956885e-02   -2.123011582288226e-01   -1.499300364450897e-01; +1.743692464517912e-01   +9.964367160851931e-01   +7.720079905177021e-01   -3.591924322744446e-02   -5.450826109304160e-01   +5.993896001222235e-01   +3.284179848093252e-01   -1.369777788162362e-01   +6.268731198327894e-01   -2.127472987228757e-01   +7.252200385986676e-01   -2.503121143118482e-01; +7.757257610543968e-02   +1.859361758289201e-01   +4.404461172559727e-01   -3.561855453057223e-01   -9.832190690172836e-02   +8.473214503926972e-01   -3.964332350661359e-01   +2.135101769110159e-01   +9.219870728679934e-01   +4.670358471539605e-01   +1.894082387427906e-01   +1.557811656147002e-01; -1.438431607091313e-01   +6.324686704230786e-01   -4.857944030479737e-01   -8.376340558282079e-01   -5.904426620787747e-02   +6.388908484130207e-01   -1.935981779860354e-01   +7.179944254859262e-01   +2.651155401451374e-01   +4.824337374324373e-01   -2.865993430596704e-02   +9.545171578397726e-01; +3.866602975246485e-01   +1.024321405677349e-01   +1.578012339014055e-01   +4.241185211822528e-01   +2.939730865658587e-01   +3.766014249339979e-01   +8.138155051413174e-01   +1.000000000000000e+00   +3.121192787057152e-01   +2.854135657006491e-01   -3.372183292071087e-01   +5.730083943790822e-02; +1.444822454685761e-01   -4.713210753901910e-01   +4.494108839066674e-01   -3.435468018124142e-01   -3.969445282453042e-01   +6.198645907768220e-01   -1.080139791595280e-01   +1.160107083534034e-01   -3.167389071363369e-01   -4.845250861333947e-01   +7.196031616456288e-01   +2.368702681041615e-01];
L2E_L3E_iAMPA_netcon = [-2.105565228265208e-01   -5.739728346952951e-01   +1.196983883459026e-01   +1.294874103515398e-02   +5.502302759157474e-01   -4.069687680351024e-02   +5.598042805391010e-01   +3.347365312713176e-01; +5.312396818378182e-01   +2.943404635967478e-01   -5.176697279451621e-01   -2.494087834454613e-01   +3.659311136832222e-01   -6.919393404198343e-02   -5.819506814898968e-01   +3.510079824267003e-01; +2.139673191220965e-01   -4.351784855917201e-01   -1.465100784222561e-01   +6.771255694392553e-01   -1.603678592753695e-01   +1.075536412027567e-01   +5.697934686412498e-03   +6.540754089132025e-01; +2.899113313587764e-01   +2.643290932875553e-02   -7.580810534440899e-01   -1.250066334280787e-01   +1.764148560824422e-01   -3.714524583925896e-01   +2.292498352434857e-01   -4.221314064597314e-01; -1.352782783513112e-01   +6.477847763196547e-01   -7.505879374755456e-01   +2.238960036318255e-01   +5.507566311242159e-01   +4.282614633933952e-01   -1.607248770499405e-01   +3.836358161991550e-01; +3.834974557483130e-01   +8.635345369040823e-02   -2.362355317141677e-01   +6.394752782449099e-03   -1.317946493119020e-01   -2.388174498969625e-01   -1.138740247384566e-01   +1.238987224925571e-01; -4.001638602694568e-01   -2.815356228811245e-01   -5.207693911577971e-01   +8.189427215982517e-02   -1.487833238010179e-01   -8.431832861355573e-01   -2.288460064229362e-01   -3.518947402680866e-01; -4.115950037259631e-01   -2.449480342626650e-01   +7.755765411398075e-01   -1.698258808853562e-01   -1.654418621024745e-02   +1.429178756290227e-01   -3.134158151162786e-01   +8.441321200377334e-01; +2.854197675290756e-01   +5.781457449744221e-01   +3.186371234261619e-01   -5.169531404501437e-01   +4.998176723071432e-01   -4.049363337006215e-01   +5.322358214494247e-01   +1.972964315239907e-01; +2.693310264762092e-01   +2.959226976670437e-01   -1.677720158532759e-01   -4.705991573835433e-01   -9.419962969832676e-01   -5.787677202529731e-01   +2.026966049823484e-01   -7.305905140747522e-01; -6.400772086559095e-02   -6.640236290922426e-01   -3.608891434496437e-01   +3.154443300180135e-01   +6.118507613333889e-02   -4.156191697933259e-02   -2.601964144393819e-01   +3.182737532645825e-01; -5.194982956403454e-02   +8.612920472749893e-01   -2.523611194350148e-01   +2.843698059897199e-01   -4.029470147625046e-01   +1.065813368355664e-01   +3.263243421158878e-01   -3.477561990614300e-01];
L2I_L3I_iGABA_netcon = [-1.134535967885701e-01   +2.929155966488066e-01   -1.669604253661555e-01   +7.700674093575257e-01   +3.441796087993660e-01   +3.944067654455320e-01   -5.110334351365702e-01   +6.066774933632223e-01; -2.993648160660445e-01   -8.365323996730576e-01   +6.973493341273174e-01   -3.077746804636166e-01   -1.307879774905601e-02   +7.308278575942673e-02   +3.512845415504755e-01   -6.369402230111967e-02; -2.874263291044653e-01   +1.488011151262185e-01   +9.540172910329395e-03   +3.328957719805908e-01   +3.186150857628220e-01   -6.540020373747010e-01   -5.053479503459941e-01   -2.237447990691900e-01; -5.799873931785975e-01   -4.429418973536738e-01   -6.796601439820343e-02   +6.661561791410902e-01   +3.694519266139923e-01   +1.211322128414099e-01   +7.759069497442341e-01   +2.200707486309448e-01; +4.467114013421816e-01   +6.143171219223931e-02   -6.245442136538527e-01   +4.082828419571309e-01   -1.665021789074473e-01   +1.099444723231563e-01   -6.558211486182473e-01   -6.775140665973900e-03; -2.071337490914602e-01   +3.927759570269022e-01   -4.560584885196816e-01   +3.065445956494980e-01   +5.558776235941680e-01   +6.596577311533592e-01   +5.954156488252564e-01   +5.325160473027744e-01; +1.846208994215076e-01   +2.241001720192253e-01   +1.103518055678576e-01   -2.639475425616332e-01   +7.878054942779787e-01   -1.261818234447906e-01   +1.558620207583447e-01   +4.573274793186375e-01; -6.163824935954856e-02   +7.062453547437014e-02   -5.105090005570195e-01   +6.172881290104850e-01   +1.082883109600462e-01   +7.221607073890703e-01   -1.097249544693213e-01   +1.102840954293369e-01; -2.402438840805057e-02   +9.665712084454460e-01   +4.667197512998198e-01   +6.361886739190572e-01   -5.036125136452105e-01   +3.458245816542358e-01   +9.547128869327844e-01   +1.431239400149613e-01; +3.378635416178877e-01   -5.369721065001943e-01   -6.954118766968720e-02   -2.685836061994540e-01   +2.578188797508129e-01   +3.656604194481041e-01   +5.740566570471066e-01   +8.048159438512173e-02; -3.610904448773057e-01   +2.475641269009484e-01   +1.098931975620206e-01   +4.996120813193242e-01   -1.851228290341462e-01   -2.469472197239409e-01   -2.963550323659476e-01   -2.542392482232181e-01; -1.549364302917417e-01   +3.910858601003204e-01   +3.915170218650647e-01   +8.924048262333249e-02   -3.340843746718611e-01   -1.067974795094928e-01   -3.343062279540814e-01   -4.747946273996585e-01];
L3I_L3E_iAMPA_netcon = [-3.434803092553768e-01   +4.474505911575057e-01   -1.298460586368357e-01   +8.515767317697434e-02   -2.010413172718296e-01   -3.132841886682046e-01   +4.170597911986058e-01   -3.691352231962913e-01   +2.886964004307905e-01   -7.020891880969434e-01   +3.803125967238719e-01   +5.371551667396834e-01; +2.731387538665591e-01   +6.382047888165775e-01   +2.961096174918887e-01   -5.810865176738300e-01   +4.689173517717961e-01   +5.146360147079578e-01   +6.984364724116894e-01   -5.267521398577605e-03   +3.034212681417994e-01   -1.189388388883710e-01   -5.478455213370689e-01   +6.372875135249116e-01; -2.957673717918870e-01   -1.548334744188883e-01   -5.644269836630260e-02   -3.136361526613475e-01   +7.762467677978215e-01   +4.838828845854805e-01   +2.257045363083932e-01   -1.774254577510390e-01   -6.437939086696466e-02   -2.340273056311516e-02   -8.029830419153366e-04   +9.532030862338817e-02; -1.772183376083056e-01   +5.940731792919239e-01   -1.620490234624822e-01   -3.480447465574718e-01   +5.782120832618353e-02   -1.436835288006804e-01   +6.302734595926729e-01   +2.421964426583693e-01   +5.171397343178169e-01   -3.150328664654408e-01   -3.039085932727358e-01   -1.744603375631634e-01; +3.745982499157615e-01   -4.395409291197295e-01   -1.346337358775465e-01   +6.618341022147555e-01   +8.447468180813809e-01   -4.543712886475755e-01   -1.491032464289702e-01   -4.560943335472481e-01   +4.379961961542760e-01   -1.197447257792377e-01   -4.121547029872676e-01   +1.832409663382069e-01; +3.636911944872137e-01   +2.079552400839054e-01   +8.352856809059263e-01   +5.678290028300526e-01   -6.623276446835370e-01   +8.317194846139906e-01   +2.176799335704420e-02   -2.101746543391971e-01   +8.785884773991014e-02   -3.288681133074585e-01   +5.701897085010741e-01   -3.428904780598670e-01; +7.585380194326425e-01   +2.877231748749576e-01   +3.734658870147633e-01   +1.497891671871382e-01   -6.263144842363535e-01   -1.030755811450415e-01   +6.472332548923702e-01   +1.000000000000000e+00   -5.072699548985644e-01   -6.933617623875811e-01   +3.300357085331461e-01   +5.786695447327764e-01; +4.776602011016322e-01   -6.629911950361669e-01   +6.828467365415879e-01   +6.529488260233680e-01   +8.912108891635658e-01   +1.049650416147266e-01   +4.986997264200509e-02   +1.535604471119725e-01   +5.695619916943678e-01   -2.755668005706829e-01   +8.749106597243077e-01   -5.557573578279922e-01; -4.183562128224144e-01   +1.017870374436371e-01   +1.467494627559932e-02   +5.070697924197416e-01   -4.072258797147447e-01   +2.076366449379922e-01   +5.037926984993145e-01   -2.763618749320841e-01   -5.534479195007886e-01   +7.414603552846378e-01   +4.655521189649970e-01   -4.632989800261174e-01; -1.573377668024490e-01   +7.631222605999213e-01   -2.957667945421366e-01   -1.541405341142014e-01   -3.130397787773926e-01   +7.301830546877386e-01   -2.916566651164660e-01   +1.091534352878491e-01   +1.079692588971400e-01   +7.648608268259489e-01   -1.086960738300545e-01   +5.723956205418184e-01; -7.440896430447894e-02   +5.996071996675878e-01   +5.145296968148053e-01   -5.133764330308616e-02   +1.325661223717740e-02   +6.337025311285679e-01   +3.056028096573226e-02   +4.068117388698425e-01   +1.510625415108888e-01   +2.018384399519018e-01   -5.956957360401215e-01   +9.588399085943247e-01; +4.455755906744982e-01   +1.510578038219000e-01   +4.624148878636871e-01   -6.435005216297132e-01   +7.614741029574587e-01   +6.665605294755177e-01   -4.935893270109055e-01   -2.218903883887826e-01   +6.615052579261335e-02   +2.553453783970470e-01   +2.790347834294654e-01   +2.968356274635371e-01];
L3E_L3I_iGABA_netcon = [+2.683577535395866e-01   -4.557473771029533e-01   +7.290132795606159e-03   +3.457904232012370e-01   -2.728920652147633e-01   -4.163626148926078e-01   +7.290827428393017e-01   +6.185099251845242e-01   -1.990243235218109e-01   +6.209679049226342e-02   +3.176802371405299e-01   -3.062659511853898e-01; +1.327430830873754e-01   -5.316106200601690e-01   -7.047148536880717e-01   +3.250480609649762e-01   -7.078170200168989e-02   +4.110248872246324e-01   +4.812709603246946e-01   -2.134477877231514e-01   +2.254038654873693e-01   +4.366910901942435e-01   +1.550265406262763e-01   -2.206609078506932e-01; -7.093051082454171e-03   -1.187576573794056e-01   +4.112522890759545e-02   +5.545239072426046e-01   -3.198114283677375e-02   +2.679474906013581e-02   -9.824293682325097e-02   +8.195552444398434e-02   +3.687474830805811e-02   +3.199548826256300e-02   -3.723034036962665e-01   -2.639069297509363e-01; +3.533653630318312e-01   +1.617994254433257e-01   -5.956567361262775e-01   -2.798659248013795e-01   -2.873014700834972e-01   +8.065725662147507e-01   -4.121589001655787e-01   -8.302701761427173e-01   +2.591199439304372e-01   -6.421625962286861e-01   +2.398061205182502e-01   -1.361960105479836e-01; -2.422275636532684e-01   -1.672396061901226e-01   -3.782171839461348e-01   +6.194000553349657e-01   -1.661089265217254e-01   -1.490211101400668e-01   -1.431863861408600e-01   -3.024261112959448e-01   -1.749798902394501e-01   -3.370637849633545e-01   -1.289228840256764e-01   -3.538826310920438e-01; -2.910031625055919e-01   -4.151082223561731e-01   +3.359754161343242e-01   -3.286911676961601e-01   +2.298331454193497e-01   +6.145579673694685e-01   +3.298061122804301e-01   -2.232642333821911e-01   -5.302218161173995e-01   -2.735098263623005e-01   -2.432180625976541e-01   +1.797093655612096e-01; -2.982564314627048e-01   +3.848508242263751e-01   +4.220274681356814e-01   +8.481357152379206e-02   +2.041326843066056e-01   +1.115938324105055e-01   +6.837756587354053e-02   +3.764867159546168e-02   -5.324842100791591e-01   +1.041108762872851e-01   +7.352730301597628e-02   -4.090483080967129e-01; -9.496470863426629e-02   -1.835936999894062e-01   +3.810797761137766e-01   -2.382993798929987e-01   +5.836380635992123e-01   +1.871824508952599e-01   -3.572133931985036e-01   +4.168287154495742e-01   +1.039255984886120e-01   -4.535058796819235e-02   -1.000000000000000e+00   -1.410124556200438e-01; +2.271077796415466e-02   +1.594677620562541e-01   -2.808058122685355e-01   +4.945309991974138e-01   +4.461525887827154e-01   -4.239237911246172e-01   +4.807687687463728e-01   +6.511012668941679e-02   -6.275049578465854e-01   -1.489040673222592e-01   -9.562219017633189e-02   -4.789897196277119e-01; +1.441675411502629e-01   -1.727162087901194e-01   -1.943029435977485e-01   -3.807176141642503e-01   +1.746481603535009e-01   +2.088423081088659e-01   -1.017060241813061e-01   +3.886561552265971e-01   +3.632196551521294e-01   +5.001386904240444e-01   -1.979358063610936e-01   +9.657350877425991e-02; -1.177047245643548e-01   -3.133655094873301e-01   +1.655128665464997e-01   +4.661727982505320e-01   +6.337564536533284e-02   -4.306574460452046e-01   -1.060005343381363e-01   -3.389414605056514e-01   +4.080038412504093e-01   +3.016660316159392e-02   +2.155112705896766e-01   +9.076244482432440e-02; +1.446515509312330e-01   +1.083058171756207e-01   +3.112793507545635e-01   +1.512128609132283e-01   -1.282858581820730e-01   -3.434896349492640e-01   -8.175869543402062e-02   -1.539059140689820e-01   -4.591200386815650e-01   +2.247416409495447e-01   +3.734390018616929e-01   +3.301877071003082e-01];
L2E_Input1_iAMPA_netcon = [-3.143475258112151e-01   +3.739003860128658e-01   -1.508531734711002e-01   +1.653768714668966e-01   +6.956625179959105e-01   -9.174930402100729e-01   -4.132151004290222e-02   -8.138588633833593e-01];
L2I_Input2_iAMPA_netcon = [+2.117924581064129e-02   -3.253491781015679e-01   +1.563753368721520e-02   -4.573597610204707e-01   +2.669890384570211e-01   -3.161769793570817e-01   -3.731906731319438e-01   -6.862588298603706e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
