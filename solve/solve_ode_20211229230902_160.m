function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.244526490932988e-02   -2.486372619179732e-02   +1.139367219436697e-01   +2.040847638888527e-02   +6.290795056867893e-02   -1.917026418979227e-02   +1.134385117465362e-01   +2.085177819203349e-01   +1.185811432826730e-01   -1.044957821706584e-01   +5.066947622676195e-02   -4.707062941156025e-02   +2.565432310940260e-02   +6.943140996465089e-02   +1.184852622226524e-01   +1.673795471316660e-02; +9.193881966553821e-02   +1.237149080755813e-01   +2.314802586258746e-02   -7.768992897289322e-03   +7.345326029034789e-02   -6.838212564830793e-03   +1.307247118611187e-01   +2.410401313981447e-02   +1.626093024675172e-01   +7.517539688457138e-02   -2.531447708126378e-02   -1.969071113973563e-02   -3.973596219526156e-02   +1.407938012976022e-01   +2.326629765088513e-02   +1.702463910960698e-01; +1.808530697376627e-01   -5.216703247727068e-02   +4.176518400160405e-02   +1.448020893728936e-01   +1.890944054317936e-01   +2.112032522714711e-01   +2.638560134914813e-01   +1.528449543887506e-01   +6.250035472554075e-02   +7.794360801951035e-03   +1.154148152399423e-01   +1.263152024545131e-02   +1.503675705543383e-01   -7.436124200841197e-02   +3.472978017784852e-02   +2.813533368170358e-01; +4.756421515341405e-03   +9.668510656037001e-02   +7.183226683661267e-02   +7.539950337709599e-02   +8.778941058197681e-02   -6.284982006106990e-02   +7.728443682676908e-02   +3.480601935409312e-02   +1.876107942928583e-01   +1.281024877301169e-02   +1.703304497721508e-01   +7.728789172493765e-02   -1.060678002072926e-01   +1.369382273990290e-01   +1.633229170670409e-02   +7.252297964188832e-02; +1.500243964099426e-01   +1.152763582256576e-01   -6.849002987574057e-02   +3.300449065708342e-01   -8.742086920680564e-02   +4.618702155007476e-02   -6.547165615953290e-02   -6.612320580416789e-03   +3.702742996679099e-03   +1.571780242090901e-01   +9.886161004812971e-02   +1.571705840290792e-01   +2.307249384526086e-01   +1.569009632600891e-01   +2.500580154442995e-01   +1.114393245531690e-01; +6.311926482907362e-02   -4.898011377404606e-02   +5.386025945494342e-02   +9.747313707868424e-02   +5.739990434286867e-02   +8.373234743306934e-02   +5.260128829332397e-02   +6.760698187848704e-02   +1.491704045401430e-01   +3.137760306325103e-02   +4.624355722546379e-02   -1.928668261114381e-01   +1.588272640543895e-02   +7.380492519068418e-02   +1.915912130797726e-01   +7.379120342469081e-02; +1.143416824363858e-01   -1.037402338973901e-01   -8.136180175120936e-02   +7.309004362358085e-02   -9.471143805363137e-02   -3.993835263145222e-03   +9.601364246976395e-02   +1.150997370620179e-01   -2.759625164977155e-03   +2.835420631653923e-02   -8.406925824599804e-03   +2.037983533158907e-01   +1.026298759908797e-01   +4.579237395983485e-02   -3.433772787926750e-02   +9.572021155845106e-03; +1.386148121818998e-01   +2.154726820139370e-01   +5.174834403468621e-02   +1.240334565474117e-01   +1.893673605098462e-01   +6.792391630832001e-02   +5.489252105563602e-02   +5.775143019160442e-02   -8.392887864948143e-04   +1.874925842546414e-01   +2.653986006885233e-01   +4.380739236771038e-02   +2.878467697666099e-01   +6.207761625937466e-02   +1.722277448347982e-01   +2.113719987888684e-01; +1.267270359536931e-01   +2.819446386878386e-01   +4.491771400933504e-02   +5.922678850274721e-02   -5.233571016783659e-02   +2.551861321565830e-01   +9.752099287290038e-02   +2.268361042046526e-01   -2.079731309704105e-02   +1.194441834470133e-01   +1.497895650528653e-01   +1.231014291885316e-01   -1.231302852757126e-02   +9.951409871415919e-02   +7.051283759713034e-02   -1.445043409581140e-02; +1.674587652408525e-02   +7.394545195347538e-02   -8.261796983035606e-02   -8.416119502506562e-02   +9.840689325378571e-02   +8.617565599516387e-02   +3.517803968079326e-02   +6.170459965850821e-02   +3.070389634494733e-01   +1.654861836855422e-01   +6.445879728575551e-02   +2.135616644692044e-01   +1.543707063934853e-01   +7.120125947793447e-02   +7.738973214923177e-02   +6.616158868418140e-02; +1.286872167766744e-01   -5.208995687129103e-02   +1.660536922790522e-01   +1.817511864574435e-01   +1.476762935429455e-01   +6.952769201777793e-02   -6.250189308721248e-02   +1.119304772497860e-01   +4.236329235404016e-02   +4.413994485138316e-02   +8.820304754893696e-02   -1.160353924887897e-01   +6.215747024572860e-02   -1.167130556777348e-01   -4.028100460729466e-03   +1.381226648684948e-01; -1.240099102195778e-01   -7.388325797953897e-02   -4.118966465046971e-02   +4.337769633131981e-02   +8.878813794414885e-02   +5.795921993245311e-02   -1.002100148121801e-01   +1.196398169214385e-01   +7.981291699850528e-02   +4.708972029835026e-02   +7.433626717112976e-02   +1.572321433226855e-01   +3.076256144992366e-01   +1.999563356746920e-02   -5.824043195517644e-02   -6.198488131487166e-03; +8.273962285368830e-02   +4.026929933438121e-02   +2.390180552003923e-02   -3.723398850456236e-02   -7.596489107831633e-02   +3.876549777817073e-02   +8.337174822315736e-03   +2.223366685390449e-01   +2.106619126537038e-01   +1.569862997989920e-02   +1.943421982702002e-02   -1.488108544820253e-01   +5.764930617572089e-02   +9.114538871208343e-02   -1.271603839173431e-02   +9.834464742107556e-02; +3.338309457597066e-03   +3.287185416115964e-01   +2.149035430564796e-02   +1.199050519594145e-01   +1.005957580696984e-02   +1.584440649353544e-02   +9.949698253660452e-02   +2.998875073124446e-02   +5.875447521406876e-02   +4.090769988844702e-03   +1.257211491196261e-01   +2.132015938444389e-01   +2.285434189711683e-01   -1.466465291360846e-01   -5.812068784408631e-02   +1.347996592491005e-03; +1.854305160104420e-01   +7.074026798362812e-02   -7.104584776094913e-02   +1.401412583366644e-01   +2.256659550773566e-01   +6.816819731804794e-02   +4.090376059372142e-02   -3.877471308286056e-02   +3.162620181297277e-02   +1.484599066924021e-01   +4.581760428933265e-02   +4.972189605312302e-02   -6.724762923632943e-02   +7.975574424565013e-02   -8.241878317554843e-02   +1.399743415426237e-01; -4.349366023911186e-02   +1.246740014320288e-01   +5.096398498090239e-02   -1.977541338935806e-01   +1.097798944448898e-01   +2.368469719969644e-01   +7.702149395176630e-02   +1.502874018570811e-01   -7.165671001102583e-02   +2.064582008817490e-01   +1.069783747607574e-01   +4.559132669773433e-02   +4.657100609013348e-02   +6.966721472857144e-02   -4.800053294634286e-02   +2.007412156487975e-01];
L1E_L1I_iGABA_netcon = [+3.402682293605731e-02   +4.117507791287656e-02   +9.901571708443960e-02   +1.467547882642900e-01   +7.886844893931544e-03   +1.209392863559891e-01   +1.640520370956932e-01   -7.254500796890694e-02   +1.476265156747293e-01   +1.141987453724089e-01   -9.840327179941516e-02   -1.044467057615710e-01   -3.068286666748398e-02   +1.778253928892631e-01   +8.092657316254950e-02   +6.521040404847503e-02; -4.164635740740365e-03   +4.691077286872597e-02   -6.281808608783523e-02   +1.594933212001017e-01   -3.289399306106734e-02   -1.353188244727216e-05   +1.385407633649981e-02   +2.340870093809007e-02   +5.727274424740123e-02   +7.728623331614870e-02   +2.430594247250193e-01   +1.740287895813186e-01   -2.244640662833083e-02   +2.632256711179686e-02   +6.888088160370467e-02   +2.979241075606229e-02; +1.106670481180813e-01   +1.283466526974505e-01   +1.410553647582362e-02   -9.618791906089388e-02   -1.030592103755254e-01   +1.885374163765996e-03   +5.424378357893826e-02   +9.444238121535015e-02   -5.933901834536143e-02   -4.488826717083026e-02   +1.707488826760814e-01   -1.256148850046475e-01   +2.297878267135313e-01   -1.143226370336790e-01   +9.446478915978759e-02   +9.727480400690507e-02; +1.754029531518855e-01   +2.783331074341943e-01   +2.073123812836057e-01   +2.230008226577417e-01   +1.050301467648522e-01   +6.814483191136050e-02   +2.162815566501716e-01   -7.105952798006004e-02   +1.384054449023123e-01   -1.144707425145904e-01   +1.917700856892448e-02   +8.180922031928842e-02   -1.966819343812284e-02   -5.777381710750720e-02   +9.832232128171649e-02   -3.127761964465354e-02; -1.778992061196210e-01   +2.294176742687418e-01   +5.554423415259787e-02   +3.718198440510337e-02   +1.761412266369548e-02   +1.945444039158169e-01   +2.213890893641480e-01   +2.301411580474697e-01   -6.419358773160050e-02   +9.815130498333494e-02   +1.620484997397283e-01   +3.578438094203821e-02   -4.471782692708849e-02   +5.046312860093288e-02   -9.295732027426024e-03   -3.939359174324967e-02; +4.348296672776123e-02   +1.569130802151016e-01   +7.338498245444471e-02   -1.247594122995010e-01   -3.649234353452390e-02   +1.479051756874663e-01   -3.464302130907551e-02   -2.263412945431095e-02   +1.218657604508904e-01   +1.134254695510538e-01   -1.097260611423021e-01   +1.039748446317481e-01   -2.339321226488014e-03   +1.400660609875984e-01   +1.129644356295656e-01   +1.621165287071981e-01; +6.997529467848043e-02   +5.883016848661261e-02   +1.617394215560622e-01   -5.015969001547561e-02   +1.895434112680208e-01   +8.092870085283391e-02   -1.840890641863983e-02   +4.201274662385304e-02   -1.138140653245675e-01   -5.677898584517508e-02   +4.199229086042829e-02   +7.199153490799054e-02   +1.127448574681165e-01   +1.006190984312568e-01   +4.781032819686420e-02   +1.902092841512409e-01; +1.513586145297103e-01   +5.812010382938752e-02   +5.449316742524878e-02   +1.342540935754870e-01   +2.765750251078472e-01   +1.130019405182415e-01   +1.645894383230038e-01   +2.397796494745188e-01   +4.874493461902240e-02   +5.522470951655241e-02   -5.669570593748029e-03   +2.049218103599672e-02   +2.633757866085643e-02   -5.000766735378753e-02   -1.508915356014619e-01   +2.654671628930326e-01; +1.900347416495490e-01   +1.132809882081119e-01   +1.579227829623736e-01   -1.549206760074402e-02   +2.891528671292925e-02   -3.506688614019724e-02   +2.161880742769529e-01   +1.542910291605569e-01   +1.085066021188168e-01   +1.200768495542150e-01   -4.740340536383982e-02   -8.817711107512000e-02   +3.542976562675649e-02   +2.532387150389964e-02   -4.428891272218097e-02   +4.249021722652601e-02; -9.133407874214684e-02   +8.284126831319391e-02   +2.111978122667397e-01   +1.486425434875552e-01   +1.210767028686691e-02   +1.661434412471779e-01   +9.522613745932770e-02   +1.189489192401656e-03   +8.021748365308165e-02   -4.394127095948160e-03   +1.341913079334187e-01   -1.987624765049129e-02   +1.308314358470452e-01   +1.175900493216429e-01   +6.580201889919648e-02   +1.168151780931960e-01; +1.089344201081709e-01   +1.663351251198599e-01   -8.763396498640568e-03   +1.192009036448488e-01   +2.070595465768132e-02   +1.942076511584835e-01   -1.498045657674651e-02   +4.568383543941921e-02   +1.271072539215627e-01   +1.808582633493987e-02   +8.117091341178817e-02   -2.394060655357659e-02   +5.286511607451830e-02   -1.005061703457092e-01   +2.132909279956296e-01   -4.214126513407153e-02; +3.082190509429505e-02   +1.179554122604274e-01   +1.221182840303003e-01   +1.924225110235854e-01   +1.146890950350224e-01   +2.324753904203891e-02   -8.336555417643041e-02   +2.171114491072323e-02   +8.072765538674531e-03   -1.030168830797268e-01   +1.809909568004850e-01   -1.936159220072620e-02   -1.785349094049006e-02   +1.546510478149966e-01   +2.762376216349752e-02   +2.920148375056364e-02; +1.825730659744566e-02   +8.656859140807860e-02   +8.323183540727830e-02   +7.575659642942568e-02   +1.040051068196223e-01   +1.422003333962198e-01   +7.812544471119258e-02   +1.012980358259837e-01   +6.971941034045676e-02   +1.482602803743861e-01   +1.140743127342093e-01   +1.881910336639183e-01   +4.560559006138337e-02   +1.922903416441710e-01   +1.900866827969068e-01   -2.961719537009948e-02; +1.052964038471623e-01   +2.115858063936076e-01   +2.584359357490338e-01   +3.052371595563402e-02   +1.148289271624159e-01   -7.095742121188589e-02   -1.606811725106812e-01   -1.719265007472751e-01   -1.137374158259005e-01   +7.675550649671527e-02   -1.085888656983440e-02   -6.977322630545030e-03   -6.552957257526246e-02   -8.851249545389253e-03   +1.397835106988805e-01   +1.953166763517143e-01; +1.312454713820614e-01   +6.671710828279526e-02   +1.158965389785252e-01   +2.387231412707860e-02   +1.681300512399951e-01   +2.365965961155299e-02   +3.562019027655065e-02   -8.231469067005295e-02   +2.735049405177077e-02   +2.052229151997579e-02   +1.883142387198393e-02   +3.575946209693336e-03   +6.345337173757698e-02   +3.321276448843213e-02   +5.138737557632486e-02   +3.044742593785891e-02; +5.882720446604216e-02   +2.037296342993766e-01   -8.112468587056641e-03   -5.140537361464483e-02   +4.035676613993550e-02   -1.502171213368075e-02   -2.927494230415013e-02   +6.385184074459221e-02   +6.855401750327414e-02   +8.464651223902577e-03   -2.439944091321165e-02   -1.108112693528041e-02   +9.438097761301398e-02   +1.502478217496028e-01   -5.483046852631976e-02   +2.233240348517267e-01];
L2I_L1I_iGABA_netcon = [+2.895163462947597e-01   +2.115777239301137e-02   -6.071940563202984e-02   +9.359477808391158e-02   +9.727798638894010e-02   +7.661730969357218e-02   -5.825380413455518e-03   +2.368620902156414e-01; +2.009486871079040e-01   +1.077553970061168e-02   +1.376783513761739e-01   +2.344392803283170e-01   +1.959435978121096e-02   +1.202484496676035e-01   +9.512004768945280e-03   +6.040713475967407e-02; -1.972429992623691e-02   +1.849985572172603e-01   -6.038716285660735e-02   +2.499362897729188e-01   -2.087414486500162e-02   -8.323861061044746e-02   +6.803847166199517e-02   +2.131488650669824e-02; +1.205001951606830e-01   +1.346440430580519e-01   +2.601055277444715e-02   +6.106725099254935e-02   +1.483076794588900e-01   +8.019325744398284e-02   +1.490521861483122e-01   +2.507979266852228e-02; +1.267622823091117e-01   +7.613974684540459e-02   -7.925619155218547e-02   +1.168924662689111e-01   +1.407196043462064e-01   +1.329726536455018e-01   -2.491174114073721e-02   +1.227057531345305e-01; +1.716280542477868e-01   +1.352856077949779e-02   +1.979017740121551e-01   -1.241444607017154e-01   -8.890112212298139e-02   +1.302012161485842e-02   +6.656820749576020e-02   +9.551408473739781e-03; -2.798683706079049e-03   -1.151435321685634e-01   +3.821402215362923e-02   +1.488156478484839e-02   +4.284762148597641e-02   +1.141447877658757e-01   +4.356460213973615e-02   +1.244564088419254e-01; +3.699683578408495e-02   -1.058071977102949e-02   +1.677366571141475e-01   +9.447142750888420e-02   +8.637758259316515e-02   +3.132806542651930e-02   +6.293758069527153e-03   +4.623511435175719e-02; +8.648824561327982e-02   +8.607550903369166e-02   +1.349361230039606e-02   +5.880707154364188e-02   +4.425874884192955e-02   +1.809456211482873e-01   -1.139417697346981e-01   -1.625196202410935e-02; +1.038327929232819e-01   +9.823869411759288e-02   +1.329739001479967e-01   +9.207005864660256e-02   -1.038439902552018e-02   +2.846894197086132e-01   +1.981716497693293e-01   +1.729135086847031e-01; +1.078064750133324e-02   +2.893153182146851e-02   +1.103549636996661e-01   +2.211241539926495e-01   -4.365978919962057e-02   +1.330379685631109e-01   +1.699554415144953e-01   -3.731081533950156e-02; +1.668218973445413e-01   +1.189063178655208e-01   +5.024635723060127e-02   +8.255577358229875e-02   +1.718309002279641e-01   +1.845255682481492e-01   +3.593805126848575e-02   +3.903402088014663e-02; +1.315806551887310e-01   +9.010287124402269e-03   +2.188058185406427e-01   +1.895320322766127e-01   +8.714210689669713e-02   +5.844049393340057e-02   -3.528731999933771e-02   +1.235913015626253e-02; -4.027689741426053e-03   +6.981439659455252e-02   +2.143870015178788e-01   -5.885132329936683e-02   -7.709013102986899e-02   +1.059716842474531e-01   +1.022758413730989e-01   +1.632246144243244e-01; +1.926565139845043e-01   +1.361250456160323e-01   -5.619216063037262e-02   +2.331743658064811e-02   -1.010888165881040e-01   -6.738246249889865e-02   +1.547348030885357e-01   +3.184141429688057e-02; +1.102959590688024e-01   +8.942971330696514e-02   +7.479531225254936e-02   -5.266995592820816e-02   +8.157782974474807e-02   +1.302766210604964e-01   +2.543315787831010e-02   +2.250583505130924e-01];
L1I_L2I_iGABA_netcon = [+1.264109863845626e-01   +2.748001816614241e-02   +7.106387861126465e-02   +1.571169107867939e-01   +1.653770248424678e-01   +1.117664869884583e-01   +1.020834031064513e-01   -2.999301775860637e-02   -2.293440309867717e-02   -4.575859070333411e-02   +9.714803754503125e-02   +1.179267628849229e-01   +2.066925293752696e-01   +1.777799562426954e-01   +6.437816014936132e-02   +2.091596697151293e-01; +1.174651789348546e-01   +2.388398355321021e-02   +3.707397202533685e-02   +2.073299159024039e-01   +1.769751423134560e-01   +2.612055776604218e-02   -1.366696933631907e-01   +2.290699101460320e-02   +1.421861450084739e-01   +1.461522693089422e-01   +4.100240603881918e-02   +5.397481098083126e-02   +1.123732234001726e-01   +3.605684568127570e-02   +1.176016909724982e-02   +1.316097709769386e-01; +4.108854084857530e-02   -2.404583767403531e-03   +1.602689017768713e-01   -1.380374198945693e-01   +1.710855589130624e-01   +2.012015650174761e-01   +2.779719523739994e-01   -5.529785471567493e-02   +5.728131436591974e-02   +7.047145372470748e-02   -2.022157309000615e-01   +2.555606241977469e-01   +7.423485165787586e-02   -7.857607805786798e-02   +1.782314607238685e-01   +8.894535821964832e-02; +6.205725242799560e-03   +1.485493623624778e-01   +2.383063519119348e-02   +1.807311200214444e-03   +5.277258089981645e-02   +2.482532585037620e-01   +1.315744579399344e-01   +5.391095172001439e-02   -5.517990161774478e-02   +5.430191145890451e-02   -3.333990640531413e-02   -4.001740406570722e-02   -3.895120288860195e-02   -1.041124548806238e-01   +1.076597633422330e-01   -6.350262879420916e-02; +9.785234296735217e-02   +9.998564353596825e-02   -6.061738326245281e-03   -9.137956905615129e-02   -2.148678220990664e-03   +1.749708074531848e-01   +9.335628524690337e-02   +2.241003900062244e-02   -1.293793341181633e-02   +6.000302649673037e-02   +9.772143363040300e-02   +8.807862560531508e-02   -1.767637800582800e-02   +1.298656476130377e-01   +3.977977932213040e-02   +3.141022586074120e-02; +2.720553037429082e-02   +6.304706633569239e-02   +1.349505724740152e-01   +9.885272226642697e-02   +1.037915880164823e-01   -4.539176010480812e-02   -9.643874456755007e-02   -3.786786065610197e-02   +2.035153528656727e-01   +2.476054550778342e-01   +1.181761032660659e-01   -5.251720288940091e-02   -3.550527995957410e-02   +1.628023463879741e-01   +1.355729842357181e-01   +6.917392257592598e-03; +6.879020885891647e-02   +2.589625625526279e-02   +4.540806458059443e-02   +1.642634543696638e-01   +7.294332946726680e-02   +3.266224111147335e-02   +1.419021761892059e-01   +1.269928703861112e-01   +6.339464821495233e-02   +1.586661171261145e-01   +1.868657361373758e-01   +5.257681883858828e-02   -4.973208209961126e-02   +6.841281450429863e-03   +1.668995153162708e-01   -8.793522640370648e-02; -8.964565038211091e-02   -8.180535619382440e-02   -2.700815282331875e-02   +8.428078968908408e-02   +1.015998597402666e-01   +1.275857097100307e-01   +1.126046419528643e-01   -5.455981486907044e-02   +1.073808923200777e-01   -6.267649168969575e-02   +5.771891318312376e-02   -1.495485114725756e-01   +6.123505769222554e-02   +4.434359448764084e-02   +1.860830800121338e-01   -4.748680957197458e-03];
L2E_L1E_iAMPA_netcon = [+8.166285364417339e-02   +1.847659194074077e-01   +1.144094954244214e-01   +1.151972073979187e-01   +8.784142469586698e-02   +2.867746364930624e-02   +1.103737327297802e-01   +8.482320358751944e-02; +1.041307365136420e-01   +2.081797588277809e-01   -6.631624971853012e-02   -3.900666260167216e-02   +1.951661086960229e-01   +2.193484513974411e-01   +8.359199657429370e-02   +4.673414286752883e-02; +1.137633904455738e-01   +1.716726621614343e-01   +1.636915424261023e-02   +9.302643026520920e-02   -3.261160881787736e-02   -4.281110686362512e-02   +2.890058904525556e-02   +1.287230261006744e-01; +1.677686643138019e-01   +1.133044031986901e-01   +2.677426418047532e-01   +8.880243495460985e-02   +1.822983337616855e-01   -8.947138216298564e-02   +8.031681369602048e-02   +5.407337602035007e-02; +3.966081180874864e-02   -9.863201532881960e-02   -5.576045302827977e-02   +1.135307286907405e-01   +2.926213895513421e-02   +1.326337128967407e-01   -1.472032885526786e-01   +2.753859624045251e-01; +7.232189062100877e-02   -6.471129926836525e-02   +6.971755451351649e-02   +6.749427963322888e-02   +1.273831337397918e-01   +1.985732048201025e-01   -4.389461905979376e-03   -7.577547933272905e-02; +8.710232609074493e-02   +7.978345615234199e-02   +6.351333103176177e-02   -3.310206234892390e-03   +1.150649220758244e-01   -1.260266734960703e-02   +1.233168506511488e-01   -2.087609446909668e-02; -1.288651017302594e-01   +1.736730297431601e-01   +4.450535013693618e-02   +1.523008069104900e-01   +9.468675159839104e-02   +2.170698899178119e-01   +9.855431602848054e-02   +2.418852716245693e-01; -5.821318906973572e-02   +1.356918483991003e-01   -8.994804216230870e-02   +6.712092058684380e-02   -9.438465132513632e-04   -3.560129836061646e-04   +2.205630829305693e-01   +7.724282426398088e-04; +8.983600120015085e-02   +7.080394868474792e-02   +2.484937169315813e-01   +1.157592916140885e-01   +1.655583943167361e-01   +1.980578588872951e-01   +8.163964927346667e-02   -1.429221406387161e-01; -4.749231761095776e-03   +1.694148656890990e-01   +1.659447667111417e-01   -7.734416341231429e-02   +1.821552473357539e-01   -5.020443369039651e-02   +2.350137650988646e-01   -1.079529182309413e-02; +1.466859924324760e-01   +6.689133111269549e-02   -1.801718888764810e-02   +8.553793494454438e-02   +9.169440165831715e-02   +1.550874803119063e-01   +4.255353414433521e-02   +2.704802759104792e-02; -8.043202729412333e-02   +4.228441183403825e-02   -9.212723261213562e-02   +8.287093427169433e-02   +1.101555677321564e-01   +8.659292821859448e-02   +6.749435238526705e-02   -6.237388845679177e-02; +1.911410495836631e-01   +4.538640044844886e-02   +6.192841410477056e-02   +2.405833359212401e-02   -7.443663625951041e-02   +1.259990882575472e-01   +1.124878641046196e-01   +1.581385240272495e-01; +5.312915296610726e-02   +9.536345471664306e-02   -9.399375382626886e-02   +1.708289461708095e-01   +3.924124375064690e-02   +1.744096078280362e-03   +4.481811349051770e-02   +7.812110476170241e-02; +1.195941197001204e-02   +1.018618598909105e-01   -7.392326253769371e-03   -5.724800302410607e-02   -5.637381733940888e-02   -8.642596854269997e-03   +6.196347860554979e-02   +2.060967043980863e-01];
L1E_L2E_iAMPA_netcon = [-2.324841857435629e-01   +1.766832639769707e-02   +2.664373900455110e-02   +6.763325724212835e-02   +2.842411077768451e-02   +1.529508011949188e-01   -1.103478594079784e-02   +1.861421635364361e-01   +1.096329218537201e-01   +2.670538008206588e-02   +1.380956821072675e-01   +1.273747595232868e-01   +1.536751303489792e-01   +7.236953077165473e-02   +9.980185917202120e-02   +7.258354474471398e-02; +2.976451321699742e-01   +5.227693912570038e-02   +5.647889607691810e-03   +4.704895455545540e-02   +1.565623650255236e-01   +6.735531767604647e-02   +2.636253012122726e-01   +3.669235839234959e-02   +1.096826513581756e-03   +5.935328134751605e-02   -9.763752902504789e-02   +5.803670430217966e-02   +2.078974165854500e-01   +2.465468961873346e-01   +2.330892300566153e-01   +4.899918796643064e-02; +2.604813523135561e-02   -2.060349385838737e-02   +1.878105575611427e-01   +1.014641211896185e-01   +1.766030561826937e-01   -1.184765354979063e-01   -5.337400375105016e-03   -1.401771321858535e-02   +4.169388890204410e-02   +9.138446822936677e-02   +5.096916576815579e-02   -2.641438566239842e-02   +1.551768507584208e-02   -7.221656098265275e-02   +3.934769655244118e-02   +1.474757973291068e-01; -6.183711080634799e-03   +3.448468939970718e-02   +6.940620428747647e-02   +1.329368164548940e-01   +1.103677671688183e-01   -4.917601290230281e-02   +2.127930131181142e-01   +1.026557068376800e-01   -8.107242381784799e-02   -7.933334111582635e-02   +1.645754344384541e-01   +6.705116477207197e-02   -1.040521708370567e-02   +6.138599802281772e-03   +1.248519896567331e-01   +2.644205460801563e-01; +4.414661964942661e-02   +3.483757731963023e-01   -8.430124903362639e-02   -7.366552309559150e-02   +4.850109194589974e-02   -7.828822476406337e-02   +5.219607893787710e-02   +2.988329208657178e-01   +5.598859318443443e-02   +1.344189086179722e-01   -3.391035239483836e-03   -4.978107560477416e-02   +1.829770871142120e-01   +1.907614423088476e-03   +8.830774711082856e-02   +2.908312059899838e-01; +1.478461530268598e-01   +1.672327774086463e-01   +1.626455921698057e-01   +2.759420075089735e-02   -3.357519057038934e-02   -6.525687057509257e-02   +2.759077537944205e-01   +3.055640393356856e-01   +1.841227326599219e-02   -4.890031752171557e-02   +3.310280589271785e-02   -4.358487491522516e-02   -3.938287408296570e-02   -8.723974523931426e-02   +6.668251934032908e-02   -8.206859809133704e-02; +2.613618164594729e-01   -7.237120112561272e-03   +1.403686083140859e-01   +8.287818176390563e-02   +2.005129942611966e-01   +1.285053004977220e-01   +2.119643740610871e-01   +2.664546620099035e-03   +4.771505419280834e-02   +6.777313172113424e-02   +4.020039229112086e-02   -6.119429605387795e-02   +2.857101600118675e-01   +3.507985615097073e-02   +1.766314373108352e-01   -6.344526465996295e-02; +2.940309298250443e-01   -3.428604288679245e-02   +2.664711524674085e-02   -4.109360991604068e-02   -7.798193815283828e-03   +7.721236939275425e-03   +9.619882350721715e-02   +9.210117235240003e-02   +4.046476145876605e-02   -2.993328515038002e-02   +5.512896034788156e-02   +1.919716366619616e-02   +9.005330503620509e-02   -1.140835081130375e-02   -5.764705603985064e-02   +1.494955589569164e-01];
L2I_L2E_iAMPA_netcon = [+2.047048556410217e-01   -6.200615688875010e-03   +8.914842158762497e-02   +2.803263426258459e-02   +9.766726252519836e-02   +1.622964328277913e-01   -3.948322238441308e-02   +1.020038967612420e-01; -6.869789344058677e-02   +1.214823947009825e-01   +1.303392623496009e-01   -3.539081341185443e-02   +1.048924535324944e-02   +3.116038982907655e-03   +1.115752383845944e-01   +5.744123520853223e-02; +8.309232629039850e-02   +8.051712539211876e-02   +4.968064207888180e-02   -7.125196259673850e-03   +1.743521246948262e-02   +1.074610699558952e-01   +3.040267099134832e-02   +5.135198541704335e-03; -5.541422891409062e-04   +4.274203185950751e-02   +1.091367610976336e-01   +7.309522576021044e-02   +1.212460837374185e-02   +2.323832256600183e-02   +4.589483739761281e-02   +6.439469935422060e-02; +1.177683293678781e-01   +7.161112870697456e-03   +3.580333780346536e-02   +3.713061024355246e-02   +6.788168130407370e-03   +7.443628197160021e-02   +1.160417296935369e-01   -2.672110592834120e-02; +2.464810797224921e-01   -1.679539409896169e-02   +1.606592535193033e-01   +9.577644605427370e-04   +7.995057190702305e-02   +2.543133296766856e-02   +1.592886377022123e-01   +1.601773544463874e-01; -1.375681463386735e-03   -7.215577586235036e-02   +2.062540886231407e-01   +4.535490239036899e-02   +9.484830938159382e-02   -3.257448762051211e-02   +6.514640261190513e-02   +7.204066283946303e-02; +1.569459910589465e-01   +2.410071369285955e-01   +1.896762532374817e-02   +2.023730764482123e-01   +2.112189449655928e-01   +1.157111998510232e-01   +9.769837908477233e-02   +7.066462482174293e-02];
L2E_L2I_iGABA_netcon = [+1.129250425518161e-01   +1.242722067386421e-03   +5.962938563383387e-02   -1.801556022728423e-02   +6.481205588844260e-02   -8.324696993003217e-02   +1.153200225168316e-01   +1.537994728402726e-01; -6.483217290388234e-02   +7.491177946893539e-02   +1.063973937425396e-01   +1.184350789673267e-01   +8.993357520256103e-03   -6.383543410033071e-02   -2.787216274654816e-02   +2.966869058418946e-01; +2.166899863767291e-01   +2.738030382139878e-03   -1.532726048775695e-02   +1.153168423854868e-01   +2.264393587158566e-01   +7.239509937658864e-02   -8.616974019944585e-03   +1.026220780102385e-01; -5.185394002537543e-02   -2.814716315469887e-02   +2.919964772783629e-01   -1.280978021254811e-02   +7.009333134654212e-02   +1.232402370904723e-01   -1.313196829153897e-01   +1.534004401729404e-01; +2.603117640063676e-02   +5.372328854919069e-02   +3.067922931952414e-01   +4.902473843808679e-02   +1.458358698884930e-01   -1.233995531381651e-01   +6.945826282187406e-02   +7.598272171528127e-02; +1.192035396058169e-01   -1.583487755556573e-02   +1.514156668258176e-01   +1.289332897455199e-01   -8.778107256080848e-02   +5.043504912929780e-02   -5.728890460594050e-02   +1.993612090794519e-01; +1.793180688298901e-02   +1.236165213146089e-01   +2.527429782564726e-01   +7.071075638380483e-02   +3.011768869810471e-02   -2.389672324677657e-02   +8.439778797060207e-02   +1.427088543570201e-01; +1.667282789921034e-01   -7.478858913396441e-02   -3.472112978886988e-02   +1.231009452613849e-01   +6.458871997893391e-03   +9.858754521604808e-02   -5.710834620876809e-02   +1.414274080943603e-02];
L3E_L2E_iAMPA_netcon = [+1.293962763155351e-01   +1.042602276307504e-01   +1.101425417681566e-01   +1.519279059974479e-01   +1.003608933655468e-01   +4.384964392768419e-02   -6.705768915009097e-03   +1.263887616790661e-01   +7.085902065685662e-02   +1.201296469010003e-01   -2.389394866661732e-03   -3.389736687903293e-02; +7.764836358144976e-02   +7.329096730248827e-03   +2.376957729625905e-01   -7.964552381105477e-02   -1.678262442583077e-02   +2.783168453368088e-02   +1.255385217451378e-01   +1.280938008322852e-01   +1.930356437182746e-01   +1.208481243695090e-01   +1.015240576313383e-01   +2.024084521484543e-01; -1.159873467095571e-02   +2.550499112163808e-02   -2.294736720444953e-02   +3.359691557432351e-02   +7.212031376244735e-02   -2.373488634034886e-02   +7.889904156622293e-02   +1.615196046035473e-01   +1.048038858748118e-01   +1.172734709125237e-01   +2.624951658363466e-01   -1.227083515915686e-01; +7.493912969318169e-02   +2.061872773990720e-01   -5.026945810191656e-02   +3.646660570171290e-02   +1.597566159076972e-01   +2.231037400819740e-01   +6.014230085946794e-02   -6.854258504159236e-02   -3.784063447169794e-02   +3.559329085677450e-02   +2.826726385340141e-03   +1.274893206409269e-01; +1.204987052724049e-01   +4.588553229856888e-02   +5.383103129460878e-02   +8.626087759121834e-02   +2.146675956835294e-01   -1.155786839447675e-01   +5.586588075671685e-02   -5.055792070594121e-02   +1.355978777328667e-01   +1.607619097895234e-01   -3.103542254423502e-02   -4.266742872773407e-02; +1.653884573905940e-01   +5.956026026047146e-02   +3.656101487782237e-02   +5.711930809596804e-02   +3.966254771958828e-02   +1.867925941764623e-01   +7.283476948220208e-02   +5.777846910206055e-02   +1.883330771863426e-01   +7.456899664383516e-02   -4.606587258137419e-02   +8.989451475749285e-02; +1.719310453558772e-01   +6.168914853240547e-02   -3.614244482204945e-02   +1.831294143396579e-01   +2.762315380276846e-01   +1.099334487352285e-01   +1.636408096866410e-03   +6.787147660467482e-02   +1.474295323025473e-01   +6.961881761091582e-02   +1.803945003588144e-01   -5.552954789737024e-02; +1.283748072830198e-01   +1.122462715544361e-01   +2.582653045844231e-01   -5.553334689953185e-03   -1.176145030910949e-01   +1.615570966472623e-01   -1.528296123036718e-01   +2.976644749868259e-02   +1.075337526910049e-01   -1.604782537534450e-02   -3.452282458232806e-02   +4.795148816401685e-02];
L3I_L2I_iGABA_netcon = [-6.775055013045693e-02   +1.426397125248577e-01   +1.442495049198148e-01   +6.240497725798323e-02   +6.052111259820493e-02   -4.703978036604044e-02   -4.716560488224598e-02   +2.350396637301479e-01   +2.485665997023920e-01   -1.280000587742122e-01   +2.361005849412917e-02   +4.478566759398482e-02; +1.657983442810846e-02   +2.284603009949186e-01   +1.986626094545195e-01   +7.379169670232266e-02   -1.793762141041913e-02   +3.236300832093370e-01   -6.943400290755844e-02   +1.381740370418291e-02   +1.494446732209060e-01   +1.047488532885493e-01   -1.360951443237534e-02   +1.764774633441968e-01; -5.797875474868290e-02   +6.331134274553606e-02   +2.528958069854806e-01   +2.217316919069178e-01   +1.393340733087292e-02   +1.440104889703306e-01   +1.519180172320247e-01   +1.352241612250438e-01   +1.407755055583170e-01   -4.642703640780242e-02   +1.999536467189874e-01   -3.522044747087549e-02; +1.523119300941402e-02   +3.398190265364658e-02   +4.885634222180370e-02   -2.608256179365671e-01   +9.808875376653667e-02   +2.277269627028267e-01   +2.086165879792083e-01   +1.938114065100708e-01   -5.968809459623984e-02   +1.174614877141711e-01   +2.098015093383168e-01   +1.472778574181042e-01; -4.203627356247710e-02   +2.684236265849812e-02   -2.123370324124687e-02   +1.217880381095284e-01   +3.115472474860252e-02   +7.839290157622907e-03   +5.544901003862184e-02   +1.340548551234720e-01   +4.033485425606188e-02   +6.987359641125732e-02   +2.181027327916293e-01   -7.570098670060164e-02; +2.083648725877593e-02   -1.079132368941159e-01   +8.980591902686202e-02   -4.767967479016697e-02   +8.341405208152665e-02   +1.813961188258583e-01   +5.197541145418921e-02   +1.908440082578167e-01   -4.824933117423182e-02   +1.223122908144399e-01   +4.548668375387355e-02   +8.607555224628485e-02; +2.694862776927986e-01   +4.145132110943611e-03   -5.978385793208907e-02   +3.230540327446789e-01   -1.595814258910819e-01   +1.748265967088334e-01   -9.685643898177197e-02   -2.861878752755870e-02   +6.308405912175857e-02   +4.390295558573135e-02   -4.084496401136117e-03   +1.193620472676641e-01; +5.879202390770430e-03   +7.735174525741903e-02   +7.082538077103546e-02   -1.866776674368704e-02   -1.404718963872575e-02   +4.763597378684982e-02   +3.262020652794205e-02   +8.666990784631380e-03   -1.076131607994387e-02   +2.253246575317844e-01   +9.569993118197796e-02   +1.137666790902315e-01];
L2E_L3E_iAMPA_netcon = [+1.479866876372724e-01   +1.823647741663071e-01   +2.746990614959598e-02   +2.145682297774976e-01   -5.701728626022451e-02   +1.260366844410958e-01   +5.021545046243601e-02   -6.942095147742579e-02; -1.137209613035688e-01   +1.961344725530467e-02   +1.757961031841278e-01   +1.372485664403064e-01   +1.354116063137207e-01   +1.432243740956602e-01   -3.638147287885100e-02   +4.182704830782174e-02; -1.277849462393467e-02   -3.900262041818534e-02   +1.921725219702204e-01   +6.587082467209914e-03   +1.181564341025065e-01   +9.781515234318524e-03   +1.614836019873389e-01   +4.152871669780345e-02; +6.394227793163991e-02   +6.423014299723033e-02   +6.515075373352583e-02   +2.288429582755119e-02   +2.926081532513848e-02   +1.742652286579598e-01   +1.843231628144155e-01   +1.762771734394336e-01; +1.749074736706293e-01   +1.317957952625732e-01   -1.421846731566700e-02   +1.402295945335346e-01   +6.853375179312307e-02   +1.486166469835716e-01   +3.269230134901781e-02   -5.895083180567293e-03; +1.662768270686076e-02   +1.662355199658755e-01   -5.239289818390794e-03   -7.546457729791461e-02   +3.340873863921710e-02   +1.705397017363974e-01   -2.269642659744668e-02   +4.850426377616554e-02; +1.512761642261275e-02   +1.170561539540717e-01   +1.887873986143876e-01   +3.830808514534353e-02   +8.183013125002522e-02   +6.963233194864395e-02   +1.132103722950465e-01   +1.453837180899893e-01; +1.247454590172574e-01   -1.612956998156287e-01   +2.097321756812778e-03   +1.709396098097150e-02   -4.401806171957423e-02   +8.200375215331307e-02   +1.089381405302177e-01   +3.643145777114304e-03; +1.174299659349173e-01   +1.165678948167765e-01   +1.292086825761791e-01   +1.296611348556825e-01   +6.796312685157563e-02   +9.417322288433767e-03   +4.718918776034652e-02   +2.404341252715516e-02; +1.105011983666207e-01   +1.010027441370658e-01   +5.134095711408988e-02   +2.698333018780573e-01   +6.411891499504273e-02   +8.915123418911255e-02   +2.287853604424910e-01   +2.098230259336280e-01; +1.469215495327803e-01   +5.837726661425681e-02   +1.228415056114682e-01   +1.533313281142864e-01   +1.406089938070679e-01   -7.626821662289018e-02   +4.063421289964265e-02   +5.081681804561176e-02; +1.483736856657394e-01   +1.013447826529140e-02   +1.587788679209769e-01   -9.492809669386984e-02   -1.421283463029459e-01   +1.343350634907521e-02   +1.819588758378385e-01   +6.246272809384143e-02];
L2I_L3I_iGABA_netcon = [+6.262575073052989e-02   +2.040987972968094e-01   +1.405514358018979e-01   +1.412755675343580e-01   +1.736565784380429e-01   -1.037270398754762e-01   +4.608971721867103e-02   +1.766278416973839e-01; +1.494406684253237e-01   +3.111755145181317e-01   -7.804357639075762e-03   +4.969477479528076e-02   +1.760531321313190e-01   +1.081941730993123e-01   -2.294839036400435e-02   +1.998828838999584e-01; +2.787077135350188e-04   +4.169962195506992e-03   +3.504473158955228e-02   +1.150332668458330e-01   +1.747098314078789e-01   +2.171686495882570e-01   -1.396793599994751e-02   +4.156713176491757e-02; -1.123326715468347e-01   +1.377207865297510e-01   -3.556808382324015e-02   +1.636069317673826e-01   +1.579937502975955e-01   +1.501908991906059e-01   +1.393163383490862e-01   +2.427025296755745e-01; -3.984773458693925e-02   +6.708520361669769e-02   +1.864907536283745e-01   -3.671461489001548e-03   -6.912847087844537e-03   +7.822431277551418e-02   +1.162274876984926e-01   +1.471550702226893e-01; -9.187398912359618e-04   -1.038653537143945e-01   -8.520511996449345e-02   +3.057058858897559e-02   +2.086102778577592e-01   +9.374724751530754e-02   +1.960977707545219e-02   +4.092264540889823e-02; -6.332115602013365e-02   -1.272100992842723e-01   +2.099849349476824e-01   +1.559853419249131e-01   -9.827942106633181e-02   +3.837284432096246e-02   +1.910018633485931e-01   +1.046624708747865e-01; -5.659919199669780e-03   +1.481113777550129e-01   +1.845516495254878e-01   -1.064836895992048e-02   -3.776723549763482e-02   +2.049224457630703e-01   +3.165552155630895e-02   +2.046836215058418e-01; +1.539618405976052e-01   +1.896395923259254e-01   -5.676577570006065e-03   -4.643240403553183e-02   +7.741988839957284e-02   -4.092495506563806e-02   +6.977647653499500e-02   +1.754973678763374e-01; +5.436842263672649e-02   +1.155069372523727e-01   +8.695994620497285e-02   +1.035469295583233e-01   +1.285935099948840e-02   -2.113473252506514e-02   +7.444529290718509e-02   +2.700368431301038e-01; +1.930919885048994e-01   -1.727952924989163e-02   +8.774443751602684e-02   -3.668433219423932e-02   +1.410442025698949e-01   +5.681398956626858e-02   -5.357088819585222e-02   +1.022637798800943e-01; +5.275537641279127e-02   -5.391450745918044e-02   +3.835116709656210e-02   +2.021384210739393e-01   +1.158330055176125e-01   +1.376435762170490e-01   +3.943211986703766e-02   +1.649306285426890e-01];
L3I_L3E_iAMPA_netcon = [+1.779211059285575e-01   +2.680852585722047e-02   +8.047247850164557e-02   -2.519434720510282e-02   +5.957067794849377e-02   +1.022184608047200e-01   +5.633054915293405e-03   -1.589787249395595e-02   +1.514786052723956e-01   -8.377208301499582e-02   -3.798449162391138e-02   +2.344175542632097e-02; +1.279905547364405e-02   -6.093862505286243e-02   +4.286953696913032e-02   +1.565874447028622e-01   -1.179188941453981e-01   -1.222328841767370e-01   +9.121961305068460e-02   +7.166614367676996e-02   +1.136876056482772e-01   +7.021480882019166e-03   +7.933552546942527e-02   -2.576996653486736e-02; +1.535292946835461e-01   +1.897389270212959e-01   +9.202706484138078e-02   -8.352289621409499e-03   +4.974863312679971e-02   +8.063773418500754e-02   +2.356416311820948e-01   -7.696040224718266e-03   -1.952653561025905e-02   +5.268341803084258e-03   +1.944667941058481e-01   +1.384303781018072e-01; +1.834963668520086e-01   +2.495965109083902e-02   +5.459450476242590e-02   +5.938610849506816e-02   +3.048886674842761e-02   +1.108159937487945e-01   -6.635176664628498e-02   +1.069219496051760e-01   +3.041879183759045e-01   +2.484572557361880e-02   +1.737689669167144e-01   +4.504567596978134e-02; +2.254306964950389e-01   -1.909519636331875e-02   +3.821595024089196e-02   +8.070006266696640e-02   +6.600355221802912e-02   -1.579327641203465e-02   +1.736455998849693e-01   +7.034552366406571e-02   +1.206719342119610e-01   -9.135487908665722e-02   +2.308667707032796e-02   +1.980714450434295e-01; -1.567906543862824e-01   +7.459269819026111e-02   +1.156063217357124e-01   +1.684800413301407e-01   -2.281627754118749e-02   -5.664245707898313e-02   +4.195454974971614e-02   +1.392607977925188e-01   -2.491888126830817e-02   -3.414859288032762e-02   +1.365382176434828e-01   +1.682302426154843e-02; +1.884403404496118e-01   +2.654508164425955e-01   +1.653976702388624e-01   +1.410201683798789e-01   +2.150152140423614e-02   -7.521964309362441e-03   +9.063008267359624e-02   +6.948821212541190e-02   +9.756320417399189e-02   +7.422015954107340e-02   +6.034139269570162e-02   -3.489348105726078e-02; +2.082148218476168e-01   +6.322024859381398e-02   +7.634237811146601e-02   -3.170548744001234e-02   +1.017155607829205e-01   +2.470382014710546e-01   +8.300893554616912e-02   +1.343288325423533e-01   +2.557840989670608e-02   -8.141996145187826e-02   +8.379801258942479e-02   +1.271717338219701e-01; +1.266420212873446e-01   +3.122465962981219e-02   +1.875325829302186e-01   -5.029192727724329e-03   +3.636284405890318e-02   -7.837163133397200e-02   +3.522923742365451e-01   +1.720657429878716e-01   -5.353057760657258e-02   +1.573884294116585e-01   +4.897614798473351e-02   +1.430975809310019e-01; -3.850256555981045e-02   -3.884752782843769e-03   +1.809922041293518e-01   +3.307424038021154e-02   +1.460297738367634e-01   -1.082972865305057e-01   +2.671490694551368e-01   +1.982865967133026e-01   +4.337529410993013e-03   -1.216640798301266e-01   -2.708378362879657e-02   -6.520569649149917e-02; -3.661194306805407e-03   +1.453718368819067e-01   -1.166126846530328e-01   -2.196662717305085e-03   +5.646688388163677e-02   -1.994875586936234e-01   +1.209661235266169e-01   -1.391255009230801e-02   -3.076202385224984e-02   -6.046855952359474e-02   +4.905341261305828e-02   +2.632062712758897e-01; +1.376490803422313e-01   -6.003416335006610e-02   +8.372220866150989e-02   +5.520165960952819e-02   +1.642348595515931e-01   +4.821992780042243e-02   -1.981115200716709e-02   -1.729062155226019e-02   +6.201580415421938e-03   +3.141744468563384e-02   -9.305072091524749e-02   +1.675007438220001e-01];
L3E_L3I_iGABA_netcon = [+9.762301217898227e-02   -1.349709839426220e-01   -2.594699858586669e-02   +1.782288373951600e-01   -1.319628412636442e-03   +1.205787420373184e-01   +2.304641525581144e-01   -1.159560927992986e-01   -1.354787038112057e-01   +7.190290898894794e-02   +4.839182669612582e-02   -1.291562309547009e-01; +1.543663763154432e-01   +1.265119718575838e-01   +1.522731025564290e-02   +1.877137368428668e-01   +1.472213585748350e-01   -2.345496849539594e-03   +1.408706845763976e-01   -2.073952955700596e-03   +1.139228865750336e-01   +4.790499439268565e-02   +1.321022316820997e-01   +1.080227129135630e-01; +1.196052681227628e-01   +1.672293421354656e-01   +2.045992219528157e-01   -2.559060531026639e-02   -4.351434291726702e-02   -4.913247460868900e-02   +1.580208250220562e-01   +2.317843678666992e-01   +1.129452678034236e-01   +9.501760504770616e-02   +9.521602939273888e-02   +1.193475853709118e-01; +1.250785263080516e-01   +6.489669622375638e-02   +5.654158075481772e-02   -7.183846678390160e-02   -5.472393757911044e-02   +8.576073819107859e-02   +2.536678246932038e-03   +7.958925726826993e-02   +1.318364598235593e-01   +1.303687883301345e-01   -5.216049258277856e-02   -7.601520571779319e-02; +7.407408382987253e-02   +1.965479657758272e-01   -2.222502983192177e-02   +6.025730869709735e-02   -1.970847619467135e-02   +1.417392214090697e-01   +8.586615595527516e-02   +1.260336590314772e-01   +8.907883939504206e-02   +9.494784651616089e-02   -5.577911916548716e-02   -7.313138043725544e-02; +2.815634682930473e-02   -3.869982124108055e-02   -2.602809794889237e-02   +6.666726542517443e-02   -1.227757246601638e-01   +1.427909042370513e-01   +1.477196877883440e-01   +1.427819438820425e-01   +1.680033729794254e-01   +1.995071905366617e-01   +1.857595232598013e-01   +4.632669836860031e-02; +1.007667189356506e-01   -4.964081910454267e-02   -1.829110892255633e-02   -6.512007214358954e-03   +2.618701243274214e-03   +1.052109768761819e-01   +1.641355393790999e-01   -7.778602433502957e-02   +1.909562220786910e-01   +2.390644090435674e-02   +1.464854812552510e-01   +1.363026974685232e-01; +5.148218981657735e-02   +2.050122701307250e-01   +1.524296383262551e-01   +2.956472985142132e-02   +9.143750750499871e-02   +2.120191150300091e-01   +1.216718120955324e-02   +1.998317765130402e-01   +1.592408936207312e-01   +3.834787774581924e-02   +1.258862572895122e-01   -8.131094471420502e-04; +7.819499003794098e-02   +8.107399117478956e-02   +5.380236146162709e-02   +1.472029824812522e-01   -2.051241904734099e-02   +9.739195282943575e-02   -6.758585858598251e-02   -1.371666029911642e-01   +1.361486056874370e-01   +2.398005165003893e-01   -8.843777552770571e-02   +8.352907148280969e-02; -6.094917026055140e-02   +4.828882690473846e-02   +1.196751140171637e-01   +9.461619841100064e-03   -7.071528197991339e-03   -9.005587805352263e-03   +1.119666493267032e-01   -3.692588273758855e-02   -1.096527933387943e-01   +7.623813107271060e-02   -4.970288469644709e-03   -4.970137890001738e-02; +3.656645414218788e-02   +1.079361998281130e-01   +8.784068637538202e-04   +1.738018082058332e-01   +2.436012544305559e-01   -2.625114564135096e-02   +1.392303141663855e-01   +1.616759679254211e-02   +1.952201565255186e-02   +1.841647308959537e-01   -3.255544857823785e-02   +2.731657026554400e-02; +9.588250114866365e-02   +1.277243691917074e-01   +1.062214089836961e-01   +8.109006869606772e-02   -2.639048618309214e-02   -1.389866893374838e-01   +4.641927605836539e-02   -9.717741890487420e-02   +1.763857925390696e-01   +8.141374973611056e-03   -8.574245423361200e-02   +4.885081953379281e-02];
L2E_Input1_iAMPA_netcon = [+1.712535760568636e-01   -1.844132345112581e-02   +9.639690311451188e-02   +8.823930972262028e-03   +3.556571099054556e-02   +2.330324067906925e-01   +6.060088760019345e-02   +4.078683437889960e-03];
L2I_Input2_iAMPA_netcon = [-5.161009818321649e-03   +1.518685973744952e-01   -2.355154203952886e-02   +2.695051397233883e-03   +6.530876086733622e-02   +2.634771816890053e-01   -3.751500147250562e-02   -8.068826257472872e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.3*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.9 + 0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.3*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*1.0 + 0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.3*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*1.0 + 0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.3*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.9 + 0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.3*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*1.0 + 0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.3*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*1.0 + 0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
