function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.618572365702753e-01   +7.477279004493884e-01   +8.572699700180187e-01   +2.244364423982196e-01   +2.436001030187724e-01   +6.752928705532039e-01   -8.082355538142552e-02   +3.802360179661119e-01   +2.243097789927304e-01   +1.628738678338872e-01   +3.786729400332779e-01   +2.007491373313711e-01   +4.738543729935122e-01   +2.814871333423398e-01   +2.536494444406356e-01   +2.884325991381479e-02; +7.546815170655438e-02   +8.768535286066509e-01   +7.900706527428077e-01   +7.155030785555567e-01   +2.831437984434892e-01   +6.816965326870422e-01   +6.843561446225539e-01   +1.946181080740120e-01   +1.263954778246386e-01   +7.399428006874509e-01   +5.625185801981738e-01   +5.992093006183621e-01   +3.768726620069046e-01   +2.450954417081635e-01   +6.102022780508815e-01   +2.484863889675375e-01; +2.131255281450391e-01   +3.079427396988081e-01   +4.161084507805908e-01   +4.788359953633348e-01   +6.004753136196279e-01   +4.343136889197002e-01   +1.312203260384085e-02   +6.283040098593731e-01   +3.132003333384506e-01   +5.141903703795523e-01   +7.544684420968620e-01   +2.315578331421309e-01   +4.015415157759487e-01   -3.214497684068305e-02   +3.378744582072937e-01   +8.857400505104452e-01; +2.095656627681565e-01   +5.891285096543288e-01   +8.209629561370503e-02   +2.324731590726823e-01   +7.900384617964967e-01   +7.943185716310754e-01   +2.132373193302774e-01   +5.660391371075565e-01   +6.571909209930009e-01   +2.259182034692403e-02   +1.854250909527196e-01   +7.825515272586441e-01   +4.729673189485606e-01   +1.918164488734277e-01   +5.541070765368801e-01   +4.477693689085151e-01; +7.793076968311005e-02   +6.701536075516813e-01   +7.729131305622149e-01   +7.342673730732902e-01   +4.838148567524783e-01   +3.188913195345323e-01   +4.594843955334110e-01   +3.060283200245426e-01   +3.366543818255313e-01   +4.680612957421436e-01   +2.017097630905201e-01   +6.480639836698563e-01   +3.625464830755966e-01   +7.647397629558585e-01   +2.183770169209953e-01   +8.338420947844444e-01; +1.554570885680963e-01   +1.683748805051704e-01   +6.768962222829673e-01   +7.528639693686622e-01   +5.604725447886004e-01   +8.227189048143217e-01   +2.901475192978206e-01   +4.012707488215654e-01   +7.987417127933085e-01   +8.707980535902617e-01   +8.032587687325590e-01   +1.360725968558730e-01   +4.183190058472232e-01   +1.525624573754382e-01   +8.360073949449662e-01   +3.717216357875167e-01; +3.312171580001729e-01   +6.530666344145396e-01   +5.668130575077718e-02   +3.509310727611556e-01   +7.577014725646281e-01   +5.152092030688545e-01   +4.349635047275544e-01   +5.381108313562812e-01   +8.520093609521949e-01   +8.505618257275824e-01   +6.173642550985567e-01   +1.136355786720720e-01   +3.194062328505216e-01   +3.805552289867037e-01   +6.534921381977440e-01   +8.240630638018734e-01; +6.257004939840515e-01   +6.995205134341855e-01   +7.165936440017613e-01   +3.271831801446906e-01   +5.850572875955273e-01   +5.332712777635730e-01   +8.346080872129212e-02   +4.067551436663118e-01   +1.000000000000000e+00   +8.000477960207826e-01   +1.385342337877466e-02   +6.890635258777531e-01   +7.505783244796124e-01   +5.510943181467418e-01   +2.431736581663671e-01   +8.006096368016327e-01; +4.438689854026310e-01   +2.466397092746215e-02   +2.189392609589671e-01   +4.793798978540733e-02   +4.185077300834231e-01   +1.512559788057378e-01   +4.680770445463595e-02   +5.209498737714858e-01   +4.544972923892535e-01   +7.371645867263809e-01   +7.366842280287150e-01   +4.507229548570708e-01   +2.282212444139179e-01   +1.943780172472133e-01   +8.994699623946329e-01   +7.749819246991185e-01; +6.301267317961347e-01   +4.900516140711886e-01   +5.486107748384429e-01   +2.385250751028846e-01   +4.352516849911199e-01   +2.606047559091214e-01   +1.981207919097402e-02   +2.102160132485562e-01   +7.811184330901112e-02   +7.255436818071259e-01   +1.488914175235316e-02   +8.987197500106123e-02   +3.141771162768872e-01   +7.349799794839226e-01   +2.963049511265463e-01   +6.851957088315481e-01; +3.402123392953506e-01   +4.940847717831332e-02   -2.900461542085119e-02   +1.754694017219332e-01   +8.301212243923318e-01   +5.765785371033495e-01   +2.024709602685234e-01   +1.714794176361763e-01   +1.756767164804540e-01   +8.367304689095429e-01   +1.214775920810973e-01   +7.103224545395761e-01   +5.318593299188298e-01   +7.494206655061246e-01   -2.972593436173727e-02   +7.036028860683420e-02; +1.412081855376829e-01   +7.908220881955561e-03   +8.647788305940040e-01   +4.585825376180058e-01   +6.369686590922978e-01   +4.894802274980982e-01   +6.598066860945635e-01   +3.426608982027465e-01   +6.263892186368972e-01   +9.162736376385311e-02   +2.563924488801762e-01   +7.601000729215326e-01   +2.979274402037024e-02   +5.262873752535588e-01   +3.677557700127905e-01   +5.434513105626214e-02; +4.003454480603350e-01   +3.016261612584988e-01   +6.001827679918375e-01   +2.263342002187202e-01   +6.019999063359970e-02   +4.443661071291660e-01   +3.762022975490903e-01   +6.676327275260524e-01   +2.813954114337703e-01   +8.837852029893135e-01   +1.787786416698866e-01   +4.467540528748965e-01   +2.014179591965811e-01   +2.416010885687468e-01   +2.981634822978668e-01   +1.935193381753788e-01; +1.621575689353197e-01   +8.437718955625944e-01   +6.592780348610788e-01   +6.695738961636980e-01   +7.345514722574049e-01   +5.569508372042447e-01   +2.379240772544713e-01   +7.307318038676853e-01   +3.509060791444257e-01   +4.545056731965062e-01   +7.711459692490019e-01   +6.250963049052475e-01   +5.012797284607473e-01   +4.983286239317660e-01   +8.597816746557875e-02   +3.466301270367079e-01; +1.228376408302133e-01   +1.847231528464400e-01   +8.949629654775816e-02   +3.721666727835288e-01   +3.264163411658580e-01   +1.166457243735235e-02   +6.092763976151336e-01   +2.817998548682044e-01   +7.599510359309756e-01   +4.452978740296352e-01   +9.974515838980123e-02   +7.447988780653118e-01   +5.626732939409143e-01   +1.941670797001748e-01   +6.373190918818274e-01   +1.407297840897138e-01; +5.203033856905839e-01   +1.815511633648586e-01   +3.181755166315998e-01   +5.728783726718636e-01   +5.218030974787391e-01   +5.327484117712191e-01   +1.827289200243081e-01   +6.135262118537523e-02   +5.767973134400419e-01   +4.312499061572730e-01   -5.314809143310260e-02   +3.704775737468334e-01   +1.908061399468653e-01   +8.499305979451139e-01   +8.463361237224382e-01   -2.857951043043368e-02];
L1E_L1I_iGABA_netcon = [-1.764068104218943e-02   +2.375240724790317e-01   +8.817736629512130e-01   +1.635239727670857e-01   +4.029924584016527e-01   +9.712800692794508e-02   +2.642862064656111e-01   +4.734593372242313e-02   +1.801419212289246e-01   +8.852014485454651e-02   +4.106511169773732e-01   +9.175932002296092e-01   +1.914901966381935e-01   +7.754658690823409e-01   +8.867385792697377e-02   +3.806869493479724e-01; +7.600318831132460e-01   +7.441646164175875e-01   +5.230552813406748e-01   +7.916334862510223e-01   +6.754151373924163e-01   +7.892729579539568e-01   +5.866879714128184e-01   +7.874195210428062e-01   +8.696059476677277e-01   +9.249450594565077e-01   +1.752962688858520e-01   +1.106509205137061e-01   +5.935577087822743e-01   +8.719046027306325e-01   +9.961760167501347e-01   +2.615412628239714e-01; +2.511314320963797e-01   +8.167420643097073e-01   +1.279997682031178e-01   +1.138111012544119e-01   +1.257933277659308e-01   +2.608257602563949e-01   +5.750658911131051e-01   +1.602113567826848e-02   +1.696050372613905e-02   +9.117742505241237e-02   +5.101448111225382e-01   +4.125471626686137e-01   +7.351256639638521e-01   +7.688528002696111e-01   +7.696752433239764e-01   +7.520356248672213e-01; +3.766214149870239e-01   +5.261305133523508e-01   +5.872763293529789e-01   +6.960763007470782e-01   +6.636749904553240e-01   +5.793702573778561e-01   +5.537106842735025e-01   +8.499761667973375e-01   +9.497780985747317e-02   +2.969795380469715e-01   +5.060400376176126e-01   +2.947090015829119e-01   +7.992067701510894e-01   +4.078609615873056e-01   +8.760740436167151e-01   +5.138063014726255e-01; +6.680558275469591e-01   +5.867948375950178e-01   +8.495650659475125e-01   +3.429678998554200e-01   +8.816777096500150e-01   +5.144286504226971e-01   +3.643607241992410e-01   +4.343340469723447e-01   +3.108854015950655e-01   +3.665249011164808e-02   +4.612719986572160e-02   +5.505852597666105e-01   +9.039777489248910e-01   +7.939572902649337e-01   +4.538956640059331e-02   +1.483381600363020e-01; +2.303024782141469e-01   +2.794174058312209e-02   +2.995337127000459e-01   +2.076167134812399e-01   +6.848164756200963e-02   +4.808777303599963e-01   +8.303989065182799e-01   +2.969387784606149e-01   +5.219450300879986e-01   +4.282912144658563e-01   +8.440509042484226e-01   +1.539383338994760e-01   +2.150968699908364e-01   +2.193564582947034e-01   +7.113853795788126e-01   +3.258721302027000e-01; +6.784592055879772e-01   +5.365031441748060e-01   +2.873293659380016e-01   +7.918066566098808e-01   +3.022103335974876e-01   +8.301275729621235e-01   +6.087233512387712e-01   +5.150787986976600e-01   +8.022216159968310e-01   +5.735032803323347e-01   +8.113993758125170e-01   +2.066345636943283e-01   +8.249886306099460e-01   +5.632450299976518e-01   +9.493082274185521e-01   +7.505434075482950e-01; +9.082731533260933e-01   +1.295716667761876e-01   +6.217617611606949e-01   +4.736028338865993e-01   +6.696097516430287e-01   +1.742390886473893e-01   +3.629337020265888e-01   +5.616260030835959e-01   +1.990423205214963e-01   +8.115375820406366e-01   +7.293292583260144e-01   +8.246484398471388e-01   +2.758661462905951e-01   +6.537210482984630e-01   +4.681730961642029e-01   +5.454716668201253e-01; +5.435389885133896e-01   +9.370957955945017e-01   +3.718846641919550e-01   +9.088052930764753e-01   +2.418352827054140e-01   +6.617113993586935e-01   +5.525091859983186e-01   +8.856100275394869e-01   +8.566241366177849e-01   +1.198473874315687e-01   +1.735863500616433e-01   +1.786284088920733e-01   +8.607860254993589e-01   +3.143639761056487e-02   +5.478062836383713e-02   +4.754736411784419e-01; +2.101845504673207e-01   +3.390746678680083e-01   +5.108357773751192e-01   +2.056654279907457e-01   +8.760108487031041e-01   +3.880454442891076e-01   +3.025429742253966e-01   +8.861314221960568e-01   +8.795124806108258e-01   +8.406125549643739e-01   +7.984844229518466e-01   +9.395269524932788e-01   +4.750324171032414e-01   +3.751105395443519e-01   +2.979898340130364e-01   +7.639691895122249e-01; +1.651608439549192e-01   +2.163771291107334e-01   +7.580514571373973e-01   +8.375359991687719e-01   +1.654855851805853e-01   +5.871863853798468e-01   +7.278185330301039e-02   +4.596833946584895e-01   +4.112521686879826e-01   +6.087692426987308e-01   +3.401885059738267e-01   +8.928476770293912e-01   +1.001929532586325e-01   +4.481832893522312e-01   +4.397987404230362e-01   +4.153508918129444e-01; +1.705984271306167e-01   +8.953627373044164e-01   +6.941566780362872e-01   +5.035896341855716e-01   +4.502115839761799e-01   +6.579120635798665e-02   +2.010442430987827e-01   +3.552448748651055e-01   +1.622279712550881e-01   +4.925221880167424e-01   +1.900860303243259e-01   +3.906527116710670e-01   +3.674380829469142e-01   +8.798874283200404e-01   +3.930170838152772e-02   +4.617338419242573e-01; +8.764154996544623e-01   +1.766449865884767e-01   +4.710315889281577e-01   +4.895794626120635e-01   +6.045467514179551e-01   +5.654438778265150e-01   +2.144810622705867e-01   +4.525404468057059e-01   +4.235259764294511e-01   +3.529323239561641e-01   +9.152134129086851e-01   +9.484376660086017e-01   +8.026361568713809e-01   +5.663936383984544e-01   +2.540952250322457e-01   +7.335945967176933e-01; +4.472153962783341e-01   +8.197016880685088e-01   +3.402703240076082e-01   +4.083686384257912e-01   +7.133987879281622e-01   +1.764242910084543e-01   +2.792281510982489e-01   +5.742065019447194e-01   +3.415336588531038e-01   +4.549562729738727e-01   +2.004257526382181e-01   +1.694326121458457e-01   +2.560432550136565e-01   +2.599263820920766e-01   +5.341672208200858e-01   +8.756768195028302e-01; +5.611466525043670e-01   +5.806779060450163e-01   +7.111466875384717e-01   +6.561172221438926e-01   +6.922086270974287e-01   +9.932046957390729e-02   +8.064876845998363e-01   +2.346629888084327e-01   +8.430019571198276e-01   +4.840138811961804e-01   +7.244076069915304e-01   +5.249743007836314e-01   +2.949428352803983e-01   +4.706278595370367e-01   +8.521840045766885e-01   +4.318243759467307e-01; +3.654280489457566e-01   +5.663611631878059e-01   +5.995581230198228e-01   +2.435864656089103e-01   +4.484185969701362e-01   +2.737648990689694e-01   +5.153395500032961e-01   +2.179206971020792e-01   +8.191613403216915e-01   +2.771639512136854e-01   +2.831422923185863e-01   +1.409388853794290e-01   +5.714360924887363e-02   +4.430074580500780e-01   +9.246814685174621e-01   +9.138780632035310e-01];
L2I_L1I_iGABA_netcon = [+6.513775569677029e-01   +4.486286577794492e-01   +7.058585751445712e-01   +5.660819825576899e-01   +9.353877309151329e-01   +6.645809286763859e-01   +9.344344203616024e-01   +1.061099334618847e-01; +4.635124982808765e-01   +1.571927383284330e-01   +2.138720652440258e-01   +9.534992217673384e-01   +2.037515220870482e-01   +6.789539662710097e-02   +8.075324336856649e-01   +6.502784520603125e-01; +9.915381192995781e-01   +5.237644774268748e-01   +6.546141717633375e-01   +6.791719033290463e-01   +7.387524835417190e-01   +6.334897262321346e-01   +2.968082657259213e-01   +2.407004860397151e-01; +3.672698844945768e-01   +1.864754191621076e-01   +8.755084124133495e-01   +4.193131183656874e-01   +7.499656726556061e-01   +3.429787025304512e-01   +9.236796692272607e-01   +1.535668548685134e-01; +7.044685901550322e-01   +5.000069819326394e-01   +6.437293017285315e-01   +2.397967378578015e-01   +9.164923454235105e-01   +3.696569149560118e-01   +5.335792263799456e-01   +2.342893415765097e-01; +6.149578028575511e-01   +5.517925640457785e-01   +7.306842046523733e-01   +1.604354760091115e-01   +2.164340696829389e-01   +7.953445613417204e-01   +8.642387208787244e-01   +5.330702090280214e-01; +8.152747363401200e-01   +4.923477058100020e-01   +2.425606354383238e-01   +2.793960816229250e-01   +7.192125039020721e-01   +1.399541525414705e-01   +6.591106106751770e-01   +3.321485809606457e-01; +9.863441508877594e-01   +4.239682796450676e-01   +6.123729520823689e-01   +8.599790075228185e-01   +1.048511590578125e-01   +4.384100307556029e-01   +4.497565123069626e-01   +2.515126428117567e-01; +7.543526680902326e-01   +1.632245545663166e-01   +4.626123278615996e-01   +4.641547267748813e-02   +7.245705494808584e-01   +3.657526360344006e-01   +7.272823812755487e-01   +7.014005535831179e-01; +4.502662479829174e-01   +8.001210873917023e-01   +6.004556090559106e-01   +8.001953140966672e-01   +3.488364573539016e-01   +8.130911385346936e-01   +8.576249907634345e-01   +2.647638590521239e-01; +5.686011832709753e-01   +5.838783350884357e-01   +5.151429575380578e-01   +3.640935489490803e-01   +7.198124531029690e-02   +8.553728029050268e-01   +6.019865877435263e-01   +4.434364465061791e-01; +3.541780776682082e-02   +3.862539333994576e-01   +4.138372710385794e-01   +4.191623904904705e-01   +3.749652674468914e-01   +4.754787834941076e-01   +2.899181953476398e-01   +5.396225500433354e-01; +4.006766517450120e-01   +1.761222746494304e-01   +6.577465809974878e-01   +7.472651969993862e-01   +2.083297585425495e-01   +6.772996737595428e-01   +3.357573418686094e-01   +7.053576132692650e-01; +4.936447813943144e-01   +4.665797995382074e-01   +6.554243695193822e-01   +3.672117920718371e-01   +8.074913893495974e-01   +3.897673665351752e-01   +3.509887603632295e-01   +2.895963347053127e-01; +5.491485903010015e-01   +1.627197021918270e-01   +2.192877093892984e-01   +2.044122141320521e-01   +6.325057479997155e-01   +5.247288215802060e-01   +2.442326082599802e-01   +7.313832657124413e-01; +7.490584000514875e-01   +5.633024707442279e-02   +6.772708336600745e-01   +3.503923312569532e-01   +3.541529625978516e-01   +5.551404083942127e-01   +1.453752087540627e-01   +3.304684878316360e-01];
L1I_L2I_iGABA_netcon = [+4.728375677151917e-01   +1.798238171590718e-01   +8.421874440203717e-01   +3.123510582450362e-01   +5.270728856339524e-01   +2.946250770420820e-01   +8.609669412512380e-01   +2.439482213799520e-01   +4.952618830690036e-01   +8.002627993787751e-01   +3.849253262791642e-01   +3.580939464880413e-01   -8.023877342953194e-02   +6.857127609279805e-01   +5.927573926679466e-01   +4.910878916280334e-01; +4.662320718792852e-02   -2.125549545935910e-02   +3.041614934005765e-01   +2.654885663052141e-01   +8.622098572187034e-01   +4.151847649336746e-01   +3.166415128348435e-01   +1.597289550861453e-01   +4.797784220802513e-01   +1.938031198192332e-01   +2.982998155187833e-01   +2.497028069236348e-01   +9.625275882448275e-01   +2.148573003649946e-01   +7.653936438924628e-01   +2.352055460683403e-01; +3.569665843901657e-01   +6.319919347566545e-01   +3.065642743359415e-01   +6.501043072227910e-01   +2.445619579539010e-01   +5.615524215342318e-01   +7.422410440299214e-01   +1.052378638681340e-01   +7.549103912417555e-01   +4.698047938567962e-01   +6.038072253763674e-01   +8.846047110204172e-01   +9.682740770601036e-01   +6.642428185201095e-01   +3.947661412508083e-01   +1.898458092398531e-01; +8.250632540418692e-01   +5.503029420499289e-02   +6.462397834777617e-01   +9.174812649658135e-01   +4.577540388685004e-01   +8.648163936124396e-01   +6.587341547462371e-01   -4.538926882467331e-03   +2.275040745248663e-02   +3.017753411416381e-01   +4.020671046372873e-01   +4.285622885912680e-01   +3.145215782614867e-01   +5.019383246878742e-01   +1.620926791947422e-01   +4.221205618640488e-02; +9.071122585522666e-01   +7.901301062136998e-01   +7.471459665906039e-01   +5.811538336599067e-01   +2.748990622312148e-01   +6.461579567935700e-01   +6.571687033370497e-01   +6.139382166531971e-01   +8.488137150731818e-02   +6.945832076657708e-01   +2.065343801412207e-01   +4.636278139231838e-01   +6.583082804358220e-02   +2.211612694383880e-01   +6.586010562284632e-01   +9.256226002368636e-01; +5.580033980404525e-01   +4.371048463102178e-01   +1.060634130231695e-01   +3.322857234509550e-01   +8.931998447122065e-01   +1.576473597671050e-01   +7.099943574111905e-01   +6.029672334473927e-01   +4.936084368950440e-01   +7.460423376419960e-01   +2.754871094335534e-01   +5.262771671764143e-01   +9.133792560921171e-01   +1.002838876089241e-01   +2.274787798006778e-01   +2.587947206859765e-02; +8.523661869593986e-01   +1.296185009740367e-01   +3.888288315213652e-01   +3.217871299439317e-01   +5.312140644080032e-01   +8.347649951167561e-01   +4.480067373749102e-02   +2.935492026051224e-01   +7.395781514984376e-01   +9.422478992032036e-01   +8.656150373230667e-01   +8.188456617706711e-01   +1.295223388826842e-01   +2.521225631398823e-01   +2.925919659531122e-02   +5.769961925869852e-01; +9.169884433224912e-01   +3.877167213931118e-01   +1.651393170305046e-02   +8.800130392194826e-01   +1.834085324898789e-01   +9.550971660917225e-01   +7.801586774079790e-01   +7.358213912360487e-02   +7.879513283387281e-01   +3.535010605003993e-02   +8.615184487830801e-01   -6.545966462461080e-03   +8.133430404171323e-01   +6.982953284728742e-02   +9.528276090316281e-01   +6.683173151725811e-01];
L2E_L1E_iAMPA_netcon = [+3.186079640239423e-01   +9.210250168080201e-01   +6.408510676439025e-01   +4.142489241727774e-02   +3.164947845675759e-01   +3.553579388429117e-01   +5.115463372348403e-02   +5.840582339869393e-01; +1.878840540415004e-01   +1.207445201277287e-01   +7.471901806119767e-01   +8.649744069110727e-01   +3.860397200379200e-01   +5.315249180372316e-01   +2.319217141259296e-01   +1.242575531430038e-01; +4.855451723083496e-01   +9.075234100217346e-01   +7.738497225960022e-01   +4.449893410454304e-02   +6.838679104921174e-01   +2.434063859810553e-02   +4.349551080886581e-01   +8.524621074406520e-01; +4.601817757251526e-01   +6.709443309356140e-01   +5.705136857940885e-02   +5.484152013585043e-01   +2.494495365367941e-01   +5.671367524737312e-01   +1.659635688475787e-01   +4.849118078625723e-01; +8.373013310176042e-01   +6.998092618354677e-01   +7.794449190227908e-01   +5.098424341818270e-01   +7.404933032651233e-01   +4.104314188139357e-01   +4.144424957024174e-01   +5.143747968595174e-01; +5.028456132479258e-01   +6.424610139602629e-01   +2.303310034561143e-02   +6.297696703511821e-01   +6.680623730756546e-01   +8.185004779467280e-01   +2.971997207658714e-01   +7.900504843522198e-02; +4.337918216386208e-01   +3.139647793752013e-01   +2.660942937863925e-01   +3.745677761267314e-01   +4.175933838147303e-01   +2.398944828368502e-01   +5.843231458180483e-01   +2.673011929925015e-01; +7.164806772368563e-01   +2.011019068331373e-01   -7.631623237588200e-02   +9.778165578842288e-01   +5.092075203832727e-01   +3.676022189890139e-01   +6.118601908869545e-01   +6.194019876645451e-01; +7.809664657915208e-01   +5.756665298784612e-01   +6.432957128743451e-01   +1.225122882830006e-01   +3.725064357532711e-01   +2.653275876531918e-01   +8.016625262214176e-02   +9.787611317567659e-01; -4.562435949082703e-03   +1.510567564508259e-01   +1.754842814431000e-01   +1.716798910968880e-01   +1.308881195597049e-01   +5.500484738919094e-01   +8.163113070709241e-01   +8.409384624088503e-01; -1.373689269655541e-02   +2.311133971460880e-01   +5.375702101934996e-01   +3.979236743288919e-01   +1.684930383921746e-01   +4.363859965509115e-01   +2.132637513901381e-01   +7.212112300905679e-01; +3.237592621609175e-01   +5.823356458879703e-01   +6.100135920840762e-01   +4.654222213781531e-01   +6.797383540763284e-01   +2.688262040319087e-01   +6.968856283895776e-01   +4.826571786585221e-01; +6.661052405195756e-01   +7.106674417937925e-01   +5.774539421814023e-01   +2.109168936071526e-01   +2.017728946551482e-01   +1.156084006854186e-01   +5.404090373020417e-02   +5.290953614013435e-01; +7.093145219568112e-01   +8.215409770568144e-01   +6.172236624923749e-02   +9.164573845936362e-01   +5.282068568256021e-01   +7.778083360540192e-01   -1.834816834461029e-03   +1.603432337165088e-01; +9.509727665801303e-01   +1.939939144621127e-01   +4.909758252799325e-01   +5.880997670475051e-01   +3.080537358369370e-01   +2.181678456705391e-01   +6.399328801838150e-01   +4.270884509499450e-01; +7.976214644973012e-01   +6.107588580104975e-01   +7.073728888502223e-01   +3.821745870296424e-01   +4.707076617684774e-01   +8.322930720494776e-01   +7.241319485197221e-01   +1.621440972127177e-01];
L1E_L2E_iAMPA_netcon = [+8.144418001785811e-01   +4.480369959465750e-01   +5.964727186048236e-01   +1.797466684416923e-01   +9.554554195483139e-01   +2.522905036346061e-01   +5.087258668938246e-01   +4.825489466108450e-01   +9.581193106956203e-01   +5.294516633516240e-01   +6.113166195097078e-01   +4.826349552686020e-01   +5.318525595240290e-01   +3.464213706985558e-01   +5.815500400189408e-01   +2.986086580388972e-01; +7.918893502813683e-01   +1.700694577147776e-01   +1.435694963552782e-01   +5.315366331162754e-01   +7.871630067200258e-01   +5.782851456358995e-01   +9.015352682179709e-01   +2.706300862978198e-01   +3.705641249439629e-01   +3.169799195236163e-01   +6.439168252696706e-01   +6.565641557713813e-01   +6.539853547601169e-01   +8.518819427439822e-01   +3.443780600775144e-01   +5.597287303385541e-01; +7.810735950067941e-01   +1.364460866950832e-01   +1.487835193872344e-01   +9.817357898454296e-01   +2.182183694545252e-01   +3.506480071157340e-01   +8.499859585101107e-01   +3.221497154070406e-01   +2.065958252177438e-01   +6.185913565934265e-01   +7.700048398910642e-01   +4.885315616442368e-01   +8.000001859039471e-01   +9.489073935408420e-01   +8.203230783694182e-01   +6.432839712217499e-01; +6.555844279520207e-01   +6.938838673536279e-02   +5.663346665772337e-01   +3.360857195389573e-01   +3.961604144433243e-01   +7.870940181870310e-01   +1.820235862040407e-01   +1.562748852959558e-01   +5.869767351085010e-01   +5.032960745383113e-01   +4.093730492209200e-01   +9.425423057723058e-01   +7.356839331683699e-01   +5.226994694111884e-03   +7.742826954289770e-01   +8.160107948625501e-01; -2.146976965222580e-03   +2.194844799599216e-01   +1.380563693277400e-01   +7.633672605496042e-01   +1.577072110173222e-01   +4.420805985055062e-01   +9.430663011243702e-01   +3.246609464781097e-01   +1.317624336546781e-01   +7.541390294708654e-01   +1.197835816629801e-01   +5.477304780134543e-01   +5.790665273690497e-02   +6.578508726045453e-01   +4.433141618127842e-01   +1.396157246307495e-01; +6.430287393753034e-01   +3.900038144438420e-01   +4.098528758826521e-01   -1.460705549046408e-01   +8.923464048078117e-01   +1.232038964424008e-01   +4.920736510523950e-01   +1.679439202947419e-01   +7.611493241269890e-01   +8.436679115886518e-03   +7.603097428453390e-01   -1.127988988632735e-02   +7.358017902702210e-01   +5.296253356405293e-01   +6.855549110738937e-01   +3.310983633186621e-01; +2.647068535019081e-01   +7.382826321040156e-01   +3.155777491614320e-01   +3.947950903181536e-01   +2.826617466694514e-01   +8.757733643412184e-01   +9.404255619484618e-01   +4.430753423328300e-01   +6.757017510181621e-01   +7.497404105594715e-01   +1.179995616929007e-01   +1.019270833960983e-01   +8.390510616177087e-02   +3.321813821166930e-01   +2.931578649224098e-01   +7.671429112125326e-01; +1.462480860960302e-01   +4.345862992701203e-01   +2.687702313765014e-01   +4.785947809978880e-01   +9.755343192965501e-01   +4.935891563468606e-01   +9.357273611486985e-01   +8.345768506953386e-01   +4.022977496854290e-01   +5.421858900727225e-02   +4.055883178983224e-01   +4.030591052847100e-01   +3.131027297913483e-01   +6.954092387033550e-01   +4.495222490915364e-02   +5.509769737308943e-01];
L2I_L2E_iAMPA_netcon = [+3.285616697247151e-01   +2.916487914846865e-01   +3.475266053965919e-01   +5.607194574886706e-01   +1.707942773924820e-01   +8.181595931189870e-01   +6.941825852869790e-01   +2.239716935337655e-01; +4.649895513142001e-01   +1.436887907396230e-01   +6.714109180400267e-01   +2.559266318177050e-01   +6.817598349830738e-01   +8.414891411333844e-01   +1.186921208703118e-01   +5.117969396060675e-01; +6.718776916361625e-01   -4.266170259632696e-02   +7.302295794653689e-01   +5.840610508906886e-01   +1.470396517029844e-01   +6.154364606055791e-01   +7.734070709587657e-01   +1.578269376930861e-01; +5.165691172290345e-01   +2.425222055529110e-01   +2.385674313637533e-02   +9.469370053768278e-01   +3.781950565016880e-01   +6.398178959422002e-01   +9.305832268845654e-01   +1.932023583606111e-01; +1.368273935147147e-01   +4.283452065347287e-01   +4.834375622863926e-01   +8.281161310259479e-01   +8.606758376389995e-01   +5.560519406177080e-01   +6.817857801280875e-01   +2.555081191109298e-01; +8.508217191706965e-01   +4.946742100010940e-01   +9.244895329637099e-01   +8.969186828519768e-01   +6.825883942778856e-01   +8.309802349490376e-01   +8.572654766631449e-01   +5.034561224272486e-01; +8.344558587833498e-02   +5.484107497373198e-01   +8.913574965821194e-01   +8.077459497656332e-01   +7.436570078335346e-02   +6.870308555361825e-01   +2.362985041005759e-01   +1.370405835486369e-01; +5.629513308550029e-01   +3.996255052844181e-01   +1.687217539333484e-01   +3.289112712243820e-01   +6.640757053944271e-01   +4.189241930652934e-01   +1.000000000000000e+00   +6.901714989463136e-01];
L2E_L2I_iGABA_netcon = [+4.759184243734256e-01   +6.124195824668962e-01   +5.898887406415868e-01   +4.249606136471738e-02   +4.448126424540738e-01   +5.070461666087319e-01   +2.718591049248765e-01   +7.127054875371465e-01; +4.734697891432149e-01   +3.334590758985146e-01   +7.441936975244534e-02   +4.707259175117616e-01   +4.146512629019784e-01   +6.498829417225030e-01   +5.008660283618335e-01   +4.056383568600940e-01; +5.676796819848172e-01   +5.683454377276790e-01   +4.333769830822245e-01   +6.197526269459283e-01   +3.047344125757198e-01   +2.910364119421068e-01   +1.760612583442250e-01   +9.228350212218899e-01; +7.083406754620232e-01   +5.637351657883238e-01   +3.874801267997175e-01   +8.463855584613792e-01   +2.362115037236200e-01   +7.703434608543178e-02   +1.848864519882600e-01   +4.140660533969734e-01; +4.956705386558320e-01   +7.777596266996870e-01   +4.625785454522272e-01   +7.518850719486670e-01   +4.021563452257741e-01   +7.321481531431800e-01   +5.924443387293077e-01   +3.920938787812322e-01; +3.943322260018040e-01   +2.489544683704046e-01   +4.150353398303129e-01   +3.817580780377025e-01   +7.919411176655270e-01   +8.028201786134207e-01   -9.952606993482377e-03   +4.238238632210236e-01; +5.909565685867883e-02   +4.365660462150635e-01   +8.191476832364356e-01   +5.460897379682922e-01   +5.261352788316800e-01   +4.288218448810625e-01   +9.000947047656697e-01   -4.223921132390836e-02; +9.160150138201508e-01   +5.617691386923951e-01   +8.658969062944316e-01   +4.672139185404238e-01   +8.739993059268820e-01   +4.961553140899493e-01   +3.042810352000378e-01   +3.492234069329486e-01];
L3E_L2E_iAMPA_netcon = [+2.419273517401889e-01   +9.044668153529608e-01   +4.561032544642882e-01   +7.235757401789661e-01   +1.752263768487710e-01   +3.943841372716542e-01   +3.412048766727160e-01   +8.372142949761330e-02   +1.348539483011577e-01   +5.155012316763306e-01   +1.619162920569362e-01   +4.719793846150849e-01; +2.801467271891471e-01   +4.456279789716503e-01   +1.823401580792691e-01   +2.176879301104411e-01   +5.436019005029157e-01   +9.596104347825613e-01   +7.201028389412150e-01   +5.610851283063062e-01   +2.175200579581303e-01   +7.922323085736133e-02   -4.892202670286939e-03   +8.999968989757100e-02; +7.872821848608462e-01   +3.762736282023724e-01   +5.595363632997377e-01   +1.443108388146725e-01   +8.037159980905481e-01   +9.129563481127947e-01   +5.281436940027066e-01   +6.167877684516830e-01   +7.225904461161493e-01   +3.010763953130876e-01   +3.871236602365599e-01   +8.869270804245946e-01; +1.390564685773298e-01   +4.549405424486150e-01   +2.189956933157631e-01   +7.890136770787990e-01   +4.655993387541839e-01   +5.363332658635972e-01   +8.536213162886083e-01   +3.065507767977756e-01   +8.262772766957137e-01   +7.965217876974708e-01   +4.391015135627065e-01   +1.576643581569458e-01; +1.854059547494142e-01   +7.485866958421120e-01   +4.544996945508589e-01   -3.405208846406949e-03   +1.679869546582096e-01   +9.155901118150510e-01   -2.307964990881414e-02   +6.802484709342272e-01   +9.663070051472923e-02   +8.299606956725157e-01   +2.424977838353083e-01   +1.970493001245450e-01; +3.415942387020854e-01   +3.875807060454960e-01   +8.269145160138118e-01   +9.806266787070214e-01   +3.639607321483810e-01   +8.728000675736957e-01   +5.650702184933484e-02   +3.569601645651658e-01   +5.036994694470359e-01   +7.925188756572394e-01   +5.653372288892128e-01   +8.212998822999437e-01; +2.344134954758370e-01   +4.763435397467867e-01   +5.459650051374398e-01   +1.225273190989459e-01   +6.423912264349232e-01   +4.767812476073298e-01   +7.229454349380936e-01   +1.244619786365542e-01   +4.067980843637978e-01   +3.988179048757605e-01   +9.732251643469109e-01   +7.378952519089124e-01; +5.363565601845048e-01   -2.904692324113193e-02   +3.509134166832182e-01   +1.225840564243015e-01   +1.449011313578584e-02   +8.716333912012741e-01   +3.878814487623611e-01   +4.780685921148224e-01   +8.581372129769022e-01   +9.701159804292555e-01   +8.816724822805593e-01   +2.709956358666053e-01];
L3I_L2I_iGABA_netcon = [-7.655769765672266e-03   +2.635586921197943e-02   +1.182088986397533e-01   +6.101139793580663e-01   +3.485334016276643e-02   +4.808146498455259e-01   +7.557592704916131e-01   +3.968898895352838e-01   +3.907724137811607e-01   +8.713755081649872e-01   +8.268925480297064e-01   +6.394670271023456e-01; +4.364965414026038e-01   +4.298626750008553e-01   +2.630765190658449e-01   -7.038651739133481e-02   +4.722252906623200e-01   +6.447694898065329e-01   +4.622275737462307e-01   +9.034734669145993e-01   +1.420429361748856e-01   +9.000203484297359e-01   +2.614659875901393e-01   +6.174421134603991e-01; +3.628856832001129e-01   +6.624794677007643e-01   +2.916169502881361e-01   +7.832212932860653e-01   +3.226479538807812e-01   +8.271738183017645e-01   +9.049609228136916e-01   +5.842396920814532e-02   +6.466998089459766e-01   +4.286031884413923e-01   +1.263163080654054e-01   +5.686490654430123e-01; +5.888240316340969e-01   +9.811295684778187e-01   +3.010967327536108e-01   +2.160195862318678e-01   +1.649805178500438e-01   +5.733875875831412e-01   +2.112403193324289e-01   +2.561617687365243e-01   +3.699053080077418e-02   +3.312129420700721e-01   +5.397181615120652e-01   +7.784206364428469e-01; +9.539056604104253e-01   +1.223273859355633e-01   +4.516586214000919e-01   +8.564787689874825e-01   +4.455823773769521e-01   +8.710070687083159e-01   +9.847625778461599e-02   +5.084558679555914e-01   +5.687959355139236e-01   +7.536209011543779e-01   +7.102501239141072e-01   +5.042240883473069e-01; +8.802566412475731e-01   +2.175726612173249e-01   +1.714833842696046e-01   +7.070010610276601e-01   +8.703607511885328e-01   +7.690373216562837e-01   +9.565066199178692e-01   +5.789519317283734e-01   +9.218369017046955e-02   +8.140340289196465e-01   +3.339504114204599e-01   +5.736670311441797e-01; +1.076205743171720e-01   +4.729326413030744e-01   +9.067900395120566e-01   +5.934711264878317e-01   +9.989550090113224e-01   +7.403717184609245e-01   +8.413935693691615e-01   +7.138572143060904e-01   +5.537597298440801e-01   +3.792593155346995e-01   +3.572937804688743e-01   +5.180711806138418e-01; +4.106394744979099e-01   +2.291482263400762e-02   +7.185329584940220e-01   +1.715291695519072e-01   +3.971485592615816e-01   -3.326975436106253e-02   -3.410989679844285e-02   +9.264028377938517e-01   +4.677200388983591e-01   +1.101870202177659e-01   +7.298874736848553e-01   +2.134630971676713e-02];
L2E_L3E_iAMPA_netcon = [+9.686698995649339e-01   +2.346546144246351e-01   +5.196158848348214e-01   +7.408254733327434e-01   -4.473547323234519e-02   +6.841315458853751e-01   +8.199595408334684e-01   +1.140424064274668e-01; +3.713546886173952e-01   +5.022403619503353e-01   +7.068468721023966e-01   +6.566729457402865e-01   +3.004524811082598e-01   +1.755699942496354e-01   +8.552158591236683e-01   +9.975699878600279e-02; +6.395419897624727e-01   +5.375961633991477e-01   +8.703975957170017e-01   +5.772220017585111e-01   +9.531572818825522e-01   +4.959985617850641e-01   +9.635737002096495e-01   +4.263037451622180e-01; +2.336278372475525e-01   +9.368973090352722e-01   +8.906341435616462e-01   +4.413427553794608e-01   +3.650199011428037e-01   +9.670964305547557e-01   +2.455958473175394e-01   +4.814845782418922e-01; +2.728450209160978e-02   +2.006306086897975e-01   +7.275467739070813e-01   -3.469429557934747e-02   +2.354308202740440e-01   +5.404181195757436e-01   +4.678452767434250e-01   +6.373069791566434e-01; +3.836365396705250e-01   +8.019529529142879e-01   +1.942204230967834e-01   +7.738576848358635e-01   +7.550475750325852e-02   -4.364193824290442e-02   +5.439486944244366e-01   +2.090749185845963e-01; +4.561637941358956e-01   +7.453466011732215e-01   +7.717389312494518e-01   +2.318110874452151e-01   +7.759284155729522e-01   +1.792042167570603e-01   +6.805863413788271e-01   +9.330008131382156e-01; +2.349248975916568e-03   +5.257163548912661e-01   +8.969395142874150e-01   +4.544513199340111e-01   +9.594857554077420e-02   +7.502782526550054e-01   +1.046434461850289e-01   +3.521773747035016e-01; +1.000000000000000e+00   +9.209532195219359e-01   +1.210719414193620e-01   +1.270405985543084e-01   +7.071086310904012e-02   +9.319654022421368e-01   +2.714350169059944e-01   +9.056134436694444e-01; +1.401141766119526e-01   +4.291860656348619e-01   +8.432372674714431e-01   +3.004075449972367e-01   +4.112394259934804e-01   +8.873258920190289e-01   +6.614544016220701e-02   +8.935602446959611e-01; +6.672522837157959e-01   +3.296176292455842e-01   +2.752684231208141e-01   +2.665842469023414e-01   +1.720302639517555e-01   +3.579503300234843e-01   +1.811154908064948e-01   +1.459723666552316e-01; +1.500800817670554e-01   +6.550690406877954e-01   +8.617966470716366e-01   +4.373919408388939e-01   -2.646800266882467e-02   +7.203480222076619e-01   +7.976682272696050e-01   +7.373883800419301e-01];
L2I_L3I_iGABA_netcon = [+3.459794077645063e-01   +6.781756730934458e-01   +2.788373189364571e-01   +6.273212867617056e-01   +5.274430241652226e-01   +3.798852348959211e-01   +4.170970619207890e-01   +4.509983834441920e-01; +3.099529777683342e-01   +6.652887836655802e-02   -1.359098245977854e-03   +7.983967808947811e-01   +6.908915443729436e-01   +1.348171140607560e-02   +8.842665786780828e-02   +6.300242877555969e-01; +3.368904451797446e-01   +6.090180655014966e-01   +3.806400128484411e-01   +8.441467933678705e-02   +8.121653611509553e-01   +6.616770944106991e-01   +2.313888786309297e-01   +1.312731559413669e-01; +5.758496952631846e-01   +8.650202147403262e-01   +5.597446448102280e-01   +4.729956268791880e-01   +5.491238643511684e-01   +6.644036343653441e-01   +3.745781424058703e-01   +6.642892564793338e-01; +4.384341513004119e-02   -1.230339206538359e-02   +3.433073995331515e-02   +7.148671310922080e-01   +2.444929182046697e-01   +6.053106131318979e-01   +4.474148187788731e-01   +2.991729429016767e-01; +5.481020435553644e-01   +4.020288355360416e-01   +4.093874203096791e-01   +7.204483987435989e-01   +2.369345665841661e-01   +7.844253967646773e-01   +4.627311307546005e-01   +1.005571612668321e-01; +2.193849709568144e-01   -5.977443999359696e-03   +4.120260562023273e-01   +9.951891101517715e-01   +7.091253059819018e-01   +6.066539942674288e-02   +2.609809844200714e-01   +8.384110747736850e-01; +2.064303949527527e-01   +8.879769090772694e-01   +8.909253898928882e-01   +8.721237346819973e-01   +5.097026606838864e-01   +1.400024738812481e-01   +6.451486544972989e-01   +1.231952685654940e-01; +2.906371462219771e-01   +5.185828818883571e-01   +2.125174031599947e-01   +1.549814275211538e-01   +3.944712578723915e-01   +3.094784129921350e-01   +6.056142211034946e-01   +4.900942961517821e-01; +4.384369605015873e-01   +1.794670205889171e-01   +2.089434438941020e-01   +4.104024825638608e-01   +9.689240105508290e-01   +5.121073004415987e-01   +4.549079353403709e-01   +9.519864345281108e-01; +5.897040642941188e-01   +8.598873973284465e-02   +2.893243863191124e-01   +6.267053726196579e-01   +5.376540621734299e-01   +6.685050292501554e-01   +9.122484282060430e-01   +6.033675988746904e-01; +3.777989797653696e-01   +1.794080048453547e-01   +6.193397886249360e-01   +3.480687673334054e-01   +1.218518853845644e-01   -1.025612063057320e-02   +3.386959769211538e-01   +6.485931492527907e-01];
L3I_L3E_iAMPA_netcon = [+8.852519241876311e-02   +6.079598989677637e-01   +4.838274722491433e-02   +1.726581755856784e-01   +2.171626902381832e-01   +6.260864663868186e-01   +3.813404306669024e-02   +3.324813852442060e-01   +4.900149978134463e-01   +3.228700431041582e-01   +5.755643697511814e-01   +8.671456772473799e-01; +3.307328237927733e-01   +7.725462488956594e-01   +2.364506679780225e-01   +2.958942008695018e-01   +6.969169502597645e-01   +4.561364938360866e-01   +3.983576204069564e-01   +3.606643598517257e-01   +6.146049292955676e-01   +2.432678841671875e-01   +6.619624093969999e-01   +2.347037287479481e-01; +4.308952416363561e-01   +2.914532115310280e-01   +7.147149131474939e-01   +8.558707704673886e-01   +5.267363142156287e-01   +5.996330091544307e-01   +9.939156956017416e-01   +4.355848400398543e-01   +2.500750577543884e-01   +3.464660840026399e-01   +8.488980635921062e-01   +8.431674478858602e-01; +4.868724271035806e-01   +1.194106710608981e-01   +5.516377896580572e-01   +6.882150815983110e-01   +4.184729799701791e-01   +5.900379546798468e-01   +5.436303624427216e-01   +6.785268376010147e-01   +5.193055993119090e-01   +2.095575897804954e-01   +3.955755183969293e-01   +4.611233367741647e-01; +9.101906691111455e-01   +7.457634999671111e-01   +5.370527330798286e-01   +4.473798902041287e-01   +2.189787320923699e-01   +2.930264886176246e-01   -2.101929600427919e-02   +2.389941691066292e-01   +9.687206757618180e-04   +2.153354569054452e-01   +2.116251913413081e-02   +4.558532198744017e-01; +3.556883861245487e-01   +1.872232758885696e-01   +6.346394326057718e-01   +4.066096637330295e-01   +1.000000000000000e+00   +5.869260658801494e-01   +2.634784939139437e-01   +1.267561840357279e-01   +1.694193550967521e-01   +5.466566737657539e-01   +2.999743198682617e-01   +1.068259903347274e-01; +4.830112122179017e-01   +2.473329345874912e-01   +8.391572346809891e-01   +8.287541878488749e-01   +1.375836985281298e-01   +1.876081377338792e-01   +3.837988888211959e-01   +1.100622984997614e-01   +8.945428436043638e-01   +7.021867638614884e-01   +3.143206692533278e-01   -7.119675444455978e-03; +3.443951290895062e-01   +4.026754831734570e-01   +3.261996738636713e-01   +5.820397650511003e-01   +7.883771997913923e-01   +2.242895521360869e-01   +3.671361019465986e-01   +2.760518049692481e-01   +3.093425553839483e-01   +2.454102377373516e-01   +6.552242382559625e-01   +4.977199968718406e-01; +3.234232566262288e-01   +4.781852358612940e-01   +3.657033359626698e-01   +5.886644967412519e-01   +5.273404458928471e-01   -8.788162240975018e-02   +6.702614245452621e-02   +3.357263276918707e-02   +3.345829827080253e-01   +2.134194548663410e-01   +8.150746072191881e-01   +9.144455164531000e-01; +7.022796397617941e-01   +6.188122314370950e-01   +5.938305133286590e-01   +3.687491935059696e-01   +4.858387371054269e-01   +3.919388171938499e-01   +2.097142782825635e-02   +6.406896610585687e-01   +5.454747387055146e-02   +8.256555477713741e-01   +4.079925288467298e-01   +1.184194141704637e-01; +9.015735024769807e-02   +2.869514072818056e-01   +6.182158945436819e-01   +2.588940425386744e-01   +1.247398016863759e-02   +4.989837028039730e-01   +5.387894409391485e-02   +7.079974625239887e-01   +6.620419542754440e-01   +1.813286106705449e-01   +6.391548857479790e-01   +3.092534482904009e-01; +5.943538111643176e-01   +6.695496000308661e-01   +4.083316950765597e-01   +5.939052497202845e-01   +6.275166237197415e-01   +3.213145253921178e-01   +2.918310392340431e-01   +8.234123469838026e-01   +5.526317594750259e-01   +3.741142931749324e-01   +5.017482213395297e-01   +3.975271985516532e-01];
L3E_L3I_iGABA_netcon = [+3.321590673959892e-01   +6.991591393977846e-01   +6.641749139788820e-01   +8.993483594528067e-01   +4.801942300153493e-01   +5.593181663731495e-02   +2.828552512568824e-01   +6.746300157504743e-01   +7.138953824888801e-01   +3.126157115357034e-01   +4.853547861181847e-01   +2.579927596389202e-01; +8.488333670478578e-01   +3.603291042216384e-01   +5.604956699657195e-01   +8.657385888710686e-02   +8.550940521956338e-01   +3.745447880480411e-01   +8.357682873590393e-01   +6.853037850757230e-01   +5.913498341657957e-01   +7.423587419047288e-01   +2.917201272661695e-01   +4.585364613340081e-01; +7.527866101280187e-01   +3.977748434878506e-01   +4.343321565359446e-01   +5.357810989965515e-01   +5.575980944090106e-01   +5.406158563854033e-01   +2.778284491256075e-01   +8.447360835092010e-01   +4.716808680060118e-01   +1.943373637628233e-01   +7.912866972169212e-01   +8.846785993534170e-01; +1.259312941384690e-01   +6.664127965170275e-01   +2.994008298759894e-01   +3.495336324657298e-01   +7.906280274731915e-02   +6.013507756939989e-01   +2.709245863593148e-01   +7.468971215144531e-02   +3.219408884189359e-01   +5.140375760548505e-01   +7.624047386434637e-01   +6.262271525633398e-01; +2.971079987091501e-01   +6.327420877715594e-01   +6.077656774342757e-01   +2.938886822800494e-01   +9.829805331586983e-02   +6.592354056368690e-01   +8.287202412662841e-01   +2.969201854107602e-01   +2.172118756707452e-01   +8.215199750429000e-01   +5.858107559647223e-01   +1.783149933262242e-01; +4.383128313750176e-01   +7.868435073161888e-01   +6.976089367695617e-01   +5.011146289613622e-01   +7.541344989326694e-01   +7.005387174639117e-02   +3.263151981511369e-01   +2.114965209736654e-01   +9.109017147122396e-01   +9.126627064085485e-01   +8.258749874491353e-01   +2.224801428987741e-01; +5.707477696937530e-01   +7.690636131990018e-01   +2.298887242937145e-01   +3.860093215998163e-02   +4.156726693166183e-01   +5.533018258154477e-01   +5.901352567949529e-01   +1.719054233771348e-01   +9.566553439148828e-01   +5.707142255829677e-01   -3.789989362503291e-02   +3.172481301389791e-01; +4.894324241341668e-01   +3.399370029461296e-01   +9.010452935128572e-01   +3.987025153071848e-01   +1.189785658072644e-01   +5.616745204991727e-02   +5.606772922400174e-01   +1.767357603190062e-02   +5.630758389718840e-01   +7.622976597327297e-01   +2.003777962406777e-01   +9.911533526746273e-01; +2.734681800974311e-01   +5.420283266277802e-01   +2.894730265554781e-01   +7.734054743125487e-01   +7.970589802834269e-01   +1.035980159283449e-01   +4.122377762369830e-01   +6.282562232731419e-01   +6.018801146647383e-01   +8.226848922498108e-01   +7.038516194533743e-01   +6.767258247079172e-01; +6.205777041313913e-02   +5.560879153512717e-02   +3.369012927414458e-01   +5.603964711258924e-01   +7.538262729615548e-01   +1.997714484965397e-01   +4.725831284846762e-02   +3.209922503681990e-01   +7.150498034319782e-01   +2.732970566703299e-01   +6.285308840937368e-01   +4.946869385677424e-02; +8.868835630986879e-01   +7.187646519216366e-02   +7.483938845534627e-01   +5.161312852357692e-01   +3.804956528021499e-01   +8.428596596745861e-01   +1.659594171429776e-01   +8.299757845885266e-01   +3.258372677462762e-01   +8.723169292097760e-01   +5.146877542701196e-01   +6.992288954019440e-01; +6.919386134606454e-01   +8.230413691340003e-01   +4.767767447104811e-01   +8.466923249854877e-01   +8.134556346818401e-01   +5.312713355335859e-01   +8.816173332997748e-01   +8.633192700714764e-01   +4.900522200956233e-01   +8.286072195000224e-01   +5.042827988186903e-01   +8.890761588193575e-01];
L2E_Input1_iAMPA_netcon = [+9.563066545444729e-01   +9.656098865588447e-01   +9.019962689731412e-01   +9.300494104020568e-01   +8.860694899231835e-01   +9.924456463481582e-01   +8.766520454153823e-01   +9.112206155814664e-01];
L2I_Input2_iAMPA_netcon = [+9.305782277895776e-01   +9.611984869796319e-01   +9.429239723687949e-01   +9.224098818356415e-01   +8.533033037764293e-01   +8.976749499445144e-01   +9.419449720891877e-01   +9.219548928597481e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
