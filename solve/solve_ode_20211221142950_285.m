function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.480402888719990e-01   +3.957355298075180e-01   -2.914611321069153e-01   +5.048202214538257e-02   -6.384651194721749e-01   -1.237052215433903e-01   +2.746490973124256e-01   -1.256825503704850e-01   +3.081290775754630e-01   -1.019580534019455e-01   -3.291594739694407e-01   -4.913247703128661e-02   -1.271446248472660e-01   -1.274513201851223e-02   +2.530472823019991e-01   -1.118424886070833e-01; +9.876144303180101e-02   +3.220525374268376e-01   -2.100837429447712e-01   +1.643374524135268e-01   -2.783149938445805e-01   -5.777701712700037e-01   +3.219945342055093e-01   +4.911429175521180e-02   -1.353918842547356e-01   +7.013377618906663e-02   -4.887022834690700e-01   +3.082113628562393e-01   +1.492642736044602e-01   +4.339348315475502e-01   +2.804500777711057e-01   -3.657598150384669e-02; +2.498674580783714e-01   +2.106143898587249e-01   +4.193243022885119e-01   -4.576761604606203e-01   +1.216768992131043e-01   +4.655549793826662e-01   +6.423034582476581e-02   +2.886443315683435e-01   +1.783623410030638e-01   -1.017826459875149e-01   -2.195144882912720e-01   +3.825054240797671e-01   +1.503712810478365e-01   +1.852528710881498e-01   +2.811664443058958e-01   -1.026982313001777e-01; -2.827534634616318e-01   -1.443634079878865e-01   +3.276018608623182e-01   -8.342221529197416e-02   -1.902198309371315e-01   -2.522597045954049e-01   -2.410425522947830e-01   -2.050430439742329e-01   -8.290308728577192e-02   +4.548692690884521e-01   +1.600421123040014e-01   +3.459994212119049e-01   -1.938135403827825e-01   +1.096098767042644e-01   +1.421633123749066e-01   -3.895540739630918e-01; +1.479225272454699e-01   -5.373999670126650e-01   +4.492412092630661e-02   -5.397137070714828e-02   -2.812230674087790e-01   -3.462859707424837e-02   -3.445525326857840e-01   +3.238390460464781e-01   +3.994873822352200e-02   -4.905426684368040e-02   -1.596966077097265e-01   -5.190326930325441e-01   +1.138335192195826e-01   -3.940126188207093e-01   -1.765403318329464e-01   +6.234250666437681e-01; +1.729762254714314e-01   -2.685911158701932e-01   +9.094168361862626e-02   -6.257513537136583e-02   -3.864965570360429e-01   +5.977236927918465e-02   +5.156435234982771e-01   +3.602125074010058e-02   -1.847151516382810e-01   +3.893733051103078e-01   +1.052400063851424e-01   -1.316652184771840e-01   -2.327318405133262e-02   +3.799517195263586e-01   -1.214610565495141e-01   +6.243632298068760e-02; +1.428119953724498e-01   -8.018734711487625e-03   +2.239492713885450e-01   +3.623452720213565e-01   +2.957448288792170e-01   +8.842481366163919e-02   -3.269736674636641e-01   -2.115213077222049e-02   +3.408941377745243e-02   -1.765363155179123e-01   -1.872233931129011e-01   +2.693974880685828e-01   -7.084635359532165e-02   +1.827923055167917e-01   -8.016081778869577e-02   -4.651210139729970e-01; -1.316120866816912e-01   -1.758285795715094e-01   +3.987642542369023e-01   -2.928828378845951e-01   +3.759847756953595e-01   +2.299945961494473e-01   -2.063674175351893e-01   +1.360015166898582e-01   -1.218979778215400e-02   -1.890511016623265e-01   +4.190379195038137e-02   -2.376780707251120e-01   +6.081063102449605e-01   +4.612884316858158e-01   +2.397626000944645e-01   +1.862562167000558e-01; +1.728356647028604e-01   -6.421751269875831e-02   -1.531207905307185e-01   -2.558285187796263e-01   -6.395262860768683e-01   +1.653272007104358e-01   +5.971732795165317e-01   +1.808304106356243e-01   -3.363036984683720e-01   +4.125149353421200e-01   -1.920306949429041e-01   +4.054245757076450e-01   +2.613648587615756e-01   +2.857476994932402e-01   -1.644147129115874e-01   -3.836211968805880e-01; -2.037009556368871e-01   -3.378919934404060e-01   +7.561953954093847e-02   -5.020020200842441e-02   -5.540004549449465e-02   -1.538577498142171e-01   -1.395320749987611e-01   -2.359790455012833e-01   +4.626752695981726e-01   -1.015583373392694e-02   -1.114594311253334e-01   +9.428438021457891e-02   +3.505226574850855e-01   +3.616393457956048e-01   +2.511288490886413e-01   -4.281100555019537e-01; -3.758158679900012e-02   +9.327694355040306e-02   +5.548755880681807e-01   -5.226250824513679e-01   -2.408823104652200e-01   +4.640364310535959e-01   +4.369463897121005e-01   +1.356391798907449e-01   -2.643460166613362e-01   -3.733828026818661e-02   -3.442272020941826e-01   -4.601358639254528e-01   +3.786071922777377e-01   +2.261738471882374e-01   -1.802351516672072e-01   -3.977948713179676e-01; -1.346704642390283e-01   -8.103342661665489e-01   -1.610302603729385e-01   +8.669780361197099e-02   -1.576960192421160e-01   +2.809364356955141e-01   -1.112152449895265e-04   -5.768548524091387e-01   +1.174324826615501e-02   +1.334938711013833e-01   +3.377537843695085e-01   +4.356905564388184e-01   +5.212453823121470e-01   -4.904444855040283e-01   +6.777861924506989e-02   -2.107086433621831e-01; +1.072162626718520e-01   +6.264452259514814e-01   +3.643369337123181e-01   +2.936195106386092e-01   +9.192386487616336e-02   +2.425232933769515e-01   +4.204376098076584e-04   +2.639823551924317e-01   +4.286513888379134e-01   -4.751697414056356e-01   -1.261176676334795e-01   -2.012916356854294e-01   +3.105554242078639e-01   -2.440121350299463e-01   +1.117819886879352e-01   +8.764284526007940e-02; -2.782930173908787e-01   +4.506966973217439e-01   -1.797652831114614e-01   +5.004534050001266e-01   -1.560560702981467e-01   -4.916660690866202e-02   -3.290966458909560e-01   +2.970309971047738e-02   +2.133154411676218e-02   +3.873202372315386e-01   -5.070925726017027e-01   -9.271085533751972e-03   +2.235289792289371e-01   +2.455546610774224e-01   +6.059491854239150e-02   -4.530572906730155e-01; -2.459703267537324e-01   +1.400842979334517e-01   -4.765955304046783e-01   +3.740049536417512e-01   -9.300293839709722e-02   -1.081370915792176e-01   -1.001040185771527e-01   -4.511275432686569e-02   +3.439613022140946e-01   +4.133896878026233e-03   -1.932711844564264e-01   +6.712624069325898e-01   -3.793062978749370e-02   -1.258217012683865e-01   +4.156958425628732e-01   +8.063505509077232e-02; +3.808797077021925e-01   -3.570355920257007e-01   -1.712150032136359e-01   -2.471745239597149e-02   -1.351930927389368e-03   +5.488351481781318e-01   +8.131970652478171e-02   -1.013245192475809e-01   -2.595382897404556e-01   +1.269729923803876e-01   -2.842757523622235e-01   +6.904028355175265e-02   -3.242867523134450e-01   -5.304592399021515e-01   +5.441338690959904e-01   +5.723458613417016e-01];
L1E_L1I_iGABA_netcon = [+6.310819127863154e-01   +5.561748666932851e-01   -5.181538617375179e-01   +5.791356982010290e-03   -4.602293956777050e-01   -6.030354830312599e-01   +3.636037933135154e-01   -6.541292179861334e-02   +5.670489920816131e-01   -3.487625082907707e-01   -1.817724478655638e-01   -1.167072299439809e-01   -3.608224751006746e-01   +8.417257657346575e-02   -1.704452275950149e-01   -6.603069737094316e-01; -3.564498664720949e-01   -1.576530171475633e-01   -2.553217488105894e-01   -1.735848735282752e-01   -9.917122289653640e-02   -1.102461691633413e-01   -3.382453869093844e-01   -3.514731043092237e-01   +2.853156968008405e-01   +4.541972215809091e-01   +5.891704363117165e-01   +1.292630160588992e-01   +1.195303580998344e-01   +3.709510016157004e-01   +2.755217375145807e-01   -2.145436539706458e-01; +9.684253255613798e-02   +6.059490585074496e-02   +6.139528554267552e-01   -4.668474939184109e-01   +2.136816886955430e-01   -3.466522915780361e-01   +6.528230887623979e-01   -6.049395676159574e-01   +2.047311376593524e-01   -3.528835815487260e-01   -5.685681373520505e-01   -1.615677082695546e-01   -5.863865906929409e-02   -3.232479931883408e-01   +3.821754163613783e-01   +1.568790549146288e-01; +4.295310577650218e-02   -5.047084575175492e-01   +6.625192758003043e-02   +3.591545857676812e-01   -3.420018482783398e-01   +8.632472059035524e-02   -4.000597561445377e-01   -3.639457424296246e-01   -2.596328383303818e-01   -2.604866459285706e-01   -5.189003455571205e-01   +3.655467051967727e-01   +2.296690046824559e-01   -1.744335634316354e-01   -4.191531543952569e-03   -5.196395333925065e-02; +2.187774366551041e-01   +5.757428051281751e-01   -4.105284570979318e-01   -2.512963905865084e-01   +2.814619909456561e-01   +2.218851680411759e-01   +1.179655302308436e-01   -3.006952083744174e-02   +1.629686217693751e-01   +1.362407449902124e-01   -4.427387596771227e-01   -3.362575049410398e-02   +2.003366468458890e-01   +4.765064647934021e-02   +1.418987086520363e-01   -5.168101921424978e-01; -9.876524698058771e-02   -5.229130583900026e-01   -3.063085473390924e-04   -3.684702961199671e-01   -2.963065330349974e-03   -9.207598239279746e-04   -1.767376815430035e-01   -2.643211611434959e-01   -1.796981681078053e-01   -1.361332780883895e-01   +2.639988309594711e-01   +2.000054995164688e-01   -1.167612837286944e-01   +1.061131857157342e-02   -1.343269142108554e-01   +2.125838231389183e-01; -4.086728791269023e-01   +5.543917157466310e-01   +1.671965570018228e-01   -3.971153561105120e-01   +2.107327475642536e-01   -7.982367354873855e-01   +2.192374596434254e-01   -1.873940964827292e-01   -3.830881737600232e-01   +1.450722459283958e-02   +3.760944647629451e-01   -6.683855844031839e-01   +3.146256407127027e-01   -3.903587167057440e-01   +2.009136885439946e-01   -2.528427860419170e-01; -3.433738518290621e-01   +2.382488953212944e-01   +2.481714045738715e-01   -3.717894980016533e-01   +1.470861194761968e-01   -1.191614500066158e-01   +7.885556282034140e-01   +6.274416716434425e-02   +4.702331579047144e-01   -3.529721268764278e-02   -5.376842933442807e-01   +4.821190071073913e-01   +1.442937370197292e-01   +2.249030034281562e-01   +4.976561055713667e-01   +5.071850793245714e-02; +2.824509990714940e-01   +1.112590900284344e-03   -4.401587383625502e-01   +4.360726772815248e-01   -3.377121138105729e-01   -3.176432440586416e-01   -5.818478758927257e-01   +2.239911671151101e-01   -8.978317020181312e-02   -2.765913840997939e-01   +4.727534837422725e-01   -3.636874197504711e-01   +6.665928556436403e-02   +2.459852631034304e-01   -4.167196897135760e-01   -2.232704874518368e-01; -2.274666383860738e-01   +2.494393031079589e-01   +3.001419927635698e-02   -4.080723384621152e-01   -2.883497865297892e-01   +1.620959775146252e-01   -2.246290556335968e-02   +2.162500365222726e-02   +4.234517523984699e-01   +1.999094116851466e-01   +3.055839808627759e-01   -6.225105046491646e-01   +4.078443986244670e-03   -4.836552710283529e-01   -4.329976296014866e-01   -2.969102736378055e-01; -3.723018030379694e-01   -1.114339926733742e-01   +9.389126190395092e-02   +3.933533728743699e-01   +4.251090270505663e-02   +2.290670872390079e-01   +4.143788734869914e-01   +1.255771615618457e-01   -2.454958394590466e-01   +5.047754902128453e-01   +3.241645307307374e-01   +2.016285631121106e-03   +6.383587359677182e-01   -2.129126856202419e-01   +3.195347866772346e-01   -2.795929775126206e-01; -1.085592205320940e-01   -3.809615148926243e-01   -5.091079061917433e-01   +4.183995606567205e-01   +4.574181402312320e-01   -4.216649092420565e-01   -3.530739806991150e-01   -1.757646888555384e-02   -1.707733992047603e-01   +1.200922257957956e-01   -2.637230904155046e-01   -2.231669887368350e-01   +3.550670673991937e-01   -2.661287842343170e-01   +6.922792490651353e-02   -3.652043947484861e-01; -1.098319827930983e-01   +1.972499249281693e-01   +2.233034634489394e-01   +3.377958695408735e-01   +2.886759548475633e-01   +1.665517173652388e-01   -9.393252013720099e-03   +1.359419928370391e-01   +3.306486751731282e-01   +8.271802743510070e-02   -2.890062803276846e-01   -1.775869965700307e-01   +7.106332216426475e-01   +1.622755457181952e-01   -6.669200812710013e-01   -5.438679065804942e-02; +2.206776210495595e-01   -3.707294006127994e-01   +3.454002371198915e-01   +2.148552186236384e-01   -5.827120978992596e-01   -2.494866747098200e-01   +5.022912606371960e-01   +3.412245075424203e-01   -1.871649162965332e-01   -7.906709887032866e-02   -3.245062138234073e-02   +1.739758114676235e-01   -9.915387242275892e-03   -1.958432718285038e-01   -5.017491845227130e-01   -3.432415807135243e-01; +3.985046101733110e-01   -3.096604704022773e-01   +5.222622853551808e-01   +7.213078017476275e-02   -4.292188943144620e-03   +2.864729877155945e-01   -2.384925971233527e-01   -2.843439814133758e-01   +7.022216054479393e-01   +4.113320409011644e-02   +8.874237454391859e-02   -7.490585088772049e-01   -2.655155401505959e-02   +3.351913983686139e-02   +3.431022055867399e-01   +5.033058551688165e-01; +1.691321059313810e-01   +4.873844726555029e-01   -7.055011849957361e-02   -1.930161601073013e-01   -5.806314660056651e-01   +6.664978719324686e-01   -6.120552446624425e-02   +2.450679666379038e-01   -4.364252963180162e-01   -3.006053238781252e-01   -6.443242401885156e-01   -4.019699107494378e-01   -4.325478814155748e-01   +4.490572575926505e-01   -1.146870208288834e-01   -1.133336106456916e-01];
L2I_L1I_iGABA_netcon = [-3.264250094061349e-01   -3.255027320222082e-01   +3.662405935271538e-01   -3.950932713205499e-03   +5.961481422430545e-02   -1.485581201364995e-01   +6.693424124320592e-02   -2.456849384074192e-01; -5.107581665183727e-01   -2.485332557742611e-01   -7.228983965310078e-01   +1.877146704895530e-01   +2.328435612148725e-01   -3.427766722654533e-01   +4.335281749984155e-01   -1.366947687162325e-01; -4.258569317183951e-01   +1.200225827376447e-01   +2.165846962092318e-01   -2.146184819622718e-01   -2.307964827126879e-01   +1.862564397808470e-01   +3.050416539965467e-01   -1.501441970242380e-01; +1.356897037101614e-01   -2.179798753343606e-02   +1.940165217146192e-01   +3.099822338673553e-01   -9.548466194789135e-02   -2.402045043134710e-01   -4.270420984702630e-01   +4.757124956614754e-02; -4.288443205327874e-01   +2.151500091411644e-01   +4.330690900262348e-01   -1.209272512021657e-01   +7.948794418409469e-02   -8.179003574515668e-02   +7.857021001300780e-01   -1.098573691039020e-01; -1.439220124292697e-01   +1.065346773954874e-02   +6.974728544526601e-01   +8.510197189341716e-02   -2.152587424481091e-01   -3.307922329694050e-01   -3.430209269073345e-01   -2.796306978322117e-01; -3.824102297779075e-01   -1.919263522496906e-02   -3.838041675083712e-01   -3.212803479588539e-01   +4.180821504597463e-01   +7.754705859768911e-02   +3.998795455378252e-01   -1.975316490437425e-01; +3.077749382199864e-01   +2.183013511830746e-01   -1.745581277725000e-02   +1.701288165996396e-01   +4.694726979537108e-01   +1.701133853100461e-01   -1.387140863386050e-01   +7.385907041268938e-02; +1.238413424601038e-01   -1.105778589444700e-01   +1.453851763694539e-01   +2.265435546797833e-01   +2.419007623834695e-01   +3.647899899498716e-02   +2.157629500810731e-01   -8.588428366050370e-02; -1.511150180251584e-01   +1.354867411390007e-02   -1.011949028229209e-01   +1.966105844469871e-01   +4.073209491749110e-01   -1.050308775245433e-01   +1.306820955276065e-01   -1.387368411911194e-01; +1.856091219574994e-01   +2.210119066961491e-02   -1.908453912169033e-01   -3.149782603734107e-01   -4.313349532931065e-01   +2.439340965752624e-01   +1.731632782773253e-01   +6.675052339583235e-02; -4.051814908197762e-01   +7.546214954638222e-02   +8.192672614356435e-02   -5.709241896165543e-01   +1.391732951135102e-01   -2.586715594059641e-01   -3.571090229826336e-01   +1.731594802443105e-01; -1.300790492384108e-01   +2.078548442761572e-01   -7.251661908577569e-01   -1.992740973209182e-01   +2.625466879720298e-02   +1.269732165264492e-01   -3.171515563009557e-01   +3.254849303928140e-01; +1.302254531113661e-01   -1.215677634615374e-01   -1.989386125271613e-01   +9.025083124250066e-02   +2.649144488899257e-02   -2.878339883024810e-01   -1.479311449892650e-01   -1.916802474400148e-02; -2.794876864851267e-01   -1.643021652285479e-01   +2.320006563078882e-01   +1.279161354184352e-01   -2.617159363220405e-01   -8.073343760708687e-03   +5.543103946009044e-02   +1.774166641968384e-03; -1.332257898046201e-01   -7.314747209171162e-01   -1.888320848804997e-02   -1.286096777898919e-01   +1.335233464264649e-01   +6.015414463984831e-02   -1.743760635111127e-01   +5.434221381324336e-03];
L1I_L2I_iGABA_netcon = [+1.781627176159281e-01   +2.606011746136752e-01   +7.459634804249128e-02   +5.311984447404537e-01   +3.318235155336782e-01   -2.882275562481505e-02   +4.219699889447693e-01   -1.449090310234623e-01   +2.649129997985222e-01   -2.559652706953318e-01   -1.509063226019799e-01   +4.148536833195932e-01   -1.431149584174395e-01   -4.936333592094613e-01   +2.586738124819353e-01   -2.307128100922773e-02; +1.547570056767372e-01   -9.583709835698986e-02   +6.201359723661404e-01   -4.266598193190742e-01   +4.132078098934123e-01   +3.139859115155915e-01   +7.052447035822704e-01   -4.537024572131789e-01   +1.414171904037418e-01   +6.688259941904856e-01   -5.233524957356027e-01   +4.877478431342746e-02   -6.384542292409615e-01   +3.584196375651522e-01   +2.105962524584362e-01   -5.351237119719889e-01; +1.267143880196568e-01   +4.394741731454067e-01   +8.865716350844771e-02   +5.701355108319097e-01   -4.224775301585204e-01   -2.427305449634028e-01   +3.031689202629394e-01   -1.692286257533803e-01   +1.377938346123340e-01   +5.714267021490254e-01   +2.693114056224249e-01   +3.953362186686067e-01   +4.662268187964585e-01   -4.305290081590384e-01   -9.309831148774983e-02   -1.739812992341800e-01; -4.633325413128090e-01   +3.598486589944181e-02   +3.258748009566644e-01   -6.516553825673328e-01   -5.619494684535612e-01   +3.209035874386861e-01   +1.925133305754301e-01   +3.687339815452731e-03   +5.075907291136411e-01   -7.580903932571745e-02   +1.454883636733186e-01   -1.964725925654821e-02   +2.349516900808214e-02   +1.132197195220446e-01   -2.320444033419524e-01   +2.920236607761002e-01; +3.017846850486143e-01   +4.814320616487998e-02   +2.219423072497721e-01   -7.969481178115093e-03   -6.428373414527937e-01   -4.040697874131007e-01   -2.935571794983278e-01   +7.275476511097932e-02   +1.864067110237962e-01   -3.172292092997472e-01   +4.639247785801331e-02   -4.958722430570651e-01   +1.420790959711297e-01   -5.676681551363283e-01   +3.197988540939591e-01   +4.417008999619545e-01; -5.874663682295208e-02   +1.455317897219413e-01   -1.290348560123186e-01   +4.531906144052734e-01   +1.775951541194380e-01   -2.119690630295557e-01   -3.264223477477169e-01   -4.947974879707717e-03   -2.947000677998003e-01   +3.033892132209851e-01   +7.135625047743838e-02   +3.389799584216958e-02   -2.274237374576975e-02   +8.226600252227108e-02   -1.954817390763669e-03   -1.980537099031813e-01; +1.234984042699216e-01   -2.741183191488449e-02   +1.022727814942300e-01   -1.972527025520693e-01   +9.699066161752894e-02   +2.541837955269182e-01   -9.813467318197214e-02   -3.990331817205142e-02   -2.425368185100381e-01   +1.250758131921825e-01   +3.003681837445149e-04   -7.436646061997430e-01   -4.679986802338880e-02   -2.770835395707465e-01   +2.705108569355288e-01   +4.042097330056438e-01; +4.775603129402216e-02   +1.503312419463010e-01   +3.102356260372455e-01   -2.301983799012161e-01   +9.241700900381658e-02   -3.075424129624749e-01   +2.140959727088558e-01   +4.082679093277208e-01   +3.755503856486082e-01   -4.250385461127851e-02   -2.947620138257399e-01   -3.038826949341750e-01   -6.547351701417871e-01   +5.324034288922456e-01   +5.241302591756625e-01   +1.126081882147021e-01];
L2E_L1E_iAMPA_netcon = [+1.664141187580712e-02   +3.220970773905846e-03   +3.066730097908191e-01   -3.058659149167480e-01   -4.480761738799362e-01   +1.223671835526227e-01   -1.028727918833777e-01   -5.668432603541277e-02; -2.917913565152664e-01   +5.569618807725758e-01   -1.160118163889948e-01   -1.249672830451947e-01   -3.945320046319339e-01   +8.917361155306283e-02   +1.860730868288006e-01   -1.397042579491923e-01; +4.820846290981723e-01   -6.166013165302493e-01   -3.222087474878687e-01   +4.470520198203225e-02   -5.516874659007134e-01   +3.403816436572236e-01   -9.253573935007725e-02   +5.536084952748687e-01; +2.301030925400206e-01   +2.007290936765640e-01   +2.027440707723790e-01   +3.239653175237205e-01   -2.686937411425000e-02   -5.156936494432587e-02   -2.656458563036806e-01   +4.262235691044819e-01; -1.484582717096617e-01   -5.912732330574007e-02   +1.649677806665797e-01   -2.167580147240466e-01   +5.187519378455870e-01   +2.145984863165507e-02   -1.353435889333284e-01   +1.731999813372158e-01; -1.668295941900267e-01   -1.259930380220588e-01   -6.422892622937147e-01   +5.224947108755583e-02   +4.317834553160965e-01   -3.038249968741927e-01   -4.074069440593438e-02   -2.572199391344952e-01; +3.386447993926323e-01   -5.376396407939718e-01   +5.671789037781845e-02   +9.898331193654288e-02   -1.570376819557736e-01   -1.158732289199695e-01   -2.191238165114133e-02   +4.817399779286676e-01; -2.752120932140875e-01   -3.664857099374672e-01   -1.564620104319120e-01   +4.539207814482754e-01   -2.022016394055960e-01   -6.232564726522765e-01   -1.696759174068811e-01   +3.104452013924177e-01; -2.062142537932385e-01   -2.465803842696135e-01   +3.423032442009371e-01   -1.122990818708286e-01   +3.429252027244684e-01   -2.714627133016244e-01   -3.978843334020564e-01   +4.332358248785241e-01; -2.194464204970293e-01   -5.204642158742245e-01   +1.736416825758031e-01   +3.195222311699643e-01   +3.910358777180721e-01   -2.438657808120147e-01   +2.025011651681039e-01   +2.477677262380111e-01; -3.864166384302488e-02   +3.960774377700362e-01   +1.205162626232885e-01   +4.860235508449983e-01   +2.011288998516028e-01   +3.643653717266438e-01   +2.203648547595534e-01   +1.826316917280204e-01; -3.670692084527420e-01   -5.279846210124052e-01   -2.671198003421114e-02   +3.908897495483906e-01   -1.477536504500538e-01   -4.907223271789435e-01   -7.115090862831654e-02   +1.069276925031176e-01; -7.610730724767862e-01   +1.204916947092039e-01   +2.865330935073880e-01   -1.792672591008850e-01   +1.202965913934732e-01   +1.876254809808648e-01   -1.858753346605069e-01   +2.155372802124423e-01; -3.061625607760826e-03   +5.509746209039419e-02   -2.460699320322490e-01   -6.843722576241429e-02   +2.805101661082735e-01   +1.015149020624674e-02   -4.180148315060759e-01   +4.631800238272766e-01; +6.737047822878928e-01   -2.564962059845904e-01   +2.307396055623477e-01   +1.421559081908105e-01   +4.449853366621581e-01   +4.615485377420758e-01   +1.274355434123245e-01   -2.223139252163230e-01; -4.813412764498041e-01   -1.510533314287816e-01   +6.107842428261011e-02   +7.961713798567288e-02   +1.364494873653424e-01   +1.863423891444625e-01   +4.807945400066670e-01   +4.114350111118908e-01];
L1E_L2E_iAMPA_netcon = [-1.075199308170205e-01   -4.703354771978005e-01   +4.956842814355928e-01   +3.999215043745469e-02   +2.931681616792286e-01   +6.680738387751702e-01   -1.207843122173722e-01   -3.370145930672674e-02   +2.245577321335661e-01   +1.394792201074698e-01   -7.225172787055660e-01   +2.594908198600148e-01   +3.379696600667741e-01   +3.605139153694009e-01   +6.412603019126940e-02   -2.045686222270773e-01; -1.283901662494558e-01   -8.868164443378587e-02   -2.338571362351290e-01   +1.005652521158005e-01   +5.004755750495570e-01   +3.814411437425174e-01   -5.952387976100268e-02   +5.262136545301380e-01   -1.900034411317476e-01   -6.158681185023910e-01   -1.552476572670925e-01   -3.998252387858464e-01   -7.729556505996907e-01   -5.344792801898561e-01   +6.349169666174864e-01   -5.220054377561697e-01; -3.858060060566849e-02   -2.148629199286176e-01   -1.162960908377031e-01   +4.815650220674860e-01   -1.861610609492998e-01   -2.035246741411136e-01   +6.796268419853553e-02   -5.038372681411307e-01   -4.684060743812630e-01   -5.850983393127902e-01   -2.320960057092550e-01   +2.529684084012397e-01   +2.010493626762367e-01   +3.605099482097122e-01   +1.903423417034215e-01   +6.827709144903145e-02; -1.079477913076496e-01   -5.235361067497969e-02   +7.651007344113887e-02   +5.971524620870174e-02   +3.454041785808963e-01   -3.460725271659669e-01   +1.592829540385164e-01   -4.781015516078460e-01   +1.475441229312156e-01   -6.935712137079950e-02   +7.863302073036063e-01   +7.685360754678396e-02   -3.025906595455348e-01   +4.960103278202883e-02   -4.066545959388145e-02   +7.743903821410940e-01; -5.636996196350407e-01   +3.297946070865355e-02   -7.716050061980650e-02   +2.132287797467012e-01   -8.253369873234735e-01   +1.419728562216468e-01   +2.623381753011372e-01   +6.531576610813330e-01   -6.431102810042331e-01   +5.130586120343781e-01   -1.226672607188919e-01   +4.928387858871213e-01   -5.119412781830474e-02   -1.539154160971655e-01   -2.707436572222051e-02   +2.516382423680880e-01; +6.082314513956869e-01   +9.612079723031346e-02   +1.008953946043332e-01   +5.627212194497899e-02   -1.756905252590828e-01   +1.218352879308596e-01   -2.198622300490134e-01   -2.741793060485385e-01   +6.394240289827616e-03   -1.396240242036981e-01   -4.294695487864433e-01   -4.827596261461019e-01   +7.727034018719260e-01   +1.303028240019549e-01   -1.016905980348394e-02   +2.989351404370492e-01; -3.337355213283231e-01   -2.901725539795385e-01   -2.902905475352551e-01   +2.169190563052571e-02   -4.649506505375788e-01   +9.645393088462598e-02   -1.254136014981601e-01   +1.124558362202058e-01   +3.811348588724222e-01   -5.078899753312739e-01   +5.298855417145901e-01   -1.933007066860505e-02   +9.348284261018313e-04   +4.819840926132017e-03   +9.873214917504881e-02   +1.790762009609901e-01; +6.747181985933421e-01   +2.193732168514972e-01   -7.263018204462464e-01   -1.147933459252403e-01   -5.661039039781233e-01   -5.750819824803109e-02   -4.133890658351259e-01   -5.401638146049667e-01   -4.426048634623390e-01   +5.452084286048747e-01   +2.038367501877262e-01   -9.164337928933122e-02   -2.380343918198829e-01   -5.685040196689701e-01   +4.001802763251169e-02   -8.137404596702431e-04];
L2I_L2E_iAMPA_netcon = [-1.173086161612180e-01   -5.086492026869635e-01   +2.355317602458349e-01   +6.189460668459619e-01   -1.186587905933887e-01   +3.094236074144671e-02   +9.897689941417168e-02   -2.811928811081759e-01; -3.274187669295371e-01   +1.924939269720724e-01   -7.996247132648502e-01   -1.322545257684510e-01   -2.216580890175591e-01   +5.927157706313526e-01   +2.386312568573684e-01   +1.170310735658368e-02; -3.895723969002954e-01   +1.367641906049871e-01   +6.129090048998866e-02   -2.398096323500919e-01   +1.505469155054966e-01   +2.580053196279040e-01   -5.021004996164156e-01   +2.848319901242715e-01; +2.236822922889878e-01   -5.731109027387713e-01   -1.930667039668194e-01   -2.087066335022536e-01   -2.811469122338506e-01   -2.146944813494082e-01   +2.312553023529454e-01   +1.069231717084425e-01; -4.798518573647695e-01   +3.278296601411073e-01   +5.790931771690594e-01   -1.139908017302136e-01   +1.562102697267140e-01   -4.528732581266469e-01   -4.191594986519230e-01   +2.329873142958537e-01; -3.960854822674916e-01   -1.778428768909210e-01   -4.745189028244792e-03   +9.513929425001544e-02   -3.021143241430554e-01   +1.185931897246254e-01   -3.454759973664497e-01   -2.277706122484966e-01; -1.077581145641788e-01   -5.125043147783825e-01   +4.128329603481566e-01   -2.798512815666194e-02   -5.232669022958126e-01   -7.071667597102982e-02   -3.574809181357394e-01   -7.200834342130690e-01; +1.340390068005293e-01   -4.826790995757423e-01   +3.068794375568030e-01   +4.555151345977191e-02   -6.817720825463308e-03   -1.682864069139661e-01   -1.815998950345223e-01   -2.437083815352294e-01];
L2E_L2I_iGABA_netcon = [-1.465457803843512e-01   -2.908079621745951e-01   -5.281351207850150e-01   +6.851169785428907e-03   +2.354413269731452e-01   -2.938954936465036e-01   -1.448893102571814e-01   +3.254874396203609e-01; +1.306336299050858e-01   -1.031471450857464e-01   +1.976273101974829e-01   -1.225491251937915e-01   -3.685895610862830e-01   +2.195973057069979e-01   +2.051920513480394e-01   -2.435134121060706e-02; +7.119059574334660e-02   -3.033993796379835e-01   -5.149469436127482e-01   +1.491490661533451e-02   +2.096716227454388e-01   +1.526361139051269e-01   -1.353948208052302e-01   +2.153468162951301e-01; +2.704770448785276e-01   +4.771747079552440e-01   -4.076644252504855e-01   +3.370249513138859e-01   -4.001094872877096e-01   -2.907574313015377e-01   +1.261257837789379e-01   +2.303539617133915e-02; -1.357112006090945e-02   +2.096360456857607e-01   +7.790141287067549e-02   +9.030967602480985e-02   +4.262415826446320e-02   -7.416839336206852e-03   -8.323117060541044e-01   +3.613431884915202e-01; +2.924789801072704e-01   -2.095041662191137e-01   +2.471831706869692e-01   +2.690759485270248e-01   +9.893588827901195e-02   -5.454573758044390e-01   -1.061653425720855e-01   -1.007435059612987e-01; -3.373855766622438e-01   -1.483980805905890e-01   -2.837795883723284e-02   -5.698494433177987e-01   -3.696816457197633e-01   -5.841341632480031e-02   -3.690981979146899e-01   +1.197494358579357e-01; -4.469585516847199e-01   -2.468311377785443e-01   +6.985336627934278e-01   +6.325440363957892e-02   +6.344090815263228e-01   +1.122628569575543e-01   -2.301407602841982e-01   +7.961519566323209e-01];
L3E_L2E_iAMPA_netcon = [-3.151322956488256e-01   +2.064869127628998e-01   -3.928488105312957e-01   -3.610711430809131e-02   +3.239354649718630e-01   -4.274964625730493e-02   -4.285029619648830e-01   +8.048353282356124e-02   -9.937120952800285e-02   +1.966797605201144e-02   +2.353887463975360e-01   +6.206205211587623e-01; +2.173296500260931e-01   -3.224713578446675e-01   -1.649761720128462e-01   -3.639293742142732e-02   +3.348583895257995e-02   -6.878183044884859e-02   +2.584835228644798e-01   -1.125493631526332e-01   +5.742591189047928e-01   +1.493879266283376e-01   +5.008276240596251e-01   -4.153191289828740e-01; +3.859152335766596e-01   -3.059042630611937e-01   -1.368352938734134e-01   +2.627573089126929e-01   -4.213186463083362e-01   +1.236228110942531e-01   +5.600364521311921e-01   +6.077857808853039e-02   +2.093043587140515e-01   -4.508480023293232e-01   -5.689124297661812e-01   +1.528586156790852e-01; +5.302495847480545e-01   +1.968378580253638e-01   -2.002238580829842e-01   -2.323599885135885e-01   +2.137800775433497e-01   -6.646320071397234e-02   -3.986886023671992e-01   -1.551419327114595e-01   -4.143223736213984e-01   +7.523162123883841e-02   -3.170130229989725e-02   +2.413183372284188e-01; -6.008187008505580e-01   -3.526504735505439e-01   +1.710571459005981e-01   +6.457582740687717e-02   +6.183949848362907e-01   +3.748834258887632e-01   -5.878245454099083e-01   +4.667700133786928e-02   -3.786073694391702e-01   +2.052577804341014e-01   +9.745263816813449e-02   -2.362041698043553e-01; +5.294583567917006e-01   +3.056320682608029e-02   -5.031938131331489e-01   -6.721797680307932e-01   +1.430475651067471e-01   +2.017696347348582e-01   +2.143933345963035e-01   -3.140599777870907e-01   -5.546909718773855e-01   +5.426554118466060e-01   +4.423980469444694e-01   +2.395141297797312e-02; +3.304034641612226e-01   +2.982066128985040e-01   +2.712483863999509e-01   -4.468111980552010e-01   -7.674985056526880e-01   -3.814093697546335e-01   -4.967526218757783e-01   +2.703358207244093e-01   -4.193975786067741e-01   -4.899233940962606e-01   -4.662420239803992e-01   +4.726897747264757e-01; +6.369767037726094e-02   +6.767468654019718e-02   -2.579264174419910e-01   +3.612224877046251e-02   -5.983610832622434e-02   +5.168520094838205e-01   -2.332394866684098e-01   -4.306548095618726e-02   -3.637504597412036e-01   -1.621043571164630e-01   -2.342172684734755e-01   +4.394571066529332e-01];
L3I_L2I_iGABA_netcon = [+6.598673901245314e-02   -4.196434521207635e-01   -8.857662103567993e-02   +2.695108357215139e-01   -2.250177171799053e-01   +6.951122792967332e-02   -6.357154587323612e-02   +1.490693433057674e-01   +1.979544465384148e-01   -2.526390776487558e-02   +3.124533553445825e-01   -5.778819921379774e-01; -5.308759285905881e-01   +1.171551550724440e-02   +2.027339098931369e-02   +3.785261496494325e-01   -2.661443688900249e-01   +1.150724576847360e-01   -1.335693351913783e-01   +6.003316280437117e-01   -6.689373710145526e-02   +2.009967788764933e-01   -1.235815791628415e-01   +8.921891354445606e-02; -8.280631853969053e-02   +2.974818640769010e-01   +8.839435794158810e-01   +8.218846136813211e-02   +3.919079022970491e-01   +4.607567581472234e-01   +4.203312000221852e-02   +2.744699796804537e-01   +7.887190794521670e-02   +2.672834419619344e-01   -4.245472119316575e-01   +4.911404269522625e-01; +5.535946563645983e-02   -5.006019175138271e-01   -4.025304048453592e-01   +3.307954467258927e-01   +4.409925138750774e-02   -1.109036668706405e-02   +7.626880604134377e-02   +2.276176700442263e-01   -1.974444742335423e-01   -5.522566200376563e-01   +3.382877159246771e-01   -5.145687297848923e-01; +2.481877408247894e-02   +1.368793578042933e-01   -1.535513787683066e-02   +4.622344712579650e-01   +9.072791678847042e-02   -6.125374136415339e-01   -6.034333016223079e-01   -4.212567811510379e-01   +2.571352850173133e-01   -3.052828743857177e-01   -1.170031582336535e-01   -2.306715464990279e-01; +4.784122056832768e-01   +3.175850303056196e-02   +1.024209113108936e-01   +3.531156020843300e-01   -3.852019823353624e-01   -1.702195900566859e-01   +7.051386599592392e-01   -1.884419536753487e-01   -7.015332860374157e-01   +1.217277619685553e-01   -7.044830071936010e-01   +5.389043947196627e-01; -1.796843454675367e-01   -2.165643065851857e-01   -6.324668702409622e-01   -3.273506999476624e-01   +1.149708096896062e-01   +3.968431202096891e-02   +3.580471446299901e-01   +6.605193952485321e-01   +5.341067924453276e-02   -5.389234334447689e-02   -1.716803123969106e-01   -5.039059229459827e-01; +9.203859206042436e-04   +2.035072206118643e-01   +2.733472181810986e-01   +7.302013722389822e-01   +5.446619443688538e-02   +3.138485045173035e-01   +6.139953780941512e-01   -6.309133141344188e-02   -5.002540446255588e-01   +3.120898959655081e-01   +8.842225613706244e-02   -1.535713010772218e-01];
L2E_L3E_iAMPA_netcon = [+3.579470091591201e-01   +1.295190886743240e-01   +6.969250721691984e-01   -4.307615630227309e-01   -1.649010626088728e-01   +5.266323400802811e-01   -3.044047699019475e-01   -3.652816413269774e-01; -5.181451209644615e-01   +3.149062920930034e-01   +2.735055480909232e-01   +7.142554028151957e-02   +3.839749020310715e-02   -4.648171500183434e-01   -2.185782938127653e-01   -3.667145637676936e-01; +2.029641201323838e-01   -3.331757295547302e-01   -2.057215623089436e-01   -6.638674818411969e-03   +1.727307439238448e-01   -2.886919663269420e-03   +8.061710854862118e-02   +7.260563438639374e-02; -2.851596743493441e-01   -2.175424529647206e-02   +1.245205074473932e-01   +1.131950092840891e-01   +4.724761782656836e-03   -7.053233989124046e-01   -2.501895588038380e-01   +1.727832275096781e-01; +3.072417818953938e-01   +2.308842045679130e-01   -3.812023012093694e-01   +2.550584770190030e-01   -3.482520807935170e-02   -8.272438296462543e-02   +1.318465135992030e-01   -1.570056881878782e-01; -3.906843729672546e-01   -3.287101340748211e-01   +4.293209737148381e-01   +1.901450835974478e-01   +1.277854676065275e-01   -1.508492462233401e-01   -3.279618848312739e-01   -5.532083266072966e-01; -1.421827485481048e-01   +5.847577028134566e-02   +2.728955646164377e-01   -2.910188661705764e-01   -7.626146469443755e-02   -1.920252640233245e-02   +3.769181625986320e-01   +2.093797619398772e-01; -6.590990178003557e-02   -5.793542929310893e-02   +5.790689579117085e-01   +1.517926409468164e-01   -1.686266712562779e-01   -1.291495936176619e-02   -5.426337397416432e-01   -4.719664287980663e-01; +3.226936363993642e-02   +2.247043123791311e-01   +6.189293193790590e-01   +1.101007575569143e-01   +1.808312581025108e-01   -2.288719101539411e-01   +2.281161756769461e-01   +3.362800013554151e-01; -4.179727402467133e-01   +3.793902866123979e-01   +3.345918831017546e-01   +3.139023958212948e-01   -2.137991476534535e-01   +2.083474332085510e-01   +1.303978240724290e-01   +2.873717975430422e-01; +2.593808992673123e-02   +4.692771686076813e-01   -6.410171171651784e-01   +1.000136120640048e-01   +3.545319563366069e-01   -1.221922525799379e-01   +3.975812795997274e-01   +3.232310487938054e-01; +2.888580068147967e-01   +6.445914458541188e-03   -7.643680116793242e-01   -4.863674263087178e-02   +2.777407508740404e-02   -5.011333197917946e-02   -6.630649758773004e-01   +4.390009585577985e-02];
L2I_L3I_iGABA_netcon = [+4.297315283797160e-02   -4.490800684469768e-01   +8.524492109127972e-02   +3.097972626066138e-01   -3.206655132868590e-01   -3.607446815079429e-02   +9.619282896079726e-02   +5.306599622920543e-01; -2.729835055261914e-01   +5.433971357711557e-01   -4.669923591913835e-01   -7.156489985039175e-01   -7.688981972688481e-01   -5.938105649152310e-01   -3.409849643243150e-01   +2.766638139321122e-02; +5.960621991991127e-01   -2.844241442697941e-01   -6.180530744186136e-02   +4.515066334892977e-01   -5.213715983311111e-01   -4.668707238663063e-01   -2.336261635135487e-01   +2.979403690485390e-01; +2.185644391063548e-01   +1.701060989688804e-01   -2.004373199505488e-01   -4.407198100023666e-01   +1.916122879454990e-01   -6.544682949497443e-02   -2.858287504128063e-01   -3.987747953829190e-02; -3.009768495013615e-02   +6.174079702364741e-01   +5.063774583803993e-01   +6.412622136001187e-01   -2.155227361396629e-01   +3.837163395500045e-01   +5.079155980118715e-01   +3.281681926207479e-02; -5.460253587350963e-02   +4.764864514495462e-01   +2.595496122150844e-01   -3.330602096908948e-02   +6.792897502791728e-02   -4.781524990762403e-02   +1.682666457051314e-01   +2.396694620899894e-01; +5.978608372348184e-01   +3.858969668538911e-01   +6.689430439459573e-03   +8.767229498271711e-02   -2.744806119607701e-01   -8.934571445610802e-03   -3.316677359646282e-01   -1.228845444442969e-01; -4.323076818176774e-01   -4.349620835965004e-01   -2.274362362471827e-01   +3.460911019346463e-01   +1.913892349275052e-02   +5.479940237994319e-01   -5.729695450188126e-01   +9.923780003477889e-02; -1.524163768449604e-01   -1.692263556168283e-01   +1.932762294692693e-01   +6.036229722636385e-03   -2.948781010663378e-01   -1.409226061095468e-01   +3.841654446781801e-01   -2.548098867379193e-01; -4.813701810263175e-01   -6.698589520107717e-01   +2.464379877845529e-01   +5.254962590926061e-01   -5.340420675393818e-01   -1.332144380421493e-01   -5.615742421124185e-01   -5.095248177552655e-01; +5.703625443252160e-01   -5.080433922063146e-01   +7.234298978394293e-01   -1.970707482549509e-01   -1.837695094460680e-01   +3.037578105891890e-02   +2.164984716874769e-01   +5.130511164334125e-01; +1.534296498889445e-01   +1.783143733231544e-02   -4.843858468703250e-01   -1.625683747173223e-01   -8.489769322876326e-01   -4.101921421605536e-01   -2.725456593888563e-01   +5.719579118429309e-01];
L3I_L3E_iAMPA_netcon = [-5.598588827875604e-01   +7.092024230515409e-02   +6.890539496549462e-02   +4.483425320830021e-01   +8.755138990937900e-02   +2.626587924354726e-02   -2.490391597600265e-01   -2.298813063483614e-01   +2.930485342722475e-01   -2.141754459930819e-01   -8.024079639407411e-02   +2.582220458286927e-01; +1.256989873420946e-01   -4.580516457609822e-01   -1.217855078616065e-01   +2.535388717427141e-01   -7.266318924137302e-02   +2.810356473319143e-01   +3.874689081271726e-04   +1.619273465170248e-01   -1.347929087418090e-02   +6.126569372269638e-01   -2.870693863553172e-01   +4.772228622571272e-01; +2.308383745582261e-01   -3.632650270893609e-01   +4.004327502653466e-01   +5.099860363678979e-01   -4.049487575080549e-02   -2.109733617171662e-01   -1.166647315083202e-01   +2.085060859712767e-01   +2.977537398260247e-01   +5.649469703400267e-01   +5.272578325872626e-02   +1.593632618554652e-01; +2.762273768012758e-01   -6.456758983472959e-01   +4.106073118685024e-01   -2.185252618926042e-01   -9.829629079656024e-02   -1.281607237189096e-01   +2.334929937024265e-01   -2.186414429628703e-01   +4.323009212629026e-01   +5.126805698199066e-01   -6.681262076852268e-02   -5.177794430072605e-01; +4.122343819769808e-01   -4.781913001003648e-01   -6.671387361254996e-03   +2.373983499046916e-01   -4.564857771621498e-02   +1.448933864107187e-01   -3.202496891328773e-01   +8.362958822624569e-02   -1.901819589998723e-01   -5.172220634272303e-01   -1.908028915947848e-01   -7.205649704041260e-02; +1.839674819946047e-01   -2.051987615193543e-01   +4.401532861704389e-01   -4.167257412804926e-01   +1.258488626155231e-01   -6.267552693390437e-01   -1.295484412180313e-01   -3.692177130853814e-01   -4.633153055120079e-01   -2.130706972427443e-01   +5.308936857377111e-01   +3.813568251937357e-01; -6.256086385885206e-01   -1.531841708066535e-01   -4.578531173877650e-01   -3.734772511031252e-01   +3.830894964101042e-01   +5.255527454929446e-02   +6.274658835792338e-02   +4.447142249475080e-01   +5.959700859552596e-01   -2.564515142007189e-01   +1.018786409425401e-01   -6.138190634970949e-01; -1.623008032165718e-01   +2.681636362403849e-01   +7.064783360210888e-02   +4.865472326089042e-01   +5.600891363268098e-01   -5.213050013262236e-01   -3.347671467454845e-01   -1.098199006717485e-01   +7.105021747781168e-02   +1.569892893633281e-01   -1.138303832847280e-01   +6.132081425437028e-01; +1.826432296844164e-01   -1.521028411328877e-01   +2.151583795416774e-01   -9.187800332072964e-01   +2.630923267886619e-02   -5.231207125908813e-01   +2.424671076512976e-01   -4.900083239005944e-02   +1.852474892989128e-02   +1.283161978191824e-01   +4.439598492969733e-02   -7.338453424777246e-01; -2.141204022009228e-01   -1.903247050195469e-01   +6.423043079227701e-02   -1.886215337853459e-01   -1.209450606136624e-02   +1.682830989639892e-01   +1.121399598809889e-01   +5.525384889050217e-01   -2.340591714543726e-01   -9.305376234390592e-02   +6.693911656632707e-01   -1.805051816898280e-01; +2.339735350129769e-01   +2.070908256522594e-01   -3.742151131934105e-01   +3.991750860451798e-01   -3.423099835527725e-01   -3.651463088700437e-01   +4.530521920320683e-01   -3.428736741927587e-01   -3.296844737716870e-02   -6.567065221921140e-02   +7.922794637161708e-02   +4.612713250959218e-01; -2.258229035723129e-01   -1.263205580783091e-01   -3.952496748701665e-01   +3.459873655087014e-01   -6.693293595174732e-01   -1.250143428380819e-01   -1.491249390022229e-01   -5.015174586041338e-02   -2.887353556043613e-01   +1.965010920938662e-01   -1.771695884949681e-01   +1.381064245373040e-01];
L3E_L3I_iGABA_netcon = [-1.989200229900630e-01   +3.293424025152814e-01   -6.289226651447365e-01   -8.556990622345041e-01   +1.015410471157589e-01   +8.174199349450197e-02   +4.635419142414484e-01   -3.488595077082495e-01   +2.606024665462207e-01   +3.459903767295621e-01   -4.109278040306596e-01   +4.835006677826757e-01; +1.103024106771221e-01   -4.791623141001203e-01   +3.249807598705954e-01   -3.924662124793321e-02   +2.049815650641421e-01   -1.213690313818940e-01   -7.291255812110227e-02   -2.638055190554118e-01   +5.520873475960988e-03   -5.167072214735224e-03   +2.100486834832332e-01   +1.245813806370297e-01; -3.180800418407417e-03   +1.345914116838700e-01   -3.587160913498984e-02   -3.091000770066697e-01   -2.321910869832316e-01   -2.603478737119499e-02   -5.160331460308185e-02   +2.243113930497243e-01   +1.174811228488913e-01   -6.179491461150307e-01   +4.223655274377383e-01   -9.778142158918607e-02; -1.740885612169620e-01   +9.048014942966558e-02   -2.737797727039892e-01   +4.074589506106333e-01   -4.244931470231442e-02   +5.676166242272834e-01   +1.103716689646352e-01   +1.697091488518106e-01   -4.286501738684406e-01   +8.692189685204052e-02   -3.078473683812630e-02   -5.010662269739778e-01; -1.733415520026643e-02   +8.293211051786638e-01   -2.267421298335859e-01   -8.167631249639540e-04   +2.605373956480261e-01   +7.085133047046814e-01   -1.453400989905768e-01   -1.366644702713533e-01   -4.022575938340230e-01   +2.458019357335489e-02   -1.575804668211306e-01   -3.803575854099721e-01; +5.787524625273839e-02   +2.126146518306185e-01   -8.742421578090112e-02   -4.292779024751810e-01   +4.163261077590889e-01   +5.686151524436790e-01   -2.518908766724608e-02   -4.597566097672141e-02   +4.629842460080473e-01   +3.468608109945773e-01   +1.382940903906915e-01   -5.539880630679489e-01; +2.911673449316071e-01   +2.370950614767236e-01   -3.562773329589721e-01   +1.377874988211281e-01   -1.471192774803083e-01   -2.140604860634072e-02   +1.914719162759786e-01   -3.944886849018251e-01   -8.262515791869665e-03   +3.547730276952645e-01   -2.313419043886021e-01   -1.103974462988328e-01; -3.232014919086230e-02   +5.388212673997587e-01   +1.344706917396407e-01   +2.104565714038826e-01   +8.613667825938288e-03   +6.902910917390841e-01   -2.090656522774803e-01   -1.958589621256206e-01   +7.954056163336827e-01   -1.422714044925803e-01   -3.904900725590800e-01   -2.171513951812439e-01; +5.478970007774370e-01   +1.883325444832791e-01   +1.657549018198692e-01   -7.252962785469579e-02   +5.099404171750759e-01   -7.419322157083379e-02   -1.037169946589347e-01   +2.838760358750888e-01   -1.717271455252392e-01   +8.037634441863750e-02   +1.429447742688552e-01   -2.086742581674502e-01; -2.426566680240149e-01   -3.989074683716568e-01   -9.403043751121203e-03   -1.726569324024998e-01   -6.555456294412479e-02   +4.363705419220513e-01   +3.257329180200889e-01   +1.186482295271733e-01   +5.741973868097239e-01   +3.721316141016149e-01   -6.310901072801003e-01   -2.683423809259454e-01; +2.837262992500147e-01   +5.151114480421624e-02   +6.311331071895782e-02   -5.529289071785243e-01   +4.193327322417334e-02   +5.036743990202219e-01   +5.603939847847292e-01   +6.694868385161665e-01   +1.135056450561128e-01   -7.038943772939343e-03   -5.216962269958537e-02   -5.333147557900584e-01; -5.010678245586725e-01   +3.791372961496219e-01   -3.053199948549243e-01   +5.930771759750423e-01   +2.287665804172503e-01   +4.102907980584177e-01   -2.500662762596354e-01   +5.585900893473531e-01   -5.442146748721112e-01   +1.347155630114601e-01   +1.644322408807489e-01   +2.651682676271686e-02];
L2E_Input1_iAMPA_netcon = [-1.446954318555984e-01   -2.332696125440000e-01   -6.093614520878425e-01   +7.433298890754088e-01   -2.807485256638863e-01   -6.814196869490342e-02   +7.270648913865280e-02   -3.193901358249365e-01];
L2I_Input2_iAMPA_netcon = [-1.480694703393796e-01   -6.962002558930505e-02   -2.141537080906315e-01   +2.707357080436843e-01   +3.580208852136897e-01   -9.038540176347393e-02   +7.838740842282093e-01   -2.881093276204412e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
