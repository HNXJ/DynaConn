function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.248534417667329e-01   -3.057883702757831e-01   +4.805966169154172e-01   +2.960924248224487e-01   +7.909286483067138e-02   +2.091658879886821e-01   -6.831265873312881e-01   +1.115981133567781e-01   +5.623016119728322e-01   +6.529006871549361e-01   +1.448889760644027e-02   +6.450687697331640e-01   +2.545528948644371e-01   -5.672082376297577e-02   -3.047030491320971e-01   +6.483106267690538e-03; +4.285497989453747e-01   +1.383627902513432e-01   +5.623728629097289e-02   +3.900772654205133e-02   -2.323304627529334e-01   +5.275843580372686e-01   -7.099039882487359e-01   +8.977714644431146e-02   +7.151845768041178e-01   +1.062985791701169e-01   +1.000000000000000e+00   +5.614504294061825e-01   +2.776428650892471e-01   -2.086999821489390e-01   +4.128422203620610e-02   -1.241523543750918e-01; +4.966800955945395e-01   +2.705768217819189e-01   -1.815714189047590e-01   +1.284178084564019e-01   +1.949837689430967e-01   +7.258099904150331e-02   +4.032443954615234e-01   +1.802621111074996e-01   +4.448402255504943e-01   +2.971421920582953e-01   +4.138038401508058e-01   +2.706920383656056e-01   +2.307304380830907e-01   -3.265808582466539e-01   -9.439148280015677e-02   +2.521122501416645e-01; -5.505706355831168e-02   -8.804383626201676e-02   -2.202373573798138e-01   +4.267337508197228e-01   -1.014096158161071e-01   +3.418004691300939e-01   +5.376129490827676e-01   +7.350416302159993e-01   +5.509330139825649e-01   +1.364412049750696e-01   +4.756768037108455e-01   +4.256974129772494e-01   +1.892868342414298e-01   +3.516001555699061e-01   +4.257614298454782e-02   +7.592495534040674e-01; +3.316387031485940e-01   +2.269052668919604e-01   +4.311871132210067e-01   +7.295104892418204e-01   +6.785364912396752e-02   +2.507548948450868e-01   +1.622210668253493e-01   +2.975515286493926e-01   -9.013271879837731e-02   +3.407870659619970e-01   +6.205898044584031e-01   -3.099974701016309e-01   +2.088907563577308e-01   +8.044907953992143e-02   +4.136079941431410e-01   +2.913131121694091e-01; +1.298674069033063e-02   +5.211816363270911e-01   +1.499297255431261e-01   -4.314107157769898e-02   +6.274990550611422e-01   +1.250075231933163e-01   +5.245756567333609e-01   +2.932071749717928e-01   +2.578555418745585e-01   +2.950501542972517e-01   +2.058365298513369e-01   -3.901783989276666e-01   +2.000988882247207e-01   +2.427050475332889e-01   -2.680193619521081e-01   -1.108073584214526e-01; +2.931497346526781e-01   +2.774699266245900e-01   +4.185957531189849e-01   +1.564511350681045e-01   +1.120619730430725e-01   +3.017421034529769e-01   +3.435173132204138e-01   +1.506033059868789e-01   -1.390649394938791e-01   +7.584842547655296e-02   -1.362068641374338e-01   +2.955605018191997e-01   +3.397796550413760e-01   +2.021945744547146e-01   +4.108281097250327e-01   +4.223733208287888e-01; +3.935452248172400e-01   +3.722442104416018e-03   -1.547293113830834e-01   +5.431539657134983e-01   +3.438522277395342e-02   +1.974714421358924e-01   +7.525639296745357e-02   +7.077229050876849e-01   +4.580339303783327e-01   +2.608465534513226e-01   +2.699159755072324e-01   +3.067406696010083e-01   -1.301870378305595e-01   +1.504910473977072e-01   -1.897053565074842e-01   +2.576072059191521e-01; +7.976822570408960e-02   +3.431408511774063e-01   -2.619299277658201e-01   +3.910278083627749e-01   +4.275738166661476e-01   +3.541291147796535e-01   +1.085575000783463e-01   -5.166155562885688e-01   +2.010683774737695e-01   -7.215746313166665e-02   +5.458912070477522e-01   -2.391296458109793e-01   +3.412226516657672e-01   +4.069272185416074e-01   -3.998808264653891e-02   +1.834063103097322e-01; +9.309602979978701e-02   +6.170875844108912e-01   +4.603496112454623e-01   +1.843875392914148e-01   +9.441109409653368e-03   -4.186950744545159e-02   +5.904616585473387e-01   -4.034251292606554e-02   +1.804799138750742e-01   +1.162799772589213e-01   +3.836567862014198e-01   +1.411017044822359e-01   +5.072640560799854e-01   -1.748596656428418e-01   +4.546306235992525e-02   +4.053025269548205e-01; +5.682368763942022e-02   +5.415658911826362e-01   +1.789921953979077e-02   +1.232569422363840e-01   +6.519186229559558e-01   +2.309821167867193e-01   +4.777918914356767e-01   +7.623395004115879e-02   +8.367882750842642e-02   +4.434569962841229e-01   -3.345994064751402e-01   +2.561139077081579e-01   -3.659065427643071e-01   +4.623559250993406e-01   +4.602540592935090e-01   +3.185142126440826e-01; +3.480948901803668e-01   +2.828682724639304e-01   +2.452808716451225e-01   -1.466555916320354e-01   +1.951063426552841e-01   +2.456115669891522e-01   +2.498826771109991e-01   +2.535494801381215e-01   +6.806485830238111e-01   +1.168407648033577e-02   +3.630633130467594e-01   +4.340667976869655e-01   +4.426593839201517e-01   +8.503782329364955e-02   -4.756773997831636e-01   +3.325181629621883e-01; +9.968420362081350e-02   +2.559841402751357e-01   +6.735142713278427e-01   +1.977266020396039e-01   +5.293272838802922e-01   +4.942862126362316e-01   +1.097453889209559e-01   +3.873270979965607e-01   +7.289298901599626e-01   +2.919682542444983e-02   +6.188301722749254e-02   +5.457618466258995e-01   -5.316158437721617e-02   +5.925929708923254e-02   +6.965998518516198e-02   -1.013423031517877e-01; -4.412746041172470e-02   +1.523852718484043e-01   +3.635497857640301e-01   -7.144365876134350e-01   +4.376922417056556e-02   +7.350491961030523e-01   +1.008762683289288e-01   +2.847823321022497e-01   -1.486368869170053e-01   +8.355445128118727e-02   +4.218733051897128e-01   +1.169854104183932e-01   +3.631184128290926e-01   +5.177570364366145e-01   -9.161918374566950e-03   -6.378524584518394e-02; +3.941430598611842e-01   -3.502325140647463e-01   +5.029818205597826e-01   +2.912599035056511e-01   -3.204916112648436e-01   +4.507744561159968e-03   +2.618188425680430e-01   -6.580148104019901e-02   +1.230585370290604e-01   +8.163054065830114e-02   -8.833543477633475e-02   +3.495853136468101e-01   +3.294753010325994e-01   +6.054989088211606e-02   +8.527673369122792e-02   -3.551711164304592e-01; -4.753615949919083e-01   +5.160438315990910e-01   +8.421372554502442e-03   +4.175911472705109e-01   +8.741116158081789e-01   +7.397199223174176e-01   +1.023880715277726e-02   +7.692941225405341e-01   -1.769675435863372e-01   +4.347018297483129e-01   +2.927956878282896e-01   +4.033741403723567e-01   +5.267619893154850e-01   +3.951389592982660e-01   +5.914465526687414e-01   +7.434130049812807e-02];
L1E_L1I_iGABA_netcon = [+1.482224303045430e-01   +1.129898746852704e-01   -4.093163155980125e-02   -1.717126083059309e-01   +6.934100376837992e-01   -1.322320564464094e-01   +9.036523134528063e-02   +2.814313359752014e-01   -1.330473863552391e-01   -1.519681789051844e-02   +3.799579682689850e-01   +3.704454678539867e-01   +8.096252763509925e-01   -5.320867142419926e-01   -2.515223638771166e-01   +7.036709619989659e-01; -4.561002620685853e-01   -1.321194178086713e-01   +5.182814767338819e-01   -4.147163284538671e-01   +2.198373438454805e-01   -3.648186744973535e-01   +4.521018562189602e-01   +4.523806978197207e-01   +4.645053778658632e-01   +2.161907312869735e-01   +4.760060721448490e-01   +1.185762269568415e-01   +6.603998669826411e-01   +1.810077957719869e-01   +1.709328383825690e-01   -5.333804846708172e-02; +1.633269640215031e-01   +1.497733560879192e-01   -1.658272562791536e-01   +5.351077917107000e-01   +1.556298471786164e-01   -2.412349357769449e-01   +1.725212514559556e-01   -4.858673873526613e-03   -2.965628022810267e-02   +7.808070467524346e-01   -7.932323761726182e-02   +3.023273180757157e-01   +1.175202188145494e-01   +7.171914487193079e-03   +5.605035011623877e-01   +2.907073219757703e-01; +4.265073672794379e-01   -1.399822679416599e-01   -8.699792430899132e-02   +3.635777715063145e-01   +2.083859119802433e-01   +4.425456559677572e-01   +1.739945295111430e-01   -1.857513166366248e-01   -4.711950348692144e-02   +2.355583433424161e-01   +3.274873471537010e-01   +5.997212288250201e-01   +2.380674919161380e-02   +3.768298757803921e-01   +1.612967371711507e-02   -2.721148769221428e-01; +1.436092509331523e-01   -8.529333974000818e-02   -1.336539219773361e-01   +2.860338024927919e-01   +2.541649973381073e-01   -1.157082469806312e-01   +1.222158652882205e-01   -3.570343140903312e-01   -8.403811842125819e-02   +2.479367766387890e-01   -3.909612395415244e-01   +7.124988115757982e-01   +1.489619295854973e-01   +1.994036203416951e-01   +5.821361718139225e-02   +2.925858310499808e-01; +1.874272946968002e-01   +1.379675302138563e-01   +1.425131712461673e-01   -1.726505819612382e-01   -4.249398261281196e-02   +7.386272991383989e-01   +1.296962186596156e-01   -5.332269458018850e-01   -2.078437194980758e-01   +2.190584141397088e-01   -2.222977106631636e-01   +4.382143882617840e-01   +7.650376821654684e-02   -2.955371008279435e-01   +4.801444429522449e-01   +2.838948666998345e-01; +6.097000690745725e-03   -1.091185167567257e-02   -8.175948590567104e-02   -2.464747022481510e-01   +4.870301458120447e-01   +2.504806119427802e-01   +1.077517804922008e-01   -2.307280610830583e-01   +5.979438680105776e-02   +3.852336991299186e-01   +5.255128575121576e-01   +3.654240933126268e-01   +2.070546196337546e-02   +7.383765606322104e-02   +8.445890282852758e-01   -3.510116768113934e-01; +9.338368743273809e-02   +2.633659021275201e-01   -7.688603609080763e-02   +1.326186120597670e-01   -1.527088274253352e-03   -1.998366808944128e-01   +5.012121080825038e-01   -6.545501158924399e-02   +7.355184006539368e-01   +2.245511688866574e-01   +1.398103698785639e-01   -3.905578353757186e-01   +1.986880378455706e-01   +3.167130666630108e-01   +3.375982927792658e-01   +3.272744976952938e-01; +6.566763407047859e-01   +8.780965682471188e-01   +2.567544336297786e-01   -1.557790278362200e-01   -3.891369171999467e-01   +2.845139526549484e-01   +3.053303318653089e-01   -5.198094697551491e-01   +2.394083238073242e-01   -1.216956249976651e-01   +2.276759822794416e-01   -2.206678415081964e-02   +1.190094968739059e-01   -9.279002335191530e-02   +8.402369936446680e-01   -1.027212792275791e-01; +3.552587796249239e-01   +4.468786246272835e-01   -6.682988192702653e-02   +1.547320325008130e-02   -2.173679854510417e-01   -1.656368474730720e-02   +3.304857110171079e-01   +2.266241604513526e-01   +3.788290100797878e-01   +2.040875339000635e-01   -4.672585583950067e-01   -2.349320464484517e-01   +4.521851279396885e-01   +5.244800664715019e-01   +2.850905461569512e-01   +2.382926821221430e-01; +4.106390002930410e-01   +1.983833317674449e-01   +3.319925236170955e-01   +4.686281475926853e-01   +1.635293758369334e-01   -5.096433357099815e-02   +7.384895852514459e-02   -9.832114884447636e-03   +3.054486464729350e-01   +2.442799377336824e-03   +7.649486920588264e-02   +7.866387025834631e-01   +7.534825049641369e-01   +1.971269197692860e-01   -4.653663973751583e-02   -4.436887732115901e-01; +2.144632116438235e-01   +2.701349996508339e-01   +3.203950877761014e-03   -5.073637086515692e-01   -1.313135646582105e-01   +1.382855602116908e-01   +6.456992493891697e-02   +6.037791725046329e-01   -1.930813998538899e-01   -2.284338262139057e-01   +2.785082473175272e-01   +3.538207203096946e-01   -9.046567685498350e-02   +1.081500350904406e-01   +3.518942693633637e-01   +5.053169851863800e-01; +2.559845509549920e-01   +2.720984702712717e-01   +1.661789090638721e-01   +6.103244288856974e-01   -2.699126000367124e-01   +3.686899866212529e-01   +1.085963143972498e-01   +3.821033342240037e-01   +5.055762029198122e-01   -2.363071596386520e-01   +1.792966475181808e-01   +2.903768966376230e-01   +2.893718485747143e-01   +2.357546545397148e-01   +6.407762443624735e-01   +2.275380033100133e-01; +5.117048683130128e-01   +5.804271551214568e-02   -1.202605728997572e-01   +1.108981078839592e-01   +9.088588446532564e-02   -3.136065210203824e-01   +1.249191077740015e-01   +2.797061692635500e-01   +3.585498700300113e-01   +1.155672863007856e-03   +5.140696393542051e-01   -2.094614122747074e-02   +2.074383314313329e-01   -8.489381045092970e-02   +2.321042538843121e-01   -4.456544816690112e-01; +4.050054451527347e-01   -5.573501603715673e-03   +5.262365591541503e-02   +6.352732565666065e-03   +1.426802628344779e-01   +1.364909928276960e-01   +4.116764282027451e-01   -4.306568734191306e-02   +5.969569549030177e-01   +8.381417106406573e-02   +2.002220290771677e-01   +1.562078820879339e-01   +2.276655034882548e-01   -2.730679973699420e-01   +5.862310785040189e-01   +6.090755127004875e-01; -4.549785377096955e-01   +2.871646050154906e-01   +1.359779940529673e-02   -2.261305322927459e-02   +6.309214619978791e-02   +4.289824843043221e-01   +1.560813902795347e-01   +1.748834204456089e-01   +9.208543386203437e-03   +3.564482767293942e-01   -9.579284560679038e-03   +2.511977130644119e-01   +2.507348482121596e-01   +2.406116522813755e-01   -2.103750050254656e-01   +5.763768947133903e-01];
L2I_L1I_iGABA_netcon = [-2.048278745522017e-01   -2.008394993650638e-01   +2.128556680600331e-01   +5.109905176639997e-01   -7.028273610842203e-02   +1.205906963217955e-01   +3.509433372992375e-01   -4.344214753708796e-01; +3.472892792911298e-01   +6.058154663196456e-01   -2.257342354504591e-01   +1.629292243659372e-01   +4.584815871331790e-01   +5.796447061817191e-01   +3.087270532727232e-01   -1.266064759087532e-01; +5.378705870792437e-01   +4.447384032418502e-01   -3.132732898306492e-02   +4.012542233488293e-01   +4.100280928086262e-01   +3.129020668866340e-01   -2.751325812765165e-02   -5.613637323293492e-02; +7.218649423643494e-01   +1.378357702594874e-01   +4.878371556288511e-01   -1.507023730723264e-01   +3.885013715143565e-01   +2.762339490296739e-01   +5.684933809639214e-01   +2.725055384344633e-01; +1.910349196845484e-01   -1.894856501818756e-01   +4.728720671027217e-01   +3.076573598721832e-01   +4.365584968265871e-01   +2.076603044561502e-01   +2.266228579330927e-01   -6.119858601755143e-02; -1.538937246353170e-02   -2.191750411177720e-02   +2.837410896287605e-01   +3.426068703843178e-01   -2.057105141484674e-01   +1.901088480121920e-01   +2.516455859590405e-01   +4.608633632857825e-01; +5.955214670409206e-01   -4.162052988062326e-03   +3.090843190057617e-01   -2.405660809239412e-01   +2.128041083506525e-01   +5.374323011303815e-01   +5.504459356014765e-01   +1.011279467689316e-01; +1.644038483232630e-01   +4.405639963701745e-01   +1.460480697265818e-01   +8.940379890358016e-02   +2.464445404345321e-01   +2.106260301756370e-01   +3.700597725112133e-02   +1.798866909891887e-01; +1.439188439265966e-01   +9.467021206425381e-01   -5.335603294505465e-01   +2.532800228454220e-01   -1.705434303158158e-01   +2.640812030931400e-01   +1.743103072749044e-01   +1.159748367046197e-01; -1.057938739396748e-02   -1.363959657493503e-01   +1.662579967216592e-01   +4.110549385476516e-01   +5.326528436473155e-01   -6.030218262688934e-02   +1.982325545698932e-02   +2.074707478784872e-01; -4.392220423778598e-03   +5.011094841176160e-02   +3.628600079288490e-01   +3.194222092298665e-02   -1.154083397579510e-01   -5.213336298414253e-02   +1.511746204376121e-01   +2.647270290945423e-01; +2.234060612388001e-01   +5.630504883113946e-01   +7.056596913667762e-01   +4.651047442373835e-01   -1.110952319717775e-02   +1.659462215768490e-01   +3.824313180131426e-01   +3.352126814849896e-01; +3.927411727957085e-01   +6.748866033631692e-01   +4.272279552026927e-01   -8.095732551375080e-02   +1.563902288669268e-01   +2.277413569661571e-01   -1.843843960587068e-01   +2.682167123256611e-01; +3.818204258501412e-02   -2.230284264631912e-01   +2.672716921621605e-01   -4.068089896655516e-02   +5.196038210230335e-01   -2.594683500783862e-02   +4.954777432187779e-01   -1.493842187186265e-02; +3.014473180833811e-01   +1.116601567953249e-01   +4.531941965244133e-01   +1.263778137858041e-01   +1.786851475427410e-01   +9.483057007149028e-01   +2.902594357928284e-01   +3.524188878872516e-01; -1.001079256025070e-01   -5.034705541523135e-02   +2.520145610806811e-01   +2.470268292584162e-01   +4.306315402919252e-01   +6.018102930463050e-02   +2.468332457503360e-01   +1.727784228382738e-01];
L1I_L2I_iGABA_netcon = [+4.298503088756121e-01   -4.297055828489294e-02   -2.426390507377820e-01   +5.552756324353485e-01   -9.205403617198915e-02   +1.438709049636488e-01   +6.684217106159869e-02   +5.216823785039695e-01   -2.705134094866397e-01   +6.216526755149684e-01   -6.554754781389301e-02   +1.483585874958860e-01   +1.598779481680519e-01   +3.451326499016890e-01   +1.490591505913477e-01   +4.784426139995293e-01; +5.084838485687002e-01   +1.477756246020842e-01   -1.047627409635768e-01   -8.107333535317701e-02   -2.672396960948374e-01   -1.502577697221426e-02   +5.269988328151944e-01   +3.787985098747567e-01   +4.416471658219003e-01   +7.603049829905005e-01   +4.996385268894595e-02   -1.102522786050290e-01   -2.230333068251000e-01   -5.530808098904823e-01   +2.818400595639733e-01   +4.620930384690515e-01; +4.904055515851063e-02   -2.062823080930928e-01   +5.459453787369547e-01   -8.237462129863080e-02   +3.729000895102876e-01   -2.614873189792560e-01   +6.406044973930043e-01   +5.559764124166977e-01   -3.441587639325186e-01   +1.977536674962659e-01   -7.308001690903863e-02   +3.178908594049584e-01   +6.142209764421145e-01   +4.350850385243094e-01   +9.116764682575184e-01   -1.984561435336139e-01; +3.112532484281246e-01   +6.288746709137969e-01   +3.508584486968484e-01   +2.460176966514614e-01   +5.121455962914163e-01   +5.427556840287220e-01   +7.583600628591423e-01   +4.114907260857597e-01   -4.337691222146735e-01   +6.717583725390858e-01   +5.602598510755569e-01   +1.316560718535535e-01   +2.763906923802470e-01   +2.543625753435284e-02   +3.785861429739383e-01   -7.728674854297260e-02; -1.308013030357605e-01   +6.992722646227037e-02   -1.817305581085119e-01   +2.189003370138838e-01   -9.833758687983765e-02   +7.761202201526771e-01   +7.682395164260002e-01   +2.251305580043665e-01   +6.654089317395385e-01   +5.453211106497522e-01   -2.796264555126086e-01   +2.562956113413302e-01   -4.291525727527187e-01   +3.143685331393119e-01   +1.522021046332193e-01   +6.217442901035196e-01; +1.587910427887205e-01   +4.526687622754798e-01   -8.168323346934514e-03   +6.098791884316695e-01   -8.284571617595185e-02   +2.696868391767241e-01   +3.508186758042194e-01   -7.206315509017683e-02   -1.314680738767493e-01   -4.101236993924878e-02   +2.245206006085578e-01   -6.274576149775803e-02   +5.995966295716275e-01   +9.189502751234403e-01   +4.024117164515723e-01   +5.834391580849752e-01; +5.614426796834363e-01   +4.929871265632274e-01   -2.442907388384894e-01   +4.031465394846717e-02   +4.582476354345836e-01   -3.284823262785702e-01   +5.279060721565182e-01   -6.040543193481414e-02   -2.018679631191474e-02   +3.700208045806917e-01   +5.067037115052162e-01   +4.001147226671560e-01   +1.321974106279555e-01   -2.462720089529914e-01   +2.294306379584615e-02   +4.002013456609173e-01; +5.097766502509605e-01   +1.158072273825027e-01   -4.519904681391212e-03   +4.622192589313322e-02   +1.668062533363597e-01   +4.245182650665119e-01   +3.381315997742914e-01   +9.448141854277242e-02   -2.228673294057149e-01   +3.700728772597523e-01   +5.510285283014854e-01   +4.660810560740906e-01   +2.778955987547191e-01   -2.884212791362572e-01   +4.372504525270726e-01   +3.948145710575002e-01];
L2E_L1E_iAMPA_netcon = [+4.112632692432224e-01   +1.414628843838582e-01   +9.832265984127289e-02   +4.084445819065336e-01   +9.917597433833373e-01   +4.662759726018275e-01   +4.024126730348229e-01   -2.512638790792919e-02; -2.164895774556202e-01   +2.542573441844256e-01   -1.536715449762049e-01   +2.232434867156955e-01   +5.426295727557017e-01   +1.354878724959265e-01   +3.948945677579874e-01   +3.442681132200527e-01; +1.721055178604077e-01   +5.044607557977649e-01   +4.637064079372325e-01   +2.071596087240832e-01   +2.089737489082859e-01   -8.333238154104944e-02   +1.831542284416528e-01   +2.943767352161062e-01; +4.178044822863069e-01   +1.061086555739709e-01   +9.562066542750711e-02   +3.734663350716339e-01   +1.785006298850823e-01   +1.771756156774281e-01   +2.302984988045326e-01   -1.527739102239192e-01; -3.544717931860288e-02   +1.893217906577692e-01   +5.482976602226759e-01   -1.614803941072890e-01   +1.726662423172691e-01   +5.986284817880887e-02   +2.135573318264917e-01   +4.437567272067008e-01; +3.536799949389982e-01   -1.937949759777788e-01   +1.155603212668648e-01   -1.308521362850445e-01   +4.611865536829523e-01   +7.022285965950801e-01   +5.300536089585512e-01   +1.825217203212404e-01; +2.485840029623226e-01   +5.652035696527915e-01   +2.836718534638425e-01   -2.682459666838168e-02   -2.680738135258081e-01   +4.161017512418760e-01   +9.149925313973675e-01   -1.375726185247634e-01; +2.015600640447064e-01   +4.369132222962193e-01   +8.524097919135144e-01   +4.333012560586470e-02   +4.060171540937164e-01   +1.627748901503117e-01   +3.382584306605592e-01   +2.542767825416175e-01; +4.915792180221005e-01   +2.768255820010867e-02   +3.670910183523343e-01   +7.097599946166621e-01   -1.837899117287414e-01   +4.648968029301954e-01   +2.743003919733635e-01   -5.099033231228123e-03; +1.849714593877182e-01   +6.250445057800783e-02   +1.671246398870510e-01   +3.374284656381655e-01   +1.738428316290335e-01   -4.851027000407636e-02   -4.441682385143821e-02   +3.069403008745186e-01; -4.230964974051388e-01   +6.073611636974920e-01   +5.725184727382334e-01   -3.199678962358120e-01   +2.655877956899471e-01   -3.693998657352104e-02   +8.624347092590744e-02   +1.700627230386826e-01; +2.221829506575635e-01   +2.399881616910050e-01   +5.294292760944115e-01   +1.837054381248368e-01   +2.612487542370499e-02   +4.645981845324389e-01   -2.792994544646732e-01   +3.556437058945746e-01; -2.209202027528113e-01   +3.225889110842016e-01   +2.145257967919744e-01   -6.273816660000664e-02   +5.431360424005651e-01   +7.112117209233063e-02   +4.278345133072213e-01   +1.174002935732855e-01; +2.481993911306223e-01   +5.534656767309405e-01   -4.400768306042785e-01   +2.020746992375206e-01   +2.347533147092075e-01   +2.602986472622334e-01   -2.918570677998369e-01   +2.804550376780084e-01; -9.557201601919553e-02   -7.883356683872891e-02   +1.775611470193721e-02   +4.179450232922620e-01   -1.431219120450845e-01   -2.190365064130908e-01   -9.992542082355398e-02   +4.939114954155975e-02; +1.925136891062049e-01   -7.984853961818289e-02   +2.926967516851620e-02   -1.366094280666973e-01   +2.303876934846830e-01   +2.607817457147631e-01   +5.429559300353921e-01   +4.621949530686595e-01];
L1E_L2E_iAMPA_netcon = [+2.818749475057457e-01   +2.681127513206478e-01   +1.943977016708434e-01   +7.855996949991198e-02   +3.801152256567891e-01   +1.952741304211094e-01   +2.161059895721903e-01   +1.647663082721014e-01   +5.007766979824398e-02   -1.763844983292038e-01   +5.649428440021296e-01   +5.244550460029550e-03   +1.756056364252133e-01   +7.817069824821474e-02   -2.867115005705222e-01   -2.202811026440932e-02; +2.168079391602817e-01   -3.240262199332938e-01   +9.157641433974187e-01   +3.551857353536780e-01   +2.174955362706500e-01   +2.517654059113541e-01   +7.670975463853719e-01   +3.983658140904795e-01   -2.047269583786604e-01   +1.658613456989589e-01   +3.977642421808077e-01   +3.728313413880934e-01   +6.463661059861661e-01   +2.034018778191074e-01   +3.681803505082780e-01   -2.967540980337294e-01; +6.216290863719226e-01   +3.316012904872014e-01   +8.402317804267077e-02   +1.342169932768169e-01   -6.404831911880621e-02   +3.890549852423552e-01   +1.866510614978428e-01   +2.532359452128988e-01   +2.042454284905162e-01   -1.478408217981789e-01   +4.645841989525930e-01   +8.370142047100970e-01   +2.418597356112800e-02   +4.549277397973527e-01   -9.686666814351785e-02   -2.685481216193755e-02; +1.918950082779936e-01   +9.774792319137734e-03   +1.813331648435546e-01   -8.866714520413401e-03   +1.699399225245591e-01   +5.919629212672117e-01   +9.350453584226190e-01   +1.196603208612392e-01   -2.939957640969548e-02   +1.502706060729486e-01   +2.907557548255587e-01   -1.949697861461734e-01   -2.738469777319429e-01   +9.866331645018735e-01   +2.675263896161576e-01   -2.373503828659751e-03; -1.061288395274071e-01   -5.426246749834669e-01   +5.000558671584834e-01   +1.055840498627476e-01   +2.541200919750635e-01   +4.902112825197159e-02   +5.857292002389101e-01   +2.184396288148297e-01   +3.492516588622652e-01   +7.890162872809431e-02   -1.154002158650901e-02   -3.840722640371111e-01   +4.667551588829295e-01   +2.266849078864198e-02   +6.319688687933364e-01   -7.310224407137580e-02; +3.284698759626115e-03   +4.722608978118674e-01   +6.553345852597488e-02   +7.034649211160507e-01   +5.708388828113475e-01   +5.841813486022521e-02   +6.603528583929641e-01   +6.700652188842045e-02   +4.086258756281317e-01   -3.532609002779814e-02   +6.110013127333868e-01   +1.011248654062498e-01   -2.669308707623912e-01   -1.963270923126751e-01   -4.962243196512418e-01   +3.765761349476643e-01; +2.074987179642948e-01   +1.250483228451978e-01   -1.893315089308204e-01   +2.455545713070971e-01   +3.769952637884171e-01   +3.808867353414783e-01   +3.467047274416751e-01   -1.631797405680752e-01   -3.018220799343727e-01   +1.396589497066262e-01   -6.979467209756106e-02   -3.454351770516357e-01   -2.552133023150883e-01   +2.566207017768624e-01   +7.131149997929415e-01   +1.351844976756722e-01; +2.159742218714392e-01   +4.330121161402415e-01   +3.314204511155113e-01   +3.143404949868629e-01   +3.998520114299916e-01   +6.529193092393459e-01   +7.468334862396238e-01   +2.994553380602705e-01   +3.360645595972793e-01   +2.769288473631210e-01   +1.135286047688241e-01   +2.433767493317347e-01   -4.106377963876491e-01   -1.425063881525582e-02   +2.193760453407620e-01   +3.146310743779847e-02];
L2I_L2E_iAMPA_netcon = [+1.605114677873893e-01   +6.235545792791977e-01   +4.149641923843119e-01   +1.648337782051093e-01   -4.126710609117913e-02   +4.708800608206674e-01   +2.053693199422081e-01   +6.146220632017150e-01; +7.343460714681945e-01   -7.789710396973712e-02   +1.000000000000000e+00   +5.632667175766667e-01   +5.080979035726478e-01   -8.894433721272567e-02   +2.377622112074981e-02   -1.720018994337724e-01; +1.281801451571857e-01   +3.210414272440236e-01   +1.415436361113842e-01   -9.706535100326830e-02   -2.335240696706222e-01   +5.122832491035158e-02   +4.671762037601956e-01   +5.137252702317188e-02; +2.929030979474178e-01   -6.230839826419819e-02   -4.460456824283736e-01   +4.406132495831154e-01   +3.472224398095322e-01   -3.832352574541238e-01   +4.012442370040342e-01   +2.225715518594352e-01; +2.556321885885352e-01   +8.053208753021933e-02   +1.594044805869579e-01   +5.318360665005921e-01   +4.328165043737477e-01   -1.023892307823699e-01   +5.222957066799564e-01   -1.047088097276931e-01; +4.279171075825855e-01   +4.694010739331069e-01   -3.796041989654574e-02   +4.791108300481214e-01   -2.549828275139221e-02   +3.249357519695755e-01   +4.073229119675439e-01   +2.462541782379657e-01; +2.846227021231917e-01   -5.339176100324471e-02   +4.080322213098636e-01   +6.785166510882683e-01   +1.087849045402485e-01   -3.645590274444992e-01   +8.358684253309173e-01   -7.540068952978089e-02; +1.148196712577154e-01   +2.872762646301471e-01   -5.397116523204619e-01   +1.228092795586961e-01   +4.752238868660290e-02   -1.074561043351448e-01   +1.155764376164702e-01   +4.765620502061336e-01];
L2E_L2I_iGABA_netcon = [+3.231469607145988e-02   +2.536000076729040e-01   +6.197860502298554e-01   -1.802073961704117e-01   -2.477609402460181e-01   -1.331253823266625e-01   -2.032882507869713e-01   +3.002211466947402e-01; +7.125169953718449e-02   +1.749708122768870e-01   +3.342250753999145e-01   +8.192261688204499e-01   +6.451819237044960e-01   +2.027305438175635e-01   -5.404232190234478e-01   +1.896075229975930e-01; +1.233821727599540e-01   +7.028029316730157e-01   -3.144713079486328e-01   -2.853338482164219e-01   +4.181574752636240e-01   +5.851504793675654e-01   +3.535689139625911e-01   +4.385215959503562e-01; -1.973528239019010e-02   +5.236551360855658e-01   -3.335193580594044e-02   +7.273787225917503e-01   +7.169138079940856e-01   -3.794867029601888e-01   -2.404711129528159e-01   +5.625094853264276e-02; -1.313359203993852e-01   -3.605458518357909e-01   -8.529253352006191e-02   +2.060106012612414e-01   +6.514828512282675e-01   +2.428828721881006e-01   +3.920718008221601e-02   +1.591899812814589e-01; +5.837812891583138e-01   +5.229862506168016e-01   +2.471354594052703e-01   +4.699157394208426e-01   +3.647356744370385e-01   -3.529504905676867e-01   +5.843007266489120e-01   -3.046997042187835e-01; +2.070634756094790e-01   +1.943611732759653e-01   -3.914510178424622e-01   +4.563162654112010e-02   -1.296249539136766e-01   -3.334644936663018e-01   +1.990217355379494e-01   +9.769498325807687e-01; -6.141297254996420e-02   +5.077030189052557e-01   +4.914979722599953e-01   -1.374772692254839e-01   +2.959070081707102e-01   +4.778113716159891e-01   +4.537522303308678e-01   +6.137897302807077e-01];
L3E_L2E_iAMPA_netcon = [+3.582323244162978e-01   -3.350898143248645e-01   +2.351674716096405e-01   +1.098494408349428e-01   +4.959692198310756e-01   +3.046481045342197e-01   +2.065540685116014e-01   +4.920482571032421e-01   +2.936951383189692e-01   -1.414083583528306e-01   -1.940408519090890e-02   -1.463952658506366e-01; +3.236086183943205e-01   +4.731224914857879e-01   +2.157613966023009e-01   +3.043042452061703e-01   +2.015752930950723e-02   -3.559345719997913e-01   +5.657865496588166e-02   +1.104796156608519e-01   -7.493665956433243e-02   +1.133298180217937e-01   -1.081430857125677e-01   +4.767182356737240e-01; -4.391757562281428e-01   -1.854331759245775e-01   +4.164185199461820e-01   +3.293606351832197e-01   +5.713104099861598e-01   +1.734053660545917e-01   +4.124026306920830e-01   +3.060014881168574e-01   +7.644122892181798e-01   -3.552680571428737e-01   +6.782134039940177e-01   +5.317830854595337e-01; +6.401236347113955e-02   +3.642193040811939e-01   +3.780664353019870e-01   +2.110871962696160e-01   +6.303896346434494e-01   +1.503413562513032e-01   +1.454976613938462e-01   +4.127870375499696e-01   -3.247437947919665e-02   -1.082606860604537e-01   -2.389853852143302e-01   +4.886260855423923e-01; +1.221187583811203e-01   +1.247993648936940e-01   +2.946028825610522e-01   +5.939224876393173e-01   +5.350340979902473e-01   +3.670938861221961e-01   +2.935876959162181e-02   -1.074577677057637e-01   +6.107335534361798e-02   +4.310379771619423e-01   +6.766989788103253e-01   +4.462370489081075e-01; +4.752726624719783e-01   +7.505579472238053e-02   +2.564065992781320e-01   -3.001706696735579e-01   +3.500253844522344e-01   +5.171539053613580e-01   +6.335164413159490e-03   -3.004951135743675e-01   +2.865614420214866e-01   +4.116142021199539e-01   +1.064430856573845e-02   +2.306521377408324e-02; +9.241962598209615e-02   +3.023334901416185e-01   +6.243121587426392e-01   +5.300871653255174e-03   +3.270874954288967e-01   +2.835206003535505e-01   -5.439649507533234e-02   +2.220026099035147e-02   +1.197088605887058e-01   +4.483400128019622e-01   -5.901272349797329e-02   +2.724556241468478e-01; -2.714939123564169e-01   +9.494346025558050e-01   +3.127180758278056e-01   -6.508701919924316e-01   +4.233212239939271e-01   +3.922643275955626e-02   -8.592895348279105e-02   +6.526226662529513e-03   +4.422089970132834e-01   +3.605443066450084e-01   +1.069993134626630e-01   -1.366948636162523e-01];
L3I_L2I_iGABA_netcon = [+7.141711568739303e-01   +4.980543366199828e-01   +1.340982037784176e-01   +1.635187390894517e-01   -5.026056375946140e-01   -6.811556998641544e-02   +1.000000000000000e+00   +7.236253623941384e-01   +7.384447411794429e-01   +2.436487892871203e-02   +1.051702785024632e-01   +1.786405219690571e-01; +2.152858474684715e-01   +1.765405718079933e-01   +1.042699478480536e-01   -1.938455147649124e-01   +4.865357983441471e-01   +2.250746313983829e-01   +3.912784445275421e-01   +2.912395476156319e-02   -1.127317419999622e-02   -1.478232154277501e-01   +3.361611152542432e-01   -2.136366575272021e-02; -7.659551014213778e-02   +3.944554320404325e-01   +2.455492675434905e-01   -2.389232413283505e-01   -5.345207871449911e-02   +4.240508003394956e-01   +2.582597862139092e-01   +2.338807297313458e-01   +3.055962793276393e-01   -1.331719367154796e-01   -1.500576438071423e-01   +8.314642267644992e-01; +5.375923918493364e-01   +5.494619387398270e-01   +5.222966573915504e-01   -1.243335043573413e-01   +2.539459411105366e-01   -1.364487130868949e-01   +3.185379240088985e-01   -3.678317239403590e-01   +4.703581436734167e-01   +6.382101513910974e-01   +6.202413048350498e-01   -2.200689482020352e-02; +3.903101924302518e-01   +3.429220175252136e-01   -1.353912722443360e-01   -9.944326379581415e-02   +6.070397256305822e-01   +4.247516516510009e-01   -5.923434725807537e-02   +8.251127275400402e-01   +6.310454961403289e-01   -2.700055024442237e-02   +3.408850563038012e-01   +1.837149144219629e-01; -7.823647304400752e-02   +5.835849637467622e-01   +4.873435476776897e-01   -1.531891043219437e-02   +5.560384080644220e-01   +3.749983575234979e-01   +7.065205605121072e-02   -2.250711297386094e-01   +3.575204498201049e-01   +4.288526703005207e-01   -1.629816867547771e-01   +2.276060674855928e-01; +5.694164151545091e-01   -1.430887517234110e-01   +3.631842460201013e-01   -3.114428088726328e-02   +6.107509812219696e-01   +5.801581491109922e-01   +4.593978801435455e-01   +5.642736371780956e-02   -5.130680009912389e-01   +7.133649676862559e-01   +3.099810009807839e-01   -2.113788577453454e-01; +1.131950030998943e-02   +2.618029928376082e-01   +3.521555150791796e-01   +3.901004878523662e-01   +8.586717538185806e-02   +4.822210736604062e-01   +7.003382895413925e-01   +8.780268233089088e-01   +5.298333637595631e-01   +3.134713341785842e-01   +3.562828865627442e-01   +4.272891016486936e-01];
L2E_L3E_iAMPA_netcon = [+6.852409727199145e-01   +3.057927834729582e-01   +6.579412724081438e-01   -6.302986374215467e-01   +2.437952699800122e-01   +4.388972926936935e-01   +4.828195779868689e-01   +6.624210003579647e-01; +1.008441178060517e-03   +1.864252871406228e-01   +2.092557863746874e-02   +3.770380472481967e-01   +4.821713297639103e-01   -1.961839665284404e-01   -2.883338718501733e-01   -4.718768144714172e-01; +1.670842354458982e-03   -1.893257175256287e-01   +2.109591900804688e-01   +3.875126024398372e-01   +3.387935010600081e-01   +1.899871864520222e-01   +3.651301606618335e-02   +1.404294974280807e-01; +1.734983269135157e-01   +3.965664245902334e-01   +8.288522046319636e-01   +7.754798973253446e-01   +8.289362124691114e-02   +7.613647608829542e-01   -1.412884603672702e-01   -2.516355921742788e-01; +1.961247769146329e-01   +1.298753111903113e-01   +5.655878457633982e-02   +4.422273786895148e-01   +2.463189642303328e-01   +2.261025893191598e-01   -6.918264619837936e-02   -2.730599563877444e-01; -1.327815846542912e-02   +7.422066680205188e-01   +6.150493101843728e-01   +7.833171816685797e-01   +2.417867707271448e-01   +3.013128391056524e-01   +1.794915403423453e-01   +1.586217120477748e-02; +5.352597582737380e-02   +8.061883615041450e-01   +7.891438908244722e-01   -8.680633854002913e-02   +1.213583426863631e-01   -7.703963275599725e-02   -6.496039179395449e-02   +3.976162358500430e-01; +5.025489675766919e-01   +3.465564422147724e-01   +1.289669593038459e-01   +2.108851336832194e-01   -5.221017456307357e-02   +2.313678492670249e-01   +1.537943067282677e-01   +6.514317395074931e-01; +1.203318584217773e-01   +7.363660899555272e-01   +5.003731474571932e-01   +3.504130605379080e-01   +2.094157118971926e-01   +3.453092639363771e-02   +8.040694629565008e-01   -1.785556915314141e-01; +1.225360011040942e-02   +2.083162328761342e-01   +2.385109424999856e-01   -8.201655689323227e-02   -4.430547546098371e-02   -2.238244069745700e-01   +2.836038549974613e-01   -4.854699502134027e-02; +4.273072738506134e-01   +1.152246122303257e-01   -2.941836547557742e-01   +9.525477810317982e-01   +5.314097579963390e-02   +4.117613423640274e-01   -9.144025930035472e-02   +2.781575777544701e-01; +1.051298172157424e-01   +8.511420597976227e-01   +3.237241587938541e-01   +6.259991274523694e-01   -1.325901078181627e-02   -3.373527129487217e-02   +5.623923959492666e-02   +2.228976313005098e-01];
L2I_L3I_iGABA_netcon = [+2.019380974145440e-02   +1.380150893658230e-02   +9.546073221468264e-03   +1.592652325953033e-01   +4.878281631429212e-02   +6.371666169061124e-01   +2.410821869487613e-01   -1.031336879512555e-01; +1.928819265732920e-02   +2.680660598997696e-01   -2.637919350465465e-01   -1.666723990317636e-02   +4.408381444604766e-02   -1.017056215241401e-01   +5.291365584416942e-01   +2.682340315939798e-01; +6.760372298320995e-01   +1.000000000000000e+00   +2.100618132260633e-01   +5.935822216098823e-01   -1.890696023874846e-01   +6.968775698240829e-01   +2.562580491119478e-01   +1.484069963008075e-01; -1.509136886341658e-01   +2.798605856220724e-01   +7.150754752476338e-01   -4.754184475771311e-01   -4.878062598803774e-02   +6.487459477124213e-01   +2.442561585130638e-01   +2.150445220830416e-01; +6.020477490473930e-01   +1.687798430392395e-01   +3.532048804333796e-01   +2.713528231638638e-01   -3.058213257108207e-01   +2.124144928624546e-01   +1.248809771129348e-01   -9.833998283773342e-02; -1.433901331761736e-01   +3.278314412803439e-01   +7.682026166032072e-01   -2.256031529684508e-01   +4.283240464816092e-01   +7.239955285964699e-01   -3.541982049007640e-01   +6.741364300661615e-02; +3.857021653505424e-01   +3.182862870002922e-01   +1.705172535621516e-01   +2.573600222884201e-01   +1.836113540681663e-01   +3.443883249291354e-01   +8.156558819883049e-01   +5.087522161868440e-01; -3.131612699232380e-01   +4.450399984129009e-01   +3.371966307544039e-01   -4.265703961445057e-02   +6.149297411790270e-02   +3.044403272544357e-01   +1.110288107151656e-01   +6.966307229221388e-01; -8.270789613424795e-01   +8.107847545167255e-01   +5.059359031045944e-01   +2.929520923005644e-02   +3.655322365744024e-01   +2.487558083316027e-01   +3.811947549673774e-01   +3.821236976256988e-01; +1.462504501304558e-01   -2.692214824575327e-01   +2.133451127923528e-01   -4.100196364851644e-02   +4.348809157275641e-01   +6.300884962654507e-01   +2.742012864044285e-01   +2.603573532910202e-01; +6.160706562977049e-01   +2.321970908977151e-01   -5.106502543969684e-01   +3.209635489672162e-01   +2.711792729115504e-01   -9.647677705839482e-02   +4.664048082673560e-01   +5.871569226747010e-01; -4.725943914857615e-01   +8.175590436700888e-01   +1.505195179671715e-02   +6.638403743818678e-01   +5.726026285151371e-01   +2.853196001374570e-01   +1.541164360978097e-02   -2.536188030865231e-01];
L3I_L3E_iAMPA_netcon = [+2.635504583987355e-01   -1.721135375267432e-02   +2.427843782719354e-01   +2.929728246376833e-01   -3.084576337080844e-01   -7.759648135751125e-02   +2.338312734701960e-01   +2.566359810960487e-01   +1.079514608781915e-01   +4.872838022258866e-01   +1.477805414905694e-01   +2.871316364787070e-01; +1.111559059063762e-01   -3.576364847288717e-02   +1.094558378199131e-01   +7.171562555151434e-01   +2.243603101312124e-01   -1.186141098303871e-01   +5.050011849801246e-01   +3.183669381581452e-01   +3.923349234193989e-01   +2.124577258452583e-01   -2.688767671019950e-01   -1.014896477827030e-01; +1.713534531912654e-01   +4.958584300762572e-01   +4.967183777428415e-01   +1.238579657554225e-01   +8.308695254942654e-01   +2.540503960818823e-01   +6.494800335182085e-01   -9.138437041873376e-02   +4.152527408691209e-01   +3.938576493663569e-01   +1.311482244615777e-01   +4.821871053975377e-01; +3.878575860003826e-01   +2.999306330637443e-01   +4.561011493301194e-01   -2.646359359153664e-02   -1.092227483715877e-01   +5.134426799096397e-01   +8.377827819873510e-02   +3.314444502994417e-01   +1.844918557883413e-01   +4.360931125692065e-01   -1.222234384581682e-01   -1.631027465161667e-01; -3.839588279032186e-02   +3.218562896681216e-02   +8.508727351457875e-01   +4.599308789345626e-01   +2.936303041917626e-01   +2.540113171575979e-01   -1.298007883704270e-01   +3.975846943293577e-01   +2.331757827055522e-01   +3.258477221749252e-01   +3.526459787935493e-01   +1.161854945434362e-01; +2.240192242940383e-01   -1.028675050822554e-01   +7.903425543571937e-02   +5.821232614454271e-02   -1.226841203304732e-01   -2.463601385731806e-02   +3.256803363057615e-01   +1.367719333706638e-01   +2.928282873285439e-01   +6.984616290701604e-02   +1.622085009987627e-01   +8.420722575235818e-01; +9.950007603147978e-02   +1.024340903647037e-01   -2.366233416099202e-01   -5.159488618086162e-02   +2.692216696034558e-01   -2.201264782443331e-01   +5.092210474085328e-01   +3.993391972867420e-02   +2.314062185099872e-01   -3.775703291454310e-02   +3.914369404357359e-01   +1.648209093470196e-02; -1.723922760487009e-01   +3.140631410811042e-01   -4.575646874306446e-03   +9.548033494652328e-02   +1.560108875636805e-01   +1.658881989421126e-02   -7.311896109091698e-02   +4.926131165532788e-02   +5.845575651075144e-03   -3.248963829448163e-01   -5.510515222999875e-02   +2.936096189284176e-01; -3.172468049291577e-01   +5.991303769759618e-01   -3.113266462025224e-02   +1.968009562336814e-01   +1.245355193661752e-01   +5.091123806524611e-01   +2.292609038512066e-01   +4.377028136939189e-01   -2.284413318646108e-01   +1.451914176117265e-01   +4.767051465067650e-01   +7.605460853518046e-01; +6.906364012321015e-01   -5.095423661883735e-01   +6.313296967342561e-01   +2.580321794489367e-01   +1.115918557339908e-01   -4.711007300056952e-01   +3.737275957395867e-01   +3.872687473536563e-01   +5.471973854694205e-02   -1.238346428307623e-01   +9.986364761744868e-01   -2.004599090151557e-02; -3.400040530873419e-01   +4.993933177132720e-01   +6.997764632056648e-01   +3.556795539686709e-01   -1.437400837115156e-01   +4.333835555125629e-02   +3.488959282561326e-01   -6.241569038244348e-03   +4.270541268072697e-01   -1.877948889787527e-01   -9.529032463019507e-02   +2.561313641776612e-01; -1.439297304039816e-01   +1.788155315634543e-01   +2.141881723657623e-01   +5.735293794819195e-01   -2.859899442464257e-01   -1.274664264985426e-01   -2.202307288893618e-01   +1.432941011083246e-01   +4.317626082687559e-01   +1.673044525651195e-01   +1.806690832938074e-01   +8.076278531839870e-04];
L3E_L3I_iGABA_netcon = [+2.655702907795979e-01   +2.485613907407815e-01   +1.392531963662028e-01   +2.208917866218152e-01   +2.672794764417823e-01   +5.806520447955378e-02   -3.399016752824280e-01   +4.005752563498038e-01   -1.776269604718468e-01   +5.945955209826489e-01   +1.431722162407275e-01   -1.792705421963916e-01; +1.834886039808167e-01   +4.848014566820538e-01   +4.317689186876005e-01   +2.825854932037115e-01   +6.155837859430165e-01   +1.267221722241616e-03   -9.008226874971959e-02   +1.179689605677454e-01   -4.883585269708006e-01   +2.176860672464110e-01   -5.313467952308656e-01   +7.616349109330892e-02; +6.913499228335727e-02   +2.309983033960007e-02   -2.888822095215300e-01   -1.957154611365773e-02   +1.774718792086112e-01   +5.084707270832182e-02   +3.322800742217937e-01   +3.469829026607684e-01   +3.489658114307784e-02   +1.840403943158898e-01   -6.925361109707381e-02   +1.125801998152372e-02; +4.595440830445775e-02   +2.491387746697388e-01   -5.053663010470907e-01   +4.397911540334272e-01   +9.548589337599274e-01   +9.536288096363241e-02   -7.905550107470573e-02   +1.006726883209049e-01   +7.602514996868610e-01   +4.010955476374238e-01   -1.099188159350592e-01   -1.143296609537061e-02; +3.345842488969464e-01   +9.749642235291363e-02   +9.738659849000360e-02   +5.272320588553089e-01   +1.154739890592391e-01   +5.827404689486659e-02   -1.413106703329227e-01   +7.710173519240830e-01   -1.622810902307666e-01   +6.797117492537279e-01   +2.079414652214108e-01   +1.336302469953001e-01; +2.534477128399275e-01   -2.059568395019061e-01   -1.308461657660912e-02   -2.066796241384366e-01   -1.497952523767162e-01   +2.165860070684107e-01   +1.546235727378761e-01   -5.061120164398495e-02   +6.787894391116739e-01   +2.005517310936692e-01   -1.757337189844453e-01   +4.190473988587932e-02; -1.760492472996019e-01   +8.868870087245029e-02   +2.141419942714860e-01   +9.619634184527613e-01   -3.127346612298428e-02   +4.833248946001439e-01   +5.296066533039885e-01   +2.365234812226447e-01   -1.589110387818489e-01   +2.468300601992594e-01   +4.773318319383956e-01   +8.980294714265266e-02; +3.267305679924050e-01   +1.716995097366021e-01   +1.495398229185185e-01   +7.251851471856219e-02   +2.164846057966036e-01   -3.562904479783887e-01   -2.129979108582369e-01   +6.194953256589292e-01   -9.160149575076269e-02   -1.019383879696100e-01   +6.158326311095351e-02   +2.873717091341842e-01; +2.023462103153990e-01   -2.744120834619382e-01   +4.399342807236222e-01   +2.057100772162197e-02   +2.030697574048914e-01   +6.956975642895935e-02   -5.873902183618697e-01   -2.240247730547271e-01   +5.794294341660055e-01   +3.566591445078266e-01   +8.311788921921320e-02   +7.643131101680265e-01; +1.751813440841169e-01   -8.035557079648015e-02   +2.946978480836944e-01   +3.366178579327972e-03   -5.671588396473740e-01   +2.824040914045030e-02   -1.501158409580540e-01   +2.228591176897197e-01   -2.816546812980822e-02   +2.789073859484333e-01   +8.219220902281664e-02   +8.572054982511548e-02; +2.620934696833848e-01   -8.433547720705847e-02   +3.872342634342891e-01   -3.243461499822019e-02   +1.720648269142408e-01   -2.159871895924364e-01   +3.566933624494868e-01   +4.487970828874094e-02   -8.947148759768554e-02   -5.565931075468175e-02   +2.571222643435162e-01   +4.839125955134619e-01; +4.317041845125484e-03   +2.458663866737650e-01   -2.076501779633203e-01   -7.585200255719904e-02   +8.734666409540748e-01   +4.796024781476355e-01   +4.068358476741595e-01   +4.148384696589679e-01   +1.806439869856416e-01   -3.146020782482932e-01   +5.251929279562719e-01   -2.032075719237413e-01];
L2E_Input1_iAMPA_netcon = [+7.936127676020900e-01   +7.296491120561938e-01   +5.159113422382903e-01   +8.386178496965843e-01   +9.688984080876919e-01   +4.509507986002619e-01   +4.640011742880283e-01   +5.830350574746981e-01];
L2I_Input2_iAMPA_netcon = [+6.260644870634043e-01   +7.744448472505558e-01   +7.337308877942589e-01   +4.482085435071448e-01   +2.410224159797737e-01   +1.000000000000000e+00   +5.895031872210815e-02   +1.183069969431912e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
