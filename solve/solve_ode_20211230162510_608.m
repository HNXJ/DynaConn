function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-6.657332344964063e-03   +2.993687494152358e-02   -3.158028059400315e-02   +1.021639621239735e-01   +6.375201411800463e-02   -3.768593727388184e-02   -1.331624068458007e-03   +4.677557342681182e-02   -3.354213891396132e-02   +7.354507344594655e-02   +1.783118079762476e-02   +1.611571406341035e-02   +6.692548346444266e-02   -4.863666592874025e-02   +1.314142198772951e-02   +1.000968779558276e-01; +6.683097313191477e-02   -8.951265394098351e-03   +5.974529732353780e-02   +6.649913471881660e-02   +1.244145731536544e-01   +4.807615665069811e-02   +1.141950121154347e-01   +1.896495953284090e-01   +4.909287208580089e-02   +4.004176383467577e-02   +2.401429494027151e-02   +1.545475307475015e-01   +5.418704883285268e-03   -3.138825397487532e-02   +1.087827049481445e-01   +7.559321810300046e-02; +1.717957443483099e-01   -1.739606839072580e-04   -5.954213355191461e-02   +6.216522526581393e-02   -2.379839938288849e-02   -6.597465597098000e-02   +1.078334549228604e-01   +1.467002598168572e-01   -9.936992882045467e-03   +1.565626724270763e-01   -3.198399688415440e-02   -7.298570361382856e-02   +5.612682888505132e-03   +1.299972633428484e-01   +1.156904307946535e-01   +4.084414842944879e-02; -9.801037324446690e-03   +5.220554850823546e-03   -1.820340651654121e-02   -3.957600438064299e-02   +2.576491728325982e-02   +2.745875692030125e-02   +1.195876699815054e-01   +9.785215686853119e-02   +1.605261358753382e-02   +5.974665471253946e-02   -9.626340088520566e-02   +4.739204669759089e-02   +2.888137663496967e-02   +6.045568293547351e-02   +5.107782659257114e-02   -5.711352065806043e-02; +1.498509794468606e-02   -5.359672611557272e-02   +9.964864081167632e-02   +1.025753752019319e-01   +9.977581188447682e-02   +7.984611371968414e-02   +5.478711932606647e-02   +3.447610828052201e-02   -9.433886987762949e-02   +3.476492339902705e-02   +5.481453430466887e-02   +6.135530430465851e-03   -1.019611158937701e-02   +9.306932729360515e-02   +1.173426972452487e-01   +1.033307084467302e-01; +6.482241906417145e-02   +1.795658283200280e-01   +5.148705115015429e-02   +2.523534436543389e-02   +1.287392079447421e-01   -7.042135168252688e-02   +1.255395835923779e-01   +7.380215915914230e-02   +1.217061632196297e-01   +1.531912482272088e-01   +1.100796231081117e-01   +6.310757635387423e-02   +1.252156958778943e-01   -1.606858741444395e-03   +7.041992742389418e-02   +1.114762859151057e-01; +1.186113700234658e-01   +7.721883238666948e-03   +3.968458640872797e-02   -5.208825483804182e-02   +7.045849989292736e-02   -3.405749894524260e-04   -5.400677629965946e-02   +6.718040627565137e-02   +4.956948200464867e-02   +6.701284624602863e-02   +1.143612280437053e-01   -1.772946687921099e-03   -5.990374791891154e-02   +1.090141727802485e-01   -2.446353663436502e-03   +7.952756482993006e-02; +9.866773972581777e-02   +4.473408830362641e-02   +1.338051292791246e-01   +1.371552556421124e-01   +3.715089823603371e-02   +3.892156792908666e-02   +8.564526397360046e-02   +7.119517577880956e-02   +1.299383660463582e-01   -1.364566635656346e-02   +2.038174892723053e-02   +6.660686012567138e-02   +7.835329529468629e-02   -1.858494288673293e-02   +5.212098458646405e-02   -5.401081001626097e-03; +6.162835211496692e-02   +1.494632738230938e-01   +3.127531016449868e-02   +6.507612328683082e-02   +1.209304433086832e-01   +1.353192281971464e-01   +5.144864458342280e-02   +1.124173511900703e-01   +1.622221269871081e-01   +1.445237132069681e-01   +1.064336715605970e-02   +1.281283382540220e-01   +6.141893484478990e-02   +1.298782435454439e-01   +8.625464724904829e-02   +7.213722826466140e-02; +1.504743832318939e-01   -1.732079241619415e-02   -3.955008782242075e-02   +2.888338989683896e-02   +4.715901593777976e-02   +3.591539928214259e-02   +2.745103725296174e-02   +5.929336930947880e-02   +1.707260578542170e-01   +5.152863853516095e-02   +9.012112078979483e-02   -8.866495635642624e-03   +1.406452508157676e-02   -5.725851100611079e-02   +2.835100270062960e-02   +2.901371951892488e-02; -2.778279319334670e-02   +7.686283404446458e-03   -1.209860566686855e-02   +4.903654110735369e-02   +1.593528252380133e-01   +8.330814824062133e-02   +3.924035907921559e-02   -1.545070671725698e-03   +4.270974472846573e-02   +1.947996507308604e-01   +1.182625913311114e-01   +8.703434255425849e-02   +3.543029636081278e-02   +1.386944676022110e-01   +1.774444054169628e-01   +1.141397572774332e-01; +9.524647071039713e-02   +1.064007424026396e-01   +1.011978953640019e-01   +1.410860604958242e-01   +4.765707022035059e-02   +9.470000312357416e-02   +1.543875508994114e-01   +7.385141188841818e-02   +3.689461270205095e-02   -1.932758622039823e-02   +6.052776125191933e-02   +6.712166147705720e-02   +8.339682686893017e-02   +1.034975068354433e-01   +1.608074671288977e-02   +1.127469754836654e-01; +2.687260397887335e-02   +1.124866977613777e-01   +6.447588776431402e-02   +1.303880509303653e-02   +1.013109352812308e-01   -2.278179339133242e-02   +1.187304191444301e-01   +5.898196644688545e-02   +1.038097044330958e-01   -1.626984590523816e-02   +4.303962276163613e-02   +5.929157242069720e-02   -4.726224861711538e-02   +6.066512807823995e-02   +8.644759735350120e-02   -2.061153913447094e-02; +7.316042218024829e-04   -9.266426807401780e-02   -5.911492945828799e-02   +2.641836534805616e-02   +1.651339926281141e-02   +1.738009213613551e-01   +1.016484372934846e-01   +2.632108860361777e-02   +1.650132442805844e-02   +8.438217114336566e-02   -1.607353088783765e-02   +5.743170588231893e-02   +1.317456489708453e-01   -3.564615797934307e-03   +9.427429676091967e-02   +9.633167222083006e-04; +6.840319629955401e-02   -3.760396885289197e-02   -2.192981429988986e-02   -2.689310720976743e-02   +1.542385802542590e-01   +4.836241953537028e-02   +3.390419370963207e-02   +1.057792853013414e-01   +6.546075030347231e-02   +1.583168411257941e-01   +1.436611108752872e-01   +4.826533395549609e-02   -4.881817030738694e-02   +1.056637615583274e-01   +1.770375197479728e-01   -6.883071302707341e-02; +5.982548985530501e-02   -7.825130042532642e-02   +7.085730922299338e-02   -3.027095836731136e-02   -5.588621117280163e-02   -4.854482314366691e-02   +9.613779170337333e-02   +1.049329645278190e-01   +5.811357970535960e-02   -1.497007946219868e-03   +6.432286123796323e-05   +1.795158848806185e-02   +1.248926552149258e-01   +6.768224828982701e-02   +1.041852749417484e-01   +1.123030608778523e-01];
L1E_L1I_iGABA_netcon = [+6.590479053557552e-02   +6.107355748162528e-02   +4.633811442157262e-02   +9.503618619532517e-02   -3.991920420351182e-02   +2.752692885333754e-02   -9.666446101581197e-03   +5.712977931732861e-02   +6.994922642080459e-02   -5.952913402971195e-02   +8.230653700493834e-02   +1.516692837649393e-02   +8.010872219840126e-02   +8.286364202436308e-03   +5.393538155600663e-02   +9.838225303808235e-03; +8.485235856785686e-02   +1.049401577684226e-01   -2.440249661121333e-02   +4.077015321033513e-02   +1.129261083774872e-01   +1.260464797580680e-01   +2.047936506875814e-01   +2.117098575290274e-01   +8.015605259678085e-02   +6.475339068318695e-02   -4.060762352909532e-02   +8.871027179369723e-02   +7.120722527859644e-02   +1.570616860915344e-02   +1.098664121299842e-01   -3.586868816455825e-02; +1.139329398507237e-01   -4.301882544200854e-02   -3.370330161688015e-02   +8.970613471788752e-02   -1.424375354183040e-02   +7.988059622600036e-03   -6.706272669223654e-02   +7.841525205518983e-02   -4.612571909582720e-02   +1.509844438725809e-03   +5.478553058048415e-02   -1.084170982283347e-02   -4.948041865850677e-02   +1.704864113666907e-02   +1.664453875512956e-02   -4.167559904124708e-02; -9.121865603458013e-03   -5.718292258531132e-02   +6.967355793742951e-02   +5.678520785203119e-02   -7.336443919481578e-02   +7.305932142743214e-02   +7.292527989550274e-02   +1.962879055523493e-01   -5.932891298614019e-02   +8.762174458936589e-02   +1.079028051745639e-01   +1.057285983203046e-01   -5.079488444392544e-03   +4.272824811582691e-02   +9.733403333144365e-02   +7.890517691554090e-02; +2.988514161083516e-02   -1.280069418796852e-02   +1.716057733933639e-01   +1.109180326420167e-01   -4.976385842453822e-03   +9.040589770690688e-02   +1.686673686419180e-01   +1.837374824196467e-02   +1.065610854934701e-01   +3.462205117331005e-02   +6.648410985837278e-02   +7.272054313041258e-02   -2.392334127234053e-02   +7.627599204636791e-02   -4.168561808210817e-02   +7.367798918225865e-02; +7.134815293924446e-02   +1.859761243993925e-01   +1.563563357881142e-01   +1.017460347569632e-01   +2.769599211240294e-02   +8.318969449174646e-02   +5.035544983917341e-02   -5.729780138760916e-02   +1.011499446904312e-01   +5.510089169393156e-02   -7.960500125138567e-03   +8.145927705131434e-02   +5.529306842652994e-03   +9.479732868340118e-02   +5.674016527319969e-02   -5.248227550886792e-02; +5.594832352192727e-02   +8.163672396214861e-02   -5.907128259255483e-02   +6.980416494756200e-02   +5.749072650150069e-02   +5.646998803983209e-02   +2.739358874136096e-02   +1.660860436731413e-01   +2.503777799374085e-02   +3.722449824035551e-02   +1.067784569843086e-01   +1.333883938950632e-01   -2.115567859628346e-02   +1.270237095427073e-02   +1.177860200742267e-01   -1.787591551848589e-02; +1.415734229577629e-01   +3.687564109122502e-02   +8.583001852834546e-02   +1.240522940187413e-01   -3.227335980152121e-02   +9.650399431867290e-02   -1.908842709519445e-02   +7.066647930450187e-02   +1.206825706920320e-01   +8.787034003726310e-02   +6.212020642792665e-02   +5.027802532838125e-02   +5.538812148426121e-02   +1.776997088185592e-01   -2.416423075777314e-02   -3.921312045387777e-02; -1.744754490124843e-02   -5.477325088347157e-02   +1.191284379146885e-01   +2.435229163386631e-02   -6.550170050674299e-03   +9.562909648689899e-02   +6.657895707322639e-02   +9.458692647493774e-02   +1.965263436059706e-02   -6.252588882584952e-02   +1.262207324711113e-01   +2.150669569145953e-02   +6.620250702299166e-02   +8.417649619421794e-02   +5.549941931652747e-02   +6.404285624763927e-02; +8.113586661605902e-02   +2.073621100910684e-02   -7.283311701897682e-02   +1.059979485284550e-01   +1.909174717316252e-02   +5.959021494578558e-02   +5.874166964723167e-02   +2.612670650773808e-02   +5.396984902898367e-02   +9.590326629358050e-03   -2.738051115319786e-02   +4.174702187411389e-02   -2.467990973572175e-02   +7.102203804113991e-02   +8.752435076914772e-02   +2.988666466920594e-02; +1.059215206865304e-01   +1.113372292542455e-01   +1.179738115432586e-01   +7.722639787962335e-02   +9.394144402486022e-02   +4.540583130604105e-02   +1.088995108506968e-01   +1.180802233486319e-01   -9.631807667297201e-02   +2.989047092113485e-03   -2.431813102435891e-03   -8.770290128028417e-02   +1.547893342247869e-01   +4.024602322228799e-02   +1.560938311199250e-01   +1.338253466454138e-02; +1.258097877019887e-01   +2.081090807366688e-03   +4.493621162900956e-02   +1.474347894579594e-01   +5.935844740136986e-02   -1.644639782739139e-02   -1.708097864138343e-02   +1.362559932897276e-02   +2.518494521944291e-02   +9.953550372536948e-02   +7.427086305780338e-02   +9.895180934030991e-02   +2.941499965099451e-02   +4.166004442274662e-02   +1.589455256513259e-02   -5.079505192679961e-02; -1.097233077257456e-02   +1.010778365537661e-01   -1.776396809486484e-03   +3.814968840593719e-02   +1.990500478639385e-01   +4.896724549162099e-02   +1.083247096606967e-01   -8.760610620638309e-02   +1.614468875552523e-01   +4.045744690039174e-02   +6.318935509805310e-02   +5.814239860077802e-02   +6.270027171972446e-02   +9.513736295263300e-02   +3.365903080600624e-02   +1.016423083510866e-01; -6.157196370787449e-02   -3.485043312056395e-02   +7.487935120745901e-02   +1.173131827451694e-01   +1.401331909112170e-02   -8.459634870439972e-02   +4.637369329988494e-02   +1.601257272166096e-01   +3.881707256643207e-02   +3.575425887415627e-03   +7.719084440919320e-02   -3.347667431087890e-02   +1.029082855523896e-01   +1.194704065934878e-01   +8.303265294049585e-02   -1.265546151267311e-02; +9.968105062478107e-02   +1.271259928047268e-01   +2.141757202784307e-01   +1.108492256684137e-01   +3.063181329489430e-02   +7.621487932386975e-02   +6.695424145601031e-02   +1.166680242803320e-01   +1.585732443857770e-01   +7.317113230215673e-02   +5.538631574535421e-03   -1.645148826651547e-02   +1.022633109851870e-02   +2.370372171653075e-02   +5.957203288448941e-02   +8.811492510220072e-02; -5.494541731989021e-02   -5.631470938127132e-02   +6.419805206472823e-02   -1.971854187360227e-03   +2.899053860225137e-02   +1.463769277119110e-01   +1.399766115976583e-01   +4.908736180504188e-02   +6.275228940998873e-02   -1.361286563820559e-02   +8.737014604631754e-02   +7.504287459695134e-03   -3.326401838302219e-02   +1.140185268572329e-01   +2.045380626899685e-02   +7.326286428672019e-02];
L2I_L1I_iGABA_netcon = [+1.284590592323178e-01   +6.992622709742180e-02   +3.901104330953471e-02   -1.052767941182541e-02   +4.095745327244582e-02   +1.063757860909317e-01   +8.063992129337456e-02   -7.847668462553400e-03; +5.267224450310155e-02   +2.939147466027722e-02   +5.455302148419063e-02   -2.916212964218381e-02   -6.536333372228302e-03   +3.565634315655548e-02   -2.463644347881816e-03   -1.607197426978946e-02; +4.297095146450387e-03   +7.995922129844694e-02   +7.748584858515714e-02   +1.062840348345779e-01   -6.014302964700858e-02   +4.058475978775017e-02   +1.104447545732142e-01   -2.129956132360016e-02; +9.829235216418292e-02   -1.751646616730500e-02   -3.843431161736989e-02   +8.815345107404883e-02   +7.051492791267133e-02   +3.283992020044397e-03   -2.681293300558667e-02   +5.781770468105576e-02; +7.613129300593145e-02   +6.310956191603451e-02   +1.105987275659007e-01   -1.743637171878918e-02   +1.905362183780627e-01   +3.326716071490696e-02   +7.569375487175764e-02   +8.154027219477218e-02; -9.013189624411257e-03   -3.921214198263269e-02   -2.882369943202007e-02   -4.234432989425533e-02   +1.767855050343679e-01   +8.226402755751368e-02   -5.925593041455054e-02   +6.389183303669303e-02; +1.163093314558290e-02   +1.728897951834338e-02   +1.598979350225864e-01   +9.350664689773551e-02   +5.093251249306269e-02   +3.636966500492880e-02   +1.648139456859156e-01   -2.938318316720352e-02; +4.010132935558151e-02   +4.600542853732855e-02   +1.544681647787624e-01   -5.386926016617977e-02   +2.240380435805808e-02   -4.320270511774370e-02   +7.004633225960713e-02   +1.157309911981567e-01; +1.199229361378184e-01   +9.435473518569903e-02   +8.248316121129773e-02   -8.310030072338304e-02   -5.400184653047209e-03   +9.670757356800530e-02   +1.140802731546499e-01   +3.720875622916870e-02; +2.286654819459527e-02   -3.688379420899295e-02   +1.380760535776422e-01   +8.939112910772978e-02   +8.328643780596709e-02   +5.675440869116997e-03   +5.148458053497162e-02   -2.129786663494226e-02; +1.205775878012552e-01   +1.676948303757796e-01   +6.282010830279004e-02   +8.432385441143771e-02   -5.030712891294714e-02   +3.599358881211346e-02   +1.303086397274543e-01   +4.019258529957970e-02; +2.803519700589878e-02   +1.114154415444754e-01   -2.027929272153343e-02   +1.166294557469211e-02   +8.509373629112087e-02   +4.533867138422138e-02   +3.579841886350466e-03   +5.622360042011797e-02; +7.377811574413314e-02   +9.742235900564902e-02   -1.699869891826539e-02   +1.725820118142524e-01   +1.557797388165471e-01   +9.901731548735249e-02   -2.167245975229680e-02   +4.691695119995179e-02; +3.295836370684880e-02   +1.434253495323834e-01   +1.151337725667311e-01   -6.183046231370590e-02   +1.706163145983941e-01   +3.997649887647878e-02   -5.736471249574892e-02   -1.830495247148519e-02; +4.977889261371538e-02   +1.137862444880497e-01   +2.210643321486330e-02   +1.341966616786370e-01   +1.090132932058198e-01   -6.804394061664754e-02   +2.427701113684816e-02   -8.499315272412648e-03; -1.659963996909605e-02   +1.542109082558006e-01   +6.815383969936796e-02   +8.774224155612771e-02   +5.019925048361734e-02   +2.417474848956795e-02   +6.976820353156482e-02   +1.690885010689216e-02];
L1I_L2I_iGABA_netcon = [+1.336143004225674e-02   +8.363435470754116e-02   +3.114095263063077e-02   +1.324619757785722e-01   +1.470831163391605e-01   +1.139822896109254e-01   +6.265915816999815e-02   -4.631609186109283e-02   +9.004360639571080e-03   +4.242510738542151e-02   +1.285939676850495e-01   +3.356905670247002e-02   +1.052306874010436e-01   +1.125146822482201e-01   +1.590807228254765e-01   -1.719327084601800e-02; +1.168301261701119e-01   +1.527583326444565e-01   +1.315059104995254e-01   -2.100702984430920e-02   +1.925638629050368e-01   +5.166726574707080e-02   +1.216031216414611e-01   +1.103443602548362e-01   +6.819918569283498e-02   -3.408401836347634e-02   +5.036580051768560e-02   +1.426735195654460e-01   +1.385854917053128e-01   -6.269103181203964e-02   -2.951114373652166e-02   +4.944487539783155e-02; +1.304989131826220e-01   +1.873836283835838e-02   +1.708357829190587e-02   +6.148437715902866e-02   -7.446677143423230e-03   -7.098270081156613e-02   -7.129135002353626e-03   -1.117848705350152e-02   +9.541461016356725e-02   -2.621135774941726e-03   +1.517947133323078e-01   +2.554049845080067e-02   -3.733443425661251e-02   +8.234828619667285e-02   +1.037981335529277e-01   +3.050972748278782e-02; +5.828428968608715e-02   +2.419239524235503e-02   +3.723881678237322e-02   -4.380244494495853e-02   -1.039820788828106e-01   +3.141737093497833e-03   -1.061443951688980e-02   +1.017600000156737e-01   +1.025832833628514e-01   +5.004918091640804e-02   +1.299490890473916e-02   +8.688224595962914e-02   +5.052323887148815e-02   +9.057862086939035e-02   +9.747133641363251e-02   +4.202745461325626e-02; -9.226037206741547e-03   -9.040768108613848e-03   +1.917729848978194e-01   -1.635925723274376e-02   +3.639823955479632e-02   -1.338011271917734e-02   -9.562622254919648e-02   +7.806492065912694e-02   +9.934436870160333e-02   +6.932934773373789e-02   +1.138095229789908e-01   -2.952509869290861e-02   +1.286459301229642e-01   +7.416369571946760e-02   +1.771926017170140e-02   +4.923851082275088e-02; -5.500927881903064e-02   +2.499044411098866e-02   +9.574564009563406e-03   +1.626453806365755e-01   -4.581933914851967e-02   +1.041151330402914e-01   +9.817063918068647e-02   +8.387308651562768e-02   +3.148978278827393e-02   +3.080349690935351e-02   +1.088039877361526e-01   -7.804533069533340e-03   +4.735276350353276e-02   -1.225397049148702e-03   +1.194859864523894e-01   +6.874061423532994e-02; +3.715676130458350e-02   -1.222588465667439e-03   +1.487205430987052e-01   +5.925493616455760e-02   +1.342193367834985e-02   -3.554695629079995e-02   +9.121778875649383e-02   -1.202145302538301e-02   +4.959379379213008e-02   +1.079500038176236e-01   -1.536874200569105e-02   +1.486229304896808e-01   +7.655267969563276e-02   +2.012364869617769e-02   +4.866486889508861e-02   +1.886949504931834e-02; +6.401774791911119e-02   +5.925009385375517e-02   +1.512963432954715e-01   +1.395985892561580e-02   +3.630960199221994e-02   +1.009543189046859e-01   +3.715325954728982e-02   +1.345115312921910e-01   +2.023577402331463e-01   +1.059547211757008e-01   -1.813154035475587e-02   +9.316535783358659e-02   -1.464455735148050e-03   +1.123962718893441e-01   +6.924027017868818e-02   +9.654162101572525e-02];
L2E_L1E_iAMPA_netcon = [+1.515961426909290e-02   +1.574657870916370e-01   +5.743267761463409e-02   +1.356675679245875e-01   +6.828619001361927e-02   +5.322722528421125e-02   +1.081046898672475e-01   +7.615004079807912e-02; +9.725881094617515e-02   -4.909189632884587e-02   +8.077029849780348e-02   +7.592135022149143e-02   -7.162203795272820e-02   +1.078870416253468e-02   +5.313828628256516e-03   -3.561426423081676e-02; +6.464017131110496e-02   +1.116303630623900e-01   +1.493884111128236e-02   +1.010255782480345e-01   +1.112132131676798e-01   +2.198655118096249e-02   +2.757375209283679e-02   +3.709427640292792e-03; +2.242397050410809e-02   +9.871084079944240e-02   +1.287536358882414e-01   +6.311632257689943e-03   -2.053234237473165e-02   +9.436829736013835e-02   -1.503714838515516e-02   -7.088385854862898e-02; +5.455016610008728e-02   +8.178357393310035e-03   +4.672748409170752e-02   +8.932547699396491e-02   +3.419492727701173e-02   +5.280681265494708e-02   -2.010971430456445e-02   -9.390310749220451e-02; +7.224451833558490e-02   +2.268036730811025e-02   +7.978033352656752e-02   +1.686999701036909e-02   +3.649242583169206e-02   +7.759943002110135e-02   +1.409622507464681e-01   +5.520324908795281e-02; +1.970355249613347e-02   +2.982226439854228e-02   +5.416441278679182e-02   +1.078508530278487e-01   +6.283785250459616e-02   -2.204220626846692e-03   -2.466565010515148e-02   +6.058458453950896e-02; -4.792832658379218e-02   +9.941603634750885e-02   +1.553338693540766e-01   -8.217792323821087e-02   +1.377354961820658e-01   -3.199780150978406e-02   -2.571592771908078e-02   -1.230592903787298e-02; +9.511948337641414e-02   +5.356272509488335e-02   +8.047075453905306e-02   +5.063735315956986e-02   +7.152423185964514e-02   +2.190226899316891e-02   +6.609855622922411e-02   +8.600750361766413e-02; +1.212656616939053e-01   +5.768812624622752e-02   +2.685228477394926e-02   +1.873427605855869e-02   +9.625750680613451e-02   +3.801970979328254e-02   +3.871599690535607e-02   +9.331047281383487e-02; -7.870756483378816e-03   +6.857366500443328e-02   +9.371252929618292e-03   -1.241289419867244e-02   +1.809530935842262e-01   +5.592097656217229e-02   -1.185721494194096e-02   +8.888798877962817e-03; +7.412456930944902e-02   -1.028566708621769e-02   +1.050430719249989e-01   +2.985026954194678e-02   +1.216666568089637e-01   +1.148153048165163e-01   -3.477896502865802e-02   +2.085492513943537e-02; +2.585032469667470e-02   +1.134112112117456e-01   +6.936298732523570e-03   -3.415505185762587e-02   +6.458989966813196e-02   +1.502713378483439e-02   +1.253215987688022e-01   +2.041683305977867e-01; +6.973793388269779e-02   +4.612752781784395e-02   +1.098647506267745e-01   -6.692431245130881e-02   -3.091830575567363e-02   +2.818167521203865e-02   +1.902257295221101e-01   +7.294171509907454e-02; +1.138160863377657e-01   +1.165207807405870e-01   +2.471602117451872e-02   +1.082339559569119e-01   +1.172539011943600e-02   +2.274516548993747e-02   +3.332202871523221e-02   +9.040191946177650e-02; +8.933038699612667e-02   -4.410455156679335e-02   -1.562803841381594e-02   +1.132811594265214e-02   +1.156539891948050e-01   +8.524669598606774e-02   +4.881018879324126e-02   +1.778739094109922e-01];
L1E_L2E_iAMPA_netcon = [+1.727444132146579e-02   +2.160011278525419e-02   +1.391287901963579e-01   +6.199190541321370e-03   +1.006843295451186e-01   +7.524690414584464e-03   +5.115570906498074e-02   -2.122847165418158e-02   +8.890030452261900e-02   +1.881287354578619e-01   -1.596338372735310e-02   +1.807750436342920e-01   +1.663956839316641e-01   +9.746953259702071e-02   -2.746549729649792e-02   +8.960604765471814e-02; +1.095327108899505e-01   +2.920871156577440e-03   +4.717776867923899e-03   +1.238919221542964e-01   +1.229356716051697e-01   +3.077647041161841e-02   +5.290674947366902e-04   +8.583936950496639e-02   +1.860019948195216e-01   -2.395919273587632e-02   +8.314520220476390e-02   +4.632884811772488e-02   +4.486227808358945e-02   +1.046799966502427e-01   +7.397145716863468e-02   +4.373610841003100e-02; +2.462899977640830e-02   +9.929034297118355e-02   +2.102817476721574e-02   +1.103338593724673e-01   +1.062385896821939e-01   +2.331962086028409e-02   +9.785564771459082e-02   +8.721261529296619e-02   +3.647556547405905e-02   +5.518396336924145e-02   +6.319146377058615e-02   +1.926629230947052e-01   +4.458380768619099e-02   +4.221967498479932e-02   +7.533692740631961e-02   +7.802694424496703e-02; +7.668665845269229e-02   +1.272128818407127e-01   +6.953649819573253e-02   -1.418514947038854e-02   +6.376803361891059e-02   +1.444071380418031e-02   +7.237868712329876e-02   +4.244627158547330e-03   +6.308444495537105e-02   +9.129477405111570e-02   +6.145417497809213e-02   +3.562180098782286e-03   +9.023917625438913e-02   +1.426321915383511e-01   -3.105038427366156e-02   +9.874964439117170e-02; -5.303879910388250e-02   +8.342909937400766e-02   -4.694713613733284e-02   +5.059477291850019e-02   +8.486874994946805e-02   +1.262486908182958e-01   +3.827374309443807e-02   +4.588225396116657e-02   +3.925637301116580e-02   +8.851747454544645e-02   +1.779760779899393e-01   +1.026499599942778e-01   +7.643930252970915e-02   +1.698552319723345e-02   -5.159252233852169e-02   +1.423632115250585e-01; -4.210135084072782e-02   +8.671338748718074e-02   +1.581354284795187e-01   +5.443116327537675e-02   +2.114929400940677e-02   -4.209376451967622e-02   +1.540302220349467e-01   -2.470989602378858e-02   +4.556701347716120e-02   +5.427497905466410e-02   +3.531573678020627e-02   +1.204914677234012e-01   +6.436683306163038e-02   -1.396993382387521e-02   +5.845616379833713e-02   +7.607074286372303e-02; +4.804646398791365e-02   +1.252292436595183e-02   +1.328820236012983e-01   +6.929263873222763e-02   +7.649789460853271e-02   +7.186363724965777e-02   -2.815611147837437e-02   +6.585583430520449e-02   -1.200528385102592e-01   +6.267222339184092e-02   -1.217188210023908e-01   +2.006156995422502e-01   +9.140287815999197e-02   +1.950427289813237e-01   -7.625897501245327e-02   -1.928748753191008e-02; +3.511037058672312e-03   +1.796261203786965e-01   +3.217167534552624e-02   +1.772345392928516e-02   -6.075594720322138e-02   -8.589926738745712e-02   +8.236597762487723e-02   +5.364119280798244e-02   +2.456536063593003e-02   +7.251706017693803e-02   +1.182598897602371e-01   -5.222665190442054e-02   +1.183456182383041e-01   +4.846744414471137e-02   +2.750773411129528e-02   +9.377829439206353e-02];
L2I_L2E_iAMPA_netcon = [+2.331156400914179e-02   +3.971787610374979e-02   +1.171044321425741e-01   +1.375889465348162e-01   +2.974508213656819e-02   -6.151021572778748e-02   -8.819368323348117e-02   +6.563362682163595e-02; -1.981120476654698e-02   +2.107465926431054e-01   +1.047000541091022e-01   +1.143686367513944e-01   +9.016288806428534e-02   +5.924260728835430e-02   +6.913383948927579e-02   +5.503548903861612e-02; +6.626130510531346e-02   +8.176262466118525e-02   +3.300718836862958e-02   -1.296495834921290e-02   +5.455701356934858e-02   +4.459101629910874e-02   +5.971370805119427e-02   +9.410270646027535e-03; +1.251616183108842e-01   -1.077232323825484e-01   +4.721913319337081e-02   -2.831194434059631e-04   +4.197286591859233e-02   +9.958343880369529e-02   +8.202792267624104e-02   -2.331242420392746e-02; -2.080138693564784e-02   +9.543282091315008e-02   -7.589681369312348e-02   +8.927902302580214e-02   +9.563227991879217e-02   +4.390157375781445e-02   +1.720673973570976e-01   +1.637758412384729e-01; -4.295491118292432e-02   +7.037294485895790e-02   +7.157389029653546e-02   +4.697442544177376e-02   +5.348101085536849e-02   +1.365688259762606e-01   +1.576225356943467e-01   -4.854341979295330e-02; +7.029077702170936e-02   +1.346159450811371e-01   +1.708075238134077e-01   +4.362282069308548e-02   +7.756380285292860e-02   +6.757789931513015e-02   +5.646390570690915e-02   +1.299458725237923e-01; +1.185816968977543e-01   -3.919504037470686e-02   +1.804306515105982e-01   +5.657998451009658e-02   +2.124576665823431e-03   +1.310529613767049e-01   -5.722787286643297e-02   +5.138721996709027e-02];
L2E_L2I_iGABA_netcon = [-2.664298969826399e-02   +1.669752586512416e-01   +1.512820041739912e-01   +7.627200715856540e-02   -6.706746272951698e-02   +4.327761556642587e-02   +1.870015708643512e-01   -5.214239068342841e-03; +5.633488364489358e-02   -3.076386807075270e-02   +3.806648328137591e-02   -5.967267396018024e-02   +3.920000226046966e-02   +7.182529029801470e-02   +9.757437406604040e-02   +1.119236995839438e-01; +1.391620424729983e-01   +1.242373711504749e-02   +1.450401450795150e-01   +3.609263950846572e-02   -1.595107091807700e-02   -1.370139086853774e-02   +8.156093925099243e-02   +8.448309231460539e-03; +1.103837887760573e-01   -4.049260718951759e-02   +4.160181630346828e-02   +1.562348921869778e-01   +4.117841112887657e-02   +2.570151094486942e-02   +6.688080281482504e-02   +1.092733032390513e-01; +7.294687215973034e-02   +1.304200833217604e-01   -3.321344488796386e-03   -5.073102961749156e-02   +6.937415097626884e-02   +3.840421708373225e-02   +1.864838952345358e-01   +7.338377039364223e-02; -4.908938299030660e-02   +1.024789173581107e-01   +9.793962766808814e-02   +2.201392567096762e-02   -2.750724126715418e-02   +1.225399854008238e-01   +5.231578452171480e-02   +4.175645956919323e-02; -2.953029678307877e-02   +9.275566078859997e-02   +1.757211535210564e-01   +1.183510005409258e-01   +5.464493688673152e-02   +1.679792103599562e-01   +2.650224250037495e-02   +9.450922916114747e-02; +1.758717906664872e-01   +1.326234702767780e-01   +6.938221099481570e-02   +1.021391675125426e-01   +6.352767820349756e-02   +6.429429733351746e-02   -3.702900521611118e-02   -5.557808302151933e-02];
L3E_L2E_iAMPA_netcon = [+5.668146055713939e-02   -2.807418837302433e-02   +7.536770713939579e-02   -4.337619629630052e-02   -7.042604550329821e-03   -9.245798242316302e-03   +4.794003889338899e-02   +3.790856127524093e-02   +2.675211013742043e-02   -3.651796083347535e-02   +9.687685784293450e-02   +1.033708772366526e-01; +8.793388598702975e-02   +1.599227277229552e-02   -4.214077511802043e-02   +5.270915485657900e-02   +6.684343847229973e-02   +1.699685382728617e-01   +1.460888548453054e-01   +9.587076688492950e-03   +3.414214277897826e-02   -2.957930570399445e-02   -6.554340172277063e-03   -4.306357543050168e-02; +2.030667858396949e-01   +7.576520250414079e-02   +9.913711093465634e-02   +1.606490478223620e-02   +6.327779523552839e-02   +3.377645986443287e-02   +1.838334724018725e-01   +1.348866336936245e-01   +5.288225435858009e-02   -1.747830379085338e-03   +9.092042745145565e-02   +1.415427444530395e-01; +1.000101841081173e-01   -1.081382970495083e-01   +1.217948888020271e-01   +1.461159717351153e-01   -3.436931047186004e-02   -4.013655108551390e-02   +9.424104682650687e-02   -6.655929702276633e-02   +3.796797697957757e-02   +7.539463866463625e-02   +5.438167327484701e-02   -3.765472181294981e-02; -6.393945694437467e-03   -8.120952953930065e-02   +1.285101200122698e-01   -1.339601257102072e-02   +2.479068415171671e-02   -1.770149038203761e-02   +6.877707781722675e-02   +8.583633207316842e-02   +7.448244074779040e-02   +3.199405102492846e-02   +9.728573514602525e-02   +1.467918399602623e-01; +1.335803007551457e-01   +3.147041236052479e-02   +1.028776662642430e-01   +9.305629172483634e-03   -7.568040806863401e-02   +7.575230099664856e-02   +1.039157506625847e-01   -1.658965937097694e-02   +6.551832258321552e-02   +6.741895026290873e-02   +5.794274280318798e-02   -2.915268979157659e-02; +9.265091372206620e-02   +1.552212172768637e-01   +5.299665757580410e-03   -2.942417886440116e-02   +1.245740562603777e-01   +7.136088457460292e-02   +7.816939510808291e-02   +1.117680368148691e-01   +9.622029830387804e-02   +5.667999943758834e-02   -9.083934265677283e-02   +2.002013383339135e-01; -4.838291795090158e-02   +4.714239773423583e-02   +5.058825938035191e-02   -1.241694397420786e-02   +4.500335437144589e-02   -2.282418210289358e-02   +1.959204450540290e-01   +3.090817547166167e-02   +2.060670559173704e-02   +3.774835099692980e-02   +3.810077412698691e-03   +1.024997736508126e-01];
L3I_L2I_iGABA_netcon = [+1.137551165005908e-01   +1.881588256430651e-02   +1.250384074324193e-01   -3.942545471686523e-02   +1.489534853491241e-01   +1.711039736940763e-01   +3.863817633418290e-02   +7.725363155416640e-02   +1.526395222549303e-02   -2.021009007836128e-02   -6.346466088310534e-02   +6.729835370742260e-03; +1.353631600968162e-01   +4.637665225540772e-02   -1.814203970427358e-02   +7.638713968947439e-02   +1.193017164281071e-02   +1.303886351969982e-02   +9.699091872276971e-02   +8.728866585930103e-02   +1.449059971442866e-01   +7.199110644741165e-02   +7.139670696339667e-02   +1.237456686192901e-01; -9.194400233001443e-03   -6.361641663324528e-02   +5.157493338112722e-02   +4.876410428666419e-03   +1.715835790324049e-01   +8.536107304520020e-02   +6.785483380921749e-02   +9.145012261152125e-02   +1.267621385931358e-01   +7.035029108988294e-02   +8.376499570562379e-02   +9.115803694254286e-02; +3.089637064095128e-02   -1.162251169959192e-02   +1.479434890000005e-01   +1.857928588293952e-02   +2.761689448937640e-02   +6.759510189520411e-02   -4.130598480937847e-02   +1.102592049852363e-01   +1.426682264880413e-01   +6.038224233495555e-02   -4.647300594214133e-02   -3.469845221009304e-03; +3.166853953362241e-02   +1.071333882905136e-01   +3.457551346069922e-02   -1.337175678146063e-02   +1.563905042363637e-01   +6.825055403720504e-02   +9.252935597789735e-02   -4.573508089938765e-02   +9.655139272945332e-02   +1.111160351912516e-01   +2.059478804250366e-03   +1.244366269238984e-01; +8.472267542520570e-02   +5.748371240327503e-02   -1.396086894854276e-02   +7.164026189344175e-02   -9.762907966653508e-02   +5.891160046603026e-02   +1.135970433172130e-01   +8.780168018424492e-02   +3.394412264919955e-02   +3.998559760867345e-02   -8.760983082835209e-02   +1.570514499803960e-01; +9.100555064748792e-02   +1.350775833297927e-02   +5.456890208432846e-02   +1.488957849146985e-01   +2.031747692183011e-02   -8.346169673440831e-04   +1.306935447494249e-01   -1.030020755909793e-02   +1.327236471187554e-01   +1.369184830133734e-01   +3.876736964306678e-02   +2.965581516784688e-02; -2.768977871574333e-02   +1.015634006083892e-01   -4.905688603493773e-02   +1.044167305733446e-01   +2.199662397213420e-01   +1.780698858166136e-01   -7.791622686677199e-03   -4.856017874969477e-02   +9.318842286222803e-02   +2.541605559763424e-02   +1.022286000296117e-02   +1.775145782598571e-01];
L2E_L3E_iAMPA_netcon = [+3.978103688797665e-02   +3.895523248949039e-02   +4.970567327978871e-02   +2.027036507357035e-01   +8.243501515297161e-02   -5.078573729577121e-02   +1.221573899086664e-01   +3.437791300070719e-02; +1.771343075235927e-01   +1.238206684501404e-01   +1.686290609984818e-02   -5.980164957322694e-02   +4.629673980826636e-02   +8.551225891830927e-02   +1.212198102248272e-01   +3.908490932826540e-02; -8.897772541851814e-02   -5.156418315928869e-02   +3.064617353192433e-02   +1.095363389532329e-01   -4.691811981579509e-03   +1.461962985468766e-01   -8.987641206349803e-02   +9.526354944647017e-02; +1.041098160222548e-01   +1.533883765218716e-01   +9.911919962998195e-03   +2.398419620682534e-02   +8.512342726921623e-02   +1.200659752260986e-02   +1.330100321683255e-02   +6.640206938007816e-02; +8.359585614969554e-02   +1.702376913212794e-01   -1.700704112771892e-02   +5.107188694372893e-02   +5.510784159600353e-02   -4.146657859248448e-02   +1.231332494202503e-01   +1.018339007062277e-01; +5.752074669753373e-02   -4.067280133374462e-02   -2.093940723514470e-02   +1.044143108537468e-01   +1.440512272907706e-01   +5.526717463527605e-02   +6.983173199810455e-02   +1.201716682406863e-01; +5.136981857202177e-02   +4.235950743029580e-02   +1.444526865869906e-01   +7.792212586753901e-02   +5.556727180941096e-02   +4.668910045487065e-02   +2.606773466258441e-02   +8.737873836507573e-02; +6.002393040214216e-04   +5.005038930374837e-02   +6.218560807851212e-02   +5.060742926491232e-02   +1.016060310673662e-01   +1.025549477919681e-01   +6.392072552156094e-02   +1.721690675493887e-01; +1.053046101107473e-01   +8.688602874156313e-02   +7.027132123748135e-03   +6.881311028878605e-02   +6.626915846324433e-02   +9.858013817041046e-02   +5.916091704100825e-03   +8.943043774505438e-02; +1.890769554546089e-02   -4.538520158118092e-02   +2.051679744936927e-02   -2.805081779011120e-03   +2.525527470546499e-02   +1.404791108513084e-01   +9.985034449269220e-02   +1.174114029205204e-01; +2.557810192592038e-02   +5.576823535146076e-02   -3.614243437438948e-03   +4.253199502501648e-02   +4.645651858985096e-02   +9.006397583528727e-02   +3.135772122840210e-02   +7.357683729893849e-02; +7.095276727318409e-02   +7.489067474463447e-02   +1.002744065129224e-01   +9.985561352268960e-02   +1.162962453105253e-01   -8.242073190182123e-03   -2.510954605623207e-02   -2.242345302694371e-02];
L2I_L3I_iGABA_netcon = [+2.589837867705445e-02   -1.608897892267668e-02   +1.084426184262632e-01   +1.374630245478731e-01   +2.313641745753264e-02   +2.676627786011483e-02   -2.153655608674740e-03   +4.608567598656831e-02; +1.111992612057233e-01   -9.882405108776398e-03   +1.024221602225173e-02   +3.983903691122062e-02   +1.282801997159586e-01   +2.434867655223870e-02   +1.411600428868973e-01   +7.339678619021171e-02; -3.398292036862784e-02   +7.924197899044000e-02   +1.179582080166779e-01   +3.541754604664075e-02   +1.513827568995600e-01   +5.883483259689061e-02   +1.705896256253475e-01   +1.458001795973727e-01; +1.245552036468173e-01   -7.743903530664338e-02   +9.305623967889937e-02   +2.444339484695842e-02   +4.314562041072810e-02   +9.260982530173775e-02   +4.323850555857428e-02   +5.083415014550843e-02; +1.683116801456067e-01   +7.691808124192274e-02   +1.022531142568735e-01   +1.517929450348557e-01   +4.542108616120952e-02   +2.104451665065282e-02   +8.351531474571573e-02   +1.875631317583918e-01; +7.889893893006955e-02   +5.545823690419528e-02   -5.764691570211549e-02   +7.055208052975846e-02   +1.129238545490404e-01   +7.827288383643796e-02   +1.243680798490560e-01   +5.248983929919196e-04; +5.243273851574710e-03   +1.160556611958523e-01   +2.687153313679348e-02   +1.212839564545032e-01   +2.312221354763857e-02   +3.518600024164208e-02   -2.032900014399404e-02   -1.207897303609218e-02; +1.356314933298738e-01   +1.456568206641632e-01   -2.573045990180606e-02   +4.401777479178046e-02   -3.046649801720011e-02   +5.436437966828134e-02   +9.310981973074436e-02   +1.607882088869338e-01; +5.474769492284465e-02   +1.396909241332244e-01   -3.569118517532983e-02   +1.033372939500408e-01   +1.611821616411575e-01   -2.571670692816017e-02   -1.383193395128682e-02   +6.801288691496615e-02; +2.900185072175412e-02   +1.592216485775909e-01   -5.887535848560013e-02   +8.746369143257973e-02   -2.604554385990707e-02   +4.486811271345638e-02   +3.198161053381176e-02   +5.947777100450354e-02; +1.579714293175581e-01   +2.237148785350808e-02   +2.194174924511815e-01   +9.107089583146785e-02   +5.892373732465671e-02   -5.929214480249480e-02   +1.221586781922050e-01   +3.108067052315390e-02; +1.031366458724432e-01   +2.539698608267392e-02   +1.112203419457163e-01   +1.023714975880998e-01   +1.044257708941184e-01   +5.357096916687132e-02   +1.023551991345764e-01   +1.125856687728114e-01];
L3I_L3E_iAMPA_netcon = [+3.794552262480225e-03   +5.318991875934657e-02   -4.540163173975304e-02   +6.604486553292629e-02   +4.646216738819028e-02   +1.518254181159652e-01   +8.715914186757802e-02   +1.653045525655599e-01   +9.793352590547370e-03   +6.277650710243587e-02   +8.277998548507867e-02   +1.607412210354835e-01; -3.393799991703078e-02   -1.000329384305697e-02   +1.356403431599512e-01   +8.350396692316661e-02   -3.813189591135465e-02   +1.297767862132765e-01   +1.160536392008590e-02   -4.922689708893987e-02   +5.276333027778088e-02   +9.186332442533099e-02   +1.307131362620557e-01   +9.201284796527430e-02; +1.757558747651833e-01   -1.588640726030333e-02   +1.425622862202892e-01   +7.361603908291756e-02   +1.185727467477157e-01   +1.692400836498849e-01   +1.293244807570662e-01   -4.637512573880791e-02   -1.443237839856143e-03   +9.531133572439773e-03   +1.666229871597209e-01   +7.875411376698335e-02; +5.949747116066860e-02   +7.350996730182828e-02   +1.193695323229761e-01   +1.089645671443436e-01   +2.213406950684197e-02   +2.786408440535165e-04   +1.590018883737244e-01   +1.334708105629866e-01   +9.033472958304031e-02   +1.283976596827117e-01   +5.194178148245003e-02   +1.424331142397526e-01; +5.566469982474553e-02   +3.095065855290621e-02   +1.601896680083079e-02   +8.287181940992391e-02   +1.820607618223031e-01   +1.133336838015941e-01   +8.771433186406888e-02   +7.021839459585763e-02   +1.039695547703703e-02   +4.337965357276610e-03   +3.134460547534967e-02   +1.647717502566076e-01; +4.178866649677704e-02   +1.833179792375541e-01   +8.584591831084941e-02   +1.071785685636991e-02   +1.061198499923127e-01   -4.444404674850139e-02   +8.041369617978096e-02   +6.002382692006940e-02   +7.219777659356379e-02   +2.809713332779124e-02   -9.922973893724173e-03   +7.893864935620103e-02; +4.803203586103234e-02   -7.511206963256630e-03   +5.781785920106303e-02   +6.734967655485477e-02   +1.057841715548097e-03   -6.421568549555660e-03   -1.078484949315429e-03   +5.095217258816486e-02   +2.693633907835719e-02   +6.940148166591259e-02   +3.572520282595659e-02   -4.256178420458191e-02; +9.951543999056708e-02   +5.861591197704721e-02   +1.006376345671259e-01   -1.698969097490473e-02   +3.283145190396457e-02   +3.662902020004349e-02   +4.040869341809544e-02   -3.947693304358098e-02   +1.671684783086058e-01   -3.457962685256320e-02   +4.087384948236480e-02   +1.925029834172732e-02; +2.024020826690986e-02   -9.271356114577890e-03   +3.799298397695627e-02   +1.543328544629733e-01   +1.422833390420464e-01   +3.459683694905876e-02   +9.887477861134928e-03   +1.835627417720060e-01   -4.198562652824845e-02   +5.257370839475263e-02   +6.094349952363506e-05   +8.347938172551296e-02; +9.287515027472741e-02   +1.204459406754063e-01   +1.638745430987560e-01   +1.211837332933027e-01   +3.127905664795802e-02   +8.725656611174618e-02   +5.586298969097690e-02   +1.219989293115704e-01   +5.913860616575885e-02   +1.174082871892987e-01   +1.344383027068976e-01   +2.485719962179465e-02; +2.853462554691723e-02   +1.811346286075176e-03   -2.821743129326013e-04   +2.680688773362893e-02   +3.472799371180429e-02   -3.885228985653971e-02   +8.897896074516896e-02   +1.313579268099651e-02   +9.685513898810869e-02   +2.806068306543150e-02   +1.142757011041398e-01   +7.681997962990428e-02; -5.601936437733661e-02   +2.911501361580049e-02   -2.039396778129186e-02   -7.528494913826267e-03   +4.069489191794958e-02   +7.556011006390652e-02   +7.149354580542680e-02   -2.618183316510407e-02   +9.305533732839685e-02   +1.561790666970908e-01   +8.824621029084920e-02   -9.135098478767492e-02];
L3E_L3I_iGABA_netcon = [+8.635834173498971e-02   +5.556365811149523e-03   +2.349161189936887e-02   +1.091659453391933e-01   +7.407046870420622e-02   +4.359980315049938e-02   +8.764473822972438e-02   +1.540877624538639e-01   +9.059682129666391e-02   +9.096461562404110e-02   +6.452149947095930e-02   +3.058093853394275e-02; +8.941184400144384e-02   +9.035514651897548e-02   +4.308684698410185e-02   +4.655807880605169e-02   -3.044205987518993e-02   +5.373640317869774e-02   +1.426158800643756e-02   +5.084253694193579e-02   +4.578746604087583e-02   +1.606508205867057e-01   -5.455256519667622e-02   +4.548714836941002e-02; +9.366329997490402e-02   +5.344989868035606e-02   +1.913458769561933e-01   +3.400658757000685e-04   +9.387081890725579e-02   +1.543062902208038e-01   -4.708645200920209e-02   -1.488446422431031e-02   +4.585402715756223e-02   +1.037474690977840e-01   +8.865581398912026e-03   +9.297207259493351e-02; +1.678609152787832e-02   -2.074895552952291e-02   -2.243454543641012e-02   +6.990314059521253e-03   +3.526807770538418e-02   -2.626202043970600e-02   +1.464956639088539e-02   +8.463644882833946e-02   +1.051132642301946e-01   +8.148409224021590e-02   -5.916361088985474e-02   +2.231078071940821e-02; +4.795670228945222e-02   +3.425715818574604e-02   -5.148251068335086e-02   -1.233942499750367e-02   -5.506732115105319e-02   -5.196062418627916e-02   -1.141829865798178e-02   +1.017068252687245e-01   -7.873635229222874e-03   +1.137716999620256e-01   -3.060356097369287e-02   +1.484790286491731e-01; +6.603088121899725e-03   +1.660182811518347e-01   +1.892500269284482e-01   +2.748402023763053e-02   +8.620580229916142e-02   +6.899145629830303e-02   +7.435132638471682e-02   +2.218063737926802e-03   -7.300540509185410e-04   +1.411593902675154e-01   +2.328386891673598e-03   +9.644669804190856e-02; +2.204576480935265e-02   +3.161843243760063e-02   +7.361978338716414e-02   +1.686735946920297e-01   +9.715743521049172e-02   -2.726855876139408e-02   +7.002729317916104e-02   -3.897981379200298e-03   +7.423584889535211e-02   +1.085179669304929e-01   +9.258051026264189e-03   -3.943883120249789e-02; -2.330498766288416e-02   +4.943253991510686e-02   +1.099279469758595e-01   +1.339658633210323e-01   +1.497269218831420e-01   +1.548340106731360e-01   +4.212480335110756e-02   -5.441659437483620e-03   +9.930405436624859e-02   +9.464825378046872e-02   +2.968536533094729e-02   +2.346974130805417e-02; +7.914885664520885e-02   -6.062591580087506e-02   +5.312398523548274e-02   +8.438172611401737e-02   +8.629952129469430e-02   +6.704597578485016e-02   +2.186203246619449e-02   +8.521889077435403e-02   +7.294416135322622e-02   +9.704844974826261e-02   +6.637141734565298e-02   +1.363812458733440e-01; +1.254833669166427e-01   +4.778462097576081e-02   +1.299213300341620e-01   -1.691291577519868e-02   +1.531106490018128e-01   +1.954368952717764e-02   +1.135440692170088e-01   +3.730785410356754e-02   +2.138525006238719e-02   +1.625604931168752e-01   +8.713445328991504e-02   -3.048450673482927e-02; +2.612585221537895e-02   +1.713429718114363e-01   +6.914720834672169e-02   +1.017298885585923e-01   +9.917797460124900e-02   +3.240051718630256e-02   +1.196369997992492e-01   +7.501632360969469e-02   +1.485852017644507e-01   -1.636692438930316e-02   +1.127264706031420e-01   +1.703839706728039e-01; +1.474710362218293e-01   +1.399449041074829e-02   +4.690731100662448e-02   +1.043262816335718e-02   +5.057771360868164e-02   +1.229921178555693e-02   +5.716653518354632e-03   -2.532103905803287e-02   +1.700055163783262e-01   +5.111473512172719e-02   +6.182575342516346e-02   +4.500169874192966e-02];
L2E_Input1_iAMPA_netcon = [+8.429257928257358e-02   +1.034886560857394e-01   -1.224552879488554e-02   +3.235359185239074e-03   +5.496246063864149e-02   +9.611702653493223e-02   +1.502238771848952e-01   -7.380365893424228e-03];
L2I_Input2_iAMPA_netcon = [+7.270962107494644e-02   +1.332331125623327e-01   +1.776065865113623e-04   +1.574974582553311e-01   +1.841682368995373e-02   +4.521661807900494e-02   -7.272928710029568e-03   +7.077696125078363e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.6*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.4*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.6*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.4*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.6*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.6*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.4*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.6*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.4*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.6*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
