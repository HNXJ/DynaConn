function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.750300591860222e-01   +7.282138791949829e-01   +8.418418406377556e-01   +2.481365398161555e-01   +3.121595063935850e-01   +6.365614420558532e-01   -8.283012734776179e-02   +3.925624987574264e-01   +3.005772956400194e-01   +1.477728143498773e-01   +4.085863998828766e-01   +1.539955436834378e-01   +4.447750640244658e-01   +2.585186519078899e-01   +2.389665204615345e-01   +2.647686743673399e-02; +7.258730496195967e-02   +8.539490832302532e-01   +7.892963199393672e-01   +6.867493222077704e-01   +2.923059647156278e-01   +6.596067224904485e-01   +6.269298541891447e-01   +2.035114572187632e-01   +1.367521458785688e-01   +7.354649299413004e-01   +5.264205930339888e-01   +6.109574694829728e-01   +3.887560432291657e-01   +2.728325275866873e-01   +5.686248394034699e-01   +3.013751841999144e-01; +2.365257046885373e-01   +2.446080557889488e-01   +4.250702250004453e-01   +4.388430381491076e-01   +6.232223980461779e-01   +4.239407279917356e-01   -4.028292540067683e-02   +5.853708029370395e-01   +3.316856073328849e-01   +4.706105876874315e-01   +7.828698080770976e-01   +2.655251757117659e-01   +3.658966827569750e-01   -9.431964933439350e-02   +3.135709352837864e-01   +8.547511504390057e-01; +2.041897052427617e-01   +6.182335376006169e-01   +1.394062817564536e-01   +2.508920596216714e-01   +7.912104436700175e-01   +7.657641620079475e-01   +1.770422493976129e-01   +5.678079863096933e-01   +6.607709246069112e-01   +2.603260646217016e-02   +1.711177049328143e-01   +7.506075137513305e-01   +5.115923114857527e-01   +2.038410955087270e-01   +5.489315754011712e-01   +4.257847135636221e-01; +4.779679020325678e-02   +6.211266274186089e-01   +7.576074843482616e-01   +7.206696441417576e-01   +4.697378435068635e-01   +3.311105528642995e-01   +4.093928188977952e-01   +3.294962623884277e-01   +3.060664982499259e-01   +4.621795956579900e-01   +1.978870688401871e-01   +6.065456371196563e-01   +3.235647331212169e-01   +7.290707149204247e-01   +2.011662590871686e-01   +8.306501304387163e-01; +1.236770660523793e-01   +1.560538198849303e-01   +7.371252265699580e-01   +7.630946376919331e-01   +5.744353565877347e-01   +7.782848056987551e-01   +2.977256390819329e-01   +3.796822345414032e-01   +8.333683626254212e-01   +8.587213535360766e-01   +8.118365940091973e-01   +6.603747759438437e-02   +4.020047748135637e-01   +1.136782231686136e-01   +8.160723008938127e-01   +3.625310829806904e-01; +3.328649561091946e-01   +6.552085773964850e-01   +5.245275550363517e-02   +3.369128088987075e-01   +7.212291066447916e-01   +4.843542821614657e-01   +3.777729677793084e-01   +5.264273601921381e-01   +9.061839746322840e-01   +8.572464529595959e-01   +5.885776040063811e-01   +1.355801613611683e-01   +3.609635206462629e-01   +4.084186130068119e-01   +6.609396012793682e-01   +8.055039922506240e-01; +6.062899351236489e-01   +6.371289352260390e-01   +7.524266874066382e-01   +3.760150758367100e-01   +5.314333188646873e-01   +5.243446449865522e-01   +8.795665685802158e-02   +4.447559429769229e-01   +9.912855323864452e-01   +7.790287871615927e-01   -1.077685932928208e-02   +7.086318595578694e-01   +7.047512998054386e-01   +5.547417321890848e-01   +2.504695753918199e-01   +7.844784067275297e-01; +4.410113418992524e-01   +5.522613984140548e-02   +1.865827807791916e-01   +3.274347550654694e-02   +3.538218799428746e-01   +1.253393528914180e-01   +1.871754623418315e-03   +5.323828799658319e-01   +5.047133090800281e-01   +6.993783148424356e-01   +6.895626664911068e-01   +4.580865391332904e-01   +2.552166056793158e-01   +1.594846416671138e-01   +8.839766707203923e-01   +7.509491954588835e-01; +6.228979801317931e-01   +5.195407327367613e-01   +5.002255649707444e-01   +2.070083640166062e-01   +4.596970004179805e-01   +2.375005335846843e-01   +4.955102232561771e-03   +2.314918886183894e-01   +3.117345732908789e-02   +7.494067635891346e-01   +4.185139068497287e-03   +1.506493014180376e-01   +3.262159102874996e-01   +6.895292597529316e-01   +3.154776015881565e-01   +6.575471978426453e-01; +3.199499812608164e-01   +6.676216842081376e-02   +1.494078038599056e-02   +2.191902743159581e-01   +7.905692123533135e-01   +5.750209352117499e-01   +1.746923599653966e-01   +1.934488529353348e-01   +1.555156224857568e-01   +8.221717190161123e-01   +9.609388030645150e-02   +7.360334624832496e-01   +4.908999674928638e-01   +7.476002052585130e-01   -7.714278820504196e-03   +6.632950619335000e-02; +1.581820972989182e-01   +6.704930082054188e-02   +8.452651366285457e-01   +4.784039868826628e-01   +5.995833905070052e-01   +4.835805726301263e-01   +6.629189328797985e-01   +2.753133118628305e-01   +6.219424051270283e-01   +1.108769588884609e-01   +2.139711482118487e-01   +7.121236628547553e-01   +3.702557404037945e-02   +4.661835328555655e-01   +3.516655210222207e-01   +6.470072967613399e-02; +3.362198824172215e-01   +3.125668765112587e-01   +5.627543240997076e-01   +2.083051648286953e-01   +1.191138702396131e-01   +4.303387917714344e-01   +3.883783530327530e-01   +6.284939579663025e-01   +2.730251411604288e-01   +8.536894553094794e-01   +1.937845945338037e-01   +3.863274976625913e-01   +1.999326039859332e-01   +2.098657827230698e-01   +2.442906870927695e-01   +1.701569895908059e-01; +1.106740109743423e-01   +8.478596834245610e-01   +6.466711486594856e-01   +6.286343118131266e-01   +7.438973234824852e-01   +5.479700687181333e-01   +2.462541333119226e-01   +7.387962273026177e-01   +3.796742539280908e-01   +4.330589352745556e-01   +7.361012959502690e-01   +5.574386083490661e-01   +5.376972686163350e-01   +4.191102098368649e-01   +7.564627753537836e-02   +3.613370237919009e-01; +1.379398433891255e-01   +2.111062753003764e-01   +6.613612256699018e-02   +3.843239173062804e-01   +3.008004113808229e-01   +2.437891527696697e-02   +6.023136502741138e-01   +2.487243352627326e-01   +7.344516514393998e-01   +4.267283797017670e-01   +9.501362143485041e-02   +6.880151073845023e-01   +5.498848105622888e-01   +1.441807446234469e-01   +6.400622863246798e-01   +1.288996436994764e-01; +4.838181853110334e-01   +1.867885200806761e-01   +2.992087826646929e-01   +5.971481549260199e-01   +4.688985866440388e-01   +5.588667531545433e-01   +2.514587409337776e-01   +1.196810087589705e-01   +5.748766210817996e-01   +3.861351547857316e-01   -1.791076081367037e-02   +3.200940930417552e-01   +1.787526006716621e-01   +8.680773912645016e-01   +8.545251449668941e-01   -4.372474108977216e-02];
L1E_L1I_iGABA_netcon = [+9.587412201325146e-03   +2.660408017764980e-01   +8.821896219921260e-01   +1.742956181276337e-01   +4.207656728385198e-01   +1.244242273120434e-01   +2.539400283147023e-01   +2.358717766394993e-02   +1.964764602532011e-01   +1.197776028158552e-01   +4.259728620882118e-01   +9.134818934520278e-01   +1.573804063442506e-01   +7.206928156475436e-01   +9.618168560492241e-02   +3.884526340296046e-01; +7.626570167618431e-01   +7.180733599171116e-01   +5.397837104046790e-01   +8.238672400616630e-01   +6.324939133017783e-01   +7.823347219170015e-01   +5.864388570411022e-01   +7.486566533577570e-01   +8.354234683197810e-01   +8.968916997154345e-01   +1.514652410529914e-01   +8.530877663704388e-02   +5.484489752457656e-01   +8.510903673805849e-01   +9.796419673065082e-01   +1.793886690356710e-01; +2.348290893865111e-01   +8.446405964287991e-01   +1.126627273369335e-01   +5.977080401248624e-02   +1.093290846560572e-01   +2.213632814923784e-01   +5.669372135166670e-01   +6.869704424105889e-02   +6.213647003976137e-02   +1.302980057071616e-01   +5.215316271590705e-01   +4.256968952829479e-01   +7.726244065633222e-01   +7.442252982997400e-01   +7.791735339313810e-01   +7.435373452243259e-01; +3.369361698778008e-01   +5.632475113440275e-01   +6.047318389105183e-01   +7.555113233942948e-01   +6.593940886309531e-01   +5.965915066965369e-01   +6.235656741473647e-01   +8.186002795281464e-01   +1.092055622962805e-01   +2.647724932202592e-01   +4.745191095133530e-01   +3.208665537650935e-01   +7.595042728531198e-01   +4.640383509507031e-01   +8.722133835365579e-01   +4.976603018238011e-01; +7.131070084301167e-01   +5.788949541674611e-01   +8.670536933014096e-01   +3.908453426533769e-01   +8.659941904909082e-01   +5.056730943546157e-01   +3.230683411688292e-01   +4.495484394717289e-01   +2.497447755804456e-01   +4.164501364173061e-02   +4.501556334377557e-02   +5.891673481633731e-01   +8.558793163581760e-01   +8.100803090399165e-01   +3.762080101866914e-02   +1.236675741686628e-01; +1.896444829719294e-01   +1.141500495223875e-02   +3.289284119932916e-01   +1.968820369556418e-01   +8.115011071390638e-02   +4.411855337277407e-01   +8.203398108472137e-01   +3.005469910695687e-01   +5.537545630921932e-01   +4.503625920379971e-01   +8.877869213608739e-01   +1.254756672454390e-01   +1.968180020011979e-01   +1.932905550142164e-01   +6.888878512374529e-01   +3.195149154065534e-01; +6.824518727366707e-01   +5.107382627009615e-01   +2.955759241832910e-01   +7.114836175509381e-01   +3.022282653518242e-01   +8.145191256819581e-01   +6.037409632150088e-01   +5.449846571211540e-01   +7.882595387632672e-01   +6.033873789504319e-01   +7.692547348050097e-01   +2.241943910558995e-01   +7.459023776981917e-01   +5.305373322329464e-01   +9.210601192141830e-01   +7.887905406157952e-01; +9.291964328009328e-01   +1.137322349468951e-01   +5.957298260527820e-01   +4.381223131768613e-01   +6.436495718500329e-01   +2.063976937065742e-01   +2.967344396593966e-01   +5.494275905412855e-01   +1.637019739178073e-01   +8.350904734085450e-01   +6.838732052980460e-01   +7.569903656654542e-01   +2.538077005110684e-01   +6.486739241450008e-01   +4.586839022112169e-01   +5.797614465544415e-01; +5.532495764425280e-01   +1.000000000000000e+00   +3.968541803929557e-01   +9.154270674858829e-01   +1.740314800392231e-01   +6.355146584196719e-01   +5.472711214396765e-01   +8.621004318862250e-01   +8.647102690876961e-01   +7.145256385069820e-02   +1.941729603192051e-01   +1.978199618588159e-01   +8.822298401354441e-01   +2.550465540961341e-02   +8.406453267250795e-02   +4.381119971187678e-01; +2.343100819004157e-01   +3.608103125313844e-01   +5.380806866424779e-01   +2.115608884147810e-01   +8.760253184736108e-01   +3.718095663583486e-01   +3.038812561094978e-01   +9.125150304716796e-01   +8.621175534413515e-01   +8.877957026384906e-01   +8.277423819219227e-01   +9.462963553962497e-01   +4.592547924226850e-01   +3.669818322562801e-01   +3.126233820351942e-01   +7.544023785455422e-01; +1.802952946420365e-01   +1.984737579698364e-01   +7.109097685552956e-01   +7.738091979076490e-01   +2.410859993469669e-01   +6.019114835860540e-01   +7.596804750942583e-02   +4.273470754207606e-01   +3.984835835637049e-01   +5.908498042028173e-01   +3.443508883949271e-01   +8.560866282308034e-01   +8.304599186357223e-02   +4.411646148085441e-01   +4.395275467656877e-01   +3.647773711759880e-01; +1.770195062841108e-01   +9.322852012247744e-01   +7.209912119237499e-01   +5.347541851319932e-01   +4.475784522864212e-01   +8.731058865544564e-02   +1.481426075234334e-01   +3.935757405412906e-01   +1.618544877179337e-01   +4.906141978192149e-01   +2.055348339333954e-01   +3.887926485630145e-01   +3.579817410516554e-01   +8.600985728459927e-01   +6.999544947196999e-02   +4.792641616749337e-01; +9.131782567048214e-01   +1.654606272810509e-01   +4.895841956766504e-01   +4.809031992746973e-01   +5.538363081504074e-01   +5.789704831332463e-01   +1.615300959264569e-01   +4.529126931934478e-01   +4.281911624798697e-01   +3.388578423803206e-01   +8.879442647785296e-01   +8.984627999731694e-01   +7.858837137611590e-01   +5.710077734263039e-01   +2.606283584088364e-01   +6.886767862814991e-01; +4.476020687897868e-01   +8.291947414014018e-01   +3.415655355092020e-01   +3.491022986084262e-01   +6.993739825301820e-01   +2.052090357498608e-01   +2.606604104636963e-01   +5.501311196128449e-01   +3.205833263826965e-01   +4.444816069788549e-01   +1.766064091006480e-01   +1.303154039037766e-01   +2.770039987209722e-01   +2.555212194629318e-01   +5.108563715195147e-01   +8.572337658419412e-01; +5.441744997838345e-01   +6.109470416573763e-01   +6.566952128997944e-01   +5.965958264668433e-01   +6.656649637152606e-01   +1.361742787356979e-01   +8.645558194276526e-01   +2.478232818636458e-01   +8.031147886971352e-01   +4.991038144381388e-01   +6.870151051187666e-01   +4.887216826740370e-01   +2.874186055920497e-01   +4.549355730409170e-01   +7.934722429395943e-01   +4.327283671682871e-01; +3.382379826669906e-01   +5.649581498947157e-01   +5.611441568624943e-01   +2.585149488953791e-01   +4.149715190811210e-01   +2.748600535441283e-01   +5.094911993013123e-01   +2.313911473931656e-01   +8.320511710304979e-01   +2.729196651227094e-01   +2.796071066419942e-01   +1.830880477479067e-01   +4.175933366883907e-02   +4.169850396525443e-01   +9.908678525468699e-01   +9.333904108118516e-01];
L2I_L1I_iGABA_netcon = [+6.250954157954287e-01   +4.064839983875227e-01   +6.497615920808572e-01   +5.620489113825992e-01   +8.949350542659439e-01   +5.840417164983273e-01   +8.677451978639864e-01   +7.799935623881497e-02; +4.286713484576900e-01   +1.702601708155012e-01   +2.482038739634241e-01   +9.219958111818616e-01   +2.504193632515422e-01   +4.242556186823353e-02   +7.919542343850214e-01   +6.195959916628425e-01; +1.000000000000000e+00   +5.275358627653034e-01   +5.752567116941490e-01   +7.128815160771410e-01   +7.011658669133578e-01   +6.444249522052071e-01   +2.793162486684994e-01   +2.879077672661420e-01; +3.518646789166595e-01   +1.995855921023357e-01   +8.476082138633984e-01   +4.331273595634782e-01   +7.301263024896097e-01   +3.509964445496616e-01   +9.424307653936477e-01   +1.783281186747100e-01; +6.935180160081590e-01   +4.714475281832787e-01   +6.279485922632730e-01   +2.042722370654996e-01   +9.384646304391741e-01   +3.217918236507746e-01   +5.273774973830586e-01   +1.992549057326606e-01; +5.691112519295224e-01   +5.588510236209269e-01   +7.187212150688972e-01   +1.461000233620683e-01   +2.129325686437963e-01   +8.364314393221295e-01   +8.448021447118447e-01   +5.145587338784459e-01; +7.656980092310185e-01   +5.122098385404329e-01   +2.425243185808767e-01   +2.570147337927577e-01   +7.195334915845834e-01   +1.479819278754426e-01   +6.336726463340914e-01   +3.855670437700714e-01; +9.111976642493720e-01   +4.216452467379227e-01   +6.151219373310832e-01   +8.298846874505020e-01   +9.019497666439140e-02   +4.365309527588195e-01   +4.076189313163230e-01   +2.738694176396716e-01; +7.095977226018066e-01   +1.510753494604242e-01   +4.360839232741053e-01   -2.986307619431097e-02   +7.161256428494709e-01   +3.674271744053954e-01   +7.453308936686592e-01   +7.022782885750704e-01; +4.394350165974664e-01   +7.621849404901186e-01   +6.285580805763576e-01   +7.957695461925195e-01   +3.927816607485468e-01   +8.139149002426859e-01   +7.424611206842201e-01   +2.136781164972356e-01; +5.501397274095557e-01   +5.398427236594187e-01   +5.438815074262761e-01   +3.369338967236267e-01   +8.963901988564704e-02   +8.375548271216303e-01   +5.480108628887409e-01   +4.106332713500083e-01; +6.775288930768085e-02   +4.011110689363560e-01   +4.014489610886704e-01   +4.393583251960150e-01   +3.780735318280661e-01   +4.487019918833524e-01   +2.502694962553301e-01   +5.211936458286777e-01; +3.608400767395984e-01   +1.515397396825499e-01   +6.354739624650482e-01   +7.579382234912205e-01   +2.178824139980267e-01   +6.860018210008676e-01   +3.684765919971508e-01   +7.339183211339072e-01; +4.573169923104631e-01   +4.327146441404711e-01   +6.218417723141053e-01   +3.190120050037003e-01   +7.796339471908901e-01   +3.605295258127601e-01   +3.677671968696742e-01   +3.026842551784103e-01; +5.834801424870113e-01   +1.358538623751412e-01   +2.156462512639730e-01   +1.986650946805451e-01   +5.937634818229588e-01   +5.677525440445096e-01   +2.847585547424474e-01   +6.804394036113651e-01; +7.144484757060771e-01   +5.827242551075496e-02   +6.590241157297800e-01   +3.825114417297560e-01   +3.563363386779723e-01   +4.905503322628233e-01   +1.884086432236806e-01   +3.283838253912119e-01];
L1I_L2I_iGABA_netcon = [+4.749975840593417e-01   +1.778537829804877e-01   +8.131287529797514e-01   +2.756674212760142e-01   +4.903800073667046e-01   +2.427812342469464e-01   +8.581711187014092e-01   +2.635264873896119e-01   +4.944683289345324e-01   +8.143735625125502e-01   +3.764372697485591e-01   +3.830613957082136e-01   -4.617524571157360e-02   +6.803661661208810e-01   +5.916691178734325e-01   +4.315434077061424e-01; +2.722361770150752e-02   +2.531636262014561e-03   +2.900291616976735e-01   +2.614181516976073e-01   +8.982201564331177e-01   +3.634875440051586e-01   +2.618609646626257e-01   +1.884562367736279e-01   +4.768378050926512e-01   +2.221456729882494e-01   +3.125139820018143e-01   +2.729940150489190e-01   +9.614540643903137e-01   +2.090641768158652e-01   +7.521403551867862e-01   +2.362698048569700e-01; +3.408375837876063e-01   +6.223533144040985e-01   +2.859706535485824e-01   +6.770912271836808e-01   +2.629892609972663e-01   +5.787466218158300e-01   +7.683218440280521e-01   +9.545049821774328e-02   +7.365483602177447e-01   +4.802994667984805e-01   +5.416748133605179e-01   +8.481042515846783e-01   +9.469759184956555e-01   +6.581089381794781e-01   +3.528600187055040e-01   +2.147859715319395e-01; +8.915731788390424e-01   +8.885790112196729e-02   +6.525889752676011e-01   +9.205821669589465e-01   +4.373325080237941e-01   +8.548572414358055e-01   +6.300853118368862e-01   -1.014959805764570e-02   -2.535719432333117e-02   +2.816399565321798e-01   +3.999103479935605e-01   +4.401524433470722e-01   +3.144283647222290e-01   +4.693676628564049e-01   +1.801016494450832e-01   -1.032002940426391e-02; +8.646578095159357e-01   +8.458890220588552e-01   +7.841340231271197e-01   +5.840799505655168e-01   +2.958093047333286e-01   +6.676850790065765e-01   +6.744819017660603e-01   +6.129540308194689e-01   +1.344964482453238e-01   +6.790441100169852e-01   +2.506592782311698e-01   +5.039644538504869e-01   +8.289572917093786e-02   +1.972681211429703e-01   +7.171286178584398e-01   +9.667486316939258e-01; +5.570399481009382e-01   +5.276398528207984e-01   +1.257587620919542e-01   +3.167695834102363e-01   +9.148695899524822e-01   +1.447332082673776e-01   +7.173289910916764e-01   +6.322339181316944e-01   +4.634062193138801e-01   +7.267574398740564e-01   +3.228913917135660e-01   +4.835861202189524e-01   +9.122567077412788e-01   +1.339933234560426e-01   +2.363626804728886e-01   +8.514351403431104e-02; +8.860040454697384e-01   +9.527190533232220e-02   +4.232683666863710e-01   +3.339087607020201e-01   +5.287447372370723e-01   +8.663219375015443e-01   +9.181069261954176e-02   +2.401420189272336e-01   +7.697026004171768e-01   +9.146436813089609e-01   +9.137703862781488e-01   +7.909385138025047e-01   +1.465933951865025e-01   +2.063874920993721e-01   +1.167539485117692e-02   +5.348809260656595e-01; +8.833049531834007e-01   +3.962620330102115e-01   -1.132257879475954e-02   +8.428180500806554e-01   +1.506978975670686e-01   +9.147993408510882e-01   +7.741279616583113e-01   +7.594449224612018e-02   +8.188527592827470e-01   +1.077333079326309e-02   +9.052276741348092e-01   +1.890437489089954e-03   +8.195206678734278e-01   +9.549137885638187e-02   +9.384942340867123e-01   +6.649031824603167e-01];
L2E_L1E_iAMPA_netcon = [+3.218298241169569e-01   +9.221955395266080e-01   +6.025060110238327e-01   +5.557867711236357e-02   +3.514892530232800e-01   +3.324690606961938e-01   +5.086917051582784e-02   +5.877198013994155e-01; +1.707446021786134e-01   +1.564468240481728e-01   +7.200680896930294e-01   +8.587414137855087e-01   +3.824777098752351e-01   +5.466306581295775e-01   +1.840690720614117e-01   +8.596397568020257e-02; +5.097386095228978e-01   +8.612495129331031e-01   +7.177105061562240e-01   +2.220790259772227e-02   +6.126014114777510e-01   +3.710258137935021e-02   +4.068138349760594e-01   +8.480328442818719e-01; +3.980459180942151e-01   +6.460193866084886e-01   +3.627721755325141e-02   +5.704159873889885e-01   +2.331234427448834e-01   +6.144830617174252e-01   +1.669136316015682e-01   +4.819965619824871e-01; +8.596775108648393e-01   +6.223654351736809e-01   +7.499320295049208e-01   +4.777856503716616e-01   +7.110230830739708e-01   +3.694178716245110e-01   +4.112658904796663e-01   +5.107757245030916e-01; +4.587449488965906e-01   +5.937453591330500e-01   +1.953445977845821e-02   +6.255932747079558e-01   +6.391088977453580e-01   +8.482668257602520e-01   +2.904517899007012e-01   +6.317971325945977e-02; +4.131739414666197e-01   +3.107596474478143e-01   +2.588540229294545e-01   +3.850229083050995e-01   +4.096269543973721e-01   +2.422260127821894e-01   +5.573374624236996e-01   +2.490716188864257e-01; +7.249702349406212e-01   +1.916934714684000e-01   -8.557371312804037e-02   +1.000000000000000e+00   +5.873330169836078e-01   +3.708956960019163e-01   +5.769982173175560e-01   +6.038401263443122e-01; +7.904370341558289e-01   +6.089801233140654e-01   +6.594306367648443e-01   +1.103513604136391e-01   +3.586431959057937e-01   +1.983180530426741e-01   +9.995129639273495e-02   +9.542194276275603e-01; +3.556971841317558e-02   +1.774510147162202e-01   +1.571442889446331e-01   +2.191195622827809e-01   +1.130419289438514e-01   +5.433007106869316e-01   +8.745491673064529e-01   +8.895360829191769e-01; -6.294831342115954e-03   +1.912519303092869e-01   +5.489247297526727e-01   +4.151603209117012e-01   +1.725830205002889e-01   +4.116181190158414e-01   +2.213313333409960e-01   +6.764523919873852e-01; +3.416697346820835e-01   +5.902813840405255e-01   +5.840771004360795e-01   +4.320027801469178e-01   +6.591497658193198e-01   +3.249255642387255e-01   +6.392355632133540e-01   +4.837356548706829e-01; +6.838605354113274e-01   +7.216795766977703e-01   +5.470535707037498e-01   +1.790447690921027e-01   +1.995585272434780e-01   +1.344722026798061e-01   +7.161415656898316e-02   +5.327039416899864e-01; +6.895067664216080e-01   +7.981653959348778e-01   +8.194498831552333e-02   +8.960235252365261e-01   +5.092096590531193e-01   +7.477063407542649e-01   +4.512251858991845e-02   +1.571423704427417e-01; +8.888893870409097e-01   +2.095827293366688e-01   +5.255520883344604e-01   +5.915101249066519e-01   +3.344575654876837e-01   +1.970879909471472e-01   +6.366586145591570e-01   +4.833901588012735e-01; +7.720530733690864e-01   +5.793473221818507e-01   +7.253934598077942e-01   +3.387747815341113e-01   +4.776331242288939e-01   +8.231043793784774e-01   +6.929384281129205e-01   +1.727165178395980e-01];
L1E_L2E_iAMPA_netcon = [+7.752399381471652e-01   +3.899688694299795e-01   +5.677853155985074e-01   +1.739955478178656e-01   +9.049092159376014e-01   +1.796893321469874e-01   +5.019164898077978e-01   +4.471180982339145e-01   +9.867600587070336e-01   +5.089433277272554e-01   +5.404164625013234e-01   +4.507851048294849e-01   +5.310965338829429e-01   +2.974776045701867e-01   +5.804244087732020e-01   +3.050798347878487e-01; +7.439334802863682e-01   +1.819845569434567e-01   +1.630519192884462e-01   +5.373539205979480e-01   +8.093517711565856e-01   +5.688276081909804e-01   +9.036726357656263e-01   +2.444862177885890e-01   +3.182369018871986e-01   +2.935535562232823e-01   +6.168257752174594e-01   +6.104725903718021e-01   +5.827688170634575e-01   +8.525162746683749e-01   +3.777412918099037e-01   +5.304829470786906e-01; +7.218764109871799e-01   +9.502234494967288e-02   +1.614264953197132e-01   +9.358512102649558e-01   +2.219215878724675e-01   +3.476555351077202e-01   +8.492220095919009e-01   +3.407393200282177e-01   +2.377697860759235e-01   +6.007437568155628e-01   +7.556933815801162e-01   +4.549628402953766e-01   +7.519756142313486e-01   +8.507728333414160e-01   +7.360806882722389e-01   +5.785386646251968e-01; +6.061397199098387e-01   +5.674011106234216e-02   +5.149516608320944e-01   +3.133204985038650e-01   +3.740815499949933e-01   +7.712284296882428e-01   +2.288565360167654e-01   +1.471292681798367e-01   +5.431793770780700e-01   +5.271993247431783e-01   +4.104327639513230e-01   +9.417573232261929e-01   +6.630548410558095e-01   +4.026878014965493e-02   +7.468640415032345e-01   +7.801326299546665e-01; -3.198596762640808e-02   +2.331479067627957e-01   +1.570310002688999e-01   +6.658703814509779e-01   +1.037267618061081e-01   +4.114548700901662e-01   +9.382598246380117e-01   +3.389968026199239e-01   +1.123802065754742e-01   +7.377043343002329e-01   +7.944945699633382e-02   +5.124674019292181e-01   +3.067643461638719e-02   +6.141711658409190e-01   +4.518290880588631e-01   +1.920555417553055e-01; +6.150444007581336e-01   +3.787868216102921e-01   +4.096625072118206e-01   -1.579714596199895e-01   +8.234458553927098e-01   +8.747959673704893e-02   +4.439221050160308e-01   +2.122194914068757e-01   +7.323177414540992e-01   +9.812167049337165e-03   +6.745327207634758e-01   +1.750340794206097e-02   +6.693160873773210e-01   +5.041951547048034e-01   +7.033471198942481e-01   +3.098212741249602e-01; +2.583699784683142e-01   +7.187961318466244e-01   +3.455378354822913e-01   +3.580974129975163e-01   +2.360412977009111e-01   +8.035154407353460e-01   +9.413781108517788e-01   +3.891360913674682e-01   +6.350170222005799e-01   +7.259240298795030e-01   +1.518280253508826e-01   +1.383825179831726e-01   +9.189140734654623e-02   +3.069613537019374e-01   +2.816903885519443e-01   +7.579151578186362e-01; +1.495431051504279e-01   +3.482976505396944e-01   +2.736701143246072e-01   +4.532001089168611e-01   +9.976390030778997e-01   +4.386210382831617e-01   +8.825788582650642e-01   +8.047254182459110e-01   +3.878533209941473e-01   +3.346735643302257e-02   +3.498215058768135e-01   +4.163799730820302e-01   +3.130107680464996e-01   +6.394902760518461e-01   +2.104333033301005e-02   +4.767749613328953e-01];
L2I_L2E_iAMPA_netcon = [+3.216656046571482e-01   +2.665868432332681e-01   +3.264545014508512e-01   +5.635301209105573e-01   +1.619451351947356e-01   +7.793058764319319e-01   +6.740270693542040e-01   +2.254303416015867e-01; +4.834011811968120e-01   +1.708335052408863e-01   +6.840015544738287e-01   +2.671230655379715e-01   +6.442303605220361e-01   +8.429932601782626e-01   +6.942693473681621e-02   +4.636537444057480e-01; +6.121760792364074e-01   -1.266447714734515e-02   +6.747545345518742e-01   +5.519039422315808e-01   +1.685554701292740e-01   +5.910012734102424e-01   +7.649809301090316e-01   +1.891134124705012e-01; +5.221135328578972e-01   +2.343837071416915e-01   +2.275666169138458e-02   +9.635081010572727e-01   +3.356319291367316e-01   +6.463652721958202e-01   +9.293967104943777e-01   +1.797680321338517e-01; +7.891216439813298e-02   +3.805821553709851e-01   +4.793313276171466e-01   +8.492694556541065e-01   +8.505760774205905e-01   +5.347611258728195e-01   +7.099677390283874e-01   +1.649717436719874e-01; +8.161726340754769e-01   +4.456765239929434e-01   +8.984657730461302e-01   +8.848458519087503e-01   +6.567764721954141e-01   +7.897946258425962e-01   +8.438649742540504e-01   +5.267869688643072e-01; +8.497211418534048e-02   +5.596131313895162e-01   +8.621704031190432e-01   +8.171882168778011e-01   +8.341208080813521e-02   +7.340545021580042e-01   +1.945222959637374e-01   +1.241361950476077e-01; +5.893996332258962e-01   +4.272683043043389e-01   +1.846326621542358e-01   +3.367202685403195e-01   +6.629458848831699e-01   +4.196935371984314e-01   +9.978528053848711e-01   +6.951059745904949e-01];
L2E_L2I_iGABA_netcon = [+4.175273589519832e-01   +6.168977409238626e-01   +5.740882881861326e-01   +1.872988188794473e-02   +4.221800265595836e-01   +5.000620788756397e-01   +2.731107863364417e-01   +6.964014145588211e-01; +5.439672171434428e-01   +2.791840712983077e-01   +5.241292309072434e-02   +5.028649744991600e-01   +4.737149174283382e-01   +6.495352581470353e-01   +5.211279452134041e-01   +4.140633098856432e-01; +5.717611949168772e-01   +5.653509351230799e-01   +4.045499945281276e-01   +6.226650425083998e-01   +3.241520873250934e-01   +2.966539997343144e-01   +1.093129174993640e-01   +9.411887023797951e-01; +6.730425359287154e-01   +5.531698597558131e-01   +4.222646597302398e-01   +8.642136974269744e-01   +2.244112003265351e-01   +7.565236133559392e-02   +1.421372440119932e-01   +4.226873778095350e-01; +5.095332300006630e-01   +7.821607468959405e-01   +4.992949311092816e-01   +7.217447462460160e-01   +4.145715370966276e-01   +7.418578878675764e-01   +6.248218614492796e-01   +4.191762285495656e-01; +3.259297937475040e-01   +2.569135412331983e-01   +4.407179019253480e-01   +4.063036482561158e-01   +7.306032289340265e-01   +8.249689871516241e-01   +1.123032492057161e-02   +4.135068373566021e-01; +8.468710286774038e-02   +4.629154539816961e-01   +7.975960402374220e-01   +5.644313088577123e-01   +5.182709228888263e-01   +4.084441879681303e-01   +9.151138781141485e-01   -8.984990540257715e-02; +8.616636717437440e-01   +5.771201088962991e-01   +8.479307075846345e-01   +4.975788548771106e-01   +9.084678090694408e-01   +5.383147518763063e-01   +3.073426416054950e-01   +3.283977088352930e-01];
L3E_L2E_iAMPA_netcon = [+2.552706996428415e-01   +8.834314707494132e-01   +4.580333085158771e-01   +6.855044640534528e-01   +2.077785134802684e-01   +4.063181770782778e-01   +2.988002038660531e-01   +9.169810070668197e-02   +1.403876099748156e-01   +5.155207905096973e-01   +1.343063099521597e-01   +5.161963098601254e-01; +2.802746907332699e-01   +4.339598534041167e-01   +1.335177108252458e-01   +2.472019729223618e-01   +5.303937740511947e-01   +8.808118641464959e-01   +7.081349718236147e-01   +5.325034837260330e-01   +2.488720621512379e-01   +4.070166587065355e-02   -1.024328678558621e-02   +8.906320561403164e-02; +7.954332986369705e-01   +3.630575568388135e-01   +5.093245040777500e-01   +1.114772746431475e-01   +8.231473671445094e-01   +9.006743173039650e-01   +5.549092592238065e-01   +6.612101260293274e-01   +7.097430213423179e-01   +3.072054794379880e-01   +3.392623586481485e-01   +9.080714515751984e-01; +9.455748562707265e-02   +4.631778362804077e-01   +2.222754671841896e-01   +7.791585548704300e-01   +4.931442049914158e-01   +5.719039497249988e-01   +8.288524687217123e-01   +3.455396211511216e-01   +8.540971673321094e-01   +7.534193657046970e-01   +4.147782316535489e-01   +1.086114750610195e-01; +1.537483518658438e-01   +7.300179498368218e-01   +4.366913494450282e-01   +4.570958472934557e-02   +1.487581738662111e-01   +9.309036224322828e-01   -4.282180522921435e-02   +6.175479740161669e-01   +1.179289672213740e-01   +8.565934061033302e-01   +2.276117047615913e-01   +2.280689970861466e-01; +2.708332882573558e-01   +3.914805171267051e-01   +8.485782253851931e-01   +9.536175055732111e-01   +4.130562609941789e-01   +8.992060833350376e-01   +3.733593665938065e-02   +3.235120729861304e-01   +5.369431996003619e-01   +7.306827758529187e-01   +5.760262473679920e-01   +7.950863609159833e-01; +2.581125172650377e-01   +4.824189957337797e-01   +5.477082356674697e-01   +1.412981950057872e-01   +6.432012852618627e-01   +5.121106201958356e-01   +6.923468475112100e-01   +1.298127290620964e-01   +3.638619846978985e-01   +4.181147087429820e-01   +9.749008663323003e-01   +6.864802493170880e-01; +5.423558235212079e-01   -4.199672303718988e-02   +3.450494747932192e-01   +1.251784971063911e-01   -1.947689643487921e-02   +8.674204203124263e-01   +3.782791367523972e-01   +4.402300660889088e-01   +8.786767933112898e-01   +9.910598597583575e-01   +8.616455057914610e-01   +2.628731770507339e-01];
L3I_L2I_iGABA_netcon = [-1.277507191646525e-02   +4.439732195048179e-02   +1.022835126730527e-01   +6.175278763648288e-01   +3.720353040557970e-03   +5.203541206740435e-01   +7.755242646898618e-01   +4.107527023573782e-01   +3.522199835000682e-01   +8.566944973091049e-01   +8.042746854554891e-01   +6.561839807193018e-01; +4.147646358505317e-01   +3.671312889436813e-01   +2.765077704105952e-01   -5.678247336454700e-02   +4.822238814428998e-01   +6.280193919498895e-01   +4.789965061019831e-01   +9.070935973561232e-01   +1.746951628278868e-01   +9.122079729689477e-01   +2.215595516940702e-01   +5.917207515876568e-01; +3.153800280271418e-01   +6.109497657981143e-01   +2.664447405476196e-01   +7.256270541158103e-01   +2.961931807454383e-01   +8.265886678452837e-01   +8.807705185818628e-01   +1.006817596395776e-01   +6.197336655625890e-01   +4.438411510231940e-01   +1.373263256063109e-01   +5.537881128242896e-01; +5.523647129884249e-01   +9.947133578482847e-01   +2.603610630662553e-01   +1.613313152341590e-01   +1.623565189452837e-01   +5.918558705020920e-01   +1.798537745982018e-01   +1.893340760555956e-01   +4.995704659810296e-02   +3.733701566646866e-01   +5.452066253908610e-01   +7.675879493066932e-01; +9.092037229293883e-01   +1.217765226775225e-01   +4.464593838875940e-01   +8.820001859242020e-01   +4.391302668065601e-01   +8.343416258446966e-01   +1.366437413099116e-01   +4.777056589446444e-01   +5.277751406022696e-01   +7.211596195491677e-01   +6.879779088548605e-01   +4.125535342635910e-01; +8.546027741187732e-01   +2.244334067461956e-01   +1.649268976123841e-01   +7.320757898120134e-01   +8.626770819629241e-01   +7.554364450479825e-01   +9.085170727607053e-01   +6.146578491999928e-01   +1.157663909224288e-01   +7.810922854077670e-01   +3.278753652362049e-01   +5.982839380674955e-01; +9.009062512515126e-02   +4.644708010313334e-01   +8.865373381763076e-01   +5.971894802972458e-01   +9.493678136333253e-01   +7.025021482280772e-01   +7.952752280834391e-01   +6.983875122284231e-01   +5.522403627266805e-01   +3.763888721295375e-01   +3.147801942407492e-01   +4.863226969629255e-01; +4.133286626074843e-01   +1.524457825484903e-02   +7.498028265391918e-01   +2.292691619052257e-01   +4.196460774413690e-01   +2.734398156332318e-02   -2.402256854663710e-02   +8.392504181035806e-01   +4.180359082998993e-01   +7.103550779638618e-02   +7.557959820506840e-01   +8.668144753025742e-03];
L2E_L3E_iAMPA_netcon = [+9.489080601121905e-01   +1.991127725167863e-01   +4.550203249159837e-01   +7.442263994509727e-01   -5.393222814000054e-02   +6.359058089513392e-01   +7.825148737864289e-01   +1.773422954204792e-01; +3.766417823412447e-01   +5.077991623849213e-01   +6.954871688450870e-01   +5.978478403527278e-01   +2.646666144240936e-01   +1.464112507746781e-01   +8.288973899736464e-01   +7.118223842852750e-02; +5.814435821728339e-01   +4.900222197267764e-01   +8.598295494677954e-01   +5.086983592622620e-01   +9.149976053583799e-01   +4.680418868848644e-01   +9.673067263819570e-01   +4.266688031992928e-01; +2.288458699577114e-01   +9.211990798468664e-01   +8.592076491445323e-01   +3.413991179395406e-01   +3.154279577362589e-01   +9.782859328001089e-01   +2.538117015878371e-01   +4.840251239630105e-01; +7.737431979051061e-02   +2.212886637342947e-01   +6.931461280248166e-01   -5.044049052304321e-02   +2.352295857740700e-01   +5.052209951146998e-01   +4.533200173073409e-01   +5.678323814155498e-01; +3.445349008279942e-01   +8.240959107153788e-01   +1.788854902685342e-01   +7.835764608425420e-01   +6.364922145645498e-02   -2.592523231563599e-03   +4.501136955873471e-01   +1.639119536957648e-01; +4.358922367939040e-01   +7.461973462276361e-01   +6.987414570818795e-01   +2.203406332742562e-01   +7.287967591848463e-01   +1.968988339424576e-01   +6.802730019937021e-01   +8.717650879250375e-01; -4.030305352368399e-02   +4.934881192031635e-01   +8.993739340987176e-01   +4.056445842050029e-01   +1.305642347915628e-01   +7.341585838844553e-01   +9.015445083732551e-02   +3.357910132841312e-01; +9.797995266280847e-01   +9.104841874181243e-01   +9.417356374335203e-02   +1.148610317264481e-01   +7.160747642206897e-02   +8.632340996693455e-01   +2.492057084322802e-01   +8.732591638205847e-01; +1.723617454291134e-01   +3.740219444488053e-01   +8.014951869330474e-01   +3.357726651887740e-01   +3.904002595034541e-01   +8.299922446690119e-01   +8.746044846088676e-02   +8.302230175532386e-01; +6.736925419508980e-01   +3.382207696626962e-01   +3.127763271971542e-01   +2.985451073381288e-01   +1.084684507071761e-01   +3.111779746459092e-01   +1.581719361040931e-01   +1.582718937427824e-01; +9.779067364473748e-02   +5.952230624061993e-01   +8.161046589854011e-01   +4.533059512946215e-01   -4.742410916045073e-02   +6.811706559383067e-01   +7.857193236351753e-01   +7.196041749008818e-01];
L2I_L3I_iGABA_netcon = [+3.235225578315185e-01   +6.859969938062311e-01   +3.316581702231638e-01   +6.733445905111138e-01   +5.202453561513198e-01   +3.329449820318086e-01   +3.908854998762225e-01   +4.806552945949437e-01; +3.356175504960017e-01   +6.549035216328795e-02   +3.153453835236977e-02   +7.834756869972294e-01   +6.991955809167359e-01   -1.987542114768160e-02   +1.064287659053274e-01   +6.142779263913517e-01; +3.266555833169425e-01   +5.600702163202743e-01   +3.683145481265696e-01   +2.507968850272734e-02   +7.972433623723766e-01   +6.649393754974702e-01   +2.495127083059517e-01   +6.718152874579109e-02; +5.932935940020904e-01   +8.229835639514446e-01   +5.283511527669487e-01   +4.799551022295428e-01   +5.422867904896981e-01   +6.324026996708050e-01   +3.932430214511283e-01   +6.907813856349290e-01; +4.524486890789978e-02   -3.337274943134045e-02   -2.300478504057174e-03   +7.072293457067950e-01   +2.291448552876050e-01   +6.417570920748416e-01   +4.407273086311826e-01   +2.353641609140820e-01; +5.782989818197950e-01   +3.978470138689829e-01   +4.291743444973608e-01   +7.220138757217431e-01   +2.948076258407806e-01   +8.151782784583876e-01   +5.036855114875153e-01   +1.530795729291082e-01; +2.392411521115880e-01   -4.998593981988927e-02   +3.687988859181524e-01   +9.960352767942326e-01   +7.563421661680865e-01   +5.400201189115047e-02   +2.760351022653363e-01   +8.373680680668231e-01; +2.255126624381764e-01   +8.616428926534861e-01   +8.869380377424068e-01   +9.102966944574591e-01   +5.181231373527602e-01   +1.327703755537557e-01   +6.555239156846216e-01   +8.022110709135029e-02; +2.838811388971376e-01   +5.356806903071291e-01   +2.508399319772643e-01   +1.879330775918814e-01   +3.986821540322843e-01   +3.591786596722636e-01   +5.874778281417939e-01   +5.143276752130039e-01; +3.971979159078251e-01   +1.909627898135061e-01   +1.821604913214877e-01   +4.023638052587835e-01   +9.285928273453427e-01   +5.029291262859971e-01   +4.739286121454068e-01   +9.661753153384537e-01; +5.420584863625053e-01   +9.264603926414679e-02   +2.531397025258261e-01   +6.028635253761010e-01   +5.214126570336327e-01   +7.062298414171283e-01   +9.454835397453780e-01   +6.309575005895025e-01; +3.795717184673408e-01   +1.807902552720661e-01   +6.388218691903997e-01   +3.533182301129514e-01   +1.409736574727251e-01   +1.953722343723549e-03   +3.672547946720505e-01   +6.023062307101916e-01];
L3I_L3E_iAMPA_netcon = [+1.455590019202375e-01   +5.586600189097078e-01   +5.259785165341506e-02   +1.659027227375325e-01   +1.855179034287660e-01   +6.918955425289505e-01   +4.503913222060534e-02   +3.420430499440021e-01   +4.523732041137624e-01   +3.336420709301954e-01   +5.231028379211592e-01   +8.634757561176643e-01; +3.160353849636331e-01   +7.588429022602206e-01   +2.166877231887359e-01   +2.677565629974351e-01   +6.894140182616521e-01   +4.702791292126726e-01   +3.309577545609247e-01   +3.290088048074481e-01   +6.399079594953959e-01   +2.524016390098924e-01   +6.953768312215795e-01   +2.350632204954311e-01; +4.419593020495090e-01   +2.826785887467175e-01   +6.851435435554029e-01   +8.252209128257471e-01   +5.477687001426059e-01   +6.118299130426131e-01   +9.957490352742556e-01   +4.413429140179449e-01   +2.770840230694728e-01   +3.741806115365288e-01   +8.037106791997207e-01   +8.554280740232560e-01; +4.769223556255702e-01   +1.140020760545401e-01   +5.700679851415974e-01   +6.821936115717908e-01   +4.576179533708850e-01   +5.792957796625358e-01   +5.546170779470084e-01   +6.525971418632812e-01   +4.822899343951661e-01   +1.865444553535222e-01   +3.760112328985334e-01   +5.078203900247786e-01; +8.669617862027733e-01   +7.569434060655168e-01   +5.274407234754008e-01   +4.592524240584893e-01   +2.178267632770765e-01   +2.901674106685914e-01   -3.126796406176231e-02   +2.628948469261554e-01   -9.841210790372642e-03   +1.848570893609720e-01   +1.169341245843116e-02   +4.363931224987800e-01; +3.236899937332622e-01   +1.313638305442232e-01   +6.492616162484726e-01   +4.587765450753676e-01   +9.585194697296341e-01   +5.680492265453436e-01   +2.181487584254378e-01   +1.597761497130454e-01   +1.682686049508761e-01   +5.335615043921503e-01   +2.733362097201874e-01   +1.269251115683459e-01; +5.155776512655907e-01   +2.876638986484339e-01   +7.790923843685132e-01   +8.619064944183609e-01   +1.655985928304866e-01   +1.353243248729576e-01   +3.816436884279160e-01   +8.830774790367117e-02   +8.598032546340353e-01   +6.935686982632892e-01   +3.099039517648640e-01   +1.516730893506207e-03; +3.060876389284896e-01   +3.854526378643894e-01   +3.303129932359554e-01   +6.083180701458201e-01   +7.690359491344132e-01   +1.743232002110298e-01   +3.243032325080797e-01   +2.980088501112074e-01   +2.526377818250878e-01   +2.594591540695205e-01   +5.808205998653301e-01   +4.923152226933867e-01; +3.620260218441273e-01   +4.381013159537426e-01   +3.876311020162443e-01   +6.255476667035128e-01   +5.515030676993454e-01   -6.581472173278108e-02   +1.185037041545934e-01   +3.850073069741876e-02   +3.359906502630798e-01   +2.480480927530046e-01   +7.509837266473373e-01   +9.277222400479828e-01; +6.837359790847735e-01   +5.887246225644884e-01   +5.471254182334827e-01   +4.148089628059347e-01   +4.431529157356208e-01   +3.369080850638610e-01   +4.259626491639074e-03   +6.381428779439675e-01   +8.484953294290112e-02   +8.126417883051942e-01   +3.863683444555190e-01   +1.111648139494976e-01; +1.054695846081526e-01   +2.594547871985036e-01   +5.855301959643099e-01   +2.028989965007763e-01   +3.644946426648626e-02   +4.997648949907360e-01   +4.312156816158685e-02   +7.115626113755785e-01   +6.545123764511224e-01   +1.905224609929857e-01   +6.083775340258561e-01   +2.889473745594403e-01; +6.092749381429881e-01   +7.293269188636935e-01   +3.995431633714872e-01   +5.704994035187402e-01   +6.473678672723885e-01   +3.308510734125482e-01   +2.990254854586105e-01   +8.250222265515154e-01   +5.608585202257436e-01   +2.809057905106983e-01   +4.503905443650687e-01   +4.216268436739357e-01];
L3E_L3I_iGABA_netcon = [+3.361539137739671e-01   +7.744071308855904e-01   +6.452728364848574e-01   +9.309345832045801e-01   +4.838806303261848e-01   +9.072204415749030e-02   +2.708655987648075e-01   +6.757382937553903e-01   +6.549537521116388e-01   +3.628640871715634e-01   +4.482621054870258e-01   +2.849469322654380e-01; +8.836557390073591e-01   +3.627306865786350e-01   +5.900366387324889e-01   +1.032684848138699e-01   +8.429934411400272e-01   +3.680762636541886e-01   +8.726641233393262e-01   +6.144319832442866e-01   +5.603783271889510e-01   +7.861721643441778e-01   +2.613388596468831e-01   +4.613636245113099e-01; +7.116133867519331e-01   +3.930093621590791e-01   +4.279509968916297e-01   +5.347027238602828e-01   +5.406002349084094e-01   +4.828102067908616e-01   +2.590621297468759e-01   +8.804205717445255e-01   +4.930630086498926e-01   +2.321586634397885e-01   +8.006544619726419e-01   +8.586683720855242e-01; +2.025739575397916e-01   +6.118457985560277e-01   +3.009269758422312e-01   +3.459188033329758e-01   +1.013597373219460e-01   +6.169983133420914e-01   +2.821057217303186e-01   +8.342019485085858e-02   +2.375333313114002e-01   +5.354250600348561e-01   +7.806411912823678e-01   +6.178860902756157e-01; +3.205359939929118e-01   +6.112781243226448e-01   +5.745089569036655e-01   +2.948435127110124e-01   +1.377854454460180e-01   +6.981224302889730e-01   +8.099244560927684e-01   +2.840077032931110e-01   +2.028912813356077e-01   +7.619732938085763e-01   +5.799745238690466e-01   +2.472388438822474e-01; +4.386963988469230e-01   +7.644561898293261e-01   +6.961892619377448e-01   +4.822013235919204e-01   +7.067378227855790e-01   +5.710823855032850e-02   +3.132590639337101e-01   +2.034409600647495e-01   +9.122649698613952e-01   +8.892130832245283e-01   +8.079819812481328e-01   +2.565140451106872e-01; +6.197877353816089e-01   +7.653348361724556e-01   +2.002084440275394e-01   +6.399644801927999e-02   +4.090630090558148e-01   +5.867920494514067e-01   +6.185274690200538e-01   +1.732168909368439e-01   +9.516055844342413e-01   +6.031003394624727e-01   -3.465732209650062e-02   +2.959405772392615e-01; +5.279902418254165e-01   +3.770137740794536e-01   +8.931664179227060e-01   +4.475343456717792e-01   +1.447735623980056e-01   +3.724342741756633e-02   +5.732653538798652e-01   +1.094919560361457e-03   +6.224660712967683e-01   +7.844399729730697e-01   +2.678880004411616e-01   +9.720580976536300e-01; +2.836469147874022e-01   +5.305724133246633e-01   +2.949389217143141e-01   +7.847332515391511e-01   +7.782376087288576e-01   +1.048329871046303e-01   +3.437175684030439e-01   +6.138209152427997e-01   +5.994798714227810e-01   +7.667857774234415e-01   +7.027938856025627e-01   +6.438219466281542e-01; +1.293480554165769e-02   +1.154899951570366e-01   +3.105392881461423e-01   +5.397199163074453e-01   +6.690077943480335e-01   +2.151100917099200e-01   +3.427345215871700e-02   +3.283039505544456e-01   +7.154316137380577e-01   +2.121236985140465e-01   +5.790793714445385e-01   +7.416621426970538e-02; +8.963335770221961e-01   +9.008240179569779e-02   +7.143332753063774e-01   +5.263547331565874e-01   +3.787709208329248e-01   +8.584882405150306e-01   +1.461881568273567e-01   +8.275120038661498e-01   +2.553699791204259e-01   +8.801568581983256e-01   +5.459501202235867e-01   +7.107676539851120e-01; +6.476191767691200e-01   +7.942419415582703e-01   +4.904515608676422e-01   +8.548925918077078e-01   +8.190082870873187e-01   +5.272163856039459e-01   +8.888744122172108e-01   +8.910336417148849e-01   +5.204260913028851e-01   +7.885453413578206e-01   +4.544270859606477e-01   +9.004197288094863e-01];
L2E_Input1_iAMPA_netcon = [+9.345049301066357e-01   +9.872594762451394e-01   +8.674256525066651e-01   +9.208971033200003e-01   +8.713558697974966e-01   +9.795133946498962e-01   +9.141357703150433e-01   +9.170235181524449e-01];
L2I_Input2_iAMPA_netcon = [+9.239209410715471e-01   +8.999649544269521e-01   +1.000000000000000e+00   +8.941711188684749e-01   +8.364561259998063e-01   +8.767253174479364e-01   +9.074452196259326e-01   +9.365580937617144e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
