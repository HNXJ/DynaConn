function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.573150635703274e-01   -1.721071201877640e-02   -5.251270217051946e-02   -1.166063258360376e-01   +4.252618429605971e-02   -2.390830908079082e-01   +4.530870255579955e-02   -1.912680446381872e-02   -2.120441062551179e-01   -1.917721166243306e-01   -1.148169886415664e-01   -1.468666829188494e-01   +2.327721412549524e-01   +1.196761422346115e-01   +2.546762012047531e-01   -1.145226280078218e-01; -9.352592988408544e-02   -1.192982237773252e-02   -1.314868746418692e-02   -4.103791174017611e-02   -2.318786656640194e-01   -3.399794950658521e-02   +5.503333240024631e-02   -2.360276365435686e-01   -5.312636794468927e-02   +1.760852529816322e-01   +2.040852222058073e-01   -2.857587046301175e-01   +8.953761102547365e-02   -1.459987681958474e-01   +1.722429844460194e-01   +1.528888720825376e-01; -6.004021067783648e-02   -2.130900955519217e-01   -6.214831130354623e-02   +1.045865765906256e-01   -5.771865949410117e-02   +6.406857647011080e-02   -5.115715031491760e-02   -2.104925197353101e-01   +2.282137920955785e-01   -8.551526244659780e-02   -2.776630213293071e-01   +2.772863240608170e-02   +8.227315680575301e-02   -2.171241038962382e-02   +3.329522584602713e-01   +1.466495697891337e-01; +9.254467201756789e-02   -7.741532789801679e-02   -5.967454501163841e-02   +2.446730217117928e-01   +4.631103726309235e-02   +2.229231232334241e-01   -1.188472890840632e-01   -2.133365413476130e-01   +6.246309442379774e-02   -5.688709769421492e-03   -7.049275893412167e-02   -2.101224849930607e-01   +1.573774627063149e-01   +2.338043409563546e-02   +5.803780700222461e-02   -6.496498886955224e-03; +6.839319721141078e-02   +7.806726399898489e-02   +4.044838933647507e-01   -1.871234952537554e-02   +8.214193356934599e-02   -1.367787479637704e-01   +1.887821200960360e-01   +8.109592969741278e-02   +2.528128904217345e-01   -2.702853174629523e-01   -2.138913045298769e-02   +1.190683098672637e-01   +1.162115731432769e-01   +2.276115845821408e-01   +2.451938610321667e-01   +3.478657407389681e-01; +4.144645133647397e-01   -2.491922238299377e-01   -1.767966835862421e-01   +6.959465232275294e-02   -1.282659075508200e-02   -2.350978450199337e-01   -1.107407170679539e-01   +1.592414390513771e-01   +2.748836390618163e-01   -1.981694070875247e-01   -3.758567972122075e-02   -3.150107199564641e-02   +9.560435524967215e-02   -4.099396353536795e-01   +1.976365153158023e-01   -2.777241801669862e-02; +5.034773992290487e-02   -2.160148546593081e-01   +7.151564946550154e-02   -6.224568660223619e-02   -8.566494920177875e-02   +2.447590985784185e-02   -1.971901902503001e-01   +2.951132419773748e-01   -3.462124147901748e-01   +1.308776218943506e-01   +7.299408095171282e-02   -2.824268863630612e-02   +1.984061521132145e-01   +2.298601814934511e-01   +1.516289914470852e-01   -1.271420714796509e-02; +3.114455896695890e-01   +3.026960487307370e-01   +2.144466542990051e-01   +1.487327463467855e-02   +1.019105088043046e-01   -2.839714755730413e-01   -7.287100814399494e-02   -1.398094838313310e-01   +1.167532835763139e-01   -8.404413615322442e-02   -6.755483791236389e-02   -8.174202622748611e-02   -1.829585559798555e-02   -2.423579303113316e-01   +5.294965907685322e-02   -1.425960050184485e-01; -3.060943248240624e-01   -2.786382524915601e-02   +1.693612762942114e-01   +8.479097738546076e-02   -9.765695858838463e-03   -1.224745803233444e-01   -6.674591907677122e-03   -1.782783447377417e-01   +1.835742761036438e-01   +5.308054040349745e-02   -2.150313308902960e-01   +2.192007016149393e-01   -2.060554723720870e-01   -2.311186318528738e-01   +9.736469712058758e-02   +1.611868003044246e-01; -1.526046953695351e-01   +6.342403241088060e-02   +2.685350348960032e-01   +3.218812875311186e-02   -7.390273199325849e-02   +2.637192928967581e-01   +6.885680451119619e-02   +1.855595236371687e-01   -7.007397221599991e-02   +1.161318905130760e-01   -1.129645036712933e-01   -1.208078265669052e-01   +2.033454272030083e-02   +3.935560964424314e-01   -7.456442565337215e-02   +1.310777219231789e-01; +6.081981068088146e-02   -4.017745150647434e-02   -2.139780461353052e-02   -1.848177909648852e-01   +1.079162945797620e-01   +1.285046588276536e-01   -1.915139948575081e-01   +1.313899872598343e-01   +2.707806639826153e-02   -1.406362079342770e-01   +3.059705741565544e-01   +1.257404022056353e-01   +1.720688754470173e-02   -2.570491101345296e-01   +7.489059326666622e-02   -3.767333279405874e-01; -1.359488502006145e-01   +2.959684468566573e-01   +1.495682578442251e-01   +1.060530923596744e-01   +3.217399433345598e-02   -3.241543260649034e-01   -1.282367338489249e-02   -2.050622930600464e-02   -1.929288019339198e-01   +3.419741244904915e-01   +5.622713109279008e-02   +4.164866916796303e-02   +1.378456017876091e-01   +1.865235735243644e-01   -3.349585115441296e-01   -1.053247861206217e-01; +2.088549006500462e-01   -1.147471412638963e-01   +2.476491878364263e-01   +4.459465918546145e-03   -1.227371548630854e-01   +4.069868426009121e-03   +2.198379392298135e-01   +2.966415169104819e-01   -9.589512609581405e-02   -1.475414170146543e-01   +3.274441328046143e-01   -1.931354107333591e-01   +1.185535576256475e-01   +5.366477709589770e-03   +2.091181130268441e-01   -3.778216369355905e-02; -4.102487488613892e-02   -7.085507642093895e-02   +1.345355349759726e-01   -8.015744866052156e-02   +1.716783180739481e-01   +5.702629041183156e-02   -6.167966178912368e-03   -5.125467453736341e-02   +2.346316454524470e-02   -1.054897379942986e-01   +1.207154921818150e-01   +2.638941607110314e-01   -1.868424639709770e-01   -1.358998671043010e-01   -2.001503810253432e-01   -5.712033449887227e-02; -1.584806810088526e-01   -2.805749755691762e-02   +3.607047289475943e-01   -1.003344177815928e-02   -3.608824104545949e-02   +1.527408071198191e-01   -1.254997348688584e-01   +9.664641528487203e-02   +1.623616348127450e-01   +1.168069121264665e-01   -1.671232295019496e-01   -8.786602721401857e-02   +6.635151949389954e-02   +2.337510378599953e-01   -5.861939619464528e-02   +1.678477689006377e-01; +2.566679443648366e-01   +6.523050302609561e-02   +1.960035026591015e-01   +2.803463472758336e-01   -1.401709128126226e-01   -2.378608752659209e-01   -1.398109775793470e-01   +1.778447386256468e-01   -3.470907619766865e-01   -1.694324164238015e-01   -2.953486447347606e-01   +9.408091134903351e-02   +1.290838832359538e-01   -1.326191719672285e-01   -2.364083262251747e-01   +7.578719727008792e-02];
L1E_L1I_iGABA_netcon = [-2.305374908610638e-01   -2.948537249747110e-01   -1.405004617746657e-02   +3.231430628346516e-01   -1.523417728445384e-02   +3.007816348649585e-01   -6.183480297111435e-02   +1.208588166666153e-01   -1.458942813432175e-01   -8.545787191026236e-03   -1.260257655149008e-01   +5.746473333185540e-02   -4.067702812977571e-01   +1.919111709372589e-01   +6.798813265561626e-02   -1.300535294951453e-01; -1.694534284808028e-01   -1.869932328181292e-01   -1.417332184947762e-01   +7.532545144197723e-02   +1.486167281085111e-01   +1.040038744327328e-01   -2.913610218250563e-01   -2.050873708579507e-01   -2.128150541808826e-01   -1.568710406051453e-01   -1.298804536469303e-01   +1.712716103564191e-01   +3.108806208441617e-01   -3.688742881887376e-02   +5.495693234122950e-02   -4.990223133051255e-02; -1.344954137908973e-02   +8.400463337013434e-02   -1.287589724865347e-02   +1.282901569739592e-01   +2.156780118475492e-01   -1.170813353521243e-01   +1.169176488815271e-01   -1.159531659567021e-01   +5.616261932613865e-02   -1.657842918914153e-01   -1.382111706104658e-01   -1.517767587627024e-01   -1.002831293955543e-01   -2.578319458090730e-01   -6.352403612705482e-02   +2.811027943885264e-02; +2.203516373473929e-01   -8.801756239059533e-02   -7.846735521201491e-02   -6.894247006773721e-02   +3.724408839579509e-02   -4.491351522778706e-01   +1.307716332235740e-01   +1.110048831889865e-01   +2.148892311797997e-02   -6.326729680510396e-02   -1.462307630997830e-01   +9.271376360092007e-02   -1.841090119867371e-02   +7.683202054868785e-02   -3.700040543886342e-02   +2.710165319384031e-01; -1.107218950763702e-01   +1.269062755125628e-01   +2.070751033502110e-01   +7.292175344725850e-02   +1.975940472240169e-02   -1.177426604077746e-01   -3.068687527698664e-01   +1.661906561703519e-01   +9.208695791700758e-02   +2.235558222015699e-01   -1.737427332137445e-01   -1.082072881048757e-01   +8.698191703490193e-02   -1.872044737902960e-01   -1.763970238137654e-01   +3.044529241655142e-02; +1.675839317363244e-01   +3.558310107784729e-02   -2.139231511585188e-01   +1.387783343258824e-01   +2.358903006135104e-01   -1.025801058033354e-01   +1.180373215624724e-01   -3.341868179821392e-02   +3.193393303797945e-01   +3.585329270521636e-01   -3.265036303992093e-01   -1.744733467882541e-02   +2.774902232729189e-02   +1.662579656440168e-01   -3.843278502296765e-01   -2.637942521540616e-01; +6.951552147368033e-02   +2.569475738901270e-02   +5.306025718529613e-02   -3.365872314250725e-01   +1.479005057874087e-01   +8.992062606532235e-02   -7.500742622143311e-02   -6.287574415209303e-02   -1.142448531993001e-01   -8.700640331411222e-02   +3.849408681445423e-01   -1.356334257862978e-02   -6.084415960454475e-02   +1.568561612111988e-02   -6.515025667590978e-02   -2.229144899430448e-01; +3.664659627078933e-01   -1.742705691127331e-01   +9.984911179764111e-02   +5.860091588924091e-02   -1.002393879150656e-01   +1.290315435814304e-01   +2.112662786526436e-01   -1.087219816909814e-01   +2.881397482677653e-01   -1.012962794474144e-02   +8.477607817911177e-02   -7.352795390684431e-02   -4.444279939071942e-02   +3.260523650512074e-01   -2.960706417980987e-01   +6.062289553622310e-02; -2.525412392072310e-01   +2.827025131666304e-01   +7.477412054116836e-02   +3.576585370352087e-01   +3.945689675661114e-02   -1.385340805189257e-01   +2.038365161134117e-01   -1.158616064674430e-01   +2.431235269179267e-01   -1.769968822067947e-01   -1.022966130840308e-01   +1.217221492476123e-01   -6.926508215493339e-02   +1.247387368350037e-01   -1.580518042720789e-01   -1.098208405153307e-01; +7.346513875853687e-02   -4.469084212189898e-02   -3.115906224005730e-01   -2.430510550830584e-01   -1.502617910953777e-01   +2.508982147047100e-01   -1.388735175223795e-01   -5.986609266014829e-02   -5.905070089225668e-02   -1.174274644087657e-02   -2.837795381398639e-01   +1.804947347134623e-01   -2.402962704286827e-01   -3.194428931310180e-01   -1.148505495534232e-01   -1.376748872491239e-01; -2.591381364733121e-01   +1.131716584371004e-02   -4.628145998891872e-03   -2.362984462468576e-01   -9.031934829404206e-02   -2.807907907374483e-01   +1.556118917662390e-02   +1.914320121562630e-01   -9.000716514157106e-02   +4.367884677871351e-02   -1.133839708118693e-01   -1.053330643999516e-01   +3.412878431675295e-01   -6.567140931093163e-02   +2.957915181310797e-01   -6.390074487740363e-02; -3.220441264753147e-01   +1.004323464665245e-01   +1.178445276558331e-01   -9.147654701042443e-02   -2.033805465651522e-01   +8.932385771389280e-02   +7.702052360924498e-02   -2.323432236962180e-01   -5.850932875122984e-02   +7.043954424551110e-02   +3.970128058139287e-01   +1.477564314038519e-01   -2.255181131399021e-02   -3.900502487614733e-02   -1.801014863951356e-01   +3.383033977444951e-01; +1.017706992384416e-01   -2.028591564299623e-01   +1.999220195322783e-01   +2.304092873578192e-01   -4.824076520598197e-02   -6.524089070237880e-02   +4.380387701161774e-02   +1.394760583897011e-01   +2.332722755890197e-01   +6.137024197840656e-02   -9.593679721776775e-02   -2.109746842612988e-01   +1.535671121244213e-01   -1.529264101197393e-01   +6.854628362634971e-02   +1.141430665345936e-01; +4.650163000266908e-02   -1.376677952783089e-01   -6.009421213135264e-02   +2.156006110183666e-01   -3.360524212361604e-03   +2.448475893215007e-01   +8.127033125969234e-02   -3.659065654066970e-02   +1.215565515128567e-01   +2.023794774077270e-03   -1.116980338935172e-01   +7.892465313569684e-02   -4.708899341041109e-02   +5.563506005271472e-02   +1.630931607928110e-01   +2.357716511312049e-01; -2.746876952275026e-01   +5.523371285691893e-02   +3.923521547773638e-01   -1.169900053835714e-01   -2.866727913587347e-01   +7.391050014216369e-02   +3.482994913311051e-01   -5.323635150688460e-02   +1.466596584602681e-01   +1.405940212624164e-01   +8.462877120335971e-03   -3.655179080360116e-01   -1.558100998437369e-01   +1.328515724986570e-01   +2.299635119586454e-01   -2.458756944201149e-01; +8.129485139787114e-02   -1.109021826824517e-01   +1.316935837026189e-01   -3.188362299222016e-01   +1.957969072025431e-01   -8.982150326603006e-02   +3.206759930193377e-01   -4.128504502554087e-02   +2.414030327965564e-01   +8.897465090115680e-02   -6.667378766960674e-02   -1.239313839244569e-01   +1.446449876174919e-01   -1.404476118236858e-01   +2.022931508571440e-01   -2.742492377903151e-01];
L2I_L1I_iGABA_netcon = [+2.432231156743629e-01   +2.407710795330045e-01   +1.808172996009362e-01   -1.481028444184970e-01   -3.997095594420608e-02   -1.701244229217219e-01   -3.868385635535672e-02   +2.230550512696216e-01; -2.717938415165402e-02   -4.564557481397239e-01   +6.563975496847700e-02   +3.273801842287163e-01   -2.918474003602970e-01   +2.295260736727277e-02   +3.034421931583364e-01   -1.162775588566373e-01; -7.413179034396360e-02   +2.468847001029545e-01   -1.920897266136576e-02   -8.325962129454847e-02   +4.216224798048385e-01   -8.619220890348113e-02   +2.140231469959056e-01   +2.985723836534938e-01; -8.324284694970346e-02   +5.323042146540796e-02   -1.039628738454745e-01   -5.591541990572191e-02   -8.304795295120417e-02   +5.936470989869430e-02   +9.804788948333448e-03   -1.134256995994090e-01; -2.351734177715112e-01   -4.026536608020932e-02   -3.668792196041121e-01   +7.919303523010131e-02   +1.387164290728766e-01   -2.288009858610993e-02   -1.663555304278368e-01   +4.143093878254399e-02; -6.088888618302954e-02   -3.617930108777288e-01   -6.666116712099845e-02   +4.162538548564777e-02   +1.925545674047646e-01   +2.155926564446303e-01   -1.932285446166348e-01   +2.172671228910848e-01; -4.152232529498825e-02   +3.566538912248562e-03   +2.569057840005231e-01   -1.279150021991895e-01   -1.883258596025307e-01   +4.172933061948043e-02   -5.131912261011080e-02   +9.340025861769066e-02; -5.384366570666480e-02   -1.209759307051013e-01   +1.972656899941200e-02   -1.212206980083661e-01   +2.701450480461385e-01   -2.546784787011488e-02   +1.023490206541664e-01   -2.284231334092297e-01; -2.593696013152766e-02   -9.200069221832058e-02   -1.351911630297605e-01   +1.895318586860666e-02   +2.437427126413444e-01   +2.135265773478476e-02   +1.700232905037452e-01   +3.485553989146633e-01; -6.602178613604225e-02   +2.055550491819845e-01   +9.327427955233418e-02   +5.073041277999139e-02   -1.090028156984698e-01   -9.884239898879874e-02   -1.017456170628672e-01   -1.774288217963372e-01; +2.568584551236819e-01   -2.972318460915396e-01   +1.203272482925703e-01   -2.200269266190981e-01   -3.199758712517086e-02   +2.668731764353556e-02   +9.532773330347823e-02   +2.267716375843232e-02; +1.374875207940341e-01   +2.845249819933611e-01   +3.926690120536103e-02   +2.122801389051139e-01   -5.991627682880234e-02   -2.333674829423456e-01   -2.097026489749123e-01   -2.442560664830919e-01; +4.681569753358165e-02   +5.831724188080439e-02   +2.623407663143851e-01   +2.170787372205217e-01   +2.982106033370954e-01   -2.275470823618055e-01   +1.612612492232941e-03   -8.942752398419139e-02; -1.620328588605881e-01   +3.202515263762827e-02   +1.264121313463175e-02   -9.330539415651051e-02   -1.002430294875244e-02   -1.779884803765941e-01   -2.104813431642304e-02   +5.044102204077626e-02; -1.081991544005801e-01   -2.802756771946345e-01   +8.829738395098599e-02   -2.939303921334169e-01   -2.743951075543101e-01   +3.279686809418704e-02   -2.115506360055872e-01   +1.262189224806530e-01; +2.828238794692995e-01   +1.508323375562056e-01   +3.153996908749266e-01   -2.985064397811743e-01   +1.048057165603671e-01   +1.384628389405229e-01   -3.858983808614817e-02   +6.503812229904543e-02];
L1I_L2I_iGABA_netcon = [+3.161356375000521e-02   +1.177431893168190e-01   -1.411487057263525e-01   -1.458460525788486e-01   +1.643270744592932e-01   -1.039906281147516e-01   -1.631637890485307e-01   +5.132378054525632e-02   +1.518283655845259e-01   -5.558043615864623e-02   +3.700909763585889e-01   +1.123373484849951e-01   +2.612342681386466e-01   +2.598922610236159e-01   -1.845152576304257e-01   -1.737257250257574e-01; +2.001374691559215e-01   -1.294428361002149e-02   +1.172780324515110e-02   +6.252987154848096e-02   +5.369824499223515e-02   +1.354859663713769e-01   -1.968439996225649e-01   +1.014970016847420e-01   -2.618027246361346e-02   -2.719673526317046e-01   -3.117530537161458e-01   -2.461229871281726e-02   +1.587704856091030e-01   +3.371191530940454e-03   -2.979862619589261e-01   -8.725946307557655e-02; -2.673881674173152e-01   -2.914426180912086e-01   -1.132417607880358e-02   -7.298300407060049e-02   +1.800117685582080e-01   +9.041930321972405e-02   -8.732315179167266e-02   +3.173029286460813e-01   +1.464243712131698e-01   -6.382546044740001e-02   -3.655476585759009e-02   +9.645788418779962e-02   -5.030563418404631e-02   +8.217200315093030e-02   +2.716844087101520e-01   -8.205013061945557e-02; -8.742560700138008e-02   +1.271426935844398e-01   +9.263832710899111e-02   +8.813724946778836e-02   +7.710858626192889e-02   -6.460754781402234e-02   +4.981606055208148e-02   +5.274921683370553e-02   +2.486012749011277e-01   -2.056842034637829e-01   +1.746020476557828e-01   +1.292709645440613e-01   -1.301104549016183e-01   +8.351871293181500e-02   -9.969982216901341e-02   +1.403185033345307e-01; +5.779533975761780e-03   +3.865661026180814e-02   +1.323768804028422e-01   -2.845907931799978e-01   -1.043865235851372e-01   -2.598307869357951e-01   +1.408949139222364e-01   +1.146443272463815e-01   -5.592758681060522e-02   +3.517598088739413e-02   -1.253927202276788e-01   -4.420998247372847e-02   -3.356296795987743e-02   +1.649605019620877e-01   +2.245743350645837e-01   -9.904999503868192e-02; -1.355238182807921e-01   +4.820707230505238e-02   +7.804851983744462e-03   +1.225570963077066e-01   +2.467972910422467e-02   -3.078056334963104e-02   -1.936021265588002e-02   +7.987119139928570e-02   +1.400409103650969e-01   -2.978429055226175e-01   +7.241550654500059e-02   +1.672146886207324e-01   -2.202102584892820e-01   +8.801400069085190e-02   +7.627342581481433e-02   -2.254102650629533e-01; +2.086352434138782e-01   -7.508662086433586e-02   +1.698918225440302e-01   +2.101562852316223e-01   -3.881215892325369e-01   +2.597134570251187e-01   +2.592484551802767e-01   +6.068175821907996e-02   +3.588222600978801e-02   +1.150019677523656e-02   +2.618138708237380e-02   +8.934768442821567e-02   +1.495527171253013e-01   +2.434011430196093e-03   +8.183938167976307e-02   -7.744046848223871e-02; +1.042237692864355e-01   -1.033874213025042e-01   +1.676030598121830e-01   -7.756397777474741e-02   -7.387801496253217e-02   -1.065177325515896e-01   -4.169174482917164e-02   -3.144267603813412e-02   -8.310380368424500e-02   +2.149886704341182e-01   +4.520830777495315e-03   +6.618010188608800e-02   -9.755082772724658e-02   -1.046880701131128e-01   -2.104184298704205e-01   +3.379463093683440e-01];
L2E_L1E_iAMPA_netcon = [+9.468797531991285e-02   -1.850610438434065e-01   -2.528778208601606e-01   -8.641970015891907e-02   -1.102977780825503e-01   -1.991668502072479e-01   +1.668378978242264e-01   -2.488108686759713e-01; +2.411096739616104e-01   -3.270788013542273e-02   -1.383344930580439e-01   +2.146562342164339e-01   -4.904197577510686e-02   -2.954176989704710e-03   -2.481980694354848e-01   -2.504523750349037e-01; +6.898348375915210e-02   +3.696055453840560e-01   -1.518035836010558e-01   +1.786745020739879e-01   +6.573999952181736e-02   -2.751921708287942e-01   -2.549427731099762e-01   -3.094438143842905e-02; +3.445603687797889e-01   -7.317586297486205e-02   +2.400250667356479e-01   +1.311396582801828e-01   +9.248875459943123e-02   -2.461862381982134e-01   -2.150970974432110e-01   +2.599314472043804e-01; +1.650428705622292e-01   -2.828486861618449e-01   -1.511355052953883e-01   +2.407333718990478e-01   +3.157096293050721e-01   -2.838843743708183e-01   +5.130267754666200e-02   +1.907926157321214e-01; -1.705656474740144e-01   -2.638744424761173e-01   +1.485712407286020e-01   +1.393816565908264e-01   +3.719176134677790e-02   +1.336385424895292e-01   +2.257332030722005e-01   +3.626515675092340e-02; +2.127136769387097e-01   -1.143789202447819e-01   -9.478103685953623e-02   -2.886455654716378e-01   +4.719410461579303e-01   +2.859801352860626e-01   +1.257026696571354e-01   -1.268268038839243e-01; +1.093422426008165e-01   +1.967876811716914e-01   +2.802193189761242e-01   -2.974025483032831e-01   -1.610250143762256e-01   +6.651778941054357e-02   +8.979924543414196e-02   -8.248249093113542e-02; +2.039144986950773e-02   -1.064889256314890e-01   -2.308915455806610e-01   -1.407864997986504e-01   +2.582611355880317e-01   +2.261477824105357e-01   +2.124887141693454e-03   +9.248958502576489e-03; +1.907082488584272e-01   +1.837977888004221e-01   -2.016957465553540e-04   +1.117067665765608e-01   -3.399538274473736e-01   +1.243766834338099e-01   +3.754590950298156e-02   -5.513365673114250e-02; -1.893861261701171e-02   +3.378402894941925e-01   -2.354283266528436e-01   -2.920682546374856e-02   -8.581894107895653e-02   +1.803298814076774e-01   +2.317292633334787e-01   +1.067820843008012e-01; +2.259902179586700e-01   -1.689192436596433e-01   -1.332669241635536e-01   -3.157020788412902e-01   +2.119895670903477e-01   +2.641280252225006e-01   +2.228502793716171e-01   +9.443900422261217e-02; +1.194546189841406e-01   +2.568344003923071e-01   -2.471769204496931e-01   +1.135216958915129e-01   +3.523542170288472e-01   -1.882072289500869e-01   -2.049103987034276e-01   -7.736920117786439e-02; +2.206144503971838e-01   -2.220228268862022e-01   -9.975824162008162e-02   -1.249893398507815e-01   -9.882015332136038e-02   +3.695472412392369e-02   -1.525142328919513e-01   +1.682847933447316e-01; -1.203423679052253e-01   +1.915661566984241e-01   -1.137825458535132e-01   -1.024725608732752e-01   -3.354035697583502e-01   -1.487829178683053e-01   -9.409306413177243e-02   +4.699042347234701e-02; -1.566097512170141e-01   -2.353976969008048e-01   +3.972504628309690e-01   -4.820807808807481e-02   -2.096922532479201e-01   -1.558006167067255e-01   +1.444273720916302e-01   -2.980603204119130e-01];
L1E_L2E_iAMPA_netcon = [-1.412034486365661e-02   +1.619341991733705e-02   -4.573996083342668e-01   -1.582108456589083e-01   -2.288315308555669e-01   -2.215960520797472e-01   +4.354130017538863e-02   -1.160956737501777e-01   +2.211091664413001e-01   +4.853165236650636e-03   +1.688577404057138e-01   +3.681824772439883e-01   +3.810441170660814e-02   +7.190736622940110e-02   -2.665925638065607e-02   +1.414751878004941e-01; -1.242002554228685e-01   +5.003952983429470e-02   -1.894487490985728e-01   +1.875690748639552e-01   +2.739639721537550e-01   -1.342749427975123e-01   -1.463275735214095e-01   -1.816009157712066e-01   +1.486239428736013e-01   -2.000969651257851e-01   +8.511005293779578e-02   +3.086049925805787e-01   -3.117295317278012e-03   -1.929110965491453e-01   +3.402507419354577e-02   +3.154349046295882e-02; +1.305787261548141e-01   -1.998153959940252e-02   +9.132696933022652e-02   +1.841895066600727e-01   +1.066517873575178e-01   -3.172923025979348e-02   -1.316011698434268e-01   +2.474246575371329e-01   -4.883968786182424e-02   -1.599944410479108e-02   +1.089160630977786e-01   -9.384746415479431e-02   -7.670082630576529e-02   -1.184268405910954e-01   +2.622200826934241e-01   -4.631797358299861e-01; +7.236327750104080e-02   -2.168716524533949e-02   +1.646769348698240e-01   -1.826990567636914e-01   -1.287630742307284e-01   -1.149158698260675e-01   +1.088273131817443e-01   -1.503559013224604e-01   -2.196933399170135e-01   -2.943943227308877e-01   -1.828440555926169e-01   +2.728283587713644e-01   -1.441183484979714e-01   +1.541138459492106e-01   +1.484648671653096e-01   +1.728435677646141e-03; +2.635279502495930e-02   +1.390079753871706e-01   +3.307083153137331e-02   +3.761584603539576e-01   +1.229987918088929e-01   +2.269844982029449e-01   -1.291161347249838e-01   +2.438798625622020e-01   -4.642796483716199e-02   -2.212670072134721e-01   +3.440837886892372e-01   +2.045326368141350e-01   +4.968694750150771e-02   +6.943911278242831e-02   -1.615734996853211e-01   +3.800610475673422e-01; -7.065200956466350e-02   -1.896764473612453e-01   -3.587707290349770e-02   -3.298996883898490e-02   -1.910861989855464e-01   -2.293274577362405e-01   +5.726922495636812e-02   -4.821274172979259e-02   -1.222227045355933e-01   +2.015406305030145e-01   +6.280861546390598e-02   -1.941643340752111e-02   -9.230087473678698e-03   -7.368394522243023e-02   -9.814374868005296e-02   +1.823024385619325e-01; +1.898767478487988e-04   -2.806995539573516e-01   -1.021754336049105e-01   -3.682464407764039e-01   +1.935456853220199e-01   -7.356589969326635e-02   +8.295260609598104e-02   -3.509343776413297e-01   +8.110032187827711e-02   +6.534853864771875e-02   -7.450446204361748e-02   -2.092759663193468e-01   -2.349831169054269e-01   +2.589219360541554e-01   -1.221353479196556e-01   +1.016359302457141e-01; -2.984490592124430e-01   -3.439928394024194e-02   -1.473062089818955e-01   -2.388564817256000e-01   +1.423464454181663e-01   -1.238080585313638e-01   -4.221018012612877e-02   +2.192164613068286e-02   -3.978346751757700e-02   +1.203533701945861e-01   +2.217662884261275e-01   -5.377759534198921e-02   +1.134306917015436e-01   -2.615487171827595e-01   +4.408530955943274e-01   -3.378008118330180e-01];
L2I_L2E_iAMPA_netcon = [+1.970947667174064e-01   +7.025015877408330e-02   +6.441319188219735e-02   +2.133275592625485e-01   +9.042038259457805e-03   +3.356328496509350e-02   -1.747232915187945e-01   -2.530684512860988e-01; -2.215424229832920e-01   +3.226917544258377e-01   +8.407708001028394e-02   -6.536066976712432e-02   -7.616525559594772e-03   -9.434905295104214e-02   +3.427639985871767e-01   +3.609796398584205e-01; +2.677784895738728e-01   +1.257422156640044e-01   -4.192457855579739e-01   +9.733935840393768e-02   -1.089577157375644e-01   +2.391117238343886e-01   +3.838043380868048e-01   -3.857485069104577e-02; -1.177060644377710e-01   +1.822870830212592e-01   -1.070169190836529e-01   +2.703866517839704e-01   -2.101887732100917e-01   +1.410414404157774e-02   -2.527837637672743e-01   +5.103441888820079e-02; -3.605193036176384e-01   -2.793769140598993e-01   -3.638987266256294e-01   +1.873401624678291e-02   +1.475863621722734e-01   -2.363857860964308e-01   +2.536345239774261e-01   +1.687378122399662e-02; -2.713475727515283e-01   -3.111408934028240e-02   +4.565203234282207e-02   +2.651791853774348e-01   -2.271555272295389e-03   -2.315477343193490e-01   +1.372370684574966e-01   -3.498815595175848e-01; -2.226468162199044e-01   -2.282573114656762e-01   -3.881701248237925e-02   +8.338711270614915e-02   -5.774459710138208e-03   -1.704889303672116e-03   -8.327326176533829e-02   -9.039697895486028e-02; +1.407968463484458e-01   -7.509674533392167e-02   -7.023077776888048e-02   +8.326577961334239e-02   -1.509369588120912e-01   +2.773272259937289e-01   -5.610769848128644e-02   +3.017768403127435e-01];
L2E_L2I_iGABA_netcon = [+3.122880347428362e-02   -1.529733861240229e-01   -5.890933450864853e-03   +1.034055489538118e-01   +1.996135515607923e-01   +1.762205003913716e-02   +1.791771676248561e-01   -7.251974170768097e-02; -1.518922433525964e-02   +6.673861430382294e-02   +6.480426063420112e-02   +5.633060384290527e-02   +7.500333014104313e-03   +4.945740502623253e-02   -1.467482389347359e-01   -1.289691050411698e-01; -8.014298457859177e-02   +7.249763540105043e-02   -5.259647020681137e-02   +2.227319947898554e-01   -2.385365066905418e-01   -1.861366962821066e-01   -1.825699111990401e-01   -1.394908274209311e-01; -3.182080684097889e-01   +1.498012809454229e-01   -2.259756622406445e-01   -1.259809017950563e-01   -6.124053545712563e-03   +4.567266501791624e-02   -3.902718816841617e-01   +3.137394913400225e-01; +1.676625091459484e-01   +5.678163930249974e-03   +1.362282265323360e-01   +5.404887842236488e-02   -1.386621843021258e-01   +1.930271204974239e-02   +4.934646113885616e-02   +1.532249655431080e-01; +4.361539468259179e-04   -2.451055101389334e-01   +8.162870272393030e-02   -1.122501020234482e-01   +2.134035272078865e-01   +1.244185127668822e-01   +2.250795511132818e-01   +8.051939530417666e-02; -2.046057237430366e-01   -5.948292327218233e-02   -6.898481405744869e-02   -3.478131210047550e-01   +9.042640280626973e-02   -6.383314037438963e-03   +1.010775724231129e-01   -6.551011353298693e-02; -1.018126059452348e-01   -4.762173026375664e-02   +1.994797569340474e-01   +3.589022592705581e-01   -3.316285058132721e-01   +1.057312032437518e-01   +1.694053724278535e-01   -2.398017794960013e-01];
L3E_L2E_iAMPA_netcon = [+1.461841552444706e-01   -4.081694128451469e-03   +1.482576312889787e-01   +5.534939951399506e-02   -3.602016594470517e-01   -2.341307149558616e-01   -2.533133261745186e-01   +3.224548665859889e-01   -9.501522843134912e-02   -3.027848182089656e-01   +2.830481145054928e-01   -1.961814506217729e-01; +3.043655769568575e-01   -4.719199036230387e-04   +3.645355763759056e-02   -5.699347145283340e-02   -1.403793884225529e-01   +1.531707062881814e-01   -9.133815187590986e-02   -2.087171672554962e-02   +6.990354499909250e-03   +1.783929522541467e-01   -5.209466519944392e-02   +2.650901260167537e-01; -1.590811959696279e-01   -1.255804947505948e-03   +5.961520334817305e-02   +4.110153919908222e-01   +2.211758902627279e-01   -1.061211267756155e-01   +9.705322446794476e-02   -8.374969669905692e-02   -3.319255273590964e-01   +4.015617307200788e-01   -6.927229297806412e-02   -1.591343896836091e-02; +3.564857750271531e-02   +2.926809322540981e-02   -3.578746638215065e-01   -6.349022234071369e-03   +1.519103537790577e-01   -1.458319149352764e-01   +3.038360388001585e-02   -2.194599114323204e-01   +1.968828392175215e-02   -2.261948968718943e-01   -1.342339597335470e-01   -1.418979841681155e-01; +9.872005315162451e-02   +4.003583314400205e-01   -9.583944002403277e-02   -1.125286187101985e-01   -5.510515679809348e-03   -2.933147990033484e-01   +4.675854662018108e-02   -2.393119839040463e-01   +1.581216200801903e-02   +1.423002853275156e-01   +3.050455029720348e-01   +1.424365938025930e-01; -3.076864757744176e-02   +1.617511302605262e-01   +9.073693613823784e-02   -8.588065550331014e-02   +2.499933650870332e-01   +7.122088800845681e-02   -3.039931302571515e-01   -7.794076927022510e-02   -1.956482654687547e-02   -2.088322781550075e-02   +1.162569937339612e-01   -6.109925646845679e-02; +1.706427368347922e-01   -2.089537724935798e-01   -1.520764138862776e-03   +9.828427304486702e-02   +5.715555501161208e-02   -3.092524141956019e-03   -5.901162159840631e-02   +1.033586937863866e-03   +2.022996613053755e-01   -3.342031966577651e-01   -5.240975886139054e-02   -6.967196180209244e-02; +1.292094882238670e-02   +1.281887875086206e-01   -1.766947632867504e-01   -2.757965387208904e-01   +1.703438400041335e-03   -3.661316325488149e-01   -5.349959437562680e-02   -6.428517320434120e-02   -1.790339117444273e-02   +1.484141218810618e-01   -1.903605369516696e-01   +1.091176156106701e-01];
L3I_L2I_iGABA_netcon = [+3.647415653101951e-02   -1.570935148497217e-01   +5.076578922503950e-02   -2.742622319397849e-01   -9.931322371424273e-03   +3.128119455597538e-01   +3.302797094437861e-01   +4.940083631830316e-02   -9.972254671026157e-02   -1.071466407860011e-01   +3.534881334315910e-01   -1.130650593894779e-01; +7.141959520470628e-02   -3.179368129686025e-01   -1.675793461702072e-01   -6.938503972106121e-02   -2.766976822801651e-01   -3.520943597824112e-02   -4.597364889997778e-02   -1.215954791792081e-01   +3.672363433105591e-03   +5.367203763105910e-02   -3.133383629836981e-01   +3.198304387596964e-01; -8.903845961372121e-02   -7.921747259725931e-02   +3.416116724610612e-01   +1.554387314855921e-01   +9.050911834504990e-02   +3.028613142134100e-02   +1.600219119998892e-01   -2.167697513600401e-01   +3.050981188942727e-01   -2.575798278472198e-01   +1.494879861105829e-01   +2.846617836887861e-01; +1.644871643670031e-01   -9.500132030681717e-02   -7.077831501274459e-02   -2.864090563141135e-01   +1.639000994580682e-01   +1.327031410407389e-01   -4.056904475275859e-01   +8.900551304911714e-02   -1.984335047690806e-01   +1.544565675580888e-02   -2.042417293432665e-03   -3.297945023699570e-01; +6.355252862069970e-02   -1.057098262607967e-01   -1.488645303963399e-01   -1.359508974786323e-01   +1.365455555035497e-02   -3.226524925873338e-02   +2.853393241865132e-01   +1.610840693728402e-01   +2.789922234720536e-02   -5.350794393816991e-02   -2.073204686341492e-01   +7.613163935834666e-02; -1.222498710983940e-01   -3.096021215921785e-01   -1.235918208027885e-01   +9.763647464147199e-02   -1.723678322005740e-01   -1.956658408973050e-01   -2.232580200553478e-01   +3.008170064196816e-01   -2.159719623714601e-01   +1.920695669439762e-02   -2.532956662696000e-01   -5.786764723443519e-02; +1.200706854356981e-01   +8.834397764792583e-02   +7.162419828338093e-02   +1.094239788228568e-01   -4.785518902698993e-02   -5.890211231465950e-03   -6.733746520967995e-02   +5.595585587800955e-02   +1.397416765083521e-01   +2.167609603984768e-01   +7.150454758571673e-02   -5.012426719143905e-03; -1.013792615504929e-01   +1.941834604354855e-01   +1.065962020398953e-01   -2.867801040138030e-01   -2.023645297562415e-01   +8.391495261361172e-02   +1.965141819990006e-01   -1.524717909007295e-01   -1.871972201865686e-01   -2.433311279334729e-02   -4.866376603828999e-02   +4.594692240200587e-02];
L2E_L3E_iAMPA_netcon = [-7.065009576539785e-02   -3.235071743221624e-02   -2.206105158722202e-01   +2.046183688656446e-01   +1.871353603663306e-02   +3.829111368805608e-01   -2.552829641843619e-01   +8.740653686201361e-02; +7.917634302778397e-02   +1.890964349804036e-01   -2.128810341972064e-01   -3.807226304544580e-01   -1.183774746790895e-01   -1.561437204258941e-01   -2.318519131835880e-02   +1.068416862692354e-01; +3.071952448334947e-01   -2.612195840299000e-02   -2.691111035571689e-01   -2.277483985860372e-01   +8.369779568847902e-02   -4.096515444356789e-01   -1.390775513573221e-01   +8.410335869849124e-02; -2.279368291368944e-01   -1.558324210804808e-01   -5.049592120388212e-02   -3.827318299852604e-03   -6.520151140435089e-02   +3.154604579102336e-03   -2.505190970522327e-01   +2.169926947670084e-01; +1.232841297446179e-01   -2.148446171258063e-01   +5.786488437508107e-02   +1.696694571412424e-01   -1.091794476575552e-01   +9.014199909336558e-02   -3.190187337676613e-02   +2.509441937071907e-01; -2.773041247240517e-01   +4.882854424543961e-03   -4.556187796619303e-02   -1.431151400017650e-01   +1.883176338255705e-01   +1.487684117882485e-01   -1.019927205647403e-01   -2.305188752641817e-01; -2.261306743191922e-01   +2.059531952871405e-01   -6.056976485556138e-02   +8.780139407735904e-02   +2.824286791345805e-01   -9.168750998024221e-02   +2.827471720207538e-01   -3.903528318435647e-01; +4.602525630807833e-01   -2.675904251754475e-01   -1.129145957245223e-01   +2.409420771277367e-02   +1.074615078522468e-01   -1.464813193207606e-02   +1.443799257639396e-01   +9.115806989938934e-02; +3.520178766859776e-01   -6.471797733693323e-02   -2.093850393593398e-01   +8.697531584927411e-02   +4.906769743545198e-01   -3.068513769195554e-02   +1.206482308844542e-01   -1.230462890390006e-01; -2.735271278305023e-01   +1.509917481634734e-01   -9.242059356814449e-02   +2.974754746239803e-01   +1.657518992153324e-01   -1.107678684975183e-01   +7.073188717293859e-02   +1.875311665450516e-01; -6.921625989723910e-02   -1.908848615984887e-01   -3.811039159050628e-01   +1.027083782790826e-01   -1.183321417144401e-01   +2.510637278603871e-02   -1.290249888516573e-01   -9.174446033158291e-02; -1.187400174564955e-01   +1.062533984560678e-02   -1.489587890178676e-01   +1.193961631916311e-01   -1.788570688768892e-01   -4.233965256881286e-02   -2.317269238188287e-01   +4.056636116478622e-01];
L2I_L3I_iGABA_netcon = [-2.076158860138780e-01   +2.494098147065658e-01   +1.009924180824864e-01   +1.118406501977924e-01   +3.885982613395982e-01   -2.091255090229859e-01   -2.298518365163434e-01   -8.119705530795765e-02; -4.168242079411233e-01   +5.614843074028922e-02   -2.348288991308521e-01   +7.568871637538194e-02   -1.402224687961825e-01   +8.341793087896013e-02   -1.573836448948622e-01   -3.691182412358132e-01; +5.675634581300937e-03   -1.426430884117841e-01   +9.232565173433441e-02   -8.081497964088025e-02   +9.711778760737448e-02   +2.205850951793534e-01   +7.790435595768722e-02   +1.419442445112228e-02; -2.889741077993700e-02   -1.771125365225804e-01   -1.134823832879366e-01   -1.237973866462972e-01   +2.723505718982890e-02   -3.447892413377599e-03   -2.240234554563297e-01   -2.233481794688325e-03; -1.000708838557638e-01   -1.835868005845918e-01   +1.776652622785575e-01   -1.962729334852959e-01   +7.177454948224404e-02   +3.699414082374921e-01   -2.360342068151974e-02   -1.253324205104666e-01; +3.047849978104201e-01   +3.508664112488493e-01   -2.200484836270470e-03   -2.598476514582219e-03   +2.219977167949221e-02   -2.310009800614641e-01   -1.095999647848311e-01   -2.285137250294131e-01; -7.485818446115473e-02   +1.016411264631072e-01   +3.718215671691135e-02   -2.887090913948490e-02   +2.407303348550378e-02   +2.046424877933146e-01   -2.703053439343589e-01   -1.719409781904846e-02; +1.786579235600713e-01   +3.034165675182046e-01   -8.942255533242499e-02   +1.534688782265009e-01   -4.361105832961763e-02   +3.891030549134329e-01   +1.678087743998195e-01   -1.540522889619547e-01; +7.426779772553996e-02   -1.569887583598396e-01   -1.905845325433796e-01   +2.056463369037501e-01   -1.147369435486801e-01   -8.744989537007875e-02   +5.090362442755454e-02   +7.640464897716798e-02; +2.531471495607579e-01   -2.560649019713921e-02   +2.097797951817031e-01   -1.083773205981001e-02   -1.245749691526218e-01   +6.831460923585950e-02   +2.238937090454198e-01   -3.431792568319880e-02; +6.987310014442023e-02   -1.679510514149653e-01   -1.394847720716874e-01   +1.915586455458225e-01   -1.479779513315246e-01   +1.594501319399757e-01   +2.756138403435457e-01   +2.570477673567786e-01; -9.580196002228231e-02   -1.900998917238808e-01   +1.453347297755254e-01   -3.218644262956025e-01   +6.081545720928380e-02   +7.265166334619488e-02   +1.982733134171165e-01   -2.804472706627879e-01];
L3I_L3E_iAMPA_netcon = [+5.699044616153640e-02   +2.860263566499973e-01   +1.520492470067339e-01   +4.278194872918252e-01   -1.902774448802060e-01   +1.694059992967740e-01   -2.185632501982172e-01   -5.047699201084593e-02   -2.049218743362844e-01   +1.797384547055539e-03   -6.693625982334181e-03   -1.560927980115423e-01; -8.382623456289980e-02   -3.699894864126016e-01   -4.788388349831834e-02   -4.855347560605874e-02   -3.355767696094195e-02   +2.372092692316578e-01   -1.123747998759529e-01   -8.157051332912217e-02   -1.056474110075198e-01   -1.742869259510409e-01   +4.276886743392932e-01   +1.356992944999314e-01; -6.731681298820191e-02   -1.967561592820866e-01   +2.412838513996950e-01   -5.060388747876488e-02   +1.013215756389385e-01   -3.471899209127070e-03   +2.997503308775116e-01   +7.052809347104469e-02   -1.235998665294235e-01   -1.433052267054854e-01   +1.471490787016594e-01   -3.125381207553739e-02; +3.818894320590985e-02   +7.842696194054311e-02   -1.420308056703446e-03   -2.327536328376013e-01   -2.561286921018536e-01   -2.260303536805779e-01   -2.666162441780503e-01   +2.197817239387967e-01   -2.179353892093753e-02   -1.563701176731331e-01   -7.360257445439790e-02   +1.247703540420226e-01; -1.457269710115259e-01   -2.998602848941702e-02   -1.911433955821463e-01   +4.836209783398202e-02   +5.166801082083075e-02   -2.666512831395574e-01   +5.307884853654376e-02   +3.651195569519808e-02   +2.862586401961073e-01   +6.569231837120665e-02   -3.513971274112824e-01   -1.974392003302490e-02; -4.151704958903861e-02   -7.996742558233945e-02   -1.614961507722487e-01   +4.736136537478192e-02   -1.391984636740148e-01   +2.901252492900111e-01   +2.414659276700818e-01   +8.590819175054804e-03   -2.492402102533067e-02   -8.672596344310679e-02   -3.391173391204562e-02   -1.168615112426320e-02; -3.526027834650780e-04   +2.045839343442688e-01   +1.042535477743317e-01   -6.636335686868908e-02   -2.654104379178363e-02   +2.145909761656418e-01   -2.558535393155421e-02   +2.415860449796133e-01   +7.008743870730293e-02   -3.238989652204282e-01   -1.686525330073244e-01   -4.080786283560818e-01; -1.917154872121377e-02   -6.881686673335066e-02   +2.179842271124929e-01   +2.994595234902631e-01   -4.735861673272754e-02   -8.954846546761362e-02   -1.777783335491658e-01   -1.417018435207067e-02   -4.121898868144334e-02   -1.054670370781413e-01   -7.991474186614095e-02   -1.928883147507712e-01; -3.229304046991057e-02   -9.249958030669103e-02   -7.431158731764656e-03   +1.505368717796577e-01   -2.672340405045354e-01   -9.023235693703642e-02   -1.344798065594577e-01   -1.699821545972633e-01   +8.355886280823104e-02   -6.971506352115461e-02   -9.813385635989608e-02   -9.322399287451819e-02; +1.409132882188763e-01   +6.058961319370962e-03   +2.056660348406888e-01   +2.156403864461082e-01   +9.323111487685992e-02   +6.947498959753955e-02   -2.106183013126667e-01   -5.033010760824047e-03   -1.534796155719825e-01   -6.118729557168218e-02   +9.035369349707650e-03   +1.985990334369105e-01; +1.724577779814663e-01   +4.844759033446264e-03   -1.291979808380521e-01   -1.266255796447984e-01   -4.098203754515146e-03   -7.930415095228902e-02   +2.341644638092288e-01   +2.419153353504322e-02   -7.336352787225883e-02   +3.065879215983873e-01   -1.079166335943221e-01   -2.636426476149880e-01; +4.712878136584366e-02   +1.941956251808214e-01   -1.386170860910577e-01   +4.457824178725036e-01   -2.700165367490766e-01   +2.059329620650989e-01   +1.965496802943265e-01   -1.873550888630056e-02   +4.780652809540788e-02   -2.397854310223530e-01   +2.589438625104520e-01   -1.300583388273078e-01];
L3E_L3I_iGABA_netcon = [+2.120348206080293e-01   -2.938111671810973e-01   +6.521589333393389e-02   -8.097673168872349e-02   -1.982940103246562e-01   -2.663750642341172e-01   +1.437305943374902e-03   -1.824360790563577e-01   -1.834152385718447e-02   -6.316253014354188e-02   -7.458218586459339e-02   +7.496260300577248e-02; -1.461682997586592e-01   -2.083396339294063e-01   +2.755701801449922e-01   -8.626997120822083e-02   -7.123706848290409e-02   +1.086769031026891e-03   +4.466019557661845e-02   +1.324194574886670e-01   -1.081932503383704e-03   -2.303446155347012e-01   +3.902058006936682e-01   -7.508434795425328e-02; -6.591051327589845e-02   -2.488284467966367e-02   +2.504390612390625e-01   -3.458798784312254e-01   +1.423408379304228e-01   +4.478395800821966e-01   -6.836677347920483e-02   -1.155428962249963e-02   -3.654352749617328e-02   +9.821066442624322e-02   +2.136378220787275e-01   -9.108547988883353e-02; +3.095356599590234e-01   -7.770119510861449e-02   +1.664730658486681e-01   -1.904813159655139e-02   +5.256821905764830e-02   -2.573734870205963e-01   +2.894737270400999e-01   +2.676963372814376e-01   -7.802371699455360e-02   +6.993736883033248e-02   -4.084842175029264e-03   -2.229338535628012e-01; +4.722021701342678e-02   -1.529447140966031e-01   -1.459225189131360e-01   -1.672270604176003e-01   +9.411371792040376e-03   +1.764877641184668e-01   -2.193647431375914e-01   +3.535165705747939e-03   +1.709923934275900e-01   -1.184790581081537e-02   +2.345938892823222e-01   +1.783480617727613e-01; +1.954763581638677e-01   +8.723995164408832e-02   -4.996681790876747e-02   +1.650723639530439e-01   -6.948013976944944e-03   +6.004891068921614e-02   +6.957051424948626e-02   +2.878227405690869e-01   -7.972221145777879e-02   +2.546422916346758e-01   +5.880252609568690e-02   +1.129591439916866e-01; +1.817084349112462e-01   -2.256124175111326e-01   +2.275909198099498e-01   -1.337078026125848e-01   -8.274194875646708e-02   -3.236242012637907e-01   +8.060973955694012e-02   -9.362512812217021e-02   -4.139410949080844e-01   -3.347936938070100e-01   -2.035595512787925e-01   +1.096057222463651e-01; +2.141817075108075e-02   -8.437686900539143e-03   -1.158324200082365e-01   -9.771974692754468e-03   -1.879359544136051e-01   +4.390495756963982e-02   -4.164914385943171e-02   +3.143749459772271e-01   +7.217095852501521e-02   -7.187422412873251e-02   +1.479653617091889e-01   -1.925350981094106e-01; -8.884772481391628e-02   -4.567001938645397e-02   -1.525645016755772e-01   -5.687169626974455e-02   +3.191462308405287e-02   -4.362688337433038e-02   +2.744371161091436e-01   -1.075686816867586e-01   -2.336705360397026e-01   +2.248767900660703e-01   -2.117704081727339e-01   -2.373935361063327e-01; +5.512794015228502e-02   +9.363638806403510e-02   +3.296833607712799e-01   +2.270470049285237e-01   -8.876488899865589e-02   -3.209316595851756e-01   -6.460063941984612e-02   +8.960357689293964e-02   -1.906124417910476e-02   -4.589315030773429e-02   -6.583788851333200e-02   +2.489802146171057e-01; +4.297909222678996e-02   -1.264760215603514e-01   -1.554529468195097e-01   -1.348540797406796e-01   +2.666995307427918e-02   -2.816217454567957e-01   +2.279588329576100e-01   -2.431689353414653e-01   +6.711957867060210e-02   -8.805461392713904e-03   +2.355693358920453e-01   +9.381814132759891e-02; +1.215809940210950e-01   +1.045493828239341e-01   -1.029700368833780e-01   +1.173068482769807e-02   -1.276435313049968e-01   +3.395715489205425e-01   -3.218012819242146e-01   -1.378828053968278e-01   +2.227131592583959e-01   -1.970203211940932e-01   +1.229922142688542e-01   +1.844207223657610e-01];
L2E_Input1_iAMPA_netcon = [+2.592280250805618e-01   +3.171267138708123e-01   +2.059109745305518e-01   +1.953801476271305e-01   -2.011276556752675e-01   +3.681467751455750e-01   +3.445933595561718e-02   +2.152532423454040e-01];
L2I_Input2_iAMPA_netcon = [+1.736963876334377e-01   +1.040243049455911e-02   -2.317336383737297e-01   -1.343332054379056e-01   +2.345560022081432e-01   +2.194042199727912e-01   -3.487011890634498e-01   +3.759370406350950e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
