function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.542213632157010e-01   +1.554836807769810e-01   +8.859702616921973e-01   +5.092018609640023e-01   +2.572589161391667e-01   +7.593705449433223e-01   -3.509515173627811e-01   +5.262798428101677e-01   +2.909946781602771e-01   +8.374911929301397e-01   +9.138796281452351e-02   -1.067633265077781e-01   +2.973375967826432e-01   +6.155646344681085e-01   -2.949059936147981e-02   -7.343346897492332e-02; +4.335327313610551e-01   +4.168115810068249e-01   +1.985839421148860e-01   +7.483992155067690e-01   +4.571799122998949e-01   +3.897438967181032e-01   +2.564722920024162e-01   +5.144381999469709e-01   +7.497763616897052e-01   +6.100236792595291e-01   +5.458168694236295e-01   +5.194758068683131e-01   +3.559192566620527e-01   +8.871953867319329e-01   +4.335642541850310e-01   -1.486024935470548e-02; +7.407386503094353e-01   +2.301616352407009e-01   -1.110399135113348e-01   +1.756057329305810e-01   +4.117793586538724e-01   +8.977605116195286e-03   +6.677052146157121e-01   +3.675838362736152e-01   +4.997110289586109e-01   +4.488422486756492e-01   +2.258828183872525e-01   +1.217464914751022e-01   +3.218131566893850e-01   -2.321196328164519e-01   +4.037665855788053e-01   +3.287922276347726e-01; +4.634087839691318e-01   -1.377066369726035e-01   +3.052392069523336e-01   +5.958421930741654e-01   +2.592301774239892e-01   +3.352773513610874e-01   +7.723326544291002e-01   +9.104108746197751e-01   +4.655056696398284e-01   +3.240352446056201e-01   +6.672239156361415e-01   +5.370129697792582e-01   +4.197910086300969e-01   +3.976044984924038e-01   +2.625815651785393e-01   +5.555648141811935e-01; +7.827947872796269e-01   +1.407321899901097e-03   +5.894812364639611e-01   +8.746991527468561e-01   +3.396318991581704e-02   +2.479742430741124e-01   +2.518162618727410e-01   +7.550626127966648e-01   +2.633300252021969e-01   +5.164191842989060e-01   +7.492295889440228e-01   +2.198389525767588e-02   +2.534867259170010e-01   +1.607938917441401e-01   +5.167094458509791e-01   +3.790956646280834e-01; +1.728109121676376e-01   +4.461341537327504e-01   +4.923576504284164e-01   +2.001500625534787e-01   +9.200731394798684e-01   +2.682340913464342e-01   +1.000000000000000e+00   +1.166427877137183e-01   +2.393797627551791e-01   +5.512661274811238e-02   +2.857681287415634e-01   +3.321801676110086e-01   +7.029076136050276e-01   -8.468373647450190e-03   +9.089351662457590e-02   +3.615335385666631e-02; +6.871746506923163e-01   +6.246952341044931e-01   +4.419068568485919e-01   +4.640783153756193e-01   +1.650139489856060e-01   +3.292657863537981e-01   +8.437900207375630e-02   -1.310421736189425e-01   +7.702696068366058e-01   +4.149000415195750e-01   +3.542986156241693e-01   +5.463501903303372e-01   +1.131892442121479e-01   +3.807303083968224e-01   +5.897925641875692e-01   +4.818115985891356e-01; +4.920164061920565e-01   +5.688633435906886e-01   +4.633363288153352e-02   +7.431626329006438e-01   -1.898940171665673e-01   -2.565826823270833e-01   +3.911433792996019e-01   +7.338637092824991e-01   +6.047156565877209e-01   +4.767281145403414e-01   +4.041413194353342e-01   +4.674054915360240e-01   +3.956455649218122e-01   +4.786243903212024e-01   +6.849605019232735e-01   +4.226406723659986e-01; -6.897703570750800e-03   +4.748760576029651e-01   -7.556241402731045e-02   +6.261579661116758e-01   +5.386515688922517e-01   +8.744201029058477e-01   +8.513631845219680e-01   +1.639012912313371e-01   +3.216990966105228e-01   +4.477168234201451e-01   +7.542290993552329e-01   -1.276224122122463e-01   +5.101306522253293e-01   +4.290836758019561e-01   +3.487210260283138e-02   -8.273129375147019e-02; +5.248498583469254e-02   +3.617494487445538e-01   +9.395394839159165e-01   +7.188291484507908e-01   +6.411003145840187e-01   +2.446335214349351e-01   +4.704432144017386e-01   +3.659053942003252e-01   +1.984634752496454e-01   +4.269751432389690e-01   +1.393888411582533e-01   +5.418629494772705e-01   +8.777387726759224e-01   +2.471764450605899e-02   +4.642491517221717e-01   +6.847959696656356e-01; +3.360980884227696e-02   +5.486553631891572e-01   +4.944560001255669e-01   +2.921333389375761e-01   +7.126845378111248e-01   +5.910371782038861e-01   +6.345642988009333e-01   +3.548918917974264e-01   +4.018611506710666e-01   +5.497988382024487e-01   +3.343078256101585e-01   +5.151023616348989e-01   -9.314081435070147e-02   +6.165608986031677e-01   +4.906687158830599e-01   +6.462122175262881e-01; +5.862258198995945e-01   +1.305209480926002e-01   +1.588864192406188e-01   +1.312508337531159e-01   +2.277180772309451e-01   +5.916334764234736e-01   +3.649122345463337e-01   +2.102618212422292e-01   +8.661424047923262e-01   -1.957820402770696e-01   +1.952787801738728e-01   +7.173998453913394e-01   +1.429159651515651e-01   +2.490353288435329e-01   -2.635117710723840e-02   +7.140356763183728e-01; -1.973380709636581e-01   +2.982809051640546e-01   +6.033708761376598e-01   +6.252994008737074e-01   +6.647785824558702e-01   +3.801564474044329e-01   +1.816181273840008e-01   +4.662635653477996e-01   +8.020318047358137e-01   +5.714582780870368e-01   +1.296855382329263e-01   +2.023265212455997e-01   -3.582343554250293e-04   +2.233819562545229e-01   +4.016809947885029e-01   +2.455580384948673e-01; +3.371232026786110e-01   +6.181286202421962e-01   +6.339857157222717e-01   +8.202935469098509e-02   +2.954886288431720e-01   +5.147764240410697e-01   +3.032581148245960e-01   +6.033448614239606e-01   +2.720655491272218e-04   +4.104537568613917e-01   +5.119741601305006e-01   +3.858037377398693e-01   +7.403716655729120e-01   +4.772075917911279e-01   +6.242904518035839e-01   +2.973382482043816e-01; +4.554656947091051e-01   -3.189245994393945e-02   +3.147335266432220e-01   +6.892043932247138e-01   +2.696417558046316e-01   +5.761892196135457e-01   +5.314691503093008e-01   +9.017150080504055e-02   +7.178983247658927e-02   +3.949654666347054e-01   +3.169652798694532e-01   +6.208152407506756e-01   +5.074898626342660e-01   +4.820938730172942e-01   +6.296719761557240e-01   +8.350946507006225e-02; -7.075840759442426e-02   +5.144868186051400e-01   +5.386049356909950e-01   +5.707093127591953e-01   +6.866042011590311e-01   +5.700606415271685e-01   -2.167676955124303e-02   +9.459910848296178e-01   +5.466872169257411e-02   +7.440355209830173e-01   +4.130596209270571e-01   +4.648722492267523e-01   +1.627889268144990e-01   +6.099168723846935e-01   +4.810567230557743e-01   +3.318139486404344e-01];
L1E_L1I_iGABA_netcon = [+8.106051183458981e-01   +4.825929106907065e-01   +4.422564486888826e-01   +3.555117035084706e-01   +4.353894085822417e-01   +2.209005140882802e-01   +5.340603280379010e-01   +2.770840880484551e-01   -3.728128754888129e-02   -2.400914616186723e-02   +4.670077328050302e-01   +2.531635352507144e-01   +6.098958993486026e-01   -4.415781904522774e-02   -2.463432168542562e-01   +1.000000000000000e+00; +1.946781390878095e-01   +2.502342156753923e-01   +7.087593708619826e-01   -1.286944622413042e-02   +5.019358119195720e-01   +7.747831897810250e-01   +4.452826098095609e-01   +7.142869791341543e-01   +4.398386163395707e-01   +1.793414267404621e-01   +4.416825232219382e-01   +8.595901693060409e-02   +8.604483814058959e-01   +4.906441808008708e-01   -1.990580894462696e-01   -9.786306478438981e-03; +1.191235455905791e-01   +4.314127144399286e-01   +5.700953218190828e-01   +1.798368189396964e-01   +5.649078770696958e-01   +3.391051877923613e-01   +3.872512037794679e-01   +1.186785423222050e-02   +3.444368534674066e-02   +9.738834337017733e-01   +5.693282842035726e-01   +2.810137223344705e-01   +2.377046171507501e-01   -1.599338604397176e-01   +9.743649896624577e-02   +7.402537951526654e-01; +8.050049698743362e-01   +1.057993493407219e-01   +1.644038717005599e-01   +3.731509103334159e-01   +3.552959512693673e-02   +3.454138870175640e-02   +2.747386173565201e-01   -1.673737183583706e-02   +2.475420600897473e-01   +1.864968471381609e-01   +2.695743942878456e-01   +9.086098467540256e-01   +3.264814656274386e-01   +5.178467845249380e-01   +5.146117106118993e-02   +1.729024024796932e-01; +4.956063619073607e-01   +3.095422474480616e-01   +2.898150612516754e-01   +2.148921300453862e-01   +5.702275870875833e-01   +1.607931454271661e-01   +3.855280368404779e-01   +3.393352660476733e-02   +4.407533728658899e-01   +3.241235598503617e-02   +2.628580387419638e-01   +4.727352313766524e-01   +3.488765343746979e-01   -1.541872536729569e-01   +1.062814911080174e-01   +4.814239617435347e-01; +2.288679502046569e-01   +4.236267662754326e-01   +7.276351622366816e-01   +2.314306995579018e-01   +7.144892193260651e-01   +2.495867001651798e-01   +2.528537971243283e-01   -1.665721061598374e-02   -1.645294073605620e-02   -1.247538334799472e-01   +4.222190926272693e-01   +7.983286132810160e-01   +2.765143231057984e-01   -2.587664166074211e-01   +5.504237415848785e-01   +3.945749080405094e-01; +3.945237617203264e-01   +2.496156388762346e-01   +2.368059113831866e-01   +1.387312428577169e-01   -5.505650624783923e-03   +2.824895807495190e-01   +3.743238102336863e-01   +1.037491652897101e-01   +2.222594765419579e-01   +2.182193422256186e-02   +4.276221513352297e-01   +4.039317452613484e-01   +8.106721913019916e-01   +1.433498265531853e-01   +3.590319201592706e-01   +2.888812477081608e-01; +5.747906109875125e-01   +5.825015066300513e-01   +3.578416399737677e-01   +6.533086046958283e-01   +3.238418559223887e-01   +1.806797062091619e-01   +2.205571267752293e-01   +5.880861453386445e-02   +9.437729726526676e-01   +1.174747668803823e-01   +5.267102074223202e-01   +1.968169929523924e-01   +1.879760136332542e-01   +3.046784683979021e-01   +2.510844912093891e-01   +5.096459488949114e-01; +4.088728881509970e-01   +3.164464055838778e-01   +3.082125680561294e-01   +1.562614105009925e-01   +3.511434607527804e-01   +8.120910498275608e-01   +3.886140808922678e-01   +2.578164834620547e-01   +4.756429737386735e-01   +4.948168206034577e-01   +3.691609830520373e-01   +5.243428480300910e-01   +1.537530813145965e-01   +1.995789682013457e-01   +5.201299974956758e-01   +3.860943902040928e-01; -4.773619053758818e-02   +7.616999051708707e-01   +5.651871861581392e-02   +5.673706550257888e-01   +7.800262479043259e-02   +5.819923976231840e-01   +2.677478186405099e-01   +3.721837420229167e-01   +5.425062855803797e-01   -1.294129856252766e-01   -9.411927833046939e-03   +5.463282059267431e-01   +6.571029706975265e-01   +6.153249378375605e-01   +3.063683744173511e-01   +5.824544376452132e-01; +3.462914021332078e-01   +1.600751284542255e-01   +4.012473747513814e-01   +1.768091797353136e-01   +3.792133260091848e-01   +1.665532905390956e-01   +4.120660257322905e-01   -3.332934419819102e-02   +7.584943912054036e-01   +2.686379574406959e-01   +1.540935466198278e-01   +2.860663806215097e-01   +3.230773547584572e-01   +3.941639751513852e-01   +4.136805760499042e-01   +1.336035531615351e-01; +5.533395438262626e-01   +3.879623672029245e-01   +1.473796272573832e-01   -4.633406344609328e-02   +1.784614417283683e-01   +1.345175492962949e-01   +2.560112895268883e-01   +6.978465927408534e-01   +1.550655608228143e-01   +5.451855219693275e-01   +5.684294561750669e-01   +7.201194598183900e-01   +3.485842133072442e-02   +1.560565852083608e-01   +4.022312444469453e-01   +5.355166050469735e-01; +6.063773476124874e-01   +2.226322565305608e-01   +7.452647037624209e-02   +6.756105405092651e-01   -7.606891170895616e-03   +1.921559597281837e-01   +2.318286435814949e-01   +2.762971504844766e-01   +9.750417754808059e-02   -2.848176591879114e-02   +5.867994820921728e-01   +1.526516665400560e-01   -1.371048803459660e-01   +2.306777657735060e-01   +5.398897769971588e-01   +4.433895095167577e-01; +4.402171126028639e-01   +5.361288309803578e-01   +2.702007663279696e-01   +6.860687325299646e-01   +1.138873743884175e-01   +5.072337304426222e-01   +4.565264197182813e-01   +2.587292935453032e-01   +8.999079515333862e-01   +2.567585540676008e-01   +4.600059186785683e-01   -2.050142724613185e-01   +3.824858177880200e-01   -1.440858713540932e-01   +1.090256990653634e-01   +9.692719720732089e-02; +6.292406330948492e-01   +2.103216356573730e-01   +3.256158507051051e-01   +1.220209114126708e-01   -8.835858408605153e-02   +1.285615956518873e-01   +2.306583578041365e-01   +6.002121602810462e-01   +5.574797034018776e-01   +3.860921960667535e-01   +6.335977881507546e-01   +1.995808430574228e-01   -7.926367079945622e-02   +1.491976409119814e-01   +3.282297279618370e-01   +5.316318963569838e-01; +3.819147755509000e-01   +2.207613056079444e-01   +8.550478136784257e-01   +1.794408266970215e-01   +6.629560343661980e-01   +3.627243542666496e-01   +6.176997293215160e-01   +4.102870949866733e-01   -2.171317934285110e-01   +2.989897688878579e-01   +1.533551305189313e-02   +4.076061975341960e-01   +3.685864878235398e-01   +2.986828338255070e-01   +1.610946225069427e-01   +4.543260959552017e-01];
L2I_L1I_iGABA_netcon = [+6.315830786174093e-01   +2.046187048825504e-01   +4.110009560422133e-01   +5.870978001619672e-01   +1.976069691599027e-01   +2.958779090877132e-01   +4.840119532421663e-02   +5.043266253157023e-01; +4.598230556907793e-01   +8.045620363756764e-01   +3.567195726394011e-01   +4.620511593266797e-01   +4.816977122873431e-01   +1.384197932299908e-01   +5.670959006968984e-01   -1.615852402190566e-01; +2.872956529398994e-01   +3.374491656948241e-01   +5.663788653963285e-01   +1.262569552213070e-01   +5.940078236741512e-01   -3.702802820408659e-02   +2.110745706323048e-01   +5.788323911191362e-02; +5.261226539893061e-01   +1.696643597544282e-01   +6.898029855612761e-02   -3.985108050412037e-02   +6.162128527556436e-01   +4.325172908833860e-01   +4.639131610773177e-01   +3.959825341908073e-01; +3.623924862232153e-01   +6.895272276100129e-01   +3.368575616779075e-01   +6.575511797627751e-01   +3.945375095506879e-01   +9.355331073896955e-02   +3.759745856061847e-01   +2.905894792266516e-01; +4.309076031874319e-01   +1.469963505068324e-01   +5.087473581575941e-01   +4.338572625175029e-01   +1.579938506687264e-01   +3.879351438175726e-01   +4.116279073389839e-01   +5.857200126274081e-01; +6.004817824461425e-01   +8.591986720843455e-01   +7.024507483195390e-01   -1.618737352958130e-01   +5.781658416889011e-01   +2.789235240661769e-01   +4.304565032978453e-01   +1.076119418217086e-01; +5.351736813747902e-01   +2.480932849604430e-01   +2.474114093660225e-01   +2.272712599885089e-01   +3.335878622984049e-01   +2.486947380614537e-01   +3.016752213407051e-01   +2.063247781790157e-01; +6.321213720311640e-01   +1.000000000000000e+00   -6.217655840386244e-02   +7.119841201152500e-01   -7.251914601213605e-02   +2.062796732170643e-01   +1.584288176330306e-01   +3.284856547734660e-01; -4.670856941062373e-02   +1.204940363223121e-01   +6.406676525146641e-02   +6.559455320626760e-01   +8.244002609173435e-01   +1.471058568532873e-01   +2.432138224340880e-01   +6.735217064541364e-01; +2.175568385179993e-01   +6.506297713390504e-01   +3.507821333032226e-01   +5.919072908039619e-01   +9.144902039008894e-02   +1.796250432807704e-01   +2.606587076447743e-01   +1.246158125671774e-01; +4.274159681463124e-01   +1.739173538007321e-01   +5.755148106483116e-01   +1.817441737384791e-01   -7.623805746436144e-02   +5.837215948124189e-01   +1.983106000212705e-01   +3.967966388640761e-01; +3.169076444329375e-01   +4.988369914121141e-01   +8.121483445466190e-01   -1.068591316000181e-02   +1.829860575577384e-01   -3.363604115353615e-02   -1.483169232467551e-01   -2.362430136688887e-01; +1.678026610763341e-01   +2.131087750392571e-01   +1.452181464864732e-01   -1.615273723351378e-01   +4.823418260580382e-01   +3.742500501420781e-01   +3.789443608252518e-01   +1.358469062833726e-01; +8.172372815142848e-01   +7.230624722073699e-01   +5.863326829878071e-01   +8.161714011812780e-01   +4.849675543945514e-01   +8.409355922824028e-01   +4.388917705346626e-01   +6.278083390955327e-01; +8.240468545706439e-02   +2.562635997120084e-01   +7.126520576860591e-01   +3.658373449604043e-01   -3.407191961237120e-02   +3.776309034725730e-01   +6.001457070679705e-01   +6.676942170549726e-01];
L1I_L2I_iGABA_netcon = [+5.691261073329451e-01   +6.518255102942579e-01   +1.569498185729402e-01   +5.071623727210897e-01   +4.729043136869904e-01   +1.737515622059596e-01   +6.550976413906826e-01   +2.363736614324378e-01   -1.333438988903770e-01   +6.082102434512211e-01   +2.769023053948524e-01   +7.348443627253019e-02   +6.615658136703531e-01   +3.094885043722366e-01   +2.118213924573968e-01   +3.454586854556675e-01; +4.590505194908754e-01   +5.955169279225467e-01   +4.358271678662003e-02   +1.655583727029244e-01   +1.489816938957212e-01   +5.526993271923100e-01   +9.380145692076416e-01   +2.439187450262839e-01   +8.551971203716281e-01   +6.642188923482475e-01   +2.036407857577225e-01   +9.269570340945321e-02   +2.905315762971738e-01   -1.436960927077971e-01   -8.687418867107431e-02   +4.633316385645461e-01; +1.583276738086077e-01   +2.215369419050132e-01   +4.214779608252441e-01   +4.473645041822759e-01   +3.849913730696510e-01   +6.781833498629739e-01   +2.860238120768747e-01   +6.227293814673668e-01   -6.815930133075456e-03   +3.376679951923774e-01   -2.557278253419209e-02   +4.811444312081576e-01   +3.306894020555080e-01   +7.759626145224214e-01   +3.775162021749717e-01   +8.753373568321630e-02; +3.032393961393829e-01   +3.719663134169758e-01   +9.915257203681281e-02   +9.028048658334722e-02   +6.329184053675928e-01   +2.594298458705020e-01   +6.749639822101527e-01   +7.636506883544677e-01   +1.217301930512295e-01   +3.565952422197692e-01   +1.020772304853387e-01   +2.523825562593480e-01   +3.758663686397793e-01   +1.726172567594811e-02   +4.008375944632808e-01   +3.867843302253911e-02; +4.109094463350857e-01   +4.657800478433522e-03   +6.484566097876761e-01   +6.568997480651504e-01   +2.112879769653591e-01   +1.000000000000000e+00   +7.257710676675986e-01   +1.632402300458153e-01   +3.391848206138828e-01   +1.834079590353454e-01   +1.224077379164219e-01   +2.215127413148505e-01   -4.784632130459456e-02   +4.203751111660088e-01   +5.541401562017562e-01   +5.446455047007921e-01; +8.191472848836120e-02   +2.728009496770388e-01   +7.933954230595795e-02   +6.705170811750851e-01   +1.587774521029753e-01   +5.415288254878832e-01   +4.994000504444514e-01   +1.802324357836030e-01   +1.337410186068936e-01   -5.421782538747651e-02   +4.803485101272114e-01   +2.449778787149922e-01   +6.299760856623154e-01   +6.749064758125920e-01   +1.775273554452795e-01   +3.634950482844252e-01; +4.407211899991125e-01   +6.213629219152874e-01   +2.379211412757972e-01   +6.369094365941228e-01   +8.259037370866763e-01   +1.771475138404708e-01   +6.923908946380098e-01   +3.576754342346752e-02   +1.728264445985680e-01   +7.474171374204532e-01   +3.560485198604643e-01   +4.665039848463025e-01   +3.022480175561503e-01   +2.200122313515437e-01   +3.076530703632848e-01   +6.259096684836167e-01; +6.726579379003692e-01   +1.444111636780447e-01   +4.898306423399047e-02   +3.507853441762649e-01   +8.562367046123787e-01   +5.544422568955436e-01   +2.677990408256645e-01   +9.679058820123401e-02   -1.249313858205902e-01   +1.657347311954602e-02   +9.864866929622691e-01   +4.229910054271618e-01   +5.916904074568909e-01   +2.323573618158085e-01   +7.127519835054958e-01   +2.044786733463748e-01];
L2E_L1E_iAMPA_netcon = [+7.156842937496091e-01   +6.307956106737685e-01   -1.380705385322359e-01   +3.044621694067737e-01   +7.551567805103097e-01   +2.936833613692067e-01   +2.298414885485826e-01   +4.694601372684222e-01; -6.256411571009005e-02   +4.429544500754325e-01   -8.641826202929495e-02   +3.689023200113515e-02   +2.465519926556267e-01   +1.745892059014777e-02   +3.428133740230807e-01   +5.661725861146726e-01; +3.183733635587063e-01   +6.791442522313563e-01   +3.597824089293020e-01   +1.252966901707980e-01   -2.296057177263629e-01   +5.725775052548390e-01   +3.914789341098741e-01   +5.236918757609184e-01; +4.200360987578627e-01   +9.949469031900014e-02   +6.008269134412279e-02   +7.766183993036382e-01   +1.639122113474067e-01   +1.202343725651090e-01   +4.095629324662169e-01   +1.698481829892205e-01; +7.771640924690407e-02   +4.575222201142952e-01   +1.651427680188531e-01   +3.378350716730986e-01   +5.890719017735428e-01   +5.627418361246849e-01   +1.000000000000000e+00   +8.334830281252528e-01; +6.137625020575923e-01   +3.763560721634615e-03   +6.422958785454798e-01   +2.784207669979893e-03   +4.507752781287669e-01   +4.253499442514577e-01   +6.736490665476634e-01   +3.202740338612642e-01; +3.762052195929043e-01   +4.647773586276270e-01   +3.529809656025841e-02   +2.651601856060187e-01   -5.545283263185728e-02   +1.869487583241710e-01   +6.128298496496948e-01   -9.654144232625135e-02; +2.165375067079430e-01   +5.262494880634079e-01   +8.727751452674420e-01   +3.569420816460792e-01   +2.742936278585815e-01   +3.605845740656442e-01   +3.955511417700690e-01   +1.037295135411043e-01; +6.664953029779808e-01   +3.436994472941163e-01   +3.952431430259294e-02   +6.476291799304847e-01   +7.023749579673502e-02   +4.656319206225556e-01   +2.577792623474235e-01   +3.112678341481762e-01; +4.907970877181224e-01   +4.900652782695443e-01   +4.637509473938118e-01   +3.477322005231919e-01   +3.757380507059534e-01   +9.612600392427262e-02   +5.343952861787190e-01   +7.390866041203271e-01; +7.912130825391099e-02   +4.969873840587588e-01   +3.818635646888419e-01   +4.553806088143188e-01   +2.920970838728542e-01   +2.373481757087474e-01   -7.245996956695165e-02   +6.281182839098126e-01; +4.947839349741899e-02   +3.143915256377983e-01   +5.266640620658659e-01   +1.082602187598272e-01   +3.616198926167511e-01   +3.214648168310260e-01   -2.864184166815432e-01   +2.617259566637289e-01; +1.332646623177065e-01   +4.538841205992325e-01   -2.949153385523471e-02   +4.217729096629483e-01   +5.272229068995260e-01   +1.037817652854388e-02   +3.759880284408973e-01   -1.731700794985286e-01; +1.658992463896188e-01   +4.194136393463080e-01   +3.720315752568427e-01   +8.366618085824451e-01   +2.587243800167072e-01   +7.377787227452332e-02   +5.529797296701582e-01   +3.285181425619348e-01; +3.299194294103072e-01   +1.911575827879181e-01   +8.607724198562126e-01   +4.306458677021506e-01   +1.168704221435074e-01   +6.686611212829997e-01   +1.785451081715136e-01   +3.956821042147856e-01; +3.577311912359572e-01   +4.415351578237278e-02   +1.244813164521378e-01   +1.107434864078810e-01   +6.067102508245038e-01   +1.949504845830272e-01   +2.156516169696074e-01   +7.235109482722784e-01];
L1E_L2E_iAMPA_netcon = [+3.833821486679647e-01   +2.903499906306343e-01   +8.288971369846861e-03   +5.881631605147393e-01   +3.933882851610141e-01   +3.485474421324247e-01   +5.608699397235162e-01   +2.079716355569245e-01   +6.549821177672116e-01   +6.369914666922140e-01   +5.837179688111583e-01   +6.866406332231169e-01   +6.065746582154612e-01   +2.455647455810391e-01   -1.161874003476571e-01   +2.296869397418045e-01; +5.143108331615550e-01   -5.261924633982461e-02   +1.529385791074482e-01   +3.548193978280286e-01   +2.448925125930359e-01   -7.470493584509219e-02   +6.434867206813788e-02   +3.341098295846330e-01   +1.772077191968987e-01   +1.770721310345206e-01   +3.530446709263422e-01   +4.760325552975202e-01   +1.979836526620462e-01   +2.291932739916841e-01   +2.025296444661254e-01   +3.287946483687563e-01; +8.428611568104296e-01   +3.803743971615418e-01   +2.732329950474869e-03   -3.538571819475041e-02   +5.962743763416066e-01   +4.812179060552976e-01   +2.576404748078417e-01   +6.740662987209066e-01   +4.014868891287525e-01   +5.058988996940902e-01   +3.609260814759338e-01   +2.732508326478837e-01   +1.516380953888324e-01   +3.697731155103837e-01   +3.829099270287747e-01   -3.008262092167525e-04; +2.981713565058756e-01   +4.060997787947496e-01   +6.100622784409417e-01   -1.469968628132771e-01   +2.218497540867805e-01   +2.926621066650675e-01   +8.182360468559281e-01   +1.443030258243465e-01   +3.751279063488059e-01   +3.190982816434197e-01   +7.718942635704863e-01   +3.231762186578533e-01   +1.348412870442139e-01   +2.640713270382297e-01   +4.212773953333737e-01   -3.687053406294651e-02; +3.398357132373261e-01   +1.850459055158278e-01   +8.319005117148723e-01   +5.082987233248477e-01   +2.205947794613752e-01   +7.086108622137953e-01   +4.050685104598802e-01   +2.688293874657456e-01   +7.535289072001559e-01   +3.480477332048807e-01   +2.477513605105964e-01   +3.016515169722378e-02   +3.796962005099917e-01   +6.260541221195245e-01   +9.074773660265292e-01   +2.782591287032315e-01; +2.068172437805196e-01   +5.808124789344651e-01   +2.448375631499127e-01   +2.957715920054085e-01   +1.586821786537526e-01   +1.535912217493226e-02   +6.374272432637376e-01   +3.597306865882612e-01   +6.844939826698013e-01   +4.995695140213344e-01   +6.169513915611747e-01   +6.560388968441619e-02   +2.324423727510771e-01   -2.264123636321698e-01   +1.785181820616687e-02   +1.463797176695349e-01; +3.311513806984728e-02   +3.055552289574266e-02   +5.000381989716918e-01   +8.550527757823971e-01   +2.369846994829283e-01   +8.180639353487613e-02   +7.249480633175582e-01   +5.437545732435727e-01   -1.355880657632217e-01   +8.593284556057046e-02   +2.082273872566293e-01   +7.270839630228326e-02   -4.987415347309589e-02   +1.901171365655137e-01   +1.581200526156945e-01   +1.642961173754725e-01; +3.212803782465321e-01   +1.502066060032143e-01   +5.584396931909853e-01   +5.812542405104026e-01   +8.644211471014405e-01   +1.000000000000000e+00   +7.005421431459570e-01   +1.839555288003773e-01   -1.220815418489117e-01   +3.555027092469905e-01   +6.667838858207566e-01   +4.196021573165625e-01   +3.102038330132363e-01   -4.077741611627703e-02   +4.808212389580870e-01   +4.030034988794950e-01];
L2I_L2E_iAMPA_netcon = [+5.770225065809433e-01   +8.255465080575159e-01   +4.276554664268626e-01   +3.595364426261410e-01   +8.760840952538929e-02   +9.755294347250235e-01   +4.439921682602112e-01   +4.347290528947769e-01; +6.851933609841351e-01   +2.407940762302535e-01   +9.500542018380764e-01   +8.206707789065316e-01   +6.568569025217211e-01   +2.421064646029314e-01   +4.685342664622694e-01   +4.301105063296410e-01; +7.880683674972212e-01   +3.120094152404203e-01   +3.283115486407713e-01   -6.961494992681637e-02   +1.933257284531110e-01   +6.684895669199599e-01   +5.822804113975731e-01   +3.039399265949338e-01; +3.914417519080614e-01   +6.203194640851495e-01   +3.862298249660966e-01   +1.000000000000000e+00   +3.215331699895234e-01   +2.905840615199582e-01   +3.334730030633640e-01   +4.616043089492572e-01; +8.173327529855218e-01   +3.934105854062145e-01   +4.079350388754270e-01   +7.824153680293081e-01   +8.857108703282489e-01   +8.041448669610313e-01   +9.656989454408954e-01   +1.815231630317565e-01; +3.505058441108705e-01   +3.903072213237505e-01   +2.110601515531347e-01   +8.539328655592840e-01   +2.404894634913219e-01   +4.043919102309644e-01   +5.089821253917037e-01   +5.547575477216358e-01; +6.174202093532728e-01   +2.360765620584422e-01   +6.753344637631851e-02   +7.431628204950779e-01   +7.263008404624772e-01   +3.251722110331441e-01   +8.333975270522554e-01   +7.157537417010396e-02; +8.367635620528019e-01   +1.860141026091716e-01   -4.452084409404652e-02   +4.519140712589212e-01   +2.433433012570376e-01   +7.360562179983985e-01   -4.313628512555183e-01   +8.124285595613522e-01];
L2E_L2I_iGABA_netcon = [+2.032083683662780e-01   +3.805640554623286e-01   +3.338820124704245e-01   +2.864759741252498e-01   +2.025639771891337e-01   +5.644994750801672e-01   +2.741468630977858e-01   +6.740815444779571e-01; +5.431561244446756e-01   +8.269362393111913e-01   +4.450822073938007e-01   +4.786076065540147e-01   +5.712494241013296e-01   +4.618437435968737e-01   -1.099254444826317e-01   +4.332686692869758e-01; +1.729329637179062e-01   +9.765027297689906e-01   -1.037112872280717e-01   -4.087426305369649e-02   +5.773654709029250e-01   +9.572660880640761e-01   +3.182563433272770e-01   +7.314761784222084e-01; +1.439740185210631e-01   +8.125547225872951e-01   +7.262040156722909e-01   +6.179969435693606e-01   +9.739180192631545e-01   +5.202831139214903e-01   -7.980224709367435e-02   +1.512072668299881e-01; +1.580406808388338e-01   -2.579930521445859e-01   +2.504323243631980e-01   +8.048274261343626e-01   +6.037451071259408e-01   +2.317667081993265e-01   +3.548461605415557e-01   -7.816204987393141e-02; +3.923859075041197e-02   +4.140380165637307e-01   +3.636401037392468e-01   +1.501983800730396e-01   +5.526180591447991e-01   +1.235147767782237e-02   +6.601466503889455e-01   +1.783744080910747e-01; +9.542342305604323e-01   +2.000185475545143e-01   -4.856723562315217e-02   +5.010200582109514e-01   -3.149086810980127e-02   +8.404108966907503e-02   +6.044279013480658e-01   +6.711968471803840e-01; +4.177847403855515e-01   +7.651281251319558e-01   +6.611466798670140e-01   -3.094610830597671e-01   +7.583159153530865e-01   +6.659619793273680e-01   +5.852854135337239e-01   +5.194138500465431e-01];
L3E_L2E_iAMPA_netcon = [+1.938014075636221e-01   -1.024227505976861e-01   +1.368021037806824e-01   +6.419660555637099e-01   +3.338401368803534e-01   +2.351228942174711e-01   +4.894641755147734e-01   +5.943342475916775e-01   +5.009236139472077e-01   +3.630424334675766e-01   +1.333979862328320e-01   +5.847797772259737e-01; +3.449652744969234e-01   +8.251058633194475e-01   +1.819336119567527e-01   +2.869550745480111e-01   +9.874875219051006e-02   -1.746363559268245e-01   +3.734668337903642e-01   -9.049794653479629e-02   +5.679326037338895e-01   -8.064891452298566e-02   +4.714178960596060e-01   +3.407623409529086e-01; +1.635640307500164e-01   +2.419827949520601e-01   +6.571420295129998e-01   +4.839703800886000e-01   +7.854538976470736e-01   +5.367131385064786e-01   +7.165093161435403e-01   +4.195204042168875e-01   +7.311820612235830e-01   +2.261781160006401e-01   -3.960550595565615e-03   +6.848743932751471e-01; +2.645584196346512e-01   +4.420555730478851e-01   +4.965338628139473e-01   +2.258021416071289e-01   +3.190477544705224e-01   +3.308047143710275e-01   +1.924669191554784e-01   +4.321198696435483e-01   +3.604982801653531e-01   +5.150921733075048e-01   +5.487062318809331e-02   +1.426322383764736e-01; +5.750787221257386e-01   +3.806839682660632e-01   +1.039195614833449e-01   +8.590990018131177e-02   +6.639516699477256e-01   +5.354555073425927e-01   -3.808184008642778e-04   +2.996339257134209e-01   +5.070226303620335e-01   +3.745534259085210e-01   +7.184854014787549e-01   +7.812271980767276e-01; +4.466233567066688e-01   +6.726180333814876e-01   +5.517879630278822e-01   -1.343060503803479e-02   +5.574748801987750e-01   +8.388036040578339e-01   +2.448794004375512e-01   +1.021494388501957e-01   -5.146580442270126e-02   +4.442340701958231e-01   -3.309814267047514e-02   +3.051327956229083e-01; +1.701552191801074e-01   +5.236950105355082e-01   +7.011193536418019e-01   +1.812160127152453e-01   +1.343031178065673e-01   +6.718531081867271e-01   +4.016650083110114e-01   +4.661556592688735e-01   +4.729275506360651e-01   +3.484687581610120e-01   -9.674412534509293e-03   -2.355487479148868e-04; -2.242699370637134e-02   +3.504667748562323e-01   +1.364116477433753e-01   -1.039043130556087e-01   +3.070809775186489e-01   +8.419143151672349e-03   +3.338575382418560e-01   +2.183952230191349e-01   +1.000000000000000e+00   +6.358898635181821e-01   -6.417446768893803e-02   +2.799209056033508e-01];
L3I_L2I_iGABA_netcon = [+8.534545782825634e-01   +3.140798216543348e-01   +3.886807673736249e-01   +7.282227087740543e-01   -8.283452688258890e-02   +3.294275388704184e-01   +7.342277622624296e-01   +4.570375605226114e-01   +6.729425339054723e-01   +8.128721291338831e-02   +3.619772174079048e-01   +6.874761389028341e-01; +5.033701884303059e-01   +1.465999649668456e-01   +1.668724722586793e-01   +3.059735669315063e-01   +7.787204156505836e-01   +1.380864895101012e-01   +4.691411489083048e-01   -4.270364550217281e-02   +4.721465399894132e-01   +1.501745334564243e-01   +4.210102035311026e-01   -2.152521442139772e-01; +3.402196870682531e-01   +5.190018944812600e-01   +6.539977902333258e-01   +3.561023748367035e-01   -6.489806881731423e-02   -8.802766240852093e-02   +4.458558069430741e-01   +7.637393750251920e-01   +4.961918277496798e-02   +2.051518759701918e-01   +2.149150081048818e-01   +5.266524692372124e-01; +2.396429712937312e-01   +7.749836857193415e-01   +4.119373215822011e-01   +9.063844730976385e-03   +1.013838812549155e-01   +6.603907243440947e-01   +8.777587068471344e-02   +1.712491932988107e-01   +4.866419497237160e-01   +2.287101958438099e-01   +4.758262893504515e-01   +6.133377507854879e-01; +9.184600209761805e-02   +2.727113341995900e-01   +3.850495815429679e-01   +3.381574145686674e-01   +5.203055005223159e-01   +6.892317690763726e-01   +8.703396703092595e-02   +8.006282789488527e-01   +6.790426536162172e-01   +2.514088453120087e-01   +2.544609252873828e-01   +7.722433931408471e-01; -2.498066816004635e-01   +6.745259245238582e-01   +1.044782805317278e-01   +6.089902622373665e-01   +9.062521448814393e-01   -1.094705172133417e-01   +1.855327927370078e-01   +7.210542412898178e-01   +4.060583942188348e-01   +1.791811795124619e-01   +3.432442052435041e-01   +6.917541910952600e-01; +6.374110561067955e-01   +3.577265063743863e-01   +6.723497648201087e-01   +2.837677135733767e-01   +2.455976374176492e-01   +3.208661773653569e-01   +1.000000000000000e+00   +1.430838141556604e-01   -8.177005826079431e-02   +4.289786097656589e-01   +5.637059606792307e-01   +3.248886635655521e-01; -2.018536921965750e-01   +3.481416392375957e-01   +9.310532265214420e-01   +6.544150875043192e-01   -1.292339999247450e-01   +7.319617864345100e-01   +3.691943291569873e-01   +1.129615660568025e-01   +5.619492704638124e-01   +3.365700021273728e-01   +3.014964266469902e-01   +4.865335613623463e-01];
L2E_L3E_iAMPA_netcon = [+3.716653850275496e-01   -6.072379080684680e-02   +8.249368536022927e-03   +3.891341690018476e-01   +1.918067279244726e-01   -1.278404648602636e-01   +2.624112184312255e-01   -3.121316549889298e-01; +2.187206370901672e-01   +7.211676745466414e-01   +4.489499464962979e-01   +1.290099427266133e-01   +7.195210982939030e-01   +4.455064471991539e-01   -1.559991483435297e-01   -2.734521566608101e-01; +3.319528590485802e-01   +1.141897617194707e-02   +4.418282722306317e-01   +7.768098623636502e-01   +5.333513824496156e-01   +4.144076323929062e-01   -4.506612773932045e-02   +4.086275121474663e-01; +1.098273991230042e-01   +6.409443841369917e-01   +6.424691849476316e-01   +7.352559265640142e-01   +6.141225559122139e-01   +5.201310552743426e-01   +4.351692775344073e-02   -2.167717576441702e-02; +1.470692895484039e-01   +5.865658964325137e-01   +4.681534139217826e-01   +9.569847380331450e-01   +9.403712056451260e-01   +2.602548138947403e-01   +1.757740173070035e-01   +5.058295722362699e-01; +5.708825337830605e-01   +8.541178672568301e-01   +9.892452393982324e-01   +7.780088880235860e-01   +4.222096381064304e-01   +5.553575527221914e-01   +9.444932997240846e-01   +4.969507140184743e-01; -7.494356593204082e-02   +3.763482750700261e-01   +8.570770827507211e-01   +8.857761108369377e-01   +3.892699608249560e-01   +3.582642609406994e-01   +4.235087950281436e-01   +3.599258451105705e-01; +5.547341322786256e-01   +4.062705953214826e-01   +2.647279754188703e-01   +2.027367114122619e-01   +5.068863236074388e-01   +5.313393544364113e-01   +7.362708522651500e-01   +8.505839963701345e-01; +5.992119284873808e-01   +2.021843929897107e-01   +4.570361494790548e-01   +1.730399791887205e-01   +9.240594165530486e-02   +8.967588961694022e-02   +6.255452970926866e-01   +3.968725169260858e-01; -7.294491240838705e-02   +4.189343506450725e-01   +2.604224822090266e-01   +6.986947849014113e-01   +2.348927334293741e-01   +6.456149810009373e-02   +9.706244545651443e-01   +4.461931648163321e-01; +5.864374299720047e-01   +1.693919772053668e-02   -7.558903464795719e-02   +7.013727433356960e-01   +9.052409845365396e-01   +8.171070800877683e-01   -2.646549227937721e-02   +6.443658545309388e-01; -2.875151533553935e-01   +8.605690825546232e-01   +7.368830088550250e-01   +4.835097019168704e-01   -2.844164019512576e-01   +3.451922812513468e-02   +2.646395575496088e-01   +4.170640681720130e-01];
L2I_L3I_iGABA_netcon = [+1.672671839504387e-01   +6.205253720711413e-02   +8.928870881010524e-01   +8.252011087544964e-01   -7.839651952151504e-02   +3.331662796069018e-01   +3.457725938870518e-01   -3.905406136203816e-02; +1.117837792383483e-01   +3.598854854616158e-01   +2.159799543226655e-01   -5.348393894694675e-02   +2.937177826890753e-01   +1.953095194411670e-01   +2.736919141283993e-01   +2.125150637482743e-01; +7.067132067212429e-01   +4.381588225338049e-01   +3.278892531456682e-01   +3.320291312334318e-01   +5.520071083658521e-01   +9.279706757081752e-01   +1.894489657031315e-01   +4.592057518191086e-01; +3.651631983052828e-01   +3.614652957898559e-01   +6.005861157349464e-01   -1.773042447661820e-01   +5.365538345337674e-01   +4.768646236932835e-01   +4.096369989144480e-01   +6.229612552894958e-01; +9.618111810972344e-01   +8.278795593284193e-01   +2.321674490473186e-01   +2.501842770416022e-01   +4.788769005123834e-01   +5.891403266140285e-01   +3.464843125854317e-01   -2.544921671597383e-01; +4.460518267154606e-01   +3.860165824783701e-01   +9.275683355966140e-01   -2.969927278663351e-01   +1.396633501736461e-01   +5.108621798757451e-01   +4.601151660670356e-01   -1.028204827982681e-01; +6.488630661087271e-01   +6.176406785673711e-01   +3.242161998617623e-01   +8.997597668258199e-01   +2.525583450546449e-01   +4.596825647135410e-01   +7.169468901823939e-01   +3.649269746879963e-01; +7.460838412969675e-02   +3.827112928722836e-01   +2.403219103538535e-02   +1.483251317269917e-01   +6.705243677802218e-01   -1.307187820032805e-01   +1.919012864843055e-01   +4.618371067152355e-01; -2.488691897060973e-01   +4.229132495248265e-01   +5.574989859473514e-01   +9.326856815804740e-02   +1.222985459375385e-01   +5.354930425120066e-01   +5.608863879865621e-01   +3.724803977830859e-01; +5.595266173243385e-01   -3.693692913815755e-01   +2.998109319436712e-01   +3.506022119547780e-01   +5.355541096108219e-01   +7.165852392072075e-01   +1.393535617849133e-01   +3.638167607307843e-01; +3.124327108446178e-01   +3.465568707522919e-01   +2.014237722647483e-01   -9.707612474710746e-02   +5.592823820144806e-01   +6.196596859523938e-02   +1.932688141305559e-01   +1.000000000000000e+00; +1.409450815617011e-01   +5.187223638186135e-01   -1.049681691731252e-01   +2.752229837413347e-01   +9.840511638254295e-01   +3.783550265518910e-01   +2.380767304722275e-01   +2.447601343146426e-01];
L3I_L3E_iAMPA_netcon = [+6.756977529340668e-01   +6.086749496938808e-01   -9.942752805993192e-02   +7.813359238939813e-01   +1.338148839125576e-01   +4.578590196472059e-02   +2.208928514368061e-01   +1.909170500564180e-01   +2.982445668908474e-01   +4.563383933731762e-01   +2.465256646324589e-01   +5.277290961093521e-01; +5.191044415144868e-01   +6.940872909876903e-01   +5.904146372309124e-01   +4.051838206094571e-01   +1.000000000000000e+00   +4.111537446518865e-01   +1.152773168174498e-01   +7.331423629752643e-01   +9.011528365138863e-01   +1.068147821699566e-01   +2.330476364597836e-01   +3.158575384289952e-01; +5.408883073223417e-01   +7.447937591979688e-01   +9.452312446740598e-01   +5.377878459704879e-01   +7.091400256388043e-01   +6.244391324953238e-01   +5.822172540721444e-01   +1.561817233270758e-01   +4.906005051661574e-01   +7.101911113808531e-01   +2.173185199041986e-01   +9.170607457548006e-01; +5.227752708821768e-01   +5.415381679189958e-01   +1.428504857486711e-01   +1.873738446000336e-01   +5.778566061560112e-01   +4.593935352499497e-01   -1.222920698989327e-01   +1.313939383033083e-01   +2.798246965189879e-01   +4.083184463661562e-01   +4.401480230571482e-01   +2.757058264693184e-01; +4.667375782326961e-01   +3.230987640158157e-01   +7.680891286472509e-01   -4.430599578288457e-02   +4.656959327538959e-01   +2.839526585346392e-01   -1.211077033309972e-02   +4.590990952561440e-01   +6.560181297268475e-01   +7.135445554256196e-01   +7.481509581601257e-01   +1.383465517524249e-01; +2.728803433772293e-01   +6.614808327508066e-01   +4.780102608144596e-01   -2.693838067430707e-02   +1.148152034718442e-01   +2.129251021240122e-01   +5.015872619803051e-01   +3.259461280564389e-02   +3.022045044171059e-01   -8.410982395385730e-04   +5.156512942033297e-01   +2.665369309001223e-01; +6.935290256222753e-03   +2.658551234838327e-01   +4.952231880872594e-02   +8.015091350642996e-02   +3.022690429677798e-01   -1.615239873736388e-01   +4.773472747263566e-01   +1.918183596551760e-01   -6.958216702820202e-02   -4.929135463823200e-02   +6.228721765663968e-01   +3.322439245566121e-01; +9.052466088783624e-01   +5.599540711796633e-01   +4.665218826140194e-01   +5.087287101305245e-01   -1.640419447768739e-01   +4.901501914220288e-01   +2.729753027582015e-01   +6.440242725189551e-01   +1.345427573082518e-01   -1.524412309917058e-01   +2.072748588592223e-01   +5.259859242261011e-01; +1.807129243033193e-01   +8.517314539212334e-01   +8.902933049138229e-02   +7.214203485300233e-01   +4.847106327028134e-01   +3.694460000125157e-01   -1.689908440783148e-01   +5.127929543418015e-01   +5.209653667496202e-01   +7.253496851634574e-01   +4.126156906093518e-01   +8.326665460743486e-01; +7.994254640857513e-01   -4.577837871724980e-02   +7.115088322798151e-01   -5.270373175114493e-02   +7.336690887479052e-01   +1.004894064917669e-01   +6.901672710857200e-01   +1.507325911414553e-01   +4.023234380777190e-01   +1.076623101596765e-01   +7.676195954255342e-01   +2.463901660389631e-02; +1.097917103514294e-01   +3.337190366959764e-01   +4.393873427924754e-01   +4.422298300318570e-01   +7.858398496697945e-01   +3.522677417919399e-01   +4.805361343845910e-01   +8.173510235741716e-01   +9.433682951615795e-01   +4.133969396650645e-01   +5.739265289662023e-01   +9.934141993162523e-01; +5.417043031225678e-01   +3.238565585720046e-01   +2.523414694626586e-01   +3.096438112742820e-01   +1.849312305089152e-01   +1.587322253094038e-01   +3.326562679299048e-01   +1.985655054309423e-01   +8.382266047203046e-01   -1.992115793347488e-02   +6.458989798067530e-01   +3.477776960393190e-01];
L3E_L3I_iGABA_netcon = [-4.830099062331224e-02   +8.645587938024929e-01   +4.164594300718237e-01   +2.539580466568064e-01   +3.079678276950585e-01   -7.946006664450531e-02   -2.635055061106726e-02   +4.508575287481769e-01   +2.721290843870483e-02   +5.242639337856905e-01   +1.764105437086669e-01   +1.566730640944544e-01; +7.817346286622636e-01   +3.637911733783258e-01   +1.503730836156442e-01   +1.152372548967958e-01   +4.204213564057864e-01   +2.089637612277188e-01   +1.127671699092681e-01   +4.725630496456344e-01   +1.210215825217658e-01   +5.279533023758905e-02   +6.971472884243508e-02   +3.101984118036876e-01; +6.253005462570230e-01   -9.384993053261761e-02   -8.482854650477474e-03   +4.537443294927633e-01   +6.097726058104108e-01   +4.186500063611927e-01   +5.201578573045480e-01   +2.219147560350569e-01   -1.209499695034270e-01   +4.517487729977138e-01   -1.761370073269811e-01   -1.106812688272988e-01; +3.910325381701484e-01   +6.516648307490490e-01   +2.192786867209865e-01   +4.901015225899077e-01   +6.600604790319645e-01   +3.864477974872230e-01   +9.226347338167737e-02   +4.449536481127265e-01   +5.356456606970327e-01   +4.853745242412705e-01   +4.026790182325171e-01   +5.939027673217634e-01; +5.021264742529077e-01   +2.981876717302903e-01   +3.597543968750624e-01   +8.424519013120032e-01   +2.858335738441173e-01   +5.433191459588420e-01   -9.393001987163008e-02   +6.162563484332880e-01   +5.231029475501024e-01   +4.791947049173867e-01   +4.299662845012835e-01   +2.506192989103088e-01; +1.042103196671262e-01   +3.828300601102489e-01   -4.485490754171564e-02   -7.570530983106763e-02   +4.674937181687888e-01   +6.912391343153076e-01   +2.739558751698916e-01   +2.458198736358289e-01   +5.814576804751571e-01   +3.962559783019033e-01   +4.836864077141408e-01   +3.355670467356038e-01; +2.327014415510882e-01   +1.028901314120803e-01   +2.841213090253621e-01   +8.461305339835331e-01   +4.855397645928232e-01   +1.587476120723040e-01   +7.864187221890560e-01   +5.744090216436633e-01   +2.184234861804469e-01   +5.198219650544446e-01   +5.932060581532118e-01   +1.548232629795440e-03; +3.248853562574498e-01   +1.492446437607731e-01   +4.849957223308308e-01   +6.019810589451734e-01   +6.584997663957871e-01   +2.403181813938120e-01   +4.539913160896897e-01   +1.776960973905534e-01   +3.828185651575279e-01   +4.281418512902729e-01   +3.447971839115439e-01   +2.031577394035196e-01; +4.111991238828708e-01   +7.481119156962139e-01   +3.756671604799501e-01   +1.748358272602799e-01   +4.959494663879810e-01   +3.496641039967149e-01   +2.116744380073915e-01   +2.778740722496874e-01   +5.782855465291880e-01   +5.860811290436178e-01   +6.277644488500239e-01   +4.795736414395063e-01; -2.155344389951467e-02   -6.264956543777280e-03   +6.332729044251832e-01   +2.005967106638467e-01   -6.299187694326015e-03   +3.831374660672688e-01   +4.796946868866002e-01   +6.017675879368732e-01   +2.979650244531470e-01   +2.994346894908067e-01   +4.148137325185465e-01   +1.000000000000000e+00; +5.563003999787107e-01   +1.117493734956362e-01   +3.331916787276518e-01   +1.746944590719875e-01   +4.130777100996871e-01   +6.694537122491966e-02   +2.578823999849998e-01   +5.153864637837976e-01   +1.469483921040983e-01   +5.943329566480547e-01   +1.491385135131365e-01   +2.708662713790327e-01; +3.897913670056098e-01   +5.299995342805075e-01   +3.676369095572361e-02   +7.825017435815258e-01   +7.237065252931716e-01   +4.857042854315529e-01   +5.426533970048348e-01   +1.392482312218030e-01   +2.406380111475392e-02   +1.893378576873677e-01   +3.885892489830982e-01   +7.792688202603777e-02];
L2E_Input1_iAMPA_netcon = [+7.154790326567806e-01   +5.924569462125475e-01   +8.552864437448383e-01   +9.344150293996932e-01   +8.002328962565055e-01   +1.000000000000000e+00   +7.687288223941399e-01   +7.389669737284396e-01];
L2I_Input2_iAMPA_netcon = [+8.322548136424039e-01   +7.127338576036105e-01   +1.000000000000000e+00   +7.183931300450402e-01   +5.885338411681984e-01   +9.414802666978893e-01   +8.004856284808501e-01   +7.084919768276297e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
