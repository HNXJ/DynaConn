function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.135522039987005e-01   +9.494242574307726e-01   +7.025412646273386e-01   +1.647773821000369e-01   +9.208496357349295e-01   +2.126487167536165e-01   +7.403433478953395e-01   +3.038149345916807e-01   +5.367362058257279e-01   +8.367543425747935e-01   +9.721486473733606e-01   +9.717325404695889e-01   +6.975558741466592e-01   +3.683217466091122e-01   +2.964146760489817e-01   +3.837767607980123e-01; +3.513789260635706e-01   +8.293291154860534e-03   +1.400448112364375e-01   +1.679645626502312e-01   +7.750930948931989e-02   +8.111144928221966e-01   +7.990629108366938e-01   +7.532083195323044e-01   +7.937837682966594e-01   +1.907238324457884e-01   +4.761411283422061e-01   +6.625150719504371e-01   +3.660487314135690e-01   +2.743770372786464e-01   +6.881345114868826e-01   +9.592918795374912e-01; +2.011564603286815e-01   +4.781673945521465e-01   +8.220314421045223e-02   +7.103440102650261e-01   +3.174068307837783e-01   +3.832615659542419e-01   +6.594091821113889e-01   +9.537819766548455e-01   +4.869444660836914e-02   +9.259601616490807e-01   +8.721532151803452e-01   +1.994444022021735e-01   +5.448060520533984e-01   +7.225570664239221e-02   +7.777169991272245e-01   +8.113671369052744e-01; +2.444408560622960e-02   +4.915020156224098e-01   +4.283553278313443e-01   +8.380933363063334e-01   +6.344336191315904e-01   +8.626007825752763e-01   +4.409906342110492e-01   +5.506453636944776e-03   +4.609372344413949e-01   +4.205243386037632e-01   +9.436785530963141e-01   +8.992125102182005e-01   +5.152121828334232e-01   +1.553695512664362e-01   +7.150803809008015e-01   +8.957422359448751e-01; +7.675934475745638e-01   +5.156071723674645e-01   +9.014496664697831e-01   +8.135783767746946e-02   +9.067520590415072e-01   +3.219806727669702e-01   +5.779664765727730e-01   +4.042866343099337e-01   +9.412341396773695e-01   +3.001914243590975e-01   +2.405206056854735e-01   +4.808667994537429e-01   +7.678412701560746e-01   +3.636997870531256e-01   +2.735086187879921e-01   +6.664783552078547e-02; +5.708797770136000e-01   +2.863892929470561e-01   +7.206899768974820e-01   +8.372753491901611e-01   +7.976734746581795e-01   +3.820468194103289e-01   +5.163940662993904e-01   +1.572038061146961e-01   +4.744115880542737e-01   +3.565321869222573e-01   +9.180967673544312e-01   +6.665625353844545e-01   +7.478286152091988e-02   +7.129354125477542e-01   +1.755141162984201e-02   +9.032646376627519e-01; +5.809167448041521e-01   +5.628182090587005e-01   +6.848117490364996e-01   +5.504199902162509e-01   +6.475841502965043e-01   +6.454988996217480e-01   +7.280470770181892e-01   +8.287924398718505e-01   +7.778989317687094e-01   +9.758260512170810e-01   +6.326502355522722e-01   +5.294761340257471e-01   +5.883989038507217e-03   +5.415682246617434e-01   +1.916128664134125e-02   +6.744517708458201e-01; +3.847249896579205e-01   +5.166198373194653e-01   +2.070737443667876e-01   +9.666168204297161e-01   +4.401076535040160e-01   +3.910966531929791e-01   +2.197015885895436e-01   +2.877202327405843e-01   +1.085904307548293e-01   +5.361556835843910e-01   +2.887822928523978e-01   +7.039411632881594e-01   +4.054108401324995e-01   +2.331200348113622e-01   +9.308746452876032e-01   +3.469050282509158e-01; +5.534136141034401e-01   +6.738101946254151e-01   +5.273371216721872e-01   +6.717167461274016e-01   +7.502800867591166e-01   +7.267358053729024e-02   +9.996089464011140e-01   +9.802311114648640e-01   +5.184446464054933e-01   +7.940452196862843e-01   +8.496944800921136e-01   +7.163146743303550e-01   +6.628256888169439e-01   +4.711330804565220e-01   +9.350909353085847e-01   +8.442157167874355e-01; +1.864932142914023e-01   +6.179225319422391e-01   +8.245657476963284e-01   +3.372389659141231e-01   +8.318351920025968e-01   +1.583786405843386e-02   +6.232811921902323e-01   +6.220471254980828e-01   +6.392365221598427e-01   +7.991627119767700e-01   +1.623202455786936e-01   +2.959131281841549e-01   +3.709120627643662e-01   +7.176014558999683e-01   +3.754864503983025e-01   +1.981490175398674e-01; +1.178159437140735e-01   +5.663470620250568e-01   +1.837409003456445e-01   +2.170819741469776e-01   +3.486091646556524e-01   +8.732506666493454e-01   +9.898026126283533e-01   +7.492208595246636e-01   +5.779403697014814e-01   +1.395247990585411e-01   +8.268673422846080e-01   +1.131207164955642e-01   +3.965824687854586e-01   +5.198865221491467e-01   +1.045482640323552e-01   +8.446531411441529e-01; +5.307272878340456e-02   +5.093604179444636e-01   +5.155437639753385e-01   +5.706775822282417e-01   +1.508712711776652e-01   +1.604125911029929e-01   +4.933017130123841e-01   +8.845709614204845e-01   +8.398503774690455e-01   +4.546462195692239e-01   +2.183493335150299e-01   +3.302873062038280e-01   +1.348836171074080e-01   +5.145107206289095e-01   +7.237343042587561e-01   +4.273570852959808e-01; +9.371023405160678e-01   +6.682441735950398e-01   +3.562941830386391e-01   +6.113620082221475e-03   +5.044595808402060e-01   +9.219853970012993e-01   +5.260477923766523e-01   +3.347275350011631e-01   +1.173582038606537e-01   +4.552175754954877e-01   +2.723761111849991e-01   +4.626874597031747e-01   +3.397629640001281e-01   +3.913330062032716e-01   +4.549738461175913e-01   +5.570990202012177e-01; +7.437339618088671e-01   +6.414892565640201e-01   +6.540449126256900e-01   +5.932204079325153e-01   +4.132707755812845e-01   +5.660788376494640e-01   +8.561749421590358e-01   +9.312383367689284e-02   +5.144820313818949e-02   +9.573655910980315e-01   +9.170244520033238e-02   +7.145060973598785e-01   +1.226377298657937e-01   +4.844721825734446e-01   +1.472160594425473e-02   +4.443968266473179e-01; +2.390527229908469e-01   +1.423548534805307e-01   +2.803998873467286e-01   +8.966703499405185e-01   +1.754754575296030e-01   +9.227168140448169e-01   +2.558995727711754e-01   +4.475354385415587e-01   +5.208657489937641e-01   +4.942703999246632e-02   +9.150210091197635e-01   +3.989702659017438e-01   +3.713669680392208e-01   +7.416502299454700e-01   +1.156301789411199e-01   +7.615255965354132e-01; +2.026363748533158e-01   +1.815579413741358e-01   +4.343646159191442e-01   +2.608533325250350e-01   +4.941861154007137e-01   +5.944260278964839e-01   +5.783850089649221e-01   +2.368522087597847e-01   +7.023410662516736e-01   +3.997123748043159e-02   +7.305055030390105e-01   +2.389550031582754e-01   +2.482956056852237e-01   +7.061639785528609e-01   +6.628908798598083e-01   +9.525485077042174e-02];
L1E_L1I_iGABA_netcon = [+8.390289292601822e-01   +7.472539454323149e-01   +8.731312944925663e-01   +4.364566014790552e-01   +9.218374804887692e-01   +7.703974657472669e-01   +3.227010074714007e-01   +6.439268964794951e-01   +9.485416813343897e-02   +2.764666933835372e-02   +1.281304599999115e-01   +5.187012993302271e-01   +8.770636221535547e-01   +5.733886766474302e-01   +1.701208318563310e-01   +6.329625109782243e-01; +6.169225926810057e-01   +9.948149748932811e-01   +3.129504162479987e-01   +1.449250570767437e-01   +8.878166805470131e-01   +2.741867328358967e-01   +9.637330280853772e-01   +4.362417146885848e-01   +2.961863127512547e-01   +5.122470305430388e-01   +4.322570192397329e-01   +2.054710927553432e-01   +8.048020890679355e-01   +2.937495716055882e-01   +5.458926714253987e-02   +3.404471564101459e-01; +6.643306509679744e-01   +3.725168920692907e-01   +4.325740532430973e-01   +6.518373623048797e-01   +5.913325263793928e-01   +5.234597387749296e-01   +3.514148132895298e-01   +4.824213797485022e-01   +3.289544623410755e-01   +8.670034266811937e-01   +4.809077111774465e-01   +7.695127202690732e-01   +6.450614074826019e-01   +1.405375105549445e-01   +2.187856341567844e-01   +1.537412016790629e-01; +7.793671730969456e-01   +5.093532804194001e-01   +3.781026632795053e-01   +7.249379720860023e-01   +8.347917043858312e-01   +4.109882204889460e-01   +3.172448790714859e-01   +9.701518814350200e-02   +4.751611267346301e-01   +5.800016030097229e-01   +6.736567998937020e-01   +3.890895361714374e-01   +7.364877636962269e-01   +4.328410684708191e-02   +2.057535372906862e-01   +4.004178597145370e-01; +3.151409630217462e-01   +7.541930019197246e-01   +6.526175685193858e-01   +1.705929915014444e-01   +7.821101510944338e-01   +7.838512144557667e-01   +9.114934297912793e-01   +8.033076067681059e-01   +2.384515222474863e-01   +4.262857245899092e-01   +3.537032095836533e-01   +7.002600168349951e-02   +6.626478746780635e-01   +6.242507539276638e-01   +2.151374323696104e-01   +9.140188923767054e-01; +3.261367188817554e-01   +1.336510639808522e-01   +2.480465917847004e-01   +3.401495833668938e-01   +7.870735962031062e-01   +2.726053302608375e-02   +8.834830215030594e-01   +6.165670897705854e-02   +4.562201588612160e-01   +7.186920613436488e-01   +4.307306417321457e-02   +7.503815674535772e-01   +8.849598687292738e-01   +6.068454698662445e-01   +5.797659054778261e-01   +1.551448917067463e-01; +6.303656266711248e-01   +5.189536091619465e-01   +6.881245822049421e-01   +1.020736123793615e-01   +6.984098091556680e-01   +4.117043545068776e-01   +3.602214841267359e-01   +9.578452425720394e-01   +7.554119956479955e-01   +2.308707819967419e-01   +2.913756780119554e-01   +4.557415389237116e-01   +8.516181122682716e-01   +3.702631895438859e-01   +3.757245300674610e-02   +4.697796212880790e-01; +9.016562606871380e-01   +9.087732219480406e-01   +3.293603478688565e-01   +4.628041308389765e-02   +2.000272223308079e-02   +8.277887262380396e-01   +7.389897548010163e-01   +7.718905581855341e-01   +7.166287598180402e-01   +5.796160795763663e-02   +8.000330442234853e-01   +3.160480817519281e-01   +4.061298036202560e-01   +8.330520384438048e-01   +7.979477938236184e-01   +8.189379458474118e-02; +3.696732496672253e-01   +1.012534608535704e-01   +8.721262315342303e-01   +4.742722938418828e-01   +3.236710665094902e-01   +5.927275090493090e-01   +1.256599040347720e-01   +4.474172271146208e-01   +2.338884685475162e-01   +9.744462526206858e-01   +6.500616492750130e-01   +2.754963504811763e-01   +1.096297609665522e-01   +5.185505452309179e-01   +1.365786961259376e-01   +3.363886730364951e-01; +8.835787011882864e-01   +1.815766381539635e-01   +9.986064173030523e-01   +4.779402740444411e-01   +9.454522136979916e-01   +2.107997717577450e-01   +5.906330684421081e-01   +1.669055271131035e-01   +7.036549465523625e-01   +9.687677790713076e-01   +7.110277107437962e-01   +5.747278549562979e-01   +4.070847634283792e-01   +8.121484223948905e-01   +5.787878015211002e-01   +4.905249067537525e-01; +1.177306993090902e-01   +1.800390818451147e-01   +6.890259735808925e-01   +5.515919812066087e-01   +4.061380329766619e-01   +2.911713568632542e-01   +4.393359018505767e-01   +8.127602242189604e-02   +3.036779481204139e-01   +1.297631790903021e-01   +7.578454420885451e-01   +9.118100977876424e-01   +3.364029827821369e-01   +5.769530544868434e-01   +8.317754550538184e-02   +5.012706163492235e-01; +9.269269459345397e-02   +5.371506367817699e-01   +3.459626454303392e-01   +6.465495234686974e-01   +6.263284256171551e-01   +2.683815986439648e-01   +9.645819843933365e-01   +7.429154940997420e-01   +4.683469746448310e-01   +3.131571200397854e-03   +3.887271775743484e-01   +4.488527512140424e-01   +1.095914446763594e-01   +7.126883844610105e-01   +2.271114757857222e-01   +1.317310351556721e-01; +5.449489576002706e-01   +9.751910257192445e-01   +5.600535980320557e-01   +3.482529973331571e-01   +8.507221192341788e-01   +9.337646248787841e-01   +9.731873719840418e-01   +5.345191489608839e-01   +4.394400675302438e-01   +9.326596510865702e-01   +3.647739358087914e-01   +9.816500672987910e-01   +8.589298226239979e-01   +7.323223956122209e-01   +4.451158347795255e-01   +7.692503412283001e-02; +6.015027807207923e-01   +8.417949374745773e-01   +8.929721563390355e-01   +2.525396696052692e-01   +3.663486557995461e-01   +5.538447744630722e-01   +2.479938882675119e-01   +4.862303516095277e-01   +7.289392474965589e-01   +7.402306674734094e-01   +8.127160976487542e-01   +1.030922474247662e-01   +8.978318663060831e-01   +4.458432359971346e-01   +1.773651574552584e-01   +6.764681243631799e-01; +7.228393987060390e-01   +6.683626646280802e-01   +6.481577540719228e-01   +1.803292106763049e-01   +2.038065628372314e-01   +4.294028993017776e-01   +7.742642635494411e-01   +8.854521464141729e-01   +8.757241056816093e-01   +4.292246304979998e-01   +3.882347879465247e-01   +4.183391128800242e-01   +6.913814495161881e-01   +2.793329816147979e-01   +4.140605959104472e-01   +1.192580067352346e-01; +9.938269786461377e-01   +1.274266413493370e-02   +3.801839863540123e-01   +4.759503314852777e-01   +9.092473684224296e-01   +3.260282197086980e-01   +7.094740379946374e-01   +5.890056150895644e-01   +9.115498950680484e-01   +9.439866810558787e-01   +8.686795856198497e-01   +3.879201014065136e-01   +7.473389132479776e-01   +1.553804439787926e-01   +9.639038744978178e-01   +9.878405594912568e-01];
L2I_L1I_iGABA_netcon = [+5.707348398128479e-01   +5.648031684576170e-01   +1.072840886870624e-01   +4.539091605668704e-01   +7.999265355389991e-01   +9.766000297282659e-01   +2.228619616925948e-01   +7.598372514039723e-01; +5.648131284398581e-01   +9.519212800539012e-01   +1.295698703435387e-01   +5.677900678774602e-01   +5.448922684650451e-01   +4.237424692302414e-01   +6.462593582528015e-02   +4.977494105218900e-01; +6.055500740754710e-01   +1.263644172076045e-02   +4.360309716459440e-01   +8.199759859505874e-01   +2.578358825442497e-01   +3.904914991298312e-01   +8.270018167819760e-01   +8.269989539691517e-01; +4.655870833483922e-01   +1.233489288864459e-01   +9.281792403304576e-01   +3.597439078068255e-01   +7.783662592480778e-01   +4.597107119361606e-01   +4.190144376158561e-02   +9.200181109938126e-01; +4.366553640857729e-01   +8.559061766480022e-01   +1.378686505685741e-01   +2.429992369289366e-01   +7.787456571604136e-01   +1.292334887440336e-01   +9.104501676259723e-01   +7.100139644248035e-01; +6.783052049858705e-02   +2.201442780096103e-01   +8.204773952190174e-01   +7.643988008220551e-01   +1.454320332757209e-01   +4.625391266167423e-01   +4.530872554949004e-01   +8.032069517697116e-01; +6.404851870907305e-01   +7.033825484188480e-01   +9.320575478379315e-01   +2.159975344140331e-03   +8.267922631550302e-01   +2.661099498043227e-01   +2.813665498411363e-01   +9.586929315373803e-01; +4.238870006023245e-01   +7.783541131128406e-01   +5.733590963050558e-01   +2.791270056112909e-01   +6.235195189242115e-01   +1.044884434140833e-01   +7.545642425548285e-01   +9.503452148041476e-01; +7.529366598804856e-01   +4.248067389050020e-01   +4.984403605570781e-01   +3.224565369240651e-02   +4.632120309777280e-01   +6.580794297986433e-01   +9.264345867532823e-01   +2.963473204792348e-01; +3.050331325728603e-01   +7.311383540819165e-01   +9.283656856561140e-01   +6.676749328067804e-01   +4.863238997013025e-01   +9.424566857848206e-01   +1.405048656641184e-01   +3.541570747746327e-01; +6.000369478198645e-01   +4.523254940578609e-01   +8.654898002379272e-01   +9.731407246783842e-01   +2.210147783579009e-01   +7.660342567137718e-01   +9.437607716724932e-01   +5.456786322278584e-01; +3.300552158582220e-01   +8.029415059380466e-01   +2.536686598767312e-01   +9.461240859334465e-01   +8.526259556022920e-01   +4.072391458117113e-02   +3.153201197687235e-01   +2.131605763140575e-01; +6.452524515490105e-01   +4.291943125126029e-01   +4.568500316506441e-01   +4.721576985476880e-02   +8.774981886149530e-01   +2.615113187779262e-01   +2.086601960995454e-01   +8.010585214158081e-02; +4.536984108563877e-03   +1.507573549460693e-01   +7.386211257819923e-01   +2.887897547066267e-01   +8.385931121858409e-01   +6.406855547379258e-01   +4.612827075470165e-01   +5.111735386757721e-01; +1.489174935203902e-01   +8.026692024148807e-01   +7.529442967978501e-01   +4.805080169115652e-01   +4.418808288630169e-01   +8.816829342088822e-02   +5.954610554083578e-01   +1.974742647734395e-01; +2.469931247521696e-01   +3.735377195410444e-01   +2.370986105230734e-01   +8.864713784441430e-01   +5.432310401472517e-01   +7.293876554033307e-02   +5.479718404598410e-01   +1.438405981969513e-01];
L1I_L2I_iGABA_netcon = [+7.108812506819434e-01   +8.696801143886169e-01   +6.152811394413841e-01   +4.896042007613536e-02   +1.457495515079486e-01   +2.336952452733700e-01   +8.402451604995246e-01   +3.675903637178243e-01   +7.103663787272628e-01   +3.900969128131549e-01   +2.438054948732924e-01   +6.736204381809126e-01   +1.607675119781982e-01   +5.707354875091223e-01   +4.460495675284095e-02   +4.575504007049425e-02; +6.059328109351889e-01   +8.010412847210446e-01   +6.175810931030781e-01   +5.257749829079303e-02   +7.450725175737632e-01   +5.520951627184426e-01   +1.995823224357532e-01   +5.599273985704478e-01   +1.895458225227354e-01   +7.261854094521292e-01   +5.071962921404833e-01   +3.368654583313569e-01   +1.067833405526362e-01   +8.133935994496539e-01   +4.353386180910158e-01   +9.210001096864033e-01; +1.611086099208842e-01   +6.202838363715046e-01   +3.079161932528278e-01   +5.986416424852420e-01   +9.510119698389152e-01   +1.119062040944459e-01   +6.150560726107054e-01   +8.356439148175755e-01   +2.313646108395683e-01   +6.330684459302094e-01   +7.338209759792543e-01   +5.481323532961099e-01   +7.436200472139731e-01   +6.753588512270160e-01   +9.252160777862669e-01   +1.758369634593788e-01; +4.795236268600278e-01   +4.775527165444660e-01   +1.320392860121346e-01   +6.593584403337517e-01   +2.631039185410139e-01   +8.225264823299370e-01   +1.578416508077750e-01   +7.156411289442266e-01   +1.000000000000000e+00   +9.796538051107578e-02   +7.810161064636618e-01   +5.345726765552639e-01   +2.179416231310827e-01   +4.405418619511803e-01   +8.852452593723512e-01   +7.450346752275633e-01; +2.897386351968382e-01   +2.064978310158887e-02   +6.005156870182298e-01   +4.864208761020389e-01   +9.222542349085576e-02   +6.576224279808283e-01   +5.864909351087298e-01   +1.162588553757613e-01   +9.020222685282194e-01   +4.955884968212898e-01   +6.833530050989917e-01   +9.068460114577619e-01   +4.855559595557576e-01   +8.881832893375496e-01   +9.657564906666712e-02   +4.703888066043420e-01; +4.042060125490511e-01   +1.206605402437970e-01   +8.927381216822217e-01   +9.793143860921197e-01   +2.311011720185016e-01   +2.336942249037063e-01   +5.425929156517791e-01   +7.413457264055504e-01   +1.291592347917806e-02   +5.542583633628845e-01   +8.142888769118104e-01   +2.859061959380869e-01   +4.823495729073445e-02   +7.876703618483347e-01   +6.851139344098326e-01   +2.518868802378403e-01; +4.883336128138155e-01   +7.222900264954976e-01   +5.657196553098179e-01   +8.665213265494557e-01   +8.892175429963926e-01   +3.040779118763685e-01   +6.882681090878571e-01   +9.222924498926038e-01   +8.339231488784558e-01   +5.351821942880291e-02   +4.227753331182952e-01   +1.371349129774085e-01   +5.790364718582311e-01   +5.876422252801232e-01   +1.275076150188889e-02   +6.658568163001251e-01; +8.643610427073607e-01   +6.696566398776798e-01   +6.342007861672292e-01   +9.579779697023396e-01   +2.003380421448275e-01   +3.241115034863890e-01   +6.984478588221741e-01   +9.204195616649397e-01   +2.511331146406962e-01   +8.047601283318653e-02   +4.940297197542686e-01   +9.534790173485145e-01   +4.958402796895167e-01   +6.201910229045547e-01   +1.265191855361243e-01   +6.086774467848717e-01];
L2E_L1E_iAMPA_netcon = [+3.726960130705105e-01   +5.621657953500142e-01   +2.043208192603000e-01   +5.187233806804004e-01   +2.944295581008746e-01   +6.892003798759076e-02   +2.811564437059486e-01   +2.644300116633917e-01; +4.342675721547447e-01   +1.876492792438722e-01   +1.399203846662684e-01   +6.827941641490609e-01   +6.180096877428238e-01   +5.910093388385185e-01   +9.303232177408663e-01   +8.988673871931689e-01; +7.172816467747893e-01   +6.062719100516255e-01   +8.064485945604219e-02   +2.090945797772680e-01   +8.704730328189814e-01   +7.784441888400340e-02   +7.608801589778506e-01   +1.562806356802939e-01; +1.959425173425446e-01   +7.321678757887357e-01   +9.261048294547791e-02   +9.723555304272083e-01   +8.158340564916952e-01   +3.968980839753419e-01   +2.605359053825134e-01   +5.517649065234012e-01; +4.627358961423968e-02   +8.359780213171014e-01   +5.519802424187740e-01   +3.490401352687627e-01   +2.100775890316365e-01   +5.382363848239568e-02   +2.453834562789458e-01   +4.232673176261744e-01; +3.124569650346016e-01   +2.742368394991591e-01   +7.305731134161287e-01   +1.824264467289020e-01   +7.479921702226920e-01   +1.255023167005436e-01   +1.627705961302159e-01   +5.472806291082449e-01; +7.937917653000345e-01   +6.071172201230224e-01   +5.473130177054472e-01   +2.448547990723748e-01   +2.000561928000486e-01   +2.423978974480859e-01   +2.902500318959605e-01   +7.457384977460998e-01; +4.010224149023237e-02   +5.491193673093238e-01   +4.883467993346800e-02   +2.572813007884970e-01   +5.808789389496137e-01   +9.405868296840287e-01   +5.647144371718612e-01   +1.319303192918154e-02; +2.153268778925366e-01   +2.772185617989694e-01   +6.357810885039578e-01   +2.193329667883676e-01   +8.772205951356276e-01   +2.084054493865027e-01   +3.989416374940257e-01   +5.904147523748175e-04; +2.697249766095500e-01   +3.376636432176179e-01   +9.918903294155845e-01   +3.822652113647824e-02   +7.167016320124436e-01   +3.289302951510683e-01   +9.852624580719266e-01   +1.854548433589443e-02; +7.930240802707782e-01   +5.706086171282689e-01   +9.124829469910835e-01   +3.531099806766453e-01   +6.977968047872952e-01   +8.659385615635853e-01   +5.463764861702165e-01   +3.523737506180204e-01; +9.843146494545714e-01   +7.432759280833053e-01   +7.720770297466704e-01   +8.966508933283706e-01   +4.608683746559067e-01   +9.203001921725550e-01   +9.339110620011304e-01   +4.294060375933038e-01; +9.625427653058609e-02   +7.646183161349587e-01   +1.958472936567920e-01   +1.361000051434708e-01   +5.053994553610720e-01   +1.924034638242153e-02   +9.863733376735232e-01   +5.439684816281921e-01; +2.008639028535331e-01   +4.028745921453771e-01   +2.888009711216713e-02   +9.518962949463343e-01   +7.993933821251034e-01   +3.606077741948355e-01   +8.329934907196397e-01   +4.826556429263261e-01; +1.183772018443157e-01   +1.553698007086014e-01   +3.773474997459546e-01   +9.087020454833062e-01   +9.345203430205802e-01   +5.310215431365604e-01   +1.809948899191174e-01   +9.166526502431220e-01; +6.404503499151122e-01   +2.067039089143565e-01   +5.776531931993821e-01   +4.111423853136715e-01   +7.928859682141965e-01   +4.064921677729157e-01   +3.117285694080054e-01   +4.162222473952985e-01];
L1E_L2E_iAMPA_netcon = [+4.957936273407471e-01   +4.550841881428946e-01   +6.145916902570100e-01   +4.928151927003362e-01   +2.329293737336036e-01   +7.157256206307401e-01   +6.877538426216876e-01   +6.361904410318568e-01   +5.217286458918002e-01   +2.403169846961009e-01   +8.718094366918916e-01   +1.764150360795945e-01   +1.366114484631762e-01   +2.469225036360122e-01   +1.820424980979951e-01   +3.103939481760094e-02; +8.340166448962297e-01   +3.634137220839901e-01   +1.045685467793097e-01   +6.642857255728134e-01   +8.373010624863424e-01   +3.813513473718332e-01   +9.738775490436798e-01   +6.238847108547146e-01   +6.719268974210247e-01   +7.290269890491806e-01   +6.637417406456717e-01   +2.983127581143607e-01   +2.867623490852266e-01   +7.463737705567588e-01   +1.514267676361995e-01   +2.504907974015520e-01; +1.847764829240516e-01   +2.962563006954226e-01   +7.571165532819873e-01   +1.808153503719896e-01   +7.337904514237998e-01   +3.788839130081121e-01   +7.565660906200347e-01   +4.105172016945869e-01   +7.725231957504545e-01   +1.282835954566674e-01   +5.441514986744301e-01   +1.067888272755676e-01   +4.257592647224490e-03   +9.317108313510597e-01   +1.349445196582649e-01   +9.905692919125135e-01; +3.385996800664812e-01   +2.391701295890849e-01   +5.408511061014343e-01   +4.769413664190801e-01   +4.879298156437267e-01   +7.177545115879865e-01   +5.546794507197074e-01   +4.319322462927514e-01   +4.644997434494615e-01   +4.194958534342932e-02   +2.467941530639159e-01   +4.519297796699343e-01   +3.085841803796450e-01   +3.181800777788530e-02   +1.652332643870656e-01   +6.311446310152660e-01; +6.924261625531565e-01   +1.346782577374765e-01   +4.468385786943246e-01   +5.013796839348310e-01   +8.513341461888866e-01   +8.306085838792098e-01   +2.795356801606200e-02   +5.125145513029994e-01   +9.053412604535199e-01   +6.520712338484524e-01   +1.107654922937051e-01   +5.855216639781069e-01   +9.077597376116985e-01   +4.307609988710700e-01   +9.212645063834271e-01   +3.609907175573164e-01; +6.925053944462490e-01   +1.000269880147642e-01   +7.421770428338603e-01   +6.034561525937129e-01   +7.208313341069735e-01   +6.692510135137140e-01   +1.905501236308121e-01   +2.594753123935316e-01   +2.238704922726764e-02   +1.990495663258161e-01   +9.705363025468033e-01   +2.208532858532259e-01   +2.948747620381019e-01   +8.274177052563858e-01   +2.614501814713554e-01   +9.894335435109605e-02; +3.677344306963182e-01   +2.335425751718480e-01   +3.895023695722984e-01   +2.455492467580110e-01   +5.220926076954194e-01   +6.481009594692935e-01   +9.365131204227929e-01   +4.217831365386781e-01   +4.833104535237793e-01   +9.721112317132037e-01   +5.882426395656875e-01   +1.066747487757564e-01   +8.268074707543055e-01   +9.965548408874616e-01   +2.059045509071291e-01   +4.154834823078683e-01; +3.261821481805049e-02   +3.499723541396825e-01   +5.332612268790548e-01   +5.205914793041821e-01   +9.399634045062432e-01   +5.606761134873186e-01   +3.932293570789325e-01   +5.231819624565699e-01   +2.729971148349994e-01   +8.235623998289016e-01   +8.182034416668951e-01   +5.629782169187184e-01   +7.400811510740012e-01   +9.217899164666026e-01   +6.169484509969619e-01   +9.262356453440566e-01];
L2I_L2E_iAMPA_netcon = [+6.770137839048334e-01   +6.126205393073847e-01   +4.156875385606859e-02   +7.995784373727354e-01   +5.212898950563878e-01   +8.226897213936878e-01   +6.468966003429796e-01   +3.884646748288487e-01; +2.218182060865388e-02   +9.434052300112162e-01   +5.301063002829824e-02   +9.333381773670194e-01   +6.753874492892789e-02   +1.106756720920253e-01   +3.467423099642018e-02   +1.701726737232968e-01; +7.360124089930925e-01   +9.627386825551717e-01   +4.076863637725526e-01   +9.414145358807251e-01   +2.870811762418701e-01   +2.488453543895906e-02   +5.642516381221937e-01   +4.453084723730097e-01; +2.183412023260725e-01   +3.642799607216054e-01   +9.775945818288784e-01   +1.438796869625606e-01   +7.165658916094015e-01   +7.510386367064649e-03   +3.075222268328314e-01   +8.786505797566625e-01; +8.541224652066528e-01   +8.001919437958817e-01   +7.117703763397937e-01   +3.240867606735961e-01   +8.883628893965829e-01   +3.374303132703467e-01   +2.626732883546309e-01   +4.056305676429164e-01; +1.584972646602566e-01   +7.222298433797575e-01   +9.893056019378210e-01   +4.275481418501327e-01   +3.628473028236878e-01   +6.660969474810705e-01   +7.194456150712601e-01   +1.648477355997288e-01; +6.702359342723455e-01   +9.499828796894496e-01   +6.445388380017689e-01   +7.081499637962225e-01   +5.654459185124509e-01   +5.899860681546542e-01   +3.076295760087763e-01   +6.651439807824189e-01; +9.326918817794966e-01   +1.302445078411233e-02   +5.011676466915955e-01   +6.191361790350273e-01   +8.828556747924788e-01   +7.741620241045015e-02   +9.027826122221163e-01   +9.304324727282456e-01];
L2E_L2I_iGABA_netcon = [+6.091921686796668e-02   +5.227705312381242e-01   +3.484126233245541e-01   +2.582377579851308e-01   +4.489986947144343e-02   +9.021690069136712e-01   +3.433628125536042e-01   +4.538716110820792e-01; +3.521052785975336e-01   +6.409362883337678e-02   +5.574001735661995e-01   +9.840865127359436e-01   +3.632762523233504e-01   +5.506937248609793e-01   +9.342051762783450e-01   +6.723134618217584e-01; +9.305619600897133e-01   +1.842364123846972e-01   +6.910389886093355e-01   +3.484649402402311e-01   +3.927894941571981e-02   +7.108995592244782e-01   +9.120587560616451e-01   +7.710891649959962e-01; +2.392394428570598e-01   +3.145441503043871e-01   +4.238395653878436e-03   +3.923400404795739e-01   +4.910346570304306e-01   +7.150996968061762e-01   +7.272150425594374e-01   +9.248769587640654e-01; +1.085249993219824e-01   +2.466961808213169e-01   +4.809543766661227e-02   +7.528144960546441e-01   +7.267179251326369e-01   +1.729939723495862e-01   +4.432902733437774e-01   +6.520057170671543e-01; +7.084785810339272e-01   +3.221418369218252e-01   +3.043737532332050e-01   +1.094590627471315e-01   +1.680513929610524e-02   +3.534701408107059e-01   +1.471299848709776e-01   +5.026068411540419e-01; +4.918384151629608e-03   +8.721707372494103e-01   +8.723308328610535e-01   +5.972703691291864e-01   +5.098701439073441e-01   +3.782811410045834e-01   +8.304434192736627e-01   +3.434637145123592e-01; +1.783775977086307e-01   +3.049136432204071e-01   +6.253129425684182e-01   +1.211896438988188e-01   +2.452966633181505e-01   +7.578005803425922e-01   +2.503945468909405e-01   +9.434685533216831e-01];
L3E_L2E_iAMPA_netcon = [+7.725669925463154e-02   +1.693186518022043e-02   +3.698650070163214e-01   +4.943195443296776e-01   +2.263895928562526e-02   +9.624480991730071e-01   +3.559996674084691e-01   +2.305067881556693e-02   +2.065677511818240e-01   +7.108763879038818e-02   +2.406884728915530e-01   +9.994558093026632e-01; +9.511721124207733e-01   +9.797443503969038e-01   +1.194815332423284e-01   +6.546545442166672e-02   +8.087535399236190e-01   +3.913734348021896e-01   +2.268850028131426e-01   +1.291821265849014e-01   +3.532498765480949e-01   +7.468936083961484e-01   +5.377329920667205e-01   +3.415705325958449e-01; +6.639591245457357e-01   +7.194059677635327e-01   +5.128175069990945e-01   +8.724289055029211e-01   +7.983583874816683e-01   +6.646281234771803e-01   +7.250685796919529e-01   +6.658438575997241e-01   +8.893227400424264e-01   +9.916426364134903e-01   +3.363825741270706e-01   +8.292090214160620e-01; +1.675438969674593e-01   +8.769378948176404e-01   +7.019601250888503e-03   +9.977371838162024e-01   +4.165288345634623e-01   +5.814596644404609e-01   +7.710969054520508e-01   +5.075289389000164e-01   +8.194771107807107e-01   +7.697187250459174e-01   +6.722533740712532e-01   +1.096160402658019e-01; +1.977354558436951e-01   +8.175022514158047e-01   +8.700364686902492e-01   +1.182651011512793e-01   +6.341217479069534e-01   +5.249786678993475e-02   +3.387750770326809e-01   +7.507423811392738e-02   +3.165672256299448e-01   +8.890479087029065e-01   +8.793526825840421e-01   +7.813638987457449e-01; +9.905124668783925e-01   +3.671146726489365e-02   +9.057915415367550e-01   +1.059424670251984e-01   +5.674146623622300e-01   +7.388455395377437e-02   +5.719632254647955e-01   +5.370591845627132e-01   +5.991134909133145e-01   +4.305881039666366e-02   +9.796895385357711e-01   +1.526846965576485e-01; +9.329625804333272e-01   +9.300380606110900e-02   +1.119860058392003e-01   +1.481230601814203e-01   +9.074322107363135e-01   +2.313234696464762e-01   +6.368566054496577e-01   +6.842945090445786e-01   +7.005348512912897e-01   +7.975276281636967e-01   +1.371957502570968e-01   +7.330880174647585e-01; +9.776927848941913e-01   +9.581456804518017e-02   +4.142015565485185e-02   +1.300164179506070e-01   +7.525684254208832e-01   +4.152965075679538e-01   +3.684854304908486e-01   +5.873551104660319e-01   +1.805083794013888e-01   +7.124280363223987e-01   +8.832010482711559e-01   +1.191596395032053e-01];
L3I_L2I_iGABA_netcon = [+7.688425291287527e-01   +5.377511181898494e-01   +5.974461319930532e-01   +3.051650142607934e-01   +9.637504699370476e-01   +1.125789316630398e-01   +2.932386123838345e-01   +7.956356889738849e-01   +9.235989696828329e-01   +9.962884998198892e-01   +3.093951876082996e-01   +9.935381364587542e-01; +6.364737003760008e-01   +4.470635143171156e-01   +5.613666925734637e-01   +7.579686956142739e-01   +5.481421502374115e-01   +6.545941918046461e-02   +1.670514794639571e-01   +5.061466623508179e-02   +3.869481174428194e-01   +2.939145050595806e-01   +4.475440502060435e-01   +9.171734818663329e-01; +7.957444515380941e-01   +1.159830696545679e-01   +7.601875591572144e-02   +6.519158040023401e-01   +9.792088472237622e-01   +4.761485115163633e-02   +7.225698562778095e-01   +1.813266584506458e-01   +7.499497503822364e-01   +5.261620628971238e-01   +2.008916173333526e-01   +6.875684147889866e-01; +9.645344132462073e-01   +7.178972629948353e-01   +7.666369825696833e-01   +3.333664697758808e-01   +1.255018380141613e-01   +1.304553405814217e-01   +3.005870608942589e-01   +2.482690787701229e-01   +8.791361089522992e-01   +3.592512920641026e-01   +9.431494696889893e-01   +2.160894637523088e-01; +7.127453575442667e-01   +1.851049966687583e-01   +8.641415856312509e-01   +9.770223181922336e-01   +1.616414810187844e-01   +4.913981037977565e-01   +6.796373672310128e-01   +2.591130399737954e-01   +3.954975884986223e-01   +5.209663869023511e-01   +2.894303621764235e-01   +3.118455939977712e-01; +6.432264344212816e-01   +3.269166423419450e-01   +7.008384925531056e-01   +5.322759344583049e-01   +3.345846131718090e-01   +4.698850519852023e-01   +7.501957864016616e-01   +6.493975318019372e-01   +1.709928487095549e-01   +4.949476637514749e-01   +1.152063083076180e-01   +2.288437264383121e-01; +5.181227209564012e-01   +9.672398747993650e-01   +1.099184920049030e-01   +7.527147526677973e-01   +5.298024419335269e-01   +1.549068312552477e-01   +7.455495760138002e-01   +1.003612926346570e-01   +4.413259026174545e-01   +1.811809496317211e-01   +6.495695538177462e-02   +7.042316875544236e-01; +9.545130738157810e-01   +6.963257306917936e-01   +6.576947469508722e-01   +2.615579562990093e-01   +6.891126564727372e-01   +1.357720506745645e-01   +7.809288095102984e-01   +4.696076098910726e-01   +8.530927736358094e-01   +4.823238905862091e-01   +7.266918975608506e-01   +3.734203572239628e-01];
L2E_L3E_iAMPA_netcon = [+6.536834672906711e-01   +3.832797938301987e-01   +2.337909595229489e-01   +4.668122689456490e-01   +9.082399707336455e-01   +9.546526165331473e-01   +7.654608309695548e-01   +3.567740189430886e-01; +3.812817167451898e-01   +2.299069767437019e-02   +9.140604728119336e-01   +2.883214960187266e-01   +6.813322146289654e-01   +2.042812017451598e-02   +8.977589292395066e-01   +6.623550502056257e-01; +3.038496264221855e-01   +3.305384563443862e-01   +4.868608420249862e-01   +2.745151491242495e-01   +8.445222411582620e-01   +4.995199074055484e-01   +7.934722652969520e-01   +5.928941955287318e-01; +1.552354300809580e-01   +4.902693885924242e-01   +5.892621868597319e-01   +1.465945494069718e-01   +9.506287747765166e-02   +3.365124043221727e-01   +9.481062407422606e-01   +5.440297148218914e-02; +7.780677571535152e-01   +2.658193199496572e-01   +9.552984698656320e-01   +1.428022905705821e-01   +7.387730655655499e-01   +6.659616024942233e-01   +5.388192171169995e-01   +2.106433957139577e-01; +7.128762155147857e-01   +5.309010434915212e-01   +8.373834731555352e-02   +2.648378914698702e-01   +5.500867477867826e-01   +1.625945966002326e-01   +1.611417550149098e-01   +6.014898455297917e-01; +1.751860759268335e-01   +4.160283600826093e-01   +2.192154449324726e-01   +6.064258543970845e-01   +2.529725918234935e-01   +2.255222502109684e-01   +1.375492184359391e-01   +2.672316317859720e-01; +4.510673095069473e-01   +2.776086894903393e-03   +1.631334138712540e-01   +1.043656958038069e-01   +7.176784358478362e-01   +1.140122036162582e-01   +2.819563018705378e-02   +1.144247314750423e-01; +8.397733224378734e-01   +8.943540632614546e-01   +3.920339836576828e-01   +4.904546415475832e-01   +3.637952855813801e-01   +9.901634061886557e-01   +6.886942199127396e-01   +2.207251422303342e-01; +6.994737050063109e-01   +2.409388548525926e-01   +1.891352487365595e-01   +8.959254322993456e-01   +8.468659481445422e-01   +1.427945237665882e-01   +5.821871891249580e-01   +8.777092051616974e-01; +7.641360807296174e-01   +8.015770495018533e-01   +7.596883950072345e-01   +1.889599154099253e-01   +8.231883686377183e-01   +7.673999231997245e-01   +2.984618482032517e-01   +4.624710951728115e-01; +9.780414613656802e-01   +5.772679955503619e-01   +2.324189829094609e-01   +5.423585176969620e-02   +6.173041268982706e-01   +6.287027787575484e-01   +7.323103402514795e-02   +7.302536705983461e-01];
L2I_L3I_iGABA_netcon = [+5.902177583152347e-01   +1.431950482810073e-01   +3.465066193810029e-01   +3.733932503469175e-01   +5.939062993675993e-01   +5.135328333586682e-01   +7.772651056595321e-01   +2.680690751000604e-01; +8.429031147680822e-01   +9.917901910705768e-01   +4.347357500002031e-02   +5.362220947401766e-01   +4.761399540038034e-01   +2.415303125088220e-01   +1.800088152723929e-01   +5.956376531138822e-01; +6.079304905330293e-01   +4.826760358802672e-01   +9.460500021637200e-01   +9.757734750222142e-01   +3.773204386044344e-01   +2.687782175026512e-01   +4.513395145073073e-01   +6.843318384098610e-01; +7.442836239246398e-01   +4.157617711461045e-02   +8.613322078762393e-01   +9.958268142053912e-01   +9.826817039652735e-01   +4.109985621617230e-01   +3.056192078998913e-01   +4.132632277050494e-01; +8.528944321214544e-01   +2.680298660886347e-01   +1.377530446475389e-01   +4.120651649072316e-01   +1.427468472775837e-01   +2.663477758372061e-01   +3.831187559012049e-01   +5.116789757551556e-01; +1.448276530531680e-01   +6.706569370774671e-01   +5.837759554442423e-01   +4.472786500489180e-01   +2.704502181245248e-01   +8.549844757506032e-01   +7.989402548432978e-01   +8.158579878639552e-01; +7.411139203794794e-01   +1.437537650464591e-01   +6.251411500816641e-02   +2.431505228544724e-01   +2.251780239717576e-01   +4.807213162667276e-01   +7.797797291848183e-01   +5.383295189117915e-01; +1.674647373448883e-02   +7.764975527034619e-01   +9.536905931236217e-01   +5.971890716177142e-01   +7.943851638511601e-01   +3.376341532240223e-01   +6.463080937932507e-01   +5.906407480901968e-01; +2.302253299562594e-01   +2.653300050455202e-01   +4.963257484966240e-01   +7.557560231681297e-02   +8.217558875918221e-01   +6.339348844372880e-01   +2.412384898711578e-01   +5.392737010724562e-01; +5.376462602384611e-01   +8.809798149460482e-01   +2.671645199079312e-02   +9.089015109679580e-01   +8.004990382299999e-01   +4.174100968349571e-01   +6.043505302069606e-01   +5.401764315097576e-01; +7.149234811065512e-01   +3.628954205453443e-01   +5.252200039191508e-02   +4.776641846138535e-01   +1.143431955894533e-01   +5.436931899093593e-01   +4.170882700682147e-01   +1.525425579139265e-01; +4.316584280020673e-01   +1.196480299416924e-02   +3.045990602992403e-01   +5.037234269635134e-01   +6.398988272656009e-01   +3.361205550106874e-01   +2.974875365358384e-01   +6.991080480217506e-01];
L3I_L3E_iAMPA_netcon = [+6.064270471719430e-02   +7.747016054225637e-01   +5.557162681219517e-01   +5.688040548222022e-01   +9.150509802483493e-01   +8.336579250275258e-01   +8.490042335145078e-01   +8.634507536378236e-01   +5.263494645798814e-01   +9.934352418880403e-01   +4.792107949202211e-01   +3.515266152891124e-01; +9.225176268155663e-01   +8.331645775649997e-01   +8.470322804574733e-01   +9.331912620543608e-01   +5.905496030968362e-01   +4.009157835124740e-01   +6.302053389901318e-01   +8.536883519352855e-01   +5.676760105259853e-01   +6.990736965403177e-01   +7.387168133197188e-01   +3.974559690526536e-01; +1.842971929767925e-01   +5.938096259366683e-01   +9.687229246536873e-01   +7.775052651071718e-01   +5.788724891212462e-01   +6.958770353536042e-02   +4.397812515775611e-01   +9.492049737491748e-01   +9.805043420262555e-01   +8.375882079663026e-01   +5.933565751563162e-01   +9.909898381390833e-01; +5.380353718817101e-01   +7.614893428846011e-01   +4.679889593743569e-01   +5.977483320462439e-01   +6.522801881936703e-01   +3.794273593096709e-01   +2.290156641314653e-01   +6.999206180734615e-01   +9.612972435393670e-01   +7.337972345780578e-01   +2.544073937182665e-01   +2.925641156497214e-01; +4.014292625344264e-01   +6.610194902761637e-01   +7.706921412519777e-01   +6.553270707978053e-02   +4.286085133608107e-01   +8.595901632308356e-01   +5.335567908019188e-02   +3.577230725165951e-01   +5.578303961241116e-01   +9.959335413169439e-01   +6.078471131657164e-01   +2.316948534449439e-01; +9.848398492201881e-03   +5.853264581693961e-01   +2.371245479304173e-02   +5.354625210454278e-01   +9.397720858011309e-01   +2.781578635009483e-02   +7.028435519744591e-01   +3.785396975684394e-01   +5.232348845846508e-01   +5.032778831327168e-01   +2.323863140641279e-01   +3.293208836140609e-01; +1.069048288874507e-01   +2.413245830481305e-02   +6.755401604658287e-01   +8.611056841634179e-01   +1.010996572462637e-01   +4.207778159668906e-01   +8.499864700214168e-01   +8.492047847215712e-01   +4.704614844969071e-01   +1.921255969924777e-01   +1.946387169500700e-01   +1.676822716839549e-01; +8.546715579846870e-01   +6.845471223364622e-01   +8.403745198911636e-01   +3.394132764194211e-01   +4.079584024096498e-01   +2.513541204007178e-01   +4.023360380083644e-01   +3.884012964861533e-01   +8.975211428310133e-01   +9.520123845962155e-01   +3.584782885785198e-03   +3.816707457818433e-01; +3.336653712525339e-01   +3.246890172143840e-01   +6.909284835708565e-01   +1.814421813335056e-01   +8.927129668665006e-01   +7.141742055503754e-02   +2.901523548514184e-01   +7.702357405440153e-01   +4.796568367996086e-01   +4.530866926438603e-01   +6.520908168584147e-01   +5.293266221375112e-01; +1.435574741044704e-01   +8.428939444119789e-02   +8.993075272087782e-01   +8.797274936354401e-01   +7.377692890407337e-01   +9.144394535799441e-01   +2.599706731686041e-01   +7.781327585487914e-01   +4.900114176222315e-01   +6.026254631627072e-01   +3.996317236062282e-01   +5.929177273807500e-01; +8.000567747424630e-01   +7.472609365997214e-01   +9.383662793022497e-02   +8.408206442761949e-01   +9.575887303547254e-01   +2.655636069010716e-01   +5.096562233136371e-01   +4.298495563430267e-01   +3.134272314896396e-01   +6.455524822393858e-01   +2.690996516480963e-01   +1.670435030682671e-01; +6.531167052368837e-01   +9.656074728986526e-01   +7.654573966013682e-02   +8.271013476916733e-01   +9.747628442574423e-01   +1.077933609529083e-01   +1.160664828475933e-01   +4.877255269157399e-01   +8.526087202647690e-01   +7.597709612073174e-01   +7.017240487637683e-03   +6.510089878882079e-02];
L3E_L3I_iGABA_netcon = [+4.412975782723407e-01   +6.436233639159226e-02   +6.529832747929544e-03   +4.968913034617645e-01   +5.408504158967467e-01   +2.529573448568729e-01   +7.184372774061175e-01   +7.578889997164561e-01   +3.817465647789152e-01   +4.492404106571355e-01   +2.026024752246798e-01   +6.564231783097537e-01; +5.818566921328137e-02   +8.079305032696591e-01   +1.286554400135012e-01   +1.918548168362941e-01   +2.178174455722315e-01   +3.331419659742396e-01   +2.275154030460999e-01   +8.902428078984871e-01   +6.067899597287133e-01   +3.939891942159032e-01   +8.285723782516986e-01   +9.047252488029438e-01; +6.271227084212531e-01   +9.133403373368633e-01   +3.091832006620011e-01   +6.420344221859612e-01   +2.677944599991163e-01   +5.983436156702148e-01   +4.948219996032312e-01   +7.304888052615095e-01   +1.630511853186905e-01   +6.764290771446180e-01   +4.412116647697957e-01   +8.387471654421671e-01; +8.085563533619545e-01   +4.285154590451209e-01   +2.385041808724393e-01   +2.561409065465821e-01   +1.342113423216661e-01   +4.808034335615502e-01   +4.783407065932636e-01   +6.916667490738303e-01   +1.007163982805894e-01   +3.454287514065048e-02   +4.259929078256885e-02   +1.668820201975754e-01; +4.030122416252419e-01   +1.912250199192742e-01   +6.522475342361063e-01   +9.411554384296226e-01   +1.406862655000014e-02   +9.010183123582719e-01   +4.329217117332759e-01   +6.451037553053729e-01   +6.186129409970976e-01   +7.829670854721710e-01   +7.655272848290114e-01   +1.613617088473252e-01; +8.871396760910113e-01   +1.867538304262666e-01   +8.081677983634955e-01   +2.905926828881299e-01   +1.280285554212339e-02   +2.870270056088969e-01   +5.565433051283907e-01   +6.168433158537252e-01   +9.614723694933173e-01   +3.747699409311418e-01   +9.148106786681715e-02   +1.394787175676727e-01; +7.186946520103902e-01   +6.704553798546451e-01   +7.399332982142216e-01   +1.427575329114076e-01   +9.856059323080210e-01   +7.392907232758780e-02   +2.032325592658204e-01   +7.541766479083967e-02   +6.717202291875699e-01   +6.403826787171492e-01   +6.574058170731298e-01   +1.578452454248596e-01; +1.973422829058820e-01   +5.240331909016847e-01   +1.239651171623296e-01   +8.640581761213650e-01   +6.473535825582791e-01   +3.872558274535303e-01   +2.741233723003274e-01   +5.471349633726934e-01   +4.701410468002801e-01   +4.934845534253640e-01   +2.671072018346927e-01   +3.989918497079866e-01; +3.701398831202946e-01   +7.751032397086888e-01   +1.780858400808409e-01   +8.863252950786832e-01   +8.096685491359585e-01   +1.885830617169754e-01   +8.078023046816087e-01   +8.771638756268251e-01   +3.334815814233080e-01   +2.235598941199259e-01   +4.378008698670250e-01   +6.611018037653219e-01; +2.081136531272291e-01   +3.020101466463558e-01   +2.669082736787561e-01   +6.601731128909117e-01   +2.775215310412113e-01   +7.286779950651021e-01   +1.008114430791155e-01   +9.828880348062309e-01   +5.885240385378154e-01   +2.144489417935656e-01   +8.519367986765272e-01   +2.223852370439392e-01; +2.618874710139299e-01   +4.718906161050918e-01   +8.137160725647121e-01   +9.994101390826990e-01   +1.488801430820558e-02   +4.254390332617257e-01   +3.551765225792233e-02   +6.903334287311570e-02   +5.451571006622746e-01   +4.544291970424818e-01   +9.040133990468506e-01   +6.433677590214815e-01; +9.928432306953847e-01   +7.115466074504404e-01   +5.930578418285598e-01   +2.631361278122478e-01   +1.050274067336512e-01   +2.687138494509432e-01   +7.153245393404829e-02   +2.925435875031631e-02   +3.946675154825005e-02   +6.320943128736253e-01   +2.859222132561693e-01   +6.096551891069677e-01];
L2E_Input1_iAMPA_netcon = [+9.964562331421587e-01   +9.933783804898392e-01   +9.933993133077013e-01   +9.894045714253282e-01   +9.915767067980408e-01   +9.999335904505857e-01   +9.873840304905608e-01   +9.957950286070263e-01];
L2I_Input2_iAMPA_netcon = [+9.985956466429200e-01   +9.951055117800774e-01   +9.936847584797004e-01   +9.887976665691628e-01   +9.937820536605899e-01   +9.898818444534671e-01   +9.934363035537408e-01   +9.987914230250957e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
