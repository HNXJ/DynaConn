function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.448311894518449e-01   +8.094221093152951e-02   +4.626875953704437e-01   -6.851521508146178e-01   +5.144870371227243e-01   +2.067017914936692e-01   -8.396644745415254e-01   -1.880210432134474e-01   +5.376005884731264e-02   -7.549756577215896e-01   -3.715687549347854e-01   -2.267793611394715e-01   -3.163402180269271e-01   -3.603612581318268e-01   +6.332605723876509e-01   -6.125748608442148e-01; +7.239413654135235e-01   -1.622052177258812e-01   +1.646477005452111e-01   -3.852838146334839e-01   +3.794756790930920e-01   +1.559901087053099e-01   +5.544047749128829e-01   +3.246067950034610e-01   +5.549660294407583e-01   -1.885020940821887e-01   -1.732558197161512e-01   +5.317827988578195e-01   +5.697671195180801e-02   +2.973462184188441e-01   +1.635082288064638e-01   +2.918533248286992e-01; -1.098079878747126e-01   +5.655674591235720e-01   +1.596517478687383e-01   +2.252601134135115e-01   -7.277604248778737e-01   -1.413216380207653e-01   -6.380315131644591e-02   +1.988673008248041e-01   +9.788541824131357e-02   +3.662556363367769e-01   +1.874787108433989e-01   -2.435296913280219e-01   +2.277470185305171e-01   +1.836463579383819e-02   +3.792516020491625e-01   -2.933142508155322e-01; -8.286180911764103e-01   +2.345054053311725e-01   -1.888269046723769e-01   -5.037818847321605e-01   -8.723818234298089e-01   -5.571107275611207e-01   -5.894627390046814e-01   +1.540958199314361e-01   +2.237256671774741e-01   -9.904906253680243e-02   -7.042421967256528e-02   +3.257390143018242e-01   +2.540219751294900e-01   +3.486609095337568e-01   -8.949283699522252e-02   -3.267321562173051e-02; +2.671468949922358e-02   -1.121149562239505e-01   -3.901733040059837e-01   +2.184491069870186e-01   -1.073868447411736e-02   -2.452621938417458e-01   +7.625392268345944e-01   +1.860173194576322e-01   +7.463282545780648e-01   -3.700308728023435e-01   -4.900541471386345e-01   +3.213289137913426e-01   +3.587289419805088e-01   +8.587006404751047e-01   +4.302484016627534e-01   +2.402473245878460e-02; +3.355489966898585e-01   +6.405778482007447e-01   +5.699756308648967e-01   +4.548464647886778e-02   +4.510105250321985e-01   +3.276053460987254e-02   +4.053477495864165e-01   -3.046408265230058e-01   -5.955410476657375e-01   -1.616259635352436e-01   -3.920127072926872e-01   -1.869708523503082e-01   -2.905718173296367e-01   -4.443763204960792e-01   +4.796706871418339e-01   +3.034430071973030e-01; -2.976966798278611e-01   -3.162134330683803e-01   -6.003305927632208e-01   +7.070468226926239e-01   -3.427184090497711e-01   -4.609651463125083e-01   -5.036458178380896e-02   +8.117869977290342e-01   +5.786499583726388e-01   +4.640340317152564e-01   -8.558437014383599e-02   -7.700625410971003e-01   -4.902712486369666e-02   -9.771701624841252e-02   +3.496901562149399e-01   -1.056462731896998e-01; -3.944584998120093e-01   -7.965230169438629e-02   +4.637930678496552e-01   +4.010465965458263e-01   -3.883165106704211e-01   -8.058593906490517e-01   -4.222761464909990e-01   -4.985885321927496e-01   -2.940912379863717e-01   +2.167760654494289e-02   +5.987357698222848e-02   -1.893774152109636e-01   +7.412547345523612e-01   +7.107183760745401e-01   -6.877376448886359e-01   -3.439783417443302e-01; +3.638893960826540e-01   -2.928877688313059e-01   -9.050294190404336e-02   -2.951020792578862e-01   -2.839863064964776e-01   +5.560249027892991e-01   +7.031046108361889e-01   -9.819842868757763e-01   +7.614522677345674e-01   -1.611815040541646e-01   -1.703744348823980e-01   -7.503294472700010e-02   -2.071415225152507e-01   +3.899612757315287e-01   +7.611021882256925e-01   -2.453960805547456e-01; -5.857970702882650e-01   +5.144655100283071e-01   +3.507149961122141e-01   +3.980903752673559e-01   +6.014520673570198e-01   +1.214378072204551e-01   +2.302919975443815e-01   +4.001402531779245e-01   -6.107532582621785e-01   +6.223835408755807e-01   +4.375924849858259e-01   +3.751952519211021e-01   -1.110158089580737e-01   -1.837686675433091e-01   +2.480653515436914e-01   +6.660180704541022e-01; +7.599800636639272e-01   -1.657326044340370e-01   +3.997014078173097e-01   +6.344968098050402e-02   +5.585542771110685e-01   +5.494826448465772e-01   +5.470643159749032e-01   +5.214546799430274e-01   -4.835639342166245e-01   +4.976463032729602e-01   -7.500750234084383e-01   +1.844951366624734e-01   +5.011279887172577e-01   -4.124244596192773e-01   -3.466965351237395e-01   -5.870573106545648e-01; -7.969663397156529e-01   +4.797518335738233e-01   -7.697912360704409e-02   -3.367993256077658e-01   +4.633188728557983e-01   -1.341427354322274e-01   -3.301785053450161e-01   +1.220176992270413e-01   +9.695892563065294e-01   -1.968136509180932e-01   -2.775240017661429e-01   +7.292482704521953e-01   +2.630738161619312e-01   -2.399229697814817e-01   -2.699513662852795e-01   +3.358690253600087e-01; -8.577411625531788e-01   +4.008557232910972e-01   -4.668215256306377e-01   +6.455573529450844e-01   +4.130222700916454e-01   +1.489504431699501e-01   +4.927228879001477e-01   -5.568638394970505e-01   -2.964490000196614e-02   -5.197829615118761e-01   -4.296440816572904e-01   +3.992528213697628e-01   +3.094416562584353e-01   +7.616248289062594e-02   -7.056712864301115e-01   -3.106458154427544e-01; +3.425062222184202e-01   -2.949910446322956e-01   +1.946108423700982e-01   +2.133792104835766e-02   -3.934479099729118e-01   +5.470359640347344e-01   -8.663871744447356e-01   -5.147652015853517e-01   -4.839350531935629e-01   +9.025640708524439e-01   -2.487123773620378e-02   +4.042102000590135e-01   -3.117565739144929e-01   -2.439095490413089e-01   -7.672751596786528e-01   -1.300167275953894e-02; +1.018102312976150e-01   -1.019826541808811e-01   -8.961310860461784e-01   +2.981380554931472e-01   +2.850051835633661e-02   -6.488121020986606e-01   -1.640920929307278e-01   +8.365851644645159e-02   +4.474596514587071e-01   -1.510822082044460e-02   -2.919866057014670e-01   -3.016675588763357e-01   +5.556246804999928e-01   -6.540743593041566e-01   +2.078010420556333e-01   +5.314737667898884e-01; -2.531182617311297e-01   -4.088875316076843e-01   -2.269147314757359e-01   +1.000000000000000e+00   +3.520231135466635e-01   +1.931450843338550e-02   +5.243664133378458e-01   -8.711820235141450e-03   -5.124648577966349e-01   -5.464011224929003e-01   -2.840527581594051e-01   +4.793069370719277e-01   -6.572864775934906e-02   -3.260720417227345e-01   +1.520502907321809e-01   -5.872871233618164e-01];
L1E_L1I_iGABA_netcon = [+2.081793550382932e-01   -6.154225667330279e-01   +3.347117373797581e-01   -3.344479637725867e-02   +8.560321768908748e-02   +4.257741771610122e-01   -7.760761001146751e-01   +5.227453238430628e-01   -2.509203953880845e-01   +1.742093945602620e-01   -3.777481550434040e-01   +1.000000000000000e+00   +3.963086202668730e-01   +3.149922329556604e-01   -1.777291463229226e-01   -3.762670252693057e-01; -4.170754038197762e-01   +1.700489357951596e-01   +6.951333889898658e-01   +6.820842930003401e-01   -5.459183156487317e-01   -3.783271519675810e-01   +1.290176026128578e-01   -7.798753763057083e-02   +2.586188287069555e-01   -3.958091983876711e-02   -3.297124612161710e-01   +8.879834357204209e-01   +1.191218335880376e-01   +6.031569192948899e-01   -1.104655877443462e-01   +1.932282183798553e-01; +2.899829491323633e-02   +7.913123356896756e-02   -5.864702504860556e-02   +8.581720405091449e-02   +1.696424326339326e-04   -8.929258056661711e-01   +7.021586683585282e-02   -3.316442631155288e-01   +3.785435938707102e-01   +1.467150192570268e-01   +3.383169122663859e-01   -5.308255697778476e-01   -1.768096250793590e-01   +1.610071177605999e-01   -4.848259234420636e-02   +3.330287451729506e-01; +3.776915090681069e-01   -7.197349559261926e-01   -3.160832096372177e-01   +3.423431078836519e-01   +2.617888605608764e-01   -6.723982159639892e-01   +6.439109606652928e-02   -2.460060731557839e-01   +3.765891523981865e-01   -4.712200516676796e-01   -4.370973973422194e-01   -6.657474366819973e-01   +7.214947351358839e-01   -8.956927002805279e-01   -5.419469698227760e-01   -7.554060897258879e-01; -2.996917152862771e-01   -2.242589120526190e-01   -2.620375736043443e-02   +3.010117969003919e-01   -2.525765717034783e-01   -2.724685926439539e-01   -1.306862291368616e-01   -2.555495479571946e-01   +6.369572776776311e-01   -5.582995237473481e-01   -1.923390195606650e-01   +4.900765259571510e-01   +2.739472585469284e-01   -4.475869644958768e-01   +3.025119321461233e-01   -7.591521940049154e-01; -1.291064146397868e-01   -5.031173649627235e-02   -2.828512419435164e-01   -3.593638108406267e-01   +1.684874699351645e-01   -6.494803238630979e-02   -3.186095665465949e-01   -3.078420225350589e-01   -3.433737059939136e-01   +3.788308286347273e-01   +5.723575222338436e-01   -6.672413045514098e-01   +8.788304404053787e-02   -3.500657734542943e-01   +1.496244465128715e-02   +4.040468874163924e-01; +6.800637346208990e-01   +5.164233659610290e-01   +1.003189544067256e-01   -4.184489967817564e-01   +5.331911800929782e-01   -3.633553232496222e-01   +7.244316425539472e-01   -2.690241069588870e-01   -6.433769130308057e-01   +1.614820416725132e-01   -4.741917226257761e-01   +2.273928594781635e-01   -2.604331160784430e-02   +6.495799477844271e-01   +6.844575310795068e-01   -3.405779255051453e-01; -4.830124063070121e-01   +2.722251181356958e-01   +4.955256003547128e-02   -4.689719055970222e-01   +3.386503873011648e-01   -6.456093730869665e-01   +7.125365655203718e-01   -8.512934444704802e-01   +7.975021827139701e-01   -6.856349510476178e-02   -1.602944989115178e-02   +4.569695418465084e-01   -2.952554208985311e-01   -4.516111125471408e-01   -1.652259916245652e-01   +2.794798288493794e-01; +2.908094434463643e-02   -8.360373565511453e-01   +3.231851511450614e-01   +8.604026069996885e-02   -5.157741574474811e-01   -3.580464207316758e-01   -7.584889595237325e-01   +3.719807272814288e-01   +5.705416401082147e-01   +5.770453043763025e-01   -4.455818150322602e-02   -2.509953897347462e-01   +3.358106700908771e-01   +1.568832645968893e-01   +1.945923782237169e-01   -2.079129214808358e-01; -6.098368745059612e-01   -2.390146692425912e-01   +2.758221498523835e-02   +8.952059723789119e-01   +1.318963714461961e-01   -5.566730258496986e-01   -1.712286179361971e-01   -8.819420715767436e-02   -8.676159071184273e-01   +4.250049198119410e-01   +3.216757373161500e-01   -4.694337881215094e-01   +2.472255299045907e-01   -6.607872966079058e-01   -7.218875261538520e-01   -2.568890086808987e-01; -2.794183792012631e-01   +3.711127563497011e-01   +4.161286490165499e-01   +1.483867167350271e-01   -7.314683423819774e-01   -4.343848580003351e-01   -5.181536299945368e-01   +5.522339717215971e-01   +5.244690210424398e-01   -7.757398681438673e-01   -6.657775975028994e-01   +2.786038512036112e-01   -3.962986207242202e-01   +7.989575588534081e-01   -4.300307578715270e-01   -3.396760997553012e-01; +4.100692104476421e-01   -6.591151550669150e-01   -1.461691743780187e-01   -2.221150970105454e-01   +3.840305907635218e-01   -3.546352085750366e-01   +5.627529212185183e-01   -4.251086209003815e-01   -2.001960020665235e-01   -8.343142405299928e-01   -3.118564022421696e-02   -3.020331660622123e-01   -5.463432106312449e-01   +2.156068552211643e-01   -3.897502657698091e-01   -7.087598442263038e-01; -7.121809091728837e-01   +9.462771132624938e-02   +2.588299174122296e-02   -2.050241727487789e-01   +3.521833426735291e-01   -1.548878799549589e-01   +2.855328316802559e-02   +4.117774731719273e-01   +2.217705661086309e-02   +2.428940990089044e-01   -2.269992430966626e-01   -1.219512117614020e-01   -5.796405198481562e-01   -4.404237955577160e-01   -5.602994669068705e-01   +2.831779394518648e-01; +2.468509436355519e-01   -2.732372798307976e-01   +9.256021600175152e-03   +2.091413873601246e-01   +1.099539944015796e-01   -4.802546110370041e-01   +2.865260086099861e-02   +7.284243979790703e-01   -2.495194669133330e-01   +8.256771559088528e-01   -2.549509750363437e-01   -1.001313223035654e-01   -7.377051336660238e-02   +8.023595913445945e-02   +8.065129521787899e-01   -4.212544022200269e-01; -1.349794930553772e-01   -2.035750109899674e-01   +5.110962225107666e-01   +4.191982827771704e-01   +1.041178426157748e-01   -4.126628173166025e-01   +6.532159584215059e-01   +5.346323272038807e-02   +1.224049051423270e-01   +3.442724516925844e-01   -3.348342010905281e-01   +6.417086321267184e-01   -2.990634525273838e-01   -9.785613957269996e-01   +7.277805720601048e-01   +2.358247168846410e-01; +4.385887928219898e-01   +9.711517804088557e-02   +4.993317397781488e-01   +4.603563316746730e-01   -1.865762645607739e-01   +6.646344514937945e-01   -1.135658405357908e-01   +3.758258711459202e-01   +1.141889410625656e-01   -3.587343364465084e-01   -3.365922138790885e-01   +2.860026835505228e-01   +2.905488910669145e-01   -1.114844270249617e-01   -1.382739511099458e-01   +3.699015543406098e-02];
L2I_L1I_iGABA_netcon = [-6.037046003458604e-01   -2.099877057585066e-02   +4.085894517359326e-01   +1.101301735754509e-01   -5.947604759486080e-01   +1.537445720452034e-01   +5.755130638013415e-02   +5.293499639555058e-01; +4.326135388442808e-01   -9.637181486776453e-02   -3.534930824499551e-01   -4.965711482404735e-01   -9.679356027212970e-01   +9.273667726090014e-02   +1.053452753853189e-01   +6.892294708697706e-01; +2.600057543202589e-01   -4.840453919590167e-01   -8.193569357266063e-01   +7.303343097316480e-01   -7.257527633667528e-01   -2.706605069551081e-01   -3.413603304267279e-01   +9.745110561551439e-02; -2.700369207482278e-02   -6.545209036114010e-01   +3.156603836518670e-01   -1.065866162020751e-01   -7.972386697174746e-02   +5.064370575989997e-01   +1.409605299807243e-01   -9.579029569002188e-01; -2.089519974650305e-02   +8.775795364687600e-02   +2.464720998954987e-01   +3.272356925251663e-01   -9.596238356994981e-02   -3.744685143518692e-01   +6.209988300492234e-01   -1.872421787159015e-01; +1.120288105213021e-01   +5.511551169040251e-02   -5.396629840065599e-01   +4.534927301638820e-01   +8.677084490536198e-01   +1.716471914987772e-01   +6.583500275470088e-01   +1.148949287938349e-01; -3.078023860037740e-02   -2.955439095621950e-01   +4.853128141248927e-01   +5.876460139873545e-01   +5.987345211733508e-01   +1.104547536241316e-01   +4.263523056892853e-03   -6.712473662411196e-02; -3.191035002703090e-01   -4.451167181266952e-01   +7.044673996043345e-01   +1.000000000000000e+00   +2.635778287134353e-01   +3.699991272127990e-01   -6.322991117301112e-01   -5.470151792658758e-01; +5.873987787404251e-02   +4.157621520536260e-01   +2.535878630209271e-01   -3.619633222865672e-01   -6.636031491096336e-01   +1.056243800731992e-01   +6.514549657337719e-01   +5.922434731909235e-01; +4.525822415108662e-01   +2.183851399090184e-01   -4.549920649490888e-01   -3.203856634869815e-01   -2.594063932150748e-01   -4.388525909512804e-01   -7.065681852315602e-01   -5.439138482865830e-01; +4.217819497478252e-03   -8.915098576056266e-02   -1.278094879801458e-01   -1.946039114393081e-01   +6.829162573632559e-01   -5.954874494570598e-01   +1.514395517763230e-01   +1.679975876118839e-01; -2.358767391940889e-01   +3.155015973622466e-01   -4.543158417302370e-01   +1.082882373700360e-02   -8.333354901902393e-01   -1.819957232645591e-02   +2.754415560718007e-01   +3.000197228913792e-02; +3.297597815632113e-01   +6.637662400665804e-01   -3.759053057271845e-01   +3.686711946169680e-01   +3.759291875786189e-01   +3.628484210268157e-01   -5.111895706693100e-01   -7.614090404096827e-01; +7.820473266655288e-01   -4.385170811082950e-02   +2.674782145043878e-02   -3.128086814191067e-01   -3.381023445106056e-01   -3.961671159996088e-02   +1.963117919147331e-01   -3.967971143057613e-01; -8.311674201306786e-01   -9.740919774665419e-01   -5.837912299752687e-01   +2.535513202838447e-01   -9.107518928567928e-03   -5.968042699984396e-02   +2.634265006972815e-01   +3.989525692207196e-02; -2.632594083164109e-01   -1.428096409481655e-01   +5.098458797896717e-01   +8.448540275058176e-01   -4.189534133599766e-01   -3.247162669074192e-01   +3.001187073911404e-01   -2.139972257978512e-01];
L1I_L2I_iGABA_netcon = [+5.962457813176043e-01   -2.582856804051413e-01   +4.950005881248075e-01   -2.381468840248615e-01   -3.284317708283981e-01   -2.896095576485699e-01   -6.028632130738412e-01   +9.337586823587740e-01   -3.917476123544746e-01   +8.364263445422656e-01   +4.927800090288554e-01   +4.177953070890884e-01   +9.407026873733595e-03   +8.705938309189198e-01   -5.125942404290638e-01   +7.283633286878630e-01; -2.610233109540317e-01   -3.872785415349960e-01   -2.120886050751219e-01   -8.302678972668849e-01   +7.509471550146519e-01   +1.682612415174383e-01   +6.262765587797698e-01   -1.620220772425468e-02   -2.034641894949049e-02   -1.651179318076336e-01   +1.762300528305495e-01   +2.176923556429759e-01   -2.397053897640026e-01   +1.344816620470995e-01   -5.853972651527086e-01   -7.319190363821068e-01; +6.730192818130705e-02   -4.174203433723447e-01   +4.349768657908786e-01   +1.437327255713054e-01   -2.989056314189842e-01   -6.988683168216162e-01   -3.087785134099914e-01   +1.291124492851718e-01   -1.590648605040658e-01   -2.653857494058077e-01   +3.939662494773148e-01   -2.469021700422172e-01   -3.204981859096598e-01   -6.770339316034363e-01   +1.253369658814595e-01   +7.154638625780417e-01; -5.094372978509234e-01   +8.201812926839650e-01   -6.510902295704623e-01   -1.725926710230754e-01   +2.951313589239646e-01   +7.058719980735103e-01   +2.107378829841814e-02   +4.618857714596199e-01   +8.967985790106435e-02   +4.938806925500887e-01   -3.661448079615608e-01   -5.711828460655752e-01   -5.653486603508130e-01   -3.793946465160736e-01   +1.598437510486429e-01   -4.842648126681866e-01; -1.297074030457384e-01   -1.997859546640675e-01   -2.705868905783623e-01   -1.207067610813206e-02   -2.477516265494933e-01   +3.297394480282487e-01   -6.523462996399314e-01   -1.821248761555722e-01   +3.034650490736108e-01   +7.854091969280822e-01   +7.996817673589615e-01   -1.000000000000000e+00   -1.812321326410769e-01   -2.564492679168613e-01   +3.241559968639233e-01   -1.397873292104843e-01; -6.961131401631152e-01   -2.711009562188734e-01   -8.883520289751338e-01   -5.075629787964266e-01   +5.245188204724550e-01   +5.524087358183324e-01   +8.293808056357836e-01   +2.137928562027625e-01   +2.516661140598535e-01   -1.937030419814048e-01   +5.150458940747185e-01   +1.415262206985047e-01   +8.242058587939064e-01   +4.582570511049324e-01   +1.874134588392504e-01   +3.133705066922101e-01; +8.868242859322184e-01   +3.979498742485198e-01   +3.146529015434022e-01   +3.010173238321688e-01   +4.381856332957846e-01   +5.256811645443986e-02   -6.745412086252979e-01   -4.426032287043342e-01   -7.105375672915845e-01   +4.876619561581311e-01   +5.212339228749014e-01   +8.519099120996451e-02   +8.406355813302544e-01   -6.033717695292113e-02   +2.440039244576624e-01   +3.827790411967156e-01; +6.964110595639977e-01   -5.551218866789944e-01   -4.348402337300413e-01   -4.434332838083904e-01   +2.086010570504974e-02   +3.805538759405729e-01   +2.812721908327734e-01   +3.187985763161950e-03   -5.530522466817848e-01   -3.210602766460064e-01   +8.236648589428508e-01   -2.210162941683491e-02   -1.016266405111061e-01   +3.929402714191487e-01   -7.239737543532830e-01   +2.044832683444207e-01];
L2E_L1E_iAMPA_netcon = [+3.992333081780179e-01   +4.926661390270277e-01   -5.779662431985599e-02   +2.189796450044750e-01   -5.368167421800685e-01   -1.418396202615666e-01   +2.249592515670607e-01   +3.137331106203872e-01; +3.598250094923997e-01   -4.447104670072739e-01   +2.364773728191437e-02   -2.289082060905371e-01   -8.368626160672493e-01   +6.535784685170462e-01   -7.079887082236658e-01   -3.930778439230396e-01; +6.119922288880327e-01   -2.035646453761236e-01   +2.928373208143867e-01   +1.236688503375330e-01   -1.618044586984075e-01   -2.592745491886655e-01   -3.747226246374374e-01   +3.942970537809288e-01; +4.826848698383632e-02   -2.522136111431679e-01   -1.078719106043155e-01   +4.610491926718541e-02   -2.868852205101826e-01   +3.899430057102857e-01   +7.608594432492514e-01   -2.774160825249472e-01; -2.966726110309278e-01   -6.897524346169929e-03   -3.058037853318588e-01   -3.671908659057020e-01   -3.883475196980523e-01   -4.830822566465003e-01   -5.223843580642851e-01   +3.157908785636062e-02; -1.198268041151492e-01   -1.900882246911893e-01   +9.118043276075778e-01   -4.797475306307269e-01   -7.646894454738536e-01   +3.229216440365045e-01   +8.644437459521870e-01   +3.469572554668059e-01; +1.192169637791043e-01   -1.021406841787610e-01   +5.523604273382774e-01   -3.542464056169642e-02   -1.882821325661322e-01   -1.962889603744240e-01   +6.568421706254042e-01   +7.285530755180497e-02; +3.270274605000488e-01   +7.184709917528474e-02   +7.373455224766191e-01   -3.478502239229647e-01   +3.435775642600039e-01   -7.366218172148841e-01   +1.041357689158200e-01   -6.422549318868374e-01; +9.509022239357207e-01   +8.730225009166463e-01   +8.124000054589466e-01   -4.609322759699057e-01   +7.497292188996391e-01   +5.138173134303995e-01   +3.582025629058430e-01   -3.712859709712200e-01; -6.054351814782015e-01   +7.329035669025209e-01   +2.546476005050488e-01   +7.759053403556091e-01   +2.470050152943055e-01   +6.201387633748779e-01   +3.992271850936499e-01   +7.394676124650241e-01; -6.003975512947406e-01   +4.028454502939555e-01   -3.539684532595340e-01   -5.696791641891195e-01   -2.655559684466750e-01   +5.073620563291429e-01   +1.009831256748786e-01   -5.644834623587356e-01; -2.344094596656775e-01   -5.435996297806837e-01   +5.972657577795425e-01   -2.638313766193968e-01   -7.605679236933740e-01   -1.851968218418157e-01   -8.272393109686590e-02   +1.431782373705713e-01; +6.481062984461000e-01   +3.351141697162622e-01   -4.729096994363044e-01   +3.801779571745188e-02   -7.325817703296776e-01   -1.000000000000000e+00   -6.548491232326576e-01   +7.006846225650560e-01; -1.924006598057482e-01   +8.258531151449360e-01   -4.198547853739157e-01   -1.719371264249257e-02   -3.381334026796186e-01   -1.659612197387976e-01   +2.024923637444617e-01   -6.657221571159423e-02; +1.326943752123233e-01   +4.185230508296646e-01   +8.467472171824906e-01   +3.326575463528833e-01   +2.345714800532743e-01   +3.085970905477439e-01   +3.630889206108939e-01   +3.289865523636448e-01; +7.080681731102778e-02   -4.253531693531359e-01   -5.726845729474511e-01   +9.806594190135236e-01   -1.924989616157506e-01   +1.015197039812621e-01   +9.235284922124989e-01   -7.125075028334551e-01];
L1E_L2E_iAMPA_netcon = [-1.674395250333425e-01   +2.459868071453992e-02   -8.033991297491964e-02   -3.621000606947238e-01   -5.825294842446359e-01   -5.964480218943156e-01   +5.947538645505795e-01   +1.802849916166413e-01   +5.187949376708857e-02   -5.188437082558388e-01   -4.589383953738088e-01   -6.310287016678372e-01   -5.134462501665688e-01   +1.834541350991155e-01   -2.662161817603483e-01   +2.644603286767870e-01; -1.222413469935485e-01   -5.035359345803437e-01   +2.851775963615202e-01   +7.118278434792829e-01   +7.616702343995049e-01   -2.643890330894982e-01   +3.835207593371462e-01   +3.858317952108855e-01   -1.290850792686801e-01   +1.236560530907994e-01   +4.143429948337322e-01   -2.283188607500553e-01   -3.496510164806314e-01   +2.297164410758874e-01   +7.637784960322040e-01   -6.054608609337996e-01; -7.049912972172097e-02   -2.133556545590168e-01   +3.548028326900159e-01   +1.543852174488767e-01   +2.664617765169449e-01   -1.753124954372154e-01   +1.000000000000000e+00   +2.484739632114322e-01   +1.705582054918184e-01   -2.296829030301826e-02   +5.088413909308062e-01   +4.914588127990632e-01   +7.230609145183639e-02   +1.446896081369938e-01   +5.317777255148926e-01   +5.274974611521397e-01; +8.801256673510795e-02   +6.394667921245881e-01   +6.623584131431703e-01   -3.940801086667379e-01   +4.654901133465691e-01   +1.943412776537302e-01   -4.339838197652745e-01   -5.878913172173577e-01   -3.934324256550091e-01   -4.138699946556174e-01   -3.936960613026437e-01   -2.610611387781691e-01   -3.494681031418903e-01   -6.898470901768593e-01   -7.594765483983646e-01   -1.524723067757291e-02; +2.209455456942209e-01   +4.067545455429850e-01   +1.018004110471122e-01   -4.835650870688834e-01   -5.634349445356741e-01   -4.144741975717895e-01   -6.457449725967139e-01   +1.763392187075290e-01   -1.980995839675439e-01   +1.575718946121357e-02   -6.462483131797301e-01   +2.827217447146688e-01   +1.072520430880021e-01   -1.899104893106558e-01   -1.546182699017092e-01   -5.239834427397708e-01; +1.750098679538522e-02   -1.794751877021639e-01   -1.641730915930445e-01   -6.283071902874741e-01   -4.621529941227092e-01   +7.251001585534156e-01   -5.465250795290267e-01   +4.894712982012247e-01   -8.685132848790668e-02   -2.199961269328373e-01   +8.647039924285672e-02   -2.571009900131587e-01   +2.378105028478684e-01   +8.657179056611450e-02   +4.784882779414969e-01   +2.826573550255957e-01; -3.180558858120941e-01   -2.897089486120508e-01   +3.423077428631195e-01   -7.666608249016761e-01   -3.631758119457205e-01   -8.347420532533784e-01   +6.890591526501353e-01   -3.182596668445874e-01   +5.409051801166621e-01   -1.122432381776722e-02   +1.462771932505268e-01   +8.244887957261797e-02   +2.928778095114160e-03   +3.365849746608542e-01   -4.448064861829001e-02   +2.084340182671687e-01; -3.100226381075833e-01   -5.454846973560736e-01   +1.232565975153748e-01   -1.930325939328893e-01   +1.269711917906091e-01   +7.138648613869454e-01   +4.044827422632926e-01   -2.731597926471205e-01   +4.618537680135850e-01   +2.564214486674756e-01   -2.485373192438207e-01   -3.266214314360249e-01   -6.716270082982549e-01   -4.486552730502309e-02   +5.455530879164224e-01   -2.865830491918416e-01];
L2I_L2E_iAMPA_netcon = [+5.387759474510496e-04   +5.999663985856599e-01   -4.280868764730986e-01   +2.266227347604146e-03   -4.462313864934131e-02   -2.030250451323493e-01   +4.340391329452853e-01   -7.298449937873566e-02; +2.631235313734026e-01   -6.139133663463865e-01   -5.540084858846972e-01   -1.907827329199592e-01   +3.730974851571611e-01   +8.386755839755500e-02   +3.048568775907941e-01   -9.815538814789996e-04; -5.888890601525262e-01   -3.219122985664999e-01   -8.060473578853703e-01   +1.756859540404622e-01   +3.606988342612621e-01   +3.408032031510516e-03   -1.700002660372709e-01   +5.880254149555799e-01; +4.599100182567229e-01   -1.068634835201802e-02   +2.912359492097615e-01   -7.966795627466468e-01   -4.806829567350640e-01   -5.075025067657404e-01   +3.681042243961985e-01   +1.171054359843205e-01; -7.659535024813832e-02   +4.128196954420039e-01   -3.545356773294662e-01   -5.126773795174093e-01   +5.702183463988741e-02   +3.034846976849900e-02   -1.415817132511355e-01   +6.080749194072439e-02; +1.532659080131628e-01   +6.948163562847125e-01   +1.000808419921945e-01   -1.484716009824033e-01   -5.148750156335120e-01   -1.863729002500364e-01   -1.110463008005262e-01   +5.859603536951976e-01; +2.069854120210641e-01   +1.046595131016597e-01   +5.803741840629615e-01   +5.174671636060189e-01   +5.719260231725138e-01   +4.076019017004200e-01   -5.710545233970402e-01   -3.548828690553694e-03; -3.135881040593338e-01   +4.344432002096804e-01   +1.000000000000000e+00   +1.936887760483822e-01   -2.326853428650038e-01   +1.179851412785322e-01   +5.866381370520347e-01   +1.296915572777018e-01];
L2E_L2I_iGABA_netcon = [-5.724417993218257e-01   +7.051638190922207e-01   +9.302054101650449e-01   +1.069836539563724e-01   +2.639637286562344e-01   -3.705460883104633e-01   -4.968280596262908e-01   -2.301703874980114e-01; +6.465828144604443e-01   -3.132697010262961e-01   +6.855333909274832e-01   +5.693992736733005e-02   -3.650936615085665e-03   -4.115409895623087e-01   +2.558876133688429e-01   +4.378938328901996e-01; +6.419324261443984e-01   -1.350491505816350e-01   +5.230179253311519e-01   +9.347520813003317e-03   +5.165094710761011e-01   +6.203585245159925e-01   -3.599896697618048e-01   +2.901910208442033e-01; -6.490124507385651e-01   +3.247897407712028e-01   -7.242884630421400e-01   -1.799228571964795e-01   +3.804788923698195e-01   +1.136154359995900e-01   -5.568986859242602e-01   +7.196128977008897e-01; +6.205332380201459e-01   +5.594329808002307e-01   +4.894973610559149e-02   +5.273497196738675e-01   +3.722852876470118e-01   -4.313925522025990e-01   +5.128524159833638e-01   +1.000000000000000e+00; +2.909105545499548e-01   +9.080326574562117e-02   +5.153918746137696e-01   -3.489592245457209e-01   -5.057926168350777e-01   +3.536430506040648e-01   +5.892517059642702e-01   +1.773427095088333e-01; -3.612533312579142e-01   -4.415396231183908e-01   -4.452367983352974e-01   +3.650384700984201e-01   +6.482404712636887e-01   -1.592273463002709e-01   -1.764555768554106e-01   -6.825430038217076e-01; -2.991119911562118e-01   +5.210495870311231e-01   +3.979078075956708e-01   -8.271558622085873e-01   +5.056497681860709e-01   +3.060052880750763e-01   -1.300775969157061e-01   +2.518052326893520e-01];
L3E_L2E_iAMPA_netcon = [-6.820880592687587e-01   -7.529229588802561e-01   +1.338223601404853e-01   +6.176011667887458e-01   +4.768562980245495e-01   +4.089474996023890e-01   +6.357299762788706e-01   +3.169595151602861e-01   -8.741900846560414e-02   -1.434527821142281e-01   -2.813233247877663e-02   +1.518515665831265e-01; -7.421646648317312e-02   +1.057985174544192e-01   -1.619967562228826e-01   -7.110461193293597e-03   +5.733107240860971e-01   -1.431527031213830e-02   -5.155771425971809e-02   +2.951140352998147e-01   +2.028623001580980e-02   +1.000000000000000e+00   -3.172578195043747e-01   +1.396514320906840e-01; -4.736300514617769e-02   -9.295083706221684e-01   +1.100289705639205e-01   -4.039168580905772e-01   +8.722066572072860e-01   +1.015493552706682e-01   +7.769370663879696e-02   -3.683377436502621e-01   +4.461219947424393e-01   +5.485003076715033e-01   -4.082206569569585e-01   +2.930163099814664e-01; -9.762725474589837e-02   -1.941131532297828e-01   +3.230874382070664e-02   -5.956852965739225e-02   +2.666892567492640e-01   -2.968211749723145e-01   +6.491286221311430e-01   +1.743110747708546e-01   -2.531570769480608e-01   +5.504627169122298e-01   +6.819625434660664e-01   +3.693203336066435e-01; -8.913604982657949e-02   +5.601039301899906e-02   -5.397964986862233e-01   -3.300824506679388e-01   +4.442709667964576e-02   +5.099591566761121e-01   +7.672192028086149e-02   -1.644691348903851e-01   +9.857263156040283e-02   -3.245418767597717e-01   -5.137565192369677e-01   +1.861223013718457e-01; -2.737179911938788e-01   -1.213615931715395e-01   +6.168500051978238e-01   -6.273655946644920e-01   +1.956071015577960e-01   +2.925886541585919e-01   +7.975512681797930e-02   +5.184515165635964e-01   +2.914164175128178e-01   +1.116057256401646e-01   -1.818334673889861e-01   +1.099310293035958e-01; +5.757905446383994e-01   +3.256809885149097e-01   +3.155121002996542e-01   +3.757856748307833e-01   +5.206868098997615e-01   -2.728400752521621e-01   -5.340955722261319e-01   -3.491020403330766e-02   +2.345616874790054e-01   -2.217048408929588e-01   -8.285894911902523e-01   +6.397483759089134e-01; -2.159230735571354e-01   -2.579519874271507e-01   -1.173027694537175e-01   -6.667109644955860e-01   -8.037705854005019e-02   +1.633963239005429e-01   -5.884336761125512e-01   -1.147417688018181e-01   +4.235311714739401e-01   -1.200373354909144e-01   +3.415609685867925e-01   -8.450684448700116e-01];
L3I_L2I_iGABA_netcon = [-3.350188406755142e-01   +1.826356395400690e-01   +4.051828670369517e-01   -5.987427048912514e-01   +9.241309578083091e-02   +1.249324410380381e-01   -4.071284607208285e-01   -6.073295539340807e-01   -4.589767708559870e-01   -7.842137922713439e-01   -7.702405456548873e-02   +4.289812702070497e-01; +2.888913300685126e-01   +8.246743648559043e-01   +2.506941224853722e-01   +9.027632089780253e-02   -1.833539313382958e-01   -5.699094968718649e-02   -1.410169619713889e-01   -5.523531761841773e-02   -1.497297119079530e-01   +2.875558002130912e-01   -9.266608886273804e-01   -6.394563712765684e-01; -6.420801491486728e-01   -1.521466973363834e-01   -6.094928474629622e-01   +1.490782783924645e-01   -2.277337206668776e-01   +1.000000000000000e+00   +3.437696978145693e-01   -3.245887534406054e-02   +9.672113271165789e-02   -1.728269049185940e-01   +1.216542579316814e-01   -7.454772634430857e-01; +4.827313559431236e-01   -7.670615494723187e-03   -2.809799350970890e-01   +6.101251078172288e-01   +4.084946441689037e-01   -2.292651353588532e-01   +2.083906932909664e-01   +2.590484571396712e-01   -4.785131871940277e-01   -4.589885028052287e-01   +5.659221055823929e-01   -1.936320243819112e-01; +5.119735156837022e-01   -2.461444870730198e-01   -1.174937775913167e-01   +5.768949525072247e-01   -5.869342468412353e-01   +1.361827009612965e-01   -4.303946461529541e-01   +6.313497125403512e-01   -5.876390642938851e-01   +2.703588648489525e-01   -1.360285317608444e-01   +6.176920854817188e-01; +5.030949627811678e-01   -3.834818471319795e-01   -4.041875048739459e-01   +2.983792301040447e-01   +9.799296780467150e-02   -6.393331557723806e-01   +2.701030077392234e-01   -5.085630305379966e-01   +3.547155911987079e-01   +8.742741456023804e-01   -3.289301450198703e-01   +7.567414218835117e-01; +2.889767661098998e-01   -8.237401142950396e-02   -2.428549514735307e-01   +3.758650911944376e-02   -8.362315736334400e-01   -1.191764721583159e-01   -1.391200664023019e-01   -3.789843391990819e-01   +5.820770895215551e-01   +4.432274249939276e-01   -4.921762857948527e-01   +3.364475556226038e-01; +8.877305843460138e-01   +2.974507455337247e-01   +8.049745301222268e-02   -2.055656942418894e-01   +8.604628751264336e-02   +6.273188038395260e-01   -7.974017531013755e-01   -3.023508447136504e-01   +3.419131714836792e-01   -2.069820011961590e-01   -6.197090127071059e-01   -8.109183657178880e-01];
L2E_L3E_iAMPA_netcon = [+7.229206439438604e-01   +3.251528160373442e-01   -3.647843647584443e-01   +4.397521344631531e-02   -3.300496010552913e-01   +7.928601780221342e-02   -2.894961266519042e-01   +2.450059627939374e-01; -3.169274767659951e-01   +4.128008301944409e-02   +2.040257639404912e-01   -5.214316902921072e-01   -4.928420544270633e-01   -3.814127702696706e-01   +1.812866186533656e-01   +1.245557984330625e-01; +5.329625460432944e-01   -3.205117167388804e-01   +5.582326654161524e-01   -3.331987727172575e-01   +4.000587343256526e-01   +3.420289932472232e-02   +2.000822659724277e-01   +5.132640641313717e-01; -4.784182482967238e-02   +1.741362272057901e-01   -5.168621251677069e-03   -1.766427824603171e-01   -3.056945325913721e-01   -2.417198619323754e-01   +1.565127332482541e-01   -4.122302890133407e-02; +3.135683170388343e-01   +5.428647118136497e-01   +7.652015858811430e-01   -5.611328799772366e-01   +5.033150337784579e-01   -2.432746573531069e-01   -4.912173974011309e-01   +4.367247935490412e-01; -6.770853912674754e-01   -2.132000391027232e-01   +2.903702524440401e-01   +4.423703912709356e-02   -1.828425937205987e-01   +6.388879971749715e-01   +7.106022567478662e-02   +3.458374638710753e-01; -2.823000608693632e-01   -7.542145227354329e-01   -1.803020347120682e-01   -2.164377535362939e-01   -8.519970272632521e-02   -4.298784290186947e-01   +6.493773112832495e-01   -3.507980868839696e-01; +3.740760010312515e-02   -2.020382592538816e-03   +5.523038250904799e-01   -7.335863544749284e-01   +1.626344144232733e-01   +4.922802787550742e-01   +2.274221361464888e-01   -5.433585054685988e-01; +2.884146661455117e-01   +1.963411144957476e-01   -1.755229284796167e-01   -2.517268116653518e-01   -5.494000397673061e-01   -2.681333814471549e-01   -7.180435021036753e-01   -5.294130607254214e-01; +7.083842234867056e-02   -1.114324107464103e-02   -3.230084821436407e-02   +1.341871383895629e-01   +4.352815942381285e-01   +2.564688338239810e-01   +2.433310283889722e-01   +4.003886654945061e-01; +5.926780775691276e-01   -5.505777039083306e-01   +3.372200907342461e-01   -3.476846512470271e-01   +6.868658721026847e-01   +3.981995858648146e-01   +3.265143704208556e-01   -8.140719565744130e-02; +5.499202088574313e-02   +8.795833972718231e-01   +9.373953976608881e-02   -1.000000000000000e+00   +5.491540151596414e-02   -9.266010779292115e-01   -4.063763946126342e-01   +6.850686872498933e-01];
L2I_L3I_iGABA_netcon = [-1.432870219627324e-02   -4.230649249632548e-01   -5.315978794815633e-01   -5.138000747402148e-01   -3.392704064508499e-01   +7.102104302091894e-02   -5.510700500391595e-02   +5.358097187564884e-01; -5.482926385745746e-01   +4.308493915406818e-01   +8.380075939926646e-01   -5.124326900623150e-02   +7.640940682471645e-01   -2.075130126119832e-01   -1.826973026555220e-01   -1.127985895856533e-01; +3.931140784918267e-01   +1.983253264638047e-01   -5.391794306881653e-01   -8.104643058303992e-02   +5.172090894166637e-01   -2.334183454958519e-01   -2.382816702511310e-02   -1.607713430003481e-01; +4.811915628679727e-01   -7.863891254753792e-02   +5.429068012427539e-01   +4.565890845327422e-01   +5.940727533518474e-01   -1.929628574557644e-01   +1.000000000000000e+00   +7.640696659527987e-01; -2.753539399107801e-01   +3.169742994376550e-01   +7.624828714209170e-02   +3.760939359105558e-01   +2.870216211105217e-01   -1.620652967492349e-01   +7.973064977790474e-01   +3.815935822197229e-01; +6.627884508532490e-01   +4.459379060475418e-01   -2.935983382150805e-01   -2.883087165995901e-03   -9.827479175301111e-02   -4.373264109961816e-01   +5.630529686021943e-01   -7.898464274039633e-01; +3.235706310936443e-01   +1.092567687367391e-02   -2.476308217666146e-01   +2.683257273081100e-01   +5.718584480724679e-01   -7.052353035013685e-02   +3.420637089264192e-01   +5.431675408858463e-01; -2.040732423425717e-01   +7.646352387260279e-02   +3.747542178858991e-01   -2.928882322215673e-01   -3.741981516715154e-01   +4.109177597720153e-02   -5.472835534904247e-01   +2.547192609636524e-01; -7.765572664741463e-02   -3.082774053955348e-01   -3.689904474311869e-01   +4.765664283574147e-01   -4.730514008969717e-01   -1.873992533072498e-01   -4.746089017013627e-01   +5.676317509682607e-01; -3.185353008341518e-01   -2.458194823130629e-01   -1.325903272165593e-01   -7.828608114494288e-01   -1.155587700989930e-01   +3.033556505705436e-01   +3.541127201538732e-01   +6.126346826036854e-01; -3.119257160343635e-01   -1.259641662521372e-01   +2.235091115664661e-01   -2.144160752719191e-01   +2.712346654097035e-01   +3.904031065391484e-01   +1.768134114921795e-01   +3.315545975200471e-01; -2.274322380169231e-01   -6.552100135319930e-01   -1.765123717606912e-01   +3.019290610658763e-01   +7.269453089925617e-01   -1.757182331456877e-01   +2.134853199634482e-01   -5.182637509619876e-01];
L3I_L3E_iAMPA_netcon = [+5.829309890437968e-02   -1.000000000000000e+00   -2.057684681775705e-01   -1.506967848905539e-01   +9.320745022491927e-02   -4.951010351872570e-01   +8.400439141092178e-02   -6.432379788004336e-03   -1.629849345004226e-01   -5.318672079036447e-01   +2.697954793527963e-02   -6.524427327764103e-01; +3.754220770101708e-01   +4.665519106018407e-01   -9.479052564284084e-01   +6.253488465488947e-01   -5.249211018068535e-02   +9.760608766770860e-02   +4.058806431894962e-01   +4.843448133063136e-01   -1.660818331117086e-01   +4.651291223380248e-01   +1.172158502600117e-01   +2.603638633228880e-01; -3.618248081949083e-02   -3.146045470624659e-01   -5.941891948474165e-01   -2.323479221646951e-01   +1.762228913320885e-01   +3.742199199390089e-01   +1.898741748764432e-01   +5.743524099071902e-01   +6.857315552869538e-02   -2.950514906454922e-01   +3.182149902781372e-01   +7.766928731186393e-01; +1.976715117322844e-02   +4.923329767588642e-01   +6.328495753889155e-02   -2.769630493157311e-01   -4.117987915441266e-02   +5.137534472847101e-01   +1.768236355150331e-01   -2.330891578012654e-01   -6.660734233698802e-01   -1.409064474018789e-01   +3.131728743009008e-01   +3.468983117099385e-01; -4.475351742598779e-01   +5.209476399848475e-01   +2.626175854680745e-01   +6.253582156994748e-01   -3.939662822069552e-01   +2.126417852860407e-01   +1.714351186852134e-01   +6.770930574050937e-01   -1.649512754536997e-01   +2.201676765389365e-01   -8.965643742719841e-01   +1.012361654245627e-01; +1.916678201028483e-01   +5.115273972882025e-01   +2.730806389792142e-01   +1.822552627182048e-01   +8.992663198560560e-02   +4.159000349985331e-01   -2.177027146265599e-02   -3.323393665571127e-01   -3.822722281011849e-01   +4.934811575704550e-01   +4.912067082807890e-01   +1.318156703273932e-01; -4.519171663668248e-01   +3.835444923423443e-01   -8.690639128070683e-02   -3.699541161289015e-01   +1.047571675936861e-01   -3.911256437789920e-01   +7.825582726117629e-01   +2.712732320867766e-02   -6.275823378309681e-02   +1.623437466262556e-02   -7.532839217470979e-01   -4.995876968234575e-01; +7.137408396547958e-01   -6.531611726789670e-01   +6.393331668072320e-02   -4.170764686114599e-01   +6.751991956071673e-01   -3.070829335492098e-01   -3.767589138139786e-01   +3.669080659313060e-01   -2.041423003352268e-01   +2.507139534694444e-01   +4.229107399840158e-01   +1.761213211028154e-01; +8.288274254814673e-02   +3.994526161177349e-01   +7.770798943536186e-02   -7.830507293785092e-01   +1.816374655098635e-01   +9.031322428394428e-02   +6.214749665800200e-02   -6.915557797816159e-01   -3.301415783605095e-01   -2.489375605147737e-01   +2.243094568926815e-01   -5.438207028403039e-01; +6.682678549744934e-01   -5.686266380278441e-01   +4.283441330431103e-01   +1.683447464871300e-01   +3.857490614693125e-01   +6.692676319319115e-01   -5.989955017325082e-02   -2.812704386612438e-01   -1.582260057036564e-01   +6.533151989478322e-01   -7.543403823657550e-01   -4.849658115482187e-01; -4.021099961812022e-01   +6.931241611513168e-01   +3.607993910548885e-02   +4.520534108405129e-01   -2.124015294635100e-01   -1.130531820978415e-01   +5.233027776983176e-01   -3.931285044596635e-01   +7.031820584223616e-01   -6.902216666066819e-03   -1.397634718581476e-01   -6.918540043968585e-02; +4.234384829268180e-01   -1.164782933187553e-01   +2.514696213263989e-01   -2.017415872955907e-02   +3.367368281210075e-01   -5.775578354108688e-01   +1.767024216465676e-01   +1.676760657412688e-01   -5.218371893781006e-01   +4.981078619203283e-02   +5.093831063419556e-01   -2.762668145333999e-01];
L3E_L3I_iGABA_netcon = [-1.731365538281213e-01   -4.061568454115145e-01   +5.207821351800183e-01   +1.826536558255844e-01   -6.685945605425166e-01   -5.798089845216960e-01   +8.786029058343979e-02   -4.928398191550933e-01   -5.916314184922974e-02   -4.702322532606652e-01   -8.699506710612416e-01   -6.220956874557364e-01; -6.800056493748217e-01   -4.906495769569584e-01   -1.469396977609321e-01   +5.714007765525684e-01   -5.142411012934256e-01   +1.500824469896637e-01   -8.754656084940161e-01   -3.960624216803473e-01   -9.801709734365076e-01   -4.753195483255620e-03   -6.301463542848104e-01   -1.451292505440125e-01; -1.958152231022864e-01   -2.327837892928049e-01   +5.015020335692083e-01   +4.997015885545689e-01   -4.702173376076278e-02   -1.785894701544294e-01   +5.242636990821876e-02   +6.077339596237046e-02   -6.881829253116448e-01   +6.746147802727039e-02   -2.240246959447723e-01   +5.470141153822956e-01; +5.938405004185837e-01   -6.625474834082893e-01   -6.001969448113523e-02   +1.743843703464890e-01   -1.450086241619846e-01   -4.299262755375678e-02   -4.140803766594258e-01   +2.739546662064722e-01   -4.440600370462462e-01   -3.121161863284335e-01   +3.513201821143344e-01   +8.212390702002622e-01; -8.421689666526629e-01   +7.769743498856803e-01   +2.554587335197768e-01   +4.268336756077483e-01   -4.431384143108347e-01   -4.335199960255734e-01   +5.800435800191633e-01   -4.401709595568875e-01   -8.910217904316070e-02   +2.312652995161422e-01   -4.777303068898714e-01   -1.936216859542557e-01; +3.185165982821374e-01   -4.157141675686953e-01   +3.251504662127368e-01   -5.347423441705697e-01   +1.894601075067214e-01   +1.028636562308134e-01   -6.125888711061782e-01   -3.445312563078135e-01   +6.092396516724503e-01   -5.612518689760859e-01   +1.811094316100472e-01   -1.076039208209221e-01; -5.595269129839094e-01   -4.588654068755580e-01   -3.265088733891550e-03   +8.242638575278334e-01   -2.715810051536606e-01   +5.601731933512838e-01   +2.405078108090258e-01   -3.683590335508424e-01   -3.084282005157918e-01   +2.567509514658112e-01   +9.142415211968314e-01   -1.546077486164766e-01; +4.920347247622662e-01   -4.006259238803827e-01   -7.165737044150035e-01   -4.447263349935050e-01   +8.658326242078749e-01   -1.149776987501790e-01   -3.014294474587420e-01   -2.304467026719391e-01   +3.297981170095721e-01   +5.039875251247606e-01   -3.651115816150814e-02   +2.807561682927255e-01; -1.250036955472467e-01   +5.942282511584419e-01   -1.138721528485243e-02   +4.565306229573391e-01   +8.953325773105082e-02   +6.207171910523118e-01   +5.127626171534254e-01   +7.972713593836439e-01   -3.881295983010919e-01   +9.179179926406628e-02   +1.891151235372064e-01   -3.107735407207680e-01; +6.147518323652107e-01   -1.603688310453046e-01   +4.750026326875945e-01   +6.447593963520516e-01   +1.902798074990134e-01   -7.034504643486712e-01   -2.854246218654047e-01   -5.032007058502628e-01   +1.426377604097666e-01   +3.555296244070329e-01   -1.364528116980444e-01   -4.481463647718091e-01; +6.018876781243885e-01   +6.287651731983310e-01   +7.958537684855831e-01   +7.068312844744071e-01   +4.096138653894876e-01   +8.868088543211758e-01   -9.931490049695696e-02   -9.737856720286769e-02   +3.182882499671126e-01   +1.085430461718289e-01   -4.681373654977415e-01   +4.872955304449502e-01; -5.201674077538979e-01   -1.000000000000000e+00   +4.923716783346301e-01   -1.591326036649666e-01   +2.994769838320280e-01   +2.303567278513900e-01   +8.620754006995658e-01   +1.390636365123265e-02   +4.065063152590289e-01   -4.134383931591189e-01   +4.937789125579741e-01   +4.407645677383067e-01];
L2E_Input1_iAMPA_netcon = [-9.135243926012139e-02   -8.524945169202002e-01   +4.105372058720944e-01   -8.196777165213175e-01   -8.710511606516208e-01   +1.000000000000000e+00   +4.983744594251253e-01   +5.810070669503976e-01];
L2I_Input2_iAMPA_netcon = [-1.203748251521677e-01   +8.030940500814313e-01   -3.903402280386116e-01   +1.000000000000000e+00   -4.037854755828435e-01   -4.970367722670884e-01   +2.356080435511333e-01   +3.875096450708007e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
