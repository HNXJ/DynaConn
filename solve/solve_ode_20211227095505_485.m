function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-4.096100722954594e-01   +7.240667492736783e-02   +1.100637790027617e-01   +2.668263739478285e-01   +1.271409751335828e-01   -2.266519020124961e-01   -1.678814278851066e-01   -4.042082278585720e-01   -4.483236594768191e-01   -1.482158265541958e-02   +1.369148461666111e-01   +2.187513774473860e-01   -1.528898050733776e-01   -3.000435056458000e-01   +3.491798733751155e-01   -1.912842330193171e-01; +3.616626976124719e-01   +2.112436840624272e-01   +6.108310024794174e-01   -5.393239471794637e-01   +7.643469709451023e-02   -1.574313696520417e-01   -3.362375964839791e-01   +1.502738078225305e-01   +1.676465699990803e-01   -6.787372357709404e-03   +1.607053105527120e-01   -1.767952613632774e-01   +1.165977512671955e-01   +6.093411147915055e-02   -1.737718312789301e-01   +2.444914109429887e-01; +1.437614062558775e-01   -1.182986376930491e-01   -1.382221166749235e-01   -1.191932115464635e-01   +3.398967264731902e-01   +4.720268105258953e-01   -1.953660991759283e-01   +5.608123494698727e-02   -2.670925349417544e-02   -1.341857697861339e-01   +1.941151420030407e-01   -2.444003593433963e-02   -2.205528806752082e-01   +4.340650153725965e-01   +2.674191793999480e-01   -2.751341776206396e-01; -6.793007765425549e-02   -2.081584503680877e-01   +2.248778880931127e-01   -1.975926706992496e-01   -2.717821778116400e-02   +3.483594301927547e-01   +3.375422581487184e-01   +1.970156750550075e-01   +1.357781611684566e-01   +2.935288430414956e-01   -2.043827688899548e-01   -5.639419042410887e-01   +3.159964779361867e-01   +2.039049220297666e-01   -5.528317696077735e-02   +2.743191766428058e-01; -7.353432788233807e-02   -2.012865299165010e-01   +4.117520429406724e-02   +3.677698315113419e-01   +1.434889611531077e-01   +1.259854439774289e-01   -1.195340488676571e-01   -3.674626575735258e-01   +6.966874422727601e-02   -8.446837556412098e-02   +6.097371807079552e-02   -3.715957276941826e-01   +4.092890974917596e-02   +8.087215871900548e-02   -9.641634586531952e-02   -2.570413102332300e-01; -1.990755866002613e-01   +7.684210762483973e-02   -9.835951970715839e-02   +1.456321787204090e-01   -1.647591858958485e-01   -8.420417541618327e-02   -5.681367528090886e-02   -2.333121061989679e-01   -1.406737244846710e-01   +2.175072499283923e-02   +2.564358004216116e-02   +1.664205809186849e-01   -3.979756317550404e-01   -3.765954984365141e-02   +3.367266123901147e-01   -1.009109094386816e-01; -1.069663053467113e-01   +1.573223720044662e-01   -1.045936299930866e-02   +1.951617250570878e-01   +2.269489828488375e-01   +2.715508938634057e-01   -5.531170510044679e-02   -6.596599732820785e-02   -2.226265502210484e-02   -1.569554385933504e-01   -4.918073790377862e-01   -3.925471655709546e-01   +1.709720352233839e-01   +4.526613307966292e-01   -3.312467680597959e-01   -1.065361812407853e-01; -2.089038989445917e-01   +2.003534802951377e-01   +2.756362697146724e-01   -3.400461250254747e-02   -2.596083991252451e-01   +7.436012488895147e-02   +5.879811701508478e-02   -1.898276699662683e-01   +1.307302626315721e-02   +2.441652019484367e-01   -2.182158810734035e-01   +8.336279295145119e-02   +3.278482931946231e-01   -4.865891487737221e-02   +8.573471254083652e-02   +1.559420828262454e-01; -4.040116527640567e-03   +7.565506410367462e-02   +4.194583341173937e-02   +4.154624387402235e-02   -1.523491960018088e-02   +2.969209944040507e-01   +1.176760510323619e-01   +2.301724454856642e-01   +5.600876042569007e-02   +3.241020512851092e-03   -2.520814010589206e-01   +1.102153501186061e-01   +2.138652634847298e-01   -3.852206018375277e-01   +7.555022025875080e-02   +1.984544385134981e-02; -7.405089131036727e-02   +2.030973126094011e-01   -1.312486923267134e-01   +4.001916220393552e-01   -7.013194951575691e-02   -2.853363466318822e-01   +3.319636798302210e-02   -2.762829140581237e-01   +2.109296473947548e-01   -2.037626092243723e-02   +1.956395001624125e-01   -2.622644588520319e-01   +1.709913975648517e-01   +2.954710832441812e-01   -3.754620856054306e-01   -3.207101947101152e-01; -2.017084703760638e-01   +2.046407002081692e-01   -2.400731488340273e-01   -1.049543477530110e-01   +1.279326408903033e-01   -2.089970978158154e-01   -3.548383683782753e-01   +1.586775939819315e-01   -2.943296250162337e-02   +3.365394964831516e-02   +1.844879086419516e-01   -3.618778856170745e-01   -1.797755479784344e-01   +8.633710050534174e-02   -3.330739326062668e-01   -3.080424761649654e-01; +1.646149865440692e-02   -2.141090997604707e-01   +2.525963475651668e-01   -8.292572168003574e-03   -3.007003982052011e-01   -1.346878446077630e-02   +3.151336539518994e-02   -2.362550723434864e-01   +1.320753550780638e-01   -2.674350905931331e-01   +3.448709704944150e-01   -8.102930716212137e-02   +5.080292899315449e-02   -2.487054852478655e-01   +3.569077642584616e-02   +7.899650026307847e-02; +1.964924426672369e-01   -2.709958900332309e-01   +6.891088093964709e-01   +1.159947649682209e-01   -1.712929054656377e-01   +1.708257893197487e-01   +8.894694744718154e-02   +1.247985697541460e-01   -3.966651987014146e-01   -5.212843689425384e-01   +6.819298601360806e-02   +9.893382827830713e-02   -4.670608615928600e-01   -3.530605910682273e-01   -9.102547647115111e-02   +2.349804434172872e-01; -2.570810293069618e-01   +2.952205302974513e-01   +2.152321444251433e-01   -2.106577831500926e-01   -2.277638693694170e-02   -7.068596196942459e-03   +2.488347102853480e-02   +1.770937337195839e-01   +6.207496233695411e-02   +1.172963271959521e-01   -3.092618307962255e-01   +5.734820676764590e-03   +1.761001669607598e-01   +5.599057960979167e-02   -2.962094628831520e-01   +2.128144920843791e-01; -8.196781515829393e-02   +3.406692439760309e-02   +2.468278672026052e-01   -2.191830052525168e-01   -2.487393626900041e-02   +3.553740788933285e-02   +2.736781446024448e-01   +2.401307577172903e-01   -1.325749130191584e-01   -3.365144231792557e-01   -1.730678969656771e-01   +6.304576595666733e-02   -5.123510337933398e-01   +1.921319100364061e-01   -7.029592417826178e-04   +2.870630210412280e-01; +1.716286688558411e-01   -3.897668004417504e-01   -2.098058354010644e-01   -6.287574018501718e-04   -4.353009552232694e-01   +2.282682157496671e-01   +5.644283482085815e-02   +1.292855029847148e-01   +1.309887056677751e-02   +3.338860742832634e-01   -5.877106136524785e-02   +2.901098793044827e-01   -5.823284191257883e-03   +3.696264012393890e-02   +2.268875314661246e-01   +3.226283703374402e-01];
L1E_L1I_iGABA_netcon = [-3.400246265660699e-01   -1.844566782482076e-01   +9.058919908504270e-02   -2.685426302834344e-01   +3.726635999596422e-01   +4.624131295838210e-02   +1.612692983658029e-02   +3.032681714966179e-03   -2.378384423707855e-02   -2.331124802428413e-01   -1.800756494556079e-01   -8.802897861160078e-02   -1.730198549374948e-01   +9.676069473863294e-02   -1.060484909238540e-01   +8.312427683950480e-02; -1.155108994806529e-01   +6.836942943278096e-02   -2.250644405545067e-01   -1.158283926793685e-01   -3.497003838573994e-02   +3.373146968237983e-02   +4.581166240667215e-01   +3.540969846618616e-01   -1.187776705403341e-01   +7.471240275183644e-02   -1.723634131382393e-01   -4.533660948178528e-01   -5.475685000271141e-01   +1.206426791988540e-01   +6.336072012874147e-02   -5.442166727371042e-01; -3.187925146807266e-01   +1.397828566402374e-01   -2.304948703775424e-01   -6.882978508287724e-02   -1.697268789631556e-01   +4.463160334739505e-02   -5.407364769400348e-02   -1.038442613270979e-01   +4.106382182535200e-02   +9.335111649603023e-02   +1.796776851067916e-01   +4.115822809070693e-02   +2.083203505551321e-01   +5.514355278900739e-02   -2.223733244764961e-01   +1.456074537041839e-01; +2.487358227183681e-01   -4.118180959235950e-01   +3.704736974539566e-01   +3.102418317422193e-01   +7.884817866953997e-03   -5.234964177537482e-02   +1.965699879779748e-02   -1.811573221178171e-01   -1.517240693258450e-02   +1.147233471332822e-01   +2.256810089671204e-01   -3.799517911669155e-01   -2.815780947444235e-02   -2.569709797543471e-01   +1.203784009970624e-01   +1.539959335654892e-01; -1.728164319109420e-01   -4.326029815056731e-01   +3.842090387684022e-01   +3.076271454807087e-01   -8.330588773112858e-02   +1.585048801463292e-01   +1.159857840845742e-01   +1.073015176903558e-01   -3.058581909043460e-01   -2.790190317144783e-02   +2.108554487090414e-01   +4.687564186057493e-02   -4.118548338881453e-01   +4.572939727455717e-01   +1.425493936328744e-01   -3.412406163133930e-02; +7.212989397195360e-02   -2.334665067291236e-01   -4.460081192938828e-01   -4.041192961367031e-01   +3.247345708470274e-01   -1.695240456605265e-01   +2.435373580389351e-01   +3.469312954367759e-01   +5.157076588350460e-01   -1.146575511440829e-01   -3.262348630330409e-01   +1.694198774430287e-01   +2.366876096487369e-01   +1.634286591432498e-01   +1.850234128649091e-01   +1.800759314418690e-01; -1.464512959721525e-01   +3.159478532774669e-02   -1.251191859575344e-01   -1.510095476248172e-01   +4.455785262679499e-02   +1.289149608591293e-01   -5.696093720274294e-02   -5.788853930248132e-02   -1.496159417412884e-01   +2.969153086906651e-01   -2.281586678485677e-01   -2.375457988265889e-01   +3.043283302444447e-02   -3.150178026296224e-02   +7.515912943171776e-04   -6.730006397472076e-02; -2.855873470521904e-01   +1.985983825057687e-01   +2.305816664162414e-01   +2.846639492427824e-02   -2.652263556445745e-01   +1.358687619874163e-02   -1.352147803846656e-01   +9.532457192589978e-02   -3.840181591480397e-02   +2.724688309927104e-01   -9.982830134762012e-02   +3.096749283428106e-02   -1.014424646014170e-01   +3.089323445144169e-01   +3.526024384118279e-02   +1.515875349013312e-01; -3.558642638450632e-02   -1.950782725273814e-01   -2.247464534344610e-01   +7.383951176643698e-02   +1.122451781011048e-01   -2.986024458523298e-01   -1.211625521076222e-01   +2.816669632977811e-01   -2.829721783497960e-02   -1.253496727061261e-01   +2.765829188761877e-01   -3.134052599507397e-01   -1.378337886006788e-01   -6.564795776692861e-03   +3.127697508416577e-01   +1.372132472856967e-01; +1.254032335700099e-02   -4.271456218520142e-01   -1.155925298745292e-01   +4.968479103200315e-01   -5.873274294764370e-02   +3.268543776150679e-01   -2.841115797513556e-01   -1.214661424458169e-02   -1.686907889387926e-01   -1.605516276881392e-01   -3.723848973231852e-01   -1.483501267381628e-01   +5.046816256537586e-01   -2.796065771403432e-01   +1.033442614474217e-01   -2.709592313825085e-01; -1.937906533582615e-01   -3.079834862147375e-01   +1.044316441909637e-01   +1.422060612057830e-01   +2.700972388010466e-01   -1.347226814535703e-01   +1.867988087750725e-01   -2.469712864734255e-01   -2.521818260564565e-01   -1.797678831914147e-01   -8.410253697064642e-02   +7.359369970934240e-02   -3.517264446793759e-02   +1.361430167954531e-01   -1.009632522472070e-01   +1.414178494727243e-01; +3.857906981124302e-01   +7.211220788089227e-02   -2.384166779326748e-02   -3.113205418181221e-01   +2.946169511406860e-02   -4.144068355723665e-02   -6.935302612326086e-02   +2.132957803685075e-01   +5.007686896149409e-01   -3.114998730493444e-01   +1.108469413499745e-01   -1.133631344864691e-01   +1.633577573711170e-01   +8.241117431999284e-02   +2.999801033133853e-02   -1.116284366913216e-01; +7.503896135275268e-02   -2.968100016457631e-01   -2.288477745148005e-01   +1.355623843142041e-01   +7.040103966144386e-02   -7.531927786152220e-02   -2.421180675451540e-01   +3.215723380995713e-01   +3.241971245209708e-01   -8.820777287571399e-02   +1.749204466602721e-01   +1.935137187540327e-01   -1.846907609210213e-01   -3.228882737034712e-01   -1.339106901096915e-01   +3.361115562171252e-01; -2.422550962512481e-01   -2.708392228780651e-02   +2.095670230957674e-01   -3.071724605264364e-01   +1.400791229356604e-01   -2.230673623224017e-01   -1.068614504256750e-01   +9.405599743167181e-04   -2.617870459223984e-01   -3.256959802029885e-01   +2.254590524686841e-02   +1.890100344904571e-01   +2.505780212288546e-01   +1.601340285656210e-01   +8.222726706213720e-02   +1.196757616537045e-01; -2.593018437583924e-01   +6.387855199152082e-02   -1.393871078048965e-01   +1.936595904836125e-01   +4.619156276586415e-01   +3.754652222218079e-01   -1.058535534481011e-01   -1.142010636077049e-01   -9.419887868492971e-02   -9.754817133423492e-02   -2.115430345055787e-01   +9.392230384464564e-02   +3.130415447789326e-01   -2.424147337472357e-01   -1.386540522772504e-01   -3.068862284520066e-02; -4.800741027290226e-01   +5.263149128166236e-02   +1.636415041997847e-02   -2.544534704627044e-01   +4.720779997545797e-01   +2.118095377779053e-01   +2.131445893186480e-01   +1.661828740759901e-01   +7.461959245996512e-02   -1.449253743460374e-01   -1.591345078411991e-01   +3.483551376924457e-01   +3.825452040804348e-01   -7.919039253712959e-02   -4.784807389710266e-04   +5.943467531702218e-02];
L2I_L1I_iGABA_netcon = [-2.971729765835623e-01   -2.704649401981279e-01   +5.421743444131883e-01   +2.163943155936322e-02   -4.371715795969813e-01   +5.365138607173991e-02   +2.878204673907654e-01   -7.297205632998227e-02; +1.313996681295513e-01   +2.003510106097487e-01   -2.756260954701237e-02   -1.116572291595180e-01   -2.932814322085645e-01   -5.111073651523060e-02   +1.525682262313233e-01   +4.649376943177456e-03; -3.012472586252249e-01   +1.114952018702072e-01   +2.218312119379304e-01   +1.939016180783819e-01   -7.080735462854967e-02   -3.549680408462624e-01   -4.289577294234322e-01   -3.753586114985332e-01; +1.953918415509890e-01   +2.088187543562505e-01   -1.324573733849329e-01   +2.405680780640497e-02   +1.595628660586394e-01   -9.789490541699945e-02   +9.355284909354650e-02   -7.057824838258339e-02; -6.237949661426687e-02   -4.963156461573092e-01   -1.612532669103079e-01   +3.164318207676281e-02   +1.925036565840181e-01   +1.175056640657440e-01   -1.652877723867654e-01   -1.033957908119250e-01; +4.698286620721956e-01   +7.322156840952648e-02   -7.796840987563805e-02   -3.152235802235591e-01   +1.101058171578160e-01   +3.978008434659915e-01   +1.581853097579339e-02   -1.805054060424792e-01; -2.385423026506323e-01   -3.160966561090003e-01   -2.753439415778445e-01   +3.288990207548233e-01   -2.955530219619866e-01   +1.750927600908231e-02   -1.884469237102540e-01   -5.432269486493471e-02; -1.057782890220080e-01   +5.287823510006090e-04   -5.183562604693046e-02   -9.994399592792509e-02   +1.425569683985540e-01   +1.160619781622782e-03   +1.822654367326569e-01   +5.334823475359131e-01; -1.237606721756243e-02   -3.374065412891271e-01   -2.058173470141212e-01   -1.807788816000983e-02   -4.013096962164761e-02   -1.663252777309465e-02   -2.497588512390347e-02   +1.283969990377605e-01; +2.468043742824666e-03   -9.179099676485555e-02   -1.372535752286256e-01   +4.785027511663095e-02   +3.596067116114782e-01   -1.349485116789782e-01   +1.501759482572066e-01   +2.315434789080463e-01; -1.274153702964539e-01   +3.877972446496733e-02   +3.225046068704681e-01   +1.436771208958118e-01   -2.693216143012151e-01   -1.947609605187956e-01   -3.445065878940513e-01   +1.748865233755695e-02; -3.017757903015839e-02   -6.169971171820521e-02   +7.366861618901696e-02   +3.812641024333166e-02   +3.447219167091697e-02   -2.704354669172967e-01   +1.982920716887859e-01   +1.155214223720739e-01; -8.040671289990119e-02   -1.666029654928541e-02   +7.956911370763686e-02   +3.998962219643033e-02   -3.261006538086390e-01   +1.153338795234510e-01   +1.185195131387876e-01   -1.380298522842440e-01; -7.660135775593135e-02   -8.679011257688507e-02   -6.801933731585816e-02   +2.205564464790372e-01   -3.607688524917421e-02   +1.116422506124704e-01   -4.297487118407497e-04   -3.363744512448973e-01; +2.366254701678666e-01   +1.888847743296390e-02   +2.974999551814957e-01   +2.673077935223873e-01   +4.169048726386245e-01   -1.554544630102439e-01   +1.493133935440763e-02   +9.464600884059329e-02; +3.481393656729355e-01   -3.696234274433731e-01   +7.138848599874129e-02   -6.520994621646321e-02   +8.509953168140175e-02   +1.188243863638501e-01   +1.333407583306377e-01   -2.960545640370721e-02];
L1I_L2I_iGABA_netcon = [-3.192512484304976e-01   -4.273327151335256e-01   +4.474337844872323e-02   -2.379341819435099e-02   +3.875374296471695e-02   +1.237680972387864e-01   +2.015872807477111e-01   +2.488117913860999e-01   -2.786895603707229e-02   +2.622361622294502e-02   +3.655523987263411e-02   +1.886861623627570e-01   -2.841245926021384e-01   -2.143586598255304e-01   -4.011367905987267e-02   -2.681444624867432e-01; -3.282395815625277e-01   +3.184190448860618e-01   -2.711220788755103e-01   -1.980409995534378e-01   -1.031153427841570e-01   -2.162152804544599e-01   -4.095378181584119e-01   +1.375948777261797e-01   -2.421131057224679e-01   -5.014199183149604e-01   -2.081962240302124e-01   +2.540439223456553e-01   -1.833649573824671e-01   +7.419043700788387e-02   -4.289260786626527e-02   -1.955016536035568e-01; +2.139687694078064e-01   +5.602846164213987e-02   -3.960455414508777e-01   +2.211817293721284e-01   +3.258070718704638e-01   -2.195878799612763e-01   +2.479754517144843e-01   -9.456583486813518e-02   +2.729796211766136e-01   +2.384424320623776e-01   -1.554218636692900e-01   -7.998806796275057e-02   +2.275303164272358e-01   -2.933211154428037e-01   +4.137151898563628e-01   -4.068024898435700e-01; +6.017839225415050e-02   -3.000771095073370e-01   +1.055188775189724e-02   +3.470821369412881e-01   +4.791017324257692e-02   -1.908412849508362e-01   -1.436462574070270e-01   +4.273004484705333e-02   -1.192171053058236e-01   -2.551633177728015e-01   +7.661892408835422e-02   -1.017784815341535e-01   -4.697321062730979e-02   +1.805660447548542e-01   -3.047213799439252e-01   +1.612297823738391e-01; +7.923363251180285e-02   -5.513385689840425e-02   +2.759926280342009e-01   +1.427958833615235e-01   -2.633125302282419e-02   +1.456874973393447e-01   -9.153942570804760e-02   +3.161582974483836e-01   +3.210270012486042e-01   +1.596671058004802e-01   +2.782227905675700e-01   +5.104605974866741e-01   -4.409305582673446e-03   -2.074501517400689e-01   -2.289188478812096e-01   -1.722239273122527e-01; +1.598588974903532e-02   +1.658476770520592e-02   +1.761121135051907e-01   +1.863194353553856e-01   -1.348800769012429e-01   +1.627852002296983e-01   +1.413853972383571e-01   -4.535750983721009e-01   -1.332874707048409e-01   +2.125688166408313e-01   +2.528136084563131e-01   -9.224203739020548e-02   +4.932060014776508e-01   -8.940875832154241e-02   +5.720031644567886e-02   +7.117498220321161e-02; -5.107791172262964e-02   +6.702234492155427e-02   +4.086112128083039e-02   -3.711926219935150e-01   -3.808073293080881e-01   -3.941249386361945e-02   -2.963259480747480e-01   +1.565523760972700e-01   -1.682572210049779e-01   +1.025351913299102e-01   +3.863631217401860e-01   +1.584263132567715e-01   +2.056063345871786e-01   -2.025575897528755e-01   +1.319493622729284e-02   +1.224781156002514e-01; -5.974976770173811e-01   -1.540922453251342e-02   -3.808717526441417e-02   +4.170880274563034e-01   +2.418919879433788e-01   -7.197768620912798e-02   +9.329374643599415e-02   +1.587674089243284e-01   -2.105907677978149e-01   -2.043596716286361e-02   -8.661039407802253e-02   +6.292422872697839e-02   -2.205999598928878e-01   -5.586916662423905e-02   +2.686392563289180e-01   +7.267613384691038e-02];
L2E_L1E_iAMPA_netcon = [+2.017286100087720e-01   +1.950989646658649e-01   +1.313178975720536e-01   -3.485550001461497e-01   +2.243535836178334e-01   -4.762847744138585e-02   +2.846522018376527e-02   -1.247581580722963e-01; +1.186893376935219e-01   +7.855997366633138e-02   -3.174597302603525e-01   -5.792410577531257e-02   +1.288616617857068e-01   +3.924036583803348e-02   -3.414192388562495e-01   -8.210724941620541e-02; -2.694432400180602e-02   -2.897441681013822e-01   +2.841528898709632e-01   +3.539823959759956e-01   -3.403684152206973e-03   -5.315984020171224e-02   -4.110442564531874e-02   +9.163864957903453e-02; +1.470493609398835e-01   -3.140570864615627e-02   -3.236600322387044e-01   +4.668245747792880e-02   +1.159151178420830e-01   -3.704442758821248e-02   +1.518730245340410e-01   +9.661818338141126e-02; +3.256064440135268e-01   +1.130827299700076e-01   +1.411991432791720e-01   +1.023868162102961e-01   -4.422842155680018e-01   +1.030804059967290e-01   +2.256598891162052e-01   -7.814628066955459e-02; +1.192736656656227e-01   -2.065203102678699e-02   +2.969799807903605e-01   +2.698347968960844e-01   +1.785556645421558e-01   +1.014799960098176e-01   -4.995876588650200e-02   -2.123724777697523e-02; +2.897890163665449e-01   -3.320851948712265e-01   -1.293115317331527e-01   +4.549894492183033e-01   -1.355365858716823e-02   -1.637316461470061e-01   -1.758286775059778e-01   +2.322169711944306e-01; -2.830460911006687e-01   +1.928214407126497e-01   -2.306377349123174e-01   +7.716183204665539e-02   +2.825138282442398e-01   -7.581675907682361e-02   -4.626458612201531e-02   -1.558414503159118e-01; -2.564208267195944e-01   -1.863324872540882e-01   -2.860745659497859e-01   +4.929142299676545e-02   +8.528179300429355e-02   +3.222116654429267e-01   -1.436055698298078e-01   -5.086792043288638e-02; -9.866966951549387e-02   +1.222559140869154e-01   +4.340187673586721e-01   +3.602472496574788e-01   -1.742764895933735e-01   -8.535365974679003e-02   -1.375584296649011e-01   +5.399404794081277e-02; -1.444485274941800e-01   -2.231660307619898e-03   +5.122405600372746e-01   -2.689173986346340e-01   -2.440535380539171e-01   -1.219049276824786e-01   -6.860985945442468e-03   -9.908626937852918e-02; +8.265273948966556e-02   +5.834646290734577e-02   -2.842585330483881e-01   -2.640269717837828e-01   -2.467769379342836e-01   -4.359897207574320e-01   +4.222947120477132e-01   +1.612252875138439e-01; +6.749263810169492e-03   -6.086071052251839e-01   +9.445265377945719e-02   +2.942198721465384e-01   +1.621411436540783e-02   +1.543388947534712e-01   -3.631771140458574e-01   -7.147831217610567e-02; +1.104294906118313e-01   +1.421244829031109e-01   -2.674751109372157e-01   -1.469653507254062e-01   +4.409381963138186e-02   +5.853638581343316e-02   -3.278854167602703e-02   +1.851632022526020e-01; -2.082736316492396e-01   +2.482438674020229e-01   +6.417960617928598e-03   +3.765675653216479e-01   +8.120918544850994e-02   +2.220910022777597e-01   +1.898752545971805e-01   -2.157490951803208e-01; -2.419511999824226e-01   -1.363293732533823e-01   -1.015093264569718e-01   -1.985704174025216e-01   -2.213401595282789e-01   +2.338013030358944e-01   -3.048002418195413e-01   -3.743807183905251e-01];
L1E_L2E_iAMPA_netcon = [-1.174216363370035e-01   +2.840664397871479e-01   -3.680840025731438e-02   +5.691265736585419e-02   +3.434247721615660e-01   +1.077830678173219e-01   +2.332548355403244e-01   -1.543671549522137e-01   +3.592844817167655e-01   +9.452898992600071e-02   -5.033982037484555e-02   -4.747259085605246e-02   +2.077262318652918e-01   +3.648632188644383e-01   +6.723860595790387e-02   -1.592446807931031e-01; -1.828344044127325e-02   -1.961140963570737e-01   +3.183201354214021e-01   +1.789401099139207e-01   +1.477163021274676e-01   +2.965868162157116e-01   -4.435820881210791e-01   +3.255956879481475e-01   -2.764630590404015e-01   -2.805896466828414e-01   -1.532986664207263e-01   +1.233273607246956e-01   +1.652209129495849e-01   -1.710637072938664e-02   +4.841880435424668e-03   +1.668299135373183e-02; +9.191882004525151e-02   -1.346847097153717e-01   +7.852473090563317e-02   -8.372463772083488e-02   -2.797078694179550e-01   -1.712104648308161e-01   -4.920945014933287e-01   -5.099836803847974e-02   +3.178183868208618e-01   -5.512396807230011e-02   +2.050178792429072e-01   -5.686365775863528e-02   +2.587504831234650e-01   +2.326439483339057e-01   +1.701187713128910e-01   -8.130592217241474e-02; -3.940888650044689e-01   -1.423072766121545e-01   +2.083807340064206e-03   -1.867946158555119e-01   +1.335037754050002e-01   -1.363052084927917e-01   +1.263919831949335e-01   +9.662208364168942e-02   +1.909966944362663e-01   +4.568029381316774e-01   +8.824103115190857e-03   +1.002369794422088e-01   -5.561452413066166e-02   -9.714609755300350e-02   +1.046890141504507e-01   +2.246237724769183e-01; +1.997724985663932e-02   -2.276901004691810e-01   +4.749621373455665e-02   +1.254620242953011e-01   +4.329130526303317e-01   +2.127741472702516e-01   +1.332707388532978e-01   -5.130684117752191e-01   +1.688957839208616e-01   -6.872953430671978e-02   -4.898891438067193e-01   -1.621684247123156e-02   +4.166014727126879e-02   +3.297068790113701e-01   -1.609390338607011e-01   +1.243270649903144e-01; -2.355678169749719e-02   -4.128394437193736e-02   -1.698552810607747e-01   -1.713035450889190e-01   +7.966917997854234e-03   -4.014636967574758e-02   +1.968621797848960e-01   -3.443126684416232e-01   -2.231889228062609e-01   +8.232143198124296e-02   -1.896275339299722e-02   +7.365456199970033e-03   +2.056028879130383e-01   -3.957677835281365e-02   +4.447799868960366e-01   +5.548865057404554e-01; +2.411717702404408e-01   -7.640684860698373e-02   -4.371590010776860e-01   +3.558666507562723e-01   +2.056951794055106e-01   -5.838695658915669e-01   -8.621753108686171e-02   -1.071320359545757e-01   +7.021638519702056e-02   -1.063957703525249e-01   +3.039396400325162e-01   +3.449829778789379e-01   -3.448793112242585e-01   -2.854375106110710e-01   +2.919555349536445e-01   +1.423171663321603e-01; +1.008073613241568e-01   +1.146975006637618e-01   -2.311139213842087e-01   +1.656320691251333e-01   +1.877466598130179e-02   -1.586494398687140e-01   +3.233173931188525e-02   +1.865612390883500e-01   +1.181005029481502e-01   -2.409762458230078e-01   +2.308170894402984e-01   -1.517160301109174e-01   -2.206769997312369e-01   +3.246109841707524e-01   -3.103100743360910e-01   -2.504575214531429e-01];
L2I_L2E_iAMPA_netcon = [+1.977567303961049e-01   +1.396324399402809e-01   +2.820080160712410e-01   +2.627822535915568e-01   -1.148009863695616e-01   +4.938580052302546e-02   +1.271099648075083e-01   -3.629707891194505e-01; +3.712913503975995e-02   -2.211219388056615e-01   +5.723175595143333e-02   -1.605629449721743e-01   +8.039184860113630e-02   +2.996881953943889e-01   -1.040707310241140e-02   -2.828620789576508e-01; +3.944218795884555e-02   +4.248512804025675e-02   +2.582070496745102e-02   -3.125908219485021e-01   +1.441498929087399e-01   +1.428647905555476e-01   -1.643843719350344e-01   -1.362945002843991e-01; -7.616998257198807e-02   -3.416545354935641e-01   -4.321923605931098e-01   +2.024380042525017e-01   +5.847471749714835e-02   +1.701526551219348e-02   +2.872590527583161e-01   -1.407136229062080e-01; -3.391626467798818e-01   +2.229097217572600e-01   -4.586593571578677e-02   -9.024647956109291e-02   +2.785498124396187e-01   -1.396864882352740e-01   +8.415501013508206e-02   +2.679526519779282e-02; -2.755682810943497e-02   -2.690394226984518e-01   +7.396402851134662e-02   +4.018397834393621e-02   +2.285618138347853e-01   +1.546481771184924e-02   -2.318591235565684e-02   +3.521518447573540e-01; -3.428678360292417e-01   -1.135705549166290e-01   +4.719929322420058e-02   +7.791711405665189e-03   +2.069623738291965e-01   -1.697556582930482e-01   +3.053956731090406e-01   -2.034048174393976e-01; +1.241293508293397e-01   +1.604641890193065e-01   -7.829262368069441e-02   -2.639386099872637e-01   +2.553248713922200e-01   -2.708207192626179e-01   +1.003846142860523e-01   -1.369007971993610e-01];
L2E_L2I_iGABA_netcon = [-6.029671058396954e-03   +2.085019576659534e-02   +1.069452529934116e-01   +1.801606292928932e-01   +5.972120678243489e-02   +8.781952199170601e-02   -2.475151136861404e-01   -3.886692377865614e-01; +1.306469198605268e-01   -3.265732734202819e-01   -1.120138099187867e-02   +4.618320501754204e-01   +1.579719790362907e-02   +2.963270099023201e-01   +2.582428073116739e-01   -3.339543079680692e-01; +4.280583378860242e-01   -3.105248602519223e-01   -2.628299814274030e-01   +1.745135573123745e-02   -3.932060850098191e-01   -2.734674687613435e-01   +5.509199622752536e-02   +3.001247246823386e-01; +1.218438846470130e-01   -3.902568470304894e-01   -3.953769545425527e-02   +9.785282042595372e-02   -5.445227335940602e-02   +1.981416795556097e-01   +3.793667921077474e-01   -1.850885681358199e-01; -3.444506699427133e-01   +8.069683136493327e-02   -1.529161233300068e-01   -7.799893537483198e-02   +1.860868441117771e-01   +1.166135990645723e-01   +4.032959034951048e-01   -1.061972247323239e-01; +1.736123380694304e-02   -1.678290246849970e-01   +7.317846634673902e-02   -1.732819851162147e-01   +2.155953741006923e-01   -2.108853591424217e-01   +2.506174239795195e-01   +2.130498617703168e-01; +2.791035338645559e-02   -2.550049038523906e-01   -3.533734856370192e-01   +1.108761847673447e-01   -4.360945500478960e-01   -1.481309512637648e-01   -7.438494818680025e-02   -3.106773409264554e-02; -2.813217395121807e-01   -3.661710556463285e-01   +1.995188830845576e-01   -1.268374230457258e-01   -1.351774036756895e-01   -2.106174120342680e-02   +1.477801097153542e-01   +5.676269874217200e-01];
L3E_L2E_iAMPA_netcon = [+9.054487043123605e-02   -1.496969182544738e-01   -1.876943861582166e-01   -2.188699510098350e-01   +9.106774820049340e-02   -2.626191557166841e-01   -2.671043046195647e-01   +1.976452768380497e-01   -1.264659348617574e-01   -1.421090581369238e-01   -1.773916170308652e-01   -2.683726126506057e-01; +2.704715292212218e-01   -3.045534776626695e-01   -2.003948134687004e-01   +1.217318518126403e-01   +1.040902447809163e-01   -1.388708615930618e-01   +4.803272119148350e-02   -3.922126700905841e-01   +1.797219808889845e-01   -5.612149687665352e-01   -1.005480370877461e-01   +8.726397657768875e-02; +1.875413153468644e-01   -2.700711037851279e-01   +1.674169504098833e-01   -1.630782696430172e-01   -2.789720619817745e-01   +2.721610392463391e-01   +2.481710280787530e-03   -1.428074881604644e-01   -3.389215600854107e-01   -2.172596586150211e-03   +3.825313261384387e-02   +1.279925023279723e-01; +2.279735273254013e-01   -9.814493588546461e-02   +2.032409325229995e-03   +3.242547222587691e-01   +8.823068181569800e-02   +1.894542470611648e-01   +1.618447313661854e-01   -7.179869628888891e-03   +1.015245824468870e-01   -2.562521911623462e-01   +2.747791342928417e-01   -2.175388085730674e-02; -4.188562666024577e-01   +1.040795624273888e-01   -2.604822533006362e-01   +1.738942896407108e-01   -9.081475826161173e-03   -6.424639933336584e-02   -3.190469095935212e-01   -2.575701829514826e-01   -1.865579182392835e-01   +1.061408936185553e-01   +3.435733891151257e-01   -1.279170319335067e-01; -4.098042742837052e-02   +2.516187739266582e-01   +1.118813137615232e-01   +2.373962960673352e-01   -2.309036568470156e-01   +2.770369191950215e-01   -3.540102284788424e-01   +3.006570083896382e-01   -1.263390990973320e-01   -4.378282959954259e-01   +1.072503101149273e-01   -1.630810857645511e-01; -1.724179792833150e-01   +1.508776295516478e-01   +4.977406950676699e-02   -3.426989943352844e-01   +2.244628451393209e-01   -1.923091226325886e-01   -1.407277850733655e-01   -1.840606196295008e-01   +1.545295216043052e-01   +2.863157107274430e-01   +1.683819521847759e-01   +2.978405482484944e-02; +7.301774798237817e-02   +3.360583673185878e-01   -2.322895321146481e-01   -8.826340851186282e-02   -1.323313907555808e-01   -1.535080162001378e-01   -2.927505058447441e-02   -1.027067097577391e-01   -1.214159271362525e-01   +3.460418616877053e-02   +3.001566759431104e-02   -1.290364159569536e-01];
L3I_L2I_iGABA_netcon = [+2.283464069935487e-02   -3.475446278898218e-01   -1.875382255702387e-01   +1.048499700172121e-01   +1.111975152557990e-02   +3.744098068974855e-03   -5.270943716430843e-01   +1.282894095505090e-01   +1.588822902492114e-01   -1.828993530992220e-01   -4.705824479201492e-02   -1.841290737815305e-01; +1.220581171160949e-01   +1.883542936244207e-01   -3.988617926183477e-02   -1.708637013942368e-01   -3.002692481869232e-02   +1.307342781538929e-01   +1.290620651230473e-01   -2.707896897505474e-02   -8.400180855292955e-03   +2.993905700826618e-01   -2.801977176274506e-03   -8.215638439177003e-02; -3.750578878096967e-01   -4.204379643550586e-01   -8.157254928214486e-02   -3.193757564958846e-01   +4.920064295626584e-02   +1.400116670296157e-01   +1.684187036493288e-01   -2.791056939943751e-01   +1.987703742002918e-01   +1.528086490673212e-01   +3.421923750617423e-01   +1.948998691159866e-01; -2.438136021165946e-01   +1.538373332428337e-03   -2.912931048012386e-01   +1.726570508309742e-01   -6.022382138751253e-01   -1.639062082441850e-01   -1.119176086023822e-01   +2.277191668397147e-01   -9.777309346993222e-02   -7.338561872255400e-02   +5.750898635333876e-02   -1.070426363315130e-01; -1.223299100691343e-01   -2.978624183139700e-02   -2.757185936240586e-01   -1.145207600125210e-01   -2.202797720720909e-02   +2.373181499307954e-01   +2.335108448125853e-01   +2.397773726736849e-01   +3.030564829061977e-01   -4.412616377446669e-01   -2.088149358108508e-01   +9.959244307260220e-02; -1.172030767031938e-01   +1.996830804698778e-01   +7.345882211927661e-03   -3.625695925881600e-01   +4.671656166251992e-02   -9.123571557127724e-02   +2.491219752080805e-01   +9.899444823208492e-02   +1.059620348190224e-02   +3.762276492900746e-02   +2.756955420118006e-01   +6.481421088965740e-02; -3.569557166666584e-01   -1.203085084885610e-01   -1.638876788325175e-01   +1.344554122353022e-01   -1.221097750360283e-01   -5.448129568984704e-02   -3.983573752292704e-03   +8.308185886615316e-02   -8.474698830392209e-02   +3.238834320304729e-01   -1.870578868038476e-01   -2.549847070253242e-01; +3.232535858689208e-01   -2.049545361187941e-01   -5.793955105285522e-01   -2.046749185494368e-01   +1.697931467655239e-01   +7.786053803208740e-02   -3.746377415935395e-02   +8.940889221446034e-02   -2.588522949650282e-01   -2.747944484756897e-02   -1.050930938069455e-01   -4.802182763080105e-01];
L2E_L3E_iAMPA_netcon = [+3.261837926406569e-02   +1.134669450130252e-01   +3.752781187682301e-02   -3.732429233140847e-01   +1.105627737795832e-01   +7.868012295144421e-02   -3.413460345575696e-01   -1.455671490841782e-02; +4.679402844141572e-02   +1.181979350018436e-01   -9.929414572797569e-02   -2.175104304079554e-01   +4.237406625554245e-01   -3.485622086879190e-01   -4.789564998613923e-01   -1.105635536184746e-02; +3.469913090330400e-01   -2.149971900393789e-01   +1.568997727195035e-01   -2.109017406137411e-01   +6.267194364190987e-02   -3.155885226573066e-01   -1.949322793829169e-01   -6.998023909608776e-02; +1.902420404662531e-01   -1.690578531203459e-01   -2.074591570849421e-01   +4.271763267949936e-02   +1.783222482113322e-01   +4.868409394364800e-01   +1.810625838772728e-01   +2.367636591903229e-01; -1.916797921714967e-01   -2.550686993250671e-01   +5.040502198831780e-01   +9.627899887732615e-02   -7.289770312667929e-02   -1.323644348610760e-01   +2.434004072701278e-01   +8.262502564835292e-02; +2.832212745483217e-03   -3.968088926229014e-01   -1.686277978961673e-01   -7.906728089106817e-02   +3.278653554882706e-01   -2.447352506967553e-01   -1.558111900021965e-01   -3.281428066485917e-01; -1.545819772483136e-01   -4.315583070081845e-01   +4.605901664966821e-01   +3.852917168735586e-01   -1.527353768263017e-01   +2.686209224750777e-01   -8.181206941174302e-03   +4.802931044663551e-01; +1.619664727622124e-01   -2.972176743597432e-02   -2.920931387071258e-01   -6.251973876092029e-02   +2.583775539008394e-01   -2.534750248852010e-01   +1.126556277502807e-01   +2.112528943133894e-01; -6.931076812643400e-02   +3.648189506846475e-01   +1.461268061457490e-01   -1.551546458582688e-01   +7.477811753487699e-02   +1.467463656347510e-01   -6.447527583255147e-02   +1.213054112795302e-01; -1.449863588985633e-01   -8.550961916951706e-02   -2.116070078746374e-01   -5.936470893173340e-03   +3.025727907264034e-03   -3.131791712576817e-01   -2.872711125939514e-01   +1.930759654317039e-01; +1.072000016305413e-01   -4.319516114798047e-02   -3.621225965601282e-01   +4.682786517967071e-01   -7.495310842483859e-02   -2.836757333793726e-01   +1.648555080612645e-01   +2.581191886135354e-01; +8.810166083601070e-02   -7.146091078086762e-02   +2.162257620890380e-01   -8.455980920750750e-02   +6.591830016675661e-02   -1.402846131027390e-01   -1.325175443476213e-01   -7.821618527925762e-02];
L2I_L3I_iGABA_netcon = [-2.003526039558149e-01   -3.214859727267706e-02   -2.229892198865095e-01   +4.754567884751164e-01   -9.170372013460118e-02   +3.418390905578335e-01   +9.382478304390798e-02   -1.931944179253073e-01; +1.244625479823558e-01   +1.263342837831674e-01   -7.049466195819691e-03   -3.992778637215717e-02   -3.304187987340497e-01   +4.734605729625842e-01   +2.276022716776655e-02   -2.896642170375765e-01; -1.806433690122976e-02   -8.499055763135512e-02   -8.566096449238635e-02   -2.457139662428531e-01   -8.642190825034929e-03   +5.026729846484135e-02   -3.077214364560038e-02   +2.985977031170038e-01; -4.274462467784358e-01   +4.329640979399758e-02   +1.032970784116001e-01   -1.111977193279527e-02   -3.979352657168719e-02   +3.608281606759745e-01   +3.407067461363072e-03   +2.528746517211874e-01; +3.632739481796490e-01   -1.666563137583424e-01   +1.972112373822169e-01   -1.200915045613056e-01   -1.786560941284638e-01   +1.854861408376663e-01   +9.371572141958094e-02   -1.541160754838249e-02; +2.570564888919049e-01   -5.916027925000178e-03   -2.521415852606217e-01   -1.623941856390822e-01   -7.514260352939228e-03   +2.573572132743585e-01   -5.195483391885289e-02   +8.752173252547486e-02; -1.482635712202783e-01   +2.272747846168492e-01   -5.153430951383860e-02   +2.603771863532389e-03   +4.093613319446386e-01   +8.528146581440876e-02   -1.609521154877009e-01   +2.536670092493477e-01; -1.013646370539036e-01   -1.960453075123999e-01   +8.924771560365138e-02   -7.280863376989125e-02   +3.086815393580170e-01   +2.952566036355846e-01   +3.608983137896181e-01   +2.293256579657757e-01; -4.121208619010349e-02   +1.179295908000259e-01   -4.108540699071632e-01   -1.480684557485534e-01   -1.044165276805882e-02   -4.870335708362691e-02   -2.270344016244707e-01   +2.986254104315211e-01; +3.494923891593588e-02   +9.306837691399422e-02   -3.220338523782129e-01   +8.173024517225030e-02   +2.032709149513350e-01   +1.541581804285012e-01   -2.621070863410363e-01   -1.492771798535996e-01; -5.336434730115573e-02   +1.645883311894638e-01   +7.006533798837671e-02   -2.062375873732520e-01   -1.572247766251389e-02   +2.688470185849927e-01   -1.620610418760667e-01   -1.500150933931609e-02; +4.103714292795732e-02   -1.002451324709594e-01   +2.084489757228221e-02   -1.600975500192199e-01   -3.757588914157803e-01   +2.252482169347435e-02   -3.724886024085689e-02   +1.651860071273195e-01];
L3I_L3E_iAMPA_netcon = [-1.308072819017179e-02   -7.832369835148509e-02   +4.000394318455327e-02   +1.059170485905301e-01   +2.844442913161813e-02   +2.928410981282396e-01   +3.036127094203417e-01   -1.236222929375353e-01   +5.880076441270519e-02   -3.598347196294094e-03   +6.543343465092026e-02   -3.455336999996350e-01; -2.201575392033574e-02   +4.971225646212103e-02   -1.766380079224639e-03   +1.377321265500089e-01   +6.055517395476719e-02   +2.332523258342128e-01   -1.071397575616400e-01   +2.477557369671378e-01   -2.232530613792375e-01   +9.785651167427412e-03   +1.397482688572564e-01   -1.649275256595907e-01; +2.048390511213059e-01   -2.261630435874520e-01   +6.692232021103262e-02   -8.024810256199277e-02   +1.854850464345629e-01   -7.513300373759718e-03   -1.098916904270250e-01   -2.966998143877915e-01   -1.746732812310205e-01   +5.823284127876822e-02   -1.591259802940353e-01   +2.705844890241926e-01; +1.107190332553435e-01   +2.949642714669287e-01   -2.629669620400920e-01   +3.382027127932912e-01   +2.708569194342724e-01   +6.967201667095657e-02   +3.325909860239537e-02   -1.549392920511730e-01   +1.919200762111323e-01   -1.406729330668199e-01   +2.672982560867440e-01   +2.273679885808060e-02; -4.187237962091455e-01   -1.680449197613077e-01   -8.267047151573276e-02   +5.579066414787326e-02   +3.029546213328054e-01   -1.145072445498997e-01   +2.491152990626293e-02   -1.409403773612868e-01   +6.120508592303696e-02   -6.078202725446068e-02   -1.493131420315618e-01   +3.746962840707440e-01; -1.090505589001975e-01   +9.007675539627066e-02   +4.331802275543293e-01   -3.815593756487013e-01   -4.583389552922664e-01   +1.245378721710576e-01   -2.341380398741577e-01   -1.160661297670883e-01   -5.703034099323934e-02   +2.890331074710630e-02   +3.750027120869477e-01   -2.451942186400840e-01; +7.791063569451864e-02   -8.155728359891047e-02   +1.329017452894019e-01   +1.922393552073506e-01   -1.227000468840052e-01   -3.727583480329358e-01   -3.159733884758191e-01   -4.451764406500794e-01   +3.933650047764924e-01   -4.790745836309580e-01   +2.307879369981302e-01   +6.950204904365584e-02; +1.735446607402273e-01   +2.901271044754258e-01   +2.203284363603122e-01   +1.133853590249684e-01   +1.614508139813604e-01   -4.708854602551428e-02   +2.094120992621360e-01   -3.331719980623588e-02   -1.198663052476739e-01   +7.616817330187008e-02   -3.414485891788952e-01   +4.332334626188945e-02; -1.901376469386596e-02   +2.106960468808192e-02   +5.942625560903311e-02   +1.848461129692885e-01   -2.992656112010973e-02   +2.167519621510022e-02   +6.585133340860003e-02   +2.347722774097608e-02   -1.644985270317241e-01   -2.799921417611153e-01   +7.038556504861911e-02   -1.919170499808525e-02; -9.632118140752750e-02   +3.623462306347487e-01   +8.316233453807553e-04   +1.228514045747713e-01   +2.097687059060772e-01   +1.914960457620563e-01   -2.234068383431941e-01   +1.127563549337855e-01   -1.317131763260754e-01   -3.129362447665640e-02   -1.447311516755341e-01   +3.471392717639986e-03; +2.383518611945452e-01   -5.422058910499977e-02   -2.369803029093090e-02   +1.384219845972784e-01   -4.435970060313248e-01   +4.166133088306088e-02   -5.780970083201414e-02   +4.238826942432067e-01   +3.836126182119899e-02   +1.026715953404891e-01   -2.706964858856141e-02   +1.358033874900189e-02; -2.837281147492384e-01   +8.041955341225529e-02   +5.972857559247682e-02   -9.623632696328471e-02   -6.531148683010707e-02   +1.063744014477828e-01   +1.831113371257973e-01   +3.851282417940362e-01   -2.250443522517092e-01   +2.825635296885648e-01   -1.780382381691468e-01   +2.810393520632243e-01];
L3E_L3I_iGABA_netcon = [+5.081344631767505e-02   -1.730143123572879e-01   +1.355603284568820e-01   +2.402278086813731e-01   +1.870836138119267e-01   +2.493970741498958e-01   +3.345071110228959e-01   +5.138732829026785e-02   -2.958027462432232e-01   +1.630735807857433e-01   +3.159542430260109e-01   -2.818906918316560e-01; -8.578206889160274e-02   +3.405280106665008e-01   +1.716083482057491e-01   -1.556671029158713e-01   +1.466097530723203e-01   -2.375585825804220e-01   -6.419297540140315e-02   -8.194452497369339e-02   +1.232750931552658e-01   -4.378680864847255e-01   +3.794267899233261e-02   -2.564922049304633e-01; +2.418178187263945e-02   -2.231378176836778e-01   +5.727514323533578e-05   +1.070920668443475e-01   +9.036212807179422e-03   +7.648120352779667e-02   -4.102435196398670e-01   +7.297181319553925e-03   -4.587498053977148e-01   +8.928980668105857e-02   -3.235620690198565e-01   -3.346384004802314e-01; +5.475401135422183e-01   -5.388426791220766e-01   -7.192123351985023e-02   +8.709968399802495e-02   +8.741756676221182e-02   -1.648723530391921e-01   -3.062990074886874e-02   -2.573014163693029e-02   -1.534688984673580e-01   -1.610673604623148e-01   -2.626061593450136e-01   -2.476049923862301e-01; -1.015680706063646e-01   +2.796881527067682e-01   +4.766129278911426e-01   -2.535784368520569e-01   +5.841490419190441e-02   +1.825505609479651e-01   +3.766985639330006e-01   +7.380972262467746e-02   +9.275328230989426e-02   +8.278621067141996e-02   -4.573288373973989e-01   -3.236434448286305e-01; +1.737593734170688e-01   +1.959573383369499e-01   +5.855604129046590e-02   +4.211155618789053e-02   +1.787566553248682e-01   +8.476121277311335e-02   -5.754958561988766e-03   +3.357678337743539e-02   -1.584208113349677e-02   +5.306796603399695e-02   -2.224930214365628e-01   +1.868073131738349e-01; +3.623969582017465e-02   -4.044814597824267e-02   -2.430015198038715e-01   +3.852888064154553e-02   -3.772138144365342e-01   -8.972059758177149e-02   +3.399316698779533e-01   +3.542577172835051e-02   +1.334704687442772e-01   +2.078127492829554e-01   +4.138001285922660e-02   +4.559279855840645e-02; -2.184652011924877e-01   +2.306337202093305e-01   -3.685971567781932e-01   +3.406567826401041e-01   -1.657654341126104e-01   +4.388808765222740e-02   -1.678215159919214e-01   +2.548165123427302e-01   -7.876358138228640e-02   -1.476251895034942e-01   -2.949279336373921e-01   +2.835071332533048e-01; +6.372189619814811e-02   -4.423892881200832e-02   +1.036085096046423e-01   -3.120101715322017e-01   -8.991680226203387e-02   -1.309001294730702e-01   -2.094336927069973e-02   +2.083045557725863e-01   -2.300974559270638e-01   +6.705325573952937e-02   +1.444865202050960e-01   +1.432488482412550e-01; -1.757215983328526e-01   +1.970005001232171e-01   -6.354617417442723e-02   -1.171083263152455e-01   +1.279573079182768e-01   +4.747800266445868e-01   +4.212888715256085e-01   +3.437407828213113e-02   +3.147587815027654e-01   -8.309118866991244e-02   +2.140109543250322e-01   +2.717984080592969e-01; +4.363257788116327e-01   -2.928061883993263e-01   -4.541434721344759e-03   +5.819590757091645e-02   -2.752553347482107e-01   +2.163277031467165e-02   -2.412175687544652e-02   +4.238884007107108e-01   -1.207152634415135e-01   +8.945549285360058e-02   +4.183451702655647e-01   +1.838289071946836e-01; -3.145481031391317e-01   -7.733435795647586e-02   +1.460557896186853e-01   +7.248071834816187e-02   -1.572502523603338e-01   -3.014364730646692e-01   -1.692173724375350e-01   -2.676586261856085e-01   -4.120549485949400e-01   +2.387840380357902e-01   +3.625250649816848e-01   +3.160027060368913e-01];
L2E_Input1_iAMPA_netcon = [+5.409515266023915e-02   +1.661340089987279e-03   +2.895815458332588e-01   -3.012810241798464e-02   -3.318939669118206e-01   +4.182143401812921e-01   +3.184651908208079e-01   -8.512295842679748e-02];
L2I_Input2_iAMPA_netcon = [+4.335576287273187e-01   -3.760810016711792e-01   +1.472001478965045e-01   -2.314634888553702e-02   -1.930183867002164e-01   +1.394290291562900e-01   -6.718088951285478e-03   +4.114303340532799e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
