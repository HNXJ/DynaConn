function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.252815347203682e-01   +8.510598299492667e-01   +9.974665064397652e-01   +2.468887270160744e-01   +2.384401620486975e-01   +8.374314192746921e-01   +1.452727439459207e-02   +4.704434883840946e-01   +3.629191931322801e-01   +2.212760701872470e-01   +3.657472872198687e-01   +1.673463859751923e-01   +5.268084452654217e-01   +3.014845946350458e-01   +2.559279429314542e-01   +8.148408101642465e-02; +1.270136257996976e-01   +9.748391529220382e-01   +8.622758910059221e-01   +7.559854857618250e-01   +3.525766776525082e-01   +7.989182864118075e-01   +7.232455814943712e-01   +1.742518445635250e-01   +8.312206443196363e-02   +7.419584073182039e-01   +6.455938780301087e-01   +7.276772139677421e-01   +5.523394274845432e-01   +2.919182870049616e-01   +7.241428703020212e-01   +2.924365802987818e-01; +3.497585064671818e-01   +3.478683233039598e-01   +3.806819796039121e-01   +6.522047480765998e-01   +5.487817056045368e-01   +4.435144691435934e-01   +5.728177617988171e-02   +7.814380157170103e-01   +3.767098467115232e-01   +5.486448383384807e-01   +9.323726037316065e-01   +2.411023419983197e-01   +5.241052186929269e-01   +2.115170592421862e-02   +4.545938443753895e-01   +9.441181814507460e-01; +2.581462472743040e-01   +6.828818096483855e-01   +1.179357414038582e-01   +2.619676240243464e-01   +9.978902872856372e-01   +9.107279230131174e-01   +2.646257557765276e-01   +6.621744288559132e-01   +8.316247915643469e-01   +4.249655184249157e-02   +2.311096842811810e-01   +9.634208165188494e-01   +6.387735523620456e-01   +1.466448914286629e-01   +7.530226664711144e-01   +4.806805349930674e-01; +4.836848295306403e-02   +7.557739171439684e-01   +9.269584030597140e-01   +8.856954469493367e-01   +5.854102239695347e-01   +3.435179927266327e-01   +5.450062941002354e-01   +2.272755905646912e-01   +3.150993806329490e-01   +5.777220301032310e-01   +2.839644961194346e-01   +6.419511578418766e-01   +4.152774901988173e-01   +9.117607422403338e-01   +2.480331594830245e-01   +9.636158479326884e-01; +1.342825881515796e-01   +2.019978990818406e-01   +8.170883782938206e-01   +8.269814686351373e-01   +6.691460456910298e-01   +9.863426279084004e-01   +3.866230297197467e-01   +4.661263844993297e-01   +8.972459199256130e-01   +9.118964472545844e-01   +8.770982902748155e-01   +2.218737706709193e-01   +4.128729100089713e-01   +1.071369828663155e-01   +9.839795301936036e-01   +3.615537611411708e-01; +2.605209170417973e-01   +8.207165465985501e-01   +3.256468878720887e-02   +4.136374835414253e-01   +9.472851053702284e-01   +5.764143471108933e-01   +4.981581060096299e-01   +6.314209116027854e-01   +9.504047749513865e-01   +9.667545741649749e-01   +7.201771156668106e-01   +2.666948982924214e-02   +4.349927941702317e-01   +4.289494828903131e-01   +7.629379109641671e-01   +9.853411251433033e-01; +7.260216371063946e-01   +8.325627429472767e-01   +8.464655885124368e-01   +4.082429090716002e-01   +6.413154403318133e-01   +4.930353068430789e-01   +9.255598846179007e-02   +3.859321102885417e-01   +9.883068348813872e-01   +9.187850554193451e-01   +9.586188249554083e-02   +8.267559296866018e-01   +9.551104453711977e-01   +6.472837200761226e-01   +3.156286941862934e-01   +9.527287581225490e-01; +6.006934709918063e-01   +1.945351839860590e-02   +3.182693624578312e-01   +7.753129699510045e-02   +5.054759368507568e-01   +9.234209101501820e-02   +1.340999459749015e-02   +6.669283329991387e-01   +5.971035729903650e-01   +8.323670948498542e-01   +8.139325661955694e-01   +5.648491331182969e-01   +4.151350861143722e-01   +2.297328835032549e-01   +9.746322507944967e-01   +8.052502417729170e-01; +7.779458717511240e-01   +5.421454677897677e-01   +6.018765279848042e-01   +2.510546115385651e-01   +4.399925296783176e-01   +3.666871881606936e-01   +1.114536201798241e-01   +3.181523113341024e-01   +7.362127195593102e-02   +9.524811358527785e-01   +5.966677672561868e-02   +1.173656932139340e-01   +3.221116799939273e-01   +7.785687317187782e-01   +3.189016416003771e-01   +8.898346379671955e-01; +4.764311067696381e-01   +1.259857482564379e-02   +4.528920442789265e-02   +1.129998485132231e-01   +9.978775080205492e-01   +6.093628559892179e-01   +2.788599305495287e-01   +2.067893427048109e-01   +2.742884846717706e-01   +9.300811053021250e-01   +7.594106846417351e-02   +8.445993954750569e-01   +5.797237278609477e-01   +9.177967561361194e-01   +4.488262490094963e-02   +1.674898708553673e-01; +1.052698879018780e-01   +6.674903951892476e-02   +9.756338566799673e-01   +5.264477715511102e-01   +6.674143578297129e-01   +5.796636790368499e-01   +7.230359298715436e-01   +4.492509328901674e-01   +6.300648998237319e-01   +1.378331797858967e-01   +3.668226750275405e-01   +9.279016294201452e-01   +1.201830150278240e-01   +5.024239093089523e-01   +4.629799026136866e-01   +9.086183116923044e-02; +5.307070753706494e-01   +2.927690572114464e-01   +6.815439425448043e-01   +3.520704992395190e-01   +2.460210162787421e-02   +5.670495376152183e-01   +4.794202003057538e-01   +8.045570299147498e-01   +2.375662510572962e-01   +9.816405964095991e-01   +1.135387194173423e-01   +4.291509420321491e-01   +2.445372992029111e-01   +2.207028646721264e-01   +3.261783563166814e-01   +1.851099727985399e-01; +8.421365656510499e-02   +9.549933318776302e-01   +8.258686801872434e-01   +7.969100312952978e-01   +8.413889542721773e-01   +5.936165010967530e-01   +3.711260729200662e-01   +9.044557962338656e-01   +3.764101345385893e-01   +3.591556941778168e-01   +9.969764878328754e-01   +6.719311964786423e-01   +6.431720573715582e-01   +5.266607771542072e-01   +1.480437894159972e-01   +3.989674622774816e-01; +1.548065559919793e-01   +2.748392000200479e-01   +1.156106506156103e-01   +4.110263818662414e-01   +4.429392875469683e-01   +9.105462637509797e-02   +7.040795119786994e-01   +2.656843646518241e-01   +8.971489441307428e-01   +6.066178257728382e-01   +1.719420498732309e-01   +9.715667224717874e-01   +6.852870908668942e-01   +2.823935137983665e-01   +7.225865058002076e-01   +1.474355914842072e-01; +6.130327557653694e-01   +2.995332279722894e-01   +3.124971590949072e-01   +7.017670510367670e-01   +5.815581440782130e-01   +6.715246793645222e-01   +2.453827403940406e-01   +7.988664922512061e-02   +6.272462448596998e-01   +4.576419060747206e-01   +3.963117631933216e-02   +5.017175981214772e-01   +2.177790222802877e-01   +9.920943640486094e-01   +9.600314479291397e-01   +3.405399042671725e-02];
L1E_L1I_iGABA_netcon = [+3.982465447278265e-02   +2.331390861954737e-01   +9.423936737464619e-01   +2.787424846482396e-01   +4.447727992055708e-01   +1.590115351449542e-01   +3.143875745833764e-01   +2.649733781015609e-02   +2.672297850181656e-01   +7.166430803585798e-02   +4.743969095761361e-01   +9.795834925934075e-01   +1.907632134901555e-01   +8.884423246980330e-01   +1.330721088852286e-01   +4.895329915196522e-01; +7.729413993082859e-01   +8.466156406413472e-01   +5.080277811518842e-01   +8.679571967866418e-01   +7.505499349595822e-01   +9.233103394742371e-01   +6.667049459652366e-01   +9.181540641675017e-01   +9.680918055263786e-01   +9.762885300721751e-01   +1.250872865390689e-01   +1.639045428512008e-01   +5.936071144045885e-01   +1.000000000000000e+00   +9.715067320258127e-01   +3.004293027954170e-01; +3.521379159759730e-01   +8.388255784025919e-01   +1.047071517227762e-01   +8.246911576131985e-02   +6.488594291067119e-02   +2.107839656132539e-01   +6.162612417312349e-01   +6.903999173906672e-03   +9.383361808940641e-02   +1.222049480919229e-01   +5.388412133176913e-01   +4.563472545010600e-01   +8.749963235954378e-01   +8.307128654666452e-01   +8.504643875690936e-01   +7.956394131555122e-01; +3.412659466924669e-01   +5.668237664259029e-01   +7.067876942996437e-01   +7.661890913254634e-01   +6.626658240585648e-01   +7.052166611458943e-01   +6.278729502843110e-01   +9.018935099616664e-01   +6.822746874056855e-02   +3.716011184486578e-01   +5.109341192777412e-01   +2.150294244771800e-01   +7.865663022847227e-01   +4.300127623201183e-01   +9.543944359192046e-01   +5.980878206867603e-01; +7.727219544344217e-01   +6.261798718121807e-01   +8.732657831635452e-01   +3.831706086122227e-01   +9.734833837890480e-01   +5.473763931368291e-01   +3.903863356197067e-01   +4.303741659197214e-01   +2.711765588782928e-01   +1.283429124028898e-01   +7.976843627858145e-02   +5.015163100368658e-01   +9.104159093453416e-01   +8.244939724674456e-01   +1.826110953478068e-02   +1.620116224271457e-01; +2.865918279970875e-01   +6.670388079931792e-03   +2.924067093194094e-01   +1.340370140368745e-01   +2.207977804679695e-02   +4.028473426621697e-01   +8.803997474827965e-01   +3.514651063306784e-01   +5.871028016382464e-01   +3.732996429577550e-01   +9.771237589945982e-01   +2.288905532645906e-01   +2.757369895553057e-01   +1.934155546673511e-01   +7.295494334686307e-01   +4.645373491771373e-01; +6.498831013731465e-01   +5.641974910195729e-01   +3.942709337950893e-01   +7.992899511837560e-01   +3.226438716689350e-01   +8.917687283898635e-01   +6.639486037981297e-01   +5.552964859841050e-01   +9.079253204408140e-01   +6.772227080807838e-01   +9.457444744544611e-01   +2.913548063655400e-01   +8.226559602092263e-01   +6.260857243917717e-01   +9.851599966619322e-01   +8.744700265709291e-01; +9.953070093682838e-01   +1.411205076986437e-01   +5.848684627692248e-01   +5.537887611198402e-01   +6.420873066242211e-01   +2.354210650802273e-01   +3.176809618820271e-01   +6.427864476703724e-01   +2.176771099160099e-01   +7.898686337823043e-01   +8.060580534335909e-01   +9.916576885518468e-01   +2.599086178918295e-01   +8.145078822071191e-01   +5.288954932936757e-01   +6.308109093668567e-01; +5.466941721836244e-01   +9.878737432188078e-01   +3.776313688318677e-01   +9.579130471461559e-01   +2.487551295458437e-01   +6.774211468739565e-01   +6.433480886206819e-01   +9.842920027457652e-01   +8.759595793165057e-01   +1.405780054140781e-01   +2.165672054760668e-01   +2.285099242916370e-01   +8.856643204945825e-01   +2.427455617671931e-02   +1.675541091360046e-02   +4.858026239779504e-01; +2.909685096131107e-01   +4.103863332384389e-01   +5.712264185706087e-01   +2.766807683141290e-01   +8.480329201567355e-01   +4.399648856940641e-01   +3.260981915381667e-01   +8.697741307199679e-01   +9.355388053073893e-01   +9.893071950737703e-01   +8.218175638688313e-01   +9.428579325752394e-01   +5.058360376553253e-01   +4.224130174720568e-01   +3.347780973345911e-01   +8.904538287290614e-01; +1.248899123887079e-01   +2.488063293388456e-01   +7.926976872234582e-01   +9.081440930656426e-01   +1.592699227836182e-01   +6.334096443614148e-01   +7.148319330058246e-02   +4.874359008792579e-01   +4.011191143668950e-01   +7.266593806178393e-01   +2.463230607315389e-01   +9.193950534866324e-01   +1.001466310080175e-01   +5.367605819779316e-01   +5.169250003840563e-01   +5.232771449660580e-01; +1.817527981997670e-01   +9.689294444990019e-01   +7.695689482326226e-01   +5.638048633322930e-01   +5.076028417060261e-01   +6.797153422633775e-02   +1.629616530220548e-01   +4.051773638328429e-01   +1.715052056234771e-01   +5.921491569826508e-01   +3.006047608944432e-01   +4.487421950587495e-01   +4.489384898353197e-01   +9.320912000193977e-01   +5.310248761844482e-02   +4.715375073397104e-01; +9.237280192374493e-01   +1.120403731791702e-01   +4.925365526834760e-01   +5.682466858779568e-01   +6.936845697211141e-01   +6.225541857455232e-01   +1.859710258890978e-01   +5.899078848509449e-01   +5.178939638741940e-01   +3.410708234833770e-01   +9.914404040970407e-01   +9.949612352167015e-01   +8.581037585983280e-01   +6.091192754071805e-01   +3.439778666467031e-01   +7.411390432684030e-01; +4.738878259925018e-01   +8.779825507787965e-01   +3.164108448398213e-01   +4.027184819858838e-01   +7.713726232938244e-01   +1.704081026655756e-01   +3.973635222338333e-01   +6.355205954500905e-01   +3.122178438055371e-01   +4.744224356250151e-01   +1.949452551499650e-01   +1.694341817947637e-01   +3.304813784019296e-01   +3.041891412385132e-01   +6.371061339273161e-01   +9.519109912610093e-01; +6.189505130592272e-01   +6.276300748942492e-01   +6.765046378632074e-01   +6.994301640280418e-01   +8.756517463648393e-01   +2.225215946176814e-02   +8.625598012124155e-01   +4.045635555622165e-01   +8.325700452853312e-01   +5.121152857195165e-01   +7.139954737219215e-01   +6.150533213712782e-01   +2.277666006644673e-01   +5.134389943555357e-01   +8.992381737629692e-01   +5.081681635260900e-01; +4.905954338255972e-01   +6.566045828628221e-01   +6.072031701102645e-01   +2.628898464841529e-01   +4.384501808450873e-01   +2.940516639814387e-01   +6.304247987286797e-01   +1.995571729146058e-01   +9.228235615835030e-01   +2.835506733648275e-01   +2.267205419732633e-01   +1.717494705036810e-01   +7.903731151310987e-02   +4.970949213693799e-01   +9.280536205382789e-01   +9.453825618195736e-01];
L2I_L1I_iGABA_netcon = [+6.957856082492938e-01   +5.330005934385517e-01   +7.521496176619443e-01   +5.835077632796675e-01   +9.499031314246458e-01   +7.577899974583493e-01   +9.132834500734616e-01   +5.852192292042718e-02; +5.781424663189219e-01   +1.031331479981129e-01   +2.245959539182288e-01   +9.031370859318573e-01   +2.223239304623728e-01   +6.015427705686176e-02   +9.569297922617735e-01   +8.210757232077375e-01; +9.755017687022857e-01   +5.075324389855153e-01   +6.960131732783841e-01   +7.132709263382602e-01   +8.528187955054235e-01   +7.728331574582744e-01   +2.592966427263991e-01   +1.881175948696773e-01; +4.527868918478090e-01   +1.645856347361195e-01   +9.508659693724368e-01   +4.717176178102633e-01   +8.532113057560987e-01   +3.744142862705072e-01   +9.034033243882883e-01   +2.392508866946184e-01; +8.227628911741494e-01   +5.564982073169343e-01   +7.246159834084988e-01   +2.711856456343965e-01   +9.767637657547539e-01   +4.481755953387929e-01   +6.017179410200537e-01   +2.432870976664719e-01; +6.077620313024200e-01   +5.950038158795092e-01   +8.235578729144080e-01   +2.138537855806462e-01   +1.912682764449596e-01   +8.216899792009277e-01   +9.915938551559956e-01   +6.060342847405332e-01; +9.443539039265750e-01   +4.958823599824700e-01   +2.704704274079463e-01   +2.661915071242772e-01   +7.937519556732068e-01   +1.704326139924826e-01   +7.089687327551665e-01   +3.433446261620922e-01; +9.730290496184785e-01   +3.866723817628442e-01   +7.012659735091370e-01   +9.764079814262500e-01   +1.133955639044140e-01   +4.610130318288459e-01   +4.619140146671831e-01   +2.866487913293013e-01; +8.411495488069103e-01   +2.139504237011473e-01   +5.130054227103510e-01   +3.679142256761511e-02   +8.800359807859613e-01   +3.545806119099671e-01   +8.498446662916787e-01   +7.978959027057352e-01; +4.709981337732614e-01   +9.869082932308328e-01   +7.140147251209231e-01   +8.734197145463503e-01   +4.210975784002809e-01   +8.531045462516537e-01   +9.366349176146525e-01   +3.273833165383582e-01; +5.259898613839086e-01   +6.439971678235794e-01   +5.267141382201540e-01   +4.267520233326461e-01   +3.032335980175817e-02   +9.528265844049423e-01   +7.284041507040759e-01   +4.610450293739074e-01; +6.981277184443266e-03   +4.333843684285446e-01   +3.594436607271740e-01   +4.175543500074047e-01   +3.557550769777332e-01   +6.044299232374974e-01   +3.186871004884816e-01   +5.865021546029775e-01; +4.469364800154538e-01   +1.399642091282084e-01   +6.768886036553000e-01   +7.685287943365718e-01   +2.136266133801300e-01   +6.710809737782976e-01   +4.377325317791269e-01   +8.102555204782610e-01; +4.347744372447214e-01   +4.913929760805761e-01   +8.040646984761796e-01   +3.924776775033481e-01   +9.549393199058870e-01   +4.603937522235833e-01   +3.943069429722655e-01   +3.243962229503570e-01; +6.838865832896933e-01   +1.910558985966505e-01   +3.368082292982127e-01   +2.761619396931065e-01   +6.402124703824293e-01   +6.530258776919774e-01   +3.289735353619496e-01   +7.873200929246451e-01; +8.466695926177781e-01   +5.401943144492387e-02   +7.644861688981334e-01   +2.814447014611633e-01   +4.296251788124942e-01   +6.795202942878852e-01   +1.630674600991775e-01   +3.156230398081811e-01];
L1I_L2I_iGABA_netcon = [+5.460926736773815e-01   +1.939891237664373e-01   +7.913777396290584e-01   +2.939526009872140e-01   +6.807616599543403e-01   +3.413619755905503e-01   +8.481915786040058e-01   +2.512268470921040e-01   +6.232017531648175e-01   +9.561685380416808e-01   +4.019699904386708e-01   +4.833862415705159e-01   +3.343920241934323e-02   +8.409025141338627e-01   +6.608049792714247e-01   +4.725341678018083e-01; +2.227058798050132e-02   +9.792138558216833e-02   +3.032595090757831e-01   +3.287478038832038e-01   +8.827626430109246e-01   +3.552488746228827e-01   +3.374746020251052e-01   +1.391105398266248e-01   +4.934002041183208e-01   +2.367924691303467e-01   +2.984125974056174e-01   +2.760758352841630e-01   +9.227262217372428e-01   +1.627370627794064e-01   +9.136879214200373e-01   +2.392728721917713e-01; +3.599298691146032e-01   +6.333768441475509e-01   +4.303712832482640e-01   +6.962321966751193e-01   +2.674166406381353e-01   +5.420750581292302e-01   +7.890194715664042e-01   +1.028127498191690e-01   +8.078051519226298e-01   +5.508936661821768e-01   +6.823709276305872e-01   +9.180078141400481e-01   +9.748885439441238e-01   +7.195083619750030e-01   +3.352427578772143e-01   +1.261089624280134e-01; +8.694264584574865e-01   +1.465127521435717e-01   +6.287890139043307e-01   +9.682331185118261e-01   +5.026626775318865e-01   +9.795318531239051e-01   +6.904290796474524e-01   +9.674375606574181e-02   +3.145147301734852e-02   +3.929069908278718e-01   +4.119480699333591e-01   +5.818976733928766e-01   +3.536314033677623e-01   +5.259143512152471e-01   +2.133787011835264e-01   +1.400171403145684e-01; +9.613024302162702e-01   +8.254858045155673e-01   +7.780897590207909e-01   +6.926333112623601e-01   +2.819021713602728e-01   +6.932768864616387e-01   +7.438914123919197e-01   +6.851388551002772e-01   +1.054751286129350e-01   +7.162554494029170e-01   +1.870177880197636e-01   +3.781164096851131e-01   +7.793338487507542e-02   +2.146475176417329e-01   +7.405771814893033e-01   +9.908098699020897e-01; +5.677504604938444e-01   +4.507966019290295e-01   +1.346186811752311e-01   +3.925555565559095e-01   +9.736395569694218e-01   +1.470137886088565e-01   +7.368780043910281e-01   +6.722610879683121e-01   +5.703275418890669e-01   +7.996768528424327e-01   +3.363093060466620e-01   +5.097613694297344e-01   +8.739852042175387e-01   +8.854358448533903e-02   +1.793880693469172e-01   +5.765319887003542e-02; +7.934643546349307e-01   +9.113548623131718e-02   +3.893650626882315e-01   +3.351991525153998e-01   +5.442417704916570e-01   +9.374877977083685e-01   +1.335432125733578e-02   +2.407763617569710e-01   +7.580206753269135e-01   +9.663356669702028e-01   +9.183587846531976e-01   +9.045589706671933e-01   +1.265500561871881e-01   +3.340035911042148e-01   +1.752106139711560e-03   +5.919608340132375e-01; +8.583944422713159e-01   +4.459943656977117e-01   +3.844538366418885e-03   +9.131360830875104e-01   +1.855962613688925e-01   +9.301656185944164e-01   +8.373769363462218e-01   +4.123091261202551e-02   +7.766144716447055e-01   +5.943544372594698e-02   +9.193807728818466e-01   +2.998888994663229e-02   +8.572464471756203e-01   +8.023468065425843e-02   +9.894306254356374e-01   +6.976744535911720e-01];
L2E_L1E_iAMPA_netcon = [+2.934527729520340e-01   +9.164487050233369e-01   +6.462644338268866e-01   +8.382678572300221e-02   +3.049378925679234e-01   +4.307344981271855e-01   +1.334780863005024e-01   +6.275278725965637e-01; +2.911689188539762e-01   +2.248995447333759e-01   +7.879592859136274e-01   +9.360592049643626e-01   +3.630841252063329e-01   +5.638103771097719e-01   +2.628775761606733e-01   +1.442648897445636e-01; +5.588946088859426e-01   +9.475192780089331e-01   +7.902446189680838e-01   +6.082240762539687e-03   +6.493886197186085e-01   +4.751351956707194e-02   +4.695447472560601e-01   +8.738345453761898e-01; +5.235362197943526e-01   +6.445841590646729e-01   +6.745037215222575e-02   +5.515583260812378e-01   +2.725998737054542e-01   +5.140850594888622e-01   +2.177917700796942e-01   +4.319275863582550e-01; +8.322966002054338e-01   +7.877214082819824e-01   +8.241177129523585e-01   +5.382625145074685e-01   +7.642893300355514e-01   +3.725855323219542e-01   +5.343473480948115e-01   +5.687424473746606e-01; +5.003569448427130e-01   +6.585267214339264e-01   +5.518891426423489e-03   +6.595774245004585e-01   +6.682036167221358e-01   +8.971908243432717e-01   +2.522173157066837e-01   +2.231794570465274e-02; +4.642107770259966e-01   +3.295474293304829e-01   +2.651130172103999e-01   +3.981190101133963e-01   +4.166875680382820e-01   +2.302919961759681e-01   +5.272345077095166e-01   +2.850956142277091e-01; +7.668958494304990e-01   +1.552239244087467e-01   +3.799150245319605e-02   +9.723201277360994e-01   +5.197896315478657e-01   +3.664323561182925e-01   +5.575785830910538e-01   +5.913386988738943e-01; +7.532370487004025e-01   +5.853740071982279e-01   +6.645703073681986e-01   +1.415930643264598e-01   +3.827090033997817e-01   +2.570848293714082e-01   +1.353381095803077e-01   +9.851026620929785e-01; +1.557022137993653e-02   +1.374555372766443e-01   +1.497287249183960e-01   +1.805107420319665e-01   +2.562047494964206e-01   +6.578202417215014e-01   +8.867356437972886e-01   +8.747185740886275e-01; +1.712597570835420e-02   +2.565087010107673e-01   +6.444956442725400e-01   +5.451659702428444e-01   +1.309194819552404e-01   +4.737012910337213e-01   +1.814544106469080e-01   +7.800809589068411e-01; +3.919047257558397e-01   +5.174047690908599e-01   +6.030333683213140e-01   +5.268115618511733e-01   +6.834693765914459e-01   +3.457273675891198e-01   +6.595069455851436e-01   +4.872564272030813e-01; +6.392046981372187e-01   +7.073030574692338e-01   +6.236717673199166e-01   +2.524551225789655e-01   +2.311134697921257e-01   +9.672526445513228e-02   +8.662864731823249e-02   +6.252410920144448e-01; +8.164907334006354e-01   +8.268427647491200e-01   +7.153198667147960e-02   +9.469750794580934e-01   +4.529116449209460e-01   +9.200050915585805e-01   +6.470782892323269e-02   +2.208290630490794e-01; +9.463219580682461e-01   +1.768920946770366e-01   +4.054114701994128e-01   +5.914755178656548e-01   +3.669101360750580e-01   +2.255421044172681e-01   +6.485833549374538e-01   +3.822520759689456e-01; +8.623531901419705e-01   +6.187796099294687e-01   +7.087210014079599e-01   +3.799114092610511e-01   +5.098873482293693e-01   +9.013850663241678e-01   +7.963345674106014e-01   +1.413989731098298e-01];
L1E_L2E_iAMPA_netcon = [+9.311174834336242e-01   +5.028102156601773e-01   +5.934305130575515e-01   +4.979368115098267e-02   +9.957114560629297e-01   +2.463253836758862e-01   +5.427839584926482e-01   +5.143099188094611e-01   +9.733561780728865e-01   +5.385113440200268e-01   +6.338887562624483e-01   +4.994021911310599e-01   +5.243881505083718e-01   +3.553366338545147e-01   +5.409029708367425e-01   +1.914402300055743e-01; +7.828122185871933e-01   +2.347001306853812e-01   +8.992574872561553e-02   +5.649336044517694e-01   +8.542183807756905e-01   +6.760766350778973e-01   +9.423700966811732e-01   +2.836161304623593e-01   +3.446248058504147e-01   +3.607576173968035e-01   +8.487437569175216e-01   +6.773423326034893e-01   +6.486657305680326e-01   +9.300771976017916e-01   +3.965900033607144e-01   +5.742631361012995e-01; +8.081156771623056e-01   +1.166572712669040e-01   +1.022217069244881e-01   +9.796330477767148e-01   +2.594148889215188e-01   +3.744268137475754e-01   +9.888871892504466e-01   +3.231298803854384e-01   +1.717095441249809e-01   +6.213455758731686e-01   +8.484991861903175e-01   +4.873195606749240e-01   +9.218197891038542e-01   +9.990275686559932e-01   +8.722347993085602e-01   +6.859386416656342e-01; +7.328826333594721e-01   +1.471911534200101e-01   +5.733131975111825e-01   +4.302802350028022e-01   +4.205754153035278e-01   +8.635679579806512e-01   +2.021904112024569e-01   +1.543938792907371e-01   +6.179604665893300e-01   +4.334897858041540e-01   +3.908917537732242e-01   +9.636182907529988e-01   +7.781556758967706e-01   +8.499074933792079e-02   +7.479937925983355e-01   +7.979905842957791e-01; +5.023405156855806e-02   +2.785536354435021e-01   +1.819105054572579e-01   +7.908395321618567e-01   +2.166237048287232e-01   +4.756216903452652e-01   +9.958298168751809e-01   +3.280973748505180e-01   +1.707631058308408e-01   +7.634298000925505e-01   +1.058439307177191e-01   +5.860306923996842e-01   +9.733714635024185e-02   +6.301778874425897e-01   +4.137649493066822e-01   +1.265066319869035e-01; +6.372832648138046e-01   +4.995464907537032e-01   +4.041906597888272e-01   +9.274534411318886e-03   +9.840608655418313e-01   +8.710526511844000e-02   +5.099795422779622e-01   +2.224776163442326e-01   +8.245403995568494e-01   +1.677568197801745e-03   +7.831244616743590e-01   +7.039335562265085e-02   +7.428166723398645e-01   +5.174980010818335e-01   +6.763364544825851e-01   +3.299484661969025e-01; +3.211599971421042e-01   +6.516102110877323e-01   +4.305217043399916e-01   +4.422919863100476e-01   +4.138573042451311e-01   +9.358948711801668e-01   +9.488217560297063e-01   +3.833707697466172e-01   +6.991995166334581e-01   +7.815264731869672e-01   +5.087983248153389e-02   +1.398459477863162e-01   +7.500032899585286e-02   +3.684838951034560e-01   +3.865461094573570e-01   +7.588345543273703e-01; +2.198831943916736e-01   +4.765566031200399e-01   +3.112402839883968e-01   +4.357006101456307e-01   +9.384352863196668e-01   +4.823466473213101e-01   +9.690207114310002e-01   +8.950237471605336e-01   +3.931794069673851e-01   +6.936440427281548e-02   +3.834063524021107e-01   +3.276802753313923e-01   +3.618807209020438e-01   +7.676144901870215e-01   +8.777840406444422e-02   +5.267441920533658e-01];
L2I_L2E_iAMPA_netcon = [+3.555108944191159e-01   +2.068441407619767e-01   +4.070267485038654e-01   +5.745701123457683e-01   +1.860322623667874e-01   +9.014678083609157e-01   +6.580245260578046e-01   +2.724636478606232e-01; +5.364949534142055e-01   +2.402179847613568e-01   +6.287788391239161e-01   +2.490012870576883e-01   +6.715914293784404e-01   +8.004561779048464e-01   +7.011813763890423e-02   +5.074821346158680e-01; +6.247118188023003e-01   +2.304368163078701e-02   +6.539933377104395e-01   +5.831705619393360e-01   +1.600720870875591e-01   +6.277010677872874e-01   +8.289635987579974e-01   +1.853336391794622e-02; +4.717712690425002e-01   +2.828788925450215e-01   +7.612307308738528e-02   +9.967345622761945e-01   +3.545735395726535e-01   +6.073841368342978e-01   +9.356322653864133e-01   +1.768727781113018e-01; +1.442179620473150e-01   +4.265126609395741e-01   +3.915446936268196e-01   +8.146769683573891e-01   +8.318549459851240e-01   +5.747434144983793e-01   +6.904590753710788e-01   +2.886439931091093e-01; +8.817809108661013e-01   +5.415390834828470e-01   +8.730016888596172e-01   +8.715426288050713e-01   +7.605104975187837e-01   +8.541748759125238e-01   +8.944219316853851e-01   +5.216733441223418e-01; +1.631847099181967e-01   +5.764659611685692e-01   +9.354995081054585e-01   +9.230390759495039e-01   +1.021982356013145e-01   +7.480854185418131e-01   +2.696724438330047e-01   +5.247250932245513e-02; +5.687053828809137e-01   +3.823086087642240e-01   +1.718946037517556e-01   +2.977866955136207e-01   +7.379122220675357e-01   +3.869184685398795e-01   +9.667685473115259e-01   +6.447671698118790e-01];
L2E_L2I_iGABA_netcon = [+5.140984192771165e-01   +6.526926670743032e-01   +6.758129490238312e-01   +5.695078603154577e-02   +5.306527800278162e-01   +5.205146014920931e-01   +3.360952910248767e-01   +7.495991510419265e-01; +4.560429277222790e-01   +3.947946486312858e-01   +5.810702177668321e-02   +5.106929427234247e-01   +4.938683222480887e-01   +6.140448815162560e-01   +4.704706601474486e-01   +4.881103082658745e-01; +6.359733799250805e-01   +4.646083787155015e-01   +4.251594174613026e-01   +5.626822452642167e-01   +3.560055038149151e-01   +3.042772831297179e-01   +1.889148378661231e-01   +9.884774163123728e-01; +7.602469189111509e-01   +5.691365512421189e-01   +4.593861760020752e-01   +9.166287663652923e-01   +2.278672419699732e-01   +3.728482895464637e-02   +1.262378140208433e-01   +4.987293270715998e-01; +5.078670556833869e-01   +8.356089667179292e-01   +5.206589413289753e-01   +8.693330648140053e-01   +3.537775677933426e-01   +7.923260258631767e-01   +7.088783754674740e-01   +3.731358835488883e-01; +4.282296923123434e-01   +2.998016747678083e-01   +5.281027097392991e-01   +3.820760080269383e-01   +7.869093834412373e-01   +9.055155306689843e-01   +1.232442787765892e-02   +4.888854135281563e-01; +9.964665892325725e-03   +5.010349364881104e-01   +8.712807914516809e-01   +5.828364105137265e-01   +5.057115708925086e-01   +3.996757022791934e-01   +9.604547128336833e-01   +1.162019592502361e-02; +9.259873947725724e-01   +5.741138728297287e-01   +9.880878907131979e-01   +4.956089452939839e-01   +9.686955499716552e-01   +6.000964320483348e-01   +4.268674855103130e-01   +3.925984105974680e-01];
L3E_L2E_iAMPA_netcon = [+2.461019567443921e-01   +9.153857728218044e-01   +4.322579896504780e-01   +8.292056802575792e-01   +1.665156128405697e-01   +4.365769657671236e-01   +4.501347623780961e-01   +8.799555269143369e-02   +1.183681917330536e-01   +5.865264874384895e-01   +1.699701717544603e-01   +4.984249182360096e-01; +2.377736221721211e-01   +5.258894716152455e-01   +2.032265263663048e-01   +2.816534952536374e-01   +6.392821584566986e-01   +9.565488189332928e-01   +7.563274016530570e-01   +5.939913743184961e-01   +2.840532414246529e-01   +3.728588024529211e-02   +2.424369997698730e-02   +1.160555108352986e-01; +8.367476595261502e-01   +3.962652147618656e-01   +5.245273845775121e-01   +8.247706260431452e-02   +8.776524885671325e-01   +8.722481552955688e-01   +5.666976877280417e-01   +7.567190519700843e-01   +6.925922555093621e-01   +3.815559933922533e-01   +4.318686074873552e-01   +9.442965923645302e-01; +1.908635840350845e-01   +4.457652670090350e-01   +2.370717128468220e-01   +8.194326245390224e-01   +5.159021380450141e-01   +6.060942335074827e-01   +8.753957534542435e-01   +3.278895870994348e-01   +8.584572224332163e-01   +8.493756247847906e-01   +4.780145185433902e-01   +2.156291280322528e-01; +2.258922298711096e-01   +8.194876259273410e-01   +4.050396422373783e-01   +6.521516122362873e-02   +2.022732903420617e-01   +9.869462644369960e-01   +3.572737399327127e-03   +6.971615335809243e-01   +6.610150773473021e-02   +8.441821382142431e-01   +2.873875588563933e-01   +2.384510770680151e-01; +4.324921040395567e-01   +3.436822152948385e-01   +8.268208308634305e-01   +9.808757240022645e-01   +4.580863465867627e-01   +9.890641406352427e-01   +1.454894753450933e-01   +4.375412486130569e-01   +4.980237990021865e-01   +8.128508532190767e-01   +6.771636220408714e-01   +8.289701753565352e-01; +1.696547236717611e-01   +5.046450674224904e-01   +6.215417655339678e-01   +1.125686922673272e-01   +6.321740600574723e-01   +4.700542525112094e-01   +7.972840963102107e-01   +1.343209348243881e-01   +4.538208864247360e-01   +3.508186822074904e-01   +9.744697887746077e-01   +7.720776977085259e-01; +5.875640650911208e-01   +5.167601133872912e-02   +4.128718007401322e-01   +2.196130953770404e-01   +1.996077977297349e-02   +9.636537568335174e-01   +4.002932084771799e-01   +4.410110918019445e-01   +9.001141116041120e-01   +9.610795600272435e-01   +9.494353284884998e-01   +3.436607378044142e-01];
L3I_L2I_iGABA_netcon = [+4.432728826757691e-02   +3.940980616101003e-02   +7.125261981784593e-03   +6.903958251638787e-01   +6.186331452617993e-02   +4.462885398272551e-01   +8.452267313413147e-01   +4.318189208037202e-01   +4.535631342761700e-01   +9.709361454531302e-01   +9.566136756453262e-01   +6.557889870813929e-01; +3.758122013333778e-01   +4.544358891666950e-01   +2.989108733512805e-01   +5.117772185874037e-02   +4.511176658994443e-01   +6.361993001814461e-01   +4.276100975033802e-01   +9.089918903709203e-01   +1.442008260139158e-01   +9.668171844275715e-01   +2.876767036628771e-01   +6.220387258792373e-01; +2.974688467614612e-01   +7.612052856531044e-01   +3.052927276181366e-01   +8.052478129855256e-01   +3.692042233009495e-01   +8.249722413379652e-01   +9.262336697442887e-01   +5.898266435211580e-02   +6.328415667279915e-01   +4.718681310396494e-01   +1.604272588974059e-01   +5.849920546006876e-01; +6.238294253216050e-01   +9.693495226317345e-01   +3.745145882523476e-01   +2.734009178448991e-01   +1.635417310095413e-01   +6.051559048182755e-01   +2.429682483484556e-01   +3.436090111929208e-01   +9.990196662609536e-02   +3.822370817357996e-01   +5.314862154930605e-01   +8.532248515200340e-01; +9.594151730052406e-01   +1.264303348460199e-01   +4.583834163754051e-01   +8.034111435082231e-01   +5.305436418814476e-01   +8.921725762650432e-01   +1.385043576572277e-01   +5.257848014417928e-01   +5.591789405484885e-01   +8.405185853307519e-01   +7.697378587011631e-01   +5.316523381246053e-01; +9.723871285235176e-01   +2.085867339127829e-01   +1.251518494880166e-01   +7.416117997726953e-01   +9.881337137483774e-01   +7.277460195941297e-01   +8.910206299664313e-01   +5.019259836511689e-01   +1.392821884933682e-01   +8.962710504594530e-01   +4.044412899175518e-01   +6.720105215381091e-01; +1.079317498024640e-01   +5.362441138003411e-01   +9.515543541290099e-01   +6.091584248200725e-01   +9.979364917196781e-01   +8.629324407693957e-01   +8.668274300855827e-01   +8.492605601522778e-01   +6.188356316012907e-01   +3.546270998043328e-01   +3.156685872002859e-01   +6.058348605972912e-01; +3.457403834967309e-01   +2.050704289819883e-02   +7.742668342137774e-01   +2.090341745246402e-01   +4.852946698238236e-01   +3.699902153346236e-02   +7.933106019292049e-03   +9.774380974602549e-01   +5.201838923524280e-01   +9.861056841848333e-02   +7.383625176559864e-01   +9.899493759066203e-03];
L2E_L3E_iAMPA_netcon = [+9.282460796728613e-01   +2.930087121607010e-01   +5.763201882501269e-01   +6.657707549658513e-01   +2.693482806972563e-02   +6.874936256042476e-01   +7.410360624244900e-01   +5.627515095384086e-02; +3.286784865372878e-01   +5.887111115542691e-01   +6.524585240603421e-01   +7.732486287703588e-01   +2.264571907225923e-01   +2.403839213576694e-01   +8.514839092890856e-01   +1.199121125873496e-01; +6.039568323433236e-01   +5.060912992710709e-01   +9.140052709417618e-01   +7.033510787798714e-01   +9.162478977467163e-01   +4.936051998240421e-01   +9.982373997202884e-01   +5.583156519340053e-01; +1.569884053902480e-01   +9.760859406923792e-01   +9.387035489437577e-01   +4.221755417758396e-01   +3.786854871502408e-01   +9.856363132242654e-01   +2.212063088515646e-01   +5.357623838855552e-01; +6.633046870371873e-02   +2.120762895196334e-01   +7.206890710950318e-01   -2.482870701859725e-03   +1.834429312167701e-01   +4.890245705968017e-01   +5.536062587550270e-01   +6.668839702433038e-01; +4.474811558269933e-01   +7.570290011661542e-01   +2.005290076633323e-01   +8.242822990757023e-01   +4.499109486509140e-02   +1.001077243709064e-02   +4.728133592498283e-01   +3.174115248146274e-01; +5.126566290454744e-01   +8.051616696927074e-01   +7.956410825236410e-01   +2.794308064635725e-01   +8.509941541304062e-01   +2.135785698705651e-01   +7.457614979656118e-01   +9.972386480426759e-01; +3.003398897835075e-02   +5.880806915316824e-01   +9.766629680822920e-01   +4.555740795741111e-01   +9.536130996446386e-02   +7.606919211290266e-01   +1.229491214671728e-01   +3.879043219520615e-01; +9.825632126390030e-01   +9.495836455703281e-01   +7.721891195289005e-02   +1.302780351533154e-01   +1.634667377167680e-01   +9.512253921188903e-01   +2.712280950367041e-01   +9.594057391579799e-01; +1.501259859591292e-01   +3.617608382109397e-01   +8.036750227599315e-01   +3.369635730125335e-01   +4.104710309951785e-01   +9.909271864925632e-01   +7.963727312661539e-03   +9.960079834038008e-01; +6.901395722908553e-01   +4.097199928902968e-01   +2.484408747650370e-01   +1.948158690856276e-01   +1.460428518817230e-01   +3.237208771822431e-01   +2.445047519831860e-01   +1.126034552717955e-01; +1.175999690727103e-01   +6.494585825750929e-01   +8.147741329830500e-01   +4.696304494454999e-01   +4.770499397912398e-02   +7.920651014563505e-01   +7.894610119547851e-01   +8.149019464226435e-01];
L2I_L3I_iGABA_netcon = [+3.587496529652167e-01   +6.487458730278758e-01   +2.733853271222828e-01   +7.324874368148677e-01   +6.104086596557288e-01   +5.094374618132769e-01   +4.203704555897270e-01   +4.981764517403749e-01; +3.365850562329737e-01   +1.639114945674788e-01   +5.537709925659025e-03   +9.033330772523844e-01   +7.916657418919683e-01   +7.292955041080172e-02   +1.167633933840179e-01   +6.924708647360419e-01; +3.409547963129159e-01   +6.543964828737807e-01   +4.149588117899133e-01   +1.485908910701581e-01   +8.807905030300038e-01   +5.847106721930420e-01   +1.821801792574168e-01   +1.227974427064446e-01; +6.453997825485673e-01   +9.051329817911592e-01   +6.344786592047773e-01   +5.239056955071064e-01   +5.734904813707843e-01   +7.409824939087840e-01   +4.503570140907790e-01   +7.623351146203073e-01; +2.043294625277155e-02   +2.486437638637930e-02   +1.352290456462530e-01   +6.674090484135975e-01   +2.628514540850687e-01   +7.417178969020652e-01   +4.935309446235501e-01   +3.877200504554340e-01; +5.249777703952282e-01   +4.833408436395173e-01   +4.717304614735353e-01   +7.632124586654871e-01   +3.077069199285552e-01   +9.440334836159553e-01   +3.355322785270443e-01   +1.299037957311742e-01; +2.692891106718227e-01   +6.442392933600830e-02   +5.071861042968058e-01   +9.948065511199917e-01   +7.076666135742912e-01   +9.812625801008833e-02   +2.741528664029153e-01   +8.369295293898255e-01; +2.347255568518840e-01   +9.589443294491257e-01   +9.946932037989774e-01   +9.891051044208098e-01   +5.240008572284058e-01   +1.281920200830800e-01   +7.952632551898681e-01   +1.096766336946062e-01; +3.827089842016740e-01   +5.191111942500051e-01   +3.471772307844719e-01   +2.087419841071151e-01   +3.299667174824289e-01   +2.910022118842082e-01   +6.270715022645201e-01   +5.275452187714560e-01; +4.127439656449713e-01   +2.123143934440549e-01   +2.155093522299022e-01   +3.630208032939854e-01   +9.856982948192377e-01   +5.038579095257482e-01   +4.771118558708857e-01   +9.858826255607764e-01; +6.397529458368840e-01   +1.416263545043903e-01   +2.950032385263502e-01   +6.621697698673197e-01   +5.198818133251419e-01   +7.904504357871107e-01   +9.432405297585621e-01   +6.953770078389007e-01; +4.156413484077977e-01   +2.694175881116126e-01   +6.655279980347610e-01   +2.846259523753349e-01   +9.387175719757050e-02   +7.569741213069949e-03   +3.113822126176340e-01   +7.208067701643881e-01];
L3I_L3E_iAMPA_netcon = [+6.923663814102310e-02   +7.375739475494343e-01   +1.439780725057269e-01   +2.127150479973946e-01   +3.087796976855913e-01   +6.779727106782391e-01   +9.208196903030398e-02   +3.955724108547176e-01   +5.282099958292771e-01   +2.946543893836228e-01   +6.267734586204201e-01   +8.853964858428796e-01; +3.479395561784824e-01   +8.595504204478984e-01   +2.676434349163638e-01   +3.931812365280057e-01   +8.560832356710024e-01   +3.433665732509011e-01   +3.920639709066121e-01   +4.271900343489261e-01   +6.364928767403346e-01   +2.850206229014445e-01   +7.599593659862991e-01   +2.312741226813348e-01; +4.780653745352212e-01   +3.602876074415901e-01   +7.422218556484546e-01   +9.299933370044068e-01   +6.409918330134537e-01   +6.020059163103677e-01   +9.944490000507282e-01   +3.974226477178874e-01   +2.566361212977061e-01   +3.065622614283681e-01   +9.345349377510657e-01   +8.314723475723397e-01; +5.798087091330137e-01   +6.985113713664723e-02   +5.873669767481925e-01   +7.965598528843914e-01   +4.631195707820278e-01   +5.796754678782465e-01   +5.871708711449358e-01   +6.915175662606884e-01   +5.818145555873208e-01   +2.187829217269527e-01   +4.361489800761714e-01   +4.668061549777863e-01; +9.957639447702608e-01   +8.961783052916014e-01   +5.967734746055257e-01   +5.002588963145068e-01   +2.523613316733292e-01   +3.571074571700315e-01   +1.952331590680276e-02   +2.319128844920234e-01   +2.865657518136889e-02   +2.749119032238206e-01   +9.251469370546499e-02   +5.174520663473987e-01; +4.295602817046373e-01   +2.052445361107612e-01   +6.417331212171936e-01   +4.706048586493913e-01   +9.307946495985813e-01   +6.616119563333897e-01   +3.128931669090573e-01   +7.025613182748372e-02   +1.882924707000025e-01   +5.522450795773444e-01   +3.719710395232262e-01   +4.627860600449928e-02; +4.891215620515280e-01   +2.133407432589830e-01   +8.622582304576982e-01   +8.741372505701610e-01   +1.892480125366991e-01   +3.257463041571005e-01   +3.479712405917685e-01   +1.385287659329303e-01   +9.371464065293664e-01   +6.555306615396322e-01   +2.441025384620773e-01   +5.186143019804865e-02; +3.654908798595811e-01   +4.697027819815178e-01   +2.203393915947998e-01   +5.824513454958071e-01   +8.702964228745920e-01   +2.772739625262353e-01   +3.963706236734050e-01   +2.843927140291653e-01   +3.532689799633384e-01   +2.536860969871583e-01   +6.792179608819459e-01   +5.881579215071161e-01; +3.167869589125425e-01   +5.569263242907833e-01   +3.466995094034828e-01   +5.824014297207970e-01   +5.610021907730979e-01   +2.859766614684786e-03   +8.618228769651889e-02   +8.754334524771003e-02   +2.986215194994744e-01   +2.055211464217924e-01   +9.235830276427865e-01   +9.035388187377427e-01; +7.395959849317858e-01   +6.194617788558958e-01   +6.001726208449185e-01   +4.027650718235921e-01   +4.866718238795307e-01   +3.900290217503987e-01   -1.537256159352121e-04   +6.259962801955948e-01   +2.175054345611112e-02   +9.082412767780745e-01   +4.722897488460363e-01   +1.703577393439180e-01; +6.765232025757320e-02   +2.781183310987506e-01   +6.604127656250864e-01   +2.212937885456131e-01   +7.418950867941081e-02   +5.190724702585524e-01   +8.639783183770947e-02   +7.682196824895230e-01   +8.000463705577345e-01   +1.674020959419018e-01   +6.460083257722875e-01   +2.753685567995701e-01; +6.346025367032825e-01   +6.274909288377530e-01   +4.285540026344582e-01   +6.237507224145754e-01   +6.436856928838842e-01   +4.423359542676635e-01   +3.526532376088272e-01   +8.540174765329256e-01   +6.522800875475663e-01   +4.183864432615655e-01   +5.449357146035034e-01   +4.026792786562353e-01];
L3E_L3I_iGABA_netcon = [+3.615907655303147e-01   +7.717078070624465e-01   +7.315376843033035e-01   +9.499236014311738e-01   +4.432150724381088e-01   +1.166064882012734e-01   +3.358821722191247e-01   +7.213749685979977e-01   +8.073900527531856e-01   +2.468942500852234e-01   +5.579213411235743e-01   +3.139941066824802e-01; +8.793910707018500e-01   +4.112528739921952e-01   +6.127243450329185e-01   +3.757726807037167e-02   +9.714873718153336e-01   +4.032508098190990e-01   +8.685460328731849e-01   +7.554435208414636e-01   +6.725083668272042e-01   +7.668612583454014e-01   +2.675944376983656e-01   +5.511966361321035e-01; +8.590090539179580e-01   +3.311836651118653e-01   +3.850185668461998e-01   +4.748692094265773e-01   +5.736027995893502e-01   +5.636284463773437e-01   +2.735208977533379e-01   +8.834444506274030e-01   +6.360677087156722e-01   +1.006897591656862e-01   +8.298140791366276e-01   +8.648002216208626e-01; +1.067469258347548e-01   +6.696833814684725e-01   +3.331796982307065e-01   +3.156918127393800e-01   +8.334499915211770e-02   +7.354506379690535e-01   +2.617722159597815e-01   +1.312811238407221e-01   +2.735310315215774e-01   +4.836058727778588e-01   +8.083654903721958e-01   +5.808031844888188e-01; +2.758583881687199e-01   +7.744096333028325e-01   +6.140578439469200e-01   +2.985709365761777e-01   +7.711125660210745e-02   +6.152838049541182e-01   +9.458607992415181e-01   +2.483414875435337e-01   +3.499358733457275e-01   +8.099601877104600e-01   +6.492055391187911e-01   +2.326884545066590e-01; +4.674607479768415e-01   +8.378790956812878e-01   +7.803137493845359e-01   +5.120838197070442e-01   +7.642631127998181e-01   +9.783814202408736e-02   +4.227537220500830e-01   +3.821082014241008e-01   +8.307109792654337e-01   +8.856770263464706e-01   +8.511308768238259e-01   +2.654610714383640e-01; +5.120837989195811e-01   +8.087589919081005e-01   +2.260480939150569e-01   +2.652344894709899e-02   +4.186478192485049e-01   +6.626412762869709e-01   +6.451243181750956e-01   +2.014884083684909e-01   +9.823340778981424e-01   +6.441300961380997e-01   +2.845316255185924e-02   +4.001254766805419e-01; +4.772575378869490e-01   +4.389520330199652e-01   +8.612067573394330e-01   +3.840026379217431e-01   +7.502388515803461e-02   +1.320072701625149e-01   +6.107162345813248e-01   +4.691053279601547e-02   +6.176407595205242e-01   +8.786949661174680e-01   +2.507526396751802e-01   +9.949348415070143e-01; +3.186863791888863e-01   +5.931963664399307e-01   +2.170601928860272e-01   +6.942453282061072e-01   +9.239070503355015e-01   +1.387629896105927e-02   +3.353206424935878e-01   +6.000007178236726e-01   +6.198488896871313e-01   +9.950649492643818e-01   +7.053366424149278e-01   +6.362116302397653e-01; +8.082697929306233e-02   +8.890498494847746e-03   +3.403655471513555e-01   +6.044224269212444e-01   +7.913932951136744e-01   +2.770691115025105e-01   +1.857198659267683e-02   +2.992312079062351e-01   +7.432050885663951e-01   +2.855505034181048e-01   +6.382126251118310e-01   +8.091129887646523e-02; +9.492855167414027e-01   +1.200314939357123e-01   +7.491566115283281e-01   +4.956478896415215e-01   +4.494111778986717e-01   +8.719721996189694e-01   +7.900739196202905e-02   +8.321080269166758e-01   +3.814042435605906e-01   +9.726721510136536e-01   +4.441998748831348e-01   +7.542527186169428e-01; +6.816279798142515e-01   +8.455325971649298e-01   +5.186371440440665e-01   +9.003432171404726e-01   +8.817362420781578e-01   +5.133035747010263e-01   +9.974382437064906e-01   +9.411346380088021e-01   +4.942544448434997e-01   +9.378516880338785e-01   +5.563423627755577e-01   +9.234195966845281e-01];
L2E_Input1_iAMPA_netcon = [+9.939366054028108e-01   +9.997768089275034e-01   +9.956327307578028e-01   +9.952409970330763e-01   +9.943969416448384e-01   +9.955861936282949e-01   +1.000000000000000e+00   +9.965769016328704e-01];
L2I_Input2_iAMPA_netcon = [+9.968329107658109e-01   +9.981513154578603e-01   +9.967415055785339e-01   +9.931032829364269e-01   +9.973627276087053e-01   +9.946005829177070e-01   +9.960471504036648e-01   +1.000000000000000e+00];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
