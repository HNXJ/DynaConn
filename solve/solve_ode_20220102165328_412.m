function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.661446432280942e-03   +8.708864032925204e-02   +1.510167144918116e-01   +1.195698480733926e-01   +1.054110198423479e-01   +1.618862260560798e-01   +8.002963984223403e-02   +3.457220972460676e-02   +3.270709821570854e-02   +7.157979872760796e-02   +1.005215791193883e-01   +3.692745262754581e-02   +7.284208134788803e-02   +1.147008560570823e-01   +7.615800680927547e-02   +1.514162227237357e-02; +6.552072655666968e-02   +5.652706766708235e-03   +8.970352082514345e-02   +1.044604410495967e-01   +4.834988467246330e-02   +5.132853285441867e-02   +1.510418122887524e-01   +1.626204097139242e-01   +1.126150497982450e-01   +3.289799526490440e-02   +1.692210037621963e-01   +4.035890012972602e-02   +3.796072862344049e-02   -3.047242005928447e-03   +9.168053408028012e-02   +5.779243397367154e-03; +1.114851465029765e-01   +1.134517019247159e-01   +1.474391331017829e-01   +7.879530389688545e-02   +1.439117755428110e-02   +1.441988163563143e-01   +1.457499144139717e-01   +7.196750889091481e-02   +7.589143137487896e-02   +6.707301529424484e-02   +8.234245053033178e-02   +2.658990003512953e-02   +1.412107782786149e-02   +2.805574487514638e-02   +1.412275142804502e-01   +1.033751242079593e-01; -1.444149947160517e-03   +2.735730133500189e-03   +8.077423587611306e-02   +1.043063076729371e-01   +3.513378218772330e-02   +1.300124266944112e-01   +7.510774796264205e-02   +1.582429334448630e-01   +7.530591692146937e-02   +4.712359648916951e-02   +1.481429638240528e-01   +1.505531402537492e-01   +2.069566360015144e-02   +1.539275665653637e-01   +3.767549925718387e-02   +5.235260944821751e-02; +8.469261905029278e-02   +1.094226501502987e-01   +1.054543082195567e-01   +1.187501605087855e-01   +6.386969216522594e-02   +1.402199737357383e-01   +8.628550737933910e-02   +4.668897217384819e-02   +9.061190121199254e-02   +1.430753063234430e-01   +5.882815905223472e-02   +1.148568354151002e-01   +4.054977831094293e-02   +5.139933220533569e-02   +1.519629586756377e-01   +2.666829030069472e-02; +8.289132920084649e-02   +2.301325639919703e-02   +1.442167680915332e-01   +2.865705201555413e-02   +1.016433409540423e-01   +5.324446230720747e-02   +7.134277928434697e-02   +3.501557236965046e-02   +7.783649746460394e-02   +7.960724572450753e-02   +1.194805494222018e-01   +4.304007793380629e-02   +7.762931652934672e-02   +8.927486571234718e-02   +7.896348763608184e-02   +1.187365018882203e-01; +5.306558135541055e-02   +1.144785714992576e-01   +1.585640790766673e-01   +1.070198865225859e-01   +6.480228175457757e-02   +1.035631022571916e-01   +6.387768984171420e-02   +1.378756298835020e-01   +1.593600317715538e-01   +6.644444289800377e-02   +2.628497863963721e-02   +2.862328380818917e-02   +7.154161880500773e-02   +1.601477667991469e-01   +1.027098728410037e-02   +3.920934215273074e-02; +9.296492298235375e-02   +5.536065419860860e-02   +1.261579944609587e-01   +1.071618357516909e-01   +9.930301825140632e-02   +2.483953339818808e-02   +7.314457220241845e-03   +7.508501367451431e-02   +1.290104997518624e-01   +1.098324728728095e-01   +4.579665766707301e-02   +1.284588362835301e-01   +4.708682575409585e-02   +1.799967239046951e-02   +1.187680800305851e-01   +1.034776460980635e-01; +1.004291372919055e-03   +1.116579742149554e-01   +1.129438842446327e-01   +1.147212166112570e-01   +1.837996663930581e-02   +1.489538784906767e-01   +7.329968332890772e-02   +7.558653452850468e-02   +7.947872393393557e-02   +7.946968654021534e-02   +2.988716247073339e-02   +1.533205494111486e-01   -3.168921202320252e-03   +1.244937836292571e-01   +6.345424232059335e-02   +8.387000068902023e-02; +1.170942792035565e-01   +2.265689038105062e-02   +1.469698100590155e-01   +1.359713518831178e-01   +1.055799543403685e-01   +3.205121631594913e-02   +1.414186309249004e-02   +7.378394973084542e-03   +1.244980087620203e-01   +6.849874555814067e-02   +2.195238971812853e-02   +9.145600946136608e-02   +1.390373583541089e-01   +3.906831502501442e-02   +1.433293764950486e-01   +1.049054249166440e-01; +6.954660645530819e-02   +8.478041757275172e-02   +8.542540357022502e-02   +1.314589238100983e-01   +1.478149444769372e-01   +3.599638458387113e-02   +1.055212178178771e-01   +9.648932413450086e-02   +4.353186259669670e-02   +4.670505381135921e-02   +1.192722660146535e-01   +1.613258408669445e-01   +2.462427513003982e-02   +1.200365640633368e-01   +1.277519144406114e-01   +3.326917154594670e-02; +8.694403870789166e-02   +4.775864036413113e-02   +1.834562494467560e-02   +2.420247718695386e-03   +1.610661181898764e-01   +1.482421457746607e-01   +1.057961120956403e-02   +1.171424783667758e-01   +1.174806017929268e-01   +5.062037559387187e-02   +2.068197311268462e-02   -7.399757559458811e-04   +1.520068924508800e-01   +1.482165132282878e-02   +9.024486934345215e-02   +7.113806027514046e-02; +1.098323827271637e-01   +1.238819233447563e-01   +1.456279938947520e-01   +2.861332826464992e-02   +1.068581479865136e-01   +1.143370821894460e-01   +1.191936016551705e-01   +1.084097219307832e-01   +1.514659336036763e-01   +7.481608640388963e-02   +6.693367201485785e-02   +1.524966848496318e-01   +1.381208356882877e-01   +1.162703530254382e-01   +8.122758395151428e-02   +1.476901960537053e-01; +1.452953160222162e-01   +1.093543993046128e-01   +5.184098642607790e-02   +1.016291053178880e-01   +2.184571334488384e-02   +4.271171098918491e-02   +1.466695738567004e-02   +4.328314171294129e-02   +5.971541100203609e-02   +1.185483983631993e-01   +3.510149377814340e-02   +1.377494340838940e-01   +9.321974572192439e-02   +1.054305210946972e-01   +6.829147168443483e-02   +5.423936745657103e-02; +4.324091114877087e-03   +9.248746328348301e-02   +1.413953520009980e-01   +8.912855717232074e-02   +4.671994982802433e-02   +3.173670515977659e-02   +5.045567327496135e-02   +6.676591904552676e-02   +3.788529816168659e-02   +1.671502560032285e-01   +5.452562906050112e-02   +1.164171976367072e-02   +2.883091190342189e-02   +1.224986118365764e-01   +3.887751059230168e-03   +1.125310014037318e-01; +1.311547636757087e-01   +5.831194731609833e-02   +3.393308122125024e-02   +1.571988707697531e-01   +1.794306048749318e-02   +2.574876221742585e-02   +1.475937293978122e-01   +2.605321006554552e-02   +9.435678290305785e-02   +1.324963821214358e-01   +1.092655590515144e-01   +2.884436812218189e-02   +1.278506459125080e-01   +1.274099699178650e-01   +1.537471351233140e-01   +1.436692419115029e-01];
L1E_L1I_iGABA_netcon = [+8.301690269906610e-02   +1.013383096118018e-01   +6.617279101070559e-03   +5.299097568207348e-02   +1.380094274101731e-01   +6.587785932720434e-02   +6.201701421832761e-02   +3.733525942228081e-02   +1.658407042867260e-02   +5.685021345285308e-02   +5.763679897538842e-02   +9.783710266396083e-02   +4.867095706124065e-02   +1.493699582645354e-01   +3.422634329206896e-02   +8.247321824943425e-02; +1.730664226239087e-02   +1.520094720354975e-01   +8.366392761523303e-02   +1.436644887781468e-01   +7.767895535948205e-02   +7.447529514917103e-02   +2.995369220696700e-02   +8.156991665111528e-02   +8.554952081944774e-02   +2.628942439611238e-02   +2.869966683712727e-02   +1.188195291223704e-01   +7.637697960261501e-02   +1.166107752885458e-01   +8.098046729042147e-02   +1.207183366912346e-01; +1.038980177627726e-01   +1.672839314967101e-01   +1.358396485985774e-01   +1.105807878889407e-01   +1.489518018776280e-02   +9.840688320453540e-02   +1.094253458142103e-01   +1.450200356200709e-01   +1.472181334298324e-01   +1.623361893145293e-01   +1.091384843241277e-01   +8.670917725195186e-02   +1.593315920168020e-01   +1.365913470778403e-01   +7.328291999941322e-02   +9.897116162538329e-02; +1.562230330733116e-02   +2.457405525831887e-02   +1.476470980183187e-01   +1.256132996934295e-02   +2.778042251267174e-02   +1.202092846050393e-01   +1.188862294506736e-01   +9.188677112746814e-02   +8.450673828520019e-02   +1.610659934606803e-01   +1.067868825822240e-01   +1.401342989201706e-02   +6.012411359143116e-02   +3.020438074845904e-02   +1.347170931142980e-02   +1.651517736299017e-01; -6.494654586344014e-05   +1.460743776184347e-01   +8.201827786201420e-02   +2.111817445136303e-02   +6.784961703779183e-02   +1.398427307830579e-01   +1.188618052705298e-01   +6.868802324914694e-02   +1.701422280904492e-03   +2.861353434279268e-02   +1.156165399794005e-01   +2.097493018737782e-02   +1.389244738817892e-01   +7.682872223383171e-02   +1.082256257434282e-01   +8.610743479951784e-02; +1.329150367166867e-01   +1.543415457939246e-01   +2.147495045781753e-02   +1.137980883460579e-01   +6.276362888341101e-02   -3.854171793128782e-03   +1.156560435501442e-01   +4.736546348384565e-02   +1.410909641977894e-01   +2.361739018528605e-02   +1.557575576113600e-01   +2.310746715224537e-02   +6.068989882385514e-02   +2.007556520625901e-02   +9.092476632556624e-02   +2.177229267150770e-02; +8.667481137196932e-02   +3.410429637037100e-02   +2.167822523407919e-02   +4.288331443248512e-02   +3.204512048680407e-02   +6.244191901982708e-02   +5.149260255589901e-02   +9.002190600115854e-02   +1.497783199852739e-01   +2.664789425872160e-02   +1.278762181043216e-01   +1.733353921820305e-01   +1.647283717303062e-01   +8.060427280541628e-02   +8.549404843677068e-02   +5.019834264150115e-02; +4.711178796685396e-02   +3.581657665319887e-02   +1.755806806402053e-03   +2.403210382717020e-02   +1.156296839414358e-01   +8.644773651030851e-02   +8.203171955209530e-02   +1.039285671187259e-01   +3.446574794585735e-02   +7.514153799872662e-02   +1.406533867190319e-01   +1.608015500789699e-01   +8.853634701043037e-02   +8.020015280062011e-02   +2.607922696592433e-02   +1.175682176315065e-01; +5.053060557811507e-02   +1.055371211012247e-01   +4.936795276545011e-02   -1.365545509580771e-03   +2.592149540744499e-02   +1.127182460447450e-01   +1.350134904525110e-01   +1.459266565278689e-01   +5.810483248480484e-02   +1.729730606282411e-02   +1.218901196209037e-01   +6.333599203436625e-02   +1.452490119034991e-01   +1.606284032701406e-01   +9.644556832902097e-02   +1.371693719815879e-02; +8.140524248935299e-03   +6.634611694973103e-02   +3.195707889591907e-02   +9.598555718405367e-02   +6.168641448797963e-02   +1.364402257513658e-01   +5.029976562836515e-02   +3.585342517533891e-02   +1.516116891390462e-01   +1.250808634929144e-01   +4.003255166076699e-02   +1.005074912613977e-01   +1.258041933986952e-01   +3.394097926271600e-02   +1.275682553868419e-01   +3.039635850763450e-02; +1.435278285384781e-01   +1.814112647134302e-02   +5.670533881979339e-02   +6.847577884185430e-02   +9.179220263588590e-02   +1.100102310695539e-01   +7.298845540688591e-02   +1.629478874674671e-01   +5.408033511670565e-02   +6.477155118175955e-02   +9.854466045634210e-02   +8.631641518050666e-02   +3.801707323065000e-02   +1.616512912884807e-01   +1.434460749972337e-01   +5.638117350506274e-02; +3.026064502156622e-02   +1.498049336796988e-01   +9.299225009791849e-02   +1.528812465522975e-01   +1.614058909811780e-01   +1.112193086385971e-01   +8.283197354546892e-02   +2.876850464357747e-02   +1.180520428112880e-01   +8.154406224181555e-02   +5.510816460975544e-02   +1.368479693053936e-01   +1.165026418953141e-01   +7.916957449606427e-02   +1.314922158766873e-01   +3.980895704512951e-02; +1.166723330361651e-01   +1.752777727366131e-02   +9.310578322834490e-02   +2.118816445537776e-02   +9.098646768967164e-02   +9.728937921422727e-02   +9.726323178491651e-02   +3.682216364275762e-02   +1.242981667226002e-01   +1.457256945533227e-01   +3.328457460298910e-02   +1.292781189024519e-01   +1.612181763378228e-01   +1.024428019491609e-01   +5.777544351175229e-02   +1.859627049089062e-02; +4.126121710021608e-02   +4.563374596739161e-02   +4.212715962422476e-02   +1.557182365286419e-02   +3.643114182106408e-02   +1.438381771413574e-01   +1.589855105318367e-01   +1.239931124147647e-01   +7.624072451086349e-02   +1.034414334597872e-01   +1.650471922306569e-01   +1.232402114385149e-01   +1.043278168060086e-01   +1.441691068661704e-01   +1.087286472750169e-01   +1.213851871868961e-01; +7.094958768152468e-02   +3.022019451600165e-02   +7.476091592636309e-02   +1.408267133544630e-01   +1.000228031067274e-01   +8.628506632661329e-02   +1.735862245029252e-02   +5.745925553822456e-02   +2.583639054496625e-02   +8.845278261453206e-02   +4.521487105569708e-02   +7.399753839571512e-02   +6.135807199932623e-02   +3.745074946888740e-02   +2.584107450569726e-02   +5.035615136864816e-02; +7.129034921062820e-02   +5.538958391467246e-03   +3.381036752071155e-02   +1.506636422208596e-01   +1.587520849190791e-01   +1.372333167828954e-02   +3.254328566483686e-02   +1.360353125109277e-01   +1.352150295127563e-01   +2.301403829900390e-02   +5.348940945796490e-03   +1.038822095455529e-01   +1.097149143645887e-01   +8.845136578911396e-02   +6.734220334628781e-02   +7.782779429810617e-02];
L2I_L1I_iGABA_netcon = [+1.650164591060886e-01   +8.247550231489760e-02   +4.672046120238761e-02   +1.424404831968916e-01   +1.574748931878651e-01   +1.522803528680779e-01   +6.262342882262226e-02   +1.280040181002509e-01; +1.336765861564593e-01   +1.377515175527546e-01   +1.180752925546568e-01   +4.922998143615733e-02   +7.103706585607052e-02   +1.115751303078469e-01   +1.516170503215278e-01   +3.925966407482322e-02; +3.607271835232875e-02   +3.743519395437202e-02   +4.201461357631213e-02   +2.749948339415004e-03   +1.325717761834544e-01   +1.589152353992469e-01   +1.784389808308720e-02   +1.012017764575782e-01; +6.754245017633616e-02   +1.306486511367994e-01   +1.146761898809718e-01   +1.063030155147503e-01   +1.015549060600227e-01   +1.022674998741962e-01   +8.454430654715638e-02   +1.318780323338429e-01; +5.320221004532530e-02   +2.497162982361791e-02   +1.037531268661853e-01   +9.794228923828993e-02   +8.026099225731373e-02   +1.260654491870815e-01   +8.085739753219676e-02   +9.517516071985838e-02; +1.276766248342114e-01   +1.196930890699147e-01   +1.554068762660336e-01   +7.483383112186300e-02   +4.867328476609743e-02   +1.141525729419854e-01   +8.930357474750103e-04   +1.177833757347925e-01; +2.267762351442830e-02   +6.296958973666963e-02   +6.229521254263025e-02   +4.418408284374992e-02   +1.228335860677610e-01   +4.212432473768827e-02   +3.424816766426796e-02   +1.126772722120466e-01; +9.795905006267602e-02   +5.836256151184682e-02   +1.338749561470341e-01   +7.053036285581991e-02   +4.852217303862414e-02   +1.206417876928079e-01   +7.923441070122093e-02   +5.388860113575269e-02; +6.826210377477532e-02   +1.132736251900988e-01   +3.151587775570306e-02   +3.821818619649481e-02   +5.133375463813930e-02   +2.793035766500387e-02   +7.034895840399506e-02   +1.596967339536798e-01; +9.017806732797196e-02   +1.110883752935859e-01   +4.060669643151571e-02   +8.701444903886282e-02   +8.151833827807355e-03   +1.168445322650986e-01   +1.485311826163781e-01   +1.119060203803322e-01; +8.852938381747047e-02   +1.307100256839333e-01   +1.429882663852679e-01   +5.807724632779271e-02   +1.196975288526877e-01   +1.579106102963809e-01   +3.542928837034712e-02   +4.469909754108306e-02; +1.334314294089231e-01   +8.405254232242372e-02   +9.819598257543957e-02   +7.221740213143575e-02   +1.597904202186883e-01   +4.243860250700848e-02   +1.058380210347103e-01   +6.251454128729977e-02; +5.169396662494986e-02   +1.605113417081276e-01   +1.520064465461177e-01   +3.275248950524709e-02   +9.451386573182056e-02   +5.548608272114570e-02   +5.177691069033195e-02   +9.192862426155896e-02; +1.236779474755548e-01   +4.296797029208926e-02   +1.663505467322351e-01   +8.443636891927042e-02   +1.381222524173067e-01   +2.965623382421184e-02   +1.601404984105269e-01   +4.369413257768243e-02; +1.668376834821179e-01   +3.469934701805943e-02   +4.818757115550210e-02   +1.537726974775528e-01   +1.112220271324557e-01   +1.616259878694100e-02   +6.703362036604868e-02   +1.139716236620720e-01; +3.198418504653928e-02   +1.191081622453343e-01   +1.137246506255198e-01   +1.059528964702418e-01   +1.401810325402060e-01   +2.048540733741937e-02   +1.670016019460114e-01   +5.101353914665350e-02];
L1I_L2I_iGABA_netcon = [+9.991221197737028e-02   +1.116461517485107e-01   +4.746366972468630e-02   +1.396134067791734e-02   +8.953015411831500e-02   +5.640025738221944e-02   +1.579632953030444e-01   +1.168440908029687e-01   +6.708031152506522e-02   +1.270782097600370e-01   +2.514143728992834e-02   +4.860346924592315e-02   +1.767848919353093e-02   +5.209877718132214e-03   +3.135150998121718e-02   +1.370269824161716e-01; +1.327089117630361e-01   +1.034496137846002e-01   +6.898808084534606e-02   +7.996483318692357e-02   +1.577366202860314e-01   +7.748769340227006e-02   +1.104846299329479e-01   +1.575883795923554e-01   +7.626613133963461e-02   +1.593386285805204e-01   +1.075509273277833e-01   +6.289277154524504e-02   +8.168187326856963e-02   +1.291269169708028e-02   +8.891961933792357e-04   +1.473124848747012e-01; +1.453887835902506e-01   +9.687299646794542e-02   +2.966276790334362e-02   +1.356865214542451e-01   +5.477993473158886e-02   +1.464719765352527e-01   +1.233780193524211e-01   +1.111031430700675e-01   +6.259675871244400e-02   +6.469530702016253e-02   +1.127569582758985e-01   +6.833054538779400e-02   +5.677176841450612e-02   +2.664153772832720e-02   +9.983644055899554e-02   +2.438059537113801e-02; +6.596838937422143e-02   +4.205579861679180e-03   +1.008878512735353e-01   +1.403640528164196e-01   +1.636623316515393e-02   +4.099859822796341e-03   +6.206219284534458e-02   +5.462889464276641e-02   +1.357362959585386e-02   +1.096114230863247e-01   +9.408590766197099e-02   +7.842089517354044e-02   +3.827034131311115e-02   +1.190826413497742e-02   +1.321495340030565e-01   +8.815195276822223e-02; +1.487049641005921e-02   +1.394049819595166e-01   +1.337875968575667e-01   +1.118154784378063e-01   +9.861745860635529e-02   +8.417412364395137e-02   +1.021793757151481e-01   +1.417112266151297e-01   +1.004276988875405e-01   +5.297880431871996e-03   +5.787297726970412e-02   +2.338915811789280e-03   +4.337358853574667e-02   +1.435503818990677e-01   +3.376169135049904e-02   +8.206796560178178e-02; +1.036789939670796e-01   +1.197978167874257e-01   +1.941430035323168e-02   +1.485781457951518e-01   +9.926672951736330e-02   +1.587481571867514e-01   +1.202501102930163e-01   +1.394773075266796e-01   +9.291677735049993e-02   +9.318003092175085e-02   +1.677552828948168e-01   +1.351339578542081e-01   +2.445533993241011e-02   +1.487400202910609e-01   +1.197136598098359e-01   +1.510068145816394e-01; +1.269834977048357e-01   +1.840596577897852e-02   +1.437908489922809e-01   +1.657451277066694e-01   +6.793762139154476e-02   +1.606581645534220e-01   +8.467231562571766e-02   +8.272517058092367e-02   +1.009900231733555e-03   +9.602445977253113e-02   +5.229273594396755e-02   +5.993150734229227e-02   +1.277621048596679e-01   +6.777422422244068e-02   +1.362325512854709e-01   +9.395839566127846e-02; +1.209780220630863e-01   +1.161290843597538e-02   +1.512634412982120e-01   +1.202603987192888e-01   +1.751719885135776e-02   +1.323383931208475e-01   +9.843922687281829e-02   +1.311221814583846e-01   +5.544076551207520e-02   +1.472109926603567e-01   +4.643659842659456e-02   +8.228560563229136e-02   +8.425368776298266e-02   +6.026813610574567e-03   +1.485705175842696e-01   -3.435455827056894e-03];
L2E_L1E_iAMPA_netcon = [+1.345309699710252e-01   +4.913718990476384e-02   +2.268737466967173e-02   +1.658782389204776e-01   -1.251446560517265e-03   +7.858857456797155e-02   +1.120209319721937e-01   +1.673726080019402e-02; +1.616264049084765e-01   +1.408495165603275e-01   +9.274445929213483e-02   +6.443320671777471e-02   +8.471659010259865e-02   +3.409741975586890e-02   +1.516313548625332e-01   +6.955703992916724e-02; +1.702199249514796e-02   +2.280370974069794e-02   +5.103354891489579e-02   +2.263543013909434e-02   +1.035293836717517e-01   +1.360630135305796e-01   +5.407664726848593e-02   +5.205049676684197e-02; +4.476132001313730e-02   +1.218607274616819e-01   +3.054893233063443e-02   +1.136043844326615e-01   +1.279210935391916e-01   +4.876951524231072e-02   +1.516201214047497e-01   +1.387060835592568e-01; +2.762223589266105e-02   +1.687685665935144e-01   +2.477239912817670e-02   +4.380337794940362e-03   +1.520595760760750e-01   +1.605747154524811e-01   +1.125889083167021e-01   +7.210699272373791e-02; +1.155712028025174e-01   +8.254443246757795e-02   +1.554181078532992e-01   +1.297193191418845e-01   +1.126525662439348e-01   +4.155684241737208e-02   +1.292690448850253e-01   +1.157471960796188e-01; +1.389880713494298e-02   +5.244391184892613e-02   +4.112979292568227e-02   +7.357390857739041e-02   +1.508527220285124e-01   +7.768398622322949e-02   +2.826310224685257e-02   +5.800886560836546e-02; +8.395023850033160e-03   +2.014210893540593e-02   +8.733361846787077e-02   +1.112069611142864e-01   +6.089605404418355e-02   +1.511768535844018e-01   +1.590951540238321e-01   +1.555597088288010e-01; +6.113357914473358e-02   +1.461121841527587e-01   +8.899664887700595e-03   +4.487607758347931e-02   +2.540515298368439e-02   +1.646295255113758e-01   +9.725622229623665e-02   +1.459907965393533e-02; +4.461238364763409e-02   +4.738887497813851e-02   +1.425954605114844e-01   +6.562444379148526e-02   +1.342108430621350e-01   +1.422424820989774e-02   +2.151816136442357e-02   +1.548260833921788e-01; +9.748953888658790e-02   +7.843656808793154e-02   +2.959431504722795e-02   +1.000835107392062e-01   +6.998355686266582e-02   +6.937276188941138e-02   +1.012353747408721e-01   +1.469887098539113e-01; +4.308240492491566e-02   +7.443406515944435e-02   +1.332923445439328e-01   +1.247082872173123e-01   +1.129174124620216e-01   +3.190184081124860e-02   +1.670090411053947e-01   +4.283866231381119e-02; +9.634780177945738e-02   +1.425872066472863e-01   +3.895497265830414e-02   +9.831144458123959e-03   +1.617729655225635e-01   +1.157693847144571e-01   +6.902892666932874e-02   +1.362313868997558e-01; +6.704993555759593e-02   +8.258276911697948e-03   +1.910319282866087e-02   +1.149779430260367e-01   +1.025667263528003e-02   +5.022092271262865e-02   +1.033080220917137e-02   +1.275512050640499e-01; +4.877313536521618e-02   +3.346536306300957e-02   +1.143494851485173e-02   +1.304237515203477e-01   +1.492682059739401e-02   +1.398518697624479e-02   +6.731714142820566e-02   +3.500431650802472e-02; +2.365984136262087e-02   +7.708331669923324e-02   +1.832194390868478e-02   +9.020765530650361e-02   +4.092413399013804e-02   +9.146206988397662e-02   +2.200448504293053e-02   +1.375929908811610e-01];
L1E_L2E_iAMPA_netcon = [+6.030065271282002e-02   +2.619010817022779e-02   +1.585193822779270e-01   +1.578193312526063e-01   +5.117381842379141e-02   +1.636505707189686e-01   +8.270957999932153e-02   +1.621893958752388e-01   +2.565629725786435e-02   +1.082506919817192e-01   +1.045057879078264e-01   +1.249538636122532e-01   +6.226558509252174e-02   +1.119335247622565e-01   +9.234316550966529e-02   +7.949712476637559e-02; +6.387781090946217e-02   +8.541005797093301e-02   +3.504809267667672e-02   +1.524677550393412e-02   +1.393645841968352e-02   +1.062155259681930e-01   +1.044794450663438e-02   +5.536590710779802e-02   +3.991800592864386e-02   +5.759025934723198e-02   +4.307466824638879e-02   +1.594475028454479e-01   +2.474803844839694e-02   +4.132656799552683e-02   +9.980725895903803e-02   +4.279962546439442e-02; +5.954716955839273e-02   +9.872530956236415e-02   +1.514065221639826e-01   +1.528562667365996e-01   +1.556206256638314e-01   +2.134721562838183e-02   +5.122429871996876e-02   +1.323495155237822e-02   +7.160705308527390e-02   +1.004802977317711e-01   +5.244835479375776e-02   +1.753723787123657e-02   +1.202314731102161e-01   +1.034928550245584e-01   +1.417993667198478e-01   +1.342256456824531e-02; +1.256854542203756e-01   +4.917928825492811e-03   +3.557157526249410e-02   +3.243831733375810e-02   +1.192101653067501e-01   +5.081119439341437e-02   +1.543888645965006e-01   +1.453358788410738e-01   +1.260369779926765e-01   +1.290847143473048e-01   +7.532488643317531e-02   +9.025151827185711e-02   +1.579636416404896e-01   +5.647180508672622e-02   +1.520657471963476e-01   +1.613547725515288e-01; +2.623654332917334e-02   +1.478574970803281e-01   +1.420014573251968e-01   +7.847788357348888e-03   +3.122158685675310e-02   +1.333129898826310e-01   +1.491058498913151e-01   +2.691552290839924e-02   +9.693749256247404e-02   +7.016300015040097e-02   +9.215147432152704e-02   +1.284554632635087e-01   +4.093054460790334e-02   +9.524172822536907e-02   +1.664429286822548e-01   +9.364826283061227e-03; +9.020594846939707e-03   +1.450873202716054e-01   +4.781144386428072e-02   +1.378959606181469e-01   +1.687707835865015e-01   +1.461154447134486e-01   +8.957500045342506e-02   +1.525398658514745e-01   +5.617349277586160e-02   +6.946933523328780e-02   +1.435536380358492e-01   +1.497520320438956e-01   +1.394466031628311e-01   +1.017006510762905e-01   +3.292613594902578e-02   +9.306750516846862e-02; +5.453494862324841e-02   +3.615558488516733e-02   +9.618704555407338e-02   +1.456012566257301e-03   +6.621668434496523e-02   +8.593913232486669e-02   +1.258289846057186e-01   +1.002113020388065e-01   +9.665491534652534e-02   +1.351869325359754e-01   +1.091483077387729e-01   +2.217035787547127e-02   +6.413761304506672e-02   +9.503933103649830e-02   +3.972803809327104e-02   +5.498838290246311e-02; +1.111954643168380e-02   +8.640035612551483e-02   +7.824149211289412e-02   +6.889109887783419e-02   +1.244127089372390e-01   +1.642460952838718e-01   +1.597031435660549e-01   +1.068665515655875e-01   +1.461347655590839e-01   +6.982351092311222e-02   +5.827386145539386e-02   +1.639359733689522e-01   +1.136737241482839e-01   +1.510273804055005e-01   +5.323515644176195e-02   +1.823794674746964e-02];
L2I_L2E_iAMPA_netcon = [+1.069232745431073e-01   +4.280186127943206e-02   +1.490131263737944e-01   +7.782961543292941e-02   +1.310864017805136e-01   +6.412776805562953e-03   +1.461129847883569e-03   +1.525532154885830e-01; +2.913800257443162e-02   +1.928444372528733e-02   +2.965234478094794e-02   +1.394209698833995e-01   +1.309046807016420e-01   +6.232481103990889e-02   +1.180530908659920e-01   +8.372391691068294e-02; +1.386678129088743e-01   +1.249291128029752e-01   +1.355158499508188e-01   +1.242638085069322e-01   +8.653325713883012e-02   +8.627007676303025e-02   +8.334648091877025e-02   +1.235494386136729e-01; +6.296297634826063e-02   +2.470139191199350e-02   +1.528799454865220e-01   +7.590647010248583e-02   +1.599758038367463e-01   +2.598473713739376e-02   +7.535527563057336e-02   +1.389925819163829e-01; +1.109292998960122e-01   +1.423172553047013e-01   +1.018941278408785e-01   +1.021241180613178e-01   +1.526405878707702e-01   +1.216536304814463e-01   +7.212922175114189e-02   +1.205164551694038e-01; +1.007880551405602e-01   +4.728700950287667e-03   +1.437150840883339e-01   +1.239580177035023e-01   +9.030642599416007e-02   +3.678988420333648e-02   +1.815285734561079e-02   +1.176201535885055e-01; +1.634585270639272e-01   +8.038918183915150e-02   +3.059938563849014e-02   +5.759747382412604e-03   +2.348118974306420e-02   +3.458124785487823e-02   +2.906370853222952e-02   +3.817509924887413e-02; +1.548404514521611e-01   +4.857669150687609e-02   +9.538522126094597e-02   +7.756341527356507e-02   +1.419827068699265e-01   +4.512284536865973e-02   +2.051260673140586e-02   +6.373170609601519e-03];
L2E_L2I_iGABA_netcon = [+1.540502936597614e-01   +3.475990625898838e-02   +3.497056442275376e-02   +2.806466445574176e-02   +1.123954724468896e-01   +6.417937226701353e-02   +1.420876295507995e-01   +1.602576331611142e-01; +3.904112663997050e-02   +6.904655800695507e-02   +2.472949703369491e-02   +6.159391770379224e-03   +1.694377861257593e-01   +1.170291647345876e-01   +1.264509816015807e-01   +1.489016590187383e-02; +1.079807849180672e-01   +6.356523199913101e-02   +9.087547220470334e-02   +1.379183168384211e-02   +6.690775101301225e-02   +1.640818369914012e-02   +1.552044516633539e-01   +1.418192749374810e-01; +1.381090991257064e-01   +1.085805549341865e-02   +4.597955556858070e-02   +1.218736716351527e-01   +1.517906276895521e-01   +1.088129786991712e-01   +7.095905668115127e-02   +1.091991833688245e-01; +2.534923494901295e-02   +1.510012164091867e-01   +7.126579000654869e-03   +1.350409016966271e-01   +5.208809328282427e-02   +5.818723862693401e-02   +8.490313997906168e-03   +4.483742616955040e-02; +1.230849351358376e-01   +5.430965121965275e-03   +8.903346211248891e-02   +1.324797055423312e-01   +1.471161620481188e-01   +4.353828178171652e-02   +1.564090096779945e-01   +1.216026711415607e-01; +2.401359851404631e-02   +1.635631630884192e-01   +4.712921345260279e-02   +6.096643231241821e-03   +1.233902601039314e-01   +8.640977300925465e-02   +9.811385536703193e-02   +9.938354167099087e-02; +1.429527619501955e-01   +5.687908131716840e-02   +8.421312712729141e-02   +3.782262179334872e-02   +7.990457913574994e-02   +1.304956807171951e-01   +1.594955409602299e-01   +1.062278867554172e-01];
L3E_L2E_iAMPA_netcon = [+5.337044672585377e-02   +1.100675334057297e-01   +2.381960437163574e-02   +1.289232905629985e-02   -1.129414209198670e-03   +1.663046778575538e-01   +6.801398117687996e-02   +1.437393257180445e-01   +1.639760378105280e-02   +4.531571278897015e-02   +4.510754205404541e-02   +1.031069589991974e-02; +4.677948972764805e-02   +1.521416770367144e-01   +5.110461557189220e-02   +5.596713865770100e-02   +7.978578339628531e-02   +8.981431526909087e-02   +1.479090166773380e-01   +1.633743603743398e-01   +9.898961251081773e-02   +1.606171887160117e-01   +5.512151805512147e-02   +4.218120577988847e-02; +1.030828543943339e-02   +1.314691057543738e-01   +1.959905818399575e-02   +1.266192273478033e-01   +2.283612765278575e-03   +1.679248771000856e-03   +8.659283092865706e-02   +1.628830859546469e-01   +9.980010735992348e-02   +1.002431290731111e-01   +4.153292081903674e-02   +1.091064635567120e-01; +1.094062309762486e-02   +3.320095215194486e-02   +1.350779201594369e-01   +4.153553787685644e-02   +5.048219379176413e-02   -6.010659084571213e-03   +5.648520002891217e-02   +1.198836444132992e-02   +3.158554021070487e-02   +5.736854817211532e-02   +3.316138270108072e-02   +5.432602490088952e-02; +1.487444086585011e-01   +6.257904206355780e-02   +5.697757719130667e-02   +1.614232044179389e-01   +1.155807039700971e-01   +5.989187486131584e-02   +1.634247935112719e-01   +2.765655977008966e-02   +1.379948327017914e-01   +8.014942857866870e-02   +1.127407118849376e-01   +6.058377290228254e-02; +1.470477772580373e-01   +1.001607754437302e-01   +1.907211806064041e-02   +7.630770018283511e-02   +1.038346099020836e-01   +1.608087436620315e-01   +1.518698555944863e-01   +5.908800901966226e-02   +8.051581332023319e-02   -6.321075828738076e-04   +1.107444868163484e-01   +4.108604415186928e-02; +1.036058223599873e-01   +8.484470094789330e-02   +1.087772121606392e-01   +4.087405940950883e-02   +1.048749504399246e-02   +6.533529265578567e-02   +1.272347316146245e-03   +5.996635357254274e-02   +5.291230500923098e-02   +1.851790173098685e-02   -2.896558896910062e-03   +7.762891261884301e-02; +1.359961796401017e-01   +2.124060546987297e-02   -2.883790479214205e-03   +4.665753491752642e-02   +8.925025926545360e-02   +1.709228636780441e-02   +3.858458324232946e-03   +7.427629808273621e-02   +7.925390055489129e-02   +1.386539800042940e-01   +1.406968770268853e-02   +1.013917185947348e-01];
L3I_L2I_iGABA_netcon = [+1.577271206226538e-01   +8.608473191276228e-02   +1.074678388820840e-01   +4.897565667658732e-02   +1.599357450618108e-01   +6.970321934502931e-02   +9.207693456621670e-03   +1.991966611187219e-03   +1.427032024309942e-01   +7.578181405254369e-02   +1.559002358234894e-02   +1.232195163582953e-01; +1.481433092381707e-01   +1.600999903168170e-01   +1.438233780770677e-01   +2.991237370362902e-02   +8.181809813207207e-02   +1.365289047693735e-01   +7.265849674358739e-03   +3.546699284264689e-02   +8.132025913773874e-02   +1.148060183505181e-01   +2.250454104632302e-02   +1.077698606245056e-01; +1.903487624631622e-02   +1.434596260656527e-01   +1.527341791960682e-01   +3.347537091261868e-03   +1.114370807795176e-01   +3.123110439037485e-03   +1.036442929977099e-01   +1.572754680718376e-01   +1.181872306249470e-01   -6.993258458454517e-04   +1.056751440318346e-01   +2.204673433814680e-02; +1.649902957812976e-01   +2.929415587597244e-03   +6.255749837823695e-03   +1.086686483051536e-01   +1.448738933748981e-01   +9.107507638942092e-02   +2.213037938224526e-03   +6.819220655811158e-03   +1.485376174179790e-01   +1.356935035918237e-01   +1.688942796912829e-01   +8.814141476975228e-02; +2.938818140174821e-02   +1.620583726457913e-01   +6.921509831379612e-02   +7.219438746056477e-02   +9.935358727536096e-02   +1.563121534381609e-01   +6.772366287910707e-02   +2.379673487601749e-02   +1.676945992901507e-01   +8.449158613013509e-02   +3.821577439695698e-02   +3.241794470584834e-02; +8.609698551001762e-03   +1.129005272784472e-01   +3.235339478758049e-02   -1.075528944654032e-03   +2.318797099898131e-02   +1.093807428340151e-01   +1.173910480492492e-01   +4.162134528297767e-02   +8.375502139137255e-03   +1.269769961974831e-01   +1.427009218817142e-01   +9.581889999090825e-03; +1.012189110575758e-01   +1.489796767691249e-01   +9.632167035095152e-02   +1.161435069307740e-01   +7.169475045271460e-02   +4.535690431017629e-02   +1.147135465606948e-01   +4.081585228864345e-03   +1.439341761929931e-01   +6.316186587558205e-02   +8.150866762204337e-02   +1.213953667024070e-01; +8.411638533125712e-02   +2.731187372773782e-02   +5.762632426472267e-02   +1.002209701871053e-01   +6.048181886825982e-02   +1.740602189473506e-02   +4.267534072565608e-02   +4.489250468673064e-02   +9.359110125888216e-02   +1.599631386824333e-01   +4.722796614254699e-02   +4.858542121591901e-02];
L2E_L3E_iAMPA_netcon = [+1.112926653590041e-01   +1.101282396359355e-01   +4.170368256567192e-02   +1.383540397549253e-01   +9.857434565449170e-03   +8.411345113557644e-02   +1.181297678771811e-01   +1.585859098808832e-01; +9.201114487473859e-02   +1.228276486251390e-01   +1.261271874649481e-01   +1.297746512916813e-01   +1.046237194045724e-02   +9.283110689931118e-02   +1.412684101526199e-01   +1.130569163859966e-01; +1.356886623266245e-01   +1.465479701051277e-01   +1.404773026315042e-01   +1.549395584808334e-01   +9.674607644545216e-02   +1.062401319560389e-01   +1.429617284382506e-01   +9.755082966232391e-02; +6.456916350530932e-02   +1.625107264656548e-01   +1.414501568798184e-01   +1.007409809124599e-01   +8.097194086993979e-02   +8.918815383629163e-02   +4.575054412456244e-02   +2.714595644433879e-02; +2.129426494051531e-02   +9.153983272045085e-02   +4.474686453922339e-02   +1.404571623056911e-02   +2.931116963460769e-02   +8.937461951940254e-02   +1.440204050905810e-01   +1.281475009940434e-01; +7.990502662777538e-02   +1.696215179164423e-01   +1.519709403066729e-01   +9.311511466049950e-02   +8.737420163003390e-02   +1.641145608733755e-01   +1.230943344110318e-01   +1.605961210380273e-01; +8.039167008181329e-02   +1.399596270580505e-02   +8.747498017363790e-02   +3.469141283000338e-03   +5.633893254442036e-02   +1.350362096292309e-01   +5.829082985434352e-02   +1.268302068143854e-01; +1.546841167114596e-01   +1.117534088176098e-01   +7.961257872934106e-02   +1.327747630446684e-01   +5.926552300424585e-02   +1.275411021320348e-01   +8.208027390142267e-02   +6.672194608528907e-02; +8.134127659320323e-02   +9.186623349999477e-02   +1.501648362244457e-01   +1.025591761485393e-01   +9.715649888597827e-02   +6.075823797718100e-02   +9.470023626296802e-02   +1.143914825847724e-01; +3.877540328515579e-02   +2.261906222713053e-02   +1.293675670868498e-01   +1.455633254341353e-01   +1.513272700525591e-01   +4.915696231635416e-03   +2.373155952500890e-02   +1.048099475906133e-01; +9.952579599928894e-02   +5.387834611158644e-02   +1.212462588499176e-01   +1.369461362853633e-01   +1.525016933696761e-01   +1.652399519350425e-01   +4.136787872241528e-02   +5.857570983176603e-02; +1.797167095975059e-02   +9.891667633932383e-02   +7.374858798108185e-02   +1.473441324786330e-01   +8.113019869116359e-02   +3.958372466612400e-02   +1.022373939987644e-01   +1.453234036872544e-01];
L2I_L3I_iGABA_netcon = [+1.588234361802254e-01   +7.177661330018717e-02   +4.523833799399191e-02   +1.135270555192743e-01   +1.225327812461242e-01   +1.413224960514214e-01   +5.278324491514942e-03   +8.540645089350309e-02; +9.456130585321852e-02   +7.626222811304866e-02   +1.133994113916301e-01   +2.743308272642353e-02   +1.497939711440816e-01   +1.365256448611988e-01   +7.775028448535175e-02   +4.843706269402284e-02; +1.300099235443531e-01   +1.240805924628744e-01   +1.608696471783609e-01   +1.006420129340060e-01   +5.770324316101000e-02   +1.025370235802591e-01   +6.922186881536525e-02   +2.392583596126952e-02; +3.500777557064622e-02   +1.349343566570550e-01   +3.143962467843887e-02   +8.320693739391344e-02   +1.005132372269533e-02   +5.635556956276484e-02   +6.690965194846019e-02   +1.648082573520102e-01; +5.206295711108505e-02   +6.748879570589443e-02   +8.206488358276970e-02   +7.832565617003497e-02   +6.552069214753252e-02   +1.052160711619532e-01   +1.407474587559212e-02   +2.489094441382004e-02; +2.266363092181555e-03   +4.507375873377223e-02   +6.583267821203741e-02   +2.807624122567365e-02   +5.909250229103375e-02   +6.602679015459785e-02   +8.679900173749265e-02   +1.176603430712331e-01; +6.124895450333578e-02   +7.711652654306203e-02   +1.596268111080683e-01   +1.047515965196481e-01   +1.250255814742186e-01   +5.201564245942565e-02   +5.056070445400523e-02   +5.474672418300776e-02; +6.731499878779841e-03   +1.673216767498074e-01   +5.101245979229196e-02   +1.456295162027668e-01   +6.045623404384692e-04   +1.249214989476070e-01   +9.286000702473021e-02   +1.298812642806103e-01; +1.458801130134509e-01   +4.862443821772498e-02   +1.416541743680177e-01   +7.651227744403484e-03   +8.551385583658878e-02   +4.653397035931699e-02   +7.114631845324579e-02   +7.131703265787664e-02; +1.218691776240110e-01   +8.682601544998254e-02   +4.193906196226470e-02   +8.702032744524006e-02   +1.021605178114937e-01   +5.547782273871343e-02   +3.357430982568043e-02   +5.512148129971509e-02; +1.230844463995579e-01   +1.624905351053682e-01   +9.155335496142833e-02   +1.121105588132263e-01   +4.992197280651325e-02   +6.350389673014557e-02   +1.538697818607248e-01   +2.104634214882574e-02; +1.271666835136813e-01   -2.702826605254803e-04   +6.092189840516331e-02   +2.584496997696488e-02   +2.425419408185004e-02   +1.619825895113267e-01   +8.396558343599130e-02   +9.000992264414663e-02];
L3I_L3E_iAMPA_netcon = [+7.378983424626070e-02   +1.669764078396581e-01   +4.012765619203549e-02   +1.032791582538657e-01   +1.295512229105323e-01   +5.674620497528759e-02   +4.895331498405629e-02   +4.169029165560715e-02   +5.963778765777857e-02   +4.538845815612497e-02   +4.438100079270276e-02   +1.059118294508147e-02; +6.302523334202069e-02   +1.460324954666314e-01   +3.394830660792200e-02   +2.530852961461310e-02   +1.231948257971177e-02   +9.272686814307199e-02   +9.464419384329219e-02   +8.877793462617647e-02   +3.450621982976380e-02   +7.941304507362359e-02   +1.220998910765263e-01   +8.979251533931902e-02; +5.176300493356277e-03   +1.001929478789343e-01   +8.046919201316222e-02   +9.740238879012435e-02   +8.283931126244794e-02   +7.113716977361791e-02   +8.453496829406602e-02   +7.590917972942254e-02   +6.495465005372732e-02   +9.402521225250073e-02   +7.634122157821355e-02   +9.164930318418606e-02; +6.314760061707858e-02   +1.201391336422759e-01   +1.069103746070423e-01   +7.515358021597510e-02   +7.557200477209432e-02   +1.481163369318589e-01   +1.302711903707869e-01   +2.373384968090566e-02   +1.553386057091875e-01   +1.443568147684608e-01   +3.102100234582876e-02   +1.236203420600951e-01; +1.875205113422080e-02   +5.880708879959095e-02   +4.141808339602873e-03   +1.363290074875243e-01   +1.270976478008765e-01   +9.105322146078684e-02   +1.588412578681766e-01   +8.310467162446888e-03   +1.543662364765715e-01   +9.727206953362395e-02   +5.896563523781846e-02   +1.895570964187415e-02; +5.924658388754041e-02   +1.054729105371737e-01   +1.377644053257612e-01   +7.161627169982278e-02   +1.653854805045608e-01   -1.157851767703853e-03   +1.457165313761031e-01   +5.054836376462062e-02   +1.099774330475726e-01   +3.886048277232451e-03   +5.506226257149089e-02   +3.054544423625787e-02; +1.324303713187998e-01   +6.641571750902071e-02   +6.185994537546945e-02   +4.511991875982913e-02   +1.097356479853807e-01   +2.926288995319091e-02   +9.005238079582971e-02   +1.535591545212523e-01   +1.367612228827510e-01   +1.630741938492131e-01   +9.470486059811295e-02   +1.166771233989535e-01; +1.244229891295882e-01   +3.489480929917039e-02   +1.187171731421571e-01   +1.035250406506043e-01   +1.651724551549841e-01   +9.827769865255966e-02   +1.588660716742787e-02   +8.456039785633269e-02   +7.377911178079541e-02   +5.120911015811925e-02   +3.675964284897075e-02   +1.524200223743746e-01; +1.515364483230750e-02   +1.410952221648848e-01   +1.197025755104048e-01   +1.341757471596457e-01   +5.972104588717768e-02   +1.256603932055936e-01   +2.814999108004011e-02   +1.290309476278698e-01   +1.373517348759205e-01   +7.585358011021745e-02   +3.311968828345051e-02   +3.188924623306821e-02; +1.542347510078216e-01   +1.365212637582678e-01   +7.061705481517234e-02   +3.343800254863864e-02   +9.531472553396819e-02   +1.314017796271008e-01   +8.608668262933344e-02   +1.443598779905162e-01   +1.159261114320317e-01   +5.693849538304231e-02   +1.447756564424373e-01   +3.533490745807805e-02; +6.944304526933780e-02   +6.114287266450843e-02   +1.677565548542505e-01   +1.538309068185075e-01   +4.086438901669407e-03   +1.032065479539906e-01   +1.051066363429223e-02   +4.206284638133499e-02   +8.556151983245271e-03   +1.630573795222664e-01   +1.244382376389626e-01   +6.504580311638949e-02; +1.507687767072878e-02   +2.730819626155450e-02   +7.605636587979860e-03   +7.169337362628041e-02   +7.427547931795067e-02   +3.947170216151398e-02   +1.359210620524637e-01   +3.001673537255813e-02   +5.332317987767347e-02   +4.132107314915690e-02   +1.280367262193260e-01   +4.905951795544612e-02];
L3E_L3I_iGABA_netcon = [+3.184584632496216e-02   +7.420881010604194e-02   +5.683760179330320e-02   +1.519532697061211e-01   +1.369395981091419e-01   +8.800538153850984e-02   +5.887360807217826e-02   +1.289118276963015e-01   +1.021066134910498e-01   +1.223993384667319e-01   +1.032541506921371e-01   +4.515308429937408e-02; +1.299264721056221e-01   +1.064066375836238e-01   +5.549911878460324e-02   +1.801420821759324e-03   +5.860645645299035e-02   +1.215330814303180e-01   +1.113879250607256e-01   +1.632351340101548e-01   +1.402118467390160e-01   +7.388851368564459e-02   +2.412608195346833e-02   +6.250826550095413e-04; +9.988082569441599e-02   +1.629167677628526e-01   +1.614375600354552e-01   +1.359690248062790e-01   +4.983168291142391e-03   +1.283209339617503e-01   +1.011928949950983e-01   +1.135682100938157e-01   +6.818305634806146e-02   +6.942352364816214e-02   +4.453752862919239e-02   +2.333239856360288e-02; +7.438337208320378e-02   +2.969520459869972e-03   +2.872764839839490e-02   +1.148813230330076e-01   +1.145716029727965e-01   +4.567597691098380e-02   +6.944377704696002e-02   +6.139096555984865e-02   +1.648418405913287e-01   +7.866155810022288e-02   +7.349637982871403e-03   +1.027859028463833e-01; +7.182132097483840e-02   +6.918817882664584e-02   +1.696061163067170e-01   +4.022078306255174e-02   +8.298445539672819e-02   +1.266836107897179e-01   +1.618002495826123e-01   +1.589159495980862e-01   +4.393687207731577e-02   +9.860798922976470e-02   +1.385461086893034e-01   +7.248562175719406e-03; +1.119203370605015e-01   +8.184668611792828e-02   +1.420227689013091e-01   +9.601949539719434e-03   +7.244082853243614e-03   +1.659026914585377e-01   +9.377097954836102e-03   +7.480951094557240e-03   +1.356915978821526e-01   +9.782356123842809e-02   +4.374423214021919e-02   +3.503640360250378e-02; +9.529886440825121e-02   +6.258373571696527e-02   +8.524701701133053e-02   +9.356190183420150e-02   +1.124126283012353e-01   +8.210597038164168e-02   +5.343658912313803e-02   +4.586421318295765e-03   +6.184471925916708e-02   +2.948233524610418e-02   +5.556149207880891e-02   +1.198924983873572e-01; +4.891277365194154e-02   +2.115331079568148e-02   +2.034666113070387e-02   +1.511437734514121e-01   +7.602514111125748e-02   +1.297053430725698e-01   +8.741414776565569e-02   +1.274290542874792e-01   +1.301623566417755e-01   +1.386288807503632e-01   +2.727691036962787e-02   +1.020027395055924e-01; +4.491331953885488e-02   +2.806466556540524e-02   +1.276642748719956e-01   +4.419402300808912e-03   +1.581689348296084e-01   +1.485499416570780e-01   +2.970334942497897e-02   +1.244738542853484e-01   +3.827489811875023e-02   +6.154180560069584e-02   +7.438144602053269e-02   +9.731922400231018e-02; +1.347674603705992e-01   +5.503193407651297e-02   +1.390186817128966e-01   +5.605299541147943e-02   +6.514743136257198e-02   +1.647810429837897e-01   +1.257925431277458e-01   +9.573730586194064e-02   +1.593360449132023e-01   +1.626694374024132e-01   +2.825772613329507e-02   +5.083648891943742e-03; +8.704608842814496e-02   +2.254548086983860e-02   +3.182538547714416e-02   +3.528230495927114e-02   +1.278287370696748e-01   +8.652453865967510e-02   +1.464154572723299e-01   +1.025729364901920e-01   +9.498590984301680e-02   +3.174376514941032e-02   +1.496692789208995e-02   +1.300603257073055e-01; +1.071646572246412e-01   +8.502794627653096e-02   +1.649490176346581e-01   +1.168140982521193e-01   +2.828333357603208e-03   +8.172472354656339e-02   +1.624889567858642e-01   +1.304551454123627e-02   +1.256463628477813e-01   +6.384896257700245e-02   +8.038020019230420e-02   +6.559270762009176e-02];
L2E_Input1_iAMPA_netcon = [+1.673305659840899e-01   +1.681554468530089e-01   +1.685758901396540e-01   +1.695068518792729e-01   +1.668665010880025e-01   +1.749037888817722e-01   +1.704526260729901e-01   +1.678639978818539e-01];
L2I_Input2_iAMPA_netcon = [+1.679456480850553e-01   +1.716296291428500e-01   +1.669990872843334e-01   +1.664316681742170e-01   +1.661486203928654e-01   +1.669581481390336e-01   +1.681730741604189e-01   +1.669432462821240e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
