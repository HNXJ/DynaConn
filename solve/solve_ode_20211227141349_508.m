function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+4.475056652255612e-02   +1.110199286795979e-02   +1.578020654340418e-01   +1.214461938639673e-02   -6.824198038728496e-02   -2.032017275699348e-01   +3.192235819853011e-02   -1.311333170212421e-01   +9.644259054847885e-02   -7.122143254053895e-02   +1.491304884120050e-01   +2.004701573853409e-01   +4.494001762114503e-02   -4.546299948111190e-02   -3.603377756646964e-02   +2.374869404392417e-02; -1.020705216768275e-01   +6.756208758231064e-02   -4.020866808944748e-02   +1.239984986679241e-01   -9.293822836202813e-02   +6.160723181100215e-02   -1.217182853378814e-03   -2.179603486830371e-02   -1.531381219157853e-01   -5.740201465151855e-02   -2.483552769093510e-02   +7.218227938608908e-02   +8.347239095397638e-02   +2.729622514832554e-02   -6.024825432311813e-02   +1.428514865827015e-01; +1.992161463029653e-02   -1.289214022870199e-01   +5.474400565113734e-02   +1.154738354576324e-01   -5.681813223920384e-02   -1.032308141594862e-01   -1.830890525320317e-01   -2.040459528664929e-01   -1.778417776690412e-01   +1.230396572703870e-02   +1.541989527976189e-01   -3.789142071717566e-02   +1.995532850515008e-01   -1.623036709619552e-01   +2.117479740147825e-01   +9.756069759626890e-02; +6.195201316559697e-02   -5.533191897698370e-02   -1.549665180008835e-02   -8.329402402033531e-03   -8.189593204349133e-03   +2.636013425120005e-03   +3.253650160665417e-02   +6.141761443682271e-02   -1.985354514821208e-01   -1.116147407666462e-01   +2.372370253295749e-02   +1.457680833850011e-01   +1.876939310944424e-01   +8.189712268393676e-02   +1.351865760439788e-01   +4.568042062876293e-02; +2.647108746735409e-02   -1.143977540846530e-02   -1.721445938331632e-01   +2.408580369032039e-02   -1.768407558245191e-01   +7.003640179922439e-03   +1.251535327496214e-01   +1.486842241719127e-01   +1.525646395501871e-01   -2.014180732208416e-01   +6.362444393833634e-02   +1.044138032366893e-01   -2.600390589706982e-02   +1.137748856726026e-01   -5.093650951196273e-02   -1.248683705598459e-02; -2.306766834258699e-01   +1.720019128138416e-01   +1.687305073102551e-01   -1.141329053958063e-01   +1.259492672384563e-01   +1.081809052999149e-01   +4.695762943283409e-03   -6.279644512638335e-02   +2.425547806592329e-03   -1.078842755960471e-01   -3.980781424013967e-02   -8.914780898190296e-02   +1.402042199444308e-01   -1.351121793887176e-01   -1.475090695698042e-01   +1.589080718934056e-01; +3.819065268314849e-02   +1.901695945673769e-01   -2.308987326057632e-01   -1.543531178874819e-01   -1.900713248406720e-01   -1.056824042193524e-01   +4.539056576155306e-02   -6.613162681763320e-02   +8.095644905691725e-02   +6.362398784447346e-03   +5.357370481311350e-02   +9.745236246539274e-02   +8.890582827877856e-02   -1.026995498307407e-01   +1.808440104874224e-01   +8.642144969308156e-02; -4.990398714689022e-03   +2.254063636449238e-01   +1.669240406662253e-01   -1.255161311875612e-01   -4.086878400848588e-02   -5.545307884642925e-02   +1.599919922177710e-01   +1.492342937818618e-01   -8.830175085557411e-02   +4.763845370916286e-02   +7.363732277124595e-02   -1.119186079824016e-01   +1.278200964564876e-01   +1.026100001414909e-01   +9.177278784285084e-02   +1.230054655793417e-01; -1.190560779966243e-01   -1.188711267884286e-01   +2.372150286504791e-01   +1.392383549895397e-01   -5.882197287675334e-02   -7.020764650902617e-02   +1.882400676407508e-01   -1.423799151253542e-01   -1.977836687952640e-01   +2.159843623507279e-02   -5.863376840200755e-03   -6.439664732851602e-02   +2.802682304693060e-01   +1.669886872766931e-01   +1.535946867451162e-02   +5.969989738898233e-02; +2.074403269687658e-02   -1.023163727607790e-01   -1.103620731333125e-01   +2.125054391457257e-01   +2.476894236463190e-01   -9.761502888584679e-02   -7.172136165257469e-02   -1.331851049684099e-01   +4.941547383915661e-02   -1.594185618682615e-02   -1.208942367172852e-01   +4.016607012795008e-02   +1.737417463982824e-01   +2.500719865964100e-01   -1.220181475523230e-01   -2.381077290555119e-01; +2.440466128358493e-01   -1.035988082522761e-02   -3.864251966944117e-02   +1.164083406080398e-01   -2.684095480147108e-03   +2.445592520960169e-01   -7.534183750064433e-02   -2.079429779740321e-01   +1.393212249226257e-01   -9.939608936870425e-02   +3.868463384295946e-02   -6.529084987946888e-02   -1.642393052854563e-01   -1.124550722142423e-01   -2.141286883564056e-01   +2.387597011082289e-02; -1.900250521586268e-02   -2.412605502295410e-01   +6.902903897184137e-03   -1.110173480315057e-01   -9.536172603200578e-02   -6.335703984417898e-02   +9.807542991729661e-02   +1.210981918189886e-01   -1.383575131036221e-01   +8.032800714581897e-02   +5.581677412307036e-02   +8.769502778234003e-02   -1.524073023188404e-01   -7.295876368823333e-02   +1.326388710997953e-01   +8.309815462602090e-02; +4.189025228029384e-02   -4.534506019859860e-02   +2.427665388209458e-02   +2.596098817779987e-02   -4.250861786173060e-02   -1.510683041969292e-01   +1.389703291197208e-01   -1.538707452396550e-01   +2.917656457904742e-02   -2.332461447049921e-01   +5.911399034833604e-02   -2.498342680404232e-02   +1.016750884542561e-01   +1.355814430976645e-01   -8.157692104088751e-02   -3.968969683396058e-02; -6.930397144844544e-02   -4.821506378235669e-02   -3.718880069279769e-03   +2.271754237998424e-02   +2.068102610864888e-01   -1.541972031999947e-01   +1.617346732528740e-01   +1.091842000100688e-01   +1.151575210348891e-01   -4.333364041673032e-02   -1.578141994428663e-02   -1.284914849772246e-01   -4.657196160327891e-02   -1.518479168406083e-01   +2.191437676522709e-01   -6.382874317139441e-02; +7.790104995217170e-02   -4.130961496040902e-02   +3.134702157760164e-02   +5.209332430777858e-02   +2.351337530002746e-01   -1.634207042957592e-01   +1.371301310111496e-01   +1.481295926184115e-01   +9.812610574588461e-03   +6.260004251664759e-02   +6.340776948227193e-02   +6.855305925743080e-02   +1.009279756906995e-01   -2.210705271108766e-01   -2.812729308595215e-01   -2.810798520521429e-01; -1.560486902370933e-01   +3.379102430061821e-02   -9.750483791284119e-04   -2.025943565575308e-01   -1.979099701616436e-01   -3.049062165290031e-02   -1.359218759526451e-01   -2.333180899155469e-01   -1.213217240567991e-01   -4.707212860661886e-02   -1.992879128685203e-01   +1.362972339006517e-01   -1.264667810587480e-01   -6.981066998416516e-02   -9.040342944727876e-02   +9.164496637381049e-02];
L1E_L1I_iGABA_netcon = [-7.930725764452214e-02   +4.527611926293165e-02   -5.338506851783133e-02   +2.605675124426464e-01   -5.243351972987101e-02   -1.073209209635310e-01   -1.833361550308777e-01   -1.503016002490986e-02   +7.618889256929624e-02   -9.397867073171910e-02   -9.924694201231271e-02   -1.467942219310585e-01   +4.693083026146444e-02   -1.274578604571229e-01   +9.496357309724038e-03   -1.480780855488012e-01; -3.446259762469089e-02   +2.848019151397549e-02   -7.173735492558549e-02   +4.718834291521111e-02   +2.857935766184769e-01   -1.636018486770552e-01   -6.685908020584971e-02   -4.482720923008126e-02   +8.544685209496529e-02   -7.919006054985575e-02   -1.127812315438575e-01   +5.267991406002553e-02   +8.501629856046887e-02   +5.271803563080105e-02   -7.087790109573025e-02   -7.298241192205672e-02; +6.316856421797988e-04   +2.864098372490500e-01   -5.650805349762445e-02   +8.453978434483793e-02   -1.036343376672893e-01   +1.706574178258369e-01   -7.966324873131339e-02   +1.524522151947238e-01   -1.762759952560737e-01   -1.042461777350250e-01   +1.264419918129547e-01   -3.275454010337948e-01   +6.512215512754341e-02   -2.091674174134430e-02   +8.888186619352317e-02   +2.655077322765572e-02; +2.576728900244748e-02   -1.580725667034607e-02   +1.281911335154096e-02   -3.351239391692357e-02   -1.995250737281686e-02   -7.919532116251388e-02   +5.143129280496190e-02   +1.214388292316563e-01   -1.042542318566287e-01   -1.081053201703777e-01   +2.319853892666952e-01   -2.056089401651548e-02   -2.483601259066343e-01   -6.643818880997988e-02   -7.898999802217140e-03   -1.261465804131514e-01; -2.833618564538088e-01   -5.560003316181442e-02   -2.259828367048404e-01   -8.712850480667812e-02   +5.943390400333669e-02   +5.838800469389778e-02   +1.795466746454614e-01   +2.798026611464042e-01   +1.640414864849794e-01   +6.917146591389857e-02   -1.523000976822029e-01   -7.732442498479307e-03   +1.152332640559978e-01   +1.262737874498557e-01   -3.852404591066276e-02   +6.194374106802127e-03; +1.663908484337004e-01   +1.398945623162269e-01   +1.316258848638156e-01   +6.403485898561881e-02   +2.165564194086795e-02   -1.562567205509027e-02   +3.355288972088918e-02   -4.035809138379160e-02   -5.288643729731710e-02   -2.244524559392129e-01   -2.759770260325083e-02   -8.379762605901063e-02   +3.974094074981017e-02   -1.248268594846743e-03   +9.246024908814486e-02   +7.154227350000297e-02; +3.293262601410325e-02   +4.926821134362408e-02   -1.512594411359164e-01   +1.571244757124084e-01   -2.106751925316006e-01   +2.394052108828787e-01   -1.020417211537627e-01   +7.131945641265527e-02   -1.000849951802271e-01   +9.876733271157090e-02   -4.891105497791045e-02   +5.142818500225400e-02   -9.846987444468221e-02   -1.027326151432688e-01   -4.776307635230290e-02   +1.256227069409046e-01; +9.620609683632865e-02   -6.925031611141305e-02   -1.481584877158472e-01   -1.235299927957213e-01   -1.492104146157441e-01   -8.301450308202976e-02   +1.252025350881704e-01   +5.330887639293977e-03   -3.142677049532450e-02   +2.570333400751626e-02   -5.431277649979262e-02   +1.296304795710963e-02   -4.031140631369422e-02   +6.180128573627262e-02   +4.439692861877468e-02   +2.061619827945503e-01; -1.571223329669213e-01   +3.029173067445269e-03   +1.450906157279228e-01   +5.660704855900470e-02   +9.417774901762077e-02   -7.398113439324455e-02   +1.174582237985425e-01   +1.344437019062440e-01   -1.638268998156783e-01   -2.083470917423290e-01   -1.351776418515939e-01   +7.270297180969257e-02   +8.934596645273428e-02   +1.708818957027909e-01   +2.164448670859800e-01   +5.333244229077423e-03; -8.967744677080471e-02   -1.248894048962728e-01   -1.394607724997819e-01   +3.263018608408861e-01   -1.237271238252622e-01   +2.270247261112788e-01   -8.172568585481524e-02   -5.190864790123789e-02   -9.776424067909048e-02   -1.082876132097565e-01   -1.509982153295045e-01   -7.525263583838032e-02   -1.358564428020649e-02   +1.258439956391196e-01   -7.171276047432608e-02   -1.425768919072017e-01; -2.428611474818354e-01   -2.113875539757345e-01   -4.157218516504422e-02   -1.504828807207556e-01   -1.199057080247501e-01   -2.835927670438374e-01   -2.820038447327566e-02   -1.098523603350456e-01   -3.780357543344148e-02   -1.131283036665901e-01   -5.429056191060645e-02   -1.243688134008783e-01   -3.410308825216768e-02   +5.242323310275349e-02   -4.705394893473986e-02   +8.018836047110518e-03; -1.530434667697715e-01   +2.352168826699642e-01   -9.721510278403575e-02   -1.061986088472068e-01   +1.457528262102472e-01   -4.634622978106648e-02   -1.076836992719053e-01   -1.062522669481869e-01   +1.899626455300974e-01   -1.834226811338066e-02   -2.018769415043524e-01   -1.162734246256473e-01   +5.462640940251214e-02   -7.695832968255245e-02   +3.602309964639682e-02   +1.038444891662211e-01; -1.072907788465321e-01   -1.518938434476599e-02   +3.074922849629121e-02   +1.252610215868316e-01   +8.817746634152862e-02   +1.559030259663982e-01   -2.239659068796730e-01   -1.003857197581603e-01   -1.291881960830433e-01   -2.871471313540464e-02   +3.171210698783206e-02   -4.811970952299305e-02   -1.981651803440370e-01   -1.481526396139897e-01   -1.583572686988039e-01   -7.987551445477384e-02; -1.621127211039668e-02   -1.401442540594268e-01   +5.505541211967354e-02   +1.028063610609450e-01   -1.903351372813147e-01   -1.329084797798146e-01   -1.609793132809537e-02   -1.164488857206234e-01   +1.345031783668675e-01   -7.563989746547808e-02   -1.228336004534972e-01   +7.547334539031975e-02   +9.219343190302660e-02   -1.950249951827626e-02   -3.030305888809886e-02   +9.578828262873774e-02; -9.643979321396690e-02   -1.164510449613240e-01   +6.251480826852716e-02   +1.145388764375740e-01   +4.695308663541697e-02   +8.310045468480654e-02   +1.289714877516397e-01   -9.865228885627007e-02   +1.251282425421414e-01   +6.980050163974905e-02   -4.595359219856005e-02   +2.795726336324640e-02   +1.817246013658957e-01   -2.397034116863332e-01   -4.227829443056060e-02   -2.097158714435943e-01; +1.038176449648210e-01   +1.891817854447683e-01   +2.527168080647795e-01   -1.936917534159387e-01   +9.341281122062338e-02   -2.087857061404940e-01   -3.953608331159000e-02   -7.684901840164141e-02   -3.842592845456416e-02   -1.176460559552999e-01   +9.811496146310479e-03   -7.155716579096698e-02   +8.373826010337662e-03   -9.925022319003154e-02   +3.939525034474640e-02   -8.612260924672462e-02];
L2I_L1I_iGABA_netcon = [-2.014252979104797e-02   -1.013430053681906e-01   -1.947001058656335e-01   -1.487028698238048e-01   -9.892460327855000e-02   -5.603212185903432e-02   +1.186158482031912e-01   -1.269708467696762e-01; -1.242804309496666e-01   -1.082352610250179e-01   -1.214027144035738e-01   -6.750912238502110e-02   +3.365731365475850e-03   -1.573433622990688e-02   +1.573274845474810e-02   -9.223266717778328e-02; -1.584860641633089e-01   +6.521454822718463e-02   -9.483830564445270e-02   -1.277296220284005e-01   +2.642369030038580e-01   -6.129358244211822e-02   -1.409310673373420e-01   -1.900484425441717e-01; -2.655916467644469e-01   +8.427042495273925e-02   -3.180588675527247e-01   -4.634873370581161e-03   -5.255863149221731e-02   +1.623920050556169e-02   -1.944675568328774e-02   -1.240774319109197e-01; -7.870101883913144e-02   -6.384180281934428e-02   -8.863819553247712e-02   +1.729228922036994e-01   +4.215390157379133e-02   +1.386830920706646e-01   -4.914580155003461e-02   +1.468347993905942e-01; +1.724574517543789e-01   +2.738766727243671e-02   +9.758523531878595e-02   -9.190734076566360e-03   +2.122256583683853e-01   +1.129112230775063e-01   -1.707841676024354e-01   -2.576914384100542e-02; -1.677299813844831e-01   +1.211683972744304e-01   -1.919031312314000e-01   -7.796519463910115e-03   -7.967544288806219e-02   +3.780035778938275e-02   +1.426466976775311e-01   +5.978415161481913e-02; +6.574563838403953e-02   -1.017296180276161e-01   -1.652695615214927e-01   +1.193341081670394e-03   +5.455743616937934e-02   +3.946599633685335e-02   -1.424563114769780e-01   +1.336484011037913e-01; -2.508638997204728e-01   -1.181922075945379e-01   +9.664362729193676e-02   +1.550924284915481e-01   -5.046545401897785e-03   +1.178832994890425e-02   +1.466216187404055e-01   +1.840472684938619e-01; -1.397479575340144e-01   -2.098746640992000e-02   +1.764575135091617e-02   -6.238221093477342e-02   -1.389602132218525e-01   +2.647515408425115e-01   +1.009911974453011e-01   -1.521794902808854e-01; -2.068837095857788e-01   +8.458628161544227e-02   +3.587487401645244e-02   +3.479489732616293e-01   -1.741914842549123e-01   -1.623762823755676e-01   +4.820116487275311e-02   +1.509826754104825e-01; +9.226185192640365e-02   +1.009105571925352e-01   -4.313214025689540e-03   -9.250829530609028e-02   -1.042819525145208e-01   +1.966288626110057e-01   -2.548137463414328e-02   +6.069962284507044e-02; -3.270974912230026e-02   +6.555423236718716e-02   -6.595185947592422e-02   +5.172624961330354e-02   -2.569559874697414e-03   +2.320372868589752e-01   -2.214824129555685e-02   -1.142270975419923e-01; +2.483044451507918e-01   -1.256922456005450e-01   +7.750460847829418e-02   +1.500910396311252e-01   -1.738206281126550e-01   +9.609953266164732e-02   -1.850495575249750e-01   +1.598576206603515e-01; -4.206825273427103e-02   -1.809697599326084e-01   +1.121772677317253e-01   -1.434883031220253e-01   +2.624958404143291e-02   +2.108934868835583e-01   -8.861079165839385e-02   +2.929908696475295e-02; -2.233171548300342e-01   +3.080313932446713e-02   -5.338506861110805e-02   -8.265791856590482e-02   -3.207842915812622e-02   +1.303059184796882e-02   +6.450267155394047e-03   +6.782728487329297e-03];
L1I_L2I_iGABA_netcon = [-6.282297354809653e-02   -9.738907325513339e-02   +5.257895998796287e-02   -9.994195218015366e-02   -1.773344772356055e-01   -2.305708175516019e-02   -4.620114352563195e-02   +2.852104545906795e-01   +1.561277054042009e-01   +4.516288027615294e-03   +3.320197562715322e-02   +1.350527950966833e-01   -6.908528689543442e-02   +9.420983600372600e-02   -1.244461185406068e-01   -7.033219903209566e-03; -2.031822488116510e-01   +1.053820373095657e-01   -1.273314273084679e-01   -2.112970263435898e-02   -1.615992921147218e-01   -1.982498906644407e-01   -7.254616149899883e-02   +2.200124305867479e-01   -1.008923336186291e-01   +8.458231569525955e-02   -2.036384195270576e-01   -2.512504003365397e-01   +2.398809427896209e-02   +3.952392850359123e-02   -1.577086813405647e-02   +9.525952714937681e-02; -5.754320377199271e-02   +6.225936827617375e-02   +5.902501406388760e-04   -1.254175908116546e-01   +1.710599420114391e-01   +8.588102080019500e-02   -2.625906021274045e-02   +3.014944108886686e-02   +3.637513045892164e-02   -9.147603803171728e-02   -1.171531311714335e-02   +9.755887498700562e-02   +1.348758491109177e-02   +1.755339718393639e-01   -5.645192451652829e-02   -4.128909667298205e-02; -9.681313765866945e-02   -1.312147692801520e-01   -1.740101493761071e-02   +1.028398263364233e-01   -2.799280777215475e-01   +1.355365225654021e-02   -1.023587471582168e-01   -2.297585970544433e-02   +1.135928057105998e-01   -2.172684554950268e-01   -2.154288412792596e-02   +1.160558931943377e-01   -1.058443899032629e-01   -3.166624830377001e-03   +1.044615339783280e-01   -2.970908570808326e-01; +1.134457897323175e-01   -7.432185700157104e-02   +6.379714575618137e-02   -1.098265182741951e-02   +5.354335801867167e-02   +1.127579277352086e-01   -6.056322059440301e-03   -1.397154964810759e-01   -1.199856736199490e-01   +6.229280754175657e-02   -3.000770662814433e-02   -3.056915775372257e-02   +7.827116666890437e-02   +8.865607697240896e-02   -4.870767097787900e-02   -1.566373417935468e-02; -2.636950348422727e-01   -1.051854573233904e-01   -5.362163771991314e-02   +3.488793827826984e-02   -4.096866673498047e-02   +1.269469040928867e-01   +6.555631465555022e-02   +1.865900553207660e-01   -1.249374967846839e-01   +4.262015193745398e-02   +3.606224057434927e-02   -4.990535293303592e-02   +8.285216064037336e-02   +1.520246719489745e-01   -8.248901852829692e-02   -2.687959312178212e-01; -1.889300084842770e-01   +5.435306211292638e-02   -6.930415042997087e-02   -9.992925351979708e-02   +2.639942504147056e-01   +1.740258913621814e-01   +6.854768458525519e-02   +2.736274450301476e-01   -1.162101974552476e-01   -2.309962201314755e-01   -1.058628751197051e-01   +1.565068503127910e-01   +1.238824235427988e-01   +2.061765479261728e-03   +1.569810873476575e-01   -8.597911926226321e-03; +2.330152284369624e-02   -1.660586845562972e-01   -3.856278878593247e-03   +3.015359211483633e-02   -1.315960241309685e-01   -1.799010967109463e-02   +8.962502721600320e-02   -7.545194231141275e-02   +7.503573612231927e-03   +1.344175981155380e-01   -2.854132421305207e-02   -2.691230374332864e-02   -8.968026788233997e-02   -5.158231885416022e-02   +7.897345520455970e-03   -1.552838500161658e-01];
L2E_L1E_iAMPA_netcon = [-2.223957971498410e-01   +1.537106339347121e-01   -8.488676967663698e-02   +1.900905022533206e-01   +4.169134306785227e-02   -2.507880065854348e-01   +3.229729877095695e-02   +4.490561260295062e-02; +1.562294479567507e-02   -9.754951543539386e-02   -5.244006338097907e-02   +1.836634192241581e-02   -4.872731972193284e-02   -1.094753467325866e-01   +1.296670425439573e-01   +2.695875981272621e-02; +2.263526160374006e-01   -1.945076604449976e-01   -1.812060506723366e-01   +3.330062571635421e-02   -1.158740113937532e-01   -1.247196612634902e-01   +1.739831636792408e-01   +1.334670102934886e-03; +9.890822498560940e-02   +1.971959788305857e-01   +6.399775276876234e-02   -4.957293807181267e-02   -8.970287220329513e-02   +2.206035638342420e-01   +2.592960596789379e-02   +4.556984459568272e-02; +9.620905075958172e-02   +1.049885665559295e-01   +4.903820579047989e-02   -6.746816477414967e-02   -1.483518179990804e-01   -5.113384198574041e-02   +2.351107015386672e-01   -4.719460919191796e-02; +1.370108496317975e-01   -1.749882464002760e-01   +4.456107798955345e-02   -1.376899370531552e-01   -1.022081717293212e-01   -1.614472181972239e-02   -5.416677339718483e-02   +2.095326901916345e-01; -9.118073295764556e-03   -5.515977172472844e-02   -6.603781972622136e-02   -4.826822648769925e-02   -6.902361494147830e-03   -1.452965874833310e-01   -6.227709293554209e-02   +2.093555631888187e-01; +2.151133128432197e-01   +5.932783511185959e-03   +1.218278372217289e-01   +1.889696050279105e-02   +1.961449849812091e-01   -1.422405509786750e-01   +1.758428338900253e-01   +6.461500158272023e-03; +1.616263178201083e-02   -3.533344951386400e-01   -7.054345704731885e-02   +7.776044823421212e-02   +1.436110660776327e-01   +3.155962228697315e-03   +1.332205180664593e-01   -2.544077861510193e-01; +1.368201164613629e-01   -1.783842264349170e-01   -3.550247463689928e-02   +1.339078891104262e-02   +9.661251749562387e-02   -8.187979201522221e-02   +1.638161575991141e-02   -7.372655976355437e-02; +1.489234021790196e-01   +3.385620830627178e-02   -4.044285263896912e-02   -6.611723971043408e-02   +2.264343016444951e-01   -1.496660507021214e-01   -1.128229022651936e-03   +2.571272300976414e-02; -4.221411805543521e-02   +7.845036797207081e-03   +3.130570851361054e-02   -1.356447156287217e-01   -2.728884387610027e-01   +6.093237158546569e-02   -2.670449259302513e-02   -1.392132170250297e-01; +9.576300364120803e-02   +4.071098912708700e-02   -4.310270282029326e-02   -1.978250706967553e-01   -8.588163069583860e-02   -5.766752040995961e-02   -8.521557105618083e-02   +2.033123507489603e-01; -1.776701815742330e-01   +1.073634319043339e-01   -1.149624666839033e-01   -1.440718727040138e-01   +1.139876100409912e-01   -1.277645137710127e-01   -1.340434331066461e-02   -1.112676534348555e-01; +1.511010732971821e-02   +8.313526889658125e-02   +1.196191083509760e-01   +1.583437187611429e-01   +6.165980794488055e-02   -1.741287939387432e-01   -4.410655403865448e-02   -2.212750462965143e-02; -1.712304073431139e-01   +3.240993555225094e-03   -6.474962225962659e-02   +2.960474567225224e-02   +3.276478630481618e-02   +2.697364122911195e-01   +6.071807402347368e-02   -1.445600547599724e-01];
L1E_L2E_iAMPA_netcon = [-9.624644366735230e-02   +1.190939979116521e-01   -1.313710873015236e-01   -4.459968299638635e-02   +6.421922910457532e-02   +1.753951122156503e-01   -1.171474431763761e-01   -6.627455745784405e-02   -1.044314591838835e-01   +2.209861625577650e-02   +2.423071644018296e-01   -1.274983716080067e-01   +1.344030307523612e-02   -6.795442459820859e-02   +1.007242131154836e-01   -1.890532192072747e-01; -3.346804483192412e-02   +1.324748452564781e-04   -1.113273150881663e-01   +9.473746559206579e-02   +1.801643170647786e-01   +1.271736771793717e-02   -4.541515795610955e-03   +1.884643737421910e-01   +1.389961864941145e-01   -1.098079246603306e-01   +1.800269087573856e-03   +6.728338257816049e-02   +1.853608094595904e-02   -1.103492116797430e-01   -1.090161366749929e-01   -2.145104000343683e-01; -1.043447039546613e-01   +5.085419989964873e-02   +8.807325983958406e-02   +4.694604620110686e-02   -7.666614360471628e-02   +3.647043996928699e-02   -7.472290895135722e-02   -4.879021858982337e-02   -1.838152028945780e-01   -9.339956179678177e-02   +1.296922480781369e-01   -9.222248899631881e-02   -1.466449051737658e-02   +2.477348735214606e-01   +1.912735718762297e-02   -2.150086860892839e-01; +1.561608220918924e-01   -6.491875779055126e-02   -9.212218637412052e-02   +1.364049579713943e-01   -6.827458598064959e-02   -4.674857132706521e-02   +2.441719069645481e-02   -2.918177811217182e-01   +2.735021102503107e-02   -1.659568798777245e-01   -7.381559449530339e-02   +1.058885934524038e-01   +2.238001757721373e-02   +5.380690748985965e-02   -2.035107690034350e-01   +4.919019133667014e-02; +2.669680235431999e-01   -1.746415404735582e-01   -3.303837830857648e-02   -5.782558955289915e-02   -2.063468739318328e-02   -3.455992722773037e-02   -1.305628275790428e-01   -1.987121422803925e-04   -1.709789771306897e-02   -2.359412164597519e-02   +1.382309597345814e-01   -1.434849947441429e-01   +1.024947966867225e-04   +5.891731122910988e-02   +1.624893579194000e-01   -1.660768630375429e-01; +1.722195232563096e-01   -1.695454808174154e-03   +5.364416550214159e-02   +1.540531910524064e-01   -4.293340455694418e-02   +2.131328814971239e-01   +5.652515898037521e-02   -1.027276036285567e-01   -3.186423350650130e-01   -9.328529390569412e-02   -2.753162639152759e-01   +1.192333742053401e-01   +1.179510665552984e-01   -4.123992437325474e-02   +1.435560183145059e-01   +1.082947656738824e-02; -1.813230567817710e-01   +1.072155685874781e-01   +1.362235248590123e-01   -3.814331013927941e-02   -5.805396006441951e-02   +6.684102435862524e-02   -1.394550088051981e-01   -1.185952173930406e-01   -7.344518895953396e-02   -1.496906396933627e-01   +1.415219660263072e-01   -2.090291664955690e-02   +1.938233061500380e-02   +1.298197965047432e-01   -2.527544254078746e-02   -3.356962417447874e-02; -9.740264516977816e-02   -1.398191479343727e-01   +4.467961543325204e-02   -1.744785452218138e-02   -3.072417444612286e-02   -1.030591620554429e-01   +2.530239429904772e-02   -7.355311796159109e-03   -6.992648321129989e-02   +8.897090815209413e-02   +1.542017898616820e-01   +1.458632850730848e-01   +8.501275368066261e-02   -1.995187406695475e-01   -3.253382972630003e-02   +1.803981296895409e-01];
L2I_L2E_iAMPA_netcon = [+2.894575858124857e-01   -1.651530963402596e-01   -1.159177410071878e-02   -1.517979938656668e-01   +8.542089095047169e-02   +6.472439753856828e-02   +1.081269622528223e-02   -8.834703456804574e-02; +2.887412373308329e-02   -2.066637626996045e-03   -1.025582485544862e-01   +1.250240654826955e-01   -1.494413374924021e-01   -6.181773904495454e-03   +3.128517157580951e-02   -2.255524980425077e-02; -3.594245942339963e-02   +5.507317556454725e-02   -7.811640601813882e-02   -6.961081515060336e-02   -2.256846540532918e-01   +1.153347791997636e-01   +8.131853715966564e-02   -2.611406280982836e-02; +1.085256917013948e-01   -1.141700386556117e-01   +1.120358767096124e-02   +8.398276678231667e-02   -7.361429123448851e-02   +1.124424928913451e-01   +1.646307983581511e-02   -1.245634507479201e-01; -1.348099610144680e-01   +1.647335082475408e-01   +4.371235527489802e-02   -2.889861171568940e-02   +1.828084591064586e-02   +1.015897462217516e-01   +3.074520957804450e-01   +2.434429141626492e-01; +3.236394871726585e-02   -1.096419427329518e-01   -8.504461438507957e-02   +2.256112057579027e-01   +8.052804308105901e-02   -2.139251376639196e-01   -7.927013617208352e-02   -5.247236434782983e-02; -1.325125516311043e-01   +8.527524419224196e-02   +8.481540046525189e-02   +8.731997054136208e-03   -1.275777799932934e-01   +1.013496666259898e-01   -6.690324673810831e-02   +7.145429204031783e-02; -1.616405653496058e-01   -9.624298876093755e-02   +1.446522243808607e-01   +7.860285927694961e-03   +1.211509801380205e-01   -5.604688083358890e-02   -1.044803682200597e-01   -2.096648641693415e-02];
L2E_L2I_iGABA_netcon = [-2.844956456457737e-02   -8.257722376083873e-02   +1.800834106603584e-02   +1.504574368554868e-01   -4.246976638291552e-02   -2.610014271140991e-02   +1.006592530113642e-01   -2.982000236600535e-02; +1.656922742864414e-01   -2.205383286814658e-01   +1.464670150232847e-01   -2.485766889920563e-02   +1.112381334786915e-01   -5.098451961352726e-02   -6.482514564451299e-02   +2.281246715708518e-01; -2.633976652176001e-01   +2.784927367271655e-01   -4.605861366423680e-02   +6.058460064803924e-02   +1.554848489387737e-01   -1.278426980327538e-01   +1.285940675837022e-01   -3.202915863990807e-02; +1.421157971160406e-01   +3.973810059530992e-02   +1.196965562881280e-01   -2.086775200705562e-01   -1.690519876862709e-02   -1.361968367229084e-01   +4.825180528040483e-02   -7.366985670832253e-02; -1.032892765647624e-01   -1.961620047169786e-01   -1.773531797003404e-01   +4.793153755254543e-02   +1.272012633831127e-02   -3.425083723263948e-02   +3.635251416545414e-03   +6.390851714064624e-02; -2.846793765040665e-02   -2.115074358093539e-01   +1.118231240598463e-01   +5.959081660976311e-02   -5.522542290471363e-02   +5.570435051793236e-02   -6.811429050241842e-02   -2.976340573256672e-02; +5.841377007505098e-02   +4.374288930648200e-03   +1.628197526872320e-01   +1.452427320839782e-01   +1.190734871949480e-01   +1.830139041024545e-01   +1.145222623801846e-01   +5.607530146641482e-02; -1.266780076825250e-01   +2.288797694500263e-01   +2.825820270484513e-02   +8.777318918291351e-02   -1.064576767798371e-01   -8.465184798722651e-02   -6.622337452145975e-02   -3.300846957499966e-02];
L3E_L2E_iAMPA_netcon = [-1.223479973149537e-01   -3.138766155980969e-02   +7.499995108336349e-02   -8.815191561749043e-02   +2.023758738148130e-01   +1.559748068421644e-02   -4.458224488382378e-02   -9.581870027356854e-02   -1.779487884518300e-01   -4.171798965352422e-02   +1.496304377337307e-01   +1.087791286424583e-01; +8.029154614134035e-02   -4.668286127288391e-02   +1.117430749685547e-01   -6.139713842876086e-03   +1.890002024084023e-01   -1.567884360254502e-01   +8.815448885873618e-03   -4.164836070680005e-02   +1.565492218316768e-01   +3.174615292788015e-02   -1.531492598048489e-01   -1.240860548794541e-01; +1.066101131105527e-01   +4.541675641339649e-02   -1.090493895294244e-01   -2.579657735969870e-02   +1.595583474727569e-01   +5.294310742560974e-02   -1.048814454883881e-01   -8.328608461926512e-02   -1.695043582165212e-01   -1.337469809931651e-01   -1.419462004880950e-01   -6.604108465826709e-02; +8.480011318318872e-02   -2.850152197943124e-02   +1.333114047577258e-01   -8.999262595408065e-02   +1.187408695699629e-02   +2.269640446006460e-01   -1.799105644828405e-02   +1.714700729816586e-01   +3.056236123134158e-02   +1.755113590300408e-01   -2.466356680880787e-02   -1.894416178580563e-02; +1.795650963109573e-01   +1.796455409517345e-02   -1.853771508246198e-01   -1.789794464679886e-01   +3.225841851281617e-03   +1.199589036281647e-02   -2.433834439828060e-02   -1.962719479878421e-01   +1.268128650458432e-01   -4.094883235531491e-02   +5.705481367268846e-02   -2.365912315655037e-02; -2.427475425737482e-01   +2.257556135918650e-01   -7.892475672780611e-02   +5.954861129642469e-02   +1.356858940629891e-01   +1.209778789256238e-01   +7.828338969625160e-03   -5.207138019573248e-02   +5.653386187656098e-02   +7.348117318944163e-02   +1.769312960538551e-01   -1.283061269532025e-01; -8.072523723559376e-02   -1.497820344959458e-01   +6.650484588690778e-02   -1.507246217284194e-01   +2.598364976688303e-01   -1.541529143291393e-01   +1.087625293872694e-01   -5.085238131584721e-02   -6.472313942682176e-02   +8.184893687852432e-02   +4.127968574946353e-03   +1.404297006706011e-02; -2.255859766090321e-01   -1.636068744708980e-01   +5.465014850977191e-02   -9.613429127901158e-03   +6.449422621542340e-02   -1.520589017363032e-02   +1.260625241650703e-01   +1.834160846905528e-01   -2.752607426159565e-02   +2.438804550406842e-02   +2.218575059667850e-02   -2.405529474383724e-01];
L3I_L2I_iGABA_netcon = [+1.338988200713216e-01   -9.543372514995617e-02   -5.898569908548035e-02   +2.866040046493011e-02   -1.350993364710303e-01   +8.655103052708003e-02   +6.810194500346226e-02   -2.869349738930341e-02   +9.506423841036216e-02   -1.289998939771277e-01   +1.045738454510597e-01   +4.926862741635237e-02; +1.815811394779157e-01   +1.284856437883566e-01   +4.350035007092392e-02   -1.085020133305692e-01   -1.452831002025592e-03   -8.128217767796204e-02   +7.239006502044401e-02   +1.873596114871247e-01   +1.039820961516312e-01   +5.864726840892914e-02   +1.315406923028590e-01   -1.146675688819518e-02; -1.613910388294343e-01   -1.992660442986945e-01   +4.054425240836501e-02   +1.753940196041020e-01   +1.197817937799407e-01   -1.385255325964644e-03   +2.060956716791938e-01   -1.115594021361160e-01   +7.183024610112071e-02   -1.701669679220803e-01   +1.251531675088153e-01   +9.502123278216260e-02; -1.031018395538925e-01   +1.407065316824355e-01   +5.224065082179247e-02   -2.045492465629349e-02   +6.540963431416164e-02   -9.221309312862291e-02   +2.332362292278772e-01   +1.065107939023618e-01   +9.923979394199885e-02   -1.418361388680987e-01   +2.096603934614474e-02   +4.244417260145801e-02; +8.642619777268415e-02   +1.614685707489058e-02   +1.764220981478176e-01   -1.050377857333045e-02   -3.420471323573623e-02   +2.130401659518456e-01   -1.282309780372609e-01   -4.060945101217261e-03   -1.642779654462323e-01   +1.205544124915666e-01   +2.092211413643058e-02   +6.529736217204660e-02; +8.693351831467037e-02   -2.143870597837797e-01   -2.504094183477520e-01   +6.843505590178997e-02   -1.567541462534642e-01   -1.367304056503061e-01   -7.543625086880207e-02   +6.866488583671786e-02   -2.002635724006967e-01   -1.261263844951402e-01   +3.441288957291957e-02   +1.706338351195678e-01; +5.033594033282979e-04   +1.349649810804966e-01   -8.939088450605259e-02   -2.566344930077363e-02   -1.437621021560825e-01   -3.789875001067417e-03   -1.744157632595321e-01   -7.838384654590169e-02   +4.042477329743686e-03   -1.258984959910410e-01   -2.194952011891181e-01   +6.043116273991454e-02; -4.454933469372922e-02   +7.551914302509728e-02   -9.561938381291902e-03   -8.831280978693859e-02   -6.127056645664018e-04   +8.571486510130125e-02   +3.738929293321784e-02   +1.423518085266171e-01   -1.793718019181381e-01   -1.284917471673125e-01   +2.030021160911171e-01   -4.629824459008925e-02];
L2E_L3E_iAMPA_netcon = [+1.366083848263790e-01   -7.418651054429276e-02   -2.341850627951802e-01   +1.307855164715886e-01   +9.237767534278841e-03   -6.486219306063701e-02   -2.074509750011537e-01   +7.730251299542037e-02; +5.769441362227781e-02   -2.010905408106434e-01   -1.396935506572098e-01   -1.766814673942058e-01   +1.187197625412255e-02   -1.326787176938685e-02   -9.406761139933209e-02   +2.457044263757759e-01; -1.480659646835814e-01   +2.345102000798166e-01   +1.717892365187082e-02   -9.054132593434797e-02   +8.856483061736380e-02   +7.618514314526760e-03   +5.880878631289634e-02   +3.421601333908845e-02; +2.967480720742509e-01   +2.943441261008815e-01   -3.030166556115901e-02   -4.250012237383346e-02   +8.811709342475922e-02   -3.094903991344120e-02   +6.726134854566002e-02   +1.580099349900203e-01; -4.596290712711969e-02   +1.415141182812787e-01   -4.097432572100006e-02   +1.362653334037566e-01   +1.308475114837779e-02   -5.841307419888257e-02   -1.394274459090186e-01   +5.272746484132412e-02; -6.155619484730488e-02   -1.302462734128025e-01   +1.677590316831856e-01   +8.595140430111514e-02   +7.084396773617482e-02   +2.296817657268843e-02   -1.337226264936346e-02   +1.362048556369073e-01; -1.050834411433745e-01   -1.453780594696990e-01   +1.994950688925068e-01   +3.304474843773955e-02   -4.384147710574723e-03   -2.159601571545333e-02   -1.097046636291641e-01   +8.324578551927883e-02; -9.933712374041147e-02   +1.226202270761756e-01   -9.440748996864677e-02   -4.664042765759341e-02   +5.098832993717554e-02   -1.036709299814564e-01   +3.319111354642593e-02   +1.564828243501877e-01; +6.814662781984332e-02   -1.007005095776286e-01   +1.855756051502194e-01   +1.094452402647332e-01   +1.113630189168975e-01   +4.864568227257199e-02   +1.502611184485493e-01   -5.055621453681818e-02; -1.714698647860801e-01   -8.707005863090174e-02   -2.931288685556655e-03   -2.336358114991881e-03   +7.228498221184849e-04   -7.840991600016063e-02   +1.848386294961316e-02   +6.598235200930494e-02; +1.381337413673836e-02   +1.324501926932737e-02   -1.171427004588394e-01   -1.451703756498334e-02   -6.416315033870496e-02   +9.598928693526672e-02   -7.454078515075925e-02   -9.884063595727459e-02; -9.713940877756194e-02   -4.045863590540527e-02   +5.305643943305095e-02   +1.140792942913884e-01   -4.350751823433343e-02   -1.582251326841701e-01   -6.646640256755613e-02   -1.382423969228430e-01];
L2I_L3I_iGABA_netcon = [-8.365806332734098e-02   +2.614693459842903e-02   +1.420165181371147e-01   -1.056869908679331e-01   -1.333258468694409e-02   -4.495612713753099e-02   +9.671963083766852e-02   -1.940810909745815e-02; -8.353139194066159e-02   +3.152147953876472e-02   -7.250373037831571e-02   +4.576762641099941e-02   -1.131252173493394e-01   +4.163575879989641e-02   +3.025707660415496e-01   +2.589712348144348e-02; +1.325845438553807e-01   +5.540378468358936e-03   -2.318915720180493e-02   -1.729739406814006e-01   +1.097025811973633e-02   +1.136638423954627e-02   +4.848364823409399e-02   +1.305293538968651e-01; +7.367907493052975e-02   +1.785846946062250e-01   +5.361327608057971e-02   -5.708250676072358e-02   +8.691207154480653e-02   -9.483381957129580e-02   +1.980536345326014e-01   -1.534103798107338e-01; -8.723012446829126e-02   -2.038616401244029e-02   -1.588866335617253e-01   -1.107245014419820e-01   +8.452796031207818e-02   +1.211406385190040e-01   -5.462607189724816e-02   +2.770511640324656e-02; -5.340225883242884e-03   -1.848050101919812e-02   +5.824955642811156e-03   -8.188026359840762e-03   +8.403247681203785e-02   +1.483475873670523e-01   +9.161009572806991e-02   +1.071311562643008e-01; +8.814656385489650e-02   +1.920954044846304e-04   +9.537409885194956e-02   -1.126483724377230e-01   -3.423234063732099e-02   -2.395648774120176e-02   +6.090578646393747e-03   -1.259659475301681e-02; -4.184568320678152e-02   +1.933810167775948e-01   +9.068180677224136e-02   +1.001023031264072e-02   -1.186840647063233e-01   +1.810450810463155e-02   -1.978568176549764e-01   -1.053669190945179e-01; +2.533963413656556e-01   +1.326033505030330e-01   +5.548886121111223e-02   +1.629348033802804e-01   +4.610208165205589e-02   -8.024769984419171e-02   +2.473123751306768e-01   -1.698026505061538e-01; -2.060939624936570e-02   -1.014307577004969e-01   -1.046116227643833e-01   +1.133858768002334e-01   -5.230990508666248e-02   -2.345314009919496e-01   +3.862002593845775e-03   +8.331973960356270e-04; -1.373884026697839e-01   -1.090098201496002e-02   +6.419217910659124e-03   -8.479248975765562e-03   +1.708255765188731e-01   +9.657329523183986e-02   -8.497862871296454e-02   -5.172795628550899e-03; -5.491189240782799e-02   +1.568821877886026e-01   +2.534247393595694e-02   +1.316430533491622e-01   -4.704627895082671e-02   -9.509048567830893e-03   +6.222293016354249e-02   -9.766876738639202e-02];
L3I_L3E_iAMPA_netcon = [+1.400778638516299e-01   -4.014244541264774e-02   +2.872829255892951e-01   +3.123090218674907e-04   +2.184719902994503e-02   +1.318855146914338e-01   -2.124354659549395e-01   -1.602059059308900e-01   -2.043200949563438e-02   +2.337997165421483e-02   -1.167388314073838e-01   +3.745539689352636e-02; -2.000766585655998e-02   -3.772643172697671e-02   +2.806555974345805e-01   +6.605593492006169e-02   +1.145377858913095e-03   -3.237352331547205e-01   +2.027157879375544e-02   +2.414514643937675e-01   +1.934536660485235e-01   -9.617723190804810e-02   -6.699164739539436e-02   +6.831744659768084e-02; -1.170834578812979e-02   -1.904667888166284e-01   -1.808290883990138e-01   +3.423096514824139e-02   +1.295303137113652e-01   +3.546186933672547e-02   -2.214215623114390e-03   +1.397712381938919e-01   +6.274528029130334e-02   -6.287505914627418e-02   -5.886913062732800e-02   +1.391006468651384e-01; +1.704067808468763e-02   -3.142710887919558e-02   +2.820690971546236e-01   -6.163407234491825e-03   -1.887969342505973e-01   +7.929045769732372e-02   -2.015823847022516e-01   +8.766080347450650e-02   +4.132634126391316e-02   -4.801057386100117e-02   -2.038401713372589e-02   +2.255125794603629e-01; -5.719542987647763e-02   -2.602105936437558e-01   -1.054736845123495e-01   -1.917147328449739e-01   -1.514829250724425e-02   -1.814514925721041e-01   +1.640596398946851e-01   -2.894007955708805e-02   -1.335949315559961e-01   -2.454485512483849e-01   -1.252872502400064e-01   -1.303737471261585e-01; +1.498583838773596e-01   +1.239181624012822e-01   +8.037825949778615e-02   -2.447954914601792e-01   -2.362389702071900e-01   +7.818295687869863e-02   +1.813992619251284e-02   -2.755884042260350e-02   -6.767038805548092e-02   +1.465793788748766e-01   +7.869824589212877e-02   -2.842591111202864e-02; +1.055926162045391e-02   -1.822204493203221e-01   -7.627903715543473e-02   +1.309314285461922e-01   +9.592082685680615e-02   -1.525473848569685e-01   +1.138852043729219e-01   +2.895067174393401e-02   +5.594500620559302e-03   +7.320582388001848e-04   +9.400071881178376e-02   +1.007268760228403e-01; +4.326727338563054e-02   -4.814361076422622e-02   +8.225297424677638e-02   +6.645361386200296e-02   +2.789300314263788e-01   +1.208925134646050e-01   +8.013895578903249e-02   +3.008272500990019e-02   +1.088556747394601e-02   -4.426965362144676e-02   +2.932896695997846e-02   +1.192575323633468e-01; +2.074372659593967e-01   -1.732006467037627e-01   +1.201360318577617e-01   -1.419211323941030e-01   +1.091990625091858e-01   +2.135265571032880e-01   +1.644809395791809e-01   +8.836774454744965e-02   -1.042941519101925e-01   +4.892042068717868e-02   +5.392530897832306e-02   -3.037098060137625e-01; +9.613745726543861e-02   -1.422139939938619e-02   -1.456281826726091e-01   -3.808189606318809e-03   +3.227941340608585e-02   -4.785257058822078e-02   -8.502198821504668e-02   -5.032153538380542e-02   +1.772186908541281e-04   -3.007538183536075e-04   +1.418096632923743e-01   -6.971690533763288e-02; +7.447425621077183e-02   +1.824404795216934e-02   -1.890215757315114e-01   -1.633585777047937e-01   +1.590257620845934e-01   -2.099047324536586e-01   -1.792992550480909e-02   +1.752834990934583e-01   +1.084263121000466e-01   -3.932627046766211e-02   +1.778086428407560e-01   +8.765657357824276e-02; -9.921912856976388e-02   +1.717579167388567e-01   -3.161983790980039e-02   +1.190382213431792e-02   +1.458193572249464e-01   -1.330958424993115e-01   +5.636838552915882e-02   -1.605572047328272e-01   -8.802555067036924e-02   +1.914777106460396e-01   +1.863250912732437e-01   +1.358858505801035e-01];
L3E_L3I_iGABA_netcon = [-3.107076231880111e-02   +1.694273350289852e-02   +9.241641239139253e-02   -6.338697423086273e-02   -1.427235598480734e-01   -1.688017319967007e-01   +1.046532476697470e-01   -1.501953249736997e-01   -5.685246456899604e-02   +4.627453646208492e-02   +6.853596514464189e-04   +1.057144957729084e-01; -7.519231202799566e-02   -6.438367815560796e-02   -8.556115246619109e-02   -1.485989585078129e-01   +2.698815259038087e-01   -9.003932583500744e-02   -3.747838180878089e-02   +5.202000924441448e-02   -7.875232867221398e-02   -1.308920474938580e-01   +2.861626505797067e-01   +1.032772854339380e-01; -1.017777490940381e-01   -3.756971442368617e-03   +7.885835305271692e-02   +6.833310561521554e-02   +5.301421780104443e-02   +9.872543860361789e-02   -3.271802770951093e-02   +2.963341169181084e-03   -6.204411457553297e-02   -1.200017040263061e-01   -7.055704074554305e-02   -3.585189561489825e-02; -8.455746665130258e-02   -6.946846781220753e-02   -5.443441266805989e-02   -6.467192854677796e-02   -1.138073470753363e-01   +2.507862122143773e-01   +5.465841352902341e-02   -7.553772173048423e-02   +3.225947566548522e-02   -1.830135838604630e-02   -2.272675048737355e-01   +1.079676274399441e-02; +3.100972935314890e-02   -1.440270848440291e-02   -2.220579847576378e-02   +1.032040041132135e-01   +4.998322479607373e-02   +7.325166467025508e-04   -4.245390039440394e-02   -2.422790605759011e-01   -2.586212700304934e-02   +5.567256110699723e-02   -2.145248289182849e-01   +2.379242046650192e-01; -6.058854680254134e-02   -8.206677818218401e-02   +1.577733089465146e-01   +1.520324453829521e-02   -7.314944031487776e-03   +3.579177375873943e-02   -5.307819301552014e-03   -9.818325370393927e-02   -1.469496592741970e-01   -8.156820376414105e-02   -7.348196841097171e-02   -4.358893121857720e-02; -1.405813610970815e-01   +2.907629650490962e-02   +8.604769569201723e-02   -1.310103300073024e-01   -1.632788257710008e-01   -1.672812396527559e-01   -8.719418338934988e-02   +1.409281300071568e-02   +5.540607472861526e-02   +2.448719779729726e-01   +1.048524434287634e-02   -7.178136481252401e-02; +5.736851630004176e-02   +9.041577773629537e-02   -1.168298214047482e-01   -1.135726489063244e-01   +2.748040322104769e-02   +2.679642484072908e-02   +1.265042145317106e-02   +5.894536802478898e-02   +7.510661566611801e-02   +1.303867219543942e-01   -5.649318570454054e-02   -7.605949193359160e-02; -1.238140286574024e-01   +2.124920276336038e-01   +9.032184659169357e-02   -1.833232924033900e-01   -2.553279061616197e-01   -2.549333182788951e-01   -1.782716431190544e-01   +9.948025308023302e-02   +1.183497923406348e-01   +1.606469077948213e-01   -3.880600942736206e-02   +3.897571854192940e-02; -1.042318829783150e-01   -2.587202254780311e-02   -5.388832586495594e-02   +6.929066749877953e-02   +1.461392033750820e-01   -1.137398456847134e-01   +1.944155820797311e-03   -8.916440578498119e-02   +2.032168249597820e-02   -8.653530988293665e-02   -5.574105750986699e-02   -1.135646268237784e-01; +1.138325733986863e-01   -1.743969652128036e-03   +8.439628753801038e-03   +1.947308602026990e-02   -3.757165756436016e-02   +2.202982594277557e-01   +1.002114621347024e-02   -2.171814039113733e-02   +9.668508971712986e-02   +8.089291251963865e-02   -1.651563649825823e-01   -2.275005542289708e-02; +3.560955979168590e-03   +1.322269830095985e-01   +1.855747631758373e-01   +6.921098591400984e-02   +2.116799229628714e-01   -4.587243780771704e-03   -4.097725817818910e-02   +7.448546413576262e-02   +5.222570821980168e-02   +2.367974317037425e-01   +1.954060610770597e-01   -5.504400197039211e-02];
L2E_Input1_iAMPA_netcon = [+6.955314246993128e-03   -1.296757532624942e-01   +2.098692981316853e-01   -6.750596659540543e-02   +1.072847170858743e-01   -6.787229778718449e-03   +5.237297284552413e-02   +1.169634146304756e-01];
L2I_Input2_iAMPA_netcon = [-9.580981081001198e-02   +1.446241556735405e-03   -1.256099886190050e-01   -2.774066100931343e-01   +1.174165292891927e-01   -7.303043315614097e-02   +2.354696874058593e-01   -1.562023005946246e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
