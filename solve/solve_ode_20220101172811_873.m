function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+9.522959000110065e-02   +1.594095371823957e-01   +6.500086413737173e-01   +3.840265103042532e-01   +6.447724301543656e-01   +4.796981117265496e-01   +4.795147816925089e-01   +6.879673554791007e-01   +7.721245622936888e-01   +1.365826333721876e-01   +3.085407696619059e-01   +4.383506596224319e-01   +2.119996344896977e-01   +5.631713587473627e-01   +3.175744012449274e-01   +7.391428033364064e-01; +2.989002650515179e-02   +1.672468118362817e-02   +1.237462284417626e-01   +2.588394022343920e-01   +5.652763412300009e-01   +7.558728296312900e-01   +4.355680129635792e-01   +4.577360736640234e-01   +3.418374404759825e-01   +1.970056495839514e-01   +3.886760996082761e-01   +6.773658928345685e-01   +4.474909359399341e-02   +4.677469832523161e-01   +3.050138194976454e-01   +7.754963591642461e-01; +3.097893036019882e-01   +4.688019562466000e-01   +3.263641149611674e-01   +5.424678548757282e-01   +5.690435656751061e-03   +1.956002210550571e-01   +6.195357125792093e-01   +2.558783372103938e-01   +3.900689360104078e-01   +3.259312951264067e-01   +7.825156189451571e-01   +2.046832315360874e-01   +6.506624360037035e-01   +5.355224325297009e-01   +6.508490987672251e-02   +7.980525512913024e-01; +3.359700200184411e-01   +4.812322427871174e-01   +3.406955682428467e-01   +6.605708169640353e-01   +2.007164209163505e-01   +6.871928928890608e-01   +4.233886523985340e-02   +3.956654609349156e-01   +1.649863150091696e-01   +6.823952953911724e-01   +3.044400949506223e-01   +1.431330976100294e-01   +5.738950809422028e-01   +6.318119137753614e-01   +7.864135259026129e-01   +5.639643381731292e-03; +7.283771295540593e-01   +3.148503606055727e-01   +1.431255989350045e-01   +3.997281666605030e-01   +1.038007577563821e-01   +6.051781838987087e-01   +3.378659975589320e-01   +4.050549659547369e-01   +5.612050987968660e-01   +1.192175372990372e-01   +2.194063374014995e-01   +1.715028903383604e-02   +2.259075768910620e-01   +7.191654262926902e-01   +2.807845052204719e-01   +6.976757917477426e-01; +3.764376212662124e-01   +9.590301467046104e-02   +1.639935323322657e-01   +5.108428908071447e-01   +6.415539407955173e-01   +7.796207787610148e-01   +7.367630838312138e-01   +1.513589713908811e-01   +7.347255976742231e-01   +6.698240188391903e-01   +6.616414326933583e-01   +5.731013843292690e-01   +6.873220093157033e-01   +2.968580262038102e-01   +8.368837225374523e-02   +5.552230490433253e-01; +1.282656002754992e-01   +2.433480329058700e-01   +4.231310716746877e-01   +4.076920483012041e-01   +5.837167893586361e-01   +5.212231544407518e-01   +2.412002115750344e-01   +1.244966421446766e-01   +5.065078704795165e-02   +9.908185610013334e-02   +2.047199394873997e-01   +4.446352376793536e-01   +6.376536750024363e-01   +4.868873749542680e-02   +4.970285730730056e-01   +1.947604770663776e-01; +4.264215851741781e-01   +1.009927017266511e-01   +4.315678816299566e-01   +4.240145482291933e-01   +1.376062118135713e-01   +6.909807460320514e-01   +5.816831029903916e-01   +3.555657174209783e-01   +6.886263648624324e-01   +4.054236840836454e-01   +1.183178083248360e-01   +7.805026220690230e-01   +5.133803769183964e-01   +2.076878940646322e-01   +6.762058108675399e-01   +4.302668786163537e-01; +3.884579308317234e-01   +5.984951669951463e-01   +7.144083739607517e-01   +7.491482610080838e-01   +6.907316177799209e-03   +7.350736312871526e-01   +5.246134593671892e-01   +6.777303959656482e-01   +3.400375504765198e-01   +4.476414187577722e-02   +2.480942411204295e-01   +3.558695575273717e-02   +1.923247039644304e-01   +4.627046969228985e-01   +5.156701881545421e-01   +6.204619316851036e-01; +2.529359117127675e-01   +5.238929497520441e-01   +3.098283394235170e-01   +4.202769657938787e-01   +1.653126245027469e-01   +2.096470746658497e-01   +3.152121496341876e-01   +6.680343836214148e-02   +7.545535525185331e-01   +7.887166996239490e-01   +6.665403723862664e-01   +7.512430391259838e-01   +7.469933277096069e-01   +6.014904289342500e-01   +6.948610071444633e-01   +3.238400356589745e-01; +3.933758598571275e-01   +5.406808935588308e-01   +3.234472586916381e-01   +3.345441172522563e-01   +3.697614948937543e-01   +2.454658331431734e-01   +3.696144082199465e-02   +4.928598646551595e-01   +1.459468095995792e-01   +3.981442077319945e-01   +4.381390229469141e-01   +4.443117749054280e-01   +1.108980951860751e-01   +1.863088596142756e-01   +7.578660149690180e-01   +6.850616248381698e-01; +3.007714249342981e-01   +2.431180489294815e-01   +3.844076666162063e-01   +6.492000496003479e-02   +2.332143115029293e-01   +4.248285917508420e-01   +3.947326681693397e-01   +5.929958580566337e-01   +2.062293668616074e-01   +3.523264242567155e-01   +6.994929895055533e-01   +2.539681397797797e-01   +5.390796564863622e-01   +4.728544999898707e-01   +4.069823689535760e-01   +4.358179183341806e-02; +5.216587556105151e-01   +6.249905942070358e-01   +2.808090534647059e-01   +6.499569129560240e-01   +1.925158506161744e-01   +2.018448451881311e-02   +6.622428924000388e-01   +7.068453094443407e-01   +4.157343024684606e-01   +2.219805183899833e-01   +6.818625128781569e-01   +6.290220493684981e-01   +3.967294489978868e-01   +5.342759231564609e-01   +6.456468678494799e-01   +7.873370318566929e-01; +3.388990612333254e-01   +4.834166200989300e-01   +9.882803217312280e-02   +3.827337109128811e-02   +5.502227810951379e-01   +7.048230114068477e-01   +8.788960794178977e-02   +5.675917558191320e-01   +1.606020007023936e-01   +4.777237429786432e-01   +1.612470083446807e-01   +4.426652885438035e-01   +6.637806559988624e-01   +7.777756637365191e-01   +7.903504019026308e-02   +2.024157825675380e-01; +4.711472950082237e-01   +7.108948450867010e-01   +5.204514322833804e-01   +1.209333975434659e-01   +1.017274036067700e-01   +6.374475416287585e-01   +7.759282026320867e-01   +6.497876274275501e-01   +4.126685264666345e-01   +4.906812051727234e-01   +6.394024839553331e-01   +4.622092494729586e-01   +4.467682412952169e-01   +7.165810526353660e-01   +3.985333914211799e-01   +3.355397017977611e-01; +1.447774053880261e-01   +5.781297125451957e-02   +7.445026278292084e-01   +5.209403324552841e-01   +5.247125871568120e-01   +5.976974079641468e-01   +2.298309645807913e-01   +5.951192597012092e-01   +7.158544168979329e-01   +3.495120545338123e-03   +5.183027735731148e-01   +7.255980342061185e-01   +4.843068246331757e-01   +3.449647968496044e-01   +6.829307199610122e-01   +4.234595721689824e-01];
L1E_L1I_iGABA_netcon = [+3.702034512041785e-01   +7.960760835372864e-01   +2.891042073690260e-01   +4.183413659534391e-01   +7.244310250868555e-02   +4.340054054313153e-01   +1.113480523519742e-02   +4.452770215003566e-01   +4.242404700333166e-01   +1.629817505105796e-02   +4.080906037793109e-01   +3.056535304826001e-01   +2.372345862530924e-02   +2.595777691590989e-01   +7.554103771520977e-01   +7.766155484753055e-01; +2.558388025768962e-01   +3.678260974907157e-01   +3.750515374577267e-01   +2.103942071881095e-01   +1.470479278769422e-01   +2.405793584118445e-01   +3.519031987098298e-02   +3.362814821840295e-01   +7.303286233889101e-01   +4.005451314338668e-01   +7.736306618324383e-01   +4.596843097082901e-01   +4.109110832735344e-01   +1.363862620990978e-01   +3.062181294447872e-02   +1.214003199173793e-01; +1.429782801441346e-01   +1.521859534424180e-01   +8.152963907920277e-02   +4.394624753695157e-02   +6.195185557779416e-01   +7.517861107780915e-01   +7.465398664539549e-01   +3.356643718334734e-01   +1.410938580050258e-01   +4.822035303370281e-01   +5.869763330258999e-03   +6.323886255174277e-01   +5.937908562449554e-01   +1.510395570118949e-01   +5.665937158804428e-02   +3.102190995540283e-01; +3.724618030143869e-02   +4.355083008355282e-01   +2.066829367878420e-01   +5.887411335829082e-01   +1.137102037324980e-01   +3.383282764779878e-01   +3.452125722375267e-01   +4.901659953477871e-01   +3.489657345458107e-01   +2.331652135586524e-01   +3.940213020362810e-03   +6.445706508464277e-01   -4.225216537879337e-03   +4.992750013698527e-01   +6.017114911704481e-01   +1.130448332839296e-01; +7.128375905590731e-01   +1.308757154458333e-01   +2.574920937842474e-01   +3.498521046334265e-01   +2.401753161513367e-01   +2.847419559556249e-01   +1.031425779823376e-01   +1.463811972836882e-01   +6.812747923390110e-01   +3.571821024209808e-01   +1.133432461922300e-01   +5.915867161433046e-01   +2.923720684298192e-01   +2.647667984890369e-01   +1.553454612271183e-01   +3.484961429247934e-01; +5.942351828975936e-02   +3.469968479182536e-01   +6.804108080912632e-01   +3.220961505762305e-01   +9.555993701484210e-02   +2.964195835716565e-01   +7.184172235538880e-01   +3.195728200873290e-01   +5.963072532312725e-01   +3.517276876465806e-01   +7.088857936419797e-01   +7.007830137574454e-01   +7.804776248855788e-03   +6.018082542111921e-01   +3.810790199890123e-01   +3.358528413169093e-01; +1.136687550691209e-01   +1.626869149674447e-01   +2.537585484803548e-01   +7.474824899614158e-01   +5.396618385095862e-01   +3.266549082238483e-01   +4.164434791685585e-01   +7.395242713362056e-02   +7.954288073773725e-01   +5.623668188788772e-01   +7.590618074662929e-01   +1.496803120366553e-01   +5.179068721317863e-01   +5.719897992584754e-01   +4.466250138679786e-02   +4.767223734963033e-01; +6.202854533857265e-01   +1.469423304840158e-03   +6.894994210760487e-01   +5.275977969205204e-01   +5.981667495789457e-01   +5.639074997253000e-01   +2.909374691083145e-01   +8.408777121677517e-02   +2.580954465276713e-02   +4.045994027076383e-01   +2.738493542667401e-01   +1.150502553563909e-01   +7.823301870146333e-01   +4.818330296876682e-01   +7.981137403443871e-02   +2.304393175406267e-01; +1.753416825288957e-01   +2.709764151586825e-01   +1.166002281710452e-01   +1.535431669631805e-01   +5.279832091331275e-01   +7.163998223956159e-01   +7.150448899233564e-01   +4.715538497123817e-01   +2.081070963280669e-02   +7.534385251692024e-01   +5.843104034373273e-02   +4.789261988885184e-01   +5.818107118411190e-01   +1.096957692006841e-01   +8.209138265925653e-03   +2.718879245819887e-02; +4.490392395424123e-01   +7.851499363096136e-01   +5.981815710999279e-01   +1.731929412432114e-01   +2.560967929911901e-02   +7.926385830618808e-01   +7.892113833020270e-01   +2.016147239670347e-01   +3.784269004380807e-01   +6.139148702707082e-01   +3.693006145561629e-01   +4.837800780115649e-01   +4.324677984849748e-01   -4.516504046752215e-03   +2.785366692917101e-01   +6.918932387173256e-01; +1.139975264774294e-01   +3.555558523309180e-01   +2.074381448267165e-01   +6.204641277523216e-01   +5.012685915444838e-01   +5.706892144091210e-01   +1.152654039973344e-01   +4.880648021834327e-01   +5.709297434594818e-02   +5.635226069447311e-01   +2.881689476949242e-03   +5.272276455995463e-02   +1.399517242923020e-01   +2.368326441252773e-01   +3.197044811983462e-01   +2.793671161049008e-01; +2.894531081520224e-01   +1.991713542135381e-01   +3.128303748415779e-01   +6.479141788969081e-01   +2.889823955993275e-01   +5.451865457475251e-01   +2.405853424023402e-01   +3.661189169781277e-01   +6.018088077795127e-01   +1.077490273790514e-01   +6.705511728768537e-01   +6.238196360235966e-01   +5.839442048670169e-01   +3.343868871817726e-01   +1.236125306879449e-01   +3.848393678364012e-01; +7.178061411459622e-01   +4.264956998853710e-01   +2.120532508992111e-01   +6.124740280602781e-02   +7.296162971346501e-01   +5.375845095719162e-01   +4.960598353814282e-01   +5.441893481226686e-01   +3.300114866663125e-01   +6.178103532459665e-03   +7.223035577558137e-01   -1.109928924874738e-03   +3.765790452296455e-01   +6.340732688768040e-01   +2.060738437191441e-01   +5.002094698365129e-01; +6.315248448398300e-01   +1.902305513204819e-01   +5.270806087044164e-01   +7.648276483084727e-01   +4.544258773542790e-01   +5.964112553524974e-01   +7.579253897296602e-01   +2.175876948668935e-01   +6.370713667342000e-01   +9.728595743062837e-02   +2.922255785204854e-01   +5.967757387820922e-01   +5.692261679239503e-01   +4.215980569501551e-01   +7.467817907243905e-01   +7.802802970080093e-01; +1.375332747865002e-01   +3.887643909066102e-01   +3.458319738711230e-01   +7.580194845452589e-01   +4.742753283034496e-02   +1.256587663239589e-01   +7.928494795532367e-01   +4.885540831508172e-03   +3.605394682423630e-01   +6.273686411970675e-01   +3.114449581959242e-01   +4.334108031187175e-01   +4.786209882839594e-01   +1.318933616186149e-01   +4.365381316637048e-01   +5.728128065079097e-02; +2.058044808173521e-01   +7.744011969544649e-01   +5.729547009207366e-01   +1.875509953398393e-01   +3.249414024404704e-01   +3.075187500087908e-01   +8.958947719685197e-02   +1.016576496571636e-01   +2.389274800680760e-01   +4.096456201535885e-01   +3.110106184672500e-01   +5.509543252305878e-01   +6.091880450947089e-01   +6.368106537963453e-01   +6.887562657588883e-01   +5.508914410177319e-01];
L2I_L1I_iGABA_netcon = [+8.568915264543656e-02   +1.203922706527191e-01   +6.772940868437006e-01   +7.757609602451736e-01   +1.138636624436769e-01   +1.985326563788014e-01   +3.519650433015789e-01   +5.620368825584370e-01; +2.191901398877067e-01   +3.771290195815365e-02   +6.668366670086570e-01   +1.108963756051270e-01   +6.345499678851962e-01   +7.325213402820766e-01   +7.095630097584856e-01   +5.121982480547354e-01; +7.174310047626553e-01   +5.202228747106207e-01   +3.605173364680634e-01   +9.556287325623147e-02   +6.348204568017105e-02   +5.677128027623324e-01   +6.238602870373567e-01   +7.735042567501650e-01; +4.694289687600573e-01   +2.050196305462082e-01   +4.978205139373972e-01   +5.908163172046067e-01   +2.629105097811152e-01   +5.064115759749069e-01   +2.257614051490758e-01   +1.243258800655724e-02; +4.488777006375243e-01   +4.278264564358349e-01   +3.717525815309567e-02   +3.062809514839996e-01   +6.067588172945918e-01   +7.840119498198689e-01   +2.811962749723704e-01   +6.986264075832298e-01; +2.743165068900282e-01   +8.429222881959035e-02   +6.371189513369585e-01   +3.358083260624343e-01   +3.406593994545293e-01   +3.708889163113464e-01   +2.440193582273154e-01   +6.694349042376330e-01; +5.355559130116333e-01   +6.890568632902373e-01   +6.374538504201911e-02   +5.077630265177441e-02   +5.883595012858449e-01   +3.397459083411899e-01   +2.256208577280111e-01   +6.564069972566230e-01; +7.929286765877075e-01   +4.652778176050321e-01   +1.815306888801305e-01   +4.832767000765236e-01   +3.556712465115190e-01   +3.796476023773100e-01   +4.261572145250764e-04   +1.691208771406846e-01; +9.640392999038881e-02   +3.893843554515833e-01   +8.100951356867128e-02   +7.684099247230874e-01   +7.254975272890682e-01   +7.580483620049221e-01   -4.990711683456661e-03   +6.431397083249085e-01; +5.789749160684550e-01   +7.852531158389338e-01   +3.750792587705658e-02   +3.424083402834307e-01   +7.482991730185183e-01   +7.824667094712729e-01   +3.714093516455992e-01   +2.836779134549903e-01; +1.606605292620810e-01   +4.082716866666110e-01   +2.565355470146292e-01   +5.777795595584899e-01   +7.225442006941088e-02   +3.015711489159878e-01   +1.480014184141193e-01   +2.858514272195357e-01; +2.038779709319299e-01   +1.244659793000366e-01   +5.396122893852423e-01   +5.506742971650309e-01   +1.781711841214619e-01   +5.612703356745381e-01   +2.806947775373636e-01   +5.280689490862854e-01; +2.558572176071626e-01   +3.884418798496110e-01   +6.284431964591362e-01   +2.855767601631894e-01   +5.328482879851848e-01   +7.915696841006752e-02   +1.078089476594289e-01   +1.203052434155603e-03; +7.020848810874756e-01   +1.432308137171177e-01   +8.024922764804748e-01   +7.757985886611836e-01   +7.032192870200122e-01   +2.871017045051690e-01   +5.337837788784831e-01   +2.735390115594357e-01; +5.514375136566546e-01   +7.562146205296790e-03   +7.768929448292285e-02   +5.335537173060787e-01   +5.715767379487829e-01   +5.054558831508115e-01   +6.930795590899107e-01   +7.432326304219580e-01; +7.569140139505949e-01   +2.928306349889169e-01   +5.598360645780756e-01   +5.293324047926177e-01   +1.624648470740859e-01   +4.483207526135839e-01   +6.029578733435541e-01   +5.107558122483852e-02];
L1I_L2I_iGABA_netcon = [+5.980917832979499e-01   +5.387840688954191e-01   +7.360033058016938e-01   +7.028279129708824e-01   +2.185128413227682e-01   +4.852539459002989e-01   +5.113269155331940e-01   +7.227303354932629e-01   +3.450057823099695e-01   +3.831494766554374e-01   +4.651646898240121e-01   +1.796770311948750e-01   +1.695953802795404e-01   +6.895890579380928e-01   +2.397093792074050e-01   +5.367672038312807e-01; +1.634561419488434e-01   +6.176917690760759e-01   +1.745663616630058e-01   +2.082115004005321e-01   +7.842376630044854e-01   +6.278715431365648e-01   +2.171375802796192e-01   +3.165799492050371e-01   +2.430410655021433e-01   +3.115787565896596e-01   +5.187234938622305e-01   +3.346018834065730e-01   +5.866873115700552e-01   +1.940902545846895e-01   +5.558663691287224e-02   +1.575015215766044e-01; +2.554684029730542e-01   +4.533364523019122e-01   +7.744125510630107e-01   +7.046952788157985e-01   +2.491323592013134e-01   +1.965157271258985e-01   +2.215378440581871e-01   +2.528231334665502e-02   +8.494372645246770e-02   +7.936258610248110e-01   +6.462200615665478e-01   +9.409358710294899e-02   +3.502036726088992e-01   +3.950959106975294e-01   +8.066461024028709e-02   +4.524548422134708e-01; +3.680808468623422e-01   +5.276732147887977e-01   +4.401661137821603e-01   +7.407321825184243e-01   +7.851955397166230e-01   +5.185783562496052e-01   +3.765392448367187e-01   +6.375521565661609e-01   +1.078595767869214e-01   +5.321002014123473e-01   +6.577884568354544e-01   +1.582692631971328e-01   +5.502909139013964e-01   +2.696415938467339e-01   +6.145261627313142e-01   +3.394451373046078e-01; +5.762616870630918e-01   +5.614413951739226e-01   +2.270117364793476e-01   +4.240607315320310e-01   +5.595736875252533e-01   +5.025236447897627e-01   +6.436261161964903e-01   +6.902089400732915e-01   +2.858791931314132e-01   +7.075313734150404e-01   +2.337195303907010e-01   +7.969980512394644e-01   +5.273921716298974e-01   +4.267182120573156e-02   +7.783797374760275e-01   +3.956128079819424e-01; +3.977857696363713e-01   +4.135480731748560e-01   +4.888512953780025e-01   +2.105385627673284e-01   +5.051549887502200e-02   +4.598271660174009e-01   +4.382277544952699e-01   +6.094918427957858e-01   +2.860254690093781e-01   +3.472316766087809e-01   +4.206377154671512e-01   +6.677373967566131e-01   +7.034757235022256e-01   +1.724353848620565e-01   +1.300023597323669e-01   +4.749271053853049e-01; +2.300730161106745e-01   +3.445849575953123e-01   +7.536501132485650e-01   +7.748683379718723e-01   +6.324404224346631e-01   +2.924264942949167e-01   +2.221849514600658e-01   +2.742896533193461e-01   +6.229257822325915e-01   +4.404990085091929e-01   +7.588498039574643e-01   +6.832217790171125e-01   +5.260520858243195e-01   +7.853743988243804e-01   +2.417715455859733e-01   +1.491083460837245e-01; +2.476078283651135e-01   +4.050904891354382e-02   +2.316975263900510e-01   +6.858125911308713e-01   +7.516114200313604e-01   +2.005411079539101e-01   +7.409489718832202e-01   +7.102609233284125e-01   +5.801687666438221e-01   +6.743300384907326e-01   +4.414401439980320e-01   +6.092556855848916e-01   +4.406002346592584e-01   +3.162063262247843e-01   +2.455295774077438e-01   +4.338694173322836e-01];
L2E_L1E_iAMPA_netcon = [+3.961884866950360e-01   +1.776079797188355e-01   +7.810051605554005e-02   +2.833051637825404e-01   +3.275625761350920e-02   +3.616288287031196e-01   +4.913554340826856e-01   +3.838680954570274e-01; +5.410055240833962e-01   +7.021288753803785e-01   +8.959986892594185e-02   +3.931721608415896e-01   +3.486872975308062e-01   +2.016284411323553e-01   +4.727993602084108e-01   +1.699513531681432e-01; +3.842307100446237e-01   +1.841127269187352e-01   +4.822044626871301e-01   +7.355853790113172e-01   +4.138669629667716e-02   +2.004208417033492e-01   +7.421763027360236e-01   +2.683543331310358e-01; +3.436182679350142e-01   +6.504307141115290e-01   +3.128455934625220e-01   +3.055181519433302e-01   +1.207830281699362e-01   +6.928262860419948e-01   +7.852998789487566e-01   +2.450008907311310e-01; +1.568460492777423e-01   +1.860869599264658e-02   +4.807479094697066e-01   +3.381393716799714e-01   +2.643865339551512e-01   +6.845296612029719e-01   +8.942039073762212e-03   +6.089207326648403e-01; +6.236280719976867e-04   +6.882823432069736e-01   +1.948651056028103e-01   +6.231721761552081e-01   +4.673764502536940e-02   +1.833743845340965e-01   +5.985327277651158e-01   +7.530728170046311e-01; +2.824615392741309e-01   +2.165799312507407e-01   +5.025866560774579e-01   +4.110353208401830e-01   +5.250036421222013e-01   +2.092322997995980e-01   +7.875012309993478e-01   +1.629228296513953e-01; +1.433543281055177e-01   +7.785406924624745e-01   +5.877058423513382e-01   +1.399942249726714e-01   +4.609690407976704e-01   +3.614012334302201e-01   +5.500298081881273e-01   +6.090255244778674e-01; +1.979714676944927e-01   +5.960429805055617e-01   +6.584308482064053e-01   +7.527982446993505e-01   +9.485552522230270e-02   +5.190935202543937e-01   +4.055732370621480e-01   +3.268199615009729e-01; +8.177239979449054e-02   +2.811428558191380e-01   +2.254000592383853e-01   +2.548016964246582e-01   +7.087007923184021e-01   +2.057770455978241e-01   +3.480006430483187e-01   +6.761660594733205e-01; +1.514531918831757e-01   +1.456742051756468e-01   +1.419380220940200e-01   +7.382790930239755e-01   +4.457031616801259e-01   +4.039983752369680e-01   +1.465308255715268e-01   +2.542870550725270e-01; +6.134528082002771e-01   +5.595577067374601e-01   +2.541538455236668e-01   +1.678401816464357e-01   +2.318512914375191e-01   +2.023006934745928e-01   +4.425209134609116e-01   +5.391288406476111e-01; +1.257016552905701e-01   +6.208730909061407e-01   +3.941092379668099e-01   +7.103836975381422e-01   +5.724680284179371e-02   +2.697412144239003e-01   +5.058801119602773e-01   +1.194069741931519e-02; +4.647913037996629e-01   +2.061332332508340e-01   +4.451534522369331e-02   +5.042732011138060e-01   +1.493428126483772e-01   +5.353377194734230e-01   +1.103987037464554e-01   +7.451271326797617e-01; +6.792799911986478e-01   +6.938585825238236e-01   +1.941498830958228e-01   +5.109725946921211e-01   +1.783212843747566e-01   +4.609067197952257e-01   +7.644504162144649e-01   +4.790555205682092e-01; +2.848422395464872e-01   +2.783639050701979e-01   +3.839979413806998e-01   +8.883220771687880e-02   +2.713383595955793e-01   +4.977839700029830e-01   +8.153192274838156e-02   +1.498647241862443e-01];
L1E_L2E_iAMPA_netcon = [+2.754563136779942e-01   +7.500790636083713e-01   +2.748696183819758e-01   +1.830336050466399e-01   +5.930509815737953e-02   +1.241446284633750e-01   +7.062583981474915e-01   +2.351326630003767e-01   +4.233423265774074e-01   +7.309453085208852e-02   +2.667398319420627e-01   +7.324767635843470e-01   +5.715974015256621e-01   +5.852291756351267e-01   +6.718433222038294e-01   +1.140926926259779e-01; +4.366285379094705e-01   +5.402990241739186e-01   +2.904430064282918e-01   +5.404841230459629e-01   +4.447129333921253e-01   +1.514376408957022e-01   +6.601380039638745e-02   +7.595974142486311e-01   +2.819702061186070e-02   +4.902062064294515e-01   +8.504349261632257e-02   +5.515600415006055e-02   +6.942859681265762e-01   +3.360477528167128e-01   +3.306409134581795e-01   +6.109982473343856e-01; +4.885656072192267e-01   +2.426476780554024e-01   +4.790744986414385e-01   +4.483078281647516e-01   +4.466565074470157e-01   +2.750440995769952e-01   +6.845266948209240e-01   +6.043154395882682e-01   +1.345505218005242e-01   +5.865999705804896e-01   +5.599286667190682e-01   +2.131623630365562e-01   +1.222935273103809e-02   +5.328815432816206e-01   +4.027937448515230e-01   +3.165023194891691e-01; +5.291685207736676e-01   +2.636429595096468e-02   +4.967025873926311e-01   +7.543556172547332e-03   +3.895727519737748e-01   +1.593541064473772e-01   +1.975947510122980e-02   +2.938301072103458e-01   +5.223930625702224e-02   +2.862103441078335e-01   +6.093810426147559e-01   +1.365028889824545e-01   +4.863129658766580e-01   +2.645891376261895e-01   +7.905693424857563e-01   +6.688071220617771e-01; +2.141727997350473e-01   +3.100579061759315e-01   +6.616122456054233e-01   +6.541891983725048e-01   +4.218829039572506e-02   +2.909746048189190e-01   +5.938333132368797e-01   +7.757911957663953e-01   +2.664907022851803e-01   +7.452634174139643e-01   +7.638510624014849e-01   +8.045557408716066e-01   +3.655499762224092e-01   +1.123425350366322e-01   +4.247442093125192e-01   +2.399893798287030e-01; +4.261823397377023e-01   +2.599191977719080e-01   +2.148861610663821e-01   +4.154771042192181e-01   +2.646271527441831e-01   +1.875062488896994e-01   +2.195262032730919e-01   +2.049080216460368e-02   +1.376160284399713e-01   +5.097329950405755e-01   +7.501051438529620e-01   +6.892894393307183e-01   +5.761402690335959e-02   +5.074052753169145e-01   +6.815070649982655e-01   +5.023966279769209e-01; +3.166444183437588e-02   +4.738991949526509e-01   +7.234833192534795e-01   +3.643845030898081e-01   +1.237253150908281e-01   +4.011862936792160e-01   +4.382679321047775e-01   +5.975023446182995e-01   +2.857270111274209e-02   +2.444259945917463e-01   +6.566502221345863e-01   +7.305465466886275e-01   +4.786239276077561e-01   +7.330303615070859e-01   +5.586230409506938e-01   +1.678753778400130e-01; +5.853033579714959e-01   +6.635735211272435e-02   +8.929541576018754e-02   +2.586838973650223e-01   +4.031850471571218e-01   +6.452772414623242e-01   +7.967189346826077e-01   +6.649104901856000e-01   +4.772733758804801e-01   +4.000871168953435e-01   +3.491568788687709e-01   +6.084182381878462e-01   +1.098899469037288e-01   +5.773629781891590e-01   +5.320610726330857e-01   +7.693066175798938e-01];
L2I_L2E_iAMPA_netcon = [+4.024166128159807e-01   +6.282336023519124e-01   +6.588988018812011e-01   +4.864162330577358e-01   +3.897282032275820e-01   +2.719556374274343e-01   +2.800682094789013e-01   +2.518711246839936e-01; +7.686854357450905e-01   +6.736832404682840e-01   +7.214596022896195e-01   +3.492377783033938e-01   +5.414458657096159e-01   +7.695879423733997e-01   +4.685749581467638e-01   +3.498037115655436e-01; +7.861910958628656e-01   +7.455214248784442e-02   +5.179033989705185e-01   +7.200663712995228e-01   +4.211325490836030e-01   +4.579416609409853e-01   +1.221832193355943e-01   +1.293213625697119e-01; +2.764678166817000e-03   +5.776224221566092e-02   +1.504460976374605e-01   +2.319871831691022e-01   +7.654638420257033e-03   +1.388379190152823e-01   +4.318285935917757e-01   +3.358745277361819e-01; +1.847477737477380e-01   +4.606069112284284e-01   +2.665153891399097e-01   +4.846884959747465e-01   +5.995653962848714e-01   +1.892096699129071e-01   +1.521908688740875e-01   +7.109565320198035e-01; +2.695918624775131e-02   +6.809362243745357e-01   +6.978152911994595e-01   +7.462814860678647e-01   +5.405300191002208e-01   +4.296808927804863e-01   +2.480361286518091e-01   +6.652415002831410e-01; +2.049869980422719e-01   +4.506952905137198e-01   +3.377368604903264e-01   +1.669949577703283e-01   +7.193885293345740e-01   +2.510014742115857e-01   +7.507202354453449e-01   +7.476630961160471e-01; +3.736763241670490e-01   +4.448811765436129e-01   +5.971058112186203e-01   +4.495320169407688e-01   +6.854335201196970e-01   +3.161729521759927e-01   +1.780889911650750e-01   +5.973281698317877e-01];
L2E_L2I_iGABA_netcon = [+7.699175821372919e-01   +2.307972227943505e-01   +7.743956578220587e-01   +9.317732317614336e-03   +6.805494509281098e-01   +1.776301253193129e-01   +6.532116700489797e-01   +5.640182892323438e-01; +8.054931614318677e-01   +1.977017543155337e-01   +2.594627518660230e-01   +3.889300990163312e-01   +2.475735668375724e-01   +4.637615645450398e-01   +7.213799037848158e-01   +1.282802309967515e-01; +1.254834787171042e-01   +6.446073725477166e-01   +4.942611025524336e-01   +4.889907829410461e-01   +7.343021002256084e-02   +5.106838276206189e-01   +5.570305760112654e-01   +5.628236180305629e-01; +4.776204869504414e-01   +6.599276707394089e-01   +2.489278273346086e-02   +6.010378085214296e-02   +5.070874955494028e-01   +1.655329367760641e-01   +1.664564086308856e-02   +5.081083174493262e-01; +3.038027154961311e-01   +7.497328380252136e-01   +3.554517914003287e-01   +3.470186753189320e-01   +6.917890508692399e-01   +2.460891361310612e-01   +4.633186393696688e-01   +6.804793350522070e-01; +7.040951591953498e-01   +2.119830574854679e-01   +3.077171892139851e-01   +7.249781396771419e-01   +2.437164796786025e-01   +4.531210235943243e-01   +6.833559554766030e-01   +2.868516454369442e-01; +7.964440846465090e-01   +4.567353081069019e-01   +1.105009222547683e-01   +5.598947990632486e-01   +3.011012209435760e-01   +3.429716467388562e-01   +7.496487732294759e-01   +7.269375609763440e-01; +2.302737353279734e-01   +4.939398887345740e-01   +3.385942524526327e-01   +7.536615925820789e-01   +7.910451102593485e-01   +7.229000815162344e-01   +1.506805696218004e-01   +6.354024614456984e-02];
L3E_L2E_iAMPA_netcon = [+3.887465658349366e-01   +6.268011425038611e-01   +2.498240910382067e-01   +6.752277177395898e-01   +7.916974619277934e-01   +8.511721111303686e-02   +5.662729552479507e-01   +1.949198118833618e-01   +3.292653685282165e-01   +6.624720327046618e-01   +6.023518762149823e-01   +3.809638622673965e-01; +7.498261572689359e-01   +2.947776854950566e-01   +5.427031004562654e-01   +5.985335777301214e-01   +5.585365464083492e-02   +1.825846088138504e-01   +1.102322781618992e-01   +4.797693035778241e-01   +1.705678415641024e-01   +4.437941758869960e-01   +4.910388968789421e-01   +1.170787132883845e-01; +4.005251863214063e-01   +9.355180856960603e-02   +3.370246507745783e-01   +6.939492121671001e-01   +2.916159283185922e-01   +4.886937905772745e-01   +7.519490872295785e-01   +5.751475890306061e-01   +3.583082365959978e-01   +2.331070218185937e-01   +4.436700715335433e-01   +1.795320058919895e-01; +5.187602010871750e-02   +5.178718007335399e-01   +2.277275491968425e-01   +4.552562218781932e-01   +4.029353372694084e-01   +4.488256487152917e-02   +1.229713363800421e-01   +5.112233432191035e-01   +5.048950058549077e-01   +6.077730457041592e-01   +5.860065526504348e-01   +7.146305682101703e-01; +3.868130421630803e-03   +3.450828316146505e-01   +5.235514282186283e-02   +4.594849651587893e-01   +2.941489945736909e-01   +6.647323604956084e-01   +8.437589645787992e-02   +6.465002172236616e-01   +6.223461407519265e-01   +1.584654058215142e-01   +7.414611136446649e-01   +1.370906623215911e-02; +2.425933661741117e-02   +3.478846156055010e-01   +5.826968766537903e-01   +7.297848339846993e-01   +5.233526954500689e-01   +5.423191619286171e-01   +2.926593811736649e-01   +3.652010283606941e-01   +5.461045295601249e-02   +4.979996174395980e-01   +1.734264610717828e-02   +3.805036587604068e-02; +3.216346391028101e-02   +7.606924328967567e-01   +6.936668606478036e-01   +6.760248879954891e-01   +5.399375146137849e-01   +4.324872953089220e-01   +5.550861331405819e-01   +9.811512216743225e-02   +6.131564316889551e-01   +5.786127155142686e-01   +4.256745637333798e-01   +2.080164202268031e-01; +2.583082386244597e-01   +2.083285337492382e-01   +7.608443084783655e-01   +5.849351519279851e-01   +6.163591676423131e-01   +1.242994266544107e-01   +5.868688090851372e-01   +4.492538118514987e-01   +4.985327039295389e-01   +5.580172278446637e-02   +3.590674115057806e-02   +5.567805005194015e-01];
L3I_L2I_iGABA_netcon = [+7.055549071585671e-01   +7.748946294198217e-01   +3.604170508032280e-01   +7.788225415093563e-01   +6.791595374732173e-01   +1.842095904406580e-01   +3.421951430025326e-01   +8.033126425751312e-02   +4.088613391861970e-01   +7.698345793353822e-01   +9.005716972162078e-02   +7.738524532045645e-01; +6.214320519813261e-02   +2.342245309179627e-01   +7.415271758787146e-01   +4.114780004853655e-01   +5.479241677625083e-01   +5.673638012505755e-02   +7.940754719369161e-01   +2.203254218394075e-02   +1.773282413786267e-01   +7.737198247205009e-01   +7.270200178313788e-01   +2.042149073639002e-01; +7.994664323110057e-01   +1.900198645765153e-01   +1.663605882580497e-01   +7.701295695103092e-01   +4.358554420107990e-01   +6.195810243652088e-01   +2.454817275329710e-01   +4.439941734951279e-01   +5.202939482188712e-01   +2.892841044140034e-01   +5.529999423883540e-01   +2.274476729285764e-01; +7.587313230778009e-01   +4.708495435356771e-01   +4.772303557778906e-01   +7.360588222527799e-01   +2.747437897690240e-02   +5.477043428078238e-01   +5.540311243802793e-01   +4.371667569039484e-01   +1.826208530579450e-01   +6.554707898945806e-01   +5.703845809177939e-01   +2.091909274125703e-01; +5.229789355648885e-01   +1.849794969353353e-01   +6.818530901925985e-01   +3.378528695649694e-01   +7.673405868385288e-01   +5.924427558621155e-01   +5.897167796931888e-01   -1.492471417682033e-03   +1.569239321280783e-01   +1.803362416883041e-01   +2.045445548572578e-01   +2.257876278613143e-01; +3.378399241137358e-01   +1.635174827765925e-01   +4.735988717767871e-01   +7.894107634411517e-02   +6.148571656197315e-01   +2.363366724327891e-01   +7.680024620851958e-01   +1.838065699874726e-01   +4.470029156656056e-01   +7.168706564106860e-01   +6.628810004841751e-01   +6.615167124686513e-01; +7.096482483737790e-01   +4.935163519961224e-01   +5.321186669266009e-01   +7.112984692519772e-01   +7.857825437253350e-01   +2.401748920327790e-01   +6.562423843125870e-01   +5.293898264673791e-01   +2.311860079257038e-01   +1.287035271454667e-02   +2.559710907163124e-02   +6.196823384526523e-01; +6.717842320734270e-01   +7.758508110823236e-01   +6.553845055338352e-01   +7.714168847077092e-01   +3.266488432365196e-01   +1.976286309686184e-02   +5.874242443361355e-01   +4.449056286227447e-01   +1.766252789139043e-01   +6.666681870675688e-01   +3.063395058678202e-01   +5.448755760788043e-02];
L2E_L3E_iAMPA_netcon = [+7.534206940695582e-01   +7.074235043672142e-01   +7.693984844597238e-01   +4.950348577199465e-01   +5.358061422622882e-01   +5.455479356516172e-01   +4.539443932107117e-01   +7.966722066246165e-02; +3.627899996855114e-01   +3.455472384877920e-01   +4.167254344540380e-01   +4.777735968707794e-01   +5.143762106218747e-01   +1.973681263500451e-01   +8.496101752817938e-02   +6.298610253961920e-01; +9.580901844893529e-02   +8.047441484843710e-01   +7.049067081238315e-01   +4.066548469713500e-01   +1.368262892073506e-01   +2.792772339898406e-01   +7.983043314303768e-01   +8.634622359917278e-02; +6.656002165215978e-01   +5.182671806732759e-01   +5.243858094036509e-01   +5.238064975314444e-01   +6.937340925139538e-01   +4.425877338104806e-01   +1.256292189634768e-01   +1.610537471322211e-01; +6.700959059495367e-01   +4.234757615529352e-01   +4.740622585800551e-01   +6.098374108094015e-02   +5.131234594911237e-01   +6.665485654991914e-01   +5.444949796217186e-01   +7.394884525858073e-01; +3.153632854361928e-02   +6.432430116841185e-02   +5.214349150583600e-01   +4.364576176431269e-01   +5.879045787012462e-01   +4.823570321381143e-01   +4.631499246091654e-01   +5.201251399842507e-02; +4.285124697437556e-01   +4.017714743194468e-01   +5.668534744209187e-01   +1.108166102883258e-01   +8.005190611477563e-01   +4.694826472861561e-01   +1.685679412117887e-01   +4.030076921948416e-01; +7.772736890908004e-01   +6.633712820906658e-01   +2.868117855637985e-01   +7.029645020091523e-01   +1.433952301182698e-01   +7.918495677055984e-01   +6.660360467374961e-01   +4.607271612218508e-01; +7.968752265647963e-01   +5.833211219536028e-01   +4.820424685567029e-01   +5.416403244458045e-01   +2.822729830771697e-01   +4.159503820378392e-01   +7.324214544575627e-01   +3.112121469454646e-01; +2.959526034987881e-02   +6.519819086792116e-01   +5.261333954551787e-01   +2.547087114487511e-01   +7.770766570182459e-01   +5.024139417435374e-01   +3.405614599888601e-01   +3.088226928467819e-01; +4.524459148802090e-02   +3.925545331024328e-01   +4.456602783920544e-01   +6.500641082231533e-01   +5.932274422505289e-01   +7.530096865758997e-01   +2.680515923319627e-01   +6.546797133776373e-02; +3.411993621991628e-01   +6.812456910920602e-01   +6.144115464636176e-01   +1.373498502074545e-01   +7.123730239178392e-01   +5.050521018082073e-02   +5.925813133865199e-01   +5.114881867745613e-03];
L2I_L3I_iGABA_netcon = [+1.371386087787888e-01   +4.369051421159845e-01   +6.963401607812196e-01   +6.102041562777475e-01   +3.799690717787746e-01   +1.352033454385640e-01   +8.194757230877901e-02   +5.905222691438240e-01; +1.292766189026557e-01   +7.619342833320275e-01   +3.859883753503691e-01   +2.942141431536761e-01   +4.405162541828562e-01   +7.740092565062219e-01   +2.327784392053667e-01   +5.033764118925101e-01; +6.918357258825640e-01   +4.872401116149310e-01   +7.483621264718234e-01   +6.163932051541600e-03   +4.726066470372531e-01   +4.569917805757731e-01   +3.690404232548603e-01   +1.045553064356683e-01; +6.510622571032216e-01   +7.905801523180536e-01   +7.254507190783009e-01   +4.464649972718582e-02   +7.771636565938319e-01   +4.304246031789056e-01   +6.893615239797056e-01   +1.449857405011296e-01; +1.533791851974242e-01   +1.621828849528869e-01   +1.396492486316940e-02   +2.229279486993946e-01   +7.721584597260783e-01   +1.324443099713674e-02   +6.353968620874469e-02   +2.748689188756989e-01; +1.316833137727289e-01   +7.061075945600267e-01   +2.537545338344714e-01   +2.562248732445549e-01   +2.001320882876289e-01   +2.734426751915309e-01   +3.386045789785219e-02   +3.710312688070305e-01; +4.864537426208448e-01   +4.644349480096254e-01   +4.724382775318099e-01   +3.064900709741761e-01   +4.816877104728232e-02   +2.466044759643566e-01   +6.649918425306327e-01   +7.268063284125756e-01; +6.078409998780420e-01   +1.692580490656546e-02   +3.862590570314832e-01   +6.009219448753639e-01   +8.593746844157626e-02   +6.725295708841232e-01   +1.402418973212325e-02   +2.251122630116922e-01; +6.708597591537483e-01   +4.146373318901729e-01   +7.686803647989863e-01   +3.092938222907597e-01   +6.867520057565393e-01   +7.700365600375341e-01   +5.710214290885042e-01   +3.725299601679924e-02; +5.374849199853926e-01   +5.784073433808582e-01   +4.492115529687984e-01   +6.850694229456541e-01   +6.302832893961959e-01   +7.655821628992786e-01   +6.251655789888039e-01   +2.906342252804290e-01; +7.060842066632688e-01   +3.798316043145276e-01   +4.757473766568502e-01   +1.835436823041001e-01   +4.547491430040693e-01   +3.249764885669952e-01   +2.252585257832080e-01   +3.328328902986238e-01; +3.055379032611704e-01   +7.582916876098241e-01   +7.291956991696381e-01   +1.321411947456725e-01   +2.017881564160805e-01   +7.847415792460493e-01   +5.853056392537325e-01   +5.921736616088337e-01];
L3I_L3E_iAMPA_netcon = [+2.500749304602768e-01   +3.832261938856875e-01   +7.995360563220482e-01   +1.470913488421109e-01   +7.359767937972945e-01   +7.100988112097245e-01   +6.079656370705117e-01   +2.581142598992361e-01   +2.822504078003980e-03   +4.589298391199972e-01   +4.878950995795961e-01   +7.110459015482269e-02; +6.052588152267482e-01   +2.365351539249503e-02   +3.861596309554594e-01   +4.347374023202921e-01   +5.802495307418687e-01   +4.933825612324454e-02   +7.939950017056888e-01   +9.408654192104655e-02   +3.725435062728513e-01   +5.238495718029165e-02   +6.922781529842702e-01   +2.698359794406225e-01; +4.609838589431438e-01   +7.158546904157363e-01   +2.888928318398433e-01   +5.818506753339183e-01   +3.489527437951362e-01   +8.789154586439700e-02   +1.329014049359481e-01   +6.029655149016521e-01   +6.951764442601547e-01   +7.553236750311803e-01   +5.679595817157064e-01   +2.233938660840075e-01; +7.403886287293004e-01   +3.337302460437375e-01   +6.838428556440117e-01   +6.859331202919539e-01   +2.078587037235495e-01   +6.641481595738770e-01   +4.831993945517627e-02   +1.799132395316773e-01   +7.866662609975850e-02   +6.739750439138229e-01   +2.351717244099207e-01   +2.775601575513134e-01; +6.301991753048832e-01   +2.409044096774454e-01   +7.118405568045075e-01   +6.828923879850596e-01   +7.940171863257259e-01   +1.900150568363325e-01   +2.844722762396191e-01   +3.019467920989762e-01   +4.027323245332361e-01   +5.413072492208644e-01   +3.437328397889766e-01   +8.324184414726768e-02; +2.851600002789981e-02   +7.733260131529311e-02   +2.818353431975079e-01   +6.939491427971227e-02   +9.895644876406155e-02   +9.147127417911882e-02   +1.966891734555855e-01   +3.996366597472439e-01   +3.407014228600727e-01   +3.513897594728578e-01   +5.966812780243573e-01   +6.665341598868690e-01; +1.453888776153874e-01   +4.150089034894193e-01   +3.157738704349050e-01   +7.120215978633013e-01   +1.694577957539170e-01   +6.939971279248508e-01   +2.196671640307139e-01   +6.977014396662397e-01   +2.127941857548522e-02   +2.731859114245566e-01   +1.253801463283694e-01   +5.710758067165320e-01; +3.974330700446612e-01   +3.165813574531285e-01   +4.008429512463635e-01   +4.271582064049882e-01   +4.268242930152022e-01   +1.179415788078421e-01   +7.171839199328777e-01   +3.634585311958667e-01   +6.262874767896176e-01   +7.252689054933611e-01   +7.388730783007547e-01   +2.716910389044731e-01; +3.822022361469802e-01   +4.293735702120166e-01   +1.030637719336911e-01   +2.643917746353008e-01   +6.701670842474936e-01   +1.941925303351370e-01   +6.878573823645668e-01   +4.029663718344680e-01   +7.116405810015949e-01   +1.724556698680615e-01   +1.310304619383780e-01   +4.669743419378287e-01; +2.058716537738993e-01   +1.227614689088927e-01   +2.089165110467358e-01   +6.294605582913545e-01   +1.831099813669483e-01   +2.563150933874893e-01   +6.320853166357955e-02   +4.719977881744347e-02   +6.885693463826691e-01   +2.195523928031905e-02   +4.717493922679642e-01   +3.974751722356456e-01; +7.100339519242993e-01   +4.020238295969863e-01   +7.844195828041053e-01   +3.289773211824609e-01   +7.932665653974053e-01   +5.340707247295320e-01   +5.279561454065352e-01   +4.351142842287305e-01   +4.497761581567751e-01   +4.195717272580474e-01   +7.252165585130140e-01   +6.147343257170705e-01; +4.571113831720156e-01   +5.684732497849376e-01   +3.990509310102587e-01   +2.438516299881177e-01   +4.814552743121225e-01   +1.608577825772467e-01   +6.371962145704362e-01   +1.668302739570487e-01   +5.767064308663806e-01   +7.899300520417659e-01   +6.216631961512886e-01   +4.181847241116537e-01];
L3E_L3I_iGABA_netcon = [+5.770668173692104e-01   +3.002028426425803e-01   +5.800823799765228e-01   +7.077803029115466e-01   +7.404407350273081e-01   +6.509306553211838e-01   +4.094504328903033e-01   +5.095490159987974e-01   +7.406982817338144e-01   +7.589519835534638e-01   +5.745171763527555e-01   +5.384629968022376e-01; +2.969547410472916e-01   +3.736719490965851e-01   +7.674075399589283e-01   +6.420835509994881e-02   +1.317436146829048e-01   +6.196277912261389e-01   +5.314047883202278e-01   +5.411500993401365e-01   +2.961744404212322e-01   +2.881476841990335e-01   +6.950711064355689e-02   +2.203528327166095e-01; +4.950590138583522e-01   +1.758410143954442e-01   +2.373381969582333e-01   +7.262940008765674e-01   +7.854526550415336e-01   +7.846446068472771e-01   +2.393798654716644e-01   +7.111616329790648e-01   +7.036731732592909e-01   +4.556426826902665e-02   +5.959847237553651e-02   +3.214911013422713e-01; +4.132943366287921e-01   +4.113587505423130e-02   +4.162804307459590e-01   +5.724207331000900e-01   +3.931537570492644e-01   +7.631971741212200e-01   +2.853082187287469e-01   +7.731022772895384e-01   +7.721146204393680e-01   +6.373753542869793e-01   +2.740676422685950e-01   +1.959027885885410e-01; +6.507164868757455e-01   +3.473182522727523e-01   +1.241453190565454e-01   +2.699166832009893e-01   +2.096031442742984e-01   +6.368491920674023e-01   +2.354272663587804e-02   +3.981458270248568e-01   +7.334280786695206e-01   +3.092228729674384e-01   +6.852139006850858e-01   +6.583858314773955e-01; +4.315070730431695e-01   +3.903416627841451e-01   +6.169386020877294e-01   +4.233203373796378e-01   +6.482221929769881e-01   +6.856304326073768e-01   +1.653278313488242e-01   +6.666432719109784e-01   +1.331861259560299e-01   +7.147301882254129e-01   +3.891148815661940e-01   +3.749864151150369e-01; +6.081067315709335e-01   +2.590756515519990e-01   +2.196248891309545e-01   +3.404641112647757e-02   +3.453881658242118e-01   +4.771047336020722e-01   +6.690081527689162e-01   +4.667089777292985e-01   +2.123248638658041e-01   +3.654708313542985e-01   +4.648830488965570e-01   +6.071140069651905e-01; +4.684861187128961e-01   +6.182887547793772e-01   +6.816604140605915e-01   +6.110658322346505e-01   +7.803760836381320e-01   +3.424998466387648e-01   +4.027105606756528e-01   +6.457607895653745e-01   +6.844135177072566e-01   +5.321682717531304e-01   +4.481623456347918e-01   +4.308400792781676e-01; +7.226299630415404e-01   +1.302907465175583e-01   +1.199625998500857e-02   +6.108917725009840e-01   +5.575163271842594e-03   +7.279548506045705e-02   +5.723148403121213e-01   +2.331105664535670e-01   +6.502667835812999e-01   +3.109659751243092e-01   +5.031030108365656e-01   +1.181836478806950e-01; +2.234489641109070e-01   +5.982062491515209e-01   +5.672574966117342e-01   +5.429955824460757e-01   +2.121551415685878e-01   +3.677608071510189e-01   +1.387663043236460e-01   +1.865320416410519e-01   +7.565880800181900e-01   +6.858116491511647e-01   +8.214598569647567e-02   +6.460152079348840e-02; +4.775626726034981e-01   +7.765741836638084e-01   +3.232110548798272e-01   +1.412872832513551e-01   +6.723018397874525e-01   +3.659370424634951e-01   +2.347340577631253e-01   +6.473962407351570e-01   +2.083552838442026e-01   +2.061724674939928e-01   +1.975245144028835e-01   +4.462692759943183e-01; +3.395733041642076e-01   +3.101077492586351e-01   +5.247184809477704e-01   +6.395389750802145e-01   +2.893911036481162e-01   +5.191138560971119e-01   +3.493028601749278e-02   +5.787959861076589e-01   +3.102764703326293e-01   +3.539948119762716e-01   +5.221199419214253e-01   +2.664370195084993e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last =  5.6 * ones(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  5.6 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 10*((exp(-10*((t)-( 50))^2)));
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = -10*((exp(-10*((t)-( 50))^2)));
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 10*((exp(-10*((t)-( 50))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = -10*((exp(-10*((t)-( 50))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
