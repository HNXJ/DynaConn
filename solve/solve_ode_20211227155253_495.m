function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+4.769022351512361e-02   +7.209298702962416e-02   +7.760231579559117e-02   -4.122690056602497e-02   +3.922209725090963e-02   +7.561666052865117e-03   +2.014840754043086e-02   +1.020194072732137e-02   +2.971466605839494e-02   +3.806917657591648e-02   +8.914575654738278e-02   +8.828382308745220e-02   -1.730748745230284e-02   +4.018196309683202e-02   +1.157320516079069e-01   -2.053019538947824e-02; +2.305275071674197e-03   -3.388637133877902e-02   +2.663554235408034e-02   +1.645559242602351e-01   +7.369456788165847e-02   +4.846831159966009e-02   +2.997615143706453e-02   +1.100254250391997e-04   +8.056138051179719e-02   +7.960887854813211e-03   +4.630940590069244e-02   +4.862479996696808e-02   +9.560294585901799e-02   +6.160040837215460e-02   +9.527730081117333e-03   +5.660798883310651e-02; +3.880499580585781e-02   +5.438713805357945e-02   +5.023029903216028e-02   -2.935138954410341e-02   -3.584545885323143e-02   +3.701754398165443e-02   +2.183830604067920e-02   -3.020683288782633e-03   +6.125289560272620e-02   +7.741353655323516e-02   -5.182890734383368e-02   +6.099109021432804e-02   -1.817614245159013e-02   +3.644608739335388e-02   +4.092366981935375e-02   +6.374757594168751e-02; +5.458331811817342e-03   +1.080315949781886e-01   +8.395161729901193e-02   +8.579481342754905e-02   +5.307006747406118e-02   +1.996891627750198e-02   +2.953021649131387e-02   +8.004771667329647e-02   +3.618704704188813e-02   +5.032285235189828e-02   -4.300902382680926e-02   -4.003607477198290e-02   +8.371009355478722e-02   -6.723812195017376e-02   +7.837819062377473e-02   +6.707981574463051e-02; +5.108334712724515e-02   +5.557441051537764e-02   +1.187135826943528e-01   +5.146491213566630e-02   +2.925550441185327e-02   +3.765626812069432e-02   +2.268097907362787e-02   +9.544711441468519e-02   -1.237793370984497e-02   +2.624625564800850e-02   -1.442752930132432e-02   +1.280016558324379e-03   +6.489241318060540e-02   +1.899156370219630e-02   +5.587243565891225e-02   +9.392472071449293e-02; +5.506406053438449e-02   +4.235579550310992e-02   -3.713672860251466e-02   +4.155786345983972e-02   +3.734078556837370e-02   -9.002714109836505e-03   +9.331218504764539e-02   -1.032757869896000e-02   +3.587640230490929e-02   +1.590547758758716e-02   +1.367393959451885e-01   +1.240217624625884e-01   -6.300084970529667e-02   -1.600688758856545e-03   +9.577604537129603e-03   +2.923702442814584e-02; -4.769834917541779e-02   -2.173946066724887e-02   +5.546981548048485e-02   +9.658897609301832e-02   +6.394074070477868e-02   -3.207035158341500e-02   +6.309681434611968e-02   -2.513572517487572e-02   +1.338376806742877e-01   +3.534692860365667e-02   -1.717668353437855e-02   +3.410024911865914e-02   +3.632059176062276e-02   +8.443928272346957e-02   +4.574981260873416e-02   +7.769895217942104e-02; +2.658722182811610e-03   +4.769534848075997e-02   +2.582574440116915e-02   +3.514158537069531e-02   +1.311608937772348e-03   +1.151933933473020e-01   +5.905102512402324e-02   +2.398991898175549e-03   -4.540428929943807e-02   +4.816765097298592e-03   +1.060362515452731e-01   +2.460731025544132e-02   +3.462664283922771e-02   -7.080754338968388e-03   +5.452022009462576e-03   -2.866765297651246e-02; +3.335172458823919e-02   -1.520240794442352e-02   +4.589148002984953e-02   +5.136291468165182e-02   +6.748984897113505e-02   -1.373631101251914e-02   +3.560559826623370e-03   +4.267502137735187e-03   +1.922910513898939e-02   -2.713778414119383e-02   +1.031554596341130e-01   +2.774450126258671e-02   +3.532064172254186e-02   +2.763214526446330e-02   +2.392650624360492e-03   +6.653397672803742e-02; +3.955568127666793e-02   +7.137951140989381e-02   +2.450748979844643e-02   +7.390731425625685e-02   +5.762521067053408e-02   +1.160946447752886e-01   -1.123512761429356e-02   +3.827522830475719e-02   -9.046358612704013e-03   +8.556904012674196e-02   +7.078216905798328e-02   +5.792795724973111e-02   +1.374523477168121e-01   +4.664989870188319e-02   +4.357521416687883e-02   +1.303494877738556e-02; +2.709265107311124e-02   +3.377674310620852e-02   +4.580461393006637e-02   +1.122820324315206e-02   +2.966280373434428e-02   +1.357787102398639e-01   +8.398993147389082e-03   +3.284364807163661e-02   +6.181076861962515e-02   +3.417137403723982e-02   -2.744254190607630e-02   +5.646116605792637e-02   +1.143519487000982e-01   +6.309835928827779e-03   +2.928121989132942e-02   +4.089882503874423e-02; +2.063879199050765e-02   +6.089904049297818e-02   +1.537823535952839e-02   +7.634477377491158e-02   -3.591713003617185e-03   -4.355584813138938e-02   +5.980703688749463e-02   +1.001446571593635e-01   +1.088447970594312e-01   -1.585350393441437e-02   +6.500330730774578e-02   +2.979321652431302e-02   +4.543902317304417e-02   +8.292734179584872e-02   +7.560867741917192e-02   +9.552854240902127e-02; +1.244404688046177e-01   +7.086262283763159e-02   +5.122027517456185e-02   +2.175466238456946e-02   +3.918081314961176e-02   +8.227674192555347e-03   +4.314704029814961e-02   -4.405558891059085e-03   +2.414628447341005e-02   +7.569446356048611e-02   +1.251009776945086e-01   -3.667619736797370e-03   +3.250438731297219e-02   +1.062496735346355e-02   +7.802475200612247e-02   -1.994906570721637e-02; +8.527572799917084e-02   -6.351511658815711e-03   +2.199642523018977e-02   +1.303069196007537e-01   +7.734178700296461e-02   +4.132594608641069e-02   +8.662635886589695e-02   -3.571747681423898e-03   +5.593059791877870e-02   +4.954449673626404e-02   +7.266515893181610e-02   +1.019446872330499e-01   +8.415286263893408e-02   +8.200699560491989e-02   +9.041119649354187e-02   +1.073387699752117e-01; +5.703565270238690e-02   +6.547693368456496e-02   +8.212336834289155e-02   +7.465740684931677e-02   +9.648323071837946e-02   -4.418561717916899e-02   +5.621641964148558e-02   +7.763745640453094e-02   +9.397613432641615e-02   +6.124264833446933e-02   +6.120184058923750e-02   -6.446982702964028e-02   +8.619056848546781e-02   +4.814904121238965e-02   +2.712034024570186e-03   +4.518439052560944e-02; +7.682543610038252e-02   -6.546968873952170e-03   +4.453651031956148e-02   -1.016302452949309e-02   +9.776970879484308e-02   +9.245367697983597e-02   +5.724141813357171e-02   +3.511200409488160e-02   +5.550079796532131e-02   +3.431716037881069e-02   +7.417995681835826e-02   +1.496519733332710e-03   +7.091370675331894e-02   +3.625079896334962e-02   +5.089879740523148e-02   +1.068025167421015e-01];
L1E_L1I_iGABA_netcon = [+4.249347075551453e-02   +1.188945635992446e-01   +6.079082365686740e-02   +9.887286460989336e-02   +1.243455652183424e-02   +6.163681706692831e-02   +3.039809303407810e-02   +3.306239553199080e-02   +9.677766343517932e-02   -2.001385676367440e-02   +4.487524198536506e-02   +4.471242138303898e-02   +2.272063332056000e-02   +6.732282994362480e-02   +6.151700890158935e-02   +9.906114098530931e-02; +3.572291767509916e-02   -1.989018437158475e-03   +6.814989777245206e-02   +8.816245759275462e-03   -3.765630586181478e-02   +3.589894952446759e-02   +4.225062986018420e-02   +4.424791960838080e-02   +1.238486473932851e-02   -5.770625240379704e-02   +7.388502059414209e-02   +3.165883757984544e-02   +6.677769251747767e-02   +4.251125006907338e-02   +4.385669880421583e-02   +7.500249118149871e-02; -1.037159430347477e-02   +8.684536319708357e-02   -2.346101227324206e-02   -2.573637017113645e-02   -4.583447914841448e-02   -2.341177497594056e-02   +9.277598158011167e-02   +3.154016925609239e-02   -3.214947687690443e-02   +1.556580792094633e-02   +5.387660163352846e-02   +7.717735048715620e-02   +4.186120353419140e-02   +3.897385878108258e-02   +4.488731864905478e-02   +4.103144342243610e-02; +5.646092275648438e-02   +8.397421524935052e-02   +7.697897087008257e-02   -2.960413301981758e-02   +3.501242524193617e-02   +1.352022665751519e-01   +5.721267122214008e-03   +5.423744000564577e-02   +1.975120940689304e-02   +1.003629853123150e-01   +8.339979991145395e-02   +9.194546100469861e-02   +6.035521467655977e-02   +4.072966847803432e-02   +4.182718770013404e-02   +5.255067771443596e-02; +5.092980917110878e-02   +6.717309717995916e-02   +8.785716663145172e-02   +1.147190629944909e-01   +7.041364768132637e-02   +6.190298162232401e-02   +4.245301099870614e-02   +4.507058305553004e-02   +7.922995854352108e-02   +3.063635426716003e-02   +8.780801325522457e-02   +3.105902716231834e-02   +9.519447241541058e-03   -2.384761471038489e-02   +6.424778658665083e-02   +5.886608856686115e-02; +1.168832979662166e-01   +2.268741174437173e-02   +2.426927483055192e-02   +8.153661970018976e-02   +3.480413989979209e-02   +7.511039318665817e-03   -7.125167472296016e-03   +1.993055916660134e-03   +1.635398016252196e-01   +6.565490647632274e-02   +6.542349993086725e-02   -2.511088337342147e-02   +9.132240432175165e-02   -5.294227671561589e-02   +3.423331656406362e-02   +1.126742866148364e-02; +9.918065856652137e-03   +6.076353248862646e-02   +8.029187117191590e-02   +5.512910230886239e-02   +2.269125727098738e-02   +1.676076270400053e-02   +8.658251560475262e-02   +1.832458714958312e-02   +2.159581209466515e-02   +6.221582560549126e-02   -6.703767522304152e-04   +1.017051098470797e-01   +5.623416430698069e-02   +5.934642517748034e-03   +3.990074998962254e-02   +3.009971281046446e-02; -3.994356397885960e-03   +9.095184269627000e-02   +2.197155087662127e-02   +6.386557519763870e-02   +2.850639424961600e-02   -9.009288281020550e-03   +1.571159122604626e-02   -6.794082699946820e-02   +9.409252738664553e-02   +5.201340061312774e-02   -8.776975882005274e-03   -8.918185026567724e-03   +1.218989074543812e-02   +6.856501881480617e-02   -2.579462592818421e-02   +1.612181551895895e-01; +5.412389068545152e-03   +8.690918875202806e-02   +8.315613358861654e-02   -7.673087773596132e-03   +2.389687213788277e-02   +8.030153677432757e-04   -1.629120941430226e-02   +5.957402751110315e-03   +2.659288910253644e-02   -2.054347728246740e-04   +5.036728767225494e-02   +2.207616606139545e-02   +2.523167337947427e-02   +9.099650087057530e-02   +5.699682743783850e-02   +6.715178743815728e-02; +4.742942811855255e-02   +9.267307313431430e-02   -2.598254472685924e-02   +1.853704283922644e-02   +3.730376493083429e-02   +3.747499934753118e-02   +1.041492793575599e-01   +2.126381113284894e-02   +7.056735533763499e-02   +2.152152526250018e-03   +6.485749682518298e-02   +5.213510908483209e-02   +3.082541389773491e-02   +9.218306449315794e-02   +8.055590889344978e-02   +6.063735686343860e-02; +3.260316660048967e-02   +6.741106733956996e-02   +1.442954314328609e-02   +5.082996248136303e-02   +4.948277655389396e-02   +1.183364006747216e-01   +4.459631469077233e-02   +3.291841817839206e-02   +5.078819971587221e-02   +5.245001460563448e-02   +2.687426501568795e-02   +8.016148322620659e-02   +7.424453583592882e-03   +3.057892068836503e-02   -2.227479280951837e-02   +7.709972198033366e-02; +3.035153337426712e-02   +2.240752266914731e-02   +2.829869631269016e-02   +6.951212523766666e-02   +3.804943956621872e-02   +3.370513158719376e-02   +5.324903064095977e-02   +5.845148872192069e-02   -4.027896937685052e-02   +8.651006260570461e-02   +6.459891862357051e-02   -4.515004483192549e-02   +3.054918803359522e-02   +6.836363180110523e-02   +6.492942977473098e-02   +7.862512368391793e-02; +3.544332142300131e-02   +4.476511386471534e-02   +1.043218258844422e-01   +1.200245455691419e-02   +2.533628094253105e-02   -2.604824178004497e-02   +1.864265380043748e-02   +7.294123076906384e-02   +6.990455803252496e-02   +7.639927476529833e-02   +4.528391849271024e-02   -1.302541589052702e-02   +4.331902818345372e-02   +5.087292535912191e-02   +6.909687575637588e-02   +1.233681131011714e-02; +1.572106818770830e-02   +6.636971525258362e-02   +3.341588261806551e-02   +5.018169230950793e-03   +6.642497352014465e-02   -3.301097667927412e-02   +3.937106746885156e-02   +3.030874066567383e-02   +3.447354471043410e-02   +1.031352170994562e-01   -3.356358625474186e-02   +5.686918797079672e-02   +7.778603505210899e-02   +9.268439835755866e-02   -5.377084150033590e-02   -1.236482372363002e-02; +6.886338601236434e-02   -3.898999970775557e-03   -1.487764796433137e-03   +3.206683910197759e-02   +1.678861317199867e-02   +4.004350805197692e-02   +6.237550958014483e-02   +2.176285036888229e-02   +9.101955933750745e-02   +7.234128972278565e-02   +5.832193142127912e-02   +8.984161894880451e-02   -4.876800146592634e-02   +8.238664978842134e-04   +6.052357044547524e-02   +9.282842498730644e-02; +2.824804122055108e-02   +2.229773318957107e-02   +3.581666944259317e-02   -3.312215363948924e-02   +3.681443671981018e-02   +1.132357759624038e-01   -4.074004353827667e-02   +2.409619824477665e-02   +1.011288751079272e-01   +4.945962798841508e-02   +9.706165802189476e-02   +5.117131828142689e-03   +1.443157238488480e-02   +1.497091067318927e-01   +3.427260084835907e-03   -5.778979612027070e-03];
L2I_L1I_iGABA_netcon = [+1.512735146963127e-02   +4.203807576062686e-02   +1.193790075612405e-02   +6.189119551168779e-02   +4.581515158620378e-02   +1.622057663688648e-02   +5.034328546589648e-02   +6.583124928235652e-02; +3.179452352210577e-02   +3.109968895006827e-02   +5.223859571856337e-02   +7.590717415487884e-02   -3.129093635965627e-02   +5.317345027855833e-02   +6.741291638403699e-02   +4.274290346847048e-02; -1.888430656663896e-02   -7.721709426686918e-03   +1.153276037488831e-01   +4.786828869541535e-02   +6.060242978688574e-02   +3.082665483925472e-02   +7.053103246029079e-02   +5.369725862859372e-02; +7.006182483853424e-02   +8.678523871189489e-02   +6.066053039331176e-02   +3.609818446465030e-02   +7.397629787800761e-02   +1.679303216000763e-02   +4.571067264988370e-02   +1.243854249056073e-01; +5.285832839701222e-02   +6.304579330374877e-02   -3.187076771863240e-02   -3.219127071416243e-02   +5.821447399957193e-02   +5.267745000883585e-02   -1.001701266545527e-02   +2.269797981737509e-02; +1.356798879404398e-02   +8.812431027811519e-02   +9.892916882297892e-02   +2.094306818725897e-02   +6.847884970001368e-02   +5.590965362146100e-02   +4.984286337674262e-02   +7.033814044994497e-03; +5.896084576643661e-02   +6.566942611010519e-02   -5.739624016216888e-02   +5.154158964058372e-02   +3.136458108652616e-02   -3.939641224306198e-02   +8.185968995258551e-03   +4.508373600879881e-02; +5.714417963674279e-03   +6.313526521236974e-02   -1.530296345848230e-02   +1.410607003760070e-01   +4.532786850315176e-02   +1.905542650612456e-03   +5.694516168819766e-02   +3.080881159683570e-02; +3.417667303899844e-02   +9.020244844772785e-02   +3.197800126824961e-02   +1.052428818450256e-01   +6.943419296242725e-02   +5.065861051947471e-02   +9.599294244688891e-02   +1.225284086818771e-02; +3.913120287326071e-02   +6.078858192103501e-02   -8.521333655910783e-03   +5.187118650180092e-02   +8.024350772119379e-02   -5.034813520143307e-02   -2.157581858378529e-02   +2.053715054086734e-03; +5.097250363442885e-02   +7.996552431047535e-02   +6.416561923703357e-02   +7.029419008276852e-02   +4.684376374492408e-02   -6.655622168613425e-03   +6.649373210558927e-02   +3.651642728132663e-02; +5.822974494141574e-02   +2.851279454333893e-02   -1.869446051434309e-02   +6.122933758288819e-02   +1.059359965303386e-01   +8.920597682061952e-02   +9.592122179704723e-03   +4.179482768187208e-02; +2.973591473662314e-02   -3.315311493633548e-02   -1.648699369540320e-02   +9.471626318308404e-02   +7.290184414813314e-02   +1.092969467837010e-01   -2.433474727230950e-02   -4.761934562369174e-03; -4.475145129575569e-02   +2.236437924626664e-02   +4.579221803670763e-02   -4.215879352951429e-02   +6.821913121907079e-02   +5.151239200976292e-02   +5.953343662113330e-02   +8.972898905369113e-02; -3.135145429385936e-02   +3.017818009436721e-02   +6.119869659261142e-02   +8.357237259554670e-02   +4.320051081791007e-02   +6.894082090793116e-02   +9.199859803125852e-02   +6.950722007426707e-02; +3.064869161801206e-02   +8.524671061732721e-02   -1.474388936743315e-03   +6.248932469681322e-02   +5.448832537683666e-02   +4.475800538411923e-02   +2.868631207256307e-02   +1.071327630902774e-02];
L1I_L2I_iGABA_netcon = [-2.397066613454154e-02   +2.460139976362828e-02   -3.481964882752110e-02   -2.457814512442941e-02   +1.157686791685426e-01   +5.330452011334836e-02   +3.727747279851673e-02   +9.413330738332173e-02   +5.328428300046179e-02   +7.504900612903412e-02   +4.750990724109216e-02   +3.696338947187375e-02   +6.763837326070784e-03   +5.187511120905809e-02   +1.490981393815677e-02   -3.804106238038240e-02; +1.003160441233718e-01   +3.906645611484176e-02   +4.535670184032296e-02   -1.211673702257626e-03   +2.159111426962293e-02   +4.464121961572525e-02   +9.226107253202556e-02   +9.907699255534634e-02   +8.426995243198210e-02   +7.459082612287360e-02   +5.002543240678180e-02   -6.134044396845249e-03   +9.546093381526523e-02   +3.134492565619032e-04   -8.194643097499215e-03   +4.385914741487968e-02; +7.344811466347975e-02   +6.867127790562920e-02   +9.614638185743744e-02   +2.514284034917096e-03   +9.257845110205885e-02   -2.052774247788605e-02   +5.288870492424579e-02   +3.816747036949499e-02   -1.608074119385581e-02   +1.185288496445091e-01   +5.466918666891148e-02   +5.891792910382208e-02   +1.225672760365254e-01   -3.759947835372073e-02   +2.786875278201833e-02   +3.170546541315281e-02; +2.807655037659709e-02   +7.292968358870230e-02   +5.157497788183255e-02   -4.554116696260550e-02   +3.495420302956916e-02   +6.147490394628417e-02   +5.740400092501097e-02   +5.043226579525904e-02   +5.274224152008615e-03   +8.078587592587916e-02   +9.159588090165174e-02   -2.027016160361816e-02   +7.831041106059959e-02   +2.012278005062806e-02   +4.798256150491544e-02   +1.046244393645893e-01; +5.194237007589501e-02   +6.576919338879142e-02   +1.105737487020949e-01   +2.753338140542428e-02   +1.189202213584470e-01   +9.131408992830353e-02   +8.900308480204984e-03   +3.964206813333947e-02   +6.084606725881318e-02   +3.880763358047686e-02   +5.135291879628055e-02   +5.703430451225545e-03   +4.788703062636918e-02   +2.589466450075934e-02   +9.077876598328867e-02   +6.312064185809986e-02; +2.040581347557389e-02   +6.244573859193638e-02   -3.624235970204011e-02   +9.786591046941107e-02   +8.486602363593290e-02   +3.573138387993696e-02   +8.225196566432764e-03   +4.195188111131663e-02   +1.613107561280926e-02   +3.505336038697984e-02   +6.813277580447202e-02   +3.541355533504791e-02   -3.092987379357075e-02   +3.997292463608770e-02   +3.119022830351287e-02   +1.352688757875726e-01; +4.308456079861496e-03   +2.507639361870200e-02   +1.156179802553749e-01   +5.274128671295998e-02   +2.183926429695613e-02   +1.139308622307971e-01   +4.524775939182460e-02   +2.897307320294022e-02   +2.597769275648909e-02   +9.324181737897073e-02   +5.326943541545270e-02   +3.564724064800587e-02   +3.801480765625558e-02   +3.456661894775396e-03   +4.377958937370779e-02   +2.310621667486498e-02; +4.756184991937035e-02   +3.498692008604418e-02   +6.867961132389554e-02   +5.238975745936555e-02   +2.094944032653292e-02   +9.647299567283803e-02   +5.964220203557187e-02   -3.100813374229382e-02   +1.178503697938287e-01   +4.005091295718587e-02   +1.291570383137983e-01   +1.281627143999894e-02   +1.046902565726610e-02   +1.942942326577825e-02   +3.313134336773938e-02   -2.989359961143232e-02];
L2E_L1E_iAMPA_netcon = [-4.348416173413946e-03   +7.817982013863009e-02   +1.025676817353427e-01   +1.107940108161773e-01   +2.384260650882394e-02   -4.288078659581885e-03   +5.539850407216405e-02   +1.140643258056799e-02; -1.434905153012889e-02   +3.731302644117956e-02   +8.577382903215992e-02   -3.361438785749485e-02   +6.909672447140856e-02   -2.469260743812828e-02   +3.185455884917120e-02   -1.618054582476442e-02; -1.219634438681490e-02   +1.688016544133626e-02   +7.415386660720177e-02   +8.539980370314446e-02   +2.276304593151474e-02   +6.989121711646641e-02   +1.092044057962004e-01   -8.670289422433527e-03; +1.011057362905249e-01   +5.909767672104163e-03   -4.070322300827500e-03   +6.807512877747529e-02   +1.100289299235014e-02   +6.530029567523449e-02   +4.416964345317990e-02   -2.237010501478418e-02; +1.003563125841999e-01   +1.003144652401360e-01   +2.586062104827280e-02   +2.698438072051669e-02   +5.875373834478376e-02   +8.096781656390249e-02   +2.875191564434613e-02   -3.713948738721820e-02; +7.119763602305948e-02   +4.456958015252518e-02   +2.262749454387922e-02   +6.194998604259281e-02   +9.873046589413445e-03   +1.040362566744432e-01   +7.561477811971747e-02   +5.926300331877671e-02; -1.620234243889524e-02   +9.927189406439207e-02   +2.257987963726181e-02   +6.532368743404028e-02   +2.743200526290646e-03   +1.080547481448262e-01   +4.806480693415117e-02   +1.056201238109286e-01; +5.075834594232716e-02   +1.271002089404535e-01   +8.776172184323884e-02   +8.141266320593697e-02   +8.740325234516566e-02   +3.129780003632811e-02   +5.973999312140642e-02   +6.134154060732513e-02; +8.147587490050730e-02   +1.927422334732810e-02   +6.739998064806077e-03   +7.952907511754005e-02   +1.163199087740304e-01   +3.576240765972345e-02   +6.895896032262894e-02   +7.290030234948412e-02; -2.906950871333107e-02   +9.864200890847775e-02   +8.835247269344967e-02   +5.349288626512473e-02   +9.522290089130077e-02   +2.068410349338203e-02   -2.430804836251956e-02   +2.918572256925424e-02; +3.315846907996814e-02   +8.121605384055335e-02   -2.408314817099149e-02   +2.121553262239750e-02   +2.504053789412442e-02   +6.362724643776603e-02   +9.915271963247882e-02   -2.954778233557892e-02; +4.634756298771041e-02   +5.921727600124310e-02   +4.073120996179695e-02   +2.554039297672409e-02   +7.727013370356038e-02   +1.311907984484482e-01   +3.220810370963565e-02   +1.022891516403945e-01; +2.616393006211392e-02   +8.524627398370119e-02   +1.043332467957740e-01   +1.064638222556105e-03   +8.577014757509427e-02   -3.159519571615848e-02   +1.030640236744151e-01   +7.592633801369680e-02; +7.110281797237734e-02   +3.003376479106201e-02   +4.093418234509762e-02   +5.803050579381211e-02   +3.169279435866612e-02   +4.185288537509198e-02   +6.272515621590928e-02   +7.838657149656450e-02; +6.426834773867689e-02   +1.110579283666609e-01   -3.283548444160073e-02   -1.017740770686868e-02   +4.688079522209822e-02   +4.435048614120365e-02   +6.723982575182899e-02   +5.338194084612734e-02; +5.965547252109829e-02   +5.520866248023168e-02   +8.127991613382000e-02   +1.048595022201040e-02   +4.321401479928595e-02   -2.214175115840767e-02   +1.049646326359984e-01   +1.608388668946161e-02];
L1E_L2E_iAMPA_netcon = [-2.655634483448590e-02   +5.642925090224876e-02   +8.161216338778410e-02   +3.877458829291363e-02   +4.604049419213729e-02   +5.675523149340373e-02   +4.754376916462284e-02   +9.004729873901225e-02   +9.908464460737663e-02   -8.156370721699542e-03   +9.739368024209746e-02   -2.357302810343684e-02   +5.071561259896638e-02   +3.604874152501039e-03   +6.322311926643040e-02   +1.018699253259790e-01; +7.064162628710652e-02   +4.557410536329672e-02   +4.209576541375572e-02   +3.825185562004173e-02   +3.218848083414248e-02   +5.951734863975165e-02   +1.571495631353861e-02   -2.429566953242044e-02   +2.880699304888946e-03   -6.631397761947931e-02   -3.327530059372659e-02   +1.489793688437819e-03   +4.170256304273313e-02   -1.059867100603807e-02   -3.481583048634425e-03   +4.591826977292696e-02; +2.742182522643734e-02   +4.633472843498020e-02   +7.565598455418124e-02   +4.243482801174012e-02   +3.473867984949705e-02   +4.301093087585857e-02   -5.401949165806130e-02   +6.351266159725212e-02   +2.648135668705479e-02   +1.027864484905050e-03   -9.723785721925424e-03   +4.515992153729105e-02   -1.619084269708541e-02   +1.275997187993492e-02   +6.746004567122624e-02   +5.979973130130287e-02; +5.527325529624977e-02   +3.143795074706567e-02   -2.059492695138148e-02   +1.176605323414372e-01   -2.491469588716451e-02   +3.916067601168567e-03   -1.378876897812374e-02   +4.591333668792119e-02   +1.057998271206386e-01   +1.339672330460157e-01   +1.503968857020687e-02   +1.354348522164494e-02   +4.559459769137894e-02   +1.049957858119813e-02   +6.518302388087321e-02   +1.205780581109204e-01; +6.680035559959627e-02   +4.006568424978209e-02   -9.692066964437815e-03   +2.418543001219890e-04   +1.002091832100828e-01   +1.337495270080123e-01   +1.270645584154889e-01   +5.846944030700939e-02   +6.392757127466696e-03   +1.329673226832634e-02   +1.748658590016239e-01   +4.249541806047546e-02   +2.462726460239115e-02   +8.233400288079479e-02   +3.861787072984884e-02   +3.418681878705646e-02; +5.084633238369986e-02   +2.296628849661708e-02   +6.175254871289129e-03   +2.725383607291902e-02   +2.319729517790352e-02   +7.535585099389648e-03   +2.397937985316213e-02   +6.194578646396260e-02   +9.983471615340449e-02   +5.213168398615829e-02   +2.775009229652302e-02   -3.485341354480620e-02   +7.983904499470648e-02   +6.066663841077672e-02   +4.861617701048047e-02   +6.553448534729393e-02; +5.141292461238257e-02   -1.158053806471738e-02   +1.611628587599904e-02   +3.572546011107881e-02   +5.417758929196591e-02   -4.807623985515284e-02   +3.947291521021443e-02   +3.925151423242514e-02   +1.775925700357689e-02   +4.195189303075034e-02   +4.027168659249820e-02   +1.030830499393030e-02   +5.188696248192824e-02   +3.918048349105466e-02   +9.179803626742487e-02   +5.082950934278099e-02; +5.360183117908736e-03   -3.352865428651088e-02   +9.588308419359699e-02   +7.556161578750856e-02   +4.857015867300749e-02   +5.342220139855656e-02   +5.145022620014213e-02   -3.023444001208959e-02   -4.114462633935178e-03   +7.727494820812414e-02   +9.780269840186563e-02   +1.743166393482228e-02   +4.921079422044596e-02   +1.016629695514072e-02   +8.037118261780243e-02   +5.052054898973445e-02];
L2I_L2E_iAMPA_netcon = [+1.573949655884395e-02   +2.317732175613533e-02   -2.429345359940962e-02   -1.152395223986711e-02   +8.441273046613204e-02   +7.498846359549161e-02   -8.010067162185375e-03   +5.769550529969148e-02; -7.954725065564952e-03   +7.766283770004033e-02   +9.688075080707026e-02   -3.204760943579198e-02   +1.938574490221103e-02   +6.135276971447995e-02   +2.381881050521390e-02   +4.373893486776625e-03; +1.848814346499506e-02   +6.845270185049775e-02   -3.382165440156359e-02   +1.052826106199241e-02   +7.063135321424177e-02   +7.104185300584941e-02   +6.454748679326433e-02   -3.533871874572133e-03; +1.293312251640008e-02   +7.910054732472775e-02   +6.425685771879404e-02   +4.314442770988704e-02   +6.718412027848950e-02   +5.837975112938937e-02   +3.216464040681837e-02   +3.519710442345091e-02; +7.130908718288671e-02   +1.047170033518408e-01   +4.603633245716010e-02   -5.446448216617044e-03   +1.496958376375240e-02   +6.474704008436051e-02   +3.245283458041695e-02   +1.075903674138893e-01; +9.451641678303452e-03   +2.950315839474559e-02   +1.057995385238905e-01   +9.199885261599035e-03   +7.517017426655903e-02   +3.703795435968203e-02   +1.757228310982975e-02   -9.277845102592507e-03; -5.761457836037931e-04   +1.994603822215899e-02   +9.823014791237195e-02   +5.827985681069196e-02   -3.929216630607891e-02   +5.278516355535372e-02   -9.256948561689692e-03   +9.736377740190916e-02; +1.027165000099758e-02   +3.415338400931341e-02   +1.173891199299512e-01   +6.958797201263267e-02   +8.362216532412094e-02   +5.393874328402434e-02   +6.560252821010576e-02   +3.343588598998760e-02];
L2E_L2I_iGABA_netcon = [+5.250486856397563e-02   +5.024463397058252e-02   +2.934913787668663e-02   -5.332299353844510e-03   +4.882184601284151e-02   +1.107615744598564e-01   +6.121515513880341e-02   -1.832354536389647e-02; +1.217310786633185e-01   +3.437742320205536e-04   -1.434294787195042e-04   +8.738072893273519e-02   -1.055533970212193e-03   +1.251090807778053e-02   +1.844774423641667e-02   +7.185428314950687e-02; +1.865738835797692e-02   +8.134343736173694e-02   +7.857372488258431e-02   +3.083017717219967e-02   +1.060548385655731e-02   +1.020806998405365e-01   +1.820413145353018e-03   +2.894443070924264e-02; +2.718689402436706e-02   +5.550351462409363e-02   +2.892083337262961e-02   +2.576119222576082e-02   +5.949736958270235e-02   +1.327784126664155e-01   +1.849570102021157e-03   +5.803651987129229e-02; +5.999424984954535e-02   +6.798574151607675e-02   +7.549704577846872e-02   -4.351802226115383e-03   +1.083583955549361e-02   +7.662306101396224e-03   +9.851222808989588e-02   +2.235379884913515e-02; +7.042637553673987e-02   +2.918221298799362e-02   +3.391090499209342e-02   +2.220074969898740e-02   +3.854112821302710e-02   +9.169375587305496e-02   +8.045563582643994e-02   -3.694515897291673e-02; +5.177054385688296e-02   +9.968793983053221e-03   +2.181456759020677e-02   +5.981880666539098e-02   +7.051924846980037e-02   +1.411407396985680e-03   +4.043406375968525e-02   -3.491140832441726e-02; +2.643047758131467e-03   +1.823145753367498e-02   +8.408700655812701e-03   +4.711033810215015e-04   +4.384159022335724e-02   +6.644318810728503e-02   +3.244392051329578e-02   +3.211661548206658e-02];
L3E_L2E_iAMPA_netcon = [-7.554453092913537e-03   +2.429047015022534e-02   +5.692676209829939e-03   +3.256645205159285e-02   +4.905787221173781e-02   +4.055687956299322e-02   +1.098268406599001e-01   +4.505751482752735e-02   +1.370789209467985e-02   +8.816045667797626e-02   +6.450079700422240e-02   +4.346022936616031e-02; +2.735653251619995e-03   +8.524992690625455e-02   +6.371541734642068e-02   -3.168918885594482e-03   +4.223404472048579e-02   +8.864483154768119e-02   +4.382554833621440e-02   -2.771583983497494e-02   +4.195852374383634e-02   -8.090808620545944e-03   +8.786530790035001e-02   +5.748914572263309e-02; +6.777207813042649e-02   +1.005995141763382e-01   +5.060201935342590e-02   +2.213684329685955e-02   +1.750668121426541e-02   +1.426198378626839e-02   +8.703209444473187e-02   +1.598163809146446e-02   +3.336496231345676e-02   +7.153460116145878e-02   +6.960678961946640e-02   +2.009719903239534e-02; -1.415765616048143e-02   +7.355895879604420e-02   +7.215312475061951e-02   +1.747409270186475e-02   +4.526047044208655e-02   +3.809248461218698e-02   +5.825214607883061e-03   +4.011030115828230e-02   -4.841330647151403e-02   +6.830084630965841e-02   +6.641893857403224e-02   -2.801947871715208e-02; +5.367073267346130e-03   +6.130364135647128e-02   +1.129339070564842e-01   +8.097239581302726e-02   +5.905124175200427e-02   +9.460510355024558e-02   +4.109826570367285e-02   +5.195609692483722e-02   +1.027014983043195e-03   +2.133153162776796e-02   +6.459911311347405e-02   +2.826032857893754e-02; +4.563989441896117e-02   +2.366106767549475e-02   -4.468977780744450e-03   +7.748793218414730e-02   +8.306469481588830e-02   -5.633554611527687e-03   +8.694891947308683e-02   +8.930325055179515e-02   +7.711599911074798e-02   +3.870316538778737e-02   +3.892697787670283e-02   -3.579964300967520e-02; +6.719426456090213e-02   +4.443638439389004e-02   +5.244128697063550e-02   +1.622067298538958e-02   -2.440854731331069e-02   +5.670036569124758e-02   +1.566600609592092e-02   +2.760501569161561e-02   +3.083561625661102e-02   +3.644284283422444e-02   +9.434596784587217e-02   +9.650994468996706e-02; +2.585064956974475e-02   +8.074037840098938e-02   +6.945127243844623e-02   +6.239526193371926e-02   +3.711961469660627e-02   +4.658495989520926e-02   -3.785616155742992e-02   -1.838961270357303e-02   +1.946409270447211e-02   -3.384943958954104e-02   +9.028096014367758e-03   +6.180500652895096e-03];
L3I_L2I_iGABA_netcon = [+9.239833459812888e-02   +6.703927221218285e-02   -1.944963333004503e-02   +7.940981903933289e-02   +2.372902282580930e-02   +4.326316736489586e-02   +7.327089238284801e-02   +2.727883250143915e-02   +1.455249655034915e-02   +8.840181915207452e-03   +9.758122720584558e-02   -4.810733072477074e-03; +1.865453174029947e-02   +5.661342658574552e-02   +4.946944519160226e-02   +4.291327854507441e-02   +1.833559692083728e-02   +6.296956373473143e-02   +6.619329329730099e-02   +1.315328163116619e-02   -5.036493420170018e-02   +9.190723653616889e-02   +6.912490615413733e-02   -5.546020140227577e-02; +7.996697707619366e-02   +1.059912634837767e-01   +7.762185245647887e-02   +4.906019633059022e-02   +1.120855618820709e-01   +7.120265264175152e-02   +4.855758038182819e-02   +5.999232217528561e-04   +1.399376620884246e-01   +1.011225138417204e-02   +9.213946294290945e-02   +6.539931914058490e-02; +1.327036605682052e-02   +7.660306817180547e-02   +9.634389308846472e-02   -9.878059223518941e-05   +8.978146810091303e-02   +2.144182682856249e-02   -2.413355318278194e-02   +2.782477506009212e-02   +9.348283263329493e-02   +4.481408929860312e-02   -5.130207777186067e-02   +1.009621932468196e-01; +3.592989610310954e-02   +5.682446094792681e-02   +9.924494753095259e-02   +6.287453489033437e-02   +9.323545343294264e-02   +2.795123836506382e-03   +2.222919484630699e-02   +1.207431760146186e-01   +1.633808946706588e-02   -2.155876659014151e-02   -7.328962985133230e-03   +6.372210744684707e-02; +6.291963992843531e-02   +6.769370535516700e-02   +8.013367280402250e-02   +4.474153398866282e-02   +4.625602482484878e-02   +7.566786497089309e-02   +5.104289278051197e-02   +7.170558552753238e-02   -1.781417995874588e-02   +3.878140235003660e-02   +7.909746500174807e-02   +1.231478161356393e-02; +3.837616866115376e-02   +3.643370745407619e-02   +5.489152186973842e-02   +6.800255366196653e-02   +2.751540292662907e-02   +4.841529920531264e-02   +2.060528159751957e-03   +2.364735257246804e-02   +1.991561427185549e-02   +3.062351606629557e-02   +1.088306265756437e-01   +9.668324665753372e-02; +2.430853144836692e-02   +8.429863509246918e-03   +7.966983328598190e-02   -6.343200136505810e-02   +8.370464176173284e-02   +6.790168772225635e-02   +8.320259064891979e-02   +8.902778207824336e-02   +3.259877909692981e-02   +8.481196876250771e-02   -5.172975097382659e-03   +5.528148896923267e-02];
L2E_L3E_iAMPA_netcon = [+1.189354646932591e-01   +5.450155161496943e-02   +1.008511825137179e-01   +1.696835627803467e-02   -2.439717681492628e-02   +8.926859048851643e-02   +1.316828967594338e-02   -3.619579561480934e-03; +4.523203359046728e-02   +1.117086292693450e-01   +7.176630960279240e-02   -3.096771316411376e-03   +1.152179371801702e-01   +4.542984173331105e-02   +1.922137516602984e-02   +4.724505956812776e-02; +4.217561782158015e-03   +3.873477906959366e-02   +3.709064328085924e-02   +4.393403588292419e-02   +4.893108889202546e-02   +8.445786738351017e-02   +7.976356118415459e-02   +4.341703202500093e-02; +2.313548882259711e-02   -1.809986200361150e-02   +8.266590051143496e-03   +1.162532715711097e-01   +5.612517067127301e-02   +1.113529676771182e-01   +4.395560907802422e-02   +4.106854272849608e-02; +5.898651879536183e-02   +9.106815840758642e-02   +9.387785271680059e-02   +1.840899458149164e-02   +1.201423108024130e-01   -1.720860211657271e-02   +5.456713216179427e-02   -2.864207190529814e-02; +8.031113395915352e-03   +1.202033077460583e-01   +3.075970683346663e-02   +1.445692805305156e-02   +1.216581526174279e-01   +7.517307991865475e-03   +4.730885752444425e-02   +3.990430757406455e-02; +5.348353502610579e-02   +8.622391577584491e-03   +2.882080261810506e-03   -1.333814309745068e-02   +5.592107988152827e-02   +2.742185771751281e-02   +6.449383507641966e-04   +8.258751253630583e-02; +1.297944518605386e-02   -3.225276326700485e-02   -2.684201602428279e-02   +2.375389610917104e-02   +1.006672883281904e-01   -2.070343947975706e-02   +3.290091880673292e-03   +4.728328701688382e-02; +8.158396037458154e-02   +8.739274478719666e-02   +9.212480927049450e-03   +7.047788453732248e-02   +2.854027119851190e-03   -7.895864184784373e-04   +7.116778729586626e-02   +9.121810137701546e-02; +2.376028589214092e-03   +8.121425617460567e-03   +4.477477885024395e-02   +5.154660724023764e-02   -4.957277034794803e-02   +9.069241410185279e-03   +6.951131578938423e-03   +3.928105927913247e-02; +5.099832591922143e-02   +2.416170976720957e-02   +5.499185036188139e-02   +8.568387937713995e-02   +9.603160509246995e-03   +4.602256355109045e-03   +9.029853989778467e-04   +4.075216634091123e-02; +3.716268309704194e-02   +5.087594169523410e-02   +7.811486009381245e-02   +5.573291324575827e-02   +4.591556351112619e-02   -5.991109234425182e-03   +2.269029309398480e-02   +6.626012161360362e-02];
L2I_L3I_iGABA_netcon = [-8.122580914869362e-03   +1.272221988146141e-02   +5.642947926533010e-02   +4.978069975563273e-02   +6.557802647778492e-02   +3.739231881271218e-02   -2.087877722941422e-02   +4.901152458484546e-02; +2.874428756107568e-02   +9.061058429476641e-02   -8.583630684162652e-03   +8.471968087951967e-02   -6.235195318648593e-02   +6.260257579751509e-02   +3.697282260123109e-02   +3.647732934711272e-02; +2.496040804408075e-03   +1.113878498376520e-01   +7.460923136838436e-02   +7.809438482497186e-02   -3.232922774124517e-03   +3.136889651806656e-02   +4.244083068766034e-02   +8.356792677412231e-02; +4.070036834989264e-02   +7.903608570317976e-03   +6.643496532436173e-02   +8.063106026165637e-02   +2.758315312740147e-02   +9.340239303893482e-03   +4.337908719011292e-02   +6.253215829150303e-02; +7.809587540429599e-02   +1.169068099629166e-01   +1.065267026876187e-01   +3.476870601399561e-02   +1.388744601246808e-02   +3.826779391365820e-02   +5.834883056749514e-02   +2.330137835316486e-02; +6.276052576458108e-02   +6.062971635877580e-02   +1.894444268189213e-02   +8.393989675878116e-02   +2.552687957715736e-02   -1.846237658581238e-03   +6.208361047300127e-02   +4.405961998411132e-02; +5.163244438605849e-02   +5.858214386327563e-02   -3.716084403750532e-03   +5.210979445837507e-02   +3.135157307996751e-02   -4.296727949673443e-03   +1.926105993453017e-03   +6.769066331565349e-02; +6.087824096634014e-03   -1.445660718463573e-03   +7.926873025849218e-02   +5.026439642645905e-02   +7.809750440558065e-02   +1.644900812105069e-02   +1.000421175046141e-02   +3.467351492372048e-02; +5.978292203594784e-02   +1.075278140103010e-02   +7.044414006655413e-02   +9.526718261365578e-02   +4.190070192016126e-02   +3.553760795854297e-02   +5.601643248408198e-02   +9.015537318350350e-02; -1.829908567278863e-02   +9.785076986949481e-03   -2.402456645324438e-02   +6.611176639157178e-02   +8.484419285478217e-02   -1.135989026769000e-02   +4.686213682663148e-02   +2.086395579197649e-02; -5.511979956729235e-02   +7.268554043272660e-02   +5.138630551827218e-03   +5.191702481869462e-02   -4.153754565583503e-02   +6.248583996491635e-02   +2.206469125729162e-02   +2.279530204540390e-02; -5.948149126587449e-02   +3.296292015127265e-02   +2.276274924463641e-02   -3.462254293547053e-03   +5.876607917862292e-02   +9.546171606371663e-02   +2.396462612200921e-02   -1.048468150198954e-02];
L3I_L3E_iAMPA_netcon = [-6.285175616603440e-03   -1.007526727427639e-02   +3.441694914644280e-02   +8.787436120630873e-02   -2.372879028135525e-02   +7.554622971577171e-02   +7.291186249352433e-02   -2.986431139405360e-02   +2.208171724952248e-02   +5.705084254988146e-03   +9.479647991037703e-02   -1.511629591607089e-02; +5.035605556290652e-02   -2.904604807587379e-02   -8.387661936846574e-03   +4.669609062462499e-02   +8.399342948806528e-02   +4.286975390683539e-02   +8.094533979908164e-02   +7.019219739365036e-02   +1.836664114496591e-02   -6.570374744693698e-03   +3.451395819857345e-02   +1.076464502719271e-01; -3.785232127159776e-02   +9.932235375644913e-02   -1.681229029018340e-02   +9.048248863027780e-03   +7.523914225473934e-02   +9.603062361796508e-02   +1.966999215151995e-02   +2.697410774355726e-02   -2.695177367379088e-02   +7.715569029365593e-02   +1.968455930936027e-02   +8.377011940596696e-02; +5.962288649746043e-02   +2.204261609500607e-02   +4.688756030506563e-03   +6.902706646032682e-02   +1.018510780205691e-02   +5.441719368013504e-03   +5.742713312368682e-02   +6.851584108080823e-02   +4.752436959655551e-02   +6.072845583592389e-02   +3.584933977274950e-02   +4.608001332527631e-02; +1.638350505343992e-02   +9.055961117524781e-02   -3.718418555649874e-03   -3.313169973027672e-02   +2.085878436742477e-02   -2.911084160971382e-02   -6.679933678882842e-02   +3.685915951349206e-02   +2.648916958991941e-02   -8.330358807137559e-03   +5.899079349892646e-02   +1.165664156831123e-01; +1.147286807118927e-02   +3.823192607058777e-02   +4.546629286647099e-02   +1.145568583886617e-01   +3.549211942690002e-03   +6.387186349049356e-02   +2.801175434863078e-02   +1.781720891723152e-02   +6.873959692134560e-02   +4.020327330556554e-02   +7.281062591984752e-02   +3.509843487276537e-02; +1.075898540150654e-02   +6.853265132393771e-02   +8.406622603128129e-02   +2.944273340880298e-02   +5.630437408061967e-02   +6.439961948597055e-02   +3.217167905867901e-02   +1.340263501586991e-01   +1.818211532454810e-02   -2.647417800377306e-02   -1.972544656734189e-02   +4.106098902915770e-02; +8.667954145206569e-02   +9.895661587368118e-02   -6.063507485429117e-03   +1.099113270553926e-01   +5.335895797605122e-02   -4.048807657807628e-03   -1.755223756125386e-02   +1.046361007254431e-01   +1.007489137941738e-02   +4.621337098419280e-02   +3.245621540881032e-02   -3.643844108067515e-02; -2.630180607571388e-02   +5.626072650366052e-03   -1.356117469189921e-02   +4.536245969164034e-02   +5.067414873169662e-02   +2.811498967259352e-03   +5.463429025700184e-02   +5.360818215804215e-02   +2.884973107613945e-02   +5.683700142749600e-02   +6.968928349407602e-02   +2.630236859342026e-02; +5.455042757703117e-02   +5.351446679004362e-02   +1.468062588558218e-02   +1.671357684213639e-03   +3.699005828113613e-02   -1.266822360887619e-02   +2.794766440818187e-02   +9.975027368569112e-02   +5.556653578359069e-02   -1.490034035912157e-02   -2.848289161630412e-02   +1.323147734820474e-02; +6.939645048797601e-02   +4.962150800626867e-02   +2.309032424266407e-02   -1.145291592231906e-02   +1.886622381654096e-02   +3.212798191748609e-02   +3.042153955579176e-02   +7.240651658631495e-02   +2.632090654258075e-02   -2.995852875430159e-02   +6.199976671913039e-03   +5.027143670638332e-02; +6.179004003583290e-02   -3.166497986232068e-02   +4.731351450244675e-02   +1.189189511909904e-01   -1.347521163697427e-02   +2.986058676437753e-02   +9.994962611897668e-02   -3.016642544719993e-03   +1.485415031306823e-02   +5.509811745594845e-02   +2.493082381312570e-02   +1.005548358365403e-01];
L3E_L3I_iGABA_netcon = [-2.487720004403813e-02   +2.069961109869712e-02   -1.354285793719575e-02   +1.184453427887403e-01   +6.286889658627590e-02   +8.843722330069517e-02   -4.612420814920339e-03   -7.640619967480090e-03   +5.738556133764686e-02   +9.788223309704094e-02   +6.763662530303446e-02   +5.765011745156903e-02; -2.341630462643400e-03   +1.039585894703237e-02   +1.098810284875605e-01   +1.461662222745534e-02   +3.248043388717982e-02   +5.105295645150404e-02   +9.684272757813503e-02   +6.203928205343388e-02   -4.283078829757526e-03   +8.978784409212798e-02   +4.865471869880682e-02   +2.727448140329740e-02; +3.275746586417508e-02   +2.731327777993709e-02   +7.986673602416218e-02   +1.250437740842053e-01   +1.160605038957833e-02   +5.091980722671559e-02   +4.563997546333936e-02   +4.610702773685868e-02   -6.016783232567798e-02   +9.386283071572596e-02   +2.589795320453724e-02   -1.393316384962867e-02; +4.246448553796659e-02   +5.374221077782824e-02   -3.295018900478591e-02   +3.255094866611785e-02   +1.428448041818934e-02   +1.059221589687039e-01   +4.401289675722915e-02   +5.355478046943670e-02   +4.026920900020237e-02   +1.334987211988155e-03   +8.269723219557229e-02   -3.773174576382291e-02; +1.133337530022915e-01   +7.516584491345561e-02   +8.859101593674040e-02   +3.887471846672031e-02   +6.608817614824107e-03   -5.864319842299138e-04   +4.453146553131238e-02   +4.592431364303490e-02   +3.295084673810311e-02   +1.053787341782264e-01   +3.436500452316832e-03   +5.449696307153593e-02; +1.281483749756578e-02   +2.962516177235438e-02   +2.582363422117972e-02   +2.419804377406274e-02   +4.327002423406764e-02   +9.334172640686465e-02   +3.266104766592086e-02   +5.305614099877074e-02   +2.976915679218478e-02   +2.760632748392935e-02   +9.874797313773642e-03   -2.398512308357269e-03; +1.709672909376660e-02   +1.487890789954315e-02   -1.384049044417528e-02   -3.045928955561549e-02   +2.015698392421737e-02   +7.862300960842374e-02   +2.147245694781614e-02   +7.454036244352046e-02   +1.805854289415160e-02   +2.894238026106678e-02   +4.379586031491549e-02   +1.902667578912346e-02; +6.555243347436548e-02   +4.435834380485450e-02   +5.463061292921643e-02   +1.325681998243171e-01   +5.015057961652146e-02   -1.836754207736032e-02   -6.465918398436785e-03   +3.306155505686621e-02   +5.099843441671190e-02   +4.075311705386015e-02   +4.085792893489119e-02   +1.025402816145624e-02; +1.626347884112428e-02   +5.086685837539814e-02   +2.985058405110222e-02   +2.151062923306261e-02   +8.468922386880165e-02   +7.805747207411963e-02   +4.023727193512758e-02   +1.303174859849229e-02   -3.145764920636293e-03   +7.727595075052382e-02   +5.581110853569489e-02   +6.006787863219564e-02; +8.043650560473646e-03   +3.518744762931982e-02   +2.852057392189698e-02   +1.963772172328262e-02   +1.020936094489972e-02   +1.682794048328564e-03   +3.846019134050319e-02   +5.703093033432251e-02   +1.287006707753128e-02   +4.833638342027190e-02   +4.853027069506355e-02   +4.507880477323272e-02; +3.268589873193133e-02   +4.987436891528127e-02   +4.864033604539188e-02   +7.864298848849942e-02   +5.402025553333848e-02   -3.282517975551502e-02   +1.188260404618043e-02   +5.998955823813728e-03   +3.018428926829727e-02   -1.578430168830746e-02   +1.353319705152304e-01   +5.970581071641812e-02; +2.624513152433732e-02   +4.293257666057423e-02   +1.726192359585420e-02   -5.013403379341893e-03   +5.394182379818174e-02   +2.264488583701485e-03   +9.592355445558345e-02   +2.990035401919471e-02   -6.725020400428055e-03   +3.630474348961828e-02   +1.546332809045549e-02   +6.295687253473797e-02];
L2E_Input1_iAMPA_netcon = [+2.771410602413059e-02   +5.071708134633716e-02   +6.788729685242435e-02   -4.975434313642377e-03   +3.073179015283709e-02   +2.667652305316209e-02   +6.436966869295739e-02   +7.262206637434823e-02];
L2I_Input2_iAMPA_netcon = [+6.412710781280082e-02   +1.150703429773429e-02   +7.590592750259177e-02   -1.499379875924746e-02   +1.533427274930227e-02   -2.556899202992205e-02   +1.282449561347546e-01   +5.344555052213981e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.5*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.5*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
