function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.238200836259699e-01   +6.446468083359694e-01   +1.238412248764694e-01   +1.224160859315412e-01   +7.308321362005277e-01   +8.209202156917262e-01   +7.068975420501412e-01   +8.198348756362421e-02   -8.523143075785530e-04   -1.256791264195943e-01   +7.616964314290475e-01   +3.230559219030883e-02   +5.006414526280301e-01   +1.436856730670138e-01   -3.556968283678794e-01   -2.459632899190061e-01; +8.613749218885641e-01   -8.658120182689419e-02   +2.867021978683890e-01   +5.582276959265003e-01   +7.139308480087053e-01   +5.152586056393857e-01   +3.094870830263441e-01   -2.184241338711615e-01   -4.565123908787924e-01   -5.341943405285033e-01   +8.050647922936559e-02   -1.655536533044802e-02   -4.384623690698718e-02   +1.750739263450817e-01   -5.007123425494954e-02   +2.811437876756949e-01; +4.850720474190816e-01   -3.453576456896676e-01   +2.042425934020687e-01   -1.682816398705571e-01   +2.348076906816887e-01   +2.990981103179386e-01   +4.475515119539430e-01   +4.510084803058935e-01   -3.246830276127670e-01   -3.250258712364623e-01   +5.210319522759496e-02   -2.010568515631170e-01   -1.951080182633813e-01   -1.504899466796981e-01   +5.253358570425434e-01   -4.386413933201460e-02; +2.538313207155969e-01   -2.992108324215572e-01   +3.902085321485118e-01   +3.937072191995152e-01   -3.647183477778022e-02   -5.752125263379290e-01   +7.793025054334126e-01   -1.571030405110081e-01   +6.408718564875358e-01   +1.362880689926558e-01   +2.147871200111136e-02   +3.325989328570309e-02   +8.305547221791368e-01   -1.205676108528718e-01   +1.264963113696317e-01   +1.583057294097695e-01; +6.882695509271286e-01   +6.516941618521287e-01   +6.242900866591028e-01   +5.710433114808935e-01   +7.356414409853295e-01   +2.161653797259764e-01   +1.026555569254175e-01   +5.683863322515362e-01   +9.264206132509671e-02   +9.109765110473242e-01   +6.113902998938043e-01   +1.971929495298352e-01   +6.666415891723425e-01   +1.000000000000000e+00   +5.552435263158169e-01   +2.115721780369359e-01; +2.777338737243810e-02   +8.266336280421728e-01   +3.898982626150331e-01   -4.428339372203215e-01   +2.870592138240635e-01   +1.399128081752434e-01   +3.117104554790540e-01   -2.300193795979715e-01   +1.120541538459159e-01   +5.065986850591293e-01   +7.720409366484488e-01   -3.262674603835721e-01   -3.529791371599209e-01   +1.696341890068163e-01   +5.361828609620869e-01   -6.337659081767488e-02; +2.392379476379736e-01   +1.561073563412376e-01   -3.647285165843911e-01   -9.995233635600527e-02   -4.505968935282499e-01   +1.751459718664022e-01   -1.181285432314681e-02   +5.274304401613211e-01   -4.416074990488477e-01   -1.784206713871996e-01   +5.750428644653741e-01   +3.342619273562396e-02   +2.853108637378529e-01   +7.753013105304295e-01   +7.064702259324931e-01   +7.841550295368599e-01; +2.641626674687655e-01   +6.144960500181833e-01   +3.751507510166860e-01   +3.412656389723224e-01   +4.048577600611662e-01   +1.380285479067947e-01   +7.852854678270479e-01   -1.542075143857626e-01   -3.810059889654986e-01   +5.963074624476905e-02   +7.654440773264439e-01   -1.027318735193267e-01   -2.488811761141672e-02   +5.064142553072497e-01   +3.701970220879944e-01   +2.986469184877423e-01; +1.975164341260713e-01   -1.013660378097181e-01   +3.847794906334258e-01   -6.731260812001250e-02   -1.485078053627464e-01   +4.362655482030125e-01   -5.802394014331842e-02   +1.806036400971247e-01   +1.089009741446732e-01   +5.262679882127609e-01   -1.936783334654081e-01   -2.910730431092049e-01   +7.993874366617315e-01   -7.625451418498747e-03   +1.623999055851326e-01   +4.316560243716488e-01; +2.688675750873504e-01   +6.834332861948351e-01   +1.280629812241774e-01   +4.840551237989696e-01   -5.165697451150174e-01   +5.238363205021027e-01   -1.373225242032795e-01   -2.324031483780563e-01   +6.232269154516817e-01   -1.519078775125047e-01   +2.043454273137590e-01   -7.242874052309178e-02   +6.799010663857227e-01   +9.817185946035020e-01   +6.802335848095011e-01   +5.955581927470535e-01; +5.400065371669102e-01   -4.453781118711608e-01   -1.942846858184312e-01   +3.984897032152163e-01   +6.895061751572710e-01   -2.919355593091668e-01   +2.724890306429488e-03   -1.757190146307821e-01   +6.088628420591552e-01   +9.471764434197472e-01   +5.106017022096185e-01   +5.629739354641932e-01   +6.316535307286575e-01   -5.119819497750173e-01   +2.286057880232348e-01   -4.568590254337258e-02; +8.692742596560635e-01   +3.828917901087360e-01   +5.952725860669863e-01   +7.245364028566545e-02   +2.554074421270591e-01   +3.042423805662259e-01   -1.716704249625646e-01   +6.350738224883681e-02   +1.782034013192778e-01   +3.992228521670050e-01   +4.241616002931431e-01   -8.387688061808304e-02   +7.463238156768972e-01   -7.433474108047850e-04   +7.243786565242115e-01   +5.966895250243739e-01; +1.350334954929423e-01   -1.206779066374215e-01   +7.625359431688774e-01   +1.385253271539767e-01   +2.778682836607136e-01   +1.523214614803845e-01   +1.009799460386032e-01   +4.671412563348656e-01   +5.914883676582329e-01   -4.126237434428783e-01   +8.046668542651250e-01   +3.582322660583897e-01   +6.940313167245615e-01   -2.127039478753309e-03   +4.511578643182760e-01   -2.808579656249261e-01; +4.621750482441536e-01   +5.944409720181555e-02   -1.246613098527520e-01   +1.992631424860573e-01   -1.451707978900422e-01   +1.525968121726825e-01   +5.778502153447095e-01   +5.046579941619130e-01   -5.356136463754129e-01   +3.292515305197712e-02   +4.585806440296913e-01   -4.340994221233830e-01   +3.271583131326396e-01   +6.262909761790070e-02   +2.488092712484354e-01   -3.042588394277401e-01; +7.154503688768370e-01   +3.922609480943435e-02   -1.427242213019419e-02   +7.164464948078935e-01   +1.746148060642737e-01   +2.394674702724834e-01   -1.345024474322803e-01   -9.778114072965498e-02   -3.760858558884250e-01   -3.074135456478511e-02   +5.053595956607276e-01   +2.864176250054836e-01   +4.570722242060307e-01   +7.844478181900001e-01   -1.742072452355379e-01   -3.750971470544688e-01; +5.660381161592204e-01   +4.542038637596300e-01   +6.278686522385611e-02   +9.986849851148223e-01   +5.006323224315162e-01   +2.445903741923170e-01   -1.770820801355190e-01   +3.301156170052059e-01   -3.106531074453135e-01   +4.328107427194557e-01   +7.096969963773716e-01   +4.820927786188056e-01   +4.433156971820727e-01   +8.646180447001232e-01   +3.401403388357497e-01   -1.075185976194854e-02];
L1E_L1I_iGABA_netcon = [+6.138730636798220e-01   +6.366936506929658e-01   +4.269611921019172e-01   +1.139761062430404e-01   +6.830724980749930e-02   +4.868912752435364e-01   +2.703351489541542e-01   +3.998861236286551e-02   +4.629886952258537e-01   -4.782716146678181e-01   +3.001862273464522e-01   +1.867556910285652e-01   -8.452126172972542e-02   +4.986401116968833e-01   -2.956729177658192e-01   +6.133935708192588e-01; +7.198324354456870e-01   +2.859040501809966e-01   +6.518627298004974e-01   -1.699652632866203e-01   +1.266730463858315e-01   +9.043667317771760e-02   +8.350676135390765e-01   +2.769841958037041e-01   +3.103129223539692e-01   +2.299589012163418e-02   +4.080113217194373e-01   +7.388266420327274e-01   +6.618543664675471e-01   -3.046473088671824e-01   -1.384303151846796e-01   +3.738030183256953e-01; +1.923607044382310e-02   +3.832080048160577e-01   +6.338769256578500e-01   +1.691185849453504e-01   -3.168949110311576e-01   +1.730588727477927e-01   +1.683784806768704e-01   +4.536252093724126e-01   +2.974732833871530e-01   +2.706490477871395e-01   +6.207169092670712e-01   +4.508087002764678e-01   +8.003466208568003e-01   +1.000000000000000e+00   +2.660198400236699e-01   +5.993333331487921e-01; +3.202040541677974e-01   +9.180671786584362e-01   +4.553197119892722e-01   -1.004581757473692e-01   +7.670320237417126e-01   +1.597997806674691e-01   +5.741552687308845e-01   +2.717001046096945e-01   -2.110132951272821e-01   +3.675188996757794e-01   -1.711428245692452e-01   +3.821106719018917e-01   -4.738652588288713e-02   +3.882581515923400e-01   -7.475223428272641e-02   +9.176977114334839e-01; +4.894146321745131e-01   -3.285842526366047e-02   -1.983789739367190e-01   +6.133404255287226e-01   -2.280301539895286e-01   -6.985597129043625e-02   +8.280011090800213e-01   +9.711571630747398e-02   +4.676921277289533e-01   -1.258581396768750e-01   +6.497944685284978e-01   +4.221776567746290e-01   -1.260656648222062e-01   +5.875119063404454e-01   -9.684324357299248e-02   -4.788038845366578e-01; +3.334681528248737e-01   -1.541457944227422e-01   +6.035172969368880e-01   +6.721397010054625e-01   +5.490590655613647e-01   +4.737304288750021e-02   +5.351662876480492e-01   -1.668675835106300e-01   +1.720238866752779e-01   +1.630456503092245e-01   +3.887802795869956e-02   +6.560249418663623e-01   +4.361186076436374e-02   +1.960879810883400e-01   +2.544936745561507e-01   +6.189220963271490e-02; -1.353268997013201e-01   +6.040146833892043e-01   +1.022278222770433e-01   +7.658686019031128e-01   +3.411617063588392e-01   +4.724118275797188e-01   +1.591701187560532e-01   -1.535082780927445e-01   -8.915031167440000e-02   +5.712098351103486e-01   +7.784439472328190e-01   +3.952495929176017e-01   -1.090177662884553e-01   +5.159396781877867e-01   +8.265181946149697e-02   +4.906558025980202e-01; -4.165816608565960e-01   +6.424121830769735e-01   -1.479740664434240e-01   -2.229759043403027e-02   -2.631051873316438e-01   +5.091830559737934e-01   -1.006190845741606e-01   +1.706894874478495e-02   +3.200796774521060e-01   +2.486876530539786e-01   +4.497682440230868e-01   +2.631285391370101e-01   -2.105351041089520e-01   +5.964706009189856e-03   +3.500395964033174e-01   -3.325132128723865e-01; +3.155325404483652e-01   +3.858994760465096e-01   +5.988212030802139e-01   +1.772435361317538e-01   -1.673083641623122e-01   +5.957767965156979e-01   +5.783382819741398e-01   +2.475457748224107e-01   -1.170230536506915e-01   +2.170108679928556e-01   -3.802470074448708e-01   +6.963415469064758e-03   +5.406403438551430e-01   -1.751555392051897e-01   +4.725093834535667e-01   +4.040653218109758e-01; +6.941811099756341e-01   +9.921151524036849e-01   +4.853150898657335e-01   +3.743617275398984e-04   -4.383093833267259e-01   +6.512921715180349e-01   +1.111162596657873e-01   -7.783248480928831e-02   +6.350048701228246e-01   +2.459697552972116e-01   -1.884986906033570e-01   +4.918541908169846e-01   -1.086042131451972e-01   +5.631996157827097e-01   +3.510429726022511e-01   +3.757074314019768e-01; -1.891698431933653e-01   +1.230155277313542e-01   +4.322407471353277e-01   -1.534480826501241e-01   -1.449954648153066e-03   +4.524877167255603e-01   -2.030271313419988e-01   +7.878594519052375e-01   -1.077895065043989e-01   -1.632533974139021e-01   +1.000563163182055e-02   -7.749959667629074e-02   +4.036807737598510e-01   +6.570780133335912e-01   +1.573934763374836e-01   +4.346629769242666e-01; -2.012758601766016e-01   -6.937807756962711e-02   -9.577367792504025e-02   +1.006625740094367e-01   +6.578956301797795e-01   +2.173142238222039e-01   -2.331942452178440e-01   -3.126901078756958e-02   -2.712945177158397e-01   +2.009192200115126e-03   -3.585062267653920e-01   +4.020144716101460e-01   +9.281304219536650e-01   +2.827704861815838e-01   -9.015985550734022e-02   -4.102417346922511e-02; +1.445528846958593e-02   +4.087664305036495e-02   -1.780725403235917e-01   +7.418275688430914e-01   -2.359227359536895e-01   +7.746434657095523e-01   +6.669804119982160e-01   +7.034211562987472e-01   -9.937210302979792e-02   -1.082984047287208e-01   +2.535273887134399e-01   -1.969535682933440e-01   +6.954077263975288e-01   +6.507440527445879e-01   -3.972179950986324e-01   +6.723648419414789e-02; +5.342596919259418e-01   +5.371202129019355e-01   -1.747274832857374e-01   +2.459184322025871e-01   +7.838583416485839e-01   +8.686289034434455e-01   +6.825541767369424e-01   +2.314738006880713e-02   +4.760693732148621e-01   -1.393410073834224e-02   +6.690589020857426e-01   -1.820535720529470e-01   -1.532441228291889e-01   +5.370157161890353e-03   +6.956446340418688e-01   +2.525680213751982e-01; +6.753855423147661e-01   +2.535531952803972e-01   +1.883203469991420e-01   +5.796717842854562e-01   +8.924034071391740e-01   +5.071086718539159e-01   -4.697793505208858e-01   -2.900395414999237e-01   +9.342301525420914e-01   +2.900731365411278e-02   +7.774924513049427e-01   +1.131384516681705e-01   +1.497780199199382e-01   -1.133525858347867e-03   +1.482641010904137e-01   +6.391535396336624e-01; +4.361599032045355e-01   +3.121675482224354e-01   +3.361256889399856e-01   +2.158403757689710e-02   +3.377007298921900e-01   +3.089278303709310e-01   +4.070492749093176e-01   -1.587668811887475e-01   +3.885392152020045e-01   +8.417842224237690e-01   +2.297953204461526e-02   +8.066314243317704e-01   +6.497370427574696e-01   -2.642527948811343e-01   -2.203167497161304e-01   +2.626722642968074e-01];
L2I_L1I_iGABA_netcon = [+3.867538665802660e-01   +7.547532768998234e-01   +5.550744921850833e-01   +3.992282013737249e-01   +2.350278292301760e-01   -4.534788325255946e-01   +6.618942957816175e-01   +3.507602260081232e-01; +1.919863136286495e-02   -2.390753717710117e-01   +6.144459877746661e-01   +3.452544511189551e-02   +2.319663332141773e-01   +2.433511933810445e-01   +7.960903451204802e-02   -1.521483542465948e-02; +7.194738363305795e-01   +1.317596078186354e-01   -1.717286180327633e-01   -8.228894993835059e-02   -3.405449055508440e-01   -3.065254522291858e-01   -2.684549800704770e-01   +4.139355407604068e-01; +3.062685043525054e-01   +5.139986109022183e-01   -1.616336216763100e-01   +5.931533088963022e-01   +6.134059123654110e-01   -6.434565412407943e-02   +5.130145183872312e-01   +4.782300184960998e-01; +1.661893744710360e-02   +7.237393642346617e-01   +3.927277090493566e-03   -3.777053032750456e-01   +5.866148605149031e-01   -1.398250971945505e-01   -2.513758047699897e-01   +3.396242843181576e-01; -1.920536932322867e-02   -8.393700842502569e-02   +1.643516493475677e-01   -1.164881851958104e-01   +6.911594167326632e-01   +1.000000000000000e+00   -1.481674531654081e-01   +8.717208643865241e-01; -2.270423955175582e-01   -1.798013518679170e-01   +5.627998731308071e-01   +8.101344220533632e-02   +3.067608214161042e-02   +1.031286990819260e-01   +4.043621341523872e-03   +2.536182469178062e-01; -3.557000778416967e-01   +3.216266124799165e-01   +6.835918136722492e-01   +7.636305898716835e-01   +2.755017118337050e-01   +1.993091672512007e-01   +6.228881478724246e-01   -1.667477679044954e-01; +2.765765765779239e-01   +5.640444589065987e-01   +4.159581688386826e-01   +5.750825406283286e-02   +3.398090067157299e-01   -3.211167212987204e-01   +1.732624219683153e-01   -1.945478605646567e-01; -3.475127620125389e-01   +1.167548202306974e-02   +2.692658719797089e-01   +3.754607090769820e-01   +3.866897504762811e-01   +5.010843579638303e-01   +3.242903569099960e-01   +8.525060766480127e-01; +4.886901196834132e-01   +1.505844615268223e-01   +4.241975539274646e-01   +5.263583208370390e-01   -3.799912001446500e-01   +6.812763012886554e-01   +1.941585822536198e-02   +5.839898966061961e-02; +2.495561491848079e-01   +1.311441116867280e-01   -2.148678255010139e-01   -1.823702997297867e-01   -1.286773483744195e-01   +2.146095438338528e-01   +1.875936655998281e-02   +1.662076670214196e-01; +4.114623851425930e-01   -4.086137520735073e-01   +1.595766920310260e-02   +7.381552623705246e-01   +7.787500614657319e-01   -3.568814206085617e-02   +1.160824058703834e-03   -1.629751934015378e-01; +3.184686827799476e-01   +4.438486398164978e-02   +2.925177308693579e-01   -1.545876163971579e-01   +9.904090779998810e-01   +3.909301857205886e-01   +6.082195712153707e-01   +7.668660220458893e-01; +6.947188036965497e-01   +1.849638158445626e-01   +2.865544395424728e-01   +1.633544808616776e-01   +3.774405307673655e-01   +8.778189409811429e-01   +1.889568052163867e-01   +4.970839084176900e-01; +4.682564502390427e-01   +1.725193589770810e-01   +4.910228555138974e-01   +9.723253814457926e-01   +3.301384270424620e-01   +6.536350716524696e-01   -3.758437908589795e-01   +1.277309593896837e-03];
L1I_L2I_iGABA_netcon = [+3.948648616772241e-01   +2.894443395733480e-01   +2.052188543705399e-01   +5.659688576098454e-01   +7.942360472549828e-01   +5.137902429084034e-01   +6.557444778533903e-01   -1.138632873709702e-01   +6.780744152952557e-02   -5.453267517348077e-02   +8.494061226147916e-01   +5.759025827956772e-01   +5.856379221572463e-01   +9.020044105612550e-01   +6.398064744327219e-01   -1.667161175394668e-01; -1.054647557799776e-01   -1.771615041925783e-01   +8.940387615691315e-01   +7.769139837254389e-01   +6.091396045862552e-01   +4.204656956801793e-01   +8.085152366233881e-01   +3.466443864912937e-01   +6.643821109713299e-01   +7.856466600330666e-01   +2.849855822485831e-01   -2.225075780809216e-01   +4.386078116978279e-01   +5.959209974092201e-01   +4.750765404667194e-01   -4.809474017775275e-01; -2.985563498890879e-01   +5.972180994531978e-01   +7.271320792691047e-01   +1.317929034439950e-01   +5.291220897485045e-01   +7.275224380596325e-01   -3.202283517828301e-01   +4.652590716518800e-01   +6.713543905187465e-01   +7.851658614157545e-02   +3.557619914528089e-02   +3.877261269694372e-01   -1.921719849070912e-01   -2.768782005158187e-01   +2.714825571081608e-01   +8.324979148389834e-01; -4.594322185560025e-01   -1.081105666952173e-01   +1.128694128762413e-01   -8.725205339465181e-02   +4.694393487502298e-02   +5.910636532423404e-01   +4.131429328161633e-01   -7.747176289425135e-02   +5.571877252704465e-01   +5.755706055314749e-01   +5.725271452377420e-01   +5.728661261557659e-01   +8.570624152040851e-01   -4.852661730463733e-03   +4.641169099161199e-01   +1.719735129320073e-01; +1.416777873804543e-01   +8.632497809760272e-01   +5.879808582302672e-01   +3.454641432476431e-01   +6.239156822019005e-01   +5.923667183624181e-01   +2.074244503015643e-02   +5.365439157574743e-01   +1.372223555226857e-01   +1.388293825933204e-01   -3.506578926845041e-01   -6.208109500960151e-02   +9.722379072789622e-02   +5.031815389318424e-01   +1.194295291891116e-01   -3.574428159677686e-01; +3.018786193059367e-01   -3.428281781966231e-01   +9.620573091488170e-02   -1.353447821030487e-01   +5.471379747534975e-02   -1.911959202020577e-01   +1.000000000000000e+00   +4.723652004909113e-01   -3.052295990651791e-03   -8.591074571040166e-02   +2.960043430316222e-01   +1.947974326566062e-01   -4.028843369402308e-01   -4.990758708447710e-02   -8.525685464269703e-02   +6.434078014318201e-01; +8.640975432201310e-02   +6.044506724855564e-01   -1.270129792902266e-01   -1.582911846912607e-01   +2.873868985825222e-01   +4.836349686024641e-01   -3.519806683630534e-01   -6.054825920690475e-02   +4.760690579105928e-01   +7.214392083881535e-01   +6.704689661263774e-01   +6.670170304523604e-01   +1.750606200409306e-01   +1.875115204512429e-01   +5.274392113973234e-01   -3.372618559226304e-02; -1.076296640546638e-01   -2.809237868233908e-01   +4.418182640270642e-02   -4.547309243226279e-02   +5.581741346875956e-01   +1.224826645809033e-01   -2.379351425731286e-01   +5.967211888678408e-01   +1.171920259090897e-01   +1.165041221851787e-02   +8.323957307942613e-01   +4.896556883234175e-01   +3.745054571792028e-01   +9.481969607544997e-01   +9.689206214196883e-01   +2.084322587180387e-01];
L2E_L1E_iAMPA_netcon = [+8.998306062977384e-01   +5.983343982562509e-01   +7.509116672741283e-01   +3.527283501885779e-01   +1.268774861991995e-01   -8.842127167801578e-02   -3.418956667840864e-01   +4.311145440260535e-01; -3.380812983328964e-02   -7.988385827131018e-02   -1.132217364218889e-01   +1.739224765642096e-01   +4.420632678178337e-01   +8.772803538206175e-01   +3.983695177139615e-01   +5.527411121653555e-01; -2.532654614250299e-01   -1.130621006983235e-01   +6.892376276512638e-01   +3.519462575679588e-01   -3.255008981894513e-02   +3.272700545508569e-01   +1.632616061604533e-01   +7.138552138586620e-01; +4.343101866308658e-01   -1.151066538196778e-01   +2.674082068523836e-01   -1.974083617085641e-01   +7.954028913050749e-01   +5.883250040139374e-01   -2.647650892726409e-01   +3.300619559245380e-01; +8.814903703668743e-01   +7.829664925813577e-02   +5.925842473931707e-02   +1.998705533018763e-01   +1.121524453255352e-01   +6.600004288136166e-01   +4.227599014431415e-01   +2.289212401520638e-02; +4.039801500799320e-01   -1.085638010741566e-01   +1.267645274284763e-02   +5.015484954870593e-01   +8.093040085827653e-02   +2.290369485301241e-01   +4.633688155730513e-01   +2.567115943591016e-01; +5.309888784759863e-01   -1.370501275343235e-01   -3.633188380599709e-01   +1.999951351632589e-01   +6.779183889237231e-01   +4.776913861124466e-01   +5.635116389869951e-01   +4.689923031859202e-01; +6.106190017451759e-01   +3.065673968903041e-01   -4.346716232019834e-01   +2.343074222429652e-01   +6.416091792510806e-01   -2.692878154076310e-01   +3.359078968200436e-01   -3.045202504063453e-01; +4.317934118696419e-01   +3.244130621688890e-01   +1.832082014198990e-02   +4.718588257252954e-01   +8.354545345185540e-01   +5.185850712752176e-01   +3.796200673084321e-01   +1.000000000000000e+00; +3.050739647368863e-01   +6.942881588605844e-01   +1.527498387366648e-01   +5.725241675608471e-01   +5.611323157227632e-01   +8.533996241592446e-01   +2.424607992531507e-01   +2.902817289721589e-01; -3.685098872400686e-01   -4.824747838015923e-02   -2.170252255147333e-01   +2.300712585006071e-01   +7.185099775278192e-02   +3.496847012806242e-01   +5.316348099031784e-01   -4.652166893341344e-02; -1.275422636524395e-01   -4.482200131382346e-03   +7.601872898430769e-01   +6.606298459658521e-01   +4.299602233774440e-01   +4.540998318697579e-01   +8.081904226120614e-01   +6.532062005572643e-01; -2.834223929926319e-02   +1.619568993774777e-01   -5.522954110690671e-02   -1.592654007766107e-01   +3.274150219330525e-01   -3.157624996052724e-01   +9.121126374900289e-01   -3.814946379520811e-01; +2.447887090876527e-01   -2.776164438120162e-01   +2.641100432782682e-01   -1.431612246555672e-01   +3.555356735317216e-01   +6.452977414295785e-01   -4.644674428102256e-02   -3.496253981421035e-01; +3.213196060538966e-01   +3.770979385589317e-01   +3.786236984095648e-01   +6.901735909338347e-01   -1.126416522150571e-01   +8.521647107857303e-01   -9.501293680920675e-02   +9.562542415556873e-01; +3.509178579596952e-01   +1.229009139369746e-01   +3.355820925249171e-01   +4.803942289225112e-01   +1.071319772474374e-02   -3.487743823183759e-01   -1.696864662289389e-01   +1.047375088829492e-01];
L1E_L2E_iAMPA_netcon = [+4.949786904768757e-01   +4.388112861176020e-01   +5.656520600409158e-01   +1.978955871627454e-01   -5.029003877679246e-02   +2.091009548165606e-01   +6.281545467034306e-01   +3.778961797891766e-01   +4.568616976162838e-01   -1.476249780574218e-01   -2.768154996933584e-01   -1.446034641694240e-01   -4.664098599074501e-01   +2.999558813048630e-01   +2.893096838328741e-01   +5.333870214899801e-01; +6.393796444229398e-02   -9.922601569908780e-02   +5.694498623883995e-01   -3.229793472990760e-01   +6.621651745842553e-01   -4.666997800070838e-01   +1.194243236092478e-01   -1.293597021481371e-01   +4.555722538729186e-01   +6.415625654245939e-01   +1.000000000000000e+00   -6.638872422218266e-02   +6.322842732881448e-01   +8.330982492875433e-01   -3.260488117062133e-02   +8.033829048502953e-01; -4.243937808677423e-01   +6.959949355590078e-01   +2.440600396093738e-01   -1.266480630539640e-01   +8.928005951522504e-01   +3.315599718481135e-01   +6.855803153281824e-01   +5.895847437783654e-01   +4.285151863987668e-01   -4.788846779309306e-02   +5.356811098218591e-01   +3.777309040568975e-01   +6.072830485643460e-01   +1.949055414055205e-01   +6.017171859468171e-01   -4.800933700579790e-02; +5.885499283714851e-01   +6.028162398476384e-01   +7.305482522690025e-02   +8.187620433654881e-01   +2.770101572778685e-02   +5.837041028529977e-01   +5.028602670098600e-01   -3.416928974541331e-01   +3.848952114863110e-01   +1.335809063137635e-01   -2.956380669308707e-01   -8.099204466750226e-02   +3.267141800243213e-01   -4.306238883015200e-02   -4.214380355876426e-01   +1.510401819295406e-01; +1.652546435852614e-01   +1.898071669675106e-01   +1.070481227583245e-01   +7.056065275587542e-01   -2.556098539356510e-01   +4.287078648028473e-01   -5.454747687600321e-02   +1.558910387019605e-02   -1.872051189480965e-01   +5.316175457688945e-01   +3.818298802492579e-01   +4.576330553510014e-02   -4.986373714013282e-03   +4.295974835505557e-01   +2.134812889218805e-01   -2.177544535643934e-01; +6.313649606374490e-01   -4.092886563569277e-01   +2.786274017796658e-01   -1.192667089058943e-02   +2.301762699001594e-01   -3.540699815307228e-01   -3.944429526473070e-01   +4.799303181959063e-01   -1.534272517226128e-01   +8.375942057036715e-01   +1.994213070591629e-01   +7.687504101255321e-01   +5.869844868638699e-01   +7.396314775884841e-01   -8.698514684885908e-02   -1.016938648252963e-01; +5.366053118218554e-01   +2.539256120307541e-01   +7.911526488765031e-01   -9.776147217136426e-02   -9.711502234983317e-02   +1.230108901114399e-01   -4.826695943544618e-01   -5.721649711314865e-02   +5.011944037549892e-01   +4.572401782996016e-01   +8.222754882759933e-01   +5.203452560981238e-01   +3.760947323662885e-01   +3.681832697209000e-01   +4.368103454463243e-01   -1.017140693847013e-01; +3.463259124927513e-01   +5.173333883152536e-01   +5.932900853993374e-01   +2.137634923836761e-01   +1.687557514082770e-01   +1.218086772839381e-01   +5.799524648439423e-01   -4.131256238511730e-02   +6.405733739048438e-01   +6.196246784376979e-01   +5.111033498471903e-01   -2.705384194677655e-03   +2.293460824043495e-01   +3.838190686652494e-01   +4.384030021763090e-01   +1.865247181817014e-01];
L2I_L2E_iAMPA_netcon = [-3.758481953136832e-03   +3.487680178800200e-01   +2.443339628855817e-01   -4.900759590590554e-01   -1.829391758599636e-01   +9.331157204929275e-01   -1.414789603432764e-01   +6.230465584632848e-01; +8.053323622831511e-01   +8.087069283884718e-01   +1.740827395625268e-01   +5.633755194769779e-01   +8.144172924584714e-01   +5.595305487319880e-01   +5.754677621835287e-01   +3.756223416164526e-01; +8.516762957098787e-01   +2.457530204069067e-01   -1.378242992004558e-01   +1.379664603826189e-01   +5.953561282172084e-01   -2.303555540368798e-01   +8.004163379506569e-02   -3.200019422537334e-01; -2.272511004927641e-01   +7.469992321180635e-01   +4.172483582121422e-02   +2.652285630261874e-01   +3.178590903698675e-01   +5.625589302015351e-01   +4.547080578198910e-01   -2.054014935005254e-01; +1.000000000000000e+00   +3.358082064296913e-01   -3.300946878294727e-01   +7.877412910803875e-01   +7.499062528853874e-01   +2.098132107894289e-01   +2.091611771475634e-01   +6.782633123132700e-01; -4.125939107948600e-01   -1.935736272334692e-01   +4.201734332516265e-01   +2.433362045852696e-01   -2.607383822281095e-01   +9.920686592591040e-02   +8.330899159527467e-01   +8.012250001182718e-02; +2.657686264282690e-01   -1.143072583718117e-01   +2.506218594469550e-01   +9.171525248962084e-01   +5.549128042583824e-01   +5.697080278500301e-01   -2.904536888812628e-01   +4.323661449351184e-02; +4.017072997800749e-01   +9.900185453308351e-01   -2.628501878323506e-01   -1.604016706655783e-01   +1.463133858613204e-01   +6.496221784905771e-01   -3.711367947743451e-01   +4.845999047938186e-02];
L2E_L2I_iGABA_netcon = [+7.203575725364432e-02   +6.133698796757084e-02   +6.626089485387039e-01   +1.606715731481446e-01   -1.706625801747290e-02   -1.244751208778224e-01   +6.435698222759505e-01   +4.314385897231821e-01; -4.201274043606148e-02   +2.033059962539290e-01   +6.456530786554880e-01   +1.252295192715764e-01   +2.722272767180464e-01   -1.742164333063119e-01   +4.948798865843342e-02   +1.000000000000000e+00; +6.138906725716482e-01   +4.205098283717438e-01   +2.428750373299481e-01   +4.272046631125550e-01   -1.446367457576292e-01   -3.133605298386491e-01   +6.478683130336962e-01   +3.207514369690891e-01; +3.314869325452303e-01   +1.327300424941299e-01   +4.036565584766704e-01   +2.758733273900945e-01   +7.855325272052376e-01   +5.846302761555880e-01   +5.605066057203187e-01   -5.300565381927641e-01; +5.149756607660875e-01   +6.989590459184833e-01   -3.723652400404788e-01   -5.468230071405628e-02   +2.830564333181722e-01   -3.465375455424139e-01   +4.588523447822211e-01   +6.845485405083165e-01; +5.453745422096540e-01   -9.143959823693583e-02   +8.471884836005552e-01   +1.620666566973111e-01   -3.382067186893697e-01   -3.054502902672861e-01   -2.263871303918472e-01   -1.931611931558734e-01; +6.415691006601831e-01   +2.400858182443921e-02   +2.047015436000531e-01   +5.266695644941746e-02   +1.491082517677217e-01   +3.523725647366697e-01   -8.810558321347420e-02   +2.134554292920713e-01; +3.040060812448628e-01   +8.445223441325426e-01   +1.299008613049947e-01   +5.972912423834210e-01   +9.507268319081027e-01   +7.698639679807933e-01   +1.668954896167712e-01   +9.165184288876803e-01];
L3E_L2E_iAMPA_netcon = [-1.829075965995347e-01   +5.475639810118764e-01   +6.450574179834738e-01   -3.399586305035346e-01   -2.645194860005331e-01   +5.997320500720161e-01   -3.238937125302846e-01   -2.873961716849237e-01   +2.459063553327358e-01   -2.858364005680274e-02   -1.922509928849543e-01   +1.033483861217610e-01; +7.462460466337806e-02   +1.999095643876410e-01   +3.937226847339151e-01   +2.017753306191877e-01   +2.632896188403070e-01   +5.495595924786005e-01   +5.205119632092549e-01   +5.191661112068368e-01   +1.817467277402937e-01   -3.683351164470600e-02   +7.792388359590089e-03   -4.740771453663165e-02; +3.431540085033761e-02   +3.455057017310691e-01   +5.836658828471446e-01   +3.320459369015912e-01   +5.330087416434778e-01   +6.240721947094228e-02   +2.384364884779348e-01   +9.340778758282554e-01   +6.350375452439938e-01   -3.911371785424584e-01   +4.522057187233724e-01   -1.477915884460985e-01; +8.770673897202877e-01   +3.326232242779139e-01   +3.274871808451543e-01   +7.786250724412822e-01   -1.213947744100521e-01   -9.776367397488312e-03   +5.911696072293769e-01   +6.795530628770672e-01   +7.723245745448484e-02   +2.479856502569669e-01   +5.251951628681778e-01   +2.622704394703768e-03; +2.495948181542782e-01   +8.986750209421198e-01   -4.550651730983907e-01   +8.425315373076696e-01   +1.523973633866880e-01   +3.192237965168543e-02   +3.726092495214556e-01   -4.126261743863369e-01   -2.330315829406411e-02   -4.398567489949489e-01   -4.233488812341847e-01   +7.337601478443931e-01; +8.872581176802693e-03   +3.968776422469374e-01   +1.464558631257242e-01   +1.590512830037165e-01   -1.186871592629563e-01   +9.363478370387373e-01   +7.698860084825335e-01   +1.456013597257758e-01   +4.706848669552599e-01   -4.334959043388267e-01   -5.744285879587250e-02   +8.184046910294289e-01; +2.744321670417264e-01   +6.640946516636195e-01   +6.210884910104678e-01   +8.304148347946184e-01   +1.528231336913961e-01   +6.220312522453982e-01   +6.440960504271839e-01   +5.038468721007664e-01   +7.776917920395450e-01   +5.571030230542445e-01   +5.702017338308718e-01   +3.911094247136359e-01; +1.647771660567360e-01   +1.423926569858042e-01   +1.879486479939485e-01   +6.264849389945938e-01   +9.652004878759191e-01   +1.000000000000000e+00   +1.810869745255437e-01   +7.478256399679543e-01   +3.827553296794328e-01   +5.543501655034627e-01   +9.856431852359196e-01   -4.236595479042039e-01];
L3I_L2I_iGABA_netcon = [+3.934338941475008e-02   -2.560254984166022e-01   -2.777516319412830e-01   +1.278574409186932e-02   +6.920643594123422e-01   -3.281268284914532e-02   -2.160981448827380e-01   +4.884825166750455e-01   +1.767825244539976e-01   +4.953251137772363e-01   +6.401922066285555e-01   +5.090492780217317e-01; +1.345231126409278e-01   +8.400516742206966e-01   +5.087180050568268e-01   +4.301716103131539e-01   +7.820094567566882e-01   +5.089993133901772e-01   +7.354550214263947e-01   +3.925926421729347e-01   -2.317349347024237e-01   +7.780420413015195e-01   +7.487465563070624e-02   -3.382337932256141e-01; +3.059420691484262e-01   +7.442200051788517e-01   +3.498921616114739e-01   +1.560840419409075e-01   +5.333071925569415e-01   +7.119952614494439e-01   +8.085399836654754e-01   -2.076909827374746e-01   +2.213401331544665e-02   +3.550690189967077e-01   +1.714785423422747e-01   +2.132027546581900e-02; +7.019934724464592e-01   -3.200311320428155e-01   +9.804600065493034e-02   +2.416824342770176e-01   +3.845719629555476e-01   +5.163858939801982e-02   +8.580123048798900e-01   +6.474132964642472e-01   +3.418919297733508e-01   +1.440500305335616e-01   +5.275335846256365e-01   -9.517081416758731e-02; +3.825259546561808e-02   +3.367322781936297e-01   +1.492855994874982e-01   -1.060362179520006e-01   -1.261713974062164e-01   +4.301079616713793e-01   +3.832589789948781e-01   +7.237339855098508e-01   -7.910729040120580e-02   +6.619324226899670e-01   +6.687140711682689e-01   +1.998783611750366e-01; +6.962990856255854e-01   -3.606875987945056e-01   -2.562910179880904e-01   -4.249279130906303e-02   +2.959544978252449e-01   +8.054392092245871e-02   +5.379557513579541e-01   +2.045342193478993e-01   +7.794533506640852e-01   +3.197053007602353e-01   +4.444817742293408e-01   +1.437524063784711e-01; +8.100180167791694e-01   -1.911602226427183e-01   +2.059292918121090e-01   -1.270122653528346e-01   +1.000000000000000e+00   +1.914107531939489e-01   +6.028152715005088e-01   +6.214354487438732e-01   +1.311019292135257e-01   -1.477320995312106e-01   +6.828950011582492e-01   +4.136001869016746e-01; +6.156406420048479e-01   +4.369107851140520e-01   +3.356580904852091e-01   +5.813654540432889e-01   +2.878006671834921e-01   +3.897751467972307e-01   +2.242527246258726e-01   +1.505680023431770e-01   -1.626623175080324e-01   +6.622506777053572e-01   +4.699138454775739e-01   -1.903414309597549e-01];
L2E_L3E_iAMPA_netcon = [+5.234970715793088e-01   +2.976687182528734e-01   -5.606778067596324e-01   +8.566978861869917e-01   +1.605830969491562e-01   +1.450989120341600e-01   -1.202641218887627e-01   +6.824566240622427e-01; -5.258795643328430e-01   +5.246432830111583e-01   +4.192342321895587e-01   -2.192861493196419e-01   -2.085183813773925e-01   +8.336243019874512e-01   -2.808477007509674e-01   -1.250309902179604e-01; +3.372939040637636e-01   +5.352351344605742e-01   +6.458978717733959e-01   +4.427176530151347e-01   +1.849714320961668e-01   +6.520276634053966e-01   +1.190667613073306e-01   +5.697301864594468e-01; +1.357296063438049e-02   +6.270959094555363e-01   +7.221433650549564e-01   +3.875678909684176e-01   +2.297715353075038e-01   +6.965649647009660e-01   +3.451011997206729e-01   -2.107681562770784e-01; -4.759670301227554e-01   +5.270074862962146e-01   +2.101168968920850e-01   -6.938453166472357e-02   -5.251567226175666e-01   +2.774988771829569e-02   -2.578678828693045e-01   +5.979516442941567e-01; -1.965739559180759e-01   +1.112404667321606e-01   +3.379362801332844e-01   +5.285186566964950e-01   +4.100593025545397e-01   +4.784846588130210e-01   -6.153147950514952e-02   +9.426108083815457e-01; +3.850768059093190e-01   -2.517776411882510e-01   -2.628709330444575e-01   +5.559001851870795e-01   -2.375004219200831e-01   +5.076499898094424e-01   +3.464029369249069e-01   +1.000000000000000e+00; -4.159128465600918e-01   +8.825363484531883e-01   +9.577756927735835e-01   +6.539628376282056e-01   +3.217484465661447e-01   +4.663264100807802e-02   +8.941539513051419e-02   +7.089531100286902e-01; +2.069991770592566e-02   +3.940472944197850e-01   +4.157248286649752e-01   -7.888840051461828e-02   -1.710450658129771e-01   +4.479794605231914e-01   +3.523201591559987e-01   +1.110346404919268e-01; +3.966738504133394e-02   +8.165114746251808e-01   +5.211755430476670e-01   -2.067421987981510e-01   +1.709558296977850e-01   +8.019749233240150e-02   +9.448770894133002e-01   -3.686013543830762e-01; -3.247798435661872e-01   +3.493843545127220e-01   +7.828963233262201e-01   +6.926043698619835e-01   +3.338956555826341e-01   -1.561044663799156e-01   -1.379713534992518e-01   +1.060192060195321e-01; +6.493700563737161e-01   +3.527026302542102e-02   -2.651707905453341e-01   +3.677232861723299e-01   -9.991464171103343e-02   +4.172615372376554e-01   -4.302174325737555e-02   +3.150539305188864e-01];
L2I_L3I_iGABA_netcon = [+5.467143797267172e-01   +2.754689373303293e-01   +4.295415545223391e-01   -7.751083049027030e-02   -1.898358785170857e-01   -7.121356279571853e-02   +5.810059592536169e-01   +9.570579729720181e-01; +1.806262257706162e-01   -2.363614977302570e-01   -4.155096399716169e-01   +5.203121348811561e-01   -2.548366285802390e-01   +5.164314343726888e-01   -4.171713836359595e-03   -2.645281949288306e-01; +2.609336846167230e-01   +4.521007815758202e-01   +4.337569833053486e-01   +6.918520645077345e-01   +2.819393231867361e-01   -1.440241312497053e-01   -1.177555241321267e-01   +3.777488247934282e-02; +5.238108636857929e-01   +6.356458397969718e-01   +8.210418266391751e-01   +5.848548455020459e-01   +6.219542712629749e-01   -1.983048476436118e-01   +6.683571172044477e-01   +4.337231153581820e-01; +8.560320247230588e-01   +6.218431718010545e-01   +5.998428728912332e-01   +3.501637682268927e-01   +8.820168109550545e-01   +4.669929985619997e-01   +2.996524665951263e-01   +6.327580375734717e-01; +4.648187522315692e-01   -1.805588715473489e-03   +2.062382175027500e-01   +8.509276942501697e-01   +1.292307419354021e-01   +7.173237913327488e-01   -4.777240680359422e-02   +3.896481455489605e-01; +5.565889276901492e-01   +1.000000000000000e+00   +9.838337508972034e-02   +1.767690326400360e-01   -3.641283227985818e-01   +9.051391675798164e-02   -3.680107386335130e-01   -3.649750373802619e-01; -3.466616134418458e-01   +6.454026208292462e-01   +2.586567607095026e-01   -9.508160657268011e-02   -2.088354208708241e-01   +5.437139489750910e-01   +3.821723015105069e-01   -1.973880426143987e-01; -1.686285672197308e-01   +4.211521705379899e-01   +5.086457913378459e-01   -1.874639845456281e-01   -4.225877326069106e-01   +2.889095498251627e-02   +5.130298858029386e-01   +8.248422485071136e-02; -9.811344288616861e-02   +2.315971483416377e-01   +6.840479351722241e-01   -3.635593017935701e-01   -1.207965533144543e-02   -2.505064690786156e-01   +3.606984932581466e-01   +2.899717143833254e-01; -1.206654520307541e-02   +5.167805213808258e-02   +8.304784724698372e-01   +6.420182391618651e-01   -1.224059570525493e-01   +7.971111065556361e-01   +8.587187115513244e-01   +7.301005648624254e-01; -2.831471936578231e-01   -3.285740601549796e-01   +3.106134680254048e-01   -1.227278815781683e-01   -1.015240608471788e-01   +2.709206876425462e-01   -6.247028955913595e-02   +3.449288843286406e-01];
L3I_L3E_iAMPA_netcon = [+8.820253488838005e-02   +2.653052665401504e-01   +6.375499857230726e-01   +3.702172451017845e-01   +1.758094771296906e-01   +1.874144727754879e-01   -2.423307785145512e-01   +3.247589565026937e-01   -2.308438560904502e-01   -2.526038501822349e-01   +1.182878754766238e-01   -1.303378001911907e-01; +5.955606322601616e-01   +6.914625956628567e-01   +4.125126194092227e-01   -1.912422254810189e-01   +6.311696528232498e-01   +4.859497411099411e-01   +6.091272172174061e-01   -2.258784936515335e-01   +3.680192334906398e-01   +5.833272439078996e-01   +6.726501389449016e-01   -5.168658186741606e-02; +5.732845137996194e-01   -2.823122009543073e-02   -5.059302382451075e-02   +7.006098552839106e-01   +3.943910752697371e-01   +2.972760272044198e-02   +2.123852355935701e-01   -1.732916551303963e-01   +3.295332941732518e-01   +5.244002223281411e-01   -1.639377958736080e-01   -3.919686588456940e-01; -1.827179254422954e-03   +9.381132597119154e-01   +1.344886211293485e-01   +3.252020672921944e-01   +2.766394370481727e-01   +2.602709065462828e-01   +6.180035160040339e-01   +6.087928350007464e-01   +1.846257483535862e-01   -2.036848791880838e-01   +8.680737689216007e-02   +7.113081015536390e-01; +1.084631937127270e-01   -3.196974937322758e-01   +4.290899551703775e-01   +4.431765016302556e-01   -3.359790043873784e-02   -1.132918465994363e-01   -7.024263758530244e-02   +4.434553574410658e-01   +3.952218836922082e-01   +6.327328490579485e-01   +5.917586026419798e-01   +8.158894051155768e-02; -1.060814585279890e-01   +5.886355342859064e-01   +3.803276632236209e-01   +3.804156986816384e-01   -1.690314053479311e-01   +7.753539579382182e-02   +2.640706402228676e-01   +2.932583060926688e-01   +6.760148762986564e-01   +2.121886681067886e-01   +4.356385967826992e-01   +4.063268012572543e-01; +8.196130175644213e-01   +1.000000000000000e+00   +7.390870079945253e-03   +1.254210613911194e-01   +6.917031242502963e-01   -1.547793419427123e-01   +8.118258944903758e-01   +7.503882395347473e-01   +6.733980317378093e-01   +5.356108195706666e-01   +6.875573908269518e-03   -1.360018116926955e-01; +2.859192320561587e-01   -2.055089814115993e-01   +2.600080911927727e-01   -2.741315705709173e-01   +1.727204401110388e-01   +1.275226373620025e-01   +1.659334772001218e-01   +2.922637913098514e-01   -5.222445438525625e-01   -2.542777813157499e-01   +6.982164843740053e-01   -2.464788603126529e-01; +1.134836668504616e-01   -1.772373617811036e-01   -4.606965419061519e-01   -3.628637678753616e-01   +5.983077603605501e-01   +5.132730350796859e-01   +2.493519422692888e-01   -5.044852325715816e-01   +9.309202176186133e-01   +7.954756159289529e-01   +1.192540617200595e-01   +6.224448353449537e-02; +2.983589436169361e-01   +7.098185813850120e-01   +2.378943024470054e-01   -2.269619660067853e-01   +6.173393317300817e-01   +3.086395032921475e-01   -1.941551578409618e-01   +6.362845820851221e-01   +5.707682125007090e-01   -1.683925339161541e-01   +2.083872998947527e-02   +5.840899787602043e-01; +3.291622322270288e-01   +3.341870167693947e-01   -6.553877017785201e-02   +4.747126848961812e-01   +3.240917445014745e-01   -1.610571572643870e-01   +6.356928483939017e-01   +6.047177274198720e-01   -5.730726838270907e-02   +3.333761822538945e-01   +4.043431170013472e-01   -2.601675829752642e-01; -1.186392735157653e-01   +1.021007529151887e-01   +6.158699572535551e-01   +6.051359209574468e-01   +2.854947967609514e-01   +7.058928339736373e-01   +6.910142453764437e-01   -5.262187181495170e-01   +8.063049233387003e-01   +3.239213337835097e-01   -5.041187773781613e-02   -6.174766200156376e-02];
L3E_L3I_iGABA_netcon = [+1.356484783249613e-01   -9.487394848302179e-02   +3.024663381692844e-01   +2.666149047896540e-02   +1.834012250498816e-01   +8.380189814692809e-01   -5.079371763748828e-01   +4.832969827209199e-01   +7.882700659824358e-04   -1.989874583621273e-01   -1.037631204488931e-01   -2.012662124587612e-01; +4.829216721133237e-01   +2.404581902608807e-01   -3.808932253643790e-02   -2.701595802389756e-01   +3.236388846679443e-01   +3.408101831143779e-01   +1.652459700401649e-01   +6.089889225723089e-01   +5.792986731973584e-03   -2.913522473789001e-01   +3.378425739961012e-01   +1.326015773272118e-01; +2.532174933657978e-02   +7.441043867831503e-01   +1.709880647059697e-01   +2.217707382655289e-01   +6.013580411080396e-01   +4.644554667339469e-01   +4.449214052877962e-03   +2.043654252485502e-01   +4.056931337680150e-01   +6.184461898345965e-01   +2.186151481513257e-01   +2.887703298454026e-02; +2.694719716820621e-01   +2.700218217146496e-01   -3.809192381246101e-01   +5.052173351779736e-01   +4.675442486561693e-02   +3.388926515502834e-01   -1.386233307749685e-01   +8.155523692537821e-01   +8.951233167070439e-01   +4.912618240897369e-01   +1.918553552102264e-01   +9.461533580090334e-01; +1.869142869326093e-01   +1.574877886970840e-01   +7.080184484717901e-01   -3.451182493555728e-01   +8.371315480689823e-01   +5.468383653595142e-01   +7.264893651538339e-01   -9.885480924410496e-02   +7.222403205525278e-01   -6.873135507709419e-02   +7.884701961249382e-01   +9.321801521537890e-01; -2.751380239450014e-01   -2.841147318215155e-01   +8.755920814496251e-02   +5.224359863533355e-01   -2.198438658936601e-01   -1.758589958072729e-01   +3.592042693686111e-02   +7.015446357182566e-01   -2.621010754316941e-01   +1.869046763307945e-02   +6.774966710384096e-01   +1.161225047967666e-02; +5.906484450592885e-02   +5.625306483935901e-01   +6.094721239142227e-01   +1.450839272202127e-01   -2.517355362982331e-01   +5.958528545824632e-01   +9.740322432324812e-02   +7.035190957710574e-01   -1.831534963383846e-01   +4.295958008750025e-01   +4.827201752680172e-01   +1.000000000000000e+00; +3.745996381682387e-01   +4.406776228454786e-01   +7.172901734909153e-01   +4.410942916000593e-01   +2.554955209327098e-01   +4.549302944464138e-01   +2.000153833287772e-01   +4.313031582116972e-01   +1.539392755819291e-01   +6.961527080839195e-01   +5.048312394184622e-01   +2.655413895933958e-01; +5.898517129202289e-02   +1.020737607995580e-01   -2.782866065412792e-01   +6.588519648275257e-01   +8.073607682444258e-01   -3.224179600949812e-01   -3.673404036696251e-01   +6.427819303690551e-01   -1.875623635540068e-01   +5.208826667157500e-01   +4.976893272496347e-01   +1.207291933700983e-01; -7.625593102290876e-02   +6.536732036089720e-01   +5.182681375699423e-01   +2.728092698644265e-01   -3.549491255852926e-01   -8.868535349379988e-02   +2.331509940704681e-01   +7.855318334351178e-01   -9.659326197501010e-02   +1.862636449232941e-01   +2.209849906305690e-01   +3.474975106609248e-01; +7.425297893606071e-01   +2.864652722970928e-01   +1.653379435658876e-02   +3.193620291854842e-01   +8.412576022164081e-01   -1.656494574845012e-01   +6.299293893372566e-01   +7.924843608509699e-02   -7.180415583960571e-02   +7.536264875317467e-01   -3.215918149455225e-01   -3.664808055432878e-01; +5.490129770746692e-01   -1.059841118366888e-01   +3.612599637787212e-01   +1.410949065957238e-01   +3.126664987436811e-02   +4.716949472952640e-01   +8.721269615203588e-01   +3.501476571383840e-01   +6.056202639447366e-01   -3.065631921775491e-02   +5.021907170176814e-02   +2.564217545693449e-01];
L2E_Input1_iAMPA_netcon = [-5.478722349908185e-01   +4.095240821481066e-01   -8.218863212703974e-01   +7.027096426450349e-01   +9.003540257740802e-02   +1.000000000000000e+00   +5.009960384007877e-01   +7.225666564364353e-01];
L2I_Input2_iAMPA_netcon = [+1.167905522548481e-01   +1.055711860513197e-01   -2.149654143672139e-01   +4.610933799734278e-01   +1.000000000000000e+00   -7.356340304700375e-03   +5.284444676918014e-01   +3.845267571983205e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.4*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.4*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.4*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.4*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.4*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.4*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
