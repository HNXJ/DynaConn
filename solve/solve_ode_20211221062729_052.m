function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-3.803440930120155e-01   -2.711163666932443e-01   -3.527061914964577e-01   -5.508891961107045e-01   +9.592273494436514e-02   +6.010748540791535e-01   +1.434622592286861e-01   +8.087183774373374e-01   -1.111315864272557e-01   +4.572085611699518e-01   -3.967542022982331e-03   -2.891979753253508e-01   -2.603286051572969e-02   +7.810515023045479e-01   -2.294146375745249e-01   +2.528255938704494e-01; +5.952425852374276e-01   -6.589883689365580e-02   -1.671779652942854e-01   +4.864097921622198e-01   -2.804535548796903e-01   +4.532523954290798e-02   +4.371588925096794e-01   -7.613647303644047e-02   -3.572787008977277e-01   -6.823923841066963e-02   +5.457277566272978e-01   +4.989841090043675e-01   +1.933706155810428e-01   -7.585969364023516e-01   +3.631751366472571e-02   -1.368580425884366e-01; +3.408732472469697e-01   +8.459074637800261e-01   -5.201394811163047e-01   -1.888531594527055e-01   -1.833557928148415e-01   +2.159607352528637e-01   +1.677585193264632e-01   +5.297834516591338e-01   -5.139582283238837e-01   +1.921207626439738e-01   -2.177095641912416e-01   -3.459394848396007e-01   -2.333084664995305e-01   +4.909375270448320e-01   -1.168645883260755e-01   -9.007317061712593e-01; -5.888592704039095e-01   -2.886409252768506e-02   -4.639087227220184e-01   -2.431703118248542e-01   +6.538800897477937e-01   +5.865535064051215e-01   +7.351683139294223e-01   +4.910084286708011e-01   -3.750876432171719e-01   +2.032472865993651e-01   -8.600730242213523e-01   -1.176481817164105e-01   +7.285996316281937e-02   -7.027942625252630e-01   -3.972092174512221e-01   -2.951601560789432e-01; -4.604558029758767e-01   -8.767059412643044e-02   +6.195086144860926e-02   -7.379010181269734e-01   -3.471029704418116e-01   -6.875273020709123e-01   +1.214727679697211e-01   -9.193279530521681e-02   -3.239529935922756e-01   +2.736500439167383e-01   +1.862151263639256e-01   +4.566040225734321e-02   +9.235642868586233e-02   +8.791713393419615e-01   -5.694419624189045e-01   +6.643180774964592e-01; -3.875724199156100e-01   -2.552329679966077e-01   -3.701054423147878e-03   +5.337949493872245e-01   +6.544077582569036e-01   -4.950786710057697e-01   -4.511087470338789e-01   -4.666811333080479e-01   -1.408429531142129e-01   +9.648646090422480e-01   +2.559512052489605e-01   +7.407317609786063e-01   +1.966145298193646e-01   -1.796568615613978e-01   -6.307090632950280e-02   -4.238675091589678e-01; -5.892942855497473e-01   -4.215352504030843e-01   +8.208408190577909e-01   +5.867674743292363e-02   -4.396427647571608e-01   -7.123984377568922e-02   -2.443992204378684e-01   +9.160409968120602e-02   -2.837712178177317e-01   -8.872785994615523e-04   -1.000000000000000e+00   +8.598037574205575e-02   -4.606547812846030e-01   +6.165119373187071e-01   -4.248307409637963e-01   -4.610658799861810e-01; -8.477979060470564e-01   -2.487375879244446e-01   -4.413076669768620e-01   +3.279521663492532e-01   -7.578971983430091e-01   +2.592113168215531e-01   +1.036157211904586e-01   -6.796816986132652e-02   -6.716205743879334e-01   +1.505441999066207e-01   -7.019352477682475e-01   -2.095473634693603e-01   +1.455975388921279e-01   +2.100285604943579e-01   -6.868750148496037e-01   -3.740508924560532e-01; -9.468650362450749e-01   +9.929656474764791e-02   -6.226777006842421e-01   +3.568967487556507e-01   +7.609430854600762e-01   +2.195973873715549e-01   -6.105972837472587e-02   +4.014952658474437e-01   +6.069420723607829e-01   -8.830710562195524e-01   -6.498603426678485e-01   -1.654000397025388e-01   +1.750899022594336e-01   -3.508038214456681e-01   +3.188265987495414e-01   -1.305458296734202e-01; -5.612059304228766e-01   -1.670520102215295e-01   +5.821865221360167e-01   -2.422082757595966e-01   +8.353209842026982e-02   -2.017511594207815e-01   -2.198883655491141e-01   -9.696356781358894e-01   +2.982303570075914e-01   +1.146758523633262e-02   +4.393147434319395e-01   -7.047395127053981e-01   -1.741452086649091e-01   +3.919055346530829e-01   -8.316996986581955e-03   -2.716609583307811e-02; +8.308476777914844e-01   +4.454636731316430e-01   -7.196436693450886e-01   +2.542645935523350e-01   -1.340188832173552e-01   -4.828694201293630e-01   -3.927948666466999e-01   -3.908639113519331e-01   -3.324438435301355e-01   -6.026025642024506e-01   +1.727175944068621e-01   -4.145804344491437e-01   +3.659092333211322e-01   +2.900906996188328e-01   -4.424480177458849e-01   -6.613580030889341e-01; -3.417880926958254e-02   +7.878470248238012e-01   -9.793585075482202e-01   +1.656474527104632e-01   +2.889126116762408e-01   -5.142193743143612e-01   -4.352300560765344e-01   +3.098188309274686e-01   -2.784832439298178e-01   +4.021011743423539e-02   +4.816961893501112e-01   +1.482479226275659e-01   -1.880756816097985e-01   +2.949148842094447e-01   -3.152074942507512e-01   +4.069196288141439e-01; +1.942208846810402e-01   +1.042436902706558e-01   -4.795296481473997e-01   +4.136625555897882e-01   -1.226476573943907e-01   +2.375091791013862e-01   -2.599285676339774e-01   -3.133210094287930e-01   +3.871398979946020e-02   +4.981162153249903e-01   +3.798653516123548e-03   -8.623985804035476e-01   -5.593986284088224e-01   -2.656824584586980e-01   +4.303050412907315e-01   +3.258914493661477e-01; -1.708747158883493e-01   +9.776498422226537e-02   -6.157557705626734e-01   -5.242837057669374e-01   +2.737477674008275e-02   +6.260234168713289e-01   -3.590658929884334e-01   +3.687100525177089e-01   -5.349884540424972e-01   +3.530205759983067e-01   +3.729158863901753e-01   -3.162774549808087e-01   -2.660706979385515e-02   -7.148047231835455e-01   -5.724958362032679e-01   +3.822252788235980e-01; +5.188058700441700e-01   -2.532324355882478e-01   +1.588492086383247e-01   -7.469366809250146e-02   +2.413522067386957e-01   +3.438755626929186e-01   +1.728895612780927e-01   +6.635374659761985e-02   -1.104064709622301e-01   -5.220916691258058e-01   -5.950464378275314e-01   +9.592700328056796e-01   +3.197444078078758e-01   +2.364375098860741e-02   +5.502954695454833e-02   +3.623905475791244e-01; -3.383111188038250e-01   -3.891996810129200e-01   +5.252854381361198e-01   -1.393900641954544e-03   -8.097091242290473e-02   +7.573258109066631e-02   -4.652180358859079e-01   -2.943352086879059e-02   -4.272868199955169e-01   -7.261087886935117e-01   +3.053816641737692e-01   -3.020508674439487e-01   -5.716866435105912e-01   -3.415202032678452e-01   +6.051608105003671e-01   -2.363813246379424e-01];
L1E_L1I_iGABA_netcon = [-3.619919578662542e-01   +1.300126808380460e-01   -3.126382697357020e-01   -3.833241438391333e-01   -2.999086168259392e-01   +5.305099251342608e-01   +4.727484098243008e-01   -2.740260788567991e-01   +5.183974593839881e-01   -2.617714701032386e-01   +6.323953050421245e-02   -6.452620596817625e-01   -1.217610385225703e-02   -8.295195353679941e-01   -4.946838255094270e-01   +3.784205862325400e-01; +2.852534388933342e-01   -7.896458927660718e-01   +3.220854024776426e-01   +3.589208819360510e-01   -1.590193080577597e-01   -2.627711767536239e-01   +7.571308446666709e-01   +1.867952266352987e-01   +1.272060755333222e-01   +2.478736142841602e-02   +4.862376440755258e-01   +9.453921950626744e-02   +5.183554855932926e-01   -2.266648098234279e-01   -1.830385569162579e-01   +7.207055197750668e-01; +3.095861391694192e-02   -2.876504286876548e-01   +6.728252465029138e-01   -3.621552996197079e-01   +1.016827922478420e-01   -2.596605203172497e-01   +1.293359631867116e-01   +8.940537135181501e-01   +6.103305987582871e-02   -3.001861432154249e-02   -1.416335985012050e-01   -7.737147221712658e-02   -3.248981297396586e-01   -4.600108563804184e-01   -5.360741554227180e-01   +6.024190151784067e-01; -1.856864467993435e-01   -4.917083555710254e-01   -9.929628166087186e-02   -7.289151702128721e-02   -2.711453885685785e-01   -5.182977309355884e-01   -1.628733464119498e-01   +3.616547290254542e-01   +3.490898934061613e-01   +1.000000000000000e+00   -6.581200200650573e-01   +5.461598118228874e-01   -7.916346123554459e-01   -4.709233521680262e-01   +5.553416762352993e-01   -3.780059474146844e-01; +2.861304216393026e-01   -5.175838873941860e-01   +4.211472097580767e-01   -3.920503616937205e-01   +1.582852128371676e-01   -3.409801937826196e-01   +4.151705920741937e-01   -1.020951639591320e-01   -4.572842771554069e-01   +7.619825972896911e-02   -3.436161041107455e-01   +1.870353959514781e-01   +1.902809863521334e-01   +5.610829851842812e-01   +7.072422755491731e-02   -2.019935246155668e-01; +3.972789963981459e-02   +4.017785078445047e-01   +6.579751512578520e-01   -4.821992672436060e-01   -1.148512696535803e-01   +1.069251965132973e-01   +7.329972499655633e-02   -7.695872965562377e-01   -1.027846839110876e-02   +2.749084811065198e-01   +8.443104434591860e-01   -3.236498839484422e-01   +7.242358262612001e-01   +5.794399876643359e-01   -7.319026552770025e-01   +7.264965780141297e-02; +4.770333299033206e-01   -2.382445070720196e-01   -1.231841504362655e-01   -1.534209766128203e-01   -9.691840095529741e-02   +3.337521710789212e-02   +3.214889738503001e-01   +2.078406528381925e-01   -2.343852247312984e-01   -5.732265054527858e-01   -2.164915240413262e-01   -8.888282815918251e-01   +5.901478510679122e-01   +5.694753494640641e-01   -5.202911017040691e-01   +4.312997426122090e-01; +1.125079835514637e-01   +1.290414509482749e-01   +5.941802194708098e-01   +3.999997948487284e-01   -3.636951803169711e-01   +2.227407483300050e-01   +3.026479857125109e-01   -5.837298622613317e-01   -4.672039323920746e-01   +4.810754115322397e-03   -1.285893485150673e-01   +2.708423135895213e-01   +3.857366750285306e-01   -5.201153331574884e-01   +1.085560224484707e-01   -5.629793168536900e-02; +2.410847680740084e-01   +1.873161968542887e-01   +7.772758133880767e-02   +2.831791776267426e-01   -2.145283871022233e-01   -3.341464973445415e-01   -2.154875845644680e-01   +3.415557146791928e-01   -2.003767319334873e-01   -4.425226003282717e-02   +2.831585092327825e-01   +8.399320784363977e-02   -2.216789307526226e-01   +3.461639008951010e-01   -1.839475794412822e-02   -4.497172238459801e-01; +5.277790161990383e-01   +1.335063964998938e-01   +1.400348486783164e-02   +1.089564298325799e-01   +7.780418218814379e-01   -2.407925617245930e-02   -5.808245130483529e-01   -4.521835400811572e-01   +4.438195456676780e-01   +1.928388124976683e-01   -2.675498683221226e-01   -4.334360149498139e-01   +4.482720112019801e-01   -3.431915438567246e-01   -6.915213417350761e-01   +3.179877602339319e-02; +1.364476962223558e-01   -3.379499078983660e-01   +5.972946985774003e-02   -3.165039737208769e-01   +2.450428634034122e-01   -5.791843864779795e-01   -3.532788924562869e-02   +7.044066773989404e-01   -3.537971438031748e-01   -2.504907061789987e-01   -5.477371365257984e-01   +1.301005228126508e-01   -5.950382660725821e-01   -2.811586671198236e-01   +3.984667368717437e-01   +1.425861138165277e-01; +1.015025470908980e-01   +2.596737341987776e-01   +3.937006072383855e-01   -9.137817413286053e-02   +2.598925539356289e-01   +3.169721150392573e-01   +6.260240424719760e-01   -4.838955745016379e-01   -4.244914049233738e-02   +6.052226988114674e-01   -1.065328976176411e-01   +7.224824934322845e-01   -2.441182128948733e-01   -2.396251676833240e-02   -6.147556177427593e-01   -6.748393200942697e-01; +4.585210435933362e-01   -6.317405947544721e-01   +4.960625528783379e-01   +2.765300607682666e-01   +4.180121824864206e-01   +9.826029802202195e-02   +2.608563549455528e-01   +2.670086473111828e-01   -1.854694678533153e-01   +3.537646142930277e-01   +1.831047803362104e-01   +4.547045209817256e-01   -4.445839316669276e-01   -4.194527914816863e-01   -2.406577743410927e-01   -6.711190339401389e-01; -4.081300182951824e-01   -4.519808269086286e-01   -4.331224737953130e-01   +2.465614734185067e-01   +2.412051272184697e-01   +2.585175203451178e-02   -2.558139407443089e-01   -9.621341122587199e-02   -5.133223244815097e-01   +3.886864500953048e-01   +5.322002930741676e-01   +2.176119944833255e-01   -3.287626611393994e-01   -2.742214212612146e-01   +1.959910061235678e-01   +5.476464110698139e-01; +8.863269172919289e-02   +1.260955491431359e-01   +1.137604334053573e-01   -4.684402128828367e-01   +6.548900446243190e-01   -5.306519356468817e-01   -5.211684052283253e-01   -3.776473578557216e-01   -1.740079151552501e-01   -3.855520718416698e-01   +6.305895447092255e-02   -1.868935079869661e-01   +1.216860682372572e-01   +1.383460904702137e-01   -3.774814389746411e-01   +5.044406475043036e-01; -2.866151890486424e-01   +7.195765517442648e-02   +2.400925069747379e-02   +1.125717691835821e-01   +4.089756525440920e-01   +1.106939471117950e-01   +1.932340508793214e-01   -2.745495047126031e-01   +4.386152208494493e-01   +1.642085366011885e-01   -1.817703111224740e-01   +3.024031511044252e-01   +4.361824322265357e-01   +9.848844720221506e-02   -6.348478609096594e-01   +5.718083462832087e-02];
L2I_L1I_iGABA_netcon = [+1.994371591611982e-01   -6.966282442066776e-01   +8.010576353248819e-01   +1.832420053568204e-01   +1.222088242935489e-01   +4.294155389567880e-01   +1.425296592959028e-01   +7.307234897970125e-01; +1.301664314880020e-01   +4.210957410252487e-02   -1.122911510125942e-01   -5.955502395616615e-01   +4.017051576511819e-01   +1.854021477177718e-01   +4.627861441094853e-01   +4.558220212754809e-01; +4.956396609847788e-01   +2.005852730431669e-01   +2.198093158193831e-01   +6.333883875062372e-01   -4.491912904383672e-01   -3.252797514077997e-01   +1.512567300991379e-01   +8.067896650421003e-01; +2.250648379216409e-01   +2.478025261049969e-01   +3.782582832188819e-01   -5.139693485485488e-01   +6.872509794235488e-01   +6.496436699372844e-01   -4.464800560469569e-01   +6.309687745071520e-02; +1.215211460442365e-01   +5.393322912522860e-01   -6.097878079065808e-01   +2.462353661157944e-02   +1.570444206340662e-01   -2.575810860973960e-01   +7.748439940909784e-01   -1.019091524429143e-01; +5.352611069315679e-01   -1.798315437323403e-01   -2.959647432812971e-01   -4.294394129639911e-02   +2.263115947936118e-01   -8.724496365279024e-01   -6.792146071088702e-02   +4.466209333904469e-01; +6.638794198053436e-01   +2.977327476716674e-01   +1.163398347249287e-01   +2.646727629337252e-01   -9.499719161599380e-01   -2.048348292033566e-01   -8.041958035949833e-01   -5.981716850044007e-01; +1.930288724469409e-01   +1.541799982274424e-01   -2.887722707431087e-01   +5.619544161568482e-01   +8.696056796908057e-01   -5.018432778186183e-01   +5.105487277674311e-01   -2.534779631823239e-01; +2.186745927073580e-01   -7.114576342892912e-02   +1.216175516532468e-01   +4.132751837866994e-01   -1.442443617691183e-02   -5.385343496726285e-01   -2.980375262011122e-01   +5.668203533454090e-01; -5.900333140854354e-01   +4.365462358696313e-01   +3.824120265521013e-01   -3.571931994610354e-01   -4.494215089824543e-01   +2.757640246451378e-01   +1.000000000000000e+00   -9.080350418757761e-01; -5.217090043275583e-01   -6.989653474197657e-01   +2.870949898733247e-01   -4.575053595460907e-01   -4.583998494773808e-01   -2.936901990721238e-01   +5.338130919657035e-01   +5.932243472627247e-01; +2.358186381338804e-02   +4.124809678497851e-01   -3.978301033085496e-01   -2.888396780243926e-01   -3.116968650193834e-02   -2.983197694438318e-01   -6.211645858708088e-01   +5.425896983899998e-02; +4.184800639714993e-01   +5.077728618164344e-01   +1.800687286683660e-01   -1.588289084536499e-02   +8.555942080130352e-02   +2.040419301543383e-01   +5.861760006595411e-01   -1.441747888413696e-01; +6.093904806880024e-02   +1.384344554601813e-01   -6.413671493521526e-01   -4.167424151896613e-01   +3.777053857813030e-01   +3.955001823553957e-02   -1.035843971294735e-01   -4.713247100257020e-02; +5.854001907713959e-01   -2.032337568177996e-01   -4.171569530582542e-01   -2.081449317398212e-01   -1.669015873019361e-01   -2.274161623570993e-03   +6.255482635872781e-01   +6.682731875038359e-01; -8.170201085021760e-01   +1.017398724020201e-01   +7.046472719555197e-01   +1.842352742084657e-01   +4.231304322434226e-01   -9.156023924577839e-02   -5.569147641200085e-01   +2.126932997075666e-01];
L1I_L2I_iGABA_netcon = [+1.648643041010024e-02   +8.691457535414394e-02   -7.313242290512323e-01   +2.916408709096802e-01   -4.258825623317648e-01   +3.209044758916102e-01   +4.216382813662934e-01   +3.830560188871940e-01   -5.027776842444497e-01   +4.893512483621148e-01   +8.294974546564442e-01   -5.441032743762481e-01   +1.604858749896857e-01   -6.326533520160684e-01   -3.369916529026871e-01   +1.923650533435985e-01; +5.112073488188181e-01   +4.796076205244795e-01   +8.494649989944736e-01   -4.121818326051599e-02   -1.367044506875716e-02   +3.609055292487224e-02   +3.071105047196723e-01   -7.326760399136638e-01   -4.404652330805325e-01   -4.904330314661358e-01   +3.147318054619582e-01   -6.436995228413680e-01   +5.296912696422722e-02   -1.552126940879147e-01   -7.514557546729198e-01   +7.379908585638300e-01; +4.076632451665814e-01   +9.808891306760162e-01   -7.683701516204694e-03   +9.558382760504380e-01   -1.346074075234964e-01   +2.055823945252468e-02   -7.009019945985839e-01   -5.741536877987998e-03   +3.620772628065367e-01   -1.015351851698537e-01   +4.846472318266971e-01   +6.489894505660386e-01   +2.963254024067121e-02   +6.786784324048629e-02   +2.079584753789065e-01   +4.306251059227566e-01; -2.182344192584947e-01   +3.731041530225475e-01   +7.384344930088447e-01   +2.985097464200406e-02   +8.370103328942526e-01   +6.664132797815715e-01   +5.376728730727430e-01   -5.435554332628073e-01   -3.350127936374195e-01   +4.402729615835625e-01   +1.904653059329087e-01   +5.365687037583180e-01   +1.204854579303978e-02   +3.422378873698611e-01   +3.435669956308205e-01   +3.359536338334885e-01; +4.420214139157114e-01   -3.741657924537123e-01   +7.589134035787728e-01   +1.803952041872633e-01   +4.598256268943866e-02   -8.531303488365697e-01   +1.109012961319816e-01   +2.615789960092360e-01   -3.350779157135287e-01   -1.650745807542972e-01   +2.537574334310346e-01   -6.171469365346582e-01   +7.789376103097361e-01   -3.767129188174692e-01   -3.806391560121831e-02   -5.967302692429328e-02; -2.846039654471568e-01   +9.006572236484887e-02   -5.899586272832698e-01   -2.381402531037961e-01   -5.563769309067695e-01   -6.334208228265263e-01   -7.417029113408831e-01   +3.011410924279503e-01   +4.689936034354943e-01   -2.124740714704565e-01   -3.157304108359633e-01   -5.634543235667326e-01   +2.396274572746071e-02   +3.604692394939700e-01   -7.368339182629766e-01   +1.646427041367326e-01; +5.309543683539359e-01   -2.365012594230519e-01   -1.777336664767362e-01   -4.957029078142882e-01   +8.439818208813071e-01   +2.829709884592084e-01   -1.936597778173437e-01   -6.885981041076994e-01   -6.463674405083758e-01   -2.431309173547284e-01   +3.489399570114109e-02   -3.447064353581729e-01   +3.128531327777169e-01   +2.705075869364584e-01   +9.541553512288724e-02   -4.337147884556902e-01; +3.812849311000678e-01   -6.557901358557154e-02   -2.109860343404794e-01   +3.396575468124365e-01   +8.553137083664282e-02   -7.862298319775728e-02   -6.594139881373147e-01   +1.000000000000000e+00   -4.015671967703688e-01   -3.392582967718944e-02   +1.204224401799678e-01   +1.790502000116776e-01   -8.040025795175538e-01   +7.393260097692360e-02   -3.483726063196024e-02   -4.140375083383066e-01];
L2E_L1E_iAMPA_netcon = [+4.417470670700872e-01   +4.937354281748541e-01   -4.963041025920705e-01   -3.473897993266650e-01   -3.893053332976132e-01   +1.422109951675986e-01   -2.373896176774312e-01   +6.485004012576241e-01; -7.047858170588380e-01   +7.429809126757669e-01   -6.131823444244539e-01   -3.409204295292467e-02   -8.222431402957276e-03   -5.268268450425488e-01   -4.978759606552198e-01   -1.513905143070984e-01; +2.931793086818402e-01   -4.386797891711471e-01   -2.735405962917269e-01   -1.814260831270329e-01   -4.122310244914382e-01   +3.278438886200337e-01   -4.650175018829607e-03   -8.517458927857373e-01; -1.857649670957512e-01   +1.632619917945290e-01   -2.196532338269384e-01   +7.751636558939032e-01   -6.514584983708762e-01   -3.811928329805667e-01   +4.108439973603883e-02   -3.952848959049244e-01; +5.843877394511426e-02   +9.081952262557386e-03   +5.582257661918014e-01   +6.303014640100417e-02   -2.483825654052614e-01   +2.796843486845872e-01   +2.855181188617640e-01   -1.424459649689644e-01; +6.591054002900041e-01   -5.698756894408405e-01   +1.604165408435183e-01   -2.166652060049792e-01   -9.212974253910634e-01   -3.764342839176995e-01   -4.921316607494175e-01   +9.757137763614204e-02; -8.537045923514865e-01   -1.767494297849629e-01   +3.451751708917984e-01   +9.838951272480315e-02   -4.575219426397524e-01   +1.554560265481389e-02   +3.263862280514480e-01   -4.191022848030129e-02; +9.805504060833717e-02   +2.234850814309868e-01   -5.602450462855598e-01   -7.349374698410979e-02   -1.000000000000000e+00   +6.275289263581035e-01   -2.461198506687885e-01   +6.162132137514622e-01; +4.776101704654724e-01   +5.024102309223968e-01   -3.799310634764451e-01   -3.860144624617759e-01   +1.730992900178967e-01   -6.875214425579641e-01   +1.992675060090928e-01   +1.654966575007442e-01; +3.652981644534007e-02   +5.045967230577132e-01   -4.196483243372418e-01   +3.988159484201734e-01   +1.305056777040238e-01   +3.116769779111683e-01   -5.527949854586961e-01   -3.443212266486367e-01; -2.489948619458912e-01   -7.709592825489368e-01   +8.178958532187179e-01   -6.101921931377383e-01   -4.777364103713317e-01   -4.766231920880732e-01   -6.692400518130369e-01   +5.704051080600167e-01; -9.637234925642753e-01   -2.097537122363320e-01   -1.839650226810347e-01   +6.301851517612596e-01   -1.769276119042017e-01   -3.525527563281328e-01   -5.600147916122523e-01   -2.895543760130792e-01; -4.995044065487957e-01   +3.861917972795325e-01   +2.729075722004591e-02   +1.195372342238343e-01   -5.766556416119163e-01   -5.605162083670527e-01   +2.507963150797467e-02   +3.585254743977435e-01; -8.593211316967504e-01   +7.341297961200507e-01   -3.991319261973611e-01   -7.416020554612504e-01   +9.972735717521694e-01   -1.119104279455983e-01   +7.339971813650455e-01   -5.221012832103188e-01; -5.299658245791907e-01   +7.183037276952857e-01   +4.443567932905272e-01   -8.112094139163359e-01   -1.856682750117810e-01   +3.538973204141538e-01   +7.533935909013596e-01   -3.059716552043796e-01; +3.661746528958791e-01   +3.316629654569823e-01   +1.468143420950007e-01   +9.543461160507523e-02   +4.648130174574880e-01   -2.040637065776877e-02   +2.736923662614207e-01   +4.424020837826980e-01];
L1E_L2E_iAMPA_netcon = [+2.695421497116874e-01   -2.386098398092922e-01   -2.461707508468435e-01   +3.802620091532769e-01   +6.238973022628970e-01   +6.843007011893606e-01   -3.848579421310594e-01   +1.807270519383636e-01   -3.384734509130575e-01   +5.764069415737662e-01   -1.775859745640368e-01   +3.250205945811928e-01   +6.369886130961562e-01   +7.166620119985897e-01   +3.762966531982080e-01   -6.662758683652022e-03; -3.296169691890997e-01   -5.068472484427895e-01   -3.124644999996256e-01   -5.104920326239177e-01   +1.933954200275481e-01   -5.016676102583376e-01   +3.316961450445122e-01   +5.962232477315162e-01   -7.115581570372441e-01   -3.643052059154017e-01   -1.058455891420237e-01   -7.209142362262699e-01   +3.708128497257487e-01   -5.814847736504082e-02   +4.788661009177488e-01   +7.193636740222886e-02; +2.375058938854938e-01   -3.288902158003012e-01   -1.808069354588681e-01   -1.792092753104091e-01   -5.257613146816077e-02   -2.560296372662035e-01   -4.768665055619339e-01   -5.746863306437875e-01   +1.464404576873075e-01   +9.526347552529064e-02   -4.868940935824124e-01   -5.115363206492568e-04   -3.422770644793725e-01   +6.385065598061558e-01   +3.079667728570373e-01   -3.364806161266649e-01; -6.531132912508192e-01   +5.127020221347762e-02   +6.441273075316337e-01   -3.720781364507360e-01   +4.808174315867231e-01   -1.243027493919429e-01   +1.000319698835787e-01   -2.164337001159518e-01   +1.403511374142693e-01   +2.611559067001511e-01   -3.732358427714346e-01   -3.358150004920433e-01   -2.341768739110041e-01   +4.566160098647068e-01   +3.359443049763593e-01   +1.216299059456459e-01; +4.786172018245549e-01   -2.793472335172073e-01   +6.370388884499180e-02   +4.074508726865707e-01   -3.337186096938675e-01   +1.004010632258003e-01   -9.837914038356602e-02   -8.733134881321599e-01   -3.638667116346890e-03   +5.684159131567831e-01   -4.310074747489904e-01   +1.571049906994947e-01   -4.806781618949396e-01   +6.696880926144412e-01   +2.746840698253094e-01   -2.528531296940980e-01; -1.873093482156213e-01   -6.651560950970387e-02   -6.183783292028354e-01   -2.945124404793354e-01   +4.443126088135315e-01   -6.172664773354620e-01   +4.196170410201399e-01   +5.577681284997686e-01   -1.692888446390326e-01   -8.386616111547905e-02   -1.502670252945132e-01   +5.901868434864123e-01   +3.615001917623121e-01   -5.421020200565007e-01   +5.845738679681666e-01   -1.574408954246594e-01; -6.962522987169319e-02   +1.853182448849301e-01   -1.310629794192327e-01   -1.308300782888407e-02   -3.793358728914925e-01   +5.961187986544610e-01   +6.207370829496297e-02   +2.225460806754288e-01   +3.202663702599530e-01   -2.102886207355081e-01   +8.629138351793935e-01   -6.991803749727865e-02   -2.697931917779679e-01   -3.405567159679744e-01   +6.672732852655108e-01   -3.333771048833442e-01; +2.504987269217418e-02   -2.074549070625629e-01   +1.980336312803000e-01   +6.728325069169512e-01   +2.548881600085461e-01   -6.603604091905826e-01   -1.864785178956236e-01   -3.269855886820425e-01   -1.000000000000000e+00   +5.175820934771935e-01   -5.651091453033383e-01   +1.745055844819093e-01   -3.716360816010499e-01   +5.532481974318300e-01   +2.190149823468721e-01   +1.287284595668639e-01];
L2I_L2E_iAMPA_netcon = [-6.627853952002128e-01   -4.956561417660411e-01   -2.776081648855696e-02   +2.291470044844686e-01   -2.147861053741612e-01   +3.314362450104993e-01   +7.089542905772198e-02   +2.261964934041215e-01; +5.469202173149137e-02   -1.270277775023339e-01   -3.704705515367618e-01   -4.653429094493594e-02   +2.391409328866289e-01   +6.481992400548067e-01   -6.223750509294086e-01   -3.642373912758368e-01; -8.743052785449927e-01   +9.240370454165824e-01   +6.079234057522244e-01   +3.370612862554815e-01   +3.299211272884626e-01   -1.691030632535995e-02   -2.965684963748306e-01   +7.920965881150459e-02; -1.848216366780604e-01   +2.661141866558338e-01   +2.544271916755867e-01   -4.701695258114882e-01   +1.000000000000000e+00   -3.676524218643276e-01   -3.252748825716766e-01   +5.541068728572919e-01; +8.549311928252562e-01   -6.512285433570715e-01   +1.299707593149554e-01   +3.794643487733761e-01   +3.686674669303979e-01   -1.759274631202279e-01   +8.946962277123248e-02   +3.626766576247902e-01; +6.924408556120909e-01   +6.140703799660719e-02   +4.662703757355791e-01   +2.747144448327407e-02   +6.738179762203205e-01   +2.258981544888368e-01   +1.288306634677330e-01   -2.343402752947872e-01; +6.659448112305774e-01   -4.708336550238654e-01   -5.471432063234355e-01   -7.148343468557067e-02   -3.131281200478986e-01   -2.982338708435632e-02   +1.432919609925274e-01   +7.686398277250522e-03; +4.857120366955974e-01   +1.826585188670844e-01   +3.733345764660067e-01   -1.815285435950629e-01   -2.109413260221501e-01   -3.501895108142421e-01   -1.790518637711783e-01   -1.187286219526049e-01];
L2E_L2I_iGABA_netcon = [+5.462005854839090e-01   +4.188908701145752e-01   +3.206389930285801e-01   +3.272951628549293e-01   +1.481094550238439e-01   -8.623302605497499e-02   -2.925447139144307e-01   +3.678465908902149e-01; +1.002327051805851e-02   -4.260529421758310e-01   +2.257337673682935e-01   +3.219761395315498e-01   +4.160334934349355e-01   +2.665206660244565e-01   -7.046106621774342e-02   -4.392195858037386e-01; -1.379614234738415e-01   +8.915055835258159e-01   -3.701272699943459e-01   +9.882039782468827e-01   +5.169894681559160e-01   +2.933473062994996e-01   -4.336843755440976e-01   -7.510208419646200e-01; -9.541194483334494e-01   +5.444385847669475e-01   +6.413542940971398e-01   -2.946253151623518e-01   +2.399126218804891e-01   +6.918934955101156e-01   -2.897659504036345e-01   +7.061463523518640e-01; +1.000000000000000e+00   +6.711440975010607e-01   -1.920715182341115e-01   +4.006631493870048e-01   +2.071371463593500e-01   +3.235381019874947e-01   -2.741345628403995e-01   +4.999012754222615e-01; +2.049765537493955e-01   +6.501604910902685e-01   +2.820534372072842e-01   +7.619016096911618e-01   +5.752220772430269e-01   +4.225188917402788e-01   -6.166023401925987e-01   -6.697990360442877e-01; -5.578289420147738e-01   +3.486954771024596e-01   +3.443538273085597e-01   -2.902885402353017e-01   +3.926366462218889e-01   -7.527239678759804e-01   +5.126865942656848e-02   +1.743857301412135e-01; +1.407491358909016e-01   -1.435479226357441e-01   -2.258615703077808e-01   +6.535682764203165e-01   -4.058954606039303e-01   -3.626642674357989e-01   +3.254131513149928e-01   +6.487759442317008e-01];
L3E_L2E_iAMPA_netcon = [+3.124842122283639e-01   +4.889975822369962e-01   +3.795359688333544e-02   +4.755514211324867e-01   -2.027394655175300e-01   +6.070368603326779e-01   -4.547623771607999e-01   -6.393267464508866e-01   +1.440079160603951e-02   -2.575121229724488e-01   -6.454264292098599e-01   -1.603119632196765e-01; -7.196464815678079e-01   +1.813244443428523e-01   +8.596429303958500e-01   -7.234339322313308e-01   -5.509969461887428e-01   +7.740172796067744e-01   -2.713673920323217e-02   +4.754557221311904e-01   +5.741779211990201e-01   +1.062649060027347e-01   +1.084135281479384e-01   +6.842308295756100e-01; +8.243008889096747e-01   +2.167403524985479e-01   +2.751744498735212e-01   +2.300050527353369e-01   -3.392484474066210e-01   +4.445701418893371e-02   +6.908206836657443e-01   +3.089429899014273e-01   +1.401648867033817e-01   +3.280778793214273e-01   -6.399412605936430e-01   -4.496639556857096e-01; -2.242326117869844e-01   -8.237688605024214e-02   +3.648137400235031e-01   +4.278409724265774e-01   +1.159355649427064e-01   +1.260970364084672e-01   -6.088242131881472e-01   -4.964795882698532e-01   +4.620551306298539e-01   +1.000000000000000e+00   -3.801788304666732e-01   +3.525822260754580e-01; +9.915427319343968e-01   -8.267769541135119e-01   +5.080182171906507e-01   -2.724154400659074e-01   -5.731200562597879e-01   -5.557404713445157e-02   +4.979259279411825e-01   +3.549874067961831e-01   -2.539338226092714e-01   -7.101991193151350e-01   +2.642522780801563e-01   -5.645779505331963e-01; -1.026962607650068e-01   +9.269778168236400e-01   +8.080148391790810e-02   +1.864290066609157e-01   +1.590319096723800e-01   +8.797697086257664e-01   +2.958993461843402e-01   -6.991425354060457e-01   +2.812624981602174e-01   +5.225334458221824e-01   -4.470713787441934e-02   +1.043292680576439e-01; -6.337590380952525e-01   +2.346963615191385e-01   +4.176032267107529e-01   +1.215533987370396e-01   -4.956106720287071e-01   +2.023108877416926e-01   -6.611280499215390e-01   +1.042194463804902e-02   +5.882022942063502e-01   +1.364650794881511e-01   +6.552305448004280e-01   +2.357406137065241e-01; -7.390570732615560e-01   -4.540392942695119e-02   +5.864923042962170e-01   +4.920729034164596e-01   -2.885930961035614e-01   +1.189878410159174e-01   -4.144043438178010e-01   +3.194080667251289e-01   +6.808933358283124e-01   +6.105152568879552e-01   +2.304006877013658e-01   +3.154026955106692e-01];
L3I_L2I_iGABA_netcon = [-4.450462123831498e-01   -7.207999284124433e-01   -8.298441844777339e-01   -2.709336432154804e-01   -3.330601203660190e-01   -4.417543588507070e-02   +6.909437336354517e-02   +1.710642010964094e-01   +5.124409419985555e-02   -1.939027136406543e-03   -4.699211831278879e-01   -1.422957163862604e-02; +4.551265974942295e-02   +6.129451008398747e-01   +3.162116748567526e-01   +8.710502958739492e-02   +4.957458867894868e-01   +6.254516239046553e-01   -2.896098873645427e-01   -3.217344004064820e-01   -7.452102241975240e-01   -5.102014534205958e-01   -3.081827035487059e-02   -7.098313177742593e-01; -3.336594238160962e-01   -1.063196049061476e-01   +2.624901163440588e-01   -2.180633633378654e-01   -1.851757936098630e-01   +6.274058228616131e-01   -3.874434828173319e-01   -3.165775056772508e-01   +5.045907289732773e-01   -3.013408898948097e-01   +6.226693279761186e-01   +8.780973087569668e-01; +4.269273846547216e-01   -1.848594649614601e-01   -4.644905925544573e-01   +9.460355561497950e-02   +3.179904973648253e-01   -4.399103643670617e-01   +3.254076646587152e-01   -5.925358411493326e-02   -3.277579625664792e-01   -1.786561350015243e-01   +1.934186911630469e-01   -2.982185816078664e-01; +8.582622428861765e-01   -7.625786230787344e-02   +2.897674689935775e-01   +1.233517427925215e-01   -3.114441592571847e-01   -4.434415508638412e-01   -2.807045716997250e-01   +3.479069486253748e-01   +3.711552096399415e-01   +1.467566905379705e-01   +2.121129924782017e-01   -3.142551745114963e-01; -7.397129614026837e-02   +1.251509772780943e-01   -5.851198531324318e-01   +1.691264413512102e-01   -2.499904559676734e-01   +1.030188727623301e-01   -3.337151067614217e-01   -5.816017911501890e-01   -5.390110897587762e-01   -2.418167067533718e-01   +3.277779408461268e-02   +2.979342238615322e-02; +3.043125735116041e-01   +5.439953170202364e-01   -6.187777238301275e-01   +7.502931753797034e-01   -2.197808419037879e-02   -3.175095635979421e-01   -5.219235581579220e-01   +3.312262286930498e-01   -1.000000000000000e+00   -1.925848642177687e-01   -2.653689985157052e-03   +2.830356412305323e-01; -5.378759601056019e-01   -7.200044133050466e-02   -5.692194266744856e-02   -6.450654405320407e-01   -3.308535289227909e-01   +3.212022454832206e-01   -4.367142270354772e-01   +1.516400733750432e-01   +2.393798314517830e-01   +2.321637105582944e-01   +3.617672754279460e-01   -4.058922974505180e-01];
L2E_L3E_iAMPA_netcon = [+7.756472360866098e-01   +1.556911495452817e-01   +3.442033573365786e-01   -2.060964038347308e-01   +8.434999883558987e-01   +7.226715034344912e-01   -1.554665162843444e-01   -4.097373461450624e-01; +3.245870583778852e-02   -3.182705192765503e-01   -7.996642649862376e-03   -4.232532064532437e-01   -5.733124235887312e-01   +3.843974418494714e-01   -3.024461433797856e-01   +1.768350234316293e-01; -1.593148113092183e-01   +2.290795073277892e-01   -4.100212254301639e-02   +1.011051918061758e-01   -3.861665010570998e-01   -2.702831641653947e-01   -7.579663702126657e-01   +1.083996207450500e-01; -3.227494728867121e-01   -3.683604269073494e-01   -2.073316798802347e-01   +1.942670397398152e-01   -6.978515906061116e-01   -3.278749933084954e-01   -4.309573182068102e-01   -4.812056826832423e-02; -6.093946568660307e-01   -5.029983890503093e-02   -6.390898653099999e-01   +1.448956999187525e-02   -1.460039136316541e-01   -9.176163835520497e-02   -4.053301147231758e-01   -2.814424759985349e-01; +4.712479258990320e-01   -3.406362770624668e-01   +2.384370517328677e-01   +8.556805563458485e-01   +3.168279445239740e-01   -5.552416843041051e-01   -1.727917591686154e-01   -3.069119863802471e-01; -1.959385642385079e-04   -1.000000000000000e+00   +4.496850708294211e-01   -2.388083544614685e-01   -4.341122869358198e-01   +1.594110583090203e-01   -1.370545843025789e-01   +3.599924030676416e-02; +4.432277651014354e-01   -2.077895086443015e-01   +5.003916550072612e-01   +5.366562105189141e-01   +1.268405561488308e-01   -2.682059385374773e-01   +1.325460374585304e-01   +6.489832730802886e-01; +3.339392285654279e-01   -2.846458002218404e-01   +6.965897996823039e-01   -5.721133984904456e-01   +4.409168315101644e-01   -5.339372988023322e-01   +1.701822803350556e-01   -1.244189209550129e-01; +4.725394685506456e-01   -4.144414026063332e-01   +6.146936634478478e-01   +6.351579276897853e-01   +3.927458038214759e-01   -6.556403408483563e-01   -2.177466486267209e-01   +1.614485414698058e-01; +9.599233656049476e-01   -3.669696488304580e-01   +4.798335088951446e-01   +7.513508385868382e-01   +2.056051131154726e-01   -1.929009046311603e-01   -3.504767773018970e-01   -4.203670818882490e-01; +7.518030503061190e-02   +3.358372102606919e-01   +4.435520079554409e-01   +7.403707417211824e-01   +3.832661596599131e-01   +4.318848268935850e-01   +7.987730762438271e-02   -1.531558622932629e-01];
L2I_L3I_iGABA_netcon = [+8.413912716759885e-01   -1.733135962297125e-01   +5.740995821331010e-01   -4.717128409100290e-01   +1.805868800642650e-01   -1.649809609445625e-01   +3.446891051337491e-01   +1.477075847728095e-01; +4.603058624426569e-01   +4.025050765828332e-01   +1.088657829200522e-01   +6.620504454951371e-03   +1.114351058504083e-01   -3.195184751926795e-01   -7.103700626437882e-01   -2.714587675235213e-01; -3.277679095673221e-01   -4.065520454900510e-01   +1.252215398084573e-01   +7.022838505598881e-01   +5.240065806320059e-02   +3.655487650892750e-01   +4.899917316297316e-01   +1.000000000000000e+00; +1.057702022147515e-02   +3.786806775438208e-01   -5.970358509548081e-02   +3.408075602729279e-01   -2.365346883978603e-01   -3.276139662322858e-01   -2.179167616927734e-01   -6.842618992871946e-01; +4.536222191009710e-01   -7.073729912699547e-01   +1.976092855711935e-01   +5.910053587447813e-01   -5.039492083658169e-02   -3.882783712237375e-01   +1.327991057590997e-01   +1.511845120114420e-01; -5.575367494162223e-01   +3.243678703605481e-01   +1.413577274796359e-01   -6.214444939514083e-01   +1.130630374055875e-01   -5.001996836178683e-01   +2.813097506133196e-01   -1.382118578068471e-01; +7.808318002512707e-03   +2.543328180008465e-01   +4.483375994310935e-01   +3.921549851582121e-01   +5.883737934083542e-01   -4.774390769197924e-01   +3.416850870025240e-01   +4.912391661782493e-01; +4.461373766436619e-01   +1.812122638349449e-01   -1.027103914610043e-01   -7.655829732070359e-01   -1.928659398696762e-01   -5.213495618904401e-01   +8.436668127837953e-01   -4.957632477936089e-01; -1.351681875022059e-01   -5.258209342594921e-01   +2.586073676265266e-01   +5.886475806763595e-01   +7.273943704407713e-01   -2.094282405568725e-01   -3.664475493932445e-01   +1.085652478133652e-01; +1.141828507380244e-01   -6.880621802226268e-01   -2.857788306065091e-01   -7.203077838781017e-01   +7.172508741733261e-01   +5.354959784209349e-01   -8.900303117617836e-02   -3.202334459722901e-01; +4.643088220128442e-01   +4.611837029421050e-01   -2.775453601581206e-01   +1.704740173079701e-01   -1.958548537903178e-02   -7.530762568943840e-01   +1.433253433389133e-01   -8.028253794630916e-02; -5.545492393939804e-01   +6.984172617933886e-01   -2.731433421310368e-01   +7.132843596035174e-01   -4.370862326600207e-01   -2.687607722779040e-01   -6.977465409916310e-02   -1.099176624127033e-01];
L3I_L3E_iAMPA_netcon = [-3.284150929639423e-01   -1.843021454223723e-01   -7.418278840503788e-01   -1.989895019751754e-01   -5.269451809950009e-01   +5.362103680838530e-02   +3.035768386036382e-01   -4.854304144250107e-02   +2.789285711445444e-01   +3.719895089290020e-01   +8.298104164729871e-02   +3.456865695092734e-02; +3.515646214190375e-01   -5.217301665173298e-01   +5.882364171282775e-01   -5.930481822390830e-01   +3.332049152117421e-01   -1.567394953998549e-01   +4.172588478304457e-01   -3.054247913832696e-01   +2.915433940143067e-01   -6.613007585926600e-01   +7.775999173027638e-01   -2.946760519917452e-01; +1.146347395926225e-01   -4.215320139409943e-01   -1.136122692315810e-01   +1.854994672042298e-01   -6.458292063401718e-01   -1.145903811291720e-02   +2.299950345524535e-01   -1.578973969892024e-01   -1.864049678080436e-01   -3.409749002144333e-01   -5.362260013077939e-01   -6.180993513764673e-01; +4.979633301462976e-01   -4.042545876096025e-01   +6.765291478494501e-01   -3.936906552950639e-01   -3.791362884074453e-01   +3.612539552502276e-01   -1.309000662805783e-01   +2.011784221157096e-01   -3.070891922122548e-01   -9.628601892275924e-04   -7.442332070353638e-02   -4.132568232802640e-01; -4.157212372295032e-01   -3.508640738874571e-01   -7.762194461447955e-01   -5.291449727918754e-01   -9.839208951900049e-01   -7.067435590384294e-01   -5.033836102906976e-01   +3.243950492777263e-01   -3.865128024084620e-01   -4.392873814994559e-01   -1.256756646538484e-01   -4.363290812263300e-02; +5.042206201906555e-01   -3.917886656915888e-01   +7.777786303752592e-02   +4.775525780596981e-01   +5.262980266553636e-03   -3.435720779599872e-02   -5.948391569885976e-01   -2.972410540881913e-01   -3.855791012408409e-01   -1.366438204692388e-01   -1.224077193684591e-01   -2.565525653524681e-01; -3.402138117712594e-01   -2.057932670029810e-02   -7.339798950175650e-01   -9.330620284971535e-01   +7.345743858183397e-01   -4.976315355593120e-01   -6.993824518785432e-01   +9.157446503061259e-02   +5.790429201219241e-02   +7.527221735127984e-01   +2.588537119485189e-01   +1.746718833610908e-01; -5.528898895307776e-01   -1.693634665060068e-01   -3.405247258898008e-01   -9.332708152770763e-03   -7.361712950913760e-02   -6.498717931259581e-01   -5.485946827845950e-02   +3.818558590146560e-02   +4.858708639729762e-01   -5.040827468780531e-01   +3.693358600023590e-01   -4.524843105755141e-01; +3.665192610582835e-01   -3.840905406378204e-01   -4.083283925313920e-01   +3.218519250121071e-01   +6.711454957294406e-01   +5.487343440151180e-01   +5.639391399732976e-01   +7.431815637649261e-02   +2.684256437308732e-01   -4.741373608562796e-02   -6.643957563859111e-01   +6.714293280320419e-01; -4.103086073133885e-01   -1.443695403381152e-01   -3.786479940665999e-01   +7.386910720187394e-01   +3.523963801974161e-01   -1.395419667097648e-01   -5.368871099628384e-01   +1.504702764416300e-01   +5.113678252482836e-01   -2.149201561221804e-01   +4.270469005231638e-01   -4.158406211530865e-01; +5.709111645096363e-01   -1.538536942155393e-01   -6.761258760309945e-01   +1.000000000000000e+00   -4.173230971782082e-01   +4.509545311230905e-01   -2.408749297712015e-01   -2.363971863419781e-01   +5.115791658846682e-01   -3.447568927559563e-01   -2.564408867847275e-01   +1.309914627310310e-01; -4.319236162310487e-01   -8.345628181118516e-01   -2.514618613298035e-01   +8.340778328673730e-01   -3.028411672499917e-01   -4.777620724924007e-01   +2.879451859025086e-01   -2.789003731417087e-01   +1.884066886860636e-01   -3.046608203747661e-01   -6.799212069842215e-01   +7.433971427355242e-01];
L3E_L3I_iGABA_netcon = [-4.775758556206024e-01   +6.207696885484673e-01   +2.286874650139301e-01   +9.190708632966712e-01   -7.899760258666274e-01   -5.894533970915820e-01   +5.695827131637828e-01   +4.953376084886490e-01   +5.520753200118844e-01   -1.437909267399952e-01   +6.730595562690493e-01   -9.408187294778877e-02; -1.784344032423332e-01   -4.871282870919579e-01   +5.574668639717457e-01   +5.807556900483928e-01   -8.671803094836258e-01   +4.916051310190293e-01   +7.043915884444067e-01   +6.005060381949613e-02   +9.683870287507034e-01   +2.654390989796547e-01   +3.362305024074703e-01   +4.491206014296805e-01; +5.208208169683389e-01   -3.064842937165400e-03   -4.864475511228201e-02   +5.181247665780897e-01   +3.574993466634712e-01   -6.643965759242900e-01   +3.529114618273683e-01   +4.857627746802889e-01   -4.366345923029019e-01   +2.783432006201111e-02   -2.784049740273719e-01   +3.710133679195154e-01; -4.525745635908164e-02   -2.645891930482243e-01   +2.964913323372399e-01   +5.413277011077583e-01   +3.983111479126047e-01   -1.769398433715887e-02   +2.375826374512095e-01   -1.534735144659571e-03   -4.549930439884248e-01   -6.027562127651214e-01   -2.178647670660039e-01   +3.891102018587069e-01; -3.836512940786081e-01   -4.873953001484809e-01   -3.698132033563297e-01   +1.938335888402893e-01   -2.035055184159948e-02   -3.677797864987825e-01   -2.432361685429472e-01   -7.919287442365046e-01   -8.211379889840069e-02   -8.135887040798676e-01   -3.265918334359139e-01   -2.066731701537389e-01; +4.960435587052422e-01   +3.893540106873725e-01   +3.960112646039008e-01   +3.820046312194899e-01   -6.804777058141668e-01   +5.799757513917712e-02   +7.181704171084435e-02   +2.750288679206904e-01   -1.330788561102943e-01   -8.865545594647191e-02   -9.926982646414827e-03   -4.459686878586774e-01; -1.875780983436603e-01   +1.223685285759547e-01   -5.363001670992894e-02   +6.963541197734428e-02   -5.904620861565135e-01   +3.006847836542396e-02   +1.967616363276748e-01   -2.673077090311359e-01   +4.245214914910048e-01   -5.587058027152302e-01   +4.682762532595386e-01   -1.494597826680239e-01; +2.430148653832231e-01   -7.942735353381605e-02   +8.074617937075859e-03   +6.882472051123081e-02   -5.251777166836690e-01   -4.824679561007080e-01   -5.423140312393807e-01   +6.917381030169445e-01   +9.764535625051656e-01   +3.997086971004738e-01   -3.924160089334055e-01   -7.553629828769602e-01; -8.633353358469095e-01   +3.523583733417209e-01   +6.300980979085452e-01   -2.659394179297790e-01   -1.000000000000000e+00   +9.453355098002326e-02   -2.192891756305855e-01   -1.096545300551564e-01   +6.634319562814186e-01   +5.581599998308189e-01   -1.119645350205032e-01   -5.454995431280139e-01; -3.820963532130554e-01   +6.105585725995367e-01   +2.924888492655744e-01   -3.510352213532972e-01   +5.183767196229389e-01   -6.870109116123300e-01   -1.644938153683889e-01   +5.367060311491647e-01   -1.526335242629000e-01   -9.539675479415016e-03   -2.714583200427796e-01   +8.018138687000530e-02; -1.596274983124663e-01   -2.860985335411099e-01   -3.893753723924806e-02   -6.373394713621930e-01   -2.930143562523947e-01   +4.079560720945429e-01   -5.145998059789985e-01   -1.271243949117868e-01   +7.754766830757625e-01   -7.908814303814048e-01   -4.966361719493465e-01   -5.993152856918317e-01; -6.584125186050417e-01   +2.195003945002868e-01   +6.778434665061516e-01   +2.543366886305850e-01   -6.784565467620145e-01   +4.009490375608774e-01   +4.859168709345634e-01   -2.623256736228690e-01   +5.013738814130725e-01   -2.019117227748224e-01   -3.113807070848277e-01   +5.044728081164691e-01];
L2E_Input1_iAMPA_netcon = [+1.688432570879861e-01   +2.533302089910613e-01   +6.444411900094257e-01   -5.137551317254304e-01   -7.809035227083996e-01   -4.820639505814821e-01   -5.146899956862612e-01   -8.713264339322545e-01];
L2I_Input2_iAMPA_netcon = [-4.754498874789376e-01   -7.922979794368523e-01   +9.710874702075541e-01   -5.235996435557517e-01   -4.844757381785968e-01   -1.238084934312072e-01   +2.231712160999633e-02   -2.489565839259759e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 100*(sin(2*t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 100*(sin(2*t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
