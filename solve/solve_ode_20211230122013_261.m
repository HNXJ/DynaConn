function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+4.102218094477365e-02   +9.032970981719152e-02   +6.590905794706327e-02   +2.515650805786158e-02   +7.933801404071783e-02   -2.902977839627783e-02   -2.794373575026605e-03   +3.744292311023023e-03   -1.775791989852354e-02   +5.358147579827603e-02   +2.270329978544646e-02   +1.346387589539054e-02   -4.084684646356241e-02   +4.458435921676072e-02   +3.176140415305614e-02   -1.532600969562782e-02; -4.336833059627992e-02   +5.420613549054192e-02   +1.082297827560007e-01   +3.779611044880925e-02   +2.467503303550298e-02   -8.896393239577827e-02   +8.966873013004523e-02   +7.021458167204205e-02   +3.607386976408909e-02   -7.706002890236020e-02   -4.531289361051568e-03   -3.328133949710122e-02   -9.366184025092963e-02   -2.964287379227649e-02   -1.027062096549020e-01   +1.158921335281657e-02; +2.964074441589791e-02   +1.839493762797714e-02   -1.806411884430199e-02   +7.645836336167555e-02   +3.300602643847964e-02   +3.900502935273949e-02   +2.714808299598853e-02   -7.470675495261350e-02   -1.323838542610039e-02   +6.452893635883719e-02   +2.202426372313086e-02   +1.044821181619451e-02   -8.500680389059498e-02   +8.056548139468073e-02   -4.634855647258519e-02   +3.528974493948103e-02; +4.237321309488799e-02   +6.506275708797549e-02   -1.025875923720218e-02   -4.896954832431311e-02   +1.568293867684459e-02   -9.343263064310195e-02   -1.279169897676279e-02   -8.791826618528305e-02   -2.308818184567907e-04   +8.710511165907089e-02   +2.973728316681571e-02   +4.166595222650843e-02   -4.904841455878854e-02   -7.263793305116541e-02   +1.458276788142094e-01   -8.500735354394406e-02; -6.281882383962246e-02   +4.176797567560564e-02   -5.219768421556868e-02   -2.098765376468909e-02   +7.545185269399279e-02   -1.646286675720782e-03   +3.756827411203113e-02   +3.378355503984146e-02   -7.816644004891432e-03   -4.190980886079718e-02   -2.137935644681424e-02   -1.964445736993122e-02   +6.376122532714668e-02   -1.855408565208976e-02   +5.365705841301889e-02   -3.906735672084011e-02; -1.094636806703765e-02   +4.923015099788621e-03   +7.444203747534692e-02   -6.530175731401025e-02   -6.456713616080886e-02   +4.680985349751421e-02   -2.926761891354414e-02   -3.014172537187752e-02   -4.207110765719232e-02   -5.320571957346346e-02   -3.930806840140669e-02   +6.676024096212971e-02   +3.868698576519525e-02   +3.124206490642498e-02   +3.772136859430737e-03   -2.979526002252576e-02; -3.894977333312913e-03   -1.638074610986152e-02   -4.363951843285222e-02   -2.817945997406556e-02   -9.845872444214404e-02   -5.861760852345005e-02   +2.392803627712188e-02   +6.462304361704793e-02   -3.963865776549955e-02   +3.082797028155188e-02   +4.499051917487501e-02   +6.089885386286733e-02   +4.346812126809960e-02   -6.584759161773077e-03   +5.611512019147707e-03   -3.438216002696996e-02; -1.534923734983551e-02   -3.991526916493378e-02   +1.141114381349894e-02   +9.784829296771411e-03   -3.209913862257986e-02   -7.263609020336802e-02   +3.510345005036584e-02   -2.121546075612258e-03   -1.116627813871781e-02   -8.493820942692340e-03   -3.952410822212224e-02   -3.958488316826430e-02   -3.950516121051770e-02   +1.093789159940058e-02   +5.245786965821232e-02   +7.449961105944375e-02; +2.909441179848322e-02   +2.637299654441197e-02   -4.901726164730051e-02   -6.660342425704277e-02   +1.432892273427432e-02   -1.499204457018293e-02   -2.317166294741081e-02   +1.063512924514560e-01   +5.297952180938079e-02   +6.188687398846934e-02   -2.472213965747982e-03   -1.731247447284916e-02   -3.989629868826165e-02   -7.696798260120112e-02   +6.809058199605210e-02   +8.299390954903250e-03; -1.003077709658674e-02   -4.494061944487451e-02   -7.642082383590633e-03   -9.082456065364904e-02   +2.536223991386243e-02   +7.455795138979837e-02   -5.317024846771052e-02   +6.902804217844592e-02   -1.086556525009864e-02   -9.743738601304874e-03   +3.684353716443567e-03   -3.900808444456635e-02   -7.253522567356813e-03   +3.130727785515195e-02   -5.478438420264080e-02   -9.124836273372093e-03; +4.971505032821879e-02   -3.224856242714401e-02   +3.034164506880472e-02   -5.679550024243565e-02   -1.279527540888010e-01   +5.723698059329197e-03   -4.060052095845650e-02   +7.622999464003849e-02   +5.535979638378756e-03   +1.001619241639805e-01   -1.625397094974107e-02   -7.722022069794367e-03   -2.154439246876228e-02   +7.566366992936127e-02   +2.296899632949055e-02   +5.333853871253863e-02; +5.795624898200831e-02   -1.167826721405415e-01   -2.601887862192662e-03   +3.942448434499077e-02   -1.677141926450462e-02   +9.527440991964618e-03   -2.137778298752329e-02   -3.557741945453324e-02   +6.340496332832529e-02   -5.051825943812311e-02   -4.457532174080907e-02   -6.830727095530119e-02   -1.405106239197668e-02   -2.141565809830176e-02   -1.888202615426535e-02   +7.245453324492318e-02; +3.866210336427904e-02   -1.910260359996620e-03   -2.578535119875989e-02   -4.532313158601937e-02   +1.795655102512294e-01   +4.884128001079328e-02   +1.565948608551636e-02   +5.863500312002970e-02   -6.304788055533112e-02   -8.422519033277530e-03   -9.627520600483359e-02   -6.984734043348491e-02   -1.842138999781612e-03   +1.040241163684522e-01   -4.661242156938206e-02   -1.271683724118432e-02; +4.924513565432653e-02   -9.464139041706104e-03   -2.030678727503189e-02   +4.106564144126674e-02   +9.239598142234648e-02   +7.239000211678567e-02   -4.423147553056863e-02   -1.030598991642419e-02   -3.330897567295351e-02   -7.542402363573338e-02   -8.050553877511416e-03   -2.886853549408320e-02   +6.347353055701932e-02   +8.280618665000586e-03   -3.106726954598339e-02   +7.000104953641455e-02; -5.983978031760777e-02   -1.772542495415479e-02   -2.073776582007480e-02   -3.657246381140700e-02   -6.762472830380351e-02   +2.615792124874379e-02   -9.809087470263886e-03   +1.624844277754226e-01   +3.194862343504289e-02   +6.396832396663811e-03   -1.154367304520614e-01   +8.468423668581113e-03   -1.392531598228621e-02   -1.897985227763868e-02   -1.210022586951223e-02   -1.764523754221518e-02; +4.322070160274705e-02   +1.286561425615901e-02   -7.184776711743612e-03   +3.048319845831531e-02   +6.113406065111963e-02   +8.395807104500912e-02   +3.805747234882492e-02   -3.910572127115775e-02   +1.964063228400646e-02   +6.462698404522231e-02   +9.531374123263928e-02   +1.032599905720242e-01   -1.472432708152553e-01   +4.379799808767265e-03   +2.869388434244470e-02   -5.224941019132656e-02];
L1E_L1I_iGABA_netcon = [+3.205984684991670e-02   +5.315349094747017e-02   -4.931878391921567e-02   -4.907552569635919e-02   +3.367877018680589e-02   +3.023632929749398e-02   -9.950646027568180e-02   +2.315358334323774e-02   -7.693349291051492e-02   +1.274147840869061e-01   +1.192847404305920e-02   -2.680283459553787e-02   -6.406065214972677e-02   -1.127148074042778e-01   +2.642113301649056e-02   +3.337631561118604e-04; -2.560295259995548e-02   +2.305108705644633e-02   -2.483963481303027e-02   +6.809728126785530e-02   -1.111319834823620e-02   -3.894605288905586e-02   +2.857274266969284e-02   -3.786748760926460e-02   +2.063480121164674e-02   +2.542105391441701e-02   -8.707376776221276e-02   +8.513022021400214e-02   -9.185940716969965e-02   +1.636544663455016e-02   -4.212784179327393e-02   -2.963807717921924e-02; -3.723107900480994e-02   +5.416734590395256e-03   +1.082522780828515e-01   -7.497502728617864e-02   -6.541422892158069e-02   +2.523680851603926e-02   +4.475469813555452e-02   +7.047625057472265e-02   +8.908018148903194e-03   -9.423634529238403e-03   -1.014819706651321e-04   +4.752207540046156e-02   +3.687828599553304e-02   +9.355061679175489e-02   -9.303075263735232e-03   +3.044909899453737e-02; +1.563367492068315e-02   -4.337989768190526e-03   +8.814306577840401e-03   +2.585360750476350e-03   +7.130416867587126e-02   +9.706790674209630e-02   -1.400476242193369e-02   +5.047563933660285e-02   -1.139649449223432e-02   +2.430436699013790e-02   +5.967495018858043e-04   +1.517590592520873e-02   +1.799237121868526e-02   +7.441930907461156e-02   -3.592794268958005e-03   +2.448796649883522e-02; +1.280366704891653e-01   +9.216097198286480e-02   +3.998942189601193e-02   -5.611464509795819e-02   -1.291013445440386e-02   +7.343971349295943e-02   -8.708594913624973e-02   -5.377541169519301e-03   -3.724870355485061e-02   +3.032366387178714e-03   +5.421944461814571e-02   +3.386823228263965e-02   -1.612785920613824e-02   -8.995959349480548e-02   +5.146514787238521e-02   +7.418886275690327e-02; -3.191588442412462e-02   +9.404453338099233e-02   -8.563842371856982e-02   -2.576358264769270e-02   +5.557525887771499e-04   +6.845116639908977e-02   +2.568131074392196e-02   -6.089151063807666e-02   -2.370318199386246e-02   +3.311388679732361e-02   -1.547790796455863e-01   +2.590269207627742e-02   +4.950504538027572e-02   -3.544529940462614e-02   -2.379781940678332e-02   +9.219476674674104e-03; +1.080775983293802e-02   +1.795264079661705e-02   +1.425711935797450e-01   -4.998602693484371e-02   -1.816230869473726e-02   +5.378117980272151e-02   +1.842158320247465e-02   +6.771910556649277e-02   +2.625265265617857e-02   +6.974958394063506e-02   +5.488584397379058e-02   -3.208818927829099e-02   +7.309289012860570e-02   -4.291333737757243e-02   -3.218579666877695e-02   +2.743049106409762e-02; +4.074635651849266e-02   -1.509457469518524e-02   +3.164522224588911e-02   -2.015488430426485e-03   +1.244513583384150e-02   -2.375874211483815e-02   -3.007393732476614e-02   +7.933884582834873e-03   +3.865263345387634e-02   +1.418335287929164e-02   -6.500246299174320e-02   -3.652311651300660e-02   +6.037367375501913e-03   +2.458730108678012e-02   +2.738612926161274e-02   -5.302778407109035e-03; +5.930580637560921e-02   +3.317081054631611e-02   -5.208189060612001e-02   -2.401212012196826e-02   +3.764642051213204e-02   +1.586748524890880e-02   -2.146823532446740e-02   +9.045886710060111e-02   +8.010181908177870e-02   -7.308747670025353e-02   -1.744258408279635e-02   +9.902135885521100e-02   +8.694081352734470e-02   +7.409089549413814e-02   -3.325848853387553e-02   +8.712296811733668e-02; +6.042477662814154e-02   +3.891634263157809e-02   +3.833345027555080e-02   +9.946714088914510e-03   -2.660301491972031e-02   +9.492828916877391e-02   +9.928850245259677e-02   -4.545612525614037e-02   -9.179663554840942e-02   -1.761261206590890e-04   -3.643499007332150e-02   -3.804989981379958e-04   +9.913541549213445e-02   +6.174627305015992e-02   -7.492036544318074e-02   +1.441869262604382e-02; -4.552940196066904e-03   +7.308021401062968e-02   -6.175672386345603e-02   +4.776862015122182e-02   -5.516992634730478e-02   +2.551712670097640e-02   +1.766672122603807e-02   +5.660719110795050e-02   +1.328593320117617e-02   -5.083305224692151e-02   -5.321655488694434e-03   +3.904579720928293e-02   -2.046708079041804e-02   +3.220866647018111e-02   +2.225663093637565e-02   +9.342925796271315e-02; -4.593564652280741e-02   -9.765653387697651e-02   +1.380522527469557e-01   +8.039964104546043e-02   -8.623482736836713e-02   +2.514990035916570e-02   -5.724748135869489e-02   -4.889167929011132e-02   -1.059479390935741e-01   -1.503105514284422e-02   +7.617019878727922e-02   +2.828676916225560e-02   +9.717602482400636e-03   +8.037772572487108e-03   -3.812648133357330e-02   -2.434311031548912e-02; -5.898886704211209e-02   -5.243069039572713e-02   -3.690843260030616e-02   +8.723664445675492e-03   +6.606325758793806e-02   +4.124995752402415e-02   +8.665707782661525e-02   -4.563893123974887e-02   -4.884796427454926e-02   +1.422360130433591e-02   +5.382973115227095e-02   -4.630925168274246e-02   +6.636385580701011e-02   +1.073108323303982e-01   -1.225049711932258e-03   +4.428848441173393e-02; +5.112607839342662e-02   -4.030729833485503e-03   +1.931562339706040e-02   -2.168344148483037e-03   -1.237841303554941e-01   -4.139600278222225e-02   -9.177449942163983e-03   -8.178854663870881e-02   -9.026743848097106e-02   -3.863696575666924e-02   -2.184554553669996e-02   -8.667024375039345e-02   -6.736834202248526e-02   +9.935811987618021e-02   +9.553723500527488e-03   -7.709996720138874e-02; -4.608511761868458e-02   +8.249916924458879e-02   -4.636845887014207e-02   +3.109470444282693e-02   +2.645175867800702e-02   -2.734559084091020e-02   -1.368359108493413e-02   +6.869534496949739e-02   +4.012835241669096e-02   +9.698736533255878e-02   +2.277003533422832e-02   +1.401733043030695e-02   +3.139655627235444e-03   -5.045123576126290e-02   -3.506342284352785e-02   -4.087518098889316e-02; +5.674191571195786e-02   +9.499529946910956e-02   +1.802053879103453e-02   +1.569109697906199e-02   -5.827987953688551e-02   +5.982362402342171e-02   -1.729701261717081e-02   +4.186890303584889e-02   +7.938654041830853e-02   +5.660854762889235e-02   -1.274095685618004e-01   -1.424912301297741e-02   +1.153972163045682e-01   +3.566208221530227e-02   -6.401874384725385e-03   +1.449697762553572e-02];
L2I_L1I_iGABA_netcon = [+7.648383782883561e-02   +2.437693895089674e-02   -1.862951728749953e-02   -5.830619434500223e-04   +5.407752755490017e-02   +1.429170840969885e-01   -4.936036269896073e-02   +3.066440095695308e-02; -1.657255568578165e-02   -7.049790502675141e-02   -1.302289442839273e-02   -1.016785164397608e-02   -4.459168190525704e-02   -5.760638153628526e-02   -3.413382437735145e-04   +1.138323900882302e-01; -4.179547305447232e-02   -1.000402167900168e-02   -3.716862766554170e-02   -2.597746067624966e-02   +3.083758255491430e-02   +4.944513477325782e-02   +2.125675686865353e-03   -4.188454031743965e-03; +6.087233713665224e-02   +3.150629355380526e-02   -2.575289634719987e-02   +2.144642200757740e-02   -5.887734595713150e-02   +6.209590879347381e-02   -2.529691014671716e-02   -3.066343648947477e-02; -1.222640742997605e-02   +2.358084017902664e-02   +9.798057682010602e-02   +3.369307688800795e-02   +4.278666221102007e-02   +3.357928590282869e-02   +8.720334303792568e-02   -6.940547219033805e-02; -2.535364134247076e-02   +2.657062641206868e-02   +7.415557940695289e-03   +3.765595337548416e-02   -1.290688976670636e-01   -1.839693459258779e-02   -5.005946695049883e-03   +2.776533845922945e-02; -1.735263748876637e-02   -1.160684360024153e-01   -2.684590678403533e-02   +8.488668223387136e-02   -2.396627280698294e-02   +4.312015568789963e-02   +1.118436063632593e-02   -2.898448289311363e-02; +4.689927188950962e-02   -1.712335370930429e-02   +6.817072192140804e-02   +6.213461170620860e-02   +1.660279356039175e-02   -6.070127899566193e-02   -9.027806285016912e-02   +5.479232740004595e-02; +1.076174127701275e-02   +2.397436054926824e-02   -7.447532867465679e-03   -1.284448386445057e-03   +3.422364303870826e-02   +7.795715849958587e-02   -7.487238657316164e-03   -4.362906163158684e-02; -2.266089284392951e-02   +7.513987847445932e-03   -5.984837561718287e-02   -8.150101045499507e-02   -6.050901972986093e-02   -3.560427985329977e-02   -1.268459789676109e-03   -7.275996096759572e-03; -4.530339982379303e-02   -1.810195201278123e-02   +4.896923798381241e-02   -5.602799188305609e-02   -3.665475798606128e-02   +2.127150555295820e-02   -1.726824054633288e-02   +9.974782352769228e-02; -4.320505102040251e-02   +2.044640566363930e-02   +1.315397826597593e-02   +8.569229425562583e-02   -1.644658305506498e-02   +2.822846742239289e-02   -2.527366441283647e-02   -7.497985142454616e-02; -4.275885784975873e-02   +5.476366418139299e-02   -1.174297330409920e-01   -4.170698466130453e-02   +7.913863126784366e-02   -1.281471124376752e-02   +1.650840839988482e-02   +1.248505781455653e-02; -4.125415238285907e-02   +4.672240698183691e-02   +8.270767372603113e-02   +6.016207920898085e-02   -6.652040802649216e-02   -8.756990370880779e-02   -4.349874261831175e-02   -2.398552555729953e-02; -5.976113436674299e-02   -2.644236484453439e-02   +2.938372962644761e-02   +5.241006322953901e-02   +4.521822695116661e-02   +1.125651169416074e-02   -4.426798466751507e-02   +4.766226778026947e-03; -7.156031437889161e-03   +5.642452104234311e-02   +3.043439662201455e-02   -2.071621254490156e-02   +7.294154106753288e-02   -5.258219552326499e-03   -2.087238529058944e-03   -3.844131035926873e-02];
L1I_L2I_iGABA_netcon = [-7.568098317545496e-02   -7.878835024614328e-02   +4.736289726363983e-02   +2.833569184184538e-03   +6.996146616020600e-02   -7.619089217670477e-02   -1.900915658828450e-02   -3.308254707475517e-02   +7.275092053469842e-02   -4.843179403988245e-04   -9.822445826043100e-02   -9.664051192518006e-02   +2.047330193973549e-02   -2.240018884373424e-02   +5.303742368608706e-02   +8.048637693709534e-02; +8.504762520637772e-04   +9.616080893096254e-02   +4.277908274928593e-03   +2.098038655024723e-02   -5.774945496092192e-02   -1.118202300414693e-01   +6.906304451405129e-02   -7.327975152766474e-02   +1.855630802404742e-02   -9.149573370903009e-02   -4.624090626336549e-02   -1.367515762664738e-02   +7.852106413209185e-02   +4.341072541419946e-02   -5.586936642858799e-02   -5.351357341064555e-02; +7.216766460933787e-03   -3.001047390862263e-02   -2.632540758422373e-02   +6.915568876323669e-02   +2.131371694154484e-02   -6.695932107552158e-02   -1.044277017274371e-02   +6.291216929256080e-02   +8.492151305359662e-02   +3.219346885178406e-02   -1.172393351606169e-03   +4.302276067948722e-02   +2.198109311480743e-02   -5.878262260757510e-02   +4.983456942147629e-02   +6.392382452548423e-02; -4.676347675468807e-02   -6.902067485959114e-02   +4.766315637891892e-02   -5.736732470565117e-02   +2.275084629644878e-02   +1.611141540521885e-02   -6.696173771089534e-02   -3.082132172275816e-02   -5.455949626384246e-02   -1.176168478770162e-02   -4.279775392832061e-02   +4.878364253483446e-02   +2.344209556243315e-02   -1.875582244345863e-02   +5.690647754250798e-02   +3.269709131482693e-02; +9.522768027518351e-02   +3.509539678659468e-03   +6.151674934365585e-02   -1.359724989982358e-01   +2.768809536324163e-03   -1.274652777085721e-02   -1.218611471588903e-02   +5.951822500624002e-02   +9.968630032350921e-02   +2.108246081816979e-02   -7.291100590600524e-02   -3.582683122937753e-02   +7.852050848710199e-02   -8.062292524805836e-04   +1.471545842231976e-02   -7.794629330194158e-02; +2.678033744937199e-02   -1.955238076567779e-02   -3.635041629825816e-02   +3.140670040782644e-02   -1.250320374572843e-01   +1.131912378549579e-01   -2.632900160453502e-02   +6.432557950639148e-02   -1.419744880831419e-02   -5.042606849794704e-02   -1.792406501384369e-02   +1.038104726262700e-01   -7.151883428760539e-03   -1.123826928579191e-02   -8.809243282059502e-02   +7.078349033983044e-03; +8.076193397144125e-03   -4.310844065083845e-02   +2.622405611332742e-02   +1.788528348003634e-03   +5.693798249221224e-02   +8.969148323130866e-03   +1.588443041480936e-02   -1.225460186704129e-02   +8.553313522645226e-02   -1.901091645316356e-02   +1.053223278852685e-01   +7.626756286567483e-03   +2.978294293396602e-02   -2.834637349298492e-02   +4.465885302640948e-02   +2.541776374467290e-02; -1.025475186632722e-01   -3.484113309408156e-03   -7.431859684743239e-02   -6.991308674815525e-03   +3.605596701500286e-02   +3.836054315334742e-02   -6.712029885107353e-02   +3.904411407429191e-03   -4.907574992728442e-02   +5.788254529379357e-02   -5.569863289114112e-02   +1.056595850193796e-01   +9.518777075323073e-03   -4.489819315050161e-02   -2.488262214696875e-02   -7.423548663838733e-02];
L2E_L1E_iAMPA_netcon = [-2.031750254218368e-02   -7.431692139947685e-02   -6.454295954720329e-03   +4.935681059756926e-02   -1.480853182185308e-02   +1.634807963232660e-02   -1.317894875655106e-02   +4.008638896028070e-02; +1.413683647994088e-04   +3.876402660472403e-02   +7.747973805049402e-02   +2.278432863179000e-02   +1.080203678635024e-01   +1.855825728114216e-02   +1.824851535875361e-02   -4.958892814686634e-02; +6.371183791975993e-02   -9.490254612462955e-03   +1.882794637280992e-02   -6.278182717939403e-04   +3.388264259202035e-02   -2.757700205582549e-02   -3.140403435628073e-02   -1.632049838576850e-02; -1.686616851732588e-02   -1.483086464730872e-02   +4.966115511662535e-02   -5.026682696520465e-02   +1.539369955822631e-02   +1.672682984358021e-02   -3.474997687757438e-02   -2.830043617564770e-02; -7.538502828680030e-02   +3.109506312166363e-02   -2.256598399115973e-02   -1.949853962650053e-02   +4.658313916454476e-02   +4.987028428746999e-02   +3.952290730669136e-02   +4.654923681737862e-02; -2.845903106961363e-02   +4.377984713674957e-02   -2.068856122838789e-03   +4.844913948578402e-02   +5.514472759326568e-02   -3.094631992986296e-02   +7.758113072427086e-02   +5.836703244253075e-02; +1.844442560189308e-02   -5.225621052321565e-02   -1.207788817587592e-02   +6.829428497970225e-02   +5.064862815205374e-02   -4.137956046279074e-04   -1.160663001940234e-02   +7.629805088085888e-02; -3.564581449387610e-02   +1.571095383511701e-02   -8.222762875219861e-02   -4.859680767180817e-03   +7.914175488932999e-02   +1.800944004807565e-02   +4.988139247223899e-02   +1.039667593449969e-02; +2.918124860404314e-02   -5.577300690714327e-02   -1.287904226360184e-02   +7.450960347440284e-02   +1.372080737709320e-01   +4.348734764786709e-02   +1.353254032592975e-03   -5.248924928165091e-02; +1.624801420428059e-03   -7.557583025108271e-03   -3.433165889238571e-02   +2.118543560249009e-02   -1.691552334632999e-02   -4.038436166578380e-02   -3.802454836196062e-02   +3.434266016159560e-02; +5.155454430874459e-02   -1.112789537201404e-02   +3.483114256335030e-02   -7.196762057107745e-02   +1.185180116485728e-01   -1.183632844407769e-02   +6.579679132037164e-03   -5.852994606345333e-02; +9.457421565923400e-02   -2.124989540734250e-02   +3.134694324770782e-02   -6.546728925552106e-02   +5.197153144741097e-02   -6.699968330398448e-02   +2.218429886797794e-02   +7.464716405248194e-02; -9.832062671634831e-02   -4.854142048926147e-02   +6.458829855423934e-02   +1.903593934530892e-02   +4.629751160901375e-04   +3.605921358982726e-02   -7.589307226088893e-02   +9.991192049694749e-03; +7.080976185779107e-02   -5.577980181232860e-02   +1.831136414684075e-02   -3.797414802701573e-02   +1.233611737754153e-01   -3.516467272309743e-03   +5.488509641000641e-02   -1.055663715756106e-01; +2.344218139935108e-02   -3.028837808918108e-02   +5.134714343375101e-02   +4.890232783288101e-02   -2.918117108783636e-03   -4.445055736435161e-03   +5.332459240484849e-02   +3.459962089045736e-02; +6.761693620209033e-02   -1.616949902950962e-02   -3.159251599360696e-02   -6.476437393736875e-03   +4.182072674848310e-02   -8.111219252749718e-02   +6.416431754560617e-02   -2.242132033159843e-02];
L1E_L2E_iAMPA_netcon = [-9.139866208955591e-03   -2.329106329126386e-02   -6.887587242757366e-02   +3.676083627023419e-03   +1.487797964814525e-02   -6.345646208913025e-02   +2.998883416628431e-02   +7.402718487960896e-03   +6.351696287037718e-02   +3.758225948478698e-02   -3.078927992923340e-02   +5.264755714101142e-02   +4.284997157650882e-02   -9.197115391026184e-02   -4.065415678949693e-02   +8.163620564985619e-02; -5.959067919714721e-02   +1.101145179895224e-02   +1.193888963260278e-02   -3.837989401048670e-02   -1.083847171769407e-02   +5.072457773263161e-02   -8.703462207693899e-02   +9.075620092337933e-02   -1.464839089415225e-02   +5.117340436003155e-02   +3.630672171240010e-02   -9.383158163963304e-03   +3.125625595132014e-02   -6.027430966411441e-02   +3.516581783027234e-02   -6.060402492138729e-03; +6.582343472615930e-03   -6.286330225423889e-02   -6.566861211347154e-02   +9.894618021353285e-02   +8.618592934895390e-02   -2.751086545088426e-02   -9.676891694768013e-02   -7.728353311117020e-02   +1.692545983037841e-02   +2.370436764729704e-02   +7.677831021354610e-02   +6.021340334487985e-02   -7.403670165072146e-02   +3.062408483633932e-02   +3.429947729250725e-02   +6.089276754768470e-02; -2.048094921796136e-02   -1.351134717528324e-02   +1.571090400881254e-02   +5.037741312922246e-03   -1.952942794351944e-02   +3.876231781577458e-02   -8.508063686729436e-02   +7.909899244215552e-03   +5.978370546049416e-02   +7.543138012047816e-02   +1.339342078247920e-02   +4.788049738783839e-02   -3.233758325618372e-02   -2.886495523847900e-02   +8.956088010074538e-02   -2.998382359834593e-02; -7.967101570855747e-02   -4.776409355600326e-02   -2.918753995321708e-03   -4.019634446547012e-02   -1.282084703828359e-02   +5.394237590919756e-02   +1.232963833827869e-01   +4.928194565936288e-02   +1.379295222201658e-02   +5.328402917972989e-02   +1.022688750138793e-02   +5.563474069115477e-02   +1.513952399025536e-02   +1.227802903600167e-03   -2.953490871267673e-02   +4.114709541440219e-02; +3.699947283864224e-02   +6.115200306759697e-02   -7.631287457793134e-03   -6.715220274100603e-03   -3.679557513029680e-02   +8.588361827797600e-02   +1.562425228968161e-02   -1.908486911611888e-02   -1.387067911597200e-02   +1.333499403761419e-03   +9.489745551533614e-02   -6.117269645862837e-02   -2.173283037795326e-02   -5.987117250144801e-03   +4.672056736780139e-02   -2.064023957170490e-03; -8.213929083024475e-02   +4.689240790853660e-02   +3.495775253843569e-02   -5.202950567458356e-02   +3.771609239368300e-02   -7.172182166285294e-03   -4.878706525956976e-02   -5.387181241548918e-03   -6.590272981052091e-02   +1.074693705445184e-02   -1.322685756558842e-01   +3.494077297222727e-02   +2.841844791245320e-02   -7.888095065365981e-02   +1.320165366871576e-02   -1.864169080570071e-02; -4.821932288191039e-02   +2.306930050965755e-02   -9.556229468757182e-03   +7.001444796347167e-02   -1.452015754525254e-02   +5.528479603851486e-02   +1.024364791959353e-01   -1.095534652202015e-02   -1.202838565576755e-02   -5.445577056185800e-02   +1.329878197952684e-02   +7.920082173655478e-02   -7.961825693524575e-02   -1.592653614625706e-02   -3.593645138596716e-02   -9.128113382171607e-03];
L2I_L2E_iAMPA_netcon = [+2.084229781435345e-02   -2.086404432401888e-02   +1.146183369693970e-01   +8.818357763805995e-02   +1.365378712991874e-02   +2.725037794222365e-02   -3.820730297776170e-02   -9.813074228278509e-04; +4.148130619310883e-02   +4.427655206476581e-03   -7.665629553843712e-03   +3.926971867731076e-02   +5.495231510870126e-02   -3.836666050720666e-02   +1.159549565252629e-02   -4.914205670762281e-02; +1.893542892975021e-02   -1.296006851311803e-02   -2.912504146598019e-02   -8.487270099867637e-04   -8.027391117501831e-02   -6.007291737089095e-02   -8.586042396864081e-02   -4.760012631000037e-02; +4.818713528365880e-02   -4.185312578922641e-02   -1.261279018394724e-01   +3.168278688247587e-03   -5.839986744412962e-02   -7.350293922231142e-03   -6.872877810411358e-02   +5.664617451187717e-02; +3.921359729404539e-02   -1.001677262680907e-02   -8.124187860690184e-03   -1.221538910175087e-02   +1.522196639605341e-02   +6.750974535785857e-02   -2.254978015603651e-02   -2.682411829169794e-02; -1.266028686257922e-02   +1.236323651765156e-03   +3.494876491760789e-02   -8.541205959717355e-02   -4.874218037697622e-02   -1.681941925427293e-02   +5.151455096060812e-02   +1.592767056832262e-02; -7.812275486798845e-03   +3.509165223294117e-02   -3.700246952315123e-02   +7.226897465192607e-02   -4.376497738552414e-02   -3.027110749208253e-02   +4.747581832687318e-02   +8.989451214485935e-03; -6.966079545387116e-02   -2.774468360829345e-02   +4.126715651400362e-02   +3.286801092942722e-03   -6.275273742966984e-03   -3.146119167450455e-02   +3.643229687187383e-02   -5.703029532056354e-02];
L2E_L2I_iGABA_netcon = [+5.128182346984785e-04   -7.372411874826215e-02   -1.019589276301901e-02   +5.399379800972159e-02   +1.765285740437555e-02   +1.285182393082392e-01   -4.110901706261869e-02   -3.132390220341288e-02; +6.721337707863198e-02   +3.499919725550087e-02   +6.542573899783929e-02   -5.722499870062761e-02   +5.961353552584640e-02   -7.870267627175549e-02   +1.180515655429308e-01   +2.278368946686537e-02; +6.099088920237480e-02   -7.450852527772242e-02   -1.858236491231976e-02   +4.552865621597089e-02   -1.973777808442907e-02   +6.961837839046743e-02   -2.862554916066200e-02   -8.529249963411534e-02; +3.703034461747291e-02   +1.977954830635672e-02   +2.454959514475741e-02   -3.432809231801358e-03   -4.876509280216568e-02   -2.147192210598704e-02   +6.544845757697609e-02   -8.529901848463040e-02; +2.531812173851665e-02   -7.358410460260879e-02   -2.010178472603634e-02   -6.284072219855086e-02   +2.426707263228978e-02   -8.125666948168643e-03   +7.042474064953461e-02   +7.927847080320327e-02; +5.827255884883412e-02   -5.816049893323477e-02   +3.257908691084924e-02   +7.679578166015637e-02   -7.159484522004508e-02   +6.219032107521691e-03   +4.505761900647152e-02   +6.555950761243965e-03; -2.437177715067025e-02   -7.098264022430907e-02   +3.876904349465393e-02   +6.186132574864064e-02   -3.361404505161161e-02   +5.140467075008331e-02   -8.042510632955174e-03   +2.674137186422436e-02; -4.476015286127736e-02   +5.051239214333422e-03   +2.091771791066240e-02   -2.125346974727165e-02   +7.850739026419734e-02   -1.389566482087972e-02   -2.208183112653464e-02   -4.667331911369015e-02];
L3E_L2E_iAMPA_netcon = [-3.456269557567993e-02   +1.626999734367566e-02   -8.304838110723359e-02   -8.916239863506648e-02   -1.528922113822989e-02   +3.341451823794526e-02   -5.147195615843526e-02   +1.910943352632526e-03   -1.977820788376113e-02   +2.477375467014372e-02   -7.476882049768366e-02   +6.576448204253592e-03; -3.719556863838928e-03   +1.212846642035866e-02   -8.553802412295355e-02   +7.677521769582729e-02   -3.428150503802008e-02   -9.069089923603151e-02   +1.738110146956419e-02   -1.123280400964521e-01   -2.267090652664308e-02   -2.877916105600856e-02   -2.444464568638363e-02   -3.005145234370213e-02; +6.319593877037843e-02   +1.133225975982412e-01   +2.718485690732066e-02   -2.310099696391458e-03   +8.521355337470678e-02   -1.324950834219325e-02   +7.615676697445201e-02   +1.601680547028853e-02   +8.429397648424901e-02   +4.017693727584086e-02   -1.607807065138621e-02   +3.485667343519731e-04; -1.849683272133168e-02   +4.734527910359741e-02   -2.915528766255560e-02   -3.729140168224576e-02   +8.574286517848002e-02   -3.914132833770856e-03   -7.019058059856703e-02   +8.633362888197825e-02   -6.715496168017490e-02   +9.798305789210954e-03   +1.256546215235394e-02   +1.214882234054282e-02; -4.860148017816273e-02   -4.179535602164978e-02   +1.526007145510427e-01   +9.922533450901442e-03   +1.823126225549748e-02   +7.737618960210774e-03   -4.140245114615940e-02   -1.025369289528880e-01   -2.743571504828306e-02   -7.308277816130637e-02   +3.386674149788800e-02   -7.967955779035510e-02; -2.854790626363649e-02   +2.731844724260530e-02   +2.650000435607329e-02   -4.535555569886482e-02   +3.297021887380400e-02   +2.419668746075252e-02   -5.134850967508810e-02   -2.680005989980341e-02   +3.988433619202330e-02   +1.347495234266663e-02   -1.150434321588231e-01   -1.675030012261207e-03; -4.582963799034373e-02   -5.352285336496430e-03   +2.490675763464736e-02   +6.243796585357816e-02   +1.613686647849932e-02   -1.335887131405589e-03   +9.623791381148224e-02   +6.170190323718403e-02   +1.175266924466944e-01   +7.510209161811671e-02   +8.754303765657008e-02   +7.220253802998450e-02; +4.575096895096174e-03   +3.759096449911189e-02   -5.880861792351136e-02   +5.515948623647780e-02   +1.245184308258345e-02   +1.697596363005533e-02   +1.986069102037528e-02   -9.441591891105683e-02   +7.925942464902644e-02   +1.177631648051346e-01   +6.203181319622004e-02   +7.479880237379600e-03];
L3I_L2I_iGABA_netcon = [-3.261850983549142e-02   -6.051030691209286e-02   -6.277600420346158e-02   -3.759241218754439e-02   -1.323272730157220e-03   -1.419657896555520e-02   +6.095000311188002e-02   +7.171886068904117e-03   -1.315227642190622e-02   +7.903711158622755e-02   +7.870206269003434e-02   +4.146484988565593e-02; +2.804399405147381e-02   -3.571278196212720e-02   +2.716481041334104e-02   -1.918188720413863e-02   +4.744668296946222e-02   +3.254831374702030e-02   +3.137972666009986e-02   -1.436317765859002e-03   -6.114359077508052e-02   -1.044548519201289e-01   +4.550153952811847e-02   -7.180925463618759e-04; +5.414335620053777e-02   +3.278906268575015e-02   +1.571961676149158e-02   -5.779108739473467e-03   +5.702450914725682e-02   +2.152213675542150e-02   -1.758994758840544e-03   +4.929612933917232e-02   +5.923149120317047e-02   +3.034744581609571e-02   +4.213051419765807e-02   +4.977034748675035e-02; +2.549975669227100e-02   -6.327420181586843e-02   +6.697008490759898e-03   -2.377707450950758e-02   +5.700580754592716e-02   +2.713088162554440e-02   +2.102315292339125e-02   -5.373567223661539e-02   +2.699222406680472e-02   +1.419591260990007e-03   +4.687140068532947e-02   -1.474140887151911e-02; +2.014911795430724e-02   +1.270097148132221e-03   +5.967866749903721e-02   -4.895377954393339e-02   -3.836094424053360e-03   -2.247576279380600e-02   +5.704749651530040e-02   +4.680175339229549e-03   +5.533543738783553e-02   -8.747671625951275e-02   +6.071913608749892e-02   -5.267806644231046e-02; +3.987560692099969e-03   +3.967889120946387e-02   -3.780113700540709e-02   -6.377742129059685e-03   -2.937429919806571e-02   +3.796688749078465e-03   -3.583615542735111e-02   -3.535495691603460e-02   +1.297727125603738e-02   +1.369242386576682e-02   +1.075396681458047e-02   -1.217145805527560e-02; +4.163974202613294e-02   +7.999983721977907e-02   +7.433161442134004e-02   -5.378391461830154e-02   +1.880344312923097e-02   +2.131879062913108e-02   -3.372616689182004e-02   -4.516756347262636e-03   +7.273914721636347e-02   +1.139300465596092e-01   -5.190147190527872e-02   +7.489604446025364e-02; +3.343928501781007e-02   +7.188901937214290e-02   +4.923911523412634e-02   +8.024369227379427e-02   -4.287345064112607e-02   +8.062290375296505e-02   +3.316770781967854e-02   -4.855080295125341e-02   +6.437921840742364e-02   -5.058352772017705e-02   +1.039303200205028e-01   +3.746861474447721e-03];
L2E_L3E_iAMPA_netcon = [-6.587435643028780e-02   -5.588882974528298e-02   +4.182368393831069e-02   -1.020321464711501e-02   +6.913320419564713e-02   +1.458401863368491e-02   +4.871132521684594e-02   +1.175490928987704e-02; +5.020437779438550e-02   -1.149246723738349e-02   -2.149166143574241e-02   +7.657847715742447e-03   -7.780898261308570e-03   -2.839013598810014e-02   +5.982597836050444e-03   -6.321026240069888e-03; -2.538799288677044e-02   +8.683016181696199e-02   +1.101360117883012e-01   +4.065190889890916e-02   +8.810516902645416e-02   -6.834414558595532e-02   -5.529758267685758e-03   -2.376373861976500e-02; +6.680960539354586e-02   +9.641297581088511e-04   -1.531883919581867e-03   +3.515149134714592e-02   +9.228354520082449e-02   -8.497974918656559e-02   +8.979263412400040e-02   -4.466082473782053e-02; +4.013938658206481e-02   -7.253680235608440e-02   +1.068195126413541e-01   -2.852901418342078e-02   -2.734947289284540e-02   +1.014863081341036e-01   -3.565688030296404e-02   +7.713963218852177e-02; +3.709552118780014e-02   +4.096113316049357e-02   -7.844900882486833e-02   -3.501487294397024e-02   -7.533781109929556e-02   +5.500061412452559e-03   +4.030209010747317e-02   +3.914951634098862e-02; +9.954235992521003e-02   +3.271464727854982e-02   +7.754668088989250e-02   +8.375689528743491e-02   +1.062588390614415e-01   -4.142578539800666e-02   +3.621749386400246e-02   -7.712911647771065e-03; -4.838125198828116e-02   -9.370193702218019e-05   +6.688301433948256e-02   +5.376673328656485e-02   -5.182477250645284e-02   +2.587977785026688e-02   -6.498158235434331e-02   -3.696535129553118e-02; +3.324634998917272e-02   -6.782770342464392e-02   -8.786112438025162e-03   -3.423279277841643e-02   -4.261237657371869e-02   +6.488934348259666e-02   +1.306054604065241e-02   -2.584210272588800e-02; +3.478560470379297e-04   -3.725659583933642e-02   -2.333395599954073e-02   -3.136664935148523e-02   +3.031324161411328e-02   +6.392518184488297e-02   +2.433309335946307e-03   +4.815734386242415e-02; +1.907105568003026e-03   -4.325909193842580e-02   +1.122423921637616e-02   +1.066502077177140e-01   -2.273468682600085e-02   +2.993948294481464e-02   +2.340307035944921e-02   +9.579892045373968e-02; -1.206871733977735e-02   +6.542036798515705e-02   +1.208607680670511e-02   -4.568391270152126e-02   +4.553205821060480e-02   -2.960981915489054e-02   +9.292356939846010e-02   +2.040724633214705e-02];
L2I_L3I_iGABA_netcon = [-1.394868325718241e-02   -2.029304021014295e-02   +2.564557587367343e-02   -1.346175794984799e-01   +2.833604102194558e-02   +3.426298835879613e-03   +9.482440864062416e-02   +6.711753827317657e-02; -6.190429156137787e-03   -2.988299042792510e-02   +7.249916313735066e-02   -1.595552618312659e-02   +6.622829864761313e-02   -1.915093270316529e-02   +2.009485746689592e-02   +1.030147622157529e-01; -1.206597412596642e-02   +1.136983952264510e-02   +5.305803996201671e-02   -5.146921001087040e-02   +5.417054667662556e-02   +5.538235659145684e-02   -3.943215381148595e-02   -2.003237027643751e-02; -1.898671987942132e-02   +3.829695931262316e-02   +3.674285866967524e-02   -5.497347198524464e-02   +3.476045840268497e-02   -8.965404764019211e-02   -1.482676321932512e-01   +4.938014456145143e-02; +8.358279450258696e-02   +5.347940815500977e-02   -6.909776262557732e-03   +1.522534284465761e-02   -7.693159468468150e-02   -5.200235604296067e-02   +4.848897823502021e-03   -2.027248391649188e-02; -6.059391109072079e-03   +1.491305273486042e-02   +5.615759969894680e-02   +1.891687193168692e-03   +4.601385490327944e-02   +3.064940457470088e-02   -7.320598533225270e-02   -9.101813868006575e-02; +5.636092841254531e-02   -3.827539932679436e-02   +1.170702900394868e-01   +1.378407641638068e-02   +8.858594623379160e-02   -2.764257919164265e-02   +8.417416001991342e-02   -4.679202699335496e-03; -8.232568546070314e-02   -1.280169180871579e-01   -1.889461899305920e-02   +7.813427479151715e-02   -7.471000090079394e-02   +1.717384482243199e-02   -2.726564647069965e-02   -1.476584587669888e-02; +1.385017723914331e-02   +4.055296556250525e-03   +1.147491357443907e-01   +3.492134588439198e-02   +3.008330363152163e-02   +1.842192980290430e-02   +6.381130097355009e-02   -6.880746402996274e-02; +9.183450280943482e-02   +8.531958795655004e-02   +1.407023224720199e-02   +6.467497690214495e-02   +1.366683877014995e-02   -4.939574135602694e-02   +8.860094856818118e-02   +4.549039308971792e-02; +3.496083533081885e-02   +3.143472899279681e-02   +6.409454250986177e-02   +8.544251581916555e-02   +8.459047042423548e-03   -5.511429748151517e-02   -3.596830857852193e-02   +9.092702992929655e-02; +9.626292147996957e-02   -3.261319939070069e-02   +4.091835835312940e-02   -2.420489608340936e-02   +5.023369328629044e-03   +5.197253528966002e-02   +4.170534151590958e-02   +4.432060760033884e-02];
L3I_L3E_iAMPA_netcon = [+6.774955515795622e-02   +1.323696014452756e-02   -5.426943786513182e-02   +5.176759413507113e-02   -2.034050760588612e-02   -5.414996500340048e-02   -4.948171777696325e-02   -3.173962199140833e-02   -7.545078676512409e-02   -1.247673653628725e-01   +2.864870274562784e-02   -2.281423449825089e-02; -5.136025299091337e-03   +7.294970714514472e-02   +2.196754253117932e-02   -4.690119501936646e-02   -3.104771347173795e-02   +7.998055040482710e-03   +3.196299587973288e-02   -4.727574076580615e-03   -6.952890754985115e-02   +1.116632756726492e-01   +2.521488974071492e-02   +1.573781943632988e-02; +5.951931358300749e-02   +1.215522772844295e-02   +3.205893820381879e-02   -2.338278699390663e-02   -2.162507694209101e-04   -2.956813693845026e-03   +9.642099998340475e-02   +4.486503248875978e-04   +2.502308166797014e-02   +9.682527955702781e-02   -7.885666397206165e-02   -5.911633149923896e-02; -5.376547379786097e-03   +2.450898060865279e-02   +5.293443076486710e-02   +6.237519423483986e-02   -1.041548697966008e-01   -6.838679059885794e-02   -3.132218863250019e-02   +6.654638349095336e-02   -1.091489076468950e-03   +7.415550362067513e-02   +4.805174448751659e-02   +4.313848993287041e-02; -4.108718784869805e-02   +5.226451690273148e-03   +3.079952463513712e-02   -2.537240918852170e-02   -5.628317249132411e-02   +6.620793744262356e-02   -3.770444614608599e-02   +3.219805937567698e-02   +7.390065930734750e-02   +6.714502775468205e-02   +7.029232812158587e-02   +1.307719031280025e-02; +5.792867873169942e-02   +2.429579421672352e-02   -3.714144437560380e-02   -3.671681214112362e-02   -8.699081136207104e-02   -6.324986238963069e-02   +8.573437082286442e-02   +1.171159307589026e-02   -1.581323904990401e-02   +2.354624132992200e-02   +2.583019786054012e-02   +7.739905861406148e-02; -5.004253881210090e-02   +7.957765893048974e-02   +8.603275955232277e-02   +1.772840700774237e-02   +1.167520129854814e-02   -5.761456834302633e-02   +2.813412134629894e-02   +5.889556625840930e-02   +2.283081893386685e-02   +1.126997064575460e-01   -6.360047070307741e-02   +4.178907526741381e-02; -1.124240711227978e-01   +3.464118195770193e-02   +6.228103710862604e-04   +7.088654492672586e-02   -5.217003442977489e-02   +4.837901596283685e-02   +5.834398391840051e-02   -5.845723316724425e-02   +9.558929156170208e-02   +5.995833087386454e-03   +5.251515332178364e-02   +6.527510660367165e-02; -3.238295854477170e-02   -1.165646611568447e-02   -4.185777121686059e-03   +4.841741984463261e-02   -2.851818967497907e-03   -4.122782161816628e-02   +2.353176975627430e-02   -6.364877903881497e-02   -2.703687641714660e-02   -7.887801249224230e-02   -6.828988674385003e-02   +9.120295568472202e-03; +1.735085874173749e-02   +4.830484312178085e-02   -5.498519401493070e-02   -1.194997591215740e-02   -1.022544478914603e-02   +4.834971356904167e-02   +4.869635221095638e-02   +3.680911960914462e-02   +7.987900987659814e-02   -3.014370983692843e-02   +7.114614224776802e-02   -1.084104923032023e-02; -6.318881428075823e-02   +5.297063454801321e-02   -1.767459479970691e-02   -1.870129661890408e-02   +5.897816021342983e-03   -2.489774958839362e-02   +5.450293874869894e-02   -2.988672381238133e-02   +9.504150863078256e-02   -4.064723837255252e-02   +4.310648997374596e-02   +4.011567936647673e-02; -1.198700048298472e-01   +4.968773673398988e-02   +1.181333330119573e-01   +1.778318676956027e-04   +6.812995187160287e-02   +6.602606523732490e-03   +5.426157334839674e-03   +6.919731080303335e-02   +3.202985564008098e-02   +2.913770330105414e-02   -6.621011686282559e-02   +2.114508459703938e-02];
L3E_L3I_iGABA_netcon = [+9.637281557031854e-02   +5.632746501671129e-02   -6.148005154295213e-02   +3.215293986119858e-02   +7.075737080587773e-02   +9.942043105858951e-03   -2.332939768763548e-02   +1.350943116467442e-02   -1.064987602465665e-01   -8.963463620512216e-04   +6.052463653240425e-02   -4.584852681763972e-02; +5.216302824517077e-02   +3.726262192024945e-02   +3.977912881352168e-02   -1.416687594658284e-02   +3.763336912476537e-02   +3.715868965494615e-02   -4.229928053971967e-02   -7.479535796536214e-03   +2.281558416121901e-02   -3.365606518069209e-03   -1.054463193797635e-01   -1.927073457699630e-02; +5.213153242196120e-02   -4.636574067387290e-02   -1.486305709022290e-02   -9.013287380823293e-02   +1.123960759458021e-01   -1.466080034125015e-02   +1.499368597743291e-02   -5.927855765179527e-02   +7.243858904561291e-03   +1.947070055778871e-02   -1.486071862146479e-02   -2.533716631058333e-02; -9.238655242201935e-02   +2.337125405280948e-02   +6.336028474602801e-02   -8.503415914639007e-03   +3.139006051214152e-02   +2.094942317905172e-02   +2.048866846946221e-02   -5.162029207657833e-02   -2.873871268824777e-02   +9.210463836196620e-02   -2.246129045501966e-03   -5.612667411540411e-03; +2.210405873320336e-02   +1.268225267345367e-01   -4.185009983564171e-02   -5.027937311240564e-02   +1.514555435640304e-02   -1.059425319886415e-02   +1.026711916198952e-02   +1.105930908125137e-02   +4.664452826257649e-02   +5.436142440298053e-02   -4.169535478039919e-02   -5.548845204438059e-02; +2.690285502469229e-02   +1.504916635505011e-02   -4.422353314517073e-03   -8.611696072916283e-02   +8.102432981474622e-03   +2.456419127515462e-02   -4.624644895939493e-03   -3.474467604279678e-02   -2.791190629999150e-02   +7.001525422336498e-02   +2.575355789664235e-02   +1.976579560845993e-02; -4.246164126299532e-02   +4.694482967416876e-02   -2.516232509380777e-02   +5.905815038583689e-02   +4.213323619027900e-02   -9.903215792514652e-02   +5.921850072458897e-02   +1.448377974138533e-02   -5.924271828129649e-02   -7.645510067598366e-02   +3.917704255241817e-02   -9.678463112289208e-02; -1.040843278520134e-02   -1.352617834224974e-02   -5.042451053960538e-02   +2.686988467603368e-02   +3.294115647549734e-02   -1.213642751832732e-02   -3.873625405627134e-02   -8.545176342999924e-02   -4.721935273492588e-02   -4.744843629519670e-03   +1.176438718703869e-02   +2.842923833743600e-02; -7.907967801846803e-02   +5.973968539859879e-02   +3.683201613913175e-02   -3.230565105272252e-02   -2.880466414002284e-02   -7.703665591038567e-02   +5.937499988853932e-02   +2.819640404272755e-02   +8.312969950050757e-03   +7.279811871573319e-02   +7.935141081099850e-02   -2.542707877490262e-02; +9.658254057989607e-02   +4.098430117721010e-02   +3.631193709991370e-02   -4.339355321731278e-02   -4.497869745971921e-02   -8.106307500595208e-02   -5.513150731697615e-02   +1.686740704176357e-02   +1.154906111097495e-01   -6.044113609534314e-02   +2.966217738212079e-02   -1.217054922027734e-02; -4.909505259024428e-03   +6.237202463223332e-02   -7.351482709251821e-02   +2.481661981632082e-02   +2.101364498173883e-02   -3.121650837827816e-02   +1.436213814035265e-01   -1.048763844640129e-01   +2.196071249571217e-02   +6.381917110281171e-02   -6.088293177781140e-02   -9.543087871216528e-03; -7.563218434380155e-02   -7.139367026429611e-02   -7.920830402459805e-03   -1.025156256140318e-02   +4.289653760613504e-04   -7.704014166354409e-02   +9.006009926556710e-02   -1.319749344586406e-02   -5.453044837049983e-02   +4.339032553041092e-02   -6.253486042048020e-02   -5.948005297013215e-02];
L2E_Input1_iAMPA_netcon = [+5.540195797029764e-02   -5.609622164718506e-02   -3.626669072807744e-02   +8.905801576253428e-03   -6.727670664727578e-03   -3.169784065161232e-02   +2.822898253494773e-02   +4.562598301373089e-02];
L2I_Input2_iAMPA_netcon = [+4.707507339067660e-02   +1.146479039857788e-01   +5.756607276056916e-02   +1.001551748721531e-02   -8.915420216030988e-02   -3.055071690066484e-02   -6.246818374957921e-02   +1.340398932148688e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.3*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.9 + 0.6*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.3*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.3*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*1.0 + 0.8*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.3*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.9 + 0.6*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.3*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.3*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*1.0 + 0.8*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
