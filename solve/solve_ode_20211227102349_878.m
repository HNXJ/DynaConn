function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.454598195898409e-01   +2.327890684821025e-01   +4.250870652770857e-02   -1.112473593433251e-01   -1.653524362774572e-01   -1.322641997832098e-01   -1.191299147273847e-01   -9.623610862316689e-02   -3.316581117489437e-02   +3.409133759506476e-01   +4.713657453953831e-02   +2.233160570934175e-01   -2.906634352109516e-01   -2.097110257058125e-02   -2.036994431402022e-01   +1.473959109533884e-02; -3.233998515975678e-02   -1.227588603243954e-01   +2.379293393667432e-01   -1.761602084129532e-01   +1.176413781654198e-01   +2.538373623293931e-01   -2.029276428265955e-01   +2.687228352916030e-01   +1.695848950876094e-02   -2.400889116561926e-01   -1.729088540995532e-01   -3.168448731209589e-01   -3.732291886660223e-02   -1.656577080679022e-01   +9.753005767252235e-02   -2.429867228171117e-01; -2.535491128649400e-01   +2.958598515520098e-02   -5.951622740078399e-02   -2.090355897702092e-01   -2.782267783474825e-02   -1.011886325425342e-01   +2.989913898856958e-01   -4.377080914708929e-01   +2.214090784002929e-01   +2.229536194263764e-01   +1.806096685621861e-01   +2.762139282105661e-01   +2.663499101851707e-01   +9.316064699740367e-02   +1.563116604489302e-02   -4.271596809218537e-01; -1.393726355732943e-01   +2.361576612297703e-01   +3.161733649090178e-01   -2.089510220870778e-01   -2.900777210118977e-01   -7.737697474895404e-02   -2.332560620664484e-01   +1.739448244268058e-01   -9.766219429806865e-02   +3.810903700471761e-02   -1.871854718073526e-01   -7.885764276680131e-02   -2.564813578463806e-01   +8.363075141159193e-02   -4.028596534459806e-01   +9.769448951605014e-02; -2.958111934764411e-02   -6.202488972792566e-02   +4.861132956256146e-01   -1.532391328810610e-01   -9.697943625338334e-02   +3.422506702945006e-01   -1.722680524395433e-01   +2.646742004481240e-01   -4.692305446763412e-02   +6.943571946605774e-02   -2.032803074359253e-02   +3.027726467894155e-02   +1.911152866470921e-01   -1.022771993333722e-01   -5.838772962488648e-02   +3.941397938501227e-01; +1.842513056103135e-01   -1.064241282310980e-01   -2.825254242260705e-01   +4.515783234390830e-01   +3.526146053372979e-01   -6.440319504797096e-02   +5.121364678021609e-02   +4.883673618354031e-02   -1.035629852184899e-02   -7.934165401869711e-02   -1.598071850456665e-01   -1.542118421545999e-02   +4.189422708529971e-01   +2.319092018139714e-01   -2.917234741686974e-01   -1.907149861472916e-01; +1.211177786377941e-01   +3.076067188957844e-02   +1.085130555554954e-01   +1.252796537506563e-02   +7.580819645618897e-02   +2.757260322257486e-01   -3.041947356317439e-01   +8.871316374699223e-02   +7.679500462140063e-02   +3.479783606407137e-01   -3.493386100932644e-02   -6.046714335426286e-02   +6.783713996852245e-02   +2.767331626288059e-01   +1.851802915119648e-01   +6.171446208587217e-02; -6.222191703260767e-02   +1.076240881474142e-01   +9.810065675681377e-02   +1.072769212423503e-01   -3.545266337855674e-02   +1.833478840374529e-01   -3.048145111488073e-01   +1.421676588941858e-01   +3.742612253851469e-02   +5.238547389049127e-01   +1.188800221335189e-01   +2.470672491621735e-02   -2.738733433612889e-01   +2.498214754127404e-01   -2.627108658911607e-01   +1.061965005628489e-01; -3.013273997056430e-01   +6.744865437606654e-02   +1.405138680085448e-01   +1.399175638151082e-01   -1.827659164304042e-01   +9.197196897419503e-02   -4.200212868038648e-02   +2.336989987496735e-02   +6.720589406045573e-02   -3.772345944397398e-01   +4.005376068090874e-02   -2.279618927413417e-01   -4.273189514586393e-01   +2.111424808020466e-01   +3.142398229037718e-01   +8.576226110977164e-04; +1.256171445431066e-01   +6.851669435308680e-02   +3.196875167090857e-01   +3.035919976600046e-01   -5.536283879761848e-02   -1.417217019308825e-01   -2.311136597085681e-01   -4.318972500076478e-01   +1.595696571847332e-01   +1.698688765302542e-01   -1.704421287085404e-01   -7.860999983457159e-02   +1.029103935141753e-01   +2.968147632257989e-02   -1.376735871640631e-01   +2.867455118838234e-01; +3.469644784570747e-02   +2.378313400232990e-02   -8.574842108906544e-02   +2.348820592298082e-01   -3.279097881298535e-01   -4.168620625128750e-02   -1.547974015997611e-01   -4.191385586973551e-02   -1.412379256271075e-01   -2.463206409261630e-02   +1.825728573348559e-01   +1.600822154956977e-01   +1.252346553351784e-02   +4.575249580861304e-02   -7.867238338153601e-03   -1.239583842385910e-01; -1.727207332901883e-02   -1.031499343432381e-01   -6.282588431871507e-02   +1.028961551922848e-01   -1.717095522963312e-01   -3.057416089083521e-02   -1.206361603399292e-01   +1.389779578992890e-01   -6.926735188049832e-02   +2.640410624232065e-01   -1.199352193217697e-01   -1.499895926046497e-01   -1.825248452918599e-01   -1.124913778100064e-01   -5.095662487462396e-01   -2.741598693956287e-01; +8.995930840958313e-02   -1.058474987273224e-01   +2.313109704885252e-02   +2.518644163930617e-01   +3.628479878451232e-02   -1.383389723148638e-01   -1.607289744273049e-01   -6.654986411270147e-02   -3.054786857079957e-01   -1.940785015892928e-01   +5.965324748173097e-02   +5.831612459380722e-02   -2.021456203985041e-01   -3.549222427834611e-01   -4.219215282008746e-01   +3.093835763421934e-01; +1.956046706420584e-01   +2.202569062941525e-01   +2.327939731872489e-01   -4.140095733458124e-03   +7.656152249538532e-02   -1.947380962693823e-02   -2.934387349078601e-01   -1.882026455923835e-02   +8.222920788536911e-02   +1.142479514508788e-01   -1.364237774469589e-02   -2.418269427937519e-01   -1.519930462077258e-01   -3.807624872504207e-01   -4.988110993834139e-02   +3.929806741928040e-01; -9.156232641634984e-02   -8.828987964545595e-02   -1.676540898944251e-01   +4.975557084809776e-03   -1.184596632539047e-01   -1.603138484693832e-01   -9.339256179087585e-02   +8.745724710377090e-02   +8.122806655021889e-02   +3.092867094691746e-02   -1.027560620564458e-02   +3.889466957670848e-02   +1.471688782374638e-01   +2.603683140676140e-01   -2.903583257010987e-01   -1.481182054854364e-01; +3.773449334147727e-01   -1.942483566364359e-01   -1.675875797703140e-01   +3.296914414207017e-02   +2.206194012737185e-01   -7.616481045629771e-02   -1.701937820192484e-01   +5.254394553650484e-02   +2.568585917458533e-01   -1.676673992579879e-01   -1.737734218209516e-01   +4.567180182261985e-02   +5.651070866430723e-02   +6.395442050514566e-02   -3.973283935605619e-01   -1.695734276564901e-01];
L1E_L1I_iGABA_netcon = [+6.780382821646470e-02   -9.299318630236539e-02   -2.657565858036099e-01   -1.085785908340514e-01   +1.639539600242512e-02   -2.461551037125825e-01   -1.345730306282756e-01   -1.547351730571203e-02   -8.277936263463116e-02   +4.026103988860502e-02   +9.761443249530852e-02   +2.817164106814425e-02   +3.085468586682992e-01   -3.567692106516534e-01   -9.753790067744597e-02   +1.989637672888463e-01; -4.715317386597058e-02   +2.001959219659185e-01   -5.536885900341655e-02   -3.034144257564376e-02   -5.580701398446599e-03   -1.037945066964688e-01   -3.395653082098656e-02   +4.961102334745658e-01   +8.462291238547498e-03   -2.791294422769763e-01   -3.171077784773579e-01   -4.204399325518623e-01   +6.282618474922035e-02   +1.526935186539895e-01   -2.049468273805223e-01   -1.468383557761961e-01; -2.082685821158224e-01   +2.196757013846259e-01   +1.336166995173501e-01   -3.012538803326131e-01   -1.665816283516375e-01   -5.452102392131666e-02   +2.313694117166240e-01   -1.240078838666515e-01   -3.548205416465439e-01   +9.746992117886817e-02   +6.354727033468001e-02   +8.128777732257947e-02   -2.413245722332063e-02   +1.029597367621696e-01   -4.716557504292043e-01   -1.979661919837758e-01; +3.064002088682950e-02   -1.221197063386056e-01   +8.869807153719331e-02   +2.470219800232883e-04   +1.161839991754075e-01   +1.693336314154273e-01   -3.751837800371077e-02   -2.159081404964305e-01   +3.605591245203982e-02   -2.117760735454921e-01   +4.456337439061726e-02   +3.160320764462740e-01   +1.449292634656614e-01   -1.119341823349368e-01   -1.801819685704888e-01   +2.261819409742400e-01; +2.547790232580720e-01   -6.284032783716459e-02   -2.544702196782996e-01   -5.200063669109925e-02   +1.555878806445321e-01   +8.940954209482246e-02   +6.479186396002463e-02   -2.298702406357500e-02   -5.346830545019630e-02   +1.471005736052076e-01   +3.414101752711378e-02   +4.281342474089864e-01   +1.471346842097535e-01   +1.829897133149163e-01   -3.470537745884728e-02   -1.746700805013294e-01; -3.032574534404344e-01   -1.297004391501960e-03   -1.372623940923310e-01   +1.549852647409810e-01   -8.358330347080110e-02   -4.407704528064447e-01   -4.791007085918368e-01   -9.376253843973596e-02   +3.028663467499071e-01   +1.587148392733751e-01   +5.262115886005380e-02   -1.594688687504715e-01   -1.223925272540414e-01   -2.261584705061292e-02   -1.703470541297194e-01   -9.377563208972267e-02; -3.110315700949044e-02   -1.586232621527761e-01   +2.528310461476276e-01   -1.884757560886642e-01   +2.837965734504960e-01   +8.160855105221509e-02   -1.465606383275137e-02   +1.806512527945738e-02   +1.392416022647417e-01   -2.418048774074387e-01   +1.945412450789916e-01   -2.616286650010186e-01   -1.306748749423955e-02   -1.400062084604632e-01   +2.078675250899652e-01   +3.721359921848542e-01; -1.697956511848113e-02   -3.824422763763721e-02   -2.317607903977573e-02   +8.783220526438212e-02   +6.129377338343044e-02   -1.942413069794159e-01   +2.627771847905237e-01   +2.266892891564797e-02   -1.558612197976785e-01   +3.006126238704298e-01   -2.375624944074102e-01   +1.063034429534850e-01   -4.209643884767485e-01   -4.241188263905676e-01   +1.066707404781599e-01   -5.644577307138139e-02; +3.650341759990148e-01   -2.714287626600206e-01   +2.016994732763656e-01   -9.832292258002874e-02   +3.523139684907892e-02   -5.430285410350119e-02   +8.258796763261106e-02   +1.176926299258775e-01   -3.695485086305174e-01   -4.134839800395537e-01   +7.656295995499894e-02   +7.793606110182071e-02   +3.713715389784695e-01   +6.795529161593322e-02   -4.539152886515528e-02   -2.035226845334908e-01; -1.717131601772545e-01   -2.091663467593549e-01   +1.478687301021671e-01   +5.300785789456031e-04   -6.082759127654523e-02   +2.299970545404065e-01   +6.851344690665130e-02   +1.385472243188792e-01   +2.422472410456011e-01   +9.821973649146409e-02   -1.340501631684980e-01   +3.363196422163663e-01   -1.796686378524034e-01   -2.161645583494948e-01   -4.147846230037219e-01   +1.569183023783285e-01; +2.526784816915868e-01   -2.958246439608753e-01   -7.161236144663462e-02   -2.295306098495578e-02   -6.907553902795216e-02   -7.995977412408509e-02   -3.550232246018380e-01   +1.241741696567634e-01   +8.798413725108445e-02   +7.153686976419736e-02   -2.017574842899528e-01   -2.958045853352215e-01   +2.000190077410989e-01   -1.315175849392901e-01   -1.696398375458932e-01   -1.987350317274054e-01; +1.904645181750063e-01   -2.600054235294403e-01   +4.005668366401499e-02   -1.239647275732276e-01   -1.190578144867383e-01   +3.508029218380257e-01   +2.054384859395473e-01   -4.820981808175796e-02   +6.734874301212344e-02   +4.287297600173687e-02   +3.005864733262540e-01   +3.444243417715311e-01   +1.636168755428193e-01   +9.004393098716090e-03   +1.538373716642511e-01   -5.499770651785406e-02; -1.394732392113254e-03   -1.791190192151748e-01   +6.000893045689809e-02   +1.811723559860964e-01   -2.751570215113127e-01   -3.085312539532156e-01   +1.526340039921006e-01   +9.339694368465060e-02   -5.142015037739113e-01   +3.654935512369293e-01   +5.072730775117353e-02   -3.180032618344031e-01   +1.970197569231095e-01   +6.309839177226532e-02   +8.260554087967981e-02   +3.414258845201058e-02; +2.912619351162563e-02   -2.070729471410693e-02   +4.922243221595080e-02   +3.217690303580087e-01   -1.640647248528231e-01   -9.886659935425254e-02   -7.259612902253101e-02   +1.283910252841685e-01   +4.874808654736559e-01   +1.600658064946481e-01   +7.083859920150605e-02   -1.569989544289974e-01   +3.037071495363717e-01   +8.709935088887626e-02   -1.341416234394543e-01   -1.409995379440122e-01; +8.320338188645396e-02   +8.230040584843348e-02   -2.339292014620288e-01   -2.600069795456369e-01   +4.168282828821170e-01   +3.102911683942750e-01   -8.056648535440722e-02   +3.312140724425690e-01   -5.986837533223158e-02   +4.051562121541290e-01   -9.466437884320211e-02   +1.172260734110598e-01   -4.819055242058501e-05   +1.655430005484733e-01   -8.488575525184316e-02   +6.099945010950476e-02; -1.796169936763492e-02   -3.812678827652424e-01   -9.466477349317076e-02   +1.889588576035584e-02   -2.188423114746082e-01   -9.110184059415313e-03   +5.744865249403510e-01   -1.774118690506845e-01   -1.983625608968536e-01   -1.159021341113124e-01   +2.394390619478654e-01   +2.799430449355791e-02   +2.074283083503609e-01   +1.543745646300667e-01   -2.705491176259924e-01   +9.176131390147846e-02];
L2I_L1I_iGABA_netcon = [+7.212401043066517e-02   +1.904390875081388e-01   +1.663563975936698e-01   +3.243767715123165e-02   +1.315090455384383e-01   -1.578000256263287e-01   -1.683471920466550e-01   -1.563715095772528e-01; -3.105197472670922e-01   +1.705749614764927e-01   +2.918286157665366e-01   +2.726776054273809e-02   +2.338282161142835e-02   +1.902866979433615e-01   -6.105732992729498e-02   -9.934333925308220e-02; +7.350240853591351e-02   +9.521208186710184e-02   +4.038404977587881e-03   +5.647696070877076e-03   -5.182167556052802e-03   +1.514711759267708e-01   +9.377360216037650e-02   -3.540648773355975e-02; -7.792571047121535e-02   -3.482554596647579e-01   -1.565816658485025e-02   +5.464003519665560e-02   -4.025057090267908e-02   +1.998555901360635e-01   +1.755862128693601e-01   -3.349342225385393e-01; -1.471840500036996e-01   -3.446529845930530e-01   +1.243869842723058e-01   +1.212142870894731e-01   -3.533625738084281e-01   -2.421357840644050e-01   +6.056143645901735e-03   -3.237195139282062e-01; +1.547047641514920e-01   +5.416809837548973e-02   +2.274094886334623e-01   -2.991036763752073e-01   -3.336141272446682e-01   +3.834057838264987e-01   -3.033433902918629e-01   -2.368568102573337e-02; +1.986707741051325e-01   -6.564862330151752e-02   -1.520888546463615e-01   -3.250972292529034e-01   +1.979199423567307e-01   +2.076761192831928e-01   +1.038143194496855e-01   +1.127677945229625e-01; -2.014936961719608e-01   +4.550656882402111e-02   +8.470588956937036e-02   +1.841403157793235e-01   +2.937546747189238e-01   -1.518806007416165e-01   +1.239640118661855e-01   -2.237869631697934e-01; +2.203938490004430e-02   -1.235010523953578e-01   -1.315312978773721e-01   +1.121517989529625e-01   -1.400514703025955e-01   +1.707935630406418e-01   +3.713207236387945e-02   +2.874741134249537e-01; -2.337556915591668e-01   -3.808990595419602e-02   +1.607595555299351e-01   +2.218263221328631e-01   +1.681437571338313e-01   +2.596620021123872e-01   -1.405784159986044e-01   -3.224995900756111e-01; -2.967724903291067e-01   -2.332508892905499e-02   +2.278878721233151e-01   -1.640246568091856e-01   +9.159241123752090e-02   -1.108081752801210e-01   +8.947763795984762e-03   +1.842135887547998e-01; +2.019675324642106e-01   +1.673488290031597e-01   +2.029089701574417e-01   -3.336900628699173e-01   +1.511574500096445e-01   +2.297078511205970e-01   +5.682868841808895e-02   +3.682942385585990e-01; +3.505146766025929e-02   +3.237944824219312e-01   -1.567595490301933e-01   -1.832617192627731e-01   -1.399716173218880e-01   +2.864998406742317e-01   -4.163003720914940e-01   +1.269373186318931e-01; -2.615794316136234e-01   -8.458740063972006e-02   +2.110246472531464e-01   +2.549695962222269e-01   -2.128466602804898e-01   +3.337788539581144e-02   +1.203943484203622e-01   -9.019445358256530e-02; +1.665614527884392e-02   -1.721775443947384e-01   -4.232355552960164e-01   -4.003425174664149e-02   +1.817798712680795e-01   +1.358880176410303e-01   -9.917458012929203e-03   -4.827887916208888e-02; -3.726231450347255e-02   -1.153981051983169e-01   -2.406434872251410e-01   -3.342240244792463e-02   +5.930464094129750e-02   +1.479119793072442e-01   +2.396013002226363e-01   -2.109362387732245e-01];
L1I_L2I_iGABA_netcon = [+2.672521575715793e-01   +2.851629480049733e-02   -1.627697463925130e-01   +1.470247292914008e-01   +3.041320126643162e-01   -3.382941600992795e-02   -9.268498288120103e-02   +1.155177595442507e-01   -1.169350789836750e-01   -1.096905040415275e-01   -1.014890846927298e-01   +4.201959951258524e-02   +2.362130804531469e-01   +1.363393281759187e-01   +1.691289308469734e-01   -3.430700497059924e-01; +8.249021419440473e-02   +1.967152802999871e-02   +1.960300668119460e-01   +3.038980022503593e-01   +1.732580251469824e-01   +7.700198776210054e-02   -9.107361141775148e-02   +3.526527996949516e-01   -9.738868064344938e-02   +1.393534818887406e-01   -1.226128984645664e-01   +2.571841248065680e-02   +1.921141686093105e-01   -1.060183839074152e-01   -1.826273396606375e-01   -4.737224163292578e-02; +2.712668052596122e-01   +3.844223411955184e-01   -2.462079628701892e-02   +2.051488425184405e-01   -1.063112876840225e-01   +8.888793984857482e-02   +1.093517892412036e-01   -3.866648955503691e-01   -1.208245061339102e-01   -3.425962076735775e-01   -3.741168545815614e-01   -2.984728023459545e-01   +3.413862345834995e-02   -2.093414723748344e-01   +1.157544763716378e-01   -7.609560712458127e-02; -8.286190608381724e-02   -2.557339340026543e-01   +4.610896154425931e-01   -2.458290717286046e-01   +1.241117288261447e-01   -4.194501770667863e-01   -6.896400364164285e-02   -1.911901224558342e-02   +2.529992365778681e-01   +1.803576920438167e-01   -3.523607307117673e-01   -1.564466335642414e-01   +2.008276518669881e-01   -2.914447124668726e-01   -1.850649890601457e-02   -1.040317590270217e-01; +1.988831559962755e-01   -5.156520324459443e-03   -2.852545146478373e-01   -2.714103393507405e-01   +1.312750355657151e-01   -3.568071702210174e-02   +1.428119280015101e-01   +4.485982746666717e-01   +1.641447714030799e-01   +2.338231682825171e-01   +8.083765534112980e-02   +3.029333448514660e-01   +4.563384901493998e-02   -1.908555208482375e-01   +3.104206360212793e-01   -1.618133749365465e-01; +1.606623766918150e-01   +3.997858408630190e-01   +7.672809908787652e-02   +3.275446022031231e-01   -8.883674628805904e-03   -3.581930098243374e-02   +3.164732890545178e-02   +6.133498971885445e-02   +1.073836308121232e-01   -1.210436879641272e-01   -2.177088402202868e-01   +1.296713586408363e-01   -1.205687859193618e-01   +1.808446090164245e-01   -1.876499387360958e-01   +6.059877647842030e-02; -1.795727195098925e-01   -8.018615166124085e-02   -8.526467940009701e-02   +8.752110227908019e-02   +7.827634937033590e-02   -1.455164264778175e-01   -3.967571236570733e-02   -1.265442184761603e-01   -7.029395297426441e-02   +9.177636673434923e-02   +1.602206538256285e-01   +1.009947770279603e-01   -5.831523751383152e-02   -1.685377804349710e-01   -1.341249941117475e-03   -1.594946899062625e-01; +3.694568591866969e-02   +5.864349762946400e-02   -1.054882547912118e-01   -1.659821137681509e-01   -1.359788207894403e-01   -2.181086663239514e-01   -2.505794413294070e-01   +1.693738086894651e-01   +4.604473513201093e-01   -2.266740074532612e-02   -2.210081890334016e-01   +7.217993619603175e-02   +3.743282551004902e-01   +1.445757537139242e-01   -9.029503059917536e-02   +6.036445026361709e-02];
L2E_L1E_iAMPA_netcon = [-2.566748849449990e-01   -3.047323023408148e-01   +9.659997328696768e-02   +6.641319159723422e-03   -1.557911320793807e-01   -2.098062382472854e-01   +2.870112836812692e-02   -1.582294872128546e-01; +2.155436505957289e-01   +2.402576321184907e-02   -1.687340877213315e-01   -1.618718995264225e-01   +2.172634443478315e-01   -1.441581609023841e-01   +1.765679923631126e-01   -2.297725627231342e-01; -4.154419591343986e-01   +3.356217313258391e-01   +3.317310399535000e-01   +2.731080613387075e-01   +1.478475920254618e-01   +1.780866590502351e-01   -2.683267653840551e-01   +4.550142907847162e-01; -2.990903123913357e-01   +6.718989236362771e-03   -7.407925755528928e-02   -2.635785711258777e-02   +4.439616122312994e-01   +4.428559589967104e-01   +1.551728521898774e-01   +3.871680623568153e-01; +7.892956572569940e-02   -1.606326822272542e-01   -1.031835563717516e-01   +1.146432723685906e-01   -2.878818164023436e-01   +1.607595183309276e-01   -1.694958508728917e-04   +6.167459240745560e-02; -1.347135585135506e-02   +1.947283732889479e-01   +3.454813144307864e-01   -3.220964999182228e-02   +3.395729886119928e-01   +4.388377190035939e-02   -2.824374080375429e-01   -2.670297108821494e-01; -2.063791597373184e-01   -2.140415951073083e-01   +1.715432386855116e-01   +2.467096983914601e-02   +2.310704027642452e-02   +1.796096784500556e-01   -1.675328728999018e-01   -2.406072158200793e-01; -5.031212940654529e-02   -2.628463278480507e-01   -1.039177517767837e-01   -3.406982672938229e-01   +2.083031764912389e-01   -3.111529991750078e-01   -3.008333229131771e-02   +1.704964880957620e-01; -4.517152773267487e-02   +5.698355894409520e-02   -5.061493466629324e-01   -2.722388869755039e-01   +2.207316410606255e-01   -9.529782454875346e-02   +2.664810542310119e-01   +2.745967810525442e-01; -2.033379245801738e-01   -7.685283750131090e-03   +7.720176107248469e-02   +6.074476519420866e-02   +3.670925715600087e-01   -1.661339217302475e-01   +2.855424732189972e-02   -1.475522758002013e-01; -9.387869038399860e-02   +5.704993003604210e-02   +3.948348622349097e-01   -7.358545067505536e-02   +3.842326020133703e-01   +3.089845337705698e-01   -1.336104306476767e-01   +1.427223460260931e-01; +1.146085550796528e-01   +1.340559631458491e-02   -1.477004051994615e-02   +2.011580529266060e-01   -2.635067825449848e-01   +2.254840803772268e-02   -1.149485516203691e-01   -2.325874677535070e-01; +3.425630483295002e-02   -6.637064593684530e-03   +7.422213553084485e-02   -6.200738251000321e-02   +1.418512777545737e-02   -2.715933023022878e-01   +2.786248318153380e-01   +1.353505893335019e-01; -3.877191893219696e-01   -2.268106882486036e-01   +4.225816580841011e-02   +2.520919125816800e-01   -3.737026616488130e-02   -3.000750403268529e-02   +9.595834772217979e-02   -1.564946355272973e-01; +2.382094708039420e-01   -2.159200824867398e-01   +4.701890240801586e-01   +2.897450695541494e-01   +2.306835069970510e-01   +1.072995118869962e-01   -1.107833461180787e-01   +6.328621620381444e-02; +9.093992581751031e-02   +1.897474315723343e-01   -1.384374475901054e-01   -1.273280469121242e-01   +1.612995542998546e-01   +3.555308756948251e-01   +4.837376531163533e-02   +2.611784594660317e-01];
L1E_L2E_iAMPA_netcon = [+1.187447764376834e-01   -4.951781967790337e-02   -2.079954066446697e-01   -2.858743199693570e-01   -4.024538848318192e-01   -1.560147291447196e-01   -2.795810756714215e-02   -1.673681558325305e-01   -7.235235178165968e-02   -6.134851465890541e-02   +5.740002602041872e-02   +2.442848503026743e-01   -7.098672046227375e-02   -1.526030293707778e-01   -5.343691254555380e-02   +1.264018583549269e-01; -3.768888065211731e-02   +2.387942373270562e-01   +1.464682470788714e-01   +2.726356444823423e-01   +1.328306120001492e-01   -2.145719497759294e-01   -5.656250661559925e-02   +2.396946916241472e-01   -1.073250904410290e-01   +4.252728494417030e-01   +2.771789794054137e-02   -6.290268543768529e-02   -3.938943000256916e-01   -1.851868424619219e-01   -1.187320809541594e-01   +3.491148448942667e-02; -8.893385073301015e-02   -4.296874414924586e-01   -4.260906178147776e-01   -3.608779259922695e-02   -3.155730933275895e-01   -3.443922839396157e-02   -6.095907194522952e-02   -1.840060470561560e-01   +3.453393464945126e-02   -2.842017654809919e-01   +1.975322486883319e-01   +2.303562711084719e-01   -3.012387702937743e-01   -2.233776065816153e-01   -1.793486065437819e-01   -1.443649029838409e-01; +1.445334010402015e-01   -4.246752688326250e-02   +2.469259168329713e-01   +2.981996370942283e-01   -3.862101218162419e-01   +3.008743848467820e-01   +1.943245219760454e-01   +7.383293423285919e-02   +5.949370850157509e-02   -1.430367353085822e-01   +5.270457323127323e-02   -9.001475855365619e-02   -7.502660196711583e-02   +1.133287664100714e-01   -3.958556576922416e-01   +2.430212018280361e-01; +3.794721592663976e-01   +5.540797047546503e-02   -1.772974978914352e-01   +3.277051207675537e-02   -6.468502245578665e-02   +2.044306010115643e-01   +8.400455296078888e-02   -1.737595592768554e-02   -1.254589868321944e-01   +2.519821923762398e-01   +6.595574724434003e-02   +4.381224372325836e-02   +3.405210143973240e-02   +4.078767581806036e-01   -4.256747901113873e-02   +9.625361497636738e-02; -1.757192568518293e-01   -1.197560483862462e-01   +4.894372247940083e-03   -3.984773865633134e-02   +1.425762397423283e-01   +1.928654912511393e-01   +2.799388632222199e-01   -4.706036577075512e-02   +2.569975358217970e-01   +2.243044279738662e-01   +2.902815656785443e-01   +2.327042438163196e-02   -5.043390638198986e-02   -1.906373285076243e-02   +3.118958609520847e-02   +7.240199096816689e-02; -3.067909927289555e-01   +1.274243490199518e-01   +3.290169013762408e-01   +2.563341463703215e-01   -4.303008458490454e-02   +1.095573784372105e-01   -7.890307607123181e-02   +3.004966916335179e-02   +2.291447753688575e-01   +1.619391311256926e-01   +2.860986339454731e-01   +2.122644139963682e-02   +1.629322119534206e-01   -2.959257287641716e-01   -2.059123067307134e-01   +3.710003872507600e-02; +1.640507407581699e-01   -2.283195981716996e-01   +8.944871094682810e-02   -1.822047321251969e-01   +3.080578127737202e-02   -2.652864814834920e-01   +1.631327847240046e-01   +8.588091684316759e-02   -1.541508247731853e-01   -4.438189426033014e-02   +3.453220840738504e-01   -2.181570748435288e-01   -2.706027658591361e-01   +4.534288297368477e-02   -1.651633373654065e-02   -9.142215178951452e-02];
L2I_L2E_iAMPA_netcon = [+7.170390125648360e-02   +3.657161705159722e-01   +2.835495945207206e-01   -1.873504473253626e-01   +1.445772220505046e-02   -4.971808288525136e-02   -1.640033229656488e-01   +2.207048981999257e-01; +3.913638655324062e-02   +2.468206984396487e-01   -3.442791657434762e-01   -2.010979812257219e-01   +1.905794899169545e-02   +1.754489802540276e-01   +2.831500875512627e-01   -2.044347129531695e-01; +4.903184051065798e-02   -1.254044876792489e-01   +2.003711727891905e-02   -5.339252745682849e-02   +1.187969419085463e-01   +2.297788506268792e-01   +2.853231088657687e-01   -7.309638779414832e-02; -9.567400106512121e-02   +2.571688450392234e-01   +5.633817150905419e-02   -1.734536241254758e-01   -1.388584173731863e-01   +2.001222188409444e-01   -9.999746436884183e-02   -2.055107113911669e-02; -2.467381532944257e-01   -2.151378748695099e-01   +6.090136151497151e-03   -1.824160219180606e-01   -7.300904716695630e-02   -1.544596263213708e-01   +3.501000517420702e-02   +4.176866557853036e-01; -9.817204502115540e-04   -1.453196426462840e-01   -8.084911103984586e-02   +1.053685471996904e-01   +4.657472934987301e-02   +2.878071585385790e-01   +2.067463975909872e-01   +1.395441311878199e-02; +2.583696048372217e-01   -9.874884848047760e-02   +1.292404040661713e-01   -3.923802049251544e-02   +3.944778950624839e-01   -1.261069585426922e-01   +4.866394325232433e-02   -1.240592361252545e-01; +1.727757014447005e-01   -2.965134911148789e-02   -3.106894354689438e-01   -1.545906029266628e-01   -2.678719656444752e-01   -4.324931490823589e-02   +1.800774912122416e-01   -1.586443871989865e-01];
L2E_L2I_iGABA_netcon = [-1.718330641769769e-02   +2.368465884806285e-02   +6.421982926081096e-02   -3.775857054198565e-01   +2.207292586179544e-01   +1.104611165985026e-01   -3.910872673353935e-01   +5.901218816706270e-02; -2.618090731551962e-02   -1.592763784198989e-02   +3.948626568565335e-01   +3.120944861949889e-01   +1.399522802603810e-01   -1.123325926645372e-01   -4.366468333345794e-01   -2.120560528238114e-01; +3.039305422529873e-01   -9.880871134089125e-02   -2.123616831228215e-01   +1.034789331733851e-01   -2.269398195515628e-01   +2.961096531452870e-01   -2.012184170729588e-01   -1.476468938226515e-01; +1.289551090306777e-01   +4.420670503323271e-02   +3.171837082795986e-02   +1.454640674974142e-01   +1.020688052400243e-01   -1.006751667754104e-01   +1.182938829049031e-01   -3.236790610586779e-01; -1.368211890095519e-01   +4.098445520582275e-01   +5.134874070191930e-01   +3.673447232603339e-02   -2.020142533075124e-01   -1.821104338409924e-01   -2.341259156293536e-01   -2.381662654404582e-03; -1.990488520368286e-01   +1.477973496777228e-01   -1.519922811685077e-01   +2.995588596410947e-01   -1.144715752668004e-01   +2.083166225313856e-01   +7.220812535274773e-02   +3.080811960360282e-01; -9.662451799072894e-02   +2.000516594454094e-02   +1.770067958692117e-01   -4.765290342559299e-01   +3.920002743631008e-02   -1.606259701997508e-01   -3.766655227411971e-01   -2.172450493876209e-01; -2.559587052647913e-01   -1.752830717287970e-01   +5.464403771155685e-02   -4.446940344288067e-02   -3.396321561409675e-01   -4.734130652242853e-02   +2.221939367979078e-01   +1.965436235651384e-01];
L3E_L2E_iAMPA_netcon = [+3.381474031127166e-03   -1.258027674427063e-02   +1.864870399129640e-01   +1.528083749401564e-01   +2.852794423832764e-01   +2.025282716642200e-01   -1.728578087569714e-01   +1.868015940671393e-01   -3.442672790932781e-02   +2.662043850400595e-01   -1.934956613615582e-01   +3.136281246572735e-01; -2.100992253588606e-01   +2.475076635478525e-01   +6.150722678984463e-03   +1.064934866163185e-01   -2.039254876186787e-02   +1.283193796917035e-01   +1.651804755254427e-02   +2.540857381964899e-02   -9.292848290737732e-03   +1.899472816884984e-01   +1.785889126246964e-01   +3.235364406219257e-01; +7.546006124478087e-02   -1.604080675615853e-01   -2.538504846766774e-01   -1.390540119901303e-01   +8.576609844983620e-02   -1.885484420507824e-01   +1.948331732542367e-01   +1.855024379015535e-01   -4.521002579140472e-01   -2.028024236076418e-01   -3.673253475765104e-02   +7.633744728065274e-02; +4.068111014333202e-01   -1.673195527591466e-01   +2.486799555847559e-02   +9.477690671422487e-02   +8.837994513989741e-02   +1.894507047676148e-01   -1.946694723329587e-01   +1.965320871681574e-01   +2.560223685153237e-01   -9.473005790739955e-02   -7.637260630771539e-02   +4.306957014572892e-01; +9.559361554515425e-02   -1.238672371479980e-01   -2.864453971614657e-01   +3.277960389300838e-02   +1.758912032385697e-01   +5.266765721078581e-01   -1.281369625896776e-01   +1.198489849812473e-01   +1.343552088361654e-01   -2.070239905495868e-01   +1.954570418849945e-01   +9.683546716894961e-02; +2.386504752393150e-01   +1.308113319905089e-01   +4.235257326312638e-01   -1.504927651765706e-02   -3.234481222322507e-01   -8.677916403515459e-02   +1.154413820818750e-01   -2.568056548910098e-01   +9.016938605792485e-02   -2.780236367605379e-01   -4.559122739828368e-02   +8.194813099390921e-02; +1.708834928216696e-01   +2.753172783850870e-01   -1.227800277903857e-01   -2.133357163801564e-01   +2.467564527972203e-01   +5.581510594332716e-02   -1.162017942596506e-01   +1.980157555750579e-01   +1.293179333710875e-01   -4.289250213860899e-01   +1.500725179041285e-01   +6.231175678548534e-02; -1.231317211699824e-01   -2.036776196054856e-01   -1.541027374977733e-01   -2.993635846305061e-02   -4.858874714864568e-01   -1.963680034798336e-01   +1.528614499634529e-01   -1.993080002084274e-01   +3.937105815078338e-01   -2.074459804204247e-01   -6.083553703498518e-02   -1.103180166768159e-01];
L3I_L2I_iGABA_netcon = [-2.374106910328845e-01   -3.459351700789424e-01   -2.858622612040653e-01   -5.998728118864689e-02   +1.510168980804118e-01   -5.506941130620924e-02   +3.124795054007757e-01   +7.675255152010106e-02   +1.568170403286163e-01   +3.336866644343427e-01   -3.320961254965482e-01   +3.213751008102170e-01; -1.359448331781919e-01   -9.820822128075554e-02   -1.525747478293668e-01   -1.145492773640553e-01   -9.367329010805946e-02   +3.085970338596726e-01   -9.033212367464824e-02   -1.275191993983888e-01   +4.732511457567001e-02   +4.212690965747083e-01   -2.099576822535027e-01   +4.617766388090319e-01; -1.284866567446808e-01   -3.222680305704900e-02   -1.841123967348364e-01   -6.133926705926833e-02   +4.772698262894195e-01   -2.422523818624095e-01   +6.757256910621048e-02   -1.689693621486348e-01   +2.470420979664918e-01   +1.849737366958482e-01   -1.479916620000474e-01   -2.119920450231398e-01; -2.768646821781579e-01   -1.721936349800296e-01   +1.267820550301321e-01   +3.058101133872725e-01   +9.430867727905481e-02   -3.960926044464176e-02   -1.456235094375655e-01   +5.832514991876230e-02   +5.933925730446413e-02   +3.236204934911964e-01   -7.524629109925948e-02   +2.092150277630808e-01; +5.331998939304130e-01   +6.343561745824927e-02   -1.080147299024184e-03   +1.849425579747509e-01   -2.191779074795905e-01   +5.608428999521416e-02   -3.165164121870512e-01   +3.904738571473869e-02   +1.794741396768483e-01   +2.220505258207229e-01   -1.625468903373417e-01   +4.295028228833440e-02; +4.115852810454199e-02   -3.369237117978426e-01   -2.282184591269179e-01   -7.818192112056557e-02   -3.635427217127777e-02   -1.975133311072677e-01   +3.041605565422084e-01   +2.898956122689732e-01   -7.000571911432076e-02   +6.023812256576364e-02   -4.413724391907768e-01   +3.000329134502518e-01; +3.225691503289070e-01   +4.927453824304501e-02   -4.688135093670603e-02   -1.793593692219551e-01   +4.482646804295778e-02   -1.376971915168946e-01   +8.206187597413618e-02   +1.361717476627106e-01   -3.256297870025657e-01   -5.302241326092662e-02   +3.238737140944681e-01   +2.430447101723660e-03; -7.588245734345207e-02   -1.819832771803194e-01   -3.748800245911965e-01   -9.316232738567588e-02   -6.533152915684702e-03   -1.204748918542525e-01   -1.610044051550583e-02   -8.364113521978536e-02   -5.730925869467360e-02   +5.325619704222527e-02   -4.315068325179990e-01   -1.612182861663216e-01];
L2E_L3E_iAMPA_netcon = [-5.987620424704226e-02   -4.578647962940781e-02   +1.043431563420584e-01   +1.768378660840386e-01   -2.958240653292132e-01   +2.369634434540713e-01   +5.932531459493288e-02   -4.420072327048545e-01; +1.536306467162087e-02   +7.050636449685746e-02   +2.865438378728433e-02   +2.063277923625278e-01   +3.763471733635467e-01   +1.470971868666529e-01   +5.923707806373631e-02   -1.385623756807232e-03; -8.439613420659714e-02   +7.602703528169082e-02   +2.450468378816138e-02   +1.896403173050160e-01   -1.263258827078852e-01   -2.628548995097622e-01   +3.708666016088111e-01   -4.126904987349596e-01; +2.100105095778053e-01   -1.238339234820286e-01   -2.541942836524170e-01   -1.957945615327012e-01   -1.204903521578293e-01   +1.259225477823774e-02   -4.583335818836922e-02   +5.690121499130602e-01; -3.193846640652111e-01   +1.883915364785718e-01   -3.560112101027027e-01   +1.788438091972256e-01   +1.273341066222098e-01   -7.555002554911727e-02   -2.074918964743194e-01   -2.875171313737674e-01; +1.140290856938351e-01   +8.514259270519277e-02   +2.097934608456972e-01   +2.720449664162060e-01   -6.643870299743182e-02   +3.928294546372280e-04   -1.022655469387938e-01   -1.483504810816839e-01; +3.102604349237366e-01   +2.807175281897232e-01   +1.315923938796171e-01   -2.733614688051904e-01   -2.584065337698723e-01   +1.524280011978405e-02   -3.063541222245167e-01   -1.007455521206025e-01; -1.610898590783382e-01   +2.455534610649602e-01   +6.058604407926201e-02   -1.283960787790923e-01   +1.821389186078916e-01   +1.442703605375381e-01   +2.842639821347656e-01   +4.443839870771249e-02; +3.698522780978746e-01   -1.538782534292238e-01   +1.554692566640665e-02   +2.160107065372281e-01   +1.462329954384877e-01   +1.825140083278162e-01   -2.591132764977973e-01   +2.161987647761203e-01; +2.346015450191795e-01   +9.113557574897539e-02   +1.222479057554346e-01   -3.259817346772682e-01   -2.923170930948557e-02   +2.449902481169605e-02   +2.522390851394462e-01   -3.328021000483156e-03; +3.011587300489602e-01   -5.037410077740730e-02   -2.076248640492746e-01   +6.839974893162733e-03   -1.825299718722222e-01   -9.003189388056847e-02   +3.046044056652407e-01   +4.446994996034815e-02; +2.764808239544236e-01   +2.381418458183982e-01   -1.835676576150702e-01   -6.470553563407959e-02   -3.023492323385971e-01   -3.230386926629065e-01   +1.022001255492477e-01   -1.393705283769817e-01];
L2I_L3I_iGABA_netcon = [-2.187846324698468e-01   -2.050351828383259e-01   +2.956198888890457e-01   +1.069973802613158e-02   -1.213816233183624e-01   -1.585011095592734e-01   -7.449717534453637e-02   -2.920577494538843e-01; +3.521034121671127e-02   +2.424170999057353e-01   +1.674006430054026e-03   +3.045400419984029e-01   -5.596312325254668e-02   +4.279821161015626e-01   +3.336278333634440e-01   -4.054715464295868e-01; -1.685470418110998e-01   +9.636801479763937e-03   +2.179441429950022e-01   -6.958397823374536e-02   +2.294959246995979e-01   +1.697429504171877e-01   +2.757779925042051e-01   +2.648711911972967e-02; +2.395967742051333e-01   -1.858421742384440e-01   -1.115722022339662e-01   +2.284937597909925e-01   -3.924454211596097e-01   +1.321716665673524e-02   -2.604163202853733e-01   -1.291639453719656e-01; -2.143589807564430e-01   +3.272537308911836e-01   -7.952235563546235e-02   +4.316578899255874e-02   -1.464536799672201e-01   +8.697851314077028e-03   +1.322674322713090e-01   +1.476466007683087e-01; +1.187807236646320e-01   -1.413168709286092e-01   +5.388036229666464e-02   -3.138425197325457e-01   +2.757473935138001e-01   +3.316672135428146e-01   -1.128108043635263e-01   +1.702312606926870e-01; -2.134786868000279e-01   +1.290786122999774e-01   -2.003507108594250e-01   -4.443326597327821e-01   +3.413664209630732e-02   +1.469777100920601e-01   -2.141615903490592e-01   +1.574145084911079e-01; -2.025257099832369e-01   -6.291018576242505e-02   +4.564687644944140e-01   +6.798392896149169e-03   -9.780722944569578e-02   +2.505849902704101e-01   +1.891224534486503e-01   -6.366203422717334e-02; +1.614811350533607e-01   -3.366047858108729e-01   -1.934590530743791e-01   +1.977470762579783e-01   +1.729179831104738e-03   -3.846125557082929e-01   -8.382541512369193e-02   +1.103065798849895e-01; +5.998618957652466e-02   -8.585344552986100e-02   -1.625700249701155e-01   -6.406460761093469e-03   -2.845584419749601e-01   +4.518878338058631e-01   -3.517312829798930e-02   +1.564207895614033e-01; -2.441426571792892e-01   +8.912576692868750e-02   -4.703777579214243e-02   +1.482997563229528e-02   -1.792928726850319e-01   -1.632201043485154e-01   +5.090510950765030e-01   -1.394762126694082e-02; -1.671525036371878e-01   +1.028800614560218e-01   +1.048896685910038e-01   +2.600271013989124e-01   -1.996503710088154e-01   +2.462849757583633e-01   -2.062673011717968e-01   +1.106362476441364e-01];
L3I_L3E_iAMPA_netcon = [-1.625265157000736e-01   +2.489499841107973e-01   +2.354332484795944e-02   +2.133118409867453e-01   -3.532554675945331e-02   -1.950224678209837e-01   -4.138686853384851e-02   +9.371404628185365e-04   -8.245108749940545e-02   -3.591113278196182e-01   -2.669209399750682e-01   +4.314338028448612e-01; -6.301589046938345e-02   -1.431536985668429e-01   +1.667472082718261e-02   -2.699929212772925e-01   -2.578973695045514e-02   -2.977647353065302e-01   -1.340084319260196e-01   -2.152317212591860e-01   -3.152267538215130e-01   +1.697891272925818e-01   -1.039086978969287e-01   +4.155240848950021e-01; +2.945327684615884e-01   +1.790698482238661e-02   -2.292349144941264e-01   +9.544710613896172e-02   +2.306243494229117e-01   -1.449138814108586e-01   -7.740173916824217e-03   -8.915523170364389e-02   -3.138032501182432e-01   -1.263835826574239e-01   -3.978742300104177e-02   -2.596070567892064e-01; +1.918622402555596e-02   +1.826750973555679e-01   -1.138856305923149e-01   +4.178307459655533e-01   +2.549696407430350e-01   -1.328599945236041e-01   -2.149719282806261e-01   -4.372310447652534e-01   +1.830175830211988e-01   -2.008153109005733e-01   +8.177515701466623e-02   +1.061308342898786e-01; +3.646632530153106e-01   -1.056693336286906e-01   -3.254141914524165e-01   -5.635450755290606e-02   -8.306031902136940e-02   +4.791121065537561e-01   -2.084444706318970e-01   +9.961194794180492e-02   -1.160555353883228e-01   +2.305487106991047e-01   +1.250150661785158e-01   -3.647251888223377e-01; -3.889789914600595e-02   -3.236678385496004e-01   -2.749729591776785e-01   +1.912264851069923e-01   +1.735183247178668e-01   -1.404253761707956e-01   +3.196363099544129e-01   -3.120480044211366e-02   -2.726451386645704e-01   -2.201523107687393e-01   +1.765864768716894e-01   +3.703143885700687e-01; -2.509164468272342e-01   +1.578271592313360e-01   -3.069913795319865e-02   -4.015933988228144e-01   -1.018612846069646e-01   +1.122431784559958e-01   -1.412707644357636e-03   -1.184702354531188e-01   +4.260477772550856e-01   -2.556468024748404e-01   +2.115674856487629e-02   -8.108417117506483e-03; +1.889761012707719e-01   +5.183138024308975e-03   +9.185288648499433e-02   -1.861313845566859e-02   -6.832647037415242e-02   -4.960122297553922e-02   +6.176258473762583e-02   +1.548353442098001e-01   +3.848759187991180e-02   -2.067326600550643e-01   +3.254637759143519e-01   +2.175915537560704e-01; -9.712696150755970e-02   -1.922981960528715e-01   -3.636374585112027e-02   +2.180542485808200e-01   +1.995008057813143e-01   +2.514226896089133e-01   +1.008459071754253e-02   -5.259762915166221e-01   +8.124287942270042e-02   +2.887292201964215e-02   -6.550328373964713e-02   -2.928347489216945e-01; -1.502841522343555e-01   +1.734574736721264e-01   +4.779750309664557e-02   +4.670621862478910e-02   +4.996257299336829e-01   -7.583707289052541e-03   -1.604610160872365e-01   +1.112879447791862e-01   +2.014134198850258e-01   +1.084829152553816e-01   +2.434872327918919e-02   +4.235471961212222e-01; +3.686953475127261e-01   -2.838400500681535e-02   +9.227185388287443e-03   -2.930094214902346e-01   -6.874786580675160e-02   -1.662042987860478e-01   -1.013515010372171e-01   -2.922952411079669e-01   +2.433088474873317e-01   +3.611306039692284e-01   +7.551010151646441e-02   +1.441365189184849e-01; -2.356776073205828e-01   -8.505955310629609e-02   +4.243293716014395e-01   -1.578002537634396e-02   +3.448072669357448e-03   +5.802930055519811e-02   -4.807726953806895e-01   +1.281622697397829e-01   -6.086751074009605e-03   -1.343416955874699e-01   -1.147170347183838e-01   +1.668111762682407e-01];
L3E_L3I_iGABA_netcon = [+1.149629348552834e-01   -1.828305538072763e-02   -2.612752699928324e-01   +6.305475827460451e-02   +3.177318004460124e-02   +1.483686621379490e-01   +3.724040771354770e-03   +1.428758345835483e-01   +2.088387641494548e-01   +1.036076689593943e-01   +4.709542320917161e-01   +1.401503945277806e-01; -2.509927524035907e-03   -7.768793587174846e-02   -2.495188301848985e-01   +7.964832917212959e-02   -2.504867815126724e-02   +1.695370063948612e-01   -2.746508047428252e-01   -1.777690962447243e-01   +4.069269688850893e-01   +4.550213152488894e-01   +5.114039801439612e-02   -3.569501994214880e-01; -3.661448059721751e-01   -2.937703328326314e-01   -3.740352086388443e-01   +1.246196231851717e-01   +9.832548304675143e-03   -9.599327757530182e-03   -1.178375618785747e-01   +1.223234553609433e-03   +6.663685360444802e-02   +1.832586536265948e-01   +1.859343589845028e-01   +4.804398024165711e-01; -6.682084436590649e-02   -2.142064264300061e-01   +1.096623292566168e-01   +1.113235514864971e-01   -1.474870228948955e-01   +2.219224838706437e-01   -4.021768015993658e-02   +4.300161480731121e-01   +7.638397263220228e-02   -5.255303831377477e-02   -8.496220769074436e-02   +1.635346102834381e-01; +6.810216278927830e-02   +1.063292096193675e-01   -2.005755052085999e-01   -3.090477201156440e-02   +1.569103487636097e-01   +5.129192147468825e-02   +1.482075470004392e-01   -3.510544360770250e-01   +1.292945898130715e-01   -6.079719479743629e-03   -2.793176059396282e-01   -1.224503021153999e-01; -2.210377618475287e-01   +1.647845287915300e-01   -5.728936273677795e-02   +3.580732005756224e-01   -1.368756077158109e-01   -2.676865487992495e-01   +4.418093311818360e-02   -1.017003375857806e-01   +2.336654876878687e-01   -1.967060987123625e-01   -1.802962708740429e-01   +2.019459003765710e-02; +9.645465881893969e-02   -2.565391047221340e-01   -1.138754906311831e-01   +4.548185887248059e-02   -3.564005882754177e-01   -1.758701951458413e-01   +1.078347025663344e-01   -1.401908695861831e-01   -1.402690330525903e-01   -1.035037064998023e-01   -1.320281792279406e-01   -1.560629719735018e-01; +2.386898580333430e-01   -1.648594739080640e-01   -3.768292930589170e-02   -1.992573305843255e-02   +2.644591555100466e-01   -2.837209560007322e-02   -1.068236674774979e-01   +2.647131165910611e-01   -2.592488968166535e-01   -2.398034347844272e-02   -1.713636523031967e-01   -8.781523395001205e-02; -9.613701126135671e-02   -1.195124563338979e-01   +8.959753634517618e-02   +7.614789189755536e-02   +1.653030088864413e-01   +6.800942829613085e-02   +1.644705825348742e-01   +1.475671498366407e-01   +1.046026131437129e-01   +2.025798501109639e-01   +4.662442572680387e-02   -3.433978674037942e-01; +2.087765510702575e-01   -4.563203891729498e-01   +8.835742421386179e-02   -6.189310882260901e-03   -3.551102854403378e-02   +2.942348062973061e-01   -1.856671160402734e-02   -1.536421115548706e-01   -1.677694351882095e-01   +4.448805941347599e-02   +2.497422958330356e-01   +2.394715211634250e-01; -2.111126421041600e-01   -1.356124204946322e-01   +5.947131514809351e-02   -6.713316827265685e-02   +1.830578374439730e-01   -1.357508810764802e-01   +1.609818035541132e-01   -3.794856477040016e-01   -1.749624714733828e-01   -1.865157683322304e-01   +2.625110997692076e-01   +1.740297248078821e-01; +3.598974737276864e-01   -9.141999579048882e-02   +1.035602131343116e-01   -3.149233031432773e-01   +9.317633404276340e-03   +1.362292277300172e-01   -1.889568466544657e-01   -1.031852264953663e-01   +9.295020204446322e-03   -1.385273851393761e-01   +1.270345142357212e-01   -3.538154562867066e-02];
L2E_Input1_iAMPA_netcon = [-1.598325771560163e-02   +5.270978770319926e-02   -1.973130070690044e-01   -1.346518572697454e-01   -9.078016809165487e-02   +1.514732385792819e-03   +5.144702792722625e-03   -6.242456719714884e-02];
L2I_Input2_iAMPA_netcon = [+1.081308400506430e-01   -2.629752693764807e-01   +3.511959332439205e-01   -7.090346892981342e-02   -3.158940845849954e-01   -1.586718479715247e-01   +9.487198358664542e-02   -2.590500028326873e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
