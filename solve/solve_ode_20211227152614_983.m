function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+8.086922819948940e-02   +1.945717391528798e-01   +1.068172986707486e-01   +8.150057086698609e-02   +3.370509441532628e-01   +5.473915694059835e-02   +1.383424970882394e-01   +1.713932418949606e-01   +9.390152891238066e-02   +1.906532461617970e-01   +3.937275111635686e-01   +3.025282884405446e-01   +1.168788253584332e-01   +2.050754871290358e-01   +3.398683275707552e-01   +4.384858845326243e-03; +1.073307159803338e-01   +9.133618624817723e-02   +1.018146552939184e-01   +2.399495749019083e-01   +1.550862793087686e-01   +2.851226277112599e-01   +1.387978863874965e-01   +1.215743723177935e-01   +1.244610364247675e-01   +1.119914023336937e-01   +8.421794866239418e-02   +2.646144842197013e-03   +3.223484407476770e-01   +1.854930137912880e-01   +2.106629953115203e-01   +2.366061387211974e-01; +2.139228124884328e-01   +1.429582222069650e-01   +1.330338963796097e-01   +7.195743206503161e-02   +8.589572289829626e-02   +1.034206807439793e-01   +2.089614894428558e-01   +1.092628524927104e-01   +4.748893793463864e-02   +3.491088191658079e-01   +2.386101103832063e-02   +2.742609402197554e-01   +3.636753958665097e-02   +2.309602460876968e-01   +1.350053310418933e-01   +2.879646681592249e-01; +2.589032332894777e-01   +2.865054529854551e-01   +3.326831109193791e-01   +3.127516068476046e-01   +2.905168318108368e-01   +1.485388931834098e-01   +1.688451810289546e-01   +3.257183016369712e-01   +3.089552323362085e-02   +2.512841998094431e-01   +6.278886636501495e-02   -3.455668067391785e-02   +2.291186386980642e-01   +1.071793622793912e-01   +2.863273182347520e-01   -3.267415472189665e-02; +1.282913765543786e-01   +2.405285064577521e-01   +3.123534164741623e-01   +1.925776200097533e-01   -5.707971387315821e-03   +5.791321503620434e-02   +2.926200711587479e-01   +2.209921620119701e-01   +1.300427891070428e-01   +4.637489698674469e-02   +5.954884612437451e-02   +1.330124199133169e-01   +2.500857676442811e-01   +2.425058910510529e-01   +2.658743504782873e-01   +3.430572289772160e-01; +1.896972440213117e-01   +2.069442731721335e-01   +1.419045859887841e-01   +3.202664208659564e-01   +7.381837297498987e-02   +3.278922578963669e-02   +1.872789250375433e-01   +2.193057293871420e-01   +2.476270201353476e-01   +2.020087622668095e-01   +3.302259697303846e-01   +3.094534483472454e-01   +1.250486994577494e-01   +1.959361475823115e-01   +1.225642092646684e-01   +1.285060300639381e-01; +1.019591146099274e-02   +6.897891006736119e-02   +1.822085808017762e-01   +3.169547752434896e-01   +1.341474105972169e-01   +3.601135103266855e-02   +1.860128109480371e-01   +2.327825392419520e-02   +3.109762242540785e-01   +6.757462512984314e-02   +3.217771303176662e-02   +2.041144158280293e-01   +1.277163956880966e-01   +1.700184221363508e-01   +2.339342473096427e-01   +2.434858016214760e-01; +2.995074660677508e-01   +4.889978284371396e-02   +9.664079738436473e-02   +6.325990716847577e-02   +7.668669190168642e-02   +3.957824325051081e-01   +1.150201053702283e-01   +1.465674449396211e-01   +1.095494483883719e-02   +6.323777826819930e-02   +1.598789486764141e-01   +1.721039108491600e-01   +1.394648766758213e-01   +3.192104231522974e-01   +6.314726867821761e-02   +4.471168958018933e-02; +2.445185117936513e-01   +1.024038072760028e-01   +1.016627970085314e-01   +2.220805920589380e-01   +2.815864390047045e-01   +7.486849978043644e-02   +1.338164998260124e-01   +8.585007883440056e-03   +2.178013287732894e-01   +2.383461695738352e-02   +2.361110855695778e-01   +1.832451738400459e-02   +8.368469537807663e-02   +1.662314814004943e-01   +2.153718873199356e-01   +1.122524412888884e-01; +2.011469109327439e-01   +1.680713061849799e-01   +2.576154098306538e-01   +1.680395594666937e-01   +2.802359040027640e-01   +3.429256185492865e-01   +1.315161791484261e-01   -4.435686827079649e-04   +1.441264717681386e-01   +2.900681249417780e-01   +2.540396427275562e-01   +1.020483241588137e-01   +3.528873327725833e-01   +2.458026130807262e-01   +2.518435262438742e-01   +3.631349357158734e-02; +6.060558435989230e-02   -1.639001213565960e-02   +2.630626699377225e-01   +1.165016931308129e-01   +9.251448894142869e-02   +3.572367057100345e-01   +2.712924157967337e-01   +9.956802395684025e-02   +1.115071629300434e-01   +1.329121904012023e-01   -9.424764825897176e-03   +2.070092651983671e-01   +1.078375968849451e-01   +1.064891244116026e-01   +2.817947842947620e-01   +1.063843516761470e-01; +4.038421877416137e-02   +1.143924634699428e-01   -1.193556161509608e-02   +1.902049628316866e-01   +1.588145788327611e-01   +2.515668220105796e-02   +3.605067684463660e-01   +2.980733034643789e-01   +1.633224913952613e-01   +2.109483107878493e-01   +1.430806200876636e-01   +2.653014260230950e-01   +2.429448115076871e-01   +2.454352201010304e-01   +3.514227562934492e-01   +3.233972402270943e-01; +3.191090307307395e-01   +3.474787603847531e-01   +1.276904322783581e-01   +3.749631453737072e-02   +2.147776476123917e-01   +1.625017831363210e-01   +2.544898342228982e-01   +5.637163015799147e-03   +3.067358616413825e-01   +3.323255996423688e-01   +2.386367232059928e-01   +3.034598716049135e-02   +1.217490532451073e-01   +1.609716214156794e-01   +2.177194950189017e-01   +1.173943927651681e-01; +3.193531526812390e-01   +7.592980152882917e-02   +1.890011622660568e-01   +2.422235278646125e-01   +2.717034167455014e-01   +8.043031831519552e-02   +1.689042563071208e-01   +1.004693724109267e-01   +2.233367478206855e-01   +2.022805670215249e-01   +2.732282787539427e-01   +3.620212567595869e-01   +2.279043339885535e-01   +2.644903805483507e-01   +3.924225808930091e-01   +1.635261422157300e-01; +2.832937602325167e-01   +8.798567923243809e-02   +2.366735959404671e-01   +3.018268713255974e-01   +2.035122796993476e-01   +2.408680567748040e-02   +2.961586833850962e-01   +1.592497237733649e-01   +1.687384949322612e-01   +1.835040764396587e-01   +5.796084035124057e-02   +4.641767829252064e-02   +3.817106157583954e-01   +5.706510902701684e-02   +1.610040162384456e-01   +3.315305403787961e-01; +3.155073828112000e-01   +1.511930684995179e-01   +2.654410711922270e-01   +7.373483165637351e-02   +2.344323557403363e-01   +1.916021589999857e-01   +2.355620257465659e-01   +2.459614007552637e-01   +2.113504693729490e-01   +9.156673747869797e-02   +5.014820409217265e-02   +9.315498784414394e-02   +1.040059434250271e-01   +4.933466836888814e-02   +2.518804653440263e-01   +2.095589978341674e-01];
L1E_L1I_iGABA_netcon = [+6.394874247465934e-02   +3.627751216743929e-01   +3.780295623876981e-01   +2.548506802127625e-01   +2.556779969655726e-01   +2.336616417301084e-01   +3.175729241798907e-01   +6.810556850360741e-02   +3.341817163324922e-01   -3.935639431918270e-02   +3.076266891886449e-01   +1.574540551260223e-01   +7.412722997493175e-02   +3.652313336902402e-01   +1.277230579331960e-01   +2.984180808841894e-01; +2.792033955639862e-01   +1.828084571837961e-01   +2.243665498364904e-01   +7.937826780698061e-02   -2.091641303699352e-02   +2.129141006622418e-01   +2.033381100164377e-01   +2.360042038410868e-01   -3.709172897585022e-03   +2.691349582041725e-02   +3.626741896265669e-01   +1.083860527345376e-01   +2.048304459382979e-01   +2.005536701747626e-01   +5.596418899225520e-02   +2.210295007237463e-01; -1.158483802065284e-02   +2.249777544984862e-01   +1.549559461499101e-01   +1.233040040285153e-01   +7.693442881024033e-02   +9.815621544571158e-02   +1.915959998554130e-01   +2.050058575296860e-01   +8.921309390241300e-02   +1.063739201185825e-01   +2.566532015071101e-01   +2.060782254064714e-01   +1.793469603406981e-01   -1.734807337162544e-02   +1.719164081842721e-01   +2.272220058410861e-01; +1.369242438379303e-01   +2.158972571146054e-01   +2.646784317936061e-01   +1.767640238328325e-01   +1.938470775160562e-01   +3.519866956824316e-01   +2.884653417571011e-01   +1.579011563933981e-03   +2.288330274159253e-01   +2.854538421052679e-01   +1.961730290482499e-01   +3.180290559733229e-01   +1.072450477283426e-01   +2.408586750095679e-01   +5.201118916910073e-02   +5.094206791618318e-02; +1.636229941683091e-01   +3.281877637118663e-01   +3.540758566059795e-01   +3.373401687550099e-01   +1.200708366091798e-01   +1.134086661643974e-01   +2.091867716001760e-01   +2.179915659332124e-01   +2.927953110799609e-01   +2.196918392655232e-01   +2.892649397617574e-01   +2.356143409022923e-01   +8.826313699836277e-02   +2.763577244171237e-02   +1.360112984882794e-01   +3.487691625196871e-01; +2.538440190138944e-01   +2.348795200783141e-01   +2.078383495421082e-01   +3.016021945970370e-01   +2.271156338708475e-01   +7.088943719578657e-02   +3.716209777534005e-02   +8.471732028545974e-02   +3.058868056346730e-01   +1.904173186659131e-01   +2.477526322525956e-01   -3.102084482475561e-02   +1.477505848880346e-01   +2.434866393428885e-02   +7.793574933781279e-02   +1.790792314298093e-01; +7.401616896115826e-02   +2.558460086558020e-01   +3.139975511880027e-01   +7.355659259803221e-02   +1.979162020887321e-01   +5.419043105643557e-02   +2.676300998222564e-01   +2.508091935362367e-01   -7.870592967854059e-02   +2.561943966138316e-01   -7.368166914184331e-03   +2.477662032688631e-01   +2.093395051340051e-01   +2.394371970865782e-01   +1.257495439567790e-01   +4.269029852341678e-02; +4.411995274481068e-02   +1.892215120196464e-01   +1.299450871412527e-01   +9.913841785816888e-02   +1.808328757613873e-01   +4.061548755306986e-02   +8.851341342532629e-02   +6.764550486057030e-02   +2.993449641196841e-01   +1.944672227550472e-01   +8.620395852782049e-02   +1.312353281690800e-01   +1.083055664501567e-01   +1.093159683234085e-01   -3.391355435916167e-02   +3.203096190179198e-01; +1.951839104590347e-01   +2.998410859093824e-01   +3.247953175217710e-01   +1.754599102792662e-01   +9.181589475596802e-02   -1.160973399848785e-02   +6.646571832946505e-02   +6.618488968104982e-02   +2.425006626835204e-01   -1.928096948811960e-02   +7.471790216872892e-02   +2.866057807741246e-01   +1.893381460451495e-01   +1.950918554424045e-01   +3.161859579407159e-01   +2.729459939578437e-01; +8.850715886763713e-02   +2.800361822801680e-01   +6.931081117063133e-02   +4.345377724176402e-02   +4.726788673088417e-02   +1.918018417585784e-01   +1.104269683100129e-01   +6.073054313012657e-02   +3.077450123009623e-01   +5.816035247590516e-02   +1.611368424507625e-01   +8.926840767678673e-02   +2.729846738203667e-01   +2.758613728755691e-01   +2.598428219548420e-01   +1.518510288044882e-01; +1.823611130629597e-01   +1.957618987215769e-01   +1.607208426745036e-01   +1.076039501947716e-01   +2.693811832792202e-01   +3.121907120165380e-01   +2.229425280361981e-01   +3.174802426703133e-01   +1.757995625725055e-01   +1.351346095993604e-01   +3.947891284309882e-02   +2.910686032901879e-01   +1.043965310165800e-01   +5.775660964882329e-02   +1.387809380566649e-01   +1.544334017334527e-01; +3.062442358133067e-01   +6.887863352517126e-02   +7.499695189464284e-02   +2.040258429089594e-01   +2.769419515050680e-01   -9.413749973740729e-03   +1.833791435564522e-01   +1.701264896468032e-01   -4.211789854116511e-03   +1.769313317383690e-01   +1.724621818571682e-01   +6.706961251900129e-02   +5.424113940578774e-02   +2.272368366260961e-01   +2.732922123260128e-01   +2.680067497705841e-01; +1.084281914374902e-01   +1.465727294652893e-01   +2.125884467394509e-01   +2.750350123688990e-01   +1.386619560396022e-01   +1.446039741862063e-01   +2.484019296330025e-01   +2.059053606604141e-01   +2.274138528234035e-01   +3.329904349843853e-01   +3.088511461675562e-02   +1.102604644520388e-01   +1.135545373727151e-01   +1.579276798711084e-01   +1.575127754927667e-01   +2.099870414021069e-01; +9.851271853907832e-02   +9.948401498124683e-02   +1.326133337153676e-01   +1.255731198883865e-01   +2.554405630736613e-01   +2.301880271845632e-02   +2.089202264592766e-01   +1.129346350773527e-01   +1.488795434959727e-01   +1.568112797959719e-01   +1.825359684993045e-01   +1.128457878448788e-01   +2.941600828201862e-01   +3.558740051394082e-01   +8.657024157061219e-02   +3.883042038865962e-03; +8.898984476147352e-02   +5.893370307875578e-02   +8.790323838625823e-02   +2.464897543265347e-01   +2.018802417519981e-01   +1.345874873142512e-01   +1.435562902612949e-01   +1.788376036789201e-01   +2.492792947607680e-01   +2.186011455937905e-01   +1.678411008883782e-01   +1.607482653587716e-01   +5.759002785415513e-02   +1.479156445758454e-01   +2.836106282247604e-01   +2.421010476956745e-01; +1.527480094578177e-01   +1.510297948926922e-01   +1.574663278620702e-01   +8.811631326134253e-02   +1.666533757456476e-01   +3.329231708467661e-01   +2.008323514243059e-02   +2.549088586294397e-01   +1.192287524478214e-01   +2.984817595826378e-01   +1.484184898138357e-01   +2.130114514513888e-01   +1.901489694763767e-01   +3.773067016625850e-01   +5.177420911670889e-02   +2.522589234013849e-01];
L2I_L1I_iGABA_netcon = [+2.476043335245283e-01   +2.880360816288999e-01   +2.132307621144086e-01   +1.597184125670694e-01   +9.008793039811605e-02   +2.823415092491120e-01   +1.402689491619622e-01   +2.908539264962350e-01; +3.393898672927423e-02   +1.791235891206308e-01   +6.089604155149717e-02   +2.019916483293122e-01   +2.188969026952729e-01   +2.623758442946298e-01   +2.520114951082641e-01   +2.435843479097297e-02; +7.648981647058534e-02   +1.605375303794123e-01   +2.461756172466458e-01   +1.661243748860009e-01   +2.684633908111712e-01   +1.519624901036598e-03   +2.763601526921683e-01   +3.470614181822669e-01; +7.130434431533891e-02   +2.959350850469611e-01   +1.131218607148939e-01   +1.810222297185964e-01   +1.166881160063064e-01   +2.985193448569019e-01   +1.498680660401410e-01   +3.657907878882491e-01; +2.914311186285104e-01   +1.992569081927504e-01   +1.604622194645868e-01   +1.373129953131852e-01   +3.438648873739905e-01   +3.302720735981521e-01   +1.242147550531014e-01   +2.306745090303907e-01; +2.282891104574522e-01   +2.441887124753095e-01   +3.689694480906396e-01   +2.241848034794310e-01   +2.508120635981094e-01   +1.760885215656031e-01   +1.978088172944421e-01   +2.571484841883028e-01; +3.159946769073833e-01   +2.419481063756081e-02   -4.454178664134144e-02   +2.789853321471881e-01   +4.236708129060675e-02   +1.016639888733088e-01   +1.627897041895473e-01   +1.429339065065107e-01; +2.228374083473318e-01   +1.180594959339064e-01   +1.256195733927970e-01   +3.375931038586714e-01   +1.344138495547793e-01   +2.319720110057621e-01   +1.020529253126182e-01   +7.770592157448737e-02; +2.235910544421926e-01   +1.756820239966468e-01   +6.138553927635344e-02   +1.593894367293192e-01   +1.936308483295629e-01   +2.946008294502110e-01   +3.552504876958795e-01   +4.503769477188337e-02; +2.032574842064954e-01   +3.113572333766721e-01   +1.936331496228440e-01   +3.027168630192310e-01   +3.013811531073483e-01   +6.149047619598961e-02   +6.812889323350248e-02   +1.436590607280860e-02; +2.780280740599844e-01   +2.935018326900550e-02   +2.478330847003598e-01   +1.957209062063975e-01   +1.750513054354497e-01   +2.763207837828088e-02   +2.701311634386439e-01   -6.713093506752794e-02; +1.507509669288197e-01   +3.274030793920445e-01   +1.548591397549239e-01   +2.342325152575944e-01   +3.046547655020105e-01   +1.114195587040318e-01   +1.234094178875711e-01   +7.332111902657770e-02; +1.842602268478907e-01   +8.349671797180058e-02   +7.688250275917996e-02   +3.052091582264036e-01   +1.149559676342377e-01   +3.027646550217054e-01   +1.988433956648881e-01   +1.674362682200178e-01; +5.632221832075728e-04   +2.768041809821465e-01   +5.975437493065061e-02   +2.630972787776169e-02   +1.408753821532816e-01   +1.470914188220681e-01   +3.673341806395550e-01   +1.427662406291307e-01; +4.397043854227931e-02   -4.427526531754364e-02   +2.165799088825666e-01   +2.015177280250068e-01   +1.659253721758825e-01   +2.323464057017362e-01   +2.989880458090910e-01   +1.313413787482148e-01; +1.065962435029268e-01   +2.725163939289299e-01   +5.480229313356569e-02   +2.850398481889399e-01   +4.957843856886904e-02   +1.809782707510257e-01   +1.311797449656890e-01   +1.117194330321455e-01];
L1I_L2I_iGABA_netcon = [+1.137664030591323e-02   +1.542565653912596e-01   +6.192463405953732e-02   +4.863365418196641e-02   +3.348141161130900e-01   +1.581145066858373e-01   +8.476532530056806e-02   +1.723714634423762e-01   +1.511597089493743e-01   +7.580660217811611e-02   +1.135263923029964e-01   +2.291335800318312e-01   +6.241659435754301e-02   +3.747751855253296e-01   +4.937604076664572e-02   +1.251493030249808e-01; +2.578064715839560e-01   +3.521132526309323e-02   +1.265694287602478e-01   +2.531237015668807e-01   +9.329421844001132e-02   +2.119764724245560e-01   +2.579941607148235e-01   +2.070152729749895e-01   +2.676166007484404e-01   +3.360623445851835e-01   +2.931229462881319e-02   +3.905991078125214e-02   +2.175991421563771e-01   +1.324871933184835e-01   +2.771916857832265e-02   +1.854764692595426e-01; +1.795303547630130e-01   +2.582637127244209e-01   +2.159241628747094e-01   +4.829308592188709e-02   +2.138690216679408e-01   +5.220636680283008e-02   +1.112414654269661e-01   +1.060229762681590e-01   +1.689562992960532e-01   +3.417342034633840e-01   +3.075997626366838e-01   +1.125502664741995e-01   +1.885188308807302e-01   +1.204083965643968e-01   +1.053586720018450e-01   +1.108218380181359e-01; +2.005571889587974e-01   +1.478617501040664e-01   +2.419753928837105e-01   -3.810381076965175e-03   +1.764688634815085e-01   +5.153934942096224e-02   +1.307501608726074e-01   +1.461182434247684e-01   +1.721440728924009e-01   +3.002905914008155e-01   +3.227110837774687e-01   +1.923864476998338e-01   +2.918597248938228e-01   +3.127937876724406e-02   +2.558187383794705e-02   +2.769161484323890e-01; +1.878775284301674e-01   +2.628957065728265e-01   +2.400908845037155e-01   +1.327034451957630e-01   +1.924466572949345e-01   +3.515478274419370e-01   +1.064051147224056e-01   +1.815346382265373e-01   +1.975745985701902e-01   +2.059831717315499e-01   +2.020672991921693e-01   +2.812290510803792e-01   +2.722377816809901e-01   +3.755286017663733e-02   +2.472926836485184e-01   +4.036946650201531e-01; +1.501857787899987e-01   +1.796844992713662e-01   +1.644627465471563e-01   +2.476355914433785e-01   +3.567784307890878e-01   +1.604312428564197e-02   -2.298257758434605e-02   +2.082646439625865e-01   +2.520540451220482e-01   +2.805348832607052e-01   +2.254438105020917e-01   +1.508629516051713e-01   +1.996095079230576e-01   +2.042863864346662e-01   +2.540871431922102e-01   +3.321094681486431e-01; +3.132191816949927e-01   +1.153420178250055e-01   +3.006686562305769e-01   +3.001163252950047e-01   -2.391948330819198e-02   +2.653561720343195e-01   +2.113542911263123e-01   +3.572583562678582e-02   +8.056993374943781e-02   +3.243666158837416e-01   +2.964110866335009e-01   +3.057607833648819e-01   +1.570880916770611e-01   +1.158286504578930e-02   +1.943125122449497e-01   +1.434979145433095e-01; +1.206899074877838e-01   +6.921529987228678e-02   +1.765305865291504e-01   +1.468593632276343e-01   +9.635269394710066e-02   +3.204573087184268e-01   +1.909951911403394e-01   +5.975168061799691e-02   +2.942683398862638e-01   +1.665098591036352e-01   +2.844272687163801e-01   +2.851818286101571e-01   +2.231188812627219e-01   +1.522843446325214e-01   +1.972488092150782e-01   +2.556778878547997e-02];
L2E_L1E_iAMPA_netcon = [+1.680629313511216e-01   +2.522193519377390e-01   +3.555781069363993e-01   +1.051170789536636e-01   -6.034347965799235e-04   +1.741056367978027e-01   +7.086101501553006e-02   +1.435889495955927e-01; +1.179348252719805e-01   +4.779854803231347e-02   +2.445847213337979e-01   +1.877595542509728e-01   +1.076972244731670e-01   +2.258896399554780e-02   +2.373911425704812e-01   +2.104065588071009e-02; +1.741934301647819e-01   +7.460625415989612e-02   +1.567170832036857e-01   +3.013567912174693e-01   +2.560082920790104e-01   +3.732570266313647e-01   +3.226477805790856e-01   -1.413730017876183e-02; +2.415228701731746e-01   +1.432738836254052e-01   +8.595019145638429e-03   +6.575335378783367e-02   +2.283442578128093e-02   +3.290939494892295e-01   +2.017430233289924e-01   +2.051554535201304e-03; +1.779550725704819e-01   +2.743220900369318e-01   +2.897586091488161e-01   +1.754270463536538e-01   +1.332786684959843e-01   +1.968848100742144e-01   +2.420507112196275e-02   +1.106280104203212e-02; +3.095161400913771e-01   +4.084056407437899e-01   -5.754531042056913e-02   +3.317417697652611e-01   +6.459487924968936e-03   +2.613636186994464e-01   +1.451364454133608e-01   +2.575889278623733e-01; +2.768638800712188e-02   +2.913386399534227e-01   +1.328972943707708e-01   +1.800056303035788e-02   +5.228164723987849e-02   +3.387085324885445e-01   +1.813134771025641e-01   +3.037883707192899e-01; +2.105478245755348e-01   +3.114958118256671e-01   +2.193181420734470e-01   +2.637868857446327e-01   +3.007555857538154e-01   +2.275740261550069e-01   +2.938171839112318e-01   +1.928190498974256e-01; +8.332006517012153e-02   +9.236938069652589e-02   +1.282589583453574e-01   +1.457529437234243e-01   +3.601230151398830e-01   +2.917865930478569e-01   +4.489989187005324e-02   +2.306599891202646e-01; +1.266375090935093e-01   +2.964230686909834e-01   +2.762476476284622e-01   +3.189977823534969e-01   +3.903084763052196e-01   +1.248532462408053e-01   +2.522015042411956e-01   +6.781204003175581e-02; +2.300794086610204e-01   +2.432995000904338e-01   +6.273161097069918e-02   +3.534498541794296e-02   +1.849435055334884e-01   +3.183685470603880e-01   +2.372974352476245e-01   +1.298814472785121e-02; +3.595905985510198e-01   +1.560118869140106e-01   +9.500983344963625e-02   +2.136278318453432e-01   +2.564777356726129e-01   +4.388915326856652e-01   +1.701131733747046e-01   +2.905845779943380e-01; +1.428523767300015e-01   +3.082569036780326e-01   +3.492818891713964e-01   +1.168571828127780e-01   +3.002743322633020e-01   -3.052640348180856e-02   +2.346738307281728e-01   +3.068585795032397e-01; +2.148356065182859e-01   +1.114635753725062e-01   +2.022319711435785e-01   +9.689930791414021e-02   +2.039679231219388e-02   +2.330562127240313e-01   +2.822943804588092e-01   +1.365828289943191e-01; +2.323057528937230e-01   +2.377556195851084e-01   +3.062575118826347e-02   +5.813659158729499e-02   +1.841633266032025e-01   +2.609530650853176e-01   +1.537096944966536e-01   +7.045418790886100e-02; +2.007116082131465e-01   +1.886438703578179e-01   +1.835301611247632e-01   +4.599728507267276e-02   +2.106709242437741e-01   +1.035445143122656e-01   +2.732203590610457e-01   +4.943316668814901e-02];
L1E_L2E_iAMPA_netcon = [+1.169547793985250e-01   +1.286295150352577e-01   +3.246063838815177e-01   +1.781115193578669e-01   +2.513492120515721e-01   +3.860141324697169e-02   +2.154428317369847e-01   +3.020208910870455e-01   +1.612147497073326e-01   +1.434604414116558e-01   +2.722428903732123e-01   -1.019403840695048e-02   +1.435805093022812e-01   +1.902025536446036e-01   +2.431995200092831e-01   +3.117754231993300e-01; +3.087297837717775e-01   +2.967720065065539e-01   +2.401841589117893e-01   +9.599902005792323e-02   +1.298551479748805e-01   +2.378488219353960e-01   +2.910851561880677e-01   +6.661069104160108e-02   +9.258666381747263e-02   +4.922878216133054e-02   +5.197239773609948e-02   +1.050290064669134e-01   +1.818465405681572e-02   +1.805899789087488e-02   +3.843476655484909e-02   +9.211137478158060e-02; +1.170306038268201e-01   +3.064680203061252e-01   +3.789226762259304e-01   +3.174672072176163e-01   +8.408640742996601e-02   +2.659719755632293e-01   +7.038143478598768e-04   +2.908384581807496e-01   +1.938478971812283e-01   +1.472436787581344e-01   +7.226468804116451e-02   +2.732286608241641e-01   +3.304777661178107e-03   +2.337022691176647e-02   +1.793485234797564e-01   +2.331332359783010e-01; +1.516076358315264e-01   +1.229884422808930e-01   +1.754628616608492e-01   +3.329681323778561e-01   +1.198147794773326e-03   -1.962782271284738e-02   +8.194962303248016e-02   +2.474435797000778e-01   +2.945658731122938e-01   +3.065218541820405e-01   +1.990981327681969e-01   +1.157101589470419e-03   +1.387926371885056e-01   +9.834064351454798e-02   +8.269569674761049e-02   +1.642389636985348e-01; +2.674432812822910e-01   +1.151433213906330e-01   +3.901509048265839e-02   +3.158161966625750e-02   +3.255816676241538e-01   +3.279981614306694e-01   +3.044467033918625e-01   +1.561954691224470e-01   +1.015420923899927e-01   +1.176109915412670e-01   +2.905601954220048e-01   +3.332448725084056e-02   +1.975820198194663e-01   +2.468592238717600e-01   +1.260150303993234e-01   +7.481814117284576e-02; +4.054359045608241e-02   +1.842896486819801e-01   +1.658021145451417e-02   -3.722304540051391e-03   +2.127593048533880e-01   +1.380914576411207e-01   +1.789556980644143e-01   +2.749664417782212e-01   +3.121678382279922e-01   +2.613808427897717e-01   +2.809375722648612e-02   +2.327202090924841e-01   +2.649928491083357e-01   +1.745816684053395e-01   +2.173284054737870e-02   +1.261970266493859e-01; +8.818503854434383e-02   +1.320154995588443e-01   +7.156985416317210e-02   +1.532908436466121e-01   +1.153239128933535e-01   +7.975538871722526e-02   -6.212885881534501e-03   -2.673373379048747e-02   +1.127383687704764e-01   +1.743781899853785e-01   +1.059177702977408e-01   +8.424295091522928e-02   +3.574581053961787e-01   +2.776353304097908e-01   +2.915698497498232e-01   +1.686925805517475e-01; +3.244394171323479e-02   +7.007842393023106e-02   +3.148195408421921e-01   +2.978405828093880e-01   +2.997961267143680e-01   +1.520591125419471e-01   +3.476658945726225e-01   +9.948814662111903e-02   +1.234293930754489e-01   +2.922926435877723e-01   +3.339241263439113e-01   +8.943435375383932e-02   +1.505432686469422e-01   +1.297617963016049e-01   +2.836538462277420e-01   +1.963957049194508e-01];
L2I_L2E_iAMPA_netcon = [+1.372177441347065e-01   +4.593428740312596e-02   +5.293862063280302e-02   +1.467005075787672e-01   +3.267047447375301e-01   +1.773977399489045e-01   +6.008559843350866e-02   +2.220426816241001e-01; +6.291107673415729e-02   +9.532688137064672e-02   +2.873735615543058e-01   +1.087125657961464e-03   +2.304966629512757e-01   +1.351311358212204e-01   +6.893292520053509e-02   +2.013528158446978e-01; -2.668484098046491e-02   +3.063651408035246e-01   +1.202089933533750e-01   +1.758210580243357e-01   +2.939054474178521e-01   +3.022081299371441e-01   +2.185459406382600e-01   +1.092157820892152e-01; +3.003026985433989e-01   +3.258336834698042e-01   +3.555207293881535e-01   +2.567176013264489e-01   +2.634228652865813e-01   +1.904638905579700e-01   +3.063948747680467e-02   +1.868882988036753e-01; +2.629257888389818e-01   +2.996312686837591e-01   +8.275921969507695e-02   -4.694562160352536e-02   +1.226453784006925e-01   +3.012877038453790e-01   +1.075864981833486e-01   +3.506787641676217e-01; +1.793682979555060e-01   +1.752973506741634e-01   +3.043942434261002e-01   +1.822421241253700e-01   +4.452806273111350e-02   +6.298988137702805e-02   +5.172378416382595e-02   +2.189538025249096e-01; +1.066422926635763e-01   +1.954133029419203e-01   +2.793005765410394e-01   -3.015193012067369e-02   -5.004437021398677e-02   +5.608844454066171e-02   +1.223161558143050e-01   +3.562898914723244e-01; +4.011685222580642e-02   +1.544898861653083e-01   +1.658270629345858e-01   +4.190279479308866e-01   +3.278006888686197e-01   +2.759545996188231e-01   +3.064480863526134e-01   +1.083383848050125e-01];
L2E_L2I_iGABA_netcon = [+2.898904479561626e-01   +1.820570657816632e-01   +2.238392538817186e-01   +1.301646379345502e-01   +1.705390004575443e-02   +3.345617944626581e-01   +3.594859035618494e-01   +2.805655470242929e-01; +3.927756215254091e-01   +9.313418270537775e-02   +1.030886044749788e-01   +3.355259259258897e-01   +2.547335778136182e-01   +1.830011084236213e-02   -8.388535610578462e-03   +2.702473174556113e-01; +1.238127013376743e-01   +2.010282439269671e-01   +2.610794736808851e-01   +1.385033228594243e-01   +1.072815588400352e-01   +3.318343285170404e-01   -3.201009170820408e-02   +1.723885804569750e-01; +3.479699789983740e-01   +8.324184460694054e-03   +1.007940406054394e-01   +5.692536991799856e-02   +2.909095022068602e-01   +3.013963225777307e-01   +2.217169636371057e-01   +1.260711050625585e-01; +2.093992646524453e-01   +2.217232151552852e-01   +3.782110759406015e-01   +9.661309647026878e-02   +3.800022730909740e-02   +1.511879820812343e-02   +2.720341590055546e-01   +1.363885660549535e-01; +2.492859755123320e-01   +6.710228404794655e-02   +1.040618159349992e-01   +1.596332085800187e-01   +9.715545688588438e-02   +3.075855948196933e-01   +1.825260682782777e-01   -3.065958967715701e-02; +2.654969090499152e-01   +2.118004633249848e-01   +2.166289945608714e-01   -1.328932227974272e-02   +9.723422836761372e-02   +5.118875375360377e-04   +2.497409837015199e-01   +8.050922020687269e-02; +5.967679662446685e-02   +1.442333932922884e-01   +2.174354770541869e-01   +1.860699592500656e-01   +2.739428647256451e-01   +2.047707174523954e-01   +1.062800417461171e-01   +9.615617656623549e-02];
L3E_L2E_iAMPA_netcon = [+1.845910949391388e-01   +2.350603263687173e-01   +1.371959009236836e-01   -8.213658064740996e-03   +1.780647725600986e-01   +3.220664216706648e-02   +3.335709431712432e-01   +2.450263732014342e-01   +2.900944195688262e-01   +1.897161444908777e-01   +1.001414659366124e-01   +2.415135913454255e-01; +1.333931915989506e-01   +2.655997823413440e-01   +2.729338976624942e-01   +2.145610296570768e-02   +2.593115421864493e-01   +2.700785585795101e-01   +2.493933314824659e-01   +9.269970921044565e-02   +2.504335597384287e-01   +8.221310459177615e-02   +2.396362006516991e-01   +2.854084753864803e-01; +2.497852517985324e-01   +1.827571557664593e-01   +3.177561071443905e-01   +3.394114119252406e-01   -2.687940991616838e-02   +9.582575199852321e-02   +1.858556086443269e-01   -2.389193062206509e-02   +1.808323736028043e-01   +2.984377677408031e-01   +1.676267068493471e-01   +2.337212001997159e-03; +2.744699161173449e-01   +1.544760579996627e-01   +4.735452417493459e-02   +3.797193649586222e-02   +3.017635381133452e-01   +1.246575181084511e-01   +2.941732630459462e-02   +1.628845311192545e-01   +6.476915714998847e-02   +1.293978412239277e-01   +1.791898713769584e-01   -5.803634103686964e-03; +2.589571789491426e-01   +3.702444760634279e-01   +3.324029927109542e-01   +3.662381531266858e-01   +2.891313411719870e-01   +3.381098018450564e-01   +2.555953009209725e-01   +5.667532292609397e-02   +2.761096804756393e-02   +7.427988882576986e-02   +2.252615836843349e-01   +2.082105762037348e-01; +8.470073816222998e-02   +1.355072180854787e-01   +5.670213633610600e-02   +1.555659130644875e-01   +2.154305129533274e-01   +2.286579310941386e-01   +3.356205268937049e-01   +3.057548638223056e-01   +3.392186480429729e-01   +1.452679074019315e-01   +3.364927822158389e-01   -4.019400266594073e-04; +3.019514254578081e-01   +7.504539602127014e-02   +8.040545991519436e-02   +3.419476807224491e-02   +7.099677006849302e-02   +1.452789647409867e-01   +1.817584663053237e-01   +1.279047419739601e-01   +8.767462929603670e-02   +1.137129106962091e-01   +3.213593630518737e-01   +3.219170664734634e-01; +3.026507458381253e-01   +3.071755873639360e-01   +1.714045070175762e-01   +2.965944303768681e-01   +2.568843287404541e-01   +1.141608714136166e-01   +3.036020912008393e-02   +9.336022127086047e-02   +8.249110956444911e-02   +5.160382624419429e-02   +1.710492775430850e-01   +6.668898852947469e-02];
L3I_L2I_iGABA_netcon = [+1.683372151980512e-01   +3.439404822874984e-01   +4.989056079866862e-02   +2.530853262490462e-01   +1.544266751515442e-01   +2.826482228625213e-01   +2.309118423608673e-01   +2.072501530229977e-02   +2.779594901972416e-02   +1.406906465493410e-02   +2.559842555792217e-01   +9.381450192955534e-02; +2.083782663757162e-01   +2.779959503414537e-01   +1.901526702037906e-01   +2.267212732142547e-01   +2.966405243885353e-01   +1.398123242919087e-01   +3.253441926655429e-01   +5.126707303120531e-02   +8.232731271162327e-02   +1.285224820102432e-01   +1.792046889502224e-01   +2.876189604480782e-02; +1.660419314807305e-01   +2.457250361718304e-01   +2.342191305576701e-01   +1.832616590561454e-01   +2.262862953654863e-01   +1.639531914015469e-01   +1.596173435230842e-01   +2.395985043073899e-01   +2.194921827538870e-01   +6.929847173478457e-03   +2.584762504543761e-01   +2.564844165623638e-01; +2.912846507165863e-01   +3.308499321364025e-01   +3.218867459001543e-01   +9.669465501351371e-02   +1.865848498760057e-01   +3.461672471396814e-01   +4.533592320905547e-02   +3.129681200280031e-03   +2.918494027522454e-01   +3.180423480400423e-01   +6.394311739029618e-02   +2.506113752864471e-01; +1.212931967178527e-01   +2.818915388520126e-01   +3.140957400715783e-01   +3.202260302711882e-01   +3.195295981809139e-01   +1.138657020158813e-01   +1.138710758107695e-01   +2.317994745756030e-01   +1.230821972846273e-01   +4.223460997717379e-02   +8.192640857458554e-02   +9.112305712258587e-02; +1.690729062833233e-01   +9.351623820185327e-02   +2.589773072453957e-01   +1.600663680049298e-01   +2.120496495715806e-01   +2.616918627430718e-01   +1.753135378154443e-01   +1.781670445683792e-01   +6.669652650310726e-02   +9.463786006723277e-02   +2.060383211413684e-01   +1.972866332410810e-01; +1.684496350717035e-01   +8.490461990702540e-02   +3.091010213571690e-01   +2.870992532145440e-01   +1.387916579914295e-01   +2.853360639367257e-01   +7.297702212633074e-02   +4.650006518743737e-02   -4.991321271128146e-03   +2.898915357058059e-01   +3.409118783081676e-01   +1.281695671187323e-01; +1.675226361527636e-01   +7.114192127483976e-02   +2.897345834994695e-01   +4.622947327138639e-02   +2.552157261343881e-01   +2.987592214100286e-01   +2.506296638977552e-01   +2.317003663137437e-01   +1.597164707047380e-01   +2.567593295319335e-01   +4.375610494125081e-02   +3.163460699859051e-01];
L2E_L3E_iAMPA_netcon = [+2.525561454885587e-01   +1.053365919297931e-01   +2.896130228590137e-01   +2.081028827381253e-01   +1.852506312423421e-01   +1.528408477430198e-01   +1.804471221837524e-01   +6.615382277521779e-02; +2.037379854348518e-01   +1.749597525206179e-01   +2.257173984462433e-01   +1.920924328797091e-01   +2.982860530847651e-01   +1.374385469435797e-01   +1.553686651196109e-01   +2.696924250301280e-01; +4.742580247113878e-02   +4.934346254183631e-02   +2.310663933189420e-01   +2.683977666334190e-01   +2.301211032195783e-01   +2.821890227206676e-01   +2.235043254183380e-01   -1.596320627650969e-02; +9.848065802442796e-02   +6.376940289876862e-02   +1.832320049505369e-01   +3.034577664687641e-01   +1.295008662630164e-01   +3.103215576657139e-01   +1.975495960782446e-01   +9.502506989097076e-02; +6.499403257208740e-02   +2.405155767887258e-01   +3.693650139094960e-01   +2.655997311251437e-02   +2.614850686007780e-01   +2.440686526634235e-01   +2.099751473714519e-01   +1.176180095214949e-02; +5.609470472795648e-02   +3.103983028332959e-01   +2.527689675107135e-01   +3.372121413191994e-02   +3.415732426732037e-01   +1.460794824830642e-01   +1.214052504752148e-01   +2.737608842342104e-01; +1.215393084952686e-01   +6.363188864398506e-02   +2.088230257338040e-01   +6.554049193894554e-02   +1.095385295773161e-01   +2.019602119005869e-01   +2.920920023333796e-01   +2.150109268252794e-01; +2.039096537499938e-01   +8.164995114501059e-03   -1.491135293960040e-02   +9.888231104424099e-03   +3.064707390316719e-01   +1.554012625735172e-01   +6.064534797134975e-02   +2.787583313785693e-01; +3.545212617211674e-01   +2.865567024360444e-01   +1.236184778030260e-01   +2.683533634722688e-01   -1.287592685876599e-02   +1.133800282086606e-01   +2.601744206442843e-01   +9.950491573863260e-02; +1.336284229154877e-02   +1.122845010032201e-01   +3.183044310679218e-01   +7.186757361117502e-02   +1.023397779032749e-01   +9.076680548901930e-02   +3.748401245150887e-01   +3.069137662091764e-01; +2.465206173528396e-01   +2.003360195766977e-01   +1.381515577791128e-01   +1.981989774657949e-01   +1.233603400873422e-01   -1.787639142310906e-02   +5.276291247431220e-02   +2.466185634072122e-01; +2.589175845541296e-01   +4.393206758186631e-02   +3.464171363684844e-01   +2.540898881014054e-01   +2.507324529687391e-01   +4.921281362149874e-02   +1.639556475553828e-01   +1.019689506805558e-02];
L2I_L3I_iGABA_netcon = [+9.522613761883870e-02   +1.268555227671420e-01   +9.107105340411188e-02   +2.246680871117992e-01   +1.766920364685036e-01   +2.049653485923116e-01   +1.510468710976856e-01   +1.894743668191469e-01; +1.623237881729939e-01   +3.063344058205376e-01   +6.278233866082283e-02   +3.293006993537523e-01   +7.247108693871098e-03   +2.463615396348817e-01   +1.116856400383616e-01   +1.237736055056974e-01; +6.664122548830081e-02   +2.241875702408354e-01   +2.555870537573540e-01   +2.439236866761146e-01   +2.020718880841043e-01   +1.848933834089228e-01   +2.285582885345046e-01   +3.630064087740195e-01; +2.750029098439866e-01   +2.561531065282862e-02   +3.033049517422486e-01   +1.189117116327127e-01   +1.931300747060096e-01   +2.144112446450784e-01   +3.325370591743924e-01   +3.800005735316378e-02; +1.790583235040204e-01   +3.661970693292959e-01   +2.684338367343355e-01   +2.215417307249778e-01   +1.903384499700485e-01   +3.053596684371861e-01   +3.494230675625887e-01   +1.103004443594392e-02; +2.846153742646680e-01   +1.961457817430456e-01   +5.067386912937394e-02   +3.761561601250669e-01   +8.992988321262436e-02   +7.929339905666426e-02   +1.446838273037057e-01   +2.888067326182304e-01; +2.184588754928087e-02   +3.056595783586342e-01   +1.230820702325068e-01   +3.249122535006288e-01   +1.216206310607088e-01   -6.631571524676053e-02   +2.020666781492060e-01   +2.434730455246176e-01; +4.668913797206167e-02   +8.180635761603969e-02   +1.916110734612296e-01   +9.911953084390281e-02   +2.497500948435865e-01   +2.049230783548624e-01   +4.466808938661660e-02   +1.032844588789661e-01; +1.751044136032059e-01   -2.030886758236350e-02   +2.773524942583923e-01   +3.701445718667642e-01   +1.812891734841059e-01   +6.354508185728724e-02   +9.486663571551707e-02   +2.817833316056841e-01; +9.580476516210459e-02   +5.726487630600591e-02   +7.287789024885040e-02   +1.945357800991045e-01   +3.078958243619082e-01   +1.347429720867745e-01   +2.882558372626195e-01   +1.710070595771774e-01; +5.556978451041054e-03   +2.170024873579840e-01   +4.304503722539197e-02   +1.821818053406086e-01   +1.013649382350613e-02   +2.462722133414217e-01   +3.427289365817827e-02   +9.458708390856738e-02; +2.815313536142894e-02   +1.264771273754176e-01   +3.086796506261183e-02   +1.039975247912212e-01   +1.792553174874534e-01   +3.233629462203235e-01   +1.191959330576087e-01   +1.173401620449702e-01];
L3I_L3E_iAMPA_netcon = [+1.581771727727677e-01   +1.973045150781672e-01   +2.137967656726686e-01   +2.574078857392764e-01   +2.835363429114843e-02   +2.739525070521873e-01   +1.033016317889938e-01   +4.645990761022298e-02   -3.414466548321969e-02   +3.801443485794543e-03   +2.338613653709052e-01   +1.972699582429900e-01; +2.663672974019582e-01   +1.350714811042509e-01   +1.361233147991312e-01   +3.236407507811705e-01   +2.411595972186624e-01   +2.210255396352088e-01   +3.094864458452425e-01   +3.736068087443660e-01   +1.741246769265001e-01   +1.167073691384501e-01   +2.000666513393431e-01   +3.437536073239355e-01; +8.629162988774793e-02   +2.905412648919852e-01   +1.476530335365749e-01   +1.140930582897667e-01   +2.740175307408744e-01   +3.040688248070785e-01   +2.299737782641941e-01   +2.667512454444771e-01   +8.050847527682520e-02   +2.860787446011434e-01   +8.914109651292672e-02   +3.226803285480268e-01; +2.949286344124339e-01   +1.731193675985871e-01   +1.943978700453370e-01   +2.915569581240099e-01   +1.194574282695073e-01   +7.996033704909936e-02   +1.849623291459394e-01   +3.114278722495514e-01   +2.114079483047494e-01   +2.875410027554523e-01   +8.488623428898885e-02   +2.304130980254669e-01; +4.547637912202555e-02   +2.900516878260218e-01   +1.240280623358398e-01   +5.604265834560963e-02   +8.312435846294289e-02   +3.492208795273507e-02   +5.889530085094061e-02   +1.273117813559192e-01   +1.897411364979810e-01   +5.537167941879212e-02   +3.173869786570785e-01   +2.568903444054906e-01; +1.500547585906976e-01   +3.061038455864523e-01   +1.529106713073784e-01   +3.206979241098666e-01   +6.891770798055377e-02   +8.289898713626057e-02   +4.719110216990439e-02   +4.773145822093338e-02   +1.247849759018163e-01   +3.603828387258884e-01   +2.409537402487529e-01   +7.674772478230962e-02; +2.195850532288830e-01   +2.251293577962988e-01   +2.496941340752838e-01   +3.077003398055337e-01   +2.085200881467729e-01   +1.709583859187971e-01   +9.128054652899686e-02   +3.256730488343420e-01   +2.766243199923865e-01   +2.925011520616953e-02   -3.508629613039826e-02   -3.235118201619715e-02; +3.823175662018656e-01   +3.114121990537622e-01   +1.809214481957492e-01   +2.009696726456234e-01   +3.862802075343940e-02   +1.030487020755301e-01   +2.263560067614180e-01   +3.113392138074301e-01   +2.373848066964972e-01   +3.073878202248383e-01   +6.210562729058368e-03   -3.789329136206395e-03; +2.607688826679057e-02   +9.180601477150827e-02   +1.426711590140604e-01   +1.056490771974428e-01   +1.623357419291251e-01   +9.279067623040067e-02   +2.972713946504630e-01   +8.579297891833954e-02   +1.989767375148872e-01   +2.544078997252529e-01   +2.280946771455328e-01   +3.356370475712087e-01; +2.309443222099988e-01   +1.342875671033921e-01   +2.279141024134986e-01   +1.523150012445848e-01   +7.059056143886339e-02   +1.956187994533743e-01   +1.494043138972163e-01   +4.058843441571150e-01   +2.680348529818016e-01   +1.450961154381707e-01   +1.091969340899198e-01   +3.232665312871750e-02; +2.442097351453189e-01   +2.643740396026693e-01   +1.312731095599981e-02   +5.132790376560326e-02   +5.160353878065090e-02   +2.744204493109644e-01   +1.433873015671422e-01   +2.667243242654227e-01   +3.579313310450803e-02   +8.551680695228063e-02   +2.316646724686005e-01   +2.134537435820301e-01; +1.815638962380653e-01   +7.359178757236644e-02   +1.565615743864792e-01   +3.789670748540419e-01   -1.170995999765678e-02   +4.784355254643709e-02   +2.082708770295590e-01   +2.289150292657646e-01   +5.950501895570047e-02   +7.358345562974904e-02   +1.375397348773072e-01   +3.055817918349757e-01];
L3E_L3I_iGABA_netcon = [+1.750922411671284e-02   +2.626154078779682e-01   +1.326703543228800e-01   +2.908022004415506e-01   +2.650767509036559e-01   +2.534871434981605e-01   +5.996088434087496e-02   +9.579127391161267e-02   +1.877174015083150e-01   +3.159039398549465e-01   +3.492496506059720e-01   +1.564928003489778e-01; +1.688595399579192e-02   +8.430846423357075e-02   +3.389892804448963e-01   +1.849495183207811e-01   +1.168588031620378e-01   +2.546597016928441e-01   +2.888807395570751e-01   +1.897293173228741e-01   -3.247990873604924e-02   +3.321695313407123e-01   +1.908535849617125e-01   +2.568478316773543e-01; +2.281857601678943e-01   +2.216338836760198e-01   +2.676849952490369e-01   +2.644364989970616e-01   +1.098437858862376e-01   +3.166976620278842e-01   +1.343968512697339e-01   +1.221161605163926e-01   +1.829729485940778e-01   +2.467374550728169e-01   +1.129465003336142e-02   -1.273628964004362e-02; +2.484619339558602e-01   +2.329733931545314e-01   +3.405783141718854e-02   +1.197071197828726e-02   +1.247647327135583e-01   +3.373382578564409e-01   +1.274030164451186e-01   +2.354277359496514e-01   -1.924002992500169e-02   +1.316871329443427e-02   +2.686121492651884e-01   +5.032950429158769e-02; +2.717775723831209e-01   +2.878029702759395e-01   +3.604479152145687e-01   +1.556514917850256e-01   +3.021371247824601e-01   +2.073689149958247e-02   +2.669886289379517e-01   +1.276219564711132e-01   -1.344481110978217e-02   +3.177015898341899e-01   +1.561177278618914e-01   +1.376600562074340e-01; +7.804694027342572e-02   -5.294066201727045e-02   +4.215191609198018e-02   -1.932787637883927e-02   -1.920849535928752e-02   +3.457263823793395e-01   +1.085879345666510e-01   +2.023145937312432e-01   +3.024798571260937e-01   +3.089904710242923e-01   +3.137181793379550e-01   +1.891526210137844e-03; +3.319311253906458e-01   +3.037904502531190e-01   +1.934777565145492e-01   +2.744558675671130e-02   +2.702388700371475e-01   +2.506543453243402e-01   +2.837159688046784e-01   +2.620419157993018e-01   +2.224135403629310e-01   +3.075295815157779e-01   +2.381188078882826e-01   +8.836109392342076e-02; +1.331828509192531e-01   +1.254096842729097e-01   +2.188394744438525e-01   +3.070947346774350e-01   +1.976466575705235e-01   +5.055720690072933e-02   +1.520812456797858e-01   +1.801885698895749e-01   +1.516628143738332e-01   +1.577272509065089e-01   +1.977156528016927e-01   +2.580012113520860e-01; +3.122614429678910e-01   +1.541691972489506e-01   +3.189298686288635e-01   +1.932049368761013e-01   +3.291832877525655e-01   +1.760834471015636e-01   +2.318036814648999e-01   +1.911180521314827e-01   +1.474559365821083e-01   +3.216197854956107e-01   +2.750286762744223e-01   +2.686571083787781e-01; +2.368589966058948e-01   +1.582697129818582e-01   +2.181832928054012e-01   +6.319998219514884e-02   +1.249819373356331e-03   +2.436239769252721e-01   +1.198289762728226e-01   +1.027274285292336e-01   +1.950303467396524e-01   +1.835610678945192e-01   +1.211282020554011e-01   +5.939152496808067e-02; +1.568608954766022e-01   +2.769203417465218e-01   +1.862354284421409e-01   +2.904443855854699e-01   +1.200759404400007e-01   +2.008207533198570e-03   +4.005816922818593e-02   +6.488872055912315e-02   +2.309369815103549e-02   -2.434158111828478e-02   +3.583904737528592e-01   +2.336765354642776e-01; +1.122389851149546e-01   +1.466186776801912e-01   +8.308001272080613e-02   +1.671253014928167e-01   +2.335933379500580e-01   +9.413284860182172e-02   +2.133317827265864e-01   +2.031880440466301e-01   +1.106734383765071e-01   +4.697358694738674e-02   +1.407161925083025e-02   +6.684398197029487e-02];
L2E_Input1_iAMPA_netcon = [+1.598360866159240e-01   +8.735135293622308e-02   +2.100380009817903e-01   +1.254692774315712e-01   +1.951829548540517e-01   +2.354986494923161e-01   +4.049398250771476e-02   +1.657071832180802e-01];
L2I_Input2_iAMPA_netcon = [+1.419703038191535e-01   +6.770773484211601e-02   +3.609042876368301e-01   +2.916049804551560e-01   +1.480691192778987e-01   +1.827729251711240e-01   +2.073648770714654e-01   +3.279749111333013e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.5*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.5*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
