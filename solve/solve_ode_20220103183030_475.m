function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.131561660835933e-01   +9.500187300683773e-01   +7.023572378198424e-01   +1.652304985871537e-01   +9.213031220119718e-01   +2.126847498153758e-01   +7.404430632242798e-01   +3.032880487782811e-01   +5.366894664106066e-01   +8.361724755200181e-01   +9.723334385835356e-01   +9.712536036727304e-01   +6.970929286678357e-01   +3.687828915392308e-01   +2.961310943486275e-01   +3.843327563934145e-01; +3.511603234524884e-01   +8.593028937617592e-03   +1.399968047871216e-01   +1.678562253389671e-01   +7.811998443010837e-02   +8.110622142959174e-01   +7.989420425020867e-01   +7.526166710547854e-01   +7.934074338839702e-01   +1.909084304368004e-01   +4.764836735477339e-01   +6.626008263910123e-01   +3.661542613766361e-01   +2.749823398726132e-01   +6.875490869800425e-01   +9.589939977981804e-01; +2.012370962276991e-01   +4.783702718600913e-01   +8.246128197875593e-02   +7.100119439612141e-01   +3.178884348987841e-01   +3.838525872735517e-01   +6.595036861169082e-01   +9.543945543320362e-01   +4.908836966989279e-02   +9.257474042313807e-01   +8.716738115309898e-01   +1.994676515956859e-01   +5.451302450597836e-01   +7.225256366087507e-02   +7.783355386527334e-01   +8.108890795937691e-01; +2.471134666977292e-02   +4.909621060258046e-01   +4.279970126212250e-01   +8.385116047462285e-01   +6.340091652806586e-01   +8.621790192372968e-01   +4.413103562467724e-01   +5.883507923042989e-03   +4.615025253413412e-01   +4.198984645008154e-01   +9.433058753781992e-01   +8.992793893217944e-01   +5.146153793886440e-01   +1.559368747169037e-01   +7.149925989504686e-01   +8.961194355553586e-01; +7.679419881755157e-01   +5.151018448895833e-01   +9.011566860892951e-01   +8.079228111363283e-02   +9.064976739135197e-01   +3.219030634405522e-01   +5.777147430805611e-01   +4.046713454666466e-01   +9.412498379835065e-01   +3.001949657358979e-01   +2.411045860883713e-01   +4.811863441941667e-01   +7.675877316612947e-01   +3.632505372629566e-01   +2.732888936852499e-01   +6.705096034113318e-02; +5.711295295413815e-01   +2.858043087056757e-01   +7.212217248192064e-01   +8.375495733924755e-01   +7.982774245358292e-01   +3.815505227803171e-01   +5.163078140927564e-01   +1.567271568208125e-01   +4.737985723230773e-01   +3.559480816880269e-01   +9.175449621500398e-01   +6.668367553741577e-01   +7.473424440341830e-02   +7.124856190240363e-01   +1.773455087402735e-02   +9.028394241641406e-01; +5.808992683898500e-01   +5.626374749810354e-01   +6.851417746938783e-01   +5.504685434867859e-01   +6.480218644929268e-01   +6.450115774006852e-01   +7.279799764854933e-01   +8.285111514250703e-01   +7.780982146632315e-01   +9.759455804867941e-01   +6.330634936092987e-01   +5.297937031389709e-01   +5.363158438136859e-03   +5.418586617243385e-01   +1.923011775043065e-02   +6.745017972576768e-01; +3.845672709234302e-01   +5.164158063728239e-01   +2.071119409031529e-01   +9.665515260486658e-01   +4.403046954715338e-01   +3.917007438421075e-01   +2.202425540738342e-01   +2.881991531876699e-01   +1.079661118210360e-01   +5.357484339073857e-01   +2.887099395291091e-01   +7.043246238154038e-01   +4.050957355074246e-01   +2.327936989549651e-01   +9.304214291806384e-01   +3.468757266472795e-01; +5.537908385244412e-01   +6.732799142056796e-01   +5.275810232429713e-01   +6.717433092757583e-01   +7.497213943533536e-01   +7.239756130774173e-02   +9.995326894742490e-01   +9.802255060525707e-01   +5.180185513085229e-01   +7.941465039344157e-01   +8.497782249403398e-01   +7.167243465265514e-01   +6.632168629622740e-01   +4.711059504520400e-01   +9.350317109069407e-01   +8.446145486235200e-01; +1.865116843222770e-01   +6.176528569070463e-01   +8.242847508350455e-01   +3.371628639613151e-01   +8.317239024419685e-01   +1.616880050929502e-02   +6.231214087983428e-01   +6.217741212483302e-01   +6.397789336020898e-01   +7.990412654539857e-01   +1.624752080822605e-01   +2.954869612226100e-01   +3.714588663520310e-01   +7.180729324406976e-01   +3.759188120174012e-01   +1.982192919585731e-01; +1.174426654190881e-01   +5.661074362482328e-01   +1.832342082854291e-01   +2.164782847424764e-01   +3.490820653053310e-01   +8.730075409852710e-01   +9.896809288014129e-01   +7.494987497566352e-01   +5.778310955631178e-01   +1.398697308416877e-01   +8.265967583984845e-01   +1.127242607375845e-01   +3.968866236268014e-01   +5.204887434817922e-01   +1.049427889367598e-01   +8.440383653243654e-01; +5.296619835594953e-02   +5.098078273531417e-01   +5.157440488935219e-01   +5.703336914223222e-01   +1.509190643583745e-01   +1.605505344254328e-01   +4.928678948274782e-01   +8.851067714245040e-01   +8.403152955949349e-01   +4.551113933935523e-01   +2.188665579758299e-01   +3.297628218523652e-01   +1.347786665244192e-01   +5.146479730713507e-01   +7.242809094999847e-01   +4.275040064581481e-01; +9.371121950486078e-01   +6.677330140526038e-01   +3.567966667389914e-01   +6.479829178036453e-03   +5.047179161052182e-01   +9.218551524549022e-01   +5.265407091250959e-01   +3.347874777814357e-01   +1.170067301553719e-01   +4.547092649236171e-01   +2.722993630996187e-01   +4.625696739861468e-01   +3.394271885430914e-01   +3.916386810046567e-01   +4.552854504597980e-01   +5.565766947700780e-01; +7.436286912098348e-01   +6.411871272604964e-01   +6.544552336218822e-01   +5.938211732625693e-01   +4.129815127398117e-01   +5.665504026255748e-01   +8.555493568591070e-01   +9.296748341603289e-02   +5.181148230746235e-02   +9.576396179181593e-01   +9.169883926871289e-02   +7.147067862399441e-01   +1.225011890281555e-01   +4.842519106502737e-01   +1.523004565663296e-02   +4.440081454991244e-01; +2.390566880068327e-01   +1.425083795934586e-01   +2.804164007806890e-01   +8.970388912764224e-01   +1.754481605421171e-01   +9.221575173164677e-01   +2.563864564030190e-01   +4.478034260140719e-01   +5.211770440221619e-01   +4.988857218770285e-02   +9.149227411558879e-01   +3.994863201143032e-01   +3.709055680615985e-01   +7.419473307211203e-01   +1.153208840369925e-01   +7.610281975487493e-01; +2.032558630647106e-01   +1.821753956987641e-01   +4.346122275252320e-01   +2.603322083849500e-01   +4.940881149504298e-01   +5.942411045763416e-01   +5.778986689201115e-01   +2.373460713788335e-01   +7.027052898503635e-01   +3.936350461985542e-02   +7.308220824336654e-01   +2.387274110741052e-01   +2.479807233111550e-01   +7.060190399721198e-01   +6.629786237572084e-01   +9.529270339804596e-02];
L1E_L1I_iGABA_netcon = [+8.393832779788793e-01   +7.468612714621371e-01   +8.736672130018908e-01   +4.362927524141808e-01   +9.221360808402653e-01   +7.702906736105583e-01   +3.233004801169522e-01   +6.439339539188995e-01   +9.438438916309164e-02   +2.787720085548395e-02   +1.277572039358962e-01   +5.184894945625577e-01   +8.767865881393456e-01   +5.730323733367371e-01   +1.706642198388719e-01   +6.331565323650902e-01; +6.171391770792882e-01   +9.942467195309526e-01   +3.132467132564783e-01   +1.453808453766693e-01   +8.882602390138929e-01   +2.740673927314596e-01   +9.641136225393384e-01   +4.357933753952032e-01   +2.966368990294964e-01   +5.128632160962491e-01   +4.327764595518462e-01   +2.053161445595461e-01   +8.047045787837390e-01   +2.935662276547729e-01   +5.444226309291234e-02   +3.399050993770475e-01; +6.642152084468553e-01   +3.724072200163488e-01   +4.324226836131936e-01   +6.512661604027801e-01   +5.914722023856339e-01   +5.231931014958825e-01   +3.508340956124119e-01   +4.828035559081096e-01   +3.290251081109101e-01   +8.665454014808511e-01   +4.806251717900791e-01   +7.692635769418833e-01   +6.455019158510639e-01   +1.400785296682329e-01   +2.184626898125025e-01   +1.539158867869965e-01; +7.788040338509412e-01   +5.089533068746963e-01   +3.782723796560309e-01   +7.250273785722076e-01   +8.342741720177034e-01   +4.110673159689593e-01   +3.167358365957583e-01   +9.702704693147157e-02   +4.748967511152472e-01   +5.795696369200957e-01   +6.738012353139684e-01   +3.885782837191653e-01   +7.365877027283828e-01   +4.288051427274402e-02   +2.063517278596778e-01   +4.005047880335235e-01; +3.153533838489549e-01   +7.536826635498631e-01   +6.530672620403197e-01   +1.703121700002814e-01   +7.818717229385451e-01   +7.844654156397831e-01   +9.113345458711426e-01   +8.029414735597681e-01   +2.385217170012289e-01   +4.263126728624024e-01   +3.536992550950648e-01   +7.024439861922149e-02   +6.632461620526692e-01   +6.242466312578799e-01   +2.156686963709161e-01   +9.142286172754828e-01; +3.261296172007144e-01   +1.341931226566155e-01   +2.477826961017814e-01   +3.397758069023840e-01   +7.875932224639024e-01   +2.781404343292140e-02   +8.835979875142318e-01   +6.130727588511342e-02   +4.565879960571811e-01   +7.185341965056562e-01   +4.277049647036647e-02   +7.504860915766765e-01   +8.850641956848713e-01   +6.071319038198565e-01   +5.794573913807389e-01   +1.555787759973136e-01; +6.304907977530239e-01   +5.193200070845596e-01   +6.882920050097809e-01   +1.022002651887577e-01   +6.984928141253488e-01   +4.115202981071007e-01   +3.605539285231353e-01   +9.574959501470064e-01   +7.555977444651535e-01   +2.305597850499840e-01   +2.919062503761101e-01   +4.560861207967800e-01   +8.521676459065837e-01   +3.707754314128514e-01   +3.742739211194328e-02   +4.695994966909742e-01; +9.012560570495879e-01   +9.091452225392583e-01   +3.289661785268611e-01   +4.627001438856255e-02   +2.062922256189482e-02   +8.280067172062208e-01   +7.395839858922963e-01   +7.716569327102272e-01   +7.168547139922146e-01   +5.799426852044655e-02   +8.005650008203524e-01   +3.160266889010269e-01   +4.055096699294963e-01   +8.330734107466842e-01   +7.984835332763786e-01   +8.137052549013939e-02; +3.700099001019234e-01   +1.017161368065985e-01   +8.720478652202766e-01   +4.747674896271494e-01   +3.238472776959900e-01   +5.921393273598713e-01   +1.259491592242292e-01   +4.480385177336176e-01   +2.341065273559685e-01   +9.742922240574325e-01   +6.505142230719468e-01   +2.755520908304164e-01   +1.096537058584721e-01   +5.185439480121580e-01   +1.371429645646045e-01   +3.360640899277332e-01; +8.841217684454458e-01   +1.809696937109605e-01   +9.988489251141639e-01   +4.779095210564749e-01   +9.458681047152016e-01   +2.104444301940077e-01   +5.903847090502014e-01   +1.674740106024125e-01   +7.032705994062429e-01   +9.690868757369611e-01   +7.108807080601340e-01   +5.742720423524273e-01   +4.067873423824324e-01   +8.117122104375032e-01   +5.792757383991192e-01   +4.904349012040817e-01; +1.171994163175690e-01   +1.804665693121686e-01   +6.894885607021990e-01   +5.511668873782576e-01   +4.061022603458823e-01   +2.915541423406555e-01   +4.394223691935738e-01   +8.070667556213922e-02   +3.037515420879504e-01   +1.296397254556592e-01   +7.575699723548743e-01   +9.118507534592710e-01   +3.358434262451706e-01   +5.774197845504099e-01   +8.309292291305817e-02   +5.018593433658043e-01; +9.278980980801720e-02   +5.365618643294455e-01   +3.465243823390954e-01   +6.464314750986170e-01   +6.262791960976640e-01   +2.678804780980981e-01   +9.640801542426377e-01   +7.424601122750719e-01   +4.689505333233994e-01   +2.641496410279919e-03   +3.889821525551642e-01   +4.491678883916896e-01   +1.089676856397403e-01   +7.122898756398673e-01   +2.266225976643637e-01   +1.313518486691399e-01; +5.443848028495786e-01   +9.750515232534244e-01   +5.599664875944973e-01   +3.487117778723690e-01   +8.501365119265885e-01   +9.341269679121009e-01   +9.725919145058722e-01   +5.342397132709651e-01   +4.395249181430717e-01   +9.327543079794045e-01   +3.651818556765394e-01   +9.813917356033708e-01   +8.591465506439763e-01   +7.319349628061715e-01   +4.454407598203768e-01   +7.632886651825911e-02; +6.020805201123308e-01   +8.412681837793982e-01   +8.935977638578169e-01   +2.522011392710699e-01   +3.667231725323251e-01   +5.542390760602068e-01   +2.481930216705391e-01   +4.859568520750109e-01   +7.293369057352630e-01   +7.404506067121355e-01   +8.121822778309471e-01   +1.034411656034448e-01   +8.976840752112186e-01   +4.458010968406691e-01   +1.769405093627886e-01   +6.761648778472913e-01; +7.232505356037631e-01   +6.688401664471694e-01   +6.477023442960604e-01   +1.799517209039122e-01   +2.040857796400063e-01   +4.295505001099153e-01   +7.737971923070909e-01   +8.852117833011273e-01   +8.761057702402210e-01   +4.292254481848953e-01   +3.877025953570647e-01   +4.178491708654894e-01   +6.910274665979336e-01   +2.792991203493902e-01   +4.140132545146147e-01   +1.187993598831980e-01; +9.932404083479542e-01   +1.287773753514504e-02   +3.802610716694962e-01   +4.761671383983072e-01   +9.086616626240134e-01   +3.262093574060444e-01   +7.095992680866209e-01   +5.886938065604949e-01   +9.118916886049667e-01   +9.433871775867749e-01   +8.687360550001012e-01   +3.873623699061567e-01   +7.468864346716001e-01   +1.549874264976197e-01   +9.640455127967461e-01   +9.872556418849328e-01];
L2I_L1I_iGABA_netcon = [+5.709493593610386e-01   +5.648393324420186e-01   +1.077851517361180e-01   +4.534507595473731e-01   +7.997984548346658e-01   +9.763404828238791e-01   +2.231230659245001e-01   +7.592881124627082e-01; +5.646503049067918e-01   +9.518628448775387e-01   +1.296824438692224e-01   +5.672989449485336e-01   +5.448871445991544e-01   +4.231626218833731e-01   +6.472367041817909e-02   +4.983259213348324e-01; +6.049797167581216e-01   +1.223638960616421e-02   +4.363892787758348e-01   +8.194839911351406e-01   +2.582079189782427e-01   +3.903037449444273e-01   +8.274390228306682e-01   +8.274429993011958e-01; +4.655540522512541e-01   +1.236150198660104e-01   +9.282898260851866e-01   +3.601265389188100e-01   +7.788541431016321e-01   +4.592980454868171e-01   +4.193172801742274e-02   +9.196664889481798e-01; +4.371618685072473e-01   +8.560930710322852e-01   +1.382463695112251e-01   +2.428427600537793e-01   +7.788195843236848e-01   +1.290288240596839e-01   +9.108268023345560e-01   +7.102026754516886e-01; +6.826805581836320e-02   +2.195754310033700e-01   +8.201118819398834e-01   +7.643944658042073e-01   +1.449889880585615e-01   +4.628209826490555e-01   +4.528771814985237e-01   +8.036859027016179e-01; +6.405470950463714e-01   +7.035445068649578e-01   +9.320417856926795e-01   +1.596549949842591e-03   +8.273820933926902e-01   +2.663869121805265e-01   +2.810036384165880e-01   +9.580776628003879e-01; +4.232712225479127e-01   +7.786109097370164e-01   +5.734801520069217e-01   +2.795482434201209e-01   +6.236156307415341e-01   +1.046488559405508e-01   +7.551364122624783e-01   +9.509307281512258e-01; +7.531062383472638e-01   +4.251044073380512e-01   +4.981759863572357e-01   +3.283023856188914e-02   +4.633754997178071e-01   +6.583931092908312e-01   +9.261883466143547e-01   +2.965948111978784e-01; +3.051209468880027e-01   +7.310640136028580e-01   +9.289873704527093e-01   +6.672374635087769e-01   +4.866259661071317e-01   +9.419695905519818e-01   +1.400437821519700e-01   +3.543186075861509e-01; +5.994479311771252e-01   +4.525757375603500e-01   +8.649061289424027e-01   +9.730349046533789e-01   +2.214723091709710e-01   +7.657687357843911e-01   +9.436035621348090e-01   +5.456587933808443e-01; +3.294405451484583e-01   +8.033241582048023e-01   +2.540528233239318e-01   +9.457757391356226e-01   +8.524187997225893e-01   +4.120947239243153e-02   +3.150932000443688e-01   +2.126376106068052e-01; +6.455786435299541e-01   +4.293358422808020e-01   +4.566332971662635e-01   +4.764183843809769e-02   +8.772944412847042e-01   +2.609635934402987e-01   +2.085248789656535e-01   +7.986514153758227e-02; +4.013109041146233e-03   +1.513120079247749e-01   +7.390679567097891e-01   +2.884581714706479e-01   +8.383982257599372e-01   +6.410992218451721e-01   +4.614755169952475e-01   +5.107764639494397e-01; +1.490518809100393e-01   +8.026999151632244e-01   +7.526216359093024e-01   +4.809884648777418e-01   +4.418141523325906e-01   +8.790766038164810e-02   +5.956259628287371e-01   +1.968730456286596e-01; +2.473475454952582e-01   +3.738627885516632e-01   +2.376215011983199e-01   +8.860822430948169e-01   +5.436336351593285e-01   +7.298445203961670e-02   +5.473798426724336e-01   +1.441855767870270e-01];
L1I_L2I_iGABA_netcon = [+7.110492474996191e-01   +8.695206429718981e-01   +6.158369081343826e-01   +4.844845106478432e-02   +1.461355467815483e-01   +2.343297770204331e-01   +8.401986239823633e-01   +3.673751201642615e-01   +7.107076486372426e-01   +3.901258223444931e-01   +2.435802886865225e-01   +6.731568175797539e-01   +1.612394406510876e-01   +5.713824077328546e-01   +4.494269786207443e-02   +4.549466820617844e-02; +6.061345116058073e-01   +8.015023239285153e-01   +6.182245260302653e-01   +5.216456505577304e-02   +7.452849948218030e-01   +5.525346672140461e-01   +1.991688149442370e-01   +5.598245899340112e-01   +1.890403993925673e-01   +7.257494755673211e-01   +5.074960971789934e-01   +3.374958339062183e-01   +1.069868061578041e-01   +8.136253318459683e-01   +4.359260899437948e-01   +9.213074371475244e-01; +1.613891521949713e-01   +6.207603003831328e-01   +3.074995375796201e-01   +5.985614439134791e-01   +9.509874174574029e-01   +1.122024288428336e-01   +6.150949373679494e-01   +8.355263250995034e-01   +2.318028602036521e-01   +6.333765291413618e-01   +7.341690281877371e-01   +5.483925593990965e-01   +7.443392238439968e-01   +6.757980390647237e-01   +9.251831289225461e-01   +1.754068193898850e-01; +4.790405438574659e-01   +4.776932184420290e-01   +1.322443654724700e-01   +6.599440161852149e-01   +2.630947403359505e-01   +8.227388301545911e-01   +1.583647742312557e-01   +7.158235166186850e-01   +1.000000000000000e+00   +9.783255541824819e-02   +7.807262236769612e-01   +5.347491857696163e-01   +2.176645326311918e-01   +4.408073184576621e-01   +8.848295442550405e-01   +7.456962883681230e-01; +2.902653088724915e-01   +2.102635056064500e-02   +6.006264811325751e-01   +4.861125082180465e-01   +9.195006056921115e-02   +6.583276674702466e-01   +5.869113714123487e-01   +1.163897771750193e-01   +9.024675448884274e-01   +4.961040976669585e-01   +6.840023339552761e-01   +9.071385779073493e-01   +4.851077138373949e-01   +8.884575547557966e-01   +9.603669792541439e-02   +4.704092618660241e-01; +4.037895306300296e-01   +1.208436823356286e-01   +8.925111830687545e-01   +9.799948919257324e-01   +2.312887515955670e-01   +2.335788991472736e-01   +5.428509059286284e-01   +7.417840959543351e-01   +1.256097835724008e-02   +5.547900006363262e-01   +8.144083642418026e-01   +2.858497152145960e-01   +4.866160354109464e-02   +7.881364169414714e-01   +6.846920323128536e-01   +2.513360329327155e-01; +4.883760210617755e-01   +7.226178091030884e-01   +5.655746126834595e-01   +8.666165290943595e-01   +8.895185470080841e-01   +3.046631491104096e-01   +6.881239681417948e-01   +9.223986349296354e-01   +8.346790222672813e-01   +5.343519311973107e-02   +4.233818286440377e-01   +1.370025692866702e-01   +5.787897577537188e-01   +5.872313920964782e-01   +1.275802186226523e-02   +6.655941499884162e-01; +8.648128234363088e-01   +6.694173387394539e-01   +6.346341753025478e-01   +9.586658461577064e-01   +2.001543933503029e-01   +3.239344362244863e-01   +6.985816876641953e-01   +9.206213293888176e-01   +2.515192167545480e-01   +8.063485677797982e-02   +4.943822291767183e-01   +9.539749704196958e-01   +4.954993657289867e-01   +6.203574384027839e-01   +1.267359982385581e-01   +6.086669971453224e-01];
L2E_L1E_iAMPA_netcon = [+3.733224671320375e-01   +5.623946341353174e-01   +2.037914985293434e-01   +5.181955010592413e-01   +2.945358834446437e-01   +6.895060353592725e-02   +2.807469134714118e-01   +2.650209452175457e-01; +4.338113302611317e-01   +1.871407503300462e-01   +1.395897212389011e-01   +6.826883559624524e-01   +6.176592884767735e-01   +5.907060485113633e-01   +9.308684533181132e-01   +8.984791314250771e-01; +7.173813898057466e-01   +6.062550132343734e-01   +8.072794388959906e-02   +2.094077852757215e-01   +8.706575058261211e-01   +7.841169453618169e-02   +7.605884928376393e-01   +1.560087909383896e-01; +1.958165314658745e-01   +7.323978770475789e-01   +9.306863529291541e-02   +9.725389472811998e-01   +8.153068185880151e-01   +3.969302627147973e-01   +2.602976409258180e-01   +5.519945600425631e-01; +4.588055039868814e-02   +8.365354613947001e-01   +5.515891920471497e-01   +3.488934240712596e-01   +2.095158779536208e-01   +5.424453453653798e-02   +2.447971091866004e-01   +4.238585365801711e-01; +3.123231101645569e-01   +2.746747860087008e-01   +7.300508559822029e-01   +1.826239324562619e-01   +7.482708392335539e-01   +1.256821407453919e-01   +1.625496814664376e-01   +5.469987742478566e-01; +7.937656669052318e-01   +6.075646533775514e-01   +5.475858864207011e-01   +2.449104631336341e-01   +1.994651838216255e-01   +2.423291864607347e-01   +2.904243528792654e-01   +7.458506504975173e-01; +4.021426509574636e-02   +5.485016779501881e-01   +4.862474653382529e-02   +2.568545267281261e-01   +5.814159638102120e-01   +9.407213203927919e-01   +5.650936492102940e-01   +1.378153462101834e-02; +2.153056093742441e-01   +2.773028357325376e-01   +6.355140870617526e-01   +2.198646420852199e-01   +8.776238260617273e-01   +2.086158733389411e-01   +3.987121288636555e-01   +4.463978639992155e-04; +2.696163545291255e-01   +3.378240517295225e-01   +9.913021543408110e-01   +3.769980853961999e-02   +7.161558113778971e-01   +3.292362948578930e-01   +9.855388733740393e-01   +1.885848868454659e-02; +7.929595238589641e-01   +5.701054153342965e-01   +9.127227542662468e-01   +3.525413851146038e-01   +6.982199133849651e-01   +8.656568472177382e-01   +5.467612274516763e-01   +3.518527940094414e-01; +9.837908156054468e-01   +7.435165587157179e-01   +7.722612737417892e-01   +8.967990412560050e-01   +4.607132040693389e-01   +9.206114215010397e-01   +9.333955895305439e-01   +4.288006399939505e-01; +9.606304910547500e-02   +7.641605514642344e-01   +1.953396288462085e-01   +1.357732543943159e-01   +5.053273261545638e-01   +1.910120229387406e-02   +9.863698410602242e-01   +5.440926297666769e-01; +2.008782747074551e-01   +4.033541501152872e-01   +2.871209193075398e-02   +9.520601612178060e-01   +7.997899743858630e-01   +3.601151676897059e-01   +8.328294983650959e-01   +4.822639108152549e-01; +1.184916011143301e-01   +1.550698781435905e-01   +3.775781805055171e-01   +9.083403418750594e-01   +9.340340992306142e-01   +5.315582321583108e-01   +1.812936562904543e-01   +9.163067310742065e-01; +6.400755152021576e-01   +2.061015443170677e-01   +5.778381921823459e-01   +4.109879404130466e-01   +7.924385737034894e-01   +4.068035672662753e-01   +3.113384499861064e-01   +4.157116674505676e-01];
L1E_L2E_iAMPA_netcon = [+4.959623730507063e-01   +4.553740947150347e-01   +6.149547194376197e-01   +4.923051478958413e-01   +2.334898825750771e-01   +7.158396569014901e-01   +6.874516536488338e-01   +6.360222853609540e-01   +5.214758235621983e-01   +2.409374879627940e-01   +8.722221347268011e-01   +1.763553562768654e-01   +1.371799631541318e-01   +2.466090533680698e-01   +1.822842144397042e-01   +3.068908046955127e-02; +8.346056885648043e-01   +3.634567485580116e-01   +1.039712882063748e-01   +6.638957574324215e-01   +8.377849250667277e-01   +3.813559934861770e-01   +9.741801219177748e-01   +6.240795941770017e-01   +6.717256973326473e-01   +7.289512078092349e-01   +6.633473754992364e-01   +2.982255396552590e-01   +2.865788888575100e-01   +7.463460743176901e-01   +1.509102354997840e-01   +2.500993521336556e-01; +1.841965047049056e-01   +2.958707631455734e-01   +7.568058592672021e-01   +1.802027893985944e-01   +7.339520305703793e-01   +3.785564006218599e-01   +7.560173705457421e-01   +4.106475281078764e-01   +7.731237511837998e-01   +1.283070839550369e-01   +5.441852898132550e-01   +1.061857031297787e-01   +4.751372286664661e-03   +9.321368598068269e-01   +1.354215875749278e-01   +9.902771603290274e-01; +3.391292140582718e-01   +2.396562308635557e-01   +5.408362500341274e-01   +4.766161174836984e-01   +4.877882658875900e-01   +7.173712513343545e-01   +5.541367772366810e-01   +4.317619112948617e-01   +4.647193936621009e-01   +4.136416611601138e-02   +2.473248076542403e-01   +4.521447055099111e-01   +3.082280188080895e-01   +3.177301126487150e-02   +1.653105295400330e-01   +6.311090869979987e-01; +6.929491903817597e-01   +1.352489992774970e-01   +4.466966856501333e-01   +5.008332727890358e-01   +8.516689736862841e-01   +8.303144545919596e-01   +2.818592319204941e-02   +5.119787200168647e-01   +9.050768704548998e-01   +6.524724211484049e-01   +1.107698973571755e-01   +5.858236943228746e-01   +9.081622501899700e-01   +4.310073549420199e-01   +9.218198762978705e-01   +3.604653662771897e-01; +6.925331272292137e-01   +1.005936783071971e-01   +7.426318891084223e-01   +6.033508092673182e-01   +7.206133721348841e-01   +6.696940265609910e-01   +1.899356050803896e-01   +2.598669935007591e-01   +2.222331482169639e-02   +1.989088132611536e-01   +9.710813964137568e-01   +2.207730083287497e-01   +2.952045097562684e-01   +8.273111774289447e-01   +2.620445637233206e-01   +9.903922467116516e-02; +3.680164572550692e-01   +2.332040208732706e-01   +3.900863386918523e-01   +2.452081117520809e-01   +5.215701487770830e-01   +6.476436369110595e-01   +9.368452538503017e-01   +4.218611404303573e-01   +4.832798029015028e-01   +9.720813941439923e-01   +5.881727349849960e-01   +1.063441229123705e-01   +8.264253090032500e-01   +9.967728913411877e-01   +2.061105395489269e-01   +4.151422091180010e-01; +3.305654353257436e-02   +3.502574841484024e-01   +5.331565740149090e-01   +5.200324182452124e-01   +9.404205730247764e-01   +5.612091581134953e-01   +3.938019002674880e-01   +5.227739299269223e-01   +2.723876302087138e-01   +8.230478524508781e-01   +8.178308058608963e-01   +5.627785030085605e-01   +7.405769210122856e-01   +9.218261547768779e-01   +6.164492226775936e-01   +9.258439883013703e-01];
L2I_L2E_iAMPA_netcon = [+6.766487178408837e-01   +6.125383821974154e-01   +4.179062290721953e-02   +7.996449684830066e-01   +5.214789366515489e-01   +8.232192558993063e-01   +6.469123320392963e-01   +3.883955564204771e-01; +2.173677121138328e-02   +9.433195445493564e-01   +5.334517620191604e-02   +9.337692293278880e-01   +6.701581441098971e-02   +1.104625101662276e-01   +3.460297726509761e-02   +1.707248835666491e-01; +7.355351141704096e-01   +9.622252633756897e-01   +4.076447032982158e-01   +9.409771490159078e-01   +2.869642578168263e-01   +2.528324891431548e-02   +5.644395049543310e-01   +4.449923453647899e-01; +2.181110322943934e-01   +3.642563365525018e-01   +9.778679098138631e-01   +1.442215766655473e-01   +7.171547393456419e-01   +7.612272190541814e-03   +3.076650825590822e-01   +8.781402610940984e-01; +8.538892387106903e-01   +7.998830082005477e-01   +7.113723044422307e-01   +3.246334076390894e-01   +8.882921385096770e-01   +3.372287704055223e-01   +2.623927199982222e-01   +4.060844060030251e-01; +1.579563690684321e-01   +7.223075340240862e-01   +9.892810675604008e-01   +4.270327499762578e-01   +3.631733595190546e-01   +6.655007397734674e-01   +7.190172256580516e-01   +1.652241929418740e-01; +6.706192337697935e-01   +9.501756487851256e-01   +6.448914391154008e-01   +7.076156512797738e-01   +5.657915271208594e-01   +5.894348905463876e-01   +3.075537623191906e-01   +6.656762748334796e-01; +9.323606781686798e-01   +1.357279821745034e-02   +5.008227356177770e-01   +6.192131118224196e-01   +8.831827180784979e-01   +7.702143857463845e-02   +9.023951926367605e-01   +9.306640617088241e-01];
L2E_L2I_iGABA_netcon = [+6.058785352706726e-02   +5.225285942915052e-01   +3.478133453177848e-01   +2.584171173138717e-01   +4.533750868029566e-02   +9.027561472780000e-01   +3.437558116382083e-01   +4.544603478260061e-01; +3.520355912692338e-01   +6.415594131223579e-02   +5.571629923253851e-01   +9.845095365219005e-01   +3.630067879927373e-01   +5.510224564223769e-01   +9.336632162284644e-01   +6.725703800068733e-01; +9.307875819988402e-01   +1.839068580271514e-01   +6.916578995727881e-01   +3.490880873997973e-01   +3.937706771583734e-02   +7.102885661008702e-01   +9.115572890090227e-01   +7.713359677149546e-01; +2.393801568812449e-01   +3.149482067968827e-01   +4.079154691398671e-03   +3.922189500628460e-01   +4.904612306845691e-01   +7.150753699204656e-01   +7.272338719899588e-01   +9.242890566297726e-01; +1.083763717625329e-01   +2.468368255820853e-01   +4.857175169866054e-02   +7.529996914647030e-01   +7.273168972707941e-01   +1.733789237327015e-01   +4.432874169418128e-01   +6.525318813987137e-01; +7.088288506362697e-01   +3.215208640466341e-01   +3.045099399625139e-01   +1.089283292585061e-01   +1.668706319791721e-02   +3.533944212182074e-01   +1.476710808416304e-01   +5.021582022592136e-01; +4.467640460512102e-03   +8.726418729964817e-01   +8.728809175622536e-01   +5.974971925978656e-01   +5.092484718273604e-01   +3.779834344769491e-01   +8.307866129228219e-01   +3.437210917213698e-01; +1.778957936023388e-01   +3.052599933836732e-01   +6.247831902433848e-01   +1.217867677138514e-01   +2.450947971745920e-01   +7.578187588532599e-01   +2.504477377012564e-01   +9.434886555067626e-01];
L3E_L2E_iAMPA_netcon = [+7.729745264283029e-02   +1.639429337808165e-02   +3.695011494658818e-01   +4.938203392822655e-01   +2.304640775119862e-02   +9.620351533178096e-01   +3.555572549064404e-01   +2.341290683568586e-02   +2.068004957464284e-01   +7.142857658349071e-02   +2.408404507754914e-01   +9.999452981915249e-01; +9.515712455090114e-01   +9.801120055494534e-01   +1.196123286522542e-01   +6.555387271643807e-02   +8.089184646351345e-01   +3.917708281439041e-01   +2.263668207267167e-01   +1.287853111574101e-01   +3.537612279074701e-01   +7.473832474416856e-01   +5.375912087029944e-01   +3.420782706647917e-01; +6.639630083071112e-01   +7.194818625636891e-01   +5.124636931658950e-01   +8.722332576367969e-01   +7.984311561266153e-01   +6.647607175469555e-01   +7.256445870635593e-01   +6.662835226732045e-01   +8.898238664609687e-01   +9.915968856729113e-01   +3.364859584967969e-01   +8.290866796761700e-01; +1.671693211784055e-01   +8.764378865591969e-01   +6.499352932140321e-03   +9.971782175921715e-01   +4.162462001422268e-01   +5.816917824149415e-01   +7.713001604395510e-01   +5.070080741952772e-01   +8.189279451233978e-01   +7.701151360596957e-01   +6.723266099473775e-01   +1.094637019739909e-01; +1.977965955436336e-01   +8.169423313651973e-01   +8.695755091873181e-01   +1.184991703260514e-01   +6.341236427882136e-01   +5.213630794692897e-02   +3.388288641666083e-01   +7.509826276447631e-02   +3.161426608914686e-01   +8.894425183268245e-01   +8.790062708030786e-01   +7.811152127017192e-01; +9.903158994500997e-01   +3.644837557672067e-02   +9.062237050865750e-01   +1.053701351395946e-01   +5.669466029436164e-01   +7.356973684801317e-02   +5.716530159235640e-01   +5.373488437658535e-01   +5.990272477088870e-01   +4.269681046564371e-02   +9.800239030992859e-01   +1.524697258215746e-01; +9.328154681894579e-01   +9.306844288654044e-02   +1.113641555287482e-01   +1.479509136582723e-01   +9.068730481333593e-01   +2.313680556327623e-01   +6.362454293772911e-01   +6.844104475615207e-01   +7.005455609368968e-01   +7.976113458205385e-01   +1.370589894678586e-01   +7.329944046527065e-01; +9.780264129774917e-01   +9.632476226954513e-02   +4.190899111121031e-02   +1.298704533488164e-01   +7.525962961981078e-01   +4.150702083505616e-01   +3.687568257210431e-01   +5.870060823880536e-01   +1.801405557940756e-01   +7.118649875329139e-01   +8.830278591545844e-01   +1.186493960886622e-01];
L3I_L2I_iGABA_netcon = [+7.692314483818363e-01   +5.371775549372746e-01   +5.977265659395735e-01   +3.050193653728002e-01   +9.639406861369145e-01   +1.126292464833446e-01   +2.935139764765639e-01   +7.950595741023948e-01   +9.236724913301005e-01   +9.961287916858219e-01   +3.089367630026826e-01   +9.930091214508886e-01; +6.361459998321672e-01   +4.470169259660726e-01   +5.616873997226574e-01   +7.579427693017662e-01   +5.481770141052287e-01   +6.520826793292184e-02   +1.674198409761888e-01   +5.104590935844727e-02   +3.873625869598070e-01   +2.940471735652117e-01   +4.472674746869651e-01   +9.176728769478407e-01; +7.957775335898867e-01   +1.154669199977831e-01   +7.622037548556249e-02   +6.514455042439637e-01   +9.795710078784515e-01   +4.700763314275363e-02   +7.225714665510600e-01   +1.807285269006800e-01   +7.495739252469303e-01   +5.265806894378600e-01   +2.014725903094347e-01   +6.879186223901721e-01; +9.645403857380377e-01   +7.180781261411454e-01   +7.660680227488191e-01   +3.332703952180426e-01   +1.254461127415744e-01   +1.306035492901889e-01   +3.003815061678174e-01   +2.486271054187697e-01   +8.797265964295337e-01   +3.593434193099104e-01   +9.431950163244056e-01   +2.160298680054153e-01; +7.121333080100569e-01   +1.847674150254478e-01   +8.646313753531287e-01   +9.764886571123687e-01   +1.619422222353161e-01   +4.911129133304635e-01   +6.792211138882399e-01   +2.587899584254014e-01   +3.959160918090128e-01   +5.208416483653430e-01   +2.899235573130058e-01   +3.112741146794483e-01; +6.434016068358233e-01   +3.274450271981537e-01   +7.011140522455381e-01   +5.322894374447094e-01   +3.351340520344579e-01   +4.698051900205984e-01   +7.506121659327221e-01   +6.498906863821600e-01   +1.704997165382597e-01   +4.948799795336045e-01   +1.157862680031181e-01   +2.289920469644388e-01; +5.177983580631621e-01   +9.678357253756164e-01   +1.101970903471533e-01   +7.530973242425339e-01   +5.302771086617158e-01   +1.546726336952248e-01   +7.453051795522483e-01   +1.007347470283443e-01   +4.414799285663457e-01   +1.813240327338110e-01   +6.458035021577761e-02   +7.044238646496460e-01; +9.542957890754865e-01   +6.957900178346668e-01   +6.570815103842041e-01   +2.618188452686696e-01   +6.885653245125627e-01   +1.358798234140210e-01   +7.811887506718784e-01   +4.690792509932590e-01   +8.528321983027953e-01   +4.825699503664160e-01   +7.271398906251068e-01   +3.739299650973593e-01];
L2E_L3E_iAMPA_netcon = [+6.530747950656131e-01   +3.835340032185754e-01   +2.341672110080079e-01   +4.674115417573268e-01   +9.081004210089124e-01   +9.545313366288093e-01   +7.651173576993988e-01   +3.570623625225675e-01; +3.816685160103768e-01   +2.294992033331793e-02   +9.134641319270055e-01   +2.886396176056394e-01   +6.812580950063671e-01   +2.025832850875336e-02   +8.971346840611194e-01   +6.626664419110357e-01; +3.038262074866773e-01   +3.306275539577395e-01   +4.866389461041931e-01   +2.740857709934841e-01   +8.449113344371051e-01   +4.995924416339116e-01   +7.940037772460109e-01   +5.932414971192578e-01; +1.556156027433607e-01   +4.902470424676998e-01   +5.887356631856231e-01   +1.465749997992957e-01   +9.510453533062571e-02   +3.365632318142500e-01   +9.484692084161354e-01   +5.457673765548890e-02; +7.776568886410117e-01   +2.662165830435939e-01   +9.552524275235339e-01   +1.427418021187979e-01   +7.388804784581219e-01   +6.661770980324118e-01   +5.384683262656247e-01   +2.111777154545114e-01; +7.125735511228640e-01   +5.304795159881212e-01   +8.322154960896312e-02   +2.648641271829900e-01   +5.497891234666550e-01   +1.631225144176342e-01   +1.608982332306080e-01   +6.009006088168777e-01; +1.754199556317170e-01   +4.156731018609482e-01   +2.194145266104469e-01   +6.059591501523581e-01   +2.535013456445097e-01   +2.250000170828419e-01   +1.371167543549978e-01   +2.676613367912005e-01; +4.508591329304837e-01   +2.973783257334303e-03   +1.629349833567802e-01   +1.038761661370129e-01   +7.177343691009415e-01   +1.138190451740400e-01   +2.822961078376828e-02   +1.139912642355044e-01; +8.401695302031076e-01   +8.937323007694021e-01   +3.925709758446616e-01   +4.907244323578570e-01   +3.641114946343914e-01   +9.897722654128440e-01   +6.883119528674261e-01   +2.203985896024401e-01; +7.000970537788050e-01   +2.407606924711212e-01   +1.897552343390943e-01   +8.962841330261000e-01   +8.474550072543967e-01   +1.429954123669673e-01   +5.819919934707072e-01   +8.778210293025664e-01; +7.646177370888281e-01   +8.011275964358904e-01   +7.597675070167751e-01   +1.895411264927869e-01   +8.229305686068908e-01   +7.674947416815945e-01   +2.987131647466363e-01   +4.627759383013113e-01; +9.783681334426786e-01   +5.771561845249408e-01   +2.327657100467074e-01   +5.450919686032548e-02   +6.171544643892003e-01   +6.289571881959928e-01   +7.260553138648913e-02   +7.296802387265737e-01];
L2I_L3I_iGABA_netcon = [+5.908368389812887e-01   +1.426591908942289e-01   +3.468547805670296e-01   +3.730090137642981e-01   +5.936093031630880e-01   +5.132966588818028e-01   +7.768255978394144e-01   +2.686084478397351e-01; +8.427550926247650e-01   +9.915946784808052e-01   +4.399131449015137e-02   +5.356735481561483e-01   +4.766331282262721e-01   +2.418645313479121e-01   +1.800371531956189e-01   +5.962571465717738e-01; +6.074074601011948e-01   +4.824635615717964e-01   +9.465766118635638e-01   +9.759825569556139e-01   +3.776711837096545e-01   +2.687569826869260e-01   +4.510167956460024e-01   +6.843155558286805e-01; +7.448385594833382e-01   +4.177737653077856e-02   +8.615908499360412e-01   +9.960873199757926e-01   +9.821325340094597e-01   +4.108403811471039e-01   +3.056329144792904e-01   +4.132440579446561e-01; +8.530858099708448e-01   +2.679783202929045e-01   +1.374722497943869e-01   +4.120995280055312e-01   +1.426660156246939e-01   +2.661721137383445e-01   +3.836572810574219e-01   +5.121961658814060e-01; +1.448225651984706e-01   +6.702172708224661e-01   +5.837509883128006e-01   +4.474445984343758e-01   +2.698496131419192e-01   +8.546945294359242e-01   +7.984926195843951e-01   +8.158948155659164e-01; +7.416777263659855e-01   +1.438492657426551e-01   +6.208681917971561e-02   +2.431649833529638e-01   +2.257206416361520e-01   +4.804257205988252e-01   +7.795384615965483e-01   +5.386715958965843e-01; +1.730562671498192e-02   +7.761547732361411e-01   +9.536481638616692e-01   +5.971063574178457e-01   +7.942066592781877e-01   +3.374056137426192e-01   +6.467910774366306e-01   +5.911930136059317e-01; +2.304776963590892e-01   +2.653498946349143e-01   +4.968865296223346e-01   +7.503580444602631e-02   +8.216369754154882e-01   +6.337171906320682e-01   +2.417825383292905e-01   +5.388738294203683e-01; +5.372591704089075e-01   +8.808983017390304e-01   +2.645949597093412e-02   +9.085785927792571e-01   +8.004867729553259e-01   +4.174147794156357e-01   +6.042902485335465e-01   +5.396671080026507e-01; +7.147880378409236e-01   +3.622925819018982e-01   +5.271703091947792e-02   +4.771042139940493e-01   +1.144267700532576e-01   +5.432863132907062e-01   +4.170001071411927e-01   +1.527336642179090e-01; +4.322507759359334e-01   +1.198134475984237e-02   +3.051076821382391e-01   +5.041887314174073e-01   +6.401524097356199e-01   +3.359467787869003e-01   +2.979700987077710e-01   +6.993240810630678e-01];
L3I_L3E_iAMPA_netcon = [+6.066564257636681e-02   +7.743247313062863e-01   +5.559346214667233e-01   +5.686599896631560e-01   +9.154182828418465e-01   +8.338947511391019e-01   +8.491495186117184e-01   +8.637978901981526e-01   +5.268211284685151e-01   +9.935972792569417e-01   +4.788461963730138e-01   +3.512792371381972e-01; +9.225121179722225e-01   +8.336109441960026e-01   +8.469964192791308e-01   +9.333198849733213e-01   +5.902446045571743e-01   +4.010151765740756e-01   +6.302591887007444e-01   +8.540424458653092e-01   +5.682824737262251e-01   +6.990376634043359e-01   +7.384524573957791e-01   +3.977729772442491e-01; +1.840969367506982e-01   +5.937824835159593e-01   +9.686199343288568e-01   +7.779499031930167e-01   +5.785293951023220e-01   +6.976231956352442e-02   +4.399342710563111e-01   +9.491696401304131e-01   +9.811034533389738e-01   +8.377736524696124e-01   +5.934391255979505e-01   +9.907870961522548e-01; +5.378714567763219e-01   +7.610131338369074e-01   +4.684750975572623e-01   +5.980307634292124e-01   +6.526136078604178e-01   +3.788214523207573e-01   +2.292042652184729e-01   +6.996011258327687e-01   +9.608571247519569e-01   +7.338509262732346e-01   +2.538701082576854e-01   +2.926136506000902e-01; +4.013728836411452e-01   +6.614204036456184e-01   +7.712431750788109e-01   +6.539645152415566e-02   +4.287563665330277e-01   +8.593197552200335e-01   +5.376266999763987e-02   +3.575140753985948e-01   +5.575374883017996e-01   +9.956883190872382e-01   +6.081702114666798e-01   +2.319770945485612e-01; +9.611127135187419e-03   +5.857932915801555e-01   +2.397828597698055e-02   +5.352589954009730e-01   +9.392047707353461e-01   +2.812826378591128e-02   +7.022378047289299e-01   +3.789601320003810e-01   +5.228182836070205e-01   +5.035134972909650e-01   +2.324412221790469e-01   +3.297627071704901e-01; +1.067909020921254e-01   +2.453275180617735e-02   +6.760659566601304e-01   +8.608732061021488e-01   +1.008727973126941e-01   +4.206689445299533e-01   +8.503796504507036e-01   +8.487074373798331e-01   +4.708802155106026e-01   +1.926993701581026e-01   +1.945532046751186e-01   +1.676286183747947e-01; +8.543840681937587e-01   +6.840152607131008e-01   +8.405314675120509e-01   +3.390257751944770e-01   +4.079416276278048e-01   +2.518062820836065e-01   +4.018664663621469e-01   +3.881035359802209e-01   +8.972708323893468e-01   +9.517057457881909e-01   +3.681217637232702e-03   +3.819304990421402e-01; +3.334707962167109e-01   +3.243427014054242e-01   +6.906643062539186e-01   +1.808211009886155e-01   +8.922515945155376e-01   +7.094297533778848e-02   +2.901394285960439e-01   +7.701984923274402e-01   +4.797878895967706e-01   +4.531033172643638e-01   +6.521315462464318e-01   +5.294611785596346e-01; +1.430855928711512e-01   +8.439751641230242e-02   +8.992119577261520e-01   +8.794912386601654e-01   +7.374781339116424e-01   +9.142142835223964e-01   +2.602652994457949e-01   +7.782714800126230e-01   +4.899071331795811e-01   +6.020301511974859e-01   +4.001059838552725e-01   +5.922972304023794e-01; +7.999947311422789e-01   +7.478729677463241e-01   +9.339945042335618e-02   +8.414254136589284e-01   +9.581203986062387e-01   +2.655582407129997e-01   +5.091049469511012e-01   +4.295439463406108e-01   +3.137051658750251e-01   +6.450622183708298e-01   +2.690826896553846e-01   +1.673586530715371e-01; +6.537217676680868e-01   +9.650355457631162e-01   +7.711107270537691e-02   +8.276029418437558e-01   +9.744979165028160e-01   +1.072285071563765e-01   +1.159511887559587e-01   +4.881481881952878e-01   +8.525141237303203e-01   +7.594364069209164e-01   +6.920023393248364e-03   +6.480249057347662e-02];
L3E_L3I_iGABA_netcon = [+4.418903293428834e-01   +6.416832934405683e-02   +5.976482015663246e-03   +4.965335425142251e-01   +5.411243644358968e-01   +2.528560227762690e-01   +7.178549823775017e-01   +7.581753608640598e-01   +3.816618857017355e-01   +4.488092098098901e-01   +2.021575638754543e-01   +6.568973191250234e-01; +5.868787803069456e-02   +8.081675359136116e-01   +1.284667227887807e-01   +1.920961092854544e-01   +2.183341508460163e-01   +3.335596040812550e-01   +2.272934128557948e-01   +8.905223440144238e-01   +6.067994599612184e-01   +3.943491752207317e-01   +8.290425128087663e-01   +9.052945715207268e-01; +6.270075273973320e-01   +9.132795193329519e-01   +3.086636610545126e-01   +6.422851232353863e-01   +2.683381053234844e-01   +5.980967276882071e-01   +4.946214878259200e-01   +7.302613838192721e-01   +1.633671017643290e-01   +6.767473912712645e-01   +4.407430281623714e-01   +8.390967201186507e-01; +8.079630651696905e-01   +4.280879258600861e-01   +2.378997964983665e-01   +2.555607122925008e-01   +1.345025918203079e-01   +4.810117349136422e-01   +4.779324028541452e-01   +6.913438366639412e-01   +1.008270250658951e-01   +3.489312744127832e-02   +4.303558338504883e-02   +1.671216273751719e-01; +4.035204742516630e-01   +1.914570485353911e-01   +6.517698062130098e-01   +9.415402363825697e-01   +1.392596946357137e-02   +9.011724449817368e-01   +4.324275016358823e-01   +6.452132237325579e-01   +6.183078604829431e-01   +7.828600648051218e-01   +7.651444743436783e-01   +1.617915935611901e-01; +8.874470298261680e-01   +1.862429590793886e-01   +8.077042927216977e-01   +2.911144858805711e-01   +1.295146169187834e-02   +2.865431770218203e-01   +5.564717334975939e-01   +6.165218781709639e-01   +9.614871566778430e-01   +3.744480113712142e-01   +9.194882560998412e-02   +1.400490714935148e-01; +7.191014280140116e-01   +6.700321698610540e-01   +7.393116739184536e-01   +1.427081463354016e-01   +9.860313728296948e-01   +7.357960844930653e-02   +2.027923967879192e-01   +7.587754313507919e-02   +6.720449371132921e-01   +6.406924771736967e-01   +6.568125703028014e-01   +1.582652160265227e-01; +1.978956869247017e-01   +5.245282108935747e-01   +1.240453659677092e-01   +8.640779688539604e-01   +6.474744681149013e-01   +3.869968364228659e-01   +2.743631869367396e-01   +5.470173976406707e-01   +4.703429058891985e-01   +4.929062356717956e-01   +2.675801476023060e-01   +3.993415116359098e-01; +3.701956028985711e-01   +7.754481641245382e-01   +1.779275211981021e-01   +8.858636982462019e-01   +8.101109372179718e-01   +1.881398260598746e-01   +8.081470244765636e-01   +8.774571979562455e-01   +3.329443484927089e-01   +2.231986741977537e-01   +4.378485339651360e-01   +6.604771131708442e-01; +2.083403587376721e-01   +3.025280246367989e-01   +2.666958431671785e-01   +6.599157455103083e-01   +2.776434785421706e-01   +7.287320446777190e-01   +1.012947683439079e-01   +9.828237592211401e-01   +5.881518613448534e-01   +2.150163715348971e-01   +8.517209168810338e-01   +2.223414958732628e-01; +2.615220019746405e-01   +4.715915790293654e-01   +8.139155984399279e-01   +9.989522992177928e-01   +1.451827660894825e-02   +4.258341152630157e-01   +3.530988970727141e-02   +6.840716255705741e-02   +5.448807809398636e-01   +4.539044238355510e-01   +9.035914141319147e-01   +6.437113071355616e-01; +9.926740085412805e-01   +7.113688897448094e-01   +5.933061636807163e-01   +2.628997424959004e-01   +1.049697389231269e-01   +2.680993090254496e-01   +7.146333408877864e-02   +2.892571200614510e-02   +4.006007319515537e-02   +6.314830230974162e-01   +2.854119755447887e-01   +6.093358302402456e-01];
L2E_Input1_iAMPA_netcon = [+9.967390438739837e-01   +9.932488842239495e-01   +9.930055719774228e-01   +9.898685002190147e-01   +9.921767443068222e-01   +1.000000000000000e+00   +9.869616054126786e-01   +9.958174398084518e-01];
L2I_Input2_iAMPA_netcon = [+9.991891030498253e-01   +9.949283964338095e-01   +9.934052940499529e-01   +9.883565926185737e-01   +9.935551494646425e-01   +9.901428809417433e-01   +9.938533732074213e-01   +9.984542633347629e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
