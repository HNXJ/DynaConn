function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.273650339331721e-02   -5.097920456637732e-01   -2.510350108763738e-01   +4.066464119354087e-01   -6.229832439151048e-01   -1.970773217036409e-01   +4.591570920015716e-01   +6.087635685049683e-01   -2.046839971198163e-01   +1.991096035684681e-01   +2.947449467786746e-02   -3.718548851265233e-01   -6.000965009068514e-02   -5.795090802002981e-01   +9.665588199305564e-02   +6.472119041608596e-01; -2.012068197008723e-01   +2.038003981598454e-03   +4.335069467962334e-02   +9.652612817762148e-02   -3.275902476889647e-02   +6.888715493177030e-01   +6.195590991924126e-01   +7.183128164454244e-01   -5.487296335989225e-01   +2.058281376355360e-01   +3.596821887366986e-02   -4.266642158826501e-01   -5.894403375125847e-01   -4.456684451680089e-02   +9.133149281895060e-01   -2.683626532045861e-01; -1.915989444884821e-01   +9.848042064146355e-02   -9.509095791683762e-02   -1.919573347958488e-01   -2.992526525921588e-01   +3.886860862708824e-01   -5.247480481707252e-01   -7.568384359090049e-01   +4.467025747692877e-01   +7.586740685591732e-01   +2.321437648737001e-01   +2.010753902726411e-01   +9.338207244524508e-01   +4.423678570079501e-01   +3.277502512560560e-02   -2.496901146647484e-01; -1.304459787499482e-02   -2.909819800064710e-01   -4.200414411058644e-02   -7.902718393442783e-02   +5.109321703046595e-01   -5.602236222605421e-01   -3.782218530868003e-01   +7.009600961608232e-02   +5.328779254522274e-02   -1.759426102059227e-01   +1.481069140972887e-01   -4.065988517715585e-01   -2.432048175489854e-01   +1.755245480469521e-01   +6.715418669602862e-01   -4.690782850824027e-02; +1.867620355663390e-01   +5.688142592543626e-01   -5.799884821506107e-01   +6.501445951322730e-01   -1.450478946585587e-01   +1.877310855617171e-01   -1.195812342308879e-01   -2.038518292963662e-02   -7.253461108811875e-01   +6.197287241317562e-03   -2.835686346964080e-01   +5.154138977041812e-01   +1.730090179526980e-01   -5.725710155363739e-01   +3.350995722430095e-01   +6.413805651341955e-03; +2.370526572406277e-01   -4.374883928566879e-01   -2.135929258550022e-01   +5.670959274854809e-01   -9.736749885982453e-03   +5.216967344006943e-01   +4.266658056419868e-02   -1.421195846511865e-01   -5.627872511875890e-01   +1.789640987989951e-01   -4.685943187363542e-01   +3.310087007315827e-01   -7.224951156671168e-01   +2.210816784143995e-01   -1.583388440730085e-01   -2.551474032728688e-01; -7.919681386177916e-01   -2.805348524475065e-01   -1.105734049928735e-01   -1.321494559910508e-02   +2.292702802537021e-01   +1.698704801783429e-01   -5.667490501149608e-01   +5.750991541034116e-01   -3.907458538098224e-02   -2.435784631877180e-01   +1.266481202593073e-01   -1.095450927099451e-01   -7.386904631105120e-01   +8.327661769241872e-02   +4.681079965753314e-01   -3.053524147596199e-01; -3.627107723318767e-01   -6.103773221246074e-01   +7.433545690764556e-01   +6.387138946220112e-01   +3.901200140724275e-01   -2.630299943711783e-01   -9.118869420172490e-02   -3.024902784930275e-01   +3.274635653327290e-01   -3.579018515451529e-01   +6.359308055947233e-01   -3.438975280697549e-01   +6.359096653852072e-01   +1.911891987633634e-01   -7.188946411836268e-01   -2.929496750949526e-01; -2.139598423286348e-01   -6.497837649375301e-01   -4.482917566019050e-01   +1.651755104470582e-01   +6.009949053350030e-01   +2.097344992395082e-01   -3.140633295701560e-02   +1.592483355596479e-02   +3.162046683468688e-01   -4.646280810940810e-02   -6.728733769607649e-01   -6.704792422503428e-01   -1.712628237973060e-01   -2.372788868240421e-01   -3.959077323377421e-01   -4.242220148463526e-01; -1.553140571152138e-02   -1.344131014501174e-01   +4.726651120577881e-01   -4.047265397418153e-01   +3.168142256192966e-01   +1.599958216521180e-01   +1.952179628178444e-02   -5.347101922420969e-01   +4.269713337949792e-01   -3.462698839693008e-01   -4.900396622801015e-01   -5.485248452835791e-01   -1.195915941559557e-01   -6.713774382470052e-02   -6.915387521594980e-02   +2.758574076321976e-02; -4.451648982781091e-01   +4.152847049253314e-02   -2.897801595997330e-01   -1.435096883236566e-01   +1.314678958489857e-01   -3.416087290319216e-02   -1.514965203696928e-01   -3.757567275432920e-01   +3.463841324498930e-01   -7.277073713192630e-01   -6.568139638655218e-03   +5.839120963759766e-01   -1.166155408675195e-01   +2.456224559116404e-01   +8.617933397507436e-01   -6.985248986214020e-01; +4.874654557455192e-01   +5.156067388575751e-01   +3.051215648011746e-01   -4.386497894908305e-02   +2.134682425076909e-01   +8.351518394816980e-01   +2.316444785325910e-01   -5.932249459693983e-01   +2.496010639600117e-01   +1.152984572134903e-01   -5.626326345671798e-01   -4.508328742087179e-01   +2.801234774505253e-02   +8.049937349962190e-01   +8.557640832551254e-02   -3.555617206233306e-01; +2.991322716613565e-01   -9.497247037677553e-01   +2.149219714494948e-01   -7.717964345094687e-02   -1.931764077689526e-02   -4.661205419834925e-01   -3.750871563157843e-01   +4.065849929063922e-01   -1.540512100864421e-01   +9.085752345469524e-03   -2.892195923802854e-01   -3.402376100216003e-01   -1.000000000000000e+00   +5.770315844957189e-01   -2.912438760890809e-01   +3.872280830324972e-02; -2.073725319973096e-01   +5.814797253578516e-01   +3.398918160202489e-01   -7.489891029709155e-01   +7.540554985847800e-01   -4.489904625132851e-01   +1.878096988009554e-01   +6.428575413206644e-01   +2.770306211985991e-02   -3.619822285595802e-01   +3.493192126362368e-01   +3.450102714606573e-02   +2.891537884195202e-01   -3.495556451294015e-01   +2.234852057353579e-01   -4.082144597045342e-01; -3.377115316394322e-01   -2.696583510575675e-01   +5.962718574184236e-02   +3.036866797320341e-01   +5.738105687934334e-01   -5.227457132026243e-02   -3.948638348720976e-01   +9.075916391594849e-02   +7.982717792604235e-01   -1.617785926687709e-01   +4.155334306302143e-01   +3.588081268990362e-01   +3.546905205342439e-01   +5.460560017385128e-01   -3.320000939702615e-01   -1.622047081874175e-01; +8.664351448463251e-01   -1.151455608107200e-03   +8.113470077495543e-01   -3.050223371753282e-01   -9.794216449474581e-03   +2.068533655668804e-01   +4.293520197588871e-01   +4.530939318527516e-01   -1.612782038470005e-01   +6.026647280410812e-01   -6.190900358870781e-01   +2.285888032833012e-03   +1.957221883413869e-01   -3.774211592931370e-01   +1.790760830413565e-02   -7.376619934444278e-01];
L1E_L1I_iGABA_netcon = [-3.712869608293859e-01   +5.183453405726910e-01   +3.249672140127891e-01   +2.359502500561339e-01   +4.169577171572017e-01   +3.775921338494059e-01   +3.121999329288926e-01   -6.828940250305521e-01   +2.064163882261117e-02   -1.639818946216419e-01   -2.982232718625788e-02   +1.623497153297853e-01   +1.992180178974687e-01   -6.196139741642529e-01   -7.803261734211280e-01   +3.395021404009823e-01; -2.643252368839482e-01   +3.495310395998749e-01   -3.906714215145102e-02   -8.859462903113953e-01   -8.852462592528251e-01   +2.660114894803292e-01   +1.175997494847785e-01   +9.384204000833321e-02   -9.258832794593046e-02   +4.898289345094925e-01   -2.288533278450429e-01   -7.657384748386062e-01   +1.256513895173428e-01   +5.628505473255214e-01   -2.186609855757011e-01   +1.876023761239866e-01; +2.005415452365190e-01   +2.413151014954171e-01   -2.461637742900547e-01   +2.009317602060933e-01   -1.208049043489537e-01   -1.430171763097167e-01   -1.000000000000000e+00   -5.321403785004817e-01   +3.619431824840033e-02   -7.995244332497861e-01   +3.300016955565572e-01   -8.422371066676630e-01   -6.300671035435503e-03   -1.016810812200000e-01   -1.264067158602546e-01   +2.075821325428166e-01; -2.809615015350589e-01   +9.359390704574482e-01   +9.607269021229556e-02   -6.466926865085362e-01   +5.572555310189710e-01   +4.031614398194908e-02   -5.539303075970345e-01   -8.911109808106611e-01   +1.675644183147799e-01   -7.988546789501734e-01   -4.976463391750968e-01   -4.568484426169782e-01   -5.176492983825702e-02   -1.371434399851713e-02   -7.572492198077845e-02   +3.516360183337739e-01; +4.318529918598727e-01   +7.513922428865438e-02   -6.582997065575474e-01   -5.525848914655346e-02   +2.238919654663273e-01   +2.946174435474778e-01   +3.144374862639452e-01   +1.351127466688032e-01   +1.032094280003950e-01   -4.550990347858097e-01   -1.212106898055182e-02   -5.754574664869464e-01   +2.573151048421289e-01   +6.001088669189104e-01   -3.529906362040351e-01   -9.512308236425877e-02; +7.599463276699474e-02   +1.867872009500347e-01   +4.516529523721334e-01   +4.621509949232154e-01   -3.688620505959331e-01   -5.923449275736226e-01   +1.610957003286579e-01   -4.477720078372391e-01   -2.736843286336392e-01   -6.461478455837116e-01   -8.320810385019737e-01   +1.694827952665364e-01   +1.465243106763910e-01   +8.470962978431216e-01   +5.615932008760000e-01   -2.595791427196232e-06; -5.466636896696674e-01   +9.635212107185230e-01   +8.044329683524648e-01   +2.782582881481365e-01   +6.348188499598787e-01   +6.508446427352336e-01   -1.005217627876436e-01   +3.166255800955337e-01   -2.819639376869390e-01   +1.690568240488729e-02   -5.024903198091016e-01   -4.747234593354317e-01   -8.190888786688207e-02   -2.314191525817458e-01   -5.587993201070731e-01   +3.379015466777260e-01; -6.199195813843399e-03   +3.370180390751455e-01   +8.760392957292709e-01   -8.721375595924116e-01   +7.642517664103378e-01   +1.800861051458394e-01   -2.108615561050531e-01   +4.894594647061530e-01   +3.852625468825267e-01   +4.967918609827903e-01   -5.014189570227526e-01   +6.456606865622913e-02   +6.514262660385948e-01   -4.231600739004592e-01   +4.454471219417711e-01   +4.547452195013940e-01; -2.406650452701744e-01   +2.917331929221414e-01   -4.718323040223789e-01   +2.714977931113875e-01   +4.031582699975046e-01   +1.911306062009132e-01   -7.852945969887244e-01   -1.014234239003843e-01   -2.907559297176736e-01   +1.034045771797983e-01   +4.377947424844278e-01   +1.175764532400528e-01   -3.756590888646566e-01   +3.295009520648091e-01   +2.721506328544201e-01   +4.269938157308270e-01; +7.818845068189680e-02   -5.236441723790828e-02   +7.054641875965681e-01   -3.355613219268589e-01   +1.417984313179766e-01   +1.694993114416304e-01   -4.068089558406270e-01   +6.061354951970233e-02   -2.563998939020093e-01   +4.190720738229545e-01   +7.429023214682454e-01   +4.166840980606160e-01   -1.417926173902747e-01   +3.049566549225777e-01   +4.664852034432933e-01   +8.597647070825068e-02; +7.300279828814484e-01   +7.878246771851073e-01   +1.404954995238727e-01   +1.053645630081607e-01   -1.125023463349416e-01   +1.343661695370077e-01   -1.101428493138993e-02   -3.939504898035787e-01   +6.310775409412309e-01   +4.118204409448782e-01   +2.723766257084614e-01   -2.426833774891170e-01   -5.491692798576635e-01   +7.469119155369709e-01   +1.733948107041438e-01   -4.244642950966201e-01; -2.500358224819570e-01   -5.197683384632881e-01   -3.047490741557279e-01   +6.269012967524862e-01   +7.796523476265862e-01   -4.092548018531025e-01   -1.247083712246143e-01   -4.417590794024493e-01   -8.645433570495740e-01   -4.106949492804033e-01   -8.794773599425288e-01   -3.897301483898934e-01   +2.544276134061052e-01   -6.599281176146082e-01   -6.209819095591969e-01   +5.782084972204367e-01; -1.322064166914821e-01   -2.359393823353441e-01   -2.633968377768804e-01   -7.430695094863157e-01   +2.523404376856656e-01   -1.282070631618900e-01   -2.414095027600597e-01   +2.958555984238753e-01   -1.810159693518779e-01   +5.255201400903363e-01   +1.239625843678622e-01   +6.331550610797390e-01   +6.013294988750013e-01   +4.632369223740941e-01   +3.528251508682592e-01   -9.365151645653511e-01; -6.393524053396711e-01   +2.950817877470799e-01   -4.212396364563135e-02   +2.758627274570478e-01   -3.438376732283709e-01   +8.929194538683943e-01   +1.746233924031831e-01   -6.015861499806039e-01   -2.029616662876804e-01   -3.455826135531931e-01   -4.366835827000586e-01   -4.689858024356615e-01   +6.713486855566819e-02   +8.497366687314550e-02   -3.019537109539170e-01   +2.569147104871994e-01; +3.525801503111515e-01   -4.499116844650195e-01   +4.095151926075458e-01   -2.888836516769095e-01   -1.983105886341973e-01   -9.571220124843247e-01   -6.534746198435549e-01   +3.171296181383178e-01   +3.996546580434755e-01   -6.325092389483575e-01   +2.058292207530024e-01   +3.590706329737600e-01   +4.754239639008651e-01   +2.984932924503773e-01   -1.009103992037572e-03   +7.986806633807765e-02; +5.574167355989954e-01   +4.663181772292974e-01   -8.540898553110019e-01   +5.794913698210826e-01   -4.966794925978658e-01   -3.987342730755855e-01   +3.066471807005524e-01   +1.086934667679531e-01   -2.568470378345589e-01   -1.954701174061724e-01   -2.156869707989667e-01   +3.807298021583426e-01   +1.656561673796743e-01   -5.758736163208813e-01   -3.947516096746939e-01   +1.428443134109578e-01];
L2I_L1I_iGABA_netcon = [+1.331323490711822e-01   +7.759358105215131e-01   +1.584355058746688e-01   +1.173766486387921e-01   -3.966059813238416e-01   +2.501652221908129e-01   +5.787149243316314e-01   +2.325127540288111e-02; +7.739342936128041e-01   +5.745229085153650e-01   +3.145588431332790e-01   +2.277897762663007e-02   +6.325934746411001e-01   -8.858142990406853e-02   +2.868441502847806e-01   -4.838246799851834e-01; +3.127665422994236e-01   +4.394144616405999e-01   +3.144014907253171e-01   -3.330398853713469e-01   -5.539375383556545e-02   -5.783319728962895e-02   +4.876460360879746e-01   +6.079400792419143e-01; -3.198355572874701e-01   -1.925291377609209e-01   -8.327656815771386e-01   +6.126564173749580e-01   +5.038872967774716e-01   +6.466210575757318e-02   -9.228092518130289e-01   -2.827356315838720e-01; -5.724651986416998e-01   +4.361151454315585e-01   -2.129502315312411e-01   +6.308080780717918e-01   -8.484683159538025e-01   +2.554033217356833e-01   -3.832246049056233e-01   +2.069857830313440e-01; -2.252276916492582e-01   -5.619005897278491e-01   +3.067788295758688e-01   -1.139641107736507e-01   +2.664029047570946e-01   -6.395057316870766e-01   +7.918856120040086e-01   +1.072311330601005e-01; +5.435653361272206e-01   +1.109565007078618e-01   -3.913506403093145e-01   -8.249919617761665e-01   +3.643598738556553e-01   -3.394295904295825e-01   +1.575706971703427e-03   +3.768546501170646e-01; -2.635394376215927e-01   +2.315996237858548e-01   -5.310923945469034e-01   -5.998297250137559e-01   -2.696098171812129e-01   +4.690741839719036e-01   -8.523875304706111e-01   +4.482914387800576e-01; +2.688964897512217e-01   -5.617470702279714e-02   +4.389520367946808e-01   +8.282240592154929e-01   -4.102588858711718e-01   -5.983126658293586e-01   -5.480511900830888e-02   -4.404629410809665e-02; +1.972459149161353e-02   -6.909318925880082e-03   +2.514922030448046e-01   +1.414931318604487e-01   +1.995612351133043e-01   -1.039969699055178e-01   -9.550995194261667e-02   +4.488118515529103e-01; +1.738936969556604e-03   -8.372458581548183e-01   -8.230037486063806e-01   +5.431048909352281e-01   +1.185649487516199e-01   +2.395507619160449e-01   -4.720730408511897e-01   +5.523586936610487e-01; -4.543541926480796e-01   -1.000000000000000e+00   -6.545550775719167e-02   +7.317756560542570e-01   +3.388848414529878e-01   -2.933743613227640e-01   -3.126292529552786e-01   +4.738808609067458e-01; +1.720899268231098e-02   -2.233461754662631e-01   +2.173086331343813e-01   -2.461942541560991e-01   -1.954448401778106e-01   +5.120771017643133e-01   -3.941976816691923e-01   +6.133116312472514e-01; -4.200623186305456e-01   +4.355295906483307e-01   +6.073382190330053e-01   +3.520606068816421e-01   +2.701849977266534e-01   +2.785317988305018e-02   +3.701544355951240e-01   -3.067817124913165e-01; +4.175244672133279e-01   +2.175676563228657e-01   +6.744826245158416e-01   +7.673710208752424e-01   +2.496206200728151e-01   +3.157834069461444e-01   +6.830914424107574e-02   +3.572878823350135e-01; -3.846443806002587e-01   +2.506526235796150e-01   -6.521429156855263e-01   +2.784424332380251e-01   -5.549261883665711e-01   +8.979243149759079e-01   -4.167044266418166e-02   -2.390841393571102e-01];
L1I_L2I_iGABA_netcon = [+3.685321531117584e-01   -6.215956609433540e-02   +4.788503877045672e-01   +3.218709129818528e-02   -6.696088115306428e-01   +5.563770061417888e-01   -6.379600459459975e-02   +5.727732156214300e-02   +2.021648768528656e-01   -8.996761468090572e-02   -4.722307673594387e-01   -6.950121002133147e-01   -7.312849458439233e-01   -1.571326712128022e-01   -1.223942383258341e-01   -7.463756456721886e-01; -1.000000000000000e+00   +5.116497769973909e-01   -5.997918357407042e-01   -6.181184987509000e-01   +1.632214716508714e-01   +4.247141809188674e-01   -1.149811136701700e-01   +4.880162383570398e-01   -9.177664523804709e-02   +2.947042988168799e-01   +5.622260238130709e-01   +7.262101629354926e-01   -2.997201458470944e-01   +5.249122410996145e-01   +4.060169820213668e-01   -3.605690848944609e-01; -4.036740977936721e-01   +1.020740176484845e-01   -7.046940154762138e-01   +7.374810288045766e-01   +3.117628962732117e-01   -4.653333896292010e-03   +1.318601101761003e-01   +1.156321738969210e-01   -5.138834235144072e-01   -3.114090779106475e-01   -1.617821509548742e-01   -2.209104714849388e-01   -8.382576921347531e-01   -5.509903638677340e-01   +1.372291382221243e-01   +8.649822781922691e-02; -5.579480641335148e-01   +2.358554030753408e-01   -2.655112039017025e-01   -2.653755352392281e-01   +1.625294056177552e-01   -1.376427457414676e-02   -6.431343889107364e-01   +9.441563287558814e-01   -5.717198301535262e-02   -3.046248069562970e-01   +4.610972793018797e-01   -5.759705123891357e-01   -1.132967830001198e-01   +2.126124608635659e-01   -7.242122053460101e-01   +7.092709184614499e-01; -9.924384771363920e-02   +4.094151668110198e-01   +8.628454731893007e-01   -3.441836311371967e-01   +1.210892474710724e-02   -2.264220268169307e-01   +4.179919181475733e-01   -5.363929590658294e-01   +4.701475364939537e-01   -6.054907755206157e-01   +6.063193342487606e-02   +2.982758727728445e-01   +3.776376778562507e-01   -1.431851983742484e-01   +9.865834382954562e-02   -3.969167422336659e-01; -2.614600095376251e-01   +7.842818792055682e-01   +3.724026068434372e-02   +9.309503560030510e-02   -5.928626337202327e-01   -4.637883663119186e-01   -4.279940699146160e-01   -1.072858202124694e-01   -8.020746454794159e-01   -5.909490192227805e-01   -6.502166895719743e-01   +1.324520691134088e-01   -3.549486754044687e-01   +1.024610181691041e-01   -3.124870657119934e-01   +2.185346277703008e-01; -5.115677367721824e-02   +3.813908092308573e-01   +7.920465940064061e-01   +5.016220162390189e-01   +3.386013299590621e-02   +1.921031512823475e-01   +3.514369758419196e-01   +8.989916910599012e-01   +2.440119086213487e-01   +6.713146405918379e-03   +5.364322800222305e-01   -6.734668851766520e-02   -2.340495085927301e-01   +2.677926025372381e-01   -4.774569636618163e-01   -5.231384934772798e-02; -8.082967022214268e-01   +5.913383930795963e-01   -1.848329857334922e-01   -4.448112655371508e-01   -6.316486285788848e-01   -2.364815871097797e-01   -3.301205513719799e-02   -9.162683669788684e-01   +1.672530992355417e-01   +1.965658271972466e-01   +4.484551641036280e-01   -6.812854412119999e-01   -1.781233704583079e-01   +7.388815382920090e-01   -1.749710837553942e-01   -7.866393050466511e-01];
L2E_L1E_iAMPA_netcon = [-3.446056156337815e-02   -2.185498125514546e-01   -6.791435051797988e-01   -5.029640437521882e-01   +6.870765033003975e-01   +7.286235416601147e-01   +2.198337847130853e-01   +8.399502944290869e-01; -2.526286944826642e-01   +9.714012023618920e-01   -3.400762902363789e-01   -7.427785200413201e-01   +9.659233225839939e-01   -1.913750852625097e-01   +6.829965786010748e-01   -2.803522236750190e-02; -5.448274369526223e-01   -3.097622731992304e-01   +1.871978577065501e-01   -2.312412684510933e-01   +1.773230835039194e-01   -3.073643886374486e-01   +1.982278997078856e-01   -7.843345842920671e-01; -6.344740376447349e-01   -1.743517635880659e-01   -6.130177579270825e-01   +5.379201117916789e-01   +6.319594648189384e-01   +2.738200508027127e-01   -3.078571018662825e-01   -5.128090098872917e-01; +4.964752153126140e-01   -2.859540268162685e-01   -3.045696345229603e-01   +7.972622203203648e-02   -2.232744561385500e-02   -2.201185324591241e-01   -7.120770713171228e-01   -8.162066197407184e-01; -1.594520097169848e-02   -3.781148802823901e-01   -7.290267565491297e-01   -9.129501148554299e-01   -7.435394458184780e-01   -5.097700483377503e-01   -6.503206668800375e-01   +2.080610729217150e-01; +2.197507652394168e-01   +6.630006797823975e-01   -9.259026841552534e-02   -1.000000000000000e+00   -6.511538803784983e-01   +9.338041195805790e-01   +9.739421190063257e-01   -5.317291109505221e-01; -3.558599437004772e-03   +5.446440024283832e-01   -2.697825896630766e-01   -8.893757462124957e-01   +2.620751523577510e-01   +7.088238579611968e-01   -4.314513392000871e-01   +5.103500806782134e-01; +1.162081117435214e-01   -1.341822102574101e-01   -2.279425612247900e-03   +4.283102858323106e-01   +3.160903027664776e-01   -2.264224827796340e-01   +3.560785331350100e-01   +1.143591712122835e-01; -2.752897042368734e-01   -1.125366375701493e-01   -1.553087919871206e-01   +4.162561425379805e-01   +4.953083961322846e-01   -3.340315529043177e-01   -3.117396408642862e-01   +3.114102477836046e-01; +4.763069871167729e-01   +6.449372542383808e-01   +1.771670225946860e-01   +9.403653467388816e-01   +7.681464463580082e-01   -6.078103540455632e-01   -1.208460054688063e-01   -1.557929241952406e-02; +6.837742318114647e-01   +4.261387820510175e-01   +5.680365273156839e-01   -4.230938491629451e-01   +4.341046293894322e-01   +4.464041977806307e-01   +1.338028086835044e-01   +5.069260317511020e-01; +1.764387601386988e-01   +3.071856730012979e-01   -8.613335839671230e-01   -5.046205466703417e-01   +2.454911549456010e-01   +2.035521303273103e-01   +4.215952443633925e-01   -9.930644839042672e-02; -4.408844966923793e-01   -1.613765730262117e-01   +1.816528832742466e-01   +3.455176275223282e-01   -2.970350844590313e-01   +3.467769260609200e-01   +5.940547893153721e-02   -2.210415150213585e-01; -1.652859218707168e-01   +7.606734884407722e-01   +9.876492143183775e-02   +5.898334292088185e-01   -2.599174469388391e-01   +7.689477181537315e-01   -3.139749997367164e-01   -1.231595495178819e-01; +1.980085123192378e-01   -5.121088466968035e-01   -2.659992492956401e-01   -1.413718484891229e-01   -6.970179674074803e-01   -5.383108588629286e-01   +2.942667116498246e-01   +9.466486924329429e-02];
L1E_L2E_iAMPA_netcon = [+4.968222428481899e-01   +1.034978432327189e-03   -3.489661142074708e-01   -2.670656953470196e-01   +5.466733071618989e-02   +6.396359933628760e-02   +5.248473257027398e-01   -4.531294244204461e-01   -1.042987940826923e-03   +2.942751808904515e-01   +2.370676371346741e-01   +7.314029551419293e-02   -3.561536574180967e-01   -2.120056609512714e-01   +5.342891958011635e-01   +2.148014092612521e-01; +2.971398241882430e-01   +3.764594936850154e-01   +1.382109393399890e-01   +3.225176892284134e-01   -4.484077040165657e-01   -5.280167830319754e-01   +1.000000000000000e+00   +9.700837116977298e-03   -4.671865244681888e-01   +3.488658959519278e-01   +2.897328372975665e-01   +1.622216152050610e-02   -1.724635022531957e-01   +2.829129521558680e-03   +1.367552515826291e-01   +3.312530731974646e-01; +2.714022686023780e-01   -4.609310991362348e-01   +1.004052504845557e-01   -3.796620445840643e-01   -7.689016147386512e-01   +4.921388256414493e-01   +1.125965584435758e-01   -3.546257255672361e-01   +5.412330750342588e-01   -7.803328882057270e-01   -4.812318459987717e-01   -6.443049390837289e-01   -2.864067683079489e-01   -5.705453625849217e-01   +5.507155410762909e-01   -5.112605212481766e-01; +8.682195329394482e-01   -1.087884826555414e-01   +3.485367961953449e-01   +4.975833615141462e-01   -6.229963654014686e-01   +4.530634136532608e-02   -2.129929122966723e-01   +3.437197208893197e-01   -8.284531326098550e-01   -2.197637970277615e-01   +4.359861044155868e-01   +5.270006481053984e-02   +1.321825196388311e-02   -3.847879865805617e-01   -4.855349628141274e-01   -3.439482707878260e-01; +4.046633269614082e-01   +1.435710743495803e-01   +1.449732084208250e-01   -2.639529943007914e-01   +1.516841663128120e-01   +8.227839458770008e-01   -1.249383295120853e-01   +1.149323363994926e-01   +7.468983178393493e-01   -3.473473908504685e-01   -3.045559005330106e-01   +2.722698709294816e-02   +4.755421498982083e-01   +4.417428039379726e-02   +2.533848605920193e-01   +4.997392677990775e-01; +7.135464775517860e-01   -5.182481321510150e-01   -2.211678232249964e-01   -1.837260509679404e-01   +4.532412378594224e-01   +6.694347122483538e-01   +4.400234456186756e-01   -5.155881299004845e-01   -1.078911685085326e-01   -7.394212925592470e-01   +5.470964449603586e-01   -6.419394185135523e-01   -1.061475723461079e-01   -1.553309819467319e-01   +6.094393283864085e-01   +4.568650829216057e-01; -6.582033630782808e-01   +7.055474889537544e-01   -6.350497659392196e-01   -5.864649944671991e-01   +3.089446620960545e-01   -7.654172098994075e-01   -1.093227805925510e-01   +6.918381577090749e-01   -2.941210606781514e-01   +2.571587173620638e-01   -8.527614060130355e-02   -1.560245671915783e-01   +6.786186997415909e-01   +6.454708438926093e-01   +3.327567581415743e-01   +2.965578000065249e-01; -8.384111522653580e-01   -3.533465674661483e-01   -4.569466992886537e-01   +2.385473512406421e-01   -7.062836683782098e-02   +3.556070830004732e-01   -1.310407243674958e-01   +2.189357322692724e-01   +3.995835914130836e-01   -2.979736385414385e-01   +1.273260768380856e-01   +1.623853837344844e-01   -5.376534335781552e-01   +3.577978087581277e-01   -4.816753501383036e-02   -3.587868795171958e-01];
L2I_L2E_iAMPA_netcon = [+3.533153050216254e-01   +4.031007985305995e-01   -3.190120934757883e-01   -5.056279633194015e-01   -2.775651374077914e-01   +7.543556065670050e-02   -3.091591803836405e-01   +1.591709002080655e-01; -2.724773916581614e-01   -7.134768932539370e-01   +7.557637417721094e-02   +2.427412682199430e-01   +4.801371447625105e-01   +1.882199810310548e-01   -6.335145754103688e-01   -4.262472790350351e-01; -3.180556853666258e-01   -5.759057658353537e-01   -1.916888420386220e-01   -7.752907867759727e-02   -2.134556539001134e-01   +4.406675548177371e-01   -3.387328684533345e-01   -1.300759047125128e-01; +3.527008874795604e-01   +5.752059545731814e-02   -5.242290371609918e-02   +2.814924737147431e-01   -1.319908082913887e-01   -3.888965653014011e-02   -1.498233253008812e-01   +6.355804909476795e-01; -2.640991541632095e-01   +6.114955182932801e-01   -3.380188175781630e-01   -6.632805402593044e-01   +1.000000000000000e+00   +5.400323069879793e-01   -6.191646524590335e-01   -3.152440956618627e-01; -6.949084387458074e-01   -1.167852759868403e-01   -6.209291593729558e-01   +6.597729413265079e-01   +2.297012117395876e-01   -6.272071722311683e-01   -1.532902469445540e-01   -1.684043251885630e-01; -4.186998325788629e-02   -5.220022100001893e-01   -6.715424238125213e-01   +3.694359208843795e-01   +5.752830405549257e-01   -6.466329792736130e-01   -4.709357822152316e-01   +2.508687462360549e-02; +1.264509854785778e-01   -3.347752090566203e-02   +3.580080426423041e-01   -1.919038116676513e-01   -2.789164531230539e-02   +4.550177167615235e-01   -1.122791421805659e-01   +1.583334363445370e-01];
L2E_L2I_iGABA_netcon = [-2.572534498302662e-01   -8.289284060559444e-01   -4.756897178066812e-01   -1.877166509962530e-01   +1.853760036585707e-01   -2.214378716761639e-02   +9.488138837077142e-01   +9.545917628135395e-02; +6.611038760885720e-01   -6.520627810460530e-01   +5.471871848113303e-01   +3.502531125178023e-02   +5.900216673250283e-01   +5.436352670678203e-01   -2.030672444461342e-02   -4.929029095424451e-01; +6.093759172215765e-01   +4.334189261858608e-01   -7.196672838759928e-02   +2.390832776691264e-01   +2.740045860843701e-01   -1.361323594086448e-01   +7.060495808331825e-01   -7.985404225092276e-01; +2.016522739093020e-01   -3.165305966751866e-01   -7.861418346800252e-02   -4.085976589950242e-01   -4.293197322012918e-01   +8.274021622351028e-01   +5.046441143759829e-01   -2.917229315308171e-01; +5.560288737846210e-01   -1.713038732922784e-01   +8.508584740914809e-01   -4.034925715382311e-01   -4.281545505721054e-01   -3.120541077864429e-01   +9.476639253946589e-01   -3.028633243549068e-01; -4.965473305436343e-01   -5.347743932181764e-01   +1.000000000000000e+00   -1.361062804350520e-01   -8.566180948091712e-01   +3.366016444514278e-01   +4.377983175372753e-01   -4.188789258249485e-01; +2.415717860525566e-01   +3.630230669581702e-01   -3.466704816711165e-01   +7.826479632228399e-01   +2.276354801696587e-01   -6.281738998694423e-01   -3.607920615389698e-01   -9.373529357695633e-02; +6.009555336590330e-01   +8.366121301939166e-01   +4.872767258006375e-01   +5.775897348953917e-01   +6.958657932107014e-01   +4.885405414576538e-01   -6.399575647743873e-01   +1.562139695238828e-01];
L3E_L2E_iAMPA_netcon = [+2.258655233826296e-01   +4.574128756141444e-01   +2.426375760055294e-01   +2.575899782107683e-01   +5.764107561270495e-01   -3.712063983476289e-01   -4.429838386865225e-01   -3.429450646837634e-01   -6.789623113113580e-02   +6.354569737385232e-01   -5.244300214733942e-01   -4.727514365959998e-01; +3.544157021662214e-01   +1.155017461407166e-02   -1.382076433917981e-01   +3.140177483709189e-01   +7.143372173417832e-01   +3.654722583656721e-01   -6.279264320021834e-03   -7.030313502823732e-01   +1.149588091936661e-02   -6.999511689480438e-01   +3.045163161082871e-01   -6.549261564360692e-01; -4.639592383545627e-01   +1.847023432554591e-01   +7.174980633516854e-01   +3.480500052964193e-01   -5.574195447994013e-01   +7.644054065736687e-01   +1.082996779866894e-01   +9.532901959153972e-01   +3.712302857889779e-02   +3.601002038137468e-01   -9.014147471681799e-01   +2.310700930353762e-01; +5.405556814726356e-01   -3.836105496221663e-01   -2.323289568289243e-01   +1.025099098756776e-01   -2.229732188170563e-01   -1.139802440770696e-01   -2.916075777353404e-01   -3.729795061808402e-01   +2.415001304481669e-01   -4.798087310759840e-01   -4.334394243612281e-01   -7.096998162764537e-01; +2.076613611514621e-01   -1.594496181649014e-01   +7.833909419270981e-01   -4.936435242054673e-01   +1.338980845164498e-01   -1.661008118669952e-02   -7.946137787990278e-01   +5.778126618147227e-02   -6.447327120235450e-01   -5.167586169157180e-02   +4.007816096528803e-01   -3.393968281012063e-01; -1.771398182802215e-02   -8.291734685948897e-01   -7.293064723053694e-01   +9.486746242340285e-01   -1.000000000000000e+00   +3.156721039940174e-01   -5.919310175254545e-01   +3.734333292268805e-01   -6.526505932879929e-01   -3.591881634728715e-01   -6.526936232106469e-02   -3.430855062568088e-01; +2.083794181667188e-01   +2.990837622433815e-01   +3.651125099190528e-01   -5.468572538242231e-01   +6.053065041739663e-02   -1.061061653390801e-01   +2.457669741132373e-01   -2.085197136604084e-01   +4.971498985247920e-01   -9.832058124545073e-01   +6.352700822112453e-01   +1.163869171988335e-01; +1.089258432911628e-01   +4.545818950784450e-01   -9.220065321001932e-01   -3.398890593824670e-02   +5.013636117793400e-01   +3.063909375363169e-01   +2.734419053706487e-01   +2.390172353378040e-01   -4.688030461777795e-01   -1.902375091974177e-02   -2.616317780144538e-01   -2.626200910128049e-01];
L3I_L2I_iGABA_netcon = [-2.403835150791725e-01   +1.699650760455934e-01   +1.066436081958524e-01   +2.869042664662745e-01   +1.257807862715860e-02   +6.796935826375947e-01   +4.729584548573696e-01   +7.039587354028307e-01   -3.060440998882041e-01   -4.282283197692427e-01   -2.627456070775194e-01   +3.280858985322591e-01; -5.586330114332223e-01   -5.528073802489487e-01   +9.430540983224459e-01   -9.847446514916179e-02   +2.716923097517118e-01   +9.399086694517864e-01   +2.473955901807604e-01   +1.656343552662749e-01   -2.329235893251902e-01   -1.046924899651962e-01   +5.702324104014386e-01   -1.014710662730791e-01; -1.000000000000000e+00   -1.723739858325496e-01   +5.589958702609212e-01   +8.698099976741751e-01   -5.417688475610452e-01   -4.533056214731012e-01   +2.015001320042809e-01   -1.794080396377717e-01   -6.357637428167368e-01   +7.918845375263488e-01   +6.842576446724449e-01   +8.407514985589912e-01; -2.791817673457519e-01   +3.960799029488088e-01   +3.664421394721570e-01   +2.136043319222024e-01   +1.094021333533217e-02   -1.364022388967660e-01   -1.093287973050086e-01   +4.787163779383374e-01   +3.679760341443714e-01   -7.875306624704899e-01   -5.045867602664904e-01   -7.480887998225195e-01; +2.820823488523760e-01   +2.928281395126059e-01   +7.054655108295989e-02   -1.926123253083593e-01   +2.805190990916804e-01   +5.269815683052910e-01   -1.990956382373409e-01   +1.327178599550752e-01   -6.473880670035014e-01   -1.441000824780279e-01   +5.929559782458574e-01   +1.634831297603530e-01; +9.153147333088838e-01   -1.602743753514724e-01   -3.294505265646248e-01   +5.414608213509101e-02   +1.325915241192094e-01   +2.370763044493224e-01   +2.283972158475169e-01   -5.693734915213922e-01   -6.838707461572673e-02   -2.274078741352023e-01   -4.543693342202454e-01   -2.752842087557837e-01; +1.518931951276639e-01   +1.262876301868320e-01   +2.876303260699215e-01   -9.068705880159977e-01   -3.457314609895368e-02   +3.019396998397061e-01   -6.469514349668323e-01   -4.090402366128535e-02   -3.411623566285395e-01   -3.506516741625648e-01   -1.671535245949910e-01   +1.481098517921882e-01; +1.029863397057660e-04   -1.331471330231643e-01   +3.099706141610950e-01   +2.567767087345010e-01   -3.881127423977810e-01   -8.478655451011372e-01   -2.006236033689824e-01   -1.399926224438699e-01   -4.054122862020861e-01   -6.234364462913593e-01   +3.787798644366620e-02   -7.647889393605232e-01];
L2E_L3E_iAMPA_netcon = [+1.882735448648817e-01   -4.187884443216905e-01   -9.295989088903759e-01   -7.234928110076614e-01   -3.460182783457540e-01   +7.645076079925360e-01   -6.069314673325976e-01   +2.964061825003791e-01; -4.239162427652333e-01   +2.079503152344522e-01   -2.474989662410569e-01   -4.927903061468394e-02   +8.860463652517824e-01   -3.640496056549274e-01   -5.049263855810074e-02   +1.486792557835403e-01; -2.104133826780792e-01   -4.644135187847540e-01   -5.164544973742482e-01   -3.580755924196035e-01   +7.002408058264324e-01   +5.068965956547401e-01   +2.145858341075154e-01   -7.468963867126115e-01; -5.537533719170422e-01   +1.516721468094304e-01   +4.611504860669750e-01   -9.629483170451636e-01   -2.353801481316992e-01   +6.868729402318647e-01   +1.000000000000000e+00   -2.581664552427962e-01; +1.735173501980171e-02   +4.663048477955674e-02   +7.562399373897122e-01   -4.591435218520067e-01   -1.693629634318119e-01   -4.313107796602565e-01   +8.146086669279922e-01   +5.153016320022110e-01; -6.052397829127570e-01   +7.148334808682888e-01   +3.012258069105641e-02   -8.942050123992241e-01   +8.412344646650302e-01   +2.472451320231646e-01   -7.683730178089409e-01   -2.474250123185520e-01; -5.925733694451686e-01   -1.274133764803501e-01   +7.126185079240934e-01   -6.583102927044551e-01   +1.358920919810888e-01   -1.142194476208233e-02   -2.728839308188369e-02   +7.616564030101549e-01; +5.873456959134319e-01   -5.300602295150363e-01   +3.344323980596579e-01   +8.501123914691430e-01   +1.650833664484816e-02   -6.046477158073708e-01   +4.768246440718714e-03   -7.802664493257939e-01; +2.356614631243937e-01   -4.112458175854362e-01   -1.380149434117474e-02   -2.016460466644044e-01   +1.721011175577875e-01   +1.994655664643525e-01   -6.951687419271521e-02   +3.097822374227375e-01; -3.170797587919225e-01   -6.797501645707666e-01   -3.842625049015018e-01   +3.119597991442795e-01   +3.682558313103209e-01   +7.275188880899199e-01   +2.336233405692081e-01   +4.443786999820783e-01; -1.555305609697072e-01   -5.660154743394735e-01   +9.508488590597791e-02   +3.136810283045125e-01   +3.792847278875353e-01   +7.664487621049694e-02   -1.119392089330769e-01   +4.982293531226250e-01; +8.017573964748806e-01   -6.225855644898922e-01   -5.983670615099295e-01   -7.240723136794942e-01   +9.390663578439158e-02   -2.301138959704141e-02   +1.396219349732834e-01   +1.635718095332753e-01];
L2I_L3I_iGABA_netcon = [-2.465573500485189e-02   +1.813991388218901e-01   -6.507555593096026e-01   -6.442992221699434e-01   +1.000000000000000e+00   -7.713131400592770e-01   +6.294266982653039e-02   +1.994078574950248e-01; -2.323410245248358e-01   +3.590761143704315e-01   -5.631067632171354e-01   -6.060444905531435e-01   -9.349915356834480e-02   -3.015537170516169e-01   -4.381343792822941e-01   -4.359648486784303e-01; -1.375328786333430e-01   -8.224824924709099e-01   -1.238693213005592e-02   -3.148219868995463e-01   -2.548683556805365e-01   -5.329619767257582e-01   -2.513840260428427e-01   -3.076677246937621e-01; +2.504005200270416e-01   -4.209522613013538e-03   +5.992017195360188e-02   -5.832751281179748e-01   +3.655543497650035e-02   +1.521043619936324e-01   +6.016115518065408e-01   +7.051294943393285e-01; +2.353462714207309e-01   -3.950847817430601e-01   +2.862908902909591e-01   +1.294107716592035e-01   -2.506483002212741e-01   +1.382010602018066e-01   +1.409512870706139e-01   +7.933320726717950e-01; -3.925603664445182e-01   -6.746091510612271e-01   +5.735675767173796e-01   +2.782692022783599e-01   +5.199605129899737e-01   +3.837500523793794e-01   -6.332709458687140e-02   -2.497331131212784e-01; -1.238294271501349e-01   -8.473994662524146e-01   +2.542894931833895e-01   +4.193369554237184e-02   -5.185164760855112e-01   -1.252041864444262e-01   +3.678522764623879e-01   +4.862694281331344e-01; -1.533850459795083e-01   -6.762616633855654e-01   +3.858481688825681e-01   -7.070586703435625e-01   -3.990028987472287e-01   -5.478125268383975e-01   +1.241024665096285e-01   +6.513614844448653e-01; +2.355260618854181e-01   +1.399272123485953e-01   -1.120544159658019e-01   -1.929783253661274e-03   -3.223180814472987e-01   +5.232596072677116e-01   +2.421857604549347e-03   -1.327393941586840e-01; +2.127064978248853e-01   +4.496495309799876e-01   +1.292857293068319e-02   -2.580857100772308e-01   +5.537339061925949e-01   -3.564201683723866e-01   -4.464944871147422e-01   +2.143545007288153e-01; +2.003203589859751e-01   -1.731708766910097e-01   +7.308651520988345e-02   +5.705387516513293e-01   +4.671110428281047e-01   +1.595563094811194e-01   -5.571763204931465e-01   -3.544636153928956e-02; -2.043115466218989e-01   -2.266042230713463e-01   +1.822780288829112e-01   -1.556729001621593e-01   +1.827282347937109e-01   -4.949838670965846e-01   -7.613056732389359e-01   +5.214477070057680e-01];
L3I_L3E_iAMPA_netcon = [-3.202051374178925e-01   -2.773132584211376e-01   +2.315930226403153e-01   -4.663519119546343e-02   -1.097779287226125e-01   +3.043610792427656e-01   -2.432935602045357e-01   +2.793997728762160e-01   +7.298599233967588e-01   -9.700411467829358e-02   -2.049390917966279e-01   +1.953792972052726e-01; -3.661100565656324e-01   -3.884493827164457e-01   +8.567695235551920e-02   +5.168834701313203e-02   -2.564013669551333e-01   -4.434450333203011e-01   -1.568795732189118e-01   +3.840780436202973e-01   -4.942844918730239e-01   -1.307005862835691e-01   +2.343096619352508e-02   +1.757644519082055e-03; -2.442864519022503e-01   +1.875198925796245e-01   -7.463508853902200e-01   -3.838934093129232e-01   -2.598762598194157e-01   -1.682105839421796e-01   +2.438700250413745e-01   +3.305629963819797e-01   -3.587368388964496e-01   +5.422385224930224e-01   +2.905713993760560e-01   -3.229954912626797e-01; -5.608784639211712e-03   -9.867012667337659e-01   +1.397951717698740e-01   -5.129567528604874e-01   +5.685588459000475e-02   -3.486543682966215e-01   +3.326458734175127e-01   -5.516131251326850e-01   -2.476388850700925e-01   +3.453532362474154e-01   +3.206005420289017e-01   -7.661635990825741e-01; -8.305831875666951e-01   -8.156233642274567e-02   +2.519828735539498e-01   -1.369576897607089e-01   -1.989471744349192e-01   +2.577270981260377e-01   +3.049493260002792e-02   -4.444916232711807e-01   -6.846325191055794e-01   +3.578122332655830e-01   +3.046723107428890e-01   +3.495256011261139e-01; +6.232268077295681e-01   +4.106159061093205e-01   +3.241996553342413e-01   -7.326964340600498e-02   -3.794808780698882e-01   +4.557818311958912e-01   +1.284781534146696e-01   -1.428405722278649e-01   +8.902843394963095e-01   -4.499383840177095e-01   -9.743325388806359e-03   -1.846221114571407e-02; -3.971548019167038e-01   -5.478660364922734e-01   -2.396908224015846e-01   -1.925358935787778e-01   -9.437223808329401e-02   +8.276948297491744e-03   -6.532450040063799e-01   -1.460527231361955e-01   -2.708828500348973e-02   +2.378254185444577e-02   +5.204041430087598e-01   +6.604131219888421e-01; -4.613545930489820e-02   -4.444134342661051e-01   +6.409973934903493e-01   -2.504436213133014e-02   +7.057913450716473e-01   +8.083447756358979e-02   -3.646535903815895e-01   +5.542137575826783e-01   -1.959823182144291e-01   -6.378793663369654e-02   -4.296868724835511e-01   +4.379001688638935e-01; +3.131172645847057e-01   +1.697899335849592e-01   -7.154403233330895e-01   -3.236605710933038e-01   -4.441152486520253e-02   +1.037678341935361e-01   -2.286919393565839e-01   +7.296324225484188e-01   +1.872700235453167e-01   -1.718115956093605e-02   -1.713338759770936e-01   -6.688690858087544e-01; -2.932861016100357e-01   +3.289519209239806e-01   +3.470608008842956e-02   -8.938726439767392e-02   +4.635926893024262e-01   +2.740218595618943e-01   +4.170938360858762e-01   -7.875638302810119e-02   -1.000000000000000e+00   -7.193288854789198e-01   -6.774204323633257e-01   +3.226245651214166e-01; +3.924739473916799e-01   +7.518827433297822e-01   -2.837989283969103e-01   +8.845488582280833e-02   -2.650639319999115e-01   -3.715862810010241e-01   +1.144205789185342e-01   -2.590625458668867e-01   +6.163923016719614e-01   -3.979303999820967e-01   -4.656594041402452e-01   -6.744940020871443e-01; -2.989873320416200e-01   +3.961593680915712e-01   +2.052648649769786e-01   -4.923046148080815e-01   +1.312922811971146e-01   -3.547493103592215e-01   -2.594615705445302e-01   -5.136551584509785e-02   -4.744364577885500e-02   -1.256605700731028e-01   +4.587058870371801e-01   -7.160818803544868e-01];
L3E_L3I_iGABA_netcon = [+2.059891759820464e-01   +6.691518886589469e-01   -9.266332896545671e-01   -2.384248968568337e-01   +1.789099969146649e-01   +4.857918332684011e-01   -7.354438330264750e-02   +5.077428540511554e-01   -4.495495354499715e-01   +2.454960231163481e-01   -2.830828522182866e-01   +8.644558479387165e-02; -5.702469051638318e-01   +5.462053737757724e-01   -1.941685074892604e-01   -9.347914657881978e-01   +2.198562850646768e-01   +5.649274642219428e-01   -2.880793824280223e-01   -9.309638386398771e-01   -1.189462320204271e-01   +4.264857299870468e-01   -5.851251637023620e-01   +1.791677771736484e-01; -2.340199791422223e-01   -1.911055883841330e-01   +8.045908177894525e-01   -9.587038872886966e-02   -5.836551307042510e-02   -4.011067924670301e-01   -2.944170801800851e-01   -9.212887128683425e-01   +3.531798620569767e-01   -3.536137390049610e-01   +4.056302075543029e-01   -1.018168848191873e-01; +4.182894719120921e-01   +2.260399707793743e-01   +5.564561069560854e-02   -1.639110944955348e-01   +8.330754678736700e-01   +3.616574944869364e-01   -5.480149876617334e-01   +3.683961687585041e-01   -5.353669674830746e-02   +2.941899046616159e-01   -1.000000000000000e+00   +9.992894021604777e-01; -2.445881888377421e-02   -4.917206715038770e-01   +5.733547276412402e-01   -5.137523408099427e-01   +6.931240171939229e-01   +3.919838666755038e-01   +5.513030500322909e-01   -4.379578261209751e-01   +8.177719328868300e-01   -4.981756622741426e-01   +8.711034827305058e-01   -1.579311226473689e-01; -2.214971861835411e-01   -2.657970798489417e-01   +5.086390402514794e-01   -8.407695550757116e-02   +6.069901821203795e-01   +3.644481581620575e-01   +1.354202833899669e-01   +4.419142646246859e-01   +2.384081534504060e-01   -3.210241039519347e-01   -9.659414028009060e-02   +3.315210523794279e-01; -3.001978661248125e-01   +1.701487342766983e-01   +7.117699445398568e-01   +8.883983301424478e-01   +4.714525935806679e-01   +7.401318200505067e-01   +9.116455156619262e-01   -7.177282015348410e-01   -6.876948980625677e-01   +6.434886272604156e-01   +2.154993277442831e-02   +2.785114500862963e-01; -7.522156896617884e-01   -3.564742373525724e-01   -6.896663398405199e-01   +4.796951789959646e-01   +7.074089681401371e-01   -7.567206589979427e-01   +4.815133657507064e-01   +3.301102185987091e-01   -5.862328040470314e-01   -4.588682038505154e-01   -2.604243225686415e-01   +5.199940364735491e-02; +9.011476072060718e-01   -6.612905446432395e-02   +2.286827087546185e-01   -4.551135296180415e-01   -2.673605289258483e-01   -2.717127187625897e-01   +6.261701628682580e-01   +2.779234901480623e-01   +8.638749222369076e-01   -9.576284317757727e-01   +9.690623474574647e-01   +8.541670494197896e-01; -2.242797141151838e-02   -4.128631676677712e-01   +3.078378572198787e-01   -5.485513541600338e-01   -4.890636881482077e-01   +6.571312003639095e-01   -2.922180686201671e-01   -7.471723329644887e-01   +3.361662125142121e-01   +6.311068428633662e-01   -6.861057256221205e-01   -4.739621329437248e-01; -5.515106458237156e-01   -1.384821239235537e-01   -6.967904886985553e-01   +4.901630195653600e-01   -6.472293569913310e-01   +7.624944975188586e-01   -2.742862445667350e-01   -6.052487710441087e-01   +5.237355517422944e-02   -1.703032679496940e-01   +2.285653983494810e-01   +1.702022115988594e-01; -2.839690249163581e-01   +8.735709898592778e-02   -7.286516075428252e-01   +5.622143769669110e-01   +2.580516356830457e-02   +2.182671579196090e-02   +2.840342547326150e-01   +6.620671573118216e-01   -4.542381982705335e-01   -5.457276916485708e-01   -3.480665468926329e-02   -1.532672115305614e-01];
L2E_Input1_iAMPA_netcon = [-4.254374654463541e-01   +1.133191379034849e-01   -1.808325438970294e-01   +1.000000000000000e+00   -7.559405010223926e-01   -1.301366234228356e-01   +5.190786939116352e-02   -1.266267415159407e-01];
L2I_Input2_iAMPA_netcon = [+5.556850252442778e-01   -9.512825327147079e-01   -1.721829743255225e-01   -7.808605938161876e-01   +6.141629930052350e-02   +1.641900936914783e-01   +5.320006909077633e-01   +6.654459335629329e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
