function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.588843465499693e-01   +1.297465708044069e-01   -1.629669475131817e-02   +1.380700067249962e-01   -5.575835046627968e-02   -1.916595528588472e-03   -1.120686687536754e-01   -3.920194046174436e-01   -1.889522003643957e-01   -1.235912654584652e-01   +5.844877823533715e-02   -2.068064001180210e-01   +2.596712063015278e-01   -3.098278540988187e-01   +8.366270973339071e-03   +1.433742166797132e-01; -9.985348228845367e-02   +9.488202913838074e-02   -1.123414377334214e-01   -1.149032224440080e-02   +9.488045952894644e-02   -5.493729067829830e-01   -2.874973126199885e-01   +1.488772067354471e-01   -1.059381699816526e-01   +3.673582937494532e-01   +3.138549666905038e-01   +3.509282040893407e-01   +2.404886716952349e-01   +7.507981391198618e-02   +2.813674541084895e-01   +4.422378278246909e-01; -1.736770791304149e-01   +3.376434039007893e-01   +2.891591550509041e-01   +9.869329152995093e-02   +1.107406959527873e-01   +3.287995139004212e-01   -9.044973920236987e-02   +5.560886295182847e-01   -3.253579200618392e-02   +2.123427683273071e-02   +1.208567364255276e-01   -2.852489417734832e-01   +7.161006782428078e-02   +6.749186157484283e-02   +1.200144549775562e-01   +3.474386443341613e-01; +1.245640242529948e-01   -3.094467874074961e-01   -1.729599084728057e-01   -1.497337936306055e-01   +2.364216168856970e-01   -8.858125273463366e-02   -3.598012124723458e-01   -1.106197028504846e-01   -1.847757507930706e-02   +1.831444268849546e-01   +2.049868810418068e-01   -3.471618079511518e-03   -1.478118594623559e-01   -2.978860323482388e-01   +2.093583684337008e-01   -4.538604031751216e-02; -6.925259967605776e-02   +3.452469546375982e-01   +1.417096376712342e-02   -1.541237211796917e-02   -1.735028032496779e-01   +4.150869522154842e-01   -4.359836132608340e-01   +1.025479868266823e-01   -3.320530627739070e-02   +6.057310358087742e-02   +7.204223138400831e-02   -2.326577751853904e-01   +2.054955160752443e-01   +2.030691022917537e-01   +1.576308140696745e-01   -7.311100343315372e-02; -1.441656294068674e-01   -4.070794571408806e-01   +2.245177380144414e-01   -3.836343219205897e-02   +2.394264263040188e-01   +2.256502241436451e-01   -2.143118647143449e-02   +2.223042288422462e-01   -4.366929584236432e-01   -4.080938962125150e-01   -4.271418601167589e-01   -2.990374565167360e-01   -6.187994557239227e-01   +1.421330098032783e-01   +1.480455552589480e-01   -2.987453237621890e-01; +2.714235464542080e-01   -1.332923974634538e-01   -3.556892969387725e-01   -3.214104137403784e-01   -2.368810613291027e-01   +1.573781809953128e-01   -1.761145354851804e-01   -1.495525131482991e-01   +2.421531077065241e-01   +1.662420389233215e-01   -3.124343887331359e-02   +2.370221169829784e-02   +3.951331867107391e-01   +6.274408260183435e-02   -9.581767888510996e-02   +5.489405436222922e-03; +1.333920107917414e-02   -1.272148987326835e-01   +1.237462749793051e-01   +1.494007377904584e-01   +3.504651259218126e-01   -2.969724599394302e-01   +1.120016164127132e-01   +1.738971716009036e-01   -1.164956171271828e-01   -8.423035672057763e-02   -3.730793760494491e-02   +1.612562227359223e-01   +1.177139793983294e-01   -1.679297348352206e-01   +3.077439259454399e-01   -8.848882854483306e-02; +2.145517325445966e-01   +3.668874070890978e-02   -1.992786859854128e-01   +1.542035004679471e-01   -6.203751632337731e-02   +4.068333023981247e-01   +1.570508049193560e-01   -2.762098912013817e-01   -1.613381471468059e-01   -2.003071644392236e-01   +1.639651643219133e-01   -2.646988206700617e-01   -6.135116875715449e-02   +2.033931572895416e-01   +1.435333278932319e-01   -2.756461614432357e-01; +3.616210593083589e-02   -7.504678383589711e-02   +8.494760793738482e-02   +1.453566388389077e-01   -1.748882411363667e-01   -2.885172862009699e-02   +1.481832253821030e-01   +3.491133344495754e-01   +7.219834391125129e-02   +4.581580120901931e-01   +4.436587472115861e-01   -3.203859056157869e-01   +2.325385295819606e-01   +1.401790697456265e-02   -3.114787057364790e-01   -1.429161804902737e-01; -2.223045026326984e-01   -3.827968343284001e-01   -1.837851407092801e-01   -7.741059961656352e-02   -5.239196927075022e-02   +1.706270990547558e-01   -1.679696201556282e-01   +3.646406661779160e-01   +2.298245093703025e-01   -2.009931929118071e-01   -1.498721304625964e-01   -1.008248059904159e-01   +1.860053396792566e-01   -1.550403495927554e-01   +3.237164322106554e-01   +2.324721231649852e-01; -3.931379753771310e-01   +4.676933609930525e-01   +5.538360949737689e-02   +3.026639990580048e-02   -1.221254003079772e-01   +2.259715521060929e-01   +1.703331095902519e-01   -2.124388345809457e-01   -1.053909260045299e-01   -2.414195249072104e-03   +8.724870468928811e-02   +3.915279332323830e-01   -2.972320391423467e-02   +3.235952041137621e-02   +3.667672976775862e-01   +5.824068802244475e-01; -1.796569706923223e-01   +3.191067935058515e-01   +2.566100892925747e-01   +2.313789906510302e-01   -4.314993348787292e-01   +1.341293170696323e-01   -2.398812937371290e-01   +4.585657706886586e-01   -1.809133391479714e-01   +2.892836772772341e-01   -7.997984591361118e-02   +2.470056963466402e-02   +9.969617585674145e-02   -2.856549799381362e-01   -3.804783694160397e-01   +1.449640024089711e-01; +5.766514184060021e-01   +1.749252432466344e-01   -1.111621109983673e-01   -6.812652002799158e-02   +1.081593403032823e-02   -4.944182757680324e-02   +1.917033502093683e-01   -4.224131779370316e-01   +2.726496548790580e-01   -1.270760894119320e-01   -3.959017117769396e-01   -1.053347061403170e-01   +2.638092265670223e-01   +6.406608789765844e-03   -1.491986862324770e-01   -2.599045819306206e-01; -1.355901969843895e-01   -1.966319673543601e-01   -5.694787695740182e-01   +5.069940014563545e-02   +2.171443548723382e-01   +5.360690272593150e-01   -8.804287870962083e-02   -3.276892240813872e-02   -5.551434866698524e-02   -4.457576108906459e-02   -1.963861946234174e-01   -7.835911977688459e-02   +2.023880497896607e-01   +2.518827096570059e-01   +9.560155774948773e-02   -4.080144275086613e-02; -2.617889012417128e-02   -4.648110441012627e-02   +3.809999932451116e-01   -1.030690930515419e-01   -3.589364229626684e-01   -2.002659636356155e-01   -2.238083093502694e-03   -4.864334842052270e-01   +5.976937918694876e-01   -1.740549981543255e-01   +8.723124697730822e-02   +5.139717034451570e-01   +8.979023746394654e-02   -9.285657953955970e-02   +2.902342252828080e-01   -1.420286378691117e-01];
L1E_L1I_iGABA_netcon = [-3.741249633923832e-02   -1.600613529241204e-01   -1.162648327923928e-01   +1.844426612195535e-01   -2.386768266818003e-01   -3.930937761221448e-01   -2.575217851801448e-01   +3.884479988008225e-01   +1.208942038376929e-01   +4.211209209692351e-02   -5.543442460215739e-02   +1.380683932401136e-01   -1.048143089829227e-01   +2.168582385035079e-01   +1.338559110283155e-01   +1.783228987145342e-01; +2.047964614619139e-01   +8.962346624765805e-02   -1.803609714271531e-01   -1.662845484390122e-01   -1.932273615495903e-01   +1.511882946721091e-01   -3.048830823149091e-01   +1.469109263561644e-02   +1.512324346903330e-01   -3.523344474825627e-01   -4.450141244488198e-04   +4.083442635210824e-01   -3.198079122776477e-01   -5.868031736240303e-02   +5.718038876367766e-02   +3.065288174077766e-01; +3.845838837108742e-01   +4.836167950240264e-01   +2.292122177380234e-01   -4.241494564369915e-01   -5.232384731665574e-02   +2.909171220223793e-01   -2.061238180767083e-01   -6.301277163096333e-02   -3.526029006951371e-01   +4.684407607898131e-01   -2.214021571088662e-01   +9.067724335148103e-03   +3.303387093329311e-01   -2.962147004702281e-01   -3.582780826258535e-01   +3.372192750119744e-01; -1.514718208564634e-01   +3.378062542237066e-02   -3.419696715509146e-02   +3.639610831312021e-01   -7.299924492910917e-02   -3.498976088955652e-02   -3.290843060774840e-02   +2.656082373512646e-01   -1.493173052356661e-01   -4.628866678498101e-01   -6.389623100207065e-02   +2.180469846162868e-01   -1.530123369957757e-01   -3.914169276519787e-01   -1.079625677066901e-01   -1.112604691650897e-01; +3.340137315101339e-01   -1.181795079346912e-01   +2.445342641323476e-01   -1.096759440442328e-01   +4.494059332825952e-02   +3.213998668318914e-01   +2.999368460848706e-02   +2.322882250584148e-01   +4.419107849014328e-01   +7.101787569869855e-02   +1.338129184296599e-01   -7.517861379650725e-02   -8.911770125937647e-02   +4.215050961669478e-01   -1.785297726492015e-01   +7.997811033083299e-02; +1.238462129942197e-01   -1.161070568034430e-01   -9.680082612763347e-02   +1.868020335930852e-01   -1.079022093870543e-01   +1.759391133975383e-01   +3.924951159461485e-01   +1.776870473292068e-01   +2.906829562202470e-01   +2.383102204589728e-01   +4.046734144359878e-01   +2.352767836358270e-01   -2.431740412853121e-01   +2.139688003759833e-01   -4.669472214616236e-01   -1.749072211056702e-01; +7.233318224175540e-02   -8.054743815595783e-02   +6.016127746372997e-01   +1.471602554637330e-01   -2.946586551173490e-01   +1.680479774118898e-01   +3.325234934872058e-01   +2.761915568979753e-02   +1.845860698304013e-01   -5.087920587556677e-01   +6.340226227879292e-02   -8.935622264740284e-02   -1.147552348250722e-01   +2.906328966024940e-03   -1.490105345622841e-01   -1.311971486734870e-02; -3.674462198733958e-02   +5.803212752185360e-01   +1.620446801109624e-01   +6.957015363263658e-02   +2.316705073144069e-01   -2.594475313884795e-01   +8.617516245556378e-02   -2.534057844697480e-01   +5.909664682242255e-02   +2.047522934004117e-01   +9.492206128753292e-02   -1.436172457329642e-01   +9.709138818513899e-02   +4.283987883797872e-01   +9.008927352018983e-02   +8.184689506176260e-02; +7.040680406075378e-02   -4.550946603503437e-02   +1.645491070846349e-01   -1.865686633338062e-01   +2.508089081289536e-01   +2.329203989550037e-01   +7.412311629606372e-03   +9.105342944590772e-02   -1.788936295063587e-01   +3.181181039944353e-03   -2.470944181081731e-01   +3.586082684488781e-01   -6.581219666893072e-02   +1.826425106913437e-01   +3.647659968347430e-01   +5.322236974395178e-01; +3.294432946347591e-01   +6.476148804367254e-02   -2.983188328611783e-01   -1.807754196406816e-02   +4.570750490490446e-01   -3.257707694727629e-01   -2.532789923180287e-02   -3.763786011911360e-02   +2.069523386965215e-01   -6.853048188489945e-02   -2.418125213418568e-01   +4.328897400601450e-02   -2.912796902867607e-01   -8.768764791143976e-02   +3.011441296280084e-01   -4.716726561119367e-02; +1.221151879873687e-01   -9.134670489234484e-02   +2.584868354321114e-01   +1.076658642054515e-01   +1.632107829623632e-01   -3.569791412894706e-01   -2.266355658925061e-02   -1.574634274607481e-01   +9.716880255409223e-02   +1.105554290374001e-01   +3.860907080432785e-01   +1.739476058376091e-01   +3.305801352677212e-01   +2.228968069598827e-01   +2.863488840261523e-01   -5.439408820426322e-02; +6.528193978391772e-03   +3.785842589155582e-02   -1.034370458974384e-01   -1.064837295693770e-01   -2.868722396483360e-01   +8.943917342110250e-02   +1.551188788937338e-01   +6.704419468580847e-02   +3.417846440132449e-01   +3.226325623898714e-01   -1.887710002635201e-01   -4.080085011241880e-02   -3.092297767349053e-01   -2.333850379468937e-01   -1.208196086630194e-01   +4.783326284719114e-01; +1.712012810717015e-01   -2.692442401956231e-01   -6.864711901330503e-02   -1.741449424793956e-01   +4.336717406149692e-01   -1.251946288077152e-01   -4.853414590320750e-02   -2.939132169682785e-01   +3.405767646921999e-02   -5.076015819421950e-01   +3.445214316495058e-01   -1.083616019964953e-01   -1.712781683254713e-02   -1.824658267109035e-01   -4.352904143568326e-02   +1.234704672907357e-01; +2.703668720735108e-01   -3.067427907784356e-01   -6.975167011513113e-02   +3.830456427425387e-01   -1.589163214055759e-01   +2.975883724541558e-01   -1.119858557675612e-01   +2.558513678094273e-01   -7.389979787075202e-03   +2.689454582834732e-01   -5.263955453434122e-02   -2.229036227827691e-01   -2.709217649161329e-01   -5.065009659497712e-01   -7.453275298375872e-02   +1.221374137184299e-01; -1.530811650620138e-01   +7.607922760167456e-02   +7.053015924089263e-02   +1.492649572351774e-01   +1.814565528006085e-01   -9.783620870766122e-02   +2.065587746259400e-01   -2.283819068642627e-01   -1.080680851837969e-01   -3.008103983425197e-01   +1.934577734117338e-01   +3.114223863380181e-01   +2.839874387074336e-01   -1.920603857680386e-01   +6.904557982592534e-02   +2.225110231488941e-02; +1.744480599795199e-01   +2.761316020634181e-01   -1.075520497394436e-02   -2.914141081334722e-02   -1.734236527575038e-01   +1.228716844081452e-01   -1.654804725374628e-02   +1.891478711764241e-01   +2.547766801410463e-01   -3.115672522080543e-02   +2.327731367910177e-01   -8.717440153763245e-03   +4.456691937315545e-02   -3.878357315208089e-01   +5.367852112336420e-02   +2.396055869885123e-01];
L2I_L1I_iGABA_netcon = [-8.295475096565928e-02   +2.022448443361349e-01   -1.437737174873005e-02   -6.751325078086484e-02   +4.504958757544703e-01   +1.413912772662271e-01   -4.615223695136555e-01   -2.145200381335025e-01; -2.754123622828758e-02   +1.043572097517180e-01   -1.296355686906974e-01   +3.928460994436975e-01   +4.402436528747992e-01   -4.993776694241944e-02   +4.260744055377598e-01   +1.005388083084801e-01; +1.133723490178095e-01   +4.453515660604900e-01   +4.394118092726665e-01   -2.676572628412633e-01   +1.733288028975891e-01   +5.934966799461209e-01   -4.091035923195526e-01   +1.399275424723120e-01; +1.634937081958235e-01   -1.481220305451429e-02   +1.610543236855223e-01   +1.833756832883012e-01   +1.048440719412806e-01   +6.839385896991754e-02   +5.190038293988278e-01   -2.122451746074414e-01; -2.226025884143233e-01   -2.351198004019254e-01   -6.778353922558406e-03   -6.818948486076723e-02   -1.388590675342792e-01   +2.321296781132133e-02   -4.289938945451932e-01   +3.797494267014938e-01; +1.877318837034028e-02   -1.450573804961827e-01   +1.256923796074560e-01   -1.821213861221956e-01   +2.896536093348697e-01   -4.005880262351983e-01   +1.556850881049367e-01   -2.345198587228270e-01; +1.918241388276625e-01   -7.604706142380992e-02   +2.423128781231194e-01   -1.254108711384139e-01   +7.324980935131623e-02   -1.550348517991089e-01   +2.999668594945539e-01   -7.462374565635849e-02; -2.002871246203527e-01   +4.286616938692682e-01   -2.492225569477994e-01   +1.470888521299627e-01   +6.439833403070486e-02   -2.893715823654205e-03   -3.562300791960293e-01   +2.708964239009803e-01; +1.241685462955643e-01   +1.773469591694554e-01   +2.502424138810261e-01   +4.493138701530092e-03   +3.494458703081854e-01   -2.901575501820252e-01   -1.427452302374876e-02   -1.273882956559796e-01; -1.012034478179120e-01   -2.418367165886849e-01   +2.361357430628295e-01   -3.090479649329927e-01   +9.762101949064093e-02   +3.168478121680395e-01   -3.865612821080505e-01   -1.947091834162697e-01; +1.272232153377784e-01   -1.791872203539591e-01   +3.048394620856510e-01   +3.089510350904987e-01   +4.228382354856666e-01   -2.379871257025228e-01   -3.842603544940541e-01   +2.906853216947888e-02; +7.928094097953822e-02   -6.301300752474380e-02   -2.605733038453850e-01   -2.268948461531457e-01   +2.419821173845762e-01   -8.271160958384868e-02   -4.612201761089755e-01   -4.215412293911018e-01; -5.219677615798858e-02   -1.741840318695438e-01   -3.769574593945632e-02   +3.261516284095348e-01   +1.681455525942758e-01   +7.826364209526623e-02   -3.308971479329443e-01   +3.838565601212408e-01; +1.954599403505343e-01   +3.946836182345423e-02   -6.262577690759119e-02   +2.389341655446070e-02   -1.852030324576413e-01   -1.335201736512211e-01   +1.040647611491643e-01   -7.493019451727723e-02; -3.194669136088322e-01   -3.863203091400691e-02   +2.732246558529536e-01   -2.012210837626691e-01   +1.519696327460930e-01   +2.576689099771057e-01   +4.533793277700443e-02   -4.438815565462775e-02; -5.061679777020449e-01   +1.873137899370867e-01   -3.436305843169393e-02   -2.577035469659597e-01   -3.549184849419502e-01   -1.545090120253498e-01   +4.244725748750210e-01   -3.676350623630159e-01];
L1I_L2I_iGABA_netcon = [-8.640791006689151e-03   -1.032342349967275e-01   +2.024791764045797e-02   -1.290407467623107e-01   +1.743141034177216e-01   -4.239391305466529e-02   +2.951001918919096e-01   -3.475507788675752e-01   -1.115079438015501e-01   +4.002577434042045e-01   +1.514837638094945e-01   +1.309170641511218e-02   +3.259491864349786e-01   +6.665114032984334e-01   -1.884559440130676e-01   +5.959076350802776e-02; +1.318385710215206e-01   -2.922851775143097e-01   -5.757579425989069e-01   +1.877154422076938e-01   +1.917608058419670e-02   -3.180611913576509e-01   -1.322754722197202e-01   +2.379395126402472e-01   +1.568928717894889e-01   -2.007857754911088e-01   -4.831937734559988e-02   +1.036068973749240e-01   -1.552373358322937e-01   +3.730723509054542e-01   +1.245140990534013e-02   -1.373738038624447e-01; -3.205993532807413e-02   +2.827949000177045e-01   +3.774577403155491e-01   -1.155105830883132e-01   +1.454096323891461e-01   +1.438202383565092e-01   -6.467301277428339e-02   +1.426276171016240e-01   -9.788263042817635e-02   -4.392596914490607e-01   +1.939295743305555e-01   +3.449798993524530e-01   -3.515306077732568e-01   +2.052055498011240e-01   +1.815399277834645e-01   +7.015589803012458e-02; +1.243706886389553e-01   +2.827107173770937e-01   -1.079591918971818e-01   -4.864588597818389e-01   +1.324660745404740e-01   +2.572697855902255e-01   +1.043809205077512e-01   -1.325406101417579e-01   -3.053814309935627e-01   +4.343499066938370e-01   -1.913394319761942e-01   +3.723224158261307e-02   -2.231527387017883e-01   +3.101378335672597e-02   -1.469098324358307e-01   +7.224808425089470e-02; -2.093761062963365e-02   -2.741061807874591e-02   +1.858677983382179e-01   +9.467975338519616e-02   -5.730583876910984e-02   -3.301428419216573e-01   -2.514373880754835e-01   +1.313417711922151e-01   +3.076688189976060e-01   -3.151595252965433e-01   +6.604165693666721e-01   -5.620495097197486e-02   -1.875056945874212e-01   -1.283080943170294e-01   +3.739962855798917e-01   -1.796732463527527e-01; -2.673979370490340e-01   -4.205012276875650e-01   -3.801153402447808e-01   +2.591270176743913e-01   +2.304415869898535e-01   -1.721989249744321e-01   +4.803323900128665e-01   -1.298843766854736e-01   -1.327317408331841e-01   -1.849889706416868e-02   +2.197155629694686e-01   +1.918322295979722e-01   +4.800361459538616e-02   -1.479681888225881e-02   -4.213536249546265e-02   -2.635914041623291e-01; +1.315853262836020e-02   -1.416672801134867e-01   -1.580531192683610e-01   +2.850852908221687e-01   +3.976622304075437e-01   +1.757875915888647e-01   +3.049021431766493e-01   +1.166098368058854e-01   +2.543904308078947e-01   +2.175951789242473e-01   -2.247130541679435e-02   -3.508311443079332e-01   +2.653054703509499e-01   -4.329648719885448e-03   -8.027814881744727e-03   +1.782278885476929e-01; -1.907674996318894e-01   -2.039788039370063e-01   +2.888106512678459e-01   +2.803470615303171e-01   +1.576081964810817e-01   -2.991179324702664e-02   +4.556551261016888e-02   -3.500951263239314e-01   -8.502863725679405e-02   +1.599559381875575e-01   +6.220390238318230e-02   +1.788542137827093e-01   -2.858237908497586e-01   +6.422394879889659e-02   +1.954358500004212e-01   -2.352417964181523e-02];
L2E_L1E_iAMPA_netcon = [+3.534182144255654e-01   +4.297343950940893e-02   -2.336367343662261e-01   -1.568100418066135e-01   +5.719374154053565e-01   +1.515007237091007e-01   -2.262527208198683e-01   +3.004738949582195e-02; +1.011824720166675e-02   -3.022914950125793e-01   -1.621844973340434e-01   +1.412259949892213e-01   +1.240533292391234e-01   -4.166493483654283e-01   +7.310839322405796e-03   +6.568115426421538e-02; +5.988165065615322e-01   -9.485433023486933e-02   -9.586359117333743e-02   -7.249065479740976e-02   -1.853227474402368e-02   +1.267236684986796e-01   +3.340328973782125e-01   -2.068570590808834e-01; +2.687861936845927e-01   -3.364656949697209e-02   +6.130835654697572e-02   -1.493522238707908e-01   +2.000242397315144e-02   +3.442116807080972e-01   -3.024475750748272e-01   +6.523998494378569e-03; +1.915567597153132e-01   -4.399551120376793e-03   -1.996702969078541e-01   +3.500047158365805e-01   +3.976021816112250e-01   -4.205163675361795e-01   +3.473142193424284e-01   -5.421458447077505e-02; +3.250024602391698e-02   +1.807872919850487e-01   -3.379139793999880e-02   +3.791328158587850e-01   -1.703035101875960e-01   -3.042875239881487e-01   -3.286347083328989e-01   +8.473191666183773e-03; +3.365260197389242e-01   +2.002819277873099e-01   +2.801389229430148e-02   +2.128277777519313e-01   -1.360290639787539e-01   -7.156811860113622e-02   +2.338432947534443e-01   +7.176140776524001e-02; -1.979988290940706e-01   +1.950013549391986e-01   +2.561097267954476e-01   +1.289895539784921e-01   -2.897908880800816e-01   -2.531843624312341e-01   -3.017031814742414e-01   +1.438692713001074e-01; +3.316240343930885e-01   +2.389856279843789e-01   +3.613298309936636e-01   -2.749983741326908e-01   -1.346937502389122e-01   -2.144470838180753e-01   -7.698127264921020e-02   -4.576675452139155e-01; +6.339013914312247e-02   -1.232787017974117e-01   +1.985348017332809e-01   -1.167513673129446e-01   -3.627359549975386e-01   -6.440031039527339e-03   -1.196660878945502e-02   -3.585140336481334e-01; -1.575698848059734e-01   -6.616080792709754e-03   +2.891713165594145e-01   -5.998141622882781e-01   -1.644789798817206e-01   +2.423404504538893e-01   +3.025007079283620e-01   -5.497224352935358e-02; +6.844602250324029e-02   +2.222749385557759e-01   +1.583546812921057e-01   +3.668817746621426e-01   -5.648347283903244e-01   +2.234679773078428e-01   +3.389464738318911e-01   +2.331977805486100e-01; +1.576801997129405e-01   +2.999197128753051e-01   +2.274156746023241e-01   -1.259663249124866e-01   +1.214186555761667e-01   +3.429131243966154e-01   -1.562581234756970e-01   -4.082959804419514e-01; +3.379275586776284e-01   -4.886219919622204e-02   -4.116866822057291e-02   +1.858787108941041e-01   -2.105044299857497e-01   +4.267397265898351e-01   -2.888685025150530e-01   -2.522849849609556e-01; -4.591639232227376e-02   -9.944209494212680e-03   +7.938942393515142e-02   -2.106890514037767e-01   +4.547119221013305e-01   +3.930626124799195e-01   -1.426154263711318e-01   +1.370380408424398e-01; -1.599001463375207e-01   -2.716676954136390e-01   +1.737088778055755e-01   +8.554335653535097e-03   -3.483727905523711e-01   +1.557859979503394e-01   +3.322463648356664e-01   +5.711247352381281e-02];
L1E_L2E_iAMPA_netcon = [+2.728504053353670e-02   +7.585684437798323e-02   -7.018562616356189e-02   -1.754912695337573e-01   +9.814234988648363e-02   +8.828078246266421e-02   -2.549293602798288e-01   +5.979498082264074e-02   -1.422071742132004e-01   -7.122539290144997e-02   +2.742316829288515e-01   +7.366507689179076e-03   +1.507982788527915e-01   -2.922412556812312e-01   +4.020624599944264e-01   -1.037963313344622e-01; -2.405172028866126e-02   +5.128642914313503e-03   +2.615747645783935e-01   -3.599957509922483e-01   -2.139442741858819e-01   +4.197892937402804e-01   +2.265351904110543e-01   -3.131953838815443e-01   +8.495444961235248e-02   +5.401684090360914e-01   +7.950507315568670e-02   +3.034430428357471e-01   +1.284486238683455e-01   -1.779320670508489e-01   +2.822886136296808e-01   -5.957327830053990e-01; -3.022875651990452e-01   -1.019524716886537e-01   -2.872604064501116e-01   +2.962190552559654e-01   +3.139638049504730e-01   +9.129475507112784e-02   -1.792718467313175e-01   -3.515428444429640e-01   +4.204897486887275e-01   +3.279310918005432e-02   -1.092357719942567e-01   +7.589581163745820e-02   -6.339412576027029e-02   -1.948904091210832e-01   +2.601246403916361e-01   +2.534578349317811e-01; +1.680783712591650e-01   +2.458654106504321e-01   +5.750023739150030e-01   -1.274751939748478e-01   +2.634404844938418e-01   +2.691990038933840e-01   -1.306574481760463e-01   -3.220690683703890e-01   -4.964332819627770e-03   -2.423191015541676e-01   +1.733100840510408e-01   +2.524125891803428e-01   +2.015005894007166e-02   -3.077698403725097e-01   +1.000452046319036e-01   -1.581905961997188e-01; -2.527575031643487e-02   -6.182606129295192e-02   +1.836986245307273e-02   -3.043710181245859e-01   +1.395866211748830e-01   -1.315456514701890e-01   +3.858048148821265e-01   -1.187244854143248e-01   -7.081110721159650e-02   +2.268863308545786e-01   +1.067358798188722e-01   +2.792999525761224e-02   -1.753243423606647e-01   +4.518454481002342e-01   +2.496002777145058e-01   +1.734700442410164e-01; -2.553277333234993e-02   +2.942129316279645e-01   -2.368084555479533e-01   -1.466619766668342e-02   +3.633936469164140e-01   -2.457581729341577e-01   -2.245769142001853e-01   -3.319848458084150e-01   -1.236744631387234e-01   +3.657805082818378e-02   -1.800939089583453e-02   -3.128548389056079e-01   +2.023857498539772e-01   +3.061799732422058e-01   -1.207676054163115e-01   -1.417070513165861e-01; -4.730378883480951e-02   -1.025026935972474e-01   +1.618763390882808e-01   -3.701695423908748e-02   -1.550186574599860e-01   +3.834146666358511e-01   -7.518138125248097e-03   -9.202400706328664e-02   +2.824473123910894e-01   -3.581337127898268e-01   +1.963181170270010e-01   +1.429120208864168e-03   -8.085607041597320e-02   -2.576880356843964e-02   -1.445643700955750e-01   +1.038946014664939e-01; +2.893742240146175e-01   -1.430751807581117e-01   +1.797393865272212e-01   +2.195843471474509e-01   +4.773959356701576e-01   -3.607553904558488e-01   +1.190150258451723e-01   +1.132892705623642e-01   +1.200832032218521e-01   -3.336128745629486e-01   +2.571433773678408e-02   -1.903371245375067e-02   +1.510153893194545e-01   -1.249778209040316e-01   +1.865585900267953e-01   +2.556950728462312e-01];
L2I_L2E_iAMPA_netcon = [-7.913486946530374e-02   +1.074104629171441e-01   +1.717496140520682e-01   +4.689872109628268e-02   -1.584991230451268e-01   +2.595733103138301e-01   +2.460452885390942e-01   +4.745443806845632e-02; -2.675195418795150e-03   +3.640681932899514e-02   +1.050864671664617e-01   +1.420062670744890e-01   -1.556152955571964e-01   +2.935101193407737e-01   -1.056079953317405e-01   +2.949993665629663e-02; -2.667397977724779e-01   +4.201450354567894e-01   -1.506388194244893e-01   +5.829401143605502e-01   -1.167144412001668e-01   +1.223681018814299e-02   +2.164822034016533e-01   +1.216494957645700e-01; -1.519635956838968e-01   -2.257867257431260e-01   -1.663274396659488e-01   +5.758751764590828e-02   -1.950208966170434e-01   +1.935515440915797e-01   +2.865582629767669e-01   -2.753699480241825e-02; -2.361141477823617e-01   +2.975247392338540e-01   -1.984050974515762e-01   +1.618990520963880e-02   +9.965416984040089e-02   -1.785233528599932e-01   +1.821122316304006e-01   -2.579314908389706e-01; -1.918892815994900e-01   +2.372509807591653e-01   +2.120330553985616e-01   +1.533868189033520e-01   -3.549377444572879e-01   +3.555266035387743e-01   +1.658443096811835e-01   -2.473397986007796e-01; -5.226672184981287e-02   +2.320067318258252e-01   -8.235145767407150e-02   -1.221544925844122e-01   -6.016585921743744e-02   -4.830585865156681e-01   +2.274674271585483e-01   +1.298185785868252e-01; +4.621154025415668e-01   -9.278368637147333e-02   +9.881279973353316e-02   +4.327094443277319e-02   -1.718779862775701e-01   +3.514125755139265e-01   +1.261371940846678e-01   -1.905097688450574e-01];
L2E_L2I_iGABA_netcon = [-1.676905322220582e-01   -3.385857100097419e-01   +8.883316147800349e-02   -1.128070319079580e-01   +6.037458831943127e-02   +3.438785042317772e-01   +4.308581193138548e-01   -4.167160916473793e-01; +4.623414747441391e-01   -2.323870584235845e-01   +1.537756064983601e-01   -7.671952029376886e-02   -1.322968452148787e-01   -5.826552256221239e-02   +3.159755683301003e-02   +7.023982526801464e-02; -4.672304482740168e-01   +2.008726403955516e-01   +1.039397695281008e-01   +6.093566037150935e-01   -1.572947194449246e-01   +3.000274459639996e-01   +5.101627486077415e-02   -4.710821378903995e-02; +3.176072223341690e-01   +3.482284837622880e-01   +1.358891019538944e-01   -4.121551750152764e-01   +1.284938151059022e-01   -8.076040719487663e-03   -1.769184191873315e-01   +8.501198568561816e-02; +4.022856812694955e-01   -3.085096926494028e-02   +2.236830551704657e-01   +7.020428867387681e-02   +1.122106169631968e-01   -9.316647966854245e-02   +5.653923149738627e-01   +4.221034180888337e-01; +1.866777209072236e-01   +9.962720524489913e-02   -1.746297741650161e-01   -2.592367445272983e-01   -2.008443180317015e-01   +2.779102611629540e-01   +1.181011268340016e-01   +2.535897250349564e-01; +4.846576570642370e-01   +1.273607950952970e-01   +4.245164454334355e-01   +1.853298097760105e-01   -2.969928070128934e-01   -3.103625536470302e-01   -2.321472742900199e-02   -1.443212643434981e-01; -1.396869991753240e-01   +1.866058893882744e-02   -2.095979079713644e-01   +5.229875645135353e-02   -2.003275261747665e-01   -2.002900295630961e-01   +3.390743548739424e-01   +2.058347564503805e-01];
L3E_L2E_iAMPA_netcon = [-3.552311106688406e-01   -2.583144511112015e-01   +8.079877006667364e-02   -1.433280373580387e-01   -4.935215631687175e-02   +3.110890292538667e-01   +2.178522998190308e-01   +4.112417421948662e-01   +1.823715922254557e-01   +4.364163144249792e-01   +2.130493930155463e-01   +1.636876762658862e-01; +1.310364927679318e-01   +5.734075209069764e-02   +3.167356152711834e-01   +9.857280528618584e-02   -1.402076949917999e-01   -3.035907721505455e-01   +6.717574474936994e-02   -3.229305603370924e-01   -2.190455703780847e-01   +1.962697293951684e-01   +4.090966994889076e-01   -6.827704331461422e-02; -2.042679810329723e-02   -2.622046948414107e-03   +2.371488879177367e-01   +3.708259468958144e-01   +7.727006364089994e-02   -3.710988401246161e-01   -8.409936793402029e-02   -1.110872848376670e-02   -2.683594713442730e-01   +1.342303185730951e-01   -4.803679988492604e-02   -1.063501851505999e-01; +3.328568903398040e-01   +1.226179190558959e-01   -1.632867281141493e-01   +8.574372960728144e-02   +2.667998936252622e-02   -7.889272516365572e-02   +4.228775582554191e-01   -1.502005209094248e-01   -2.453736551523434e-01   -2.316432808499736e-01   -2.463422978571008e-01   -4.823115451368379e-02; +1.796473919245673e-01   -1.748321910777129e-01   +3.312305577975478e-01   -6.254633975214127e-02   -4.007070872980160e-01   +3.466300727623233e-01   -1.949223853895542e-01   +2.675248585263512e-02   +1.086309691552163e-02   -3.883064549802715e-02   +4.228428560238039e-01   +1.953975921198183e-01; -1.232696702799532e-01   -2.055304597464544e-03   +2.706770854043964e-01   -4.543145273767241e-02   +2.437408936021324e-02   +4.022056643469251e-01   +4.235758028242880e-01   +2.688824784730766e-01   -2.689229972129079e-01   +6.470193435940563e-02   +1.009741514444653e-01   +2.970878363915162e-02; +9.373791598193085e-02   -5.123145250557626e-04   +1.901067687289882e-01   -1.453427962064514e-01   -1.095094559230013e-01   -1.392289319136253e-01   +7.610694980063212e-03   +7.982249643487441e-03   +3.696336741881111e-01   -2.595212079706563e-01   -2.914252912112891e-04   -3.500823491673155e-01; +1.192175461505292e-02   +9.240236353680557e-02   -7.644728832543231e-02   -3.033971407667345e-02   -2.543201583046436e-01   +3.374477312741763e-01   -2.849018990974682e-01   +8.023203856628143e-02   +1.595215031463038e-01   +3.346491301626685e-01   -2.912700558392345e-02   +4.930158380854607e-02];
L3I_L2I_iGABA_netcon = [-8.867922127532522e-02   +3.925831192310962e-01   +1.026663905921872e-01   -2.835885797202486e-01   -1.133303223294087e-01   +3.097583146952793e-01   -1.848883937441312e-01   +1.022674020771267e-01   -3.129677356528529e-02   +3.851640588009405e-01   -2.998850289075609e-02   -1.896711060316214e-01; -5.098780172692711e-01   -2.709758354258974e-01   +1.223818101350684e-01   +1.544681984792136e-01   -1.155557605286282e-01   -2.665775228910183e-02   -1.251990441105630e-01   -2.585836334714583e-01   +4.130130121792089e-01   -3.492004664951946e-01   +2.547346122219625e-02   +1.481918862232585e-01; +3.087936783494242e-01   -4.048005022785124e-01   -3.994005082508079e-01   -1.549839726074301e-01   -4.516046456194497e-01   +2.336532504106163e-02   -2.465559432857165e-01   -1.080895912087175e-01   -8.922619221484171e-02   -1.267387100464397e-01   -3.627387411745529e-01   -3.693114014020522e-01; +5.767720309926632e-01   -1.971225699057551e-01   +2.643890128260301e-03   +1.321299049071611e-02   -8.847501739047942e-02   +2.421265308221698e-01   +8.812758420901382e-02   +2.404618761440568e-01   +7.006763661984264e-02   +7.576784458220531e-02   -6.681695420477710e-02   +3.306046862251675e-01; +2.778037241233255e-01   -1.800683074886252e-01   -1.000101619377395e-01   +2.126525448934803e-01   +2.164593734739089e-01   -6.839112363906973e-02   +5.619454865190759e-02   -2.966780593133442e-01   +2.716915387954402e-01   +1.598714525727852e-01   +9.422586308962630e-02   +3.591339361288752e-01; -1.815296590085113e-01   -4.619612245070970e-02   -6.809824134573297e-02   +2.931202486426938e-02   +5.064911158466259e-01   +4.176485525507804e-02   -3.075916911640848e-01   -5.921875005540607e-01   -4.452690035465812e-02   -8.252633225891559e-02   +2.790215828544994e-01   +2.118449528604484e-01; +1.579452145742735e-01   +7.016776722955277e-02   -3.839645382888423e-02   -4.871101572158528e-01   +3.169586740254232e-01   -3.673163498364119e-01   -8.557299567991586e-02   -1.004588174404705e-01   -2.189944051123014e-01   -4.616658176582041e-01   +1.725709540954498e-02   +3.458328409019001e-02; +4.537673521886982e-01   +7.532796675175031e-02   -2.555084542988681e-01   +4.876924224007711e-02   -1.302175704810817e-01   +6.275005837101896e-02   +5.754010123377215e-03   -2.921518653763071e-01   -1.362519909149545e-01   +1.503956570173521e-01   +1.991446863217812e-01   +3.915711630714558e-02];
L2E_L3E_iAMPA_netcon = [-2.110622803708968e-01   -1.648943068263573e-01   +1.181786760344012e-01   +3.036012874951922e-01   +2.928159401887720e-01   +3.999971050743071e-01   -7.704375610958823e-02   -4.035969362792170e-01; +1.671845433432525e-01   +1.555621062693950e-01   -2.084710156718028e-02   -1.132262596590821e-01   +1.283902996255414e-01   +2.583001117965387e-01   +8.859407912305525e-02   -1.307417129336043e-01; +1.995276938594246e-01   +2.937256634034666e-01   -1.637997632590897e-01   +1.038690240743953e-01   +1.446038706633158e-01   +3.140599637050818e-01   +1.520150469802111e-01   -1.983285333805894e-01; -3.975981959268075e-01   -1.694246557801123e-01   -1.836202747966796e-01   -2.269256746584777e-01   -8.263066202462073e-02   +7.336655558543637e-02   +1.477205543426741e-01   +3.094647512900520e-01; -3.289201522256301e-01   +4.130148198347782e-01   -2.198947194687857e-01   -3.213812817822989e-01   -2.349163087848348e-01   +3.662028181924478e-01   -2.704273431604858e-02   -7.671497009636205e-02; +1.991544301634215e-01   +1.286741097917935e-01   +2.010942093305436e-01   +4.841258568988754e-02   +5.625190438203510e-01   -4.394851357193100e-01   -8.770550441004238e-02   -1.606676454048550e-01; +2.047854867005836e-02   +7.666399915414701e-02   -5.348221822365126e-02   +3.300618016957360e-01   +3.299611182873504e-01   +5.497740769949161e-03   -4.919629546330792e-02   +1.854473325077356e-01; -4.333188360521545e-01   +4.904515228746903e-01   -1.344765858762567e-01   +2.740670485768261e-01   +3.377188014359189e-01   +1.358960630015419e-01   -2.988255176603142e-01   -7.894156961651355e-02; -9.200702769593389e-02   +6.342592569384531e-02   -6.969466142830102e-02   -1.256938314616117e-01   -2.010104381135626e-02   -1.634701644933392e-01   -7.044932404601426e-02   +2.018777895271259e-01; +3.718500709210083e-01   +2.727983845627854e-01   +5.367412479378457e-02   +2.918862793407764e-01   +8.273432147630584e-02   -1.401292929656836e-01   +1.131019284547084e-01   +4.540916289718329e-01; +1.337310375473231e-01   +1.281225700800656e-02   -1.557736545594112e-01   -2.559207953737436e-01   -8.462513482922876e-02   +3.844101531580632e-02   +1.080343437488703e-01   +5.187442960473196e-02; -4.971197001389552e-01   +1.715664715680216e-01   -2.054818659570687e-01   +4.273294643846500e-01   +1.018272332325795e-01   -5.136051409229070e-01   +3.356408525032274e-01   -4.867993334627451e-01];
L2I_L3I_iGABA_netcon = [+1.741692501269181e-01   +5.225139457561145e-04   -1.777191713166404e-01   -7.814131123596557e-02   +2.861656387723263e-01   +1.153193661273684e-01   -2.259707595104168e-01   -7.647874871911105e-02; +2.290980600742358e-01   -1.146106709566241e-01   -4.573903221482116e-01   -4.233037161880464e-01   +3.596588239259210e-02   +4.270962247413251e-01   +1.727078017545128e-01   +7.298805594114505e-02; +6.297816484494742e-02   +1.961187900039156e-01   +2.536890635415087e-02   +4.697030463045156e-01   -2.277304437729096e-01   -4.886000646463880e-02   +1.513498222679231e-01   +4.601708917208590e-02; -3.568334614630751e-01   -5.870939867128981e-02   +2.720684896011449e-02   +1.480237762254062e-01   -4.685208654726589e-01   +4.362955697270946e-01   -1.555586629638729e-01   +1.127197111961674e-01; +1.538048315697094e-01   -1.401225740515429e-01   -3.257492565683333e-01   +2.190214106242035e-01   +4.003258462446600e-01   -9.875481666751255e-02   -1.015932944524850e-01   +7.123003560222177e-04; +4.374252010845466e-01   +1.693508756172578e-01   +4.929553172775562e-02   -1.310719035745983e-01   -4.258140965221202e-04   +4.970178845352953e-01   +3.500171766774660e-01   -3.259218388790378e-01; -2.318329487106399e-01   -1.231695210304964e-01   -5.301729203463272e-01   -2.347338496875357e-01   -8.622965664144670e-02   -1.852929459598501e-01   +1.423648993320980e-01   -3.421801450252649e-01; -4.198112965960498e-01   +7.717293979985895e-02   -2.569925896212607e-01   +1.657200503529464e-01   +1.231618468301282e-02   -5.490197178797269e-02   -6.098374507336357e-03   +3.137156822915736e-01; +6.362261896698640e-03   +4.954264385153568e-01   -2.195294586669681e-01   -9.103200090069413e-02   +1.873313733707034e-01   +4.235020017917248e-01   +2.999797691118479e-01   -3.241471298391916e-01; +1.318002617870361e-01   +4.656751567021821e-01   +6.632200961010914e-04   -4.263847680454841e-02   -3.389744176568871e-03   -1.768481261209845e-01   -3.351159484736764e-01   +1.530265134573476e-01; +2.312796226125368e-01   +1.725804990118915e-01   -3.999941500281522e-01   -7.510930183645514e-03   -2.227943688955916e-01   -1.827403890762733e-02   +2.979256102704946e-01   +2.085334653910559e-01; -3.625329848115142e-01   +4.425557338132310e-02   -8.957271459082246e-02   +1.910839647393515e-01   -4.196575780216573e-01   -1.472208861765341e-01   +3.821475500815774e-03   -1.908876909641343e-01];
L3I_L3E_iAMPA_netcon = [+2.687383356217583e-01   -2.612017737565733e-01   -3.167654751898885e-01   +1.412264391842957e-01   +4.127677436934208e-01   +2.024524516336633e-01   +2.412710588164309e-01   +4.551466877901818e-01   -2.142894380775929e-01   +7.387055078499891e-03   +1.084575769196490e-01   -3.415883161242610e-02; -4.038835784202278e-02   -1.846335694195712e-01   +1.642499704433240e-01   -2.218495581923012e-01   -2.511186000391276e-01   +4.186387565597430e-02   +1.807867192910096e-01   +3.816031964916250e-01   -3.499922169051468e-01   +2.172141408687557e-01   -5.473871045436979e-02   +2.698864737095222e-02; +1.683063104359589e-01   -2.134818833514329e-01   +1.778863531220752e-01   +7.014439776620379e-02   +2.163544334006580e-01   -3.356271692462361e-02   -5.283595796398019e-03   +1.091351989436513e-01   -2.092627294280811e-01   +1.133374735646556e-01   +1.075439486257037e-01   +1.756746811461719e-01; -2.302054069450429e-01   -2.177464774765331e-01   -2.956493076123223e-01   +2.807322930709013e-01   +4.652755062744569e-01   -5.368483009047014e-02   +2.829475073475488e-01   +6.696000411934830e-02   +1.180360400715179e-01   -3.406495132909025e-01   -1.185806878864400e-01   +3.129930546067262e-01; -3.933983624086124e-02   +1.183089135624718e-01   -1.578026845817084e-01   +2.698504818433501e-01   -1.586879199328458e-01   -1.900922439506978e-01   +3.341180354618999e-01   +5.552783215116559e-01   +2.469321917840266e-01   +2.874742434715841e-01   -5.498359879085719e-01   -1.125240620265550e-01; +6.021457633732874e-02   +1.561455592742729e-01   +1.812957723861085e-01   +2.802300470207835e-01   -1.908580787692865e-01   -1.722642112278570e-01   +9.983296192863110e-02   +3.379664282059601e-01   +3.987909576213591e-02   +7.264762486406519e-01   -4.859935238920388e-01   -9.073402826822508e-03; +9.641991851392623e-02   +2.253330153622552e-01   -2.282747825336419e-01   +3.378751311969407e-02   -4.693209392977074e-02   +1.304666232232729e-01   +5.651844986905694e-02   -1.566725012113847e-01   +2.219680674578992e-01   +3.549176643066030e-01   +2.124126096857374e-01   +2.298218013708164e-01; -6.121724014536734e-02   -1.471403048176216e-01   +4.107245219231555e-01   -7.258962425388682e-02   +3.523983513974308e-01   -7.241554623372344e-02   +1.031195076306067e-01   +5.952553915300158e-01   -2.699618579631937e-01   -3.061555946226504e-01   -1.765388095548796e-01   +2.597360484427481e-01; +1.355033936186752e-01   -3.189164833342609e-02   -5.484648154107062e-02   +1.231236063215815e-01   +6.692743977307666e-03   -1.443366168411926e-01   +1.759306682572358e-01   +1.403139842744955e-01   -1.129256759310045e-01   -2.000949280559974e-01   +1.302865424688385e-01   +2.069297704073596e-01; -6.261502515232106e-02   -3.207125920161673e-01   -5.219157246469561e-02   -2.030693044467941e-01   +3.362996618565149e-01   +3.721352085438894e-01   +2.490340341257014e-01   +2.053504461568060e-02   -2.457260266434192e-01   +3.561623057915105e-01   -1.390732168097772e-01   +2.974728875785047e-01; -2.436379647636960e-01   +1.017055630347618e-01   +3.968874225892265e-02   +7.895209153217028e-02   -1.198755507334612e-01   +6.564155417696166e-02   +2.344795804451412e-01   -2.013066950503386e-01   +2.257846744610498e-02   +1.170554695650752e-02   +1.342345392143667e-01   +8.132780249537583e-02; +2.545917859571611e-02   -2.171108186678541e-01   -2.927315879383606e-02   +1.025496382523630e-01   +3.150865560823931e-01   -1.582383931996321e-01   +1.994556737133764e-01   -4.831308051568726e-01   +1.874064909884167e-02   -4.219961529518096e-01   -1.810308753249583e-01   +1.322688588186921e-01];
L3E_L3I_iGABA_netcon = [+2.130249272976914e-01   -1.348074495033334e-01   -3.618367361640196e-02   -8.328399913672518e-02   +3.772021425170508e-01   -2.307439279110968e-01   +4.476573288486696e-01   +8.600719655857690e-02   +5.190772806934618e-01   +4.587845312804757e-01   +3.418567017263178e-01   -2.454654527284158e-01; +1.330444883067396e-01   -5.308574524023284e-01   +3.158041081689298e-02   +2.569742635508761e-01   -2.267838999827336e-01   -2.280814026339651e-01   +6.979870291383689e-02   +2.514736564537994e-01   -2.215211407889418e-02   +3.545952655842789e-01   -1.315627739351215e-02   -1.596355015992975e-01; +3.268177677999863e-01   +1.955756428821362e-02   -2.963783901107738e-01   -1.486913741312119e-01   +2.894089075508811e-01   +2.558398561716220e-01   +2.541436358112958e-02   -2.625431202096412e-01   -2.544051610639665e-01   +5.689030261708697e-01   +1.704226294228675e-01   -3.324785214476482e-01; +7.599720745368771e-02   -1.604424537928098e-01   -2.315483400594279e-02   -5.893272519204651e-02   -1.240518079506744e-01   +8.731319088464967e-02   +3.204159963728712e-01   +5.916220713446735e-02   -2.979827616105910e-01   +3.015279387725069e-01   +8.654488359269205e-02   +2.417999617042754e-01; +2.577228100216492e-01   -2.891227158370130e-01   -5.743623483828939e-02   -2.590226393158144e-01   +1.204492616833242e-01   -2.697610158644769e-01   +4.802174831472937e-02   +3.475848950730887e-01   -8.124193517072650e-02   +5.187130937081895e-02   -3.442876661153247e-01   -4.532732133177991e-02; +5.716021942835936e-02   -1.506661978965670e-01   -7.899836821558448e-02   -2.682499027947800e-01   -2.464947583530830e-01   +8.666650349816518e-02   -1.497986680495559e-01   -4.341276795829186e-01   +2.592962399477339e-01   +2.678932892235080e-02   +4.468273511252295e-02   -3.085658562179743e-01; +2.617912962707354e-01   +4.383941864741336e-02   +1.624785724365964e-01   -9.034972277732092e-02   +1.501031142774048e-01   +1.214460795639383e-02   +7.237277171267029e-03   +6.199975823606206e-02   +1.444229244076933e-01   +3.513594090889399e-01   +4.077437493289053e-01   -7.135039853120599e-02; +3.486672099535590e-02   -3.236528797576688e-03   +2.578454413663948e-01   -1.601557912486210e-01   +3.851749344302580e-01   +7.166552468306378e-02   -6.710289628337973e-02   -5.594654247109887e-02   +8.998250799240909e-02   -2.235199994459387e-01   -3.384439874211073e-01   -2.351317772453584e-01; -3.270414917150641e-01   -1.845410781521772e-01   -4.514860616793445e-01   -1.923743296771666e-01   -1.450352727499287e-01   +3.410532183738033e-02   +2.841535041961145e-01   -8.575202122461870e-02   +6.533027943831567e-02   -3.647964947478584e-01   +3.368850892898197e-01   +1.889915394344653e-01; -3.249726211357271e-01   -1.972572361098806e-01   -1.343369706291571e-01   -1.267314158293148e-02   +6.287815796252752e-02   +8.458348592593880e-02   -1.231899796655300e-01   -1.829805226315414e-01   -1.818949493559036e-01   +2.054293125523003e-01   +3.041196557218446e-01   +1.310424828516179e-01; +5.183905374452085e-01   -3.050269626530193e-01   -3.971497690215978e-02   -1.255757430000501e-01   +2.677530658161855e-01   +2.974807707503424e-01   +2.014346326934483e-01   -1.744739886844707e-01   -1.298829996433454e-01   -2.638842632460482e-01   -4.228730950660520e-02   +3.903543832675269e-01; -3.236433315603286e-02   +3.389158809499951e-02   -3.101866068702749e-01   -3.024426396409715e-01   -1.225558228175089e-01   +1.683631712365917e-01   +1.948989579812453e-01   -2.560773461764938e-01   +3.682467217754771e-01   -1.471340745490244e-01   +3.476921512525063e-01   -2.537201729388852e-01];
L2E_Input1_iAMPA_netcon = [-1.655808354399214e-01   -3.769040362258446e-01   +1.289194609919335e-01   +3.584458270071253e-01   -1.982620674951935e-01   -5.451724615870100e-02   +9.648497082756335e-02   -2.045694941711806e-01];
L2I_Input2_iAMPA_netcon = [+8.160626241221994e-02   +1.066650452077112e-01   -1.031713837352568e-01   -5.228260975215651e-02   +1.336901512605694e-01   +2.687452964479308e-01   -1.047016989644017e-01   +3.085147070789852e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
