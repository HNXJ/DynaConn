function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.608650267798931e-02   +1.852689879766456e-02   +2.805328888238027e-02   +1.894325456452250e-02   -3.871400169228274e-02   +2.525197236104225e-02   -6.628822644066019e-03   +1.253548191910667e-02   +5.858347090266880e-02   +3.554267585161965e-02   +7.195999299929232e-03   +3.559856856182132e-02   +6.564192951869682e-02   -8.300383540965734e-03   -2.169461065397767e-02   -3.655332748518859e-02; +8.966361351519075e-03   -4.146844593509628e-02   +1.877614109739562e-02   +8.622581344713578e-03   +2.362671070922339e-02   +3.689554417438485e-02   -2.124873303416129e-02   +7.758592447438812e-03   +1.463445679491655e-02   -2.860365858249410e-02   +4.353481243010583e-03   -1.811105530786354e-02   -1.157401188223941e-02   -2.062148800411592e-03   +2.874321982457346e-02   +8.037214631978606e-02; +2.838289335944578e-03   -4.097984688801741e-02   -1.723157748611071e-02   +3.543855669676299e-02   +3.212507706676909e-02   -2.524363939111340e-02   +1.159062039836848e-02   +3.379727801272458e-03   -7.217524228944686e-02   +1.982380660393405e-02   +1.940691432797867e-02   -4.809269067720457e-02   +3.595470898473925e-02   +1.559325397602908e-02   +6.862318029806908e-02   +6.251042521818217e-04; +2.685042572353602e-02   -1.135151313426996e-02   -4.003565558726012e-03   +4.341012595005923e-02   +7.045069469573850e-03   -9.753619544457815e-03   -8.255905848978820e-03   -3.720100371243368e-02   +1.231339997026239e-02   -1.645761416345445e-02   -1.031833070375288e-02   +1.906219398300540e-02   -2.209100487206842e-02   +3.169200441964694e-02   +1.864984757200398e-02   +3.594656118654922e-02; +8.456322754318332e-03   -2.366560439104220e-02   -3.993558804277598e-02   -8.768253222380881e-05   -4.853945536525438e-02   +8.379458175998164e-02   +3.748862631730222e-03   +3.072424457319891e-02   +2.283232800170586e-02   +3.901346202961610e-02   +1.271167163882726e-02   -1.801698559191224e-02   -8.948006269020981e-03   +4.607054160005923e-02   +6.919647520603344e-03   -1.833199114257638e-02; -6.978516161604018e-02   -2.153770617697883e-03   +6.114557760907408e-02   +3.081072785822091e-02   +3.304307220255356e-02   +2.662699506353882e-02   +4.844976094047709e-02   -6.547815320977243e-03   -1.008738329577518e-02   -2.566131950628821e-02   +1.325913281638586e-02   +2.181569106479470e-02   +2.362190509224400e-02   -1.022172522536086e-03   -4.284168913434495e-02   -1.054691162939937e-02; -6.117672823746330e-03   +7.201208999310751e-02   +8.640754096759800e-03   -3.369075985134309e-02   +1.238669627516181e-02   -3.285702708705329e-03   -7.407918771154650e-03   +3.819636861395861e-03   -4.640486978565644e-02   -3.103492739333714e-02   +3.026538916110221e-02   +6.280320764999156e-02   -3.645396826586569e-02   +6.874514401798596e-03   -2.992835630763156e-02   +3.648685586036027e-02; +9.224207609036790e-02   -4.183843774223131e-03   +3.588732287103973e-02   -5.786920901785397e-02   -5.862551106624986e-02   +3.731276158667723e-02   +1.799962094259445e-02   +1.967086180872634e-02   -1.016309142567214e-01   -6.501118136730219e-02   +5.272107515191141e-02   -2.502139206583351e-02   +2.431801578350311e-02   +1.180984973596326e-02   +9.525644035638998e-03   -2.670544823877186e-02; -9.217343362808678e-02   -1.129011218616702e-02   +1.688549043116605e-02   -1.448963665439272e-02   -1.544145130119532e-02   +5.084409022899257e-04   +3.410059097752120e-02   +1.068500479851141e-02   -2.864461875860850e-02   +3.245611472460851e-03   +1.037745007046416e-02   -4.799000250289522e-02   +2.940768819783696e-02   -8.584209170006429e-04   -9.706023955724303e-03   -2.515059662963141e-03; +9.848076543034644e-03   +2.487214467009405e-04   +4.253525397778279e-02   -1.352278964553218e-02   +2.502668820871291e-02   +5.790836960217962e-02   +4.147276877151518e-02   -3.759537770418232e-02   +3.164295679710409e-03   -1.508313250964892e-02   +2.639934104355839e-02   +9.146068489918160e-03   +3.170384993271307e-02   +8.037686617512640e-02   -1.888505135378348e-02   -4.038606885188603e-02; +5.812392459985961e-02   -8.235211134831237e-03   -2.235749504509046e-02   +1.334921961170855e-02   +1.468561317279313e-02   +9.427264679517181e-02   -4.369748959774562e-02   -9.894404110934984e-03   +1.722529014183265e-02   -1.147806212241747e-02   +1.809503555821439e-02   +1.172080485763792e-02   -3.436380505109065e-04   -2.244512075850272e-02   -2.552986050555018e-02   +2.311577969958365e-02; -5.379861708982844e-02   -3.010619448412154e-02   -1.819544028205355e-02   +1.107288323550449e-02   -8.225234696426780e-03   -2.204516889739639e-03   +4.460031884198951e-02   +4.019080851273292e-02   -3.216302315393160e-02   +1.889823744448401e-02   +3.455972420327346e-03   -3.262157761005868e-02   +3.555391227497094e-02   +3.605940698807395e-02   +6.219105391000812e-03   -6.134177973242136e-02; +5.259932077901963e-03   -2.291335356380211e-02   +1.887574527094841e-02   +1.249795734386747e-02   -1.808823313446844e-03   +9.308653213265777e-03   -3.161269613959350e-03   -4.398620834407493e-02   +8.698092929684481e-02   -5.495713813755316e-02   -3.335164149822308e-02   -1.603380440395118e-02   +1.906470981426380e-02   +1.148517561238419e-02   +2.139430964349373e-02   -1.139511123034788e-02; +4.587613807307359e-02   +2.458550577491008e-03   +1.133243237650126e-02   -1.643964073404442e-02   +1.146824840748012e-02   +1.038037167429726e-02   +1.873314522699653e-02   -2.570021688470782e-02   -2.118081590138776e-02   +2.903442392555610e-02   +2.942035109882075e-03   -3.137576790464322e-02   +3.946064060903605e-02   -4.014759488059878e-02   +6.822760970794707e-03   -2.976514169045238e-02; +8.074044311344010e-04   +1.765236529632425e-02   +2.320870843290213e-02   -2.071363193797403e-03   +2.883992263660596e-02   -2.924844737072617e-02   -3.905682038270583e-02   +1.606700824493480e-03   +3.578768089486421e-02   +2.696319966543772e-02   +4.780026978940728e-02   +3.587276954073148e-02   -2.968264172350880e-03   +3.485241265722019e-02   +2.651121741942191e-02   +7.223739981477837e-03; -7.306453836069406e-02   -5.990240029696689e-03   -2.496612318062075e-02   -1.122864873579465e-02   -2.332988594329957e-02   -4.194342027691253e-02   -1.845177814588397e-02   -7.296167977336830e-03   +3.628647343998141e-02   +7.185648240650053e-02   -1.655706436915803e-02   +1.655499518381095e-02   -6.216763096818410e-02   -6.536458333463799e-02   -3.594181238353010e-02   -1.083468722044961e-02];
L1E_L1I_iGABA_netcon = [+1.706558064648070e-03   +3.337225761674993e-02   +9.007173675970324e-04   +1.815314833180382e-02   +2.474372443420172e-02   -5.682747065822107e-03   -4.732493883277591e-02   +3.121992061277539e-02   +9.892266300402040e-03   -3.977510898041840e-02   -2.251413139547984e-02   +1.146728650484200e-02   -4.099481514746631e-02   +3.128481690786795e-02   -1.987867549447804e-02   +8.902546823901453e-03; +6.857080687934951e-02   -2.225471790280053e-02   +1.584716506809131e-02   -2.389921882500285e-02   +5.879026405272424e-02   -2.973031517523642e-02   +1.453896785206428e-02   -1.537641312734233e-02   +2.819115076214750e-02   +1.116243692949683e-02   -1.648948667036909e-02   +6.323548129642070e-02   +1.771383268018359e-02   +3.888640354669468e-02   +1.806015853001233e-02   -4.591992065792921e-02; -2.823431660106156e-02   -1.006424342347076e-02   -5.323128283688550e-02   +6.690987032098103e-02   +2.737038533932989e-03   -1.508651074892445e-02   -9.068122265041446e-02   +2.903900885493004e-02   +4.045246767799969e-03   -2.808853981502949e-02   +3.336362142987900e-02   -1.429525175313721e-02   +3.739302285784844e-02   -3.018462648425707e-02   -1.507663791611583e-02   -2.092837996121821e-02; -6.578043150561828e-02   +7.038892813951259e-02   -7.221125922351815e-02   -7.284965780157558e-04   +3.368802179142987e-03   +4.037066797324153e-03   -2.633603826539169e-02   +4.202163627977172e-02   -2.142374305921886e-03   +4.316001233828338e-03   +4.084197435802111e-02   +5.059004599247711e-02   +3.309587117218641e-03   -6.827900687022810e-02   +4.510022130035468e-02   -5.413565215804463e-03; -2.292284548494639e-02   +2.255083870506349e-02   +5.752924526678233e-02   +2.028066566149736e-02   +1.485761731834745e-02   +2.040270413679728e-02   +2.097250857001328e-02   +3.629414079215884e-02   -1.124931078053707e-02   +1.329217528921070e-02   -1.030076956983334e-02   -4.919050144665073e-02   +6.826250212063076e-02   -4.299050142265055e-02   +2.930168860561999e-02   +1.259586933144800e-02; -1.557495400800053e-02   -5.001359873344196e-05   -2.363926772418846e-03   -3.922724074648533e-02   -2.314456492405414e-02   -4.178938244524595e-02   +7.021685352961796e-02   +4.464294234869514e-02   +1.720186541269390e-02   +6.751879583628645e-02   -2.650092434683216e-03   +2.196696129037091e-02   +5.310244436091782e-02   +3.333516108622493e-02   -3.734199858674098e-02   -3.403107900521329e-02; -4.847927348038117e-02   +1.573273400312570e-02   -2.975163129947475e-02   -4.063714519712388e-02   -5.082631102899113e-02   +4.196716005697599e-02   +9.020886310048427e-04   +6.531008914761202e-02   -3.525422443835457e-02   +6.789331818151488e-02   +7.394893533610383e-03   -1.745359315084328e-02   +6.409043885047706e-02   -6.284319796787886e-02   -3.105114183944648e-02   +6.367255105118924e-03; +1.838312928539185e-02   +1.802668317446307e-03   -3.584726950201417e-02   -4.679790672226914e-03   -1.937025091375590e-02   -5.559128656553131e-03   +4.014215169283425e-02   +4.215688773559641e-02   -8.214240061966029e-03   +5.949192844171786e-02   -1.635761497278892e-02   -2.161641414223956e-03   -6.199665695470545e-03   -3.287628372037097e-03   -6.519658655235840e-03   +1.412555181794207e-02; -4.932871323578338e-02   -9.460668408899037e-02   -1.163456650819884e-02   +5.305838936125243e-02   +2.798840330077582e-02   -3.600573954558414e-02   +4.014965812246858e-03   -5.739568360139300e-02   -9.298000223871480e-02   -4.276537821569090e-02   -1.895104455279225e-02   +2.728992281147361e-02   -6.337283983124038e-03   +4.452634460058807e-02   -4.102408235456920e-03   -6.386494539883486e-03; +7.313372689463386e-04   -4.159694701657458e-03   +7.797661139004777e-03   +7.327642211368529e-02   -4.991947812211894e-02   +8.543874313639979e-02   -3.025457762043582e-02   -2.010053214244845e-03   +4.350419232519052e-02   +2.128338958313625e-02   -7.530648246934160e-02   +2.142662461705393e-02   +2.572028609767413e-02   -8.110324133323062e-02   +2.148666407261062e-02   +3.856511657339542e-03; +5.815444753289603e-02   -1.036943561631285e-02   +5.425886990366188e-02   -9.292455739289569e-03   +2.887838363468113e-02   -4.475773716375206e-02   -2.327506005509214e-02   -4.009716614679239e-02   +9.505041097248207e-03   +2.795786167213432e-02   -4.274478378981483e-02   -4.704854740565519e-02   -4.247870992156030e-02   -1.632037704614921e-02   -5.066359601963337e-03   -2.892571037060531e-02; -7.777511858414143e-02   +5.987520379295986e-02   -4.622874747736504e-02   -5.078361975123479e-02   -3.571345763819869e-02   -2.014744373152118e-02   -4.071453991032938e-02   -1.782236290541802e-02   +3.281126810538384e-03   -6.907493067268402e-03   -1.721475737454501e-02   -2.771940476012302e-02   +1.852161803074869e-02   -1.296525479069490e-02   +3.929194704589872e-02   -1.176256967066642e-02; +2.533375741005564e-02   +3.553863798963598e-02   +9.798126477590693e-03   +8.546011983128286e-03   -7.440252054661690e-03   +5.085720449792003e-02   -7.586701695286455e-03   -2.715732628181886e-02   -4.429961938469578e-03   -3.506631421602603e-03   -8.672973910747565e-03   -4.568133774924355e-02   +7.964537287014250e-03   +3.431285052046657e-02   -8.184268919304524e-02   +5.618680033720162e-02; +8.106741258059902e-02   -4.952697426167133e-02   -2.937622500260398e-02   +4.639735283498941e-02   -1.764325060889349e-02   +5.667367206285642e-03   +6.162364691376482e-03   -1.865869963152221e-02   +4.195016719379117e-02   +4.382576168004711e-02   -8.758785314540889e-02   +1.617778472874897e-03   +3.791841813125398e-02   +1.705638949207406e-02   -5.260659197220384e-02   -8.082285452923292e-03; -5.875045607089734e-02   -3.590479001091254e-02   -4.963290102408714e-02   -2.477659858559899e-02   +7.996971739723722e-03   +3.120880850593454e-02   +6.098358493183128e-02   -2.943368515013381e-03   +9.446755628666752e-02   +3.606169839003644e-02   +5.835325676456694e-02   -2.151684588295933e-02   +8.811244853962008e-03   +7.364502789912687e-03   +7.732344486373907e-03   -5.437058147902280e-02; +7.872278637486829e-03   +4.540927539255681e-02   +8.085931316706210e-02   -6.746756757886904e-03   +3.361041006312233e-02   -2.578204015369857e-03   -3.915451046373923e-02   +2.001507989122275e-02   -2.320636826600848e-02   -1.515768949993542e-02   +1.925106912860670e-02   -7.810509651822004e-03   +1.874625031203878e-02   +2.268512667441910e-02   +6.129066945988020e-04   +8.331691522480084e-04];
L2I_L1I_iGABA_netcon = [-1.457685045735655e-02   -2.500953833862097e-02   +1.589633814263209e-02   -2.017622576398031e-02   -7.315182254063077e-02   +8.623216813964475e-03   +3.380230879459042e-02   -2.872759299461167e-02; -8.091995080713944e-03   +1.892677698728216e-02   -1.260673575144573e-02   +4.848540045786587e-02   +3.283529781825695e-02   +3.482615862606434e-02   -1.966592167503852e-02   -1.103748377006749e-02; -6.583463878722509e-02   -4.284403474032111e-02   +1.263009123181605e-02   +2.700774257677731e-02   -8.255045930372695e-03   -1.296115851796146e-02   -6.515003892094594e-02   -3.497994623681757e-02; -3.436010564002771e-02   +3.141653379663403e-02   -6.652218057524534e-02   +7.275577115050036e-02   -6.695153219967871e-03   +2.542041525209066e-02   +4.526757577748606e-02   -1.525656859839854e-02; -1.473096116825825e-02   -1.744779225243548e-02   +1.625458842547604e-02   +1.217152954702290e-02   +2.776690148032074e-02   -5.605679947309316e-02   -1.488765993275520e-02   -3.353747259602672e-03; +3.288882354152870e-02   +9.482053551591681e-02   +2.211517284150667e-02   +4.849847451792327e-02   -2.185634600872563e-03   +7.121040358787578e-03   -3.813404603023656e-02   -1.410015785611574e-02; +1.322814355698757e-02   -1.369125730614758e-02   +6.557752305500641e-02   +1.052867304197640e-02   +5.706664528589873e-02   +2.277541409832411e-02   -5.717218831963154e-04   +3.016882063204334e-02; -1.699732761834615e-02   -5.014092157807203e-02   +4.890644081524016e-03   -6.123103508538828e-02   -2.705286545103020e-02   +3.505452179976103e-02   +6.359789574994204e-03   -2.570185938803525e-02; -1.845531775929370e-02   -6.380981291492621e-02   -2.854833619721529e-03   +3.247191126251473e-02   +1.618024702817586e-02   +3.217052975055563e-02   +8.504728081602270e-02   +2.542090711394294e-02; -2.603361855997716e-02   +8.552161938551453e-03   -1.946048025765673e-02   +1.653353612421416e-03   -5.928289891715553e-02   -1.097461675676325e-03   +1.536072443620915e-02   -4.271218539619499e-02; -6.015447018214419e-02   +4.356608350607175e-02   +4.021541619494619e-02   +7.646514837649745e-03   -7.290333073706363e-05   +2.504778333696382e-03   +2.712242350194945e-02   +9.790710929134114e-03; -1.881588387544614e-02   -2.743448192987036e-02   -3.642169474620243e-02   +3.055926613072642e-02   +4.312961233559189e-02   +6.263447617203204e-02   -7.571533898234533e-03   -2.893004719864033e-02; +6.525521729959667e-02   +2.686878572717328e-02   -3.390969090076212e-02   -3.203034848052928e-03   +6.522043254427708e-02   +7.679333496184841e-02   -3.419033365209164e-02   -3.313364893212907e-02; +2.575133837839414e-02   -1.956090980870996e-02   -6.019164806278548e-02   +3.406826232587808e-02   -3.550951038619452e-02   -4.969310401826164e-02   -7.625674997235182e-04   -3.752889596625518e-03; +2.714237455785906e-02   +1.023692888276452e-02   -4.874706506646524e-02   -4.610832653259905e-03   -5.484721567136539e-02   +7.101321522058762e-02   -2.879484104076422e-02   -7.660420824456794e-05; +2.355148941073166e-02   -2.407741143535341e-03   -3.168396264140458e-02   -7.304621755873779e-03   +3.572398460132708e-02   -5.776805340693509e-02   -2.280979795976379e-02   +1.066531957850578e-02];
L1I_L2I_iGABA_netcon = [-3.015553900387154e-02   -1.519738858726839e-02   -3.357862057559793e-03   -3.168794184863606e-02   -6.837540822968177e-02   +4.120196810718652e-02   -2.083545273391656e-02   +1.154521392400366e-02   +6.198693748813382e-02   +1.792273271278736e-02   +6.596459844186013e-03   +1.843255279125922e-03   -2.583031996267104e-02   -2.205012343107706e-02   -6.328583677836180e-02   -7.673808931304724e-02; -1.306067950867891e-02   +6.914596888511006e-03   +4.058968806910881e-02   +2.142333787678755e-02   -6.470571315635408e-02   -2.433548638145128e-02   -9.966955028919117e-03   +1.369542536932793e-03   +5.404470995432345e-02   -4.278575827658256e-03   +1.969555716125579e-03   -2.923782046265324e-02   +7.281843834602253e-03   +1.636021322646228e-02   -2.041097300063166e-02   -8.038665579435479e-03; -2.492066732643083e-03   +1.866566969294988e-02   -1.394361034666195e-02   -2.778481960312893e-02   -1.582756478888226e-02   +2.798365364751110e-02   +9.883843670932533e-03   -1.206246734735007e-02   +4.136706850372866e-02   +9.647000815042744e-03   +2.810733418396491e-02   -2.451314804975373e-02   -3.382452774587246e-02   +1.754186641914561e-02   -4.393155635655190e-02   +5.561132093619164e-02; -3.044320180624847e-03   +1.720419776327538e-02   +4.510147822102340e-03   +6.541972656613125e-03   -4.176078658634112e-02   -2.765952602666680e-02   -3.410473333982823e-02   -1.932407292146982e-03   -3.302654424302811e-02   -3.510762308249105e-02   +3.965419203810881e-02   +4.292908326970647e-02   +8.507039690724597e-03   +2.400335685068166e-02   +5.090730430457514e-02   +1.384121771130946e-02; -1.043948638772620e-02   +1.242843884366461e-02   +3.246078316907973e-02   -1.310474325279756e-02   +3.348219370876671e-02   +2.949163687566890e-02   +4.959003578941951e-02   -1.384594715397331e-02   +8.964247622399690e-02   +4.966265730158000e-02   +2.341669881787620e-02   +1.687184661846346e-02   -3.590831598430005e-02   +3.876431958959220e-02   +2.634175675590078e-03   -4.099586778424336e-02; +3.384509822302538e-02   +3.120806677153976e-02   -2.823833610288390e-02   +5.408406560816578e-02   -1.183567194273220e-02   +2.479247064507606e-02   +3.418298534882428e-02   -1.129693036355627e-02   +1.455106234958216e-02   -2.219085957357037e-02   +5.056476258373315e-02   +5.951874788462376e-03   +1.426598523265254e-02   +6.041845581286620e-05   -4.672537615895188e-03   -4.896300748317291e-02; +2.156160209455028e-02   +4.064288703483354e-02   +4.797657545419477e-03   -8.107084700553338e-03   +6.375057637472288e-02   +4.414783326600043e-02   +2.408795134374752e-02   +6.884910815486974e-03   -2.124303826070378e-02   -7.070365181715310e-02   +5.078171351290515e-02   -9.308531307452191e-03   +8.599477605002502e-03   +6.952690964901598e-02   +9.701664080415265e-03   +2.169831607922684e-02; +4.438030051195813e-02   -6.057555243919454e-02   -5.594020445660410e-03   +1.686594568332290e-02   -5.116225770980982e-02   -3.195202017843594e-02   -6.447186676024270e-02   -3.924647100793138e-02   +1.185293210890273e-02   +1.809479212466970e-03   +3.674405228646116e-02   +5.256885949950350e-02   -7.022447054436270e-02   -1.007439864954193e-02   -2.072414084808184e-02   -5.709009821044608e-02];
L2E_L1E_iAMPA_netcon = [-6.437026663342509e-02   +3.127357720493246e-02   +2.399283056380904e-02   -1.386614685960944e-02   -3.831077139464865e-02   -1.014888572733880e-02   -8.900003509579497e-03   -3.505999542897162e-02; -1.990519510188579e-05   -5.273468821384986e-02   -5.556661613500441e-03   +6.343304575611675e-02   +6.566278619985758e-02   -2.541597118357509e-02   -2.812609161320895e-02   -2.696078002142380e-02; +3.466297133835110e-02   -7.379647331585638e-02   -7.822341379915006e-02   -4.856573044287609e-02   +2.131236854023152e-02   +4.085519436024557e-02   +2.922674334217880e-02   -1.525588683979041e-02; -2.928002680722689e-03   -8.930104356930865e-03   +2.857118678984556e-02   -3.313457116666944e-03   +1.824238444687661e-03   -2.060170910700721e-02   +2.654137674610634e-02   +4.356309584873218e-02; +2.244019002136258e-02   -2.871135255723916e-02   -1.972093731369487e-02   +1.505401132376122e-02   +5.697727226842511e-03   -6.920506606681599e-03   +2.335957650334754e-02   +2.474503583203549e-02; +4.672269828580307e-02   -1.896877735623897e-02   -3.350496078793863e-02   +5.101475857442848e-02   -4.258158271242116e-02   +5.794388177332284e-03   +1.753042760529646e-04   +6.475109711258921e-03; -5.435809231761018e-02   -8.937730429265186e-03   -6.983438620290132e-03   -2.255236753947551e-02   -1.359621374661003e-02   +2.696104902099657e-02   +1.701780724342336e-02   -2.474576880174584e-02; +4.591665413628455e-02   +1.399203191206739e-02   -4.621856278794016e-03   +4.540248470363405e-02   -1.492621899434076e-02   +2.770731190150659e-04   -5.010078207882233e-02   +5.436700931914058e-02; +2.125035945584288e-02   -3.083236022998708e-03   -4.789834134266990e-02   +6.582917066195706e-02   -4.194434757129997e-02   +1.399713429948326e-02   +1.824013176951033e-02   -5.802464872977155e-02; +6.830311872107078e-02   -2.130418635173698e-02   +6.023541961423276e-02   -4.051737538122144e-02   -2.227608964021097e-02   +2.924583167405491e-02   -4.629719432199365e-02   +2.387673029726037e-03; -4.391766098528711e-02   -3.609101775986327e-02   +3.914963195487241e-02   -2.569052178743611e-02   +8.605194913116578e-02   +5.208394645168572e-03   +3.666905914319058e-02   -2.310475150996862e-02; -3.708628064986982e-02   -7.561157464189791e-03   -6.133358040052495e-03   -5.081045455262240e-02   +2.417276889879375e-02   -2.334019141495964e-02   -3.177915746140622e-02   -1.125103113457975e-02; +2.422182994014511e-02   -6.070961078844642e-02   -1.741865337011174e-03   -2.342659945131978e-02   -3.712825309147680e-02   +4.181404221002447e-03   -6.547744890881702e-02   -7.323121604876866e-02; +1.645566981101388e-02   +1.051208442225973e-02   -1.211864145468379e-02   -1.514460182267625e-02   -5.146826479202074e-02   +3.548016147069173e-02   +1.677400116604975e-02   +5.683549094834409e-02; -6.081102813145039e-02   -2.587475005337193e-02   +3.596863881798164e-02   -2.272748660731563e-02   +2.432729331445712e-03   -2.302733072909067e-02   +2.386578557543621e-02   +2.603595519736598e-02; -3.196202224687542e-02   -9.439261516649346e-03   +5.624741285470931e-03   -5.130461485709541e-02   +3.432869230575391e-02   +3.083297080108868e-02   -4.837383353427027e-02   -4.324688846873404e-03];
L1E_L2E_iAMPA_netcon = [-1.032052816536185e-03   -1.148457726604991e-02   +2.158030073576810e-02   -7.077110877929561e-02   -3.157576942339439e-02   -3.453634957278683e-02   +6.433884945147321e-03   +1.412688679444840e-02   -5.736824970402446e-02   +3.003449714135179e-03   +3.586521314301866e-02   -9.696686647583127e-03   +1.203788153920291e-02   -2.297594311771420e-02   +3.312742725357704e-02   -1.311718641071377e-02; +2.571214918780369e-02   +4.068712281823511e-03   -4.615864337413656e-02   +3.362545656879579e-02   +3.113599682472345e-02   +1.002928656686566e-02   +5.855796003435573e-04   -2.970985063125060e-02   -5.825509162273777e-03   +3.934753385531773e-02   -3.636388186723293e-02   -3.784618614104045e-02   +4.076850593927944e-02   +1.302376594874323e-02   -6.087682590305478e-02   -2.081843945207555e-02; -8.482076255758083e-04   -2.593058629804719e-02   +4.514465447533680e-02   +7.794439348808423e-04   +3.939688097366473e-04   +1.402643024119541e-02   -2.872814012714113e-03   -3.435864748563897e-03   -1.771502553478027e-02   -4.132528716171912e-03   +1.159108598630909e-02   -4.080063692066938e-02   -1.599447931171886e-05   +1.951822506709735e-03   -2.768452026978229e-02   +1.587528232231063e-02; -1.894623912256176e-02   -2.488357716000051e-02   -3.047428758230397e-02   +3.134340863654188e-02   -8.810342644959867e-03   -7.762942493344821e-02   +4.428197625447124e-03   +3.409916086489707e-02   -6.356184155751614e-02   -4.619733487773139e-02   -1.972321019176438e-02   -1.233902231946108e-02   +2.551827337135432e-02   +4.283853164481528e-02   -1.323256862991305e-02   +2.796301388494212e-02; +1.728650280940183e-02   -2.161637647610730e-03   -4.833033053146280e-02   +2.453593050394864e-02   +2.893617411059726e-02   +4.415802314866626e-02   +4.928146357952280e-03   -2.666077576565102e-02   -2.697076610080414e-02   -3.443420286707152e-02   +1.438256314257381e-03   +1.797790050265850e-02   +2.465559458402447e-02   +3.029648569056146e-02   +5.105730638443068e-02   -1.825014967674941e-02; -2.588963464137010e-02   -1.300208574564746e-02   +1.085262197522527e-03   +1.815441571169696e-02   +1.319637341844866e-02   +3.965024501647453e-03   +4.823972773633653e-03   +2.944034169855729e-03   -6.219794089487637e-02   -2.752406302921848e-02   -8.286841973656606e-03   +5.805759469214396e-02   -2.118373987441600e-02   +9.452387366274750e-03   +2.433777435909522e-02   -9.699657883596689e-04; -2.881199090811360e-02   +7.213571526830481e-02   +3.621779186458086e-02   +6.165279738414926e-03   -4.788480675586874e-02   +1.008652274329341e-02   -1.621558987197460e-02   +1.865991483629231e-02   -2.210121666350130e-02   -3.164752850780481e-02   +2.865137749014740e-02   +4.183672728036727e-02   -1.883443653419060e-04   +7.401356403598855e-02   -9.416067873363619e-03   -3.102489478190618e-02; +2.316478981855793e-02   +3.140002917380118e-02   +7.775907008742225e-03   +1.315500439121599e-02   +4.647000059228380e-02   +7.630181320382230e-02   +2.136879960806659e-02   -2.528653437728172e-02   +1.834109529828797e-02   +4.594077121618775e-02   +3.121914059862880e-02   -1.327361851983920e-02   +9.898132932920024e-02   +1.367127440744790e-02   -2.407204721771973e-02   +4.174165887547147e-02];
L2I_L2E_iAMPA_netcon = [+3.138862399954688e-02   -3.344559770595242e-02   +7.747781136604651e-03   +4.315404013115837e-03   +8.082059905775871e-02   -3.750495803964012e-02   -5.488610140463528e-03   -8.478936552679815e-02; -1.870261060849791e-02   +1.573033182399129e-02   -2.661844144345781e-02   +6.801958434177566e-02   -1.830841162242199e-02   -1.170122580864436e-02   -4.407510897872285e-02   +6.695918616774472e-03; -1.406175572939078e-02   +3.512073849698835e-03   +3.615135666434595e-02   +4.867154982113366e-02   -5.844591361683644e-02   +4.877953689697928e-02   +5.406052127697676e-02   -2.260429782975335e-03; +5.045713199624436e-02   +1.109320174106372e-03   -5.720368724908623e-03   +1.569592539988965e-02   -3.475257679073128e-03   +1.121904630210156e-02   -1.504908886056745e-02   -1.290669728035690e-02; +5.272452101365915e-02   +3.189015843070046e-02   +2.148847015809559e-02   +2.577356500346221e-02   -3.166332756362435e-02   -1.623454515854261e-02   +5.022329566726133e-02   +6.802698367124597e-02; -8.920650862452681e-03   +2.303559303832764e-02   -1.900953048500170e-03   +4.675146907222170e-02   +5.493266449969913e-02   -5.654385156028895e-02   -6.118691691676247e-02   -3.312413370174897e-02; +3.462201874051533e-02   -1.413250137224676e-02   +5.207036351048454e-02   -1.506522032101415e-02   -3.903544144389320e-02   -1.565810681303825e-02   -2.899196465946108e-03   +8.522627152341434e-03; -2.067477448066838e-02   -2.295848141867830e-02   +1.054926405933133e-02   +3.456828873462790e-02   +8.130626556413771e-02   -2.163308759459556e-03   -3.538909749759826e-02   +4.998286577102553e-03];
L2E_L2I_iGABA_netcon = [+6.053952175189677e-02   -4.966452492688298e-03   +2.688013259213850e-02   -3.348456711361823e-02   -3.928079996183003e-03   +4.540756312190338e-03   +4.624224882975299e-03   +3.329841386588591e-02; +3.022567091055686e-02   -5.842505809287283e-03   +7.164423732088098e-03   -4.446921240312322e-02   -5.703311879128265e-02   -3.584665195815661e-02   -7.611362316236475e-02   -3.942098146525119e-02; -3.010150049737529e-02   +1.364391476116542e-02   -3.608391712971056e-02   +6.094779091851957e-02   +5.446073081990648e-05   -2.064319712100995e-02   +8.426466766015888e-03   -2.414264232336746e-02; -2.156083774644151e-02   -2.040802567530517e-02   +8.445529554769070e-02   -6.955122815426017e-02   +4.214411075850866e-02   -1.394199097226605e-02   +9.565786365986106e-03   -1.652177089558045e-02; -2.991540296822288e-02   -2.380045454341616e-02   -3.083286120005070e-02   -1.916046895812578e-02   -2.239106115092068e-03   -5.579381024913940e-02   -3.803698452434101e-02   -4.194226371020401e-02; -4.792797269614358e-02   +9.285441415880334e-03   -4.568312793346101e-03   +2.147672884322240e-02   -9.518600964641879e-03   +1.203003764447064e-04   +5.265563768086301e-02   +6.347271161508486e-02; -1.436073773497740e-02   -2.447491819571869e-02   +1.609265996791738e-02   +4.781512426063273e-02   +2.704173179535124e-02   +7.478497269631017e-03   +5.519179083469755e-02   +2.082785784403646e-02; +4.029887141733071e-02   -1.398342708943850e-02   -5.163651518296290e-02   -4.440632914290331e-02   +3.312679008864162e-03   +7.242933543817279e-02   -5.860493718449779e-02   +2.224756011262814e-02];
L3E_L2E_iAMPA_netcon = [+2.100269604912748e-02   +4.504715787822326e-02   +2.748382679681729e-02   +1.237071621869034e-02   +4.193983536641303e-03   -4.527792505047331e-03   -1.689748815088639e-02   -2.024868009787265e-02   -1.000983409020462e-02   +7.957345670854835e-02   -2.065029651099733e-02   -5.244698265449092e-02; -2.465492569367034e-02   -2.455625460516869e-02   +1.739913537991797e-02   +3.286810100041832e-02   +2.881533931292576e-02   +1.682374733746819e-03   -1.582848887449345e-02   -2.715150318451756e-02   +3.047519456505411e-02   +5.713439893135622e-02   +1.850012681692957e-02   +6.775506342272439e-02; -4.998082272300290e-02   -4.577667762352417e-02   -7.957169166988343e-02   -5.016394578298661e-02   -4.944123828312152e-02   +4.146724940189834e-02   +2.250148066347794e-02   -4.805116515894098e-02   +1.433305928842669e-02   +1.036370848398922e-02   +4.627704798509330e-03   -2.580172478511737e-02; -2.644815596864538e-02   -9.709992952690954e-04   +4.858227737611943e-04   +5.796455774130561e-02   -7.113875651961417e-02   +5.281300380569711e-04   +3.337229389560317e-02   +4.183540595753132e-02   +6.112377638216918e-02   +3.641577813275518e-02   +1.748062164299143e-02   -1.253092303899144e-02; +2.177678045050057e-02   +3.031281442168913e-02   -1.755914624058810e-02   -4.461729400549361e-02   +2.153018695552135e-02   -2.619812358570142e-02   +6.848892556794900e-02   -8.358970249427073e-03   +3.449135720200616e-02   +1.019962615127712e-02   -5.393351876477662e-02   -6.196776504260699e-02; -1.519602079044890e-02   +5.898902911998741e-02   -1.438532441226330e-02   +3.709824775383714e-02   +6.128045666806466e-03   +7.069793969061497e-03   -1.394315139052578e-02   +4.574360362053767e-02   +7.055094848738221e-03   +3.523278192597995e-02   +1.583319423111236e-02   -3.384271399709678e-02; -2.435532696685870e-02   -8.366611792053159e-03   -4.990944312831311e-02   -2.337775121677502e-02   +9.907473423596588e-03   +4.256160343638783e-02   +1.012199502814871e-02   -5.293823356270194e-02   +5.213786347065033e-02   -1.843707694696205e-02   +6.077385481601797e-03   +4.292478386334255e-02; -3.146651232108849e-02   +1.037235393690587e-02   -5.338734835682971e-02   +2.444610698305563e-02   +1.081218549164477e-02   +9.281796701657002e-04   +6.659697981824451e-03   +2.951813268185900e-02   +2.947423043696579e-02   +1.326708614073207e-02   +3.388775220850128e-02   -5.014164135629787e-02];
L3I_L2I_iGABA_netcon = [+1.228552483307751e-02   -4.040477659356589e-03   +5.641599190830644e-02   +9.034254402346578e-03   -4.068142818933830e-02   +4.802285577714952e-03   -6.876839108392382e-03   -5.791023507477535e-03   -4.086787353027097e-02   -2.981208271244407e-02   -3.816852963937620e-02   +4.443568047709391e-03; -3.753044169979040e-02   +6.830590402377143e-02   +2.047665995822656e-02   -2.261717413221318e-02   -2.284586443962763e-02   -9.643085275123826e-03   -2.588334364027269e-02   -3.596243049066068e-02   -2.007022317393763e-02   +3.205439605043461e-02   +2.029224588484252e-02   -1.425762501008541e-02; +2.733692055429566e-02   -8.633872354297319e-02   +5.617728870845293e-02   +8.697089980396913e-03   -3.847553725411770e-02   +2.151211542156628e-02   +1.669622697086871e-02   -5.907142537989178e-03   +7.449971826505349e-03   -2.846685824286315e-02   +2.945855714562894e-02   -3.965740619779427e-02; +2.894639547097582e-02   +1.977659131252797e-02   +2.493050511621030e-02   -4.379559553234492e-02   +2.714493411809802e-02   +6.224197867035854e-03   +3.254755877003757e-02   +4.518351729200963e-02   -1.077990826662060e-02   -9.623274075477282e-03   -3.209732434257772e-03   -3.290776022158245e-03; +2.827190355882712e-02   +3.677459727119646e-02   +2.980438271788309e-02   +2.518509614358286e-02   -4.011906125737194e-03   +1.922672164850141e-02   +2.619135689366505e-02   -1.899759200611712e-02   -1.387122491191339e-02   -2.426900335755787e-02   +4.012496197803406e-02   -9.513409221606404e-03; +3.669280935581195e-03   +2.036713418325101e-02   -3.775153988656180e-02   +1.455850494587595e-02   +7.764314605519311e-02   +3.120191095561981e-02   -5.461591400501016e-03   -4.021734735737121e-02   -4.311611194311402e-02   -1.869673693306631e-03   -5.305626861443801e-02   -4.419912534304244e-02; -1.163000425150069e-04   -4.373047081257480e-03   -4.235996463529724e-02   +1.261565920694630e-02   -1.241291299514186e-02   +1.347680629355459e-02   -2.364965411191040e-02   -4.044474461939822e-03   -5.683032032285249e-02   -3.536587785733122e-02   +3.195608416434187e-02   +1.974489541204701e-02; -3.527027538552188e-02   +1.818055309452068e-02   -1.718564465731862e-02   +1.441277055017098e-03   -7.098285927046898e-02   -3.514874623436418e-02   +4.252385895297570e-02   -1.305348464184336e-02   -3.195235673723466e-02   +2.290485349567694e-02   +2.988386838059354e-02   -4.293267248334080e-03];
L2E_L3E_iAMPA_netcon = [-2.132234956230463e-02   -4.704502134730779e-02   -5.143161510532242e-02   -6.668999234297314e-02   -1.562499219448461e-02   -5.874423653210716e-02   -3.807309442384818e-03   -7.060892521362869e-02; -1.726351244163248e-02   +1.048092884666935e-03   +6.133216132596477e-02   +7.726469112678522e-03   -7.576918515141304e-03   -6.246789911974002e-04   -6.206375600880495e-02   +7.486308190053868e-02; -2.620879319724911e-02   +3.935922138144565e-02   +2.415195244961277e-02   -1.710879858679897e-03   -2.490588259102655e-02   -1.157313553590585e-02   -6.641547399303928e-03   +3.830501477331880e-02; +3.880545724337979e-02   +3.224951670550928e-02   -7.944618350864695e-03   +1.142373473904989e-02   +6.687670914631104e-02   -2.918291979849554e-02   +2.173142518157396e-02   +1.209324595634650e-02; -3.404550613460180e-02   +2.381199606663601e-02   -2.667558891010453e-02   -4.903497777690578e-02   -3.941934946668937e-02   +4.889828773517785e-02   +2.678583948932916e-02   +2.179436496877737e-02; +2.236318937468819e-02   -4.960598136522466e-02   +1.511064938504149e-02   +3.584429939234789e-02   +1.722196224369980e-02   -3.945073910694169e-02   +9.428287554676004e-03   +3.521128076258608e-02; -5.396261559153894e-03   +2.196013044761113e-03   -1.982305810700939e-02   +2.674817004480678e-02   -6.835855638604862e-03   +4.626772376822495e-02   -5.756822405337204e-02   +2.262997513513452e-02; +5.143733113076626e-02   +1.737825498460558e-03   -1.966284446624778e-02   +4.081742295647760e-02   +5.840880577589400e-02   -4.179516612426975e-03   -2.761325253780789e-02   -3.324638255638537e-02; +2.695762006525551e-02   -1.057094042792672e-02   +1.872830871176991e-02   -2.279796803416925e-02   +3.538105432029306e-02   +4.610954875677929e-02   -1.539777805323669e-02   -2.526949441772227e-02; +1.264812312834074e-02   -8.475720937654525e-02   +8.576913258792163e-03   +1.936062986825592e-02   -2.190957404078184e-02   +2.194273835787088e-02   +8.884814072462107e-05   +6.888996192904090e-02; +1.561073867179465e-02   +1.542129624344171e-02   -2.189610379731297e-02   -3.775553333909674e-02   +2.816213083844119e-02   -1.297603520638104e-02   -6.603746789963577e-02   -3.252626325636572e-02; +5.628766329237696e-03   +8.166484426573305e-02   -4.786114357980496e-02   +1.446813803003431e-03   -6.714178350060431e-03   -4.193710515548067e-02   -3.692407054279233e-03   -1.057262839600815e-02];
L2I_L3I_iGABA_netcon = [-3.772937674565646e-02   +3.022044327956945e-02   -1.078784281010464e-04   +7.812072509970200e-03   -3.276147023001688e-02   +4.652562246335261e-02   +1.324536908970698e-02   -2.042327828731366e-02; -2.682329685284788e-02   -2.502157172946072e-03   +2.827874673884037e-02   -1.566297539572172e-02   -6.030262527876856e-02   +1.755760816571495e-02   -2.967188612938265e-03   -6.337784390862873e-02; +2.015527816707603e-02   +1.705049197289641e-02   -6.573829742806506e-02   +3.859808040418416e-02   +1.534673494196238e-02   +2.457784168672520e-02   +5.606640808697533e-02   +3.057688270685503e-02; -2.952321402977124e-02   -8.646633136841365e-03   -5.407602497970463e-05   +2.293244928250937e-02   +4.499769475368723e-03   +1.163663997136013e-02   +3.689130640180533e-02   -2.420424259474865e-02; +3.022054083527753e-02   +2.782811824916584e-02   -7.956406905394615e-02   +1.895135543100641e-02   +4.306096516666658e-02   +7.180707300357752e-03   -1.771024031896753e-03   +3.716661491831629e-03; +3.653017539543896e-02   +2.678292537881297e-02   -3.892003481856846e-02   -3.822808049892178e-02   +1.933735109254673e-02   +6.571908344772152e-02   +7.606531777506058e-02   +3.324837174572209e-02; -3.801278767155429e-02   -2.912207517655355e-03   -3.177525518215757e-02   +4.693971113352988e-02   -3.381179621469112e-03   +4.700802122214915e-03   -2.253307955463493e-02   -2.751558745372579e-02; +1.260273402089573e-02   -9.258270127721686e-03   -9.164192888451718e-03   -2.730367535018335e-02   +4.958545169670762e-02   +8.367836788215538e-03   -2.608012580510166e-03   -1.250597119789209e-02; +7.696045037779486e-03   +1.085013755342522e-01   -1.667254424949721e-02   +8.444023053389085e-02   +3.277525603956311e-03   +2.829002462579709e-02   -2.255787817084220e-02   -5.070278980618429e-03; +7.327009703652584e-02   -5.148516347883698e-03   +2.252164743331721e-02   +6.050903999345377e-03   +1.537855094473221e-02   -3.890487523969813e-02   -9.287228587862878e-03   -1.661932259844788e-02; -1.780894827554413e-02   +1.460247150504487e-03   +3.732626158355253e-02   +2.379609107469366e-03   +3.954807939618236e-02   +8.483509039514948e-02   -2.923266380719729e-02   -9.099132371491545e-03; -3.668847282799449e-02   +1.477633764974550e-03   +3.157699305597193e-02   +1.017210841797722e-01   -6.661366987741456e-04   -9.207108259430894e-03   -4.044329568642202e-02   +1.569519649965579e-02];
L3I_L3E_iAMPA_netcon = [-2.905635183971817e-03   +5.261627451119688e-05   +5.427201765980907e-02   +2.738205387735398e-02   +3.371807080667093e-02   +2.062744636239570e-02   -4.829390187533382e-02   +4.777480234452396e-02   +3.555524924277092e-02   -5.416597548621388e-02   +8.791732646868420e-03   -2.349338904879966e-02; -2.036610254050814e-02   -1.603325741141791e-02   +2.692387983069501e-03   +8.749039840124505e-03   +1.150995480244924e-02   -2.132805956270457e-02   +2.222444838960172e-02   -8.364662520354022e-03   -3.941286278119383e-02   +3.144692161005419e-02   -2.746698799346111e-02   +3.069451022741304e-02; -1.900307815462854e-02   +3.786031154652909e-02   -2.886317482918642e-02   +9.289662213562418e-03   -5.969802731987836e-02   -1.989898442528871e-02   -2.916358949388772e-02   +1.647461883532933e-02   -4.084463895741307e-02   +4.619312935530168e-02   -3.307089906609617e-02   -4.797334833808219e-03; +1.560265335482090e-02   +2.450449764407408e-03   +4.686724890430833e-02   -6.892709018123369e-03   -3.059815376189868e-02   -7.182778179017841e-03   -1.262005724843672e-02   -2.186602656708210e-02   -3.379474167683250e-03   -3.312151278703299e-02   -2.257446727739951e-02   +1.616247161874961e-02; +9.463607315640609e-04   -2.451434069899637e-02   -4.653933667346007e-02   -3.565276274419070e-03   -2.130568604181970e-02   -1.001016999529128e-02   +2.531551373251479e-02   -5.239701797979567e-03   -8.554772678913045e-02   -6.551779072266327e-02   +1.656130721450392e-03   +1.913494956541439e-02; -5.062059269875206e-02   -2.495410314002662e-02   +8.336890824244532e-02   +1.370308260795954e-02   -9.476711588690848e-03   +7.425998439281106e-02   +1.598333942391522e-02   +3.441869500175260e-02   -1.560093802245682e-02   +4.391687041721794e-02   +1.217648159399078e-02   +1.738069339867692e-02; +9.536508100450569e-02   -3.105438597628875e-02   -8.231412135063213e-03   +4.608499656376981e-03   +3.636553056762585e-02   -2.580705442388794e-02   +1.038983741479187e-02   +7.402227651100476e-02   +3.613281400690457e-02   -5.872467323316090e-02   -1.268620835795127e-02   -1.615235709154729e-02; +3.673389085680077e-02   +2.316112793870367e-02   +1.659495210754112e-02   -4.803716713712090e-03   -1.985482402265856e-03   +2.748444708169345e-02   -7.450407389796213e-03   +6.298659636318205e-03   -5.202951878745945e-03   +1.147355846444927e-02   +4.210467746246763e-02   -1.928248162843234e-02; +5.977907123338593e-02   -2.558825420312608e-02   +2.764564137419241e-02   +1.473067106692654e-03   +1.201533299646770e-03   +9.517967826406040e-03   -5.070097840361402e-02   +4.164725446711552e-02   -3.307462167267716e-02   +5.079776595740625e-02   -7.081870774694274e-02   -6.076175246246335e-02; +2.181473007138175e-02   +1.323818076825073e-02   +2.489633300162663e-02   +2.506686243712599e-02   +1.479993354203874e-02   -6.294697147207172e-02   -7.324753538983600e-02   -1.943411565512034e-02   +3.690665853033238e-02   +3.263099398006090e-02   +2.227720842734553e-02   +2.816934371299229e-02; -1.153977568545075e-03   +5.096720134411559e-02   -3.718608997595464e-02   -1.704431502940468e-02   -7.570201757986925e-03   -7.342376995996213e-03   -6.052816509837727e-03   +2.978715534046355e-02   +4.904146100222744e-03   -4.351531274860159e-02   +3.307240698741627e-02   +2.566123006201463e-02; +4.296122820554351e-02   -3.653469992998667e-03   +4.840385239274329e-02   +6.589095643203770e-02   +6.007900903760208e-02   -2.210756439548298e-02   -3.290897543763422e-03   -4.658998431645672e-02   -1.071562373846364e-02   +5.846323881426693e-02   +1.005688669860542e-02   -3.475444897246037e-03];
L3E_L3I_iGABA_netcon = [+8.184767760472755e-03   +6.083163861615243e-02   -4.383740995793527e-02   +2.521935059855065e-02   +1.461067303140030e-02   -4.970511968684424e-02   +4.427713551513281e-03   -2.447270535021195e-02   -1.785585218222934e-02   -8.457529296086381e-03   +7.325896776447169e-03   +2.288366766339993e-02; +1.724176433226595e-02   -1.132454192093461e-02   -9.560988682224948e-03   +4.047839451954011e-02   +9.522914964514231e-03   -9.437817427627627e-02   +6.139425001910720e-03   -4.071813908947107e-02   -4.897884443321111e-02   +2.249646717233790e-02   +6.312149020425231e-02   +1.452044241450185e-02; -1.442799914578595e-02   +6.211284555555805e-03   +8.563892465054486e-03   +7.904133118627362e-03   -1.245539527403774e-02   -5.646366244667425e-03   +4.649879405291323e-02   +1.356853959603289e-03   +4.738351035982445e-02   +1.598344386502044e-02   -8.962184322567970e-03   -3.197181753994317e-02; +6.160065518697862e-02   -9.791094221990912e-03   -2.358653400605423e-02   +2.962631603216807e-02   +5.019129552212334e-02   +2.690675955338406e-02   +3.650319482941142e-02   +6.499215299067795e-02   +4.800565488838848e-02   +5.581003523308412e-02   -7.889891952920976e-02   +3.079743244875695e-03; +3.057340576134764e-02   -1.003763036413200e-01   +5.750122428167648e-02   +6.498533698726196e-02   +3.406040359111728e-03   +1.826054623130962e-02   -2.398600941690022e-02   -1.327774389967452e-02   -3.195540693691539e-03   -4.387902629621299e-02   +4.514206773613404e-02   +4.734826500544768e-02; +1.808657702986668e-02   +1.907535395319226e-03   +2.085114859229929e-02   -7.925419377711618e-02   +2.365835176422951e-02   -5.441419574793516e-02   -1.078205317186438e-02   -4.408542342219673e-02   +3.162532334175110e-02   +6.635500124704373e-03   -2.613673494912261e-02   -2.255979214783067e-02; -1.454399440272392e-02   -5.443479100284263e-03   +6.983465062077401e-02   +3.241513987117471e-03   +1.997105699872067e-02   +5.723931148722101e-02   +1.917178716167942e-02   +4.214230532702786e-04   -2.447648196171150e-02   +8.096280367789316e-02   -8.893803998271345e-03   -2.107404673731577e-02; -5.325740872931932e-03   +4.007423395072102e-02   +1.174695213933784e-05   -3.062671949998172e-02   -2.889992379682957e-02   +9.541313302767227e-03   -2.178409552935671e-02   -4.447721484295176e-03   -3.522875235323598e-02   +3.362259614311190e-02   -4.530247900103309e-02   -2.199511638222655e-02; -2.891596037204407e-02   +3.114219370275119e-02   -1.747620171490409e-02   -1.232704124467483e-02   -3.137035974397421e-02   -2.079726296879241e-02   -3.174095816882878e-02   -2.386233256754431e-02   +6.587774649050793e-02   +3.653162548130983e-02   +2.881990040081474e-04   -5.823052578331772e-02; +6.544650410783709e-02   -4.723643927315577e-02   -1.981753210046610e-02   +8.049824458890159e-04   +1.825701868436065e-02   -1.012104694432542e-02   +2.708875489371624e-02   +2.821385062251404e-02   -3.050510549060955e-02   +4.038306949896656e-04   -5.424824068141819e-02   -6.281938391359734e-02; -2.556607614232938e-02   +7.285966528586374e-02   -3.253474197561138e-02   +5.287847102326479e-03   -4.746076503401303e-02   +3.957237981301008e-02   +7.769133122701158e-03   +3.249087974936972e-02   -3.025300996538170e-02   -3.695840818292505e-02   -3.224109525996228e-02   +2.238217420569634e-02; -3.921729328200028e-02   -1.635353046568747e-02   -3.811453801274116e-04   +2.955555094600276e-02   +2.363213505108883e-02   +3.094999481298086e-03   +3.180026444574237e-02   +6.702337737318303e-03   -1.702561610004336e-02   +6.924131766335712e-02   -4.530404873118814e-03   -4.305019275747556e-02];
L2E_Input1_iAMPA_netcon = [+2.776863387068321e-02   -8.157450478732311e-05   +5.088252890286121e-02   -3.429539812919431e-02   -7.062188624975743e-03   -3.687583056901949e-02   -1.810167681959283e-02   +4.376280091051564e-02];
L2I_Input2_iAMPA_netcon = [+2.390288113244338e-03   -7.170354715809952e-03   +1.038290061390908e-02   -2.856763711940963e-02   +7.119254520472842e-02   +2.697909239735713e-02   +3.998958517646793e-02   -6.137659276618783e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
