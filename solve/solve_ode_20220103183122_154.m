function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.135389580779240e-01   +9.494566169451284e-01   +7.026723713039654e-01   +1.646192703202641e-01   +9.205380860336521e-01   +2.127736772590622e-01   +7.406676691244355e-01   +3.038803605701423e-01   +5.365738362519256e-01   +8.371163207724467e-01   +9.719107101759978e-01   +9.716978531523836e-01   +6.975168500237590e-01   +3.684701669111459e-01   +2.964161798607660e-01   +3.834301581609250e-01; +3.514255974377858e-01   +8.695410508878150e-03   +1.403570847049753e-01   +1.682428143080496e-01   +7.779570445709112e-02   +8.107695830482092e-01   +7.992215365360942e-01   +7.535386751360044e-01   +7.937861737054371e-01   +1.904685743686937e-01   +4.759632248869133e-01   +6.626412991886054e-01   +3.656573831487135e-01   +2.744768411284152e-01   +6.885159459902828e-01   +9.590819932369128e-01; +2.015041357320321e-01   +4.782354651882664e-01   +8.257093029486114e-02   +7.105227101713431e-01   +3.177390075282174e-01   +3.828614372983599e-01   +6.597924080613947e-01   +9.538903049865697e-01   +4.908074945254680e-02   +9.257601128869239e-01   +8.717712679802215e-01   +1.993331164720744e-01   +5.445655024431915e-01   +7.232266579266747e-02   +7.774414146444509e-01   +8.115275601611155e-01; +2.422290095668828e-02   +4.918808766216808e-01   +4.286644833577113e-01   +8.381490294247717e-01   +6.348144717943234e-01   +8.622405489421713e-01   +4.413360745875300e-01   +5.648809197394251e-03   +4.611446359117506e-01   +4.207998535231296e-01   +9.435939394425350e-01   +8.989087351217511e-01   +5.150211171616549e-01   +1.553263711581101e-01   +7.150249947116698e-01   +8.953474651440598e-01; +7.671888716345518e-01   +5.158727233092822e-01   +9.015946911857509e-01   +8.138753340931838e-02   +9.068335586598636e-01   +3.215491005980518e-01   +5.780325411656481e-01   +4.039789033506564e-01   +9.412678534974601e-01   +2.999841935046298e-01   +2.403585870939353e-01   +4.812857617246337e-01   +7.679104204017020e-01   +3.639456399481942e-01   +2.734467250889115e-01   +6.700790351149020e-02; +5.707034603580632e-01   +2.865455592279167e-01   +7.206176790576686e-01   +8.368389919036263e-01   +7.977033841740034e-01   +3.823208888125147e-01   +5.161537442588177e-01   +1.574549664834425e-01   +4.747056306427770e-01   +3.566289127233307e-01   +9.181938159980407e-01   +6.664696872247874e-01   +7.506054720032491e-02   +7.128893667378593e-01   +1.721197620397335e-02   +9.035365759476934e-01; +5.808619771079204e-01   +5.632586060810434e-01   +6.850262682446523e-01   +5.507332302252759e-01   +6.479597877536966e-01   +6.454295994976017e-01   +7.279705185771026e-01   +8.288257719093264e-01   +7.775574669933569e-01   +9.760270645278663e-01   +6.327165854224375e-01   +5.293432690476405e-01   +6.308952689736996e-03   +5.412507389652683e-01   +1.927630882207383e-02   +6.747121680971740e-01; +3.847360259084313e-01   +5.162354827758964e-01   +2.071984584172799e-01   +9.669110666155748e-01   +4.402495349525550e-01   +3.909523067382316e-01   +2.198698801890886e-01   +2.877047144830063e-01   +1.085244424928501e-01   +5.357171552506704e-01   +2.890945010515486e-01   +7.038299271717172e-01   +4.056130822924687e-01   +2.335500649983658e-01   +9.311080430457574e-01   +3.465567862397080e-01; +5.535983158073476e-01   +6.739953547300922e-01   +5.271954451674923e-01   +6.714785539556466e-01   +7.504964377276636e-01   +7.278111626276540e-02   +9.992901565482556e-01   +9.802599375234901e-01   +5.185328161200956e-01   +7.942520363883705e-01   +8.498576953158637e-01   +7.165319484350047e-01   +6.625621480366177e-01   +4.714213718387298e-01   +9.350073117437303e-01   +8.445931601857990e-01; +1.868488514269390e-01   +6.179368875535471e-01   +8.248377750159409e-01   +3.370575534438743e-01   +8.321361184761489e-01   +1.579190808088105e-02   +6.236104273937924e-01   +6.221638432568648e-01   +6.393922018527962e-01   +7.994080036934551e-01   +1.621473912773208e-01   +2.962420806000027e-01   +3.711212894834756e-01   +7.172464953019574e-01   +3.757603904438745e-01   +1.981319249803074e-01; +1.181632192913615e-01   +5.659732960177569e-01   +1.836431950122817e-01   +2.166441274660139e-01   +3.486086367972694e-01   +8.735043958736135e-01   +9.894228324068518e-01   +7.494794297789924e-01   +5.776982788686673e-01   +1.394311646222811e-01   +8.268074266352664e-01   +1.129545872469187e-01   +3.966675513833186e-01   +5.195255263503757e-01   +1.045163576022187e-01   +8.442410111091491e-01; +5.338401578572071e-02   +5.095973080733722e-01   +5.153405853403120e-01   +5.704658430962378e-01   +1.505956364949256e-01   +1.602557738504028e-01   +4.931895479885033e-01   +8.843034745549522e-01   +8.395122482695285e-01   +4.546149689790498e-01   +2.184785314520536e-01   +3.303742059932966e-01   +1.351821088845763e-01   +5.143407628441681e-01   +7.241026280794101e-01   +4.275166001659701e-01; +9.367344920166727e-01   +6.678098940945210e-01   +3.558789078897510e-01   +6.508511782301321e-03   +5.040160008506824e-01   +9.216033848816452e-01   +5.264214440994297e-01   +3.351446828860620e-01   +1.174055595991548e-01   +4.551244180012998e-01   +2.719445025968576e-01   +4.630107848803071e-01   +3.397084877743061e-01   +3.915065555285557e-01   +4.546726235409525e-01   +5.569970871619198e-01; +7.434334194782520e-01   +6.415975491156843e-01   +6.539567419781050e-01   +5.929025952596023e-01   +4.136811983068421e-01   +5.660065019232223e-01   +8.558135301519567e-01   +9.301806801323168e-02   +5.112563446456031e-02   +9.575918797723403e-01   +9.204337834880773e-02   +7.144166165019653e-01   +1.230242910119825e-01   +4.843157434043822e-01   +1.446368756667695e-02   +4.446173202343981e-01; +2.389164192009432e-01   +1.424648218232106e-01   +2.803340655081378e-01   +8.963105186474479e-01   +1.751643490937174e-01   +9.223669551674565e-01   +2.559708313971569e-01   +4.471111963580398e-01   +5.205854368919791e-01   +4.965200984132919e-02   +9.146194178747376e-01   +3.989424731138340e-01   +3.715414852788571e-01   +7.415294548878901e-01   +1.155796876036886e-01   +7.616342551936681e-01; +2.025496011635264e-01   +1.813684375489072e-01   +4.346129109186167e-01   +2.605016390796581e-01   +4.939192013143450e-01   +5.941087491050528e-01   +5.781374942277885e-01   +2.364739951027374e-01   +7.023860492383479e-01   +3.954584780412203e-02   +7.301661702818689e-01   +2.387093902405278e-01   +2.483489840952245e-01   +7.062048149857657e-01   +6.626886807419239e-01   +9.528204259435742e-02];
L1E_L1I_iGABA_netcon = [+8.392481509121870e-01   +7.471574302000626e-01   +8.729238299140198e-01   +4.362093663354256e-01   +9.217404545277430e-01   +7.700789493578611e-01   +3.230020831236089e-01   +6.442259526007911e-01   +9.458657846399961e-02   +2.767901027813827e-02   +1.281813887539099e-01   +5.186596585014271e-01   +8.766849886145729e-01   +5.731062121947008e-01   +1.704785763338906e-01   +6.330858146514540e-01; +6.170249144999871e-01   +9.946550536530990e-01   +3.126364749576374e-01   +1.445078988795278e-01   +8.874737548945467e-01   +2.740768680629350e-01   +9.636279846761872e-01   +4.362566613650572e-01   +2.957864086319960e-01   +5.118872326291488e-01   +4.320356518064929e-01   +2.050859565872795e-01   +8.050601325930726e-01   +2.935155988735410e-01   +5.473677056601476e-02   +3.403846334593446e-01; +6.641462687671129e-01   +3.725377170948409e-01   +4.322275638223644e-01   +6.520230845917959e-01   +5.911759800060530e-01   +5.234003736486653e-01   +3.513873395009408e-01   +4.826828653700825e-01   +3.286839571660366e-01   +8.672640959014996e-01   +4.808189788421229e-01   +7.695226044890084e-01   +6.450412759432863e-01   +1.407905770435044e-01   +2.185705865036194e-01   +1.539677524968772e-01; +7.789906992775051e-01   +5.096384703430960e-01   +3.784914439326933e-01   +7.249583761235993e-01   +8.344613300851891e-01   +4.112903883099447e-01   +3.175481681388397e-01   +9.721750111035746e-02   +4.754060353783250e-01   +5.803777731109682e-01   +6.737437748915370e-01   +3.889015388166032e-01   +7.365623872455790e-01   +4.358877252868101e-02   +2.058987895603100e-01   +4.004749667886974e-01; +3.152589949514343e-01   +7.542073062646337e-01   +6.526830565799571e-01   +1.706477140349307e-01   +7.823481344730315e-01   +7.835103092723568e-01   +9.119281309476314e-01   +8.036202225664664e-01   +2.387044070471729e-01   +4.259318498018339e-01   +3.535920068623693e-01   +6.996279630146258e-02   +6.622854139649872e-01   +6.239698454727574e-01   +2.154035525107203e-01   +9.138289200272718e-01; +3.265482186261376e-01   +1.337955581313766e-01   +2.480400870468774e-01   +3.401320251440865e-01   +7.867088905367479e-01   +2.714738597740967e-02   +8.833060723113155e-01   +6.140346707320841e-02   +4.561767064894783e-01   +7.184014551240092e-01   +4.297329350179983e-02   +7.499570373597502e-01   +8.853495571554000e-01   +6.070331466997094e-01   +5.793428558302711e-01   +1.550879503802094e-01; +6.305940586942959e-01   +5.191392520320981e-01   +6.877076613018336e-01   +1.018113931616675e-01   +6.987248376146190e-01   +4.114331121884561e-01   +3.600263111717369e-01   +9.580183339701116e-01   +7.551296522759663e-01   +2.304562964250441e-01   +2.909643724382578e-01   +4.555282468965249e-01   +8.516551426393169e-01   +3.700078483911964e-01   +3.761706743108863e-02   +4.696356751634967e-01; +9.013879950465971e-01   +9.090553730556882e-01   +3.290010193326989e-01   +4.592134563194757e-02   +1.972885656290255e-02   +8.274116992346924e-01   +7.392647285815488e-01   +7.718471099739163e-01   +7.162077345355508e-01   +5.767452422817511e-02   +7.996506211555788e-01   +3.157407675135909e-01   +4.058937393444295e-01   +8.333910965829912e-01   +7.983090391669869e-01   +8.209155574456993e-02; +3.695312345220296e-01   +1.011452603095253e-01   +8.724517843130233e-01   +4.740133868878144e-01   +3.237437791888678e-01   +5.930633475271371e-01   +1.254747506425072e-01   +4.472534382430950e-01   +2.339580853298193e-01   +9.748017227323481e-01   +6.496823057025000e-01   +2.754432961930973e-01   +1.096244259180034e-01   +5.182649560131372e-01   +1.365507743852753e-01   +3.364935044505268e-01; +8.833470027266165e-01   +1.815784695404526e-01   +9.990506240161677e-01   +4.776781420090911e-01   +9.453492636116790e-01   +2.110509028697725e-01   +5.906344098514069e-01   +1.669401917903873e-01   +7.034417344451662e-01   +9.688342386372323e-01   +7.108537236912974e-01   +5.747096238446270e-01   +4.068432076104256e-01   +8.118456730934931e-01   +5.789425237372404e-01   +4.909054912368024e-01; +1.178421760104371e-01   +1.803685685699415e-01   +6.887124835056488e-01   +5.516215277879299e-01   +4.060337843336893e-01   +2.910531378244317e-01   +4.396292591680317e-01   +8.115175513337824e-02   +3.038386874440547e-01   +1.298726945098151e-01   +7.578303952180762e-01   +9.121876532029630e-01   +3.361135992185741e-01   +5.768705989781955e-01   +8.293230822662202e-02   +5.015310173319824e-01; +9.233587358963445e-02   +5.371636951687052e-01   +3.460438776476182e-01   +6.462070678404703e-01   +6.267019978639503e-01   +2.683997587591504e-01   +9.644834726238111e-01   +7.424999073393924e-01   +4.683306872219509e-01   +3.344440851263048e-03   +3.890693721025398e-01   +4.487660656339846e-01   +1.100076622200145e-01   +7.127273801291963e-01   +2.270923151936318e-01   +1.315767097940954e-01; +5.447892538490233e-01   +9.753183838752444e-01   +5.596117762145616e-01   +3.482911927442797e-01   +8.505698436229171e-01   +9.333778278016883e-01   +9.733944567498707e-01   +5.346345563450887e-01   +4.390635436170569e-01   +9.327200084742356e-01   +3.646838663460938e-01   +9.817242423975239e-01   +8.589362183639341e-01   +7.325249808302052e-01   +4.455532774916622e-01   +7.656213008246483e-02; +6.017626601234699e-01   +8.416795372520750e-01   +8.932367773255838e-01   +2.526234956602768e-01   +3.665285929969032e-01   +5.536167149673339e-01   +2.483743486328221e-01   +4.861259302529456e-01   +7.287874303816831e-01   +7.405352875890868e-01   +8.127434223323409e-01   +1.031273024705026e-01   +8.974408205044028e-01   +4.461679912737557e-01   +1.774733406422512e-01   +6.760302444554540e-01; +7.231934733372795e-01   +6.681269487014349e-01   +6.484020178215947e-01   +1.805710877653095e-01   +2.034990748276501e-01   +4.292976444356891e-01   +7.743816050491753e-01   +8.854995750760397e-01   +8.755310758072907e-01   +4.295329270928733e-01   +3.878307264998427e-01   +4.183604939985233e-01   +6.915441885837322e-01   +2.792918383994192e-01   +4.136482368953724e-01   +1.192121817394698e-01; +9.941396893474386e-01   +1.247045243431396e-02   +3.799446291495317e-01   +4.762613229926537e-01   +9.090559109351481e-01   +3.259896981128400e-01   +7.091776882083630e-01   +5.894176256257706e-01   +9.116756646211570e-01   +9.443405705477613e-01   +8.690313270696923e-01   +3.875106373697291e-01   +7.475358862526572e-01   +1.556199338704380e-01   +9.641657863606394e-01   +9.879346926417816e-01];
L2I_L1I_iGABA_netcon = [+5.708864665996006e-01   +5.650345259622249e-01   +1.070167662193665e-01   +4.536697332034076e-01   +7.996379596078687e-01   +9.763806317446148e-01   +2.230871502962026e-01   +7.600222967329220e-01; +5.651230001158801e-01   +9.518363172193436e-01   +1.296214010000527e-01   +5.680611062899978e-01   +5.450182661083889e-01   +4.239414521547086e-01   +6.427103510408855e-02   +4.974069360224284e-01; +6.055721881736641e-01   +1.288311393022550e-02   +4.356724619448004e-01   +8.198296368313197e-01   +2.578759116795562e-01   +3.909262659481916e-01   +8.266155465182227e-01   +8.268862567203979e-01; +4.654148416849672e-01   +1.234560714305053e-01   +9.281746848153547e-01   +3.598181863792941e-01   +7.780778759831078e-01   +4.593081109539688e-01   +4.195591707754762e-02   +9.200033251074380e-01; +4.365575197280935e-01   +8.557461666295245e-01   +1.375362435328770e-01   +2.432788550556765e-01   +7.787390585119145e-01   +1.294796476387046e-01   +9.107488827919604e-01   +7.103524562396368e-01; +6.774115340886801e-02   +2.197394672688275e-01   +8.202602453132893e-01   +7.644470695608269e-01   +1.453655757294579e-01   +4.623942722259766e-01   +4.529894409182830e-01   +8.029124525827926e-01; +6.406357426886072e-01   +7.032677371113579e-01   +9.319466254723416e-01   +2.337267762568308e-03   +8.269389456087660e-01   +2.661514925267635e-01   +2.809533405130982e-01   +9.589692020933964e-01; +4.240136416332059e-01   +7.783552405335722e-01   +5.730546926286105e-01   +2.791395097140172e-01   +6.238270406972949e-01   +1.041003367667009e-01   +7.546107585632552e-01   +9.506114409991736e-01; +7.532910118317860e-01   +4.251996256782039e-01   +4.980724213848384e-01   +3.193920268246795e-02   +4.629461267429657e-01   +6.582925392385880e-01   +9.265712790326298e-01   +2.966869074306840e-01; +3.051373093571679e-01   +7.312078421029461e-01   +9.285735513108960e-01   +6.674523200266966e-01   +4.865747817218590e-01   +9.428884739381175e-01   +1.406091920874736e-01   +3.545079795142635e-01; +6.004060401915410e-01   +4.520846479720676e-01   +8.651442116341677e-01   +9.729516658905086e-01   +2.214034748831430e-01   +7.660906942684333e-01   +9.436481946587432e-01   +5.458387197607747e-01; +3.301811861830211e-01   +8.027778818814389e-01   +2.539845329537341e-01   +9.459120351145769e-01   +8.526468465509881e-01   +4.080551128897732e-02   +3.157302892059481e-01   +2.128088233365426e-01; +6.449060965688833e-01   +4.292305851627026e-01   +4.571888320932049e-01   +4.751620221230070e-02   +8.777046664769749e-01   +2.611593634802211e-01   +2.084967254817436e-01   +8.028067845589601e-02; +4.270697737151640e-03   +1.508118817336285e-01   +7.383210926692204e-01   +2.887214635929817e-01   +8.388944711427047e-01   +6.403321587753071e-01   +4.612545654737270e-01   +5.114445512624107e-01; +1.489092303082966e-01   +8.025153490974005e-01   +7.532037694548088e-01   +4.801789780606909e-01   +4.418391240676901e-01   +8.822628816137409e-02   +5.953881682549017e-01   +1.975559294329086e-01; +2.469196753350112e-01   +3.730950149888112e-01   +2.371339237145557e-01   +8.868581316142861e-01   +5.429912814055112e-01   +7.328932681896326e-02   +5.478670395162742e-01   +1.440414538036041e-01];
L1I_L2I_iGABA_netcon = [+7.108138743542475e-01   +8.699137758066323e-01   +6.155476608107987e-01   +4.897332928817717e-02   +1.455659142351161e-01   +2.341132587633441e-01   +8.402218313520717e-01   +3.677547648281905e-01   +7.105791035513462e-01   +3.902966018130821e-01   +2.436488619387029e-01   +6.734524150674684e-01   +1.607849275156194e-01   +5.704220301295212e-01   +4.418862493064859e-02   +4.610065905736090e-02; +6.059955614659222e-01   +8.009868302407818e-01   +6.174330902647270e-01   +5.220250741040069e-02   +7.449019958121540e-01   +5.521106927671927e-01   +1.996781454277240e-01   +5.598097291125543e-01   +1.892571907803743e-01   +7.261649939280663e-01   +5.076325574046799e-01   +3.370667882931237e-01   +1.064193989117518e-01   +8.130992737183391e-01   +4.351634678079896e-01   +9.212294565866685e-01; +1.615371295387609e-01   +6.202730593709752e-01   +3.079035296740460e-01   +5.982380690682791e-01   +9.508637396349934e-01   +1.119370524663556e-01   +6.146206710659525e-01   +8.356663425646326e-01   +2.310062880016117e-01   +6.331828930188320e-01   +7.338533595127387e-01   +5.481119150590341e-01   +7.439899926492534e-01   +6.751969912385757e-01   +9.253391832362767e-01   +1.761940540257007e-01; +4.798282839398144e-01   +4.774933532787737e-01   +1.323571078084922e-01   +6.589858343792088e-01   +2.627900706579800e-01   +8.222677655079682e-01   +1.582164157760849e-01   +7.153255834134893e-01   +9.996879470148831e-01   +9.787318896274466e-02   +7.807579670040911e-01   +5.347329683812578e-01   +2.175297098821867e-01   +4.402610915535861e-01   +8.856477752280456e-01   +7.453269730209088e-01; +2.895687743834395e-01   +2.040980671145241e-02   +6.002523479039019e-01   +4.866363088483587e-01   +9.219031356460675e-02   +6.577344736869606e-01   +5.864033387413835e-01   +1.159511536082531e-01   +9.019160874498404e-01   +4.959122576093697e-01   +6.832875772421373e-01   +9.064418871959654e-01   +4.859054754515207e-01   +8.885914884152254e-01   +9.628821585103177e-02   +4.700450864175480e-01; +4.044091197035928e-01   +1.203582257848207e-01   +8.930763404303665e-01   +9.795442942950857e-01   +2.312044082141021e-01   +2.335916229154198e-01   +5.422964715167972e-01   +7.414849742391735e-01   +1.269188098890544e-02   +5.546743414944472e-01   +8.140565333378520e-01   +2.854891171644663e-01   +4.815252186403512e-02   +7.878624389395703e-01   +6.849822313506163e-01   +2.515735928269649e-01; +4.885486361404547e-01   +7.226907641603512e-01   +5.655457816217163e-01   +8.669035217183029e-01   +8.895877958331402e-01   +3.044508088976507e-01   +6.886080888004714e-01   +9.224426933317190e-01   +8.339091638587955e-01   +5.348125085035187e-02   +4.225464907939803e-01   +1.375361798576124e-01   +5.789608710856693e-01   +5.877887171662053e-01   +1.282367146662374e-02   +6.661661268210933e-01; +8.643244077974929e-01   +6.694499003296778e-01   +6.339742703249376e-01   +9.578032036722840e-01   +2.004623093678761e-01   +3.240844473040538e-01   +6.980688763146443e-01   +9.204888226660645e-01   +2.510224189832112e-01   +8.015025962275310e-02   +4.939448019385940e-01   +9.537473125978768e-01   +4.955677029947930e-01   +6.205869429133356e-01   +1.268863361071784e-01   +6.088838162257323e-01];
L2E_L1E_iAMPA_netcon = [+3.731337115072609e-01   +5.620058055731866e-01   +2.046176908186721e-01   +5.187448310626823e-01   +2.940154734146716e-01   +6.900319250142135e-02   +2.810474813652489e-01   +2.644547137408957e-01; +4.346899100084922e-01   +1.873369316125921e-01   +1.395133758038713e-01   +6.828235518401534e-01   +6.179227210648599e-01   +5.909755100974590e-01   +9.304933535194230e-01   +8.989580541714184e-01; +7.169563399350489e-01   +6.061826975773215e-01   +8.053778175285163e-02   +2.094760448741949e-01   +8.706209465160004e-01   +7.813845336118612e-02   +7.605237050007529e-01   +1.562379362299104e-01; +1.961297759825185e-01   +7.319423760084994e-01   +9.269979746543595e-02   +9.724718160086810e-01   +8.156628305372031e-01   +3.972293887301583e-01   +2.609553222113232e-01   +5.517500971899494e-01; +4.615806004793564e-02   +8.363377969892645e-01   +5.522241560623101e-01   +3.487567687538476e-01   +2.103907844569931e-01   +5.412362853441737e-02   +2.452826104970415e-01   +4.233538004425267e-01; +3.121283968644741e-01   +2.740817460798746e-01   +7.306425081977813e-01   +1.824607390543669e-01   +7.477880967326160e-01   +1.251890245653914e-01   +1.628158925394056e-01   +5.477101504666723e-01; +7.937903884192230e-01   +6.068931503568143e-01   +5.476490845978932e-01   +2.449121465961847e-01   +2.002558512464190e-01   +2.422835977720762e-01   +2.898077520155410e-01   +7.453682957297325e-01; +4.052083609707259e-02   +5.491612174434233e-01   +4.922909637265524e-02   +2.572127458111991e-01   +5.806281873405387e-01   +9.403943926317266e-01   +5.647544175399520e-01   +1.338060049953054e-02; +2.152803793959537e-01   +2.769558767487709e-01   +6.354691479371279e-01   +2.189410403059330e-01   +8.774873018010653e-01   +2.084488702999539e-01   +3.985423743892634e-01   +5.412757771472851e-04; +2.698043379770571e-01   +3.377040113455777e-01   +9.919853060506177e-01   +3.817880871457219e-02   +7.167960517803579e-01   +3.291292674243537e-01   +9.853400263019635e-01   +1.846428839605273e-02; +7.928593738878749e-01   +5.707450380460602e-01   +9.122713097049576e-01   +3.530755627639169e-01   +6.979213068781710e-01   +8.663758531897632e-01   +5.459526039673479e-01   +3.526450738952130e-01; +9.843126812537328e-01   +7.428714915292135e-01   +7.722559577380997e-01   +8.965193314388533e-01   +4.609509261674052e-01   +9.201586579373692e-01   +9.335484675514558e-01   +4.292155286553370e-01; +9.661282654937123e-02   +7.642285514879673e-01   +1.955542779297585e-01   +1.360858836882686e-01   +5.050459014053829e-01   +1.960364925953034e-02   +9.863264778200388e-01   +5.441947707335911e-01; +2.005440719501788e-01   +4.029848821836827e-01   +2.927760871003013e-02   +9.523217939865483e-01   +7.993397483528937e-01   +3.607025162749736e-01   +8.331480529129631e-01   +4.828225149062234e-01; +1.187941099416642e-01   +1.554476970101449e-01   +3.770868705336892e-01   +9.085889308359675e-01   +9.341442026962987e-01   +5.306541009843817e-01   +1.814172852275894e-01   +9.166065575143759e-01; +6.404863714870415e-01   +2.064278576531287e-01   +5.778728941040315e-01   +4.107701675729459e-01   +7.926429108148050e-01   +4.065671763092388e-01   +3.121650533295000e-01   +4.163809041181035e-01];
L1E_L2E_iAMPA_netcon = [+4.954242329902029e-01   +4.548317913645940e-01   +6.145202994047363e-01   +4.927173611158713e-01   +2.328994962252692e-01   +7.152993367888365e-01   +6.880632476695341e-01   +6.359013872533900e-01   +5.220839157270860e-01   +2.405538666071900e-01   +8.719092523003770e-01   +1.767607234761554e-01   +1.365269421011233e-01   +2.465495447238235e-01   +1.823701556351946e-01   +3.136244594208062e-02; +8.336453045784953e-01   +3.631926355962011e-01   +1.049532434341947e-01   +6.640407099493125e-01   +8.368580116660631e-01   +3.816762618368700e-01   +9.734875262966076e-01   +6.236685527293276e-01   +6.719125435952659e-01   +7.290540221219312e-01   +6.640030428709565e-01   +2.986921962637238e-01   +2.864550575083618e-01   +7.464227380122693e-01   +1.517842982303503e-01   +2.507142756341191e-01; +1.845824937530064e-01   +2.965340018816218e-01   +7.569523406198878e-01   +1.810948246008925e-01   +7.338299612734258e-01   +3.787939970385136e-01   +7.565011508265013e-01   +4.107725649144795e-01   +7.729340250250504e-01   +1.281883503826725e-01   +5.439849911812237e-01   +1.071717709762323e-01   +4.688147073680074e-03   +9.314494502508321e-01   +1.352716876873749e-01   +9.904791659107086e-01; +3.381665974201105e-01   +2.388073518563404e-01   +5.405805469246650e-01   +4.767516597136986e-01   +4.881513249549673e-01   +7.179323848209174e-01   +5.549200578140020e-01   +4.316688920605818e-01   +4.643625547657630e-01   +4.198522416873496e-02   +2.464887209874930e-01   +4.519314988239590e-01   +3.089479949909890e-01   +3.202882382796761e-02   +1.649957041391191e-01   +6.309999741921397e-01; +6.923648878541910e-01   +1.348992086858326e-01   +4.470911980519903e-01   +5.017551030691363e-01   +8.513237850290172e-01   +8.305886052989907e-01   +2.839167251507094e-02   +5.128865637365355e-01   +9.051626849572663e-01   +6.524847527715036e-01   +1.110907797585114e-01   +5.856596561805073e-01   +9.073878260103060e-01   +4.303171481804655e-01   +9.208381912238099e-01   +3.609309278898696e-01; +6.921712277848991e-01   +9.990882552374160e-02   +7.423169233232390e-01   +6.035570133449870e-01   +7.206872521192101e-01   +6.689358499622265e-01   +1.908322664216181e-01   +2.598478432186516e-01   +2.251007468721842e-02   +1.988223494613180e-01   +9.702416044328013e-01   +2.211712351073801e-01   +2.952393974278173e-01   +8.274069393204924e-01   +2.618326140014322e-01   +9.869260435998838e-02; +3.678312927766639e-01   +2.338385840279977e-01   +3.894520066095150e-01   +2.459425052300730e-01   +5.220405529799244e-01   +6.481720212888851e-01   +9.369202154538814e-01   +4.219535385294245e-01   +4.835278161377758e-01   +9.724428237012632e-01   +5.885692861080805e-01   +1.065377186243328e-01   +8.271415175337153e-01   +9.965735638640035e-01   +2.061531065458500e-01   +4.154146964320469e-01; +3.280990209592950e-02   +3.500756048191386e-01   +5.331123790092233e-01   +5.205121254272503e-01   +9.402103195671603e-01   +5.609531923251158e-01   +3.931798456479493e-01   +5.234963043784476e-01   +2.727349531664970e-01   +8.233846883953756e-01   +8.178079072376276e-01   +5.628139513210156e-01   +7.398833413913126e-01   +9.219057562823084e-01   +6.173541978512436e-01   +9.259539095063462e-01];
L2I_L2E_iAMPA_netcon = [+6.768004793795093e-01   +6.123286091504779e-01   +4.154188155171151e-02   +7.998825055892796e-01   +5.210026015785488e-01   +8.229141863476518e-01   +6.469894187700875e-01   +3.880642398711346e-01; +2.202700462151905e-02   +9.431301643814379e-01   +5.336065716930045e-02   +9.332092857563448e-01   +6.785924799609859e-02   +1.104316993045054e-01   +3.463850895517204e-02   +1.702226924550582e-01; +7.360212853094100e-01   +9.626052458385688e-01   +4.072492293754219e-01   +9.416615919864262e-01   +2.870291528157778e-01   +2.487717902356136e-02   +5.642983312883095e-01   +4.450539953677247e-01; +2.182399414910586e-01   +3.638674911932056e-01   +9.775997919380516e-01   +1.439488859498696e-01   +7.166063492998691e-01   +7.391129847351497e-03   +3.073627544420600e-01   +8.786668716315231e-01; +8.542782463305767e-01   +7.998580551156238e-01   +7.121341074501152e-01   +3.241015423553547e-01   +8.879986554230875e-01   +3.374312776479988e-01   +2.629527291313772e-01   +4.054355578202562e-01; +1.586578038221476e-01   +7.224739039235794e-01   +9.893798437717874e-01   +4.279526299020071e-01   +3.628214820828936e-01   +6.656902689771549e-01   +7.194242212562462e-01   +1.648658456294498e-01; +6.704452518768538e-01   +9.504110261800067e-01   +6.445950776449253e-01   +7.080620966048526e-01   +5.650832725960759e-01   +5.899366020071516e-01   +3.079867936970919e-01   +6.651183627056025e-01; +9.324009292160564e-01   +1.330665388262257e-02   +5.011778516361234e-01   +6.192320058624493e-01   +8.825515521044469e-01   +7.710584425216783e-02   +9.025242120427884e-01   +9.300510421531054e-01];
L2E_L2I_iGABA_netcon = [+6.052585086280294e-02   +5.223616468592654e-01   +3.487676688316456e-01   +2.585168017151670e-01   +4.516651736199423e-02   +9.021080690230647e-01   +3.436511384561003e-01   +4.538189922084974e-01; +3.523519090934738e-01   +6.429105404874140e-02   +5.576323771771680e-01   +9.845272523464221e-01   +3.628577021515133e-01   +5.503286728727051e-01   +9.341998190168765e-01   +6.723152342831755e-01; +9.305980276721650e-01   +1.839607335605544e-01   +6.911570171194229e-01   +3.482095372363406e-01   +3.904190396515519e-02   +7.111836990967463e-01   +9.120641648763216e-01   +7.711301492160129e-01; +2.391656501870947e-01   +3.149035601309751e-01   +4.401173858868308e-03   +3.926624226745985e-01   +4.910462676344245e-01   +7.149216931840318e-01   +7.269090452477949e-01   +9.246033206368582e-01; +1.083280917440063e-01   +2.470371922112088e-01   +4.840058947688386e-02   +7.523814964705846e-01   +7.264216059341719e-01   +1.730808719242731e-01   +4.431168936218982e-01   +6.522436196139292e-01; +7.086367456469471e-01   +3.224549203228433e-01   +3.042023906830823e-01   +1.093472072739677e-01   +1.709027464436397e-02   +3.538891181946210e-01   +1.467967524743126e-01   +5.028943600891037e-01; +4.735467447565482e-03   +8.719001809230904e-01   +8.724840736025328e-01   +5.972398772565425e-01   +5.100550261069510e-01   +3.779722698449693e-01   +8.304453340411597e-01   +3.437859443120121e-01; +1.780410364872509e-01   +3.046501361334214e-01   +6.252641058383839e-01   +1.207766404709290e-01   +2.453916766092966e-01   +7.581862313796985e-01   +2.499820379708232e-01   +9.435529865307085e-01];
L3E_L2E_iAMPA_netcon = [+7.712245033559378e-02   +1.712925915576347e-02   +3.697831561331890e-01   +4.942694387302405e-01   +2.222365703846051e-02   +9.620812116073494e-01   +3.558022758511811e-01   +2.302237765873941e-02   +2.063466925746724e-01   +7.113920269703344e-02   +2.411248425753490e-01   +9.990465272459040e-01; +9.513126269853133e-01   +9.801107756795361e-01   +1.193238477238392e-01   +6.518219970754881e-02   +8.089431494311013e-01   +3.917590951220580e-01   +2.269140459973367e-01   +1.292097624840381e-01   +3.533744552491959e-01   +7.465500341745600e-01   +5.375816805753859e-01   +3.417435663888126e-01; +6.643468945838079e-01   +7.194093791190790e-01   +5.123978534495532e-01   +8.724714539920908e-01   +7.987213943289988e-01   +6.643418818978648e-01   +7.253374030232670e-01   +6.657561919481774e-01   +8.892839116580635e-01   +9.916432772152257e-01   +3.360569593711591e-01   +8.294987084435134e-01; +1.675927859008990e-01   +8.773449966848104e-01   +7.420928091307091e-03   +9.980474122494987e-01   +4.165365374134484e-01   +5.814023922676363e-01   +7.714882419343505e-01   +5.073218830585706e-01   +8.196980110916170e-01   +7.698669188483880e-01   +6.719240388461589e-01   +1.098869964843529e-01; +1.980976600410221e-01   +8.178577308208813e-01   +8.701911856046750e-01   +1.184122083294264e-01   +6.343351735721640e-01   +5.224851103023998e-02   +3.383407840347079e-01   +7.502473154788347e-02   +3.168414085178272e-01   +8.890533156891113e-01   +8.790583127765730e-01   +7.810192383618801e-01; +9.903582214736347e-01   +3.706545411462751e-02   +9.057938317597058e-01   +1.062948427601978e-01   +5.675600425443557e-01   +7.422880931249715e-02   +5.721044841120458e-01   +5.370547806493987e-01   +5.994156538255836e-01   +4.342346332400582e-02   +9.800152937009512e-01   +1.524671731125461e-01; +9.332037571403179e-01   +9.286210044469814e-02   +1.119743375209419e-01   +1.477287570207256e-01   +9.070778976518026e-01   +2.310553964859477e-01   +6.365673049113201e-01   +6.840420949073174e-01   +7.003154858264724e-01   +7.971082912984548e-01   +1.368274685166126e-01   +7.328070690817643e-01; +9.776443656043812e-01   +9.581754665097225e-02   +4.177078211898294e-02   +1.297575009502815e-01   +7.521718509925737e-01   +4.153805679952819e-01   +3.688633536456597e-01   +5.877470159204996e-01   +1.806385305793157e-01   +7.124962987229523e-01   +8.834165975500125e-01   +1.192834854822155e-01];
L3I_L2I_iGABA_netcon = [+7.691024347181763e-01   +5.381699998276983e-01   +5.973302396800625e-01   +3.050789560871304e-01   +9.635252871544897e-01   +1.124573721300444e-01   +2.934229205346828e-01   +7.952302034310536e-01   +9.237745755051067e-01   +9.960077736058731e-01   +3.096883664364305e-01   +9.936968725117874e-01; +6.361202669359205e-01   +4.472575848685280e-01   +5.611373312118237e-01   +7.581205022316819e-01   +5.485510972614533e-01   +6.531584904789547e-02   +1.671048348974142e-01   +5.061903201306676e-02   +3.869555154257772e-01   +2.942980023953300e-01   +4.476008248726672e-01   +9.172229117420304e-01; +7.955307440355225e-01   +1.163444242396736e-01   +7.569558986569160e-02   +6.514892439196899e-01   +9.787951562274484e-01   +4.783998192537465e-02   +7.224762557056230e-01   +1.811329425259000e-01   +7.500215874452272e-01   +5.260582801507289e-01   +2.012187478355756e-01   +6.875157680598419e-01; +9.643072736494447e-01   +7.178582807741729e-01   +7.667628041563971e-01   +3.334695517031684e-01   +1.253587426822602e-01   +1.301227382177328e-01   +3.003123204691771e-01   +2.485819742326257e-01   +8.788007313223921e-01   +3.596053265531781e-01   +9.432389283551176e-01   +2.158266865399162e-01; +7.129047007024121e-01   +1.854916184171432e-01   +8.642857390614683e-01   +9.766861660990075e-01   +1.612954205497588e-01   +4.909822900793120e-01   +6.793341555324365e-01   +2.590715111287131e-01   +3.956306753585945e-01   +5.206577882639442e-01   +2.893883761362409e-01   +3.120935195618957e-01; +6.435042135197667e-01   +3.265012485814799e-01   +7.007839940225100e-01   +5.319817027971188e-01   +3.342544349972034e-01   +4.702293153650486e-01   +7.506050388257495e-01   +6.491779242121379e-01   +1.710627367870892e-01   +4.951489093445846e-01   +1.148883642634875e-01   +2.291730932318975e-01; +5.181387193664336e-01   +9.670139472890391e-01   +1.099413713891301e-01   +7.527658430068027e-01   +5.293877912963482e-01   +1.551152109536640e-01   +7.453798645078623e-01   +1.000083743594441e-01   +4.410641906278578e-01   +1.808042261437931e-01   +6.512214659899326e-02   +7.041631315960856e-01; +9.547262748855228e-01   +6.967429722707255e-01   +6.581224536329895e-01   +2.619077871878633e-01   +6.887354789791580e-01   +1.356640259605993e-01   +7.808439188438763e-01   +4.696650253184937e-01   +8.534211082623798e-01   +4.825767183554269e-01   +7.271324666350112e-01   +3.736092210442861e-01];
L2E_L3E_iAMPA_netcon = [+6.534630008157970e-01   +3.831724379046574e-01   +2.340418744363810e-01   +4.670273930529955e-01   +9.084228474507214e-01   +9.543201516147942e-01   +7.653491660029125e-01   +3.565049268307172e-01; +3.812713797531310e-01   +2.314334864033039e-02   +9.143141718660630e-01   +2.879433100534685e-01   +6.814556426930828e-01   +2.006155391627628e-02   +8.980293906032277e-01   +6.619341839140447e-01; +3.037654484576158e-01   +3.305636498292194e-01   +4.870783197664943e-01   +2.745867530784756e-01   +8.445020917802247e-01   +4.995998719945507e-01   +7.938123954843473e-01   +5.931303372630073e-01; +1.555133696520438e-01   +4.901685324717758e-01   +5.888200024332835e-01   +1.464766436088612e-01   +9.513402384301620e-02   +3.367567944207559e-01   +9.479275653723521e-01   +5.397714888300190e-02; +7.776535946153590e-01   +2.658291638887162e-01   +9.554951777641942e-01   +1.426240422901787e-01   +7.385502017660163e-01   +6.659287457371950e-01   +5.388181566749130e-01   +2.102502221353172e-01; +7.130145280368588e-01   +5.310125033230274e-01   +8.376009777577482e-02   +2.646287062178047e-01   +5.498219789516111e-01   +1.627053215944586e-01   +1.611718056633394e-01   +6.014453775246025e-01; +1.751304480614517e-01   +4.161241428719791e-01   +2.192031655905065e-01   +6.059927869916905e-01   +2.527879317099349e-01   +2.258694102530704e-01   +1.377705572411409e-01   +2.673928262409999e-01; +4.512708739807562e-01   +3.151700419134846e-03   +1.629889105262329e-01   +1.043767120216431e-01   +7.173485945208826e-01   +1.138622159286150e-01   +2.803930375235504e-02   +1.146230676908051e-01; +8.399540544878744e-01   +8.941058485360559e-01   +3.918283041862920e-01   +4.903312538459336e-01   +3.639112866056974e-01   +9.904712853546970e-01   +6.887922188953741e-01   +2.205332749890933e-01; +6.995353963787746e-01   +2.406981795709748e-01   +1.887454435975690e-01   +8.962112481051978e-01   +8.464374169499271e-01   +1.430941443290040e-01   +5.823340448133995e-01   +8.773762288622581e-01; +7.640779581364630e-01   +8.015026403343476e-01   +7.599164918646912e-01   +1.889309738089605e-01   +8.231295710590981e-01   +7.678130299753423e-01   +2.988428357139098e-01   +4.626840439653292e-01; +9.777260113666995e-01   +5.771522189045135e-01   +2.325218944646638e-01   +5.458861418078225e-02   +6.174489311271369e-01   +6.283941441473191e-01   +7.337839473657512e-02   +7.300960155957807e-01];
L2I_L3I_iGABA_netcon = [+5.901292771039202e-01   +1.433783684183721e-01   +3.461872484434128e-01   +3.737140217407598e-01   +5.941293322799872e-01   +5.133902878647001e-01   +7.771707951814792e-01   +2.680231068849631e-01; +8.431058852529838e-01   +9.915273679225665e-01   +4.351370164676008e-02   +5.359134058278477e-01   +4.765037323467513e-01   +2.416796642163547e-01   +1.801489870696259e-01   +5.953084030365545e-01; +6.076508677753003e-01   +4.830898859771068e-01   +9.459636567394409e-01   +9.762173581070652e-01   +3.774025514829387e-01   +2.687748183758613e-01   +4.517687924171983e-01   +6.844740895327558e-01; +7.443437005678862e-01   +4.126337884462571e-02   +8.610633363078569e-01   +9.958795453126102e-01   +9.823738836558629e-01   +4.106498770279513e-01   +3.051922956868249e-01   +4.130056153002188e-01; +8.527779026446126e-01   +2.676933775225148e-01   +1.374832279288317e-01   +4.120801477069546e-01   +1.430313083227851e-01   +2.664039925579302e-01   +3.832888499820691e-01   +5.112496920379987e-01; +1.450519602581703e-01   +6.709388047578372e-01   +5.841612859280211e-01   +4.473180541509845e-01   +2.706251454083220e-01   +8.551545293812789e-01   +7.993655246319876e-01   +8.159484985806573e-01; +7.411614462754632e-01   +1.436216478575691e-01   +6.216023101563251e-02   +2.435334480183668e-01   +2.252333621766415e-01   +4.807788423041367e-01   +7.800895171703970e-01   +5.384887637231224e-01; +1.674822000492825e-02   +7.768046035297757e-01   +9.536993975092642e-01   +5.970553686779928e-01   +7.945687155693338e-01   +3.380127310609373e-01   +6.462019231086776e-01   +5.903488068524363e-01; +2.306100145173385e-01   +2.650676126537547e-01   +4.961236816632152e-01   +7.588233397924767e-02   +8.215105684424878e-01   +6.343651539009748e-01   +2.408187862510565e-01   +5.392589344919291e-01; +5.380731939310713e-01   +8.813848806511595e-01   +2.669421950778946e-02   +9.087422264568656e-01   +8.001807093460193e-01   +4.174930524832355e-01   +6.042708582039285e-01   +5.404005570033014e-01; +7.151577652679849e-01   +3.630104108234309e-01   +5.227285967795593e-02   +4.772340833464411e-01   +1.142033556700365e-01   +5.435708891826768e-01   +4.175229740491402e-01   +1.526139470683014e-01; +4.312864049133567e-01   +1.165681770934648e-02   +3.044562793460213e-01   +5.036891106874317e-01   +6.402119808262572e-01   +3.362777120277742e-01   +2.976362683475992e-01   +6.991266170779999e-01];
L3I_L3E_iAMPA_netcon = [+6.102828891345566e-02   +7.743146200796417e-01   +5.553872899361485e-01   +5.683808467524021e-01   +9.148263600525145e-01   +8.333843448168377e-01   +8.485606743431392e-01   +8.630971308106598e-01   +5.267491189162613e-01   +9.935865027976295e-01   +4.793495797327980e-01   +3.516015685723679e-01; +9.224826802583689e-01   +8.332839654662235e-01   +8.469966146813019e-01   +9.329596160298307e-01   +5.906072691381227e-01   +4.013437658990177e-01   +6.299325181162476e-01   +8.539562718670537e-01   +5.679879398397581e-01   +6.987508085341236e-01   +7.387755218911682e-01   +3.970530208009818e-01; +1.844061581822148e-01   +5.939415850552039e-01   +9.686727060598651e-01   +7.775212913323520e-01   +5.787820321166881e-01   +6.915281828620252e-02   +4.401248671737121e-01   +9.487843222476149e-01   +9.806620348635681e-01   +8.377153911907170e-01   +5.934633837124493e-01   +9.907517801606067e-01; +5.378695628642165e-01   +7.614030036887957e-01   +4.683749669595604e-01   +5.978917316513735e-01   +6.523657313507811e-01   +3.793742966736232e-01   +2.290421922319996e-01   +7.002295719347493e-01   +9.610532005291257e-01   +7.339525574038438e-01   +2.542373677248678e-01   +2.928614908213057e-01; +4.014504714425702e-01   +6.608185651782000e-01   +7.702842508449494e-01   +6.544356514233829e-02   +4.288679625744466e-01   +8.591830209787374e-01   +5.361679341171594e-02   +3.575438604603882e-01   +5.578982496339967e-01   +9.960159786310839e-01   +6.075193000296202e-01   +2.316082863046556e-01; +1.005104913657459e-02   +5.857113379076814e-01   +2.335409687938036e-02   +5.352629141114255e-01   +9.393953259975766e-01   +2.804500360627748e-02   +7.026007618227902e-01   +3.785151213912105e-01   +5.236599612461340e-01   +5.036627722524538e-01   +2.319956332982816e-01   +3.290319260871122e-01; +1.070245732196343e-01   +2.377355510180522e-02   +6.751104625952286e-01   +8.614867015839629e-01   +1.008957223310817e-01   +4.211693088008973e-01   +8.502764230420609e-01   +8.494810103679150e-01   +4.708086617047423e-01   +1.924535848355926e-01   +1.949164469504301e-01   +1.679648454543829e-01; +8.546692840984513e-01   +6.845570905775850e-01   +8.400930642942662e-01   +3.391540645821552e-01   +4.081263276102438e-01   +2.516454235630489e-01   +4.019837892609794e-01   +3.888216541686946e-01   +8.978971158684280e-01   +9.517689172690200e-01   +3.748965291758356e-03   +3.815073695569436e-01; +3.337561298759764e-01   +3.250598148834771e-01   +6.907968677061160e-01   +1.810101095638627e-01   +8.928221011612345e-01   +7.154058662043493e-02   +2.904484558833494e-01   +7.703069568707717e-01   +4.797573589550780e-01   +4.530365390650046e-01   +6.522382928025000e-01   +5.290022897196105e-01; +1.433194466649701e-01   +8.418637534842192e-02   +8.995914883463398e-01   +8.799235521596608e-01   +7.378183777022623e-01   +9.143610400412895e-01   +2.596650371712592e-01   +7.778318749684523e-01   +4.897940033288610e-01   +6.023978143247609e-01   +3.996900584746995e-01   +5.931223980933517e-01; +8.001824284018543e-01   +7.472774058760561e-01   +9.342331009181000e-02   +8.409934525638181e-01   +9.575077195367132e-01   +2.655510410950618e-01   +5.100468855386725e-01   +4.295518320123435e-01   +3.132511424824714e-01   +6.451191328810922e-01   +2.690062739786139e-01   +1.671561401434708e-01; +6.526783637637712e-01   +9.652425643112390e-01   +7.615558017233764e-02   +8.272422333751388e-01   +9.749894520689139e-01   +1.078806357843015e-01   +1.162300675424250e-01   +4.879605036010402e-01   +8.527965893598787e-01   +7.599194248243454e-01   +7.174895621897736e-03   +6.484506875199768e-02];
L3E_L3I_iGABA_netcon = [+4.408813302383544e-01   +6.445191839939207e-02   +6.778844982254705e-03   +4.969354276570236e-01   +5.412811380200503e-01   +2.527672166006851e-01   +7.187786114773110e-01   +7.581529275473536e-01   +3.816859185494136e-01   +4.492863281458683e-01   +2.029428150385968e-01   +6.562963375720197e-01; +5.862271508825630e-02   +8.083004500276659e-01   +1.286817620822717e-01   +1.921904852939522e-01   +2.175562452036951e-01   +3.328208508162642e-01   +2.279199470112180e-01   +8.902975067733114e-01   +6.071077108951527e-01   +3.943413209163136e-01   +8.285476652488383e-01   +9.046275862808136e-01; +6.269000472930362e-01   +9.135849074180281e-01   +3.090564799557327e-01   +6.421528358665075e-01   +2.681940987681787e-01   +5.980440622460999e-01   +4.950246394652706e-01   +7.307893858449529e-01   +1.628515616656934e-01   +6.763676186608516e-01   +4.411996147587550e-01   +8.388164150108884e-01; +8.083967455911212e-01   +4.287214301653448e-01   +2.387105391214314e-01   +2.560838986851534e-01   +1.345680037339481e-01   +4.810997986764623e-01   +4.784496887870208e-01   +6.919507537887387e-01   +1.009064277636265e-01   +3.442206691542937e-02   +4.266938278199276e-02   +1.670229393358139e-01; +4.033505808771285e-01   +1.915790837655139e-01   +6.524416456608662e-01   +9.410722140503613e-01   +1.440750058030253e-02   +9.012086215720232e-01   +4.326090829556177e-01   +6.453210368884470e-01   +6.184059633924832e-01   +7.834003994774267e-01   +7.657426322773034e-01   +1.612125480778023e-01; +8.872765037263014e-01   +1.863723366249570e-01   +8.083359551706569e-01   +2.901514793759841e-01   +1.274821484245155e-02   +2.868986302862804e-01   +5.564766698474304e-01   +6.167911280778917e-01   +9.616373606091134e-01   +3.750213955083050e-01   +9.149193372954546e-02   +1.397715407954362e-01; +7.183254897811505e-01   +6.708521685248189e-01   +7.397452202979539e-01   +1.425510023568768e-01   +9.856780570930057e-01   +7.431707056044511e-02   +2.031839554072894e-01   +7.509038542591247e-02   +6.716274872114426e-01   +6.403530949926715e-01   +6.572755937526163e-01   +1.577343439246298e-01; +1.971572957956720e-01   +5.240914259213694e-01   +1.243541046986736e-01   +8.639974902369343e-01   +6.469994277402144e-01   +3.876973910591967e-01   +2.736999468246814e-01   +5.469851563884437e-01   +4.698768196823123e-01   +4.939031628819827e-01   +2.674977992209878e-01   +3.987069707239761e-01; +3.700680253516835e-01   +7.747573564789730e-01   +1.777768483743453e-01   +8.860468146996260e-01   +8.099855773780880e-01   +1.886072906017775e-01   +8.079377126247381e-01   +8.768358001040022e-01   +3.331519058230105e-01   +2.233611123582820e-01   +4.380696094678114e-01   +6.614373545970403e-01; +2.078688054749929e-01   +3.021566019594733e-01   +2.669700553465642e-01   +6.597801228401734e-01   +2.776741641681527e-01   +7.288094944278178e-01   +1.006355455616400e-01   +9.832088950452909e-01   +5.882074481002620e-01   +2.145743304981589e-01   +8.522432560714381e-01   +2.224500964801843e-01; +2.618657230016984e-01   +4.719293510615320e-01   +8.137907799292606e-01   +9.996496406125616e-01   +1.508950688641836e-02   +4.255825187120798e-01   +3.581295116775925e-02   +6.867510367664502e-02   +5.450015104017881e-01   +4.547625473550961e-01   +9.039710121729706e-01   +6.437977298510722e-01; +9.926534201264942e-01   +7.112124710441190e-01   +5.929579971024462e-01   +2.635166545144206e-01   +1.052371121338640e-01   +2.689637677802228e-01   +7.127717663883371e-02   +2.884361621219222e-02   +3.916298502926847e-02   +6.320050392254575e-01   +2.856894442942164e-01   +6.097774950901218e-01];
L2E_Input1_iAMPA_netcon = [+9.965105895448958e-01   +9.937368987060433e-01   +9.931450959446964e-01   +9.892898104016777e-01   +9.915254598705053e-01   +9.995388469158220e-01   +9.870361223012223e-01   +9.956888193352035e-01];
L2I_Input2_iAMPA_netcon = [+9.982677702727772e-01   +9.954033173610358e-01   +9.937545839712872e-01   +9.883976478255873e-01   +9.933805808077332e-01   +9.899286687265838e-01   +9.936723577997872e-01   +9.990337544140441e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
