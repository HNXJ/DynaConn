function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.226445997092529e-01   -4.275438040053545e-02   +7.162673136598725e-01   +4.429701640876722e-01   +3.879661953079370e-01   +1.161358602131431e-01   +6.689110858705720e-01   +4.127993458678836e-01   +1.774831314086764e-01   +5.054438235896741e-01   +5.008657344863846e-01   +1.056072373487639e-01   +4.539307777845857e-01   +3.924643891205689e-01   +1.717162403938438e-01   +6.852307616068537e-01; +5.236941159971629e-01   +2.450172027587310e-01   +6.694969075255864e-01   +2.906166859942128e-01   +5.558502864015967e-01   +2.130608793165814e-01   +1.836592327280123e-01   +2.898839626633593e-01   +6.378060144917821e-01   +1.293100206333033e-01   +3.388850839025144e-01   +8.320156102753458e-01   +3.385996562127966e-01   +3.202070655050558e-01   +8.540769458812907e-01   +5.229701262908157e-01; +7.950862247550505e-01   +1.148367287434064e-01   +6.118287051050335e-01   +1.541477811236442e-01   +4.731912069150734e-01   +1.698027265417640e-01   +1.427673830722163e-01   +6.051727482906627e-01   +1.918927155554208e-01   +2.273320204894776e-01   +5.484771471449009e-01   +1.269369165465064e-01   +3.825939481515723e-01   +5.297345684738722e-01   +3.582329083882829e-01   +2.690121561565882e-01; +5.884426927305249e-01   +8.099839113885537e-01   +5.988407547382230e-01   +3.968637030152004e-01   +5.275108975927668e-02   +7.201187647249001e-01   +7.298698797257132e-01   +1.455553879775661e-01   +3.181928813974063e-01   +2.253772004694836e-01   +2.754755883208433e-01   +1.933296335711916e-01   +3.519733822557334e-01   +1.350668171931756e-01   +6.409941476788317e-01   +4.196506652824458e-01; +5.889898821329177e-01   +2.866721488978929e-03   +6.737458018894760e-01   +7.509322554745951e-02   +1.716612793179152e-01   +6.226996704129505e-01   +3.502327202415940e-01   +6.919812329191278e-01   +6.476446290429685e-01   +7.507695786952912e-01   +7.862220150333271e-01   +2.199248635281521e-01   +5.295987671542182e-01   +6.108531068624902e-01   +1.072909632690820e-01   +6.092634320064277e-01; +6.071748911292513e-01   +3.011789617250271e-01   +5.286334476197699e-01   +2.554124208422006e-01   +3.421264055740144e-01   +5.427108252190658e-01   +6.966643747855694e-01   +5.818148877800614e-02   +6.389013174284774e-01   +7.555706053183294e-01   +6.022818195368782e-01   -3.963245038415691e-04   +4.148607879515509e-01   +3.577325510065813e-01   +4.180962423206194e-01   +1.147137238768097e-01; +4.417243456540295e-01   +2.229296809926231e-01   +1.426890094698215e-01   +2.597110523726387e-02   +3.488126652287082e-01   +8.040849607974540e-02   +7.342116866099095e-01   +7.416794807280733e-01   +3.332244123832277e-01   +9.714492646114567e-02   +4.580450182259581e-01   +8.379417369180805e-02   +5.522494142361070e-01   +6.308611530722207e-01   +2.804528095433371e-01   +2.215609203513293e-01; +4.146692759441441e-01   +2.305706235482313e-01   +5.435449237357260e-01   +7.240457038635313e-01   +6.216727549319897e-01   +4.340493116635215e-01   +5.188240230993532e-01   +2.863655573144712e-01   +1.665912368979146e-01   +2.607268158238222e-01   +4.921392046518935e-01   +5.043109792141696e-01   +3.740087452368417e-01   +3.774688974104780e-01   +3.365940401157755e-01   +6.456504028011420e-02; +2.799796370663497e-02   +5.486059137678384e-01   +1.897488809755477e-01   +1.128877476928457e-01   +4.923691025796537e-01   +1.632383495165319e-01   +3.292217776739870e-01   +7.222370286801746e-01   +4.468287911734681e-01   +1.927171029667721e-01   +1.745523970589219e-01   +4.412030530594934e-01   +2.119983249282157e-01   +2.589557643218905e-02   +9.728870306190139e-02   +5.431930600357295e-01; +3.215356136984571e-01   +4.993724467469256e-01   +9.001605407787765e-02   +6.378238139065600e-01   +2.553485989233134e-01   +4.749413539325806e-01   +6.161121787497805e-01   +2.802093484006481e-01   +5.918971221478174e-02   +2.380017277440859e-01   +7.559728589088500e-01   +7.135704985451004e-02   +4.120754013435691e-01   +3.919550266492850e-01   +1.645552325304843e-01   +7.147398822281792e-01; +7.849331351069223e-03   +1.895792866076242e-01   +8.217443800963276e-01   +2.158065823510898e-01   +2.999729052827729e-01   +8.763600270671841e-02   +7.820310012354363e-01   +1.445379061991851e-01   +6.608257279134175e-02   +5.310727365842177e-02   +1.275996755148265e-01   +4.881584199733252e-01   +3.769950920831411e-01   +7.478358115516156e-01   +4.683999581600050e-01   +7.140157671299198e-02; +4.541122700530738e-01   +6.324474096562765e-01   +7.094155963287545e-01   +7.479666439314446e-01   +4.236776829280110e-01   +2.835392576752457e-02   +1.849953401668377e-01   +7.596463047137147e-01   +7.282331880806849e-01   +1.092489164816635e-01   +1.170691062504741e-01   +6.542809416787065e-01   +6.347094039235647e-01   +4.568281894097274e-01   +2.252632374270146e-01   +6.739875654013939e-01; +4.511927505257419e-01   +2.072959401882786e-01   +6.597544665390623e-01   +5.156321312957934e-01   +3.057926411542754e-01   +3.791551061758467e-01   +3.234326874493689e-01   +1.973780920213939e-01   +6.405793788463160e-02   +5.131613404509633e-01   +6.644720248571844e-01   +4.821044656129845e-01   +1.735381561123177e-01   +2.612697044113683e-01   +7.572929840496784e-01   +4.200692710166012e-01; +2.048985296651696e-01   -4.282894031288628e-02   +4.695051391431059e-01   +1.469946199980569e-01   +3.761841419267997e-01   +1.867463780961850e-01   +2.007862715417539e-01   +6.613400991981956e-01   +5.801747626256992e-01   +7.449207363908763e-01   +7.461824000322094e-01   +4.494313087993720e-01   +4.996945649538708e-01   +1.612058059507572e-01   +6.508815937307698e-01   +1.542797008568626e-01; +7.985584860578459e-01   +5.623505615394675e-01   +6.241731890692334e-01   +2.726865734239187e-02   +3.488367331965799e-01   +5.846326035201675e-01   +2.862076029189926e-03   +7.115231113727910e-01   +6.225051557558341e-01   +3.829047420046730e-01   +2.453991559394380e-01   +8.337698302920932e-01   +9.392859618223423e-02   +5.849219395801661e-01   +7.821196811045222e-02   +7.034632604841143e-01; +1.128694857474544e-01   +4.674943598662285e-01   +6.993892596605962e-01   +4.760795759340856e-01   +6.317274984216699e-01   +2.625370137413202e-01   +5.153508796589853e-01   +2.033489578756867e-01   +9.508006998548077e-03   +1.255821370434862e-01   -4.935587255313450e-02   +6.707314228902732e-01   +6.374651428970174e-01   +7.050579368759700e-02   +6.237381689431128e-01   +1.624473399297053e-01];
L1E_L1I_iGABA_netcon = [+1.074123249791391e-01   +6.796045892540734e-01   +4.911462179150094e-01   +2.895870287256753e-01   +3.482180929646435e-01   +5.158988881363483e-01   +1.976105398450185e-01   +4.545163329001171e-01   +7.189913668741631e-01   +6.989304396500116e-01   +4.914733961842767e-01   +2.884483344190123e-01   +5.362087277398409e-01   +9.077039428541023e-02   +2.252768280590147e-01   +9.705845969313549e-02; +3.141664575162945e-02   +3.552493954499991e-01   +3.882641975220107e-01   +7.285140709981165e-01   +7.657924147309440e-02   +6.633877411507854e-01   +2.792215652523019e-01   +5.149404134373229e-01   +2.083283469527374e-01   +4.721902602841299e-01   +8.051756479978277e-01   -1.002407533977443e-02   +7.645739320810222e-01   +4.792488337644275e-01   +1.013711140506567e-01   +5.385494188959029e-01; +4.288685175361879e-01   +4.133544686346345e-01   +1.376044871297730e-01   +6.283777410545455e-01   +5.284904253596294e-01   +7.021644584102280e-01   +3.423958003431856e-01   +7.840065653965627e-01   +1.687820137927555e-01   +2.480009769257802e-01   +7.449242511948030e-01   +5.763756994676568e-01   +2.024688767813424e-01   +5.164431094335579e-01   +4.973596305009229e-01   +6.451720989049785e-01; +7.349101306546959e-01   +1.624039764836934e-01   +5.208742878728140e-01   +7.219733674254816e-01   +5.310941182067209e-01   +7.581169262938670e-01   +5.860262612434471e-01   +8.328821129251036e-01   +4.723391668623778e-02   +8.182819708523235e-01   +6.591846208215972e-01   +1.211953796951903e-01   +2.017664703367947e-01   +3.741878725470685e-01   +4.658772491266741e-01   +4.117661953447869e-01; +7.046412798353493e-01   +4.540769671211188e-01   +2.312215890924920e-01   +1.377419682433319e-01   +1.699618712140645e-01   +4.787042052330784e-01   +6.380029667484810e-01   +3.137042179643998e-01   +6.984189861975930e-01   +3.400382717552122e-01   +1.856973591037391e-01   +7.990135833188081e-02   +5.605800185140801e-01   +8.201171829454839e-01   +3.286740714701730e-01   +7.249467330952322e-02; +3.664377203701278e-01   +3.362544177329644e-01   +1.221315199432264e-01   +7.579251197592325e-01   +3.231390883309889e-01   +4.354495190232485e-01   +6.936616798506885e-01   +7.186801563598104e-01   +3.192495839180600e-01   +5.853477199176488e-01   +6.957820663093242e-01   +1.323502047350425e-01   +4.884647334469865e-01   +2.224377751306957e-01   +4.847405328516922e-01   +3.037811239384349e-01; +2.706110503088835e-02   +4.702409721899388e-01   +3.747228788369513e-01   +2.263042475057577e-01   +4.651093234692771e-01   +7.544408619660034e-01   +1.194138976244383e-01   +6.639982482592295e-01   +4.872969092821637e-01   +7.128572454206628e-01   +5.274646969864083e-02   +8.084978583355896e-01   +1.118161240511929e-01   +2.183527692134607e-01   +2.863796898055698e-01   +4.717929286494124e-01; +5.223588885909092e-01   +3.966181097539710e-01   +7.524350832996363e-02   +1.591922795632333e-01   +6.537944597858236e-02   +2.317138419132202e-01   +4.827462643942762e-01   +3.119588336814255e-01   +2.869908123872024e-01   +1.131908684088560e-01   +8.306162565894768e-01   +5.334100660746921e-01   +4.119337277102660e-01   +3.800386964276441e-01   +1.803046574299444e-01   +1.890763864617926e-01; +4.016473997971351e-02   +6.518982254145658e-01   +8.154272437063081e-02   +6.572621869365208e-01   +4.479251087008521e-01   +6.146440658250160e-01   +2.834618990512717e-01   +6.488345311060724e-01   +2.989183349152553e-01   +6.733933467854416e-01   +6.101002222836740e-01   +5.015634204132412e-01   +1.548955574206127e-01   +4.915654460720449e-01   +5.116132946076938e-01   +7.276274130095359e-01; +2.339419593254370e-01   +7.187050739390760e-01   +4.376430979416359e-01   +1.593906530495294e-01   +7.313515442187163e-01   +4.370156055969525e-01   +4.909778001912938e-01   +2.309506788457992e-01   +5.149387028932333e-01   +7.675223155396395e-01   +4.888373446261787e-01   -8.665221643175187e-03   +3.289333057945699e-02   +3.236202944496361e-01   +2.756353001699831e-01   +4.828898757019511e-01; +7.695686570456469e-01   +1.930268375442853e-01   +6.493022884185967e-01   +7.509643305587743e-01   +4.909881458299000e-01   +1.931912673883724e-01   +7.460509306675966e-01   +3.984878056607921e-01   +6.385434846936985e-01   +7.028744303385486e-01   +3.673305382354496e-01   +3.440789220103175e-01   +3.412381223219157e-01   +5.129157888084228e-01   +7.166303747387051e-01   +3.688590871831938e-01; +9.346550122370219e-02   +1.341909321919682e-01   +1.146929237893921e-01   +4.090549697672345e-01   +2.052913937204417e-01   +9.293984809194311e-02   +4.441862959002287e-01   +4.300100673381696e-01   +5.554933434532467e-01   +4.408705060285638e-01   +6.047410217981941e-01   +7.360923446278741e-01   +3.873623724686194e-01   +6.311393117588378e-01   +5.878980513531362e-01   +1.465498049384082e-01; +4.587084520186755e-02   +9.298188340867061e-02   +2.893469967196124e-01   +7.374780580357440e-01   +4.868852256576595e-02   +3.668176891945037e-01   +5.553935685304566e-01   +5.076118111638740e-02   +3.709890396312827e-01   +3.455742781052201e-01   +2.055214774450038e-02   +4.889449087053866e-01   +8.174757421439587e-02   +2.425145870358830e-01   +4.068254853881301e-01   +6.905887209847849e-01; +4.347577523375021e-01   +5.897447107812415e-01   +3.446996164884431e-01   +6.292812255168748e-01   +4.924264307618909e-01   +2.276358049656922e-01   +3.210176582607026e-01   +4.505411284751221e-01   +2.741357290942329e-01   +7.423447225143789e-01   +4.661334597539415e-02   +6.330270701199467e-01   +4.133982726248218e-01   +6.869676921341406e-01   +7.234017373263726e-01   +4.496811671807900e-01; +5.597433808584711e-01   +7.431088575460920e-01   +3.251132399427942e-01   +2.148127132510188e-01   +5.168023700505042e-01   +4.619037446446452e-01   +5.366198367274373e-01   +4.921621582804748e-01   +5.600861816508573e-01   +7.041851699892429e-01   +6.777094993769431e-01   +3.011560846268502e-01   +3.483099760741345e-01   +2.005248566531898e-01   +3.548428365768403e-01   +6.840066012657308e-01; +7.452164061957660e-01   +8.928223074519365e-02   +4.014380140517574e-02   +1.680576135906151e-01   +8.814703850038154e-02   +7.468693291770400e-01   +5.250392223892554e-01   +6.148235850028970e-01   +5.554752677721991e-01   +2.421022504840183e-01   +7.075064682547927e-01   +1.408713353699736e-01   +2.605348848627093e-01   +3.427155764183674e-01   +4.901711317458689e-01   +3.038996836056001e-01];
L2I_L1I_iGABA_netcon = [+2.843872105745975e-01   +7.060238313752114e-01   +2.789858340682410e-01   +6.026389748534600e-01   +3.807580208596751e-01   +6.208023501072504e-01   +6.218180685044618e-01   +1.236790700849465e-01; +1.290612895987309e-01   +5.236576185367513e-01   +5.682272962047646e-01   +5.831900919732913e-01   +4.789110273060582e-01   +2.108757265495103e-01   +3.764017594598388e-01   +6.858156668230864e-02; +4.178152236910052e-01   +6.459191769014943e-01   +5.707746972539034e-01   +3.542141621589905e-01   +7.583778823425950e-01   +8.049017618164764e-01   +4.700915422751074e-01   +4.577619450323185e-01; +2.798071279336822e-01   +1.788371874385613e-01   +7.006687174525233e-01   +6.635987878808605e-01   +4.293348414530039e-01   +1.382335687018118e-02   +3.072877898426387e-01   +2.465827660744702e-01; +2.156860252955579e-01   +1.691022730927107e-01   +5.574743064290006e-01   +8.247794348509183e-01   +8.196064536707262e-01   +3.995721493241354e-01   +6.648460942010301e-01   +9.015417546189172e-02; +4.627531538500538e-01   +6.849870771444158e-01   +1.836092272423641e-01   +6.328307791357826e-02   +8.294422414635580e-01   +4.899979082744373e-01   +4.633315070466807e-01   +9.012592814288622e-02; +2.688905823224862e-01   +1.196930021529488e-01   +6.665209044988910e-01   +4.557911976151107e-01   +2.411893731824589e-01   +5.803707496128886e-01   +6.143095193208176e-01   +7.954037134630269e-02; +7.473017354259376e-02   +6.333427122717062e-01   +4.724516368596895e-01   +4.839032242009030e-01   +4.130714349546092e-01   +7.433173406074576e-01   +1.503467764797016e-01   +3.746433278211281e-01; +4.035016740805286e-01   +2.457896730003079e-01   +7.658800334797439e-01   +2.002771327693552e-01   +2.718127887234790e-01   +2.180002526141756e-01   +7.621927861118913e-01   +1.958565867915900e-01; +1.795886530940816e-01   +6.289330799828864e-02   +3.542471127572924e-01   +6.050991351070019e-01   +1.134871559720206e-01   -4.030529218075714e-02   +3.541662382871404e-01   +1.355993804363946e-01; +7.875981918736247e-02   +5.096576257822721e-02   +4.708747758568827e-01   +3.452309805658876e-01   +3.859429662752080e-01   +8.011912645560731e-01   +1.625639815597802e-01   +4.031743091985886e-01; +3.875218006814887e-01   +5.044101113054564e-01   +7.569976860923360e-01   +1.980031956779879e-01   -3.826157148552615e-02   +7.860562925937689e-01   +1.818740924843166e-01   +3.645074334851020e-01; +5.191586765115914e-01   +1.241384970132556e-01   +2.406207124516405e-01   +2.513323506609431e-01   +9.625911512087121e-02   +4.594293619514791e-01   +2.580652163206040e-02   +3.165623296911372e-01; +2.518639031762694e-01   +1.659752315686451e-01   +5.821408601918026e-01   +7.211980838838385e-01   +7.492297848556135e-01   +5.196522507041679e-01   +4.091227837349401e-01   -2.412767693827714e-04; +3.874952891521199e-01   +6.489939460521560e-01   +8.521018964601066e-01   +5.327753909850524e-01   +5.816533872999976e-01   +9.932263397873811e-02   -2.420611803409993e-02   +7.903079454830673e-01; +7.319184193474784e-01   +4.765814561133547e-01   +8.101791178478749e-01   +6.541161306430596e-01   +1.681030182873731e-01   +7.937624949982300e-01   +4.704805685685944e-01   +4.831276055123735e-01];
L1I_L2I_iGABA_netcon = [+5.808336728048976e-01   +6.679439052286404e-01   +6.347859675830717e-02   +1.344971036874570e-01   +1.312689547883678e-01   +5.040794532321053e-02   -3.413311360903492e-02   +2.897092315363149e-01   +3.463913996458760e-01   +3.581508227469220e-01   +7.850503821827554e-01   +1.452825697194974e-01   +4.801508218840188e-01   +4.123380589037439e-01   +5.601185980614050e-01   +7.675028605685003e-01; +4.016504586142650e-01   +4.026050895252260e-02   +7.673000572020461e-01   +4.119736870818818e-01   +5.963231375068131e-01   +2.910529287037769e-01   +8.005471890825316e-01   +6.955848848008448e-01   +5.010079548229122e-01   +2.382358113948326e-01   +8.257982992941322e-01   +6.704416133430527e-01   +1.422083054682593e-02   +2.884028941298699e-01   +6.018830659693608e-01   +4.817346912265898e-01; +7.446906344838017e-01   +4.880345608681794e-01   +3.557004457775608e-01   +7.390857222866194e-01   +2.250279015200553e-01   +4.301875745066632e-01   +4.873708748857469e-01   +4.308427974858594e-01   +4.593667201275642e-01   +6.998553109467585e-01   -1.962096207988859e-03   +5.862716107283625e-01   +6.073312307703593e-01   +6.684162988346078e-01   +1.736642846065937e-01   +3.115281822419339e-01; +8.416774914423493e-02   +2.794188828074997e-01   +1.890814279510883e-01   +4.452671807069921e-01   +1.801002677610566e-01   +2.096368020256833e-01   +5.786431948237112e-01   +7.151081352412739e-01   +2.092805342413014e-01   +4.545613696069688e-01   +7.162672742474633e-01   +5.530018928577580e-01   +7.222654372224473e-02   +7.099370863514028e-01   +6.056891726866269e-01   +7.441686303670254e-01; +7.578780031308922e-01   +6.149877251073167e-02   +4.774827239755941e-01   +5.047716338571987e-03   +6.560760240904834e-01   -4.456211224147684e-02   +5.518494960196517e-01   +3.912829720143470e-01   +5.509591145883075e-01   -4.284822760651594e-03   +6.999882096803330e-01   +6.865487608131705e-01   +2.269681247957903e-01   +2.046044766647328e-01   +2.329216952181990e-01   +3.239274567437763e-01; +4.824387736482338e-01   +2.225443773923791e-01   +2.228339267766351e-02   +5.252155589127860e-01   +4.997060436016130e-01   +4.411136265291823e-01   +4.599611464937964e-01   +3.606217292283811e-02   +2.200169735682006e-01   +1.177445615742578e-01   +3.528454454978295e-01   +5.703592570645653e-01   +2.655621418550102e-01   +5.760380470791927e-01   +4.252531767593778e-01   +2.692555705281391e-01; +9.057270633943049e-02   +8.096654560699362e-01   +9.858880444119186e-02   +4.985003023300523e-01   +4.263280956052058e-01   +7.982786609054352e-01   +6.953473198488337e-01   +2.540392952695125e-01   +4.521369250550297e-01   +6.700888265675242e-01   +3.664230093482022e-01   +7.598021525946133e-02   +1.754667525996614e-01   +7.899505647488321e-01   +2.958046944605652e-01   +8.408166459353917e-01; +7.574710835983081e-01   +4.261548205857581e-02   +3.671422975992741e-01   +2.940663702923041e-01   +1.317684368929273e-01   +6.928657848394641e-01   +1.216656794289943e-01   +4.471569459022891e-01   +2.872320752996482e-01   +1.631160241428171e-01   +2.137076316978649e-01   +5.269646525529803e-01   +4.881960362386713e-01   +1.714041700114441e-01   +1.116105519868598e-01   +1.897326199139940e-01];
L2E_L1E_iAMPA_netcon = [+2.155536415796067e-01   +4.353998804956764e-01   +2.250190808007666e-01   +4.404789350880889e-01   +6.975957805174795e-01   +3.592414841154734e-01   +2.560100331745339e-01   +5.755732387834855e-01; +7.190231830377204e-01   +5.885705979388175e-01   +2.605552439226277e-01   +6.647827042788206e-01   +7.013979049563688e-01   +3.616041951650772e-01   +1.400191200204817e-01   +3.700285702701604e-01; +5.860501071391693e-01   +6.982728424500859e-01   +6.500985644578504e-01   +7.174657592746494e-01   +6.600552023557378e-01   +2.707708650370336e-01   +5.267267636018838e-01   +2.325065305504033e-01; +1.299083339138814e-01   +1.484877316628228e-01   +5.615093260053453e-01   +5.382344183244453e-01   +1.353985889608263e-01   +1.343150732432052e-01   +3.084689571987395e-01   +3.527161157344936e-01; +3.318034094975139e-01   +1.414382354628908e-01   +7.126176776273395e-01   +6.617466060898812e-01   +6.629986876382198e-01   +5.389902125669751e-01   +7.021967649145452e-01   +4.194052434560877e-01; +9.819448612947956e-02   +8.024310330559717e-01   +1.663423029461794e-01   +3.044028056056545e-01   +7.521781147229523e-01   +5.667469117310577e-01   +6.423723455016019e-02   +6.417160759022872e-01; +7.418156849417001e-01   +6.756196340064159e-01   +5.500332558525187e-01   +3.451994311101322e-01   +7.253454155448018e-01   +3.256404928638930e-01   +4.274160638038150e-01   +7.377284896638737e-01; +6.241727666818787e-01   +6.473427174403715e-02   +3.276250621872046e-01   +5.430234735832334e-01   +3.898965860393531e-01   +2.047937146851256e-01   +5.801342485936223e-01   +5.893225842503412e-01; +1.029350274146828e-01   +2.354416649050119e-01   +4.091429357739071e-01   +1.817789564279089e-01   +5.124332643406584e-01   +3.357431772075280e-02   +4.340237092100088e-02   +4.943399283451253e-01; +2.823361344393939e-01   +2.561323363073355e-01   +4.646053542257269e-01   +7.665577537202297e-01   +1.314254445884917e-01   +6.756101608082377e-01   +4.673899981400363e-01   +2.622121844357714e-01; +5.707808469380593e-01   +2.798908114953381e-02   +4.649945651003121e-01   +8.692523812900499e-01   +5.098534956052452e-01   +3.550225229707752e-01   +2.083178331338735e-01   +7.251697893316876e-01; +1.429443610874189e-01   +2.915266566600206e-01   +6.678200225057468e-02   +3.895483597194825e-01   +6.711842954791800e-01   +7.449752523221062e-01   +3.126182446027652e-01   +1.012341845171424e-01; +4.832510002308219e-01   +2.806418487871145e-01   +2.121492244763422e-01   +6.691559092672756e-01   +4.442551986977720e-01   +3.915466669184492e-01   +2.575902262361506e-01   +3.767588192800085e-01; +7.386660420827359e-01   +1.968854172412187e-01   +3.880226506318304e-01   +4.947854932997640e-01   +4.347533768695531e-01   +1.871300438198116e-01   +4.244982772682681e-01   +1.924386874706366e-01; +3.263308926016978e-01   +3.200009440920477e-01   +3.407647626995067e-01   -3.064099389652612e-02   +3.858649831548366e-02   -5.815562378549954e-02   +8.207295894253844e-01   +3.343817634172762e-01; +7.487950639884439e-01   +7.556291377494763e-01   +7.505858936873652e-01   +6.357626582525790e-01   +1.057311691441384e-01   +1.184086870770617e-01   +2.769769797195228e-01   +7.046062180514640e-01];
L1E_L2E_iAMPA_netcon = [+7.274401698841485e-01   +4.315598605768426e-01   +3.515055122539672e-01   +2.810468479205833e-01   +3.883167749227914e-01   +3.936684696966170e-01   +2.995474405752415e-01   +5.526594389664088e-01   +3.302799599288138e-01   +7.545923349599976e-01   +8.236630673584652e-01   +5.353291209212225e-01   +1.246701400259307e-01   +1.531608573837889e-01   +2.240097766488628e-01   +6.287347952182842e-01; +7.537405980642543e-01   +6.986384643893384e-01   +6.631829627570127e-01   +2.104771974564601e-01   +4.686512215252024e-01   -2.826797253103267e-02   +1.388697628033400e-01   +5.889529796439030e-01   +2.136912061850839e-01   +5.788788102273550e-01   +6.419776777091508e-01   +5.253316163010905e-01   +5.365683577211597e-01   +7.126335596155124e-01   +6.668420233929306e-01   +1.688835173374885e-01; +7.832455974750743e-01   +7.072914461905144e-01   +2.156723652043105e-01   +3.725814787574434e-01   +7.229652632232254e-01   +5.065681974297067e-01   +9.057035816820867e-02   +4.500108242337614e-01   -3.765001516379241e-02   +9.409667031035823e-02   +6.444129622635750e-02   +7.302548258781089e-01   +6.535706021126684e-01   +3.360478533997863e-01   +6.648446896388259e-01   +8.302792648493539e-02; +2.091286187703182e-01   +4.237793107608271e-01   +4.893849776946852e-02   +7.104693173637650e-01   +3.204235991546679e-01   +7.217858353223899e-01   +3.479101715768377e-01   +6.657418085104113e-01   +7.399069998355690e-01   +5.398467879687508e-02   +3.675712938271965e-01   +1.644374110254789e-01   +7.678808855530388e-02   +1.932354758083788e-01   +7.301455612622714e-01   +6.685060769600686e-01; +6.971038848792999e-01   +6.355254248036590e-01   +7.445321228651303e-01   +7.003765858338293e-01   +3.796551986104265e-01   +2.376122307444228e-01   +2.222614853807008e-01   +3.634235905774993e-01   +3.444337327213345e-01   +5.403110021756726e-01   +4.219243143695882e-01   +4.143031933433479e-01   +2.274719704089187e-01   +3.127841328752698e-01   +7.220552880774486e-01   +3.334156258369610e-02; +3.164832418918366e-01   +5.306492185963968e-01   +8.168772920336934e-01   +5.236973470654237e-01   +7.138344341781039e-02   +1.515739912014412e-01   +3.833487598046964e-02   +1.390181260738430e-01   +7.375511494676829e-02   +1.949796448007280e-02   +1.151432571247569e-01   +2.011823643678119e-01   +6.917974731813337e-01   +7.302071123908205e-01   +6.192490601601816e-01   +2.791418922242135e-01; +3.790174441282826e-01   +1.994857255579311e-01   +3.052072663073876e-01   +1.319617684591609e-01   +7.928581892383032e-01   +7.351928755563694e-01   +5.740867151652455e-01   +6.151729838524884e-01   +3.625290022579788e-01   +4.465201011642927e-01   +3.045128320525486e-01   +2.337561359601322e-01   +1.097862852766922e-01   +2.108438560530647e-01   +2.906867168654085e-01   +2.784246276629097e-01; +6.718099907843695e-01   +2.937226329430741e-01   +3.756556465969224e-01   +5.981714086530809e-01   +6.886658953523392e-01   +7.949931000432566e-01   +3.547921564224139e-01   +3.699512503641384e-01   +6.167824853175971e-01   +1.942167163307487e-04   +2.436161524349725e-01   +5.248296022876318e-01   +1.273671179497323e-01   +5.791003800819969e-01   +4.695155242512958e-01   +3.973505796092374e-01];
L2I_L2E_iAMPA_netcon = [+7.042948514803593e-01   +4.153816005316275e-01   +6.430769327808143e-01   +2.813796826841618e-01   +2.021161138298599e-01   +3.264229153634886e-02   +5.095783024295521e-02   +3.940972730996239e-01; +6.691803007318187e-01   +4.864264871706427e-01   +7.215897478692790e-01   +2.796051266959129e-01   +4.952107912705928e-01   +8.374865943099957e-01   +6.226225271931475e-01   +2.565130973352951e-01; +6.259051786227945e-01   +4.074007994619200e-01   +4.827601453853190e-01   +7.273507365296097e-03   +5.692347356614897e-01   +3.343077960998767e-01   -2.083112524007959e-02   -4.217996279319170e-02; +2.132509969145777e-02   +2.625879187767590e-01   +1.510758865265914e-01   +7.713383874017734e-01   +5.400975582410403e-01   +4.605173993419215e-01   +2.289408334355437e-01   +1.589047314052918e-01; +3.596416684625082e-01   +4.605256925472055e-01   +5.530710184511478e-01   +8.358984839075141e-01   +2.486699161579600e-01   +2.627757147041216e-01   +6.025013577615831e-01   +4.621515395609308e-01; +1.866553714729573e-01   +5.406187506301674e-01   +3.607182945073561e-01   +3.682907533133166e-01   +2.168233660967576e-01   +4.234807345476724e-01   +3.177012920734048e-01   +5.886935707822685e-01; +7.612622202123281e-01   +2.507495500835690e-01   +8.730664617064615e-02   +5.817774799941927e-01   +1.809588692305436e-01   +9.253060255023718e-02   +4.466351907795348e-01   +1.431284935662315e-01; +3.918339914541975e-01   +4.392059131159907e-01   +6.732936832119094e-01   +6.989590823416366e-01   +2.543920228282495e-03   +2.308906105722884e-02   +3.233729786331689e-01   +8.171051691004133e-01];
L2E_L2I_iGABA_netcon = [+7.477809340789268e-01   +3.568683734549549e-01   +5.507847302943729e-01   +7.606246571467126e-02   +3.337034827962711e-01   +7.602152965819750e-01   +4.940271292613993e-01   +1.724345247472363e-02; +2.459460005944856e-01   +6.588184251631943e-01   -2.285366149384632e-02   +2.662751957116778e-01   +5.355157785690445e-01   +6.081464211259172e-03   +5.069605311630916e-01   +1.896187609091754e-01; +6.326573130783990e-01   +2.250833160868899e-01   +1.150302973618181e-01   +7.757455472472700e-01   +2.213385368955241e-01   +4.236694771563384e-01   +6.522614742025896e-01   +1.445565781173813e-01; +6.079944401267006e-01   +5.839280252870618e-01   +6.137190155080717e-01   +4.890138649802375e-02   +8.978176028051418e-02   +3.060902930442361e-01   +6.996256260981411e-01   +6.223379102381760e-01; +4.317911040941537e-01   +9.243042089731246e-02   +5.803766429119408e-01   +4.449661202277886e-01   +3.490332006809184e-01   +7.937614395331312e-01   +2.866675067452988e-01   +4.257353063794714e-01; +4.398087611585841e-01   +4.027401848716777e-01   +2.604024655595470e-01   +4.801936494531288e-01   +6.887864019820467e-02   +7.759523052611946e-01   +4.483996948933396e-01   +2.948781304472966e-01; +4.463288283593531e-01   +5.696817993230113e-01   +1.270390071168786e-01   +1.600329628267372e-01   +4.285088699162450e-01   +6.129316037573584e-01   +2.087271494686133e-01   +5.762355402068036e-01; +1.637450477988617e-01   +4.969143305842392e-01   +1.778254402995118e-01   +1.882157595114334e-01   +1.137573674016743e-01   +5.857339841322929e-01   +3.581687530336559e-01   +4.941996637362849e-01];
L3E_L2E_iAMPA_netcon = [+3.638014817704916e-01   +5.249567986921488e-02   +8.287555685402069e-02   +7.916316535927003e-01   +6.570054949263260e-01   +7.738327170215569e-01   +4.453806813074765e-01   +1.202643919343872e-01   +7.037882047189395e-01   +3.020871655112664e-01   +6.746510130211323e-01   +2.317910035511075e-01; +3.101693011953338e-01   +7.320438656563847e-01   +6.869135633070398e-01   +5.292368848106018e-01   +3.790982209198260e-01   +2.920652241456180e-01   +5.518705637483933e-01   +4.787974630501669e-02   +1.545968801913315e-02   +5.254346634989498e-01   +4.220196390254886e-01   +5.505755116046417e-02; +2.431139658299388e-01   +5.601306282414263e-01   +4.796114697821452e-01   +2.723688584781865e-02   +3.188938062195770e-01   +6.735979114860107e-01   +2.475951635135734e-01   +4.132797897566033e-01   +6.250383652766173e-01   +6.915713438280799e-01   +5.385145372679073e-01   +9.688264428753610e-02; +4.756548526068585e-01   +2.033624681390052e-01   +6.816918891343947e-01   +1.214917988470613e-01   +3.051678039871505e-01   +3.775958875127499e-01   +7.083270828246025e-01   +1.079468727970223e-01   +2.282617114182096e-01   +6.535909855200644e-01   +3.639415100393065e-01   +3.903818686589928e-01; +2.429685821613101e-01   +5.798493545888505e-01   +8.631028134678881e-02   +7.018189363265940e-01   +5.197867618926663e-01   +5.331533837465102e-01   +7.261859141737311e-01   +8.679120663397749e-01   +2.490573563992400e-01   +2.534375063213642e-02   +5.516825884180314e-01   +2.786435772314702e-01; +2.948283135602880e-01   +6.112955423837982e-01   +1.340619383022952e-01   +7.396062918441612e-01   +4.059700869780457e-02   +5.952042000082058e-01   +5.105141351895227e-01   +7.408846439848928e-01   +8.371002766415047e-01   +3.688125943927433e-01   +1.081121839038722e-01   +4.459930048955025e-01; +6.710706647204115e-01   +6.454366663309696e-01   +7.102267917376405e-01   +3.224247478650320e-01   +6.548136625252965e-01   +4.178723611364243e-01   +7.347226045123576e-01   +5.972459395156178e-01   +1.212870664723027e-01   +5.174605063326082e-01   +5.594216223269293e-01   +4.315850302152878e-01; +3.192277380409435e-01   +1.131066667283933e-01   +3.592510813630769e-01   +1.778315817355918e-01   +4.355715991794488e-01   +2.404387061732333e-01   +3.095492963568966e-01   +3.452101364914896e-01   +5.525240691330338e-01   +1.326939728205411e-02   +5.136299668203270e-01   +4.459920800288578e-01];
L3I_L2I_iGABA_netcon = [+2.786527802505074e-01   +3.419013361254133e-01   -3.204261237223142e-02   +8.230663641659344e-01   +4.249331913950157e-01   +1.835704326752196e-01   +5.713251372345471e-01   +3.724437473481640e-01   +3.689943163327688e-01   +2.898326027153076e-02   +3.274450939899732e-01   +5.368385617931624e-01; +1.107330737855878e-01   +5.717727449952872e-01   +8.302293283247653e-01   +7.324238039679437e-01   +3.791362090655796e-01   +3.133989183397978e-01   +4.741707447561643e-01   +5.833286094272560e-01   -9.634391938883061e-03   +6.422012944807540e-01   +8.373662680475792e-01   +2.704598369852100e-01; +3.176577335089872e-01   +4.538108424731063e-01   +5.527655755199462e-01   +8.218443793731432e-02   +2.013618767170039e-01   +6.002310848516427e-01   +5.773180403822824e-01   +6.859324469262065e-01   +4.833578918426153e-01   +8.670778809174555e-02   +2.075736412877875e-01   +5.648208062280352e-01; +4.430268020520272e-01   +4.193255442999501e-01   +2.478008613591952e-01   +4.985133799998223e-01   +3.784670598594092e-02   +2.401509706284550e-01   +5.357970915932412e-01   +8.133225993399056e-01   +4.254892514015309e-01   +8.183523285973264e-01   +5.431219932318310e-01   +2.061003383726528e-01; +3.438258886182973e-01   +5.105378076937358e-01   +4.117944159554267e-01   +5.977821090403908e-01   +8.910786598266554e-02   +7.622652757104890e-01   +1.077634452228366e-01   +5.171132599221846e-01   +4.098453663743875e-01   +3.721450956215309e-01   +5.755131932525495e-01   +6.550761921312509e-01; +6.719630949263252e-01   +7.507211851273673e-01   +6.098578452428818e-02   +3.933081133814115e-01   +7.617451337734320e-01   +1.427646062516725e-01   +6.524196838112103e-01   +9.934969746277890e-02   +3.980318753872506e-01   +2.588762411980177e-01   +1.889406809272335e-01   +2.648410511958983e-01; +4.337935268745335e-01   +1.982161922987881e-01   +5.548683792531189e-01   +7.144089297388004e-01   +1.735079841710578e-01   +4.883340038162098e-01   +4.062013062331299e-01   +3.043735890841220e-02   +7.729110067447524e-01   +4.424333960936147e-01   +2.534014106806617e-01   -2.582665033838000e-04; +5.122864129936006e-01   +2.676178870601866e-01   +2.030583112714910e-01   +3.801617732654194e-01   +4.973102449057576e-01   +5.956771631298874e-01   +7.331234196040116e-01   +4.947449979522308e-02   +5.229675105497306e-02   +6.570828399466869e-01   +2.684442304657974e-01   -5.344205458305644e-02];
L2E_L3E_iAMPA_netcon = [+4.068075814953261e-01   +3.887880279743371e-01   +2.570763779180890e-01   +6.864861001793374e-02   +2.682168235776866e-01   +8.669148183653634e-01   +6.458128026696100e-02   +1.729546593957401e-01; +7.789305789014602e-01   +2.048680238323982e-01   +8.905747523366080e-02   +2.229714423411183e-01   +6.497616188523109e-01   +3.398238727261995e-01   +1.086981823816457e-01   +5.530080896878100e-01; +3.404415384621264e-01   +6.367680657156182e-01   +4.421227581391333e-01   +3.486020590783857e-01   +8.186113557178526e-01   +7.260919851383751e-01   +5.720774829692412e-01   +6.232299704304187e-01; +4.829992815891708e-01   +4.091075842545778e-01   +4.445743730273949e-01   +6.824196841066003e-01   +6.827104177346288e-01   +6.094186127433570e-01   +6.370422303617735e-01   +6.304366212042737e-01; +2.876127068709726e-01   +5.818293318333270e-01   +4.045470779159906e-01   +5.063062230757877e-01   +2.796657814619717e-01   +6.662242993895816e-01   +2.453223081019891e-01   +2.433567124906257e-01; +6.599271521813421e-01   +2.799007080054263e-01   +7.014346298164738e-01   +6.992331646015704e-01   +2.777371613750322e-01   +4.800534939199849e-01   -1.873363910224070e-02   +2.313204569408299e-01; +5.554059471269241e-01   +5.960090139056756e-02   +3.505858003214292e-01   +2.001110629507508e-01   +3.772508688557381e-01   +4.495064829088742e-01   +1.814012475264155e-01   +2.749263438900619e-01; +3.323643479853773e-01   +6.110093899581155e-01   +4.405222546831417e-02   +4.285683224891702e-01   +9.444220582629477e-02   +3.784083572114755e-01   +4.031572834974596e-01   +4.218646880074409e-01; +1.220485152918987e-01   +3.453903111198848e-01   +6.317308715815533e-01   +2.732162593220647e-01   +2.751526493394805e-01   +5.692800306141088e-01   +2.870200829157261e-02   +3.329091919889052e-01; +4.478167153674952e-01   +6.002354520505753e-01   +1.288970892088796e-01   +5.735958376552204e-01   +2.111027311112579e-02   +2.764363239567864e-01   +1.752569325788188e-01   +1.197000388765684e-02; +3.597544483415765e-01   +1.197811259305910e-01   +5.944736898932064e-01   +3.872418888395317e-02   +1.932897923785275e-01   +9.291021118651285e-02   +4.368919525377699e-01   +4.977351609988946e-01; +7.144670488589908e-01   +5.897338998784402e-01   +3.325046058428172e-01   +5.958285135578449e-01   +5.969544557308913e-01   +7.090588298139759e-01   +3.780768040108621e-01   +5.797673233069124e-01];
L2I_L3I_iGABA_netcon = [+6.491328398327884e-01   +4.774474856571197e-01   +4.679972375621826e-01   +2.153445274372799e-02   +1.680306844387520e-01   +8.013225984968952e-01   +6.467942483608820e-01   +1.126723533735892e-01; +1.799953490736892e-01   +7.248252593458333e-02   +3.371545767942121e-01   +7.098027469300608e-01   +4.739368290336960e-01   +7.318531745071272e-01   +4.277177284933647e-01   +4.831682999359271e-03; +5.592322651530716e-01   +2.136425195948257e-01   +2.983068799434340e-01   +2.935977165951029e-01   +7.267094182245453e-01   +6.120171710419652e-01   +2.176914145980343e-01   +7.905529682697346e-02; +2.294959951655382e-01   +4.819265346258408e-01   +1.154544698283912e-01   +1.294074179704389e-01   +5.612446425800354e-01   +8.059686984397407e-01   +4.476461391231023e-01   +1.951202666008444e-01; +4.774183788479862e-01   +3.595325780012855e-01   +1.409827351127831e-01   +4.195820745113621e-01   +1.335862758698652e-01   +3.046360840209374e-01   +1.483558375337955e-01   +3.599532099325549e-01; +4.522145939293554e-01   +5.478436144286957e-01   +6.198576084034115e-01   +6.176126683433565e-01   +3.007102598111892e-01   +4.338575356656993e-01   +7.167452935315026e-01   +3.320443104490371e-01; +2.065675857025993e-01   +2.280460241299143e-01   +3.917402532250746e-01   +5.232061683003228e-01   +5.016438004979366e-01   +2.326369966770887e-01   +3.588536975811949e-01   +5.158609172409407e-01; +5.673864059018450e-01   +6.062096228760699e-01   +7.147797481878720e-01   +7.706290599543588e-01   +6.528223365212731e-01   +1.020514395637172e-01   +3.789095094634136e-01   +5.579947880672217e-01; +5.921549104585090e-01   +4.685295861708630e-01   +2.362725650981728e-01   +6.988100347420024e-01   +3.773481992497986e-02   +1.739433783084691e-01   +2.264359582020710e-01   +1.183994678413079e-01; +1.121127028089262e-01   +3.015350854262991e-01   +5.183891969462460e-01   +6.970705595372727e-02   +3.662475154525157e-01   +6.654966858707476e-01   +7.438189464212775e-01   +8.117756376527203e-01; +6.750418153770120e-01   +2.276389425267313e-01   +6.409604443504828e-01   +4.311356282433861e-01   +6.582737824316109e-01   +4.034531975571679e-02   +3.752603735037506e-01   +2.732381388687570e-01; +4.573111810605208e-02   +4.883858562718575e-01   +6.763781711929386e-01   +6.283322156225092e-01   +7.880453949554325e-01   +2.916001001482166e-01   +7.445208458466337e-01   +7.796278746672206e-01];
L3I_L3E_iAMPA_netcon = [+2.237429954343233e-01   +9.617061727039128e-02   +6.008853880249354e-01   +5.610464831757568e-01   +3.251102097015151e-01   +2.708648752412435e-01   +4.075176543061562e-01   +2.386940426209445e-01   +6.970242874033793e-01   +7.166788826606452e-01   +3.086277643377330e-01   +6.356072409389888e-01; +3.490403174671279e-01   +7.588902833404731e-01   +2.337741666397624e-01   +5.295373975537184e-01   +6.253636700297796e-01   +8.470072749842254e-02   +4.467189307790466e-01   +1.744862174431193e-01   +1.477614256853774e-02   +4.551846522985257e-02   +5.307643136356590e-01   +4.020993578270106e-01; +1.368612305217725e-01   +2.611951118116785e-01   +1.113068713848008e-01   +3.325111171918143e-01   +1.814822628818848e-02   +5.955452859809610e-01   +6.379522891273879e-01   +6.703050044150947e-01   +3.044052029596063e-01   +5.013401220355782e-01   +3.380156752859594e-01   +4.354080405148140e-01; +6.989180033061541e-01   +6.410599467270545e-01   +7.525889115329260e-01   +5.061593699459802e-01   +6.621507726654423e-01   +5.202774166332067e-01   +1.479437921118568e-01   +3.267566010849449e-02   +6.627419263898597e-01   +5.036265928715652e-01   +5.089395320738521e-01   +7.867491784810086e-01; +8.325549897810498e-01   +5.971224149384187e-01   +3.674687133825807e-02   +6.333440364975811e-01   +6.589277856495486e-01   +2.604397118344010e-01   +4.244207108581315e-01   +3.487535847410095e-01   +7.284597101720525e-01   +8.153832922547863e-01   +7.092020659912411e-01   +5.157391215361499e-01; +1.104752346328310e-01   +6.302251111270826e-01   +6.292869933812642e-02   +2.413359455737220e-01   +6.593860925588912e-01   +2.449618603714653e-01   +4.173858258276243e-01   +1.158096662582173e-02   +7.179660432505650e-01   +3.888365631868995e-01   +1.308978763324141e-01   +5.927025515248474e-01; +3.565872149613676e-01   +1.684491978305706e-01   +1.429214500323751e-01   +6.021529812183691e-01   +1.802319477794087e-01   +2.673325299647714e-01   +6.620741371788958e-01   +6.885122900020045e-01   +6.532802380560379e-01   +1.405137079203572e-01   +6.030534648117480e-01   +5.239477817322176e-01; +3.417683440393539e-01   +5.836614648877929e-01   +2.032716557051215e-01   +4.801690771033578e-01   +8.222354550627691e-01   +7.963664285472272e-01   +3.714316728389520e-01   +7.802470835339940e-01   +4.934996202669734e-01   +3.991097427116417e-01   +3.989392360485919e-01   +2.367068553504980e-01; +1.706213851916004e-01   +6.685403786039943e-01   +2.381231503410849e-01   +8.201322285762157e-01   +6.433136044345921e-01   +6.299032140806257e-01   +1.264595097414581e-01   +8.736867766175949e-02   +6.180018091977356e-01   +3.234784530852321e-01   +4.812170947900750e-01   +2.872067450995122e-01; +7.545724806604682e-01   +5.129795161537041e-01   +4.207159520086254e-01   +4.755515603252201e-01   +5.531683655370947e-01   +2.702170102733507e-01   +3.437175712627786e-01   +6.181509322464381e-01   +4.161920495970745e-01   +7.970514084166440e-01   +2.127103807779312e-01   +3.575914066329144e-01; +4.971143342462744e-01   +3.033427206192620e-02   +2.997897230047805e-01   +3.388725714151025e-01   +4.778878882647985e-01   +1.268594579420518e-01   +4.065498738140903e-01   +7.171127014908290e-01   -1.248615066947236e-02   +1.390178359468378e-01   +1.742958183236213e-01   +2.738979792811677e-01; +5.318928675277425e-01   +3.544953240993777e-01   +6.698804236115801e-01   +1.409160705148120e-01   +4.234312840971569e-01   +5.136560814721084e-01   +1.103210406403182e-01   +5.233917288584042e-01   +1.498485204805101e-01   +5.368424864476843e-01   +3.829616534247561e-01   +1.909194999655078e-01];
L3E_L3I_iGABA_netcon = [+3.585813716141988e-01   +6.480480289889353e-01   +7.012029353725897e-01   +1.795851204883394e-01   +2.215752788329993e-01   +7.043898728945553e-01   +7.108130291294521e-01   +5.528789017882655e-01   +3.635914809787222e-01   +3.633847295493732e-01   +1.344132772777763e-01   +3.728832289849053e-01; +3.678426358430153e-02   +5.298866057419586e-01   +1.886493646876927e-01   +1.718827011377240e-01   +2.974910359970541e-01   +6.519581640356582e-01   +6.261528913521390e-01   +3.789342864612947e-01   +6.084356020197229e-01   +5.195827766908476e-01   +4.666739490213891e-01   +5.755035917415768e-01; +3.958215014307969e-01   +7.123089702850972e-01   +7.246540378695679e-01   +7.255650096650642e-01   +6.104706560915549e-01   +1.703530096396070e-01   +4.033215669286192e-01   +4.247134413226888e-01   +5.110791880493980e-01   +6.758649361834204e-01   +4.784355137546378e-01   +8.153722890863190e-01; +6.334527009336967e-01   +5.770850378806304e-01   +4.040569827731191e-01   +2.709792571492068e-01   +3.965035396937888e-01   +2.660980244840130e-01   +3.967945052043412e-01   +7.449090365549541e-01   +4.299570376547010e-02   +3.519290557353185e-01   +5.122603187767830e-01   +8.269906079887201e-02; +8.369960575742134e-02   +3.557027426462558e-01   +8.160443949157823e-01   +5.683537963686210e-02   +5.113037300848360e-01   +2.553714303672976e-01   +1.695412835558341e-01   +5.700954996836226e-01   +7.806108896143092e-01   +7.267075732132148e-01   +1.602922231269955e-01   +6.181400140847503e-01; +6.337156568716205e-01   +4.567188163064588e-03   +6.653817719999034e-01   +3.123441299087067e-01   +1.587567298111526e-01   +1.444312593706916e-01   +3.720818066411434e-01   +3.925518568899036e-01   +7.951538210099269e-01   +3.282974770879414e-01   +4.875597910278632e-01   +7.126126861258297e-01; +5.981352391125262e-01   +7.837553612188333e-02   +5.432943330494641e-01   +4.149602135019774e-01   +8.036885093911046e-01   +2.398544143269327e-01   +1.344141859201696e-01   +4.481154202356865e-01   +7.408625398686738e-02   +1.738667674405750e-01   +5.587447205768209e-01   +1.995146403063141e-02; +7.553592232651397e-01   +9.607081106273943e-02   +5.528534998551556e-01   +1.102823299066470e-01   +5.873613447094858e-01   +6.497477225541418e-01   +4.401867152382523e-01   +6.143287200779344e-01   +3.004268956423851e-01   -7.305953484686788e-03   +6.203245472868437e-01   +2.946678092956469e-01; +3.993238722029836e-01   +4.618620910253732e-03   -2.341112918463651e-02   +2.541553255927728e-01   +2.147804590585268e-01   +7.128934922629552e-01   +6.880967950828383e-01   +4.124499259342664e-01   +4.587043713091435e-01   +7.498641135304608e-01   +3.250666395420456e-01   +7.574421031756751e-01; +1.309146218975357e-01   -4.340754184218835e-02   +4.464544870533613e-01   +6.869395861813529e-02   +4.202069259261790e-01   +3.541562765667658e-01   +6.462469135342109e-01   +2.397343366206545e-01   +3.976972061281226e-01   +1.787170310923259e-01   +3.302527327238692e-01   +7.138705740836153e-01; +3.435993713522850e-01   +6.761381821809448e-01   +3.301589672517282e-01   +1.194722234205261e-01   +8.477172616566570e-01   +2.394388931476020e-01   +1.877765014323355e-01   +3.804367140770032e-01   +4.571295995783263e-01   -1.026281812736902e-02   +4.627077925968052e-01   +3.668655203785403e-01; +1.074714557215048e-01   -1.109952001777943e-03   +3.123895553005188e-01   +8.037381260444171e-02   +7.017189880215652e-01   +3.274560370531510e-01   +2.641296044515197e-01   +8.408009678591364e-01   +5.605649274849837e-01   +4.983063002052439e-01   +1.612547097457430e-01   +6.842571571721145e-02];
L2E_Input1_iAMPA_netcon = [+2.341661028026554e-01   +2.962667643721943e-01   +3.201442253252714e-01   +7.452480197060282e-01   +7.418096608745093e-01   +3.471507334848590e-01   +3.334977529157385e-01   +5.539016632872572e-01];
L2I_Input2_iAMPA_netcon = [+2.813263361101511e-01   +1.893367702174384e-01   +2.395098180568034e-02   +3.821004558623592e-01   +6.377162095044981e-01   +3.074335800523780e-01   +3.238327935039126e-01   +8.085369441547104e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.6*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.4*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.6*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.4*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.6*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.6*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.4*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.6*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.4*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.6*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
