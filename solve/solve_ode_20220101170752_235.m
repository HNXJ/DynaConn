function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.434924671609585e-01   +2.173592275885384e-01   +1.576693298569924e-01   +8.200806888087953e-02   +2.557289595755364e-01   +2.807491220560184e-01   +9.925665739373346e-02   +2.186148954829104e-02   +3.086650572196234e-01   +1.618160221723786e-01   +1.691720130792173e-01   +1.075990444848630e-01   +3.097314228515501e-02   +1.862615188398085e-02   +3.085460195409511e-01   +2.343550899338376e-01; +5.465739597876254e-02   +3.134747654243982e-01   -5.276248753710648e-03   +3.980650385436875e-02   +2.316639424792418e-01   +1.962126451814880e-01   +5.796229524680335e-02   +3.173243594150605e-01   +2.641367199096317e-01   +2.087501137519827e-01   +1.436670222923576e-01   +3.271362372503881e-01   +2.004517367460447e-02   +1.565179934205849e-01   +1.317255467039203e-01   +5.631243792614696e-02; +3.184309638332348e-01   +3.001955870272005e-01   +1.963362060526852e-01   +8.649974189059934e-02   +1.885595232827031e-01   +9.584451120917009e-02   +7.594174221005856e-02   +1.058694963187293e-01   +2.297696110134935e-01   +1.119595001713328e-01   +3.208596363764518e-01   +1.995759483608187e-01   +1.560598053566379e-01   +2.720503736505552e-01   +2.366097944296650e-01   +2.860253287095936e-01; +1.590792913804222e-01   +4.453874268152506e-02   +8.907155975536390e-02   +6.061514186997302e-02   +6.903433443473270e-03   +1.589451153156695e-01   +9.771635244674848e-02   +8.584739759138385e-02   +9.179783798237763e-02   +2.414416122181756e-01   +3.198004860999598e-01   +5.729828596050671e-02   +1.028940448872643e-01   +2.084206247486353e-01   +1.237824875271654e-01   +5.463739597874182e-02; +3.078954817088702e-01   +1.079556743163652e-01   +2.087971550799604e-01   +1.108871571879793e-01   +2.949644742649621e-01   +2.862108752622592e-01   +6.990325200731172e-02   +2.501082402966787e-01   +9.115527011879403e-02   +2.186907719712494e-01   +7.372507201003732e-02   +2.217994432593930e-01   +2.636172800266554e-01   +2.827196372217989e-01   +2.652580827374930e-01   +2.659711704846972e-01; +3.181890872429781e-01   +1.461649969354884e-01   +3.158078733341231e-01   +1.440310936832857e-01   +1.103352212152533e-01   +1.717517907219514e-02   +1.262219555978334e-01   +1.323689676023960e-01   +6.001530906884141e-02   +1.966602921802552e-01   +7.239861203610687e-02   +1.192448957038243e-01   +2.187144181975091e-01   +2.656434343668407e-02   +1.417180936529114e-01   +2.870805216125764e-01; +8.907868013188494e-02   +2.868444144216888e-01   +4.679213677679461e-03   +2.451232865225682e-01   +9.075389687528632e-02   +1.672206899239299e-01   +3.251623647922621e-01   +2.027799748932863e-01   +2.292449878073785e-01   +2.162151154864184e-01   +2.088677327742004e-01   +3.262144934983089e-01   +1.820538017190127e-01   +2.497133243383756e-01   +1.796123312820772e-01   +2.007863510683318e-01; +2.097373798864636e-01   +3.011886795068974e-01   +8.398476399459490e-02   +8.093544346671871e-03   +2.421494058993122e-01   +1.623445077614533e-01   +3.141471804535091e-03   +1.971796342613324e-01   +1.456808244621720e-01   +2.697092092742180e-01   +2.417881764390682e-01   +6.675008854152223e-02   +8.901634198231212e-02   +2.067038585345264e-01   +1.717539133154688e-02   +2.020053141869008e-01; +1.889454546061319e-01   +5.290934067827674e-03   +1.586067918960740e-01   +2.942254631796990e-02   +1.245822990966417e-01   +2.822045621670959e-01   +1.169970938695802e-01   +2.975605249545524e-01   +1.797442136199151e-01   +1.934523950410248e-01   +7.350187727059088e-02   +1.236429091417977e-01   +1.754386437807199e-01   +7.433879551269874e-02   +1.050951953280954e-02   +8.058317733984031e-02; +2.607486008958907e-01   +6.078501638742202e-02   +2.698095144133552e-01   +2.746743537626439e-01   +8.646212378377835e-02   +1.313067305963457e-01   +1.586849453254339e-01   +9.356575674298470e-02   +2.010226682016212e-01   +1.244546233452108e-01   +8.219052520747377e-02   +2.501834096191312e-01   +1.904064207122779e-01   +1.403010184433548e-01   +1.546237574465543e-01   +8.331968225544269e-02; +1.904856010428924e-01   +3.077183364925670e-01   +1.466798994157649e-01   +1.436898272369245e-01   +9.937609258336269e-02   +6.141845396051767e-02   +2.326849650829172e-01   +5.373654317887067e-02   +2.540633278606191e-01   +1.829335555511665e-01   +3.133320616105897e-01   +2.744828316056741e-01   +1.619735758529345e-01   +1.755585618491735e-01   +5.615780976544502e-02   +3.057331712515030e-01; +1.840483048337773e-01   +2.912519512452376e-02   +1.239693891070277e-01   +3.154751607175254e-01   +1.505001497199538e-01   +2.606880859287837e-01   +1.731147134966067e-01   +2.270538959357952e-01   +8.246443750557404e-02   +2.358149082509760e-01   +1.733020324166179e-01   +2.834873176183738e-01   +2.675439328502335e-01   +2.602743207717458e-01   -3.899043458595840e-03   +2.612527409653982e-01; +2.998510574564919e-01   +8.004196708051575e-02   +8.150400182483966e-02   +3.373022213853282e-01   +6.185009431570233e-02   +2.282982279306882e-01   +1.913603866937172e-01   +3.134485620332928e-01   +3.236295606736139e-02   +1.809961530084127e-01   +1.593450438109669e-01   +2.054866511794221e-01   +2.519771125352681e-01   +2.008226239778115e-01   +7.103299904388312e-03   +3.271715179604992e-01; +2.131680370649432e-01   +6.855344833007532e-03   +3.162591947848711e-01   +3.132274295604949e-01   +2.828575923493776e-01   +9.972133518817944e-02   +3.419517856191013e-02   +2.478551340947901e-01   +2.248458969954686e-01   +7.957588526252884e-02   +1.463663043385045e-01   +1.814900783171681e-01   +2.141659962579924e-01   +1.072267541449854e-01   +3.030051923389475e-01   +8.296621097898463e-02; +1.332325479202493e-01   +3.112192824087633e-01   +1.790948685197660e-01   +2.998953346558927e-01   +2.204719035758310e-01   +1.510438403403027e-01   +1.432225211402736e-01   +3.208302167184647e-02   +6.225259088630198e-02   +3.300397760078367e-01   +6.856699520478050e-02   +9.362376942063322e-02   +2.967668329426567e-01   +1.418299108503395e-01   +4.726919056331469e-02   +2.181882768276062e-01; +3.260760296348469e-01   +7.593046823582877e-02   +1.133024154428127e-01   +1.547895197135706e-01   +6.821559104588606e-02   +1.712423443310075e-01   +2.951694139697073e-01   +4.628405138922206e-02   +2.475955535506429e-01   +1.919768749834964e-01   +1.729628598280538e-01   +1.545931545742255e-01   +5.033534135712305e-02   +2.422821013848187e-01   +7.499703573516663e-02   +1.283684159634116e-01];
L1E_L1I_iGABA_netcon = [+2.713750981432050e-01   +3.075450219024594e-01   +6.542735833480187e-02   +7.263555407352833e-02   -1.520234023487561e-03   +2.830220973620006e-01   +1.940459415144372e-01   +3.009706511460339e-01   +4.548598312509688e-02   -2.577690696361685e-04   +5.970305181786535e-02   +1.814797066412084e-01   +2.079156697505282e-02   +7.865363213404454e-02   +6.905623415585574e-02   +1.340422582960978e-01; +2.316897710655054e-01   +1.855695544304304e-01   +3.892790981028975e-02   +2.207198776499195e-01   +2.226428590303752e-01   +2.550241448195982e-01   +9.543039863642705e-02   +2.680354879928868e-02   +3.229290858073282e-01   +3.769262802542771e-02   +2.938336040293954e-01   +1.259616702245844e-01   +1.432401319917657e-02   +2.835831123538546e-01   +2.795132300384617e-01   +1.402772149167967e-01; +3.294944768687042e-01   +2.292099002983159e-01   +2.967375326427070e-01   +2.975730526740026e-01   +2.955611050428492e-01   +7.212887066280717e-02   +1.225732623609290e-01   +7.272115964522344e-02   +2.354423545560495e-01   +2.717553237563260e-01   +4.772552468082627e-02   +1.761496563546241e-02   +2.868210905326145e-01   +2.346309033952778e-01   +8.517389744498250e-03   +1.659746155994690e-01; +2.106485961574964e-01   +1.756366634388113e-01   +2.695028633375171e-02   +2.176817067714461e-01   +1.333707620582079e-01   +2.691283468522950e-01   +7.417975925675162e-03   +1.473248036686702e-01   +1.835920557748896e-01   +1.372458335979863e-01   +1.761111529213977e-02   +2.773712171680519e-01   +4.558430030615297e-02   +2.100194182042394e-01   +2.177745826425846e-01   +2.164131874557068e-01; +1.740635783659974e-01   +2.246088383251280e-01   +2.752446473097331e-01   +2.464938565242635e-01   +4.100838575657906e-02   +1.886460175306572e-02   +3.898351958305202e-02   +2.902948569139857e-01   +2.966703434919341e-01   +3.040484795773119e-01   +2.050835562168511e-01   +1.485472539083137e-01   +2.050032313375509e-01   +1.773338123741642e-01   +1.701902539744515e-01   +1.893061252133690e-01; +1.821214210059807e-01   +1.701681573108583e-01   +4.004667686363695e-02   +1.091959585386128e-02   +2.413267860823756e-01   +2.041948078091956e-01   +1.173494317754050e-01   +3.222926506491409e-01   +3.272744286677352e-01   +2.065111651982205e-01   +5.430687736305020e-02   +9.855670017316513e-02   +3.002701761897830e-01   +2.719047076894607e-01   +1.441268176716237e-02   +1.304310725941085e-01; +3.174147347110213e-01   +2.773957408762833e-01   +1.226888873967776e-01   +2.507960182367646e-01   +2.114147684261346e-01   +4.155594821717329e-02   +1.418955160463104e-02   +2.893589598638658e-01   +2.607750418009001e-01   +3.469151355377394e-02   +2.757795987623368e-01   +7.744354219111052e-02   +5.425784959797666e-02   +1.046019999164542e-01   +2.617382900205024e-01   +3.151481274701441e-01; +1.307183768393542e-01   +3.207472042443086e-01   +1.763708689272709e-01   +2.324181997526407e-01   +3.083801270173547e-01   +1.077496154642379e-01   +1.428907539065256e-01   +1.331892101508621e-01   +2.344425977420746e-01   +5.886496692291349e-02   +7.752549493939745e-02   +3.246914402887278e-01   +4.635039305353138e-03   +2.764148725164763e-01   +3.121823293700613e-03   +1.224710897624603e-01; +2.736645919675928e-01   +1.679277126610547e-02   +3.010787728593545e-01   +7.110144044656017e-02   +3.180419254924024e-02   +4.616948138775928e-02   +3.081366700577868e-01   +2.059778463258314e-01   +2.967672292600765e-01   +3.132723210948617e-01   +1.293251153004970e-01   +2.834480994097608e-01   +1.930194309556713e-01   +1.279044228538881e-01   +2.299357443874126e-01   +1.119015544956551e-01; +5.796328585491688e-02   +2.590026845019376e-02   +1.722453009987692e-01   +2.831446373081353e-01   +2.297719457718884e-01   +3.152179757682738e-01   +2.174201644012163e-01   +2.700462443565888e-01   +1.159377040189788e-01   +3.137909374959290e-01   +1.323781395440506e-02   +1.282955863884158e-01   +6.203552865828200e-02   +1.431920497191235e-01   +2.772315251196629e-01   +1.877661468915472e-01; +7.328821991479635e-02   +5.748982800671104e-02   +3.271210757930849e-01   +3.045543185266164e-01   +7.998867089015099e-02   +2.200155836962402e-01   +2.287307702741074e-01   +2.935171171405534e-01   +1.168522061733193e-01   +8.823860941426935e-02   +3.080960868254533e-01   +1.328699636019815e-01   +2.724581812209755e-01   +2.668240346351733e-01   +1.119279302110659e-01   +3.297889287829621e-01; +2.775836537460575e-01   +4.591231178461663e-02   +3.105590509593797e-01   +8.327546169888229e-02   +1.110565999811939e-01   +2.920217300077171e-01   +2.785831914027285e-01   +9.178733648448947e-02   +2.135285844503057e-01   +3.199966968346878e-01   +1.322944898714651e-01   +1.992290663992133e-01   +2.375410953932940e-01   +1.689122356888550e-01   +1.097161690663811e-01   +4.324580220887531e-02; +1.024541416715393e-01   +1.743998912935513e-02   +1.227438943106036e-01   +2.417897162216371e-03   +2.308407955536490e-02   +2.105284666131250e-01   +1.317471892234794e-01   +7.046518039678049e-02   +1.921250272335129e-01   +2.225724793216387e-01   +3.284113968368366e-02   +2.792118685479780e-01   +9.541157584345250e-02   +1.099440432999844e-01   +1.143317140727463e-01   +1.902206365478776e-01; +2.607755396260936e-01   +1.996330241047149e-01   +2.993496800911645e-01   +1.468510732976901e-01   +3.242874469023460e-01   +1.884139795275266e-01   +1.902774423551894e-02   +1.688952459458229e-01   +1.419129429129568e-01   +3.305791295498927e-01   +9.273204066917651e-02   +7.304986752615314e-02   +7.307765166643652e-02   +1.139148492395651e-01   +7.845694044533678e-02   +2.306564450744319e-01; +2.556542766620876e-01   +8.761763315598961e-02   +1.759925058601844e-01   +1.018160868426651e-01   +1.811985799489282e-01   +6.628599087982154e-02   +2.822045742573199e-01   +1.626094193666217e-01   +8.376165856119920e-02   +4.049451906778784e-02   +1.918562201711414e-02   +2.689125690585946e-01   +6.689222643382373e-02   +2.981182452546852e-01   +1.937932111434464e-01   +3.241505281723283e-01; +5.617545372573906e-02   +1.010824149200634e-02   +2.126156596031478e-01   +8.562307643970095e-02   +1.439864735651653e-02   +1.999826146573841e-01   +1.265900866995978e-02   +6.206375963118113e-02   +1.416223813036754e-01   +2.022262884855811e-01   +1.406506356718822e-01   +4.633749662978961e-02   +1.646595872739201e-01   +2.411235973910137e-01   +2.112617062470265e-01   +1.887854769726656e-01];
L2I_L1I_iGABA_netcon = [+1.566108520664301e-01   +2.097687720793312e-01   +1.994415439976837e-01   +1.049595184848701e-01   +6.285160493586077e-02   +3.109958001764862e-01   +1.498865361937949e-02   +2.968497532366551e-01; +2.828206702425339e-01   +1.634118729954899e-01   +1.410764386617136e-01   +2.746269287735931e-01   +9.072202633839582e-02   +7.287006788009955e-02   +1.114377590417923e-01   +2.383593076247432e-01; +3.090411445903840e-01   +2.385163444675903e-02   +4.249382764957656e-02   +3.226701550838622e-02   +2.340025318600920e-02   +3.062340564001832e-01   +2.010170853890093e-01   +1.178108650502166e-01; +1.514561730023441e-01   +2.824794018754488e-01   +1.433520452362984e-01   +2.596457398377195e-01   +1.833997884093335e-01   +2.390585908695435e-01   +1.756012632048778e-01   +9.682877091224401e-02; +2.458299662836994e-02   +2.961754453420827e-01   +1.558012615914491e-01   +9.439758347342685e-02   +6.525593216038825e-02   +5.175047676197091e-02   +1.908727045356785e-01   +1.513153702809659e-01; +7.620067980738968e-02   +1.900765795553739e-03   +2.673657556946083e-01   +1.974405680853553e-01   +2.475414159577799e-01   +2.027283268524860e-02   +2.921846617381620e-01   +2.679736505171096e-01; +9.251297958893992e-02   +1.493033475137959e-01   +2.489298092631088e-01   +2.771741291366100e-01   +1.548798845935344e-01   +1.688654736888619e-02   +2.732917717114642e-01   +3.752708357594359e-03; +1.987068555411293e-01   +2.861969276965196e-01   +9.379468565557993e-02   +4.227152671777250e-02   +2.748125607353937e-02   +1.350630317062183e-02   +2.751546863328693e-01   +1.786919633174529e-02; +1.694380598445591e-01   +2.842270239153976e-01   +2.082894466320831e-01   +2.845634856962245e-01   +6.156131153142304e-02   +1.895198332335398e-01   +1.354634243007764e-02   +2.814471777675140e-01; +2.726869819437112e-01   +4.676855775725956e-02   +1.946193776676198e-01   +6.842019701762342e-02   +2.436324471978031e-01   +2.348135568812474e-01   +4.434093114045920e-02   +1.930719891178841e-01; +1.074510111397572e-01   +1.957246776765877e-01   +2.090318163925256e-01   +1.571978276210535e-01   +7.883450625204606e-02   +1.502700099585812e-01   +1.561085899111051e-01   +1.037839683052502e-01; +1.578374174742374e-01   +1.472478522410355e-01   +2.893326607804925e-01   +3.635980241221404e-02   +2.065160473212389e-01   +1.984899746438347e-01   +2.011942654898639e-01   +1.018391284062295e-01; +1.564904582763347e-01   +2.960085737137672e-01   +7.774677048865726e-02   +9.291502845271325e-02   +2.071703581446333e-01   +1.169769922834227e-01   +2.655914135335747e-01   +7.791264021172641e-02; +2.493299858820990e-01   +1.787711454516515e-01   +1.808123441305032e-01   +1.966546117923696e-01   +7.975802937792206e-04   +1.736299845896384e-01   +2.250592624702974e-01   +2.976880366398260e-01; +9.239541060725835e-02   +3.144639388154947e-02   +2.557689056922351e-01   +4.026930582822971e-02   +1.155925910236515e-01   +8.229179133908267e-02   +1.196707570573649e-01   +5.080990597173396e-02; +3.183910695433930e-01   +1.310209533941401e-01   +4.279161410102227e-02   +2.273691225371179e-01   +1.784193783288094e-01   +1.777193895758478e-02   +3.202345055944774e-01   +3.077778672620868e-01];
L1I_L2I_iGABA_netcon = [+2.330047933630500e-01   +8.204352019202412e-04   +1.996093864613972e-01   +3.108640851216623e-02   +2.587228191231967e-01   +2.628738032535939e-01   +1.515473286903239e-01   +6.994982724234552e-02   +4.143560259033911e-02   +1.619789641714798e-01   +2.165693208443973e-01   +2.760249097894156e-01   +2.072231698116591e-01   +1.662419811889098e-01   +2.740025118035801e-01   +1.239707034491073e-01; +1.343441754326864e-01   +1.132620062690357e-01   +1.950686951658979e-01   +3.132627385051217e-01   +1.401340213383487e-01   +3.230492509078579e-01   +6.454868177780544e-02   +4.034582987669547e-02   +3.201799868196606e-01   +3.305913707793415e-01   +2.920018941667866e-01   +2.143674987099259e-01   +2.297741563383023e-01   +1.795203224243172e-01   +2.981908473733712e-01   +2.986640933962157e-01; +2.495379519332469e-01   +1.485250497245766e-01   +2.682823154888386e-01   +1.966112501914861e-01   +2.905590262667613e-01   +2.559450601320731e-01   +3.083877290495232e-01   +1.922100363225633e-01   +2.824564507359136e-01   +6.428905128879217e-03   +3.083734326671065e-01   +9.153565448962253e-03   +7.899739589162805e-02   +1.617701499138462e-01   +1.453602360348299e-01   +2.991743462108276e-01; +1.181486387011870e-01   +1.479059315177005e-01   +1.635279035808087e-02   +3.770697943899615e-02   +3.267335811515378e-01   +1.879066780291808e-01   +1.903589687564411e-01   +1.876300331131798e-01   +1.052485739390093e-01   +1.132603667187496e-02   +4.704366205503186e-02   +5.174075554601130e-02   +7.372023834459397e-02   +2.933165721821993e-01   +4.928497628670647e-02   +1.541779274943517e-01; +2.811399446313638e-01   +4.956465844536905e-02   +4.014611215630295e-02   +6.246850741252937e-02   +2.299130237146835e-01   +3.888483122572183e-02   +2.697045958444281e-01   +8.830190055233209e-02   +9.895886524421758e-02   +1.268052454209088e-01   +1.627687053990739e-01   +1.799529458794445e-01   +1.426530846230313e-01   +2.733283060100435e-01   +1.939626494602892e-01   +2.910155577498630e-01; +1.817612484705446e-01   +1.348451972580298e-01   +2.333551870533934e-01   +2.275348311649813e-02   +2.203912775161418e-01   +1.173318523325564e-01   +2.385179493460854e-01   +4.967384711990626e-02   +1.579813910976470e-01   +2.429218147043641e-01   +5.159620937362430e-02   +1.573134283103791e-01   +4.749836056396337e-02   +2.920196807415263e-01   +1.071614255832773e-01   +1.015229604635842e-01; +2.464205742136811e-01   +8.947031616987393e-03   +1.763526572609707e-01   +1.159193063105639e-01   +1.000987468666536e-01   +2.519130997614131e-03   +1.896237818437487e-01   +2.685030000745366e-02   +1.310598499840945e-01   +2.245995731941278e-01   +1.938838794061811e-01   +2.140675390561353e-01   +6.978368069447705e-02   +9.129137561466476e-02   +1.618227052626408e-01   +3.024762284546039e-01; +2.489047646763884e-01   +2.251627199588614e-01   +6.905029418466789e-02   +1.695722193901414e-01   +3.051858419429179e-02   +3.223109517189576e-02   +2.955859570751247e-03   +2.773118777335991e-01   +2.528061508279924e-01   +3.080428862177071e-01   +2.310624957683783e-02   +2.494712356134601e-01   +6.893738959133951e-02   +2.403627709981027e-01   +1.949607473273141e-01   +8.012169952695686e-02];
L2E_L1E_iAMPA_netcon = [+2.696131623845559e-02   +7.444282716551344e-02   +2.644990085861825e-01   +3.290329103577915e-03   +7.535474337738805e-02   +6.957672495615241e-02   +2.348541079301213e-01   +3.112767635898745e-01; +3.217462670251087e-01   +1.077552883653732e-01   +1.615251978949199e-01   +1.562580409576691e-01   +2.295338083737892e-01   +2.965229743867419e-01   +1.442238169002780e-01   +1.162463218779917e-01; +4.603076823369318e-02   +1.400265978129374e-01   +2.582952889981877e-03   +2.796385355016178e-01   +1.860171153939538e-01   +5.526354935624155e-02   +2.246728199445822e-01   +2.651938730071960e-01; +2.771592421770572e-01   +1.589346363437409e-01   +2.776595652751884e-02   +1.899216569206681e-01   +1.842304882637275e-01   +1.866424930782339e-01   +1.383033137545737e-01   +1.216114136550658e-01; +1.416471507100804e-01   +1.894417698570415e-01   +1.815845724529210e-01   +1.197225901431490e-02   +2.009532861642170e-01   +2.326947528839236e-01   +3.162699641770984e-01   +2.816468167282993e-01; +2.387835518432801e-01   +2.478769910694344e-01   +1.669103517562458e-01   +1.922162729808723e-01   +4.564631133869831e-03   +2.631952514803693e-01   +1.642027753381759e-01   +3.452789579980463e-02; +2.958581353073517e-01   +4.982323644372487e-02   +2.048096505048660e-01   +7.830829176951104e-02   +1.134759873789281e-01   +1.274549394724458e-01   +1.465622281454219e-02   +6.668068687374362e-02; +1.508236000460696e-01   +3.993165917914229e-02   +7.989831769377786e-02   +2.706224847417677e-01   +1.441934894941175e-01   +1.155446171849955e-01   +2.005124533710266e-01   +3.992818023640004e-03; +1.280645017842001e-02   +1.798878778316724e-03   +1.599847137045318e-01   +9.184846967260710e-02   +2.269045747253426e-01   +1.568617567940380e-01   +1.232710664482708e-01   +6.252468315020619e-02; +9.524988144341100e-03   +1.125926994357257e-01   +6.157597807255500e-02   +1.494648222424474e-01   +2.254536946314502e-01   +1.411346585500487e-01   +1.392423411124858e-01   +2.825219000230793e-01; +1.875858282757707e-01   +1.526719431604598e-01   +2.483692613531918e-01   +2.137226398054593e-01   +1.601635906358881e-01   +9.768017360964397e-02   +8.977609824270354e-02   +5.535244758119671e-02; +1.789443615195783e-01   +2.360491103552447e-02   +4.708117270210784e-02   +7.862546610609228e-02   +1.393773371973599e-01   +9.723123525038628e-02   +1.255305078761143e-01   +1.247769989338422e-01; +1.330038210898790e-01   +1.992694114618354e-01   +3.124247040978078e-01   +3.129798733067659e-01   +2.219023545228779e-01   +5.803454278759182e-02   +2.393739612188722e-01   +1.769631949290529e-01; +7.038194337457253e-02   +1.610707527803381e-01   +1.172305505042313e-01   +1.154553068875710e-01   +1.105674288830350e-01   +1.097336640581981e-01   +2.889869716416529e-01   +1.209358173641557e-01; +1.863381917659654e-01   +2.833219846485577e-01   +7.468199811689279e-02   +3.125807610769187e-01   +1.623106496496829e-01   +2.141757516033680e-01   +4.942153711641882e-02   +2.754023863624890e-01; +3.436633421436299e-02   +3.298055762840583e-01   +1.594264231098406e-02   +2.965426371255266e-01   +2.436492846610427e-01   +1.359619543617664e-01   +8.642717456008429e-02   +1.899179387429745e-01];
L1E_L2E_iAMPA_netcon = [+5.648797170843594e-02   +2.551095448790174e-02   +9.108185473244790e-02   +2.323038822063163e-01   +5.860297433895158e-02   +3.130426478619214e-01   +2.691430181933833e-01   +7.771186336403869e-02   +2.785416646660024e-01   +2.072291329514220e-01   -8.189196403191909e-04   +2.674131491404722e-01   +3.347548947291258e-02   +2.975040440417786e-01   +9.957559226650335e-02   +3.070585085568509e-01; +1.330405991583460e-01   +6.902563744366740e-02   +4.956181918536433e-02   +1.927177822241452e-02   +5.781140326684045e-02   +2.403141709509741e-01   +1.822499162640535e-01   +1.413550431376463e-01   +2.556136769872407e-01   +1.088519995844257e-01   +6.746397669520435e-03   +2.201258965046627e-01   +1.896241838469938e-02   +1.384113172348780e-01   +1.394973790839239e-01   +1.356091212765429e-01; +2.064354201880045e-01   +1.971520525862568e-01   +1.499318491244489e-01   +1.336900999297666e-01   +1.778885030403668e-01   +1.350239859568300e-01   +2.466090701272795e-01   +3.248497478917646e-01   +5.368408079472963e-03   +2.670205141318200e-02   +1.461296888991567e-01   +2.608231888653234e-01   +5.870362213949348e-02   +1.344756373931049e-02   +2.082671380842981e-01   +1.392736617633306e-01; +8.765230596112417e-02   +1.590269126132606e-01   +2.879441554187833e-01   +1.825030383161598e-01   +1.598949955863176e-01   +2.192532012106188e-01   +3.064014198775577e-01   +6.567565318521731e-02   +1.129979188125679e-01   +1.235957457154777e-02   +2.637453570129523e-01   +1.345171639555220e-01   +7.185948742556284e-03   +1.793111732384191e-01   +3.268872836759654e-01   +3.172762868023464e-01; +1.768712211158909e-01   +3.013383151948677e-01   +1.649666821549685e-01   +7.324445304200439e-02   +1.450534849393751e-01   +2.731748940779251e-01   +1.486400819254508e-01   +2.431803736323612e-02   +2.721471666506883e-01   +1.364085196968216e-01   +7.071560052319976e-02   +2.661806113440521e-02   +3.029931471953523e-01   +2.251037983681739e-01   +2.459751542579503e-01   +1.514486938927812e-01; +1.669841272788956e-01   +2.380795317079128e-01   +1.174879018185405e-01   +2.176895545492826e-01   +2.311442731427152e-01   +5.755249848162088e-02   +7.424268758129020e-02   +9.081777565868400e-02   +1.139427911434656e-01   +2.963806031749209e-01   +1.641134988149360e-02   +2.486259471983845e-01   +2.612241005246519e-01   +1.211428020291831e-01   +2.439300096695337e-01   +1.334826199256306e-01; +1.567418503742697e-01   +1.614935063649055e-01   +2.122105557520379e-01   +1.270020424345713e-01   +1.775377078515571e-01   +3.752424047006172e-04   +2.052675531163508e-01   +2.303395457222979e-02   +7.031632531913100e-03   +1.483030282645158e-01   +2.687050450587123e-01   +1.230167446625812e-01   +1.934837074320852e-01   +4.423422998764209e-02   +7.513960092681994e-02   +2.802886441918134e-01; +1.995508029908507e-01   +6.715792653147530e-02   +2.280846383574983e-01   +1.970618085052203e-01   +1.351102678971822e-01   +1.147346071618012e-01   +2.616956928770135e-01   +2.558528911036762e-01   +7.050118889814398e-02   +2.184296739058711e-02   +2.598754430481595e-01   +7.501228676157073e-02   +2.501456237183247e-01   +2.527912800108051e-01   +2.858489164474223e-01   +7.935219463129002e-02];
L2I_L2E_iAMPA_netcon = [+1.964389796479586e-01   +3.976766887125422e-02   +2.595305439697612e-01   +2.002826937932606e-01   +2.352841627619780e-01   +3.016909217730699e-01   +9.317943583992787e-03   +4.813359187677599e-02; +2.456995066224723e-01   +1.096586802890646e-01   +3.240878084500262e-01   +2.965253455421425e-01   +1.427582533112893e-01   +1.139514748285429e-01   +1.013650832968293e-01   +2.052612377085438e-01; +3.114082917250681e-01   +3.056520011616525e-01   +1.258542091598873e-01   +4.393553982796974e-02   +2.164724785532249e-01   +2.602230750686929e-01   +2.726442105900257e-01   +2.860246205096691e-01; +5.763393536840043e-02   +5.308014593016412e-02   +1.498605373907343e-01   +1.515147359306471e-01   +1.578971377276067e-01   +1.755517403952861e-01   +3.124179480509953e-01   +1.450314416542288e-01; +2.992228938594094e-02   +2.075562950285900e-01   +1.556525646628145e-01   +1.306104370322373e-01   +2.799105922648005e-01   +3.140339310738699e-01   +2.402261311877442e-01   +2.354144524643220e-02; +1.912046444209336e-01   +2.327370297357323e-01   +7.243546419750073e-02   +2.893704006408751e-01   +1.340217239343487e-01   +1.735537154397798e-01   +2.085326495438736e-01   +2.082046081060385e-02; +3.186508924858071e-01   +1.432375372858734e-02   +2.515505961828711e-01   +4.172649164241955e-02   +1.376591264291656e-01   +1.998880724053251e-01   +4.189842686574710e-02   +3.014639184351352e-01; +4.246175715408364e-02   +2.176432373966623e-01   +1.124951126242080e-02   +8.797665446228890e-02   +2.264840207971384e-01   +2.776577572063226e-01   +1.547235422561422e-01   +1.963935313653411e-02];
L2E_L2I_iGABA_netcon = [+3.180857388932438e-01   +2.057227025879442e-01   +1.990254748377032e-01   +2.237884372734762e-01   +3.495900301986008e-02   +3.152016596119830e-01   +5.260735821123626e-02   +2.311978272285335e-01; +2.365211994349993e-01   +1.251249549682081e-01   +1.832607849951562e-01   +1.025493649248382e-01   +1.313227771583577e-01   +1.975130098076518e-01   +1.688615564321265e-01   +3.155445909720065e-01; +2.177507815704286e-01   +3.192331751880063e-02   +2.020984071884681e-01   +3.641075624348555e-02   +1.588234605917010e-01   +3.323877727249718e-02   +3.230044046165351e-01   +1.610439500009337e-02; +3.023138885514186e-01   +5.506839181861686e-02   +1.903759016926543e-01   +3.077164976522836e-01   -5.982501962230006e-03   +3.113693709934120e-01   +2.642754180550951e-02   +1.280952543647274e-01; +3.128644159639986e-01   +2.437173053587137e-01   +1.815989347849443e-01   +1.388134927977482e-01   +2.019228342731269e-01   +3.020832066514014e-01   +1.346072567486562e-01   +1.211083078357152e-01; +1.312681589192812e-01   +1.926400092956251e-01   +1.903151879993396e-01   +2.626408356174775e-01   +1.267955620413644e-02   +3.008098270264733e-01   +5.608466310767606e-02   +2.730354538782954e-01; +2.993814679422632e-01   +2.303879194717069e-01   +1.964713400831539e-01   +1.533749878008673e-01   +2.439690360317043e-01   +2.362005365670977e-01   +1.173728531212075e-01   +8.938464109986163e-02; +2.726946296200739e-01   +6.126011478060527e-03   +2.912596949761042e-01   +1.020026607923083e-01   +2.645867888355106e-01   +1.962364432894143e-01   +2.940626694782083e-01   +9.419495464561414e-02];
L3E_L2E_iAMPA_netcon = [+1.142982020561874e-01   +1.752086582884086e-01   +1.975621202273472e-01   +2.798559687936826e-01   +3.539822354603842e-02   +2.697223935487238e-01   +2.160005701991395e-01   +2.266122138714560e-02   +2.888923365502858e-01   +2.281190535735690e-01   +1.436620482482994e-01   +1.763625150461883e-01; +1.496123406824043e-01   +1.413633865405362e-01   +9.217504543047202e-02   +1.566407325964671e-01   +7.058693220708588e-02   +1.716440658631463e-01   +2.448077062817659e-01   +4.433075550235759e-02   +2.941001544536928e-01   +1.987389721931134e-01   +2.873271547620928e-01   +2.593766157492597e-01; +2.358107716582588e-01   +3.029595826650326e-01   +2.486960952189907e-01   +2.842652743765516e-01   +6.410831225058988e-02   +7.481858088075524e-02   +1.315613658887362e-01   +3.112718273364355e-01   +2.184327427607612e-01   +1.032479681612082e-01   +1.075358888983703e-01   +2.181440880697599e-01; +1.096561215802621e-02   +3.287422237349752e-02   +2.026793752777534e-01   +9.135252042372531e-02   +1.020912330369248e-01   +2.949354865594823e-01   +1.878978652503632e-01   +1.905723170657547e-01   +1.015210253544550e-01   +2.859324537748817e-01   +3.311575458314612e-01   +5.984426649318753e-02; +3.284245970296507e-01   +7.097038104481883e-02   +1.042834563676698e-01   +2.004827918725663e-01   +1.445788431003583e-01   +4.411551860640513e-02   +9.351984620923685e-02   +2.646342173463889e-01   +1.735378676734526e-01   +3.014810374081048e-01   +2.743323358559796e-01   +5.985904526886700e-02; +2.110654314929817e-01   +1.520569024998989e-01   +5.615547830688676e-02   +3.128867056262156e-01   +2.638673434466837e-01   +5.956913886055974e-02   +3.225123489164229e-01   +7.492596132856029e-02   +2.144685267519722e-01   +1.550128676846615e-01   +1.822716713432358e-01   +2.842124756865956e-01; +2.057234180212300e-01   +2.388401274459639e-01   +1.934546149411130e-01   +2.041083585219079e-01   +2.834111241910141e-01   +1.115994493685180e-02   +1.467882273535381e-02   +5.060432266028596e-02   +2.606955773527128e-01   +3.240481735936417e-02   +2.922420042315472e-01   +1.907225375518515e-01; +2.011528212191636e-02   +9.368784561016319e-02   +1.716998760602343e-01   +7.940426192065735e-03   +2.971712707849213e-01   +1.249890906028103e-01   +2.402115658774687e-01   +3.218790394853602e-01   +4.223505501348515e-02   +1.721325083219792e-01   +1.805898071847724e-01   +2.928516648331979e-01];
L3I_L2I_iGABA_netcon = [+2.403807931757426e-01   +1.194076553468570e-02   +3.968355354969148e-03   +1.786991682074276e-01   +1.312029361039040e-01   +7.111879370888505e-02   +2.303898092091180e-01   +2.617459173885085e-01   +2.791397145839576e-01   +2.445233870363808e-01   +1.957411170180946e-01   +7.516973295013850e-02; +1.480619048801339e-01   +2.696002903469462e-02   +1.989724501102952e-01   +1.355449396399917e-01   +1.326082390662885e-01   +9.867136645493463e-02   +1.560686733108739e-01   +2.024712197401712e-01   +1.658972591023339e-01   +2.875128025741130e-01   +7.594262784193276e-02   +2.541073927510614e-01; +3.177146514201375e-01   +6.410665786784983e-02   +1.845782006718750e-01   +2.742016878227483e-02   +1.917098478313965e-01   +1.813020266535688e-01   +1.722206485827272e-01   +4.207388781746193e-02   +1.675861553692626e-01   +5.307769538413047e-02   +2.111302310639367e-01   +8.062799753497078e-02; +6.622145479262748e-02   +1.171616047969966e-01   +1.471112662757883e-01   +2.841662361099884e-02   +1.003537171594772e-01   +2.550092197651672e-01   +1.310195618866348e-01   +2.482814237061605e-01   +2.450295704818027e-01   +1.840167026281570e-01   +1.230095456013966e-01   +1.987080566616115e-01; +3.135871427338757e-01   +3.194811856495912e-01   +2.546804322609624e-01   +5.963459711547489e-02   +1.711970811529565e-01   +2.320536217779924e-01   +1.764897108593268e-01   +2.640421001301635e-01   +3.277071332840935e-01   +9.541035334985348e-02   +8.128094417409158e-02   +4.667084688102598e-02; +2.948529111744404e-01   +3.269599842305627e-01   +5.651898783940068e-02   +1.946921718053174e-01   +7.196065487165958e-02   +1.235298914172630e-01   +2.516371313795966e-01   +2.186497485882247e-01   +3.915153031442615e-03   +8.162096471912200e-02   +5.127986279015045e-02   +1.318166259422161e-01; +2.664900122181979e-01   +1.127578140876899e-02   +3.015722948201608e-02   +3.316091383011625e-02   +3.658206606655030e-02   +4.284746523580721e-02   +2.516262554434995e-01   +2.616764970041088e-01   +1.872443228183942e-02   +2.394471010417230e-01   +1.101924071568152e-01   +2.308389280946783e-01; +1.095473254712534e-01   +2.704139100976469e-01   +2.045163141017939e-01   +2.311618456106872e-01   +1.810591034786582e-01   +9.636494098118649e-02   +3.353982430541529e-02   +2.865588428557012e-01   +3.164105754792397e-01   +2.146787888495688e-01   +6.009892649776296e-02   -7.359189301623823e-04];
L2E_L3E_iAMPA_netcon = [+5.096887708005931e-02   +1.379187022383724e-01   +1.387874869911510e-01   +2.427107438338402e-01   +1.896346800884353e-01   +7.002418410219133e-02   +1.256450759584430e-01   +1.979455445837946e-01; +3.160870011314905e-01   +3.066328907933304e-01   +2.859178064805821e-01   +6.119197570014859e-02   +2.108156294754294e-01   +8.706780324168677e-02   +1.361403808097114e-02   +5.024886794167736e-02; +2.322311857467539e-01   +2.043484433984014e-01   +1.306020740619188e-01   +2.235866231015944e-02   +1.998394625892067e-01   +2.355654398411951e-01   -2.111933906280868e-03   +4.072781528452712e-02; +2.166415541317077e-01   +2.921712616956277e-01   +3.001617133439470e-01   +2.098832581808354e-01   +7.704344492732011e-02   +2.226159751282109e-01   +1.573969471629643e-01   +1.535519304274004e-02; +1.233158608567047e-01   +8.098596361320270e-02   +2.404267357374548e-01   +3.043503217511296e-01   +2.846225716384300e-01   +1.261223729131724e-01   +1.962059617490852e-01   +2.909064625374587e-01; +2.413663683419758e-01   +2.622531804388228e-01   +1.154706092674573e-05   +1.875058212790441e-01   +1.923261467147615e-02   +1.366870612406280e-01   +5.282752227059558e-02   +1.944632814813574e-01; +2.355138278228936e-01   +2.968712921740221e-02   +8.590739360636135e-02   +2.501161507073276e-01   +4.783518746564290e-03   +2.078104288853727e-01   +2.329107659562389e-01   +1.347158741756740e-01; +2.071504000048820e-01   +1.287072557513512e-01   +1.501297024061438e-01   +2.956219876702155e-01   +1.704267936192495e-02   +9.751715328817286e-02   +1.214574416023015e-01   +2.404138665863374e-01; +1.252600035822773e-02   +5.820125908968615e-02   +1.875748819626257e-01   +2.700958551024578e-01   +1.142333351344623e-01   +2.125091064034298e-01   +8.462658120954940e-02   +1.368117584209511e-01; +7.145852648135698e-02   +4.659871772976582e-02   +2.956597329749440e-01   +1.505385470281786e-01   +2.831538766443334e-01   +4.953248198481922e-02   +2.891739797547319e-01   +5.488438381571160e-02; +4.130027194655780e-02   +1.552432081618876e-01   +1.368104993780490e-01   +1.725742829124831e-01   +1.113148013652969e-02   +2.082365469602948e-01   +1.816598188241803e-02   +2.529104387107725e-01; +2.671968043653393e-01   +5.113579534109471e-02   +2.776848428491855e-02   +3.419999313815532e-02   +1.648380421164683e-01   +6.629436029827715e-02   +2.717425474632190e-01   +1.562464643886219e-01];
L2I_L3I_iGABA_netcon = [+7.948453731304640e-02   +9.373186041750176e-02   +1.014289677590342e-01   +6.279431666727922e-02   +3.018795540031655e-01   +2.130644710454173e-01   +2.777147751192732e-02   +1.124238338169296e-01; +2.255331739537884e-01   +1.525605847526595e-02   +7.562131694972503e-02   +1.695842674297194e-01   +3.137193948618395e-01   +2.104460040710423e-01   +1.672973891463848e-01   +2.783359256340383e-01; +3.341065680240016e-02   +2.123088274456551e-01   +3.089327124443775e-01   +1.609664909871571e-01   +3.158128080463961e-01   +6.969384338522631e-02   +6.050200487112623e-02   +1.791061175915429e-01; +2.344441407261745e-01   +1.952463146294270e-01   +1.454442421171475e-01   +1.005864629048634e-01   +3.197731783063582e-01   +2.688177627996497e-01   +1.283108270436533e-01   +2.265154153289002e-01; +1.919153486660644e-01   +2.424211616781663e-01   +1.946613924697340e-01   +4.600890482049635e-02   +1.928087043285444e-01   +2.312480995730665e-01   +2.685082853486563e-01   +2.344208638269701e-01; +1.006742231147736e-01   +7.381063990534471e-02   +1.894012961604389e-02   +2.471931135042587e-01   +7.073984014239501e-02   +3.150964423913461e-01   +2.317297126247572e-01   +3.296082728621654e-01; +1.644184494454789e-02   +7.011026049860572e-02   +7.743213978487799e-02   +2.419220219488149e-01   +3.179413449247383e-02   +9.858648194406354e-02   +1.218255643153813e-01   +3.415359300357510e-02; +1.619553776155527e-01   +1.166172193121947e-01   +2.816605770024486e-01   +1.481034941841917e-01   +1.545168147904974e-01   +5.869198790997396e-02   +2.961379588068382e-01   +2.917308563258719e-01; +2.827334265444119e-01   +2.868465729186876e-01   +2.727510474136848e-01   +2.215710967712889e-01   +2.050689942043303e-02   +2.862523820529358e-01   +1.305164846293034e-01   +1.654625697681451e-01; +2.748589433738491e-01   +1.574133561457427e-01   +1.453781657621417e-03   +1.216393061575148e-01   +2.616825092592713e-01   +2.893413297054656e-01   +1.644584850524399e-01   +3.088615982962790e-01; +2.028652152222022e-01   +3.253668881069752e-01   +2.722423409381003e-01   +2.431013647085278e-01   +5.237182530507233e-02   +2.874700745853990e-01   +1.470900077332679e-01   +3.025938302402165e-01; +1.886653295808245e-01   +2.580158040289462e-01   +1.154889916706487e-01   +2.596586320931670e-01   +2.990362235553714e-01   +5.774657097553323e-02   +1.076150912147004e-01   +4.555364733646620e-02];
L3I_L3E_iAMPA_netcon = [+2.659803832755891e-01   +3.358119271796863e-01   +2.013826545512979e-01   +1.766897327410227e-01   +8.195105854861245e-02   +2.495046296741966e-01   +1.325672471784547e-01   +1.405618639816840e-02   +7.954272338373156e-02   +8.065930660073631e-02   +3.037311041189270e-01   +2.267638451817177e-01; +9.748874146146642e-02   +2.968604342053395e-02   +3.076070498215106e-01   +1.720039686693021e-01   +2.214701350927498e-01   +1.633794743843777e-01   +2.824664137376351e-02   +2.995619373608065e-01   +4.552583243782832e-02   +7.372000659099426e-02   +1.689770398424069e-01   +9.979030845307672e-02; +3.016638271602779e-01   +1.341578170912994e-01   +3.062762729102845e-01   +1.058871697883266e-01   +5.337673636551631e-02   +2.186121480678591e-01   +1.899002027613084e-01   +1.442738945479007e-01   +9.444709912317548e-02   +2.035510796464377e-01   +1.752519043022668e-02   +2.397154038992904e-01; +2.060726020522120e-01   +2.383728366779806e-01   +1.636209335838767e-01   +2.945208015853435e-01   +3.077810995037863e-01   +5.327144095437673e-02   +2.249891028190492e-01   +2.438328955101624e-01   +3.058023641497533e-01   +1.867708439353111e-01   +2.398873560606742e-02   +2.101269261380737e-01; +2.322034055258144e-01   +6.492031398041963e-02   +2.424389638046877e-01   +3.244209262824942e-01   +2.726561418555006e-01   +5.618564359593766e-02   +2.481591149442457e-01   +1.087092521195836e-01   +1.680027922034409e-01   +2.580424582229249e-01   +1.322535343714353e-01   +3.955262406121991e-03; +2.684022065871255e-01   +1.863476913406588e-01   +3.302962068644581e-01   +4.827811875649143e-02   +5.921106826821369e-02   -4.649516438192435e-03   +2.049183178479238e-02   +1.288705329079295e-02   +2.757148135251554e-01   +3.251996522469013e-01   +2.327684283528196e-01   +2.271117726843878e-01; +2.346985711075385e-01   +1.622709146132052e-01   +2.539217498463247e-01   +3.123760981603977e-01   +1.216545009144268e-01   +2.069414767881109e-01   +1.678755084277070e-01   +1.717928348261859e-01   +2.206372691767422e-01   +1.862006451939452e-01   +3.073405567013112e-01   +1.332327579818803e-01; +2.344748544079043e-01   +2.282990445452798e-01   +9.222723435464607e-02   +2.834410230622796e-01   +1.144914039726022e-01   +2.943411334883149e-01   +1.795765172129916e-01   +2.497167178989707e-01   +2.830740631392692e-01   +3.267637255313314e-01   +6.667565358619938e-02   +8.383763180978622e-02; +3.626124751981482e-02   +2.116071369578567e-01   +1.650490188273516e-01   +3.075008941079854e-01   +1.283885471571117e-01   +1.120398938688799e-01   +2.058686926755752e-01   +2.446855758017689e-01   +1.674698978105277e-01   +3.107404215780520e-03   +2.757494019765717e-01   +2.827815377571009e-01; +2.441743421826174e-01   +9.536234408872303e-02   +6.400394045622990e-02   +1.242834513846041e-01   +2.147500488232483e-01   +6.210232960433221e-02   +4.276019704276297e-02   +9.108681177765629e-02   +8.257573991986410e-02   +4.920732007412795e-02   +4.678310310681454e-02   +2.121417309165006e-01; +1.377984218280999e-01   +2.061480364605586e-01   +3.254046637355722e-01   +2.024587071730649e-02   +1.983983755427510e-01   +9.275727294580206e-02   +2.838147701394583e-01   +5.660832154802427e-02   +3.145999763560176e-01   +1.123256730872016e-01   +1.019324981081563e-01   +2.935147696608842e-01; +2.986622646389367e-01   +1.516458538676335e-01   +1.179761322511639e-02   +1.611981295019090e-01   +7.216295858950584e-03   +1.717200497819175e-01   +3.231497489755774e-01   +2.134403741511769e-01   +1.669942489551509e-01   +2.411542641413527e-01   +2.973002069677576e-01   +2.054078223614170e-01];
L3E_L3I_iGABA_netcon = [+1.421818239746602e-01   +1.266761834543054e-01   +2.649561111679331e-01   +7.640917050236570e-02   +4.161319547017872e-03   +2.451574628589528e-01   +3.187829280827272e-01   +2.957691234278907e-01   +2.901218712243543e-01   +1.783565090257289e-01   +1.470317720265939e-01   +2.317917947843250e-01; +2.256878151932501e-02   +6.849624230863093e-02   +7.158909576644207e-02   +1.315501185746764e-01   +2.059218657603326e-01   +2.331523489133406e-01   +2.852417279428610e-01   +2.763242751115900e-01   +5.482907797480227e-02   +2.878329465870009e-01   +2.891282576938550e-02   +3.030298325800516e-01; +5.433424743854262e-03   +1.316586690720748e-01   +2.279175973882076e-01   +2.245509307102608e-01   +1.802752078535181e-01   +1.272923395550918e-01   +2.630224873132742e-02   +4.009023219778544e-02   +9.658591289725484e-03   +3.202530177767955e-02   +5.066154557002929e-02   +1.067005239377035e-01; +3.009509285536462e-01   +1.699363089163454e-01   +2.615801400899849e-01   +3.268795702238589e-01   +2.733626277543831e-03   +1.754125574881052e-01   +1.124934010409407e-01   +3.160197041477825e-01   +6.205548556242044e-02   +1.659089413188957e-02   +2.750599598460120e-01   +2.847766559247049e-01; +7.616430079451957e-02   +3.367193166659300e-02   +5.612592128057931e-02   +4.128397890397011e-02   +1.646957233135331e-01   +5.402196236331657e-02   +2.250547235135121e-01   +1.306916131585940e-01   +2.903027723588610e-01   +3.143382505884182e-01   +3.077164291486349e-02   +1.093043965698719e-01; +2.018111023786683e-02   +2.351222013688655e-01   +2.077665043834133e-01   +2.757776540513899e-01   +2.074825914049862e-01   +3.135456212590844e-01   +2.696913179165299e-01   +7.584146276021331e-02   +2.667647215371124e-01   +5.624608637162178e-02   +7.001125058983512e-03   +2.297211773286073e-01; +1.043292922551662e-01   +1.288124529748723e-01   +2.520685643423166e-01   +1.308933971973448e-01   +2.894031095314247e-01   +2.023155708410825e-01   +2.152309438801272e-01   +2.384921414882621e-01   +2.664131640403454e-01   +9.562855245049467e-02   +2.550734427702013e-01   +1.231834227758485e-01; +2.814369957095575e-01   +9.955011427011735e-02   +1.452573906061959e-01   +8.636778211024748e-02   +5.777872699986559e-03   +3.018772425111925e-01   +1.977978795642703e-01   +1.971451745429594e-01   +2.427525367489741e-01   +7.787826607028353e-02   +3.026441917818733e-01   +1.178217941082828e-01; +5.951016618873451e-02   +6.398847172310571e-02   +3.008333184913708e-01   +7.093776834503014e-03   +2.117594448219693e-01   +2.257347236307014e-01   +1.324200647213066e-01   +2.442551295795994e-01   +3.123174752787430e-01   +3.242356948739492e-02   +2.104746552854904e-01   +1.454425447074223e-01; +2.122227885194738e-01   +8.100418411242356e-02   +2.439027980191264e-01   +2.164932027712322e-01   +1.351000809731862e-01   +1.239917014359843e-01   +2.389122014141299e-01   +2.575439307462044e-02   +2.704425377335095e-02   +1.792711862419049e-01   +2.287003530616124e-01   +2.470504470100444e-01; +8.443104280932816e-02   +1.899901159428117e-01   +2.843020097518580e-01   +1.416785832323462e-01   +3.085872267139905e-01   +2.962641576391437e-01   +1.944410466329534e-01   +2.808024888743016e-01   +1.556182352940509e-01   +3.495983503600431e-02   +2.635673314680454e-01   +1.863388493316081e-01; +2.810490136740760e-01   +1.988431883926861e-01   +1.479203358184349e-01   +4.890709642834527e-02   +2.275002156890600e-01   +5.540613602253781e-02   +3.088296709498210e-01   +4.714103689058773e-02   +2.300169638895155e-01   +1.540465935549584e-01   +5.427246713285781e-02   +2.450731783062585e-01];
L2E_Input1_iAMPA_netcon = [+1.836112014062415e-01   +2.051456524479310e-01   +2.761514717366375e-01   +1.968610710618650e-01   +1.228350289724700e-01   +2.901764126375442e-01   +2.428953030561257e-01   +1.761482993778800e-01];
L2I_Input2_iAMPA_netcon = [+1.258957350870242e-01   +1.093020159917044e-01   +1.076382965886985e-01   +1.526319781775247e-01   +2.585235100400040e-01   +4.362171997427556e-02   +1.725050183408699e-01   +8.856317013434646e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = -20*((exp(-10*((t)-( 50))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 50))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
