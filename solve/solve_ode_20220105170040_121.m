function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+8.239442305461118e-01   +4.222663780458819e-01   +5.315230550484819e-01   +6.364601145225660e-01   +5.989537139130205e-01   +3.409611596126020e-01   +6.477146394867899e-01   +8.396070792147078e-01   +5.445914425421635e-01   +1.927524840170948e-01   +4.502865943332926e-02   +8.223202489043180e-01   +7.685255588439832e-01   +1.107932002719339e-01   -1.439087977369241e-03   +8.400097598838197e-02; +9.823161603321255e-01   +9.598992186741959e-02   +3.245604282417495e-01   +9.570890125768515e-01   +3.868591528562088e-01   +6.061990681449099e-01   +6.778482049974980e-01   +8.324836876587203e-01   +7.225963964371672e-01   +1.378441129588654e-01   +7.536624370511542e-01   +4.302188423855422e-01   +1.672113311704533e-01   +1.357039995153256e-01   +8.647288373534557e-01   +6.276027099522676e-01; +7.308784345754090e-01   +5.977116655795904e-01   +1.051373546505120e-01   +2.410796714529520e-01   +9.158202187051605e-01   +1.923479163915242e-01   +6.345319619236950e-01   +2.548154292410951e-01   +5.208223675780388e-01   +6.965254622114063e-01   +2.415462935166007e-01   +8.875303643583320e-01   +8.629149187734497e-01   +6.790142099424742e-01   +6.130564976766008e-01   +6.613640731625042e-01; +3.446067563321005e-01   +4.727106620773997e-01   +6.108327122760618e-01   +6.756814896392243e-01   +1.231673545469164e-03   +7.403141021023499e-01   +9.464139803315234e-01   +6.135716085112809e-01   +9.929193331138085e-01   +9.186925864369928e-02   +4.428235518453437e-01   +3.916713327629396e-01   +9.895782480139366e-01   +4.944444662197721e-01   +9.888537113639609e-01   +7.303702083657113e-01; +5.856375395581609e-01   +6.961529496241374e-01   +7.804937636057262e-01   +2.875636961837920e-01   +4.626278472243563e-01   +2.426641582783240e-01   +2.097713968896373e-01   +5.823813524061028e-01   +2.211448303088686e-01   +5.239244984874658e-01   +6.869886354454118e-01   +7.702263958784967e-01   +5.156844892484698e-01   +1.875526812072180e-01   +5.254953653418503e-01   +8.924561723692108e-01; +1.087483497831366e-01   +7.012000090306960e-01   +4.231799279381142e-01   +6.711032191493478e-01   +4.258467286866850e-01   +9.189852234081761e-01   +7.080236005257228e-01   +5.410555533467486e-01   +1.047184923829704e-01   +5.320193498628584e-01   +3.586352161812784e-01   +3.962399693846840e-01   +8.842391559247595e-01   +4.941775748899507e-01   +4.810621913062886e-01   +9.828280856364832e-01; +9.059233072332789e-01   +6.396688617910286e-01   +9.076189868162764e-02   +6.932158809420416e-01   +4.605346530466447e-01   +2.701959611814538e-01   +2.374724980978723e-01   +8.704218811017735e-01   +1.110368828755296e-01   +8.619179141212282e-01   +7.363784794500924e-01   +8.099869800512920e-01   +5.883576332303938e-01   +1.487639185390839e-01   +8.030285944768633e-01   +7.694099017742524e-01; +8.815274612257881e-01   +3.255246752012666e-02   +2.645710138682481e-01   +6.669088387322722e-02   +7.717913175469299e-01   +7.658402272558781e-01   +1.196012519874548e-01   +2.649623627486786e-01   +6.577885291426251e-02   +4.840504412122465e-01   +3.947369623595530e-01   +7.547991602799788e-01   +1.549867171068768e-01   +5.390559070115834e-02   +2.282654379375527e-01   +5.826921816882411e-01; +8.179619440904553e-01   +6.900348982419949e-02   +1.531544279138041e-01   +2.520913366056987e-01   +3.235465340428436e-01   +1.893138431354441e-01   +6.083051038334167e-01   +3.152189412275627e-01   +4.038413850651507e-01   +3.926783463234450e-01   +6.846115230895168e-01   +3.771812172251286e-01   +2.001105726076298e-01   +8.516417310302834e-01   +4.964082014964813e-01   +9.261560495237997e-01; +2.596852600507417e-01   +3.193540321827646e-01   +2.822562400893122e-01   +2.211387945035493e-01   +7.839724012346042e-01   +2.859750887094858e-01   +4.523301993541271e-01   +1.181151636450633e-01   +4.469945850476766e-01   +6.719168750704883e-01   +7.033317827809198e-01   +2.171758197526833e-01   +4.075924845003751e-01   +5.610299381449390e-01   +8.990187668471643e-01   +5.810618414576144e-01; +5.942546841832543e-01   +5.305140967686695e-01   +4.418749550879993e-01   +6.690640020816709e-01   +4.705476524654304e-01   +9.162680229264644e-02   +4.589824205088930e-01   +9.393879283062838e-01   +3.657441670343397e-01   +7.421263287656021e-01   +4.417344013135726e-01   +7.896962730402775e-01   +7.481939611745839e-01   +9.300983776481839e-01   +5.758982689757172e-01   +1.638270411259174e-02; +2.168346290960183e-02   +6.537776542992526e-01   +5.259834208124208e-01   +8.448627398603764e-01   +3.697744181797546e-02   +5.774773993624466e-01   +6.617276906191717e-01   +6.456464077408316e-01   +7.626680325719083e-01   +5.189324649146418e-01   +1.810683429567651e-02   +9.497521027288254e-01   +8.244040659770436e-01   +6.980691278961403e-01   +8.439171494062450e-01   +1.217202413726534e-01; +4.258321356798468e-01   +4.075073814263468e-01   +4.591474185186160e-01   +3.449505864647271e-01   +1.770359703443984e-01   +6.829293204813996e-01   +7.698554812039216e-01   +4.804304056052808e-01   +6.268317598766107e-01   +3.441896204021213e-01   +3.291735675231717e-01   +3.280657208778764e-01   +7.917412036862953e-01   +5.836273819401957e-01   +7.392013986860185e-01   +8.616300133608046e-01; +3.122037714805518e-01   +8.195274531208929e-01   +8.755126504200296e-01   +7.823129161113005e-01   +7.196739979721671e-01   +5.468329657137675e-01   +3.500436466737890e-01   +6.393134436468082e-01   +7.716793854553090e-01   +1.488015125198497e-01   +4.229881902308305e-01   +6.728944601672728e-01   +3.201473401713043e-01   +8.154126659438858e-01   +5.862583204691266e-01   +4.831627742271922e-01; +1.600449578757502e-01   +7.196258513899497e-01   +5.186061166770471e-01   +6.773392927863369e-01   +4.732930144270087e-01   +4.246969491550734e-01   +6.621837550347803e-01   +5.447187954944056e-01   +9.324600306694216e-01   +5.864419660812551e-01   +2.694488561314289e-01   +4.394176740944665e-01   +5.339295393130955e-01   +8.804600750859982e-01   +2.451282792568137e-01   +8.442952092407906e-01; +1.777132627133660e-01   +9.687292142305948e-01   +9.450617281906315e-01   +6.885955816476652e-03   +1.536963202547165e-01   +6.440139149500393e-01   +4.158031215830208e-01   +6.477543048233273e-01   +9.734732432852423e-01   +2.614553035565559e-01   +1.963734970586250e-01   +8.326609755029318e-01   +9.065334888011765e-02   +9.892133791455743e-01   +6.651668893076762e-01   +2.088407817662427e-01];
L1E_L1I_iGABA_netcon = [+5.514545497280041e-01   +6.948051042622839e-01   +1.048289816238441e-01   +1.772915948821621e-01   +5.429432133823511e-02   +1.789711388716397e-01   +5.962807870899371e-01   +9.968187698127862e-01   +3.396505993893961e-01   +7.790540596705557e-01   +6.834017530209940e-01   +3.657747029182398e-01   +7.822302798085038e-01   +4.318082634344180e-01   +5.952670942980989e-02   +9.736645901552414e-02; +6.315095115112972e-01   +4.978285244875346e-01   +1.429498349815965e-01   +3.987422752773523e-01   +1.780290674314489e-01   +3.607710281304856e-01   +3.002201410069709e-01   +3.318051942768412e-01   +2.948622836201754e-01   +3.371279392665492e-01   +1.329002967486127e-01   +3.691589555553459e-01   +1.014339394080408e-01   +6.557918140057744e-01   +3.135305759675040e-01   +1.422929890374462e-01; +3.241344353548509e-02   +5.355981138589748e-01   +1.688605209169115e-01   +1.334981228651533e-01   +6.606354028934894e-01   +5.605152470868817e-02   +1.338539214405529e-01   +2.976398042192064e-01   +7.454196978087783e-01   +6.074056847961278e-01   +7.237706883556779e-01   +6.845999671445054e-01   +2.922423882899203e-01   +1.107664801919041e-01   +7.724679492683101e-01   +1.682509268489200e-01; +6.143462744348719e-01   +4.429233676989917e-01   +6.221094313063469e-01   +2.912680971947719e-02   +3.327885480829195e-01   +5.231231892103515e-01   +2.115066440488741e-01   +6.212935945835675e-02   +9.810031665226067e-03   +7.416680378998118e-01   +1.095326217586579e-01   +5.975974494117605e-01   +2.363113360262479e-01   +9.317837619290186e-01   +6.964685511806405e-01   +1.958778610750268e-01; +3.638219912573106e-01   +1.240338398645718e-01   +5.733181574936466e-01   +9.375069863944701e-01   +8.978422089112299e-01   +3.350178173013520e-01   +8.968420521469085e-01   +2.989613311086239e-01   +4.717670159978669e-02   +1.049947646298925e-01   +1.164330900847088e-01   +7.889136475759088e-01   +5.301921467197339e-01   +1.860612931939921e-01   +1.260202582947264e-01   +3.170734538000731e-01; +4.988851361223468e-02   +4.909415563756555e-01   +5.351137020163862e-02   +3.023912518366172e-01   +1.175285202220157e-01   +1.742627085368217e-01   +7.074531670335123e-02   +4.406872787962746e-02   +6.680387279881863e-01   +1.270912625415689e-01   +6.403546066312403e-01   +3.683681269714353e-01   +9.203876367959003e-02   +2.653400156535415e-01   +1.273582802699396e-01   +3.171803454304343e-01; +4.875754172310367e-01   +8.540072178209730e-01   +9.314095634252850e-01   +2.964400188848511e-01   +9.886060517454361e-01   +2.105846023782859e-01   +2.435199741173713e-01   +5.063327014484030e-01   +6.048955403356424e-01   +5.492313387883573e-01   +3.283149371853304e-01   +2.049366636867577e-01   +4.058743909736524e-01   +7.986091395371686e-01   +9.165436293951727e-02   +2.169566524058038e-01; +1.924414930551802e-01   +8.737505486775712e-01   +7.285054664382496e-01   +3.350182845485314e-01   +5.420810977447917e-01   +9.048452605530004e-01   +5.420397737274556e-02   +7.605366324364177e-01   +5.273504620199823e-01   +4.855515803152435e-01   +6.538799904944044e-01   +8.674226533311885e-02   +1.053482509555763e-01   +4.875346576299667e-01   +8.153997403004020e-03   +2.518313421621165e-01; +1.217419438721137e-01   +2.717124599707647e-01   +7.383556579429587e-01   +4.688409595140218e-01   +7.061674667526204e-01   +6.746166528995792e-01   +4.412786313873376e-01   +6.308563004683838e-01   +7.296036497481891e-01   +8.902509267289522e-01   +7.497746640230752e-01   +7.719092633172316e-01   +1.096155570043297e-01   +7.694854933629691e-01   +4.241548997270970e-01   +8.934380596420620e-01; +2.074536043772612e-01   +2.096492443270346e-01   +6.296856454387302e-02   +6.476156091723113e-01   +9.992127124110580e-01   +4.681544941925928e-01   +1.399923045970881e-02   +9.190504974681543e-02   +7.076762399137598e-01   +7.999518981247556e-01   +5.844533076696810e-01   +2.072455889221459e-01   +7.854163980797421e-01   +3.975623946566240e-01   +6.563811229303207e-01   +7.021880979881412e-01; +1.467974305500705e-01   +5.644306705330072e-01   +8.604918617707360e-01   +2.511093543240086e-02   +2.879135634813462e-01   +9.122278216743441e-01   +8.965769579404397e-01   +8.134001144302597e-02   +7.808464150372565e-01   +7.347410236703243e-01   +7.403471987379819e-01   +3.890649785083569e-01   +2.909330723451111e-01   +2.732740192790089e-01   +7.225197824325719e-01   +5.559388796257969e-01; +1.890637116533120e-01   +6.379640920800050e-01   +9.328346691884184e-01   +8.424536757263222e-01   +4.140508436437272e-01   +1.047882673721747e-01   +1.955802658484526e-01   +7.752672106557829e-01   +2.875367041211980e-01   +5.300624255310373e-02   +2.348834837591175e-01   +5.511309833047873e-01   +6.046985459416426e-01   +3.667411749669101e-02   +5.305349154208064e-01   +1.849487789947080e-01; +4.272614810860577e-02   +4.161740079677924e-01   +9.838964982010914e-01   +5.587656493723953e-01   +4.669370130321969e-01   +7.452659295584914e-01   +9.217401523616452e-02   +9.043348646396728e-01   +6.901807839564343e-01   +7.327674419056279e-02   +7.346340221345214e-01   +2.295461650570974e-01   +9.643778857828693e-01   +6.736620186167800e-01   +1.085405771822888e-01   +2.132562411274172e-01; +6.361753442786328e-01   +2.061610119176333e-01   +8.581769933619726e-01   +8.537737749758776e-01   +7.645400342442493e-01   +7.369595368646815e-01   +3.077920179513079e-01   +5.343675935887245e-01   +5.552815049956149e-01   +8.708469355642040e-02   +9.710926005482163e-01   +6.418638093772548e-01   +4.319928249750276e-01   +4.317759253525905e-01   +6.328819177986228e-01   +7.611106465597625e-02; +2.811244706020625e-01   +9.491208981091163e-01   +7.856342479469353e-01   +3.498347127714994e-01   +8.182701778562430e-01   +5.621920471585125e-01   +4.555542582450027e-01   +1.076540077125513e-01   +3.946686849062149e-01   +7.957464058941665e-01   +8.671009797424761e-01   +4.833143944898916e-01   +6.942672982859003e-01   +4.515033812276034e-01   +1.283068638963695e-01   +9.143836063600422e-01; +5.381938827376055e-01   +7.971000373654095e-02   +5.142566965401123e-01   +4.460699358493759e-01   +9.959169912353849e-02   +1.858293498986172e-01   +1.016352125203398e-01   +8.275949832496998e-01   +6.139042151624693e-02   +9.407744379356463e-01   +8.731686677027301e-02   +1.512436816785976e-01   +7.578328773761368e-01   +6.099396171448709e-01   +1.343234105511102e-01   +7.075297827251126e-01];
L2I_L1I_iGABA_netcon = [+5.577387714851647e-01   +1.589606801943095e-01   +4.230492498682464e-01   +6.832022566822957e-01   +8.079322870460791e-01   +7.948858132241143e-01   +7.882426683627313e-01   +2.692805219564096e-02; +3.140023186051987e-01   +7.586608570301012e-01   +4.302829097139773e-01   +4.642010892653429e-01   +7.465483768518580e-01   +5.771761862722145e-01   +8.511959306374890e-01   +4.211181107786584e-01; +1.673658202007978e-01   +8.693825696253464e-01   +1.247858339574785e-01   +2.137123065444894e-01   +1.188815257989286e-01   +4.405196704401585e-01   +5.064536922749941e-01   +1.824223088033265e-01; +6.212174161487715e-01   +3.506086502207331e-01   +2.472382981197071e-02   +9.762281306376687e-02   +5.253633884022622e-01   +2.569091221535714e-01   +6.350821653913702e-01   +7.268473304852784e-01; +9.874472193015011e-01   +6.865445831099785e-01   +2.904273954123850e-01   +8.234288229431170e-01   +3.245640961242779e-01   +7.518971386228570e-01   +9.515561891592186e-01   +3.706792891156346e-01; +1.724437606807076e-01   +2.934620481159469e-01   +3.187417079866948e-01   +1.749187767396135e-01   +5.461284275221540e-01   +2.293617528262951e-01   +4.445439377051319e-01   +8.415853388095641e-01; +2.578610326980822e-01   +5.291680396856425e-01   +6.534163736463716e-01   +1.646975191412254e-01   +4.002827728639804e-01   +6.543550644939228e-02   +5.957041084118704e-02   +7.341667865706989e-01; +3.973084323078649e-01   +8.324877166278414e-01   +9.565446701115566e-01   +6.678617154493097e-01   +4.156722297099675e-01   +7.657687026840682e-01   +8.677400434641137e-01   +5.699177529368934e-01; +7.428766417692781e-02   +5.983005323205405e-01   +9.374345738042490e-01   +8.938980173105769e-01   +1.793573332938063e-01   +6.715507931418921e-01   +6.309107533968892e-01   +1.777143141708063e-01; +6.849228934392285e-01   +3.348812871311403e-01   +4.573880254951226e-01   +5.153247870227738e-01   +2.553618553200865e-01   +7.149952534803888e-01   +3.528913387294342e-01   +9.597400476268380e-01; +4.039144707405407e-01   +2.987111195318222e-01   +2.401283868514535e-01   +7.028816242586845e-01   +2.017721830536294e-02   +6.417330568405278e-01   +9.970317444286869e-01   +2.657607615905914e-01; +9.826951162858217e-01   +4.522881023895488e-01   +7.647656639583589e-01   +1.512974533346979e-01   +9.224074354779596e-01   +4.198960039348592e-01   +2.253527673149646e-01   +9.251371677243125e-01; +4.012208068634835e-01   +4.230959334959364e-01   +7.598923729639098e-01   +9.520889417967310e-01   +6.542713886083606e-01   +3.895406136014898e-01   +6.526526384494624e-01   +2.205819419238500e-01; +6.217282943436918e-01   +3.594674489797094e-01   +7.408903691455024e-01   +5.397843481933834e-01   +9.340863808203528e-01   +8.166132368076794e-01   +6.042123023265079e-01   +3.720960119052352e-01; +1.552409499506599e-01   +5.603384144693175e-01   +7.443535925521771e-01   +6.817212100652639e-01   +1.643421661707274e-01   +3.159358947086687e-01   +3.887804026411225e-01   +8.845221383424223e-02; +3.815339399743994e-01   +7.433137861092592e-01   +1.082785799389380e-01   +3.653972627780075e-02   +9.215753281045408e-01   +8.162274214191231e-01   +1.403583510023718e-01   +6.414853405090781e-01];
L1I_L2I_iGABA_netcon = [+1.813631319747848e-01   +9.110323508842622e-01   +2.764201899003908e-01   +8.760330559592530e-02   +5.334746252906446e-01   +1.071154499701106e-01   +9.873123753091856e-01   +4.118997502901399e-01   +7.196089026396248e-01   +2.168806280842691e-01   +9.222688421149503e-01   +6.729979381810721e-01   +1.074870960231601e-01   +5.557808889426716e-01   +6.306570443702635e-01   +4.844684133614607e-01; +4.651020571345198e-02   +7.987894238716414e-01   +2.474500495952044e-01   +8.032386923313507e-01   +8.869076471284487e-01   +6.147587707037796e-01   +7.665226520033703e-01   +6.001122101445463e-01   +9.973211465709210e-01   +1.267869778687125e-01   +7.701075706249354e-01   +4.766053694612680e-01   +1.813090582778237e-01   +7.719212143901528e-01   +9.967896011292356e-02   +8.942423099619148e-01; +7.234308480609574e-01   +7.435586885497110e-01   +4.512130991144492e-01   +9.890192329167466e-01   +8.976772379395508e-01   +9.399895394955415e-01   +3.370620420625864e-01   +7.494304356018734e-01   +3.548817877909014e-01   +3.089378955252581e-01   +4.229787975318101e-02   +6.236194657725871e-01   +1.001785049677734e-01   +3.121419513918446e-01   +3.915810401580410e-01   +1.380372812276723e-01; +3.492606817641818e-01   +8.126559743027034e-01   +2.261338282948473e-01   +6.637650299718310e-02   +6.250460240268648e-01   +3.532398267197375e-01   +6.627303955462784e-01   +5.835160721611491e-01   +9.705683679328537e-01   +7.256015764909677e-01   +3.786260902131796e-01   +2.380120326254015e-01   +4.897158031232017e-01   +1.774989129292742e-01   +5.598865481235715e-02   +3.889375643529389e-01; +6.610939798070600e-01   +3.845921384817286e-01   +8.046508395717583e-01   +9.395359743315811e-01   +1.375416076534610e-01   +4.112739395012642e-01   +2.453978238494331e-01   +5.516619874144203e-01   +3.471506411544256e-01   +7.825037577690935e-01   +7.036684294850106e-01   +1.774730634179580e-01   +1.920862434061075e-01   +3.388545031949616e-01   +4.999934344786960e-01   +9.272594432475367e-01; +3.849958809172376e-01   +6.168693385571663e-01   +9.852383997246815e-01   +1.856383828370489e-02   +2.183450248411301e-01   +9.824209573357640e-01   +2.951920816974306e-01   +5.813352276265272e-01   +8.859513012817928e-01   +6.920598148958577e-01   +7.280443127226544e-01   +8.290791427416382e-01   +8.937338765546514e-01   +2.101924250443751e-01   +4.309614993461968e-01   +9.180958190743862e-01; +6.277791986714903e-01   +5.772506630452355e-01   +3.064844877409361e-02   +6.843908153930602e-01   +1.817658792863903e-01   +9.457547656947495e-01   +6.789362699793104e-01   +5.113911384294442e-01   +4.551450544682542e-01   +1.000634649400529e-02   +2.244099700991696e-01   +7.662167485872751e-01   +9.925828983225164e-02   +5.110753997281257e-01   +9.977421907251124e-01   +7.159651318487429e-01; +2.298897185170724e-02   +5.275796664136572e-01   +5.351992199242975e-01   +7.824942344432895e-01   +4.285675291511284e-02   +6.768736993277678e-01   +5.262456623504206e-01   +8.028231579043139e-02   +4.155799008283907e-01   +8.456904008349297e-01   +2.690528857991061e-01   +9.339113010655367e-01   +4.600238054371733e-02   +9.053814619087658e-01   +8.107943582179685e-01   +6.185753448450607e-01];
L2E_L1E_iAMPA_netcon = [+3.423157186704252e-01   +7.584676374645879e-01   +5.903229618934643e-01   +5.010490929695472e-01   +8.518360281491991e-02   +4.702121743115991e-02   +9.236063591336227e-01   +4.758168596313141e-01; +9.369676211916409e-01   +4.142336667267338e-01   +6.603892119547241e-01   +4.884165419440422e-01   +9.738277121796984e-01   +3.437711800688674e-01   +8.010778689193366e-01   +3.641463965969283e-01; +1.238443841602250e-01   +4.948040438260849e-01   +4.826520271731949e-02   +8.782637659370642e-01   +6.511760989707102e-01   +7.375865097316227e-01   +2.862632218861778e-01   +7.878841030236600e-01; +7.317241942959382e-01   +6.962750972471361e-01   +3.494530383650274e-01   +3.512211351997588e-01   +2.303098713220944e-01   +7.945782257545758e-01   +5.448334678401251e-01   +7.810153220646989e-01; +6.477410412247165e-01   +9.744035419611294e-01   +4.495543210540581e-01   +4.479371599969328e-01   +4.034197183124552e-01   +5.439216212363266e-01   +9.841693170236933e-01   +6.682074195281432e-01; +8.326788603439153e-01   +3.282627264537747e-01   +2.396734227620397e-01   +9.637050448415990e-01   +1.204349267302003e-01   +6.880688687786364e-01   +7.146458290813352e-01   +1.339789236387247e-01; +3.969021271750954e-01   +8.366365260252415e-01   +7.143133977808348e-01   +4.197009687618766e-02   +2.686690308713305e-01   +8.957425374118484e-01   +8.373802006169452e-01   +2.027628244413254e-02; +7.497199510165610e-01   +7.395935184392264e-01   +8.582422081929353e-01   +9.741051690170619e-01   +2.555972622760205e-01   +5.485425728325073e-02   +4.342294495198049e-01   +5.595933497795192e-01; +8.347472421951817e-01   +9.537143438766651e-01   +2.827487632986060e-01   +1.886050222581500e-01   +3.320744280842725e-01   +3.030004705808079e-01   +4.718680168214463e-01   +3.004395778804294e-01; +3.234017382298154e-01   +3.281566198281786e-02   +7.325296741282635e-01   +6.655653030724565e-01   +1.495876512492540e-01   +4.501642581187529e-02   +5.612673278829950e-01   +9.396433145355991e-01; +5.519276167009882e-01   +3.552974549494518e-01   +1.399421628803402e-01   +5.870230897523221e-01   +3.470105844003147e-01   +1.953345128371788e-01   +2.704905644390678e-01   +9.813119535185594e-01; +9.817732999921264e-01   +6.613242268781860e-01   +8.390750535095538e-01   +6.749096391478788e-01   +1.201540775434788e-01   +7.190594553314005e-01   +7.487544033970872e-01   +2.865809481070141e-01; +5.489652438080689e-01   +2.826167343376039e-01   +1.388019013098234e-01   +3.585870849607898e-01   +8.830272092248314e-01   +7.225670480774916e-01   +5.054192970375478e-01   +7.996866915915438e-01; +3.314737592195801e-01   +2.313570243593132e-01   +5.878442855181714e-01   +6.189724291138177e-01   +9.471770900765564e-02   +8.765314616515425e-01   +6.469937650499105e-01   +8.941533486123885e-01; +6.197807254920744e-01   +7.100812590182198e-01   +3.671650750179307e-01   +8.118099537093355e-01   +9.317596391537503e-01   +5.805955284735761e-01   +3.077076961339298e-01   +5.984150152580812e-01; +3.611158942762652e-01   +6.243055151823669e-01   +8.064526193465391e-01   +2.027161735547431e-02   +3.995999520193880e-01   +7.272951457109890e-02   +1.384742339412440e-01   +8.838477030823486e-01];
L1E_L2E_iAMPA_netcon = [+9.434938991072296e-01   +3.730734022208247e-01   +6.689155921671107e-01   +4.861062964917524e-01   +2.465703059833760e-01   +4.520276219000127e-01   +1.237946134803950e-01   +4.966435756580658e-01   +8.833682503132281e-01   +3.253431371747612e-01   +5.156398501871313e-01   +8.570491417210460e-02   +6.316299466739993e-01   +4.282356356868853e-01   +6.132324933325718e-01   +5.038165385027508e-01; +5.483939589643921e-01   +9.353518398074288e-01   +2.081766010092716e-01   +7.572525728062731e-01   +7.842515423713672e-01   +2.056770065887976e-01   +4.073367256800831e-01   +6.931757524590906e-01   +7.208096706296557e-01   +2.459412023929424e-01   +6.574303801709318e-01   +1.637511725687217e-01   +8.585386054019789e-01   +4.921842710781892e-01   +8.206458342797988e-01   +6.112485485629513e-01; +7.277901821521325e-01   +8.291615674518278e-01   +6.543685117056064e-01   +4.161095029163105e-01   +8.823509688616608e-01   +8.993485067033841e-01   +2.754813430514881e-01   +8.347650046148587e-01   +1.843436584736583e-02   +3.424006743691693e-01   +9.517195199482436e-01   +3.242008214766922e-01   +9.763755360431476e-01   +7.171739627658752e-02   +8.867857978301178e-01   +8.200103666225794e-01; +5.777179085604670e-01   +8.502985982319055e-01   +7.190812565231429e-02   +9.717999151690465e-01   +9.126807334061093e-01   +7.628188948626182e-01   +7.171220424333994e-01   +6.127419576803667e-01   +6.745867217975924e-01   +3.758246341595964e-01   +7.222833757909629e-01   +3.002310640571330e-01   +5.696425582253588e-01   +8.876366847648974e-01   +9.300381539904795e-01   +5.332504479625453e-01; +2.528720086087916e-02   +3.722226120981526e-01   +4.066030881660613e-01   +9.899934738228146e-01   +5.585046678134816e-01   +8.837342067484244e-01   +2.818310332810350e-01   +5.746068566054343e-01   +4.385299235513397e-01   +5.450852543775909e-01   +3.995131939841734e-01   +1.120716118917304e-02   +9.959207188525864e-01   +6.563846851005967e-02   +1.919442286308872e-01   +2.025780064250959e-01; +4.473117560615535e-01   +5.926504673503448e-01   +6.663020498296190e-01   +8.641904343713238e-01   +5.979851796348500e-01   +2.867254281037200e-01   +8.947168232475169e-01   +3.251231040346864e-01   +4.365774868743386e-01   +5.625227062892683e-01   +8.342647305023100e-01   +5.409694936736739e-01   +5.538852516612648e-01   +4.356723362635033e-01   +2.572473876065140e-01   +4.544691756141672e-01; +6.470147634383920e-01   +8.740834206062614e-01   +9.370207421215531e-01   +3.877034236515042e-01   +1.488203893442976e-01   +6.703242054746238e-01   +8.271987778980701e-01   +4.552792183506705e-01   +1.158571550300527e-01   +3.944715558477534e-01   +1.354600835916985e-01   +9.675873311860497e-02   +5.160420903707542e-01   +8.257148820333429e-01   +8.977123143521664e-01   +4.288375671535350e-01; +5.219834795639787e-01   +9.333651817496081e-01   +8.100204021018315e-01   +4.530868957863630e-01   +9.011047679164748e-01   +6.631380552202539e-01   +3.906089718552220e-01   +7.145046306711124e-01   +8.149995440131921e-01   +3.961413878503492e-01   +5.982208849748318e-02   +1.457838463492993e-01   +3.319105742798386e-01   +3.930804690420558e-01   +5.932520588125458e-01   +9.650434166262597e-01];
L2I_L2E_iAMPA_netcon = [+6.181059008134929e-01   +6.954805391612521e-01   +7.341314977681888e-01   +5.904005776454452e-01   +6.702344556124424e-01   +5.460445995557681e-02   +9.917952514775531e-02   +8.482842353541160e-01; +6.972916254897367e-01   +4.268170488700719e-01   +4.299576105721846e-01   +4.585792057861519e-01   +5.004969350365622e-01   +1.542546072738596e-01   +9.078282639247031e-01   +9.175878065833120e-01; +7.204356040556155e-01   +8.363589790404006e-01   +6.927915228122316e-01   +5.138953028592705e-02   +2.195204876666267e-01   +1.959124255255244e-02   +1.100322174537022e-01   +9.862936416297972e-01; +3.479093529759630e-01   +7.303216245185494e-01   +9.449784407505908e-01   +2.287577109615331e-01   +5.716490536423769e-01   +4.352993601204230e-01   +5.182686837615393e-01   +5.037372440368173e-01; +5.168922852202011e-01   +3.605904555801543e-01   +7.838646481661427e-01   +8.343790213673637e-01   +1.220898037336879e-01   +8.320545679469922e-01   +1.420852471166736e-01   +2.706065176999198e-01; +5.563339230370333e-01   +4.542351033350130e-01   +7.057824146492929e-01   +1.589877272462735e-02   +6.709748194109733e-01   +6.183499446528218e-01   +5.601928655483057e-01   +1.024931518498481e-01; +1.579272633885331e-01   +3.887951974936925e-01   +1.100452615750214e-01   +8.635772245977600e-01   +5.987013602286254e-01   +5.205971725772234e-01   +5.014599895486775e-03   +5.071519607466974e-01; +5.635537307712830e-01   +7.747500608156721e-01   +3.905035139063325e-01   +7.963688943192233e-02   +5.533758346186515e-02   +8.642274667482339e-01   +7.676429199099305e-01   +5.847280948089513e-01];
L2E_L2I_iGABA_netcon = [+7.635268872361807e-01   +9.411542210332225e-01   +2.393979321944825e-01   +8.340899287749627e-01   +2.580801446351842e-01   +7.634770328457306e-02   +1.741792308179005e-01   +5.239060861770379e-01; +8.305135945935399e-02   +6.560144884085048e-01   +5.790840263954441e-01   +4.011866880975293e-01   +2.986715670669732e-01   +3.939018292358624e-01   +1.403632457441635e-01   +2.639246569568957e-01; +6.598454574301353e-01   +4.519420562993030e-01   +8.662084866615999e-01   +3.904847177459591e-01   +4.244071242730533e-01   +3.705541685566696e-03   +5.969675028578673e-01   +6.894771884990691e-02; +5.169271150571025e-01   +8.405491215392502e-01   +4.056746126473978e-01   +3.629934838962468e-01   +1.172776248337873e-01   +2.200356836318121e-01   +9.001163966176912e-01   +4.353952048221774e-01; +1.722227191986813e-01   +5.327649010422200e-01   +1.115960199872302e-01   +1.379120121728124e-01   +4.972217991626873e-01   +7.497463465002580e-04   +9.384721946125513e-01   +1.740365281035183e-01; +9.404179950230092e-01   +5.534686767348196e-01   +4.435903193006773e-01   +2.580690269689763e-01   +7.074428249784130e-01   +1.903780861202347e-01   +2.208384113193848e-01   +2.627635283608848e-02; +5.912670264800531e-01   +6.805109851257423e-01   +2.972330731606105e-01   +8.652303521905526e-02   +2.449081232792699e-01   +1.429950701449399e-01   +4.812027466515384e-01   +9.543431034923917e-01; +4.408072933603690e-01   +3.678867255265113e-01   +4.008292298314314e-01   +4.298880952262822e-01   +7.842577083941638e-01   +2.682807428727896e-01   +3.780180060420207e-01   +4.302776669575735e-01];
L3E_L2E_iAMPA_netcon = [+9.623152902555733e-01   +7.731268988978721e-01   +9.119516668963802e-01   +5.311376536294592e-01   +4.849108400048896e-02   +8.187258799817050e-01   +6.253625823089559e-01   +7.474723921196922e-01   +6.727175327789002e-01   +9.056728312363722e-01   +5.817813156305449e-01   +5.879887474267522e-02; +7.620806889381427e-01   +2.275720377970579e-01   +9.082377962740013e-01   +7.154117562088138e-01   +5.518135571973977e-01   +7.281547621813893e-01   +5.422783397471470e-01   +6.457426971314395e-01   +4.315928499577323e-01   +3.939161260566113e-01   +6.857716009293290e-01   +9.807677113424268e-01; +8.137766491169615e-03   +3.700161545048836e-01   +5.909859714779965e-01   +1.805454827063370e-01   +2.739852070478319e-01   +1.767257336123281e-01   +4.377990906504227e-01   +1.211963884637106e-01   +6.921529432139657e-01   +2.519440371969503e-02   +7.214276356206385e-01   +2.842795278968944e-01; +6.792222366824747e-01   +8.918340499417038e-01   +3.310535936426842e-01   +3.345207955645586e-01   +2.442080327516757e-01   +3.603124014885744e-01   +2.870841738515045e-01   +5.063138135372757e-01   +2.578015086193570e-01   +6.696538251739512e-01   +6.494493439571656e-01   +5.922275623135409e-01; +7.051423339840563e-01   +8.560416408610548e-01   +8.530899502982708e-01   +1.869145617336776e-01   +2.437031757875348e-01   +1.868906648524237e-01   +5.013011824972242e-01   +3.484885665099642e-01   +1.303649048865482e-02   +8.383185917422444e-01   +7.249138590250348e-01   +9.611644241821820e-01; +6.455139856454348e-01   +3.998725253969078e-01   +4.433930889158219e-01   +3.211456461122765e-01   +1.540437087451577e-01   -2.870565150000593e-05   +7.618211220058815e-01   +9.028466521582348e-02   +5.315435239919977e-01   +9.719227776021653e-01   +3.751949663797163e-01   +1.858631217489442e-01; +5.532964343454574e-01   +3.184579348876125e-01   +9.015242139765940e-01   +4.039964184942122e-01   +9.574028773126390e-01   +3.146007626478805e-01   +7.611531261992240e-01   +1.476598462591925e-01   +2.792038586668977e-01   +5.586337477281832e-02   +5.796622471770920e-01   +1.932526155148626e-01; +2.171455730311203e-01   +6.088543652929083e-01   +3.372427450962268e-02   +5.484848229008012e-01   +9.359303736469107e-01   +6.984215978309550e-01   +5.778401531990185e-01   +1.990166258311247e-01   +9.463045477728198e-01   +4.508898268980633e-01   +1.145209134614660e-01   +3.411159230030042e-01];
L3I_L2I_iGABA_netcon = [+9.329066010042837e-01   +9.322758686585526e-02   +6.272793934510457e-02   +2.795584698960044e-01   +2.539321991484660e-01   +4.040239244701760e-01   +5.285847890805604e-01   +1.081591632035571e-01   +9.126915669170255e-01   +5.831358886545839e-01   +2.077949369129816e-01   +9.071280901805548e-01; +3.906946723862590e-01   +6.174641687198780e-01   +4.955274994742913e-01   +7.449983129799757e-01   +8.574244099361275e-01   +9.875957667168249e-01   +8.300707695534535e-01   +2.708330647806394e-01   +6.385162293224090e-01   +2.827034139050460e-01   +3.180938670767428e-01   +5.510798456659807e-01; +2.711410840837694e-01   +1.150209631819340e-02   +6.426655533711818e-01   +2.382897584209206e-01   +9.113915641433220e-01   +8.995553512168347e-02   +8.584652176413662e-01   +5.229071486293618e-01   +2.547988069447381e-01   +8.282163265813999e-01   +1.339552779384157e-01   +3.436528630361897e-02; +1.513452779431558e-01   +5.736521925287608e-01   +2.224496098083312e-01   +9.574697907054057e-01   +6.994486717158706e-01   +3.224760953261790e-01   +7.874096275885550e-01   +9.722402481278958e-01   +8.995855466732341e-02   +1.922126513677903e-01   +6.736002980795271e-01   +5.455594184034304e-02; +3.964518903952032e-01   +7.874122524729632e-01   +8.388551759674119e-01   +6.213249017248483e-01   +7.253911891073097e-01   +5.130102885920250e-01   +3.194596514512817e-01   +7.087546946404218e-01   +8.380574089694716e-01   +4.422415133072743e-01   +5.704640005252114e-01   +8.070023529614623e-01; +3.758811114634713e-01   +2.344976471779331e-01   +9.706502308839299e-01   +6.005485899534575e-01   +2.294819679998963e-01   +5.822252603564802e-02   +4.530250356070983e-01   +3.110335471589095e-01   +5.840208241277949e-01   +3.933610267394273e-01   +1.697833321759399e-01   +4.505400807048737e-01; +1.300577705204548e-01   +4.471584909529189e-01   +8.470235532318426e-01   +1.725715260552286e-01   +5.745600746638087e-01   +7.263799633671946e-01   +7.528324512274583e-01   +2.943643900673811e-01   +9.483561871468840e-01   +8.271236976689494e-01   +1.484856353154624e-01   +3.815830375844727e-01; +4.346819077892917e-01   +5.692839842396527e-01   +5.070289249367854e-01   +9.051104142254170e-02   +8.113233548625040e-01   +5.569791511974734e-01   +1.112435450133782e-01   +8.498414871663627e-01   +6.077141918258590e-02   +6.790474730715512e-01   +4.762680549752372e-01   +7.909697695936307e-01];
L2E_L3E_iAMPA_netcon = [+3.645998392619652e-01   +7.553589859079900e-01   +7.406133170885766e-02   +5.175480634196997e-01   +7.585203247168179e-01   +4.324959030248075e-01   +1.992417115138914e-01   +8.764630046141045e-01; +5.310183032931672e-01   +9.972451326753148e-01   +5.917385780946696e-01   +9.948943361377965e-01   +9.946575849575802e-01   +5.421540343769591e-01   +1.940531769421205e-01   +7.871522468079385e-01; +7.138891550667337e-01   +1.875961475512740e-01   +9.102890775121785e-01   +8.565969005040950e-01   +9.626457929027074e-01   +7.112326952630091e-01   +3.258872657923565e-01   +4.678046445537060e-01; +8.697909136097451e-01   +7.808127638605259e-01   +1.914089541606972e-01   +9.609968988834390e-01   +5.368297914388245e-01   +1.530708925187227e-02   +8.803804263119169e-01   +8.137688589412535e-01; +3.288302273534591e-01   +1.952904807849631e-01   +4.310374724660966e-01   +6.784970263187436e-01   +9.664018173849699e-01   +8.012956671669778e-01   +4.723854900807025e-01   +8.972327989528203e-01; +6.498202495589824e-01   +9.917437520983688e-01   +7.498346049788247e-01   +4.027979102182593e-01   +1.162801441226066e-01   +1.431290301583308e-01   +4.037134551054481e-01   +4.279425304099411e-01; +9.755175711576168e-01   +8.021536227492637e-01   +3.971939531554449e-02   +9.341474370484086e-01   +5.036656987717059e-02   +4.792097996447167e-01   +1.799663693502425e-01   +3.337626171369757e-01; +7.580763844030022e-02   +4.244941951522300e-01   +9.455100059273598e-01   +4.802937453392722e-01   +3.034045353463556e-01   +2.561113566458224e-01   +9.692405394375235e-01   +5.955133569123435e-01; +5.885440967244827e-01   +7.278743502115738e-01   +7.631979298431463e-01   +2.293417679238107e-01   +5.823552500598309e-01   +3.680322322495514e-01   +4.092521635315702e-01   +9.018071764598132e-01; +4.131214802962258e-01   +4.977912235593859e-01   +5.561394404314702e-01   +3.959448716914972e-01   +5.323625506507564e-01   +6.609547392144651e-01   +8.438810698529183e-01   +7.014957753721492e-01; +3.077087583589803e-01   +8.084636712398590e-01   +1.830745782201603e-01   +7.044476719105169e-01   +8.998438223216948e-01   +1.686855147086355e-01   +6.163237961091578e-01   +3.790000858625473e-01; +2.630117067935729e-01   +3.570487572992790e-01   +4.997002017871504e-01   +5.596660266156183e-01   +5.402214463412279e-01   +2.807330882293040e-01   +3.732287395507134e-01   +7.353721443049472e-01];
L2I_L3I_iGABA_netcon = [+9.556887462247565e-01   +3.005805554533911e-02   +9.070183421050475e-02   +4.593184492757896e-01   +3.270150283529438e-01   +3.675792672670197e-01   +6.844709889691601e-01   +8.042548949489312e-01; +5.417050327369972e-01   +2.084159858744855e-01   +5.930262937427249e-01   +6.393240402140631e-01   +8.049455232959646e-01   +2.101663813134080e-01   +9.098184331650410e-01   +6.568709985057497e-02; +5.382963826057211e-01   +4.544198332708410e-01   +2.415362674175044e-01   +9.165442016189598e-01   +9.987884585727509e-01   +4.399776202259422e-01   +6.112617643211877e-01   +9.493804915145267e-01; +3.094601081673137e-01   +1.262416528818694e-01   +8.393087170670918e-01   +1.611266621850445e-01   +9.793189301564619e-01   +9.558386232594153e-01   +9.001283411818745e-01   +4.959197456234647e-01; +7.045639381507936e-02   +9.683163469122210e-03   +8.572679021111427e-01   +7.130475286712455e-01   +1.260761667781414e-01   +1.236338233535649e-01   +1.942619726308461e-01   +7.542805858635209e-01; +1.817463459105719e-01   +7.267025390594575e-01   +9.617428301155841e-01   +5.770120434982627e-01   +2.310410819916453e-01   +4.694677263885683e-01   +7.531203279259494e-01   +7.405450230708288e-01; +9.206817448145629e-02   +3.536050504188750e-01   +4.892747495027853e-01   +4.325230131648501e-01   +2.295502566542036e-02   +8.541373551088478e-01   +3.469967675660930e-01   +8.310303742870904e-01; +4.637012741767738e-01   +7.781632177528034e-01   +2.194337098317676e-01   +8.831285171213779e-01   +6.078872799698982e-01   +4.126709346801863e-02   +4.186809290742862e-01   +1.564337987747023e-01; +9.277666372282601e-03   +4.361557100907003e-01   +2.267676856486426e-01   +3.896962461456657e-01   +1.103188048299916e-01   +6.898663289916056e-01   +1.536933826135292e-01   +4.567228924402858e-01; +9.137266924007813e-01   +4.371179893855659e-01   +5.360874312391314e-01   +1.769058334058437e-01   +4.069630322395675e-01   +9.770976658720879e-01   +8.198401834769987e-01   +6.185829380233325e-01; +6.420688257916057e-01   +5.074374881751494e-02   +7.610075892773684e-01   +6.306618695677161e-01   +8.838612427916053e-01   +2.841971229399131e-01   +6.231107928762923e-01   +9.300538489516055e-01; -4.130346130248789e-04   +4.835100557358677e-02   +3.473823667738783e-01   +6.226659531272456e-01   +5.470935306614219e-01   +1.348956043179858e-01   +7.405144508312058e-01   +8.339733519434817e-01];
L3I_L3E_iAMPA_netcon = [+8.950938513053422e-01   +2.554101055447545e-01   +7.404754781647989e-01   +6.826937907344656e-01   +6.018038272135471e-01   +7.480316880912460e-01   +7.453019057313744e-01   +2.228623479012236e-01   +4.578780367660619e-02   +8.005185694876895e-01   +2.912527571327995e-01   +8.028822348932226e-01; +5.818845930410728e-01   +3.234291912255214e-01   +6.940161228597600e-01   +2.360645416668973e-01   +8.555816153235768e-01   +5.433349628928988e-01   +1.273302759346358e-01   +3.510372992514679e-01   +2.137669487925035e-01   +2.332070835777146e-01   +4.041847961552769e-01   +1.040305915940257e-01; +5.842070897239535e-01   +4.020607963023334e-01   +8.227332290081025e-01   +4.547059361673171e-01   +9.892366086837578e-01   +3.400205303505760e-01   +8.221659140494247e-01   +2.855627741249214e-01   +3.965414987188092e-01   +9.313149670675482e-01   +8.630620065356671e-01   +8.197007549059070e-01; +8.543799924304539e-01   +4.043389265492577e-01   +8.291634061791922e-01   +3.843472975323940e-01   +9.299740130200763e-01   +8.317211205583791e-01   +2.660543703250445e-02   +9.266965152971303e-01   +3.336028814777174e-01   +7.626063613756774e-01   +6.145407470508870e-01   +8.407370862145049e-01; +3.387908364106189e-02   +3.860797431914215e-01   +2.955489486218533e-01   +5.387759310842318e-01   +4.099303965092948e-01   +5.518768487907728e-01   +4.164280889902628e-01   +4.978053649084702e-02   +2.279026447077293e-01   +8.284926348185611e-01   +9.901374999043678e-01   +3.556506894193353e-01; +8.839715496009035e-01   +6.084491894290099e-01   +3.083214796103979e-01   +9.919188435378846e-01   +1.290348664902199e-03   +9.567205464807013e-01   +7.309690752048280e-01   +5.923672701927784e-01   +9.344883760436098e-01   +5.734280953527127e-01   +2.037219764362589e-01   +4.297035374456437e-01; +4.061031266544693e-01   +1.654286367701810e-01   +5.234592477636419e-01   +7.555212923486549e-01   +5.415560528311657e-01   +8.923714771579420e-01   +7.818782209380788e-01   +1.610231452357445e-01   +6.803591178773946e-01   +7.928754600292273e-01   +8.282289663894703e-01   +5.699150325938795e-01; +3.593563487884123e-02   +1.899937635631438e-01   +3.267916937881178e-01   +9.807555020741433e-01   +2.091441844824845e-01   +3.585665043294222e-01   +3.680472581106463e-01   +8.366498061087017e-01   +9.624673683677717e-01   +3.303116078912844e-01   +6.772928181079141e-01   +7.000575437675028e-01; +7.461158540198258e-01   +9.597163500386929e-02   +8.341296451860922e-01   +2.347060315529073e-01   +2.191688345793210e-01   +5.486058074388387e-01   +7.462571642375715e-01   +1.678417981349845e-01   +4.384927642785964e-01   +2.238405518084838e-01   +2.487356130554483e-01   +7.431010571402710e-01; +1.559356188798254e-01   +3.219096153616994e-01   +8.081392939842885e-01   +5.281948893778464e-01   +3.273624006996004e-01   +3.453736205340328e-01   +8.921874106881319e-01   +5.009610667978799e-01   +9.398374973199065e-01   +3.106755820379868e-01   +4.781373009726013e-01   +7.571036621703612e-01; +1.455669996089325e-01   +7.696701853746474e-01   +5.589062513450568e-01   +5.374056564340234e-02   +9.581209966982732e-02   +6.236409847996696e-01   +2.441976987092706e-01   +9.985053910825322e-01   +5.825774406199305e-03   +5.844510262968564e-01   +4.004337366079073e-01   +3.902232304348650e-01; +6.066188248980846e-01   +2.343408081828384e-01   +2.625857653293710e-01   +7.580688045094603e-01   +7.499500326790938e-01   +7.989060653364771e-01   +1.305747703199263e-01   +3.541813250783339e-01   +6.107329436933380e-01   +8.288656266955884e-01   +5.986459760159764e-01   +4.276245342545188e-01];
L3E_L3I_iGABA_netcon = [+9.563438202761890e-01   +8.848000029563581e-01   +8.005959571691446e-01   +9.854845092810367e-01   +9.015327146442474e-01   +9.618508735434532e-01   +6.534735417488184e-01   +4.998040682531014e-02   +1.083949474628484e-01   +4.516910210034444e-01   +8.287942114910710e-01   +5.803847882109180e-01; +5.720445571493169e-01   +4.370423982196289e-01   +9.854022460592582e-01   +5.607310207888647e-01   +9.949515984165420e-01   +5.426527915977027e-01   +6.513164376263415e-02   +4.669055736773120e-01   +4.611199147578571e-01   +3.348521703335947e-01   +6.273696541180853e-01   +6.367275931589457e-01; +8.497960735898422e-01   +7.819190170099773e-01   +1.587183615509717e-01   +9.323902780916755e-01   +6.518570528095465e-01   +3.069082214134259e-02   +2.747704129868527e-01   +3.243377977501179e-01   +4.514746685859184e-01   +6.008399923703608e-02   +5.402591428819667e-01   +6.499666760877627e-01; +2.765777180641920e-01   +1.498588890981503e-01   +2.380968190570776e-01   +7.212069122536711e-01   +1.083446393319661e-01   +6.959916659764759e-01   +2.817064155441268e-01   +6.310593388052169e-01   +5.509226149687706e-01   +7.397836836608741e-01   +6.493292379460741e-01   +8.624655598475272e-01; +6.219640381636754e-01   +6.204897680406193e-01   +7.013327087418447e-01   +4.843057638011040e-01   +3.722734491920740e-02   +5.200002155680654e-01   +8.784139027370116e-01   +2.294272247881460e-01   +8.063816017593869e-01   +5.062715788155088e-01   +7.265660696008479e-01   +5.704821351189157e-02; +5.894287601961270e-01   +2.598279106957764e-01   +3.779498998993361e-01   +6.392503648700220e-01   +6.185112907904565e-01   +6.004927877919689e-02   +4.448173093357500e-01   +5.805872046484072e-01   +7.008409931054128e-01   +2.013398319328329e-01   +9.417456328840669e-02   +8.185716357257575e-01; +9.637268599531501e-01   +4.455458407473266e-01   +9.746987672196143e-01   +8.869564750881134e-01   +5.653225227173793e-01   +8.891730502161230e-01   +7.574054235338099e-01   +6.033129503363026e-01   +8.728052698217338e-01   +4.261441248791571e-01   +8.786407939746610e-01   +5.292992842498377e-01; +8.717408533363517e-02   +8.441983008458198e-01   +9.701108207483669e-01   +1.980361905623549e-01   +9.624293890498704e-01   +3.302461020650806e-01   +6.014284641053051e-01   +5.995511399649571e-01   +5.305050402814337e-02   +1.681193241064700e-01   +1.343412088009896e-02   +6.952915174332450e-01; +5.013896739512642e-01   +1.975334286905790e-01   +6.427080152315116e-01   +3.959692378814692e-01   +7.468295682786948e-01   +2.288378507301798e-01   +7.822127694462033e-01   +4.475985137987601e-01   +2.188247643215033e-01   +7.522546849849833e-01   +2.926795831503868e-01   +2.112919035302230e-01; +5.209331274706765e-01   +3.034052077833481e-01   +8.604293026220232e-01   +9.914944102034760e-01   +6.621970137972456e-01   +1.138449883011721e-01   +1.133115894041904e-01   +3.401180033278645e-02   +4.585966300633707e-01   +3.671867278924374e-01   +1.805213379024394e-01   +5.441251989174514e-01; +9.150764613109456e-02   +4.805522693229559e-01   +4.017155969162214e-01   +4.012706629847279e-01   +5.246475207183489e-01   +3.113129105285758e-01   +9.780403809815207e-01   +5.124287383999746e-01   +9.593893894625481e-01   +9.416749490585207e-01   +9.263947761375807e-01   +7.044708877789944e-01; +9.073698702235649e-01   +3.369052777828593e-01   +6.317027998750331e-01   +6.591994758353089e-01   +2.586780697870826e-01   +2.278099586178009e-01   +8.484821088346037e-01   +4.070309258210386e-01   +7.927989146451239e-01   +1.499353373509287e-02   +6.985102487160706e-02   +9.552907855809738e-01];
L2E_Input1_iAMPA_netcon = [+9.963849526365882e-01   +9.994210379219709e-01   +9.978173294394472e-01   +9.992289126639002e-01   +9.962970734259590e-01   +9.973056876322192e-01   +9.970980955589080e-01   +9.966796408292051e-01];
L2I_Input2_iAMPA_netcon = [+9.979763038408166e-01   +9.977535387290610e-01   +9.987035006693558e-01   +9.996907428236641e-01   +9.980660256889905e-01   +9.971346117763091e-01   +9.993879745987237e-01   +9.985102581960444e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
