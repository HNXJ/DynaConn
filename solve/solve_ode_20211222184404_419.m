function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.621800516915897e-01   -3.133188356602086e-02   +6.699949055772276e-01   +8.763855949394539e-02   +4.901799405109759e-01   +4.118555146697301e-01   -2.408799894459825e-01   +8.173537778843762e-01   -1.321255165127286e-02   +3.758400782875289e-01   +1.863291552020960e-01   +2.618323724046662e-01   +4.052811263084478e-01   -4.092806107271144e-01   +4.286140516536926e-01   +4.965650869966897e-01; +1.405781955176951e-01   +2.167522048275390e-01   +4.619937312491202e-01   +5.593823004618124e-01   +2.024943060548650e-01   +4.857390255761133e-02   +4.394048925216871e-03   -2.265827829956865e-01   +4.509649976534639e-01   -3.133318165184159e-01   -6.333388559555750e-02   -3.970413666421438e-02   +1.213650002469318e-01   +2.567240415086102e-01   +2.148226131987787e-01   +8.505569156513483e-01; -7.075803640326166e-02   +4.245511816431253e-01   +1.414449489373692e-01   +7.263986789704426e-02   -1.028909963221792e-01   +4.901649468567433e-01   +1.843090517798195e-01   +2.214121448661653e-01   +3.595467501629657e-01   +2.493070846854563e-02   +6.591024360056023e-01   +4.520841664486683e-01   +7.288281423383907e-03   -4.090150381196240e-01   -9.346642676574674e-02   -5.885477396887340e-02; +7.176228932237494e-02   +2.573936740465856e-02   +2.679108882325928e-02   +7.242668542358368e-01   -1.874662597568042e-02   +2.080386463382993e-01   -2.491706374108140e-01   +5.798383935051673e-01   -2.225916774948666e-01   +2.359062821418396e-01   +7.090900716183564e-01   +3.997188567753375e-01   +1.605834895471316e-01   -4.118511793200212e-01   +6.064428468668879e-01   +5.103686604082142e-01; +4.294948966332537e-02   +3.339567862455367e-01   +7.323215481597016e-02   +4.907807660460720e-02   +3.017375480033707e-01   +3.528680044686729e-01   -2.533191563570321e-01   -2.743802472909185e-01   -1.912888789670191e-01   -5.975581792893474e-02   -3.218840241204973e-02   +7.248398259266284e-02   -5.112980574296535e-01   -2.571432890450472e-01   +8.400352282985152e-03   +6.301113964244948e-01; +2.166816037609678e-01   +1.380917299787442e-01   +3.841870021169287e-01   +3.969596213591686e-01   +1.022445182070831e-01   +4.993635760495739e-01   -4.927048994681288e-01   -9.618275498151105e-02   -5.013691488860536e-01   +3.687809642179479e-01   +2.574852037167651e-01   -3.105354205141083e-01   -4.699487474299258e-02   +7.320926776803623e-02   +5.584850269383625e-01   -5.317916945200647e-01; +5.322031699904606e-01   -2.120329914612581e-01   +2.436416776099252e-01   +1.491773680312822e-01   -1.720653653933901e-01   +1.355722664597566e-01   +1.843058770264150e-01   +4.208712762758930e-01   +6.415980490408855e-01   -1.851476978874749e-01   -7.784547485020454e-03   -2.952072746194906e-01   +3.677643947732052e-01   -2.493617853040505e-01   -1.769271862349852e-01   +2.197291115986471e-01; -2.975175328487039e-01   -2.323795385569637e-02   -4.880749751353134e-01   +1.555737985262104e-01   -7.478829293373010e-02   +8.679108719081473e-02   -3.187147147004112e-02   -4.561982547520192e-02   +4.734699288972544e-01   +4.436442496723719e-01   -2.225374562663494e-01   +7.374696474039184e-01   +1.483581913250568e-01   +2.085169095019883e-01   +4.639329237483149e-01   +6.988731423312911e-01; +3.361246592623044e-01   +1.254190562645824e-01   +1.058101716181303e-02   -9.834361261412317e-02   +5.907184327099780e-01   -8.776839495124220e-02   -4.160814350901046e-01   -2.609243992539277e-01   -2.800330616271439e-03   -1.261062925605534e-02   +5.343901248848404e-01   -2.355008849091716e-01   +3.883545216436690e-01   +4.497167996217917e-02   -2.844447037555353e-02   +5.601391787821799e-01; +1.972615335636754e-01   +2.653856253039985e-01   -2.544309148211041e-01   -4.919174128736661e-02   +2.653437878652101e-01   +3.537366227891028e-01   -3.383566056070075e-01   -4.011308642565742e-03   +6.956180574926615e-01   +3.948328685475006e-02   -2.464825161732795e-01   -2.524777854012885e-02   +1.558241901745103e-01   -7.234216084624367e-02   +3.685727886924708e-01   +1.180862375880096e-03; -2.287503275508133e-01   -2.401095517745546e-01   -5.651865309140099e-02   -1.623617005716891e-01   -9.046312302514875e-02   +3.701610440330335e-01   +5.427133758141387e-01   +3.933735650107663e-02   -2.476463986008514e-01   +1.797110610393028e-01   +7.881347388667195e-01   -1.481265785108555e-01   +2.502346098492190e-01   +3.943963166250921e-01   -2.919668217284675e-01   +4.351830305553223e-02; +2.952251084103071e-01   -9.207600719112874e-02   +1.306582130835318e-01   +3.431345267415237e-01   +6.372386567284598e-03   -2.766988125796754e-01   +7.123943099033333e-01   +1.187345182503136e-01   -3.316794736965954e-01   +5.618721038691887e-01   +6.872243445254139e-02   -3.385236172253941e-01   +4.968795626821862e-01   +8.128600423859487e-01   -1.179909491653512e-01   -5.874667367974958e-02; +2.878932075185189e-01   +1.453452528381062e-01   -2.658239781348420e-01   +1.330660287132125e-01   -1.301065570258762e-01   +1.304571286609109e-01   +2.006699806999060e-01   +1.455612248254100e-01   +2.803437180323340e-02   +6.492285849208906e-02   -1.198657730790794e-01   +5.249108591323868e-01   +3.247836577707131e-01   +2.267742957651431e-01   +2.308735296477712e-02   +2.224092386702253e-01; -1.157456500583348e-01   -1.658947122276356e-01   +7.492970759183482e-03   -2.001036638064812e-02   +2.830338308013884e-01   +5.518704549915217e-01   -1.656280578758566e-02   -2.962350436503189e-02   +2.759113987311481e-01   +6.816467573687434e-01   +7.824815103676416e-01   +9.079808245580734e-02   +3.100604077550076e-01   +1.848266079948652e-01   +5.554897270704884e-01   -5.560267896636404e-01; +5.495438293142113e-01   +7.111921103418066e-02   +3.810900367379100e-01   +4.762598361419136e-01   +1.791979482425852e-02   -3.592172550611249e-02   -1.171773800038483e-01   +2.323725581623423e-01   +1.651922304826662e-01   +4.867340524024156e-01   -1.174354137634808e-01   +3.582833465301815e-01   -2.687532620937389e-01   +2.938216607658368e-01   +2.479087366612917e-01   -2.898543218805480e-02; +7.957349198118092e-01   -1.485099051853251e-01   +1.312999380122510e-01   +3.052130291744338e-01   -2.826021152472136e-02   -1.435060944049257e-01   -1.513148724551726e-01   +2.951861710472815e-01   +4.347659909029287e-01   +5.579925188609686e-02   +1.987817812517699e-01   -1.561998403393091e-01   -2.303726313807974e-01   +1.822981487170001e-01   +4.102008334338269e-01   +3.109076663873365e-01];
L1E_L1I_iGABA_netcon = [+3.805317545367550e-01   +3.026086419469712e-01   +3.115288599240779e-02   +3.817764814118104e-01   +2.697424639052862e-01   +5.681012631360113e-01   +7.945483900650765e-01   +1.999129762783909e-01   -6.355944575700868e-02   +2.431107870727551e-01   +4.495871322582844e-01   +4.915913386031773e-01   +3.687039979731945e-01   +7.424572745191913e-01   +5.259473603858636e-01   +5.490287858033029e-01; -6.160870280240565e-02   +6.302884173401252e-02   +5.379831186378790e-01   +1.072472520726107e-01   +1.714268337582557e-01   +2.694859929139171e-02   +6.231946961523847e-01   +2.933435662803176e-01   +3.843564442606182e-01   +6.014458065438562e-02   +4.098016887810914e-01   -1.671538670036788e-01   +4.061542085346745e-02   -3.581975528154663e-01   +4.775124606032550e-01   -1.111892625032106e-01; +6.142862560144745e-01   +3.865443133942589e-01   +4.918605014857703e-01   +8.504607520170726e-02   -1.070068892033166e-01   +1.023368814321163e-01   +2.163146487501710e-01   +4.972982371342665e-01   +2.497027942637240e-01   -8.653651973612322e-02   -3.256556257108381e-01   +6.246494827041763e-01   -2.009082086450990e-01   +4.249565867626666e-01   -3.618660694030289e-01   +7.072995679836344e-01; +3.907213449895183e-02   +7.901881661090950e-02   +3.892244124078988e-01   -3.307848647238408e-01   +1.793204644358256e-01   -1.521232722458423e-01   -1.070911205411880e-01   -2.829137719688372e-01   +1.537365093533138e-01   +6.672130293666896e-01   +3.120714876160696e-01   -7.241981558445799e-02   -1.150034505848999e-01   +8.947944149604285e-02   +5.045492364376066e-01   -3.896927212938166e-01; +6.930064700972904e-03   +5.029574120079942e-01   +1.150230520973135e-01   -6.471829394533110e-02   -1.446164521573016e-01   -5.357344378551093e-03   +1.028649355568540e-01   +2.989705589158639e-01   +3.106594073260643e-01   +4.170621414757900e-01   +4.957208627617767e-01   -1.701063673190218e-01   +2.880722837597791e-01   -1.977533473925931e-02   +3.988893366397661e-02   +1.344458277499196e-01; -1.467245128026856e-01   +3.199798539455906e-02   -1.295301332254696e-01   +4.346596358216175e-01   +1.605419359894492e-01   -1.232704913185242e-01   +8.156612683812474e-02   +9.455878586172826e-02   -7.203965404437661e-02   +1.977339459857108e-01   +8.129667398580948e-02   +2.994368954422386e-01   +4.145720425467065e-01   +2.637922657768283e-01   -2.439232736786892e-02   +7.050638840494119e-02; -1.625896965295743e-01   -2.223680694183187e-01   +1.456007245677413e-01   +6.828798513741687e-03   -1.259929559265217e-01   +9.411259249296375e-02   +5.210661131651726e-01   -1.533598886897619e-01   -4.093699357957494e-01   +4.215783642061162e-02   -1.149894537332299e-01   +3.593771922771318e-01   -1.074316772435800e-02   -3.932769194517139e-01   +1.718626966572488e-01   +1.020716839831448e-01; +1.692569698257365e-01   -2.027696829844941e-02   -4.987025427119195e-01   +1.024729031308206e-01   +1.567642326515220e-01   +1.202345299858883e-01   +4.202713498864457e-01   +6.172502442330752e-03   -2.533732579383921e-02   +7.953734038565416e-01   -1.299593669715459e-01   +2.894298142855194e-01   +4.466034830354078e-01   -4.562617770737289e-01   +1.599255212263724e-01   +2.515344765721069e-01; +4.235166588824429e-01   -1.081218934297540e-01   +3.736371937120219e-01   +6.218816713598592e-01   +6.251263593132194e-01   -2.691507548355158e-02   +2.291969384186333e-01   +3.778844439589856e-01   +3.646702095985123e-01   +1.082341544993259e-01   +2.316382719807716e-01   -7.652802236689338e-02   +5.731536118073942e-01   +5.779539371109764e-01   +4.106845131059211e-01   +4.719474366580345e-01; +5.245035349292136e-01   -2.049301026019079e-01   +3.654173570680787e-01   -1.757874336442769e-01   +3.940349992959282e-01   +2.301835731968193e-01   +8.424330442055358e-02   -2.285944955783979e-01   -2.177938113177861e-01   -1.182447096803894e-01   +1.361625378243788e-01   -1.042789144817204e-01   -4.105501649752674e-01   +1.429524794586343e-01   +2.983733662384689e-01   +4.823649999473490e-01; +1.223336672737179e-01   -1.983745313802293e-01   +3.446080228240635e-01   +1.134143516926003e-01   +1.751066307472658e-01   +3.584160372651528e-01   -1.455309350035690e-01   +4.330652560143633e-01   -3.202877539512865e-01   -8.707073262618857e-02   +5.336418728216136e-02   -3.789749276853508e-01   -1.371386543007511e-02   +2.479874121388531e-01   +1.795813353735047e-01   -2.443179108127540e-01; -1.217300328358585e-01   -1.393532597535248e-01   +2.117341602902729e-01   +2.143589599408650e-02   -3.012357559217133e-01   +1.600950831203175e-01   +2.051365383494941e-02   +4.848094119155562e-02   +5.573582612693784e-02   +3.671959735729908e-01   +2.160340790715710e-01   -6.053636276348616e-02   +1.828251634495024e-01   +2.861374436547746e-01   +2.373105239689561e-01   +1.410029232594871e-01; -8.895098142445698e-03   +4.335187356736454e-01   +6.085795473220602e-02   -3.680343933718511e-01   +1.388740934197108e-01   -8.188196747160020e-02   -2.879857841941610e-01   +5.219277644503614e-01   +3.024253744635651e-01   +2.228306727547971e-01   +9.877407616071551e-02   +5.693014210764549e-01   +2.795313974188776e-01   +2.799522418821787e-01   +8.426792378404149e-02   -2.146762055405828e-02; +1.030434587917554e-01   -1.231217255236694e-01   +4.436997903851438e-01   +2.008355380207289e-01   +1.150118657519111e-01   +5.310264332790942e-01   -2.245196726346418e-01   -1.081256123057505e-01   +3.521687193875098e-01   -5.294855789378414e-01   -2.701599117424048e-01   +9.190124472659504e-02   +4.248238402364317e-02   +6.248612538918823e-02   -3.238772267662823e-01   -5.366516985988028e-01; +8.788810116567003e-01   -3.251888709467769e-02   +6.490888283465935e-01   +2.004095081133191e-01   +3.692939262906008e-01   +3.873160763184729e-01   +5.010440441019619e-01   +3.760262244808119e-03   -1.189610255991931e-01   -1.082407410407591e-01   +4.809254287108577e-01   +1.137565281601742e-01   +5.391011630485172e-02   +5.287173667439808e-01   +3.091537993479599e-01   +3.985652390318163e-01; -2.697609668665385e-01   +4.173024042534517e-01   +4.061187062358007e-01   +1.073822542113789e-01   -1.173987808015258e-01   +3.745002691769500e-01   +1.657581046591461e-01   +6.160330851820328e-01   -1.530268402827031e-02   +3.198384578665461e-01   -1.217107560757397e-01   +6.920061990627112e-01   -3.500294397376482e-01   -4.336748959003695e-02   +5.046397819872287e-01   +3.939047319192366e-01];
L2I_L1I_iGABA_netcon = [+1.744911926868480e-01   -2.689455725907866e-02   -4.123491898965413e-01   +1.254317913932522e-01   +1.658414197477961e-01   -4.902201063715864e-02   +4.823760354255091e-01   -1.967834004910852e-01; +7.562414332484252e-01   -5.703854402858336e-02   +3.575940130427524e-02   -2.382332431474919e-01   +4.984682337813204e-02   +1.699781541827833e-01   -1.880356191943746e-01   +3.157960949660266e-01; +2.604587202279748e-01   +1.171614065454316e-01   -4.053968468373644e-01   +2.765969311461040e-01   +5.215879325441078e-01   +2.955219471174855e-01   -3.347079576643067e-01   +2.838976761163594e-01; -1.858513671013108e-02   -2.884599544402139e-02   +2.377894042573347e-01   +5.935917127862638e-01   +1.722922204542511e-01   +8.236568129481753e-01   -1.605455288239209e-01   +3.543971242112259e-01; +1.687379498302854e-02   +1.433983380732188e-01   +3.158877285711060e-01   +7.648123947899046e-02   +1.186732697790021e-01   +8.036604178028775e-02   -2.714059030563236e-01   +5.111735292544455e-01; +7.447372991683412e-01   +5.828706442019091e-02   +1.526113149279994e-01   -1.936668969928881e-01   +8.171773702998961e-01   -2.027288885010030e-01   -4.706369361255166e-01   +7.591336896587806e-01; +1.920109534116450e-01   +5.004815982862075e-01   +2.295319185913220e-01   +1.297119874474274e-01   +6.716119680705647e-01   -1.650039332160594e-01   +1.677047523443455e-01   -1.262251747512549e-01; +1.813475175537388e-01   -5.032759700474224e-02   +2.414720537879760e-02   +2.114969340255327e-01   -2.482107495734147e-01   +3.060195220577697e-01   +2.483984775212174e-02   +5.156766546139399e-01; +1.355773718845011e-02   +5.460061902797513e-01   -3.142806555265160e-01   +3.049400550185216e-01   +2.303708436593362e-01   +3.794022142070026e-01   -2.880965784611548e-01   +2.089729257038045e-02; +4.767672127977264e-01   +2.366468396392932e-01   +8.080762961690344e-02   -4.335826702464621e-01   +6.233982747577855e-01   +2.497533881874051e-01   -3.364411117269965e-01   +2.601096270099691e-01; +2.870381241671384e-01   -1.172976735388699e-01   -1.325661706994045e-01   +4.879476490117394e-01   -1.049744096987574e-01   +4.264925360986327e-01   +3.433478979354861e-01   +6.168997040301198e-01; +1.239155465833552e-01   +1.787138163810469e-01   -4.616769243629263e-01   +4.105829974451408e-01   +5.967057205779577e-01   -2.075959680985641e-01   +2.548011948101427e-01   +2.838847462069927e-01; +4.880442688702857e-01   -2.281304285081860e-01   -6.053527152930543e-01   +2.793644282447654e-01   +6.256302708069237e-01   -2.673954583835685e-01   +1.442441567980704e-01   +2.345705107806781e-01; -3.209724295483681e-01   +3.481694839950434e-01   -1.237146556198086e-01   -8.470019204703237e-02   +2.916269297890101e-01   +1.190388180296895e-01   +1.009939013036469e-01   +2.592481413654585e-01; +2.981117164493630e-01   +3.239273276952742e-01   +2.615237194230902e-01   -2.989641521897904e-01   +2.161637337526739e-01   +1.109413963129471e-01   +5.629340610330935e-01   -2.231401409154736e-01; +5.884855212165303e-01   -5.008928815404861e-01   +3.623457885515661e-01   -2.118860549910720e-02   +5.810978853994750e-01   +1.304302072769404e-01   +1.324722016045539e-01   +4.730242001301823e-01];
L1I_L2I_iGABA_netcon = [+2.781966454710708e-01   -9.970416392216426e-02   +2.585484990386498e-01   +7.039324722317414e-01   +4.734021611764958e-01   +1.936453023992303e-01   -1.044670953273289e-01   +4.138453425989243e-01   -2.291636608542004e-01   +3.365876455459870e-01   -7.878463502285715e-03   +3.154988164154682e-01   -6.136765167643726e-02   +7.200117262174123e-01   +1.370950107471025e-01   +5.614012275393198e-01; +2.803814295398196e-01   +7.980236985532228e-02   +4.883333279298413e-02   -6.090070555439434e-01   +1.208648163487338e-02   +1.320725173009650e-01   +1.059517252376309e-01   +7.004548423788319e-01   +5.194681227280337e-01   +5.584080759410708e-01   +2.496184502025515e-01   -2.142680984757453e-01   +8.404925732616549e-02   -1.659867537047353e-01   +1.403024352942917e-01   +3.090582091361225e-01; +2.685562474866908e-01   +2.271421908964139e-01   +6.982529051759764e-01   +8.093787853149670e-02   +5.076862109134380e-01   -4.797280844236888e-02   +4.110977502209960e-01   +3.100784245344526e-01   +2.144337888263609e-02   +5.413500516337608e-01   +1.037152092044125e-01   +5.442586843355859e-01   +6.308224245281262e-02   -6.616852461635109e-02   -2.596956545645877e-01   -1.718020200547786e-01; -5.712620538974345e-02   +8.958631960407346e-02   -1.419791100588323e-01   -1.034250654966552e-01   -5.116135518883123e-02   +1.963083261499657e-01   +2.493141057684936e-01   +4.185747508648069e-01   +6.324223844371883e-01   +7.157177519283335e-01   +5.930381834585516e-02   +5.926573169564332e-01   -6.624392978698653e-03   +1.999659950678733e-01   -9.795914298854214e-02   +2.523838450945414e-01; -2.731425594314469e-01   -7.689141027321174e-02   +5.865876544461681e-01   +2.391015288026217e-01   +3.099538902883164e-02   +4.024225202655247e-01   +1.123085413080550e-02   +6.476805554860494e-02   +2.862488314353651e-01   -1.115602231900553e-01   +5.412007318913792e-01   -9.633532667345031e-02   +4.669461574507213e-01   +2.064336913651393e-01   +5.443383925684234e-01   +3.498584939586105e-01; +4.276930654745781e-01   +1.361108962720016e-01   +5.215462614015155e-01   +3.754021781641211e-01   -2.424803905074658e-01   +4.384170682621734e-02   -2.101046678557759e-01   -2.247917058580303e-01   -4.608815338347876e-01   -8.147797153016023e-02   -2.774916415318427e-01   +8.359649287726816e-02   -1.513340920745783e-01   +3.709623592174581e-01   +8.640840488887241e-02   +2.924123045353908e-01; +1.756792488420342e-02   -5.937060362498496e-03   +1.889744215410403e-01   +5.979821509309348e-01   -4.158659709468131e-02   +5.234276415633762e-01   +1.514666284649113e-01   -1.163977185210474e-01   +6.560556361807487e-01   +1.909147209501072e-01   -2.343193315894626e-01   +1.711131062264751e-01   +8.030818415655876e-02   +3.359528080062324e-01   +1.699224125695348e-01   +3.965779709027051e-02; -1.532337483673867e-01   +1.196514940929615e-01   +1.277041996444819e-01   +6.088223169155870e-01   +5.218051381285904e-01   +1.323201547617298e-01   -1.573335800540558e-01   +1.631492649647716e-02   -1.479150957971749e-01   -2.065932734215220e-01   -5.680820438230514e-02   -2.333486086623051e-01   +2.483267820184504e-01   +4.562232530875043e-01   +2.375788888720695e-01   +9.201487151704517e-02];
L2E_L1E_iAMPA_netcon = [+1.987960849641497e-01   +5.080420549852012e-01   +1.516680059365500e-01   +2.338470986208817e-01   +1.155995050892284e-01   -1.200832618690258e-01   +5.619233791095246e-01   +1.243610783285590e-01; +5.155515750333090e-01   -6.317735295097206e-02   -4.560079442969908e-01   +1.025713337596051e-01   +1.623904131110418e-01   +3.558975215603748e-01   +1.785463974809527e-01   -1.906562027966971e-01; +1.232025929728138e-01   -1.802348515418710e-01   +3.442310671440668e-01   +4.030950666780453e-01   -1.086632218684257e-01   +4.179809957435727e-01   +3.437630615863664e-01   +4.302549055002078e-01; -8.208243548045768e-02   +1.367530460996852e-01   +1.779686197886418e-01   -5.427765465174443e-02   +2.474067366442415e-02   -4.840729437664089e-02   -4.238286899149345e-02   +4.807208038524532e-01; +9.425171406594787e-02   -1.498772041329340e-01   +2.986301949924574e-01   +1.776948157620712e-01   +9.352692865510106e-01   +4.930214947703462e-01   -9.803067603228753e-02   +5.532645942815402e-01; +6.938111902012879e-01   +5.516224962919143e-02   +6.536745644834593e-01   -3.367986548562779e-01   +4.666677759761625e-01   -1.967077649598949e-01   -4.173773728047603e-02   +1.925444403319765e-01; +4.279498385028157e-01   +4.989221700597998e-01   +3.513413541711379e-01   +5.501351503003059e-01   +1.951578802181225e-01   -1.151115976254483e-01   +3.902029398944020e-01   +1.985581632766400e-02; +2.681634211414042e-01   +2.813185860432078e-02   -2.108975146868423e-01   -2.935670343287001e-01   +2.226749145960477e-01   -1.863225303982085e-01   +1.613332876546379e-01   -3.461753314568357e-01; -1.884329169445745e-02   +4.233472018230661e-01   -1.722279357713126e-01   +1.790653443354329e-01   -2.968085507904718e-01   +2.861966297910244e-01   -4.042621990306791e-02   +6.441234323246017e-01; -1.167280602427812e-01   -4.986388061215906e-02   +3.778405610207762e-01   +2.356649459279767e-01   -1.019285717979281e-01   +1.829536710056268e-01   +4.411190523740324e-01   +5.232718197379344e-01; -1.310993583165112e-01   +2.823867368427967e-01   +1.138722872241610e-01   -1.895397855015946e-01   -1.810269301877769e-01   +4.370408965884404e-02   -8.269865413930849e-03   +1.678793989943366e-01; +3.876315338534898e-01   -5.475601144595447e-02   +4.214022968500789e-01   -1.725424147930413e-02   -1.966429322814282e-02   +2.169923604084227e-01   -2.985475230717624e-01   -1.762380709708120e-02; -5.091242294307797e-02   +7.369106226738019e-01   -1.757374854189625e-01   -2.117873953397602e-02   +3.722974277814205e-01   +7.337273972589059e-01   +4.132967369504905e-01   -3.933233765404560e-02; +2.208554772149886e-01   +1.376626869360673e-01   +2.126938364201403e-01   +4.874929195353300e-01   +3.582525903797820e-01   +3.251499780207185e-01   +5.593972289806777e-02   +1.294341198771391e-01; +3.656626253696391e-02   -2.325287949449231e-02   +1.665556846778195e-01   +3.885813440107493e-01   -2.217620988588526e-02   +4.181192754203673e-01   +2.377837552503013e-01   +6.408674009272245e-01; +4.884239412703732e-02   -1.376914269289176e-01   +3.608202491545738e-01   +5.704326892308018e-01   -7.620166750514440e-03   +6.871626526578847e-01   +2.275120675595718e-02   +5.529925686897373e-01];
L1E_L2E_iAMPA_netcon = [+2.118739712591848e-02   -4.526249353679029e-01   -2.502773685418313e-01   +1.870585967431201e-02   -3.577128239269484e-02   -9.390892460736064e-02   +4.762510550587404e-02   -4.395063802201745e-01   -4.357413970790127e-01   -2.173200617531020e-03   -2.688665179158948e-01   -2.062250711492807e-02   +2.134188367151056e-01   -2.651696498629275e-02   +1.343258454179483e-01   +6.877649480653605e-02; -4.315630949592536e-02   +1.488740010024547e-01   +8.202427971590412e-02   +1.344809621718293e-01   -4.660793564945656e-03   +1.644807667608246e-01   +2.887712933840418e-01   +6.615886070289956e-01   +3.806435349700916e-02   +5.611164196651123e-01   +2.603163183330481e-01   +4.386573636869380e-01   +7.044896909027484e-02   -1.071718984425047e-01   +3.333813877023588e-01   -3.497354852865864e-01; +1.441805074839903e-01   +1.041111280309397e-01   +2.001589309382537e-01   +3.471744967419085e-01   +6.273944467657244e-02   +5.349771921428679e-01   +3.852665832621140e-01   -2.368066961654299e-01   +3.934013017180944e-01   -5.364286493128897e-01   +4.812562680247763e-01   +1.256640605652513e-01   +2.022090588572042e-02   -4.231183963013427e-01   +4.252427970198014e-01   +7.671663300852477e-01; -1.711701391961577e-01   -7.565256453376444e-02   -4.707865150884921e-03   +5.064267130609723e-01   +5.264288027902718e-01   +2.077202910217540e-01   +3.596401816088514e-02   +1.977200640521550e-01   +1.483798679784638e-01   +2.480918783618519e-01   +2.201435194669044e-01   -3.064295032076571e-01   +4.932455711726693e-01   +4.127717011615708e-01   +2.676811394615263e-01   +1.678596296539858e-01; +2.574645729181886e-01   +5.709709320565156e-01   +4.394066506474065e-01   +1.016705087350386e-01   +3.762732372197893e-01   +5.314183674922321e-01   +6.664322113682555e-01   -1.032096758619934e-01   +5.887621528045459e-01   +6.639170526476532e-02   -3.424281374783411e-02   +6.589886160455135e-01   +2.349621371853484e-01   -1.631063869665699e-01   +3.155878688533721e-01   +1.835337825890653e-01; +4.790533719497950e-01   -1.910322283176837e-02   +2.120259100322761e-01   +5.902146038679703e-01   +4.014190594899095e-01   -5.563223602664953e-02   +6.430504193789921e-02   +2.717539341096654e-01   +5.281213881718543e-01   +5.348343350766951e-01   +1.192961462515337e-01   +4.722793407387068e-01   +6.872507329861905e-01   -2.732216704733602e-02   +1.376359488708853e-01   +6.085475993385073e-02; +2.024593664816965e-02   +5.241473514531564e-01   +4.789165780112301e-01   -5.892191123623414e-02   -2.905730651714414e-02   -1.606952014331365e-01   +8.887906765784759e-01   +1.786529742069486e-02   +2.595566310562489e-01   +1.480666062809509e-01   +6.792798538165866e-01   +2.517883952032567e-01   -4.362233669747008e-01   +1.782929093089181e-01   -3.222934971274665e-01   +5.986721747109454e-01; +3.785333706529421e-02   -2.015144600484736e-01   +7.814781717144559e-02   +3.843771228935793e-01   +7.392029146000070e-02   +2.762782630654955e-01   +4.848922856573239e-01   +4.791873391790730e-01   +2.716684312801000e-01   +5.877336799458388e-01   +2.517810300968432e-01   +2.465874891575193e-01   -7.318154501243512e-02   +1.937150897592223e-01   -2.165136036686145e-01   +3.740730701109010e-01];
L2I_L2E_iAMPA_netcon = [+3.311073427960740e-02   +1.500092913858740e-01   -1.916229867682223e-01   +1.805327040653747e-01   -2.664511686879048e-03   +1.618689648743898e-01   +3.428074744094212e-01   -1.278512315155112e-01; +1.447521726905202e-01   +2.717209430074522e-02   +1.415324933388711e-01   +4.539066979712966e-01   +3.996296767451810e-01   +2.982484451584069e-01   +5.035458603424281e-01   +2.917835644792292e-01; +1.831121419773517e-01   -2.808646401959406e-01   +9.116658827793152e-01   +3.006920323382964e-01   +4.469846662666733e-01   +3.447797453896544e-02   +4.220922369891025e-02   +1.166968178746291e-01; -4.778439931621196e-01   -3.433870177781552e-03   +2.295910791729594e-02   -1.332709519228297e-01   +2.903967092343544e-01   -2.819819809476561e-01   +4.026328154976613e-01   -2.620628656082215e-01; +5.449088147219413e-01   +5.456049020035583e-01   -1.064293549463538e-01   +1.112196244316159e-01   -3.960222489485821e-01   -5.402040884394779e-01   +5.277989692239300e-01   +5.878273865795665e-02; +1.782832533417188e-01   +1.447644530421511e-01   +2.175578022518653e-01   +4.817645351789352e-01   +3.424072007667994e-01   +3.592899990287292e-01   +1.145292633464031e-01   +5.277344526897970e-01; -1.174730707531158e-01   +2.328972672677820e-01   +1.889721616834858e-01   +3.446324135858507e-02   +3.249087363467060e-01   +4.452767205745626e-01   -1.270585873271431e-01   -1.333022917253371e-01; +1.433557504065164e-01   +3.947409163399273e-01   +1.958636837165034e-01   +4.338166894016698e-01   +2.850577800050105e-02   -8.192248691953187e-02   +1.946224002330718e-01   -1.733085195590130e-01];
L2E_L2I_iGABA_netcon = [+1.456797834364756e-01   +7.696012159964211e-02   +1.497932457933707e-01   +4.639150273295997e-01   +2.234899066288681e-03   +2.795465608972636e-01   -9.910097485308016e-02   -1.304588244605122e-01; +2.689084833331314e-02   +2.345214027818102e-01   -1.034961678505151e-01   +1.849019900671292e-01   +1.419622787449684e-01   -3.319705270909473e-02   +2.175056572092909e-01   +3.965912463545022e-01; -3.578871770239628e-01   +2.934618328682280e-01   -1.737274908856929e-02   +6.286837938449357e-01   +1.028212902143434e-01   +3.856174506475240e-01   +3.435547512433645e-01   +1.509275614376612e-01; -2.235328984198592e-01   -4.871168621415640e-01   -1.816736691091091e-02   +1.634080345685578e-01   +1.810003960242722e-01   +6.365444066619700e-01   -2.094076061241177e-01   +3.655898212418124e-01; +5.202200532004022e-01   -1.243394995095314e-01   +7.073961505782883e-01   +4.280312263249128e-02   +2.391808811011517e-01   +2.396687028349214e-01   +2.044671188792637e-01   +4.517897217498266e-01; +2.385135236670620e-01   +5.818267705494933e-01   +4.216751490125552e-01   -1.199568394266258e-01   +4.288168870868514e-01   +9.981974029772164e-02   -2.678860667041624e-01   +3.291344338049478e-01; +1.451738380550416e-01   +1.264353674980024e-01   -2.579277882116277e-02   -3.030150405575677e-01   -3.081851138964913e-02   +6.952973149506436e-02   +1.468581030625473e-01   +7.707351907144586e-02; -2.862076136546865e-01   -1.792631465749006e-01   +2.469523505537130e-01   +6.049218941768512e-02   +2.941921051248440e-02   +1.708163177354268e-01   -1.261504193736592e-01   +9.150437412123541e-03];
L3E_L2E_iAMPA_netcon = [+2.354286267471024e-01   -6.630940273707008e-02   -1.817196453679580e-01   +1.933776797106934e-01   +6.616873777362848e-01   -1.510659974758877e-01   +7.061617232018919e-01   -7.600362938013855e-02   +3.199980286775546e-01   -1.946844106426393e-01   +3.009691649181587e-01   -1.442407936350833e-01; -1.663905092926782e-01   -2.817338592212712e-01   -1.423002228306203e-01   +2.102772116422947e-01   -1.909725734260399e-01   -2.524528078356085e-01   +3.482393708302970e-01   -2.893154444904265e-01   -4.069928713962969e-01   +2.234952870912954e-02   -3.436275528790216e-01   +1.516572906250982e-01; +4.196282242933861e-01   +4.921754716030143e-01   -1.653354021248919e-02   +1.464957893716891e-01   -1.709492035552952e-01   +1.051490548182551e-01   +4.784517747381670e-01   -1.523143364697991e-02   +7.601406058849226e-02   -3.357217818438653e-01   +2.876085366693811e-02   +4.076078645054707e-01; +5.569195223230218e-01   -3.595486534261310e-01   +1.136136480772035e-01   +2.055636579459901e-01   -1.699292789389790e-01   +1.546775876125704e-01   -2.091219266127584e-01   +6.066429037123768e-01   -1.307772159567795e-01   -2.905802454976042e-01   +1.620943488479875e-01   +3.343216683747274e-02; -4.261992759879066e-01   +2.137046325680624e-01   +8.524402601018943e-02   +5.176755288581750e-01   -3.454368294282001e-03   +5.148990362235419e-02   +6.076586344674290e-02   +6.264521813454389e-01   +1.542156660043592e-01   +1.939531979481290e-01   +1.607261928539935e-01   +1.601477376271609e-01; +3.837842950089479e-01   +5.974626552929303e-01   +1.530954139704852e-01   -1.970020736842999e-01   +3.302988883887185e-01   -1.198404916538848e-01   +2.883315125428099e-01   +1.273874368061236e-01   +5.483348612952509e-01   +1.047514929227226e-01   +2.741927231081849e-01   +2.598451723980694e-01; -1.878628237536094e-01   -2.128403859805714e-01   +5.267585532386871e-01   +7.075672093604964e-02   +1.415898719315449e-01   -3.948292984647539e-02   +1.753759181613535e-01   -1.139949791934590e-01   +3.093386606533155e-02   +6.188957274178783e-01   +3.025199207118488e-02   +6.360507247525431e-01; +6.714189246050413e-01   -9.204807206091570e-03   -9.950565708505607e-02   +1.384527717659528e-01   +2.367598368316029e-01   -4.171372003136460e-01   -1.713982235253892e-01   +2.120353424901288e-01   +4.991401396120532e-01   +2.796288347845192e-01   +1.430987760036150e-01   +1.610330810393639e-01];
L3I_L2I_iGABA_netcon = [+4.562846272094494e-01   +5.782640579272956e-01   +1.842580577772171e-01   -9.046785150759848e-02   -1.138728275547260e-01   +4.541249269878120e-01   +1.078692513607243e-01   +4.003223040413423e-03   -4.825013978044668e-01   -1.754059424246361e-01   +3.069389688679681e-01   +2.003992222285425e-01; +2.500366698521533e-02   +1.764148107228817e-01   +2.506665600189432e-01   +2.660756357556192e-01   +3.899641451834215e-01   -2.501208705272767e-02   +3.186981970597175e-01   +5.633940184343116e-01   +2.187042788730153e-01   -3.114001181980716e-01   +2.980002023568921e-01   +2.677683174072054e-01; +6.725265040942223e-01   +8.005165161365649e-02   +1.681513247216630e-01   +4.379864635342293e-01   +5.342660403670820e-01   +3.607608155288804e-01   +5.990336420059382e-01   +6.526499643413991e-01   +1.545861539814823e-01   -1.227640522780120e-02   +1.747518534045364e-01   -2.505210636186907e-01; +2.735661777069426e-01   -3.390881467471559e-02   -1.236885267141694e-01   -1.468600209235564e-01   +2.754537821003594e-01   -2.304175493062494e-01   +1.110474251186935e-01   -2.850237351261348e-01   -4.231787197484238e-04   +2.324279722268923e-01   -3.742119635429363e-02   -1.597111866473973e-01; -1.367641313759479e-01   +1.830192258281847e-01   -8.858592277895307e-02   +6.164107451568281e-01   -5.195930119617122e-02   -1.744920905206246e-01   -1.251344460714537e-01   +1.043092700338187e-01   +1.656648391515946e-02   +1.282489565959633e-01   +4.768487012579579e-01   -2.665481090618648e-01; +2.182043728807405e-01   -4.573531399325665e-01   +2.874262113665063e-01   +8.001666859165703e-02   -2.188056801283337e-02   -2.806696928417115e-01   +5.116160833553982e-01   +4.253338949205515e-01   -1.561865880863488e-01   -1.644026526722656e-01   +1.900105625184590e-01   +1.951791517541771e-01; +3.257950084661120e-01   -4.143913385249191e-01   +3.738002776243875e-02   +3.593536822899174e-01   +1.737538632952435e-01   +3.895803519287045e-01   +4.121429232232114e-01   +4.002829444315474e-01   +2.661699360861341e-01   +3.177632650121356e-01   +2.138260042425976e-01   +3.763998567835626e-01; +4.970891901334966e-02   -3.504544286385520e-01   +6.172743959248774e-01   +6.457226295125136e-01   +5.072882707114982e-01   +9.617251408947998e-02   +5.084903668202254e-01   +3.851789350641966e-01   +6.654324351056282e-01   -6.545694589390427e-02   +4.948829036986032e-01   +2.093599526059594e-01];
L2E_L3E_iAMPA_netcon = [-1.365710601791194e-01   -3.012090313380322e-01   +5.084147651463974e-01   +3.588540508193491e-01   +5.818851701339407e-02   -1.806565379856226e-01   -5.673147832337301e-02   +3.638762815114462e-01; +2.639511502607161e-01   -1.998792792739903e-01   -1.903375669873844e-02   +4.636416159532953e-01   +5.594751899088692e-02   +3.180107743281905e-01   +2.146530066924562e-01   +2.894829186539506e-01; +5.142543716290344e-01   +3.866528778099935e-01   +1.355642535556960e-01   -3.686537484544525e-02   +4.367350576179856e-01   +5.252594988163758e-02   -2.545187673506207e-01   +5.517094249742535e-01; +6.871338332367972e-02   +2.036433347332198e-01   +3.603698658587075e-01   +4.484008630678494e-02   +4.347823925905441e-01   -5.964824995780576e-02   +2.256211164686382e-01   +4.231698300073314e-01; +6.035703793656227e-01   +2.435167961888064e-01   +1.046864062777778e-01   +3.164797639105432e-02   -1.766615528393588e-01   -2.798413976883721e-02   +6.424271450518778e-01   +2.465797209146436e-01; +1.861255878590002e-01   +4.134624195659461e-01   -3.886852269331950e-02   -5.236574264153974e-02   +1.187705031127582e-03   -2.010412100219104e-01   -3.293134621038171e-01   -1.333090638452029e-03; -1.300820867055142e-01   +2.459461202756079e-01   +2.874621734226409e-01   -3.658471585871313e-03   +4.764680387815419e-01   +4.759092181851143e-01   +3.841866876709479e-01   -2.397688000064308e-01; +5.161480140548693e-01   +3.594688226201820e-01   -4.054097224090061e-01   +1.920706263853868e-01   +4.070779511285791e-01   -1.027196529285953e-01   +4.397777435415405e-01   -4.660362281725422e-02; +4.421579780835806e-01   +2.549270223064543e-02   -3.443130413135898e-01   +4.101552338377037e-02   +3.704776732413775e-01   +2.234686107898828e-01   -3.307387726304791e-01   +1.139942755823417e-01; +3.886701499640360e-01   +3.507506980510621e-01   +1.807465628675904e-01   +4.895888043599689e-01   +2.337409059880806e-01   +8.811296910498275e-01   -2.783375043118805e-01   +3.220502002181134e-01; -4.229923126766991e-01   +4.024787183410293e-01   -4.352404615024836e-01   +3.345902629755806e-01   -1.808602413564862e-01   -1.820665789541862e-01   -3.432868241697616e-01   -1.397166049223995e-01; +2.224775050618373e-01   +1.521931371862376e-01   -2.926025399962451e-01   +1.392062770079635e-01   -3.156356561248209e-01   +2.265948078206926e-01   +7.317047881471899e-01   +3.020414626226082e-01];
L2I_L3I_iGABA_netcon = [+4.618643115068446e-01   +3.899073738513864e-01   -4.677112052880320e-01   +3.786636028747047e-01   +1.244746966624288e-01   +9.849930574539506e-03   -1.937942515929361e-01   +2.178161469773591e-01; -3.520564704577837e-01   +6.249018462769218e-02   -4.410487166294451e-02   +3.762652755639572e-01   +5.565981131087967e-01   -9.956040683235159e-02   +2.992722271312126e-01   -9.181086824066573e-02; +7.573058222890079e-01   +4.324973185773424e-01   +4.587963422838311e-01   -1.426230562463608e-01   -2.431837758915185e-01   +2.241515133778453e-01   +5.809501811616495e-01   +3.663438222581636e-01; +8.561693909047516e-01   -1.897805641983114e-01   +5.019858054017957e-01   +7.322726637531206e-01   +4.020729113496879e-01   -4.490485658146630e-01   +4.907529088953928e-01   +1.681845391201386e-01; +5.098641336910225e-01   -2.088593021658834e-03   +2.158534773194204e-01   +3.482795780692931e-02   +1.875070775835226e-01   -2.948814323218583e-01   +2.235937511578685e-01   +2.261208099508272e-01; +1.177523895822626e-01   +7.544151427584144e-01   -1.741831827343633e-02   +6.362719153326405e-01   +2.741221173863668e-01   +1.357790176398936e-01   -1.987293304724620e-01   +4.441955413341081e-01; +1.434665773217409e-01   +3.567635538023045e-01   -3.249989803333477e-01   +4.570376249056315e-01   +5.757021598082063e-01   -1.193318131086633e-01   +6.172687700369454e-01   +5.577355369731256e-01; +2.140252080030220e-01   -3.685175036340138e-01   +2.556585948491671e-02   +6.954685237069018e-01   +7.473698113151426e-01   +3.880687559922280e-02   -2.121231724154649e-01   -6.793009452515293e-02; +4.534556411115788e-01   +5.757733625955539e-01   -2.872951283643760e-01   +1.989233183660861e-01   +7.197105166942619e-01   +5.273672216908276e-01   +5.468516580669169e-01   +2.870261742565328e-01; +6.424595455035624e-01   +4.315894591951807e-01   +1.891903090153662e-01   +4.704249116290700e-01   -4.300245526749690e-01   -2.050288761527801e-01   +6.533974540378369e-02   +4.942130013707211e-01; -2.759843024394009e-01   +1.909719341320126e-01   -1.124636401541621e-01   +3.945111801192127e-01   +5.806391181725554e-01   -4.138462939193244e-02   +3.505981063510105e-01   -4.360056295606035e-02; -2.449908990563919e-01   -1.090670401798254e-02   -6.637379577250339e-02   +6.377681462408378e-01   +2.776276239189804e-01   +2.437775559784868e-01   -2.309482861496536e-01   +6.441476229834123e-01];
L3I_L3E_iAMPA_netcon = [-2.153177207004571e-01   +3.781813529272838e-01   +7.047735569173913e-01   -5.142530843189234e-01   +2.724880253423720e-01   -4.740975826668428e-01   -5.185569011897478e-02   +3.769560476344805e-01   -4.721916912743776e-01   +5.777641101174448e-01   +3.061182159915228e-01   +1.204672176515073e-01; +9.036775983908396e-02   -2.982867191185831e-01   -1.451826619063435e-02   +8.348706950955725e-02   +3.657327096556555e-01   +2.432529981251066e-01   +1.120731587124794e-01   -6.134471512396561e-02   +1.950486765388806e-01   +1.145929552052236e-01   +5.508842315921337e-01   -2.209446338316913e-01; +4.546176230515368e-01   +3.058737723796102e-01   -1.473184551043557e-01   -9.325424273202157e-02   +2.468757926708091e-01   +5.811626177896728e-01   -1.539009322645069e-01   +1.483591068506908e-01   +5.055465674162071e-02   +3.215279986137609e-01   +6.225250847845598e-02   +4.468548681911985e-01; +6.308761399099271e-01   -3.709726093673517e-01   -7.679338423666213e-02   -3.078563918457606e-01   +5.402822055945504e-01   +1.400349501229678e-01   +1.666814060466686e-01   +3.757959710878394e-02   -2.528459498143131e-01   +6.346209608859518e-01   +3.292849756360781e-01   -5.396009256704369e-02; +4.095896287025553e-01   +4.026969690443506e-01   -2.966773348134121e-01   -1.336320206616992e-02   +1.476598917302575e-03   -2.996442603332803e-01   +1.434399012197319e-01   +1.518611043276450e-01   +6.248043542475629e-01   +3.904474219187963e-01   +2.637551635245883e-01   -8.580228174724748e-02; -1.787151931197377e-02   +2.832380429568814e-01   +5.565450489805237e-01   +1.748878990969693e-01   +2.187824655940402e-01   +3.973061873911180e-01   +5.340595647623906e-03   +4.954204546405417e-01   +5.409446855050339e-01   +2.840256209174927e-01   +2.716387806727579e-01   +3.043268701303286e-01; +1.132544257788050e-01   +1.582167839685746e-01   +2.263408503208014e-01   +1.794453521983755e-01   -3.697600076324058e-01   -1.571491598915212e-01   +6.146231967832310e-01   -1.538078559382462e-01   +3.595187019995763e-01   -3.421626118089765e-01   +3.125357888992017e-01   +4.351989149403547e-01; +6.237322802913779e-01   -2.673555701789215e-01   +2.937604505353841e-01   +2.492714656016105e-01   +8.015294086991556e-02   +1.542381994540322e-01   +5.235014861621844e-01   +4.709159456956513e-02   -1.454476444880950e-01   +1.102158477330911e-01   -1.110479088204081e-01   +3.463025595733489e-01; +6.166771758742440e-01   -7.513488574745569e-03   +2.644558410764229e-02   +3.873609432821601e-01   +8.802454841789559e-02   +4.009334061814815e-01   -1.478874535385434e-01   +5.431174924504844e-01   +3.056135116522135e-01   -1.291209497996798e-01   +1.943975186600697e-01   +5.506121100737834e-01; +2.896832216462373e-01   +2.985913557554180e-01   +4.415573349999817e-01   +1.795771284926769e-01   +4.724768010897855e-01   +1.230050041141428e-01   +2.442863298648327e-02   +4.447687587733334e-01   +3.049141566273909e-01   +3.962770563787748e-01   +1.809292735306873e-01   +1.589719795690827e-01; +1.534506808880844e-01   +1.885831562540960e-01   -3.700704133522898e-01   -5.462834383482223e-02   +5.033513036811289e-01   +1.433788147234206e-01   +1.123562384696706e-01   -2.256957148708481e-02   +9.025255403196758e-02   +1.236261796352484e-01   +8.784359365894454e-01   +1.517627717033077e-01; +9.303972883693305e-02   +1.700128393883787e-01   +9.638835691619851e-02   +8.532055031772631e-02   +3.268592840748781e-01   +8.883444015224314e-02   +5.798226934133170e-01   +4.859499638702198e-01   +1.802969772764702e-01   +1.599959296913890e-01   -7.855876152262234e-02   +1.631109722449685e-01];
L3E_L3I_iGABA_netcon = [-2.194813666417806e-01   +2.526148421900517e-01   +1.779295761056294e-01   +2.493915894788857e-01   +3.259233077713079e-01   +4.414280063005970e-01   -8.810711421604156e-02   +4.243587335165352e-01   +6.566791835049737e-01   +1.271175550158637e-01   +5.140000603885952e-02   +1.789245897757009e-01; +6.850997042455610e-01   +2.564293541308035e-01   +1.509178885649883e-01   +3.853740805579774e-01   -8.579845113464948e-02   -4.721675966364893e-02   +9.454325722139398e-02   +6.848856285348190e-01   +1.080189926831915e-01   -1.198506228872369e-01   -2.928558242874300e-02   +2.290690607113118e-02; +1.827478549962981e-01   -7.633065187550955e-02   +6.332780446661355e-02   -2.142037779471809e-01   +2.900418803810498e-01   +6.406097284493291e-02   +2.589153830138174e-01   -1.114780009269710e-01   +2.921581627074574e-01   -2.136526235092280e-01   +2.351927670703707e-01   -2.333774878546877e-01; -1.442210726028462e-01   -2.225319781945668e-01   +2.236085206351178e-01   +2.360682442631276e-01   +3.038345050267084e-01   +3.859915148177087e-02   +3.119936545585796e-01   -2.079216485170471e-01   +5.100388887297284e-01   -2.172064943063610e-02   +3.716702867605118e-04   +5.487421732215232e-02; +5.760151911375269e-01   -2.047321676939277e-01   +2.058506746336679e-01   -6.188572285305213e-02   -9.632329913753547e-02   +2.706543807177852e-01   -1.307387649866726e-01   -1.896284052478723e-01   -1.911293721419403e-01   +2.133312267928663e-01   +8.157937407261770e-02   +2.816521067960874e-01; +6.266867460982358e-01   +5.818824885372533e-01   +1.591919663700349e-01   +6.890593181116426e-01   +1.307741939991212e-01   +4.276317810754373e-01   -1.475838755281758e-02   +6.184627300673579e-02   +4.253803079962941e-01   -5.183486604310490e-02   +3.194661251764340e-01   +3.419582896611761e-01; +4.480078716981513e-01   +2.739112960789264e-01   +4.037782728511569e-01   +7.450184977321820e-01   +3.998046330131361e-01   +1.964103776711704e-01   +9.681800229138932e-02   +1.530738138740870e-01   +3.479601878402698e-01   -3.579686488406509e-01   +4.929432519576504e-01   +2.304063252906495e-01; -3.624879822918456e-01   +4.250420868305430e-01   -1.996518950491058e-01   +3.888342258699888e-01   +5.342536912577704e-01   +5.654705849582817e-01   +3.441362143050256e-01   +2.293944281058060e-01   -3.507062109925676e-01   +2.861591627396577e-01   -3.065829244658801e-01   -1.795330471307428e-01; +7.844566834628275e-01   +1.995592075942195e-01   -2.307289659557582e-01   -1.839137888528704e-01   +2.647495415404941e-01   -2.425915152135054e-01   -2.806964524812390e-02   +2.118106820231775e-01   +1.547575577793573e-01   +4.784943910009166e-01   +2.047049807485883e-01   +1.489428020395144e-01; +2.623922345054145e-01   +5.957186955816581e-01   +3.140519095449768e-01   +2.497625582082766e-01   -3.095489297234344e-01   -1.430665973914941e-01   +5.920154440861246e-02   +2.945896736346238e-01   -3.509673815560052e-02   -3.733399958723903e-01   +6.161554359629193e-01   +5.362851993748871e-01; -1.525943935629993e-02   +5.125724565113653e-02   +3.899514290251725e-01   -3.034729948618443e-02   +2.263856025212820e-01   +6.399481645377724e-01   -1.148440455608917e-01   -8.200683360713751e-02   -1.739408576145656e-01   +2.586359506675893e-01   +8.833461299489756e-02   +2.855648567324739e-01; +2.225533942997587e-02   +3.778614455743708e-01   -1.619490553573561e-01   -2.197798433322982e-01   -1.435067502096064e-01   +2.229016978355290e-01   +3.136331766696933e-01   +3.135389644585889e-01   +2.301526787617977e-01   -3.003992346386112e-01   +4.612601012831978e-01   -2.491684285941773e-01];
L2E_Input1_iAMPA_netcon = [-4.628685943958850e-01   +5.706158801889932e-01   +3.274329173939778e-01   +3.935872138050387e-01   -2.419386562631408e-01   +3.712330392652195e-01   +4.134953207222825e-01   -1.927362673618391e-01];
L2I_Input2_iAMPA_netcon = [+1.536681749494480e-01   +4.789433046051465e-01   +4.797799753255009e-01   -4.458228771033264e-01   +6.542480098707879e-01   +3.049905217169498e-01   -3.253424579659367e-01   +1.369690300451129e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
