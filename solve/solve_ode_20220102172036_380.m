function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.195249973977470e-03   -4.473739207498210e-03   +4.675683098983858e-05   +6.183584085986652e-03   -1.418680153347286e-03   +6.896976754949775e-03   +7.110585115015195e-03   -1.810427840964268e-03   -3.298784730757685e-03   +4.617244922032861e-03   +1.476016406518308e-03   +1.505794769219770e-03   +7.794718336384093e-03   +1.048515310195573e-03   +3.486757399719625e-03   -2.756183430215335e-03; +3.033974101523416e-03   -3.129920014520778e-03   +2.757660964652321e-03   +5.738863728916796e-03   +3.172918438176017e-03   +7.063742044015065e-03   +7.576623992273393e-03   -4.580755029938478e-03   -1.063477785928271e-03   +9.082991439177018e-03   +4.994987027328656e-03   +6.885466936332456e-04   -1.973428561337509e-03   -5.513250671217435e-03   +2.500634213865383e-03   -4.274135880068362e-03; +6.741613965099768e-03   +1.846893468469070e-03   +5.833857958101823e-04   +6.103021618753503e-03   -1.414524098404956e-03   +4.043198206207526e-03   +4.866314356813618e-03   -2.183774945087028e-03   +3.571079776665005e-03   +8.086528338486169e-03   +4.778525526023319e-03   +1.989232658401690e-03   +8.094798894610579e-03   -1.767007984304035e-04   +2.325931285906981e-03   +4.761625162596404e-03; -9.617626222953951e-04   -1.226556708789131e-03   -4.191792025511829e-03   -4.009505062874966e-03   -2.324879542075910e-03   +1.695319051578859e-03   +5.265431213673241e-03   -5.492922877125455e-05   +3.835413960320423e-03   +4.316708682664682e-03   +7.577751730106301e-03   +3.339311004985477e-03   +2.512639006892407e-03   +5.468757841365835e-03   -4.362483758433804e-03   -4.916246828064165e-03; +1.122625648354533e-03   -3.277876456477701e-03   +2.101385737073116e-03   +4.930368437787427e-03   +8.058515930591485e-03   +6.746424854786517e-06   -2.167973552349437e-03   +3.218390004711432e-03   -3.601707596435617e-03   +6.119538749241159e-03   -2.134374936364186e-03   +5.318398781147559e-03   +3.173394194873974e-03   +2.361556456401424e-03   +3.027703095218743e-03   -3.214935976309634e-03; +6.528348051776606e-03   -4.746265881081527e-04   -9.416929964700649e-05   +7.022209409049508e-03   +1.969637889252744e-03   -1.345514533142022e-03   -1.202398312615684e-03   -5.745928102936311e-03   +1.736846649494148e-03   -4.538516094182913e-03   +2.360653407210452e-03   -5.504837652495103e-03   -2.689560725391701e-03   +4.014947358857271e-03   +1.084512944943614e-03   +4.644880819157853e-03; +1.072073833746976e-02   -1.369628506052281e-03   +7.005267700771723e-04   +5.204996761807414e-04   +9.022823467307170e-04   +5.577760572211357e-03   +7.299346038095659e-05   -6.549645718858903e-05   +7.312226546055604e-03   -3.521239310672014e-03   +2.703915164300083e-03   -9.629032176384192e-04   -3.736869429796253e-03   -8.704518436486322e-05   +5.177374328442888e-03   -8.987109182267213e-04; -2.164271343071348e-03   -9.550871100537636e-03   +4.456611789093894e-03   +1.945970985187404e-04   -2.136308301574257e-04   -4.380305077704317e-03   -3.073856283679203e-03   +1.187888074680137e-03   +6.160995072303402e-03   +2.442068593683344e-03   +5.304027580833682e-03   +8.991669683194863e-03   +5.674328859122614e-03   +2.435895327201437e-03   +9.146828226132290e-04   +5.267479734129305e-03; +1.584192932303513e-03   +3.435542126046850e-03   +1.990124891350353e-03   +5.932160832436089e-03   -6.685952509392809e-03   +4.162959328506538e-03   -2.597819458278576e-03   -1.536288368530693e-03   +3.846959691749780e-03   -6.788343307438695e-04   +3.531159804763041e-03   +7.207539141278693e-03   +5.934413229025806e-04   +7.371880695664653e-03   +1.255514122348322e-03   +8.106502275468815e-04; -1.843946111254555e-03   +8.112550323104695e-03   +8.486136481751607e-03   +3.800970537667785e-03   -3.070371769087058e-03   -1.872268197099258e-05   +5.755969891011844e-03   -3.720209050594754e-03   +7.856046992468051e-03   -9.725023515788345e-04   -6.907895169661333e-04   +9.469707825609298e-04   +3.222610643326144e-03   +6.666720375335730e-04   +8.756673049864159e-03   +1.199018963939058e-03; +5.582143569765963e-03   +1.129214188552058e-03   +4.025140398150112e-03   -1.195249138335822e-03   +2.869131580274370e-03   +1.126090270421665e-03   -2.884193687931255e-03   +4.150956755826133e-03   +8.839054283958335e-04   +1.978107063057592e-03   +1.113160883430149e-02   -1.177139932901013e-04   +5.102321372415787e-03   +2.205750340271330e-03   +2.574918590773199e-03   -2.219472625235639e-03; +3.551800485785277e-03   -1.482225541391366e-03   -4.115247601311579e-03   +1.699447081755869e-03   +4.481836144114029e-03   +2.965265876536600e-03   -3.912786549583866e-04   -1.170021420940590e-03   +2.242114055887093e-03   -4.585241009851298e-04   -2.123648911502220e-04   -3.463917808059601e-03   -1.344862818479807e-03   +2.210720007642663e-03   +4.391353150601696e-05   +2.256402061530809e-03; +6.814613282967775e-03   +1.419246886643700e-03   +3.191916821993018e-03   -8.891169275232480e-05   +1.738477406346498e-03   -2.890509280824468e-04   +5.296244742286057e-03   +4.761764814043949e-03   +6.609977396538041e-03   +2.449823641019807e-03   +6.349497163406576e-03   -2.639824836470471e-03   +3.481632277289193e-03   -8.054704642479064e-04   +2.637701188318139e-03   +1.115558935311768e-03; +8.794447324356258e-03   +6.908643371968675e-03   +7.130408292079084e-03   -1.887902386464586e-03   +3.174967069904855e-03   +7.023011803930630e-03   +4.179160779950973e-04   +7.776392304134661e-03   -1.041246676490895e-03   +1.194090808714714e-03   -9.670517168740778e-04   +4.111329968714621e-03   +1.144444302779160e-03   +3.158799466421999e-03   +2.128848747007045e-03   +1.663115929548173e-03; -3.104917124949320e-04   -2.197094644131325e-03   +3.682545160787044e-03   -1.368666712054363e-03   -1.742206799429990e-03   +1.559618182974534e-03   +2.384869285154903e-03   -1.526697043153251e-03   +2.276577212168034e-03   +7.305562693966702e-03   -1.323750375172748e-03   +5.515203147781085e-03   -1.112873944054581e-03   +3.795599936418418e-03   -5.994284728424107e-03   -5.442245573926266e-03; +3.321782532608406e-03   +3.869014898205793e-03   -5.409981863873026e-03   +9.462791528214581e-03   +8.560975000723493e-03   -6.570629536975046e-04   +1.228811897164932e-03   +3.334929932314723e-03   +4.739870765071950e-03   +5.602786899114134e-03   +5.915494934417905e-03   -6.504869730141440e-03   +2.091818328726551e-03   +1.913984595838451e-03   +5.663505190367511e-03   +5.404882853552184e-03];
L1E_L1I_iGABA_netcon = [+3.045704788466488e-04   +7.475036471832071e-03   +2.294713455589242e-03   +4.316424677634660e-03   -7.104094066131121e-04   +7.791522684630825e-03   +3.788656836937884e-03   -3.817604800589964e-03   +4.767844839375852e-03   -2.775668499238832e-03   +1.351542824366657e-03   +4.091985897873259e-03   +7.497410026140437e-03   +4.342451459743664e-03   -6.907841232418932e-04   +6.539618871791348e-03; +1.581642528823523e-03   +1.690705608181684e-03   +8.609913179172092e-03   +5.389428711660929e-03   -1.312732346674005e-03   +1.109911578802488e-03   -4.347500050708820e-03   +5.175141704251123e-03   +1.702065243419570e-03   -4.434250726750595e-03   -1.088202631238242e-03   +2.081148310389879e-03   -3.490430494554678e-04   +3.236633859596104e-03   +1.724618945487122e-03   +4.278728777642534e-03; +8.348897241575809e-03   +2.641133702569964e-03   +2.589986014832636e-03   +3.042655745407056e-04   -2.918084369227711e-03   -4.777087842335178e-05   +3.154713996753000e-03   -5.829040846449919e-04   -4.941062692666714e-04   +9.092641599685855e-04   +7.461414682813292e-03   +3.214724427531444e-03   -3.796903812281863e-04   +5.782413027451711e-03   +2.722104100932848e-03   -3.055134640642808e-03; -3.033491584665077e-03   +3.443591215523578e-04   +2.215802535395311e-03   -3.966177543078956e-03   -5.359276939887751e-03   +7.144272414467421e-03   +2.914831684909311e-03   +5.211510879231255e-04   +2.405570254137152e-03   -5.702077039698811e-04   +3.429710098766801e-03   +1.513504677609070e-03   +3.201172818151210e-04   -1.354030181945256e-03   -8.937072573468373e-04   +7.773594667976003e-03; +1.555561730841557e-03   +6.420765950833416e-05   +2.344739794795585e-03   -2.481725420612619e-03   -7.287402293745767e-03   +7.015869267694846e-03   +1.566445782295274e-03   +5.635882378446833e-03   -2.762479897158758e-03   +1.738900736239069e-03   +3.335173286262369e-04   -2.858907765754822e-03   -6.830241547845323e-04   +3.751364445858724e-04   +5.882787758592762e-03   +4.965943032628413e-03; +2.675860116552869e-03   +2.117073656708502e-03   -2.361656004068631e-04   +1.897811804905066e-03   +3.734733232649004e-03   -2.286951928198175e-03   +4.314983987108965e-03   +5.283022931481170e-03   +4.464487933979565e-03   -1.853203309937479e-03   +3.739382856609400e-03   +1.295807161508046e-03   +4.508926277637122e-03   -7.268220265455374e-04   -6.353909221324891e-04   -5.701433343217939e-03; +2.852341137985713e-03   +1.479340555269788e-03   +1.002033175025916e-03   -2.907035828127807e-04   +7.580893520924151e-04   +1.092101593824090e-04   +6.145586651791058e-03   +4.100767703363693e-03   +2.214311506944280e-03   +1.745004693308130e-03   +2.628639604299864e-03   +5.435799491681185e-03   +6.149722931845408e-03   -3.834721362768034e-03   +2.392594381875924e-03   +2.433369338515704e-03; +3.696368147410630e-03   +1.042708693959838e-04   -7.748793360781707e-04   -2.420615034322920e-03   +5.346564821670556e-03   +2.641458525833884e-03   +5.372829042781311e-03   +6.561527220279688e-03   -4.687151004810444e-03   +2.068020751196280e-03   +3.497164285982499e-03   +4.502871147296559e-03   +2.611158765206274e-03   -1.224510214808123e-03   +2.868843234734018e-03   +1.833154400916812e-03; +1.712765196112602e-03   +2.038748668201403e-03   +3.639252863570548e-03   +3.007707876715450e-03   +4.605103805522666e-03   +5.998049530760170e-03   +3.511636936349225e-03   +6.495039641196705e-03   +1.768267998065527e-03   -3.357667505131930e-03   +2.958639781710639e-03   -1.069122675280876e-03   +2.967304857325666e-03   +2.390441899728848e-03   -1.359938279778831e-03   +1.747950066527993e-03; -4.107585794400024e-03   +5.219903671844543e-03   -5.571126168736523e-03   -2.686809449904496e-04   +3.929881586184582e-03   +4.296957132878213e-03   +5.524243180588161e-03   +1.729873666004197e-03   +7.845614068607228e-03   +3.736308534311858e-03   +1.797791845150253e-03   +6.010768007636432e-03   +3.432412422569005e-03   +5.454180444613899e-03   +2.611970170805221e-03   +4.541407939709162e-03; +2.652264237775480e-03   -7.723712069706821e-03   -1.922534539460323e-03   -1.496601053864999e-03   +6.964285355899617e-04   +2.477649319906142e-03   +5.321524881069700e-03   +6.161056206292826e-03   +2.345889225942911e-04   +3.223297417041773e-04   +1.585779300633241e-03   +7.402457564712319e-03   +3.253204157459804e-04   +1.354211451078047e-03   +4.355606547401153e-04   +5.057161750649291e-03; -6.283109784065918e-03   -1.492490622145682e-03   +5.160436370157723e-03   -2.871901348086173e-03   -5.019644463787509e-04   +1.667073289063679e-03   -5.704594161879577e-05   +5.022186777069572e-03   +1.331139811821221e-03   +4.677014843715864e-03   -2.570084403725879e-03   -4.565429532219947e-03   -4.448215867484287e-03   -5.233071043666496e-04   +3.754263009024622e-03   -2.924048749497730e-03; +7.770389701761702e-05   +2.480615423132524e-03   +4.889597291267725e-03   -1.219194312076486e-03   +2.238575260196756e-04   +4.993038290679543e-03   +9.045168224879603e-04   -1.661953035740084e-03   +3.264473573327858e-03   +1.548785096552318e-03   +1.959690073252736e-03   +2.652676972981187e-03   +4.897277468584338e-03   -1.779199941096875e-04   +7.011723513867754e-03   +9.438230051228992e-04; -2.026955888375428e-03   +5.952720621912227e-03   -3.718549484311710e-03   +3.511519324630802e-03   +1.714467030857523e-03   +5.681459566209310e-03   +8.382945571634277e-03   +7.797174928765009e-03   +5.112388321270207e-04   +5.400143206190834e-03   +5.425213252633682e-05   +4.444500601775259e-03   +4.072554129879681e-03   -5.104968762928098e-04   +2.279415115282422e-03   -5.935632276042752e-03; +3.025570465351589e-03   -3.843237355102347e-03   +2.485072863677493e-03   +3.313452355734436e-04   +4.219191253434056e-03   +9.577869916093017e-03   +1.363232902713651e-03   -4.605005797743131e-03   -6.771851308350829e-04   +2.505489276592831e-03   -4.528975192752643e-03   +2.056804020512487e-03   -2.078793509195272e-03   +3.015448426320693e-04   -1.248135541310128e-03   -5.618321520675266e-04; +3.052733849541279e-03   +2.427504760909426e-03   -6.259316435252504e-04   -8.039411937035695e-04   +6.479615444126291e-03   +9.965805240177506e-03   -2.436670120808581e-03   +4.239608343944147e-03   +3.003784502665999e-03   -7.992033131475624e-04   +4.654250467381151e-04   +3.401887540841973e-03   +4.524706347658952e-03   +7.248582940333582e-03   +2.107944605360132e-03   +1.034657134793786e-02];
L2I_L1I_iGABA_netcon = [+1.732054473209082e-03   +3.384303592147874e-04   -5.033909980054254e-03   +8.511845847746238e-03   +4.575624994233253e-03   +4.866092030624557e-03   -1.280940544397605e-03   +1.667590481254349e-03; -1.082914986127741e-03   +2.648521480625787e-04   +2.439730860923263e-03   +8.568244004340229e-04   +4.080639279825949e-03   -1.072344971154786e-03   +2.035868682362401e-03   -5.761770951730220e-04; +1.294030754368060e-03   +4.668698875824244e-04   -2.438431722739079e-03   +2.759359349403450e-03   +3.237762243693842e-03   +1.002251229718249e-02   +2.936022768553383e-03   -1.189024416798067e-03; +1.242770861857511e-04   -3.715254491880308e-03   +5.376203749280625e-03   -3.638428167559972e-03   +5.215202175454658e-04   -1.742790780325647e-03   +4.604407976896200e-03   +5.155292703139131e-03; +4.531045123938921e-03   +4.495543156650285e-03   +5.960857870013682e-03   -1.293523176835047e-03   +5.234993450116902e-03   +2.038814992641591e-03   +2.141552683040155e-03   +1.240992471832062e-03; +5.170923402737638e-03   +2.246591402413990e-03   -8.123450364435334e-04   +6.428866197882824e-03   +2.866528834636557e-03   +2.598063980020995e-03   -4.571381724756770e-03   +2.289475372276403e-03; -1.349599919122980e-04   -4.556399041660370e-03   -3.178734810856998e-03   +6.031334747024958e-03   +2.317320724419192e-03   -4.723980204763725e-03   +1.330850863280213e-04   -1.047464362331612e-03; +2.549445246849327e-05   -2.809503977439518e-03   -4.252498484730784e-04   +3.383034314850381e-03   +3.918199240832407e-03   +8.492516071041494e-03   +5.318162643113891e-03   +6.090866694238555e-04; -2.358318321344261e-03   +3.106139109005430e-03   +4.651093316733209e-03   +1.274327671562000e-03   -9.694707933217417e-04   +1.811330426472484e-03   -7.782563694479256e-04   +9.240244297413143e-03; -4.828662022835508e-04   +1.152052581899310e-03   +3.193380492126801e-03   +3.171756893347631e-03   -1.660923569648755e-03   -1.016688905434429e-05   +2.233877267919765e-03   +1.886144255830173e-03; -1.681920904258274e-03   +1.502009683786438e-03   +9.068111011674608e-03   +2.976450227715237e-03   -1.573259098854881e-03   +3.617664933536778e-03   +2.368967920418969e-03   -9.272299339302857e-04; +9.619969533437661e-03   +1.277972496798537e-03   +2.797273368868705e-03   +6.768958322903469e-04   +3.632976315557678e-03   -5.030114350518251e-04   -1.639870288262839e-03   +1.172237311290388e-03; -7.510028403098119e-04   +3.326089392057616e-03   +4.034010200729471e-03   -3.101864912331000e-03   -2.993343158800327e-03   +1.505989183073867e-03   +2.941076969859323e-03   -1.137241924080283e-03; +2.603315338875684e-03   -6.158351617752934e-04   +5.917340837921066e-03   +2.169222504874071e-03   -1.109757419577328e-03   -5.138239533462164e-04   +1.314454316341299e-03   +2.311447640235130e-04; +1.383016680303916e-03   -3.831147977326170e-03   +6.980946959584431e-03   +3.249067223228009e-03   +4.820451536284760e-03   +6.451646718907650e-04   +5.131023323754216e-03   -5.790559131771180e-03; +2.795887360319309e-03   +3.907276972570627e-03   +7.854572095717667e-03   +1.062456758199130e-02   +1.701628256874939e-03   -4.246988617207226e-03   +2.700026485264981e-03   -1.561919525491367e-04];
L1I_L2I_iGABA_netcon = [+4.248194169507960e-03   +5.965927278570107e-03   +3.421846501937784e-03   +7.266711874494950e-04   -5.310125798122012e-03   +6.333034347709586e-03   +6.151517134267074e-03   -4.513148578535301e-03   +6.793198480710621e-03   +9.872057060184725e-03   -4.989450594080780e-03   -2.851502845312384e-03   +5.781089061220176e-03   +4.620059408415422e-03   -3.559870517502468e-03   +3.465715479677776e-03; +3.351618290119555e-03   +1.229389385987225e-03   +3.572170900922141e-03   +2.554901238594948e-03   +3.942409512849855e-03   +2.655154954596326e-03   +2.025158782613173e-03   +1.445578346877067e-03   +4.270597680119020e-03   -3.688759242649626e-04   +7.507538688258097e-03   +5.767767739113637e-03   +4.815559229342910e-03   +9.733743933918425e-04   -6.132752811821705e-03   -5.514530313637622e-03; +6.153965458689083e-03   -1.693140677563859e-03   +1.014959219962435e-03   -1.495024178203501e-03   +1.579100750785423e-03   +3.402364702898835e-03   +4.756076864280258e-03   -3.719996597142199e-04   -2.434734087283241e-03   +6.793260077410420e-03   +3.183935349963937e-03   -2.704450134686406e-03   -2.229464857083979e-05   +5.801782094992935e-03   +1.712449185852775e-03   +1.752773193688123e-03; -3.323504856725622e-03   +6.614480758461911e-04   +4.465355210911640e-03   +4.241479046232144e-03   -5.781241651325503e-03   -3.865977492435706e-03   +9.002120642631737e-04   +5.232137298191294e-03   +7.940647045987513e-04   -9.945646470609559e-04   +1.055975069125705e-03   +4.139260219376932e-03   +7.854709010609726e-04   -3.321579555079166e-03   +5.779087799274694e-03   +2.059108379184145e-03; -3.384454595711864e-03   +7.772178048382632e-03   +1.944595509197448e-03   +1.942423851095348e-03   +4.031319302920331e-03   +2.066454795012203e-03   +2.903172342471743e-03   +7.701548543392788e-03   +1.355182692403247e-04   +1.025288671030881e-03   +3.229118665641183e-03   -1.423910340380232e-03   +4.302466613496605e-03   +1.811470802501593e-03   +3.199155926538128e-06   +8.415687340482324e-05; +3.947592856221734e-03   +4.782982884817568e-03   -1.813609326670212e-03   -3.141315203310604e-04   +1.048458832226919e-02   +4.395816767088521e-03   +8.752550801472558e-03   -5.356573630001018e-04   -3.235155629013662e-03   -1.874875786672606e-03   -2.486925010719775e-03   +6.867104437471877e-03   +6.070323598796314e-03   +4.557294414959067e-03   +8.222779661923474e-03   +1.734936528665593e-03; +4.854167236082074e-03   +8.573907298264885e-03   +4.104913411503984e-03   +2.253828631166510e-03   -7.203501235193051e-04   +5.873799911177811e-03   +2.442118742064404e-03   -1.639615173373502e-03   +4.094300607878744e-03   +4.323632391558243e-03   +5.184193681296628e-03   +2.825668890356920e-03   +5.313241528334406e-03   -4.199712276669450e-03   +4.594706328247921e-03   -2.769067514221915e-05; +5.579471810669908e-04   +2.404086521202605e-03   -3.221770433096893e-03   +1.669528652504246e-03   -1.936439591307952e-03   +3.050782601338091e-03   -3.886614678161526e-03   +4.745541973990353e-03   -1.850480680209621e-04   +2.342278279123896e-03   -5.679894573100725e-04   -7.603369371942723e-04   -3.027764015642131e-03   +1.125128109801587e-03   -1.282417345064251e-03   -2.458142540564207e-03];
L2E_L1E_iAMPA_netcon = [+2.129998923125094e-03   +2.565914975212158e-03   +3.176566665268871e-03   +3.077925632402295e-03   +5.069656138177812e-04   -3.710248366943831e-03   +1.030140833535145e-02   +5.979990225183327e-03; +4.039175821997959e-03   +2.204503715876476e-03   +4.629771150000857e-03   +1.492197379216841e-03   +4.984095634484824e-03   -1.815090274820839e-03   +2.423439232401534e-03   -2.921990872654379e-03; +6.248272315302163e-04   +5.117539138256449e-04   +1.741024361007976e-03   +2.366503444830453e-04   -2.232927110967648e-03   +7.064569923290303e-03   -4.045456908723251e-04   +2.055895883268527e-04; -1.749962808864909e-03   +2.183267924259488e-03   -3.920551871868065e-03   +4.585906852980886e-03   +9.756829348616781e-03   -2.353690476861088e-04   +4.779452183151025e-04   +1.925534241907357e-03; +2.387646266881625e-03   +7.676876969315903e-03   -3.786135744879730e-03   +2.386069005851391e-03   -4.221877524833923e-04   +1.491753901165192e-03   +2.892227776151926e-03   -2.961154975123554e-03; +3.120322656413359e-03   +5.440718008043778e-03   +5.066566920385720e-03   +5.697231921416646e-03   +6.300276219084815e-03   -5.140070430036851e-03   +2.050521038205140e-03   -1.865091132588505e-04; +3.667548680536784e-03   +1.520761966490350e-04   -3.155960662978517e-03   +1.921622089356293e-03   +5.098395744530662e-04   +2.355115086170238e-03   -2.762957173824322e-03   +8.181623363279527e-03; -3.082582250517314e-03   -2.265990866390242e-03   -6.821099079546322e-04   +1.605595746182841e-03   +6.564245071238500e-03   +3.478670619498457e-03   +6.325339267466774e-03   -3.778002489792062e-03; +1.413372478810333e-03   +2.508435633873732e-04   -7.895036953702295e-04   -2.303538278536521e-03   -7.288634966923429e-03   +9.937196529212058e-03   +3.301707393880237e-03   +6.264811772729358e-03; +2.457069471253305e-03   -2.885695819963027e-03   -3.932077940921530e-03   +5.441403674139006e-03   +1.003545414451331e-02   -1.219400486849377e-03   -3.136611747097055e-03   -1.238312886753230e-03; +6.516991754154673e-03   +6.298541436275898e-03   -4.634486925094259e-04   -1.122396357915715e-03   +5.138252512152353e-03   -1.666245068252279e-03   -6.533810699975123e-04   +1.921292820659912e-03; -3.134837105282725e-03   +9.863453155636475e-04   -4.122739005419287e-03   +3.144840833381729e-03   +5.984218243362021e-03   -7.664866872965031e-04   +8.726900935635681e-03   +2.052637567032620e-03; +4.355605499423991e-03   +9.127367229933982e-04   +1.474255742740907e-03   +2.045135909215782e-03   +5.372547774889225e-03   +7.256646329491030e-04   +6.822708814596651e-03   +6.608071151313363e-03; -1.245747163153711e-04   +3.465874905598980e-03   +1.834602601663664e-03   +4.147978627156090e-04   -2.844066558863671e-03   -1.578421955905750e-03   +3.613173513270296e-03   +3.724795687882293e-03; -1.901757507769195e-03   -9.189714660233757e-04   -2.453445124222977e-03   +3.879824235584117e-03   +7.172327587493892e-04   -6.596254537346035e-03   +9.315138713984067e-06   +1.383511768724390e-03; +5.940133694780562e-03   +1.768816105359334e-03   -3.085140067137055e-04   -3.084386162078394e-03   -2.266405272807234e-03   -4.832884508576216e-03   +5.207822793353822e-03   +3.012319743188151e-03];
L1E_L2E_iAMPA_netcon = [-3.750096472621044e-03   +1.753095285240830e-03   +4.915392478634090e-04   +3.252368031054995e-03   +7.658633716600876e-03   +8.349733548470357e-03   +3.175345086098432e-03   +6.740987103335688e-03   -1.332481908513356e-03   +8.943759614752464e-04   +5.026075086366084e-03   -3.304635495133072e-03   +4.193522916789602e-03   +1.992102533872923e-03   -3.789098712203662e-05   +4.561527444875037e-03; -3.960775254860883e-04   +8.508296692110603e-03   +3.504491097147186e-03   -4.215996703197182e-03   +2.617361656931618e-03   +3.606810045094501e-03   +9.122568890094621e-04   +3.250374029482530e-03   -3.925990985298557e-03   -3.763765371840345e-04   +5.109936917993920e-04   +3.474305691575934e-04   -2.996671173534033e-03   +6.367543757777354e-04   +6.371428072965971e-03   +1.424794654870368e-03; +1.849082010797451e-03   -1.609855850881482e-03   +5.844578693216904e-03   +8.026640804692073e-03   +5.115687208806937e-03   -1.284736461520308e-03   -2.301572402669127e-03   -1.896836940036932e-03   -1.138672582250600e-03   -4.648916396531246e-03   -9.735489461887984e-04   -2.333388740823926e-03   -1.691395634358611e-03   +5.781572998205434e-04   +3.617502321992794e-03   +7.751852499353297e-04; -2.853638301871977e-03   +1.252348624210679e-03   -1.542258543753273e-03   +1.694811165018329e-03   +3.723669228076903e-04   +5.553707428208647e-03   +4.919952235830394e-03   -4.445652893670151e-03   +4.953851485208837e-04   +3.582121233116269e-03   +4.318300452803720e-03   -1.874778135777106e-03   +5.249385509004589e-05   +3.072657574187281e-04   +1.970980622936294e-03   +3.392798603035943e-03; +1.258032338687233e-03   +3.402854053884765e-04   +4.205379573598212e-03   +4.029356845618804e-03   -4.088880403373639e-03   +1.347391045273410e-03   +8.228907623139721e-03   +4.370829192990372e-03   -1.232766974034915e-03   -2.503284149372612e-03   -6.253993874197622e-03   +5.308938670952208e-03   -1.441067250998954e-03   -3.647725866689063e-04   +7.858972828961776e-03   +1.388243599133755e-03; +4.087754714633173e-04   +7.390400919993167e-03   -2.060598412154744e-03   -4.823318787492243e-04   +1.074123155390466e-02   -1.405235332751383e-03   +1.588746182001459e-03   +6.950115613207344e-03   -4.326624688350047e-03   -1.508302296774076e-03   +5.770254886559007e-03   +5.872450977301595e-03   +7.141881634344823e-03   -2.691094179843149e-03   +2.564669458660108e-03   +4.951687830212935e-03; +2.260175237143133e-03   +5.034367650241328e-03   -3.110979374868400e-03   -1.649953408115928e-03   +4.591265489474175e-04   -1.897373963617633e-03   +3.302268025585557e-03   +4.751911121425425e-03   -1.864114187135283e-03   -1.096670344314214e-03   -2.422028013244940e-03   -3.724135733526354e-03   -2.547587254577583e-03   +1.569752008068066e-03   -1.667813334694828e-03   +2.015388795388083e-03; -6.409894894250890e-03   +1.452645715755371e-03   -3.598909364265685e-03   -6.983040070895371e-04   -3.811027952372783e-03   -3.009809494429982e-03   +3.775625441617963e-03   +4.577402455348129e-03   +4.652797565513423e-03   +2.586588374016245e-03   -1.559110757415311e-03   +7.349413323841976e-04   +2.273512187921426e-03   +2.151201661796353e-04   +1.260619155537217e-03   +5.092891673229785e-03];
L2I_L2E_iAMPA_netcon = [+7.964228556398912e-04   +9.390708978173328e-03   +3.171963062743664e-03   +7.049379500206903e-03   +3.170147408429068e-03   +1.053873187254741e-03   -6.385631443636120e-04   +4.199304421147915e-03; +5.564166970825843e-04   +1.889527727692632e-03   +3.073238210120355e-03   +6.959546103846063e-03   +9.120140500602036e-04   +6.570781451783992e-04   +4.645420278700651e-03   +1.171670407936542e-03; +5.786213622527740e-03   +2.748428906570117e-03   +6.144983090924908e-03   -3.585512802158462e-03   +3.061226518662416e-03   +3.581502714272311e-04   +3.370195286624762e-03   -1.398591392541627e-03; +1.614075386528864e-03   +4.557491972487563e-03   +9.751456587671457e-03   -2.148306429348397e-03   +5.898433453912718e-03   +1.254361261185291e-03   +1.896679035210568e-03   +1.197799687742429e-02; +5.188661391365068e-03   +1.656945978502393e-03   +4.126711757215530e-03   -2.439688220674135e-03   +1.306407410306118e-03   +2.856447674871297e-03   +1.985407815732468e-03   +2.763923018155157e-03; +3.997899432677406e-03   +1.653418586231899e-03   +2.233402537855114e-03   +8.938049386040922e-04   +5.545204073145404e-03   +3.695004988507636e-03   -2.084752016815984e-03   +8.521451981477508e-03; +1.153242708004461e-03   +2.840727041275348e-03   -3.882107431237764e-03   +4.899581731246512e-04   -5.257541942565178e-05   +4.988545228976015e-03   -5.222280687424563e-03   +5.739598535469635e-03; +2.177268700368616e-03   -2.575065191736637e-03   +1.305407658563714e-03   -3.254185866573393e-03   +7.947206140404795e-04   +1.975030247692144e-03   +2.773307106058031e-03   -1.867921565087107e-03];
L2E_L2I_iGABA_netcon = [+6.626248542317530e-03   -4.646594317530953e-03   +4.834271376783185e-03   +1.320416078711544e-03   +4.725492552198085e-03   +3.964314542717251e-03   +1.407594580278353e-03   +2.238608765478946e-03; -5.426764855935032e-03   +4.813390357961514e-03   +5.166960721424420e-03   +1.438136036879641e-04   +4.889861420523002e-03   +5.011518792410453e-03   +6.692227419606058e-03   -6.494086222827474e-04; +7.494793575294419e-03   -4.859600644857163e-03   -1.847541060262080e-03   +3.058602318307551e-03   +1.796656554267215e-03   -3.362847337314689e-03   -9.139349863799538e-04   +4.188941718281399e-03; +6.003820021367384e-03   -3.750326360759955e-03   +1.307460910984962e-03   +4.667897636966585e-03   +2.545066661395561e-03   -1.594413344388247e-04   -2.224716624279657e-03   +1.853075052270412e-03; +2.720749389959108e-03   +3.236014482454937e-03   +5.571675371665977e-03   +1.015273178520329e-02   +5.555694073172059e-03   -3.247555216476040e-03   +2.146103654248772e-03   +1.587054310743389e-03; +6.337607427716779e-03   -4.996631668663622e-03   +3.033303024114799e-04   +1.550703250155464e-04   +3.123432503015977e-03   -3.954804680296631e-04   +3.141433178538676e-03   +1.987265585432348e-03; +4.262337649114687e-03   +2.901962007306923e-03   -2.304000234655147e-03   -2.948715251089444e-03   +1.715803729662837e-04   +3.693855510908765e-03   -2.062857020858102e-03   +1.590791179120653e-03; +4.239660367799986e-03   +2.802529573585981e-03   +3.941536757546869e-03   -4.156325660054533e-03   +2.665769347269841e-03   -8.369670648695599e-04   +4.754860328189934e-03   +1.201747792562266e-03];
L3E_L2E_iAMPA_netcon = [-4.057316531835499e-04   +9.418277360977993e-03   +8.258617308335705e-05   -4.492810186865486e-03   -5.459295379341915e-03   +3.551786898977109e-03   +3.803700098479148e-03   +5.616007945282790e-03   -6.578527431327407e-04   +1.061815381762651e-03   +2.079010930285301e-03   +6.810964031394559e-05; +5.960214396880660e-03   +6.895911225862022e-03   +3.048167383539484e-03   +1.914993912457665e-03   -1.850937496019000e-04   +2.836105272990049e-03   +2.840725583957914e-03   +3.256706229735523e-03   +3.560656500544259e-03   -1.940700834475540e-03   +4.189920578079393e-03   +7.753923610602134e-04; +3.242662944462796e-04   +2.711704468910156e-04   -3.027145347885110e-03   +2.718137866234367e-03   -3.747667546899534e-03   +3.552276203035588e-03   +3.120613783284058e-04   +9.520577866855832e-03   +6.076004599899491e-03   -3.388396080786071e-04   +2.428120514586959e-03   +4.386530077328494e-03; +1.157686467407094e-03   +2.977511047708710e-04   +4.448574559878904e-03   +8.819987366935997e-03   -2.871438777129912e-03   -2.623324328832396e-04   +4.882750546945980e-03   +4.432381732644632e-03   +2.523130625975499e-03   +5.077893180717385e-03   +5.427856068856573e-03   +2.347713825486731e-03; +4.993746336136602e-03   -4.323034940945324e-04   -2.219448222172315e-03   +8.578591043077496e-03   -2.584864293417037e-03   +2.484254624168503e-03   +5.617077062966276e-03   +7.097472806072908e-04   -1.000741297540717e-03   +8.053933194779343e-03   +6.657587822390571e-03   +1.979108584905705e-03; +2.334474825377909e-04   -1.991840855745860e-03   -4.422997605354017e-03   +1.083087531858215e-03   +1.625211348703203e-04   +7.554007179397188e-03   +6.824424053909967e-03   +8.827014628712958e-03   +1.076584652236979e-03   +2.760079415119899e-04   +4.617100009995350e-03   +1.717199243340695e-03; +9.127057550896281e-03   -3.107397093346793e-04   +5.298359321923178e-03   +4.792310476813582e-04   +2.316198360935164e-03   +3.813201963983308e-03   -5.722551485472325e-04   +9.274754656776041e-03   -8.063037249221136e-04   +2.570384812221537e-04   +3.665453795319716e-03   -2.042526449881317e-05; -4.179254605769633e-04   -1.725996287786400e-03   +6.902878269313727e-03   +2.046909159412618e-03   +3.737411669608446e-03   -6.450480955429342e-03   -3.583339874736315e-03   +4.713800385629007e-04   -1.498995523355603e-03   +6.239023331856487e-03   +2.353903205535524e-03   +1.860934374276242e-03];
L3I_L2I_iGABA_netcon = [+5.491256027414483e-03   +5.200864224580553e-03   +1.180836742798794e-03   +1.513225563659325e-03   +4.049839491339625e-03   -2.302065484026245e-03   +3.742267439960601e-03   -2.126651232453086e-03   +3.755771027423927e-03   +3.469364295655895e-03   -1.373562788570107e-03   +4.891095279670961e-03; +8.484244323937657e-04   +3.907750380938613e-05   +1.415589358616694e-03   +2.577507831764185e-04   +4.546475423977980e-03   -5.585906270511524e-04   +3.866405373247588e-03   -3.261572729740534e-03   +6.249808111553579e-03   +1.524760757960442e-03   -1.275402654446055e-03   +2.297355810698238e-03; +3.372244125449006e-03   +2.744788595401313e-03   -8.745934431696043e-04   +1.734807273951711e-03   +1.739513920191952e-03   +3.083243442428796e-03   +1.080431774784542e-03   +6.301578692540926e-04   +6.315499185253683e-03   +2.151402743088257e-03   -3.750595244637799e-03   +7.709281028647074e-04; +6.779364877324378e-03   +5.583334104277023e-03   +2.762650021971594e-03   -1.667092937971561e-03   +2.198712538436149e-03   +7.567868310272465e-03   -1.740769677153358e-03   -1.192305567960772e-03   +4.706385271396919e-03   -3.225429317878394e-03   +3.891898762110515e-03   +5.229330660658059e-03; +2.154923298820806e-03   -1.684556730764789e-03   +7.836220135710974e-04   +6.387245183367180e-04   -5.209070834901053e-03   +6.451855171356001e-03   -7.846084347975583e-04   +5.916122055906463e-03   +4.023870062245014e-03   +2.572901976086849e-03   -7.064174943968597e-03   -2.898753546112924e-04; -4.636995201003937e-03   -3.261476051712258e-03   +2.653759362297562e-03   +2.044223396927685e-03   +3.592673307950710e-03   -2.041632282982176e-03   +4.788402312931186e-04   +2.618983497325080e-03   +4.202020410725043e-03   +5.368401845800556e-03   -2.301364839617418e-03   +4.141238361946901e-03; +4.212995530735619e-03   +1.123599561352194e-03   +2.536235885808580e-03   +3.580727452525866e-03   +1.039407114166710e-03   +4.317127228732304e-03   +1.491423175392376e-03   +4.660865748501699e-03   -1.910586800847172e-03   +5.478771356313306e-03   +2.935202174075462e-03   -1.390318636349952e-03; -9.828864784677570e-04   -5.206610505475314e-03   +5.271121153478778e-03   -2.245988396394688e-03   +7.376401256012580e-03   +5.561613027426195e-06   -5.424056809972383e-03   +7.284474652178429e-04   +5.791564665712261e-03   +1.564846470852472e-03   -4.038896074492489e-03   -7.050038814853187e-04];
L2E_L3E_iAMPA_netcon = [+2.548345155287378e-03   +2.876603069115291e-03   -9.908514366488096e-04   +6.074253143038292e-03   -9.276591610887376e-04   +1.524320071128442e-03   +3.655511924254701e-05   +7.645918594641861e-03; +1.745930975386642e-03   +5.196129786714941e-03   +7.157370492023217e-03   +1.000597249220222e-02   +4.600485684121422e-03   +2.796206968438084e-03   +1.338767928775841e-03   -9.331342038925388e-04; -3.523549817739655e-04   +2.569788521196446e-03   +6.253571908473249e-03   +1.682290244433630e-04   -4.451417046647377e-04   +8.604359980471727e-03   +2.728157797937005e-03   +8.077145878136129e-03; +3.461977512833983e-03   -5.233640589454724e-03   +1.617382183038712e-03   +1.546521398629864e-03   +4.052082440350178e-03   +5.826916424246216e-03   -6.517527720388955e-03   +5.931259272156562e-03; +1.810584055580108e-03   -3.824000120973749e-03   +3.058700070043456e-03   +4.268469226699515e-03   +4.144413362392929e-03   +1.589230397002878e-03   +4.518558142809857e-03   +2.592049848100481e-03; +3.044042866222109e-03   +4.651948489284788e-03   +4.666040312337089e-03   +1.438010844310496e-03   +7.155984397570746e-03   +8.445202091810242e-03   +4.177219080800309e-04   +2.983707820407076e-03; +4.751057011888969e-03   +2.092962746477609e-04   -9.537197353713862e-04   -4.712102534128961e-03   -7.449627245498178e-04   +4.039083980495962e-04   -1.705365945261387e-03   +2.004505039539698e-03; +9.468943520335378e-03   -6.429186717875565e-03   -2.657977493476794e-03   +4.100293506697154e-03   +4.992337014056832e-03   +3.863011969208289e-03   +4.012679355040419e-04   +4.203945551401948e-03; -6.741736182076144e-04   +4.489623869972779e-03   +3.146439502206796e-03   +7.373489636179358e-03   +3.313092896827555e-03   -5.488084437861397e-03   +2.433287190620297e-03   -2.799438734811283e-03; +1.714515562751609e-03   +2.531134057334646e-03   +2.695152450428633e-03   +5.087419971001855e-04   +3.050575788326781e-03   +2.855449018689136e-03   -3.170307545048061e-05   +3.846886531117671e-05; +3.326441796153891e-03   +1.133838078620958e-03   +5.343023750317114e-04   +7.965009300878505e-04   +1.357897710580907e-02   -6.453974482520440e-04   +1.353863270761346e-03   -2.069769920475591e-03; +5.837126456775521e-03   +3.759400787062138e-04   +3.793869636544865e-04   +4.314218117037233e-03   +5.280671729086082e-03   +5.499349466538962e-04   +4.165130397590622e-03   +5.766192686395468e-03];
L2I_L3I_iGABA_netcon = [+6.998768271800665e-03   -5.078977534583005e-04   +2.876770600939720e-03   +3.610239895081556e-03   +9.785353756308230e-03   +5.878857010403499e-04   +2.024512225985182e-03   +2.351918449190822e-04; +3.023554668224391e-03   +2.857607223625989e-03   -7.189496421253845e-05   -2.067492785474338e-03   +3.441093418861301e-03   +4.789043938785569e-03   -4.302424405383931e-03   +2.370497978701807e-03; +1.131713181006033e-03   -3.604555019147816e-04   +2.079527689056873e-03   -2.707784928563438e-03   +5.929821090801621e-03   +9.031256861581131e-03   +8.361391282113629e-03   +2.103576678681268e-03; -3.374461159751010e-03   +6.368505916874849e-03   +4.106880599338012e-05   +5.281179159370834e-03   -4.269902030214594e-03   -5.926260289804582e-04   +4.974450667393090e-03   +1.261284317815141e-03; -1.208831429320752e-03   -5.585571418549909e-03   -3.800888600297063e-03   -1.386338988215280e-03   +5.198629579477710e-03   +1.199346527390891e-03   +7.399492982834726e-03   +6.302178234368666e-03; -1.487700980113509e-03   +4.994804902535166e-04   +4.267934829153104e-03   -2.058147281540925e-03   -3.027809623397901e-03   -2.661818556328033e-03   +2.930926406045768e-03   +1.021270815018315e-02; -2.375996869336434e-03   +1.278794580366688e-03   +1.452354627043471e-03   +2.482986245627561e-03   +7.362635498281741e-04   -2.988884689012675e-03   +8.466488688676371e-04   +3.236259165769600e-03; +4.596068182376916e-04   -8.059584456245484e-05   +8.053438138461244e-03   -1.451009458720385e-03   +2.386497748106660e-03   +7.766868213915239e-03   +4.268459795969254e-03   +7.515215942227743e-04; +1.236473160578018e-03   +3.315779438770588e-04   +3.126933966215284e-03   +2.577959776386397e-03   +3.797373302049594e-06   -1.236927574073580e-03   +3.742149924751757e-03   +5.026209216907702e-03; +7.345460040658030e-03   +9.544933040625580e-05   +3.565309613845232e-03   +1.209914598817559e-03   +6.347784388589420e-03   +2.043527217737895e-04   +4.460813467383396e-03   +1.773152054594017e-03; +7.105000341980829e-05   +1.492543835776398e-04   +1.683284103751238e-03   +3.503355480337036e-03   +1.062280889537017e-03   +8.146079741642399e-03   +2.351783211816366e-03   +2.297860477203572e-03; +7.937555817198355e-04   -7.755077824239435e-03   +3.274623673766498e-03   +5.398447703268574e-03   +2.706265359481499e-05   +1.657390232555086e-03   +3.292593883422984e-03   +6.812626631701504e-03];
L3I_L3E_iAMPA_netcon = [+2.892257815638398e-03   -5.110283663686700e-04   +1.726016175903051e-03   +2.008256859784157e-03   +7.198193655250993e-03   -9.826502104232555e-04   +1.637408250845882e-05   -2.910118045487820e-03   +1.697603247597688e-03   +2.860124590980061e-03   -1.381460062427271e-03   -2.665068487187751e-04; -1.090428551103709e-04   +4.851289758627509e-04   +2.829179098424396e-03   -6.734335761527793e-04   +2.111980463022820e-03   +5.954969783104322e-04   +3.307003007300243e-03   -8.668096417681376e-04   +8.156704863880441e-05   +2.379977441161226e-03   +6.988157179406549e-04   +5.348395125151239e-03; -3.691114535593472e-03   +4.217040398621112e-03   +4.991191489179784e-03   +3.369605075267221e-03   +1.615677520810704e-03   +6.346912978708262e-03   +2.773782616653811e-03   +4.791493375697629e-03   -4.372473719531844e-03   +2.784150814847889e-03   -1.328600261480100e-03   +2.051615243354623e-03; +5.293314535832006e-03   +6.026653749864021e-03   +3.360428780762321e-03   +7.565494474999642e-03   +8.330535455948756e-03   +1.822958516199462e-03   +3.774428670299026e-03   +4.918581524271147e-04   -3.679346429827589e-04   +8.055115353933684e-03   +2.149999584461782e-03   +8.782758852868120e-03; -1.154805085959917e-03   +3.172670309704416e-03   +1.337993782040852e-04   +1.866310555329543e-03   +2.050074245869275e-03   +4.540655041929140e-04   +1.380068430058563e-03   -2.736007666432137e-03   +6.364871349678288e-03   -8.531172768438464e-04   +8.745010098743541e-04   +5.378963297606390e-03; -4.425466470893229e-04   +5.987672286509185e-03   -1.891330769603953e-04   +2.267598107645334e-03   -9.713371662864812e-04   +2.653944757893498e-03   +7.922839470885483e-03   -2.124651027656287e-03   -7.840593210595383e-04   +3.989948424529135e-03   -4.287088273264863e-04   -9.525949063890343e-04; -3.852983150657805e-03   -6.056981157636091e-03   -3.153254802397036e-04   +2.385424609747859e-03   +6.469850040498782e-03   +2.203811744962094e-03   +1.424359012736753e-03   +7.481472052415722e-03   +2.072900483010535e-03   +5.209685710390992e-03   +3.180345716367622e-03   +7.998035093350000e-03; +5.696120155717012e-03   -6.549833832504861e-04   +7.216524706077198e-03   +1.237598998715003e-03   +4.420576700379018e-03   +1.029369933260095e-03   +4.837210982536248e-03   -1.284334615019359e-04   +3.945541024041551e-03   +1.036345357959512e-03   +7.741818290310546e-03   -7.833841456374767e-04; -4.967945891248874e-04   -1.971966638204008e-03   +1.333745116170483e-03   +2.834736828583762e-04   -5.879345488521045e-04   +2.011121963985416e-03   -3.254133220680291e-03   +4.543492695124388e-03   +9.480471958542205e-03   -5.620143991466162e-04   +2.978523371526669e-03   -6.240391356502935e-03; -2.077071213582960e-04   +1.969939695917319e-03   +6.314429987295459e-03   +2.393739436167881e-03   +4.201814872943657e-04   +1.945682334022775e-03   +1.245964391249993e-03   +4.909397532251736e-03   +3.821346638535054e-03   +3.639383790117393e-03   +5.109522269072630e-04   -3.422295707791062e-03; +2.986571171121166e-03   +1.377093484198891e-03   +4.612714266589202e-03   +2.600619631753615e-03   -6.273101047952610e-03   -3.244465394474848e-04   +2.194454606601536e-03   -5.431844514285376e-04   -2.124151236245037e-03   +2.605345386530032e-03   +5.521864995562415e-05   +5.012374069889582e-04; -3.528744734046014e-03   +3.389644296895949e-04   -3.844898734866359e-03   +1.971387268453589e-03   +7.271017790651001e-03   +2.011636279199176e-03   +8.058444327581158e-03   -7.821715294291464e-03   +2.211892716255404e-03   -1.569439780883287e-03   +3.673386449355739e-03   +1.752901941554010e-03];
L3E_L3I_iGABA_netcon = [-3.604066199772017e-04   +3.597396545196392e-03   +1.201483385323332e-03   +7.007241904280545e-03   -1.042317427610849e-03   +8.505450621199831e-03   +5.531426025733250e-04   +3.713596069834186e-03   +1.513389329551461e-03   -4.221687220708560e-04   +1.765162879300863e-03   -2.416514469785122e-03; +3.117292281742364e-03   +1.012255218957482e-03   +1.368015373324256e-03   -1.334059381095046e-03   +1.640472977768592e-03   +3.671271558587652e-04   +1.055097017499528e-03   -1.537557746116924e-03   +3.256483364983044e-03   +8.372489682504498e-03   +1.912797865341207e-03   +1.382267953337560e-03; +4.558858316238623e-04   +2.838040119914593e-03   +5.308291218976748e-03   +2.164849571809037e-03   +6.661120320793281e-04   +2.693121846907964e-03   +4.951315929883263e-03   +4.374001501134026e-04   +2.453038681866487e-03   -4.088265474302312e-04   -7.514509127675834e-04   -4.349595511912694e-03; -3.203328300582022e-03   +3.834560294527506e-03   -1.798785363135239e-03   +1.020483336586518e-02   +1.148995204713985e-03   -1.480473616143653e-03   +3.360028300441669e-03   -9.490249870979053e-04   -1.022724638555358e-03   +5.100852950257596e-03   -9.073287678503282e-04   +2.422483684138453e-03; +6.006056209656557e-04   +3.169696583954766e-03   +1.535435919112746e-03   +3.744271638266797e-03   +4.102906124221666e-03   +5.776983585144788e-03   +1.974283277742642e-03   +5.780162435660177e-03   +6.030779695163134e-03   +4.825875726704001e-04   +5.856208838898101e-04   +3.541802732902601e-03; +4.162955737900191e-03   +3.328185612396430e-03   +6.504370444343779e-03   -2.925037555343929e-03   +2.641611291027810e-03   +6.920348416290883e-03   +1.948034558805559e-03   -4.313794144251527e-04   +9.298687037465690e-04   +2.917452497291457e-03   +2.707759368832543e-03   -3.337646957556385e-03; +2.627880590205313e-03   +2.178296936086516e-03   +9.173920967729793e-04   +3.096222195505334e-03   +4.230626856674491e-03   +4.377708432470652e-03   -2.013745623245593e-03   +1.387496317269858e-03   -2.942036876203735e-03   -2.605751667965197e-03   -2.060054380593637e-03   +5.574968741863886e-03; -3.260406434368536e-03   +6.470912486714134e-04   +1.392137690224527e-03   +7.486844915558814e-03   -2.380609556986774e-03   -3.035106609969630e-04   +5.392337927608776e-03   +5.151235362763500e-03   +5.607415794240603e-03   +5.544670746682507e-03   -1.356256498457121e-03   +1.939752090497148e-03; +2.965108173873710e-03   +8.288601472261442e-04   +3.505820784562916e-03   -1.943864165676438e-04   +2.218558223201002e-03   +5.111625509207596e-03   -5.333798032104604e-04   +7.896255211143816e-03   +7.416819256723473e-04   +2.528505573813096e-03   +1.985500179537575e-03   +3.068374333260963e-03; +3.537600887428044e-03   -5.366645737406635e-03   -6.316868167814127e-04   -3.476837337426778e-03   -2.586312988279806e-04   +4.716625375222978e-03   +1.397887180224719e-03   +2.633158874963014e-03   +4.669479493666780e-03   -1.493250050226033e-03   +6.420784580387748e-03   -2.150275410068059e-03; +2.242510475340809e-03   -2.575473114034106e-03   +5.177652221572102e-03   -2.064909216803482e-03   +6.245831479418156e-03   -4.930505723686324e-04   +8.081060323070479e-03   +2.832612465942963e-03   +9.605687377628305e-03   +5.782434983790457e-03   +4.643472741008061e-03   +5.309723245031242e-03; +8.123648373287464e-03   +6.618290679029117e-03   +1.221579770053399e-03   +5.231468155500036e-03   -2.508821134722270e-03   +2.380309383516546e-04   +5.296576161183425e-03   -4.946459262582454e-03   +7.353610449501476e-03   +7.174524038312568e-03   -2.731707908520383e-03   +2.611753031338118e-03];
L2E_Input1_iAMPA_netcon = [-2.361842108654912e-03   +8.091957283379568e-03   +4.779076017838813e-03   +9.110309134185202e-04   +6.891368353525322e-03   +4.192939032726150e-03   +3.985990257982703e-03   +1.220775080416800e-03];
L2I_Input2_iAMPA_netcon = [+7.861193698260664e-03   +5.750264758747816e-03   +1.657443183615102e-03   +8.804533660123604e-04   +6.050080849998139e-03   +5.155008577255550e-03   +2.387144437057999e-03   +9.141562074663630e-03];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
