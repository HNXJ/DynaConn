function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+8.586568350556402e-02   +1.582798982972080e-01   +6.642832140474868e-02   -1.031729609659387e-01   -1.466938642543675e-01   -7.103973238011761e-02   -8.164707633250415e-02   -9.145172404354004e-02   -6.193382692352807e-02   +3.036176191626495e-01   +7.993487761158314e-03   +1.625360812046961e-01   -2.036673049160175e-01   +1.655943132573955e-02   -1.931642324534800e-01   +5.081267872648876e-02; -2.823235945635853e-02   -9.637234514626891e-02   +2.011419369896209e-01   -1.714186744608811e-01   +8.803920369715131e-02   +1.958461549381236e-01   -1.524290323873881e-01   +1.999599545604707e-01   -2.582131766532303e-02   -1.877194015290458e-01   -1.599080460853396e-01   -2.191053257052336e-01   -4.088559598064848e-02   -1.354487347511679e-01   +9.662360602181334e-02   -2.032436626099158e-01; -1.664779016217070e-01   -6.952464385961244e-03   -5.580512968286892e-02   -1.430834586609660e-01   +3.127957986157021e-03   -5.639074379859940e-02   +2.081322857079675e-01   -3.514483825197037e-01   +1.644125200537652e-01   +1.470183225466420e-01   +1.301640398127878e-01   +2.181627480319458e-01   +1.917879121568537e-01   +5.040725908306753e-02   +3.087245750780444e-02   -3.556210860164702e-01; -9.818157108796643e-02   +1.845555131136094e-01   +2.838356093036002e-01   -1.418287457979459e-01   -2.515856169407908e-01   -4.655691923058281e-02   -1.821572286683249e-01   +1.636885658283866e-01   -9.285789999239065e-02   +5.829291673908919e-03   -1.580745245029191e-01   -6.329058028831769e-02   -2.239988400587245e-01   +6.950569604783721e-02   -2.831434450555972e-01   +5.543439472389813e-02; -3.790671797877442e-02   -1.375618853970882e-02   +3.775802691435227e-01   -1.181590610756997e-01   -5.226441778868592e-02   +2.430778149653772e-01   -1.313821010205471e-01   +2.295850757116136e-01   -3.073558563213215e-02   +4.763987042032326e-02   -9.835778869845329e-03   +3.014705585902628e-02   +1.882829087071814e-01   -9.170420782366867e-02   -5.709551165220735e-02   +3.260666467171593e-01; +1.769525777851308e-01   -5.423775086829252e-02   -1.926246057223881e-01   +3.755089476416160e-01   +2.774501999205765e-01   -5.351905100733904e-02   +2.352813588290045e-02   +4.657624960552049e-02   +7.646764107406669e-03   -2.876940421304867e-02   -1.517410651442121e-01   -5.995836920856951e-03   +3.426956183504403e-01   +2.224545608496654e-01   -2.015973435554482e-01   -1.512051273711975e-01; +6.183522997081067e-02   +4.193848236707247e-02   +7.701927636622019e-02   -1.785300724806044e-02   +3.246464746048393e-02   +2.443546884893235e-01   -2.340574965510729e-01   +8.173962251838651e-02   +6.275143495502154e-02   +2.453151870237578e-01   -4.580549539812212e-02   -8.046020091045768e-02   +6.193154296255614e-02   +2.277069453787794e-01   +1.810515456775647e-01   +4.605397256827772e-02; -1.333176956261727e-02   +5.325608715221738e-02   +1.121318143831835e-01   +9.456906317039770e-02   -3.030922002569280e-02   +1.612572064615798e-01   -2.614547786303993e-01   +1.277256370669891e-01   +4.301061519814584e-02   +4.186274426506026e-01   +7.401960269370464e-02   -8.950896755970505e-03   -2.442366694829228e-01   +1.876839664803559e-01   -1.736738387627546e-01   +4.579941467509206e-02; -2.591576212131368e-01   +6.444895175135859e-02   +9.160001509603070e-02   +8.098017502171943e-02   -1.843073910891714e-01   +1.052706516823714e-01   -5.914953636760986e-02   +4.185291023106474e-02   +8.428228170883909e-02   -2.789116549148632e-01   +3.910911325117214e-02   -2.106838001482206e-01   -3.249245935516407e-01   +1.418430703820124e-01   +2.635676840656255e-01   +2.110659328462342e-02; +8.680421517111048e-02   +9.289141688378141e-02   +2.789230916918876e-01   +2.331332970790876e-01   -2.498864794365720e-02   -9.224131133892016e-02   -1.769177106742169e-01   -3.307289895455988e-01   +1.358774478475439e-01   +1.669379476199088e-01   -1.022936555977497e-01   -6.008570486827031e-02   +7.702171623111657e-02   +3.088234538897770e-02   -1.110512845056362e-01   +2.437877744400262e-01; +5.101275693006004e-02   +4.593444199956988e-02   -6.811642542517038e-02   +2.257704464220712e-01   -2.911021125968829e-01   -6.202085649838245e-03   -1.590014552831061e-01   -4.524825012368859e-03   -1.190450128916264e-01   +2.676383587996014e-03   +1.072539381914305e-01   +1.494123096395631e-01   +2.953149950092340e-02   +7.357821842386017e-02   +3.071456201903264e-02   -1.135426759289564e-01; -4.639403423580593e-02   -8.340909343472530e-02   -1.218661423790435e-02   +1.051096910419163e-01   -1.526809431538727e-01   -5.047175121277366e-02   -7.439137854430719e-02   +1.497036401919120e-01   -6.733193162527357e-02   +2.148360619781233e-01   -7.748826520986279e-02   -1.096102423619659e-01   -1.260585630902138e-01   -6.474440264606643e-02   -4.213185426140214e-01   -2.054598090635923e-01; +4.262426461982380e-02   -1.110437403905365e-01   +4.967336430795997e-02   +1.664913284109309e-01   +5.092889762325615e-02   -1.065603818483932e-01   -1.288235892083087e-01   -7.089484484711263e-02   -2.576676285636460e-01   -1.722978812081374e-01   +4.702930208704651e-02   +8.106349246643289e-02   -1.512471549738478e-01   -2.862913416384158e-01   -3.195215775444099e-01   +2.861473232578974e-01; +1.380828360139246e-01   +1.475454355772832e-01   +1.791105014967216e-01   +3.357130451358833e-02   +5.518254620702552e-02   -3.464911957225987e-04   -2.160493410958006e-01   +1.130472239448329e-02   +7.592726905681225e-02   +7.660142524234220e-02   -1.103215248610187e-02   -2.059264666491671e-01   -1.077779811321234e-01   -3.167088818340481e-01   -1.328581983298229e-02   +2.910247424171825e-01; -1.115624044308054e-01   -9.835138219037669e-02   -1.455388101304664e-01   +2.459845845878189e-02   -7.659819097803676e-02   -1.406522131004737e-01   -4.283496107936396e-02   +3.582257028391710e-02   +3.308908098675840e-02   +4.452472566948409e-02   +1.096645320008076e-02   +5.486186124466437e-02   +9.222009532883571e-02   +1.726710930290386e-01   -2.516209249333116e-01   -1.070393336188565e-01; +2.867175270218527e-01   -1.263533905161949e-01   -1.511450292709877e-01   +8.637459633553553e-03   +1.492344125210734e-01   -2.368604115540423e-02   -1.076818926524812e-01   +2.107146773003788e-02   +2.297892647299858e-01   -1.079044020053690e-01   -1.473229994006908e-01   +1.795590826090279e-03   +5.438472740661142e-02   +7.545110059510830e-02   -2.942057281452079e-01   -1.182150066802011e-01];
L1E_L1I_iGABA_netcon = [+2.099441680699304e-02   -5.159459394397081e-02   -2.475025298944330e-01   -5.021583649767822e-02   +3.191918270171159e-02   -1.584227093922466e-01   -1.257912174182057e-01   +9.474909392722514e-03   -5.871316494655641e-02   -3.603862982012117e-03   +5.035358083917009e-02   +5.575958729224315e-02   +2.799591459059061e-01   -2.590648656799822e-01   -5.243610619311082e-02   +1.385767375071302e-01; -4.440757007086925e-02   +1.781044705032833e-01   -1.048233392590552e-02   -3.195213233729995e-02   -4.018057425038801e-02   -6.258183100065383e-02   -1.143084546122230e-02   +3.686073545791585e-01   +2.665537810840501e-03   -2.264042886680342e-01   -2.260415881172216e-01   -3.172318022449714e-01   +5.316453619566844e-02   +1.204204894855259e-01   -1.991146283805111e-01   -1.427625228450857e-01; -1.783080827511880e-01   +2.074660290930370e-01   +1.005953418323198e-01   -2.537034498261984e-01   -1.591524580471817e-01   -5.705949008217073e-02   +1.519243728190719e-01   -6.323335796716459e-02   -2.972098740585083e-01   +5.320919197933360e-02   +2.523677759681664e-02   +3.901673560235618e-02   -1.763561234061432e-02   +6.686301050378225e-02   -3.591335458096082e-01   -1.401496295984904e-01; -1.333524613420332e-02   -8.194179337392138e-02   +5.448022639031590e-02   +2.929340578115137e-02   +5.873337149991929e-02   +1.114755158425865e-01   +4.173642519908483e-06   -1.595373997816836e-01   -5.719283096663690e-03   -2.032192880850446e-01   +3.222800341895153e-02   +2.671004388769634e-01   +1.105847659305968e-01   -1.236510505030642e-01   -1.623264151170960e-01   +1.518781774271989e-01; +1.995231079954713e-01   -8.374348585053318e-02   -1.846146770993985e-01   -6.026501115199701e-03   +1.595897045371332e-01   +3.572168236406323e-02   +6.063327350498918e-02   +6.862712068532381e-03   -3.093009606781587e-02   +1.342706275350811e-01   +3.702815406858680e-02   +3.045224716124895e-01   +1.202240335592536e-01   +1.188013156546064e-01   -5.202260502012753e-02   -1.616942113626936e-01; -2.299526673133691e-01   +2.370120737839037e-03   -1.082579056730027e-01   +1.005461883743642e-01   -3.915427318297746e-02   -3.477057598481658e-01   -3.566419651361794e-01   -9.845162696213648e-02   +2.056186942253089e-01   +1.068338492767567e-01   +6.297249431744305e-03   -1.123193428767387e-01   -6.401986188952850e-02   -3.585613770462995e-02   -1.166446807830064e-01   -1.003180944496178e-01; -3.926721264366179e-02   -1.620498243872847e-01   +2.272413924201122e-01   -1.826347553017404e-01   +1.917697484809613e-01   +3.557118858381796e-02   +2.144283647831648e-02   -2.209067714107314e-02   +1.225112031299978e-01   -2.086588983151805e-01   +1.517752349953654e-01   -1.931272455749342e-01   +2.629654683892469e-02   -1.232704272801771e-01   +1.864888774247349e-01   +3.026470206077504e-01; -2.706146921555065e-02   -1.587418457949950e-02   -2.178061079883792e-02   +8.714159501291505e-02   +2.561179691593122e-02   -1.708546324987394e-01   +1.719198321604928e-01   +2.661847530746916e-02   -1.327825692819695e-01   +2.572003425252590e-01   -1.846455158253658e-01   +1.112152944830014e-01   -3.181371560931425e-01   -3.302412007237134e-01   +5.373893077296530e-02   -8.423682023148441e-02; +2.761700421524430e-01   -2.534932249258761e-01   +1.249660063178494e-01   -7.402553107194018e-02   +7.819945054611938e-03   -3.893368494682715e-02   +4.709105743173038e-02   +7.768897247255750e-02   -3.344615966257026e-01   -3.513177879815604e-01   +9.345243580712251e-02   +3.022070234989624e-02   +3.085441743523066e-01   +7.826856611188671e-02   -1.149759391098759e-02   -1.659539772277716e-01; -1.435264070432573e-01   -1.678765012600886e-01   +1.153857703730688e-01   -1.769045235909648e-02   -2.698503430899010e-02   +2.067446607181306e-01   +2.886485439656382e-02   +1.113246575407677e-01   +1.723480287497232e-01   +1.003770999412389e-01   -8.795267306522712e-02   +3.050881954890103e-01   -1.102485104749286e-01   -1.641559657550672e-01   -3.348419421326528e-01   +1.503096826635545e-01; +2.214928991785615e-01   -2.357811680546066e-01   -3.924148945175050e-02   -1.181622978575066e-02   -7.154249676617530e-02   -5.274500162383498e-02   -2.760320185891281e-01   +1.141301137043079e-01   +6.774587510158152e-02   +8.586298224553104e-02   -1.498776045701413e-01   -2.438579045587168e-01   +1.249331507140596e-01   -1.224853850653707e-01   -1.617736120297688e-01   -1.315732311248630e-01; +1.640160126802653e-01   -2.043997466865210e-01   +1.440451267424388e-02   -8.846160392304155e-02   -5.855403551081216e-02   +2.893452451752986e-01   +1.564255298297407e-01   -1.012121004820337e-02   +6.947926280945951e-02   +2.948367262139358e-02   +2.676034730709506e-01   +2.899480384314119e-01   +1.274597695910425e-01   +2.160480024096302e-02   +1.228040342405709e-01   -6.617041456455738e-02; -9.255074583632126e-03   -1.684093861253862e-01   +4.130936094424256e-02   +1.182532172345129e-01   -2.263782741711903e-01   -2.631189928823450e-01   +1.329993337206660e-01   +6.147346907730752e-02   -4.185345442006104e-01   +2.922007305933956e-01   +2.859268550018296e-02   -2.739865125722057e-01   +1.560042709117048e-01   +3.352957799959551e-02   +5.652386367556256e-02   +8.428688327623897e-03; +1.198692471592318e-02   -3.019582735353056e-02   +6.972469122074314e-02   +2.438972037212338e-01   -1.040388206935525e-01   -8.516269702086772e-02   -3.411657568884369e-02   +1.104668076937014e-01   +3.675665789913870e-01   +1.580673569719405e-01   +8.444746352447803e-02   -1.098153821136837e-01   +2.506512169985893e-01   +7.446106287004202e-02   -7.167549648911341e-02   -1.008506024225390e-01; +9.659702551483215e-02   +3.211121145962996e-02   -1.978695899339591e-01   -2.111919131142876e-01   +3.253557072362933e-01   +2.256763999885553e-01   -6.266160873143670e-02   +2.767025049273063e-01   -6.350677120249452e-02   +2.956290758938445e-01   -6.200712342648383e-02   +7.498201674711763e-02   +2.498211905094074e-02   +1.123869347131818e-01   -9.321021262590934e-02   +8.461404069911121e-02; -1.620276541670907e-02   -2.819325386711701e-01   -7.261416535698718e-02   -8.516167338451369e-04   -2.092235349929411e-01   -1.272047950057541e-03   +4.486189782511579e-01   -1.629433755332938e-01   -1.375135161416280e-01   -1.153688041638703e-01   +1.650135940890003e-01   -2.984880948079291e-03   +1.511117030887403e-01   +1.320612571334904e-01   -2.205542717080139e-01   +1.011097369774074e-01];
L2I_L1I_iGABA_netcon = [+8.156388769997347e-02   +1.742639848009648e-01   +9.974102991209610e-02   +3.757109472908849e-03   +8.996232364758305e-02   -1.190254976898770e-01   -1.233514357037535e-01   -9.687604634764849e-02; -2.175998622317953e-01   +1.221821586615727e-01   +2.475618759703735e-01   +4.232836384521119e-02   +5.342736562404480e-03   +1.475523722282006e-01   -8.546094701496350e-02   -9.396869646247440e-02; +2.020801308715267e-02   +3.762143734026505e-02   +5.931334884171397e-03   +2.564286963119594e-02   -1.719770369182078e-02   +1.141741638849589e-01   +8.580315983274096e-02   -3.966707041093985e-02; -5.107687523267288e-02   -2.976188868785293e-01   +2.125579724929552e-02   +7.915593254161277e-02   -1.164756234643214e-03   +1.677645227323821e-01   +1.756913053548053e-01   -2.358159860675247e-01; -1.253821141081203e-01   -2.412151523945103e-01   +1.346908985549733e-01   +7.984744010767955e-02   -2.772749205447610e-01   -2.265324459146912e-01   +2.138536095519909e-02   -2.917311568058079e-01; +1.163612232101742e-01   +7.751515280698903e-02   +1.595992233723496e-01   -2.057448840800870e-01   -2.493293634094325e-01   +3.000213581180731e-01   -2.174105707407878e-01   +4.554273254455073e-03; +1.241785935104218e-01   -2.766847544051870e-02   -1.019630385453174e-01   -2.666789533095609e-01   +1.226767290841586e-01   +1.544024480542447e-01   +8.289520694201878e-02   +7.350992883862431e-02; -1.991371420886362e-01   +1.158564399842259e-02   +8.258839306176943e-02   +1.221281731255015e-01   +2.672345180385861e-01   -1.326943528483057e-01   +1.125668338552782e-01   -2.046208967520340e-01; +5.011530210719375e-02   -7.594708937997383e-02   -1.090736662311383e-01   +6.910875675334525e-02   -9.426794202668362e-02   +1.257170177598454e-01   +3.845142081070610e-02   +2.026080093103262e-01; -2.170423820356544e-01   -4.955643728457436e-02   +1.468155231120418e-01   +1.442097903535507e-01   +1.503898362350489e-01   +2.377965529014106e-01   -7.810712173068504e-02   -2.974685185792484e-01; -2.084575965759999e-01   +8.391307792680932e-03   +1.719131419323534e-01   -1.051944163130007e-01   +1.003956744324053e-01   -4.948349883943613e-02   -1.713016888027672e-02   +1.827489846887254e-01; +1.651756195232523e-01   +1.551661971779412e-01   +1.266276242870037e-01   -2.972452192174142e-01   +1.544973046475091e-01   +2.008254700441944e-01   +4.187307044381391e-02   +2.751090036213671e-01; +6.673932337546838e-02   +2.255310303004091e-01   -9.146915019623619e-02   -1.641127160658184e-01   -1.186096678588359e-01   +1.982344036157937e-01   -2.958528399739500e-01   +1.317739960490024e-01; -1.735067028985166e-01   -2.993836659962762e-02   +1.348365817775845e-01   +2.192806435617249e-01   -1.539341885379416e-01   +5.894345983021991e-02   +8.731395710267520e-02   -1.053958097092917e-01; +2.086769565365320e-02   -1.028019017527372e-01   -3.745242749807520e-01   +5.930372267565459e-03   +1.173795602838361e-01   +1.121423393310008e-01   -7.866027097210787e-04   -5.390599273398808e-02; -6.347596515300535e-02   -5.356153988286573e-02   -1.546580171585258e-01   +9.934899431366422e-03   +3.885656649840824e-02   +1.053120050744549e-01   +1.723412014887614e-01   -1.836204084428887e-01];
L1I_L2I_iGABA_netcon = [+2.453095123335035e-01   +5.138312862151425e-02   -1.388517713958534e-01   +1.406691861463355e-01   +2.493363389296874e-01   -1.784909323811786e-02   -4.405206040744253e-02   +8.720929148122693e-02   -1.147175021520127e-01   -7.154161653189517e-02   -6.681941073037713e-02   +5.594621384527638e-02   +2.274157305314105e-01   +1.385888074236601e-01   +1.015734683152482e-01   -2.384790089356466e-01; +6.714320677087432e-02   +2.944166484961319e-02   +1.939072377364565e-01   +2.659977185393899e-01   +1.634884984900250e-01   +8.551787272866260e-02   -4.613344698790534e-02   +2.780549881907095e-01   -1.107037073540930e-01   +7.906315384964718e-02   -9.578542879452830e-02   +4.492479667438160e-02   +1.185781930481309e-01   -5.786216774181996e-02   -1.183727888789182e-01   -6.065439267883720e-02; +2.215151994142539e-01   +2.745661069514347e-01   +4.066192684381156e-03   +1.404135063511574e-01   -6.421887059812484e-02   +4.545572682010497e-02   +1.123845946099430e-01   -3.019663358291927e-01   -9.219025541688683e-02   -2.365333022715975e-01   -3.317827025542204e-01   -2.428979405511255e-01   +2.165816721074335e-02   -1.650171886560984e-01   +9.948842304574565e-02   -3.336814724298130e-02; -4.853300587393965e-02   -1.690190041131538e-01   +3.567504503930287e-01   -1.723729258852663e-01   +1.311995035101053e-01   -3.487345012076072e-01   -2.546086188932935e-02   -2.484803928406887e-02   +2.024805345342083e-01   +1.053204183753305e-01   -2.572894127142187e-01   -1.568220208581961e-01   +1.299153333954442e-01   -2.105788727299708e-01   -2.676997467528088e-02   -5.596876974209469e-02; +1.389533613182527e-01   +2.445139657295296e-02   -2.153537818032546e-01   -1.961058484172260e-01   +1.436297050238412e-01   +9.937546267783492e-03   +9.811173467227953e-02   +3.835325240630722e-01   +1.080775586801837e-01   +2.135344838573514e-01   +4.168006312982000e-02   +2.489273883348077e-01   +3.396072971491919e-02   -1.487072935008840e-01   +2.202758879039556e-01   -1.442603814104258e-01; +1.144464001187621e-01   +3.094488569515575e-01   +2.185566634573304e-02   +3.008497044173720e-01   +1.453125994949681e-02   +4.656955103649017e-04   -1.233982665407400e-02   +2.234573100123671e-02   +5.366957266254217e-02   -9.439687651988579e-02   -1.901595828833212e-01   +8.865353970682789e-02   -8.573188643813824e-02   +1.118104906306222e-01   -1.263694791247185e-01   +7.621286545393130e-02; -1.551426169961529e-01   -4.167223747013087e-02   -6.243913479155348e-02   +9.201710529470736e-02   +7.935448062172931e-02   -1.256124113208389e-01   -1.583755356372295e-03   -1.148612069154502e-01   -7.699347205502155e-02   +6.795176066536583e-02   +1.009021664999698e-01   +8.463994215694381e-02   -7.967437554335968e-02   -1.362007276528163e-01   -3.779363785806402e-02   -1.513731618602563e-01; -3.475526410335071e-03   +6.871073711954902e-02   -8.674051095618864e-02   -1.460435170316582e-01   -1.348256711563961e-01   -1.661695370873602e-01   -2.230669252749984e-01   +1.305763597552906e-01   +3.321109878016165e-01   -4.637757010403108e-02   -1.633769542271446e-01   +7.223738947380656e-02   +3.215449053737092e-01   +1.150222684161609e-01   -3.668480088403653e-02   +1.309389934953865e-02];
L2E_L1E_iAMPA_netcon = [-1.847131221997486e-01   -2.592510506533816e-01   +1.163829962212786e-01   -2.111005202299427e-02   -1.239578189646938e-01   -1.915048658697211e-01   +1.601700461212530e-02   -1.137260357334432e-01; +1.644678785466199e-01   +4.261955739392212e-02   -1.213398849721577e-01   -1.541452181225972e-01   +1.954898190395044e-01   -1.350254894978238e-01   +1.178391200196210e-01   -1.875391389136967e-01; -3.308510983384065e-01   +3.045412521752631e-01   +2.577331799468138e-01   +2.130504167103049e-01   +1.016071157680186e-01   +1.819237359194466e-01   -2.518032311981448e-01   +4.006559173531634e-01; -2.045372913377724e-01   +2.181859139351584e-02   -7.869422542764731e-02   -5.313271674590161e-02   +3.617218936020515e-01   +3.258689067393922e-01   +1.400957185694015e-01   +2.796168700288821e-01; +9.865950987316802e-02   -1.427953735526286e-01   -5.121867977679184e-02   +1.167304357902532e-01   -2.364822444413751e-01   +1.398149608076180e-01   +8.192779130042837e-03   +5.056445783444059e-02; -4.819038337773063e-02   +1.847562983122651e-01   +2.399271018353719e-01   -7.189278265498714e-03   +2.820865042638062e-01   +1.996810758221915e-02   -2.235882624873344e-01   -1.988688576032465e-01; -1.999571180322522e-01   -1.857167412358075e-01   +1.487585044494071e-01   +1.963586587918182e-02   -4.127261250647628e-03   +1.707361991251997e-01   -1.456842900645032e-01   -2.117759186507910e-01; -7.670305988375747e-02   -1.969246764850490e-01   -6.449173066968074e-02   -2.901404842176449e-01   +1.540201467148962e-01   -2.756362239973814e-01   -4.587201565628017e-02   +1.733422955129530e-01; -2.091770715287700e-02   +7.707934946985279e-02   -3.913479640785373e-01   -2.565768938005244e-01   +2.159133779768058e-01   -6.473935582775915e-02   +2.086014114996998e-01   +2.186392467575052e-01; -1.929845765917245e-01   +1.862719850820104e-02   +4.589647378954240e-02   +7.474134063886194e-02   +2.835149117344862e-01   -1.554167708427094e-01   +2.171350780674800e-02   -9.020141462791384e-02; -8.209633444532335e-02   +2.488902267454240e-02   +3.282413971673799e-01   -6.806404612073440e-02   +3.170432246387313e-01   +2.862651206890068e-01   -1.087660904700779e-01   +1.070113213733202e-01; +1.237067680799771e-01   +1.966418674372996e-02   +2.686668412090261e-03   +1.346421968030397e-01   -2.494137574660204e-01   +1.433929347739070e-02   -1.174875027896895e-01   -2.223851016686543e-01; +2.989690708157797e-02   -2.485687781144758e-02   +2.531149333010276e-02   -8.260780555654737e-02   -2.618437135612661e-02   -2.293639388393189e-01   +2.410345556737901e-01   +8.540734375179125e-02; -3.363989254929509e-01   -1.734455614998404e-01   +4.426399143991500e-02   +1.868843706459843e-01   -4.520123490287312e-02   -6.222176563885769e-02   +6.502092784522306e-02   -1.458949500121446e-01; +1.722032835870684e-01   -1.452683998100444e-01   +3.723860929355696e-01   +2.692378695196158e-01   +1.609327719765898e-01   +5.986593862001947e-02   -9.207836167643468e-02   +2.009065621431391e-02; +7.529654677259891e-02   +1.473275535463625e-01   -7.737715116598264e-02   -1.219551952189517e-01   +1.103931032577172e-01   +2.835740065417234e-01   +1.994051166626914e-02   +2.349544488555866e-01];
L1E_L2E_iAMPA_netcon = [+1.057156238685574e-01   -1.705730310992040e-03   -1.969461226867341e-01   -2.124117569425779e-01   -2.889330977807461e-01   -1.474197026154083e-01   -5.672835457258151e-02   -1.726350460759560e-01   -9.407591445463348e-02   -2.244151247288701e-02   +8.534039862420670e-02   +2.034893151022234e-01   -5.798908668247793e-02   -1.130372218533599e-01   -3.240169022946598e-02   +8.964517251053236e-02; -6.255671546450892e-02   +1.928772745825271e-01   +1.407993361618127e-01   +2.300131519420864e-01   +6.774718670026889e-02   -2.009012959107395e-01   -6.908054173718846e-02   +1.959572109503418e-01   -1.184139954344929e-01   +3.566960997608069e-01   +3.706493268987778e-03   -4.333007305382045e-02   -3.519284915489490e-01   -1.588761326612377e-01   -1.212703058912390e-01   +6.089707197813807e-03; -4.533922698374324e-02   -3.590120759917007e-01   -3.526433319681891e-01   -1.385891333359917e-02   -2.857149744270836e-01   +3.959070904335692e-03   -3.236617231380193e-02   -1.861530544731810e-01   +5.025760374980023e-02   -1.916654449812807e-01   +1.291984090241955e-01   +1.926651008784139e-01   -2.443373630205153e-01   -2.083018157598820e-01   -1.369316440462028e-01   -8.225634966882231e-02; +1.341258645329770e-01   -3.596401916014802e-02   +2.299176811819088e-01   +2.210193603207497e-01   -3.413478545075179e-01   +2.494037683333351e-01   +1.554939679468764e-01   +6.386126031306624e-02   +7.514214749651160e-02   -1.451701468912164e-01   +4.460324656244858e-02   -7.399644965644571e-02   -2.692387208566119e-02   +6.154616409769105e-02   -3.241232314783730e-01   +2.187698011360046e-01; +3.200305774683111e-01   +3.933664381297053e-02   -1.052298169464932e-01   -1.243469825186017e-02   -7.628446083733159e-02   +1.538574256498351e-01   +5.788322593604258e-02   -3.449586743190821e-03   -1.144706629373930e-01   +2.221047222964970e-01   +2.333250349485702e-02   -1.921114048661923e-03   -1.077635961990461e-02   +3.404722122992812e-01   -3.126958012083196e-02   +1.151170396167298e-01; -1.716033293405581e-01   -1.080534626497250e-01   -3.384436418891137e-02   -7.747076048184958e-03   +1.275389607586934e-01   +1.650081531147240e-01   +2.151317235093735e-01   -4.828040524437215e-03   +2.066210321402334e-01   +1.448904494307602e-01   +2.588031917853122e-01   +5.180472311665896e-02   -3.382337863546658e-02   -8.863629390257713e-03   +1.336492245106738e-02   +5.139486810960126e-02; -2.187772892312560e-01   +1.397832654174554e-01   +2.636141840932226e-01   +1.855306778418611e-01   -1.679053716320310e-02   +9.592778725670617e-02   -7.216059449680175e-02   -5.324724942434887e-03   +1.626335426545351e-01   +9.626803007243140e-02   +2.485963809338969e-01   +4.494401807906580e-02   +1.059839694738838e-01   -2.634468434739022e-01   -1.897368324386235e-01   +2.974330556664584e-02; +1.371729335222547e-01   -1.657602886851549e-01   +6.424491838387332e-02   -1.662421975754365e-01   +1.532319513432155e-02   -1.842118309046461e-01   +9.824823126152782e-02   +8.216804062549282e-02   -9.386781564212249e-02   -1.174522536546433e-02   +2.688128566039082e-01   -1.442625016198925e-01   -1.868929645605260e-01   +6.940917205748429e-02   -3.367519360019612e-02   -9.893610390389315e-02];
L2I_L2E_iAMPA_netcon = [+9.290555698440882e-02   +3.180654295483678e-01   +2.024691302782003e-01   -1.788482824303114e-01   -2.763912721109696e-02   -4.431712586938964e-02   -1.064996853636839e-01   +2.121296890707561e-01; +2.950837608728431e-02   +1.864357347961495e-01   -2.966454377822372e-01   -1.659892001442104e-01   +2.829570474136529e-03   +1.094376505133052e-01   +1.893490093937176e-01   -1.506270086673483e-01; +5.797660912956103e-03   -7.709316386009869e-02   -1.583791853529557e-02   -2.312296015278737e-02   +6.573788774444320e-02   +2.016205628145760e-01   +2.512944772865870e-01   -8.574746236178002e-02; -3.717859631330905e-02   +1.958203865483772e-01   +8.222440583785696e-02   -1.727185386313438e-01   -8.985084256311629e-02   +1.334772634826592e-01   -1.141368429769657e-01   -2.191967123975544e-02; -2.129323325133719e-01   -1.925790239321032e-01   -2.081442310549581e-02   -1.455032466304422e-01   -7.211901176281590e-02   -1.537250048167010e-01   +4.100600547127521e-02   +3.478396687059709e-01; +1.908427202454998e-02   -8.945944338665145e-02   -9.677292024247197e-02   +1.013684005516229e-01   +6.130536030241800e-02   +2.465339544939005e-01   +1.400457934318919e-01   -2.362968680224913e-02; +1.915456801201332e-01   -5.499798921758540e-02   +7.281062012855274e-02   -1.134801454966566e-02   +3.351942711807297e-01   -1.253251781246261e-01   +2.514935565400437e-02   -1.152261059921807e-01; +1.111009987377961e-01   -7.663148920229318e-04   -2.292139389171094e-01   -1.318746499657667e-01   -2.327431125710907e-01   -6.328401033279316e-02   +1.513410028133727e-01   -1.023523249327099e-01];
L2E_L2I_iGABA_netcon = [+1.077610167163036e-02   +5.241190599302721e-02   +3.148588509074503e-02   -2.815904292906951e-01   +1.918417892547263e-01   +1.222772631130197e-01   -3.485270538680687e-01   +1.903792010762876e-02; -2.827962070444642e-02   -3.491818110145509e-02   +3.157569351600045e-01   +2.490382337296556e-01   +1.333654386304511e-01   -1.287963760785431e-01   -3.835659384110699e-01   -1.921302725409806e-01; +2.160351905311463e-01   -1.123805728835422e-01   -1.956236722245094e-01   +1.204684263479678e-01   -1.530646603859427e-01   +2.106958700424070e-01   -1.544815062484056e-01   -1.515128968179526e-01; +1.144230976685827e-01   +5.118609344910278e-02   +4.873541613570496e-02   +1.221859650182943e-01   +7.011033697303445e-02   -5.226197824127037e-02   +6.073237985109867e-02   -2.841298601496747e-01; -1.459959752564144e-01   +3.323866816395742e-01   +4.473968367515917e-01   +5.019166094133835e-02   -1.530076781736703e-01   -1.841363989525758e-01   -2.140185862891691e-01   -3.258458361601282e-03; -1.766304917996463e-01   +1.511986079835355e-01   -9.667319685104817e-02   +2.444591826038280e-01   -7.830280312989318e-02   +1.368869728739574e-01   +4.785000828080099e-02   +2.263245952748425e-01; -8.047249579702698e-02   +5.978569318994454e-03   +1.329086207344288e-01   -3.462202969663588e-01   +3.666506601257966e-02   -1.118226024604006e-01   -2.643374424453181e-01   -1.742251792299895e-01; -1.687452517173721e-01   -1.575985319698535e-01   +7.264170662939633e-02   -1.478236669233045e-02   -2.330627662552049e-01   -6.788831220776021e-03   +1.866259734151371e-01   +1.870899133783441e-01];
L3E_L2E_iAMPA_netcon = [+2.926046468219252e-02   -8.979719183035105e-05   +1.189382759938418e-01   +1.341626803270844e-01   +1.990318020814754e-01   +1.341175190907825e-01   -1.413649419736922e-01   +1.299293284982075e-01   -2.213834147750746e-02   +1.994801995605801e-01   -1.638629215360152e-01   +2.780524512479762e-01; -1.706857246196884e-01   +1.620701773497195e-01   +2.183616711682915e-02   +7.997561682845704e-02   -1.082263354317395e-02   +9.906681337833961e-02   -6.606075076614246e-03   +2.960543553644648e-02   -1.745325342935226e-02   +1.353591039577306e-01   +1.790967052702520e-01   +2.864273125041841e-01; +5.093031618816542e-02   -9.249321797501067e-02   -1.639982365276936e-01   -1.251365027535469e-01   +8.899632537075114e-02   -1.519366162104208e-01   +1.230305723246486e-01   +1.232069700283895e-01   -3.664134821349956e-01   -1.701117439738788e-01   -4.527806340330315e-03   +3.685517677938163e-02; +3.158665265212943e-01   -1.534429886032518e-01   +3.428876614586802e-02   +7.914240419905944e-02   +8.160639601489605e-02   +1.684689705627463e-01   -1.231157893339919e-01   +1.682423001233242e-01   +1.914505530088549e-01   -5.486311068242783e-02   -2.252510653882953e-02   +3.517223360259984e-01; +1.138469605321415e-01   -1.351832965931577e-01   -2.650745780715891e-01   +2.427715615906374e-02   +1.144551264483059e-01   +3.894585237070860e-01   -6.741839227757379e-02   +1.168310443322629e-01   +8.470990864223496e-02   -1.285277757628627e-01   +1.808367501116897e-01   +6.850490600664674e-02; +1.774973650500100e-01   +9.558878373811663e-02   +3.150371154851486e-01   -2.018978073550070e-04   -2.851645001796355e-01   -3.796989585086339e-02   +7.412131257253800e-02   -1.804147316511372e-01   +4.092926096046400e-02   -2.139221105717718e-01   -5.551028071984150e-02   +8.816855499446609e-02; +1.741288044131835e-01   +2.113419814084563e-01   -9.971001897366022e-02   -1.845071714573341e-01   +2.045778421801160e-01   +1.334677042644861e-02   -5.394420128100562e-02   +1.500597230037462e-01   +9.471366934838853e-02   -3.239949835659179e-01   +1.020188890304909e-01   +5.868350975387577e-02; -8.579798479555779e-02   -1.607684755511087e-01   -1.238393723333571e-01   -1.832017743324454e-02   -4.258709135370092e-01   -1.606980645319903e-01   +9.123891206862700e-02   -1.742008745575007e-01   +2.899551871725413e-01   -1.644181189420607e-01   -2.850311906400689e-02   -9.325644997909996e-02];
L3I_L2I_iGABA_netcon = [-2.206172717910645e-01   -2.860471041708889e-01   -2.651567657288094e-01   -1.317908372785558e-02   +8.859236461706801e-02   -4.906347896936826e-02   +2.178937744843679e-01   +6.189003318159225e-02   +1.511651690298252e-01   +2.783839699024919e-01   -2.770134101095661e-01   +2.492015685504441e-01; -7.842049661627162e-02   -7.958520714553151e-02   -1.448156508259378e-01   -7.543832616295490e-02   -7.358230024654051e-02   +2.599807294739307e-01   -3.670514081990013e-02   -1.025056220727763e-01   +2.079502800800212e-02   +3.122013562976164e-01   -1.817131617547827e-01   +3.570659040485724e-01; -1.258025833918061e-01   +1.361435471604813e-02   -1.618365017678270e-01   -3.496534830026385e-02   +3.968385137624459e-01   -2.288186259061361e-01   +6.930136763981679e-02   -1.027551357780904e-01   +1.915623250504743e-01   +1.776171545472358e-01   -8.981470453466101e-02   -2.030364886019330e-01; -2.225155572522008e-01   -1.400679938958134e-01   +7.193666695457743e-02   +2.706548734801738e-01   +6.111535053152652e-02   -2.755951153975093e-02   -1.218798926252700e-01   +2.185624923490944e-02   +6.795410613156715e-02   +2.281111484226245e-01   -7.168771620119230e-02   +1.974286853539320e-01; +4.037079094466859e-01   +6.457926292653676e-02   +5.708090426080617e-03   +1.783500477481368e-01   -1.857766828663795e-01   +2.468515578025532e-02   -2.359657868573666e-01   +1.509091373891843e-02   +1.193374510714510e-01   +1.720710124093144e-01   -1.272686917261421e-01   +5.842403676737934e-02; +3.984785235959534e-02   -2.370770958638627e-01   -2.174935088422342e-01   -8.791942548690679e-02   -4.863420041536257e-02   -1.563636088481831e-01   +2.059027146901785e-01   +2.685012652286106e-01   -5.043837225136823e-02   +6.192170206015413e-02   -3.919390755032651e-01   +2.147580587397167e-01; +2.537796729743399e-01   -1.546864125764186e-04   -2.887395425043736e-02   -1.117185530038761e-01   +2.377978849106635e-03   -8.458562036014389e-02   +1.002903017356783e-01   +8.627749805461260e-02   -2.259680822765744e-01   -1.595578097594187e-02   +2.977686195110640e-01   +2.472291314524085e-02; -5.192691484151097e-02   -1.563121475199438e-01   -2.730295469318788e-01   -1.099986911524964e-01   +2.722832115640110e-02   -1.115062399170258e-01   +1.623114510277332e-02   -1.026484888994316e-01   -1.055933510742466e-02   +5.594966197396573e-02   -3.525442657635460e-01   -1.437807122663604e-01];
L2E_L3E_iAMPA_netcon = [-8.193118730922871e-02   -2.968972269890815e-02   +1.114704796216907e-01   +1.530099279127753e-01   -2.585868849227786e-01   +1.655648567547451e-01   +7.083808419792070e-02   -3.291577268290848e-01; +4.991172436849199e-02   +6.697850095322672e-02   -1.264992854060925e-02   +2.031095191035173e-01   +3.151388374739332e-01   +1.003476519315385e-01   +4.572189489466914e-02   +2.718739038619495e-02; -3.421609894585713e-02   +3.236763764243394e-02   +5.842125895006164e-02   +1.566014518310933e-01   -8.280463754768369e-02   -1.973768353796719e-01   +3.111293022485139e-01   -2.907827756799998e-01; +1.387528083387827e-01   -1.140879269608004e-01   -1.938647869056563e-01   -1.487036149679190e-01   -8.198626317339169e-02   +3.790166000823463e-02   -4.596999763836918e-02   +4.465672049547272e-01; -2.833820325149512e-01   +1.258417147931679e-01   -2.788086348344719e-01   +1.271013917349028e-01   +1.187978682388426e-01   -3.253228936880501e-02   -1.479919987503808e-01   -1.914057173261513e-01; +8.223685870862321e-02   +8.924319992108630e-02   +1.483520860989957e-01   +2.141853228287697e-01   -1.697802306271459e-02   -6.601179379527415e-03   -5.456917311837242e-02   -1.281012626167849e-01; +2.686247511121311e-01   +2.401234245162406e-01   +9.818828989684251e-02   -2.096573227971940e-01   -2.304399854690660e-01   -2.207565984034408e-02   -2.466115977401699e-01   -6.149404472805668e-02; -1.069463756301174e-01   +1.985198014818966e-01   +3.468023023784254e-02   -7.934499143022708e-02   +1.790469622310548e-01   +9.233466028572640e-02   +1.929744240910655e-01   +2.816419655132939e-02; +2.892096698522048e-01   -1.401817559376589e-01   +4.326691277578384e-03   +1.908235548685932e-01   +1.372673304366583e-01   +1.245804330504855e-01   -2.357261463459575e-01   +1.570579797789469e-01; +2.189081489385182e-01   +6.237363537700046e-02   +1.307628456998201e-01   -2.305151340249369e-01   -4.605213297043026e-02   +2.072439543738362e-02   +2.190503700949212e-01   -3.266453325889072e-02; +2.519115395835484e-01   -6.269411857487917e-03   -1.871858096013604e-01   -3.034060951883089e-02   -1.243018736378317e-01   -5.226279441158441e-02   +2.661494195514379e-01   +2.477810236279456e-02; +2.471595244446309e-01   +1.766806400847579e-01   -1.677310339666977e-01   -5.894195581835360e-02   -2.252551669980595e-01   -2.444635799472846e-01   +1.042327421144544e-01   -1.337588928090396e-01];
L2I_L3I_iGABA_netcon = [-1.799616828463258e-01   -1.993256540678859e-01   +2.699454552876039e-01   +4.315860065875510e-02   -9.092502720159491e-02   -1.128624530854351e-01   -7.030798453199663e-02   -2.664415933786592e-01; +4.168155776717165e-02   +2.191196969630392e-01   +3.224012681303867e-02   +2.045455848947391e-01   -5.322533246431640e-02   +3.749378425303865e-01   +2.298585279618524e-01   -3.394155136722328e-01; -1.006313017407742e-01   -3.102756123984500e-02   +1.371521793649847e-01   -5.692371321246275e-02   +1.550950303164798e-01   +1.020291478025751e-01   +2.287993397051235e-01   -3.183745044353418e-03; +2.251149735210089e-01   -1.737610256710171e-01   -1.120472942501150e-01   +1.725884395606082e-01   -3.129407908353689e-01   +1.616428617720286e-02   -1.999149774746519e-01   -1.322150914059697e-01; -1.343963866845056e-01   +2.570196082169774e-01   -5.407390946158423e-02   +5.958139853897305e-02   -9.919983379156497e-02   -2.441965360806580e-02   +1.446410583518541e-01   +9.449627580067085e-02; +6.187515047447535e-02   -1.361876066584435e-01   +6.019938412900295e-02   -2.743925652765473e-01   +2.150856994850366e-01   +2.474814153831723e-01   -9.946625789462513e-02   +1.507181163937082e-01; -1.997943229794021e-01   +1.081470338969346e-01   -1.640933811541492e-01   -3.749460954979856e-01   -7.973258597990068e-03   +1.338081779038550e-01   -1.945522269813016e-01   +1.278288032405911e-01; -1.919646018997886e-01   -8.837453793104123e-02   +3.997383048671174e-01   -2.475211493071783e-02   -1.133034273824469e-01   +1.767766102582106e-01   +1.388045421678229e-01   -7.862714051314530e-02; +9.736298216482950e-02   -2.893320823690754e-01   -1.167779254370663e-01   +1.435883713350036e-01   -3.397016152848258e-02   -3.308496206121853e-01   -5.907998848837887e-02   +1.195524716835296e-01; +7.802989774558353e-02   -4.544063260991225e-02   -1.348913441900802e-01   +2.881235832744287e-02   -2.065312700352441e-01   +3.472665535718373e-01   +8.851486198866498e-03   +1.035726723280150e-01; -2.066683946296132e-01   +4.040273232912224e-02   -5.404242758716345e-02   +3.419564848340322e-02   -1.292821683525395e-01   -1.170668194922782e-01   +3.881049634208974e-01   -4.044323283793361e-02; -1.360205566084753e-01   +6.601201594692106e-02   +6.314346581227272e-02   +1.954418857607991e-01   -1.753839421474190e-01   +1.723038389555203e-01   -2.002574580694431e-01   +7.661483802010330e-02];
L3I_L3E_iAMPA_netcon = [-1.625688976277957e-01   +1.682471582405865e-01   -2.757889208194760e-03   +1.803372453080476e-01   -1.471420983255933e-02   -1.759643413649248e-01   -1.715233753345066e-02   +1.520348795961569e-02   -6.774385062107009e-02   -2.993019404549495e-01   -1.970521244991940e-01   +3.684917635961224e-01; -6.371154063120918e-02   -1.375172643843320e-01   -1.715971616604551e-02   -2.080118026264341e-01   -1.771344956137196e-02   -2.185203104724720e-01   -6.853580998041418e-02   -2.086936852777473e-01   -2.644403528870555e-01   +1.535898857110159e-01   -9.521250892285431e-02   +3.079911604406178e-01; +2.122735254626667e-01   -2.052217835251599e-03   -1.449838802461125e-01   +4.495497262611632e-02   +1.471075976581223e-01   -8.350648982111666e-02   +3.875973447005952e-03   -1.092016213797242e-01   -2.172529902194383e-01   -7.895736939729202e-02   -5.454523362834286e-02   -1.757930481136226e-01; +5.394273287719873e-02   +1.446902319247232e-01   -1.233679970073526e-01   +3.339266391245762e-01   +2.255190670976396e-01   -8.592960953563811e-02   -1.584553470513282e-01   -3.827613463591362e-01   +1.205365300203756e-01   -1.892222888321807e-01   +6.975643572076942e-02   +5.224824233706715e-02; +3.116867327357485e-01   -1.093055525868333e-01   -2.445162004859409e-01   -5.690304589583227e-02   -3.381929599337823e-02   +4.020509929163938e-01   -1.948470284071380e-01   +7.577679733656346e-02   -5.886462863190365e-02   +1.616541551315151e-01   +6.873612371921295e-02   -2.809208515778362e-01; +5.723430497633256e-03   -2.353927501032124e-01   -2.325909061118161e-01   +1.341624117486560e-01   +1.041466137188728e-01   -1.143076696869257e-01   +2.744836218422457e-01   +1.225011551956858e-02   -2.071025492049597e-01   -2.017100583537793e-01   +1.699586888563377e-01   +2.680535411945154e-01; -2.177130104484046e-01   +1.170969455343409e-01   -5.175878207993262e-02   -3.021846623883734e-01   -1.076816536638970e-01   +1.017834367434643e-01   +2.291925850085833e-02   -1.158899514663222e-01   +3.097506978219986e-01   -2.026306905401598e-01   +3.048679975823031e-02   +2.314120320989574e-02; +1.605941232260294e-01   +1.519586487688549e-02   +7.489124666441911e-02   -4.976889895282541e-02   -8.389653123356261e-02   -4.270048835990053e-02   +3.182988575908403e-02   +1.112306322969711e-01   +4.449565011209732e-02   -1.736425102270867e-01   +2.716837643382191e-01   +1.760577595435611e-01; -9.403105914145929e-02   -1.543233234347279e-01   -3.005844026767008e-02   +1.555497850821992e-01   +1.364464060905742e-01   +2.173102720597307e-01   +4.590142834101693e-02   -3.989839365689268e-01   +3.277841900811085e-02   -1.504451195826781e-02   -5.282315058630703e-02   -2.251004752049974e-01; -1.027715833453608e-01   +1.237543045407848e-01   +6.567305037394169e-02   +5.892909971255245e-02   +4.330445087743564e-01   +2.734784335452292e-02   -1.577942112255801e-01   +5.506575155599975e-02   +1.443007396123282e-01   +4.850878661788338e-02   +1.651380578462444e-02   +3.110363461249171e-01; +3.121890552777354e-01   -2.198012806621344e-02   +6.284334238446576e-04   -2.304797232306299e-01   -8.308816386140896e-02   -1.376848057119569e-01   -1.109237531126895e-01   -2.227881952928515e-01   +1.762817641474091e-01   +2.884283632198982e-01   +8.225072558088270e-02   +9.502244077739069e-02; -1.781474407031935e-01   -4.280585323037189e-02   +3.627619688744890e-01   -9.398894088370691e-03   -2.250805644300367e-02   +8.520903940738464e-02   -3.874709645243152e-01   +8.594456048136709e-02   -8.051603691042172e-03   -1.048382373863555e-01   -9.522357879687100e-02   +1.604096626116455e-01];
L3E_L3I_iGABA_netcon = [+1.306368869243903e-01   -3.933584051821599e-03   -2.065738855350114e-01   +5.737458352851525e-02   +5.854467048092599e-02   +8.503635532126869e-02   +1.794342397696705e-02   +7.947604807386086e-02   +1.352605118310213e-01   +6.969399276321370e-02   +3.996941750766379e-01   +1.233809270908780e-01; -2.845343208425426e-02   -9.958892727507532e-02   -2.321621952867593e-01   +5.569415246793340e-02   -3.309119495840428e-02   +1.086487746755999e-01   -2.191195886788386e-01   -1.734993024281655e-01   +3.651173369118765e-01   +3.827906203753874e-01   +9.668179319696955e-03   -3.188915371581419e-01; -3.079465254447334e-01   -1.986945522822539e-01   -2.634348673647831e-01   +1.155811652397666e-01   +2.023349790443154e-02   -2.691957321646832e-02   -1.088852073359807e-01   +4.266864002091018e-03   +9.075480132396177e-02   +1.692067358996751e-01   +1.487790364600117e-01   +4.207709717918227e-01; -6.620131578139965e-02   -1.870346381812162e-01   +1.019504475521289e-01   +1.248839374201299e-01   -1.514972972802078e-01   +2.167208623514032e-01   -1.441615679927102e-02   +3.649912735759724e-01   +3.899164262425034e-02   -5.383682928977160e-03   -1.016615641742248e-01   +1.072213176549073e-01; +7.067228998557953e-02   +1.005700611358425e-01   -1.310723120785661e-01   -4.424203613046541e-02   +1.568869927734811e-01   +7.888166228920770e-02   +1.165817363213666e-01   -3.058014722182392e-01   +1.016277402664522e-01   +8.690155014159364e-04   -2.612716982909996e-01   -7.048057187093770e-02; -1.388409578656073e-01   +1.066973921351150e-01   -3.613206612470178e-02   +2.637136315711066e-01   -1.268769803534914e-01   -2.007925900034387e-01   +1.930841825762027e-02   -9.628857637611644e-02   +1.530016557067748e-01   -1.264754013209969e-01   -1.170443146806460e-01   -1.078862542042715e-02; +9.802103981739116e-02   -1.782254607714057e-01   -1.195829408361715e-01   +6.535230814513286e-03   -3.138640489848631e-01   -1.616717398576138e-01   +1.204896840071425e-01   -1.125311761457787e-01   -1.028793618616575e-01   -7.030217321858925e-02   -8.163483897175980e-02   -1.467456820323169e-01; +1.717557779506646e-01   -1.319195059282104e-01   -7.938849787007977e-03   +1.450148949628166e-02   +1.870586368017742e-01   -1.464794116339416e-02   -1.069077247943320e-01   +1.966976793740324e-01   -1.922067187084703e-01   -1.210902663538224e-02   -1.677415245396763e-01   -8.983864752446030e-02; -5.784875135399428e-02   -9.834630877144897e-02   +1.066218378160504e-01   +5.136338751182851e-02   +1.312605289966351e-01   +2.055364700189528e-02   +1.257932866315551e-01   +8.542798565425877e-02   +1.166532203927489e-01   +1.520326032218839e-01   +2.444103083773956e-03   -2.540904809495415e-01; +1.628739490822275e-01   -3.671393677757516e-01   +4.322875705750094e-02   -1.922871381946877e-02   -4.266245830981462e-02   +2.532854279478087e-01   -3.822610648885335e-02   -1.573031024129503e-01   -1.381162777397514e-01   +3.933818739841263e-02   +1.957100376098166e-01   +1.894819287272301e-01; -1.783343061136747e-01   -7.096699060654946e-02   +5.949939592965700e-02   -6.426141862640253e-02   +1.577038362323193e-01   -9.894667522182773e-02   +1.030414825786822e-01   -3.212018920676293e-01   -1.545053396891322e-01   -1.487536477617061e-01   +1.933301786208888e-01   +1.217314497078039e-01; +2.761786853017593e-01   -7.791929188535077e-02   +8.765613906736427e-02   -2.233984507675897e-01   -2.647976248536696e-02   +8.564259680914776e-02   -1.838846750028653e-01   -1.158498237998433e-01   -6.458949745663012e-03   -1.351444687298515e-01   +6.819820150476387e-02   -2.256245355240375e-02];
L2E_Input1_iAMPA_netcon = [+7.984751251745293e-03   +3.962267391890310e-02   -1.955630953661369e-01   -1.045990151220141e-01   -9.774203049626644e-02   +7.314494053859736e-03   -1.005083442287115e-02   -7.217208343675466e-02];
L2I_Input2_iAMPA_netcon = [+8.897787532113317e-02   -1.814661763747307e-01   +2.495661047690927e-01   -6.639905525051423e-02   -2.364193062353049e-01   -1.270753066487139e-01   +7.415619202194897e-02   -1.741913159099224e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
