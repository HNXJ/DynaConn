function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.768756335125148e-01   -2.030908681264353e-01   +1.458444770874971e-01   +8.103864734534422e-02   +5.158123836650216e-02   +4.981352692195237e-02   -7.735767706339600e-02   -3.545207094222155e-01   -5.082968202395028e-01   +1.555933906819835e-01   -1.955822572561481e-01   +7.099826337448770e-02   +1.510445213899471e-01   -1.077721626166966e-01   -6.903574488286143e-02   -5.020960250860631e-01; +2.334537944507450e-01   -1.900913117081356e-01   +3.954148980054707e-01   -2.832297309505762e-01   +1.491349113098993e-01   -1.589640633395589e-01   +1.101254758796352e-01   +2.914053636992815e-01   +2.308027814730504e-01   -1.364610264543893e-01   +1.366191645005192e-01   -2.371770911265054e-01   +1.281371283575548e-01   +4.014562479936087e-02   +4.788681681720324e-01   +4.526223728267679e-01; +1.490057792950630e-01   -4.410641144923329e-02   +1.728847128217534e-02   +9.763019939088734e-02   -7.711874549485724e-02   +2.112152709719528e-02   +9.575582911824211e-02   +2.903014901249070e-01   +1.793202759342606e-01   -1.353627406870560e-01   -1.524281250777373e-01   -9.339057296240619e-02   -5.748046321483860e-01   +2.347982139529937e-01   +2.653655424842480e-01   -7.546510018725647e-02; -3.397861134399520e-01   +6.296953382469600e-02   +4.215861846142591e-01   -7.126235633700989e-02   -1.597487077376031e-01   -2.353311200546784e-02   +3.773751089144861e-01   +5.050666811718185e-01   +3.174993511959878e-04   +1.375963387296646e-01   -1.732210859598554e-01   -2.505184744069025e-01   +2.018304618417937e-01   +5.053176413764829e-01   +1.873037933889827e-01   +2.828803550095687e-01; +1.293764049020855e-02   -3.338521638171407e-02   +3.919479812536887e-02   +3.907652422137864e-01   +4.583566098240774e-03   +2.895634121380529e-01   -1.150587111592070e-01   +3.822012362388634e-02   -1.126592792073066e-01   -8.777351280252477e-04   -2.804317787356821e-01   +1.455603777165408e-01   -2.067533412731646e-01   +2.953623764488975e-01   +2.085458769122626e-01   +1.736494068699203e-01; -2.409702135208673e-01   +9.036344744467494e-02   -4.942918967072145e-01   -1.144320713166641e-01   -3.265004221268010e-01   +3.497025308721766e-01   -2.322373229845649e-01   +1.311173386878721e-01   +4.306756693398315e-01   -9.916878356466236e-02   -5.902578634655591e-02   +1.889731072167099e-01   -2.196536871294848e-01   +3.088810419456250e-01   +4.143979226053253e-01   +1.930116007744901e-01; -2.809958609608470e-01   +1.221841060014852e-01   -2.222664723492875e-02   +1.940421042419768e-02   +1.233022697615870e-01   +9.076033482167074e-02   +5.482438045917346e-03   +1.408445620376728e-01   -3.725900183526121e-01   -3.408309116358679e-01   -1.609985843186531e-02   +1.270894175361247e-01   +5.262022832933111e-01   -1.583267606794411e-02   -3.577212963663468e-02   -4.386486587594765e-01; -3.565458303780521e-01   +1.206830642039615e-02   -1.070162010327875e-01   +1.557078688584079e-01   -1.008410620668545e-01   -5.839543263821925e-02   +1.818722500966531e-01   -7.477558093280172e-02   +1.911316288031395e-01   -2.928131147664780e-01   -4.490564637250941e-01   +5.954812260757535e-01   +4.059714431448449e-01   +9.735110478876664e-02   -2.970676770687921e-01   +3.348355613770087e-01; -2.130711094323756e-02   +8.057221020674177e-02   +1.217764609389416e-01   +1.505710667182905e-01   +1.323275381704960e-01   -1.943295917333654e-01   -2.568011552869938e-01   +1.866219173369753e-01   -2.532241915164932e-02   -1.921435602610422e-01   -2.127749318913772e-01   -4.630834570148434e-01   +1.402423240730123e-01   -2.762811147454784e-02   -2.467984762314890e-02   -1.437570610884241e-01; -1.299222255294910e-01   -2.495541816133407e-01   +6.986899204980200e-02   -7.100198719061152e-02   -1.908426829327567e-01   -5.793595489735931e-03   -2.240253699419066e-01   -4.955275396913771e-01   +1.716790608188344e-01   -2.093742097611955e-01   +2.851706512551562e-01   -3.208267260593665e-01   +4.572411301536367e-01   +3.036611068590655e-01   -2.955454967602283e-01   -5.419160723721386e-02; -9.785350550204178e-02   +2.981602251141076e-01   -3.733792009294088e-01   -7.101840071156723e-02   +1.447443807147457e-01   -1.241369223849064e-01   +3.906521152277024e-04   +1.496616288518357e-01   -1.479019404454003e-01   +1.386906080338061e-01   +2.995024992562774e-01   -1.755716993461724e-01   +2.837657949666123e-01   -2.616993367822207e-01   +2.915122936186481e-01   +1.148934070027526e-01; +4.571725476207243e-01   -1.398195558765230e-01   -2.870758755716862e-01   -1.969594009578206e-01   -5.425042128379529e-01   -8.604617828240363e-02   -2.872776827243576e-01   +8.629243848196316e-02   +2.665826601388566e-01   -4.012219895015254e-02   -1.264593434482352e-01   -8.282400790636525e-02   +1.827849832664674e-01   -1.138996164051295e-01   +2.127567053378400e-01   +3.101878397105909e-01; -9.339723299985904e-02   -1.222382784117148e-01   +5.544716130200883e-01   -3.500156610229659e-01   +5.583173980137635e-03   -7.535731756154071e-02   +5.045614031811091e-02   -1.905079712163198e-01   +3.484836292806114e-02   -1.379534593780118e-01   -4.095090201432567e-01   +1.990677482144278e-01   +2.699736594338255e-02   -7.811894915386888e-02   +1.464221580414017e-01   -1.095194498455847e-02; -1.187998307362100e-02   -1.512425648361340e-01   -1.677211986814551e-01   -1.683123471522063e-01   -5.383171290878614e-02   +5.324744863900341e-02   -6.751433017768892e-02   +3.017079798414742e-01   +2.038758030971770e-01   -3.283488129787904e-01   +3.290774457402157e-01   +2.746695307936218e-01   -2.331619770173043e-01   -2.167968810973093e-01   -1.776711376326879e-01   -1.445232357356599e-01; +3.557151499796076e-01   +6.879278916453108e-02   -1.133417805885168e-01   -3.669617668690995e-01   +7.906077491765832e-02   -3.181647432979795e-01   +1.809076117260373e-01   +1.482463296556331e-01   -6.650797540959842e-02   +1.814542368086570e-01   +1.064019954140427e-02   -6.817182704738772e-02   -3.952712251249581e-01   +8.305593151659388e-02   -4.297725408582848e-02   +2.567789856263946e-01; +3.402536338743620e-02   +3.051886131205060e-01   +3.243301768060863e-01   -4.209319163339607e-01   -7.591164518676935e-02   +1.319014391513200e-01   +4.179658356981690e-03   -3.527466252379731e-01   -1.612161519488016e-01   +9.205336875588968e-02   -1.894860365639475e-01   -2.143103078271415e-01   +1.199584072167919e-01   -4.167805594317586e-01   -1.318237435862591e-01   +4.874587699619300e-01];
L1E_L1I_iGABA_netcon = [-3.399666156314124e-02   +1.559446282105564e-01   -2.998207802194230e-02   -4.240462481492096e-01   +2.120827706592747e-01   -6.128335076703372e-02   -2.342217335696063e-01   -2.893344000612878e-02   +1.590616401754795e-01   -2.355275393898235e-02   +9.410337198559594e-02   +3.306064869741554e-02   +2.715753705919668e-02   -1.858576007994526e-01   -3.429726160281800e-01   -6.941106236374743e-03; +1.485596222463134e-01   +2.778388719689088e-01   -2.555119617556476e-01   -2.200900390477607e-01   -5.092421132038052e-01   +3.289734664855655e-01   +2.323010774462991e-01   +2.397425552266865e-01   -1.137347597382610e-01   -1.794483872876015e-01   +1.461100135675029e-01   -3.538004849414116e-01   -3.136966272658154e-02   +1.253569281008292e-01   -2.998547600366880e-01   -2.139077614405315e-01; -1.020361648046920e-01   -2.403195178690739e-01   -1.183475444747452e-01   -1.698041011215465e-01   +3.073771687440376e-01   -1.990776119214824e-01   -1.882881757937110e-01   +1.560307792005519e-01   +2.809058481370647e-01   +3.084698385459671e-01   +2.078938105607218e-01   -6.873124166348563e-02   -5.658285964614296e-02   -1.285273406681544e-01   -2.010889171726818e-01   +1.323504500041546e-01; +1.981432558257878e-01   +3.001913749867978e-01   -1.668465594015618e-01   +2.369885819020977e-01   -1.880945182476942e-01   -2.367554739532512e-01   +4.096905901880805e-01   -4.254113165089827e-01   +1.830660829622259e-01   +6.838955506204153e-02   -4.479431598581346e-02   -1.763330174951500e-01   -9.661755884751470e-02   +1.190377100924021e-01   +3.728028159408503e-02   +1.892733758085958e-01; +4.646424192291238e-01   -9.049210675749944e-02   -2.940711966820861e-01   +2.455308777343638e-01   -2.656805747675848e-01   -5.665063439566192e-02   -1.803039761244091e-01   +1.955987131441474e-01   +1.624662510343995e-02   -4.201241242942735e-01   -2.426478902703293e-01   -7.985374635194202e-02   -5.853852962778836e-01   -1.393040098487275e-01   -1.411271358175248e-01   -3.312178126273317e-02; -2.243259457020005e-02   +3.087593784062843e-01   -3.593052918629602e-01   -1.318310653440259e-01   -3.982401362824514e-01   -3.456422337454669e-01   +1.252216332642829e-01   -3.629397479911581e-02   -4.687646030881407e-01   -3.358500122422799e-01   -6.337088103459901e-02   +3.408879975429042e-01   +3.571703763115086e-01   +6.128378537811437e-02   -6.875600406715601e-05   -1.787773341886206e-01; -1.549355710741563e-01   +2.128531708560289e-01   -1.289380999258180e-01   +3.899598297951148e-01   -4.489444644540609e-01   +7.583228831675562e-02   -9.695756881669934e-02   +1.649772578338171e-01   -3.574056845473912e-01   +2.196553704697329e-01   -2.205121228985423e-01   +2.110356584879446e-02   +2.083360830468295e-01   -6.921417726918946e-02   +3.240410915582112e-02   +4.578884210032377e-02; +2.126074938140403e-01   -4.306179667245146e-01   +1.525583476821810e-01   +4.690731735333451e-01   -3.346095928378853e-02   -9.524129871916365e-03   +2.315293634574885e-01   +9.693563528792397e-02   -1.520718829871594e-01   +1.643342341687014e-01   -1.468799034553231e-01   -2.735407222933899e-02   -2.115355892271373e-01   -8.974081981258812e-02   -1.085019940588876e-01   +3.103861741345880e-01; +9.830781507499363e-02   -2.164365083657700e-01   -2.847389912892830e-01   +9.846540946520115e-02   -1.882727738230922e-02   -3.065149048047958e-01   +2.673225092798981e-02   -4.057820689045383e-02   +1.465849270099318e-01   +4.958028478987067e-02   +2.422030600815730e-01   -9.771182342404122e-03   +4.044829581690870e-01   -1.154601630167847e-01   -3.417780524780993e-01   -1.844445793688289e-01; +3.105632736865258e-01   +1.436138232085030e-01   -3.848774358001606e-02   +2.666010974711312e-01   +3.433003328841275e-01   -6.194670231352423e-02   -1.243420129608769e-01   -2.458552040288707e-01   +2.310081007260434e-01   +1.540745786489751e-01   +1.814865086615491e-01   +1.181234516246278e-01   +6.151784467902176e-01   -1.891542918482567e-01   -3.987845903189066e-01   -8.147468900475420e-02; -2.222461950790276e-01   -1.388493542727807e-02   -2.627260594280368e-01   +1.182155806875867e-01   -3.661337619675135e-01   +3.004422667368095e-01   -4.849651561209031e-01   -4.943983815703119e-01   -1.664331791737193e-01   -3.727922849959779e-01   +1.371683090559666e-01   -3.409915659885164e-01   +8.542218467288085e-02   +3.738040004550424e-01   +2.281698389691658e-01   -3.028008772429638e-01; -2.035834501493577e-01   +1.299116691129338e-01   -2.406847812972546e-01   +6.655251854298215e-02   -9.461953945806864e-02   +1.285836472660725e-01   +2.231264380786650e-01   +1.885538406079755e-02   +4.446088091444265e-01   +8.297682635014707e-02   +1.876795428991266e-01   +4.532065757653694e-02   +1.747830150528605e-01   -2.356092784634566e-01   -2.696552799268835e-01   +2.489979287922313e-01; -6.674324866194353e-02   +3.364264656447986e-01   +1.469874314972806e-01   -2.157816772706693e-01   +5.009863615264972e-01   -2.659510402074813e-01   -4.410488743189968e-01   -2.392658034920888e-01   -1.496060081575330e-01   -3.859337326585740e-01   -3.210766559044603e-01   -3.164822481731352e-02   +1.234317905418329e-01   -4.022391691959041e-01   -5.882744819364127e-02   +2.057760218004359e-01; -3.321977130278525e-01   +1.597886100622325e-01   -1.787449060729167e-01   -9.606351134036065e-02   +3.647159186633535e-01   -3.986242313319064e-02   -3.159541644103069e-01   -1.927155377799346e-01   -1.918828483689611e-01   -3.840048212966586e-01   -2.276867649136541e-01   -6.440609503465130e-01   +5.020948093153912e-01   +1.483174792045479e-01   -7.161932754343206e-02   +2.314662372150039e-01; -1.354550276669293e-01   +3.050885383503538e-03   +2.698349925146930e-01   +3.240073750550307e-01   +1.293963492628497e-01   +3.648915009943337e-01   -2.929551550090426e-01   +3.344236070457490e-01   +1.066526557697883e-01   +1.132464724563951e-01   -2.396701117035576e-01   +1.975639613285846e-01   +3.022097343212417e-02   -1.078387805692173e-01   +8.722454165731701e-02   -3.074602885832800e-01; +1.054114274245583e-01   -2.548910170882251e-01   -1.978331726404736e-01   +3.324689773181106e-01   -1.824994884617916e-01   -1.862097497639293e-01   -3.461505739689300e-02   +2.981453338616877e-01   -7.517951307287504e-02   -6.639085362257369e-02   -8.453685712435960e-03   +2.922171789116826e-02   -1.409214889064482e-01   -1.032505835390979e-02   -2.742972592376146e-02   -2.556358281188911e-02];
L2I_L1I_iGABA_netcon = [-1.382198542113368e-01   -4.722058690065281e-01   +2.821999810229727e-01   +4.077527694544723e-02   +1.869074787748848e-02   +2.675889380022445e-01   +2.025418815181722e-01   -4.567609558497617e-01; +1.570506834178465e-01   +1.361940919005530e-01   -6.010039932316169e-02   -2.329097891632100e-01   -4.183985373020916e-01   +2.468914777841321e-01   -2.721663785736213e-02   +9.283675380949065e-02; +1.456782587175955e-01   -2.414764374983195e-01   +4.786700408894735e-02   +3.505123117252845e-03   -9.435158007359504e-02   +2.083780173446232e-01   +1.656685660949419e-01   +2.573831822122650e-01; -1.388450109518430e-01   +5.378757102815029e-01   -1.418897481159336e-01   +4.610627758291985e-02   +7.269562955690147e-02   -1.166274980733131e-01   +2.750644033703831e-01   -3.540715291653145e-01; -1.315547396742792e-01   +3.830151228039911e-02   +1.488329704211690e-01   -1.933254872108547e-03   +2.393135712358018e-01   +1.809663507305209e-01   +1.601927634221671e-02   -1.184133890959929e-01; +1.633478296901040e-01   -8.483974368729585e-02   +1.337126123127623e-01   +3.932888876720039e-02   +2.481112545724408e-01   -1.641701938034512e-01   -3.397571752192241e-02   -5.892342854720037e-02; +1.528489025625907e-01   -1.564455326213635e-01   -2.092584509167457e-01   -1.242597562921735e-01   +1.919574212102874e-01   -5.072491352168881e-01   -3.161477688652832e-01   -7.384634676325028e-02; -1.703574659272389e-01   +1.903473169108854e-01   -2.571958190674722e-01   -9.081036892045374e-02   -1.050621268130894e-01   -4.501238213599789e-01   -1.882795176230573e-01   +1.391915895428958e-01; -1.324129809626484e-01   -2.680065932702150e-02   +2.367729326227095e-01   +2.542705404336053e-02   +1.976439272155376e-01   -4.574302835244805e-02   +3.243807967482217e-01   +3.855402991422012e-01; -1.424674023585571e-01   -9.298882077989989e-02   +2.193326093983885e-01   -1.971405701874965e-02   -2.279373049790318e-02   +6.056328893450800e-02   +4.603132848532622e-01   +1.041845970105140e-01; -1.172531034095947e-02   +8.960450915508678e-02   -2.620307151488797e-01   +3.062004582667197e-02   +6.975525945602662e-03   -1.700538377636629e-01   +1.697964136772649e-01   +1.018643823243514e-01; +2.451242501871101e-01   +4.960775919946988e-01   +4.462155144818908e-01   -2.108772533024816e-01   +5.108388858198561e-02   +6.669664507794065e-02   +3.677257773725085e-01   +4.096484901405666e-01; -1.889636137375763e-01   -3.669247509497116e-01   +4.110189709422336e-01   -3.524041908807592e-01   -2.604142707662170e-01   +2.372570864576393e-01   +1.667801212533154e-01   +1.794231852482407e-01; +9.491311378708178e-04   -4.981437188549229e-01   -7.021441880514395e-02   +2.973248349888785e-01   -5.386014609607002e-02   -2.837102832067491e-01   -1.872953562949291e-01   +4.091778589681766e-01; -2.317733501294705e-01   -3.701480178011374e-02   +5.237591572536751e-01   -5.594212213231578e-02   +2.281062584371628e-01   +2.627614671763217e-01   +3.686999795210674e-01   +1.768932463967469e-02; +3.649878227507868e-01   -1.914251454654126e-01   +1.778952495336941e-01   +3.802116763154325e-02   +1.406768024014478e-01   -2.225249295240635e-01   +5.144114578496812e-01   -6.689163114841894e-02];
L1I_L2I_iGABA_netcon = [+1.981850358524041e-01   -2.764857853616706e-01   -2.835792272682314e-01   -1.229671120556023e-01   +1.805970693420023e-01   +4.957047641398963e-01   -2.876611782871834e-01   +4.065609569668186e-01   -2.283506534939246e-01   -2.841430073832237e-01   +2.695619832592425e-01   -4.653813491827383e-02   +2.285042442863544e-01   +1.841112103739412e-01   -2.557545008448640e-01   -2.826168740288563e-02; -2.891872654580123e-01   +2.486318552895139e-01   +2.258309523008375e-01   -3.112473857272829e-01   +2.366582398401048e-01   -4.291944787989848e-01   +1.025704602212093e-01   -5.665661753269322e-01   -3.242969530073802e-01   -5.139579767772710e-01   -1.250779048406770e-01   +1.241133049420506e-01   -2.247938845506842e-02   +5.957562223471446e-02   +3.867971990459940e-02   +1.244715284299034e-01; -2.629074948218828e-01   +1.712434823100887e-01   -1.602696865905452e-01   -1.368552453274219e-01   -8.008797850456525e-02   +1.138145904698785e-01   -9.195576988567471e-02   -2.445951061272898e-01   -1.264937002142194e-01   -2.242825020835785e-01   -1.215134557697154e-01   -2.054055712252166e-02   +1.131007807002594e-02   -2.396667658829870e-01   +2.123454771094667e-01   -2.913259087811466e-01; +4.229646750305590e-01   -2.578479734202060e-01   +9.484622368933607e-02   -1.396117059502597e-01   -9.776066998135885e-02   -3.030890137715651e-01   -4.267611325360716e-01   -3.032075872099013e-02   +1.258211369526477e-02   -1.740782673711680e-01   +2.245043182449954e-01   +1.310047879485930e-01   +7.291183420856814e-02   -1.509216573435276e-01   +3.195432590876991e-01   +1.549693172375599e-01; +1.207589374004325e-01   -1.485154282250504e-01   +4.184453466406457e-01   +7.264987424496050e-02   +4.630609247040207e-02   +1.040362144335644e-02   +4.184278594129675e-01   +4.690496490042372e-01   +1.929926358005162e-01   +1.778134884149542e-01   +7.026316210454292e-02   +6.619474826491077e-02   +2.546190366787325e-01   +1.812313706814602e-01   +2.110145206478369e-02   +2.743855758047725e-01; +2.424740417851838e-01   -1.927804382402533e-01   +1.796493106961017e-02   +2.871270051528432e-02   +4.783456435638427e-02   +3.362976813981341e-01   +2.118584233839437e-01   -1.691652030065768e-01   -7.242772443022936e-02   +3.307799877055868e-01   -3.347518726720835e-01   +1.712272034128686e-01   +1.457224667605703e-01   -3.507710267091320e-01   -2.427732480348869e-01   +2.169312235180541e-01; +4.244073165111290e-02   +3.579883544540124e-02   +2.883754967936633e-01   -1.487569543357192e-01   -3.718623246422667e-02   -9.132177611498991e-02   -2.608594085522287e-01   -3.156921404954202e-03   +1.419811656043047e-01   +1.776717623174412e-03   -1.038807696878116e-02   -1.675158646120306e-03   -7.389997493419820e-02   +5.650913332142550e-02   -1.655776522150597e-01   +1.938933406201472e-01; -3.765455912744256e-01   +2.152364688033412e-01   +3.772223655305336e-01   -4.219973793861141e-02   -7.338042631106850e-03   +1.196975660490265e-02   +2.079369113708610e-02   +1.679046764741259e-01   +3.436028087934905e-01   -1.175478834266297e-01   -2.948267643565978e-01   -2.931925469966374e-01   -8.848720464854032e-02   -2.780700819030163e-01   -2.217581137623647e-01   -4.622459901553409e-01];
L2E_L1E_iAMPA_netcon = [+2.429398223775900e-01   +7.779922568498160e-03   +7.568145032989804e-04   +1.498765851325329e-01   +4.836889342210913e-02   +2.392723285905856e-01   -2.584816723391821e-01   -8.792100829973791e-02; +1.901250422614107e-01   -1.346757973040860e-01   -1.298560942648747e-02   +2.979802242594317e-01   -2.153848449817626e-01   +2.417135328940116e-01   -6.099586464987646e-02   +3.383707591676266e-02; +1.994202031180301e-01   +2.925783078128022e-02   +2.981198759404359e-02   +2.313877419778473e-01   -9.098654965780836e-02   -2.220715898295044e-01   -1.487441930812462e-02   -9.880633922832943e-02; -1.441333053371873e-01   -1.141571224309033e-01   -7.225969484279515e-02   -5.376105621964571e-02   +1.924564051565265e-01   +2.535330728645049e-02   +8.124664131815425e-02   -2.461561479018683e-01; +1.031601310173264e-01   +9.628612181953927e-02   -1.094985871828411e-01   -2.057030023155813e-01   +1.952489177088845e-01   +4.806737031096044e-01   +2.579120834551277e-02   -1.418988015181213e-01; -4.411809598966228e-03   +2.575476206755467e-03   -3.397962412716156e-02   +8.864590719511409e-02   +4.620346750251325e-02   +3.598281645753850e-01   -3.171526922999855e-01   +2.332257629252440e-01; -1.498758610331662e-01   +7.409939029593590e-02   -1.351811156911658e-01   +2.109041526272260e-01   +5.948302075822415e-02   -1.384222503663669e-01   -2.866143198486231e-01   +5.682590635545867e-02; -2.327645881616592e-01   +3.442956528309300e-02   +2.691622086183242e-02   -9.614142009555890e-03   +5.802634436604268e-01   -2.481953060196007e-01   +3.107650057572713e-01   -5.631834101751543e-01; +1.475478254731473e-01   -3.602869865234945e-01   -1.532566963013625e-01   -1.674099430804377e-01   +3.339281367667495e-01   +2.901537144734330e-01   -4.173869673040840e-01   -6.123629987350515e-02; +3.348385682886475e-01   +2.947163337862754e-02   +2.760991655921597e-01   +1.036128334082025e-01   -3.801680428842385e-01   +7.744582505312916e-02   -2.680096434205614e-01   +2.344916841807168e-01; +4.537093452806684e-01   -1.102162585056310e-01   -9.089762695567824e-02   +3.866402028928159e-01   -3.337392751724879e-01   +3.229242005961883e-01   +1.935428270109018e-01   -1.026765687862052e-01; -2.656003396047901e-01   +1.226049925119478e-01   -1.988897407630322e-01   +3.341863916465798e-01   +5.597331555719617e-02   -5.330120725476459e-01   +2.995859192834174e-01   +2.924669776154515e-01; +8.757222704376984e-02   -2.775090855827158e-01   +2.840583333407861e-01   +1.578032382608603e-01   +3.839435181490488e-01   -3.119079110836872e-01   -3.200965682041000e-01   -5.028188549263648e-01; -2.190141148604804e-01   -2.990414112896572e-01   -3.803703993479902e-01   -4.670126132307951e-01   -5.826103030711750e-02   +2.829631512429787e-01   +2.945252869650438e-01   -3.703386238747164e-02; -1.128502408981401e-01   +2.776944028779613e-01   -2.515141411584231e-02   +1.919257914288556e-01   -3.881147262965989e-02   -2.401643498726218e-01   +3.174559521208343e-01   -9.371516615808650e-02; -4.017337259725682e-01   -1.443800844032504e-01   +1.929747964415076e-01   -1.598600270368726e-01   -3.006402045975631e-01   +1.240270038728334e-01   -2.628876778918976e-01   +4.233454765410349e-02];
L1E_L2E_iAMPA_netcon = [+4.341077495904438e-02   -1.840434560522975e-01   +1.226420033494391e-01   -1.460582992967993e-02   +9.921150480661128e-02   +5.024982519860980e-03   -1.088438662474665e-01   -1.815071010725274e-01   +2.417294701450345e-01   -2.593665842140768e-01   -2.412925751967547e-01   -4.877617097026506e-02   -2.400813934521527e-02   -2.798518723755640e-01   +3.452484827653511e-01   +2.316568538887863e-01; -2.013386943358059e-01   -1.999976414185077e-01   +2.162031545785201e-01   +7.306842954669668e-02   -1.448296627484499e-01   +4.321818885200683e-02   +2.971172092533941e-01   -1.625936105185443e-01   -2.959105847895998e-01   +2.431377242424917e-01   -9.283758028422257e-02   +2.172273782989730e-02   +3.181752693482908e-01   -2.078560784892750e-01   +3.926046287380029e-01   -2.276631949305422e-01; +5.296309898626361e-02   +1.958410107875388e-01   +8.798745148828871e-02   +3.660649283964604e-01   -2.112389625015549e-01   -1.177220556249644e-01   -3.438370547570319e-02   -6.570669539204979e-02   +2.275156082862970e-01   -2.857419078527887e-02   +3.375312388210716e-01   -2.422042372558668e-01   -7.356940714314196e-02   +1.178666987274291e-01   +2.549300645713781e-01   +7.316937242784063e-02; -3.484952801295192e-01   -2.052828978305094e-01   +8.669020201390328e-02   +1.403367158588623e-01   +3.436917435188108e-02   -3.006579912304342e-01   -1.459934355555630e-01   -2.249318262351945e-01   -2.858307865182784e-01   +2.027129234272623e-01   +1.593995054468539e-01   -3.329965120251945e-01   -1.541893503335957e-01   +1.186022418277753e-01   +1.182520298861246e-01   +2.613573881036794e-01; +1.934646837005709e-02   -8.765722622286265e-02   +1.345062717736306e-01   -5.741300466703743e-02   +4.628536967979303e-01   +6.283314452450680e-01   -2.215329133199671e-01   -5.064396517480176e-01   +7.110631478952084e-01   -3.233813891281486e-01   +1.400365047281759e-01   +2.384255006644891e-01   -6.338765381181555e-03   -2.596944485806917e-02   -1.090094423444327e-01   -2.453276053285634e-02; +3.661363082095331e-03   -1.282059265058182e-01   -3.413859562427476e-01   -1.034382432218421e-01   +2.478680607320672e-01   +1.172697494598968e-01   +9.519760217614151e-03   +5.455891753103896e-02   +9.559185258757932e-02   +1.675312196629858e-01   +2.913023987068972e-01   +3.752478286589489e-01   +1.528153076064501e-02   -1.454818771205160e-01   +3.379011446124468e-01   +2.364726041073141e-01; +2.595882573664086e-01   -2.059621495599614e-01   -8.127450181231607e-03   +6.042741913583652e-02   -1.505376942175507e-02   -3.678459611634098e-01   -3.929946683313790e-01   -3.250629693909760e-01   -1.484661221940675e-01   -1.276741470557580e-02   +2.638638434392244e-01   -1.194892697959269e-01   +1.787810459440740e-01   +9.046583464547463e-02   +2.360982012665962e-01   -3.153517613265504e-01; +2.944083491334810e-02   -9.008795975634770e-02   -9.202058176109462e-02   +3.105025403903666e-02   +2.022782064359958e-01   -6.973441612333502e-02   +1.248634466111251e-01   +5.425033623424347e-02   +4.343797187724209e-01   +5.579427280430953e-01   +4.048008896562701e-01   -2.944212199510333e-01   -2.348491539341398e-01   +1.738519054214941e-01   -2.137681401943562e-01   -2.373246420354388e-01];
L2I_L2E_iAMPA_netcon = [+3.858759586114681e-01   +1.025081312174633e-01   -2.214877593453487e-01   +2.165406919685568e-01   +6.032777937351988e-02   +3.977040046531345e-01   +7.321591083720017e-02   +1.758827733452735e-01; -4.875576243274591e-01   +3.019956160764591e-01   +2.978708291037511e-01   +2.284125037260578e-01   +3.102993364026822e-01   -2.576677186443529e-01   -1.168376611898597e-01   +4.368280895286484e-01; -1.798339877521877e-01   -1.051163102398288e-01   -7.414001621555658e-02   +1.070042904753163e-02   +1.270390150602535e-02   +6.425622993511265e-02   -3.407389525854769e-02   +2.728260393271713e-01; +2.760409468686277e-01   -4.521530463152851e-01   -9.034816955255394e-02   -8.107109696011050e-02   -2.519058379018818e-01   -6.127017760879089e-02   -1.836452363714891e-01   -3.181042955513476e-01; -2.743776361933878e-01   +9.060662054826127e-02   -3.644965066673952e-01   +4.397434366762106e-01   -2.595477565560333e-03   +1.835087879425170e-01   -3.248741997506629e-01   +3.471578848490802e-01; +1.934733467893068e-01   +7.105966344378906e-02   -2.534163473398933e-01   +1.001291349388210e-01   +9.108618369194571e-02   +1.832553279384536e-01   -4.439042780071831e-02   +3.831518900735258e-01; +3.031663067475297e-01   +1.218082661121179e-01   -3.207125603965315e-01   +4.890293379584648e-01   -1.789009353252612e-01   -1.377174455636310e-01   -3.542151537983506e-01   +1.485756100456083e-01; +3.161965110970427e-01   +3.742918477722573e-01   -7.320693022834662e-02   -7.499072236381982e-02   +2.599135314987026e-01   -3.130966813569336e-02   +1.752175148712139e-01   -3.306186996700153e-01];
L2E_L2I_iGABA_netcon = [+3.217557116051941e-01   +8.011662726295082e-04   +3.696395889332231e-02   -1.604904227025508e-01   -2.273260875593146e-02   -2.118927727274667e-01   +2.312023581201147e-02   -5.131790591691816e-01; +2.667964848797996e-01   -4.405903933692394e-01   +1.863647154903641e-01   +2.026388226352752e-01   +4.220913631225421e-01   +1.188371920994614e-01   +9.410060352657987e-02   +1.667504644472063e-02; -2.070666378882271e-02   -2.705003134497653e-01   -3.162183111148429e-01   -3.239057102683490e-01   +2.059342123043042e-01   -3.066073692203825e-02   +7.387414965344272e-02   +3.356271836325924e-01; +4.925846489746544e-01   -2.522003340892316e-01   +1.248147177220862e-01   -3.186173849790781e-01   +1.492287908074572e-01   -3.266127502935270e-02   +1.707480519192231e-02   -2.533676598057054e-01; -1.865579615503878e-02   +1.281764095573397e-01   -6.447926370798221e-02   -1.125061518324785e-01   +1.471938283735940e-01   -2.109740436260077e-01   +4.582037410304954e-02   +7.870494895038849e-02; +4.973127257664885e-01   +1.391438083068091e-01   -1.952791558125754e-01   -2.334562632045731e-01   +1.311020247507113e-01   +1.084095086955376e-01   -1.820645395699311e-01   +4.849496603024081e-02; -4.279887878243327e-01   -2.930320282108243e-01   +3.282324338272130e-01   -2.463218322447105e-01   +9.203210621300559e-02   +3.500683589309077e-01   +6.625528637742170e-03   -2.756688864515190e-01; -8.460669459051694e-02   -2.148152405555959e-01   -5.208553618944516e-01   +1.465347183488405e-01   +1.556290815697031e-01   +2.580190205027663e-01   +1.725925964031876e-01   +1.711579889721753e-01];
L3E_L2E_iAMPA_netcon = [+1.039034884713095e-01   +1.226252886403655e-01   +7.182584919001520e-02   -1.688732779669037e-02   +6.070378156672232e-02   +9.174486096348713e-02   -4.906095342165699e-01   -3.743283192965210e-02   -4.390947995872876e-01   -3.333874215991212e-02   +2.936084204199855e-02   -2.507041230965279e-01; +2.032925535854221e-01   -1.134998815427583e-01   +1.710117843310423e-01   -1.301999823539517e-02   -1.336296656433068e-01   +2.134071960772995e-01   +4.821923329223600e-01   +4.269748788311298e-02   -1.768252075841900e-01   -6.084672275175151e-01   +3.223403089716499e-01   -7.008665370524400e-03; +3.029874197385640e-01   -5.155793646385706e-02   +3.605295923098040e-01   -1.084691796881712e-01   -1.700729702745021e-01   +1.517903802740562e-01   +1.230807628065384e-01   +4.473250716791694e-03   +1.679482307023013e-01   +1.941821048081742e-02   -2.984199521480332e-01   -1.905141045805231e-01; +8.855188768643205e-02   -4.100878595638460e-02   -4.420867636538208e-01   +1.524759318483157e-02   +2.520569595597703e-01   +2.067153465721516e-01   -2.016976198818408e-01   +7.463049529288779e-03   +8.121587114195333e-02   -9.964002856889598e-02   +1.832454282680965e-01   +2.822852531837000e-01; +1.668023147568842e-02   -6.399267406376952e-02   -5.014724433172925e-01   -1.232744252557498e-02   -8.381611983842910e-02   +3.083865427537038e-01   -7.182678198650702e-02   -4.103153771292675e-01   -3.156310450937123e-01   -5.023683845910654e-02   -2.090660098298877e-01   -2.740776886153142e-01; -1.966151724496297e-01   +2.195331525097509e-01   +9.441208688230844e-02   +1.365930305274008e-01   -4.079545704520072e-01   -3.441394594312143e-03   -1.962913976135446e-02   +4.359856856762676e-01   -1.830571493390332e-01   -5.111292754029881e-01   +1.245318536991415e-01   -2.135720737444311e-01; -2.737401224264362e-01   -2.902174542483996e-01   +6.214234729213666e-02   -1.273358235614689e-01   +1.009942088433300e-01   -1.037294583178882e-01   -1.776248156434101e-01   -3.330194708901342e-01   -1.079686831025010e-01   -2.183978074485943e-02   -5.495387113626362e-01   -1.406864488325575e-01; -3.595662933120997e-01   +6.566821584954932e-02   +9.723079176089228e-02   +1.303840560601714e-01   +3.679927253404947e-01   -8.154978003265956e-02   +2.860566305572622e-01   -1.664610570237965e-02   -1.129307671292586e-01   +2.730151741024852e-01   -2.304883922252942e-01   +1.691341588373468e-01];
L3I_L2I_iGABA_netcon = [-4.290436414042338e-02   -4.251194687165477e-01   -2.117477654339411e-01   -7.495634669993445e-02   -2.273987176141775e-01   -1.107661561412804e-01   -5.216268963774758e-01   -2.029009227258479e-01   +1.918400618452571e-01   -4.710337356953902e-01   -6.704037202064664e-02   +2.622222661424398e-02; -2.135375624750772e-01   +9.092279081890106e-02   -4.326007363804785e-01   +1.734518274526252e-02   +4.063299608326018e-01   -1.133432945928399e-01   +1.580777963886722e-01   +4.049977232389786e-01   -3.275293155881690e-01   +3.510279851754592e-01   +2.278041160286333e-01   +4.807129740336498e-02; -4.946921144923091e-01   -3.540152839924919e-01   -1.925662327482465e-01   -1.082069245714096e-01   -2.115531503891985e-01   +1.464775399914201e-01   +4.714610380828176e-02   -2.899828609534899e-01   -9.503593010980244e-02   +9.474421158340109e-02   +2.485178487059924e-01   +5.193409472757141e-01; +6.808105547136781e-02   -1.083884425657915e-01   +3.653886051871666e-01   +3.894125281589679e-01   -2.492555002926617e-01   +1.944647868822734e-01   +2.746782174428239e-01   -9.174897274785768e-02   -4.391229201082196e-01   +4.064893955035859e-02   +1.046017467806848e-02   -6.362954226171470e-02; -9.026170167055730e-02   -2.857953314374894e-01   -1.997868399734388e-01   +3.480969109497196e-02   +8.465224470739813e-02   +8.868109197928438e-02   +3.256544661858122e-01   -2.228335680997418e-01   -2.113782980656422e-01   -1.061037134189981e-01   +1.159159017221074e-01   -4.001801790947643e-01; +5.501583071040639e-02   +9.314118853967798e-02   +2.953330509393928e-01   +1.521364330806720e-01   -5.405585335882904e-02   -3.804650105577802e-01   +4.834602250436860e-01   +2.311868505192201e-01   -1.875495832031322e-01   +2.668658626667449e-01   -8.599267962343671e-02   +1.281245913318167e-01; -3.430726872639839e-01   -3.771307767207881e-02   -1.039271552628936e-01   +1.969965004909367e-01   +1.305632672749472e-01   +3.299305403684401e-01   -1.004218392291480e-02   -3.481907696934551e-01   +1.395584422863593e-01   -2.548953820549837e-02   +1.483538126636252e-02   -4.880972024219798e-01; -3.085697175136284e-02   -2.305886815516126e-01   -3.619307672905170e-01   +9.619648144143156e-02   -1.207043535109426e-01   -2.269243773079454e-01   -1.825919840346190e-01   -3.060618453934988e-03   +3.836318817593735e-02   -1.621962319535603e-01   +4.011222750948080e-01   -1.445206782848036e-01];
L2E_L3E_iAMPA_netcon = [+2.064711408733985e-01   +1.838360830844750e-01   -8.271029405128646e-02   +1.251111651402087e-01   -2.474925427079369e-01   +3.803233061350520e-02   +1.674288570683701e-01   +2.519337069029209e-01; -3.807857317933375e-01   -3.812234126070474e-02   +3.839480342383506e-01   +6.101940446904802e-02   -1.614811996209626e-01   -1.514240193749300e-01   -1.245716599608586e-01   +1.796233214611191e-01; -1.720314230361335e-01   -4.817443419954962e-01   -8.528160670474791e-02   +2.348635376892717e-01   +2.340587288294524e-01   +3.035226405354695e-01   +4.513421646732380e-03   -1.763278533300038e-01; +2.842740563280683e-01   +1.599678824991572e-02   -2.901228324231643e-01   +1.222837815711057e-01   -9.287347513401481e-02   +4.390776888969515e-01   +5.031016163912736e-02   -3.945919956550548e-02; +3.013596277820151e-01   +7.062488806947070e-03   +1.148344118711639e-01   +2.828848241305153e-01   +3.532274269728898e-01   -2.027060857160478e-01   +1.355363390362179e-01   +1.928209769857495e-01; -5.545395869998272e-02   +2.455874364239938e-01   -2.210487197782692e-01   -4.450126988489267e-02   -8.613194223067329e-02   -3.349172494269765e-01   +5.928283607203180e-02   +1.432892990689636e-01; +1.135083689520961e-01   -2.882595590646569e-01   +1.181681536413704e-01   -2.105971561678785e-01   -8.750922683408434e-02   +1.181985253771893e-01   +2.860606333818082e-01   +2.555063232519151e-01; +4.251594252807230e-02   -2.341678054804780e-01   -1.491066433152491e-01   +1.086335891786964e-01   +1.497337132089924e-01   +1.453937853483089e-02   +8.132481885907270e-02   -1.148578621886803e-01; -4.821121921633892e-03   +3.018775501892855e-01   +1.273254540402949e-01   +1.845201972939247e-01   +1.974938764834617e-01   +4.177867766464681e-01   +1.635957746090276e-01   +1.847689121659351e-01; -3.991944090036936e-02   +1.146215064430578e-01   -8.965781601618109e-02   +1.153055656387538e-01   -8.027260401203945e-02   +1.944004657008320e-01   -1.964949707783263e-01   -2.300641221066958e-01; +1.772778624157394e-01   +4.405482621577865e-01   -2.451957663264718e-01   +4.052194952902684e-01   +5.826897935419406e-02   +9.959179344973590e-02   -1.756809764031588e-01   -3.394971101877688e-02; +1.331041316031127e-01   +7.203026135055070e-02   +3.665957625791513e-02   +2.220604893142071e-01   -3.917975981502387e-01   -3.329303505684377e-01   -2.287438096967872e-02   +2.975264839490244e-01];
L2I_L3I_iGABA_netcon = [-3.383676678201241e-02   -3.708342782172525e-01   +1.264527235695950e-03   +3.434155939139308e-01   +5.109907693586996e-02   +1.199261506697483e-01   +1.238895226368276e-01   -2.588662908578183e-01; +9.590350308182999e-02   -5.996310342970916e-02   +1.783661484094893e-01   -8.377291023170003e-03   -2.539110304970285e-01   -1.215819745182795e-01   -4.014266530818722e-01   -1.017004710051069e-01; -1.066540107430644e-02   +9.528476446470621e-02   -3.606166599248007e-01   -1.290231481127302e-01   -4.857998301830216e-03   -2.808529400441341e-01   +2.170246542434927e-01   +1.585836857393797e-01; -1.947704039066674e-01   +1.784022882565223e-01   -6.889897094975672e-02   -1.199400459975974e-01   +5.504678723692629e-01   +2.098128366229528e-01   -2.566127613047012e-01   -6.882369089063578e-02; +3.156412123192964e-02   +1.533734820057182e-01   -6.660774675177591e-02   +4.006690508687426e-01   +1.211855596478734e-01   +1.588298479603252e-01   +5.730261605989714e-01   +1.690547116596915e-01; +3.324779488421558e-01   -1.698630468489970e-02   -2.853393514033480e-01   +5.165065938371355e-02   -1.925114819670343e-01   +1.388441635320048e-01   -5.150127159217315e-01   +2.243116756901141e-01; +5.327529369160427e-02   +1.900679704264438e-01   -1.663330316283591e-01   -1.386115730417253e-01   +9.737463065208687e-02   -4.933656292854374e-02   -1.367345686651891e-01   -4.008229123700584e-01; +8.278822436921346e-02   -6.108041668322910e-02   -2.123020561305095e-01   -5.975235841298510e-02   +2.466726452699498e-01   -7.299484105131010e-03   +1.756111988647842e-01   -2.139598259070122e-02; -2.480707103606629e-01   +5.511559492271234e-01   -3.541050141186434e-01   -2.238065906605007e-01   +1.785491637832236e-01   -3.238983147705422e-02   -2.202633928249652e-01   -2.913915703723853e-01; +5.177928469982505e-01   -7.042070382975245e-02   -4.402002985109033e-01   -1.427584001042025e-01   -1.290374435950291e-01   -1.473600434303101e-01   -2.145504712838378e-01   +2.580904593542418e-01; -2.816627511772488e-01   +1.890310140419137e-01   +2.355062957872111e-01   +8.739165046168736e-02   +5.909314296747092e-02   +2.155963426701711e-01   -1.849847303908237e-01   -1.660989775448049e-02; +4.568914353041280e-01   +3.217230966433330e-01   -1.436688847202506e-01   -2.820011325309455e-01   -1.349304410347533e-01   -1.110434753818199e-01   +2.875805226575286e-01   +4.069873574757564e-01];
L3I_L3E_iAMPA_netcon = [+9.899476463876788e-03   +2.597822232185570e-01   -4.683295675641070e-01   +3.156452377862938e-01   -1.413570493249518e-01   -1.908968705964478e-01   +1.942189029952962e-01   +1.777059335529195e-01   -3.395217920470064e-01   +3.506922347490103e-01   -3.552514461878373e-02   -1.900486479027527e-01; -8.433868107906478e-02   -3.958347197852636e-01   -1.254454219915060e-01   +6.335621294498597e-02   -2.370552791098238e-02   +1.739236844940323e-01   +6.905480901297023e-02   +1.247371976939497e-01   -3.091567908163739e-01   +8.309896079203290e-02   +1.785824723909440e-01   -4.167770638053282e-01; -1.680878844959955e-01   -7.165670951421597e-02   +2.054293964527264e-02   -5.870132400369321e-05   +1.170703665128566e-02   -1.698862434429673e-01   -1.035762759455087e-01   -3.973928049692810e-01   -4.010651271576784e-02   -6.228626455049960e-02   -8.758843221671749e-02   -3.594149938581320e-02; +5.282830678691126e-02   +3.171295352997301e-01   -3.671888159738529e-01   +1.647203803797045e-01   -1.364911568014199e-01   -1.267693741008249e-01   -4.123064721094386e-02   -3.088837540310558e-01   +1.439637419797364e-01   +2.153848310123285e-01   +4.293959337532197e-01   +2.703828405473900e-02; -4.352450250627425e-02   -3.752526717699567e-01   -2.128017124769380e-01   +3.112896738333408e-01   +4.560112364002011e-02   +2.762501538023795e-02   -3.307404413071635e-01   +1.464131105677832e-01   -5.184442447636910e-02   +2.169519110043244e-01   +1.397707872881392e-01   +1.364781765804046e-01; -2.519032531083918e-01   +1.789922698036800e-01   +5.304690370372075e-02   -1.330755848327010e-01   -6.296135365950339e-02   +2.517903598509973e-01   -5.884010678318727e-02   +2.038848297135189e-01   +9.093947407085569e-02   -9.382637488176143e-02   +1.323020814463362e-01   -3.643272771821006e-01; +1.793786282142514e-01   -3.634294740718277e-01   +1.660399949524059e-01   +5.070551860036961e-01   +7.616588732374657e-02   +1.782585464087115e-01   +1.654081252337475e-01   -3.957303760849131e-01   +1.290087515778708e-01   -2.219645543741095e-01   +4.998036969411467e-02   +1.210857094554153e-01; -2.644519794729658e-01   +1.069505728729016e-02   +2.922522614835166e-02   +3.065535636243813e-01   -2.030620335539918e-02   +1.551183638217362e-01   +3.144261116330811e-01   -1.026794815269772e-01   -3.479434684420961e-02   +1.983974206753334e-01   +1.708689120259818e-01   -3.310420805103221e-01; +4.611833167274854e-02   -8.727613087525071e-02   -3.361219675750263e-02   +3.173900309892395e-02   -1.528557927653746e-01   +1.421021371594814e-01   +1.210470050976070e-01   +6.290379885459235e-02   -1.642201885932783e-01   -2.251892934845727e-01   -4.079044663539242e-01   -8.707768085004483e-02; +3.829132703376516e-03   +4.601996781616566e-02   -3.047064646135506e-01   +3.881516146515442e-01   -6.945438507026927e-02   -3.925803798459082e-04   +2.454555589640768e-01   +1.541785880658454e-01   +3.553341514098725e-01   -1.632067097088418e-01   +1.180656401980470e-01   -3.839851913439532e-02; -1.426164169975883e-01   -5.977009169809741e-01   +1.737065254540349e-01   -2.482770788201181e-01   +2.029696873096513e-01   +1.798306352235906e-01   +2.475082973565477e-01   -8.464177166380316e-02   +1.881219363355746e-01   -9.321217054252051e-02   +3.702204890863238e-02   +3.971060744257048e-01; +5.189793303864428e-02   +9.397421037465858e-02   +2.522015771033319e-01   +1.022033668284211e-01   +2.411287468479076e-02   +1.394480615844431e-01   +5.861672139770494e-02   +2.531330385021916e-01   -1.116100118360575e-02   +5.034540355927028e-02   -1.212097541164374e-02   +1.784386224837877e-01];
L3E_L3I_iGABA_netcon = [-9.713604771449125e-02   +3.143631722358703e-02   -2.372713801323170e-02   -9.801003814361262e-02   +2.635501003505256e-02   -3.618558957537762e-01   +2.787355000465619e-01   +1.518624916748653e-01   -6.719676191387253e-02   -3.587246398447935e-02   -2.363629647603616e-01   -2.925955524755096e-01; +2.868386778330878e-01   -9.564493997480543e-02   -8.221295238845600e-02   -1.346186038545495e-01   +3.572880514884963e-01   -6.894969873784311e-02   -6.751204915136430e-02   -4.382998853763823e-01   +3.471810631706952e-01   +4.231751714304455e-03   +2.525616301075687e-01   +1.204827028393385e-02; +1.039973284178384e-01   -2.133735582560066e-01   +1.634024386275163e-01   -2.402795284353468e-01   +1.622872684117006e-01   +1.530957316186549e-01   -1.755230539087892e-01   -3.706297183544475e-01   -1.301078969049463e-03   -1.279705724268800e-01   +1.093345931152349e-01   +2.700608055383268e-01; +4.206637559949728e-01   -2.239946007934418e-01   -1.641662996556386e-01   +1.763050604082396e-01   -2.595014140495893e-01   +8.959548610422990e-02   -1.669803398837239e-01   -4.231364342652405e-01   +1.130694916317505e-01   -1.280121373815366e-01   -4.549501755834526e-02   +7.227993445260092e-02; +1.021119572109948e-01   -1.282228558308019e-01   +2.387572347134755e-01   -2.052778295285981e-01   +8.683756264169400e-02   +3.452654892273807e-01   +1.127722139737349e-01   +1.029979322106421e-02   -9.330824833849256e-02   +1.245451456578911e-01   +2.623836484203591e-02   -1.430290851672433e-01; -2.558134834665659e-02   -7.062713683034871e-02   -5.257955880450140e-01   -8.481015649512730e-02   -1.634094642098263e-01   +3.554345850556567e-01   -2.874435345250065e-01   -2.423372054324552e-02   +3.458009711060078e-01   +1.045147413716502e-01   -1.914220965701424e-01   -9.705751676060408e-02; +2.196902365447073e-01   -1.614113728127163e-01   -2.582707659024854e-01   -1.661637544982178e-01   +7.660447713382063e-02   +7.161563822166789e-03   +1.292319348816995e-01   +1.194647050879619e-01   +8.838766139354390e-02   +8.788152788441692e-02   -2.099414792468009e-01   +1.324431136980005e-01; +1.932010266219054e-01   +1.825890327550643e-02   +1.159617997066674e-01   -1.171119456888272e-01   +1.352306407833785e-01   -2.551830618816783e-01   -1.981717795391983e-01   +3.218696935561747e-01   -2.695977218970148e-01   +2.270479455548541e-01   +1.417030881235797e-01   +2.460525174763294e-01; +5.034916545599333e-02   +2.481261331322083e-01   +7.011649196362871e-02   +1.357994219516276e-01   -1.658662332573020e-01   +1.897667690244596e-01   +2.383300974395858e-02   +2.997369770590774e-01   +5.810550837771181e-02   +2.240434751057164e-01   -3.841043514405845e-02   -2.063074145461487e-01; +3.754252616139960e-01   -1.741772131145680e-01   -1.741883840494688e-01   -1.569383540067487e-01   +4.200319564382039e-01   -7.437181045270876e-02   +3.352954637671651e-01   -1.196230478532591e-01   +3.530248059224188e-01   +2.802836620510091e-01   +1.966176822301668e-01   +3.846519160599864e-02; +3.756265750043429e-01   +7.836425895638968e-02   -1.361872658426174e-01   +3.941291197707938e-01   -1.189465581279947e-01   -1.886778911078305e-01   +2.932050041269560e-01   +1.250525481835500e-01   -2.260569336458726e-01   +3.750273299389775e-01   -4.499255635124535e-01   -1.205280454947860e-01; -1.594325079875876e-01   -5.025973233850005e-01   +2.570666559564572e-01   -4.248606022794801e-01   -1.166949120695155e-01   +2.571540134998083e-01   -1.315601649047893e-01   -2.032250721043663e-01   -1.309091303335045e-01   -1.159196987252248e-01   +3.650266724747875e-01   -1.846990661754024e-01];
L2E_Input1_iAMPA_netcon = [-4.223486282268327e-01   -1.191750788938516e-01   +1.364048652130206e-01   +2.525052617868748e-02   +5.128022349213236e-01   +4.914740888434599e-02   -2.134613941875278e-01   +3.534380694925554e-01];
L2I_Input2_iAMPA_netcon = [+1.912795411150070e-02   -7.270478184667209e-02   -9.191518853604641e-03   +4.314456484875938e-01   +1.225828850203644e-01   +1.332401973100526e-01   +1.817609832127574e-01   -1.817868656319533e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
