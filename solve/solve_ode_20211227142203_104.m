function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.882208123564922e-03   +1.159538010742652e-02   +3.608472424428915e-02   -2.216125504909103e-03   -2.691937643787608e-02   -1.417294920543016e-01   +2.292750907135780e-02   -7.267462170599215e-02   +6.558779554930926e-02   -3.663483152848097e-02   +4.966277373719138e-02   +1.147587119335004e-01   +5.532018930442754e-02   -5.095776807793296e-02   +3.355924795367991e-02   +1.068937390969889e-02; -5.822141155617357e-02   +6.355595789493391e-02   -5.727450633170007e-02   +6.272024700717306e-02   -5.275021652581021e-02   +7.053558239790532e-02   +1.996698347985419e-02   +8.673732598042884e-03   -9.477553521682892e-02   -8.069406457112427e-03   -5.204197100480969e-02   +7.132337432163272e-02   +4.713823076417739e-02   -5.261635633897616e-03   -8.075019088904668e-02   +7.683837954687774e-02; +2.561774240118036e-02   -1.047412881593864e-01   +3.742886385681209e-02   +1.044982410698108e-01   -4.423748398390093e-02   -5.827441936320678e-02   -1.403989161657787e-01   -1.151017722581498e-01   -1.003673483131638e-01   +3.440941309763070e-02   +7.041455732037048e-02   +3.786875107354721e-03   +1.092537957437964e-01   -5.875481075130654e-02   +1.391356127997106e-01   +5.189010172022124e-02; -1.077672837587359e-02   -6.324154165657922e-02   +2.916513306213764e-02   +1.284199092973570e-02   +2.183008671335763e-02   +8.262003255928961e-03   +6.581433304108003e-02   +2.088332606678094e-02   -1.433094088570771e-01   -8.461223808116980e-02   +2.324117527150522e-02   +6.261996564992649e-02   +1.002127825277456e-01   +1.380137057144033e-02   +5.598722733122277e-02   -9.217903753179558e-03; +2.568400762758943e-03   -1.889417318648443e-02   -6.640544784790128e-02   -2.032705248502478e-02   -1.433356840817201e-01   +1.735652566957195e-02   +8.980102196992423e-02   +1.043800591818983e-01   +1.291612523088507e-01   -1.082603014698758e-01   +4.879212751729759e-02   +7.966669498484910e-02   -3.567620802507183e-02   +7.088317345077838e-02   -2.549436777679848e-02   -5.038345249356038e-02; -1.146903617354390e-01   +1.272588764777258e-01   +1.109273582153530e-01   -9.138306645206845e-02   +5.794006406597890e-02   +6.017643704091392e-02   +6.270535998720642e-03   -3.922483079667347e-02   -1.615662484911129e-03   -3.100442518521822e-02   -3.710475307485887e-02   -2.179853546091849e-02   +1.279939290458991e-01   -7.372902824815222e-02   -1.174749106714831e-01   +7.123757372817900e-02; +2.048682560652924e-02   +1.303994496457240e-01   -1.541019580642709e-01   -1.327404646211053e-01   -8.040285935195399e-02   -5.721474605170836e-02   +2.465005553852037e-02   -3.781613976646736e-02   +5.720083624165521e-02   -2.631152266797886e-02   +3.467108542196434e-02   +5.765637080291828e-02   +8.724457018849645e-02   -6.648717259592934e-02   +1.070096146464956e-01   +1.053217925743091e-01; -3.511498543529745e-02   +1.539525455920490e-01   +1.382134326264045e-01   -1.006891913083139e-01   -4.112876403054417e-02   -6.829967325268524e-02   +8.313153461419573e-02   +5.894752226061060e-02   -5.214158593758730e-02   -6.257118085994208e-03   +8.477858387631296e-02   -7.751378017468084e-02   +6.822118119958734e-02   +1.951086240740355e-02   +5.021520089408478e-02   +4.115968380943129e-02; -8.700647647549523e-02   -8.175825627129790e-02   +9.675994029361761e-02   -9.695938549883661e-04   -2.518930962625857e-02   +1.923600312397293e-02   +1.270473763493954e-01   -5.165222652520041e-02   -7.412105547224723e-02   +9.676543057607411e-03   +2.361056077894174e-03   -2.581056641872259e-02   +1.217540905458280e-01   +9.551208636627419e-02   +6.812809673605001e-04   +3.467179042741764e-02; +3.842239989832411e-02   -5.897078489491989e-02   -5.699792562995321e-02   +1.426507924338919e-01   +1.922424105548681e-01   -2.145748426962477e-02   -4.052688299834301e-02   -6.259261450977836e-02   +3.761405564317891e-02   -1.628268903110408e-02   -1.024610435292918e-01   +4.915860391613115e-02   +9.920447034927038e-02   +1.108313593099871e-01   -4.710882043631649e-02   -1.468281559923255e-01; +1.106953778116273e-01   -9.736309242786803e-03   -3.066213988006235e-02   -4.821400105489069e-03   +2.728289551783187e-02   +1.361696234144126e-01   -2.948567681933002e-02   -3.945615151479927e-02   +1.186263125183010e-01   -7.880358283723177e-02   +4.706207262322300e-02   -3.288944861695507e-02   -1.317512299848315e-01   -7.769483323454052e-02   -1.520727372697363e-01   +1.364858646408673e-02; +3.342851027697932e-02   -1.617652944269676e-01   -6.950962778390513e-04   +4.956002776599130e-03   -4.749883910980914e-02   -7.786660402632300e-03   +1.752774446990286e-02   +8.430397777136731e-02   -9.653841235490325e-02   +7.734579415166515e-02   +6.331020894580446e-02   +5.681286306553544e-02   -5.972620621303589e-02   +5.323952750966032e-04   +7.439685339999288e-02   +7.597568708921587e-03; +1.050014402045583e-02   -3.919708066931630e-02   +5.262975213959551e-03   -8.144375643330880e-03   -9.154703242303500e-03   -6.867235309601491e-02   +1.086093631181224e-01   -1.173468499557167e-01   +1.738533336090646e-02   -1.136026946259420e-01   +2.860039545164277e-02   +5.642502452291785e-02   +4.867952832573839e-02   +8.063904842921263e-02   -4.343734849730074e-02   -3.768908452059927e-02; +7.947077151823998e-03   -4.353593543122756e-03   -3.472629336257640e-02   -2.712000322871901e-02   +9.715819367829452e-02   -1.188419572330531e-01   +1.167309725859950e-01   +5.544757067751240e-02   +6.901856666842879e-02   -8.584359853340776e-03   -2.163567958726231e-02   -1.049828117037578e-01   -6.519302230380908e-02   -1.254841083275118e-01   +1.266534595533539e-01   -1.286137644009624e-02; +1.000082383059979e-02   -6.863730102069707e-02   -8.000709242270606e-03   +4.894138956388400e-02   +8.626871392968673e-02   -1.090497051558674e-01   +6.961894759457504e-02   +8.299809328317441e-02   -4.797994597620538e-02   +7.023114817285128e-02   +2.630775822347544e-02   -2.469816618217240e-02   +3.322648406050074e-02   -1.151788984200852e-01   -1.296197379892104e-01   -2.138884397338846e-01; -7.452536862111039e-02   +4.494160392474514e-02   +8.739351403664729e-03   -1.042344608244876e-01   -1.302069838903814e-01   -3.488432193279760e-02   -8.524480853180148e-02   -1.315781944472960e-01   -3.266892295158343e-02   -3.217677787639903e-02   -1.131951309773066e-01   +4.065819699352284e-02   -4.588525238416879e-02   -3.870418102132509e-02   -1.164899084697763e-01   +7.156749405513796e-02];
L1E_L1I_iGABA_netcon = [-7.303853029142264e-02   +4.642492840164246e-02   -5.370519553417109e-02   +1.719781081930116e-01   -3.680776702985225e-02   -9.940095105959725e-02   -1.588854941545313e-01   -4.693050387724444e-02   +8.005196599869946e-02   -8.369183134837310e-02   -5.802087138820812e-02   -1.398025042752984e-01   +3.564787191831165e-02   -6.431783349146085e-02   -1.931902807397147e-02   -1.299604392763319e-01; -1.472359431070048e-02   -4.910599065444910e-03   -2.002008634925355e-04   +3.520778740508304e-02   +1.955889514663378e-01   -8.875480960627982e-02   -1.028883462640906e-01   -8.112071729588188e-02   +3.356144085342361e-02   -7.454699298489248e-02   -4.627535263668719e-02   +1.443160726254971e-02   +1.327837924302580e-02   +2.242377871909601e-02   -3.350697795547315e-02   -2.347830530867559e-02; -2.042056838297477e-02   +1.553888773198406e-01   +8.829906541738019e-03   +5.831736022889230e-02   -7.922925463274702e-02   +9.546936627555493e-02   -5.253963195485783e-02   +1.074858222711500e-01   -9.953212374810499e-02   -8.250948952856305e-02   +1.068816746789264e-01   -1.760838021072447e-01   +4.643527317283495e-02   +2.561898690521315e-02   +4.194671803530566e-02   +7.489079123832279e-02; +5.271285071190873e-02   -8.673773392864575e-03   +2.181943941457389e-02   -5.960705206294502e-02   -4.388232003274980e-03   -1.830713084016705e-02   -1.644746766944725e-02   +4.872988590418180e-02   -8.581928549821589e-02   +6.312890088581161e-03   +1.913284503108538e-01   +9.559441211845257e-03   -1.319544562424704e-01   -1.185654538290899e-04   -8.576964637073824e-03   -7.529467107613090e-02; -1.576880476729600e-01   -5.242603767950126e-02   -9.853903238702050e-02   -6.390033397925247e-02   +4.483647991097350e-02   +7.701887975578856e-02   +1.016864270726569e-01   +1.775677295963156e-01   +1.559125103096617e-01   +1.804862292455460e-02   -7.334279110560707e-02   +5.957656190227791e-03   +1.049356435359831e-01   +7.394817769034338e-02   -4.051201473379505e-02   +4.202468251109232e-02; +1.539687432967756e-01   +2.018425819595677e-02   +7.599530050100572e-02   +4.509974642823496e-02   -5.375518322472938e-03   -1.519277065118144e-02   +3.735241405627386e-02   -9.553052396198325e-02   -2.600048397426870e-02   -1.917999620202310e-01   +2.819315337357272e-02   -4.618379101111531e-02   +3.860618674447174e-02   +6.792506055739543e-03   +1.075720204250755e-01   -3.573152077150853e-03; +1.382516294163925e-02   -1.776402092247335e-02   -1.500825898434998e-01   +6.588746352882807e-02   -9.822524983402460e-02   +2.292840583634329e-01   -1.541086406161894e-02   +1.008768954680296e-01   -6.428192586892889e-02   +7.613515066284655e-02   -1.008712357109308e-02   +5.697589932277090e-02   -4.330103030149814e-02   -9.291934445146394e-02   -3.936132898689093e-02   +7.394123984106436e-02; +4.614623904006679e-02   -8.216043864100678e-02   -4.044342565641189e-02   -5.254426709724563e-02   -8.812428012511860e-02   -1.002691857136987e-01   +5.534282956255550e-02   +4.791369411982828e-02   -3.216588887821877e-02   +2.114350751621413e-02   +3.263727749244545e-03   +3.077607784118437e-02   -3.748668492317362e-02   +6.854145426657934e-02   +7.414997569767467e-02   +1.341900995837550e-01; -5.798264419085163e-02   -2.371516746675958e-02   +1.218904285507406e-01   +8.678390629467481e-02   +9.818671606216886e-02   -5.705395507939012e-02   +5.186353264372568e-02   +4.415040030753692e-02   -9.804860412145264e-02   -1.397011040278229e-01   -2.959703319733043e-02   -1.297237249178594e-02   +8.649096996866260e-02   +9.787600146593395e-02   +1.310295628420352e-01   +1.796403164542872e-02; -5.928926956893771e-02   -7.304157263196226e-02   -9.662119410137106e-02   +1.409136913070291e-01   -8.311020336725436e-02   +1.374941276742986e-01   -5.562882020797530e-02   +1.456865143249875e-02   -1.089196512741878e-01   -3.740223072114257e-02   -1.015264728639973e-01   -5.738177048074135e-02   +1.831659685738264e-02   +6.557628852447885e-02   +8.818692048429659e-04   -8.802408877003037e-02; -1.715048470146163e-01   -1.387885119887728e-01   -3.861178799579035e-02   -1.227169062195298e-01   -8.271595449058057e-02   -1.436338594352682e-01   -3.751774681522784e-02   -8.134751218416973e-02   +1.497433679053737e-02   -9.318648010260049e-02   +9.315798560663082e-03   -4.429081984052380e-02   +1.046024482248470e-02   +4.397855550827096e-02   -1.010161923048070e-02   -9.545593552673995e-04; -5.284199774021268e-02   +1.416271401521139e-01   -3.949787658300030e-02   -6.069681179101192e-02   +3.647378152356497e-02   +6.677872775974480e-03   -7.140099744427239e-02   -6.054283741338497e-02   +1.356044230436663e-01   -3.162521997481006e-02   -1.168464093260727e-01   -1.266809631791073e-01   +4.166794446848174e-02   -1.979931486800503e-02   -1.107426924830861e-02   +8.092274582731507e-02; -2.844399842196756e-02   -1.878584519974853e-02   +9.761003359500215e-03   +8.498856838620653e-02   +4.286616805136709e-02   +1.048002909294270e-01   -1.283195271223284e-01   -5.781790976973336e-03   -9.070227808717193e-02   -1.632248087358536e-02   +4.711238793819560e-02   -3.506872907672798e-02   -1.534359214099508e-01   -6.356637014077567e-02   -1.283917279015536e-01   -1.756879812783880e-02; +9.285441737111971e-03   -8.524892250033823e-02   +6.103071422095279e-02   +4.012594033243631e-02   -1.392386389838850e-01   -6.666022218222011e-02   -2.807222462036845e-02   -7.268048963411373e-02   +9.037100819825304e-02   -4.450508686412397e-02   -1.433380236666545e-01   +9.678233905955319e-02   +4.472583268934355e-02   -1.724974661265373e-02   +1.165175973423662e-02   +9.623257223507337e-02; -7.824448159416407e-02   -1.438172563098741e-01   +3.157643897123848e-02   +5.819373543787680e-02   +2.389078271001059e-02   +1.517194368059351e-02   +1.230142152809929e-01   -6.266990442815187e-02   +9.884860832099462e-02   +3.502448792339392e-02   -2.324319767766684e-02   +1.285446789315255e-02   +9.977213233895127e-02   -1.156919425809875e-01   -1.354767349800079e-02   -1.578788630660045e-01; +5.772658025355504e-02   +1.379633015983348e-01   +1.724553509118736e-01   -9.227736622875735e-02   +7.254807098552635e-02   -1.390276815521299e-01   -2.781127319927819e-02   -6.103364897098672e-03   -6.477181012152949e-02   -3.830349735400129e-02   -9.331911081623800e-04   -7.336959857835736e-02   -3.762904367276358e-02   -2.102826282262039e-02   -6.117267104290503e-02   +1.993321630496215e-02];
L2I_L1I_iGABA_netcon = [-3.195750794713417e-02   -4.655301994709126e-02   -6.136650115111461e-02   -1.347564706526980e-01   -6.188685203069800e-02   +6.272588459458487e-03   +7.819536497190721e-02   -1.079200968232423e-01; -5.153960630465247e-02   -4.170290091625307e-02   -2.238626136119069e-02   -2.007408615460828e-02   +4.539871769554421e-03   -1.285873763746614e-02   +2.110651791571102e-02   -1.023445896234570e-02; -1.087038601324402e-01   +4.419626387941478e-02   -7.133846091050983e-02   -4.014364116067008e-02   +2.210078273567547e-01   -5.282925405888970e-02   -4.501983857647608e-02   -1.249432261734288e-01; -1.128726547420435e-01   +9.069445356777160e-02   -2.133772074277380e-01   +1.124266802380318e-03   -5.785270289280347e-03   -6.267382280629452e-04   -5.352472423814406e-02   -7.622120129321372e-02; -8.535993361460555e-02   +8.799891453465087e-03   -8.673304407174556e-02   +9.088207958165868e-02   +4.327406450238803e-02   +9.363912679877205e-02   -9.172832733833193e-02   +1.076495051337029e-01; +1.114455589692917e-01   +4.266989478333504e-02   +6.126696102625372e-02   -4.064895635340673e-02   +1.090592253525649e-01   +9.062474456533973e-02   -9.733554432875935e-02   -9.278624656462366e-04; -8.845849857591245e-02   +1.036755249112901e-01   -1.508271785411938e-01   +3.412591396053013e-03   +5.535196903045568e-03   +6.274754994130374e-02   +6.126067832537537e-02   +4.513411139113443e-02; -1.021207011586831e-02   -5.979059302515395e-02   -1.636188469389316e-01   +6.303356718169617e-02   +5.423898449212376e-02   +2.622299386931806e-02   -1.037708391708064e-01   +8.912317106496914e-02; -1.429408670641412e-01   -9.266850826533643e-02   +8.089799393993463e-02   +8.147691335472403e-02   -3.977042590363442e-02   +2.619536380356853e-02   +1.153162001810451e-01   +1.566603564366973e-01; -8.274868150181264e-04   -4.145937430892505e-02   +3.504592119573893e-02   -5.170426827182913e-02   -7.625157488305204e-02   +1.114268720369191e-01   +5.043728250958775e-02   -1.289889783423493e-01; -8.642439567780066e-02   +8.291569311066312e-02   +2.432695314638347e-02   +2.009215214131208e-01   -1.109494468956191e-01   -1.186466391621205e-01   +5.043048624032320e-02   +9.803392419835605e-02; +8.137445223253430e-02   +6.820320650506514e-02   -5.826471919953394e-02   -3.002972478667585e-02   -8.386793223596541e-02   +1.103218390709240e-01   -6.013530957125601e-02   +6.775682857161355e-02; -7.760590825839454e-02   +2.662623699461499e-02   -4.059838748666517e-02   +1.626398197500435e-02   -2.341679550366910e-02   +1.319698128793794e-01   -1.499775718176476e-02   -5.587939671417286e-02; +1.157970318832641e-01   -8.436679769574397e-02   +5.714114603739171e-02   +1.326462793227803e-01   -1.131331684356532e-01   +5.451430969769158e-02   -9.683157357310795e-02   +5.184939376444654e-02; -3.472393792471870e-02   -9.996251801834538e-02   +7.279120828533957e-02   -7.173020235495356e-02   +9.713043124227206e-03   +1.234511950091544e-01   -4.394741139711283e-02   -2.762684294778385e-02; -1.641475913165348e-01   +3.038501820325762e-02   -7.110329200251388e-02   -4.030532759939034e-02   +7.147214611313837e-03   +6.625888850285963e-03   +4.414515060732049e-04   -9.884681641458514e-03];
L1I_L2I_iGABA_netcon = [-2.319124876157290e-02   -6.160285295035048e-02   +4.988425889883785e-02   +6.162694351285950e-03   -1.598342985781691e-01   +4.253747294640549e-02   -1.128485233282617e-02   +1.413772009027218e-01   +1.080919713460863e-01   -1.947327441189158e-02   +3.334427183964308e-02   +3.306319554061952e-02   -2.492809842230303e-02   +4.870172302003881e-02   -9.535476222248651e-02   +7.093287178653509e-04; -1.591896108038491e-01   +4.809431502972045e-02   -1.740607660260489e-02   -4.749158581223185e-03   -6.844376268429340e-02   -1.345042998682459e-01   -6.486167794351948e-02   +1.834983221066608e-01   -4.518072893667560e-02   -3.554541085152328e-03   -8.378791846698166e-02   -1.928358212644639e-01   +1.250620248674797e-02   +3.835725814099328e-04   -6.894867062843468e-02   +6.635879855692621e-02; +3.044882724108535e-02   +4.465416025381071e-02   -2.805784812892703e-02   -6.798554683477091e-02   +5.781287190732026e-02   +2.997726759698993e-02   -4.575286717667167e-02   +3.288902224841662e-04   +1.775269139364819e-02   -8.701299318011886e-02   -1.438960999539395e-02   +6.472775649013089e-02   -4.094756324525554e-02   +1.197291340043131e-01   -8.415400764729639e-02   -2.917000636813428e-02; -4.301272899273208e-02   -1.209647306168495e-01   +1.198791506577103e-02   +5.102849296476612e-02   -1.180187786935365e-01   +7.487431681102658e-02   -9.194132160529535e-02   +5.856798466663409e-03   -8.586249024392449e-03   -1.414910864108060e-01   -9.200553821468122e-02   +5.528805334953396e-02   -7.367029828373406e-02   -3.329821952179546e-02   +6.327713933943296e-02   -1.753782769040775e-01; +7.864209887476946e-02   -4.706312022311057e-02   +3.509409106315933e-02   -2.864432096312998e-02   +6.073271902748754e-02   +9.537954509711911e-02   +5.049418078432930e-03   -4.457961319998664e-02   -7.160246972799207e-02   +4.894409403072052e-02   -1.938260771757582e-02   -4.728696800786203e-02   +4.197683530425612e-02   +5.615244291044270e-02   +4.528781395042605e-02   -2.389332111221017e-03; -1.693429334852631e-01   -3.787789027946886e-02   +2.290120770591645e-02   +8.631477308004942e-02   -5.741385550965006e-02   +1.118853104049420e-01   -3.276725737432755e-02   +8.018555493873028e-02   -1.107874574594234e-01   +4.191744557046029e-02   +2.728706523334037e-02   -5.600172732411375e-03   +3.938624614937470e-02   +8.046831384600162e-02   -1.005871229929619e-01   -1.547711375067699e-01; -9.449872262135707e-02   +2.168732385998296e-02   -3.114243471581300e-02   -9.314875866064125e-02   +1.746977347290898e-01   +1.345798808753373e-01   +2.723304686766219e-02   +1.920206734067209e-01   -6.406591532674216e-02   -1.371891882386383e-01   -2.721540757468446e-02   +1.104444043668484e-01   +6.168878210313020e-02   +1.887274451048561e-03   +8.602081656011790e-02   +3.887274691128595e-02; +8.141205046391571e-02   -1.435410261630562e-01   +1.652951159024976e-02   -2.889672086951158e-02   -3.301221878465817e-02   -2.546770277418684e-02   +6.207515273700768e-02   -1.413516157327234e-02   +2.290335022882077e-02   +1.137675782560526e-01   -4.305947386707135e-02   -1.822316848373532e-04   -7.557874758334537e-02   -1.076268652030145e-02   +1.048639980032513e-02   -9.360501398526722e-02];
L2E_L1E_iAMPA_netcon = [-1.399853614876637e-01   +5.014735617438051e-02   -3.886165069968243e-02   +5.741637160559855e-02   +4.523133139911097e-03   -1.828481917904203e-01   +4.480665258850481e-02   +9.227666849595706e-02; -3.069978290872788e-02   -4.144946852310218e-02   -8.341204674905305e-02   +4.190737182302472e-02   -2.636243313777569e-02   -8.210142714928033e-02   +7.984295859383164e-02   +3.864412879926377e-02; +1.135078812328204e-01   -1.336334830970484e-01   -1.322304179661746e-01   -1.719225172427417e-02   -6.484321725995572e-02   -7.605457379203778e-02   +7.761161604677996e-02   +4.941658745861056e-02; +8.131669582012689e-02   +9.745462217194785e-02   +1.810991425991467e-02   +1.885563300105754e-03   -6.440386095907605e-02   +1.045859718046979e-01   -3.360340735130912e-02   +1.065430679806345e-02; +4.909870483904286e-02   +7.787239057180739e-02   +1.469423241697538e-02   -4.758851542042854e-02   -7.852775263656021e-02   -4.161881107857286e-02   +1.069784794148362e-01   -4.165859131308807e-02; +8.818833578230278e-02   -9.382113501239667e-02   +3.834023463753548e-03   -8.248897558700820e-02   -6.785268326895655e-02   -4.762965034949358e-02   +7.907656082926214e-03   +1.458880182662376e-01; +4.258329993119490e-02   -2.014626758723353e-02   -7.126410705026216e-02   -4.692976974381165e-02   +2.901818026023837e-02   -4.365482254047886e-02   -2.763244292311120e-02   +1.298286068723393e-01; +1.013088054099066e-01   +5.019880276204719e-02   +3.974189369740069e-02   +4.791985300709311e-02   +6.726717907351699e-02   -7.286042596646973e-02   +1.238370779203887e-01   +4.473261537279834e-02; +2.989005091871934e-02   -2.222577270504061e-01   -5.999490215847955e-02   -2.891319144811724e-03   +6.799239812822286e-02   +1.452666862105163e-02   +5.077436975584590e-02   -1.510571346374439e-01; +1.007302026488815e-01   -1.017560692707853e-01   -4.172905493596591e-02   -2.095028922685844e-02   +3.791314901588330e-02   +1.009610257581786e-02   -4.437625618191037e-04   -3.782579750476321e-02; +7.844887976784019e-02   -2.698325472275787e-02   -3.006001825742117e-02   -8.308921462504401e-02   +1.634760024369611e-01   -7.744180398203000e-02   +9.930943808714798e-03   +3.086976816222503e-02; -6.583063772297188e-03   +6.012984733467199e-03   +6.461385687523444e-03   -9.447573555160393e-02   -1.516761076982328e-01   +4.248803532847533e-02   -4.289157034134468e-02   -1.232528708237650e-01; +5.116367857862562e-02   -1.205452028230799e-03   +1.333504970668982e-02   -1.399376244861294e-01   -5.281339828921634e-02   -9.121480018375733e-04   -1.789071087822385e-02   +1.107283192738534e-01; -1.079660475105195e-01   +6.291043247325817e-02   -9.091573982337282e-02   -8.637736008641049e-02   +6.006957523310200e-02   -7.782502315213827e-02   -3.411601055790443e-02   -9.140007590304883e-02; +1.224182948819610e-02   +4.801980823291785e-02   +2.641028885283809e-02   +4.365957040769771e-02   +5.962388956827167e-02   -6.514396922274000e-02   +2.863223724319765e-03   +3.249931151609471e-02; -1.119401597100475e-01   -2.290166630925769e-02   -3.284802662769448e-02   +2.388269824525459e-02   -2.753339185953354e-02   +1.780550810785537e-01   +4.358507011010015e-02   -7.735899270189991e-02];
L1E_L2E_iAMPA_netcon = [-4.971602650142587e-02   +8.513711894385864e-02   -1.095912327067787e-01   -3.837282096133911e-02   +3.197522274085203e-02   +1.075251144046420e-01   -1.864675040630547e-02   +2.150407129720118e-03   -9.592280239393181e-02   +2.738350146136632e-02   +1.777822316041594e-01   -6.136353311497886e-02   -6.762611944422159e-03   -4.779661739126909e-02   +2.495969333011516e-02   -1.222513611917710e-01; -5.264096190354192e-02   -1.148435461347346e-02   -5.085219187552351e-02   +9.566185427397529e-02   +1.709571482175565e-01   -6.819660690842449e-03   +7.485267109022600e-04   +6.593231644966499e-02   +4.800267701743360e-02   -5.263422379800059e-02   +1.665628684380710e-02   +5.401263463733090e-02   +1.583959272371109e-02   -6.729399386576911e-02   -1.088512816805111e-01   -1.193091236290052e-01; -3.689935768579634e-02   +3.831731086370502e-02   +1.095698574357790e-01   +4.558165328285761e-02   -4.385238436294969e-02   -4.294941496940661e-03   +3.107785211053794e-03   -4.747632144588329e-02   -1.284169082443829e-01   -6.394819238766175e-02   +6.815310000020723e-02   -8.183636655629986e-02   +2.602578949563606e-03   +1.974186295455514e-01   +2.559225449291940e-02   -1.081401703531860e-01; +1.252770759386888e-01   -6.166690114569130e-02   -5.528560201768814e-02   +6.043411599697261e-02   -6.541835619486651e-02   +4.497340653828978e-03   +2.212132290691474e-03   -1.325404792605981e-01   -1.010329134631037e-02   -8.518053219443238e-02   -4.142933895721813e-02   +7.992146482947483e-02   +8.977710380387686e-04   +2.059598753447917e-02   -8.165757574232363e-02   +1.908855660594919e-02; +2.135803507107931e-01   -1.158337622242868e-01   +4.896156813878606e-03   -1.545771223302878e-02   +7.640196891433129e-03   +1.640863013543598e-02   -1.005129945227588e-01   -1.046982244260185e-02   +3.921794220646120e-02   -1.653849825436985e-02   +1.256086731014229e-01   -8.215254850021741e-02   -7.198895681983282e-02   +2.047588297608703e-02   +6.771966032503943e-02   -6.604687258102643e-02; +6.382531772671876e-02   -6.103322902825601e-02   +3.953474441363202e-02   +1.047676506878412e-01   -2.632081139625724e-02   +1.315105618769283e-01   +2.160854750259124e-02   -5.547759267511275e-02   -1.427034241467792e-01   -4.609936618922565e-02   -1.193178771826307e-01   +8.732899904040484e-02   +1.057462631980424e-01   -7.673851385321040e-03   +1.137356530933047e-01   -2.658700303949768e-02; -3.623314003131337e-02   +5.075154693963566e-02   +5.562334377045813e-02   -1.188000302913955e-02   -8.830676080242721e-02   +3.620354851607708e-02   -1.056200221011413e-01   -6.798925302547640e-02   -1.835768675095205e-02   -1.013209421124244e-01   +7.888889903205298e-02   -5.201837467059118e-02   +3.403480441812105e-02   +6.413246151611877e-02   -3.338358347350840e-02   -1.718909138840851e-02; -1.162576471912354e-01   -5.703076671573828e-02   +1.526200278221165e-02   -4.355255015439750e-02   -2.216633659633612e-02   -6.510421000896922e-02   +3.445892230204761e-02   +1.976386860029239e-02   -6.743470540310695e-02   +6.465117449312172e-02   +1.103617820183352e-01   +7.210369071834133e-02   +3.679816405603017e-02   -7.685423544667468e-02   +8.000885466478772e-04   +1.565972171796456e-01];
L2I_L2E_iAMPA_netcon = [+1.767121633299783e-01   -7.454865206360603e-02   +2.068365874226919e-03   -9.610611808236333e-02   +4.878191984391901e-02   +6.037123882390095e-02   +2.617135146867997e-03   -7.787169189136213e-02; -2.814198447296738e-02   -2.079016372857178e-02   -7.878716779820627e-02   +1.203638120741200e-01   -9.160749134617974e-02   -2.599380030055950e-02   +2.508599525414565e-02   +3.303844374692287e-02; -4.747545663569748e-02   +3.876091641437168e-02   -8.072207949774340e-02   -2.188750064923560e-02   -1.147296186893315e-01   +7.091062047609424e-02   +2.129929691253703e-03   -1.114625460412788e-02; +6.034872481383816e-02   -6.887470876803055e-02   +1.159244268543390e-02   +9.491736711604033e-02   -9.613405003186183e-02   +7.789308245182495e-02   +9.355554933573729e-03   -4.834199733414810e-02; -4.810141288838471e-02   +1.080237116785510e-01   +4.105428235833277e-02   -1.783646491066209e-02   +1.699601555641458e-02   +1.123707884795208e-01   +1.358651741989956e-01   +1.241488380025291e-01; +3.194198867955968e-02   -1.084607949936990e-01   -8.846991019270203e-02   +1.506822793590240e-01   +7.112937427890194e-02   -7.890191982074288e-02   -1.227793050967285e-01   -7.048734032465161e-02; -1.097074799710073e-01   +6.306525077617990e-02   +2.243426895602026e-02   -2.567538437882694e-02   -9.419779221251359e-02   +8.293096433986667e-02   -3.524119422080104e-02   -3.824947539025476e-03; -8.165347760215826e-02   -4.842704711146853e-02   +5.483936727541930e-02   -5.739953564815586e-03   +1.118692377710588e-01   -7.950180916880430e-02   -8.674495704351094e-02   +1.512871303667001e-02];
L2E_L2I_iGABA_netcon = [-2.812845066040164e-02   -9.325647531633101e-02   -9.227290723209797e-03   +1.484219314615322e-01   -2.459764401954027e-02   +3.362726567585475e-03   +2.945453258701988e-02   -1.274079353620853e-02; +9.158167724385025e-02   -1.024276042160653e-01   +1.370933592671809e-01   -1.223351318663322e-02   +9.423562532088449e-02   -3.020361175598536e-02   +4.089030863961512e-02   +1.155142757230039e-01; -1.446551731088717e-01   +1.937659914896689e-01   -2.823460209115678e-02   +8.554342261375614e-02   +7.459982429856615e-02   -5.765293884121873e-02   +1.072354980437036e-01   -5.749966065279312e-02; +8.994864920014625e-02   +1.292187873049274e-02   +7.645095043563993e-02   -9.487930723016108e-02   +4.733743151582140e-02   -1.104856890143545e-01   +2.927065671726293e-02   -4.010024876107970e-02; -9.959939920680261e-02   -6.445682808625144e-02   -4.682440407250123e-02   -1.256999475963638e-02   -4.218500574518395e-02   -2.372159196827953e-02   -2.067053868114029e-02   +2.781293472048017e-02; +2.681391183066295e-02   -1.484119471011934e-01   +1.001416436085209e-01   +5.194406625171441e-02   -2.158133762363669e-02   +1.950115593130366e-02   -9.211754394934775e-03   -2.022998989846028e-02; +1.846857515465423e-02   -3.746965444180757e-02   +7.554528441303074e-02   +1.748155269292176e-01   -1.541101331053944e-02   +9.927086525061096e-02   +8.474964713068063e-02   +6.385467767512279e-02; -8.645750001471927e-02   +1.767253490833518e-01   +2.439652237174066e-02   +9.817931851274365e-03   -7.920886101917386e-02   -5.620582976343501e-02   -4.721037991278395e-02   +6.371115148643491e-03];
L3E_L2E_iAMPA_netcon = [-7.055734903172645e-02   +4.465783595201654e-02   +2.018051015186043e-02   -3.508878035492171e-02   +1.388829486075171e-01   +2.828428478866989e-02   -6.518467881016794e-02   -9.615558848458968e-03   -1.030277587165664e-01   -3.910758467477376e-02   +8.698042313790676e-02   +8.129121422164202e-02; +5.290205115559873e-03   -4.924300839370500e-03   +9.849415139432439e-02   -2.809152577690553e-02   +6.050728313168825e-02   -8.832088294494392e-02   -5.456808141909373e-03   +1.500970533536687e-02   +1.318039670341499e-01   +2.922046889378201e-02   -4.092484137256244e-02   -1.012941039926223e-01; +9.184516843987685e-02   -2.794846165855515e-02   -9.245981412868609e-02   -2.607150649431882e-02   +8.679932416426397e-02   -1.954545822248766e-03   -1.754958392498212e-02   -5.984145635610508e-02   -8.589657580763373e-02   -3.272839124241735e-02   -1.486709261036720e-01   -3.923614987364739e-02; +3.882063432452770e-02   -9.183553234136124e-03   +7.347092806700521e-02   -3.654825908414124e-02   +1.701979609988187e-02   +9.272464436255692e-02   +8.276499908189102e-04   +1.094285891761695e-01   -4.036036915707719e-02   +1.165189392813526e-01   -1.379100952206644e-02   +2.152309252497191e-02; +9.404461854115026e-02   +4.357654974424821e-02   -5.388902356139910e-02   -3.800255324232617e-02   -4.583474396685482e-03   -7.457287912739015e-03   -1.127324117981333e-03   -1.164948376387835e-01   +7.577585793644342e-02   +3.324745650201136e-02   +5.554070236278183e-02   +5.539632523771401e-03; -1.369621403671286e-01   +8.385159876045044e-02   -9.616827745307688e-03   +8.426298322314466e-02   +6.612514102751602e-02   +1.122553628232477e-01   -7.384904042429008e-03   -3.322092544378619e-02   -1.150769282015719e-02   +3.188351489724728e-02   +1.402109895649466e-01   -9.575985633639318e-02; -3.772976490832243e-02   -7.963010792840292e-02   +1.637295898600797e-02   -9.260594948571474e-02   +1.017660181841121e-01   -1.174495706713747e-01   +9.366713972507897e-02   -9.698960861178276e-03   -8.726018233349697e-02   +5.802524281106805e-02   +3.581821409988770e-02   +6.837651187474006e-02; -1.447348823107672e-01   -1.232864131733596e-01   -8.284655310297468e-03   +4.314733521466804e-02   +2.850840268195753e-02   +1.839439393037797e-02   +7.990767093769297e-02   +8.542026126734932e-02   +3.358558307755110e-02   -1.483135856874046e-02   +5.944062248536120e-03   -1.004855121273981e-01];
L3I_L2I_iGABA_netcon = [+9.014301627362041e-02   -7.658250596915535e-02   +7.167648622427962e-04   -3.266748526762210e-03   -4.418935902050388e-02   +6.067776061401475e-03   +6.786304409617107e-02   -2.480470393680090e-02   +8.863187589271132e-03   -1.153808782997363e-01   +1.067531833768598e-01   -1.558632649162753e-02; +8.987244944145131e-02   +5.587234698152430e-02   +3.712623118625040e-02   -6.451662643489402e-02   -3.089853291733932e-02   -5.018971472656249e-02   +8.783472290212051e-02   +9.865453287774109e-02   +6.144306922749175e-02   +2.193357519462922e-02   +5.675925665916605e-02   +2.603664252300471e-02; -9.041530424990613e-02   -1.480493283903580e-01   +6.776710215774695e-02   +1.351051732065989e-01   +1.183260434675531e-01   -9.234983621480609e-03   +6.659569021449796e-02   -8.437631734783876e-02   +7.508964735670734e-02   -9.046051194075042e-02   +8.832612831959222e-02   +6.557633842686035e-02; -7.176163181479465e-02   +1.272350422252947e-01   +3.430571016461879e-02   -2.467172879484500e-03   +5.764198204668722e-02   -7.506689553848246e-02   +9.311228107041192e-02   +4.241458562150857e-02   +3.510269391363966e-02   -6.138978347182692e-02   +8.488261663737746e-02   +1.025738196212439e-02; +6.953684325628959e-02   +1.762568639544015e-02   +1.222745055299403e-01   -3.779756276064278e-03   -4.714300258134112e-02   +1.297084576051958e-01   -4.631513173465910e-02   +1.768722927533742e-02   -7.357919037081320e-02   +6.894779130442839e-02   -8.690548502497314e-03   +6.808186355475167e-02; +6.042000554712426e-02   -1.344899178498513e-01   -1.316115468504729e-01   +2.061256486911189e-02   -1.174017601622896e-01   -1.112828550540097e-01   -2.690748540917084e-02   +5.809676446678785e-02   -1.127641916937755e-01   -9.064399826782836e-02   -4.957353217901295e-03   +1.163720724410298e-01; -1.218822761288200e-03   +8.311454409399721e-02   -7.711357021183878e-02   -5.096424335667370e-02   -1.412792097097178e-01   -2.320479633777588e-02   -6.606782700815808e-02   -4.030692885230161e-02   -3.593942396294873e-02   -8.862437922302763e-02   -1.150022794458452e-01   +7.066496694618660e-02; -5.142475014662941e-02   +5.871174976085806e-02   -4.507166710085678e-02   -5.883050450044754e-02   +3.132987931796158e-03   +5.610800272280999e-03   +3.791391764137547e-02   +1.310407553887682e-01   -1.210159856582392e-01   -7.446631533798528e-02   +1.179898989407064e-01   -3.724005298019806e-02];
L2E_L3E_iAMPA_netcon = [+1.229164634664668e-01   +9.031490095540341e-03   -1.378608173992028e-01   +1.568358332131668e-03   +3.838523799436225e-02   -7.900331144861100e-02   -1.465842996814249e-01   +5.013049028820272e-02; +6.864779063480311e-02   -7.322770979175336e-02   -3.039743554832647e-02   -1.354729961270687e-01   -3.047273541706305e-02   -5.537747657495176e-03   -2.232588630184903e-02   +1.753413864059813e-01; -1.029096372848882e-01   +1.283925282109425e-01   -2.095468504346026e-04   -5.606835821717232e-02   +2.776232959081032e-02   -2.449568767004042e-02   +3.774930382664612e-02   +8.717953375692565e-02; +1.231219375103392e-01   +1.969707485422065e-01   -5.901464297437597e-03   -2.488644212847583e-02   +1.594930885204315e-02   -4.200859269555845e-02   +4.095970184512358e-02   +7.756085012709975e-02; -6.219634914928935e-02   +9.218429549622245e-02   -2.248235186346340e-02   +7.266680453198626e-02   +3.021555397257143e-03   -6.314655772224198e-02   -1.399729314151267e-01   -6.814751079899465e-03; -8.110372956607662e-03   -1.057670799805108e-01   +6.491589259234500e-02   +8.938300254549444e-02   +6.727356876383180e-02   -2.256172164205001e-03   -6.367535285178386e-02   +1.263828789268729e-01; -5.145833279727711e-02   -6.742962964576243e-02   +9.089137972126501e-02   +7.830329292067470e-02   +2.745856273802904e-02   +1.982367368258210e-02   -5.339166738534877e-02   +5.606054106000129e-02; -3.407990199111034e-02   +7.454206855998410e-02   -1.343348227140946e-02   +4.170168937155296e-02   +1.398731945672788e-02   -7.786626376796905e-02   +2.358501737872678e-02   +1.148801738546548e-01; +5.780140165688265e-02   -8.863366334716230e-02   +8.549297944534943e-02   +6.083755000705543e-02   +7.393522440750708e-02   +1.068664294416438e-02   +3.628707639225811e-02   -2.480018643935451e-02; -1.659150705322936e-01   -8.917470029853633e-02   -2.580784032392981e-02   -4.542075108050496e-02   -2.057212350135739e-02   -7.576841429254777e-02   +2.607653133904993e-02   +6.490025991624286e-02; +7.930913230120514e-03   +1.473970240080901e-02   -7.323343853610839e-02   +8.594918870963836e-03   +4.561050065729398e-02   +2.325885191264573e-02   -3.000091590704197e-02   -4.834863234722964e-02; -8.659131164120716e-02   -1.421325166913943e-02   +1.107067416327383e-02   +5.061129338850207e-02   -2.777788052300397e-02   -8.493875793869368e-02   +2.232159823407364e-03   -1.313388260564418e-01];
L2I_L3I_iGABA_netcon = [-6.282724057508439e-02   +4.900193647107360e-02   +9.990650929775967e-02   -1.258911013165294e-01   -2.709175742426536e-02   +3.332721270461737e-03   +4.868748253359828e-02   -3.491999750290987e-02; -5.403326726149973e-02   +4.314495014841667e-02   -3.278782909089700e-02   +1.929846412819687e-02   -6.685255131898653e-02   +1.777994747082498e-02   +1.766760353933708e-01   -1.984129973007361e-02; +1.100639805437962e-01   +1.133108069624729e-02   -4.670701783592435e-02   -1.349599003690960e-01   +2.099167947505404e-02   -2.680141973381156e-02   +1.945174674417249e-02   +7.726681938962704e-02; +4.046132438059623e-03   +1.200286198649713e-01   +4.837591419168109e-02   -5.008315654931145e-02   +4.295003835661988e-02   -3.208417650275967e-02   +8.225733851969393e-02   -1.432321753275618e-01; -9.146784774585592e-02   -3.922417332373865e-02   -8.550588525296535e-02   -5.662097206399815e-02   +6.075234301210489e-02   +3.427560398012906e-02   -1.978180993421550e-02   +2.412601353270342e-02; +5.414312108465873e-02   -2.528851723906629e-02   -5.642971544864723e-02   +2.330878757464192e-02   +9.893136992837415e-02   +1.217225959125529e-01   +9.423156346780120e-02   +4.418767097441612e-02; +2.626029835815257e-02   -2.324762048355078e-03   +8.754672407496512e-02   -9.734784859553405e-02   +2.973760120817946e-02   -4.153717976381706e-02   +3.724489083573639e-03   +4.564910957396253e-02; -2.533215248982530e-02   +1.604228775421617e-01   +1.346396594856451e-02   -8.309775939710913e-03   -6.166020489808845e-02   +3.628575034507175e-02   -8.240501228221628e-02   -6.997601798609272e-02; +1.375547827621677e-01   +5.439480463676994e-02   -7.939668900728329e-03   +9.266189043219911e-02   +1.950913733548783e-02   -3.749914570377579e-03   +1.524311218950499e-01   -7.114910527288984e-02; -4.515950553758010e-03   +2.528826132143965e-02   -3.865867352348719e-02   +2.766640710916184e-02   -4.845219118975603e-02   -1.242064355825689e-01   -3.129416471111306e-02   -1.392779801920974e-02; -5.400315211631789e-02   -3.725446874081631e-02   -3.558952098024107e-02   +4.738831274536726e-02   +6.868188401454856e-02   +8.282855319957175e-02   -2.738418526458380e-02   -4.789999751117616e-03; -1.023393287036203e-01   +1.206599954185771e-01   +2.909676135854957e-02   +1.380016990626670e-01   -6.115110763422756e-02   -2.057024960809313e-02   -1.315288499395260e-02   -5.586563759854413e-02];
L3I_L3E_iAMPA_netcon = [+1.130818558282558e-01   -1.725391408970763e-02   +1.772536093301942e-01   +5.568918145930549e-02   +8.569724253954291e-04   +9.443079031156551e-02   -1.497804824580500e-01   -6.297285768982047e-02   -5.180479076442043e-02   -4.972664846422184e-04   -4.457665355086402e-02   +1.677352869415017e-02; -4.525139457636689e-02   -4.424144210925317e-02   +1.555716623049776e-01   -2.385262402731970e-02   +4.479896767873151e-03   -2.466475471128545e-01   +3.765893963354707e-02   +1.726347998073241e-01   +1.907654388522242e-01   -2.710461539201202e-02   -9.316285338747532e-02   +4.819275988679274e-02; -2.365846569604249e-02   -1.022448974153356e-01   -1.372986915622275e-01   -1.254809197705688e-02   +9.988312343831575e-02   +3.040582785044766e-03   +4.705341759166282e-02   +6.503548565748363e-02   -9.267908410156695e-03   -4.623300831797336e-02   -5.436071188228167e-02   +1.347193841950929e-01; +9.674258372104678e-03   -1.605334093477634e-03   +1.307972934010102e-01   -4.363330806904162e-02   -5.368270752028293e-02   +1.142778536411157e-01   -1.128688113738021e-01   +2.437472174165554e-02   +6.283462666408939e-02   -7.207150208420731e-03   -5.976783221208580e-02   +1.394967828635489e-01; -6.490715494719843e-02   -1.724624627086166e-01   -1.266410628895425e-01   -1.540984020504322e-01   -3.770595909705630e-02   -9.162569326820937e-02   +9.259932920773818e-02   -7.424162806033696e-04   -6.112775876955423e-02   -1.610222519283745e-01   -5.843852382496664e-02   -7.254295608237375e-02; +5.195976055699826e-02   +8.901486998696104e-02   +7.498981660383154e-03   -8.405041606799918e-02   -1.138875606282848e-01   +5.971844309481651e-02   +2.037198150286164e-02   -1.688656511199144e-02   -2.821114531111597e-02   +1.138650597098743e-01   +6.010420844253946e-02   -3.571080611906527e-03; -7.245562202834400e-04   -8.619275853586426e-02   -7.560963660130687e-02   +6.355127715685271e-02   +3.786937970404322e-02   -3.087182961372817e-02   +4.708335809722863e-02   +1.112399466102952e-02   +4.720349654870951e-02   -1.289508394615228e-02   +3.313410990247479e-02   +1.151204239646989e-01; +4.373544980965213e-02   -2.802083035993964e-02   +8.151781741077518e-02   +5.622947724254989e-02   +1.412587723712820e-01   +7.023474250192403e-02   +1.611973293407674e-02   +3.640505090416431e-02   +6.516565466758810e-02   -2.405833624781029e-02   +4.561595658680942e-02   +7.851375661465280e-02; +1.613875847169156e-01   -9.051589178712176e-02   +1.007728756369097e-01   -1.545163555116714e-01   +3.176277719393392e-02   +1.223707601127790e-01   +1.207741129319414e-01   +1.802147301262859e-02   -9.517367944422525e-02   +4.244047685405153e-02   +4.321709778581848e-02   -1.892456011174981e-01; +4.955491690191527e-02   -6.248610555001056e-02   -1.098373509871755e-01   +3.652037319001262e-02   -3.769097966843172e-02   -3.713108329120718e-02   -3.136172197677405e-02   -8.635342377625227e-02   -1.089802799636007e-02   +2.746889059283869e-02   +1.070591170456338e-01   +8.870303823497658e-03; +8.053038185783429e-02   +3.937513086279122e-02   -1.402833427494261e-01   -7.293883412225867e-02   +9.468756489303876e-02   -1.288938306414024e-01   -1.927255734883501e-02   +4.945266663441557e-02   +8.589935277037317e-02   -4.944361120108253e-02   +8.830651903117945e-02   +5.394474128493195e-02; -1.214958370040048e-01   +1.047300404235188e-01   +4.319874779301246e-03   +1.461132603047885e-02   +8.045281875484503e-02   -1.426164033572526e-01   +3.668105317593726e-02   -8.933615749264337e-02   -3.709681569171344e-02   +1.543567750790246e-01   +1.257541866602580e-01   +5.556100056787398e-02];
L3E_L3I_iGABA_netcon = [-2.834871627443595e-02   +3.963010571877608e-02   +9.416793208752386e-02   -7.500555109558933e-02   -1.073777764388555e-01   -1.276329668137897e-01   +2.926454027801660e-02   -5.181797899990948e-02   -6.972311867186605e-02   +7.242582408706021e-03   -1.575367346785626e-02   +6.310323225914338e-02; -6.755489452722192e-02   -1.779388941389187e-02   -4.016998729494335e-02   -8.873602085591063e-02   +1.596066624046064e-01   -7.123843101817203e-03   +1.697018548165809e-02   +6.103979058009629e-02   -9.461428734008086e-02   -9.259263262909688e-02   +1.743997939543968e-01   +5.694250640464783e-03; -8.153600906781855e-02   -1.017603534518531e-02   +7.529368000476688e-02   +1.525731122422603e-02   +8.168422485232721e-02   +1.121450363624280e-02   +2.612101614993970e-02   +6.812023867726500e-04   -7.132751945786800e-02   -8.774262964665423e-02   -7.003174200428287e-02   -2.846290626645832e-02; -7.063014513874369e-02   -4.646109816831663e-02   -8.055368092350580e-02   -3.584521203362831e-02   +1.451743663839641e-02   +1.194669627105405e-01   -3.746553350227567e-03   -3.161405860377816e-02   +5.537098848197050e-02   +5.442501598252875e-03   -1.038220474894304e-01   +2.897916638269293e-02; +2.773176413347931e-02   -1.132983060715945e-02   -6.179963389849720e-03   +6.591387243238447e-02   +2.727994288405054e-02   +1.705520818886291e-02   -6.974829055265371e-03   -1.155937323237344e-01   -1.366225843717007e-02   +1.107410657323150e-02   -9.465620417733489e-02   +1.936221782449333e-01; -1.944074510473175e-02   -2.837193237751515e-02   +1.203238927397974e-01   +2.009156759647852e-02   -1.475866083633801e-02   -1.934641695583907e-02   +3.396753927612928e-02   -1.205224860770718e-01   -7.708361694714824e-02   -8.925366496096184e-03   -7.398050772767890e-02   +9.884258274371348e-03; -1.156231104257194e-01   +1.587262455583334e-03   +4.019013453475708e-02   -1.235056342710226e-01   -1.018466556478551e-01   -1.126214677094067e-01   -5.822893298242861e-02   +3.056880205872178e-02   +1.651472891803142e-02   +1.712693794706380e-01   +3.579636459414559e-02   -2.092802050885643e-02; +2.806778075483503e-02   +1.025867933914339e-02   -1.257240594495923e-01   -6.209086961509966e-02   -5.285763280245682e-02   +1.195506249516481e-02   +2.381449362864518e-02   +2.547929834945491e-02   +1.761051196559911e-02   +6.563825677508545e-02   -8.540379063771536e-02   -4.037666067623940e-02; -7.318884268082167e-02   +1.709814488804301e-01   +5.359878193146531e-02   -6.967741330510202e-02   -1.284361422652071e-01   -1.752406842340198e-01   -1.264259539162511e-01   +6.757402738775979e-02   +1.071262087656380e-01   +6.000912046004010e-02   +5.836021187670222e-02   +3.723052305297281e-02; -5.707544137506097e-02   -6.603427381938473e-02   +1.252420208810192e-02   -6.080448336155175e-02   +1.322845796713433e-01   -7.772509780469812e-02   -3.764526240171660e-02   -6.667636387445814e-03   +3.078920110324739e-02   -4.293029380598193e-02   -3.038829250787567e-02   -8.222625450461164e-02; +8.961024897381842e-02   +1.695503199087452e-03   +1.353418561689469e-02   +1.208867378527501e-02   +2.815124346398027e-03   +1.584946526354749e-01   +6.771760270556382e-02   -7.669510284197303e-02   +5.243055231515838e-02   +8.413978298004464e-02   -7.342502665309447e-02   -2.894255915018487e-02; +1.767181615128330e-02   +5.180286453212486e-02   +8.773238830930565e-02   +1.058204121037726e-02   +1.469873753328624e-01   -2.168141506323340e-02   -1.489103068395090e-02   +6.316949514561547e-02   +2.561699763112477e-02   +1.349364387733908e-01   +8.389186388900016e-02   -6.096362906680447e-02];
L2E_Input1_iAMPA_netcon = [-1.693748035707093e-02   -7.342987916783660e-02   +1.073851201565825e-01   -5.599432692201874e-02   +5.332386143146149e-02   -5.170224095384766e-02   +4.322857650517685e-02   +7.041631710460794e-02];
L2I_Input2_iAMPA_netcon = [-8.060696852441851e-02   -2.440347543592310e-02   -1.078931900814664e-01   -1.821093821847416e-01   +7.017157596721518e-02   -8.988126240762422e-02   +1.664040891411883e-01   -8.695020806645988e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
