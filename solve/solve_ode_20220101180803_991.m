function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.794059050930973e-01   +1.874120127052855e-01   +3.854765519662412e-01   +9.052523680535213e-01   +6.154957295952094e-01   +4.622963273590448e-01   +4.193112602107762e-02   +5.401633426928570e-01   +6.493822582616410e-01   +7.129700843231709e-01   +5.292803326825291e-01   +4.916159631532093e-01   +7.701711777244156e-01   +3.450079541671072e-01   +4.638982682362336e-01   +7.903214135010485e-01; +2.027682305346666e-01   +3.575116099725280e-01   +5.764224908292577e-01   +1.366203709732262e-01   +2.718549712897448e-01   +3.968349753051859e-01   +1.274699577637367e-01   +1.151774721883758e-01   +9.996275444394680e-01   +6.500230567023590e-01   +7.638956738630927e-01   +8.981414021517978e-01   +9.162338365178393e-01   +6.380460978984236e-01   +6.559587302596620e-01   +5.299354242612679e-01; +1.493619292660383e-01   +8.710029231073650e-01   +5.175841518049711e-01   +3.870066590783814e-01   +2.175866239286807e-01   +3.253203354012478e-01   +3.906964614958537e-01   +8.562941334907763e-01   +7.845558043916211e-01   +3.575577749856251e-02   +6.629702535633583e-01   +9.455157161244150e-01   +3.344826818790909e-01   +9.756918790308666e-01   +6.690874058252211e-01   +5.762600520989672e-01; +4.947161083986780e-01   +1.798172973729398e-01   +8.356047494393890e-01   +8.221443384712419e-01   +2.944375443883892e-01   +2.861216988083396e-01   +7.199839313627077e-02   +2.803246077663526e-01   +3.457920513850257e-01   +6.069963392779547e-01   +8.305490677826094e-01   +9.907526934685261e-01   +9.007249521096304e-01   +5.095132665592024e-01   +8.798530264753823e-02   +6.855001716877782e-01; +1.371894813734515e-01   +3.609589157663792e-01   +6.356098094752498e-01   +5.876202745425954e-01   +5.042436866110627e-01   +8.808109610756809e-02   +4.342142042631995e-01   +2.549274558229506e-01   +3.015602509311194e-01   +6.641907382768329e-01   +5.806160015627638e-01   +3.736976818652584e-01   +4.086214668287860e-01   +3.938092882534328e-01   +2.681866488872489e-01   +8.814235829085745e-01; +1.481416447030967e-01   +6.984123695782183e-01   +2.280960946493565e-01   +7.814652391949888e-01   +4.910737791574781e-01   +9.282631199796912e-01   +6.965466903864681e-01   +5.962992107534402e-01   +6.223182476700536e-01   +3.986788399547982e-01   +4.595961815508977e-01   +2.604213356092510e-01   +1.388463554734635e-01   +1.301958555789708e-01   +6.711517718868287e-02   +7.438212960078083e-01; +5.723378291866853e-01   +7.804390996035111e-01   +8.433146832349061e-01   +8.940051026171233e-01   +7.020684388998387e-01   +1.988753135708429e-01   +1.725354400667665e-01   +5.799232237183357e-01   +9.661087218799436e-01   +6.333384809833308e-01   +8.502385728031320e-01   +8.514692881092107e-01   +9.974089548622370e-01   +9.825134949137180e-01   +8.923316624797739e-01   +1.726485998737017e-01; +4.587264789704504e-01   +3.658275223933870e-01   +6.758620486951880e-01   +4.184095381078380e-01   +4.286769390903304e-01   +4.275694889663215e-01   +6.209164587708660e-01   +2.631699147116656e-01   +3.328672273444144e-02   +9.262508474683780e-01   +3.530090411414081e-01   +9.503386538041020e-01   +8.297835224022939e-01   +9.748941228521546e-03   +1.392870818955252e-01   +4.049514152100565e-01; +8.877661317266560e-01   +1.846061370542355e-01   +1.515423926757077e-01   +6.725134401408717e-02   +8.101853742613789e-01   +2.196847882646923e-01   +3.101127874259735e-01   +5.439725171672555e-01   +9.008212670493524e-01   +6.359119288009422e-01   +2.176542844648590e-01   +9.725594368755149e-01   +6.167774173167184e-02   +7.330851018974678e-01   +5.697539009627943e-01   +9.659115086759339e-01; +4.645115555219654e-01   +9.901799025163327e-01   +8.211355170916361e-01   +5.128333075304957e-01   +5.860219474247909e-01   +4.457168891508313e-01   +7.473456676708267e-01   +3.161071923825010e-02   +3.466398740755589e-01   +3.204495061431144e-01   +1.534561399471914e-01   +4.561019050720004e-01   +7.136326329855746e-01   +3.196599106712527e-01   +6.558180029975386e-01   +9.646397029485196e-01; +3.029216810956437e-02   +9.359269709755166e-01   +8.613471459852584e-02   +9.074147097261147e-01   +9.983471183874337e-01   +9.599004129871433e-01   +4.117867635698846e-01   +4.447099104991813e-01   +2.235677269493548e-01   +7.263902160972949e-01   +1.434270275444827e-01   +5.618518075377087e-01   +8.278890144232173e-01   +5.266028577690548e-01   +1.682602273623527e-01   +8.754849598364944e-02; +5.538544613170537e-01   +6.614286493187828e-01   +7.544827004689877e-01   +7.786016089260293e-01   +3.291330261606338e-01   +3.584153449115789e-01   +5.727067251388194e-01   +5.430196131120031e-01   +9.784212990283788e-01   +4.973753834945739e-01   +8.881985559867979e-01   +9.789501250032447e-01   +1.914613879187403e-01   +5.781041504622650e-01   +6.010544901297247e-01   +8.214044325313681e-01; +1.130448762343479e-01   +9.385881884645516e-01   +3.272086311520216e-01   +3.431744338872140e-01   +2.779750913763605e-01   +9.485608382510116e-01   +7.592454644579627e-02   +7.982658036586902e-01   +5.979859939461895e-01   +7.335384532173332e-01   +6.115954817577972e-01   +9.071756265646418e-01   +5.866598735258333e-02   +8.600235850524852e-01   +1.133594221135970e-02   +7.170081427115605e-01; +2.932262282477074e-01   +9.560135195447889e-01   +1.344790189356778e-01   +6.355227226272364e-01   +2.737790534389879e-01   +8.215694619010243e-01   +8.601829168250850e-01   +2.079417348565948e-01   +4.213083341732633e-01   +6.044245133167193e-01   +2.324692550209626e-01   +7.553074249586809e-01   +1.174769308621816e-01   +6.020332111484032e-01   +1.178721125093702e-01   +1.330210892346020e-01; +9.201129061879324e-01   +5.571586236002152e-01   +1.808937030413795e-01   +4.507195106543216e-01   +9.550166188630559e-01   +6.024183976974280e-01   +1.364182058690806e-01   +6.416190276629277e-01   +1.803088791575346e-01   +5.483520413052090e-01   +1.000694591034075e-01   +2.529857217757699e-01   +2.761120825695157e-01   +7.158087351082156e-01   +6.644080805355201e-02   +8.719635668964750e-01; +9.559917479881057e-01   +1.542992684254096e-01   +1.366996515342253e-01   +6.331966074018635e-01   +9.778273988067446e-01   +4.609004950197975e-01   +8.207277282211046e-01   +2.101297884242708e-01   +5.502903875656290e-01   +9.003170269248399e-01   +9.044838054015761e-01   +8.101736584005780e-01   +8.060693669312072e-01   +3.438222773398825e-01   +8.990204831741052e-01   +4.101092141845427e-01];
L1E_L1I_iGABA_netcon = [+8.832378939495874e-01   +4.680975236396352e-01   +2.138946682956983e-01   +6.693396552884885e-01   +9.815975800166499e-02   +1.166962146439523e-01   +8.142190822359775e-01   +7.026568319545411e-01   +5.916869747169974e-01   +5.850321982073322e-01   +1.026233746720675e-01   +3.705445877926365e-01   +5.732815222419393e-01   +4.005773120158918e-01   +4.726717139126815e-01   +1.306897898440829e-01; +1.080774209149993e-02   +8.459070604584460e-01   +9.039152610072672e-01   +9.509411037065296e-02   +5.458732314783754e-02   +2.193334776008902e-01   +9.784588606624575e-01   +6.200595475025009e-01   +4.418342387392790e-01   +6.902556330764853e-02   +2.397472430459477e-01   +1.450155004901423e-01   +3.171022662537401e-01   +5.444310261384053e-01   +5.649398270184983e-01   +3.709366664416114e-02; +8.855925036026071e-01   +3.799590178523400e-01   +7.789320405806581e-01   +7.848571456658505e-01   +1.555031422351809e-01   +5.928270381439067e-01   +2.010057630339385e-01   +8.903029098316494e-01   +1.896513494437470e-01   +9.954853203608046e-01   +9.409776115240056e-01   +9.872224323203983e-01   +7.657932977762464e-01   +9.760796495789614e-02   +5.208424465751288e-01   +8.255653642269918e-01; +8.105866475346515e-01   +1.302370477572425e-01   +9.591023898135242e-01   +7.237860464534340e-02   +8.916802384207089e-01   +6.579601572799554e-02   +8.885716343665685e-01   +9.412356837808398e-01   +1.071584588389947e-01   +3.651115107160601e-01   +5.188035103609859e-01   +2.922999863329461e-01   +5.239429018676609e-01   +5.182698199404508e-01   +5.253909924486233e-02   +7.542680880997161e-01; +9.579507273109524e-01   +6.152851742990596e-01   +5.577637918650765e-01   +8.110575357806923e-01   +6.922763654519717e-01   +6.366376633379496e-01   +7.895252592511401e-01   +5.110815670038888e-01   +1.083038290493709e-01   +5.098233538883965e-01   +7.721965640383428e-01   +5.711171865839110e-01   +9.365022807574376e-01   +2.924023747837732e-01   +5.435742118319176e-02   +5.248998088430999e-01; +6.707942611564420e-01   +6.839301521357649e-01   +5.207966296854258e-01   +2.026320305649167e-01   +6.092759145929072e-02   +3.321537856684564e-01   +3.948184492721598e-01   +2.937046699230793e-01   +2.202665453114471e-01   +5.834261910738570e-01   +6.297666505871518e-01   +7.253864405013886e-01   +5.011964204724244e-01   +2.494816449097411e-01   +3.453870925282262e-01   +4.695113122204261e-01; +5.854078173683016e-01   +2.648402952471923e-01   +3.222645561798428e-01   +7.464530546880078e-01   +9.271614854344506e-01   +1.921319195405556e-01   +1.995939542735007e-01   +4.908056735471916e-01   +8.947601220039492e-02   +4.652579285694756e-01   +4.822762069956198e-01   +6.923263596276930e-03   +1.630902054066937e-01   +7.019694049765464e-01   +5.424643669353285e-01   +5.348833420791976e-02; +5.696843768693240e-01   +1.542382823236592e-01   +1.839968474060339e-01   +2.784297490901037e-01   +6.385972818876446e-01   +2.815234052583369e-01   +1.597952281591305e-01   +6.987754858559286e-01   +5.965404737894211e-01   +7.003457049813219e-01   +4.881784275571787e-01   +3.758089071437958e-01   +2.427030877403059e-01   +5.598679946842010e-01   +3.555904114972361e-01   +5.754376598141903e-01; +5.464898024428282e-01   +8.521872750634872e-01   +2.249922733302765e-01   +5.326542738782817e-01   +3.575770360926482e-01   +8.456378446184381e-01   +4.035758496256002e-01   +3.933284019933556e-01   +1.685559454266095e-02   +3.596747639586062e-02   +7.094175819858319e-01   +2.442501719202770e-01   +8.532506622689354e-01   +9.330918285445317e-01   +4.032914491225589e-01   +3.788545317490802e-01; +1.795582602729578e-01   +8.227106332760820e-01   +9.411927030563207e-01   +4.134154953802939e-01   +2.130266481895167e-01   +2.167246665357903e-02   +5.355737983270270e-03   +3.243686945965967e-01   +9.336589293124409e-01   +6.391045042653116e-01   +4.249194878366997e-01   +2.653626793724501e-01   +7.558848340743233e-01   +9.186627185008156e-02   +3.271013887963320e-01   +7.033296857681991e-01; +4.407529766036845e-01   +8.262879885000030e-02   +1.378760850196801e-01   +8.637088587988353e-01   +6.410041339441559e-01   +1.227873089383632e-01   +9.757370356572014e-01   +5.036836760970527e-01   +8.038626062462123e-01   +6.940078154464179e-01   +6.370754782997805e-01   +2.952675852785636e-02   +2.656466484036675e-01   +8.713969405281932e-01   +2.344531032527771e-01   +7.535992740468426e-01; +1.558808758449755e-01   +6.939018604058805e-01   +1.823810386493631e-01   +2.998550997811618e-01   +7.084836567341448e-01   +3.270727986288244e-01   +2.261938241110748e-01   +4.484290132177502e-01   +8.423571324867487e-01   +3.230591916678077e-01   +9.387364730261614e-01   +8.354637472604732e-01   +8.554174407705344e-01   +4.107205976483568e-01   +1.357162207064504e-01   +1.743291184603185e-01; +4.004672126518738e-01   +4.568786304165686e-01   +8.084283305062981e-01   +5.277779114551662e-01   +4.647774598330925e-01   +4.467623910801958e-01   +6.628606460895997e-01   +4.086980452135355e-01   +2.443069105404001e-01   +9.490053938076509e-01   +6.773131015928711e-01   +3.517341046823569e-01   +4.647068858456307e-01   +2.050562680911983e-02   +6.010946074159479e-01   +4.404267049267589e-01; +6.825872026643059e-01   +6.865706768062384e-01   +4.624399840311111e-02   +4.104570019426944e-01   +3.628406200179939e-01   +6.912997402479504e-01   +4.537058615719990e-01   +5.069740154347248e-01   +6.467008866504073e-01   +5.265179787233110e-01   +4.234542419172516e-01   +1.902606162081651e-01   +2.521860408008040e-01   +5.587213148237758e-01   +3.013369753892141e-01   +8.701750065803504e-02; +3.078791434804417e-01   +1.688056590287508e-01   +6.565214335730751e-01   +9.009380471827133e-02   +5.532275710473422e-01   +1.905756987942382e-01   +7.300793439293773e-01   +2.641227296454850e-01   +7.241827142883417e-02   +5.638051685798033e-01   +3.842584038495663e-01   +7.925584013287702e-01   +6.875674900812323e-02   +9.689053173564645e-01   +2.365115878781977e-01   +5.396744248649382e-01; +7.448871890133576e-01   +8.034935442901290e-01   +4.856616163387283e-01   +4.784318340103716e-01   +6.142363435414012e-01   +7.368995888904160e-01   +7.721975206644308e-01   +1.186430717235409e-01   +5.520474968400519e-01   +8.439095280956344e-01   +8.272156495926990e-01   +2.827398211858065e-01   +1.473385107441919e-01   +1.093264319180457e-01   +3.510073060790441e-01   +8.791918054457236e-01];
L2I_L1I_iGABA_netcon = [+8.314001781755990e-01   +8.894039575071067e-01   +6.918363004432208e-01   +6.462604551011919e-02   +8.840441463414545e-01   +6.701976709622626e-02   +1.179481526893146e-01   +6.966990637448789e-01; +3.709497796688697e-01   +3.325478588487968e-01   +2.747312555509676e-01   +4.416365550247214e-01   +8.800178804982706e-01   +3.254676103248054e-01   +4.456027891487915e-01   +1.419816303629114e-01; +2.335574261385065e-01   +8.670964373602239e-01   +9.260330243638062e-01   +2.388591205357208e-01   +7.396205606895409e-01   +8.607657822039381e-01   +2.780415681480696e-01   +7.664151722616701e-01; +5.562455546732666e-01   +6.218380743252028e-02   +2.776885244379261e-01   +8.483273011758790e-01   +7.139064894263539e-01   +5.827246850764062e-01   +4.318206580973449e-02   +8.541688328100584e-01; +5.083281196990130e-02   +9.376612276199338e-01   +1.542790522121713e-01   +3.562948890767619e-01   +6.598685537389609e-01   +8.460879014902594e-01   +8.242201932018272e-01   +3.792578745331459e-01; +3.646900950026177e-01   +4.182872708332651e-01   +6.277626232915803e-01   +1.497656530278785e-01   +3.722843388167986e-01   +8.534694149323804e-01   +5.009797349564017e-01   +7.628218326487624e-01; +6.141952826169546e-01   +1.308352735618168e-01   +3.781298280939549e-02   +7.534429161525017e-01   +9.627450264267191e-01   +9.199348324956481e-01   +8.613904517966229e-01   +2.857769290255909e-01; +9.848991088031125e-01   +7.423136404507065e-01   +9.960520979427241e-01   +2.329772301421528e-01   +1.952869051095008e-02   +5.419182552502469e-01   +6.784780822102857e-01   +3.134397665646922e-01; +3.929603461055921e-01   +7.609426976861052e-01   +7.611068573295172e-01   +5.185832599990438e-01   +8.139917396935834e-01   +2.593022275721618e-01   +8.809666316943983e-01   +8.552854436059283e-01; +5.279730322627540e-02   +2.565926942833672e-01   +8.911079175628185e-01   +3.846353790117545e-01   +6.835202765128380e-01   +1.070515029422289e-01   +3.007311634037028e-01   +3.378496420733790e-02; +8.455854931106441e-01   +9.049788359343103e-02   +7.036669913373115e-01   +9.539995586416139e-01   +4.988039468195616e-01   +4.253670161705414e-01   +6.381943755472602e-01   +7.268273832827941e-01; +6.644968757016122e-01   +6.529411779040715e-01   +4.576023562767770e-01   +9.753314055945084e-02   +1.285562193387720e-01   +3.362967415457052e-03   +1.530334628484786e-02   +6.359224930032892e-02; +9.194952462812430e-01   +9.719909963879102e-01   +5.321501779154392e-02   +5.728098382325029e-01   +5.908993020898645e-01   +5.025763830349024e-01   +8.120726689377779e-01   +8.410824435933385e-01; +3.249590267166353e-01   +4.940736168559335e-01   +2.963638080837236e-01   +3.583269569353859e-01   +6.068674863386981e-01   +2.585731388679890e-02   +2.273373484561841e-01   +9.362735701859437e-01; +9.444841583368218e-01   +8.362194867683052e-01   +2.167577069887426e-01   +2.027553732094213e-01   +1.453575836984761e-01   +9.614358920225408e-02   +1.539975355351654e-01   +6.152132463424506e-01; +3.958858969906863e-01   +7.366133786191140e-01   +4.855767584525297e-01   +4.593520940298983e-01   +3.743803682195009e-01   +3.713445303360565e-01   +4.102012004986388e-02   +9.851801650864896e-01];
L1I_L2I_iGABA_netcon = [+2.505634804330038e-01   +5.001487189175464e-01   +3.703404520546580e-01   +2.070992396862795e-01   +6.809452607590623e-01   +8.145669948098667e-01   +1.939447867673120e-01   +7.332434540860266e-01   +8.776078094912929e-01   +3.266743428750910e-01   +6.689552029644930e-02   +9.741600017599202e-01   +1.308946252046572e-01   +3.114349848420827e-01   +1.790607988796977e-01   +1.924096127061034e-01; +3.812329608108322e-01   +7.164778018897966e-02   +7.881387068118457e-01   +1.035052410324850e-01   +2.129913252239038e-01   +5.749460750862168e-01   +3.952242927872098e-01   +4.759462356799787e-01   +1.898278764211618e-01   +6.148739841265765e-01   +4.631036018462633e-01   +9.928397587709900e-01   +9.372110716389355e-01   +2.955806258439091e-01   +9.139646020382625e-01   +3.494034390214648e-01; +2.263395274600939e-01   +9.307896825706075e-02   +6.455300834812157e-01   +8.171816278487417e-01   +3.142266176408675e-01   +7.648630531025602e-02   +2.181502814801481e-01   +6.406647137898362e-01   +8.271665055195156e-01   +2.300789525352388e-01   +8.512600554283067e-02   +6.558081895250124e-01   +1.661622194588402e-01   +1.002833797217789e-01   +9.302267240977757e-01   +3.651739280029445e-01; +6.130191530225803e-01   +1.633416324658827e-01   +2.414416350326664e-01   +9.486465033900420e-01   +9.552361370746520e-02   +2.050032202481402e-01   +4.372402116453633e-02   +3.886779092735455e-01   +8.227231303459678e-01   +2.240559361028096e-01   +2.598695437772601e-01   +6.562433558684262e-01   +3.062239533571058e-01   +1.812179559742487e-01   +9.616565885092455e-01   +1.743123964130916e-01; +5.802875740807942e-01   +5.294209036741441e-01   +9.191964260355036e-01   +5.509147106355097e-01   +2.976588970526395e-01   +5.028992555522626e-01   +6.262448284772720e-01   +1.382607517780543e-02   +4.289613932414704e-01   +8.762822581596670e-01   +5.314772801443887e-01   +1.791671483069180e-01   +8.917948889684032e-01   +2.870130636524555e-01   +7.382339980037979e-01   +9.424144383678104e-01; +1.185760401431296e-01   +9.195262119539442e-01   +8.907974110148232e-01   +8.320310854087259e-01   +5.407367530291124e-01   +2.063812428776212e-01   +6.561624028753631e-01   +9.456053294987556e-01   +8.878210942669890e-01   +8.372557175522387e-01   +2.850255137679516e-01   +2.719008468533068e-01   +2.733770588576661e-01   +4.027587708133726e-01   +1.836090279558077e-01   +6.478274719877836e-01; +3.034187982925344e-01   +3.110348869650429e-01   +8.407367598277234e-01   +9.031841142421861e-01   +8.003195748857237e-01   +9.396473127257732e-02   +6.680319597442238e-01   +4.176887907555904e-02   +1.661208852789516e-01   +6.830560774826405e-01   +2.616398162667800e-01   +7.256480118577535e-02   +5.847475787196348e-01   +2.615400498949190e-01   +9.399068969233606e-01   +8.015565747750280e-01; +7.027211742475270e-02   +8.234686650806103e-01   +7.900384580407526e-01   +1.906136516281511e-01   +7.150387734188534e-01   +1.433962051408353e-01   +3.862720930291899e-01   +8.553953963058130e-01   +4.587260732858298e-01   +6.754950870255582e-01   +9.972820373687021e-01   +2.260866669208788e-01   +6.236686216893998e-01   +9.669410119663412e-01   +2.917464862975054e-01   +7.857774126641163e-01];
L2E_L1E_iAMPA_netcon = [+3.871677920392015e-01   +2.687237520467262e-01   +1.794642127129986e-02   +6.525180257913277e-02   +5.526390169356820e-01   +7.817767836798473e-01   +5.982805590819029e-01   +6.123781988588867e-01; +2.059565436587442e-01   +7.468774668661694e-01   +9.233930372767729e-01   +1.017347982955616e-01   +9.943251348830897e-01   +2.919986478515708e-01   +2.706958242924610e-01   +8.769121595009353e-01; +4.075945708357939e-01   +8.235071904881341e-02   +5.142791959455364e-01   +7.029975505262344e-01   +3.700747923144935e-01   +9.699581779866177e-01   +4.331985465202983e-01   +9.223619688089723e-01; +8.454540795112431e-03   +6.914709154600496e-01   +2.727080678140342e-01   +8.061833680347533e-01   +8.770713897102123e-02   +1.062514472421527e-02   +6.079557154080503e-01   +4.364036431537581e-01; +9.754142777658177e-01   +6.593037768861083e-01   +4.671184957391949e-02   +9.654031841119330e-01   +7.210206112502847e-01   +9.037749399547728e-01   +5.905009846494097e-01   +9.914660919721840e-01; +6.750186945916654e-01   +8.516921833754774e-01   +8.681548880316942e-01   +1.842183607987025e-02   +5.547909921994041e-01   +1.067936007980084e-01   +4.865548670949449e-01   +9.958896940291854e-01; +3.365804831231624e-01   +9.450840352396590e-01   +6.109292248277400e-01   +8.984795528763934e-01   +5.129503928441083e-01   +7.556005604613224e-01   +6.776309122383497e-01   +5.464300090391363e-01; +9.547569328039951e-02   +3.289018863493588e-01   +7.460753349123042e-01   +8.017039520516255e-01   +3.152149100269355e-01   +5.076398746740158e-01   +7.814691789908152e-01   +5.284158153498092e-01; +9.981069472907098e-01   +9.608371633149404e-02   +4.213457261626143e-01   +3.726835127212969e-01   +7.269044909173643e-01   +7.428657207329915e-01   +6.491847092503085e-01   +7.789414431950592e-02; +6.713470239453956e-02   +2.423432376990854e-01   +9.024408232508185e-02   +2.964179066449980e-01   +2.491786526187711e-01   +1.795183259615925e-01   +4.476812794140671e-01   +8.258632589841910e-01; +7.778193314475980e-01   +2.735677620900590e-02   +4.730530009424398e-01   +6.142659574432744e-01   +1.863120038384335e-01   +9.126796266063090e-01   +6.738968611619508e-01   +4.008515202014991e-01; +6.606087659085043e-01   +4.468730091160604e-01   +3.240516077033417e-01   +9.152972580326112e-01   +1.136590581004876e-01   +2.371012070619750e-01   +1.694830574863567e-01   +9.127811765191514e-01; +7.553406847975551e-01   +7.856805640041542e-03   +7.593132158028142e-01   +1.952683251498399e-01   +1.506968183927371e-03   +1.833362942029082e-02   +6.063700936843248e-01   +5.892049014623701e-01; +4.139331084721305e-01   +4.288519540406287e-01   +4.711339983730010e-01   +3.152061677781437e-01   +3.251344240343862e-01   +8.878631746152412e-01   +2.950328370829760e-01   +2.867757222142272e-01; +2.925414145285630e-01   +4.500311762198029e-01   +3.209724153958380e-01   +5.765416470120922e-01   +5.530736146812552e-01   +7.753632833508306e-01   +4.556090626742781e-02   +2.874058236231419e-01; +4.300506235427655e-01   +6.336723411250416e-01   +1.525795132181375e-01   +4.126633281614345e-02   +1.165213867878945e-01   +7.398194637095519e-01   +4.068173819591471e-01   +1.559680902052660e-01];
L1E_L2E_iAMPA_netcon = [+9.878444891831252e-01   +3.615271798263644e-01   +4.489647838037447e-02   +9.326024663913278e-01   +2.704710200529514e-01   +1.406087579375369e-01   +8.152875995925630e-01   +8.452940823789734e-01   +1.059422819789980e-01   +6.109764464007030e-01   +8.603032368876090e-01   +5.407348290409324e-01   +3.702340745057012e-01   +3.507353016551916e-01   +5.751608974333824e-01   +3.981069406057813e-01; +1.920820844597866e-01   +8.916601601671303e-02   +8.363265982786700e-01   +4.941276343554780e-01   +1.169557359795514e-01   +9.313485332239392e-01   +7.462428875381389e-01   +2.668140697126491e-01   +5.489007370158164e-01   +5.997538253574433e-01   +9.410493978528700e-02   +4.516626329347168e-01   +3.295382008834651e-01   +3.076016669389235e-01   +2.701391227099350e-01   +5.276294681288518e-02; +1.360858227008416e-01   +2.109238074305703e-01   +1.863237637680772e-01   +6.621536858433444e-01   +4.114772770774973e-01   +5.476140954050170e-01   +6.900580899665758e-01   +3.441591612930637e-01   +1.186806714309385e-01   +4.879571961729378e-01   +8.226032441980282e-01   +6.411157487285840e-01   +2.298155434918968e-01   +3.358779104627097e-01   +3.298142489090883e-01   +6.278562301141404e-01; +2.116509216894289e-01   +3.649464362253163e-01   +3.750559329485291e-01   +8.859561831318621e-01   +3.090518116874860e-01   +2.825621165119906e-01   +9.772603035918837e-01   +3.997990666265094e-02   +2.828099418409700e-01   +3.962550732787341e-01   +6.595276827085238e-01   +2.882401370286791e-01   +3.417117256624911e-01   +6.305617053801594e-01   +3.770322118044545e-01   +6.606933989015442e-01; +3.746426091675070e-01   +5.561588581529289e-01   +9.105904584858433e-01   +7.676940794204320e-01   +8.268351716377920e-02   +8.010449116021561e-01   +8.971705815874715e-01   +3.294837630391695e-01   +9.461719054761351e-01   +3.427804139648444e-01   +9.254290904843873e-01   +4.792460481355026e-01   +8.757695243673418e-01   +1.679473748383720e-02   +4.622226993075580e-01   +1.736904172859248e-01; +7.025819935930796e-01   +4.659413927547380e-01   +9.578283043363850e-01   +3.677683804132108e-01   +3.022794625291597e-01   +3.285282684625969e-01   +6.531406217012893e-01   +7.288759440557636e-01   +4.925149695149974e-01   +5.158448732735560e-01   +5.598396549520344e-01   +7.984544333594490e-02   +7.673678723499985e-01   +4.860569112987883e-01   +4.956603949090891e-01   +4.821537561761768e-02; +4.366747031467330e-01   +7.251024324239017e-01   +7.001430895286963e-01   +7.551427638372363e-01   +5.774367829538886e-01   +2.044657176422169e-01   +4.971658382193118e-01   +3.687593908571920e-01   +1.331341481220594e-01   +2.578172328908881e-01   +1.918085271811224e-01   +6.023366995261875e-01   +8.687564371653391e-01   +2.779737749079384e-01   +2.037838774521427e-01   +6.091433537716295e-01; +6.068244323297804e-01   +9.659138411908021e-01   +3.577482028228997e-01   +3.613951692882399e-01   +3.508789729750666e-01   +3.625234049347048e-01   +1.720670475859236e-01   +5.909527868980919e-01   +1.456548869315814e-01   +1.964499783671859e-01   +5.746286360842006e-01   +3.458745719471322e-01   +8.807657936282207e-01   +9.893566376304220e-01   +2.433651856717929e-01   +8.839554252402946e-01];
L2I_L2E_iAMPA_netcon = [+4.942744047541304e-01   +5.229690913464213e-02   +7.170787331567730e-03   +9.862382959521466e-01   +5.216682231009360e-01   +4.490166267777380e-01   +9.899082070670563e-01   +1.435654680657790e-01; +3.321837503014593e-01   +6.896150492390852e-01   +6.846875080905183e-01   +9.088754712923107e-01   +2.736091024958117e-01   +2.649703132474555e-01   +6.229020249908401e-02   +3.104054608881843e-01; +1.724751665581702e-01   +4.619971441932003e-01   +7.494674807209462e-01   +4.258542784020071e-01   +4.400011598183322e-01   +5.223570836945779e-01   +5.551032267771078e-01   +2.660999317190499e-01; +4.982729735241067e-01   +8.807104182338819e-01   +9.641830704897880e-03   +6.610123076145334e-01   +4.679184836981354e-01   +3.193909638607156e-01   +6.510005191854630e-01   +6.353896452668258e-01; +2.383546774592680e-01   +9.992172968139383e-01   +7.444685662871217e-01   +1.161134415891669e-01   +3.572243124577502e-01   +4.964647733657737e-01   +1.704825142822866e-01   +9.444815216796112e-01; +3.372266100600700e-01   +5.714199526513078e-01   +5.622931298915909e-01   +7.888816918651578e-01   +7.942247568352712e-03   +6.495720610752669e-01   +5.879080398568549e-01   +2.856936591483228e-01; +3.276561948645139e-01   +5.018338495163673e-01   +6.752100120955334e-01   +5.729976201936156e-01   +3.617318330821043e-01   +2.800274199611178e-01   +1.266012025716526e-01   +4.919020650620439e-01; +3.060735769475204e-01   +5.132240762023191e-01   +7.232424184770347e-01   +4.092913355315876e-01   +4.723658932816929e-01   +1.098242139797426e-01   +3.222511738062969e-01   +4.336574246481639e-02];
L2E_L2I_iGABA_netcon = [+9.989086897816165e-01   +1.317969543695003e-01   +5.857926875418774e-01   +7.888379227737223e-01   +8.107863407414095e-01   +8.090307834430095e-01   +4.823546005813268e-01   +4.609006549079412e-01; +5.498180118788790e-01   +7.224544997422753e-01   +9.825383118988631e-01   +6.921138575363870e-01   +6.230028173134302e-01   +9.167060223038425e-01   +9.478431089199785e-01   +8.376604463926041e-02; +5.587392746751715e-01   +3.464705961244172e-01   +9.477245088336705e-01   +5.838941828710257e-01   +4.291108461141141e-01   +8.186974110058618e-01   +3.901484966351935e-01   +4.022632822096214e-01; +5.637406305700446e-01   +2.921354053363880e-01   +6.758174384453789e-01   +5.705745356996876e-01   +5.582749371535672e-01   +9.959845101111924e-01   +6.762108184604834e-01   +3.201776697054620e-01; +1.298995954286286e-02   +9.481404566038872e-01   +6.380965977268807e-01   +4.222058304881514e-01   +8.201420813536551e-01   +6.493846625444792e-01   +5.047330018481786e-01   +9.475052783156863e-01; +3.637398050893612e-01   +2.085831663778778e-01   +4.385563789344302e-01   +8.146057377572650e-01   +7.353696755615080e-02   +7.319369205379809e-01   +8.666139457076877e-01   +4.320355931293343e-01; +1.459114581235548e-01   +2.548451403243526e-01   +8.079831046922747e-01   +8.924597221371713e-01   +2.544399955159947e-01   +5.021626605895870e-01   +6.302123004350617e-01   +6.089955601013870e-01; +7.556319509729444e-01   +8.047189496801700e-01   +2.738584676268681e-01   +4.101408265621344e-01   +2.007773786390767e-01   +1.235690179602407e-01   +1.435217637544107e-01   +4.146814266835434e-01];
L3E_L2E_iAMPA_netcon = [+6.425716391885247e-01   +2.703513190345302e-01   +6.074891289590759e-01   +2.598864659384632e-01   +9.927114356644617e-01   +4.494724496106099e-01   +1.268978528869459e-01   +1.584412032851855e-01   +3.216307007552459e-01   +2.148239002149087e-01   +9.159242007421202e-01   +5.578133762995230e-02; +4.003049584591031e-01   +8.003054759066064e-01   +8.238771876579963e-01   +1.116369323743927e-01   +2.485310296274136e-01   +7.695383402994577e-01   +2.717509616086423e-01   +2.884884874539960e-01   +4.754531474491496e-01   +1.485225929341606e-01   +8.056160291643487e-01   +8.764556049316378e-01; +5.702787733643653e-01   +3.463205518651428e-01   +6.355750332871826e-01   +8.451183341678170e-01   +5.645259943071730e-01   +4.930992260221891e-01   +3.944916620938650e-01   +7.141007751893584e-01   +5.612531268025251e-01   +8.097929226065956e-01   +1.675560339276901e-01   +6.542916321610224e-01; +4.823440494765665e-01   +4.359766562673811e-01   +6.796162501297969e-01   +5.188085822338541e-01   +2.765818504321598e-01   +9.332175581476992e-01   +2.094977439157975e-02   +5.784003592840242e-01   +3.328397800541918e-01   +9.437601593473166e-01   +4.331136211876829e-01   +5.645531073232185e-01; +1.453195253054890e-01   +3.141381549314496e-01   +5.855906565862971e-01   +3.833953805722599e-01   +6.087993401447584e-01   +2.723024352506265e-02   +7.869553297478366e-01   +1.698802397273733e-01   +7.414373434411903e-01   +6.589506756153506e-01   +6.165487870294027e-01   +7.455720534675210e-01; +6.767878159450049e-01   +9.173226183464306e-01   +1.799357331537740e-01   +1.640944473969561e-01   +3.289180523910078e-01   +6.523747858658672e-01   +7.120130790060255e-01   +1.511803514792593e-01   +4.893127778203216e-01   +4.238430942486348e-01   +8.771175148453076e-01   +3.700273839480269e-01; +2.801138415241127e-01   +7.405256785569003e-02   +3.708721035086660e-02   +5.131282135192911e-01   +2.057902214032852e-01   +2.912895155424485e-01   +3.666850520582181e-01   +9.022289198028479e-01   +9.269648770431257e-01   +6.106102643424709e-01   +5.372605819264786e-01   +9.718395690973043e-01; +5.673868561074856e-01   +5.518280787436683e-01   +5.520912785192698e-01   +6.848092863912211e-01   +8.822959412762588e-01   +2.276231166886094e-01   +4.396636743202853e-02   +2.103133035943704e-01   +4.431441644530527e-01   +6.745546282779302e-02   +5.557894048905065e-02   +9.980837196224680e-01];
L3I_L2I_iGABA_netcon = [+5.587667628989778e-01   +7.397929698699353e-01   +7.528004250778685e-01   +7.768943414693334e-01   +5.353998425921980e-02   +5.177479277743237e-01   +4.747203418410127e-01   +6.944084666166102e-01   +2.038365713144968e-01   +9.747418122383333e-04   +9.161144002351614e-01   +3.277126887256457e-01; +9.823017477696490e-01   +2.019478389476242e-01   +7.702521815862078e-01   +6.737598454588516e-01   +3.580630024970436e-01   +8.002164536127387e-01   +8.785862745049412e-01   +1.407321596884350e-01   +2.657526193931681e-02   +7.880192352583486e-01   +6.906852333755161e-01   +5.471182828862753e-02; +5.874944278438928e-01   +4.983580160152186e-01   +5.443015022826619e-01   +6.279642682731857e-01   +6.914968314771852e-01   +9.750599113413831e-01   +8.146674737720269e-01   +3.190891261197794e-01   +7.102630195039317e-02   +8.325654876823591e-01   +3.618761077433041e-02   +8.810861657923122e-01; +7.933766005176335e-01   +3.032921067270474e-01   +6.564405931019301e-01   +6.500109110378687e-01   +9.176451347649575e-01   +6.090971140555524e-01   +6.045570533608615e-01   +6.489604066294958e-01   +7.315073998506174e-01   +9.666838002475472e-01   +5.307706482367186e-01   +3.813133330754792e-02; +9.483394452614395e-01   +2.089095929641183e-01   +2.990262855081188e-01   +1.863051577157503e-01   +9.726688078284751e-02   +8.624733614715117e-01   +3.273619065109797e-01   +2.543392287766707e-01   +7.377451674787897e-01   +5.937781575948756e-01   +1.535315472376463e-01   +9.625322143079452e-01; +2.714032626424603e-01   +3.882105342554241e-01   +9.381466241647997e-01   +5.581096642526914e-01   +6.038669031123323e-02   +4.187852629829039e-01   +4.935635559145438e-01   +6.802677093801809e-01   +4.261810369282448e-01   +1.140299596278946e-01   +2.825131186864613e-01   +6.009548845402916e-01; +5.566903372818709e-01   +4.910583429710674e-01   +6.491857685041420e-01   +2.695656653702710e-01   +1.136626173320612e-01   +8.798402990337755e-01   +7.704094814522792e-01   +6.981402658921476e-01   +5.869891634617064e-01   +1.992030736923522e-02   +8.370489122746255e-01   +7.235166798129586e-01; +8.768625794951961e-01   +1.518386902905593e-01   +2.424542454867702e-01   +2.950599233103368e-02   +7.097572200244865e-01   +3.732344651982487e-01   +6.822480087509649e-01   +3.303674138130174e-01   +6.243829585872599e-01   +9.271113686584029e-01   +3.569763787532318e-01   +8.533484628287392e-01];
L2E_L3E_iAMPA_netcon = [+3.962525674297177e-01   +3.422552664299862e-01   +9.251135522808230e-01   +4.577392332543968e-01   +2.296163352001683e-01   +6.332583467727869e-01   +9.324418743837590e-01   +5.533297124640060e-01; +3.211199424481005e-01   +4.356417605043714e-01   +6.883406222347301e-01   +9.822678592362721e-01   +1.510291006118005e-01   +6.528484090228368e-01   +8.155349526376959e-01   +2.812807947950866e-01; +7.531390244680451e-01   +9.441524048510189e-01   +7.878905296489807e-01   +1.159837195615071e-01   +4.716945074391099e-01   +4.325047985482718e-01   +7.956727509683699e-01   +5.449771466477804e-02; +8.405963885977479e-01   +6.816101679663837e-01   +7.384728364415137e-01   +4.979057545502019e-02   +4.921718953005552e-01   +1.215236923020603e-01   +2.258951839074763e-03   +6.216157598954823e-01; +7.341315703882143e-01   +4.271819312565969e-01   +8.819661957684294e-01   +2.014484424226121e-01   +1.906999102841954e-01   +4.479793807335316e-01   +5.622438871603693e-01   +3.025634611441959e-01; +5.274199904098581e-01   +3.378536998159465e-02   +2.243458216955533e-01   +9.616718619792293e-01   +8.527452901796516e-01   +2.209021765624634e-01   +5.922072264554007e-01   +6.084928617379862e-01; +9.325086862123996e-01   +4.758121903552183e-01   +4.615185683332634e-03   +2.290354767388918e-01   +1.233279639015497e-01   +5.454047600579083e-01   +4.537045744231900e-01   +6.327266611832461e-02; +7.398139311392438e-03   +7.699673157122396e-01   +5.038189741962487e-01   +9.519919079201067e-02   +2.906727207326200e-01   +1.874117776022957e-01   +9.456742262731086e-01   +3.555652748362437e-01; +7.967917544021855e-01   +7.966821967152841e-01   +2.252928132977973e-01   +2.431142714204995e-01   +6.935326116737203e-01   +9.905968240563033e-01   +7.282421353005759e-01   +5.339028510018909e-01; +9.603998962476357e-01   +6.047819917726504e-01   +9.338443195967936e-01   +4.210773112670740e-02   +9.596578898074462e-01   +2.446819731084483e-01   +5.331294904355119e-01   +5.888832283407711e-01; +4.932716574238848e-01   +9.856963188509217e-01   +5.832517133208829e-01   +9.713824221015810e-02   +9.032124661874918e-02   +9.250683052022134e-01   +4.952514555317238e-01   +9.145052680367672e-01; +7.379922727524448e-01   +6.541744220037620e-01   +3.519521351358776e-01   +4.948128036021096e-01   +2.322911027152202e-01   +3.317341528879089e-01   +3.472736814083416e-01   +3.970605777451862e-01];
L2I_L3I_iGABA_netcon = [+8.547053387959921e-01   +2.230623356000344e-01   +4.426306994285486e-01   +6.249364054769755e-01   +6.692563909103930e-01   +6.280940068080501e-01   +5.556415744941344e-01   +4.698561097286794e-01; +2.914069526964275e-01   +1.613489199374689e-01   +7.499599605141117e-01   +5.889834368658308e-01   +6.463398328930714e-01   +6.195857308234406e-01   +2.795811598416358e-01   +9.037512180817735e-01; +7.523103177577308e-01   +7.000977904406183e-01   +1.340076749462874e-01   +2.638610985683398e-02   +3.517913946884998e-02   +9.224240917818449e-02   +9.231712065967979e-02   +8.845477204123480e-01; +2.495058644507213e-01   +3.819073884231228e-01   +1.312334289390248e-01   +6.991815290004194e-01   +4.538749240145618e-01   +2.152662923737858e-02   +8.765019491304632e-01   +8.670922548688154e-01; +3.059775629326522e-01   +4.892292711437172e-01   +2.518199650494491e-01   +9.290808863057006e-01   +3.315033380058798e-01   +4.435864464202876e-01   +9.660566750447502e-01   +8.114077855032306e-01; +4.048776548005053e-01   +1.791769283358122e-01   +7.833576557553135e-01   +9.585117524844716e-01   +8.571756446055578e-01   +3.545302497245220e-01   +1.585252660909142e-03   +2.588335524379740e-01; +9.312141689504494e-01   +6.924798109952159e-01   +3.857450716395160e-01   +3.494009911004448e-01   +6.715033997909490e-01   +2.872581335133150e-01   +6.150763159787580e-01   +8.324754504818567e-01; +3.649244217730637e-01   +8.177167568928254e-01   +9.794907497009193e-01   +7.433078233339299e-01   +9.319111477395311e-01   +5.199748866907161e-01   +8.164586912114458e-02   +9.089780766198815e-01; +6.026221419600108e-02   +4.941026159056939e-01   +8.481350679374295e-01   +3.327255687836594e-01   +8.082122002191897e-01   +8.804795385278034e-01   +1.932383480625930e-01   +3.333911865780936e-02; +5.672943289647568e-01   +8.915250468048229e-01   +4.290131111119863e-01   +7.978410794419024e-01   +5.414632677382203e-02   +4.502102619085354e-01   +1.821486873234868e-02   +9.413477930284249e-01; +3.759893471053368e-01   +5.572182376705502e-01   +2.665760431300850e-01   +7.809722446202193e-01   +9.687430348545643e-01   +7.305263428915744e-01   +6.825158922431731e-01   +3.555853645542169e-01; +6.959573737675329e-01   +8.963801777622626e-01   +7.469702557372039e-01   +8.512117879041691e-01   +5.626869715317945e-01   +8.881132255437529e-02   +9.111622954666609e-03   +1.560320973145275e-01];
L3I_L3E_iAMPA_netcon = [+8.600513141693148e-01   +1.209615303717803e-01   +2.034449519944332e-01   +8.195128178073918e-01   +5.130941725921404e-01   +1.962572431238956e-01   +1.530887668212996e-01   +1.067437910886196e-01   +4.502571679313999e-01   +4.944109431270235e-01   +5.497947088370547e-01   +9.783267910387163e-01; +8.990171783880196e-01   +8.931478536944617e-01   +8.729190096957058e-01   +5.983150840758732e-01   +1.129145623091737e-01   +1.093310350344715e-01   +4.436852422213632e-01   +1.865661663197826e-01   +1.968846850038619e-03   +4.094380245118204e-01   +1.351133813096639e-01   +6.849561195437908e-01; +1.093685146758216e-02   +6.759533526371633e-01   +4.345800170135262e-01   +6.535261895310110e-01   +8.750091062790374e-01   +3.991288059214105e-01   +8.218293091442056e-01   +9.689205105516571e-01   +9.777200221062033e-01   +7.253732977463869e-01   +8.912911497830832e-01   +3.091638373671169e-01; +3.566344844588368e-01   +6.095723457726814e-01   +4.535982229270696e-02   +1.853176630862265e-01   +1.429836780034036e-01   +1.294304857234528e-01   +2.539222658607322e-01   +9.457689613378952e-01   +6.404566706282525e-01   +6.780063861382314e-01   +3.648641748667485e-01   +5.243293812225635e-01; +9.617506120139849e-01   +9.895950168490062e-01   +5.573029948715317e-01   +8.281570242251424e-01   +4.614674993331439e-01   +5.451442408000166e-01   +4.061504009177984e-01   +3.167509745371712e-01   +6.905269321363652e-01   +1.646181207944365e-01   +7.998317823320271e-01   +7.164474261868825e-02; +9.921171761889713e-02   +7.962743146535319e-01   +6.424396629268635e-01   +8.652311276523523e-01   +3.764689558574817e-01   +9.207050538174476e-01   +5.848204860268911e-01   +9.773119244876468e-01   +8.402248367788347e-01   +1.939384536647459e-02   +2.126947136944276e-01   +4.985171089771213e-01; +8.768933410581898e-01   +9.502777709983046e-01   +5.958176226296282e-01   +2.095533949252542e-01   +4.576315550807468e-01   +2.573445664819565e-01   +5.010872810415381e-01   +9.003491004068886e-02   +4.504729159876852e-02   +2.710978792911257e-01   +1.252614775272789e-01   +4.315143439520412e-01; +1.492307003622166e-01   +3.677196796109380e-01   +7.534288554022193e-01   +1.318614637932215e-01   +6.489318830957377e-01   +3.602206640150566e-01   +3.839535141531625e-02   +8.184387617633312e-01   +5.925372973229232e-01   +8.596080699001252e-02   +3.967367477153256e-01   +7.678466665898547e-01; +5.169032991603778e-01   +6.547845343731694e-01   +8.949527079426843e-01   +2.942071155704107e-03   +7.804404810607785e-01   +2.411566711701001e-01   +8.279273103751547e-01   +5.816393272046783e-02   +7.802147529047094e-01   +3.451303545469186e-02   +9.913325098522218e-01   +5.656769951792531e-01; +5.473904495654428e-01   +1.986873058338319e-01   +9.083761286346376e-01   +1.202792940061905e-01   +1.667190576123695e-01   +8.194878699512598e-02   +7.890698716184196e-01   +2.517359633230611e-01   +3.333229981989403e-01   +5.927691830148579e-01   +1.478413622261706e-01   +9.979138390626192e-01; +5.474483320001809e-01   +6.838922205307209e-01   +3.265995867985646e-01   +1.833347707053333e-01   +1.353519021572901e-01   +4.463678301835916e-01   +2.004630713596630e-01   +9.017504074706667e-01   +2.591874960494065e-01   +3.400364579418946e-04   +5.274178138157467e-01   +8.737108707626842e-01; +5.843920063287225e-01   +3.138304213929558e-01   +3.971098402377073e-01   +8.029043221389485e-01   +3.386209070186993e-01   +1.620679776178218e-01   +9.769755697004057e-01   +6.684577266592887e-01   +4.622499307813706e-01   +8.732890273254443e-01   +5.971552930515150e-01   +8.985397861418140e-01];
L3E_L3I_iGABA_netcon = [+4.555347376347899e-01   +6.821422745851368e-01   +1.610006236613384e-01   +6.916636536103091e-01   +7.787450339549233e-01   +1.560395091415913e-01   +2.006953901069686e-01   +7.903578270520687e-01   +2.384440059126688e-01   +2.427117258845551e-01   +7.985691776216475e-02   +4.838945367304515e-01; +9.551158623845093e-01   +3.612122079913048e-01   +7.544798859494662e-01   +8.534075970231341e-01   +8.994948018127206e-01   +4.895439710115468e-02   +2.939582571581842e-01   +8.672186737882071e-02   +1.395382606201276e-01   +8.808521968779509e-01   +5.234801178888234e-01   +9.366554991100011e-01; +9.698667402895373e-01   +3.614121127134010e-01   +7.240630149093276e-01   +9.157420374627261e-01   +5.464612084092895e-01   +9.811596818145525e-01   +8.813355017560481e-01   +2.190634430892420e-01   +9.595194630686367e-01   +7.144226291995649e-01   +2.991525607997861e-01   +3.781446232421717e-01; +9.597619348687414e-02   +5.504450280793849e-02   +5.266132106784405e-01   +6.741873552664848e-01   +8.707548137923571e-01   +8.587951958025026e-01   +4.565054516675240e-01   +5.402075507636339e-02   +7.810361933900629e-01   +1.861628162438648e-01   +9.146390805510427e-01   +6.709773655271682e-01; +7.594012308741583e-01   +5.372296094362098e-01   +9.753687173205861e-01   +6.648021303808125e-01   +7.575663405708697e-01   +5.981228619053571e-01   +3.047239614258133e-01   +9.012295246317136e-01   +7.257892142507569e-01   +9.670946654030710e-01   +2.625609440959932e-01   +2.008712570587363e-01; +5.693522187832353e-01   +3.172659669692868e-02   +1.227694312093499e-01   +4.393775028857648e-01   +1.360551311758690e-01   +3.881305723321228e-01   +1.181836001227983e-01   +8.229510561827543e-01   +8.873073363204722e-01   +4.640071069239383e-01   +1.234211530316491e-01   +7.797224123556878e-03; +4.384801865948443e-01   +1.817916423955050e-01   +2.152449628950400e-01   +8.748572133600311e-01   +4.643182614016939e-01   +4.014428998703630e-01   +7.377070135519542e-01   +8.201687237291031e-01   +9.161885777761113e-01   +4.675794327173614e-01   +7.518444511622419e-01   +6.851873658240936e-01; +8.236090048139005e-01   +7.602353127359007e-01   +4.466870248060384e-01   +7.642961201535143e-01   +3.258398278108693e-01   +5.272311328584887e-01   +8.282354417806559e-01   +5.152803729969493e-01   +4.265550801922979e-02   +7.503865962600517e-01   +9.875204649150969e-01   +2.135424685023815e-01; +8.648590599152449e-01   +6.223639718609330e-01   +8.183859065911094e-01   +3.923857471647672e-01   +4.855905934395379e-01   +5.419438471787456e-01   +8.942786410015935e-02   +9.504348723276492e-01   +8.807739329157045e-01   +2.051301394270727e-01   +4.750084664846623e-01   +8.386223394363251e-01; +8.196993280426037e-01   +2.003499118228768e-01   +6.015536714384242e-01   +5.730649223011451e-01   +5.882652509196065e-01   +7.809218398178733e-01   +2.293711038939757e-01   +3.522858206981090e-01   +2.469391713232958e-01   +5.688171752265446e-01   +4.863662276878651e-01   +9.348586343314800e-01; +5.363246799842032e-01   +4.358491114278013e-01   +8.726777958180687e-02   +7.351156769383004e-01   +4.762662381940608e-01   +2.492979390344945e-01   +8.244403249557608e-01   +6.804904565051717e-01   +5.762763162096609e-01   +9.822608946023198e-01   +3.131173194347436e-02   +9.480911838817948e-01; +7.755707074130964e-01   +1.153958661603265e-01   +5.264462212886736e-01   +5.026156111527703e-01   +8.367004323469851e-01   +3.688663508281735e-01   +6.597228928412509e-01   +5.382251073753108e-01   +9.362199515682768e-01   +7.406374598244472e-01   +3.366898142689646e-01   +4.875561790958634e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last =  5.6 * ones(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  5.6 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 10*((exp(-10*((t)-( 50))^2)));
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = -10*((exp(-10*((t)-( 50))^2)));
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 10*((exp(-10*((t)-( 50))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = -10*((exp(-10*((t)-( 50))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
