function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.436596959435829e-01   +4.209856181061514e-01   +4.185712180056371e-01   +3.800420387297264e-01   -3.266351628038580e-01   +6.220383085430166e-01   +7.433973247552842e-01   +5.393297843214121e-01   -3.913842922853674e-01   +5.985948452190711e-01   +5.374227871767627e-01   +2.624481848381668e-01   -1.031596658133567e-01   -1.427683979872557e-02   +3.281807972138461e-01   -7.049089838781267e-02; -9.755528404995548e-02   +4.584451059639210e-01   +5.055019134509494e-02   +6.385147683540784e-01   -1.139988719292852e-01   +5.338384259318860e-01   +8.242991870642109e-01   -2.912669424805374e-01   +7.448958368938046e-01   -5.692785924139132e-01   -7.090353435597089e-01   +3.645423570578912e-01   -2.218966979918265e-02   -1.455813820942670e-01   +6.773205176208171e-01   -3.850407251672994e-01; -2.627166158439357e-01   -6.924812787559425e-01   +7.161376454047356e-01   +4.822413258929300e-01   -5.027792863514791e-01   -1.697719311763598e-02   +6.132710287510383e-01   +2.790734957984850e-01   +5.635776750195644e-01   +8.318999135483296e-01   +3.551956696809132e-01   +3.287083564246635e-01   +8.797153011072062e-01   -3.177519897113161e-02   +4.581263098414319e-01   +2.217006274931201e-01; +6.205703769058887e-02   +1.770892748264772e-01   -9.710857716094835e-02   +9.030450532849869e-01   -9.746649944050248e-02   -1.335676330589736e-01   -4.237359818320594e-01   +2.120514576787262e-01   -4.324961594610953e-01   +5.199997503102837e-01   +4.315109578003992e-01   +3.041467587306522e-01   +6.365069603629324e-02   +5.375176411126463e-01   -2.171924353678848e-01   +2.150380797785506e-02; -2.769162758462109e-01   +2.777268366940949e-01   +7.098425963184178e-01   -2.304065112103488e-01   +6.611029170435165e-02   +5.632140045879340e-01   -1.527098683533503e-01   +1.815466994019642e-01   -1.757422848690663e-01   -2.322233210897241e-02   +5.408326426943277e-01   -9.494222622984121e-02   +1.466840322160535e-01   +4.181575678829985e-01   -1.284849960986701e-01   -6.509496962662773e-01; -5.618377338257875e-02   +6.170306007344681e-01   +7.447322386360514e-02   +5.962292235316083e-01   +2.896673990112570e-01   -4.228309431802019e-01   -9.999806926696622e-03   +2.538831801011385e-01   -3.840219860939236e-01   +4.492978315809074e-01   -4.871406703416449e-01   +1.070626979987760e-01   +6.490878308090592e-01   -2.362353722718635e-02   +9.244059318699493e-01   +3.080910697851172e-01; +4.610327254058474e-01   +6.099903664448256e-01   +4.384601361151816e-01   -2.196013449137317e-01   +5.240986992144042e-01   +2.468049434940461e-01   +8.432584000125065e-03   -2.001831564082596e-02   -3.497847819199519e-01   +6.951581800096467e-01   +4.906617840111074e-01   -3.007396495427715e-01   -9.841654447686238e-02   -5.057866897184631e-01   +4.712133784656574e-01   +6.067564555898052e-01; -2.134418492203919e-01   +4.977624633279281e-01   +7.288185636989883e-01   +5.678060585836606e-01   +4.609411799076873e-01   +1.507940740573641e-01   -6.156854209942858e-01   -1.618634797928762e-01   -1.652477208314765e-01   +6.158840118609454e-01   +3.482835439031481e-01   +6.691675504329844e-01   -2.570116352445539e-01   +6.663068818389528e-01   -1.347657816206894e-01   +6.453010070321753e-01; -5.925125564012483e-01   +2.550044803720470e-01   +2.711394000109890e-01   +3.268735206423123e-01   -6.015977818092251e-01   -6.715005988127165e-01   +6.014786467638997e-01   -4.906357196507063e-01   +1.358546339453706e-01   -4.930046554851253e-01   +1.240405528118033e-01   +1.079297722471829e-01   +7.995467705050751e-01   -4.809637431578906e-01   -3.287142682970837e-01   -7.259308986713572e-01; -4.889535053653174e-01   +2.916438902346198e-01   +3.939119369887403e-01   +4.782329683667046e-01   -4.340319025775290e-02   +9.676196724713326e-04   -1.166452489327505e-01   +7.621844505591321e-02   -3.544005371505668e-01   +5.533504444207166e-01   -1.204342309316205e-01   +3.928735237067790e-01   +8.661356116597684e-01   -2.746598092038676e-01   +5.960621938907844e-01   +4.233681506119572e-01; +3.916795675605659e-02   +1.461014710813539e-01   +1.709242288138312e-01   -7.306931047072798e-02   +5.156542433121251e-01   +6.150458261346923e-02   +4.981883205858263e-01   -4.370348233669676e-01   -2.213779978187236e-01   +7.649180439120911e-01   +1.813330653524532e-01   -3.554818303007468e-01   +3.180229009099917e-02   +3.652937083760352e-01   +5.521564541254389e-01   -4.013304157155469e-01; +8.356415533384391e-02   -4.938361968082175e-01   -3.264687164198067e-01   +9.860557573499641e-01   +2.280123102001303e-01   -2.560197456061885e-01   +5.205347391335277e-01   -7.305854244108494e-01   +7.166407395774499e-01   -5.429969787416365e-01   +7.472414156988517e-01   +5.481907705072687e-01   +3.355433257811639e-01   +1.600744434178858e-01   +7.048621118896690e-01   +1.969379857806104e-01; +9.331354117021162e-01   +5.749815685581868e-01   +4.210585891679215e-01   -4.604838330073580e-01   +2.814923693225454e-01   +4.532185755793940e-01   +7.620579781166392e-02   +4.985041207003854e-01   +8.249441192254034e-02   +2.288748016140968e-01   -3.957338747441849e-01   +2.061238307828904e-02   -1.311626562642919e-01   -4.837706229954277e-01   +2.464601637216293e-01   -8.762095207652446e-02; -1.996602107508510e-01   +4.189860012898638e-02   +1.959903343986204e-02   -6.936990242311590e-02   +7.694801259212168e-01   -3.661606134156364e-01   +9.373369890766277e-02   +6.372195551186657e-01   +4.815258852596713e-01   -9.465862988882001e-02   +4.031764567999717e-01   -5.639660770109254e-01   -1.920581674004237e-01   +5.758259030647365e-01   -6.037665466744946e-01   -2.177689979355482e-01; +5.848364011897351e-01   -4.982267633926344e-01   +8.485779533620605e-02   -4.328845963920877e-01   -4.833277732574592e-01   +8.966288214726862e-01   +5.447508364517090e-01   -6.343664559954227e-01   -1.686534548782672e-02   -3.242280116990593e-01   +2.949503193639679e-01   +6.030320199405413e-01   -5.125678188952226e-01   +6.307618937665402e-01   +1.000000000000000e+00   -4.211491440071981e-02; -2.356898354260342e-01   -6.791887389530088e-01   +5.605793532608168e-02   +2.991513543802913e-01   +5.565792160193518e-01   +8.336436077716101e-01   +4.244904552325404e-01   +2.731166903239995e-01   +5.405493893127278e-02   +1.874665813702866e-03   +2.588525381409499e-01   +5.833952754192813e-01   +6.011242868323580e-01   -4.238790439806407e-01   -3.213791092457793e-01   -3.709231221001256e-01];
L1E_L1I_iGABA_netcon = [+7.893513220584862e-01   +1.047268353055960e-01   +2.910592900933949e-01   -3.923415824315045e-01   -2.039417155982678e-01   -3.961250106748699e-01   +5.806726931249246e-01   +2.009440797400925e-01   +5.066187648061775e-01   -4.451569588009163e-01   -4.066060222686124e-02   -1.646093802099449e-01   +4.898718330602889e-01   +1.056628728017914e-01   -3.031629509405404e-01   +8.529776527655673e-01; -2.810368763791736e-01   +1.828061707711960e-01   +2.629676944506405e-02   +5.242693140282014e-02   -2.077487072351870e-01   -1.674794852484439e-02   +4.006726879968558e-01   +4.137447793327197e-01   -2.281089960924258e-01   +7.993419134828937e-01   +2.465982674761782e-01   +6.496598434672746e-01   +3.160741200417821e-01   +7.506628422002695e-01   +7.286461616878757e-01   +6.162218500058253e-01; -3.907915526472581e-02   -3.793323283775879e-01   -2.872871191302131e-01   +2.564333558097649e-01   -4.470062677345158e-01   +8.559773000146575e-01   +2.017092468334283e-01   +6.802530350445350e-01   -9.698015784594995e-02   -4.030319511278795e-01   +4.174404829412439e-01   +3.033810104774291e-01   +8.012569916580563e-01   +4.140933103808150e-01   +2.262215327462198e-01   +4.537119630473411e-01; -1.209735478853170e-01   -7.110164946081436e-02   +4.450733175568082e-01   -1.398996729287866e-01   -2.834272083700247e-01   -3.301713990922483e-01   +4.106064737543907e-02   -1.264250686304385e-01   -1.408266455262510e-01   +1.793070827251296e-01   +2.978626777447609e-01   +2.762627552625379e-01   -2.306269453502597e-01   +4.420113252707323e-01   +6.643964421826537e-01   +1.867702366953126e-01; +2.197604154279689e-01   -3.426585439734091e-01   -2.103277128477906e-01   -6.318665650366646e-02   +1.366902235094676e-01   +6.372493733386124e-01   -2.320882977720609e-01   -2.243119661118890e-01   -8.738480202304445e-02   -3.658093088005769e-01   +6.281208084229877e-01   +8.100684909219200e-02   +6.744823683495599e-01   +1.616318571646845e-01   +4.120317227912662e-01   +5.341715835960148e-01; -6.429904035354297e-01   -2.205766805536478e-02   -1.606078251529132e-01   +1.766968105936331e-01   -3.117511308331046e-01   -6.927754331168849e-02   +6.292839658266850e-01   +2.245414500912953e-01   +5.019974049059547e-01   -1.556525924572062e-01   +4.436419606354457e-01   -1.910612886153860e-01   +6.312610395280508e-01   +6.662206220947304e-01   +3.064197740973298e-01   +3.382938529109290e-01; -7.043510718707890e-02   -2.953183051673739e-01   +1.015121844004564e-02   +1.038983395405266e-01   -2.732131703578581e-01   -6.949761616739950e-01   +1.203224114557240e-01   -3.126163592316606e-01   +4.841823134226142e-01   +5.312459193672147e-01   -7.060365972845312e-02   +6.107994375603309e-01   +6.063947003344526e-01   +7.855592859276226e-01   +1.307691347567851e-01   +5.146883406306906e-01; +8.322225195167723e-02   +6.044679170037048e-01   -5.738951998885304e-02   +2.611067990895755e-02   +1.420408181210905e-02   +3.528560526868405e-01   +5.898422806607140e-01   -2.616446318547539e-01   +7.170722210745949e-01   +3.192721806121199e-01   +5.114639010745670e-01   +2.087751526041710e-01   +7.410785540027541e-01   -2.197480568593375e-01   +5.414126768712544e-01   -2.610520699285118e-02; +3.124364909206540e-02   +2.844555043156734e-01   -3.324893776798154e-01   +3.155909075563416e-01   -7.561907638189734e-02   +8.882596983805352e-01   +7.768926248631939e-01   -5.037952763711138e-02   +1.420107933251866e-01   +5.300744706492462e-01   +1.796120789562458e-01   -1.447483163557127e-01   +2.223399862876759e-01   +5.852493766735992e-01   +3.422561799690666e-01   +1.402806202893936e-01; +4.393083439580186e-01   -1.929371215794695e-01   +6.869379803158706e-01   +1.208344660932306e-03   +3.058477052601276e-01   +5.335275744247478e-02   +3.325403530559390e-01   +4.143184472866844e-01   +2.738968786591724e-01   -3.732419359619831e-01   -7.779854794622128e-02   +1.091281652839491e-01   -1.571645585114646e-01   +6.297921917878617e-01   +1.208075284037254e-02   -1.597340761688731e-01; -2.152195369244504e-02   +1.712820666927801e-01   +5.061066921881287e-02   -9.344942680821602e-02   -3.091190651539767e-01   +8.671276640989943e-02   +2.537846310010864e-01   -4.723621675323823e-01   +4.232466986300874e-01   -4.438241059599017e-01   +6.524426495036206e-01   -6.949448890582068e-02   -1.985674149273233e-01   -6.688344667584212e-03   -2.488920551275198e-01   +3.650108741311025e-01; +2.261507904608442e-01   +5.722775317665535e-01   -3.212094391511081e-01   +1.593856090776150e-01   +4.777215488698344e-01   -1.926177362135470e-02   -6.497469439489571e-02   +6.704193306933987e-02   +7.409039421782988e-01   +1.000000000000000e+00   -5.104391764981475e-01   +5.879175915798380e-01   +3.779745888965960e-01   +9.539161374754018e-02   +1.723221356676411e-01   -1.444080428723087e-01; +6.657795253060128e-01   +1.789401244844765e-01   -1.424167590274205e-01   -4.638939134600505e-01   +1.976276450479047e-01   -3.944894645327490e-01   +2.594015101544508e-01   +5.768630649692666e-01   -5.871083175224456e-01   -4.629334022991194e-01   +2.416462077025779e-01   -3.296915595057033e-01   +6.222109424867119e-01   +2.967846228608375e-02   +3.241519411685128e-01   -1.646540838215531e-01; +2.772710106480606e-01   -7.438686900000447e-01   +5.584872408510340e-01   +5.417137983616964e-01   +3.638076032281574e-01   +2.206445849720976e-01   +4.448730973074422e-01   +7.338055907847860e-01   -1.707613953465040e-02   -3.217749685041071e-02   +2.981067420517426e-01   +4.866761627632191e-02   -3.823514847526714e-01   -4.197954621945783e-01   +1.914235191377243e-01   +2.050390547207951e-01; -4.272802265129680e-01   +5.370163176606835e-01   +2.716231653117456e-01   -4.771049476546774e-02   +9.893282533256960e-02   -3.672470201589264e-01   -3.351718216005658e-01   +2.100622766672443e-01   +5.408283159146179e-01   +5.555132703788386e-01   +7.119099616431922e-01   +5.036868752493222e-01   +3.632758191688938e-01   +7.227174578385284e-01   -8.085000999042441e-02   +5.512747052776709e-03; +1.114621165811944e-01   +6.716917154139084e-01   +5.857098734772321e-02   -7.601439531821585e-02   +3.850194922571629e-01   +7.287235294298248e-01   +1.697995625767359e-01   -2.745509036834953e-01   +6.405877258457042e-01   +5.846997354731861e-01   +9.478589824837877e-01   +5.042483047578733e-01   -4.523442845518029e-01   -1.010987054108570e-01   +8.816702791513756e-01   +2.314227104852565e-01];
L2I_L1I_iGABA_netcon = [+4.519877114345931e-01   +4.923791289789538e-01   -5.181896994521062e-01   +7.121312867662793e-01   -8.150249207379275e-01   +4.178092458620866e-01   -1.109055080232279e-01   +2.255360210992711e-01; -5.167721218063593e-01   -2.893894195701803e-01   +3.958240304898374e-01   -3.629157610813826e-01   -3.038690216999820e-01   +3.158935559843098e-01   +4.662970787493609e-01   -1.480942312358296e-01; -2.145283734079829e-01   +3.668472730845744e-01   +1.123231193767837e-02   +4.943183087550718e-01   -4.678753337182680e-01   -9.196716735596568e-02   -2.048843945478637e-01   +6.678541396408433e-01; +2.737634909827560e-02   +1.439989561173131e-01   +1.027530397984050e-01   +8.566784547023399e-01   +6.898800087045206e-01   -5.927697231463440e-02   -5.089983114668294e-01   +5.838293415589931e-01; -1.311300140554438e-01   +6.313852837334746e-01   -4.680166705149760e-01   +8.214903439778602e-02   +5.611675173728667e-01   +4.352656698046581e-01   -1.258613763949742e-01   +7.645041224022036e-01; +3.883212694276680e-01   +4.743545922064458e-01   +2.212669186238353e-01   +3.153828741573547e-01   -3.908071316985582e-01   +1.000000000000000e+00   +5.383788955251375e-01   +1.787440361532314e-02; +6.646500937905073e-01   +6.729950027747204e-01   +1.888738508486255e-01   -2.299564451401792e-01   +4.044286158369153e-01   +1.922089558561232e-01   -2.719620774972492e-01   -1.007232511537118e-01; +5.641482376835300e-01   -1.440643378141935e-01   +1.559472632485203e-01   -6.474502779464776e-01   -1.431223582043679e-01   +5.102479002309460e-01   +8.200092461302676e-02   +8.236205180541084e-01; +7.607067865908146e-01   -1.674719257468736e-01   +6.244321485401005e-01   -4.150168686422867e-01   +1.441157788195198e-03   -6.507723562046075e-01   +7.953333513056428e-01   +3.667562040631900e-01; -3.591132948322643e-01   +6.846484007878075e-01   +8.060272224355944e-01   +3.639014816738445e-01   -1.897131107221982e-01   +7.839008572347649e-01   +2.276175329980747e-01   -6.053290347103385e-01; -2.182555559280055e-01   -2.516371969717947e-01   -3.810546759605598e-01   +3.277233764009997e-01   +1.377611016053635e-01   -3.028942033335153e-01   -4.776383698957655e-01   +2.094279398775232e-01; +3.492353555601748e-01   +3.203198917843155e-01   +7.093281006084717e-01   +1.012865041326974e-01   +6.305707527571787e-01   +4.584752951039462e-01   -3.492900047048095e-01   +1.626122772297813e-01; -2.870405448410389e-01   +2.433948437829917e-01   +5.925797001539390e-01   +4.932180659616596e-01   +2.992953163800766e-01   +3.683815836209253e-01   +6.043963135782573e-01   +5.641405666271924e-01; +2.860642855721686e-02   +4.903104170441540e-01   -4.624179645489289e-01   +1.886544211814248e-02   -3.605727664498324e-01   +1.667343923987434e-01   +6.017731506326527e-01   -2.997077084352679e-01; +1.782562903180167e-01   +6.212098976206298e-01   +7.404857242105901e-02   +4.971484449115324e-01   +6.451255933891282e-01   -2.038584917676032e-01   -3.027137182452216e-01   -7.555727417367286e-02; +6.657984823661447e-01   -4.961826385284046e-01   +4.659971603629181e-01   -1.577463994052150e-01   +6.230927315679128e-01   +4.979600576946510e-01   +5.216812145392453e-01   +6.139076940663364e-01];
L1I_L2I_iGABA_netcon = [+1.118879820414288e-01   -3.550808180347931e-01   +2.666420632245324e-01   -2.922009396851808e-01   -4.176366707260250e-01   +5.514564683153823e-01   -3.799699305870733e-01   +6.720819586311064e-01   +6.392684884837255e-01   +4.091983413465495e-01   -2.481010390560058e-01   +7.531006814084105e-01   +2.904195774497992e-01   +2.742831276601965e-01   +4.060164371659684e-01   +5.238544411315965e-01; -2.473563833127826e-01   -1.940560634925825e-01   +4.613163037820665e-01   +5.337674351433927e-02   -5.350656041738616e-01   -1.711885425842530e-01   -2.986373191886051e-01   -6.562862208777132e-02   +2.863134334326520e-02   +3.078632919951129e-01   +4.430115489307146e-01   -6.015947082575698e-01   -1.095397676330141e-01   +4.142257414365320e-01   +3.547303043734050e-01   -3.750940448695176e-01; -2.638090509682557e-01   +2.396445246566679e-01   -7.122202167513667e-02   +2.798398344585692e-01   -5.867960281427944e-02   -2.037648781967426e-01   +3.494908023053944e-02   +5.649029668885941e-01   +6.556554906992011e-01   +5.922672477140725e-01   -3.475260997805908e-01   +5.502184319211022e-01   +5.503989600579641e-01   +2.833896332533467e-01   -2.506344597054301e-01   -4.506768563235643e-02; -1.698744231685231e-01   +3.108359640378264e-01   +6.256222333079854e-01   +9.645242168868570e-02   +1.230018158580666e-01   -5.506803435727867e-01   -3.970810083761658e-02   -4.837071681909174e-01   -3.538508835201447e-01   -9.729974521147389e-02   -1.404407355419736e-01   +4.682924324641493e-01   +2.170677961439501e-01   +5.898375884624912e-01   +6.704190973984541e-01   +3.586262215654779e-01; -1.755425586464725e-01   +3.810274976086531e-01   +3.475621484862333e-01   -4.271015112000094e-01   +1.010464299287549e-01   -7.711938523035548e-02   +5.085316171871086e-01   +3.384154821846540e-02   +1.126235475881975e-01   -2.796207075858048e-01   +2.762779005886777e-01   -1.359211023850627e-02   +4.768108187465002e-01   +4.276434361051817e-01   -2.339578886444213e-01   +5.994674775037351e-01; +6.508994063230521e-01   +2.499877557701833e-01   -5.017604508256017e-01   +6.849711970932260e-02   -1.392096652001699e-01   +6.600558000171199e-01   -2.556942238750538e-01   -4.636642371463024e-01   +4.100179370307600e-01   +1.000000000000000e+00   +5.880408562601918e-01   +8.503643919551550e-02   +5.914853135409217e-01   +5.900435089063190e-01   +9.909410679703652e-02   +5.851584513293235e-01; -2.292387927243379e-01   -1.071223063608267e-01   +1.615153120649215e-01   +7.675810687052349e-01   -3.107773034385244e-01   +8.810696588670069e-03   +8.246789475938293e-02   +1.055682007816149e-01   +5.569448453632425e-01   -1.137020484777269e-02   +3.142186459296608e-01   +3.360667615169187e-01   -3.807527002358288e-01   +1.507050751421199e-01   +2.538779635102449e-01   -2.061091516678447e-01; +2.157829289098967e-02   -1.095201152208087e-01   +3.348768202895937e-01   -5.607532992951327e-01   -1.729326040764555e-01   +6.878640451060596e-01   -1.535994066571724e-01   -4.595168763242470e-02   +8.543948846192870e-01   -4.562666304226264e-01   -3.560018191642714e-01   +4.304735207924382e-01   -8.718719794884296e-02   +7.619874167309805e-01   +1.054699166520712e-01   +6.986085094074974e-01];
L2E_L1E_iAMPA_netcon = [-2.231606187139710e-01   +7.748581680401051e-02   -2.874067692111310e-01   -8.538214444313727e-02   -6.530868031111571e-02   +6.401347122422565e-02   -1.043905569524834e-01   +3.685641771097127e-01; -4.044387648052361e-01   +1.059265151164469e-01   +4.447346579015526e-01   +4.917683924343634e-01   -2.872618510275158e-01   +1.381799068197765e-01   -3.049556047739893e-01   +4.170923129873683e-01; +3.001865474644842e-01   +2.163795787141419e-01   -3.693325687224964e-04   +4.200309020178147e-01   -6.212596664040541e-01   -7.875479446017310e-02   -3.862496965875643e-02   +8.727232405676398e-03; +1.217618460625300e-01   -6.471309828343601e-01   +4.244975144245321e-01   -7.845202498406629e-01   -2.442997645444385e-01   -2.286715075581750e-01   -2.521290888057534e-01   +6.707733040438366e-01; +2.619249179984451e-01   -4.597662297679210e-01   -3.431589633240174e-01   +5.855517292830208e-01   +5.795360135851544e-01   -3.378314171234097e-02   -5.652513487257464e-01   -4.037966619922227e-02; +1.000000000000000e+00   -3.440815769514171e-02   +1.191614922735705e-01   +2.044103440530545e-01   +5.288106100590295e-01   +2.198750831826759e-01   +5.226394593524887e-01   +1.287141870211641e-02; +5.239139870518174e-01   +2.947751195455870e-01   +6.154090245138803e-02   -4.410381927258915e-01   +2.339300631129538e-02   +2.817002263402861e-01   -3.021345748619917e-01   +4.820971080267596e-01; +1.286306155563726e-01   -1.199783177961988e-01   -3.501633446386586e-01   +6.705054582514705e-01   -4.295618276946849e-01   -4.241950252270196e-01   -2.507108959805304e-01   +1.904457657215934e-01; -1.626514900338696e-01   +2.550105965892453e-01   +4.955207333424642e-01   +2.467836466891056e-01   +2.302817599377462e-01   -4.733377532789174e-01   -4.581540536030823e-01   -3.326457272047884e-01; -3.843036795674513e-01   +6.470780426012640e-02   -6.016428460852765e-02   +5.766862619925823e-01   -3.158588982122586e-02   -4.324717787880101e-01   +2.669253303293643e-01   +6.086960720311242e-01; +2.543234723922375e-01   -1.228149138205992e-01   +1.718073054753929e-01   +5.446542116212411e-01   -2.884949221699995e-02   +3.397711544639199e-01   +3.466302172737838e-01   -2.785242740361500e-01; -2.973653449102040e-02   +9.457405257113105e-01   -5.691705670062858e-01   -3.233223012043066e-01   +3.624855586388399e-01   -3.590001823883361e-01   +3.665377241144064e-01   +2.799547848882579e-01; +4.036057836660889e-01   -4.599730208542501e-01   -4.493554914962309e-01   +4.761882317722018e-01   +5.942159610322295e-01   +1.673316891034153e-01   -2.842396119962975e-01   +3.614342080898734e-01; -4.700189349093260e-01   -3.732332518234842e-01   -7.954531814941325e-02   -7.285064390070101e-02   +1.479336690407505e-01   +1.548721038115206e-01   -4.862688297690283e-02   +4.878864545929192e-01; -1.169314992805048e-01   -7.346068300956696e-01   +4.450696204887405e-01   +3.587175979096759e-01   +7.334104198186644e-02   +6.854504519785409e-01   +5.166913355640352e-01   -1.524849336325954e-01; -1.077909053083264e-01   -8.828919175810834e-02   -5.620298094473402e-01   +5.344058946523469e-01   +8.203090265857165e-01   +4.620748100634014e-01   -9.412517699840595e-02   -7.550569258485276e-02];
L1E_L2E_iAMPA_netcon = [-6.624615717349538e-01   +6.359316769354889e-01   +4.857473688323194e-01   +7.779368849466550e-01   +5.580129747315505e-01   -2.834273230359122e-01   +7.166421680088000e-01   +6.335913386007777e-01   +6.839175281351277e-01   +3.422063702793898e-01   -5.543050174652367e-01   +7.571339685856477e-01   +6.234070020690780e-01   -3.682897934441329e-01   +6.228921229759314e-01   +3.522021702153580e-01; +7.915823355684468e-01   +5.843727682320646e-02   +2.296379996554809e-01   +1.356692671090073e-01   +2.476614717982210e-01   +7.224990291380247e-01   +2.496887646056375e-01   -2.553542685386899e-02   +4.180711773033301e-01   -2.575284754669274e-01   +4.780098363239022e-01   -1.305690099613969e-01   +7.292647520225488e-01   -5.442678031827489e-01   +6.602830556445817e-01   -1.942101281323580e-02; +6.260754183754436e-01   +2.264086901643697e-01   -3.971970408219572e-01   +3.151529408285608e-01   -4.832980084214752e-02   -2.424100951781906e-01   -8.419390290160460e-02   -1.094944366755836e-01   +2.837565687168965e-01   +8.383038915042444e-01   +3.583228508317719e-01   +1.309184640858899e-02   -2.302995110169953e-01   +2.394033199728398e-01   -9.456971036411448e-02   -4.156859700868668e-01; +5.629909544795052e-01   +4.999674557983569e-01   -3.068793465995298e-01   +2.147354628283819e-02   +1.000000000000000e+00   +3.051874535598655e-01   -1.428291834228491e-02   +5.129262479446428e-01   +6.134528745078378e-01   +6.864607437017242e-01   +4.032529441136788e-01   +3.708108386868163e-01   -1.194170851696158e-01   -4.318823408686251e-01   -4.309945870413833e-01   +2.364458712421503e-01; -6.029895280536347e-01   -3.071553449608113e-02   -5.666232734784469e-01   +6.006271629494203e-01   -3.933700402430892e-01   -1.192297891970225e-01   +4.409868516653526e-01   +5.636768170440197e-01   -2.271425819358009e-01   +9.273267577355241e-01   -2.447201041742438e-01   -3.989193503147070e-03   +1.221084123148793e-01   +4.289887052140610e-01   +1.268842243130019e-01   -1.403702712548033e-01; +1.183334662448172e-01   +6.985583630774131e-01   +5.542532701697482e-01   -1.713111501382923e-01   +6.699086028647049e-01   -9.330617724736238e-02   -7.532566532506808e-01   +1.425924070402035e-01   -3.741405644568281e-01   +8.900846142321076e-03   -7.515890460300456e-01   -8.744439898997818e-02   +3.693846936825741e-01   +5.488131352178977e-01   +1.990498733451632e-02   +8.355015448037196e-01; +6.534676048891093e-01   +6.813530351626419e-01   +7.272905789452366e-01   -1.121418025493718e-01   +5.501045804686689e-01   +4.144655974911653e-02   +2.691974371491991e-01   -3.468371852665907e-01   +6.905673715779703e-01   +6.508190476670215e-01   -5.172327954276350e-01   +4.806902268028778e-01   -3.205431828524890e-01   +5.922055663265495e-02   +4.763986725361622e-01   +2.339987743939135e-01; +9.353129652230207e-01   -2.507495617137734e-01   +6.302823216678146e-01   -6.745696960016702e-02   +8.046112020291756e-01   +6.192127862372102e-01   -5.473501549015164e-01   -1.980364649310115e-01   -3.390481848033310e-01   -6.962733961362578e-01   +1.065182420445189e-01   -3.278299923879252e-01   -1.896720840967424e-01   -1.927643242189228e-01   +4.534585943403558e-01   +2.374354911908458e-01];
L2I_L2E_iAMPA_netcon = [+3.324513733988628e-01   +2.848994172262463e-01   -5.297434852853824e-01   -1.582066538948557e-01   +3.823544400568958e-01   -5.901184426614677e-01   +7.113743250685587e-01   +2.036829615165884e-01; +4.328655540753868e-01   -6.423318844660206e-02   +5.499269757650852e-01   +3.888693691169987e-01   +7.424809205831193e-01   +6.851151182537015e-01   -1.108820005265473e-02   +8.370797521863698e-01; +5.283494761946781e-01   -4.532536606365598e-01   +6.672372314299807e-05   -4.135305949668153e-02   -2.942815441818402e-01   +2.189647582573946e-01   +4.592204709048988e-01   +7.481680971972221e-01; +7.661909145607292e-01   +5.691257832229624e-01   +4.714463077558521e-01   +5.183405783929584e-02   -4.253781893936683e-01   -2.047389029787662e-02   -3.441009736133835e-01   +2.873299878208782e-01; +5.373952546758177e-01   +1.859311738150077e-01   -2.482848694434711e-01   +6.267683140551203e-01   +7.902601650727101e-01   +1.000000000000000e+00   +3.845376851996754e-01   -2.762256232571098e-02; +3.116713421749392e-01   -6.361758030398486e-01   +2.431056306213961e-01   +5.136528447517572e-01   +1.724496688272064e-01   +7.457346986534616e-01   -3.936366590335025e-01   -6.401718935299214e-01; -3.666134983097787e-01   -1.562826691966287e-03   +8.198098335904128e-01   +6.596879868301849e-01   +2.255517151921021e-02   +3.666243008907172e-01   -6.540911104269044e-01   +5.091141710938235e-01; -4.362370045416359e-01   +7.122123898651588e-01   +1.310118255166028e-01   +1.010727173026209e-01   +7.618481473483386e-01   +8.225824860612674e-01   -1.116249979102930e-01   +5.410123270071453e-01];
L2E_L2I_iGABA_netcon = [+5.243738274812442e-01   -3.178907490889770e-01   +5.626464394566050e-02   -6.126757297208439e-01   +3.333702461382713e-01   +4.745478005164076e-01   +7.973111773317499e-01   +7.493459384926516e-01; +7.579932182449430e-01   +7.063711642412419e-01   -2.313792205080663e-01   -4.301059995021157e-02   +3.796221102065663e-01   +7.816900725826645e-01   +5.531972733191476e-01   +6.387166129174769e-01; +9.117337093011794e-01   +2.262478743775728e-01   -2.117709687748798e-01   +4.584309466456871e-01   +8.724784290396081e-01   +1.000000000000000e+00   +3.141784500358727e-01   -3.913059262472866e-01; +5.237979636842869e-02   +2.041950800090862e-01   +7.649946197948164e-01   -6.855335311078924e-02   +4.324435063320334e-01   +3.849772828200280e-01   -4.724198235113539e-01   +4.078338219212780e-01; +7.254401142066461e-01   -1.125381670948329e-01   -1.928312438856772e-01   -1.097483542069946e-01   +8.889776321249881e-01   +2.321393155446406e-01   -1.037553686173992e-01   +9.681883761142734e-01; +2.554162341128605e-01   -2.585245424787426e-01   +3.022810271622943e-01   -2.155296096080918e-01   +5.418874092183503e-01   +1.643275120084242e-02   -3.582947354249890e-01   -5.763657199461052e-01; -3.558515166929058e-01   +1.907227992379932e-01   +5.492006733250331e-02   +4.668157462029213e-01   +4.760008658071684e-01   +5.909488665650631e-01   +2.648766841402004e-01   +4.938396446862612e-01; +1.026061479947821e-01   -4.794427462859757e-01   -2.438994336584898e-01   +2.007719500129417e-01   +8.071372744131331e-01   -4.870037067400012e-01   +8.979053374689622e-02   -3.724084610992018e-01];
L3E_L2E_iAMPA_netcon = [+1.068746164260057e-01   +2.412497556978024e-01   +3.460711374489300e-01   -2.613973808735329e-01   +2.494829950300604e-01   +9.391912252021889e-01   -7.337212628920001e-02   -1.290935614866125e-01   +6.315747876702575e-01   -6.485153965999059e-01   +7.857193409146427e-01   -4.096983246592483e-01; +8.089093108609767e-01   +4.857050847955566e-01   +4.366644132296330e-01   +4.843090001297252e-01   +2.804377647370302e-01   +1.044214770434252e-01   -5.286847881552769e-01   -3.353676802275176e-01   +5.450067675795875e-01   -1.249967897702742e-01   -5.860753372929085e-01   -2.283359573748494e-01; -1.838531190686728e-01   -1.474096196164886e-02   +3.951047804985985e-01   +1.128273165921701e-01   +5.651783895987833e-02   -6.228003180958446e-01   +6.588961968908428e-01   -3.262307084261407e-01   +6.845087099232482e-02   +2.586362959827883e-01   -4.804134843584661e-01   -3.621865499187846e-01; -4.682352691537462e-01   +1.769526125818394e-02   +2.989324389075088e-01   +5.395663717483429e-01   -6.594568091896165e-02   +5.730219387725932e-02   -4.965781998227799e-01   +6.225667316535749e-01   -1.402248524360247e-01   +3.509844688148060e-01   +1.550129530680922e-02   +1.372435507851366e-01; +6.327384803359850e-01   +3.185850287640821e-01   +6.659358145736937e-01   +3.361952731502765e-01   +5.090224941693088e-01   +5.000890709802362e-01   +1.061916030791865e-02   +6.107490107089291e-01   +8.739775701574243e-02   +1.938467793159511e-01   +2.458019753673888e-01   +3.255571964489041e-01; +2.201128043463462e-01   +6.426796434326694e-02   -5.887147823991951e-02   +2.802537606380271e-01   -4.779479941700741e-01   +1.740986881260296e-01   -2.474541707202827e-02   +2.492561250568375e-01   -4.397613622172079e-01   +6.329895721769896e-01   -7.184985031522605e-01   +8.367800701304426e-01; -1.782625271768399e-01   -1.456726319811847e-01   +8.464947070015176e-01   +1.000000000000000e+00   +5.666105096194792e-01   +2.856876164077518e-01   +9.846657201826888e-01   -7.667136646304792e-01   +2.766829409462069e-01   -4.300510749496840e-01   -8.692981443527700e-02   -3.242258515084439e-01; -8.877818171678249e-02   +4.578581727508080e-01   +8.043318485662534e-01   +6.922951368800735e-01   +9.820218295745329e-01   -7.076410567834376e-01   +7.353766589045206e-01   +2.279174523014264e-01   +3.083557794204023e-01   +7.771591469683490e-01   +7.039132224249437e-01   +2.988619897545904e-01];
L3I_L2I_iGABA_netcon = [-4.486337953689735e-01   -4.154970792963618e-01   +1.700600645756662e-01   -5.743920683523304e-02   -3.838097815804144e-01   +4.515753704634534e-01   -3.011151858700040e-01   -3.504224199187660e-01   -7.523034773047699e-02   -5.915935957763924e-02   +2.782114520988989e-01   +8.569129341978916e-01; -3.189608008164280e-01   -1.531870420387532e-01   -3.515952143206520e-01   +5.759440327747307e-01   -3.494663211939101e-01   -3.481643584062168e-01   +4.949291718377331e-01   +7.492630233247367e-01   +8.015946679143351e-01   +2.921673699680062e-01   -4.570173487594027e-01   +3.649028102898029e-03; +4.976845728072977e-02   +1.586590873535755e-01   -5.003063370061470e-01   +3.693051915155524e-01   +4.881909034371475e-01   -7.306520871759502e-01   +4.900189003747061e-02   +5.987532692680363e-01   +5.009816917078093e-01   +4.242731374796747e-01   -1.283634233374225e-01   +6.544762639163243e-01; +6.551815075464660e-01   +6.525003972432944e-01   +7.453530009520656e-02   +2.499325107957429e-01   +4.147671611050824e-01   -4.439120020343310e-01   -3.144161571882715e-01   +3.562435734357646e-01   +4.327734317574020e-01   +1.844857246557214e-01   -3.045008277808638e-01   +6.463634717182699e-01; -5.617040585081258e-01   +4.365502422290644e-01   -7.361165721947533e-01   +8.246160037685273e-02   +4.291310193308396e-01   +2.318734220851359e-01   +4.002094378948696e-01   +4.116453700849623e-01   +8.936166292087727e-01   +1.306547562637893e-01   -4.573101749869200e-01   -6.859413353924805e-01; +6.998675727359618e-02   -3.510425708855898e-01   +1.726353675302371e-01   +5.302124349710040e-01   +1.121258828578817e-01   +1.000000000000000e+00   -2.949656974325410e-01   -6.007326181921521e-01   +6.499293422539064e-01   -2.771539237841523e-01   +2.001834385578362e-01   +8.725801084711740e-01; -1.429695125661666e-01   +3.324385272999696e-01   +6.537830154744261e-01   +9.264363906001560e-02   +3.534723517701668e-01   -1.758324983423806e-01   +5.191492461296614e-01   +3.222397249227877e-02   +6.924923611877640e-01   +1.398301686726919e-02   -1.165728886437713e-01   +7.008473330683554e-02; +4.458078588171551e-01   +5.870738602387559e-01   -7.070064734813203e-02   +1.887799548277332e-01   +3.279454327531545e-01   +7.913747117615491e-01   +7.048295416717430e-02   +9.419177024763403e-01   +5.389316580285238e-01   -1.522357410978229e-01   -5.616892862728630e-02   -4.654080762542587e-01];
L2E_L3E_iAMPA_netcon = [-1.580820272805327e-02   -2.482426470462902e-01   -3.714785990891811e-01   +4.201068727990450e-01   +7.021998849249937e-01   +2.603217523228091e-02   +4.549363447464362e-01   +3.542440524894839e-01; -1.126640463612901e-01   +4.757122269229404e-01   -1.293319427770659e-01   -3.618508088549376e-01   +5.429214632985274e-01   -1.033095437712530e-01   +4.036419459160349e-01   +3.927289052048001e-01; +3.472488739940743e-01   +6.359038223339026e-01   -1.594852830342044e-01   -2.625461310093556e-01   +4.426999550008834e-01   +5.019901984806825e-03   -4.058845473350761e-01   +6.615771924223828e-01; -1.733024927327151e-01   +1.653454828973275e-01   -2.492438293168351e-01   +7.627316659119657e-01   -2.842009334647223e-01   +1.274570915061985e-01   -3.139743407370581e-01   +8.419283032409558e-01; +8.349023849837092e-01   +2.700125421008995e-01   +3.501396157651709e-01   -4.487019014178134e-01   -4.600771193805280e-01   +2.967342577841165e-01   +1.670270589588372e-01   +5.085460488752913e-01; -1.140874519882526e-01   -3.427553535532842e-03   +1.000000000000000e+00   -3.094459949394796e-01   -3.834807557423036e-01   -1.856439190865482e-01   -3.949523647317827e-01   +7.343856901194890e-01; +6.624211941318418e-01   +4.226715839876565e-01   -1.606547436929576e-02   +8.644124777161400e-01   -1.526906127359499e-01   -3.705555768385997e-01   +4.947218917967603e-01   +5.212789945086034e-01; -1.599789403700620e-01   +1.068986335790052e-01   -5.708397026461325e-02   +2.850608652958848e-01   -8.000931965153549e-02   +1.594586171546684e-01   -2.791762977549881e-01   +6.296451205668283e-01; -3.971708228806318e-01   -1.011913770642539e-01   +7.128288639033287e-01   +5.790300619519791e-01   -3.445053013030466e-01   +4.283021868138135e-01   +5.791757948989436e-01   +2.499554013391815e-01; +4.023223932306294e-01   +1.257555073263943e-01   +2.750691800896136e-01   +2.975108013159328e-03   +1.396210000104612e-01   -2.780837555422251e-01   +6.139858166201257e-01   +6.445427308071404e-01; +6.472337923054602e-01   -7.258755527327712e-02   +8.949337460628611e-02   +1.700427634789690e-01   +5.644770671550254e-01   -4.262426405478880e-01   +5.134681356715982e-01   -3.725641690166129e-01; +9.365821393821079e-02   +3.078445393675174e-01   -4.166842563719387e-01   -3.786898011185557e-01   -5.053798460210776e-02   +5.989979871080026e-02   -4.724050485338252e-03   +9.407668670303528e-02];
L2I_L3I_iGABA_netcon = [+1.026982608373938e-01   +1.114033041731867e-01   -8.912660484399251e-02   +6.943462249422867e-01   +5.946743505935173e-01   +2.441410992409904e-01   -1.034779079835655e-01   -5.119356470576088e-02; -3.715954485241964e-01   -2.656659066329689e-01   +4.883695268306914e-01   +6.671348696818370e-02   +5.451963948578349e-01   +5.643144600020998e-01   +6.381192809927398e-01   +5.167942110364582e-01; -7.513962795184966e-02   -2.588985617554811e-01   +1.766557253585663e-01   -3.534027863068098e-01   +8.632133046056062e-02   +5.886520939524297e-01   -1.950653465862662e-01   -1.131780516328138e-01; -3.240109908945522e-01   +3.951703343435994e-01   -3.752791851407355e-01   -6.423246521746285e-01   -2.214981914764477e-01   -8.425630852739045e-02   +4.635907922072742e-01   +3.715378785196087e-01; -4.277492313655203e-01   +2.742377375426103e-03   -1.834251136911854e-01   -1.273599833877978e-01   +3.621802702698206e-01   +4.012475621416060e-01   +4.235011333717852e-01   -5.268766587182064e-01; -1.204438725969635e-02   -5.527667145789443e-01   +5.999255358520724e-01   +2.671059334907216e-01   +8.778438854954196e-02   +2.867696348414048e-01   +3.942003129015473e-01   +4.454595009730111e-01; +6.133040874486145e-01   +8.534260159764138e-01   -4.743264391261929e-01   -4.777876942380389e-02   +1.407021132985466e-01   -4.293299629425052e-01   +5.780458274437281e-01   -2.440633274089290e-01; -3.001924619231328e-01   +1.712873880669191e-01   +2.457217677998836e-01   +1.125818669112678e-01   +4.981129172717051e-01   +1.399879341077133e-01   +5.674906302763710e-01   -9.788206805240132e-02; +2.553271108260447e-01   -3.051591084246674e-01   +6.765961948739977e-01   +3.583941498456297e-01   +8.358670709929662e-01   +2.254116571213015e-01   +1.000000000000000e+00   -2.222285765838977e-02; +5.590620505395231e-01   +2.245923140303492e-01   -2.601735916700609e-01   -3.222675061239753e-01   +5.443149483248007e-01   -2.643433069566365e-01   +2.333867380528006e-02   +3.187310454834534e-01; +2.908165787628286e-01   +2.698839729837594e-01   -3.667126807097935e-01   +3.714631374905633e-01   -1.822020536995239e-01   +3.886405652155114e-01   -6.405485751377158e-01   +6.726010029361219e-01; -5.584930562451522e-01   +3.487985655657836e-01   +4.956897165429542e-02   +3.717199182430118e-01   +1.446870178143611e-01   +2.795477460391964e-01   +6.012738830842428e-02   +1.842628451272688e-01];
L3I_L3E_iAMPA_netcon = [+1.308249764242904e-01   +4.778361352112693e-01   -3.487942524209031e-01   -2.507101401771939e-01   -1.968031746458562e-01   +1.623472668871774e-01   -2.527729880616937e-01   +2.447356382595084e-01   +2.485476219048488e-01   +4.783446164756282e-01   -4.071512653121642e-01   +3.213506928406598e-01; -3.949923417071188e-02   +1.337144369492498e-01   +4.041816534053366e-01   -3.076368244236597e-01   +8.825423364054217e-01   -6.317271130758099e-01   +5.277214734078373e-01   -4.430930086891883e-02   -4.094455142704738e-01   +5.813965742715824e-01   +3.905271554409519e-01   +4.725983442975243e-01; -4.074433165688924e-01   +4.496387950233622e-01   +5.985244268781720e-01   +5.383426445161029e-01   -3.697525015494948e-01   +6.003919715974150e-01   +9.171657775642018e-01   -2.437605230554269e-02   +3.377586689616160e-01   +2.259143023355334e-01   +6.135074787345802e-01   +2.769792265865241e-01; +5.952557318841480e-01   +5.277425022392770e-01   +9.248935765408760e-02   -2.071327547198155e-01   +4.704683129485829e-01   +9.138716441082949e-01   -2.878410462938308e-01   +6.554874694997980e-01   +4.629749133630650e-01   +1.088553455201354e-01   +4.530415561025882e-01   +3.747281464113457e-01; -3.633616203783672e-01   -2.406346015460303e-01   -3.728231273235016e-01   +1.465462905691043e-01   -2.273856186375190e-01   -7.287182883037681e-01   +1.316054080898088e-01   -1.483604160840393e-01   +5.873928796315823e-01   +1.218473259114660e-01   +4.554975346908630e-02   -1.247383862398747e-01; -9.231201300240462e-02   -2.998326976911219e-01   -1.736357745142210e-01   +8.046544302032439e-01   +4.517924935453405e-01   +2.093171886296344e-01   -4.704745128378398e-01   +2.277063219899253e-01   +5.882198030728530e-01   -3.482321086287440e-01   +7.092828499137549e-01   +4.464315278293869e-01; +7.472175927131097e-01   +1.183412017501637e-01   +7.444116000870952e-01   -1.899400957254874e-01   +1.428152385364589e-01   -1.164587772968162e-01   -2.321375843897954e-01   +1.682706496321198e-01   -1.727203864043894e-01   -1.099937212883640e-01   +1.715751607203383e-01   -2.601903655358958e-01; +2.681373906149432e-01   -8.361908407407045e-02   +2.494697708495808e-01   +9.662365557828518e-01   +3.992142949740383e-02   -2.272945882761375e-01   +1.866208499651965e-01   +1.979256550875735e-01   +2.497455608206454e-01   +9.446690142590849e-01   -3.031179905013109e-01   -1.623412483641752e-01; +3.174229705829781e-01   +4.706438183493525e-01   +6.275386512493797e-02   +3.895022755631610e-01   -7.109402504389434e-02   -1.191057686134651e-01   -3.289605633642051e-01   +4.951957225478299e-01   -4.488844784950839e-02   -4.103501181803186e-01   +8.908650090711230e-02   +4.297208749285102e-01; +4.225547614773150e-01   +2.629679760145191e-02   +1.789206287667266e-01   +3.606563151243660e-01   +8.584880439750491e-01   +2.366588624248956e-01   +1.404970347824889e-02   -9.386148538594848e-02   -6.173095646474703e-01   +7.457322828814973e-01   -2.805845051089300e-02   +7.240341995438612e-01; +3.051828131082863e-01   +6.966916950017751e-02   +4.750138179174813e-01   +1.555901938038481e-01   +5.246539099252524e-01   +5.813556454969376e-01   -4.537125753393554e-01   +6.069439579524822e-01   +1.000000000000000e+00   +4.024654185759498e-01   +5.545459004950353e-01   +1.956307260181733e-01; +2.334195547726297e-01   +7.317471173151384e-02   -1.350175574478606e-01   -2.682655863140923e-01   -6.721543120416611e-01   +5.560339075417353e-01   +4.192955011902426e-01   +4.825529922582673e-01   +2.240271698895768e-01   -4.236620119646317e-01   -5.652423869341041e-01   -5.031269313464299e-01];
L3E_L3I_iGABA_netcon = [-2.003923831584778e-01   +4.192623987244768e-01   +1.963976839337109e-01   +1.013361827207314e-02   +2.118321771334445e-02   +2.812389890207380e-01   +6.356040739808723e-01   -1.019716658202488e-01   +4.744167205798010e-01   -4.775720566129760e-01   -3.144158482548715e-01   +1.606691095873434e-01; +8.270003222310525e-01   -3.250082897231348e-01   -4.182479222015347e-01   -7.841578653624565e-02   +3.251987991877078e-01   +6.284332758888266e-01   +4.047086552829319e-02   +3.639889227284150e-01   +9.386283795180073e-02   +1.590186725120108e-01   +4.613726258159523e-01   +2.389142065932113e-01; +1.630615788003516e-01   -3.482459209187522e-01   +6.061098251793338e-01   +5.592717661020811e-01   +1.334311025999301e-01   +4.062699822463041e-01   +2.729104938037468e-01   +6.452251635389165e-01   -2.444068827406331e-01   -2.989316702830255e-01   +1.583042734453426e-01   -1.379753243324733e-01; +1.833965914605447e-01   -1.073018362822451e-01   +1.000000000000000e+00   +6.095016963515369e-01   -4.346996452234130e-02   +9.355639973413992e-01   +4.152009867406308e-01   +6.037065512103535e-01   +4.069048199002332e-01   +2.175458350292057e-01   +8.338789157555456e-01   +4.879462372402739e-01; -4.102027473086627e-02   +5.386612648046550e-01   +6.573402284355585e-01   -8.448207309370274e-02   +4.914530757588219e-01   +2.128030716426630e-01   -4.687110697725820e-01   +7.970473177943919e-01   +6.670344730759280e-03   +4.476513381361562e-01   +5.542175901471570e-02   +1.063013749865784e-01; -3.665634260100223e-01   -8.034768703986558e-02   +1.383812362561387e-01   +4.852994036975336e-01   +2.802414972087142e-01   +1.278374905716491e-02   -5.936330799764635e-02   -1.824024366003826e-01   -1.461977778516271e-01   +2.977770320352106e-01   -3.042888349178183e-01   +4.708593748885415e-01; +3.774528784587506e-01   +6.839092728417673e-02   +3.170763638072522e-01   -6.991346735520809e-02   +7.339176651645991e-02   -1.835129879713390e-01   -1.132576963453611e-01   -2.916951574785455e-01   -1.999212487737892e-02   +3.520793978157049e-01   +5.459152902490639e-01   -3.021701579808043e-01; -2.373621832966894e-01   +2.648320912555350e-01   -4.322880636734894e-01   +3.082395723213994e-01   -1.305395919968216e-01   +3.536922055366559e-01   -3.151722762412237e-02   +1.865890942736995e-01   +3.948675304690623e-01   -4.783938479039011e-01   -1.036087834657328e-01   -3.040229556353029e-01; +4.297195361739391e-01   -2.667871251235553e-01   +1.171456341494500e-01   +7.289606256721357e-01   +4.183581021065900e-01   +4.161354291446577e-01   +5.467138388375907e-01   -4.436298864211273e-01   +2.090174918908520e-02   +5.758224086174547e-01   +9.594360235878256e-01   +3.876944528149214e-01; -3.892471912344311e-02   +2.715770756335535e-01   -3.005389024803932e-01   -1.089428287307600e-01   +6.012092294953494e-01   -3.295850300052611e-01   +3.876396795788333e-01   +2.851228293675462e-01   +4.980461396005323e-01   -2.355123260016950e-01   +5.479088114897540e-01   +3.455277960870308e-01; +3.562516843916471e-01   -1.658919036588345e-01   +2.953101699024403e-01   +8.808264092127838e-02   +9.413278556722707e-02   +4.620883662600905e-01   +6.219247465943271e-03   +3.640793053588392e-01   -2.253908659155512e-01   -1.093929038434245e-01   +4.877843587810730e-01   +1.530439192736069e-01; +3.572963312533067e-01   -1.748872632195774e-01   +7.480465599852429e-01   -2.563511746296266e-01   -6.136110713172899e-01   -7.934005500114612e-02   +1.285330721086855e-01   +2.091925789178375e-02   +3.341069383971099e-01   +7.864873827135281e-01   +4.203579659353944e-01   -1.584965066892933e-01];
L2E_Input1_iAMPA_netcon = [+4.802825369878632e-01   +6.173192473318843e-02   +2.219847397999516e-01   +1.781824969105642e-01   +7.301059617694011e-01   +1.000000000000000e+00   +4.288868423267044e-01   -2.247982116400005e-01];
L2I_Input2_iAMPA_netcon = [-5.049030879099078e-02   -5.029706374402567e-01   +4.386277126135265e-01   +7.268102974999110e-01   +7.953936685261068e-01   +5.537102103607567e-01   +1.000000000000000e+00   +1.732546305967664e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
