function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.572545750719538e-01   +9.245975173721568e-01   +2.565225937007347e-01   +8.476830847361303e-01   +4.392358875785454e-01   +9.968745669776405e-01   +4.577843693880281e-01   +8.487613963542867e-01   +6.064709752657549e-02   +6.468708719604005e-01   +7.809264328490522e-01   +9.587488218821505e-02   +5.536321145391099e-02   +7.133265606200473e-01   +5.605939585825146e-01   +3.220224456190328e-01; +9.555551210680892e-01   +7.247412866292058e-02   +9.159797830866941e-01   +2.583094238612504e-01   +2.066659364879667e-01   +7.907818168691931e-01   +9.644087248811891e-01   +2.873307968170364e-01   +1.161254222172592e-01   +3.457886321992356e-01   +7.704567819335488e-01   +6.275501294310559e-02   +1.852265604644561e-01   +4.430730579006830e-01   +2.302076317180674e-01   +9.110589121115731e-02; +4.800994284008520e-01   +1.214538221954098e-02   +5.299235126733447e-01   +5.913207930407658e-01   +2.272375745626476e-01   +7.509937423936297e-01   +5.671693822240472e-01   +6.292012211730956e-01   +4.920640851359311e-01   +2.307495320712594e-02   +6.344644669105796e-01   +9.844944298996883e-02   +8.684462865121689e-02   +8.965463313434813e-01   +6.028618055022125e-01   +5.986650414648914e-01; +6.170340435099473e-01   +6.743125194069610e-02   +5.738350734996335e-01   +2.314341317456969e-01   +1.154201979573131e-01   +1.207894971684240e-01   +6.761442334360230e-01   +9.342017265715276e-01   +3.749878370772141e-01   +1.609840435070889e-01   +8.519470946000605e-01   +3.219783951705438e-01   +2.521357879424807e-01   +5.687230182403058e-01   +6.621369882231147e-01   +6.807273780921219e-01; +2.427112890610547e-01   +8.950012832177797e-01   +7.514598022649552e-01   +7.014393573556469e-01   +2.834414007077685e-01   +2.312118949122299e-01   +3.236081890879383e-01   +9.213960504686000e-01   +2.209169905109515e-01   +9.667657332434390e-01   +1.606555459215211e-01   +8.240060469125148e-01   +4.976325504470146e-01   +6.604931229441607e-01   +1.022882661268364e-01   +6.044934477863647e-01; +7.827460234817584e-01   +1.295121688469836e-01   +7.194657862309785e-01   +6.362800200881980e-02   +2.210406362658683e-01   +9.037922027922640e-01   +3.583180053234671e-01   +2.055838460123571e-01   +5.418123746791302e-01   +9.270358682518687e-03   +1.187794021701386e-01   +9.351707272568682e-01   +9.450546237804606e-01   +8.036980277942333e-01   +6.015605362717336e-02   +3.708365886342815e-01; +9.674071956345396e-01   +2.943782176207408e-01   +7.917671055874144e-01   +7.981179247345668e-01   +4.707656857476743e-01   +2.078612202461716e-01   +1.763562221161559e-01   +4.695215327796997e-01   +9.175601491177371e-01   +7.558825204330624e-01   +9.546315568326347e-01   +8.714616558606900e-01   +4.672166855004866e-01   +3.724579240207826e-01   +8.323737499830426e-01   +3.683631415572353e-01; +9.402885555471413e-01   +5.534155371979592e-01   +9.581290567425165e-01   +1.552927956139614e-01   +2.004879737633946e-01   +5.339202757936876e-01   +6.450916422624782e-01   +1.179298145201664e-01   +5.292235708493197e-01   +2.736114684578909e-01   +3.607559208194695e-01   +7.454179325903201e-01   +2.460844942917506e-01   +2.459463746048166e-01   +4.053166705801055e-01   +6.760074208642038e-01; +6.907238530065093e-01   +3.720555747140837e-01   +2.145790088171790e-01   +8.494501863045719e-01   +4.619317690404731e-01   +4.202632412340793e-01   +3.920511758977374e-02   +2.516789065843783e-01   +4.862962144964015e-01   +5.024914774755090e-01   +9.452505288452488e-01   +3.730326866306259e-01   +8.488563444604640e-01   +5.905318893223284e-01   +5.451477677864487e-01   +4.697650688521867e-01; +3.498443196465283e-01   +7.660718287233995e-01   +1.155205258253778e-01   +2.187702097157458e-01   +4.289180623027610e-01   +3.607297131578349e-01   +1.761488574262954e-01   +3.474432497965244e-01   +4.997889634531921e-01   +6.449470692787407e-01   +9.369919249919584e-01   +5.987784718173865e-01   +2.475134615797757e-01   +1.222925850384140e-01   +4.865862466374009e-01   +8.507874148892824e-01; +2.835092907774278e-01   +7.888439622545576e-01   +2.562522610213259e-01   +4.534808353696389e-01   +3.996390172385843e-01   +6.462590714272834e-01   +5.474305269768339e-01   +8.021774171964478e-01   +9.753958639747660e-01   +6.851284104731128e-01   +1.518916644248727e-01   +9.494081116822747e-01   +6.190857382805748e-02   +1.392951035750265e-01   +6.884237552366409e-01   +3.485868381153617e-01; +3.076679905503072e-01   +1.409941719220430e-01   +2.587511166643259e-01   +2.711836224456070e-01   +1.938485763014811e-01   +7.418211106301842e-01   +6.478525470110678e-01   +5.990048882448906e-01   +4.669173029440131e-01   +9.396152289239382e-01   +5.224192809140766e-01   +8.220225252386253e-01   +5.012409424345132e-01   +7.464187562846480e-01   +8.945978653440357e-01   +6.616813029270052e-01; +4.987381911721938e-01   +3.147779642266735e-02   +9.089276833595250e-02   +7.751606789700106e-01   +9.983943303880753e-01   +6.819891717273413e-01   +1.673255360277099e-01   +4.048697874375508e-01   +4.322642899606464e-01   +5.712617760968364e-01   +2.151563809235730e-01   +8.399647056210219e-01   +5.594031929488620e-01   +4.010314816814294e-01   +5.827345706702624e-01   +8.454439162134562e-01; +7.809014926829984e-01   +4.449206299069625e-01   +9.224700385440103e-01   +9.462344908398068e-01   +4.969465938692544e-01   +9.413556271486158e-01   +8.095738202114365e-01   +5.679018451561607e-01   +2.962238890374962e-01   +9.718021984491765e-02   +5.230765236630992e-01   +7.390624411358188e-01   +4.773079373379397e-01   +2.123359037899480e-01   +8.341916455864486e-01   +4.116222779982901e-01; +9.830739120260282e-01   +5.883377809215473e-01   +3.616605174430529e-01   +3.149012092262730e-01   +7.175804183874105e-01   +2.862164477494022e-02   +8.491498594759239e-01   +5.336233004490605e-01   +4.296734254260287e-01   +7.839330018971942e-01   +1.936881685362156e-01   +7.815565446510050e-01   +5.731999819572170e-01   +1.527882414344375e-01   +7.521823386158023e-01   +6.733325588231421e-01; +9.413419464967070e-01   +1.851174046843569e-01   +9.546098113481253e-01   +5.368458821024965e-01   +3.845743569336491e-02   +5.007250847009519e-01   +5.784040398918262e-01   +4.279316656167705e-01   +6.038380522405153e-01   +3.512946206970633e-01   +7.332878994154024e-04   +5.931420326871708e-01   +8.377082812007086e-02   +2.010390855464740e-01   +7.084062602736418e-02   +6.203202313392220e-02];
L1E_L1I_iGABA_netcon = [+5.886387801109021e-01   +5.479789445004990e-02   +1.761915226374189e-02   +8.893047994659553e-01   +7.272164534817951e-01   +9.388458451309671e-01   +7.845636829939940e-01   +1.067460282250182e-01   +6.085679849913750e-02   +1.340450309957922e-01   +6.427841285781130e-01   +1.577487893011663e-01   +2.863177096195946e-02   +2.936314387786397e-01   +8.277984955139039e-02   +2.411089479193049e-01; +7.767646950136458e-01   +4.775888390893875e-01   +8.864451556916517e-01   +1.061739616454377e-01   +7.813112680086810e-01   +1.229729353424793e-01   +7.172328270732204e-01   +3.386863628069579e-01   +4.874386708091580e-01   +5.224020195354644e-01   +2.823928216675712e-01   +8.198667850223895e-02   +7.794121827444572e-01   +7.938165799833362e-01   +1.984841009415992e-01   +9.081276238228440e-01; +9.953035249548033e-01   +6.773419961004324e-01   +2.617835968409049e-01   +8.936336345467975e-01   +5.046755578641904e-02   +7.420255713321062e-01   +9.554096325459595e-01   +8.962729347109095e-01   +3.163950480691509e-01   +5.863814710308171e-01   +6.368941164751539e-01   +8.583730848443759e-01   +3.069504892990454e-01   +6.023705829756349e-01   +9.168878850312782e-01   +4.188159297340666e-01; +2.484822628129432e-01   +4.802913150109083e-01   +4.454286315597713e-01   +1.595117318287286e-01   +5.718129032807124e-01   +4.707329217376240e-01   +6.680712515525701e-01   +9.356726086023198e-01   +6.141911567286893e-01   +6.394543370961855e-01   +9.612755090434030e-01   +4.710741899430819e-01   +4.362634402274362e-01   +2.759425645892224e-01   +4.090791344936826e-01   +3.224795349293916e-01; +3.359198996417447e-01   +8.522878043019735e-01   +3.306315788891270e-01   +5.855901580056266e-01   +4.929198903126498e-01   +8.270970445752912e-01   +9.803069238235379e-01   +2.960813589961199e-01   +9.649092623986785e-01   +7.326355299571785e-01   +5.121683439995864e-01   +7.410256822233907e-01   +9.432890637691216e-01   +5.942349440549111e-02   +4.889456932313465e-01   +7.333879035180502e-02; +8.651119614256862e-01   +4.685375065902965e-01   +9.481025375613924e-01   +7.464834827551778e-01   +7.871139132127788e-01   +2.536060453933562e-01   +3.596110219019285e-01   +2.180044611510445e-02   +2.366362258152538e-01   +6.853494140787456e-01   +8.643918176201175e-01   +8.149693373293869e-01   +3.084131804466771e-01   +8.478914363754457e-01   +1.169145452348502e-01   +5.936560667660832e-01; +7.824629148441558e-01   +1.386590313610183e-01   +2.983896172126230e-01   +9.508986224525229e-01   +1.280571735015057e-01   +8.572344589119807e-01   +5.851501834362859e-01   +8.325139401328062e-01   +9.426518200466358e-01   +4.478500343956126e-01   +5.612030531550102e-01   +6.419588137753306e-01   +7.328152194474252e-01   +8.624601548902777e-01   +3.898904465964226e-01   +4.686596135017451e-02; +9.345146961768414e-01   +5.492378585715310e-01   +7.138074573165860e-01   +1.826904688938681e-01   +2.352087708588005e-01   +3.622322119330098e-01   +2.180670154114196e-01   +9.955742198800137e-01   +5.454338554448627e-01   +6.904072379758275e-02   +4.427726717067001e-01   +3.807678684687601e-01   +4.821690322539285e-02   +1.745659583362874e-01   +9.477615059346973e-01   +5.876024976977856e-02; +5.387260442237705e-01   +6.785524814376886e-01   +3.901651402596946e-01   +7.903199666716674e-01   +4.184273103209761e-01   +2.395707345906084e-02   +4.135066793022167e-01   +6.121632384252473e-02   +1.336662305016973e-01   +2.075397787973032e-01   +3.401437871086355e-02   +5.037301616309062e-01   +1.299427776796878e-01   +5.701594631686506e-01   +9.960237998453254e-01   +3.021901403114428e-01; +7.396323244482882e-01   +2.035436154673654e-01   +8.592810075708366e-01   +2.604592234238221e-01   +7.307150000734267e-01   +7.409576670687863e-01   +8.890222304924554e-01   +9.902066715574968e-01   +7.867016799723466e-01   +2.229907230205809e-01   +3.726715730874663e-01   +9.136974186190989e-01   +4.874223331676072e-01   +6.990335207102789e-01   +3.692246425986804e-01   +9.407975368338259e-01; +4.631480891883502e-01   +9.125912670153005e-01   +9.364801232179817e-01   +8.319605734004595e-01   +9.687038076675545e-01   +6.032127181787585e-01   +2.099027540378223e-01   +8.459671886220888e-02   +4.583130959375051e-01   +9.475117605656043e-01   +2.291553834053305e-01   +7.269211470905402e-01   +8.034720499389680e-02   +5.847644308444446e-01   +3.004022408458892e-01   +2.140752855955053e-02; +6.547923668803680e-01   +8.831573428287852e-01   +1.527624807071758e-01   +2.582557313005306e-01   +3.334292107887976e-01   +7.593791013555478e-01   +7.132284725234161e-01   +3.682315170447900e-01   +7.570360461086922e-01   +8.356486583736457e-01   +6.246067970707888e-01   +1.936166030843903e-01   +6.772226947042479e-01   +2.994019965819140e-01   +8.161812715607802e-01   +3.778309790943479e-01; +6.381182196288819e-01   +7.518288945310782e-01   +8.219779571875080e-01   +6.466721361918967e-01   +5.396084575724713e-02   +1.443687524751058e-01   +9.399787503436619e-02   +8.715266134861916e-01   +4.527477662905824e-01   +4.792744948408797e-01   +7.855642056746147e-01   +1.955527598445096e-01   +8.180595441704827e-01   +4.673310573459875e-01   +4.173480816203955e-01   +7.146607049831777e-02; +1.413400377111597e-01   +9.551939846586223e-01   +4.842925022422975e-01   +3.890095804519228e-01   +4.064503274959098e-01   +7.695070699388584e-01   +9.494204745405909e-01   +9.956366406975214e-01   +7.194875609358649e-01   +5.024323928541641e-02   +3.166327057231363e-01   +7.415321871221493e-01   +4.955002520965216e-01   +5.823680093521655e-01   +9.270044858687754e-01   +5.089047597640054e-01; +4.093004152182218e-01   +3.895907124376198e-01   +7.944940106266556e-01   +8.610407527220687e-02   +8.262884775879576e-01   +7.401782778206517e-01   +2.601027309678730e-01   +9.336404334310791e-01   +1.641083498350961e-01   +2.825104316846281e-01   +8.782560124351045e-01   +3.517315050633155e-01   +8.812265236677624e-01   +8.269774918539786e-01   +7.538365163519467e-02   +7.019621267274638e-01; +3.172953577535343e-01   +1.113351701489973e-02   +7.191019271811719e-01   +5.721656629621149e-01   +2.013127364215475e-01   +2.187852839772544e-01   +7.137766444969640e-01   +7.067049388089042e-02   +2.492218706031895e-01   +3.924043391053194e-01   +6.595625582751383e-01   +8.276133660764186e-01   +4.418094819960583e-01   +9.333363250801879e-01   +2.921279584286562e-02   +7.806826726910395e-01];
L2I_L1I_iGABA_netcon = [+7.965865037313292e-01   +2.838271419767520e-01   +5.343324301082695e-01   +6.970349441471801e-02   +3.959624540746339e-01   +8.460078488492696e-01   +6.869954513686203e-01   +8.580673671728445e-02; +3.110261604096132e-02   +5.663559659734463e-01   +5.660050214173187e-01   +8.338055883519973e-01   +3.865049845584481e-01   +7.187101468996411e-01   +4.504401673702788e-01   +8.002712842217036e-01; +9.741747545033541e-02   +4.962461750420842e-01   +7.192773025454716e-01   +7.481856933158637e-01   +1.763654196978397e-01   +2.318722146131933e-01   +9.686146357949627e-01   +9.632877629064510e-01; +6.222605808785366e-01   +5.521833317148163e-01   +8.610915452823417e-01   +9.835278942188398e-01   +7.789110717955797e-01   +5.282674638905814e-01   +6.357450768659574e-01   +1.737484952507020e-01; +7.244469996069296e-01   +4.948129796750774e-01   +8.680371410074851e-01   +9.580828155287122e-01   +3.619369776425582e-01   +2.003542947908699e-01   +9.822855062774175e-01   +4.559305964236392e-01; +5.338083502343138e-02   +1.385746936985872e-01   +4.349270321203940e-01   +3.369044859094512e-01   +4.690743863895959e-01   +9.356086136153743e-01   +8.243033409116749e-01   +5.112642575002643e-01; +1.382079401262429e-01   +4.823051698934223e-01   +6.647871881845712e-01   +2.385156088219083e-01   +5.528419814112742e-01   +4.848189725489092e-01   +9.259232007063077e-01   +7.376097101473683e-01; +2.592908895509916e-02   +8.435420171266197e-01   +6.888732218319223e-01   +9.275631379219155e-01   +6.442569281566582e-01   +3.237974381446730e-01   +4.192658338715731e-01   +7.588507310653848e-01; +2.536623320453280e-02   +6.132703523241727e-01   +3.007737188394737e-01   +2.944044071360603e-01   +6.963377709784557e-02   +4.679867658728737e-01   +3.516704419303760e-01   +9.401416094192684e-01; +1.709009543314393e-01   +6.078019743961842e-01   +5.933461900775052e-01   +7.894680460829862e-01   +7.571082691910838e-01   +3.178703061322253e-01   +5.754826059783690e-01   +3.936632645574299e-01; +1.332532630498351e-02   +8.220529571952712e-01   +9.515616954854870e-01   +8.989052831348671e-01   +8.330790286679151e-01   +3.041034320503300e-01   +5.341462919112305e-03   +2.450866877176971e-02; +2.082890188433633e-01   +6.670075417765442e-02   +5.060334661406879e-01   +4.242940249087700e-01   +6.493821737049047e-01   +7.907419298830858e-01   +1.028944467593512e-01   +8.457665908693643e-01; +3.890206046042433e-01   +6.846502195466898e-01   +2.962131538795660e-01   +9.588736960458673e-01   +4.443482695511614e-02   +5.576680320587803e-01   +1.368322323570542e-01   +3.001294829513101e-02; +4.055292868348542e-01   +6.469838664140573e-01   +9.879568702274115e-01   +9.476107515389003e-01   +5.636430496196299e-02   +5.086358844836182e-01   +7.120995007629578e-01   +9.419381066433076e-01; +4.333362430034238e-03   +4.929042943521222e-02   +3.252164668115507e-01   +8.335633608901818e-01   +9.210354429814031e-01   +6.206954815387311e-01   +2.862884827967772e-01   +6.783979506355846e-01; +2.489315444761584e-01   +8.504141410728002e-01   +9.043466725429853e-01   +6.653328086988952e-01   +8.438027216653573e-01   +4.200578380147921e-01   +7.483362919536026e-01   +3.875833227050959e-01];
L1I_L2I_iGABA_netcon = [+3.966569504641790e-01   +7.165960682086930e-01   +6.927042315875623e-01   +8.223215538968311e-01   +7.648453387559280e-01   +9.321480769868107e-01   +4.394005849301988e-01   +5.540857425475795e-01   +1.854421748245905e-02   +6.084535441207760e-01   +1.036083628741054e-01   +5.176443116975020e-01   +6.495164376039407e-01   +6.316742935346182e-01   +7.182380639040544e-01   +6.881144587111961e-01; +2.042797556886774e-01   +4.302600454129906e-01   +8.861117977147611e-01   +1.828608648933748e-01   +8.926974553115696e-02   +4.477145566279975e-01   +7.342007747149603e-01   +9.985102414257463e-01   +9.366497481273407e-01   +6.969117135563185e-02   +7.473178268817827e-01   +4.901503192947185e-01   +3.109587649228129e-01   +4.468082726928052e-01   +1.905143893851623e-01   +3.211387906254074e-01; +2.330026159427748e-01   +4.275824127568638e-01   +1.233260246250014e-01   +7.286000984126249e-01   +3.214808237112112e-01   +1.466210535139170e-01   +1.882955859193831e-01   +2.225985328720659e-02   +4.846156568998548e-01   +4.417001223919292e-02   +4.222685930135374e-01   +1.553848461420038e-01   +3.130772787135051e-01   +8.291149687737166e-01   +4.527876042070262e-01   +7.884130514247701e-01; +6.506690812385090e-01   +3.465200040449168e-01   +8.042860889612453e-01   +1.110380927369217e-01   +2.206506288263141e-01   +1.970155241798913e-01   +6.178545439778427e-01   +6.224033361648508e-01   +9.599122029909712e-02   +3.217656859430426e-01   +7.036990384447706e-01   +5.514341132595284e-01   +9.759933904623171e-01   +1.469882766271247e-03   +8.034711582879306e-01   +9.171814148684676e-01; +1.586887265121413e-01   +6.509710147838892e-01   +6.159678486910455e-01   +2.902765692088971e-02   +7.888929439694629e-01   +6.703390483773439e-01   +4.279046546306302e-01   +6.354163682752960e-01   +2.228802108191541e-01   +1.450801369905557e-01   +4.034320679610995e-01   +2.282091094614963e-01   +8.985731802538119e-01   +8.974115867471268e-01   +7.241474019400883e-01   +1.452576240641127e-01; +9.770007358074294e-01   +2.940673583948984e-01   +7.090889831434906e-01   +2.839716130399043e-01   +4.572070237412252e-01   +3.053116634425602e-01   +7.743598896293569e-02   +5.565951350269430e-01   +1.110548446738753e-01   +2.819333311642012e-01   +8.726210156342435e-01   +7.595544807724542e-01   +4.392453755989862e-01   +6.973235848107159e-01   +3.857868183606439e-01   +6.299478571348078e-01; +1.197235399040859e-01   +4.863123689045313e-01   +7.832763613448767e-01   +8.720576664189913e-01   +6.820731119938993e-01   +1.484437086268527e-01   +2.004499138688643e-01   +7.388217306376805e-01   +2.027250920522504e-01   +2.030772666417098e-01   +2.634961872843933e-01   +1.695718283513959e-01   +4.392952898240238e-01   +1.228521954885564e-02   +7.692866366206287e-01   +3.643154450052456e-01; +2.655846431588436e-01   +2.317207520786664e-01   +3.687723583212554e-01   +8.184872724138211e-01   +5.737168683335558e-01   +7.370358878819764e-01   +5.475388572595921e-01   +4.594431402391287e-01   +3.374485562940970e-01   +8.138269815132988e-01   +6.844098071002049e-01   +1.285580779751294e-02   +4.163740613757407e-01   +3.763053844716513e-02   +2.448518376295816e-02   +2.683005382780286e-01];
L2E_L1E_iAMPA_netcon = [+3.572255077218420e-01   +9.240620053605366e-01   +6.282066298523054e-01   +5.590406993688644e-01   +7.142032125636322e-02   +5.498401384916829e-01   +6.334096434543536e-01   +4.519754031436625e-01; +5.502397484797972e-02   +1.650770087371115e-01   +2.195042762108331e-01   +8.974518511547888e-01   +4.280435552984613e-01   +6.453939397046872e-01   +5.857033871467729e-01   +8.659483054562129e-01; +9.298999549332813e-01   +1.470435938127133e-01   +6.659902765909143e-01   +1.278557933474296e-01   +1.931125488985985e-02   +1.473450830304112e-01   +2.942497614765949e-02   +8.604774665106056e-01; +9.207978995426782e-01   +7.763756425814857e-01   +6.636426433616035e-01   +8.129694608586064e-01   +1.056797840701071e-01   +9.181969185990346e-01   +9.858691500582828e-03   +2.004624181064065e-01; +4.670202768789922e-02   +6.245163636444371e-01   +1.538539986972921e-01   +9.581823333468971e-01   +4.268970039519928e-01   +1.717289108383258e-01   +7.568669319980417e-01   +1.478910315697565e-01; +3.033007263314365e-01   +6.736212511513401e-01   +8.933664540717979e-01   +5.717717773522366e-01   +4.845205840696395e-01   +8.052987109345574e-01   +1.838870235237611e-02   +4.396668289910959e-01; +3.494722414424797e-01   +2.767968515353464e-01   +7.379014141862383e-01   +4.916836876194940e-01   +5.029216823789142e-01   +3.147529485858511e-01   +9.794044838027168e-01   +1.281330214463553e-01; +4.418988966779479e-01   +2.810733996917806e-01   +4.923511448332006e-01   +9.877166473531656e-01   +9.474390330614860e-01   +3.512912969418577e-01   +9.602139052717328e-01   +4.706698801770649e-01; +5.422262319331389e-01   +8.883196506087043e-03   +6.251227467958524e-01   +3.911918307634104e-01   +8.975010626806983e-01   +4.708630266241771e-01   +1.944051497449637e-01   +6.438745533875907e-01; +4.364541419503551e-01   +1.219874375476746e-01   +3.078918342384831e-01   +1.205269049280033e-01   +9.110523217265930e-01   +3.599224303811585e-01   +5.769753663230981e-01   +2.018358655453673e-01; +8.189747740884299e-01   +4.833178950168844e-01   +1.334946537195311e-01   +9.832498721750691e-01   +4.228676051278336e-01   +3.241375300835515e-01   +7.900047343745584e-01   +5.062551271352067e-02; +3.838018926185013e-01   +8.230534607669170e-01   +8.831026389772101e-01   +8.061389070970458e-01   +9.764603436975543e-01   +7.382509271968165e-01   +2.757058454978617e-01   +4.030866296214848e-01; +1.234219322506234e-01   +8.957257314240100e-01   +7.401634741251616e-01   +4.202552556054167e-01   +5.497626134221398e-01   +4.157901230162742e-01   +3.789409488879522e-01   +4.758313430443639e-01; +8.328550706095489e-01   +4.265967047088304e-01   +5.073257550711430e-02   +6.644151885417277e-01   +8.630738194402795e-01   +2.705937103480325e-01   +1.937211623470408e-01   +8.499864854464806e-01; +5.162230648773947e-02   +8.602969368918747e-01   +6.217642240879249e-01   +7.458398013830466e-01   +3.152509216414029e-01   +2.286779431132139e-01   +1.776894288571971e-01   +2.194590161344632e-01; +7.307735314748182e-01   +8.767149475495859e-01   +9.022970600712678e-01   +7.535769161858852e-01   +3.301086178850703e-01   +8.322220996433221e-01   +9.333956576031039e-01   +3.833480327671394e-01];
L1E_L2E_iAMPA_netcon = [+9.845568482887982e-01   +1.477436313932671e-01   +7.450648409094854e-01   +3.362566533969829e-01   +2.031769157895126e-01   +1.158988726326794e-01   +9.738463272657223e-01   +6.657802844841415e-01   +7.350416622907905e-01   +9.134714505981498e-01   +2.675136272206127e-01   +8.207459373648600e-01   +7.731567110437059e-01   +1.368263272787903e-01   +6.930941342357053e-01   +9.649426577608042e-01; +2.432689156680015e-01   +3.777810543956382e-01   +6.486756211597181e-01   +2.973080580626513e-01   +1.469928178504909e-01   +4.679922573624861e-01   +8.363946947602549e-01   +8.450419044086348e-01   +6.299315204128090e-01   +2.998679524801601e-01   +3.187437430425017e-01   +6.587240731381249e-01   +5.767164886583708e-01   +5.491370039522542e-01   +3.454595602942035e-01   +2.618100463973153e-01; +8.383278380972666e-01   +5.541562160578846e-01   +2.191679173612995e-01   +1.838602001247286e-01   +7.363249308809893e-01   +7.150335000930123e-01   +1.561904746757491e-01   +1.965128296138077e-01   +1.595150439874315e-02   +2.303856802517180e-01   +1.124720689385705e-02   +7.427604119787361e-01   +7.218161746136331e-01   +4.329953205445072e-01   +4.847090643723914e-01   +7.523928834641047e-01; +6.481561883126270e-01   +4.708447000731695e-01   +4.568596777024624e-01   +7.323811324817943e-01   +2.446951291546837e-01   +9.644513051995219e-01   +6.130491135994788e-01   +7.559642675673197e-01   +2.700645244411055e-01   +7.269803326433456e-01   +7.090021328489970e-01   +1.554585475140517e-01   +9.841674803005552e-01   +6.502307523793487e-01   +7.803927576083494e-01   +1.030842365940861e-01; +4.798954931089766e-01   +2.392062010392541e-01   +8.439549530495870e-01   +3.768553621642364e-01   +9.045285839702125e-01   +1.713680116073313e-01   +9.043730223830696e-01   +9.559497562293290e-01   +4.095106857594892e-01   +8.400643445644833e-01   +4.188119708519097e-01   +9.014784671319096e-01   +5.504552250911299e-02   +2.743514905459938e-01   +3.020119231951672e-01   +8.270681863255861e-01; +5.435557428540897e-01   +8.683854404052279e-01   +3.176915355240285e-01   +6.770609406763106e-03   +8.485434704438232e-01   +5.848953591213406e-01   +6.846905117388190e-01   +1.244453288129611e-01   +7.134681179403716e-01   +3.713321878472120e-02   +2.966636424254604e-01   +6.435812591242076e-01   +4.032119746311352e-01   +3.483307411532856e-01   +9.456547658478324e-01   +9.455771272159167e-01; +2.844652997165465e-01   +8.967134070134306e-01   +5.220931903427812e-01   +7.166074875417791e-01   +6.975841881777436e-01   +3.603583923455710e-01   +7.236551882979924e-01   +5.316013506775255e-01   +5.345556585959306e-01   +2.989656118671010e-01   +5.339636618142418e-02   +2.434965785135274e-01   +3.768489888269937e-01   +1.564942336353531e-01   +5.570102184303759e-01   +7.169642374807370e-01; +7.016200941132893e-01   +1.239212524036098e-01   +1.155474778135299e-01   +3.102805801149329e-01   +3.531025455296152e-01   +5.587567141364087e-01   +1.496866763736965e-01   +5.395289669211007e-01   +8.234435203736250e-01   +5.504661969335174e-01   +3.947595203372076e-01   +1.248348113114448e-01   +4.802639568205443e-01   +3.089909958794943e-01   +6.358291398386784e-01   +1.473277917118456e-01];
L2I_L2E_iAMPA_netcon = [+7.129182410411439e-02   +3.581987118716501e-01   +7.854893640821167e-01   +2.475815235279415e-01   +2.520328308439319e-01   +3.237845204285612e-01   +6.137404672920512e-01   +6.699103865641243e-02; +7.061224802300111e-01   +1.887008326269770e-01   +7.441248687184688e-01   +9.371322522059682e-01   +2.446515361265482e-01   +7.715507665655221e-01   +8.753075799049665e-01   +8.662396169748011e-01; +9.192046053723159e-01   +2.818955183524563e-02   +6.790145397045330e-01   +4.468187453089578e-02   +6.525944563481076e-01   +4.932383863197463e-01   +7.902484132058691e-01   +1.101302235232701e-01; +5.025930850201944e-01   +3.222548867163081e-01   +1.609453879625996e-01   +6.027939556605953e-01   +5.182961644640682e-02   +9.733435224054546e-01   +2.473899716650021e-01   +3.601022829394833e-01; +5.392816250107888e-01   +8.089623999543782e-01   +9.790729482581638e-01   +9.159558457665049e-01   +5.817355307775575e-01   +3.107732567304642e-01   +3.452373480784612e-01   +4.620168745820027e-01; +9.737358783660998e-01   +2.363246371383541e-01   +1.129589743365079e-01   +9.186022650582633e-01   +3.178880681017795e-01   +8.454388309026498e-01   +2.106065094400434e-01   +4.983885478697573e-01; +1.498793522861009e-01   +4.664694969882610e-02   +8.729954883420575e-01   +9.011475395855634e-01   +5.216286286883339e-01   +5.041174540514142e-01   +4.638470885387130e-01   +8.037465218882177e-01; +1.356615934836730e-01   +5.178985281209949e-01   +8.214413081176922e-01   +3.052070128187470e-01   +5.461303536088178e-01   +4.581542008358933e-01   +3.772401915406931e-01   +3.341394902928950e-01];
L2E_L2I_iGABA_netcon = [+4.516611300020673e-01   +4.424638685818327e-02   +9.585328463813608e-01   +7.249872560520119e-01   +8.860609313931055e-01   +4.024433744699658e-01   +5.185292555358512e-02   +4.596394805848352e-01; +8.207352230054779e-01   +7.486159085798938e-02   +6.583549587043273e-01   +9.389748180590340e-01   +9.065206341928130e-01   +2.065508058757303e-01   +6.548586710041201e-01   +8.642331563515598e-01; +6.781398458808761e-01   +1.655517268271278e-01   +5.317734170561332e-01   +5.986323697871417e-01   +8.637335411450544e-01   +8.069596863927833e-01   +3.262652200913151e-01   +8.773081844825636e-02; +5.500931309402539e-01   +4.995237643464323e-01   +6.350064407656597e-02   +6.244086005177266e-01   +6.433816530311515e-01   +8.212559198900966e-01   +3.842565600587504e-01   +8.434016848559527e-01; +1.482357721395069e-01   +7.408931754593080e-01   +9.968111913599149e-01   +3.251345991569166e-01   +2.833236496602135e-01   +2.433350738424945e-01   +3.515273507160696e-01   +3.662952726975690e-01; +8.857771052311735e-01   +6.880564913783292e-01   +6.481621720859668e-01   +4.324805621893905e-01   +7.654363030378405e-01   +5.440916262957539e-01   +2.480970137067782e-01   +7.731501620994380e-01; +5.266865601191220e-01   +9.281276322149923e-01   +8.302000896177213e-01   +6.463129515692918e-01   +3.573355253561862e-01   +7.388168696052140e-01   +8.726681447672106e-01   +9.558977659627053e-01; +3.282097076231649e-01   +6.505878969422187e-01   +7.745141895231805e-01   +7.617068487406385e-01   +3.834592719088314e-01   +2.206473730005247e-01   +3.472023650465277e-01   +8.477713921804079e-01];
L3E_L2E_iAMPA_netcon = [+4.401855502295733e-01   +3.962169239694752e-01   +9.157695385081882e-01   +1.842184813458480e-01   +8.456003166145598e-02   +8.990781957996042e-01   +8.065964343885942e-01   +8.495288928870572e-01   +8.782753947332168e-01   +7.301353323871985e-01   +8.729405787453547e-01   +7.800641393549007e-01; +4.580439062603265e-01   +7.472646558855904e-01   +5.446846823464346e-01   +1.835578282426000e-01   +2.811770807340942e-01   +2.527600910041059e-01   +8.769907333969231e-01   +6.399836761140461e-01   +7.772069956518480e-01   +6.245339675398175e-01   +7.717962367304465e-01   +2.844244621766248e-01; +5.725942868236454e-01   +4.501704627561054e-02   +1.808937680575211e-01   +5.180541520156745e-01   +4.045514060098800e-01   +9.612712403069952e-01   +7.819276322916493e-01   +4.360635617774030e-01   +5.172100280549129e-01   +8.022143058094636e-01   +7.186575257542045e-01   +6.388890364210856e-01; +7.379346641418083e-01   +6.811063686305859e-01   +8.378352526120773e-01   +1.093640759395323e-01   +8.434955561394214e-01   +7.946832672022619e-02   +8.077063630113144e-01   +7.207179535440119e-01   +2.520750285824702e-02   +6.820930463253967e-01   +2.146410958928291e-01   +5.581855093596799e-02; +1.119862246101175e-01   +1.882619313455706e-01   +6.737399474464669e-01   +7.403545266767555e-01   +3.587498059220584e-01   +7.338320571057155e-01   +9.614654310679078e-01   +9.438251979760118e-01   +1.446292421208195e-02   +8.021137870120295e-01   +7.304388701715238e-01   +6.646859466383834e-01; +3.930313971093645e-01   +7.131270165653212e-01   +2.603486434677671e-03   +6.649713856635372e-01   +8.441472218305787e-01   +3.750205614412059e-01   +2.894105765565794e-01   +1.610415542041875e-01   +9.852979127129876e-01   +1.335104138233554e-01   +1.942595886236307e-01   +1.354470693839860e-02; +8.762684911104096e-01   +3.981032154691887e-01   +9.061542358659302e-03   +6.026499190896115e-01   +6.458538771146755e-01   +5.367605162351052e-01   +4.490551626028212e-01   +3.499903355897794e-01   +1.152013766611291e-01   +3.549430178463783e-01   +4.574766120945750e-01   +1.964267339438149e-01; +7.657876783404387e-01   +4.048543763361420e-01   +7.425922744469649e-02   +2.611612465575244e-01   +6.543438789974345e-01   +6.139765247228677e-01   +7.875796934613927e-01   +9.482763007607473e-01   +4.526109879130065e-01   +9.580296635051812e-01   +2.569757093431120e-01   +1.148918948393393e-01];
L3I_L2I_iGABA_netcon = [+4.966128345233138e-01   +9.213268708247131e-01   +4.922778310984790e-01   +6.585081176928431e-01   +5.840112293262429e-01   +1.951441490720928e-01   +8.487111186291586e-01   +6.938233026474731e-01   +3.958512506053198e-01   +3.128959184915283e-01   +8.954199933760353e-01   +7.377731904538678e-01; +5.475109895256836e-01   +1.011648522655832e-01   +4.121864967319858e-01   +5.175742496464887e-01   +1.247510537080680e-01   +8.397756922963086e-01   +5.593739073175034e-01   +9.823137671432922e-01   +4.979431241831798e-01   +4.564535911978096e-01   +6.951552731701826e-01   +3.714815253123632e-01; +6.034253620101558e-01   +4.067951472528493e-01   +2.520030364909952e-01   +6.134702861326990e-02   +2.892364146051967e-01   +7.689708872963145e-01   +4.196226784573618e-01   +2.377698321928329e-01   +9.604674102175036e-01   +3.744277615353301e-01   +4.236399145495215e-01   +1.820212871222806e-01; +8.885759422619822e-01   +9.979687331000106e-01   +5.667672519880751e-02   +1.693391019220551e-01   +8.843161628488366e-01   +7.142780067185817e-02   +9.359153450490626e-01   +8.068455424671843e-01   +7.267121026760304e-03   +9.647024267973697e-01   +1.187420654399617e-01   +3.637903031252678e-01; +9.281916899359131e-01   +9.159213062054394e-02   +2.527731514080367e-01   +7.857849106930082e-02   +6.605142662262712e-01   +7.047851439911775e-01   +8.457443341734772e-02   +8.677256706516929e-01   +4.422173955417872e-01   +6.904800873730664e-01   +9.060705600054378e-01   +3.234196618011146e-01; +6.927229384949946e-01   +2.529627690163909e-01   +3.950279299752621e-01   +1.138942628030259e-01   +7.359746286119906e-01   +6.888068224149970e-01   +1.620833210567307e-01   +1.755057073775035e-01   +8.135000554671523e-02   +8.021460666138823e-01   +6.959289950275135e-01   +1.163959962391499e-01; +1.339699699622919e-01   +5.205164744891122e-01   +1.146971618697934e-02   +1.386009371773946e-01   +2.645582917775459e-01   +7.335283744685920e-01   +1.706645684149781e-01   +8.005796549252946e-01   +5.311405659604951e-02   +4.639095449221234e-01   +3.588456971822812e-01   +1.280894925016921e-01; +6.707748818441817e-02   +8.835897436259383e-01   +3.734872971639719e-01   +9.977732213723390e-01   +4.256099463785843e-01   +4.327493157723928e-01   +9.621137628795785e-01   +3.899237188126508e-01   +4.884323776226912e-01   +1.326341692525868e-01   +9.608521783514756e-01   +6.681663231723444e-01];
L2E_L3E_iAMPA_netcon = [+5.193630575998709e-01   +6.416810308168410e-01   +8.194180416874645e-01   +6.297581583476924e-01   +6.962231488753523e-03   +6.585381554219041e-01   +9.453611401603074e-01   +6.992014496657823e-01; +2.850926108811955e-01   +9.350613630204259e-01   +9.452303449913045e-01   +9.836003686085869e-01   +2.172038632703330e-01   +6.103849539597505e-01   +2.932945815734833e-02   +3.724952916264083e-01; +9.024890193534679e-01   +3.176286552635760e-01   +2.354291528699974e-01   +3.250320488457842e-01   +5.325004558543400e-02   +8.579414121459690e-01   +8.970356146579880e-01   +8.519269787217437e-01; +1.135918419584550e-01   +1.687135423657664e-01   +7.325206924310496e-01   +5.236445095634092e-01   +5.858405361686347e-01   +7.680868033614773e-01   +5.938210926490979e-01   +8.319028493940402e-01; +8.549000595079855e-01   +3.624084262996902e-01   +2.776174699217053e-01   +9.675563659860553e-01   +6.310600809665647e-01   +8.391399091548188e-01   +3.498572309450585e-01   +5.319830627745608e-01; +3.282247859185503e-01   +9.505341348473841e-01   +7.243460130902551e-01   +5.345635099965873e-02   +9.757257752567670e-01   +8.607053731148618e-01   +9.589770657550184e-01   +9.605502406253368e-01; +1.242985402885223e-01   +9.422156640464597e-01   +8.499335728030897e-01   +2.252554572737044e-01   +4.994451534204536e-01   +6.263875071165415e-01   +5.244633472073578e-01   +6.542834127329610e-01; +1.767790137614577e-01   +5.142093376311300e-01   +5.147435809724759e-01   +6.246675151401589e-01   +2.003531803221689e-01   +4.521417257837901e-02   +1.633160191115698e-01   +7.112762097643059e-01; +9.993771529565911e-01   +2.261224607752487e-01   +1.923817864689977e-01   +8.074947092040358e-01   +7.577050731847481e-01   +1.529229382013891e-01   +8.555241647269592e-01   +1.821770733256116e-01; +8.442490079618614e-01   +9.288157986194712e-01   +7.239776806107973e-01   +3.841214128154531e-01   +4.176345071006192e-01   +1.512029642958185e-01   +5.341452612573625e-01   +5.725838286849647e-01; +7.893560013068600e-01   +4.793279570467636e-01   +9.035695475826826e-01   +1.078087946751172e-01   +6.874620826285560e-02   +4.582466198558197e-01   +4.094728987723415e-01   +5.025526335858502e-01; +3.526901364542998e-01   +9.002846864554130e-01   +5.298550097680821e-02   +2.344089285530884e-01   +2.818542175649364e-01   +5.550176246731751e-01   +1.178027210867867e-01   +7.733694636720727e-01];
L2I_L3I_iGABA_netcon = [+4.569025924977497e-01   +9.395969978743233e-01   +3.564382732601531e-01   +2.194062920600168e-01   +3.950279796608920e-01   +4.621493821030993e-01   +2.535257509640965e-01   +1.422443201152990e-01; +5.937667095880909e-01   +9.641872276607464e-01   +2.800010430802540e-01   +5.346244199458829e-01   +8.898753179600861e-01   +8.598943678923522e-01   +5.445187533779181e-01   +6.798806025210594e-01; +9.319965285560419e-01   +5.495835518243597e-02   +6.052101569610997e-01   +4.162303008225422e-01   +2.034769393061564e-01   +7.570831955469909e-01   +6.691286344522839e-01   +1.469509254211643e-01; +6.004773935924499e-01   +9.647544499656557e-02   +5.081348162715011e-01   +2.964368423276651e-01   +3.013419511709609e-01   +3.306971310847097e-01   +3.542705639935158e-01   +4.564367730495422e-02; +5.937614251220009e-01   +9.142662960662471e-01   +9.454840855061619e-01   +9.036579201284769e-01   +6.429737365251136e-01   +6.110343237964547e-01   +7.055267661215439e-01   +5.278124674488343e-01; +5.697839903058503e-01   +7.968639883097879e-01   +9.493058196676707e-01   +6.279386271271314e-01   +6.965663398319877e-01   +9.107921957206253e-01   +2.343314294725846e-01   +6.930126688420521e-01; +3.980119192844533e-01   +4.059561879820308e-01   +9.633612874633368e-01   +3.716913761371168e-01   +2.145074897752409e-01   +5.609418294034803e-01   +1.837846151126327e-01   +2.843203231834541e-01; +8.223522276926448e-01   +9.279521791888918e-01   +7.566666685424028e-02   +1.267547573520874e-01   +9.374447577790219e-01   +5.808505515164889e-01   +9.898719705338305e-01   +8.858315022299088e-01; +9.585699425349219e-01   +7.685547743715178e-01   +8.123267910541397e-01   +4.165962873060612e-01   +9.159216148534045e-01   +5.235340924059702e-01   +5.984486267090305e-02   +2.971255753709110e-01; +6.574133991284228e-01   +1.350988135733009e-01   +6.094849341774263e-01   +5.070288514669200e-01   +3.302241357292689e-01   +6.694002460756142e-01   +6.464216030130501e-01   +9.137077576529338e-01; +6.030307191818387e-01   +5.104840770323944e-01   +9.807565694381853e-01   +9.245927539418121e-01   +9.020930309560699e-01   +4.041826020146203e-01   +1.300292960810012e-01   +2.518436565770227e-01; +6.309017807459605e-01   +1.921808002695381e-01   +9.075426098605123e-01   +3.419803623039194e-01   +6.426415764361293e-02   +7.678651444185344e-01   +6.919349990316662e-01   +1.756187406082343e-01];
L3I_L3E_iAMPA_netcon = [+9.339901024360109e-03   +9.548566818327602e-01   +7.305254261266376e-01   +3.101715684293990e-01   +2.316330559978919e-02   +7.616046252912645e-02   +6.255176976963415e-01   +7.342552892351503e-01   +2.262628988773093e-01   +2.877265837659829e-01   +5.263420830880006e-01   +2.127042081928501e-01; +5.459487960904579e-01   +4.843917660852675e-01   +1.222350838450411e-01   +8.177623144254673e-01   +6.282800129660981e-01   +1.517037123409886e-01   +8.026061467606085e-01   +2.973366730407445e-01   +7.820975591492951e-02   +4.111819139195119e-01   +6.265714973443539e-01   +2.382133413487620e-01; +8.117767506958934e-01   +7.556466477503169e-01   +5.442924479457493e-01   +8.152890683693339e-01   +5.875321479632931e-01   +5.657036702483216e-01   +3.005294751743920e-01   +5.898830510998460e-01   +8.859239229781282e-01   +9.620167625754052e-01   +9.796534392052089e-01   +6.542975730782044e-01; +1.208158814836264e-01   +8.443268587719722e-01   +7.892813095924405e-01   +7.546923205471896e-01   +4.028930110334170e-01   +2.471249643078848e-01   +9.510358627143833e-02   +4.662875222081694e-01   +3.560567498731529e-01   +7.219629040321114e-01   +8.263138876677784e-01   +8.586967353890005e-01; +8.636674940340824e-01   +6.074521586773902e-01   +8.369857103185085e-02   +5.613568634247230e-01   +1.834334309301038e-01   +7.842659025113407e-01   +2.505822119896302e-01   +6.537312012086126e-01   +6.660904159038090e-01   +5.987909513229916e-03   +7.324663157668596e-01   +6.480474478625365e-01; +7.529381302514881e-01   +1.778257650182924e-01   +8.595917980493639e-02   +3.866030762041255e-01   +3.792623322838022e-01   +5.050153171370464e-01   +8.868655653740395e-01   +2.152562092699620e-01   +7.423510978096693e-01   +4.604054282795874e-01   +9.366273769013209e-01   +5.845822610578177e-02; +2.369606689265069e-01   +9.134771506762657e-01   +7.156009255283656e-01   +1.186997363965862e-01   +5.216319862775353e-01   +9.229957785557947e-01   +7.031201572430019e-01   +9.776237795535457e-01   +5.602375011420025e-01   +3.741098579665004e-01   +3.133925628822494e-01   +5.288585954371857e-01; +6.157819984051854e-01   +1.447268666299406e-01   +3.177077529832842e-01   +6.492383624477366e-01   +2.671500817263729e-01   +2.987173472550735e-01   +8.403370542747899e-01   +2.442502672917605e-01   +8.264199668025333e-01   +4.361743170388973e-01   +6.380492438445255e-01   +8.174402099859979e-03; +9.102778729264980e-01   +9.201576808554873e-01   +2.621425203337494e-01   +5.930230692767080e-01   +9.643149158698117e-02   +5.969891201316878e-01   +8.808110469716572e-01   +3.625147651007996e-01   +2.979364994519748e-01   +6.263179088768537e-01   +8.852831333411834e-01   +2.350440593147696e-02; +9.708596001363156e-01   +8.637845325627366e-01   +1.035486119651926e-01   +6.113007644336645e-01   +7.142438009768720e-01   +1.986971115004732e-02   +1.600886950275326e-02   +6.058304982553169e-01   +8.738582561810395e-01   +4.462422177384584e-01   +5.528661669506718e-01   +6.809355104042126e-01; +4.330970272789709e-01   +3.914810280269789e-01   +5.140205535491759e-01   +3.870739829954958e-01   +7.195629193789291e-01   +8.207271526715730e-01   +4.585341501057475e-01   +2.990472837914442e-01   +4.438581721145398e-01   +3.799588254884135e-01   +1.280216858068701e-01   +3.551466134097070e-02; +4.440207063617108e-01   +6.775862914009378e-02   +9.015925461400817e-01   +6.346440867712323e-01   +1.873947343411019e-01   +4.880214090871084e-01   +5.793380072781854e-01   +6.288239066558833e-01   +4.314876793739859e-01   +8.827649214546587e-01   +3.886791199898999e-01   +3.699317221864474e-01];
L3E_L3I_iGABA_netcon = [+6.722479327799560e-01   +9.150032293987848e-01   +5.738152065573592e-01   +7.113698351689944e-01   +1.534349411417861e-01   +2.244479296240556e-01   +6.668514059215336e-01   +6.505853797878488e-01   +1.925739807654503e-02   +1.398595144836074e-01   +4.000752060438796e-01   +6.912788757613173e-01; +8.638060199325142e-01   +6.472307319793453e-01   +8.378139832995480e-01   +7.586672329699399e-01   +5.715390197202204e-01   +9.369430155771734e-01   +2.689397821786547e-01   +8.291053940496105e-01   +7.937046761256195e-02   +8.634819065149332e-01   +2.818930549277697e-01   +8.435832056756232e-02; +8.679864346222858e-01   +2.086604013092034e-01   +1.074698615430369e-01   +4.269725801668758e-01   +9.679991967504458e-01   +5.236168799444020e-01   +2.246570797924851e-01   +3.751294020299278e-03   +2.072659422800297e-01   +1.421298865459047e-01   +8.501750019344582e-01   +7.925187807898837e-01; +2.443544785725766e-01   +9.043071827260066e-01   +3.041675851981716e-01   +3.778902779320331e-01   +5.358886960224185e-02   +1.635456170605006e-01   +6.579925775212980e-01   +1.365489753719751e-01   +5.382263931137099e-02   +3.357043308891446e-01   +6.583972790520422e-01   +9.597237775630061e-01; +6.203738457304292e-01   +7.112803313161605e-01   +4.558070332294661e-02   +9.302590310157162e-01   +6.934213095259646e-01   +4.062809481500037e-01   +6.151368482926822e-02   +3.674384279486510e-01   +1.687710630933866e-01   +2.511748591084593e-01   +8.539568713243236e-01   +9.834836097492450e-01; +2.357163648175954e-01   +8.137880910864369e-01   +4.540653345641621e-01   +1.394462892942040e-01   +6.895610430537934e-01   +2.447239368015639e-01   +5.390515291634959e-01   +8.403048237220558e-01   +7.212066022077823e-01   +7.932600200249892e-01   +6.208032444070546e-01   +7.772716191173984e-01; +5.883273956157955e-01   +6.609365119579436e-01   +9.388027082661435e-01   +2.282479636697355e-01   +1.536074802274957e-01   +1.943456022088330e-01   +1.804068215630007e-01   +9.480887995347625e-01   +2.343291573154367e-01   +9.717702402073866e-01   +6.601789310136633e-01   +7.965397510504058e-02; +4.721112790639339e-01   +9.291675393240658e-01   +8.010888818331019e-02   +9.132132484147945e-01   +7.866813981273630e-01   +7.789075749887003e-01   +1.682889594631535e-01   +5.810483772870065e-01   +9.058254516532876e-01   +9.999721942705248e-01   +5.158979110539169e-01   +1.772254545310952e-01; +3.051772112958966e-01   +3.316390757301740e-01   +4.324722122778135e-02   +1.492779578184787e-01   +3.915188220481398e-01   +9.269233313179842e-01   +7.164405849770638e-01   +3.105849118984362e-01   +1.638752966449664e-04   +9.560504280884264e-01   +1.353346584224085e-01   +5.985699992243116e-01; +4.584479343445768e-01   +9.543487335572969e-01   +5.082115575974666e-01   +1.611910751891453e-01   +1.283256866516891e-01   +3.956031894958529e-01   +5.389408659531725e-02   +9.176329591895016e-01   +3.275161703225238e-01   +5.170467491488424e-01   +5.215121350780991e-01   +2.349380743439777e-02; +3.665810670986936e-01   +5.420174608551809e-02   +8.800518774264743e-01   +9.508787082869774e-02   +9.864504926979489e-01   +6.911794917464139e-01   +4.892600055449792e-02   +2.963437731543247e-01   +1.839994050743247e-01   +8.556793370206928e-02   +9.594634166374938e-02   +9.941266215269154e-01; +8.055692162589696e-01   +7.862573445535672e-01   +9.165347251116102e-01   +6.193595855077980e-01   +4.391835727396622e-01   +8.561069132543421e-01   +3.699401974141068e-01   +5.940544188305030e-03   +8.181007671309071e-01   +6.505230796109529e-01   +5.539661137151889e-01   +6.311861223947275e-01];
L2E_Input1_iAMPA_netcon = [+8.641695975901663e-01   +6.691083883631971e-01   +3.832849216416742e-01   +9.076197935846564e-01   +9.440615368721228e-01   +4.116026506973621e-01   +1.886459812662770e-01   +9.291974428764942e-01];
L2I_Input2_iAMPA_netcon = [+8.109078929360110e-01   +2.628587266254893e-01   +3.699052533103844e-01   +4.185669248584477e-01   +4.525446984904478e-01   +5.499562307314472e-01   +1.921575097106851e-01   +5.368536740928714e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last =  5.6 * ones(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = -10*((exp(-10*((t)-( 50))^2)));
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 10*((exp(-10*((t)-( 50))^2)));
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 10*((exp(-10*((t)-( 50))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 10*((exp(-10*((t)-( 50))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
