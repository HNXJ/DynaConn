function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.437665679945997e-01   +1.730890000973030e-01   +1.700380484709382e-02   +4.558913014186187e-01   +6.855026472728903e-01   +4.069544374611946e-01   +6.187497304644044e-01   -2.054573877152237e-03   +8.202340924564255e-02   -5.114756704688729e-02   +6.114724394393818e-01   +1.084067167705194e-01   +5.075493600105899e-01   +6.710015169938494e-01   +1.723325575093387e-01   +3.076813547276105e-01; +5.645681063625162e-01   +3.419295233435234e-01   +3.102886032671504e-01   +5.956118125373913e-01   +2.538329719740915e-01   +2.427699525711596e-01   +5.083472329041858e-01   +2.366136354107322e-01   +1.195632350902865e-01   +7.210609027009004e-03   +2.173688912919508e-01   +3.934138584895229e-01   -9.616709305679605e-02   +6.416008662450817e-01   +1.636808955806655e-01   +5.539274155849558e-01; +3.722862583548959e-01   +1.558621046357466e-01   +6.507302582127632e-01   +3.543741975066519e-01   +3.169794791302905e-01   +2.387925644088094e-01   +7.579057812259062e-01   +2.319145814875235e-01   +1.935767456937657e-01   +1.161646058479849e-01   +3.207186365134028e-01   +7.764939753700724e-01   +4.375558692334647e-01   +2.131982915749126e-01   +4.500163394865273e-01   +5.293900193447086e-02; +3.795601489319883e-01   +4.020368116953621e-01   +2.899094007072245e-02   +2.460911715260144e-01   +1.816468450932959e-02   +5.163872457220744e-01   +5.322984123567676e-01   +4.245362827457481e-01   +6.007044130586706e-01   +1.761667231425393e-01   +3.946910499198526e-01   +2.365614199649216e-01   +6.895093196833972e-01   +4.988713313593249e-01   +6.536977688410597e-02   +3.509953102855773e-01; +1.840372114036235e-01   +4.286945404557042e-01   +1.533583246627629e-01   +1.455580464021293e-01   +1.449520135980917e-01   +3.661778085201913e-01   +9.108418233123546e-02   +6.649664145654642e-02   +4.215618636080675e-01   +3.230267379898424e-01   +1.040962938658372e-01   +5.686633239272297e-01   +4.540449656747850e-01   +5.861586945012514e-01   +2.748109669963294e-01   +5.389776526062736e-01; +3.499770016961987e-02   +1.902782591441557e-01   +2.029732111389404e-01   -6.815974529233719e-02   +7.333172598890875e-01   +6.583959211354237e-01   +4.280129550695143e-01   +4.284987996483132e-01   +2.825375360571005e-01   +1.661833299315794e-01   +1.731724772931645e-01   +2.389935177237202e-01   +1.519938280999116e-01   +4.069625890053287e-01   +3.072592084270976e-01   +7.383443933688146e-01; +6.083116383768125e-01   +1.808630574719125e-01   +5.585915322950873e-01   +5.457370989281438e-01   +4.623895534306244e-01   +6.403911459367129e-01   +2.017065375330737e-01   +1.889045121214184e-01   +4.610271452005967e-01   +5.968142343075783e-01   +2.394043696327373e-01   +1.227758786297646e-01   +3.395999725928154e-01   +2.537088847370851e-01   +4.333647303297489e-01   +9.857740042823956e-02; +9.289710637649246e-04   +7.131407262353879e-01   +2.939659657777944e-01   +2.710364761000547e-01   +3.516818571262953e-01   +7.213572824220169e-01   +4.904364639751408e-01   +4.653166495952609e-01   +6.957232987486323e-01   +2.480676732822895e-01   +1.126725779530394e-01   +2.976482872861542e-01   +6.264151618961015e-01   +3.151013564982759e-01   +2.875263637741080e-01   +8.153849412051500e-02; +7.724074382241474e-01   +7.180310043697382e-01   +4.311305939751633e-01   +6.907779337137266e-01   +2.255664415227295e-01   +2.065476386270520e-01   -8.341803241543781e-02   +2.899408498232685e-01   +4.763622906101882e-01   +1.625024942175532e-01   +2.631876109458849e-01   +6.030713878485502e-01   +2.053819917389347e-01   +7.625025566487026e-01   +2.125579700307724e-01   +2.329937848693201e-01; +4.556506774654184e-02   -7.700562682632599e-02   +5.482359437321913e-01   +2.483217685034353e-02   +8.132116917864811e-01   +4.506838021084853e-01   +3.762987009902005e-04   +1.971775966420723e-01   +7.118064998032918e-02   +5.367623567251937e-01   +4.682636734745798e-01   +3.472843573824903e-01   +1.965519975432481e-01   +3.104312612406086e-01   +6.412361708691112e-02   +4.550605961847732e-01; +1.833868094284183e-01   +1.891403882218507e-01   +1.221902968004068e-02   +3.973758372737861e-01   +4.259027337616785e-01   +7.494365710744547e-02   +4.947540921147743e-01   +4.347231475265448e-01   +6.172333353840757e-02   +4.541488289256741e-01   +2.973772240476140e-01   +5.422663405605259e-01   +3.573831643121437e-01   +1.629149435075157e-01   +2.685601456181167e-01   +1.954869324643894e-01; +3.830974002518734e-01   +4.621526681735938e-01   +4.819165955530211e-01   -1.561840054665024e-02   +5.189842331184299e-01   +3.159442989020714e-01   +3.702144697409700e-01   +6.735983055629857e-02   +6.079692490195893e-01   +2.332227537760816e-01   +3.860168481826347e-01   +6.462911626331127e-01   -5.647544040765683e-02   -3.720366895741376e-02   +4.347385051198266e-01   +3.113903739907485e-01; +7.445467192875053e-01   +6.083527779533631e-01   +4.871993322851990e-01   +2.454369392934309e-01   +5.790765159982444e-02   +6.135634947067077e-02   +2.531548998889524e-01   +5.597983955478678e-01   +3.995511846226840e-01   +1.566760718656356e-01   +1.817932107313461e-01   -1.434035063864465e-01   +7.591343643066965e-02   +2.289919470667912e-01   +6.679007023358791e-01   +3.162038752516054e-01; +4.563930874155563e-01   +1.958609085460687e-01   +4.521581303836202e-01   +6.372850286049749e-01   +2.569811831565237e-01   +6.935749000520477e-02   +7.505019242495706e-01   +5.399573663001699e-01   +2.577117690917226e-01   +4.361980103678779e-02   +5.114260456911557e-01   -6.866912596257438e-02   +4.220821603409453e-01   +1.543141893116594e-01   +4.036316328313853e-01   +6.663341646391838e-01; +1.619398961351073e-01   +4.853039328946854e-01   +3.310752809723325e-01   +4.321140136363151e-01   +3.476287551984573e-01   +1.982633784404496e-01   +3.170573780499314e-01   +4.926825468375353e-01   +2.023732219743894e-01   +3.398089957271611e-01   +1.669802563125773e-01   +2.595920234928396e-01   +4.160937324288386e-01   +4.900766113456604e-01   +3.121857155892910e-01   +3.912207158682687e-01; +4.545084674366507e-01   +9.584970996984249e-02   +1.520389342652990e-01   +6.543395261983133e-01   +7.224807921769981e-01   +3.653212128891151e-01   +1.293314792334409e-01   +1.768973054562433e-01   +2.540810446560552e-01   -1.196571186380651e-01   +1.205864379542599e-01   +3.781927534541790e-01   +6.766739329058438e-01   +3.818746057897778e-01   +3.944718047555221e-01   +3.880123203906653e-01];
L1E_L1I_iGABA_netcon = [+2.486871547941366e-01   +1.735610564343288e-02   +3.340865781134639e-01   +3.148243030072475e-01   +6.147029446528249e-01   +2.279663622224771e-01   +4.511685868485884e-01   +5.589884448249615e-01   -1.278836300971874e-01   +4.755346971658684e-01   -2.617347792360370e-02   +3.658153516942882e-01   +6.526607266025574e-01   +2.041332219964423e-01   +1.828554844267771e-01   +5.354129983961617e-01; +2.827215838355404e-01   +8.960142223809819e-02   +3.982877947749583e-02   +4.216098415697661e-01   -8.002039177209527e-02   +1.826629771758184e-01   +4.143912571286894e-02   +4.107663209238372e-01   +4.422051495938065e-01   +6.167670905285400e-01   +2.509645783308047e-01   +3.484647098957582e-01   +3.597483691627237e-01   +5.319869431248762e-01   +5.573958399862603e-01   +4.671483834580099e-01; +4.187938530791767e-01   +7.173157544021281e-01   +2.743941270881879e-01   +5.812680766217211e-01   +4.524873849445965e-01   +2.533601129212149e-01   +6.684123097055777e-02   +1.946797099790293e-01   +3.230857754708980e-01   +4.126469404605306e-01   +3.539805036239932e-01   +3.132447943339901e-01   +4.959165563041894e-01   +2.014867412917912e-01   +9.697267354811934e-02   +1.054633521969294e-01; +3.146610335681211e-01   +5.568296181021166e-01   +1.011158061888620e-01   +1.029842435262402e-01   +4.904469761708544e-01   +2.943319462485993e-01   +5.265862316676424e-01   +5.644305314396822e-01   +3.273663786228851e-01   +5.431147290479256e-03   -6.578363478795768e-02   +3.155313918868119e-02   +1.640646801157420e-01   +6.379852393620600e-01   +2.540386808535719e-01   +3.623503773626999e-01; +5.795397687305411e-01   +8.187946528398997e-02   +2.713130303811325e-01   +1.633176582731677e-01   +6.357748628345467e-01   +2.273170139497948e-01   -1.026649623378611e-01   +2.412764860198208e-01   +2.395684491318032e-01   +2.699573201147767e-01   -4.160911073055783e-02   +2.448385170862047e-01   +4.616692506636960e-01   +8.517084250985904e-02   +5.325520112099497e-02   +2.296946354101278e-01; +5.634536383535321e-02   +4.843425580175635e-01   +1.619455956878774e-01   +1.050730011679696e-01   +9.782756678215158e-02   +4.770679439172544e-01   +3.436705240790311e-01   +4.880550389444981e-01   +3.330229757550569e-01   +5.259456664621264e-01   +5.487821439740881e-01   +5.844608420362788e-01   +2.178629935118224e-01   +2.183489195495618e-01   +2.253160681991851e-01   +5.174406867663243e-01; +3.202728229303108e-01   +1.929664525174088e-01   +3.092625055355839e-01   +7.794341616727434e-01   +6.149513455238590e-01   +1.815095146535478e-01   +3.256506175032288e-01   +6.599292562452689e-01   +3.397855744086626e-01   +3.244531015790900e-01   +3.184050016965738e-01   +1.820828389545938e-01   +4.600620669064244e-01   +2.038235333833897e-01   +2.588392365942896e-01   +2.832690144680327e-01; -7.667059913428859e-02   +3.311074236068999e-01   -1.861823394795085e-02   +1.187010093030035e-01   +1.850622647485019e-01   +4.183555889923808e-01   +5.294878989822501e-01   +2.530758250219683e-01   +1.571912376795463e-01   +1.298911899851838e-02   +1.406988569552300e-01   +3.854601832738045e-02   +4.735890639262095e-01   +6.294463187814789e-02   +6.990943614838054e-02   +1.400327554032742e-01; +5.561908946103273e-01   +7.085115024073324e-01   +3.273605150868160e-01   +6.189197320605514e-01   +2.266048025231166e-01   +4.982317518046835e-01   +4.468624565683731e-01   +2.827327053290469e-01   +3.518173587997749e-01   +4.330726702238069e-01   +5.183946352876544e-01   +3.613599425829200e-01   +2.314544495716840e-01   +9.795206589097141e-02   +5.133530445352107e-01   +5.545607076006551e-01; +1.893835013469888e-01   +1.740270423586985e-02   +4.312560095773812e-01   +2.256546266231135e-01   +9.804377720913247e-02   +2.056841598892944e-01   +2.902399743238947e-01   +4.193391222304876e-01   +1.563977079276572e-01   +5.965912918262403e-01   +3.199915141010837e-01   +1.710872196162721e-01   +2.609852630386084e-01   +2.247245977173908e-01   +1.665539058721366e-01   +2.064609512261281e-01; +3.674442346517014e-01   +3.583645292492464e-01   -5.146266345307351e-02   +6.922144892699874e-01   +3.012612440548204e-01   +6.571388911664384e-01   +1.393857553190003e-01   +7.581433861218979e-01   +2.855330300589325e-01   +6.789077327759606e-01   +5.805679156171557e-01   +4.546671081983101e-01   +5.291141886989675e-01   +1.094244448071808e-01   +5.233399974408708e-01   +4.378341719536026e-01; +1.088401759748356e-01   +6.101800068366194e-01   +4.703640633123682e-01   -7.880385750862730e-02   -4.298176606899143e-02   +3.705647305245470e-01   +5.882544145268715e-01   +6.715926740771997e-01   +3.208420188245245e-01   +1.228339308605188e-01   -1.166993679817826e-01   +2.575216399168276e-01   +4.556925801581794e-01   +4.297076624242320e-01   +3.101416568348578e-01   +1.897996019898724e-01; +2.720705297021132e-01   +7.317436653411391e-01   +4.112819156011913e-01   -7.047335988219901e-03   +6.037505143591090e-02   +4.478443716304073e-01   +4.148665632453572e-01   +4.984406656160026e-01   +1.903306879164630e-01   +2.307163274866241e-01   +1.391672294327995e-01   +4.108737584414586e-01   +3.885500716816945e-01   +4.764427083054858e-01   -2.516800328204949e-03   +2.756696580398064e-01; +5.875116780800378e-01   +3.025350418732132e-01   +3.819667501423806e-01   +2.938029831558749e-01   +1.083758037995557e-01   +2.702473161292394e-01   +6.906524985372765e-01   +1.016916518701620e-02   +6.032948287194326e-01   +7.396225641897898e-01   +2.788698651048994e-01   +5.439410231884998e-01   -5.055613024131161e-02   +4.525288554907153e-01   +4.378039318675637e-01   +4.831546195180776e-01; +4.127665050358980e-01   +1.340670068760669e-01   +7.751032142396624e-02   +2.174909659549086e-01   +3.873398723032164e-01   +2.263209558166592e-01   +2.737417837946106e-02   +5.597814052690663e-02   +9.137661872425171e-02   +5.270677653922226e-01   +2.244411448958665e-01   +1.999233135369425e-01   +4.547906456087983e-01   +5.961615634813171e-01   -2.320465768261626e-02   +5.141539774106008e-01; +2.859395357801290e-01   +1.075752824436099e-02   +2.773706895317156e-01   +2.014533236382729e-01   +3.687107269193667e-01   +6.826542128017434e-01   +2.639533062442800e-01   +6.028309075919254e-02   +2.021807687740709e-01   +4.010681385215016e-01   +1.065066120769410e-01   +3.138683760854960e-01   +1.014575795725277e-01   +4.968875745371474e-01   +4.533609182855960e-01   +1.360131638549102e-01];
L2I_L1I_iGABA_netcon = [+3.218442337278037e-01   +1.577545871950251e-01   +3.767701023987576e-01   +2.968287615453698e-01   +8.976238496831279e-02   +5.009402138538824e-01   +1.188060455989283e-01   +5.020375394525235e-01; +4.564562056367827e-01   +2.715743903340393e-01   +4.047135038612037e-01   -9.360644093752196e-02   +6.805873078144259e-01   +5.703553016675555e-01   +4.790590466782383e-01   +3.284307755673767e-01; +2.572226825543640e-01   +4.348399004032233e-01   +2.698305120018438e-01   +2.619786542244058e-01   +3.291064793355931e-01   +4.150550232546640e-02   +4.815699132011865e-01   +2.633811576944518e-01; +6.971656745007754e-02   +4.459485044368682e-01   +8.212192377281434e-02   +2.523426439916722e-01   +2.209782040496159e-01   +4.952589207302747e-01   +6.592766182748014e-01   +7.728256486834357e-01; +9.678698058213472e-02   -1.030580854685851e-01   +4.904219344468218e-01   -1.803127045253123e-01   +2.091502150894799e-01   +4.811081012658773e-01   +6.133353012271796e-01   +4.793593296021041e-01; +1.421368931913507e-01   +3.121244871313005e-01   +7.022380613874458e-01   +4.286952329857889e-01   +3.567541836023393e-01   +4.583792692767189e-01   +2.508468288527909e-01   +3.099869626197939e-01; +8.298868424448960e-01   +2.214973425264323e-01   +4.439322514345936e-03   +3.251087794489673e-01   +6.496446114627574e-02   +7.119402465195759e-01   +1.191874422774648e-01   +5.697187051703941e-01; +1.432759575632224e-01   +6.351381248384060e-01   +3.164352088316877e-02   +6.372989529759795e-01   +3.982675602665542e-01   +3.259182326572801e-01   +5.265845187471854e-01   +2.997689567459444e-01; -5.462439345840326e-03   +2.374994928831563e-01   +5.587742642896244e-01   +5.924170797928812e-01   +5.409630621249845e-01   +2.276598758259785e-01   -3.887307038660145e-02   +5.678188408674981e-01; +5.251061086324501e-01   +3.487400245718167e-01   +1.059335907261063e-01   +2.195887483048863e-01   +5.861752255189205e-01   +5.840648135694738e-01   +1.546472612466314e-01   +3.781009600753854e-01; -3.963564643960601e-02   +2.551235297018331e-01   +4.516644612943904e-01   +1.966064411292848e-02   +4.327904463800344e-01   +2.986777248504440e-01   +5.792409949706155e-01   +5.848338144717170e-02; +2.217795201830575e-01   +3.582968996576404e-01   +5.373584802313683e-01   +2.679552898688198e-01   +4.566515170564977e-01   +1.718324598163679e-02   +4.045795358982938e-01   +4.938642035369285e-01; +4.643908414230364e-01   +2.586025763992076e-01   +4.368754454253160e-01   +4.136673802912212e-01   +2.772082516875070e-01   +5.759705024839009e-01   +2.793456824381120e-01   -9.076500236854468e-03; +3.798761142978448e-01   +4.900795847425061e-01   +3.675250060291790e-01   +2.663283985699760e-01   +1.434409889154087e-01   +3.854520804550822e-01   +4.536025774780540e-01   +3.364915927013192e-01; -9.036719120273780e-02   +4.697140223642228e-01   +3.019649030687098e-01   +2.231578598723751e-01   +3.277889743472662e-01   +1.913132770280751e-01   +7.135106528586511e-01   +5.601033269041288e-01; +5.852106383571558e-01   +1.178061630251397e-02   +3.444193084484461e-01   +5.584201480880410e-01   +5.248845573147110e-01   +4.822241465092211e-01   +2.705322749971310e-01   +5.912760997093698e-01];
L1I_L2I_iGABA_netcon = [+5.238896603099610e-01   +3.956160228892315e-01   +1.451175083187861e-01   +1.670821255268162e-01   +5.111732332262560e-01   +7.680642100932096e-02   +4.334517861867972e-01   +2.509939957878100e-01   -2.170999281822822e-02   +6.057301273626948e-01   +4.668753534860114e-01   +2.268959213756939e-01   -8.061065856860623e-02   +1.230296172814290e-01   +5.958930013520173e-01   -8.128272509182498e-02; +5.787079315073596e-01   +5.262388707321040e-01   -8.574668847296803e-03   +5.167874159661471e-01   +1.717351746368397e-02   +5.476788071768655e-01   +1.972396461164637e-01   +6.955224340191521e-01   +6.796153050453312e-01   +6.378490494780590e-01   +2.591349065877905e-01   +9.474459539298410e-02   +3.458022242339100e-01   +6.732289074119879e-01   +7.857232950042261e-01   +3.084740220395794e-03; +2.277845582776326e-01   +1.506491847535779e-01   +9.252475140922418e-02   -5.426465416722665e-02   +3.579255716462859e-01   +4.768231327471567e-01   +4.844016425607078e-01   +5.192413124443206e-01   +2.784362288948701e-01   +3.292563933176952e-01   +4.089437183567092e-02   +2.007122068985193e-01   +5.593733696270003e-01   +7.456067771395025e-01   +2.720511869293959e-01   +7.723371406955234e-02; +3.003913556600380e-01   +5.219946135393935e-01   +5.566259286104868e-01   +4.936900794545601e-01   +2.663317305035232e-01   +7.523848887932776e-01   +2.803466166574556e-01   +3.870469602976161e-01   +6.279976224932813e-01   +4.857373344606550e-01   +7.073646535560894e-01   +6.988257121596861e-02   +4.556672700936820e-01   +4.480044773253407e-01   +1.832137433335399e-01   +1.761807437030476e-01; +4.853464120890539e-01   -1.462839587521053e-02   +3.482789688972829e-01   +3.474476749776098e-01   +8.076430339768745e-02   +2.245262299429367e-01   +5.691373490051393e-01   +1.287918176630065e-01   +1.717753644830225e-01   +4.321756607766279e-01   +3.327257043353165e-01   +3.291874732714863e-01   +1.095178660422096e-01   +3.653030937445960e-01   +6.318662941964250e-02   +1.855725084444999e-01; +2.236326144909223e-01   -1.793508626994651e-03   +7.107117935462431e-02   +4.061159534584254e-01   +6.135701546357701e-01   +5.317818331300209e-01   +2.197605056186406e-01   +4.908066050329352e-02   +3.414786319013566e-01   +3.400623993861497e-01   -6.506926049347987e-03   +4.615636730192088e-01   +3.446098685458249e-01   +3.531804709216663e-01   +5.322714067092166e-01   +1.746146523219717e-02; +5.881604170811322e-01   +7.624042756834514e-01   +5.909860138110606e-02   -7.967394622095431e-02   +2.993590865374459e-01   +4.328355430118329e-01   +6.024257554199494e-02   -4.482109977605862e-02   +5.373607260680436e-01   +1.748294183394688e-01   +4.404175671343284e-01   +3.792354199369288e-01   -1.041583701789800e-01   +3.464980381542250e-01   +1.251819432957221e-01   +6.963368797157828e-01; +6.176678879453551e-01   +2.934843262457575e-01   +9.996677035615147e-02   +2.796433680581232e-01   +6.488703050959908e-01   +3.481725153368251e-01   +3.739008827248567e-01   +1.607811237498542e-01   +6.630399675452847e-01   +3.559507501706239e-01   +1.210992368819701e-01   +3.965021667393396e-01   +6.157039347697919e-01   +4.589130072836039e-01   +6.071488460274376e-01   +1.453541347991810e-01];
L2E_L1E_iAMPA_netcon = [-2.971241940956035e-02   +5.489953313305629e-01   +3.907008787819109e-01   +3.179117266355079e-01   -1.366597874949908e-02   +5.300158211144926e-01   +1.219766751080884e-01   -3.423420333083829e-02; -7.051272962860970e-02   +1.953716157734890e-01   -5.389562551763352e-02   +5.825119818760608e-01   +5.277251904656353e-01   +4.794787133182971e-01   +7.095790389723956e-01   +6.332013700579425e-01; +5.846829266326770e-02   +2.186241707303202e-02   +6.275644441216357e-01   +4.082782841949981e-01   +1.178776622932427e-01   +4.433824404941157e-01   +5.810919677213734e-01   +1.074028725255303e-01; +2.169257261522088e-01   +5.205799572314272e-01   +1.240467798098680e-01   +2.090761884524414e-01   +6.776613427350078e-01   +2.380206226178894e-01   +3.555324266135773e-01   -5.334200618405965e-02; +6.233084246453225e-01   +3.154193921292968e-01   +4.581709788414322e-01   +4.543563145263287e-01   +4.735645206914120e-02   +9.852121726641559e-02   +8.462718055972263e-02   +6.766207925672514e-01; +6.581897769433995e-01   +4.724510609772296e-01   +2.439245206532195e-01   +1.113981927525046e-01   +5.123373027594873e-01   +4.627685248154036e-01   +4.001638500484986e-01   +5.406479568565227e-01; +2.399436842702826e-01   +4.034265949729976e-01   +1.159503741416427e-01   +4.297192019568431e-01   +2.332586312824395e-01   +5.238240173418175e-01   +6.812568242766919e-01   -1.178028863102419e-01; +4.873211133048949e-01   +5.570160266396743e-03   +2.595950192914536e-01   +5.230013858528713e-01   +3.950084393717035e-01   +1.705767863320155e-01   +4.148476713419083e-01   +1.998190574792178e-01; +6.931089893545312e-01   +1.925017644554643e-01   +4.963254166357989e-01   +3.284882301446527e-01   +3.381523069839614e-01   +4.536071912091613e-01   +4.858673167749867e-01   +3.489885913990579e-01; +5.377157287210039e-01   +5.644210685503663e-01   +4.275658051555911e-01   -3.216683810050432e-02   +5.761232468601152e-01   +2.237222686135325e-01   +3.883005939376082e-01   +3.216748212209063e-01; +1.647327611986233e-01   +4.366017456265350e-01   +9.538155814279761e-03   +1.678495832653288e-01   +6.516563800227780e-01   +6.180598636027075e-01   +1.587604552259672e-01   +2.022162672192251e-01; +4.582881713690342e-01   -3.698497321653824e-02   +4.638321449254990e-02   +2.337121138327378e-01   +2.039133973922421e-01   +2.541541964757488e-01   +4.792405173184132e-01   +2.980177982201399e-01; +5.184231771685740e-01   +1.015834476426692e-01   +4.275372879570238e-01   +2.179225605738427e-01   +6.077533822768465e-01   +1.635270511444606e-01   +4.730389315388152e-01   +4.038893433203231e-01; +5.719791256400232e-01   +6.481506295318884e-01   +2.336150652441240e-01   +3.088315439308483e-01   +3.984843671027430e-01   +5.143812656759895e-01   +6.446498173644030e-01   +8.048872301918028e-02; -2.774998913404678e-02   +4.877761059573901e-01   +1.352883099360814e-01   +7.950831649258053e-02   +2.934947557318426e-01   +6.736586278788211e-01   +1.499406165384723e-01   +2.842817522776421e-01; +2.147011230020560e-01   +6.237245682988117e-01   +5.235459277089626e-01   +4.167709112400185e-01   +3.152551100646552e-01   +4.830314145650378e-01   +4.538041056512007e-01   +2.449570224138506e-01];
L1E_L2E_iAMPA_netcon = [+3.284682843863047e-01   +4.456405956104726e-01   +3.036315470724478e-01   +5.623213099124820e-02   +1.490580761385944e-01   +4.335189832545224e-01   +1.467194867349741e-01   +5.947107287627040e-01   +4.946982070201775e-02   +5.141063470664232e-01   +7.479608959195913e-02   +1.903970215557702e-01   +9.598223590001126e-02   +2.134239537791434e-01   +6.148324415021117e-01   +2.676851825128974e-01; +4.691981675931349e-01   +7.081512181273050e-01   +5.597914593948836e-01   +5.245852174964907e-01   +3.278891415794272e-01   +4.589912958474294e-01   +3.170426941669592e-01   +9.792377244820669e-03   +8.630698966492065e-02   +2.673702967904197e-02   +4.496707774641003e-01   +4.328937542696834e-01   +8.073489245497020e-02   +6.933014965603018e-02   +6.506029669712257e-01   +3.743242880817456e-01; +2.482799010847779e-01   +6.899283513027479e-01   -2.750400465834980e-02   +2.337466077409658e-01   +2.889638653541170e-01   +6.756689610317496e-01   -9.929347592638048e-02   +5.442679578310361e-01   +2.480426145833272e-01   +6.201291262521541e-01   +5.157285908992767e-01   +2.471401872781557e-01   +2.452222103976104e-01   +6.838927087619888e-01   +6.361358606730332e-01   +5.209081353044853e-01; +5.745869521636435e-01   +1.154889212629961e-01   +4.494314494989215e-01   +1.320045235052515e-01   +5.473904264462373e-01   +2.474249312545258e-01   +6.260764861806687e-01   +4.716058440981982e-01   +3.895548271228421e-01   +6.203024232353459e-01   +2.956634041238235e-01   +1.712246425302694e-01   +6.430127871581034e-01   +3.769237040531849e-01   +5.141013719338825e-01   +2.328028694008806e-01; +3.139354220781637e-01   +2.332975349630953e-01   +2.806725360354060e-01   +6.246554890571856e-01   +1.521807944586401e-01   +4.047647731267154e-01   +3.417069369142887e-01   +6.469774141785473e-01   +3.149874597741374e-01   +4.189112359409654e-01   +1.744360037520552e-02   +4.945982874001160e-01   +5.222900552711743e-01   +1.620800795322880e-01   +6.292867347959005e-01   +7.941157731701232e-01; +4.540194479433056e-01   +5.872437516639543e-01   +1.697125063453796e-01   +7.163861926045625e-01   -1.596764794001253e-01   +1.237084770485643e-01   +2.636114343857975e-01   +5.233530952238927e-01   +5.505279083926963e-01   +4.662200593156856e-01   +2.603844790305684e-02   +1.654815470010573e-01   +1.268023206806859e-01   +4.580648092593325e-01   +4.602852265013634e-01   +1.869503743384058e-01; +4.286457535526483e-01   +2.481607881370597e-01   +1.858781327580543e-01   -7.117188869661360e-02   +5.868993579579300e-01   +5.419490401496150e-01   +3.635107685873132e-01   +1.711388683984047e-01   -1.328378176565927e-01   -7.844202040798809e-02   +8.054733295252259e-01   +2.514306327850901e-01   -4.625203333004574e-02   +6.378332418929895e-02   +2.786243153146712e-01   +2.016793583798225e-01; -4.371826931144594e-02   +4.328443691499564e-01   +1.839283001125841e-01   +3.727762067918873e-01   +8.510944809030019e-02   +5.314146179857886e-01   +4.431545814043333e-01   -1.008067428887217e-01   +4.818487702363383e-01   +4.685414492495666e-01   +4.153142758739076e-01   +9.185087068936892e-02   +6.185820490784847e-01   +4.343598735081823e-01   +5.491871141253071e-01   +5.545015834499013e-01];
L2I_L2E_iAMPA_netcon = [+7.735967784610415e-01   +2.938179532757199e-01   +5.331790418865958e-01   +4.656476701093440e-01   +5.234934318058659e-01   +6.545446131635202e-02   +1.409726514553090e-01   +5.128102643553538e-02; +6.847459120427899e-01   +6.630228637382782e-02   +8.974549251123484e-02   +4.526335677239631e-01   +5.784606265116541e-01   +1.509464669188917e-01   +4.255150400985576e-01   +2.804904231268480e-01; +6.625375160169167e-01   -3.308838229760810e-02   +5.512106402689745e-03   +4.415480086723683e-01   +5.568363466716030e-01   +3.839726033221814e-01   +5.130517197092389e-01   +5.913799622580378e-01; +3.314821119126771e-01   +4.571075475429396e-01   -1.300871367347368e-01   +3.603552304150410e-01   +5.908849199863996e-01   +7.278373266605146e-01   +3.590399433708150e-02   +9.860436879229792e-02; +3.018493431790925e-01   +1.813672867773672e-01   +4.045786592245490e-01   +1.180431247046616e-01   +4.900019656863687e-01   +4.036281627289424e-01   +3.360466940606616e-01   +3.862384796388733e-01; +2.778652756895228e-01   +4.327384658184414e-01   +1.159890976026091e-01   +1.945264753261708e-01   +4.034016915430921e-01   +5.249531691077858e-01   +3.890517024815189e-01   +1.978679367264532e-01; -4.926313808352713e-02   +2.169487395142993e-01   +4.994154980218009e-01   +2.909682883478354e-01   +4.340054454797453e-01   +4.141327283417460e-01   +5.659449343992786e-01   +2.768428508819272e-01; +5.550370762959818e-01   +8.022964888447069e-01   +5.375371740505659e-01   +3.204002823593202e-01   +3.219773831794295e-03   +8.345384583144269e-02   +2.426395671286010e-01   +5.783969692831407e-01];
L2E_L2I_iGABA_netcon = [+6.176791383965106e-01   +3.222630320208685e-01   +5.288722980226833e-01   +6.477038862005887e-01   +2.381933684335419e-01   +7.044294892518900e-01   +5.070625484343210e-01   +2.000973186378838e-01; +5.451628147041112e-01   +5.893884355032756e-01   +6.521230030475658e-01   +9.844754855389677e-02   +5.159841077671050e-01   +3.213826771122698e-01   +2.524828370447394e-01   -7.779724574246340e-02; +6.400293935148753e-01   +1.921240901197086e-01   +3.553491196946368e-01   +5.048603556813275e-01   +3.196211065709445e-01   +2.117587270020715e-01   +5.267170990115340e-01   +3.915182548202246e-01; -1.526856374043486e-01   +5.728026027273931e-01   +3.969348496019601e-01   +2.123493960727048e-01   +4.981656405404465e-01   +1.151218691730483e-01   +4.801270650750679e-01   +2.839268793230953e-01; +4.212204192782242e-01   +2.024582810651670e-01   +5.771797068633152e-01   +4.343770875940632e-01   +9.623261210167419e-02   +4.078318271388137e-01   +3.506287822338362e-01   +3.799226158291682e-01; -1.281648954647989e-01   +1.149904636564665e-02   +4.101251661965414e-01   +3.228601604802709e-01   +5.261002878550937e-01   +6.771532305932233e-01   +5.697663752013370e-01   +3.380379051151318e-01; +6.726058491455137e-01   -4.042711231062407e-02   +3.263342505202562e-01   +1.564566181974150e-01   +4.540536563780180e-01   -6.272262035294242e-02   +6.057583005788680e-01   -3.340866414518513e-02; -8.199724699628902e-03   +2.448189964255276e-02   +3.718269334878222e-01   +3.219360383664392e-01   +3.377273477211939e-01   +3.850997587091442e-01   -7.145092081951157e-02   +5.535090613823621e-01];
L3E_L2E_iAMPA_netcon = [+4.307989709812353e-01   +4.016472014055186e-01   +5.395571537304641e-01   +1.672719987929684e-01   +7.046300333823384e-01   +3.776385451747367e-01   +5.549776517084203e-01   +2.556309523217788e-01   +1.727195628419710e-01   +1.749484574464745e-01   +3.191255208812567e-01   +5.492489904882019e-01; -5.318040467681107e-02   +4.809938434419183e-01   +6.742827476279453e-02   +3.735842927937979e-01   +2.960948003219266e-01   +1.811642716327818e-01   +6.647539401852818e-01   -1.273023542283354e-01   +1.529299420176123e-01   +3.094617799419518e-01   +1.712143627044460e-01   +5.408221875447666e-01; +1.406146759693729e-01   -9.936651014217804e-02   +1.168472386669738e-01   +8.144570145647689e-02   +6.150345956991591e-02   +1.477042602479829e-01   +6.473625759143220e-01   +3.487368757507181e-01   +2.658411590363953e-01   +4.463435945441006e-01   +6.666939186782785e-01   +2.547375847192481e-01; +3.972112730314861e-01   +2.025999728804150e-01   +2.682559848032690e-01   +3.564350303557932e-01   +4.365615228793741e-01   +1.598169961673450e-01   +4.902659727927615e-01   +6.116453833505584e-01   +3.100936776970932e-01   +4.950950865945244e-01   +3.854784020284595e-01   +4.689004973119630e-01; +3.599802876887189e-01   +3.465660761995858e-01   +4.233349190371616e-01   +4.082345226929280e-01   +2.504284715505982e-01   +4.050648096657999e-01   -3.820429635082570e-02   -5.235492633309326e-02   -4.537911136026471e-02   +3.485859372375677e-01   +3.610442189168275e-01   +6.706034503616454e-01; +7.187197266556331e-02   +3.326659832813224e-01   +2.036256537010902e-01   +7.507641437756634e-01   +3.150034802817314e-01   +2.317407623113062e-01   +2.013974877706864e-01   +4.536020370983748e-01   +5.098547743049114e-01   +3.386341830229116e-01   +4.466529043063900e-01   +9.461277034743239e-02; +2.811347284781929e-01   +5.942855130581566e-01   +5.292393420046992e-01   -7.631514356971492e-02   +4.549159696666842e-01   -3.519066112166467e-02   +1.014350459437649e-01   +4.423163811783773e-01   +2.609456739462472e-01   +1.934129075476502e-01   +8.167693710057733e-02   +1.468948224382853e-01; +4.145546893965664e-01   +4.073080326491433e-01   +3.497959370842023e-01   +4.035274917335112e-01   +3.198501776625112e-01   +6.078108301020128e-01   +5.437086334961959e-01   +2.066410874502948e-01   +5.423924446712414e-01   +5.439816025910471e-01   +2.696024061710797e-01   +4.896509312777403e-01];
L3I_L2I_iGABA_netcon = [+2.310570280276346e-01   +4.777730980668379e-01   +7.517861924879170e-01   +7.783135229605181e-02   +5.568204396849278e-01   +1.226018635984391e-01   +3.024571169778046e-01   -3.520172575882952e-02   -1.276948434748020e-02   +5.793352009323464e-02   +6.798271386131496e-02   +6.047161022383981e-01; +3.972665936108670e-01   +9.155013235944878e-02   +8.092937312652680e-02   +1.018510318961870e-01   +1.561690646638851e-01   +6.030603316667824e-01   +4.809947911894761e-01   -5.826446152944843e-03   +3.628342291988934e-01   +5.572938512207803e-01   +2.749666795945311e-01   +3.311381162386575e-01; -1.473508695425146e-02   +3.509136971679116e-01   +1.030091637454043e-01   +7.305516275039599e-02   +5.241339419375096e-01   -4.602460399031075e-03   +4.059219978923955e-01   +3.812025662203246e-01   +1.701543032317692e-01   +2.385028076531175e-01   +4.007617678406639e-01   +6.028200288189516e-01; +3.634888861941121e-01   +3.024019852057912e-01   +5.410264661065112e-01   +4.418095228319928e-01   +3.423966847158902e-01   +6.314106100157824e-01   +1.352679201490505e-01   +9.217179922642196e-02   +3.746320559145581e-01   -7.009426581224838e-03   +4.331134929766768e-01   +4.125915768897093e-02; +1.975494689377123e-01   +5.184998703394601e-01   +2.446072209014769e-01   +5.686317387204348e-01   +4.117319769177191e-01   +2.672944980937384e-01   +4.808125471117740e-01   +1.829894923100021e-01   +5.628377126754434e-01   +1.449369535852328e-01   +2.526315235902293e-01   +1.845376013216880e-01; +8.338378924403275e-02   +1.918769042073564e-01   +6.235732666037198e-01   +1.613510879844485e-01   +1.004530222468159e-01   +1.627754363512017e-01   +2.489275716685868e-01   +3.373291183330657e-01   +4.472058826674874e-01   +1.990272156560984e-01   +4.184538657646813e-01   +2.233139872041240e-01; +5.109734934706968e-01   +6.549329651008294e-02   +4.008131881615489e-01   +5.197180316577492e-01   +4.656023009734908e-01   +2.173452526837343e-01   +6.898721832558892e-01   +5.142231160525466e-01   +2.162224452939807e-01   +4.430519189993182e-01   +3.542689838021764e-01   +8.741098155692822e-02; +2.930160819551681e-01   +6.289069470893586e-01   -3.825668565326348e-02   +3.513271873728860e-01   +1.090840549616348e-01   -7.077315620444180e-02   +1.052819917088192e-01   +2.834231303628670e-01   +2.430922792104315e-01   -1.383133556644734e-01   +2.781369497096187e-01   +2.732565710250738e-01];
L2E_L3E_iAMPA_netcon = [+4.938363653896108e-01   +1.918702935188074e-01   +7.246648040117757e-01   -5.759371490698495e-02   +2.743884111501927e-01   +2.463065545128133e-01   +1.496717122236051e-01   +3.746771433573930e-02; +3.169069953594256e-03   +4.420660734272488e-01   +6.714158152949395e-01   +3.239503144954766e-01   +7.899259026771873e-01   +3.784459872599544e-01   +2.006294225874610e-01   +5.989604825810187e-01; +4.865889340934385e-01   +3.913084322656005e-01   +3.161092890126745e-01   +5.610299838691218e-02   +5.846315826511575e-02   +7.686421098200551e-01   +4.185846789767013e-01   +5.846394258183943e-01; +2.583648819903055e-01   +3.815810444392254e-01   +2.642677365258831e-01   +5.250186411441355e-01   +2.474853381295797e-01   +1.300686679774829e-01   +5.608331881758845e-01   +5.700325322423272e-01; +2.860516621370744e-01   +3.085281001712130e-01   -6.382893904873843e-02   +8.110601807541420e-02   +3.601176328368343e-01   +2.373176451480593e-01   +3.456668553820482e-01   +5.621144120406826e-01; +2.823017268916064e-01   +4.599498874455412e-01   +4.002261734168626e-01   +1.712759864062782e-01   +3.067386825693704e-01   -6.224218451639404e-02   +6.346601907982876e-01   +1.702238634136498e-01; +4.313203849314100e-01   +4.628406132343424e-01   +2.748016505725907e-01   +3.742793835304568e-01   +1.862625544158006e-01   +4.899549256430115e-01   +4.774616190117728e-01   +1.275060895006476e-01; +3.754059032441741e-01   +3.004651374584150e-01   +2.208279311664637e-01   +8.270203521026119e-02   +2.393683813518632e-01   +2.017420288774733e-01   +4.276652930958053e-01   +2.660735347345322e-01; +4.007705170555849e-01   +5.247696738617534e-01   +5.267470663398897e-01   +5.834928778253677e-01   +4.301380673977315e-01   +4.077146503615653e-01   +6.677305882859613e-01   -3.949914774634208e-02; +4.844135772620848e-01   +6.080333864429897e-01   +3.350044139291448e-01   +3.932065029385279e-01   +3.329090193169562e-01   +2.411478257431027e-01   +1.101931917788079e-02   -5.745448084241003e-03; +4.702999864460157e-01   +4.795241041176423e-01   +9.522665841905226e-04   +2.281890168501937e-01   +4.059318240516012e-02   +3.986315672504592e-01   +3.381060888460450e-01   +5.479013668790405e-01; +4.823469261694701e-01   +7.058613306613347e-01   +3.830523703743695e-01   +4.279014527466378e-02   +3.203934353060446e-01   +3.746218995747373e-01   +4.636481274132633e-01   -3.649772986733266e-02];
L2I_L3I_iGABA_netcon = [+1.029060225396193e-01   +2.275242480865145e-01   +2.343084942764818e-01   +5.063215267954457e-01   +6.078619656629256e-02   +2.206429406396526e-01   +4.021861779586519e-01   -9.502709463388419e-02; +5.840379482610862e-01   +4.457240981116224e-01   +2.572847502878133e-01   +6.231309991618628e-02   +4.818236864986686e-01   +1.045514593564008e-01   -7.261107705277813e-02   +3.759513832598164e-01; +3.504119341325524e-01   +2.132197242730060e-01   +2.561572908012097e-01   +2.290496558649196e-01   +3.326354293872107e-01   +5.585427836556290e-01   +4.299806254280983e-01   +4.701863971121608e-01; +1.439265184737056e-01   +4.305613620210836e-01   +5.623613226441295e-01   +4.849502041856679e-01   -1.040869965616580e-02   +3.450978328970996e-01   +3.471094558539030e-01   +4.513238499399101e-01; +1.043458165802463e-01   +2.387512468933893e-01   +2.322492439159639e-01   +1.146723186446019e-02   +2.115583220182796e-01   +4.049339401772075e-01   -3.229750830043782e-02   +4.914929670695407e-02; +1.088355582429100e-02   +4.658325336703547e-01   +5.804415574148627e-01   +7.865548481869294e-02   +9.258681178907509e-02   +2.891413103027761e-01   +1.972544266919919e-01   +3.739378553977894e-01; +1.795422127472032e-01   +3.692851726465071e-01   +5.355109057478290e-01   +3.853853460682157e-01   +2.134230126062581e-01   +2.886603753700796e-01   +3.740126066274967e-01   +1.111254727803737e-01; +3.667811223290570e-01   +8.993786249704153e-02   +1.345113913366727e-01   +4.760681654283616e-01   -2.477639646829274e-02   +2.041276761850138e-01   +2.789001887515001e-01   +3.162347620490833e-01; +3.258800652489834e-01   +4.863652557321262e-02   +2.869234236257918e-01   +1.989846985884325e-01   +1.169061526096553e-01   -3.855235872775146e-02   -6.417821786551804e-02   +4.415408528106740e-01; +4.606889928400633e-01   -8.776745440677344e-03   +7.209704027665412e-01   +2.429729097279051e-01   +2.021925916160946e-01   +6.219423610205180e-01   +7.136894617742005e-01   +2.695743747032559e-01; +3.719672228147972e-01   +1.182498146551877e-01   +3.764557835369172e-01   -1.743309617411699e-02   +2.708543396198250e-01   +2.263302420928267e-01   -1.389128803416482e-01   +2.086702218040094e-01; +3.929315315181858e-01   +2.460960197641851e-01   +1.416286008378559e-02   +8.585414821845937e-02   +4.769058697844954e-01   +3.151082674376732e-01   +5.650671224682380e-01   +5.116191905339638e-01];
L3I_L3E_iAMPA_netcon = [+2.745206571197783e-01   +4.024948762343646e-01   +4.076185400337152e-01   +4.508754143403461e-01   +4.928769050257182e-01   +1.222155971505278e-01   +4.689274406504037e-01   +5.837513514177847e-01   +1.504547315763414e-01   +6.456742018967221e-02   +3.209759919982041e-01   +4.045838829746791e-01; +3.995012538779649e-01   +1.050857246266018e-01   +1.914423392939950e-01   +5.023683533899610e-01   +6.146246881282631e-01   +8.729224971713161e-02   +6.836046305920129e-02   +2.130271334360161e-01   +3.634667191256960e-01   +2.653437714295779e-01   +5.998440442006124e-01   +4.861954873841962e-01; +4.303225641527537e-01   +3.505916346715499e-01   +1.012746625114454e-01   +3.532949297364379e-01   +1.039091418206144e-01   +6.285211978273848e-01   +5.246344672306916e-01   +3.858183558214070e-01   -1.042225089884175e-02   -6.356448573568928e-02   +2.928213084513785e-01   +1.352169110078261e-01; +3.114795285516546e-01   +3.613480174195483e-01   +7.509746533358964e-01   +1.817392548270413e-01   +2.004101518260890e-01   +2.097951885872277e-01   +4.671996299888009e-01   +2.709267902181121e-01   +5.044262717130675e-01   +5.871260165144764e-01   +1.606216071456790e-01   +1.888197196049363e-01; +3.269736831587643e-01   +3.794920333084800e-01   +2.405756505309548e-01   +3.648550936078974e-01   +2.692430325986025e-01   +4.986048768982745e-01   +3.943966577374565e-01   +3.948396933035546e-01   +3.508908458765921e-01   +2.992139159575530e-01   +2.396334780972497e-01   +1.338982904852815e-01; +1.439738888716232e-01   +4.698401525753113e-01   +6.425764533032736e-01   +4.216415528632914e-01   +2.843769009847922e-01   +2.466715185312665e-01   +3.662361339423622e-01   +2.889522873328699e-01   -8.711303225058184e-03   +1.030169244276108e-01   +2.417836703538475e-01   +5.877870504801259e-02; +3.684889217617922e-01   +3.430008129876010e-01   +8.946835136139408e-02   +3.228065339483970e-01   +6.236998091165692e-01   +4.751305913518463e-01   +2.347728338230379e-01   +1.305244302120471e-01   +5.795969410688959e-01   +1.698801458735141e-01   -3.027661337406287e-02   +4.391548258309661e-01; +1.755802869180831e-01   +1.646263010379736e-01   +6.008044709646172e-01   +3.590446226309258e-01   +4.104677341242963e-01   +4.476067385932762e-01   +2.167487035881708e-01   +3.586947272756538e-02   +4.837820035264987e-01   +6.257418347188818e-01   +1.585229593744962e-01   +2.657101156964295e-01; +2.271950847879797e-01   +4.438159697422502e-01   -5.068385822098093e-03   +2.543285623604945e-01   +4.185735731618293e-01   +2.933352812368376e-01   +7.013206636016307e-01   +2.142444503633255e-01   +1.620239159711828e-01   +3.342717803990868e-01   -9.452238334538608e-02   +4.139259832745845e-01; +1.656326907477326e-01   +3.578508219623980e-03   -9.592683616887458e-02   +5.197147489961662e-02   +1.363081648613068e-01   +1.291644918453650e-01   +1.994509772446182e-01   +7.595831193218175e-02   +5.408671344638412e-03   +5.289537324521110e-01   +4.661444997554889e-01   +1.304039611872473e-01; +3.903754824717782e-01   +4.419889240266965e-01   +1.437036583341118e-01   +4.928540513666833e-01   +1.626522179686601e-02   +3.531204541539228e-01   +3.343132094262366e-01   +7.317567289988515e-01   +2.899751288892692e-01   +2.591600631653743e-01   +3.505250488159686e-02   +4.675531032185192e-01; -7.281402491028953e-02   +1.900494033594676e-01   +1.675809217850390e-01   -5.520286115768115e-02   +2.630357125083613e-01   +3.154117735386819e-01   +2.998756604940345e-01   +3.757048587062831e-01   +2.798479330817818e-01   +3.005410424149759e-02   +3.228322235366687e-01   +1.510328392025543e-01];
L3E_L3I_iGABA_netcon = [+2.707215638739820e-01   +2.533009499433763e-01   +2.630514539312297e-01   +2.595310489553481e-01   +1.258333935366373e-01   +1.926689967791709e-01   +4.649528864650690e-01   +1.362036757279652e-01   -9.404988166436465e-03   +7.366616817010870e-01   +5.191072278067369e-01   +4.860064612280903e-01; +2.319710227167069e-01   +3.511610208044313e-01   +1.437380978655037e-01   -4.898809458775454e-02   +4.552118425102854e-01   +5.579923652020898e-01   +5.052725961098290e-01   +3.510623015274308e-01   +5.238883098259698e-01   +2.413388827726741e-01   +5.861962908300089e-01   +3.974913941059999e-01; +1.973276150923457e-01   +3.306857183459810e-01   +6.846203473303993e-01   +4.497011238750413e-01   +5.344946596169593e-01   +2.434397300214356e-01   +4.836179865966962e-02   +4.733065426610144e-01   +5.705976166955921e-01   +6.810198856383943e-01   +1.852642914123539e-01   +8.013099067753381e-02; +5.307088573476062e-01   +5.609397972278307e-01   +5.944874390327427e-01   +4.071403816398668e-01   +5.307442205667684e-01   +6.268944453234517e-01   +5.110578055630965e-01   +4.179796661689658e-01   +4.208655928735514e-01   +2.199586976248373e-01   +4.691678669379038e-01   +2.826867539406585e-01; +1.026919943894136e-01   +4.752909615383559e-01   +5.136985960403150e-01   +1.910003831519370e-01   +1.194326279153119e-01   +6.104771558512428e-01   +7.394953282267624e-02   +4.781025909022336e-01   +1.092900341222009e-01   +4.948245952728310e-01   +6.183031014679223e-01   +1.039183342234948e-01; +2.711764396399099e-01   +6.856920928614799e-02   +7.320868738637342e-01   +6.060959649697499e-01   +4.736719842983312e-01   +8.050450127198011e-02   +9.255704612697956e-02   +5.033817213417793e-01   +3.281540995953277e-01   +1.000651288746381e-01   +1.144267547712013e-01   +1.216762500722444e-01; +6.851770280936316e-01   +1.705215030357211e-01   +7.059544035399521e-01   +1.452345548079765e-01   +4.158710974740228e-01   +2.318635658554212e-02   +4.266012482668137e-01   +1.651223243280749e-01   +2.582336281007463e-02   +3.087793438320541e-01   +2.633347632373170e-01   +3.641280998888338e-01; +4.486979827310077e-01   +1.350608320208972e-01   +2.032616475090505e-01   +4.304899525397003e-02   +1.437587593709581e-01   +7.044915831778334e-01   +2.264047545777061e-01   +5.271423668527347e-01   +2.071466662632668e-01   +6.849605835578375e-01   +5.060125710634182e-01   +2.626038191542306e-01; +2.092992023075110e-01   +7.485215875333080e-01   +3.088727537415237e-01   +5.400748327873616e-01   +1.544215788161074e-01   +2.174661322053420e-01   +1.548967854928192e-01   +1.076173853257095e-01   +4.006899864797891e-01   +5.615388249152431e-01   +3.851341982937186e-01   +1.898937233858246e-01; +3.505941038950264e-01   +6.015294347324919e-01   +2.000771145438651e-01   +7.858123786323179e-02   +1.225745452095642e-01   +1.802677921001085e-01   +2.376338789200979e-01   +1.170311779205834e-01   +3.511354665046116e-01   +2.984117850435430e-01   +3.317303472299804e-01   +6.558663497604936e-01; +5.503074518876098e-01   +6.547857501194384e-01   +4.405593979760828e-01   +3.861876057458167e-01   +2.917445008399976e-01   -5.724816357967275e-03   +3.662375627835349e-01   +1.429697530387679e-01   +1.820983836049842e-01   +9.416008914918311e-02   +6.245079183947455e-01   +2.229086649955612e-01; +8.558027124775491e-02   +4.717666510545502e-01   +4.445580518225015e-01   +3.874898418954009e-01   +5.205565714145158e-01   +5.276019680742612e-01   +1.170444222899221e-01   +1.616915670157172e-01   +4.460739853495954e-01   +4.805085289670090e-01   +1.134383596519234e-01   +1.681517535715380e-02];
L2E_Input1_iAMPA_netcon = [+4.971389645649786e-01   +8.951009786436627e-02   +1.740837180437755e-01   +4.581947840584197e-01   +1.677027434399648e-01   +4.740194733063354e-01   +2.682666483577174e-02   -1.207596181062707e-01];
L2I_Input2_iAMPA_netcon = [+3.962984219708781e-01   +3.044181861585466e-01   +6.768054508955170e-01   +5.126316809073071e-03   +5.177837541252118e-01   +4.304748146773518e-01   +6.023425242921030e-01   +3.766657456637038e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
