function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.310547408826580e-03   +1.125864073585722e-01   -1.113686188847287e-01   -8.341451108168532e-02   +5.432202408551620e-01   +2.315261593210111e-01   +2.302407460330513e-01   +4.421273240203472e-01   +9.073295559052084e-02   +2.001053991239419e-02   +1.363900182344994e-02   +3.807256540585745e-01   +3.965500151545736e-01   +1.279883196342382e-01   -1.659462114056662e-01   +3.871775274271687e-01; +1.900947559236511e-01   +3.152680724306982e-01   +7.241294049404557e-01   +4.099474561120000e-01   +1.146750154543475e-01   +5.217918438170673e-01   +6.429642355178110e-01   -2.133109597366473e-02   +2.215406917408866e-01   +3.916604050802669e-01   +3.524262687097823e-01   +3.805270671793307e-01   +9.032820599618815e-02   -3.721898782062294e-02   -3.662845601397879e-02   +5.418420566958986e-01; +4.735368368233307e-01   +6.167149956989529e-01   +7.252026097616228e-01   +3.723467886468842e-01   +6.398013406420402e-01   +5.526584650800201e-01   +3.431698408910320e-01   +1.520245797975517e-01   -1.865828673586372e-01   +5.018793018392174e-01   +4.554236584555217e-01   +6.262274690414156e-01   -3.725243807865014e-03   +2.416793874236043e-01   +5.776192487391124e-01   -2.657836691989277e-01; +2.359790863628518e-01   +2.498039033372389e-01   +2.911943447499608e-01   +7.824009420110670e-01   +2.348357109617285e-01   +4.037973773081403e-01   +2.243360065717520e-01   +1.069741052353921e-01   +3.859108985743163e-01   +2.443285615838112e-01   +4.801560492161780e-01   -1.759442407936447e-01   +6.090869376233281e-01   -7.104615814995831e-02   +3.515195257124670e-01   -5.021672977227791e-02; +5.560523590719085e-01   +5.984365291278598e-01   +2.132394197169490e-01   +2.810823155751208e-03   +5.225476152402875e-01   +1.236757123583253e-01   +2.456691364634215e-01   +2.571228112429476e-01   +9.320587235735265e-01   +4.408326107300448e-02   +6.488851785526779e-01   +3.973737346900065e-01   +2.638820586821511e-01   +3.885836066475783e-01   -1.167793042129789e-01   +3.420022523988984e-01; +2.196838777942019e-01   +5.212294920422961e-01   -1.357921782450807e-01   +5.571180745677065e-01   +2.460805763960377e-01   +1.550431688480971e-01   +3.409311435404409e-01   +5.460243394637634e-01   +1.245413572419151e-01   +1.388877516241440e-01   +1.595172910384135e-02   +2.177414042791800e-01   +1.382432955756148e-01   +2.625553568453350e-01   +2.571190784226828e-01   +2.989535133910772e-01; -1.144877175060392e-01   +1.150151168072734e-01   +4.134900208969722e-01   -9.087683527034282e-02   -4.455901121040398e-02   +4.902868462148174e-01   -7.741000780106183e-02   +4.531228318125684e-01   -8.580509782305873e-02   +2.588321905825109e-01   -2.254657705044507e-01   +5.769599408005031e-01   +6.156730094946590e-01   -5.950863929952685e-02   +3.718940545124909e-02   +3.966533802593363e-01; +1.942110435037878e-01   +5.811704233959658e-03   +3.155206959380010e-02   +8.410187575379452e-03   +3.725287744261528e-01   +5.973050274441156e-02   -8.430486036151567e-02   +4.284712273057393e-01   +4.175929732983209e-02   +8.674736350863309e-01   +2.719579952673823e-02   +3.810899040129428e-01   -2.076031764999321e-01   +1.153915528314016e-01   -1.663204447345092e-01   +1.611606772349283e-01; +2.832935561255494e-01   +5.154417743746492e-01   +1.012042074758265e-01   +8.031868233504424e-02   +1.646285671923639e-01   +7.649292171276098e-01   +3.978916882186374e-01   -3.737511175953288e-02   +1.210233264996859e-01   +3.475528601064406e-01   +5.622135928439258e-01   -6.106004892343327e-02   +4.049985886559911e-01   +3.552157930030888e-01   -1.799506930840644e-01   +4.933399937267681e-01; +4.704226347794337e-01   +2.971542781453480e-01   +8.180210807134017e-02   -6.443683194549443e-02   +3.222419381988907e-01   +4.032970573141261e-01   +2.337704067708574e-01   +1.322549197097863e-01   -1.907470007502653e-01   -2.080079068958126e-01   +4.707459189926795e-01   +4.274675680960161e-01   -5.547521813114806e-02   +7.844501401088191e-01   +4.839471212457200e-01   +5.060105027197781e-01; +2.392919493812437e-02   +2.673012260756048e-01   -5.858823121825099e-02   +5.645414303087075e-02   +3.028084247372820e-01   +3.526934704676873e-01   +7.729894434669596e-02   +6.842060562419221e-01   +2.990335146420663e-01   +1.941044965657209e-02   +4.763630171788824e-03   +1.241035094312174e-01   +2.869914945078439e-01   +4.011913143777425e-01   +1.628358533934111e-01   +1.073213112538481e-01; +4.174782351888970e-01   +1.937870609704705e-01   +1.013019519124946e-01   +1.981791075595100e-01   +5.353350279442608e-01   +4.512928595495097e-01   +2.381107908474506e-01   +4.711891756153107e-01   +1.657027599594590e-01   -2.472404734499348e-04   +3.869932823070565e-01   +4.374635147997989e-01   +1.725716805147511e-01   +3.178716481343281e-01   +8.784882445804986e-01   +7.772714524543708e-01; +2.389202403414830e-01   +1.307767052564777e-01   +7.892231166033562e-01   +5.121006907978320e-01   -1.352302910663424e-01   +1.749231595857965e-01   +6.789359129970053e-01   +1.763952249403598e-01   +8.034665672727719e-01   +8.181474304470837e-02   +1.034815748846057e-02   +3.643835059303102e-01   +1.289547362481037e-01   -9.012233894780636e-02   +4.358643382024424e-01   +2.623897702720288e-01; +6.004752764401389e-01   +2.715115678423203e-01   +3.815977091630577e-01   +2.341539100287675e-02   +4.214420313173283e-01   +5.640330980496302e-01   +1.235973887895315e-01   -7.763377179597797e-02   +4.479889400606891e-01   +4.205000972455720e-01   +1.880055868532685e-01   +4.315852526347225e-01   -1.653805027356153e-02   +6.203225776369315e-02   +4.957667564546496e-01   -6.178786947735554e-02; +8.987721610112243e-04   +7.128257196820190e-01   +5.259058462650442e-01   +5.251414735361054e-02   +8.943362311775585e-02   +3.430554139694452e-01   +5.301293023054464e-01   +1.085725969532336e-01   +2.767572822120051e-01   -7.154015796216519e-02   +1.183368842829738e-02   +5.394016115123218e-01   +3.531919813121440e-01   +5.439297663114359e-01   +2.558244385140864e-01   +7.947042893513742e-02; +7.767109018659805e-01   -1.134340463661392e-01   +2.633628358531811e-01   -2.157071207503247e-01   +5.210855120284703e-02   +3.145502468908973e-02   +8.165782815523366e-01   +2.517166171349366e-01   +5.418261642831801e-01   +2.050855682545811e-01   +3.080881532036758e-01   +2.268321940759099e-01   +5.178941365204677e-01   +4.693792844693599e-02   +5.691566320066104e-01   +7.419340616115970e-01];
L1E_L1I_iGABA_netcon = [+2.457585324254521e-02   +1.230523378496094e-01   +1.835013260417516e-01   +1.973523646175718e-02   -1.629753581214869e-01   +2.677862192814131e-01   +4.641307607566743e-01   +4.678973663734368e-01   +6.682258398201244e-01   +4.224147938807662e-01   +8.238490401700276e-02   -1.212106765877707e-01   +1.964347201368238e-01   +3.068616983534787e-01   +4.537489082154890e-01   +4.531166139128755e-01; +4.461253135062150e-01   +7.410471987371492e-03   +1.093362145565062e-01   -9.619380204645571e-02   -1.039667229641225e-01   +5.220399972863101e-01   +3.708416629356271e-01   -1.265915591809297e-01   +4.479323701289792e-01   +3.689183034484690e-01   +4.393753310842090e-01   +1.876902437496928e-01   +6.281609521473764e-01   +2.388221795139643e-01   +6.446496408040175e-01   +3.472709936288939e-01; -6.610450509364760e-02   +4.476453117756916e-01   +3.266887860054724e-01   +3.393377511136859e-01   +3.177577065067096e-01   +6.911000828381238e-02   +6.978418414801666e-01   +2.198624538796778e-01   -2.407108178782208e-01   +5.217796084121311e-01   +4.997746736668365e-01   +1.013451566574521e-01   +2.154692959424643e-01   +5.729144701730201e-01   +5.335780081870621e-01   +5.026410905363305e-01; +5.524672479147794e-01   +1.164227560029998e-01   +3.740824871827065e-01   +4.894740525069718e-01   -1.169588743877165e-02   +3.341972412508600e-01   +3.003556471927664e-01   +2.412271062983280e-01   -1.959353078837672e-01   +5.505408671193895e-01   +2.352475339450790e-01   +4.075516804418844e-01   +4.562970622803380e-01   +2.466146973181934e-01   +5.034885179690960e-01   +1.620725888170585e-01; +3.211008061518605e-01   +4.171455332961193e-01   +2.055804885889003e-01   +4.952917690746577e-01   +5.619640673843874e-01   +2.931986042760675e-01   -3.950952750327932e-01   +5.895745457941204e-01   -8.878580097245292e-03   +6.851756216042488e-01   +5.620384768467277e-01   +1.301328990102750e-01   +7.724800612871013e-02   +4.222487503792398e-01   +4.086154714345352e-01   +4.436194010774747e-01; +3.007809458258159e-01   +5.505372246541771e-01   +4.074564887694157e-03   +1.378987702057351e-01   +6.675604661835847e-01   +4.948344931205310e-01   +1.411686191638224e-01   +4.926839026486129e-01   +5.390321641685591e-01   +7.766116321642343e-02   +4.526105336248235e-01   +4.280728855559968e-03   -1.655717684157429e-01   +3.384599696267045e-01   -8.824093432110042e-02   +6.413369071264440e-01; -3.901684302960631e-03   +8.611198667042042e-01   +3.159289187536200e-01   +4.392635285815950e-01   +7.210655453031555e-01   +4.565766263766748e-01   +8.444936285473371e-01   -4.067166179867287e-02   +4.838929266198386e-01   +1.275224134795963e-01   -1.373723993049089e-01   +2.310259010200126e-01   +6.870281844483839e-01   +4.306578817656136e-01   +5.041788823768949e-01   +4.269760588835786e-01; +1.594569248747106e-01   -1.316720528289699e-01   +5.967337344925339e-01   +4.180799072663055e-01   +1.649660069479028e-01   +6.012705095998233e-02   +4.565889850525834e-01   +3.440765429270748e-01   +2.119107112623567e-01   +5.317869175044661e-01   -2.057191156364336e-01   +2.454628631307655e-01   +4.537531504790521e-01   +6.712504992274541e-01   +3.117071318154783e-01   +3.005016526747130e-01; +5.398943637743565e-01   +6.145360217054664e-01   -2.738834670557760e-02   +4.232168151558191e-01   -1.734199407651703e-01   +2.157165087623017e-02   +3.830395713367057e-02   +9.094241526892255e-02   -2.682497084265850e-01   +3.789845976952050e-01   +2.778079541668562e-01   +4.648741620770799e-01   +5.577647357814332e-01   +6.292443416648472e-01   +1.628131638488932e-01   +5.502988635219390e-01; -2.118518561621930e-01   +2.856065081048995e-01   +1.477571749489495e-01   -7.714061882829019e-04   -8.579996310121261e-02   +8.426555143056534e-01   +8.467705022431873e-01   +3.240968680025644e-01   +5.233983674945749e-01   +1.730658652159748e-01   +4.443686460341549e-01   +1.917268762008829e-01   +8.730694592510022e-02   -4.010185343365255e-02   +3.285911527128489e-01   +5.942106382644190e-01; +8.383206029051387e-01   +3.016349673201382e-01   +2.055185203535284e-01   +2.296829619673338e-01   +1.373233213620515e-01   +6.841584934764704e-01   +1.743981992639939e-01   -8.258329897008862e-02   +6.700140312349988e-01   +9.091362612897419e-03   +5.504156445309010e-01   +3.194839014868533e-01   -1.245396907506541e-01   +2.597303533901000e-01   +2.968296603412561e-01   +2.762026584460840e-01; +4.344346412029695e-01   -1.478163774076371e-01   +3.614417805509995e-02   +4.391466098055632e-01   +7.436947202633601e-01   +5.444464871199557e-01   +1.201440730195605e-01   +4.754194907557274e-01   +1.671032191812262e-01   +6.672335255856597e-01   +2.278242928248372e-01   +4.669632203258968e-01   +4.259034213055445e-01   +7.925740898973321e-01   +4.985227055292204e-01   +5.749631039916124e-01; +3.998632184945441e-01   -1.706257196490457e-01   +5.905922103249272e-02   +7.513307536587901e-01   +2.908092778986339e-01   +6.506630561134795e-01   +6.945237501075278e-01   -1.864627752098353e-01   +2.717159698513909e-01   -2.344256692537572e-01   +2.278188108983259e-01   +1.613674223528770e-02   -4.279740562984607e-03   +2.548360459347882e-01   +2.521429591195621e-01   +3.163464883390513e-01; +7.418325789611964e-01   +3.979425804489586e-02   +1.648086179837644e-01   +3.949759384329223e-01   +3.602502357334366e-01   +1.254209173542689e-01   +1.845037679353279e-02   +2.015688954828208e-01   +8.036034896395990e-01   -5.947494125848149e-03   +6.836888895043186e-02   +2.707534912486693e-01   +3.153617715948438e-01   +7.110855067461862e-01   +1.960724644277038e-02   +3.721970008943455e-01; +8.444231824645466e-01   +1.842479068147991e-01   +5.846814725460995e-01   +1.890334540921247e-01   -1.138640911639702e-02   -4.114226999348926e-02   +4.193974529049507e-01   -7.099843677418968e-02   -9.113139716956582e-02   +1.323125709377035e-01   +2.848139257467198e-01   +1.970672101653602e-01   +3.899421750307425e-01   +2.579854689310407e-01   +5.186221630642864e-01   +2.695456353395465e-01; +3.673962464802149e-01   +5.591188330991189e-01   +4.394956889305062e-01   +1.990012067284588e-01   -8.649319016852799e-03   +1.587623901933548e-01   +5.325910080113654e-01   +5.233967929682239e-01   -1.565700911819099e-01   +4.740012855887802e-01   +5.751252371522024e-01   +3.604335567961303e-01   +1.439537672923546e-01   +4.255824256801225e-01   +3.925525494759778e-01   +5.558655290919425e-01];
L2I_L1I_iGABA_netcon = [+6.060818718002029e-01   -5.887749018057723e-02   +3.919394346134456e-01   +2.918582789234838e-01   +9.628637439052655e-02   +3.894157722954096e-01   +3.019865636600161e-01   +7.521861406187394e-02; +1.067471176346852e-01   +3.326170683772527e-01   +3.227623302484836e-01   +1.773889791361780e-01   -1.611642978410406e-01   +4.048254474442996e-01   +3.357392847494167e-01   -6.996445220395830e-02; +7.592789737127879e-01   +4.144101843505507e-01   +6.571932254884265e-01   -1.536134710088634e-01   +4.482114977879992e-01   +5.576264694791142e-01   +2.176844835609222e-01   +1.239379762861488e-01; +4.195938283962804e-01   +2.886836450708500e-01   -2.780061395452696e-02   +8.758624330891515e-01   +2.462236914511585e-01   +6.555272803215040e-01   +6.512038060174183e-01   +4.271253975745279e-01; +6.505773460831460e-01   +7.167817372400276e-01   -5.675191746392193e-02   +3.604965069494803e-01   +3.809112812904480e-01   +5.720302416069189e-03   +3.262114639541439e-02   +1.225184620509752e-01; -5.394872085648930e-02   -3.193180297267798e-02   +9.649243970416416e-02   +6.241870672463418e-01   +2.175621924893829e-01   -6.703089950382715e-02   +2.105908901602173e-01   +4.342204494706644e-01; +9.378392114181638e-02   +7.283433148645782e-01   +3.411273100699400e-01   +3.446411776036667e-01   +2.551579292370794e-01   +4.615710718973369e-01   +5.969739927999892e-01   +2.370630598606824e-01; +1.275910215075784e-01   +2.238333471716641e-01   -1.911326126211153e-02   -7.474446829885208e-02   +5.686037647855228e-01   +3.514233202991293e-01   +6.795154426086766e-02   +2.428164327298986e-01; +5.484874371379329e-01   +8.793362837650773e-02   +5.176632061200235e-02   -2.923327972374829e-02   -6.936793637674958e-03   +6.902169338245928e-01   +3.589809051350018e-01   +1.223383779158134e-01; -6.483575818766714e-02   +2.194892486715949e-03   +1.392356404944250e-01   +4.857192814296630e-01   +1.809040226600598e-01   +4.900195013915343e-01   +1.766274685113065e-01   +3.848239262855011e-01; +7.582528675711220e-01   +5.166520466373323e-03   +2.804889835320018e-01   +7.733094659834459e-02   +7.621816742516251e-02   +5.347820464417915e-01   -5.575873966434122e-03   +2.208605300199587e-01; -4.234226904255788e-02   -1.324677252579751e-02   +3.320034858717760e-01   +3.085722302802628e-01   +2.132740379698178e-01   +6.204335469470075e-01   +1.698143133457778e-01   +3.391288409567361e-01; +6.175613663755453e-01   +1.001940960563449e-01   +1.180691941313644e-01   +5.212075685775338e-01   +3.729179611989798e-01   +7.155102685075597e-01   +6.229034682738783e-01   +5.888683945262780e-01; -2.827562786384689e-02   +6.268837267386332e-01   +7.803074742307956e-02   -1.209338736765813e-01   +4.174373136160796e-01   +2.823105433048538e-01   +1.476083377610001e-01   +3.949818441377079e-02; +2.559904094077464e-01   +5.282126912201337e-01   +9.984413229229586e-02   +3.531973454264941e-01   +9.470611246969837e-02   +3.061526846495352e-01   +4.633098356894328e-01   +6.512951255008643e-01; +9.155380090312981e-02   +5.315168083565525e-01   +2.460607370392446e-01   +5.126252110459818e-01   +2.311694753947531e-01   +1.659397416002595e-01   +5.797728462083651e-01   +2.943481944874453e-01];
L1I_L2I_iGABA_netcon = [+9.997219463771956e-02   +9.982025895451360e-02   +5.049253599889212e-01   +4.314357417089643e-01   +1.084063553391180e-01   +3.631659100423436e-01   +3.481993404434965e-01   -3.745151220679735e-01   -1.097286897067572e-01   +1.582856920268333e-01   +1.335539238423473e-01   +1.208176595035699e-01   +4.577092507690195e-01   -5.712161793913467e-02   +1.091444155489067e-01   +5.670607898039025e-01; +4.913609723484605e-01   +2.040969951865682e-01   +3.740199647376395e-01   +3.017037334858629e-01   -1.494449122000236e-01   +1.338924749216064e-01   +3.256490430579803e-01   +8.214691478025411e-01   +2.302138643100749e-01   +5.860391830861978e-01   +3.498522564695797e-01   +4.960828872718203e-01   +2.140574125935333e-01   +2.686840052331527e-01   +1.632797525314720e-01   +2.905809831003965e-01; +7.918950853998370e-01   +5.125624951418128e-01   +5.779461732425030e-01   +2.407777129273899e-01   +6.846220231201090e-01   +2.288732695906573e-01   +2.207503072032540e-01   +2.994982679266882e-01   +2.008227595275318e-01   +6.430607399197267e-01   -1.086541310962057e-01   -2.671137333783040e-01   +2.667452518831203e-01   -1.008982995190736e-01   +7.382962453479075e-01   +4.617434441842856e-01; -1.698856594938736e-02   +7.144635682599468e-01   +1.529382392810844e-01   +4.597643901939646e-01   +2.055837433636276e-01   +5.852858195888172e-01   +3.299627939928114e-01   +4.200009051161907e-01   +4.075958832943101e-01   +6.534278551003052e-01   +2.559881501705688e-01   +3.727092805687529e-01   +7.202197772592176e-01   +5.309709206398179e-01   +4.401719401587753e-01   -2.046243771977307e-01; -2.587888686932606e-01   +5.965767803437291e-02   +6.039792852648891e-01   +2.658695518681863e-01   +7.125107477113871e-02   +1.454786315831803e-01   +3.610064138798185e-01   -3.039176847777804e-02   +1.335826726213513e-01   -7.085642256949340e-02   +7.641696077141047e-01   +3.834312437288654e-01   +2.406824196288666e-01   +8.491724325864710e-01   +5.447685398906037e-01   +4.920938740820797e-01; -7.178632630796564e-02   +2.153087725257522e-01   +7.227625974619708e-01   -2.877935328560984e-01   +6.377561760127840e-01   +1.752885723204487e-01   +6.576910749350426e-01   +2.372106680330134e-01   +5.154803670920114e-01   +3.633002329068105e-02   -1.867482838827055e-02   +5.979560552816990e-01   +6.308679267595140e-01   +3.131131244881671e-01   +6.669195019191557e-03   +3.244649731537828e-01; -1.647724823103826e-01   +6.483311583160014e-01   +8.075933212819492e-02   +5.159385856349250e-01   +4.616412787769085e-01   +5.682819066003262e-01   +1.795496956986672e-01   +1.859347949600364e-01   -1.431608664969727e-01   +3.882441036660092e-01   +2.913000854356962e-01   +8.246209062038781e-02   +3.213188242793921e-01   -1.945598426605172e-01   -1.674457303745548e-02   +3.382929403678045e-01; -2.789681397994536e-02   +6.746609362351882e-01   +8.750040697902715e-02   +8.409065859071567e-01   +3.027968137321089e-01   +3.981905326327517e-01   +2.582929256910256e-01   +3.581810216455495e-01   +3.389247651536614e-01   +3.386559725567180e-01   +5.941282197543121e-01   +4.803187379171065e-01   -2.525836409647854e-01   -2.499553224310979e-01   +9.174752479352790e-01   +9.378277184615529e-02];
L2E_L1E_iAMPA_netcon = [+6.598350431018303e-01   -1.506761456893460e-02   +6.393936368511062e-01   +8.201987243242172e-02   +2.857803114139185e-01   +4.074062784640779e-01   -7.275944923501679e-02   -2.707111911296409e-02; +1.907754192144056e-01   +4.471313647173272e-01   -1.174050344467144e-01   -6.749210501599837e-02   +4.911244638203136e-02   -2.131174250381924e-02   +2.114693768838981e-01   +4.404243819870954e-01; +2.213746656241126e-01   +5.500403788643209e-01   +4.196702346179570e-01   +1.618044566081769e-01   -7.281348689390366e-02   +5.461313424696488e-01   +6.368366265225062e-01   +3.397760555719189e-01; +7.174027179971481e-01   +8.839527148731437e-02   -9.300098424828573e-02   +1.442322878350821e-01   +6.974148023424134e-03   +4.338839033765773e-01   +1.069768688764019e-01   +8.065313833190399e-02; +5.828756029742087e-01   +2.749742599122335e-01   -4.994420045892257e-02   +1.902333862794072e-01   +3.190604568434594e-01   -3.305600155333077e-01   -2.308068872880603e-01   +5.339113884065501e-01; -1.995404211874949e-01   -2.867008540076724e-02   +1.815158245523872e-01   +2.063217822543365e-01   +1.272497599932177e-01   +6.299999076949968e-01   +1.930485296512084e-01   -1.598741210858175e-01; +3.314878671016851e-01   +2.676853315884000e-01   +5.645800977886002e-01   +3.981395634213694e-01   +4.648249852054473e-01   +3.773857791695463e-02   +3.909534076997214e-01   +1.724547905994961e-01; +8.439558087362914e-02   +5.098887976431110e-01   +7.094667332329400e-01   +2.781880902096468e-01   +4.685847187184672e-01   +6.515302008514430e-01   -6.862093357156521e-02   +2.857333488304368e-01; +3.237319576452446e-01   +9.936199965778916e-02   +3.149905738843535e-02   +2.765047897584660e-01   +2.405411749662845e-01   +7.516260182512325e-01   +3.546337516264679e-01   +6.129543053487362e-01; +2.818679490595412e-01   +1.903438517821521e-01   +2.020413674387114e-01   +4.727528787189900e-01   +3.165037151321223e-01   +3.434043548520208e-01   +5.462616856715612e-01   +2.357840592107296e-01; +4.227858404871329e-01   +3.531791896879891e-01   -1.274253581959083e-01   +3.747436823142900e-01   +9.720561834698110e-02   +4.042645723366242e-01   -1.950850276427804e-02   +6.227417751768110e-01; +2.186560640218897e-01   +4.819500712770856e-02   +4.586827588438482e-01   +1.043153537695890e-01   +2.367194956064589e-01   +1.325834057427667e-01   +4.015440622420842e-01   +1.534646360317818e-01; -6.555426296905692e-02   +3.067881668819727e-01   +3.419216096393208e-01   +6.807184897410150e-01   +4.908567280835903e-01   +4.108155975093895e-01   +3.020200481320116e-01   +5.384765125294831e-01; +4.331170694581071e-01   +6.168216187570117e-01   -2.003321706274310e-01   +6.922551102815698e-01   -1.763365847788224e-01   +2.178387753388608e-01   +2.752680107955491e-01   +2.339971134091119e-01; +3.473555988443481e-01   +1.677440312980154e-01   +5.524622008038370e-01   +2.893710566972997e-01   +1.483389728855243e-01   +4.017020564601651e-01   +7.587846598180048e-01   +5.049880364129047e-01; +2.570184237647012e-01   +3.666502783940541e-01   +1.393639100160723e-01   +5.098241813731259e-01   +3.443366885606583e-01   +1.940584221619728e-01   +1.153859862835726e-01   +5.812822900658513e-01];
L1E_L2E_iAMPA_netcon = [+6.792764842452396e-01   +5.493349385578725e-01   +7.249206472386379e-01   +2.222075946968624e-01   +2.422978883391155e-01   +6.473628415766236e-02   +3.240512812206373e-01   +3.024005067406418e-01   -4.387835629806021e-02   +3.638347034913924e-01   +2.212226611446449e-01   +1.563861563071937e-01   +5.055051950389972e-01   +2.479413641406912e-01   -1.918663474301859e-01   -8.443120952385608e-02; +3.330511559920480e-01   +1.912117525901387e-01   +5.118493199336231e-01   +5.630570328931258e-01   +1.688353808643630e-01   +1.547096814134039e-01   +5.738286414700418e-01   -2.776508134518886e-01   +2.666650086600331e-02   +5.261721325938079e-01   +1.529745487342414e-01   +9.560185513929702e-01   +4.224884986022939e-01   +2.342675005916266e-01   +1.654647284618407e-01   -1.114788087316141e-01; -5.288713320351619e-02   +2.046797333858290e-01   +2.762158773668011e-01   +2.185903271402668e-01   +4.692064042559460e-01   +5.620975750147983e-01   +1.518934698448846e-01   +1.455301295524813e-01   +5.425283228559212e-02   +1.454821257103229e-01   +7.533189450384570e-02   +8.179865927130542e-02   +9.294765066695289e-01   +1.017507074393363e-01   +6.514326166222346e-01   +7.561999501565331e-02; +4.972356344984158e-01   +2.849043275582038e-01   +4.755161661374568e-01   +5.465119034094926e-02   -9.191983990897679e-02   +7.181238039178330e-01   +4.159182350997048e-04   +5.234535633887394e-01   +9.953609824561474e-02   +6.066528411040044e-01   +4.856743916960247e-01   +3.768155108422147e-01   +2.083721212609302e-03   +4.771323614210162e-01   +4.110612733825872e-01   +6.279419625958372e-01; +2.239492286058610e-01   +7.920616329545317e-01   +4.793250545759550e-01   +5.461287250288390e-01   +4.265973870999817e-01   +4.561153451652061e-01   +1.034265377963007e-01   +4.311632592265509e-01   +8.209242324897560e-02   +1.553807875768504e-02   +4.135084284151737e-01   +1.624269455817162e-02   -3.782547309418723e-02   +4.037203788844727e-01   +5.229693365971381e-01   +5.376375725731137e-01; +3.346320945544896e-01   +2.221936564911353e-01   +2.535670681157714e-01   +7.276485525781600e-01   +4.360681648672358e-01   +2.264153759905707e-02   +2.357990161171319e-01   +3.388664635721660e-01   +5.864332437918880e-01   +8.557471636688052e-01   +4.548120068398837e-01   -2.776939078741111e-02   +4.023565593568146e-01   +1.573132513471324e-01   +2.180602546375128e-01   +3.511568058349987e-01; +2.021072255039803e-01   +3.012073425018092e-01   +4.738037381483440e-01   +1.363206960047570e-01   -2.735749433284020e-01   +3.776296454540857e-01   +1.209768022462587e-01   +4.530247718689958e-01   +1.231847383596415e-01   +1.122298728082479e-01   -2.518169167233054e-01   +1.138090256389404e-01   +4.198926677216238e-01   +5.106456586970982e-01   +5.006900632003417e-01   +5.099103090327143e-01; +4.782918384012701e-01   -1.675431258194796e-01   +6.068583802453145e-01   +4.058044320285390e-01   +6.181938252969607e-02   +3.665721524203360e-01   +3.543096801531359e-01   +9.396028082100576e-01   +9.437197770302141e-02   +2.351162983890863e-01   +5.682771435816210e-01   +1.201385085694477e-01   +3.319309896632113e-02   +3.575231513315117e-02   -3.082011950467715e-01   +4.128933440035108e-02];
L2I_L2E_iAMPA_netcon = [+1.975847896750756e-01   +2.781067263290053e-01   +5.142166417192249e-01   +4.223009381671591e-01   +9.382334322533143e-01   +5.203484842732686e-01   -3.950276248788883e-01   +5.890199603472421e-01; +4.937136196832623e-01   +5.065630580924489e-01   +3.223953520831889e-01   +2.827730015643275e-01   +2.472089435214648e-01   +1.646572447329552e-01   +4.093352402643705e-02   +4.929371056484047e-01; +2.137662280640040e-01   +2.665687906533870e-01   +2.504615126928058e-01   -1.269756273822983e-01   -9.913010072025649e-02   +2.964562776244707e-01   +7.256558632198953e-01   +4.066991786060726e-01; +2.663243194881884e-01   -5.598194318230792e-02   +4.030527436104773e-01   +4.614057779907029e-01   +5.574691425472907e-01   +2.780086542475717e-01   -2.181294570329469e-02   -7.327112966530776e-02; +2.475003696926685e-01   +6.502137935134591e-01   +1.373022473586850e-01   +4.980095021216734e-01   -3.469778624223815e-02   +4.890567051621548e-01   +3.521638545367546e-01   +8.337047315434096e-01; +1.205119274298456e-01   +2.597256710192570e-01   +6.284224184768302e-01   +4.191384032720280e-01   +9.555906556363292e-02   +4.328847241738449e-01   +5.399517266198096e-01   +4.816707645860964e-01; +1.012039037557000e-01   +1.439164267746142e-01   +3.739642768556069e-01   +6.564891681213281e-02   +6.940547660060846e-01   +2.927341344041164e-01   +3.145883962951168e-02   +3.307310732764004e-01; +2.230816456693069e-01   +5.874383623790982e-01   +2.538960647080830e-01   +2.627613085991735e-01   +7.135551974952761e-01   +4.295294398676076e-01   +2.033096962127645e-01   -8.723784920648819e-02];
L2E_L2I_iGABA_netcon = [+4.559786413540280e-01   +3.938338489093120e-01   +4.470072895765176e-01   +5.647735408549762e-01   +3.109838911650564e-01   +4.844013437256668e-01   +1.903929717684680e-01   +2.682173293943006e-01; +5.166006656037905e-01   +3.258595288520601e-01   +4.568050769858207e-01   +7.125590850866639e-02   +6.254104171893922e-01   -1.669607171307963e-01   +5.010290886352134e-02   +5.367520801183537e-01; +1.048816053018938e-01   +7.261443973425918e-02   -6.587442719950955e-02   +5.218664846386583e-01   +4.874805947374554e-01   +8.786378309518006e-01   +1.283549381742056e-01   +3.542175600796511e-01; +1.810445820715031e-01   -4.970449192163706e-02   +4.463964403087536e-01   +5.339617843352323e-01   +3.132472876169688e-01   +4.729056001065959e-01   +3.681820624679027e-01   +8.249883073564234e-01; +5.154121805159180e-01   -2.337099421932345e-01   +4.305835258234521e-01   +6.869651603892936e-01   +1.082712598348732e-01   +3.114257676828327e-01   +2.848300446190564e-01   +4.940968735010324e-01; +6.460093487933323e-01   +1.263962841068438e-01   +2.148754493504428e-01   +4.494107617726998e-01   +3.276257774853641e-01   +5.567098523076885e-01   +2.126993292400038e-01   +3.720540432230603e-01; +5.647273719692814e-01   +2.774535451337878e-01   +2.041018438606826e-01   +3.713893946091739e-01   +3.892568762517453e-01   +7.024872216651367e-01   -2.314106983837934e-01   +1.258407501033227e-01; +8.115279283237098e-01   +5.188354585093836e-01   +6.427692784226969e-01   +3.970475949072130e-01   +4.267643676279699e-01   +4.546745662705960e-01   +1.396350209439495e-02   +4.697948331452827e-01];
L3E_L2E_iAMPA_netcon = [-8.514496487264321e-02   +9.077908076999402e-03   +3.245786339280496e-01   +1.732246599267750e-01   +3.525425103034956e-01   +6.354070566179938e-01   +2.699839320433710e-01   +8.947799824576022e-01   +4.387215134945693e-01   +2.227717282318546e-01   +2.258827752827129e-01   +6.063275171565459e-01; +5.063671325536853e-01   -1.310331283727497e-01   +4.220335873443442e-01   +7.534551058134793e-01   +2.238522555561163e-02   -1.799229442675622e-02   -1.376675165208020e-01   +2.459363285518721e-01   -3.160740556610250e-02   +3.001877536095405e-01   +1.323950546957974e-01   +2.231315454351579e-01; +5.555289966306676e-02   +1.611191617610128e-01   +2.317343833247438e-01   -2.240227450179708e-01   +1.878686874051813e-01   +3.056878842167193e-01   +7.286176920375232e-01   +4.122332108958188e-01   +1.982842635363522e-02   +7.313230461433741e-02   +4.401108584213435e-01   +1.998971690186176e-01; +4.260405404105184e-01   +1.588575118357892e-01   +6.345748948025766e-01   +2.715337844244156e-01   +1.622662899249570e-01   +4.365825612327447e-01   -2.316170690343270e-01   -4.786169344978319e-02   +6.503470392974434e-01   -9.833489065997032e-02   +4.766413315738312e-01   +7.722574007622360e-01; +3.544904961636122e-01   +4.564125865066646e-01   +3.659284927960992e-01   +2.349313617746020e-02   +4.466842829464118e-01   +2.264041360844938e-01   +2.993776645095934e-01   +3.995603925151737e-01   +1.596390869641559e-01   +6.031655079173938e-01   +1.654481494089404e-01   +3.210488692393443e-01; +1.499945939792717e-01   +5.138086696529459e-03   +4.714349351414006e-01   +5.528032059083725e-01   +1.725439392233014e-01   +7.675639132851600e-01   +3.967664569228427e-01   +2.883913296621946e-01   +9.217157499438601e-02   +5.405969530094956e-01   +1.358464260613782e-01   +1.418475899037940e-01; +9.310533730583735e-01   +1.862924697353059e-01   +2.099662419954592e-01   +4.669680821301726e-01   +3.616359865988096e-01   +4.770834898016264e-01   +6.206098089497190e-01   +7.429472010719254e-01   +2.771926481426460e-01   +3.420892843071427e-01   +2.360649582015544e-01   +1.899050313134871e-01; +1.056454930171639e-01   +2.469787811002980e-01   +5.520683569000426e-01   -1.497160486785585e-01   +2.485526125252923e-01   +2.866504694343603e-01   -7.950713597610669e-02   +2.340724245237778e-01   +1.626777719726323e-01   +5.386824395476041e-01   +5.095640043819250e-02   +6.856740544322981e-01];
L3I_L2I_iGABA_netcon = [+5.788741972105078e-01   +6.821237766531597e-01   +5.246433734210313e-01   +5.062170386625733e-01   -1.569820677313739e-01   +5.752092257449533e-02   +1.172375630498755e-01   +2.045732719968251e-01   +4.210489306835042e-01   +9.574922335596772e-03   +1.299841370952233e-02   +4.653691757766232e-01; +2.533028606266324e-01   +7.316867164583361e-01   +2.562262314062705e-01   +7.944378510358155e-02   -3.924854591458599e-02   +4.697065935286347e-02   +1.533103011839694e-01   +3.360412530318539e-01   +4.880900990228157e-01   +3.784091507281830e-01   +4.595878816289724e-01   +9.518774981731084e-01; +6.685945133695366e-01   -6.056689863938214e-02   +4.942297323700096e-01   +1.020894969251152e-01   +6.429424185816915e-01   +3.587032859344738e-01   +9.964987826280750e-03   +6.617277641796102e-01   +4.269622984723966e-01   -3.874464570127917e-02   +3.741927724768451e-01   +5.985618772178575e-01; +4.963968867620468e-01   +2.669846351307333e-01   +3.456454863108810e-01   +3.662535942438333e-01   +1.609663233584547e-01   +8.579441490197215e-01   +4.031128758465072e-01   +1.385241040508736e-01   +2.020239915906064e-01   +6.060550210997647e-01   +8.085572671133863e-01   +1.921900915758655e-01; +5.202609160010760e-02   +8.005028604950558e-01   +1.683897228002410e-01   -1.796077688271882e-01   +2.923785613090686e-01   -3.041064125967476e-01   +3.646714341283258e-01   +1.146096960976843e-01   +2.901321292024691e-01   +1.278116966058926e-01   +3.717436055721340e-01   +3.033901127562287e-01; +1.918929979544788e-01   +2.328228889420169e-01   +4.369076273824315e-01   +1.575889328886409e-01   +5.380212172751013e-01   +5.058564670175829e-01   +3.738013082861673e-01   +1.257147143256355e-01   +8.423642259061023e-02   +1.159309865702975e-01   +5.558693383232806e-02   +2.582993036998117e-01; +4.233222040942428e-01   +5.180208004953401e-01   +3.399623423137723e-01   +2.888325255743197e-02   +5.465779034132004e-01   +5.600367661324884e-01   +7.025958114289236e-01   +2.033315098348846e-01   +3.726889541242031e-01   +5.846211297964583e-01   -2.055133385626205e-02   +1.113281790292039e-01; +3.360168368755728e-01   +4.616209331753988e-01   +7.312129523711085e-02   +9.685059650488313e-02   +1.760936657282032e-01   +5.956223828123697e-01   +3.670993567013006e-01   +3.528075025001334e-01   +1.815933379597367e-01   +5.362893426840704e-02   +3.593232325896738e-01   +5.305855988939596e-01];
L2E_L3E_iAMPA_netcon = [+1.999567506552914e-01   +1.962678620222936e-01   +7.345772268207292e-01   +2.947225152255615e-01   +4.633715560422572e-01   +3.329932402472259e-01   -1.499044597995228e-01   +1.213988688560496e-01; +1.267268027410410e-01   +6.415294919620791e-01   +3.969049146700392e-01   -1.699459109708225e-01   +1.625435312247781e-01   +2.832488359359006e-02   +1.347583242433626e-01   -2.107434631823224e-03; +3.505464530120568e-01   +7.876351518131594e-02   +1.601029998238335e-01   +8.479318947374683e-01   +8.576264919560700e-02   -4.317992263549630e-02   +4.715389769035738e-03   +1.260170097880569e-01; +5.731968328055721e-01   +4.011320622170871e-01   +2.381230544398588e-01   +3.085509739987383e-01   +1.778254575794560e-01   +6.845298222180316e-01   +6.446795167138588e-01   +1.140893555735304e-01; +6.177026542985826e-01   +3.150812922574969e-01   +6.342836029761478e-01   -2.089513368102305e-01   +1.865186964457871e-01   +7.842467670529654e-01   +4.561824476042208e-01   -8.168527536833291e-02; +4.785666657738348e-01   +3.768973475071118e-01   +8.473896490399216e-01   +6.257728804798074e-01   +4.029591118250907e-01   +8.745733816725307e-02   +5.436824395880015e-02   +5.716562327657397e-01; +3.825794909474427e-01   +2.726162813844685e-01   +2.386061782292477e-01   +5.375263842386837e-01   +4.788776893466790e-01   +2.048926010762889e-01   +2.150242724606843e-01   -2.435051888354147e-01; +1.878677435995304e-01   +3.685377735206753e-01   -8.172607526838301e-02   +6.668280420334930e-01   +4.161948536203173e-01   +2.203388453981696e-01   +2.391838809227200e-01   +6.586560466418115e-01; +1.130450383341265e-01   +9.579075703404979e-02   +5.269432496971558e-01   +9.120723489608273e-01   +1.955174385256897e-01   +3.499011248874776e-01   +4.651764028725323e-01   +5.688593595974318e-01; +4.104623391443784e-01   +4.591164208564421e-01   +2.562624757431113e-01   +4.512657481934035e-01   +1.506984414141133e-01   +4.697076877698386e-01   +3.526663597641227e-01   +2.966565401488262e-01; -2.538097707782157e-01   +5.795509202177441e-01   +1.704289194021583e-01   +8.550052571218762e-01   +1.187591067999785e-01   +3.222277790318913e-01   +4.849214140391750e-01   +1.870862711278451e-01; +3.752503271960958e-01   -2.362597756054696e-02   +1.100561621447903e-01   +3.261359211230772e-01   +3.112351351472675e-01   +3.736458137306710e-01   +5.017370347495194e-01   +1.941913310934753e-01];
L2I_L3I_iGABA_netcon = [+2.474040523348232e-01   +4.139481579774770e-01   +4.805210655335004e-04   +6.911816159319678e-01   +4.600137449109177e-01   +5.935767312697986e-01   +2.541793662718737e-01   -3.415231118126616e-02; -1.578065120881852e-02   +1.066755495527073e-01   -4.028284931277784e-03   -1.178855490962184e-01   +5.348484288607173e-01   +6.238832855599443e-01   +5.844464298000922e-01   -1.011981951504384e-01; +4.308174368164619e-01   -1.617005207191685e-01   +1.308934725912018e-01   +3.664724571423680e-01   +1.346642154999640e-01   +7.147625442779519e-02   +5.814126222214235e-01   +4.823971709181403e-01; +5.878312288353413e-01   +1.691265224421937e-01   +3.925304155947814e-01   +2.508546076211899e-01   +7.338570147295796e-01   +5.226910807017180e-01   +2.594940675855608e-01   +2.495533157344010e-01; +6.060257337154440e-02   +1.454775546322284e-01   -1.893753690072983e-01   +4.764364600008714e-01   -5.720408563757519e-02   -6.091683412587896e-02   +3.473422966232670e-01   -9.834693644694636e-03; +4.400308824557276e-01   +3.487948023894187e-01   +1.576576513991836e-01   -8.298002664240511e-02   +4.456934825794334e-02   +4.190469931329405e-01   +3.251441443341587e-01   +1.164203852714655e-01; +6.520615715536479e-02   +3.285007584730914e-01   +1.851380744450883e-01   +3.260820518215400e-01   -2.843658012400391e-01   +2.829820877879773e-01   +4.889579034900927e-01   +8.326423692809634e-02; +5.792196239533783e-01   +3.934758599202146e-02   +2.964326371799020e-01   +7.890102445445279e-02   +2.434215775096629e-01   +4.674649116844524e-01   +1.326494302588214e-01   +4.771735827369019e-01; +1.457041773186269e-01   +6.625178593695291e-01   -7.504239439415489e-02   -7.509881292089482e-02   +3.282054960359588e-01   +2.706507957690049e-01   +5.953638590054490e-01   +1.358143650969339e-01; +3.501998091197885e-01   +3.793487816254374e-01   -1.997969985080517e-02   +4.911999944412784e-01   +5.257440599236476e-01   +1.543116268503736e-01   +1.747069856422135e-01   +6.052106498509009e-01; +1.618482642422035e-01   +7.061836896219229e-01   +2.986136429331638e-01   +1.098359720094688e-01   -8.658532008213732e-02   -2.791242927337604e-01   +5.640577197089853e-01   +2.722975120816111e-01; +1.420131954884293e-01   +2.223402308194962e-01   +4.784106226582894e-01   +4.010726805208294e-01   -2.457948489974634e-01   +1.732574203797740e-01   +5.653949689432733e-01   -1.225425857451615e-01];
L3I_L3E_iAMPA_netcon = [+1.395541883221201e-01   -3.129128048775168e-01   -1.445646176669721e-01   +3.971174305654151e-01   +6.236391442635975e-02   +2.597150920432713e-01   +2.166914135827984e-01   +2.792553650351939e-01   -1.323334750096609e-01   +1.789602134484047e-01   -1.802457185317272e-01   +2.252703484013948e-01; +2.133877223936963e-01   +3.307833601756301e-02   +1.059338845544323e-01   -1.904229719595117e-02   +5.381147493069994e-01   -1.635734943505618e-02   +3.771120627642773e-01   +3.462815924047039e-01   +5.189003307426784e-01   +3.644654613174590e-01   -2.511234202741974e-01   +4.118375668158410e-01; +7.237452762962676e-01   +5.520884197792901e-02   -1.192371800381657e-01   +6.708409429866372e-02   +2.974286654335554e-01   +4.531572575647005e-01   +2.935844870273159e-01   +4.814445556521116e-01   +2.314800080878903e-01   +3.299832169821467e-01   +5.636911612616167e-01   +2.302454971971591e-01; +1.478116839137270e-01   +5.582358642900517e-01   +5.923988192519236e-01   +3.866026845937046e-02   +2.384083886276587e-02   +2.718831181218587e-01   -1.843081291384049e-01   +4.274917404527887e-01   +2.931558109146665e-01   +2.982078719186008e-01   +4.230596233616681e-01   +7.481480791191991e-02; +9.145742042553374e-01   +3.686231799847126e-01   +7.063237414661421e-01   +1.106404594661516e-02   +6.497751399993095e-01   +3.037431667218252e-02   +6.762569932627921e-01   +3.600612206747291e-01   +6.007807472012245e-01   -1.750018149721269e-01   +4.097672662828723e-01   -1.892146028413765e-01; +2.355156554010600e-01   +1.165974836804558e-01   +5.870602276556377e-01   -3.612559940922973e-02   +4.675703038220413e-01   +9.412702870396583e-03   +3.464732038229416e-01   +1.617394866351457e-01   +7.295762973040558e-01   +2.355398849011125e-01   -1.788743436063246e-02   +3.390952499281426e-01; +3.522680276163889e-01   +4.615077109286132e-01   +6.334114006827819e-01   +7.128730247106015e-02   -1.047746694709856e-01   +4.351220608886300e-02   +7.326305607226644e-01   +4.593174601784289e-02   +3.966886145391784e-01   +6.844045250528241e-01   +3.944060229668485e-01   +4.106093743145183e-01; +3.564095935859465e-02   +4.331403903238437e-01   +2.418289490138970e-01   +1.273385511681352e-01   +4.036064686936750e-01   +1.703089287850098e-01   +6.485359943711427e-01   +7.463679622990421e-01   +3.367243733148474e-01   +4.058286027077675e-01   +3.024281776595423e-01   +5.751404079724399e-01; +1.845570068303066e-01   -3.043324606914311e-02   +1.223780532434845e-01   +6.863157698604332e-01   +1.941959546196345e-01   +3.849022989005669e-01   +5.299946398011387e-01   +8.434718495617470e-01   +3.828522566122861e-01   +3.279007913353870e-01   +2.903903880627324e-01   +2.204967085444731e-01; +4.837877156460176e-01   -1.332523833506337e-01   -1.192052533983323e-01   -1.089091549033802e-01   +3.854309978215223e-01   +6.326778832619946e-01   +7.290405756440417e-01   +2.630071249631351e-01   +3.244966467333414e-01   +2.088438702359099e-01   +4.323757540332337e-01   +1.638491570530503e-01; +1.398814123875543e-01   +4.042232308381936e-01   +9.742171302539260e-02   +3.746701533103136e-01   +1.598337224557315e-02   +3.081375330193070e-01   +1.667483306470637e-01   +1.232140288599357e-02   +4.634030285391605e-01   +3.955794278738972e-01   +1.878579242759537e-01   +4.349930498881639e-01; -9.821610575104668e-02   +1.014840068854212e-01   +3.850178643268629e-01   +1.929447372017907e-01   +7.742850221134634e-01   +2.662349774635684e-01   +6.048516717246604e-01   +5.769817589334393e-01   +3.490057583722033e-01   +2.789493792111956e-02   +3.724090916977771e-01   +4.282081558532611e-01];
L3E_L3I_iGABA_netcon = [+2.746749363537637e-01   +8.271234742716105e-01   +5.417700298455314e-01   +3.300169057523761e-01   -1.522556391564740e-02   +6.649056110599653e-01   +2.800394860125165e-01   +9.310997398134453e-01   +3.313335891693766e-01   +1.723088373817994e-01   +1.275060395471641e-01   +7.091841410032181e-01; +4.373759408950641e-01   +3.562421254094552e-01   +3.341304121051727e-01   +4.754579285542905e-01   +2.799960978915793e-01   +2.469141810981395e-01   +6.757288469746006e-03   +2.104746419626845e-01   +5.450620857676870e-01   +3.327245515610004e-01   +2.418546062820382e-01   +7.565076084489758e-01; +4.676357727609647e-01   +3.324375217905224e-01   +2.296147693496853e-01   +8.656362522533942e-02   +5.336420357830242e-01   +7.015951660867619e-01   +2.934761571247547e-02   +1.642152405632187e-01   -1.985105650730773e-01   +4.298617988937496e-01   +1.578457677449531e-01   +2.831207645564847e-01; -2.383879524609142e-02   +2.069162881774008e-01   +4.122261469398011e-01   +6.236521880472787e-02   -3.946770942504371e-02   +2.426265092870705e-01   +4.438619944322830e-01   +2.047418286263239e-01   +3.365822312821654e-01   -2.115339241893437e-01   +5.287946098260520e-01   +2.741773900188652e-01; +6.555903481107744e-02   +2.408404940097963e-02   -4.616846564391443e-02   -1.766929460608238e-01   +1.680327530268449e-01   -5.356469866999021e-02   +1.517137978155115e-01   +5.039741418313027e-01   +2.201227324139543e-01   +3.060574795888072e-01   -8.969941739298735e-02   +1.723485031326581e-01; +5.105135912189851e-02   +5.632475936121639e-01   +7.444748971835662e-01   +3.143627359075720e-01   +3.764080501741897e-01   +5.157097344030352e-01   +2.445082579595460e-01   -1.511992983911495e-01   -1.850377878350137e-02   +2.600787829507608e-01   +1.350658400166304e-01   +2.936900768655122e-01; +1.920552172662523e-01   +2.266529541034880e-01   +4.764878345747047e-01   +3.332158429835880e-01   +3.891657452679257e-01   +4.375399229169351e-02   +5.292013970311308e-02   +1.897854796454740e-01   +3.809620705217046e-01   +2.888618239339736e-01   +7.366891774391047e-01   +2.683453056206215e-01; +1.141539292985772e-01   +1.534399071005614e-01   +4.969658726653577e-01   +5.521448701883690e-01   +1.032277590052980e-01   -1.206399087291588e-01   +9.698334094148493e-02   +4.815355172444192e-01   +1.228047885939446e-01   +9.424325677880928e-02   +5.207157179986317e-01   +5.497602722011612e-01; +3.107775094148876e-02   +1.309898025322526e-01   +1.586359963962951e-01   +4.183393005181855e-01   +4.877101967580816e-03   +2.174540631159946e-01   -8.140957995396353e-03   -2.110944408510861e-03   +1.353720320660672e-01   +1.798762284510517e-01   +3.275974970921999e-01   +6.233287981047640e-01; +5.593638306106146e-01   +9.999193136726733e-02   +4.261386341136671e-01   +3.660289792425559e-01   +6.870907022552880e-02   +4.632931163771105e-01   -1.965343002012457e-01   +6.252488870005660e-02   +3.592444529232373e-01   +3.238735092943078e-01   +2.373072028266684e-01   +4.864095514976135e-01; +4.662002058956162e-01   +1.127819110124473e-01   +1.252067761776124e-01   +3.529984931054270e-01   +2.031157951951309e-01   +9.454415353288431e-01   +3.365221427817315e-01   +1.048825103629177e-01   +2.044459287435305e-01   +8.515116458047282e-02   +1.369622374427973e-01   -1.780061410150747e-01; +1.086092455623275e-02   +4.073070746181535e-01   +2.917313655971465e-01   +1.560623465888392e-01   +5.654267456333654e-01   +1.293942782307562e-01   +3.590256957560089e-01   +2.151768100962440e-01   +4.557588608280271e-01   +7.111806151187732e-01   +3.452776490030258e-01   +6.039723661228527e-01];
L2E_Input1_iAMPA_netcon = [+8.549900263816590e-02   +3.221668672664155e-01   +1.512086830808990e-01   +3.042262278470239e-01   +3.767432446225635e-01   +5.358218638875458e-01   +3.549543939654812e-01   +2.294019948681521e-01];
L2I_Input2_iAMPA_netcon = [+5.677972954836455e-01   +3.822022781635922e-01   +3.892015908731167e-01   +5.071965451816955e-01   +3.288817049292733e-01   +6.316622030492097e-01   +1.847130954276800e-01   +9.834402067388299e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
