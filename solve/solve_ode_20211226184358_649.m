function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-4.042757354336682e-01   +5.827349079958684e-01   +3.263511295020623e-01   +8.394601955838591e-01   -2.381742432122565e-01   +1.982450790437750e-01   +2.689208810570662e-02   +5.524052183360745e-01   -6.693002993427506e-01   -7.182366817868771e-01   +4.412710461161720e-01   +6.364875646098108e-01   +4.948031574924416e-01   -8.163437330316307e-02   -3.719907304619320e-02   -8.043921208621210e-02; -2.290822786422779e-01   +6.839784203341622e-01   +4.038874596199862e-01   +5.343867903537350e-03   -2.401857503531284e-01   -4.749209413365207e-02   -7.881988525913337e-01   -2.479487001319121e-01   -2.406795134985885e-01   -1.681403635545093e-01   +1.383324120711874e-01   -6.349829707817639e-01   +2.215975198459736e-01   -3.193669946940118e-01   -3.875043140491345e-01   -5.823285218377402e-01; +2.524033719219604e-01   -2.607453330172484e-01   -6.134385645512360e-01   -3.877874056491086e-01   +9.678808115046814e-02   +8.529136069317403e-01   +6.094532027529566e-01   -3.196945287460033e-01   -2.454698982278343e-01   -7.095913653222703e-01   -5.682112265496410e-01   -5.989865494820924e-01   +6.126798387835432e-01   -7.472238827123451e-01   -4.790896969449775e-01   -7.965521708605026e-01; +3.660730444408196e-01   +2.109268517495409e-01   +5.692270415671192e-01   +4.384631805902314e-01   +2.246625614868970e-01   +7.408372889877891e-01   -6.049993479970818e-02   +3.852570686300831e-01   -2.121328514278450e-01   +5.604119911303992e-01   -7.997671492426287e-01   -4.548572007912651e-01   +2.916252731005709e-01   +1.489774584887507e-01   -2.462378106164878e-01   -4.745360304540607e-01; +4.093522375115046e-01   +3.493792243720333e-02   +1.759407733342341e-02   +5.659888499849266e-01   +7.439401408705912e-02   +9.094135522594601e-02   -3.980230291689394e-02   -2.227072571333641e-01   -3.029772509512724e-01   -1.253827671119656e-02   +4.458117395712431e-01   +4.958725703415356e-01   +3.428575732814047e-01   -6.180677942124828e-01   +3.684034674643936e-01   +4.071027505583411e-01; +3.203419377687931e-01   -9.571323028921368e-01   +9.819122933599661e-01   +1.440895626749015e-01   +4.960987505583951e-01   +1.429204560306225e-01   +1.717349072581893e-02   -8.052003513747816e-02   -4.929986512843837e-01   +3.807943212132381e-01   -1.510562935842184e-01   -2.348308820745752e-01   +6.762455245531569e-01   +4.662577161311966e-01   -3.038482237592435e-01   +1.211481895813621e-01; -3.033241458928487e-01   +3.474737287376495e-01   -6.262036097386406e-01   +2.899135756665592e-01   -3.900472511603233e-02   +1.850762357049998e-01   +1.762615919008144e-01   +7.345123004292128e-01   -4.641375931782864e-02   -6.917521721685431e-01   -1.214782087978527e-01   -3.427404382761527e-01   -2.704214748422697e-01   +6.754099575793175e-01   +1.683308918021102e-01   -1.308811132879187e-01; +3.737552985576257e-01   -3.924561834009240e-02   +8.577314070814697e-01   +5.619386052825944e-01   -7.188092862465394e-01   +4.137610698095612e-01   +1.860432230487813e-01   -6.799558758276486e-01   -6.649234356528065e-01   -1.398269796753673e-01   +2.292131127745485e-01   +6.098175266854852e-01   +1.875732264122033e-02   +3.804152594693543e-01   -4.401200350967749e-01   -4.896129074488331e-01; -2.147190097416497e-01   -6.561454535631900e-01   -3.019360077707970e-01   -2.026139855245203e-01   -5.630560268960294e-01   -4.385552079779249e-02   +5.524370631422738e-01   -2.342295639525363e-01   +7.136978201297229e-01   -4.074818144085995e-02   -2.539064499275165e-01   -2.468267589939113e-01   -1.143922751584403e-01   +7.161819194693286e-01   -7.980128841654551e-01   +7.855675421575700e-01; -7.682202425115631e-02   +3.226277206454086e-01   +3.285645765800977e-01   -5.713306175712987e-01   -1.350336973608941e-01   +2.734565885599751e-02   -4.487059090498946e-01   +2.421738247362600e-01   +1.507444459122482e-01   -4.321836355116634e-01   +6.064011646488197e-01   -4.408606950461985e-01   -1.782102907300455e-01   +3.088572684111386e-02   -1.798519322203158e-01   -1.118155085365989e-01; -5.313085050129579e-01   -2.659281841613639e-01   -9.378400096236960e-01   -5.633126361646686e-02   +2.328743012367349e-01   +2.030716061233380e-02   -7.892138288201063e-01   -1.881934154923548e-01   -1.359153455811280e-01   -5.167698030834510e-01   -4.612374303552787e-01   +5.740873475555265e-01   -6.106595814378774e-01   +3.778273656072496e-01   +5.699091166588798e-01   +2.028366771658739e-02; -3.887023913300282e-01   +4.993285568973213e-02   +6.294636575932477e-01   +9.269250365566828e-02   -1.864942788688648e-01   +7.947220262449651e-01   +5.485215572677384e-01   +5.529627837979648e-01   -3.328166663069280e-02   -4.908883484002005e-01   +6.906690911128057e-03   +6.093059201225594e-01   +6.711286026197293e-01   +1.033836193649608e-01   -5.611503035037507e-01   +3.886334128459178e-01; +6.009749954987095e-01   -2.417632442638262e-02   -3.520471765136860e-01   -5.730256544362289e-03   -1.795722699436408e-01   +6.078395659312080e-01   -1.000000000000000e+00   -3.398662879464854e-01   -2.234478431122043e-01   -1.021792675858487e-01   +6.647375131819396e-01   -4.963625781512951e-01   +6.028633792858408e-01   +4.568951477226791e-01   -7.916690354900392e-02   +4.562311900304239e-01; -2.574332041280501e-01   +6.683760247660180e-01   +3.053886601735451e-01   +1.687306423569187e-01   -7.673020415224810e-01   +3.301425467671799e-01   +5.104696911027985e-01   -1.825518406225105e-01   -6.482880775611186e-02   -6.180953333949684e-01   +1.391298476524465e-01   +6.589836921889689e-02   +1.522315402600694e-01   +4.374373563367131e-01   +5.799538898480908e-01   +6.478989522283488e-01; +5.825353080532866e-01   -2.308436610993462e-01   +1.915633482624083e-01   +6.482686441528387e-01   +5.484601637703190e-01   -4.396959084262016e-01   +3.274590564866761e-02   +7.582108804718375e-01   -8.566725929322314e-01   +1.016774087708703e-01   +2.035798326677588e-01   -5.413600971627345e-01   +2.269250193555616e-01   -1.883358255946751e-01   -3.002220809401276e-01   -2.319835283214169e-01; -3.150660667200554e-01   +1.679578226870174e-01   -1.320240812655134e-01   +2.168080736899057e-01   +2.408462230255703e-01   +3.753175896823123e-01   +1.349391729157578e-01   +5.346777115842484e-01   -2.021975614434772e-01   +9.493069280843548e-02   -8.236449427737481e-01   -5.903501706643254e-02   +4.344541685550590e-01   -9.764864691455731e-01   +1.353020091159365e-01   +2.693705652422563e-01];
L1E_L1I_iGABA_netcon = [+6.240608969826031e-01   -1.728316341626728e-02   +6.394300205454384e-01   -3.411924088688106e-01   -3.088139837021265e-01   +9.449186235939511e-02   -2.997439274917931e-01   +8.667714085479089e-01   -2.113402884809001e-01   -4.815996584343330e-01   -6.862175886605880e-01   +7.761957340694284e-01   +2.760565230788866e-01   +5.146376946861680e-01   +3.984229976341286e-01   +2.972328075984839e-01; -1.078064014199972e-01   +4.602738210217007e-01   -3.818632041450442e-01   -1.176771051742665e-01   +4.114648555376257e-01   -9.503770526222647e-01   +9.902940471267301e-02   +2.805433990831221e-01   -2.290676291917420e-01   +3.589679314467413e-01   -4.215339743096450e-01   +7.731957782090755e-01   -4.700325604132596e-01   +1.191622437869251e-01   +8.360518187925821e-01   -6.059555058815690e-01; +8.211302597520612e-01   -2.362471715432195e-01   +8.169350795735130e-01   -4.357825035346212e-01   +2.673045413119223e-02   +3.857430775743841e-01   -6.865979896049760e-01   -1.000000000000000e+00   +8.628937882320834e-01   -2.208274542198570e-01   -8.204228069077448e-01   +5.508518958352324e-01   +7.340549071261225e-01   +1.408218027874582e-01   +9.708165589956577e-02   -2.791923412227102e-01; -4.347638794104008e-01   -2.364798584553134e-01   -4.002079491215993e-01   -3.637081682278152e-01   -3.987706775769432e-01   +4.119970026225574e-01   -2.447718893329829e-01   -3.297934780457600e-01   +2.145223568458913e-02   +5.878798442970209e-01   +1.098459801531414e-01   +6.000711434752015e-01   +1.376948181840274e-01   -5.234333986725078e-02   +3.180937618532345e-01   +1.471314532215145e-01; -5.411469090127596e-01   -2.381763245514210e-01   -6.645270665747344e-02   -7.078216570364505e-02   +2.521259832128738e-01   +1.155198454945579e-01   +2.013598024488988e-01   -5.038971797507594e-01   -1.632923979647944e-01   -5.846864104995063e-01   +1.170646449221888e-01   -2.295386389401645e-01   +2.171923621913688e-01   -7.141094059369070e-01   +4.873175141886517e-01   -7.228214372547044e-01; +9.256876735100240e-01   +2.445516812030370e-01   +3.454124841548192e-01   +4.040945066109917e-01   -8.252508735293849e-01   +6.677592793262965e-01   +4.378367926116433e-01   +1.597512691121260e-01   +3.075186474297758e-01   +5.727823474650290e-01   -3.395168841046534e-01   +1.501421973559749e-01   -4.461916308972222e-01   -1.486262607511933e-01   -7.611343765835891e-01   +8.337546135257035e-02; +4.725690241478998e-01   +5.495585118170243e-01   +8.032525479504515e-02   -1.880163558189718e-01   -2.693461906779643e-01   -3.570580585147923e-01   -1.301644760460831e-01   -1.556126683206014e-01   -1.857616589518751e-01   +7.452526382715258e-01   +9.784105889875184e-01   -8.560441073339530e-01   -4.583272197093730e-01   +8.660440371084924e-01   -7.552447749718650e-01   +2.391297313248197e-01; +2.637987963423632e-01   -8.164832730193027e-02   -4.831914185035904e-01   +4.866445489339113e-01   -3.815637656515996e-01   +3.514774984217121e-01   +1.877644803214288e-01   -1.131643416172949e-01   +5.758199758632873e-01   +3.687888187776246e-01   -5.811183413161523e-01   +1.139361910333436e-01   +1.294603410601717e-01   -2.131647746982074e-01   +7.254775355952410e-01   -7.128479873052620e-01; +1.528604013329394e-01   +9.134659392869040e-01   +6.480422371099889e-01   +1.571612192004554e-01   -1.395274632908821e-01   -2.005169446350582e-01   -7.341565133124912e-02   +3.912077512281296e-02   -7.756050307929550e-02   +4.967310089232050e-01   +4.801261330803007e-01   +4.110533100769968e-01   +2.158092207531619e-01   +4.384900854332356e-01   +3.789082502013347e-01   -8.672604646001103e-02; +3.607548602855548e-01   +1.822770313150599e-01   +8.360356939784678e-01   +7.405793087736472e-01   -2.161422624480572e-01   +5.422517850851607e-01   +2.331272872432955e-01   +6.552957193245613e-02   +1.230902738103558e-01   +6.054042969604204e-01   -2.108904959378602e-01   +2.676835383458921e-01   -2.868001599045522e-01   +4.397347743901667e-01   -7.486590723290619e-02   -1.517801782249449e-01; +4.535684756705388e-01   +9.980982535526972e-02   +2.805464738596630e-01   +4.257962101353118e-01   -1.524903400501121e-01   -2.855906610750832e-01   -4.110096038462400e-01   -3.879245812273699e-01   -4.542305068756740e-01   -6.298764659803172e-01   +9.494897277221729e-01   +6.436835395036032e-02   +1.537092280423420e-01   -8.185319325174462e-02   -2.311431297081735e-01   +3.613691455701411e-01; -1.381892592615976e-02   -6.414730706529428e-01   -3.409667226928008e-02   +1.938395244407295e-01   +4.455037067858509e-01   -3.408458024181188e-01   -3.175671152878933e-01   -4.157417951599887e-03   +2.326025531074117e-01   -3.415098449727417e-01   +3.904622447302504e-01   -9.373170004768235e-01   -5.750513607649446e-01   -1.581725557484267e-01   +5.767955508406146e-01   -5.285646250691354e-01; -4.449819514833916e-01   -1.540479491713976e-01   +2.915735589611497e-01   +2.288679354463156e-01   -1.194655410534024e-01   -7.096144392678562e-01   +1.275938492744619e-01   -3.978900816529840e-01   +6.455446020424844e-01   -2.673273971565148e-01   +2.489065911418653e-01   +8.968078207955502e-02   -9.080270403087306e-01   -2.702862513611974e-01   -7.295902754536983e-01   -5.306447494233511e-02; +6.409925074268261e-01   -1.182451765712601e-01   -1.314438680327465e-01   -3.811291868059047e-01   -1.218740247920844e-03   +1.192498742090729e-01   -4.995348095873585e-01   +2.428641778957575e-01   -1.110909636981413e-01   -2.006674649306372e-01   +7.902334798546071e-01   -5.451897188461510e-01   -2.075768320730782e-01   -2.121727518881723e-01   +5.571819737239885e-01   -7.317016821297834e-01; +2.212713689390618e-01   +7.092929327432580e-01   +1.416283435485339e-01   -4.005926522732261e-01   -3.383121565050370e-01   +5.515198187507510e-02   +1.990909629110393e-01   +1.768577178914611e-01   +2.002556146338259e-01   -4.726767253584458e-01   +4.398295098667306e-01   +6.322460923303010e-01   +9.312948125444857e-02   +8.717245239271000e-02   +1.440038700919319e-01   -1.537903574703668e-01; +1.595236472787556e-01   -7.182289024412959e-02   -6.054847564653087e-01   +7.856343313881672e-01   -5.535492798875339e-01   +4.033979087368460e-01   +8.714158370151720e-01   -1.004003333276823e-01   +4.295751873088439e-02   -3.958080967166185e-01   +3.956686491252384e-01   -6.473448634120033e-01   +1.562303354426832e-01   -5.115251516824763e-01   -7.749957251341472e-01   +1.224309457789443e-02];
L2I_L1I_iGABA_netcon = [+2.924594696305446e-01   -1.000000000000000e+00   -2.918264199495151e-02   -9.026603908272265e-02   +7.037370489907269e-02   -2.062391274061186e-01   +1.759994895344772e-01   -1.825451860306398e-01; -8.723237194477612e-02   +7.042180587619551e-01   +4.917058843243838e-01   +6.350405399789604e-01   +5.945983342613793e-01   -1.826733333444012e-01   +1.414624493909378e-01   +1.053993766418448e-01; +1.396100384908298e-01   +1.794127015102017e-02   -4.176929414988554e-02   -7.270152400669734e-01   +4.713332364975497e-01   -3.659310382295329e-01   +7.582212433108331e-01   -2.865711202159589e-01; +2.490974587265231e-01   -6.801400296319097e-01   -2.440882079150057e-01   +3.615890047708506e-01   +8.166124761638239e-01   -1.929618851498143e-01   -3.156406695369680e-02   +2.383216411045740e-01; +1.558638373712273e-01   -1.643564232198366e-01   +2.132119716398645e-01   -3.926695445980684e-01   -1.465869777670077e-01   +2.031328084608560e-01   -2.455422982290713e-01   +5.101644477574604e-01; +2.697202586232997e-01   -3.063722028489250e-01   -7.129894977095068e-01   +5.197601681498678e-01   +3.286235509937398e-02   +1.707414863425712e-01   -5.718355279645407e-01   -3.409325195135000e-01; -6.116298983721912e-02   -1.301597028303135e-01   -4.464031751274256e-02   +6.897016556666422e-01   -4.848633825837781e-01   +3.819808221967714e-01   -5.067069340150153e-01   -4.889447141097450e-01; -3.004638441219408e-01   -3.429533421711203e-01   -2.798045453144701e-01   +9.122210322428003e-01   -1.457428872582024e-02   -9.080939612102714e-01   -4.105593335477690e-01   +7.527823861253355e-01; +5.056262233843076e-02   -2.672330510868371e-01   +2.846484569332611e-02   -2.973112238291759e-01   -3.193657538270271e-01   -5.673883026094195e-01   -9.384526099718815e-02   +4.559679470325527e-01; -1.260711754102580e-01   -5.283291655663707e-01   -1.234614076820721e-01   -3.887265376195276e-01   -2.764533811544563e-01   -8.717356098120034e-01   +4.850822686396916e-01   +4.655124265050443e-01; +3.902499253326873e-01   +1.761949189404973e-02   -1.125819131926511e-01   +5.531779074672914e-03   -1.507524777776423e-01   -8.430595894457134e-01   +7.084881273577375e-01   +7.317093320445012e-02; +2.917817094037696e-01   +1.305056911457056e-01   +3.822875522127819e-01   -2.552070214077816e-01   -4.357047849729477e-01   -4.072664714407906e-01   -3.721864435923051e-01   -3.277329954845822e-01; +7.198648807203099e-02   +1.892879371915705e-01   -2.975977495399162e-02   -4.305106827715588e-01   +2.159399123380476e-02   +1.264670789393514e-02   -2.846710607355956e-01   +7.418847186588423e-01; -4.373570472815820e-01   +2.699619455178904e-01   -2.840086898618562e-01   +2.054947293235420e-01   -3.124556669040673e-01   -2.566307754322119e-02   -8.668046853262995e-01   +4.676869008625754e-01; -2.739122798154215e-01   -1.492194153723513e-01   -8.388452903616807e-02   +7.503951520465087e-02   +5.988995174481990e-01   +8.943368978918023e-01   +6.185561110431037e-01   +3.473006157173102e-01; -7.942559564739409e-01   +6.180724551624598e-01   -1.567410394657152e-01   -2.189272993652160e-01   -1.276062082971104e-01   -4.999430326369626e-02   -1.957949564579000e-01   +3.181148514731968e-01];
L1I_L2I_iGABA_netcon = [+3.156720288214743e-02   +1.737105930158034e-01   +4.088938270906649e-01   -6.775200650509258e-01   -2.447983538392803e-01   +1.380274296159860e-01   -9.471248883773473e-01   +3.706752116709982e-01   -7.010406496010382e-01   -8.491299071874532e-01   +9.892532905436116e-01   +2.198274621279874e-01   -2.120392174728075e-01   -1.277458147028487e-01   -4.579082707925056e-01   -7.405861392269789e-01; +2.159380158411847e-01   -1.047680380522205e-01   +4.652016506032212e-01   -3.047622892197437e-02   -3.499683756222910e-01   +3.922725117354158e-01   +6.100557724282928e-01   +6.423411068468345e-01   +5.508263732372040e-01   +3.498117572457010e-01   +2.678329562663471e-01   -2.728609538378056e-01   -4.968790022561689e-01   +1.534575117708971e-01   +2.544975230602262e-01   +2.345361626397198e-01; +1.566322821140953e-01   +2.687179466423129e-02   +4.876807834528357e-02   +7.130182869950045e-01   -2.007369077178597e-01   +8.573339531324990e-02   -4.911658538934215e-01   -4.523430956771947e-01   -9.894214548331920e-02   -1.676738508967999e-01   -1.226378716385571e-01   -3.409818583944805e-02   -8.045193031440293e-01   +3.852275479970358e-01   +9.866404492624236e-01   +3.006962122331537e-02; +3.690059236627206e-01   -6.556563316625297e-01   +7.050690447103123e-01   -5.760367780801392e-01   +5.422311516921656e-01   +6.814582937556500e-02   +1.814649058847784e-01   -1.284927922718977e-01   +5.978442267702595e-01   +1.422023696198546e-01   +2.903884525499343e-02   +3.239129302963689e-01   -8.917912634242166e-01   +2.037514496426001e-01   +2.409088140737803e-03   +6.421294471898200e-01; -3.274885375998393e-01   -3.375708156671633e-01   -2.766195641562696e-01   +3.253827370762406e-01   -2.901117863755479e-01   +1.534650344989179e-01   +7.439956794132971e-02   +2.921259499812173e-01   +6.165596090899045e-02   -8.288345302773457e-01   +1.142161995709303e-01   +7.732732907544810e-01   -2.899192513478160e-01   +3.622573976630781e-01   -4.769537992772171e-02   -1.708769816514027e-01; -5.551194406741714e-01   -2.610892608443534e-01   -3.579879371294615e-01   +3.018236046696909e-01   -3.658970365782988e-01   -2.479306791973495e-01   +2.635184381632129e-01   -6.055642405226720e-01   -1.953772380798141e-01   -6.850982043294233e-01   +3.416023617031957e-01   -3.938876583306689e-03   -6.024123806770121e-02   -6.339402512016156e-01   -9.595205842828322e-01   +2.565464205670017e-01; +3.378575046878785e-01   +3.108267311147334e-01   -2.257027996219326e-01   +4.497268470624243e-01   +4.713466283340756e-01   +2.866639288970252e-01   -2.750345394633174e-01   +4.299941295977988e-01   +4.265642377282592e-01   -5.326712208467190e-01   -8.948454654620150e-01   -5.279328822220417e-01   -7.881395737711542e-01   -1.401795264921981e-01   +1.567380900810982e-01   +4.124220771546391e-01; -3.223676701741842e-01   +7.762131076371790e-01   -1.000000000000000e+00   +3.415863536827549e-01   -8.527079320730372e-01   +8.517002252118729e-01   +5.966835906407503e-01   -1.337833052183443e-01   +5.680634839888312e-01   +2.718927095831599e-01   +3.391801060597280e-03   -6.113172826089133e-02   +2.650319501251632e-01   +3.784982108632174e-01   +2.509969844215310e-01   -1.826912524134067e-01];
L2E_L1E_iAMPA_netcon = [+5.324905219050677e-01   +5.528062216511248e-01   +2.251237811841568e-01   -3.034854399137593e-01   +5.561479116635901e-01   +8.065491234609258e-01   -1.012941311359719e-01   -1.939313372606428e-01; +9.084761845369784e-01   -1.958054859327069e-01   -9.456612366507035e-01   -8.349354306903654e-02   +1.633120019566673e-01   +4.088596444855069e-02   +3.367701662561619e-01   -1.166384544728603e-01; -1.720091305904705e-01   +1.979592515008514e-02   +1.954050056230789e-02   +1.097981376245603e-01   +1.881309511097128e-01   -3.558211435116532e-01   +4.158593930651626e-01   +7.205593804309085e-02; -9.484525064129832e-01   +7.552049110428275e-01   -1.544402792712821e-01   -6.206726096995386e-01   +1.253581300068880e-01   +5.096356255730759e-03   -2.951157969985855e-01   -1.920913172932481e-02; -2.813581041500582e-01   +1.448157864008708e-01   -3.464748360575650e-01   -3.531325836786970e-01   -3.874512225893882e-01   -3.787732908965595e-01   -3.153065634409918e-01   -3.943411387728639e-01; +1.618967926708427e-01   -4.704501871476736e-01   -2.467656888060045e-01   -8.573533908562005e-02   +6.779563466904123e-01   +1.390014117638083e-01   -7.394186676319491e-02   +3.281287261294844e-01; +3.319570740111193e-01   +2.089748859143713e-01   +2.892753117878726e-01   +6.619633355504365e-02   -1.000000000000000e+00   +1.400779169847760e-01   -5.513433351302819e-01   -1.558814688890957e-01; +2.163961154994322e-01   -9.001259241214876e-01   -8.541564362949521e-02   +2.802589696379499e-01   -2.586851729579240e-01   +3.228504582484740e-01   +7.799767039325523e-01   -1.800735612186326e-03; -7.349858216787464e-02   +5.452494062275746e-01   +2.241717458286427e-01   +1.812216957180200e-01   -6.256431249265577e-01   -1.868141898497848e-01   +3.228320339218029e-01   -9.826043204227448e-02; -2.783452373667595e-03   -8.226505291092194e-01   +1.704788258219963e-01   -1.720644504853832e-01   +1.150050045015198e-01   -3.170668423988066e-01   +4.596572755929133e-01   -9.294423866747062e-01; +8.553626464395644e-02   -2.467194007251867e-01   -7.094048494246474e-01   -2.909202978531045e-01   +3.940987537950925e-01   -4.281893913153123e-01   -1.677590893952101e-01   +3.183364355978636e-01; -2.672610982374929e-01   +1.735820558546964e-01   -7.281118885955903e-01   -1.753586768467316e-01   +8.315430241177187e-02   +7.695983497816651e-01   -2.309248178784758e-02   -3.503462296783110e-01; +3.466228657781416e-01   +5.596756994483290e-01   +7.659979639520708e-01   -6.539706936186537e-01   -2.600620169302039e-01   +4.714778650191718e-01   +1.139600683464856e-01   -2.926310675267364e-01; -6.703671623912637e-01   +5.698897214762068e-01   +3.293792802003326e-01   -5.114331074591151e-01   -1.451761861666545e-01   -4.783328240182277e-01   +5.353896279229404e-01   -6.971354701653056e-01; -2.696721972301606e-01   -6.956575579412502e-01   -3.079214261430360e-01   +8.104555205388064e-01   +9.195387022895077e-01   +4.314875018959353e-01   +1.221149555053604e-01   -4.321440924134038e-01; -4.058333007724355e-01   +2.795677900204337e-01   +1.743379011754559e-01   -1.001312911328405e-01   +1.374663186952196e-01   +8.161093784042679e-02   -1.702933301066499e-01   +2.837041253099856e-01];
L1E_L2E_iAMPA_netcon = [-8.286588866282019e-02   +1.335744620046751e-01   -3.098911363491684e-01   -2.428610302196199e-01   +2.229361937469274e-01   +7.796983656719612e-01   -1.983678216161384e-01   +3.380701622995522e-01   +5.993154939176411e-01   +4.234176246791925e-01   -6.230184176438135e-01   +6.495703734293612e-01   +3.059936791721757e-01   -1.625563095315273e-01   -6.972393073657379e-01   +5.456779761650551e-01; -3.692301116369218e-01   +6.152111847934445e-02   -3.432933020839193e-02   +7.568996098626452e-02   +4.397490529723247e-01   -6.112333552509631e-01   -1.789646272632345e-02   -6.619755174068930e-01   -4.817370012592930e-01   -2.221808712581910e-01   +1.647749109901262e-02   -1.819812340775897e-01   +2.960796565473852e-01   -1.666417000121106e-01   +1.955815942727635e-01   -6.714900944488654e-01; -2.842548797974689e-01   +1.548851439552577e-01   -7.543630940743519e-03   +4.456041976903393e-01   -1.609535358429120e-01   +3.789901250748484e-01   +4.601006405885809e-01   -7.525200791995035e-02   +2.526941217041402e-01   -5.221862346406246e-01   +2.211864466429421e-01   -4.594860546796978e-02   +9.125702514402116e-01   +3.482085654560970e-01   +5.099330775825008e-01   +4.702816838592960e-01; -3.184986744490862e-01   +1.492537814695372e-01   +8.229377293961323e-01   -8.248132719651199e-02   +7.802481627018014e-01   -5.665794411396420e-01   +6.773215586316789e-01   +1.065809925463593e-01   -1.221133406344430e-01   +2.745946149508350e-01   +3.032245030571953e-01   -9.939839891473307e-01   +2.996529391860089e-01   +2.499634897503411e-02   +2.340164310299472e-01   -8.689373063726724e-01; +1.503825252746342e-01   -2.478780496204931e-01   -6.795469636537655e-01   -4.026080582483881e-01   -2.787581030034924e-01   +5.197720226187545e-01   +2.768627884628437e-01   +4.426407284925248e-01   +5.089942427819131e-01   +2.505331476410603e-01   -8.154760635737804e-02   -3.229906218430980e-01   +2.201924840616842e-01   -5.940009567465504e-01   +7.922712896441506e-01   +3.478813453325698e-01; +4.302853644347657e-03   +4.887223707903735e-02   +8.926251354624720e-03   -7.338469896318833e-01   +9.728116264268426e-02   +3.083579386165777e-02   -2.025476683666020e-01   -4.117577448931480e-02   -6.420776648565888e-01   +5.722084891130683e-01   +6.075086159420098e-01   +3.691926194849687e-02   -5.059088526612263e-01   +9.136094688568938e-01   +6.528072366576230e-01   +6.826741846365476e-01; +4.544865473190915e-01   +5.148324575282470e-01   -1.769368121969792e-01   -8.185198898235728e-02   +6.673916480358322e-01   +8.226132695916728e-02   +2.402134512953908e-01   +1.528898628934321e-01   +3.631075072962804e-01   +3.171291801893481e-01   +1.378005462024113e-01   +2.221604318304659e-01   +1.233006145098430e-01   +7.515694773484562e-01   -6.237688803525044e-01   +7.391765565582784e-01; -8.130707430259010e-02   +6.391051578730620e-01   -5.800837392998619e-02   +4.072193848079715e-01   +6.224987895437408e-01   +4.847388182355698e-01   +5.558048973632257e-02   -1.000000000000000e+00   +1.667240666489458e-01   +1.048078871067411e-01   +1.476758406548372e-01   +6.720168419813304e-01   -4.882590969892299e-01   +3.108084637863010e-01   -5.320376556949613e-01   -1.192857201762797e-01];
L2I_L2E_iAMPA_netcon = [-1.528842480101620e-01   +2.058646778941591e-01   -1.331958846052118e-01   -1.612524885366008e-01   -3.776109682840291e-01   +1.724330703567190e-01   +7.774887915370919e-01   -2.130709198394816e-01; -2.956273325465621e-01   +3.215953522978833e-01   -2.498184001330545e-01   -4.906344443269749e-03   -2.021057672885238e-01   -5.692937594937302e-01   -5.481277430178670e-01   +7.339276018227217e-01; -6.915327254717715e-01   -1.478833362824260e-01   -3.279774390731672e-01   +9.703694297934023e-02   +4.490518010930689e-01   -4.561928871705522e-01   +4.033999384287057e-01   -7.433420719517815e-02; +7.263321868406546e-01   -4.172215028907436e-01   -3.150375431225075e-01   -2.079470525312947e-01   +1.000000000000000e+00   -5.438061084697345e-01   -1.742763109878933e-01   -3.588873853541101e-01; -4.548956061232338e-01   -4.551613659112053e-01   -8.198472549366462e-01   -9.157479529660605e-01   +2.040010034284954e-02   -2.024248378781960e-01   -8.912661352013903e-01   +1.185700157345593e-01; +7.792811380369264e-01   +2.246273899515778e-01   +6.363080017234690e-01   +1.457811413092141e-01   -5.722773583806380e-01   +6.812844186067104e-01   +3.820695769892199e-03   -1.364998536519034e-01; -7.241681063838785e-02   +3.158004197256683e-01   -9.268742650255556e-01   -1.748688078243687e-01   -5.436700106703709e-01   +1.990418036889206e-01   -8.820938727315134e-01   +1.376784516454867e-01; -1.643358341920887e-02   +6.811977876363837e-01   +5.845348211446080e-01   +6.282416227991150e-02   +1.555227451427373e-03   -2.329384354558378e-02   +1.347654736455168e-01   -2.795704589690733e-01];
L2E_L2I_iGABA_netcon = [-9.481215506993346e-01   +4.866508267654128e-01   +1.000000000000000e+00   -4.136722339335600e-01   -7.749483864006414e-02   -3.462532283304290e-01   +3.460145179263144e-02   +2.175198928551232e-01; -2.544281007197221e-01   +4.728299177984753e-01   +5.131270615416180e-01   -4.428394282197400e-02   +6.374989220727760e-01   +4.482769555551263e-01   -3.215248097232853e-01   +1.439523984890647e-01; +2.907119972407063e-01   -4.190090401221044e-01   +7.338930249227830e-01   -2.414211999534704e-01   +3.748653435884035e-01   +3.421580557840513e-01   +6.999266054721203e-01   -9.226085630768795e-02; -2.486097847112426e-01   +1.121740062357206e-01   +1.039753033599353e-01   +5.394670936636068e-01   -1.906982638710818e-01   +1.493341543295038e-01   -5.373539931094118e-01   -4.583039488874500e-01; +3.734819446029799e-01   +3.445512493376106e-01   +1.787719693609229e-01   +9.443416659408291e-02   -7.322933248033092e-01   +4.238825019201900e-01   -1.991455060621144e-01   +4.136952846333844e-01; -4.037267157645913e-01   -8.526502874371567e-01   -2.670959356286579e-01   +2.764571437558124e-02   +3.083064667558075e-01   +4.239636634658792e-01   +5.690849716187357e-01   +2.719192159291139e-01; -2.733979914279664e-01   +4.935821094509924e-01   +2.050956353740116e-01   +5.914287534378314e-01   -4.112839964963925e-01   -3.734474136366157e-01   +8.002477654777265e-02   -1.578434978108965e-01; +6.011224896668954e-01   +1.172555254237497e-02   -1.497596761492347e-01   -4.120411641636422e-01   -4.384535910424918e-01   -3.337084022657473e-01   +8.460584757604274e-01   -3.192338372913474e-01];
L3E_L2E_iAMPA_netcon = [+2.858547009933715e-01   +4.100533980087488e-01   -3.649284765933458e-01   -1.335349508603462e-01   +2.179276939898331e-01   -2.878648138970041e-01   +4.849716010694495e-01   -3.953803297859451e-01   +2.479987568930665e-01   +1.000000000000000e+00   +5.436674418382081e-01   +1.541621129940220e-01; +5.230549280598423e-01   +5.574423755437946e-01   +6.555350392401492e-01   +1.534443079166125e-01   +3.418880154201663e-01   +1.508314916583489e-01   +2.717413272044955e-01   +9.246773876815988e-01   +5.302145460480624e-01   -7.412520858426394e-01   -3.053755082774185e-01   +6.125841928179928e-01; -2.017787060639156e-01   -3.670168825151942e-01   +6.322390603594410e-01   -8.206147601174698e-01   -1.822155417578511e-01   -4.327108665007356e-01   +1.456571556407575e-01   -1.132667209818999e-01   -7.229952176443188e-01   -8.072454549284497e-01   -1.276685528308965e-01   +1.567082132052482e-01; -7.082923928254119e-01   -3.774077238891178e-02   +1.231044445809013e-02   -3.777335877735804e-01   +9.228466536249426e-02   +7.261511851172050e-01   +1.285185112699741e-01   +3.013274500916947e-02   +2.679568040041896e-01   +2.626440460073615e-01   +4.847122190815961e-03   +2.643972018889387e-01; -3.447732210398335e-01   +4.716269032352897e-01   -6.387764319998628e-01   +5.298878985666561e-01   -2.466695438799185e-01   +1.218626508529484e-01   -6.896614324478499e-01   -6.570572459080803e-01   +4.890835787278101e-01   -3.769541238408740e-01   +4.751090246122832e-01   +1.506205197127188e-01; +3.099030252581587e-01   -3.513503434926769e-01   +1.097776995355387e-01   -3.391839977073876e-01   -1.528577561682827e-01   -4.738571905063946e-01   -2.153319803379701e-01   -1.631179566540259e-01   +2.490232455320595e-01   -1.956848949519781e-01   -4.365762887487792e-01   -2.972212906886429e-01; +5.920898985495689e-01   -1.009747025841571e-01   -7.159412314332185e-02   -9.338405027037526e-02   -1.405599503110449e-01   -5.167785093436401e-02   +4.981057243122975e-01   +7.116205292427150e-02   +5.385046946673811e-02   -3.275710356540018e-02   +2.300990143748827e-01   +1.449082417581509e-01; +2.752387355084130e-02   -2.690693036818650e-02   +4.832674897661173e-01   +1.700681798549948e-01   -6.978276728994521e-01   -5.299000034605207e-01   -6.575914412342489e-02   +2.623847676864462e-01   -4.708495919858786e-02   +3.886799010805875e-01   +2.137635036815145e-01   -5.057352117169527e-01];
L3I_L2I_iGABA_netcon = [-1.457025833799341e-02   -2.728952093341171e-01   -7.633561085132731e-02   +1.649392702708182e-01   +8.904500115657743e-01   +2.018154633515518e-01   +2.183124838929456e-01   +4.246683713541224e-01   -1.702256261657796e-01   +4.513535698929907e-01   -2.439506975209474e-01   -2.670315144678140e-01; -3.607222362109125e-01   +2.724567161453569e-01   +4.520943307061555e-01   -1.000000000000000e+00   +3.288035612302153e-01   -2.364730131119493e-01   -5.136013937693961e-01   +3.814354680340558e-01   +5.743553395724719e-01   +7.775527740571647e-02   -5.773474426404493e-01   -2.615762029717464e-01; +1.757356845063814e-02   -3.213251328355314e-01   -4.421228794983283e-01   -6.110730860287085e-01   -1.628914806531238e-01   -3.528254887137914e-01   -8.621102074372979e-01   +1.497752807123264e-01   -4.490382999253376e-01   -4.680389188222848e-01   -6.682516233395340e-01   -5.723933761098778e-01; +2.676963165386566e-01   -1.358328785993975e-01   -1.460620511838989e-01   -2.101862974377386e-01   +7.760603093826153e-01   -2.662232613318357e-01   +2.535368938653246e-01   +4.191883756481012e-01   -4.570787637503964e-01   -6.351977975222081e-02   +4.165328415244192e-01   -8.957338422900053e-02; -2.091795408085805e-01   +7.030604834851610e-02   +5.291324776019496e-01   -2.054661267369499e-01   -5.614450424487593e-02   +6.008089549041545e-01   -1.773408201220598e-02   -2.325840578929776e-01   +8.308407643932482e-01   -3.268382120389919e-01   -2.349595632287530e-01   +2.994498278329897e-01; +8.724875807430112e-02   -4.459095177599806e-01   +3.592411386014914e-01   -5.044379314854879e-01   +1.070290136914292e-01   -2.298739446082317e-02   +3.519057979269938e-01   -4.213821119539574e-01   -4.466030395537570e-01   +6.916459958761892e-01   -4.151261096589614e-01   +1.445442914417562e-02; +8.990450088367223e-01   -5.165607895991382e-03   -7.605182686592761e-01   -6.433119006752104e-01   -4.029587106273878e-01   -3.509418588570120e-01   -1.774020212273107e-01   +4.483404709972951e-01   +7.690902032329218e-01   +2.696115968569254e-01   -2.607029594319537e-01   -6.485033482223236e-02; +3.387462651425760e-02   +4.950141840711064e-01   +5.470165879045073e-02   -3.556381255675027e-01   +6.712797630497245e-01   -3.218662810468109e-02   +4.286225316193747e-01   -3.676173468313691e-01   +1.729972673011146e-02   -6.060680957136467e-01   +2.297955617359484e-01   -5.647359437853599e-01];
L2E_L3E_iAMPA_netcon = [-1.713495734105972e-01   -2.223287718508889e-01   +1.737613312743450e-01   -3.704336963291532e-01   +8.638488032480967e-01   +2.831342312465660e-01   -3.862569347742070e-01   -1.675470894719728e-01; -2.559702549488681e-02   +5.781498270133156e-01   -1.327143515292740e-01   -5.974596164796436e-02   +4.096899218339449e-01   -1.474329360491083e-01   -3.946318689379571e-01   -1.424210849269326e-01; +3.700106641659959e-01   +1.381754997667365e-01   -9.999826451557381e-01   +1.365766175135442e-01   +5.089113407099546e-01   -8.075298380975270e-01   -4.387974748088648e-01   +1.981243103822245e-01; +4.335027156511811e-01   -3.874783839113142e-01   -2.889926688787408e-01   -4.248116470986192e-01   -5.081170276132030e-01   +6.305383750882737e-02   -2.479421046149003e-01   +8.109380608739310e-02; +4.247837993298531e-01   +1.656390998487954e-02   -1.035958597216372e-01   -4.417014966720322e-01   -6.977471219098235e-03   -5.263307280419529e-01   -2.195203321372582e-01   +8.830045899181781e-02; -1.477003048917343e-01   -1.067921982354886e-01   -2.282926399082302e-01   +6.469009688297465e-01   -3.672511272853436e-01   -6.858019489210470e-01   +1.721468807861189e-01   -3.924806631055323e-01; -3.804375916817740e-04   -3.466083539113917e-01   +1.337185322567588e-01   -6.786658523063284e-01   -5.110289026343993e-01   -1.868297424990432e-01   -5.874887293841228e-01   +5.087584814864185e-02; +4.517343031495750e-01   -7.515638916490369e-02   +1.651330749150440e-01   +4.101467605694435e-02   -5.164281058419683e-01   -8.560699827822441e-03   +1.704226345420829e-01   +4.479166246350246e-01; +6.270925303651498e-01   +1.509462148332260e-03   +2.719768850945642e-01   +2.800634539382280e-01   +2.174078957202134e-01   +4.579638966720618e-01   -7.791151161251899e-01   -1.556792026347079e-01; -4.149973930998785e-01   +1.000000000000000e+00   -2.482742211320109e-01   -3.373134226336304e-01   -3.463251719463439e-01   +2.359696054621175e-01   -4.355739394207053e-01   -4.225056887885746e-01; -4.298835554949908e-01   +6.608432529336364e-01   -8.791912450513575e-01   +1.924085233839681e-01   +4.761205149558619e-01   -2.519240908309621e-01   -5.689906446038367e-01   -4.656427161608397e-01; -3.409082483751353e-01   +6.166451151337633e-01   -7.870137593389235e-01   +3.494647038395689e-01   +5.021430275681278e-01   +3.317418761130282e-01   +9.247402769045893e-01   +2.011028666129912e-01];
L2I_L3I_iGABA_netcon = [-1.685230262238233e-01   +5.306163054230708e-01   +9.020614730319130e-01   -1.871159075429967e-01   +8.176658067168829e-02   +2.540089556427491e-01   +6.420480737434110e-01   -4.506453572449325e-01; +8.274115711562716e-02   +6.298787278766687e-01   +1.215456115722899e-01   +3.697054987901144e-01   +8.087157273167052e-02   +5.969137282685139e-01   +4.716056790979980e-01   -4.765673188190113e-01; -2.226527475997866e-01   -8.697295486260346e-01   -3.059759215024851e-01   -1.308764864987607e-01   -3.793476723416451e-01   -1.506211974894105e-01   -5.704608778206610e-01   +1.672959640677669e-01; -4.017030188347194e-01   +9.628167136570230e-01   -1.841163829714184e-01   +1.047023440322610e-01   +1.274664064730170e-01   -2.008446359521357e-01   -7.158835862922823e-01   +5.437645089598560e-01; +2.628794869310259e-01   +1.979100103861262e-02   +5.042271207613339e-01   +2.020121945296844e-01   -2.572866755964559e-01   -4.661622207431154e-01   -7.608271382239347e-01   +1.993421831301280e-01; +5.041427635316561e-01   -3.404826506217689e-01   -8.614584351409983e-01   +2.110631440484400e-01   +4.574560362708783e-01   -6.835246375950230e-01   +1.004956367826289e-01   -6.345379010287777e-01; -9.646640942137036e-02   -4.271395350902615e-02   -2.744198460376289e-01   +1.781007991970186e-01   -3.355248392489027e-01   -4.820791216861889e-01   -6.306799977145519e-01   -7.077862665407190e-01; +9.400694111969161e-04   +1.274660915942802e-01   +1.800075984368715e-01   +7.935093406606888e-01   +7.687332842351289e-01   +9.077282434605623e-02   +9.611950535970603e-01   +5.008328589457740e-01; +4.822721405334656e-01   -1.501232135962664e-01   +7.093733323948491e-01   -2.796863253457019e-01   -4.557038391963342e-02   -2.856075234944809e-01   -3.646169628244987e-01   -3.677769761378592e-01; -4.906099476751638e-01   -1.637159874370583e-01   +7.310409523698563e-02   -2.452594736803114e-01   +1.000000000000000e+00   -5.818348834881220e-01   +1.000959873949035e-01   -4.114853388271453e-01; -7.461359262388416e-01   -3.298050129284629e-01   -5.873413462600178e-01   -5.000383812065984e-01   +1.666639437952359e-01   +5.638117374193710e-02   -4.602241635515604e-01   +8.152787463984050e-01; +3.537236806536759e-01   -2.804426956916949e-01   -4.029921395774740e-01   -5.455163221563637e-01   -4.373337844218694e-01   +4.053338769443777e-01   -9.264959518778451e-01   -1.154950614836057e-01];
L3I_L3E_iAMPA_netcon = [+4.132403513298780e-01   +4.054443120244132e-01   +1.226660417073984e-01   -5.363481645922370e-02   -1.000000000000000e+00   -4.697960708031232e-01   +3.466543312916345e-01   -8.459747481112756e-02   -1.457980834504968e-01   +2.771664093678883e-01   +4.084355378950353e-01   -1.177833797650725e-01; -5.418048705906295e-01   +2.586829174962408e-01   +1.427185439224145e-01   -5.528388408157621e-01   +3.595127876844068e-01   -1.891496787935657e-01   -2.231126762598045e-01   +3.074363722207619e-01   +2.238065535317566e-01   +3.654258726534920e-01   +7.878264661603749e-01   -9.041841660349009e-01; +4.559533422100203e-01   +9.498288117266489e-02   -2.275513552187917e-01   +4.692896848069004e-01   +2.263916153500920e-01   +3.967741792407437e-01   +5.355758069161778e-01   -8.170331225927661e-01   -4.739938588335407e-01   -1.389272101980893e-01   -6.697237553379030e-01   +4.749213864954680e-01; -7.161058256506491e-01   +3.064642588079141e-01   +4.856199377015158e-01   +5.879586370698073e-01   +3.354813943030879e-01   +1.960004214832018e-01   -3.497568175314905e-01   +6.772547817441940e-01   +4.188090851928434e-01   -3.781842353792578e-01   -3.564997259367094e-01   +1.234206321907249e-02; +5.303584319157575e-01   +2.262230873058454e-01   -2.050503990172862e-01   -2.628819832989798e-01   +4.214753688266814e-01   -6.918697912665540e-01   +1.408615694878253e-01   +3.851289865052728e-01   +2.084202530919827e-01   -2.970502381663767e-01   +8.124623767471414e-01   -2.075820086636347e-01; -5.233155948730333e-01   +2.137971861114596e-01   +1.088127675612802e-01   +4.786700903422154e-01   -2.471769753870109e-01   -6.759936014794389e-01   -4.418683079162817e-01   +1.347241151299941e-01   -4.047374269002780e-01   +7.267059898803528e-02   +3.899082960761192e-02   -1.979692045723560e-01; +6.044777713501894e-01   +7.595277221445663e-01   -6.507608761038715e-01   +3.703304824775429e-01   +7.729326458841217e-01   +4.528486652271535e-01   -6.359928574917370e-02   -6.998305022655076e-02   -4.966366758762232e-01   +4.821965665606439e-01   -1.217207602344833e-01   -8.561130286703035e-02; +9.327960483462983e-01   -1.090985353884889e-01   -5.818763506788596e-01   -1.319966805439543e-01   -8.979299619927654e-02   +3.426601668799374e-01   -4.488454419595998e-03   -2.877614656662069e-01   -1.427679188679865e-01   -3.616976100195255e-02   +3.591359664749572e-01   -1.059327172929758e-01; +6.024511119867151e-01   -1.897133552996629e-02   -5.708861485321540e-01   +1.352418306198329e-01   +5.900177549787948e-01   -7.914452637572723e-03   -6.049487136874108e-01   -8.069265576652713e-01   -4.750062485655868e-01   -6.429417313593702e-01   +6.517726644450427e-01   +2.598012137929311e-01; -4.645298085011930e-02   +8.735844890899064e-02   +9.179122040144678e-01   +6.127149201672742e-01   +5.124864446385849e-01   +2.747850109452956e-02   -2.677298897239898e-01   +1.008465033945922e-01   -7.808379411494470e-02   -3.035497150420733e-02   -1.228201633387210e-01   +8.744859465818691e-02; -3.961334059485552e-02   +1.245101199983638e-01   -2.432641612910637e-01   +9.244052828186010e-01   +5.553766821262777e-02   -1.877693862857749e-01   -3.021326823878510e-01   +2.858778167073582e-01   +5.547944582866244e-02   -2.179706921750879e-01   -2.476502682787505e-01   +8.344384810146415e-01; +8.547982545441478e-03   -2.297291336895019e-02   -2.240459913799169e-01   +3.740867934440606e-01   -3.835767304108413e-01   +5.184693620015245e-01   -5.354676340180067e-01   -7.911973389068633e-01   -2.357687764021347e-01   +2.519065024781514e-02   +6.463574436776558e-01   +1.003919138880431e-02];
L3E_L3I_iGABA_netcon = [+1.018170258347984e-03   -2.795654011458103e-01   -1.260217890467794e-02   +7.878858821227148e-01   -6.092510395043920e-02   -7.829444663752659e-01   -2.250052914850660e-01   -2.386271788156830e-01   -9.735996855545256e-02   -2.414373911644694e-01   +3.060123077728163e-01   +1.640064554941928e-01; -3.202613468192801e-01   -5.766883189465726e-01   -1.813317027333814e-01   +7.703967165481912e-02   +1.247562566366092e-01   +9.521398558302614e-02   -4.887845379092365e-01   -3.482284483810307e-01   +1.601814252039208e-01   -1.296676255380178e-01   +6.981994868410081e-01   +2.228149455004985e-01; -6.065779949115222e-01   -5.446682360776232e-01   +4.648316801635691e-01   -8.175898629800597e-02   -2.221464296990413e-01   -4.190791795673049e-01   +2.571901159165033e-01   +5.766703428129913e-01   +3.712252099208048e-01   +1.894894569335545e-01   -3.301358128067455e-01   -1.256258900205146e-01; -5.012233923529366e-02   -3.774168055381292e-01   +3.643253255893321e-01   +2.003684874874467e-01   -4.112492404588942e-01   +7.550391482353815e-01   +5.781259785937931e-01   +2.412048299428695e-01   +2.430759229540367e-01   -5.011746729293473e-01   +9.659561685531577e-02   -1.930935898454024e-01; +6.260747551953590e-01   +3.813068646246353e-01   -5.501566698590409e-01   -5.326330644742430e-01   -2.955290058707279e-01   -2.080619643373672e-01   -7.839763999699292e-01   +3.915785474095369e-01   -6.990196009662333e-02   -2.302008925783457e-01   +4.897434782645060e-01   +5.315970510840288e-01; +1.686820263804815e-01   -3.253167562349912e-02   +5.883779882338457e-01   +7.036117287769372e-02   +9.426457678879382e-02   +1.770272827797269e-02   -7.618454568786052e-01   -1.575372369675516e-01   +1.029681778207337e-01   -7.371565799365081e-01   -7.393620322623592e-01   -9.216614461062307e-02; -4.414866770343426e-02   +1.654902591585088e-01   +3.012272294273711e-01   +9.813319994318456e-02   +1.560521781074406e-01   -5.168117219557459e-01   +2.322113952134766e-01   +2.565932835173844e-01   -2.634085077256768e-01   +3.890842904125395e-01   +3.275282376760068e-02   +8.930094595287881e-01; -6.356999126164564e-01   -2.480730632654957e-01   +5.587182108021307e-02   +4.621197303791972e-01   -2.327689566307023e-01   -3.768734757507065e-01   -3.551666723724304e-01   +1.675537600942139e-01   -6.100892755512517e-01   -1.698324348431805e-01   +5.369769721974494e-01   +4.639073768571615e-01; -6.668235823594909e-01   +6.749098783426019e-01   -9.640254339269541e-02   +4.919987407402453e-02   -1.000000000000000e+00   +5.515308599046411e-01   -1.182377410195275e-01   +3.471738343698714e-01   -8.396715798096432e-02   +6.320023872873841e-04   -4.066051980164738e-01   +1.557639605780077e-01; +1.612893823940024e-01   -3.542444214234978e-01   -4.968277931528952e-02   -1.656446688634353e-01   +2.133959204046083e-01   -1.706704048519534e-01   +5.117080189377459e-01   -6.173903354421779e-01   +2.574652528479540e-01   -4.746634620279448e-01   +9.404612754943149e-02   +3.803694855859184e-01; -1.853557017198648e-01   +4.536825189415640e-01   +6.295028753185847e-02   +3.602994174702767e-01   -2.027101219791044e-01   +2.327760932571162e-01   +3.243492216113214e-01   -6.216642594478938e-01   +1.819218642800099e-01   +9.442142138648463e-02   +1.613936440805397e-01   +3.306321159067981e-01; +2.439241223535840e-01   -1.857636994421733e-02   -6.234154284445452e-01   +6.270603567932971e-02   +4.340453740257910e-02   +1.500062405902149e-01   -7.344878476317216e-01   +5.854938089924608e-01   +1.868364882434724e-01   -2.718381504390831e-01   +1.042617919706489e-01   +4.527325166706150e-01];
L2E_Input1_iAMPA_netcon = [-4.477008146051574e-01   -2.496349989311741e-01   -1.373808650102372e-01   -2.266675938551742e-01   -2.945859967279740e-01   +2.995770211722376e-01   -4.847441104761750e-01   -1.000000000000000e+00];
L2I_Input2_iAMPA_netcon = [+2.916224251710359e-01   +7.667593477880434e-01   -7.996144566685247e-02   -5.882865916630017e-01   -1.000000000000000e+00   +3.872226948015092e-01   -5.120405170075023e-01   -2.642627645989216e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
