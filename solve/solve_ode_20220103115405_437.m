function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.161847390332359e-01   +1.683009131209376e-01   +7.032580530461562e-01   -2.837380447276986e-02   +1.473694119714731e-01   +7.311824513691286e-01   +1.407940781491004e-01   +1.402292186709304e-01   +2.745316922770809e-01   +5.636969802438946e-01   +1.206897492928225e-01   +1.095844370235679e-01   +7.997705194388768e-02   +3.273523719696696e-01   +7.241225190414555e-01   +2.148400754245150e-01; +7.226759799251118e-01   +4.452161913490792e-01   -1.924843413859209e-01   +1.777261624244712e-01   +7.226492034318568e-01   +4.346250105811503e-01   +2.740482350078131e-01   +3.867902447261037e-01   +4.587285613380400e-01   +1.916229859728422e-01   +4.618556784854884e-01   +6.552234787182276e-01   +5.329018670595695e-01   +8.756105842139031e-01   +4.946468274527607e-02   +2.679099514795227e-01; +3.873539401433005e-01   +3.849566661875817e-01   +1.891520832381478e-01   +4.756365761689093e-01   +5.508291906027777e-01   +1.412500495478616e-01   +2.677975408545992e-01   +2.207789346357026e-01   +2.206216131620946e-01   +3.810359049577265e-01   +4.603215149284193e-02   +3.457269341289059e-01   +5.422773783278656e-01   +5.879771057075910e-01   +1.205080057683062e-01   +3.816391717264920e-01; +6.366014461830231e-01   +3.607190550500255e-01   +7.723838989160972e-01   +8.354311812811159e-01   +8.673815798374468e-01   +2.944408023727166e-01   +6.656760096805659e-01   +8.626896517891062e-01   +7.851764694092433e-01   +4.881012737175644e-01   +1.589460377217984e-01   +2.310817686958272e-01   +2.443888156747030e-01   +3.184131316446654e-01   +3.520997353920800e-01   +2.248146883289300e-01; +4.565712668713765e-01   +6.805533105243042e-01   +4.074375087205852e-01   +9.689535670498635e-01   +1.828677345307217e-01   +4.622679450496081e-02   +1.809236346266606e-01   +7.677440434119239e-01   +6.895795333152436e-01   +7.695505026696966e-01   +9.209758516183320e-01   +2.187845593325534e-01   +7.834940542750936e-01   -7.410636910997789e-02   +2.456855233967460e-01   +3.403982124646977e-01; +1.025042125602196e-01   +2.643874969019205e-01   +4.495209500811139e-01   +6.251549811749564e-02   +1.539535681886530e-01   +8.195806626018339e-01   +6.068106515048483e-01   +5.368089224901623e-01   +1.899555304057930e-01   +6.831513319437199e-01   +1.211329179688255e-01   +8.500801996932372e-01   +2.882234709333268e-01   +3.324363686681714e-01   +5.972482196801080e-01   +5.518182537579046e-01; +4.656752306355834e-01   +7.480582533075689e-01   +1.262715128489647e-01   -1.819339789179021e-02   +5.520850183111754e-01   +7.063093794767950e-01   +5.750310324605394e-01   +1.646854394679650e-01   +1.647435141381302e-01   +5.886999350899359e-01   +6.034057516797855e-01   +6.739464484176703e-01   +4.656472480384735e-01   +2.086007420072972e-01   -1.082731405500427e-02   +7.661310920263338e-02; +7.100744481712546e-01   +7.405006019285928e-01   +3.789131324325345e-01   -1.333090050773200e-01   +4.617107484637640e-01   +2.454126313622602e-03   +3.543700666117969e-01   +2.576579896230657e-01   +4.094101520666534e-01   +6.555143637743170e-01   +4.082260236261747e-01   +2.709476642271270e-01   +2.717935959303284e-01   +4.879138453144017e-01   +3.897829545597282e-01   +7.692973803103540e-01; +1.709005007958126e-01   +3.396027150836297e-01   +1.078563520183486e-01   +6.368058818997943e-01   +8.536351975722634e-01   -1.248645581546034e-01   +5.630113159978517e-01   +4.607295967189665e-01   +3.049662409783129e-01   +1.827718734567509e-01   +7.220713113210068e-01   -8.094974560548429e-02   +2.132890082842421e-01   +8.093617786297760e-02   +3.771922211298477e-01   -3.904993411125556e-02; +3.619537779706866e-01   +4.807261591860386e-01   +3.646359847080716e-01   +4.127189081032307e-01   +7.112047927231195e-01   +5.643891847468918e-01   +3.819940568416258e-01   +5.713575296374993e-01   -7.351215424380053e-03   +2.141853734348976e-01   +2.263613619147143e-01   +5.421146013706025e-01   +5.934421009756324e-01   +6.146356722376817e-01   +3.140755872820286e-02   +6.054490150590186e-01; +3.369249338035251e-01   +4.921747238438982e-01   +4.206527762055232e-01   +5.854296064645036e-01   +5.060520791611154e-01   +4.398164906723893e-01   +5.581883894003880e-01   +7.504351485806547e-01   +4.321339049069507e-01   +1.037584737484663e-01   +2.930448368080033e-01   +6.945465919822228e-01   +2.574639723781696e-01   +4.862258530318520e-01   +3.457386792681837e-01   +1.108636546493978e-01; +4.123679341507878e-01   -1.390232017395297e-02   +6.431330228780181e-01   +4.979517151607238e-01   +5.312698303659846e-01   +4.719480034191496e-02   +3.600630185273484e-01   +6.559079707729240e-02   +4.877680146044741e-02   +4.786338606633888e-01   +2.013022956601415e-01   +1.433559598972352e-02   +7.360469612100720e-01   +5.062838878653187e-01   -5.584322590937855e-02   +1.023499375013090e-01; +1.645854728285538e-01   +1.958602859659805e-01   +8.568179767546827e-01   +7.030760834996089e-01   +6.286023423980178e-01   +9.486129682849744e-01   +1.891700395075868e-01   +3.677184753280146e-01   +1.636621038296658e-01   +3.981346404890325e-01   +3.003924957796822e-01   +5.033854342822202e-01   +3.644974640447345e-01   +6.625055243032835e-01   +6.096426133348734e-01   +4.223364887684350e-01; +4.809726752501012e-01   +7.860999652293120e-01   +6.828440312067755e-01   +7.264537859159942e-01   +7.413165685416362e-01   +3.487621309414130e-01   +1.831392306366755e-01   +2.378779961096344e-01   +6.546295315493903e-01   -1.040802472902644e-01   +5.340840771737342e-01   +1.437017565073569e-01   +4.471727649622197e-01   -2.032205097251325e-01   +2.129482264029911e-01   +2.633555228991125e-01; +1.873226797769956e-01   +5.097419960657243e-01   +3.990862508110082e-01   +5.394226110790219e-01   +7.193562585012224e-01   +8.991956212056631e-01   -7.355996793113163e-02   +2.550029637315073e-01   -2.162960796725041e-01   +3.377745483798401e-01   +3.464163073920508e-01   +5.885604574252398e-01   +8.243168382676378e-01   +7.773756542756137e-01   +3.733402773418691e-01   +2.928162292619817e-01; +5.410048661059249e-01   +2.007998701847762e-01   -1.173803022932313e-01   +2.604617118176544e-01   +5.096886488351268e-01   +4.959147883174390e-01   -3.349076691414210e-03   +2.778378313818828e-01   +4.170741767882251e-01   +6.297783876398543e-01   +7.150319594289112e-01   +3.706935833909504e-01   +6.372846922622744e-01   -3.447302742711624e-02   +5.660741954426005e-01   +5.728675101800138e-01];
L1E_L1I_iGABA_netcon = [+5.113161738154270e-01   +5.515919160220906e-01   +4.760359416227413e-01   +1.667033486467454e-01   +4.961070077515085e-02   +3.086096420569564e-01   +4.319261290172930e-01   +8.771339376784820e-02   +7.329221351716740e-01   +5.355439867986249e-01   +3.957947423284808e-01   +3.334072030798118e-01   +8.951971997558070e-01   +2.168108900750409e-01   +3.610504828213491e-01   +1.297059331097212e-01; -6.940228878255525e-02   +1.102438438204350e-01   +1.334172703833115e-03   +3.457465683383103e-01   +1.684609900825982e-01   +5.096391809983595e-01   +2.670872297434791e-01   -6.585109199373582e-02   +6.967495019590417e-01   +3.387891471865458e-01   +3.657764496509981e-01   +1.086657183323414e-01   +5.004573830418163e-01   +3.998182050723036e-01   +2.172055059796392e-01   +4.417822971522067e-01; +5.561589680243524e-01   +5.435443558735774e-01   +6.024520294993523e-01   +1.067837776636468e-01   +6.215531264795375e-01   +7.292681772718737e-01   +3.260662860037017e-01   +5.291322591094413e-02   +5.938228507224114e-01   +3.254691372176615e-01   +6.653390178822871e-01   +6.114472391353111e-01   +7.895068959167200e-01   +2.622559462570090e-02   +3.105328210023586e-01   +4.407142604541441e-01; +2.592532818084225e-01   +6.871464795820695e-02   +1.958459636856650e-01   +4.889780716137719e-01   +7.005993861295360e-01   +6.318237584304813e-01   +7.263650917250483e-01   +2.719001933322210e-01   +1.806320736559094e-01   +8.481026042896224e-01   +1.211377197455769e-01   +2.076151001474472e-01   +6.466133237873747e-01   +8.237426288122357e-02   +4.966211544805532e-01   +4.028068714436358e-01; +1.913055951930653e-01   +6.798703430662999e-02   +2.059295556701807e-01   +4.323503405751709e-01   +2.324459302820440e-01   +5.715202133450807e-01   +7.518190957500759e-01   +7.276058066061357e-01   +2.506451644322736e-01   +4.160301312183471e-01   +5.798590196068523e-01   +7.258467442460580e-01   +3.128120911241115e-01   +4.590590057010062e-01   +5.337696437329417e-01   +1.602691209885205e-01; +5.199142453972895e-01   +3.049565993016035e-01   +4.530557934501744e-01   +1.576867671017932e-01   +2.286994547691545e-01   +3.071298977346004e-01   +6.194954928067208e-01   +3.970140366475880e-01   +6.692240629756793e-02   +5.612293486631069e-01   +2.986451675469752e-01   +3.147118350196241e-01   +9.674955324358617e-02   +4.456231211630431e-01   +4.174915641829665e-01   +6.685457493242879e-01; +2.698801720351065e-02   +9.203272439466823e-01   +2.133172212697677e-01   +4.070586373112653e-01   +6.397365468183505e-02   -1.969110528498170e-01   +6.944108054066369e-01   +4.535321269127015e-01   +8.568389533606018e-02   +3.855298734495494e-02   +4.471731364196043e-01   +5.518791934388075e-02   +1.412148109560414e-01   +4.132943607088774e-01   +6.617840122120513e-01   +1.727849585059817e-01; +1.643723903725056e-01   +9.975163909036465e-01   +6.193654286664440e-01   +2.181631141695442e-01   +5.082213984308785e-01   +7.696498067349796e-01   +7.341778931273224e-02   +8.346944136625231e-02   +4.376203754709310e-01   +6.406766810587439e-01   +4.895515659052355e-01   +6.003178051424558e-02   +3.935590653464258e-01   +5.522962755739206e-01   +5.700161517668667e-01   +2.393671850689471e-01; +2.327972004246376e-01   +1.630121548237556e-01   +5.441552311720612e-01   +7.205892105392135e-01   +8.180544508464450e-01   +1.711903149973681e-01   +8.278343688117037e-01   -6.258106149453141e-02   +3.532167290266964e-01   +1.483606864556021e-01   +1.326133505936318e-01   +8.443137505471576e-02   +2.730883314533494e-01   +3.405712310692944e-01   +6.399214635197310e-01   +2.053347720951252e-01; +3.184859185847808e-01   +8.350278165756371e-01   +5.466995970993933e-01   +1.467252358886950e-01   +3.772139980966312e-01   +7.585347188791405e-01   +5.527338242083539e-01   +3.442683515777999e-01   +3.993778407442016e-01   +7.132677055872539e-01   +2.111779291737085e-01   +5.868775510019509e-01   +5.269878914798500e-01   +2.947227519455080e-01   +5.908288801569200e-01   +1.732891325945483e-01; +7.066874870164921e-02   +6.648039895562007e-01   +6.763088839090245e-01   +4.980497086289853e-01   +5.704340570881626e-01   -7.873864214335242e-03   +2.127319595588601e-01   +5.385792579737982e-01   +5.340853242197798e-01   +4.157762638221837e-01   +6.425026021315466e-01   +5.968845373907674e-01   +4.307881778935366e-01   +6.524313250369440e-01   +1.399335196031472e-01   +5.435249531318403e-01; +5.821971226628764e-01   -1.186429419087562e-01   +1.892077537597941e-01   +7.746019711648663e-01   +6.244458635338489e-01   +3.563861732741037e-01   +1.235354283434428e-01   +3.956126700132776e-01   +1.163069634560828e-01   +8.343655823089179e-02   +4.971503751198720e-01   +4.064019424186834e-01   -9.723676986088238e-03   +2.039411142882491e-01   +4.524482820069848e-01   +7.454192547083821e-01; +5.291295236265368e-01   +8.116290026265214e-01   +7.988902555992157e-01   -2.598051985718954e-02   +4.836707355342952e-01   +8.492712522762706e-01   +4.696855711001745e-01   +5.901848283431766e-01   +3.546778899258404e-01   +2.769557050311857e-01   +5.908213212676157e-01   -4.531926526169254e-02   +6.873286080222003e-01   +3.872109399739964e-01   +2.526197471703283e-01   +5.123098183673983e-01; +4.997924141316563e-01   +4.794854845295972e-01   +1.209692781186523e-01   +7.270226120204062e-01   +9.941670643767947e-01   +8.594407151418811e-01   +6.185090477325268e-01   +1.770986810096720e-01   -4.954470578619837e-03   +4.013325769014413e-01   +9.305732437006788e-02   +8.115607372158978e-01   +2.247432300490431e-01   +7.354146323506151e-01   +7.053410138228312e-01   +4.310475261207002e-01; +9.250681859396389e-01   +7.745822436309927e-01   +2.212101590377927e-01   +1.891479241785229e-01   +5.822149933987727e-01   +3.755034138502664e-01   +2.013433986134957e-01   +1.854453775383620e-01   +5.589931112238363e-01   +1.740820459719938e-01   +4.968441334040064e-01   +4.326116862965604e-01   +6.431185311222501e-01   -2.707855248536069e-02   +2.554678433317645e-01   -7.157173520884420e-02; +1.893252166693503e-01   +4.272572367352577e-01   +7.011256225988646e-01   +2.121998657241569e-01   +3.072557720434986e-01   +5.446892483511194e-01   +4.104610404136799e-01   +6.620231252063209e-01   +7.256685625905933e-01   +2.587400825440388e-01   +1.053507742416759e-01   +7.968550748476355e-01   +7.768970880914401e-02   +4.399138625268796e-02   +1.801699734985877e-01   +3.844537630225816e-01];
L2I_L1I_iGABA_netcon = [+2.827900675541122e-01   +2.541194521415522e-01   +7.814679189909898e-01   -7.869846505474841e-03   +7.655622691217787e-01   +7.285732420893587e-01   +7.564715035553979e-01   +8.563101444736260e-01; +3.404034057852802e-01   +3.683776152445866e-01   +4.101153290258507e-01   +2.109757491824301e-01   +5.795100650894122e-01   +1.652800877374859e-01   +3.376804313647428e-01   +8.168577172140866e-02; +3.433836577018208e-01   +6.610860588998013e-01   -6.017865336260772e-02   +1.501687697252410e-01   +4.882912938387535e-01   +5.353392607423211e-02   +5.047254147100897e-01   +2.198641391329165e-01; +6.740956135226889e-01   +5.472312377497716e-01   +3.767686522897312e-01   +4.375693263130677e-01   +5.364798222858781e-01   +1.334736082340906e-01   +5.532571515347360e-03   +1.956063525050270e-01; +6.902049788616067e-01   +6.319658010311258e-01   +4.563463437359843e-02   +1.273756200779729e-01   +6.192148030031063e-01   +4.379863564336826e-01   +5.098548272460124e-01   +3.551852273612767e-01; +8.003992455288911e-01   +5.553742817715404e-01   +4.152203574264329e-01   +7.128938873241848e-01   +5.867604756579229e-01   +4.502736823120427e-01   +7.137396852863430e-01   +1.380568830111398e-01; +2.922472037170268e-01   +3.023762860439875e-01   +6.727236197974996e-01   +7.422696755184893e-01   +2.414667828351253e-01   +8.147072441518916e-02   +3.322166367234953e-01   +4.595551288756448e-01; +4.419188878068230e-01   +4.714465367014779e-01   +1.009317302976933e-01   +1.381330249285295e-01   -4.553587991489584e-02   +3.924399545673039e-01   +3.775306956570692e-01   +5.691133364772598e-01; +4.305598791475174e-01   +2.652405354545934e-01   +7.798739133245769e-01   +4.089967856185988e-01   +3.479903034103170e-01   +8.059084560785275e-01   +4.726161283301389e-01   +7.257888232269605e-01; +6.738822335536347e-01   +2.769363575692986e-01   +1.615877109271970e-01   -4.360682713298157e-02   +7.053112839556815e-01   -8.637851862080026e-03   +1.054681859359157e-01   +5.984462994096562e-01; +3.314742796961511e-01   +2.964925777703404e-01   +4.099073755960136e-01   +8.695056588400123e-01   -2.142500247531031e-02   +5.262892039526590e-01   +8.956460910724109e-01   +7.879157556560267e-01; +6.182701541729163e-01   +8.040661682822819e-01   -1.148029386821040e-01   +2.818240346711663e-01   +3.004905469032065e-01   +8.383775134924500e-01   +6.573781519992978e-01   +3.285569270347166e-01; +9.331414148981407e-01   +2.532652036397668e-01   +5.996350911884064e-01   +1.677297613031508e-01   +4.429685490206104e-01   +2.354649986485964e-02   +6.961823170507521e-01   +5.179636451740709e-02; +6.625150651828495e-01   +1.156174933209432e-01   +3.521128089989582e-01   -1.319108536913240e-01   +4.238859539159597e-01   +5.048134322187018e-01   +1.412203039840054e-01   +2.780859941677107e-01; +1.094904937912063e-01   +9.984751597956417e-01   +5.683889239101472e-01   +9.862359542159339e-02   +4.019422847239145e-01   +6.725734434289673e-01   +3.323169580433551e-01   +2.649104825453040e-01; +2.315868403858101e-01   +7.451320957173241e-01   +3.016748132300615e-01   +5.775568292363500e-01   +1.433087190540594e-01   +4.253039026879587e-01   +3.864724569050757e-01   +1.176830313095455e-01];
L1I_L2I_iGABA_netcon = [+2.198782488140904e-01   +4.545746092061539e-01   +3.787455684288470e-01   +2.669567452867502e-01   +5.840514745950466e-01   +2.023647228818628e-01   +7.175206950513323e-01   +1.072556694383335e-01   +2.431755774402167e-01   +6.983197684656516e-01   +3.731199948412042e-01   +6.283249481905305e-01   +2.491643821311144e-01   +1.194255130367605e-01   +1.970449404145820e-01   +5.398825841843113e-01; +8.291396319286560e-01   +3.600442031331780e-01   +4.790756904204378e-01   +3.566604159998289e-01   +8.984954412716948e-01   +8.263681491741977e-01   +5.410996757510393e-01   +2.697792450962375e-01   +5.228788647714258e-01   +6.172674312087859e-02   +2.193765300525299e-01   +7.120267883819014e-01   +5.146467417208079e-01   +5.749373228164661e-01   +4.110472125694395e-01   +8.669424996562082e-01; +2.012918527695421e-01   -2.410998752967342e-02   +2.007493531448253e-01   +3.191206448461236e-01   +3.443448883844457e-01   +6.062446459480937e-01   +4.627757851008534e-01   +5.847497700655994e-01   +4.613995321504464e-01   +4.547714213067748e-01   +2.320593758390409e-01   +6.271927065448241e-01   +2.644036747855666e-01   +9.902822730980373e-01   +4.297867016676360e-01   +8.764981041623209e-02; -2.188497829384714e-01   +6.561645888034890e-01   +3.497702677860660e-01   +7.292278939545967e-02   +6.594727778289821e-01   +6.943846219595414e-01   +9.808899076940839e-01   +2.642947994431260e-01   +8.907033190368426e-01   -4.947705893780237e-02   +3.391817660750296e-01   +9.891173707924694e-01   +9.435619052558453e-02   +4.283107762326404e-01   +6.422352559806155e-01   +7.325042095067337e-01; +7.473689029397831e-01   +8.077615727116476e-01   +8.528754653892004e-01   +3.351281553671767e-01   +2.041626880630740e-01   +4.678386959045642e-01   +7.404447762820163e-01   +1.883699257062554e-01   -2.996808218368241e-02   +5.064678098524832e-01   +4.381363835585937e-01   +7.732726664176877e-01   +3.328683126686678e-01   +4.326077491923967e-02   +5.404436941987690e-01   +5.124585664970336e-01; +7.932749528108601e-01   +7.103980162422819e-01   +2.115245259968904e-01   -1.151693420156246e-01   +2.779446076711182e-01   +1.011678698579687e-01   +6.032982149003284e-01   +3.426449940655537e-01   +2.324632560630897e-01   +8.407701841906885e-01   +9.261410207889804e-01   -1.169705132417309e-01   +2.719463543505443e-01   +5.238759662271749e-01   +3.850441129754216e-01   +3.718410232953708e-01; +3.997944730987632e-02   +7.767067086023537e-01   +5.376954685503664e-01   +6.486717749984341e-01   +3.132663921337062e-01   +7.714974256184435e-01   +5.852733682499373e-01   -4.984928315766000e-02   +3.090950116775236e-01   +2.269168289151202e-01   +5.125989860167222e-01   +2.921872695601755e-01   +7.123086326907007e-01   +8.229876374386913e-01   +1.871209457930005e-01   +6.103793870859431e-01; +3.606480147065745e-01   +5.679858094962378e-01   +4.942770748542292e-01   +5.916789028749098e-01   +9.734530891308061e-01   +5.283508723387172e-01   +3.104563118046664e-01   +2.142738230497060e-01   -1.628956002845618e-03   -1.520338084161374e-03   +2.251745606821807e-01   +4.979552254122885e-01   +2.494569631056350e-01   +8.448193224833860e-01   +5.562808369191522e-01   +3.706611700664203e-01];
L2E_L1E_iAMPA_netcon = [+5.769479394902127e-02   +5.829022900531787e-01   +9.026619832128713e-01   +7.066698187246189e-01   +4.966642790714236e-01   +3.425316286223082e-01   +5.689585399294148e-01   +8.888530919703855e-01; +8.954181702782770e-01   +1.890831534131905e-01   +4.064976281188964e-01   +6.821284005529412e-01   +3.467447300662654e-01   +5.181260269881057e-01   +3.059097968571963e-01   +6.923495839018852e-01; +4.580894603635479e-01   +1.107332141579931e-01   +4.102717401059180e-01   +8.997711681505068e-01   +2.011223527722896e-01   +6.228933950075438e-01   -9.074274767887011e-03   +9.427922670778975e-01; +5.407240434336285e-01   +2.567389563781728e-01   +3.869107612279661e-01   +8.348040596267223e-01   +5.255584121748929e-01   +5.661975120412671e-01   +7.763600588146212e-01   +5.833799095760810e-01; +9.962558015803570e-01   +8.643853972555146e-01   +3.707576571343084e-01   -6.397194387069574e-02   +3.785862929693719e-01   +3.487537048336038e-01   +1.633059410256536e-01   +5.384625987483972e-01; +9.243621213294372e-01   +2.593906468355908e-01   +7.973608696121175e-01   +8.197407080109848e-01   +9.016023340920756e-01   +7.764866143710574e-01   +6.023310297164871e-01   +8.274558019822625e-01; +4.936098221457314e-01   +2.475959034078491e-01   +2.277937058037114e-01   +2.636980595019778e-01   +8.688118577654141e-01   +6.911553168209151e-01   +1.863406082539143e-02   +7.132082575312069e-01; +7.960843789773341e-01   +4.456198430727502e-01   +8.472486087433774e-01   +6.219811553482003e-01   +1.385724947674760e-01   -3.860219155862487e-02   +4.653205741656407e-01   +6.933627928991243e-01; +1.026489589820298e-01   +2.417667987063489e-01   +6.663296046997066e-01   +8.755965408226687e-02   +6.500338107125915e-01   +9.143464032813448e-01   +3.383957471346889e-01   +1.277480174201847e-01; +5.023942335548288e-01   +4.567548658855449e-01   +3.365721739955485e-01   +7.371450969896958e-01   +7.035042247373464e-01   +8.143595720727845e-02   +8.308746543145226e-01   +6.626221189094099e-02; +4.953536015694132e-02   -4.996130156929096e-02   +4.597779999157744e-01   +6.364256631374735e-01   +2.374341766340818e-01   +7.675014309099910e-01   +8.959357435884570e-01   +1.916985261941707e-01; +6.747362852857672e-01   +2.463531185516287e-01   +1.930483441768817e-01   +7.919673612556941e-01   +7.805692374185716e-01   +1.872802605086697e-01   +2.842496076552268e-01   +5.573651002934621e-01; +3.639517304651946e-01   +7.039657548296560e-01   +4.584796529983998e-01   +4.277836252205770e-01   +7.195219351192519e-01   +3.316033552336590e-01   +1.589387249102314e-01   +4.573852888446391e-01; +2.207623717043693e-01   +9.299437131603907e-01   +9.283168103995858e-01   +6.193371695388377e-01   +5.294384844530342e-01   +3.775039811018507e-01   +5.262172276693077e-01   +8.714657049252108e-01; +7.575703371367478e-01   +3.596922574217685e-01   +2.858054087488648e-01   +6.153810519133818e-01   +8.854006256823547e-01   +4.568298265613331e-01   +5.656660450631966e-01   +7.834993914961726e-01; +4.255719984453802e-01   +4.808460402893808e-01   +2.914816905202641e-01   +8.430726273725984e-02   +8.586981004889215e-01   +1.668358113554411e-01   +1.798126716866229e-01   +1.526035129258713e-01];
L1E_L2E_iAMPA_netcon = [+3.317343968605692e-01   +3.773649737047653e-01   +1.562908061754203e-01   +3.148465826505001e-01   -9.288929721206247e-02   +5.746371146070095e-01   +3.368395809431469e-01   +7.719055733167278e-01   +6.589531957155959e-01   +3.661229308724383e-01   +1.728134734627943e-01   +8.402200391196520e-01   +6.233352486842154e-01   +1.281715463257299e-01   +9.310001015916941e-02   +4.946348178898671e-01; +3.179108003420288e-01   +3.988712781164734e-01   +9.268893513577775e-01   +6.452819136042932e-01   +5.045284043308711e-01   +7.487446514570739e-01   +5.324946117720802e-01   -1.363088464091961e-01   +4.506804195825196e-01   +3.570700574019023e-01   +1.824998963338913e-01   -5.889881247541165e-02   +5.746355793615794e-01   +2.667982746887562e-01   +4.900780058324858e-02   +1.848933385321246e-01; +1.417039817127239e-01   +2.809185665985750e-01   +4.482819593136413e-01   +6.911331420001967e-01   +9.767700789743047e-02   +3.883435856001393e-01   +1.590618831513360e-01   +9.595561866197055e-02   +5.911794069093137e-01   +4.235684737768256e-01   +9.486517971358348e-01   +2.820524794467778e-01   +2.416644017222924e-01   +7.944660459904640e-01   +4.104433233843265e-01   +3.842322792501880e-01; +7.823981586231697e-02   +6.617535298588832e-01   +3.795707563608697e-01   +4.943535808859260e-01   -7.702631883462757e-02   +5.779210880526976e-01   +4.101893708683687e-01   +2.411118044294735e-01   +5.147801053892986e-01   +5.762573699446949e-01   +5.689949434759959e-01   +1.414995937786850e-01   +3.694063441528453e-01   +2.385929037454327e-01   +2.961965156247715e-01   +3.546091301286107e-01; +2.951853368765315e-01   +6.755886408214460e-01   +8.513619124213042e-01   +2.003363563220485e-01   +2.253381581656124e-01   +7.159173726278010e-01   +3.832669509649920e-01   +4.082001145946263e-01   +7.703256770249365e-01   +6.285899561950777e-01   +8.403917277765467e-01   +1.306889742545385e-01   +8.356666981205905e-01   +7.395004333653346e-01   +3.410402935778760e-01   +2.419622426382847e-01; +4.808736433153490e-01   +7.768327842073544e-02   +3.228887192213186e-01   +3.395956956502035e-01   +5.527557295315346e-01   +5.737224416523989e-01   +6.118391842457795e-01   +1.253385721298514e-01   +4.391032266300627e-01   +4.883918630995941e-01   +3.394529048690802e-01   +5.826024372242501e-01   +4.077522424430255e-01   +4.975855636976813e-01   +6.661262491063518e-01   +4.523236022905613e-01; +6.224707956068503e-01   +2.842482320865088e-01   +3.448626265818662e-01   +5.213199012056772e-01   +2.264332421737279e-01   +1.360817233823362e-01   +9.523674367184820e-01   +7.205612174967744e-01   +3.811273758744856e-01   +7.405274383105092e-01   +3.784948257057885e-01   +6.403615125176939e-01   +2.013130400232358e-01   +4.614565457130625e-01   +1.218021482484792e-01   +2.577136163025616e-01; +6.090086914951350e-01   +5.886615910174993e-01   +4.496441824200196e-01   -1.041860259120536e-01   +6.664171518376945e-01   +5.136331729783838e-01   +5.491543542244747e-01   +2.897736668989061e-01   +4.295041319584894e-01   +2.056649408424814e-01   +6.328643419168074e-01   +3.013892269628340e-01   +8.345597271860797e-02   -1.645190290864576e-02   +6.101884276848354e-01   +7.551055140481653e-01];
L2I_L2E_iAMPA_netcon = [+1.368083339312648e-01   +7.545435675562563e-01   +7.212419546603924e-01   +6.638134367911629e-01   +3.900135180673871e-01   +1.050595871170887e-01   +1.000000000000000e+00   +7.270760640016578e-01; +5.877732327388895e-01   +8.636031030929667e-01   +4.664660324924809e-01   -4.002366569676472e-02   +7.415688546448576e-01   +9.071414669988583e-02   +3.419164776386816e-01   +2.051897919043714e-01; +5.446129016036217e-01   +4.612425577166498e-01   +7.892184062553753e-01   +9.917590027487372e-02   +2.948097790853169e-01   +6.003267848240171e-01   +3.880238260338206e-02   +1.306822035156419e-01; +4.503630197365121e-01   +8.243261019042960e-01   +3.697088229360126e-01   +2.548788981268689e-01   +7.432029679002742e-01   +6.088993728829522e-01   +7.449126128166789e-01   +6.543338316328702e-01; +7.190238596259765e-01   +3.852741852683180e-01   +5.882375226793274e-01   +2.164059843312616e-01   +1.300857704692001e-01   +6.156699523475482e-01   +5.196384864393359e-01   +2.052202319748461e-01; -9.800839169174272e-02   +1.436207639199508e-01   +1.259650168975780e-01   +4.430461369899716e-01   +1.868792313079018e-01   +6.515324973935798e-01   +6.510280844432278e-01   +3.837960648259973e-01; +6.759242375437995e-01   +4.190805754590928e-01   +7.090120566318056e-01   +1.992230842085400e-01   +1.537721113921625e-01   +1.841370713302941e-01   +7.544176940799678e-01   +3.516798365216512e-01; -5.934836168589610e-02   +4.319655039523738e-01   +3.546806216869522e-01   +2.408070464174179e-01   +7.202699275833739e-01   +5.687670377553226e-01   +8.651882810622147e-02   +1.939875463030446e-01];
L2E_L2I_iGABA_netcon = [+8.673576245526182e-01   +6.763491668121173e-01   +7.110668663474695e-01   +4.623749685156804e-01   +2.952932917751220e-01   +1.700773228530793e-01   +3.491387654571656e-01   +2.674492179408879e-01; +4.633360221027143e-01   +8.996974380645637e-01   +6.817098537552337e-01   +7.765981609184286e-01   +2.074615578774262e-01   +3.782830058619823e-01   +1.056838038083734e-01   +7.465256637576380e-01; +2.653773456182155e-01   +7.422027090680137e-01   +9.629273275186446e-01   +7.382502866167259e-01   +3.576293655095575e-01   +4.224930005489758e-02   +5.795744848430564e-01   +2.175026581122333e-01; +3.743438729303534e-01   +4.248789256731875e-01   +7.380333814128154e-01   +2.182865791332882e-01   +7.049194587558566e-01   +5.402421957279228e-01   +4.540219974306597e-01   +5.420779708680611e-02; +6.659174357055312e-01   +9.176996302981760e-01   +4.183568715087206e-01   +4.694580775541600e-01   +6.454493886304381e-01   +4.614618082326541e-01   +6.885522585861816e-01   +8.102616077623494e-02; -3.047770350538870e-02   +4.774564394236121e-02   -1.050478926689668e-01   +1.339160183736449e-01   +6.832149538658343e-01   +5.706445797458828e-01   +4.957261033305838e-01   +2.376405421750223e-01; +4.297782647657035e-01   +7.879955589340430e-01   -1.845864492479600e-01   +4.449130218685076e-01   +5.130987916455043e-01   +7.871608838312173e-01   +7.090641074261793e-01   +6.400905094649122e-01; +1.796190035563582e-01   +2.880955492659525e-01   +2.616195544562022e-01   +7.606253383245541e-01   +4.818861637570357e-01   +4.459854555895204e-01   +2.246633518588834e-01   +2.755638185169422e-01];
L3E_L2E_iAMPA_netcon = [+3.337477226759250e-01   +3.152937478747539e-01   +5.918207572279022e-01   +3.356511398698955e-01   +4.647742366337732e-01   +6.851604760253271e-01   +4.628823944994078e-01   +6.603930194760409e-01   +1.007453998056282e-01   +8.003340316295632e-01   +7.907458274407461e-01   +5.413397916747460e-01; +3.328988604812589e-01   +5.285829286105544e-01   +8.160334698310808e-01   +5.056249681021117e-01   +3.968135500065738e-01   +3.047655361321577e-01   +3.869085070876147e-01   +7.848933139303025e-01   +1.785751951569368e-01   +5.665126360331308e-01   +3.608957987627695e-01   +2.914012633638479e-01; +1.708017620532781e-01   -1.195945058599157e-01   +2.190830424818835e-01   +3.627661087637729e-01   +1.199613195869167e-01   +5.351594417365261e-01   +1.739642847305784e-01   +9.430195037025252e-02   +5.357319462484152e-02   +3.881522231438239e-01   +3.257233053394550e-01   +3.455529827788067e-01; +5.495285812358626e-01   +6.792822885098296e-01   +4.891154580098958e-02   +5.712078667146221e-01   +4.253080179422759e-01   +2.070750524086513e-01   +2.940205362262894e-01   +3.830782478976170e-01   +7.303419642837158e-01   +1.399034141796281e-01   +3.918962523196285e-01   +5.852135200002963e-01; +6.459317673321391e-01   +3.420631782903132e-02   +7.287684984231450e-01   +4.398353858767676e-01   +6.637177233058084e-01   +9.039547894970122e-01   +3.823968941217201e-01   +6.529666610306670e-01   +9.564816446266161e-02   +8.542505704331601e-01   +5.279187662780358e-01   +2.165181074493596e-01; +5.138015830125553e-01   +6.089783364320037e-01   +5.807683196027372e-03   +3.678655026467799e-01   +2.581446175777278e-01   +8.193896293194585e-01   +5.283359111411799e-01   -1.312665370536988e-01   +3.232107644787300e-01   +8.691947573410844e-01   +2.742452275659780e-01   +4.931370459098391e-01; +1.460861769342193e-01   +2.410863120406138e-01   +2.511481896587164e-01   -1.342015272450500e-01   +9.970528544467385e-01   -2.405076194936355e-02   +6.934973781331717e-01   +6.319961810919738e-01   +2.544176854520063e-01   +2.155751382572902e-01   +1.636475118609632e-02   +5.832445595826510e-01; +4.549848345672363e-01   +7.047963250783756e-02   +4.859371727251204e-02   +4.002914275722626e-01   +7.349337201830147e-01   +2.038868198333302e-01   +6.258613686104372e-01   +1.140235094939603e-01   +1.316804330727475e-01   +5.098951130225569e-01   +5.042304766755269e-01   +3.128541933727033e-02];
L3I_L2I_iGABA_netcon = [+9.356962730148906e-01   +5.710930829282810e-01   +7.287898068284162e-01   +1.743789133267533e-01   +3.274977339918717e-01   +6.354711503080438e-01   +6.293572953980449e-01   +4.735601407043772e-01   +5.032001575314263e-01   +5.438499909540612e-01   +4.811691173974871e-01   +7.759552032541638e-01; +5.905695098886861e-01   -7.603250467535784e-02   +1.021804028394233e-01   +7.387666017029335e-01   +2.725794776390620e-01   +4.038680719737036e-01   +3.490346416628640e-01   +2.856225433631215e-01   +6.602207891643442e-01   -5.287641318553110e-02   +7.344771323416237e-01   +1.658062186513186e-01; +2.847012819497300e-01   +5.302740889319937e-01   +8.164523637011706e-01   +8.158123114863213e-01   -5.232250604986708e-02   +4.508878756250516e-01   +1.741927256444201e-01   +6.341687387714093e-01   +5.019182137553183e-01   +3.492196852311202e-01   +9.567350440710428e-01   +8.857368734711794e-01; +1.407301098341861e-01   +2.309185679057945e-01   +8.673328723230915e-01   +2.306478263903116e-01   +5.288756129104958e-01   +6.244042293377395e-01   +2.656892668441961e-01   +5.938397436108230e-01   +3.290593448465490e-01   +3.556044781712712e-01   +9.959676324214414e-02   +3.910156041014332e-02; +1.954527362874920e-01   +4.022012140242500e-01   +1.077153051815891e-01   +1.349680232826549e-03   +5.591590025032614e-01   +2.703991977704414e-01   +4.762005630369270e-01   +3.708934979760596e-01   +3.443632227713548e-01   +7.637955418593613e-01   +7.827843651926855e-01   +7.452458696801140e-01; -3.727289153074811e-02   +8.403695160388841e-01   +3.754362297680929e-01   +4.104355732352623e-01   +1.285375557169333e-01   +1.392891904344201e-01   +9.390261656796812e-03   +4.003609630843361e-01   +1.976454673889069e-01   +5.281645954846327e-01   +6.981510302016419e-01   +7.277708686398974e-01; +6.492410665388686e-01   +5.997014955950173e-01   +7.185533790345533e-01   +3.828595186354187e-01   +4.662369071825625e-01   +2.648299889525528e-01   +4.010033773558339e-01   +3.617282942973779e-01   +4.484118785298323e-01   +6.659435321213254e-01   +4.380315526368724e-01   +6.926559711234035e-01; +5.510696583606163e-01   +9.501506480964367e-01   +5.310108931938481e-01   +1.597796634430632e-01   +1.125803137943980e-01   -1.155266100865435e-01   +9.637883278213276e-01   +7.718592880185152e-01   +7.747045277971049e-01   +5.912034519364064e-01   +2.404576995103240e-01   +6.418578230262166e-01];
L2E_L3E_iAMPA_netcon = [+1.875472339314060e-01   +2.603973154302097e-01   +3.310708655874045e-01   +6.991198385005618e-01   +6.381447620943511e-01   +1.240992562722624e-01   +2.065061022789732e-01   +4.691102271444721e-01; +5.482950575082606e-01   +7.812514438121344e-01   +1.952224425355226e-02   +6.638740327864515e-01   +1.191035601488398e-01   +5.248396340293527e-01   +1.051284479851102e-01   +6.850339438483725e-01; +9.281375727532267e-01   +3.806006880149346e-01   +5.290572268502116e-01   -8.486832931867168e-02   +8.959687858697495e-01   +1.773885247991389e-01   +3.328106503603236e-01   +3.376737577345270e-01; +4.433553034564089e-01   +6.184885186180541e-01   +8.165037769390723e-01   +5.451092263707523e-01   +7.578219267738013e-01   +4.161424273177627e-01   +5.008770202565155e-01   +6.716911720760022e-01; +2.956929115890587e-01   +2.720630602754143e-01   +8.510099701083301e-01   +6.790604997704410e-01   +5.016072234540020e-01   +2.444634507595728e-01   +8.741259452729826e-01   +2.680206860237722e-01; +2.463260330496793e-01   +6.680399745383276e-01   +1.816107689110171e-01   +7.842525268983840e-01   +1.801075476895792e-02   +6.997117567549508e-01   +1.967035984408391e-01   +8.235209887099264e-01; -1.174489709817273e-01   +6.135490329777540e-01   +5.492357018128068e-01   +9.141342228509583e-02   +3.446956689607355e-01   +1.344191440915231e-01   +8.932588452358504e-01   +7.717180460402108e-01; +4.090822514383726e-01   +8.977178730384410e-01   +2.533879071596464e-01   +5.800799033928492e-02   +5.069184837372046e-01   +4.999479344511830e-01   +6.499140290086910e-01   +1.596109643719770e-02; +4.138513027673203e-01   +9.469581827286940e-01   +7.159206444609345e-01   +8.528722661084792e-01   +3.018898265879215e-01   +6.667623254743572e-01   +4.998427901016733e-01   +8.795545457709787e-01; +6.070246466435679e-01   +1.449805502411786e-01   +2.982976560563151e-01   +7.429978334581592e-01   +4.331201984620647e-01   +6.598140527811447e-02   +9.462412376874414e-01   -2.101476216731259e-02; +3.709759953898523e-01   +4.665026335778216e-01   +2.050261291021291e-01   -1.849318629120043e-01   +3.502797940148447e-01   +2.335927863611492e-02   +5.801194142970466e-01   +8.296359870946372e-01; +5.503663763895490e-01   +4.207138812561853e-01   +3.142606825198390e-01   +9.158834735997071e-01   +9.170477286126456e-01   +1.687292587971743e-01   -5.732253850998358e-02   +3.166283069133505e-01];
L2I_L3I_iGABA_netcon = [+5.845597824236297e-01   +1.839655107193781e-01   +2.004205538595687e-01   +9.931036137026057e-01   +5.846552454441287e-01   +1.740286842199878e-01   +9.147281636026725e-01   +1.018278150421971e-01; +5.610026471566567e-01   +4.601483519413451e-01   -1.258880879197772e-02   +8.287797401520355e-02   +5.439403586494871e-01   +8.213051718660536e-01   +9.188757741005966e-01   +3.570522721796533e-01; +4.240327926537276e-01   +6.526968947145467e-01   +1.096052337067599e-01   +8.747337582600437e-01   +3.281131158600494e-01   -4.737495673289296e-02   +5.291406178921568e-01   +6.224577949378010e-01; +1.928976650470535e-01   -1.762457218277153e-01   +6.285289834993506e-01   +5.499947209049364e-01   +7.427184445296113e-01   +1.961433582852500e-01   +6.248439127220698e-01   +3.453799174132257e-01; +3.856288992650432e-01   +6.746328554896104e-01   +3.559621959745398e-01   +4.755308857649421e-02   +3.004632036261037e-01   +4.079872523403888e-01   +8.343690182488488e-01   +7.182964382330941e-01; +1.447761343511001e-01   +4.749837245486992e-01   +2.735645307961396e-01   +5.006051505005735e-01   +3.228499892901206e-01   +6.823070470905122e-01   +9.383178758383480e-02   +4.183486088443947e-01; +8.361651825122155e-01   +2.775056820198335e-01   +4.509200058964535e-01   +7.318037017482963e-01   +3.029985891461632e-01   +1.509214807972427e-01   -9.442583925880649e-02   +5.371132635684204e-01; +6.810220827485594e-01   +6.582351746056869e-01   +7.116565497872467e-01   +3.843709270087589e-01   +3.982640261420579e-01   +8.676479107978828e-01   +4.242867353082194e-01   +1.397069427082954e-01; +2.737990119333529e-02   +1.950089741570211e-01   +3.923096716766993e-01   +3.305754302419905e-01   +7.254445518940955e-01   +7.519186587305910e-01   +6.286507987817158e-01   +3.833984326809067e-01; +6.982175884185032e-01   +3.673220793940980e-01   +7.593005585353536e-01   +1.889647866692608e-01   +3.219897996264308e-01   +2.027325510938067e-01   +3.898232198925683e-02   +1.137302265180170e-01; +5.107784555339658e-01   +7.889543845739339e-01   +2.317434434280863e-01   +7.674739265234247e-01   +1.888235583972023e-01   +2.155791146327872e-01   +3.647512032783635e-01   -1.020190809880762e-01; +7.910543792837732e-02   +4.492354782004608e-01   +2.463697669097944e-01   +5.227015533901657e-01   +8.145124954659682e-01   +8.309644448444443e-01   +9.177392249697105e-01   +1.862300006591245e-01];
L3I_L3E_iAMPA_netcon = [+4.730055470735541e-01   +7.308890507704068e-01   +1.399959517997872e-02   +4.463328515288340e-01   +7.618059435328860e-01   +5.283294080545414e-02   +6.123287560112429e-01   +4.792011419040708e-01   +2.557469163448882e-01   +2.442614519788220e-01   +2.862585042196508e-01   +6.247001731037430e-01; +5.425695023876069e-01   +7.350151573614919e-01   +7.095670981124365e-01   +2.135885043739899e-01   +1.081397415632614e-01   +5.472588751905578e-01   +7.909502633980372e-01   +1.000000000000000e+00   +8.016955283558233e-02   +7.002879447903146e-01   +4.028178442474517e-01   +6.916464281692499e-01; +4.950644911863562e-01   +5.355536634271315e-01   +5.055304110352278e-01   -1.054237060602546e-01   +6.984132016276604e-01   +6.660300969490046e-01   +4.563701841791853e-01   +8.156435380235177e-01   +9.003435911694321e-02   +5.928909513025222e-01   +9.848943748353277e-01   +5.164376162010333e-01; +6.861289575187347e-01   +4.671498017524912e-01   +4.379309672464780e-01   +9.021809469366200e-01   +7.977274444682568e-01   +7.365764843496296e-01   +7.944362934411142e-01   +6.608864836619711e-01   -1.111776670607161e-02   +6.467202076419809e-01   +3.938343178023503e-01   +5.877806284996558e-01; +8.055752771140864e-02   +3.252793813673718e-02   +2.396571601413181e-01   +5.300197392445642e-02   +5.171945060960393e-01   +8.567052674219120e-01   +9.207675033531537e-02   +7.112557885020651e-01   +4.490194424772755e-01   +3.496375372249145e-01   +8.016083029637752e-01   +6.745261632392799e-03; +4.476776570647820e-01   +7.385486066318036e-01   +1.302286095735651e-01   +7.139902327274414e-01   +4.695251087981535e-01   +2.187647377744637e-01   +5.271901047220690e-01   -8.865589258040142e-02   +3.729740946092180e-01   +2.305525076757308e-01   +4.067348078706214e-01   +5.292600779708460e-01; +1.535758405455761e-02   +3.782044995722630e-01   +2.192520728357817e-01   +2.921387726108306e-01   +8.687056048652227e-01   +2.327588983812849e-01   +4.547665247199799e-01   +7.638070758397719e-01   +3.278316522930039e-01   +2.723035688749442e-01   +5.292774951371256e-01   +4.358341091651765e-01; +3.913839069151126e-02   +1.597457128093068e-02   +1.827304825103636e-01   +1.025941996053013e-01   +1.291703954741096e-01   +8.991784207265835e-02   +3.829944847947563e-01   +4.595417606731181e-01   +1.721595916848320e-01   +7.670517898925683e-01   +3.306817796905895e-01   +2.517549719924209e-01; +2.155293937561116e-01   +2.226035231828378e-01   +4.646184501496051e-01   +4.721529613480127e-01   +3.041966793373804e-01   +9.648751082890338e-02   +2.780392468698683e-01   +3.514395241063746e-01   +5.856443865906458e-01   -2.354159136991995e-02   +2.721300016868934e-01   +3.986475012332732e-01; +5.267733772113788e-01   +7.417113817573096e-01   +5.419325178536926e-01   +5.051029889793183e-01   -9.530337147086237e-03   +2.964377846320441e-01   +8.162977765867796e-01   +5.612351090907213e-01   +5.490890124493877e-01   +6.324384653898674e-02   +5.157145205344049e-01   +2.893817051450163e-01; +1.063812354931107e-01   +1.096176222477434e-02   +5.890315496559142e-01   +1.607072969808676e-01   +2.370156870684612e-01   +6.063958669906594e-01   +2.378031906431350e-01   +3.134581940024803e-01   +9.298594547237348e-01   +7.218298585821686e-01   +7.679589085705875e-02   +7.922358991048033e-01; -1.557144324030065e-01   +2.842017935868005e-01   +4.637276484287861e-01   +6.344615635753950e-01   +8.690694996109724e-01   +3.161721776892699e-02   +1.491278223394815e-01   +5.469955403847345e-01   +6.213238387403947e-01   +3.974304225294357e-01   +3.439488657620577e-01   +5.289253838093713e-01];
L3E_L3I_iGABA_netcon = [+6.129982588505921e-01   +1.157076360594513e-01   +2.679404273329636e-01   +7.676727094208364e-01   +4.600518251551139e-01   +9.283671242493495e-01   +8.522081506433237e-01   +7.118550933664736e-01   +7.551455766298061e-01   +1.554774175366182e-01   +1.945039560329296e-01   +6.486108947813524e-01; +5.423258811756946e-01   +4.159797768472608e-01   +8.197584745851453e-01   +4.654427688996849e-01   +6.239496106106290e-01   +5.897995976820097e-01   +9.980368662729535e-01   +2.368775573988928e-01   +6.329409825633904e-01   +2.528664613793703e-01   +3.424706335851693e-01   +4.194427074822719e-01; -1.020559527217349e-01   +1.405203785776688e-01   -3.843636853657020e-02   +4.432904269029782e-01   +4.104741761714349e-01   +5.871164185883174e-01   +7.563373012672877e-01   +6.937332544590946e-01   +4.382203703494313e-01   +4.911008680403693e-01   +5.364100668365798e-01   +4.627123430817380e-01; +6.145758978832756e-01   +8.511296041933044e-01   +7.448282123549812e-01   +1.132755947976368e-01   +8.347254023763414e-01   +2.665968547634260e-01   +6.164648695802170e-01   +5.585908164457125e-01   +5.071820943701503e-01   -6.383609459505127e-02   +7.258798283571797e-01   +6.233711900689937e-01; +1.019942255435837e-01   -1.194871285939826e-01   +3.824733375290927e-01   +4.438737388892221e-01   +4.114382344701060e-01   +2.820271476223972e-01   +6.548181852847461e-01   +4.228288621905478e-01   +4.245300735779641e-01   +2.667492244865572e-01   +4.146342163986075e-01   -2.155045719543030e-04; +2.375255339999577e-01   +1.796793974665072e-01   +7.203353728005418e-01   +7.632466959224031e-01   +4.630963069600528e-01   +2.127720288677644e-01   +6.889505461102376e-02   +2.636938004178931e-01   +4.329204694432219e-01   +9.506403043002735e-01   +7.817253847102934e-01   -1.192357762241184e-01; +3.609169065633629e-01   +3.998873665331920e-01   +7.964524800058663e-01   +3.352630623380120e-01   +4.562239369905282e-01   +7.772239899836468e-01   -1.781605544351147e-01   +6.233458608272326e-01   +6.549876292389696e-01   +4.241147247275334e-01   +5.347115074534111e-01   +4.201759725745284e-01; +1.399018549902958e-01   +3.354695654534818e-01   +4.943122751780270e-02   +9.325342509388069e-01   +7.797103689648750e-01   +3.314958276632709e-01   +5.162913497424521e-01   +1.292798462617394e-01   +3.246015988162168e-01   +3.289499818978622e-01   +4.411220473216149e-01   +9.265039538562229e-01; +5.006325277352993e-01   +1.015716769991434e-02   +6.907271452690247e-01   +6.710635585111641e-01   +6.203119688264112e-01   +5.911319899689816e-02   +2.937831068955808e-01   +7.486178524429350e-01   +3.263195497078956e-01   +9.291433327391965e-02   +4.928860841342737e-01   +6.916242148900574e-01; +1.865459113719423e-01   +7.363499954149715e-01   +9.769172362691635e-01   +7.850215660209630e-01   +4.194758528802574e-01   +3.522804052368526e-01   +7.379591498259517e-01   -2.619533564135851e-02   +9.350757705817695e-01   +6.715069956815166e-01   +3.551940487025924e-01   +7.848407994834444e-02; +2.537853457777478e-02   +7.703178169916175e-01   +2.655756000389214e-01   +4.788464342218202e-01   +7.719878762057282e-01   +3.100845087389630e-01   +7.829129210536165e-01   +8.476390817767008e-01   +4.751874247139031e-01   +4.869067286735929e-01   +1.239147343001362e-01   +8.804539441408730e-01; +6.669335226769486e-01   +1.419408872452589e-01   +5.356987100466600e-01   +7.001107209583572e-01   +7.216974273541954e-01   +7.475576577779540e-01   +3.887222226388200e-01   +3.927220038286253e-01   +6.201258291469314e-01   +3.393992015441505e-01   +3.236238291547461e-02   +2.034402029685584e-01];
L2E_Input1_iAMPA_netcon = [+9.934607975713367e-01   +9.252860787494356e-01   +9.541978510738334e-01   +9.427787720714670e-01   +9.884514096408999e-01   +7.266114605732605e-01   +8.648044278119951e-01   +7.519676006896412e-01];
L2I_Input2_iAMPA_netcon = [+9.556021841681507e-01   +8.954539693199429e-01   +7.598075653965211e-01   +9.479162453544714e-01   +8.608104141885206e-01   +1.000000000000000e+00   +7.688700152204619e-01   +8.436460076020649e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.4*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.4*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.4*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.4*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
