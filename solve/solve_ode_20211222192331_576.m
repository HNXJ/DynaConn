function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.869499647142984e-01   +3.347695119145176e-01   -3.992775228349080e-01   -1.773411511239244e-01   -4.833238734189515e-01   +5.707259589007740e-01   +5.711774134590238e-01   +4.133627511770561e-01   -7.389105864283422e-01   -4.089863170258383e-01   +6.681130511965998e-01   -3.561787949918104e-01   -2.296480369364825e-01   +5.840714165438918e-01   +5.842081531353193e-01   +2.843305243731895e-01; +6.536172349794759e-01   -1.665352252434238e-01   -6.639552131198665e-01   -4.393332365178162e-01   +7.793268140474676e-01   +2.743040114080350e-01   -1.930165653014451e-02   -7.831984334581542e-01   +6.863539337130476e-01   -5.342457391161943e-01   +6.717389398894479e-01   -8.631853051247731e-01   +2.973040134975045e-01   +3.121315168996453e-01   +1.915251906244427e-01   +2.667948758369781e-01; +6.083978751426398e-01   +7.743750431354470e-01   +2.298370340071670e-01   -3.253020408430639e-01   +4.947509393353895e-01   -2.805482681004789e-01   -1.752297917539281e-01   -5.084998555360360e-01   -4.705252173169261e-01   -1.120295955636565e-02   +4.366551118046983e-01   +1.719917086514303e-01   -3.649648126334423e-01   +1.701780859281410e-01   -1.480031273764499e-01   +1.970967979673696e-01; -2.602371267169950e-01   -2.210161233727900e-01   +1.402449894088441e-01   +2.614344606979850e-01   +6.752940635457053e-01   -4.548094327541597e-01   -6.105065560179600e-01   -1.640308434659182e-01   -1.054725472530025e-01   +2.440748963610240e-01   +3.089397150677606e-01   -1.389900680314753e-01   -1.875894668207912e-01   +2.670291875386538e-01   +1.341504158622760e-01   -1.065137664026712e-02; +1.310513770516644e-01   -2.748269011475890e-01   -4.017058555574925e-01   +2.536855911364998e-01   +3.842179416223724e-01   +7.857334439892376e-01   -9.052570361186708e-03   -3.877931191691414e-01   +5.198078220003131e-01   -9.275048062256104e-04   +1.586417489970432e-01   +8.674662277559716e-01   +5.586569078436064e-01   -4.104143121837630e-01   +7.547188017987134e-01   +3.411870498792994e-01; +5.600349604580995e-02   -4.194079478195679e-01   -5.621983459258613e-01   -6.074594466203734e-01   -5.797665943074968e-01   +4.905358382482602e-01   -9.486151596023151e-01   -3.163809799202207e-01   -3.038021005808338e-01   -3.113418566732747e-01   -7.291494805903835e-01   +3.035288960407387e-01   +6.057448637464863e-01   -1.378252075390765e-01   +1.156096889187066e-01   -2.896070773160729e-01; -4.828506810792274e-01   -3.094202573559538e-01   +6.060838095687486e-01   -8.394817296345413e-01   -2.331200800318216e-01   +7.880890251453516e-01   +5.167039352833424e-01   -3.484735244838195e-01   -1.973359426048303e-01   -5.741517713401882e-01   +8.933546564745094e-02   +3.669087655733176e-01   -4.927586161606497e-01   +6.052364223679749e-01   -2.689403635446665e-01   -2.466942938381706e-01; -9.716216120429594e-02   -4.868770469293034e-01   -4.631585762992469e-01   +7.159573029786043e-01   +6.411043188922309e-01   +3.033388242548621e-01   -5.182221493688590e-01   -2.620710154473932e-02   +6.631670728982622e-01   -3.633515361607539e-01   -2.068571962492779e-01   -6.915106014314977e-01   +2.789137600409990e-01   -3.866082249434806e-01   +5.903729564835257e-01   +4.712111430340875e-02; -2.247082941133101e-02   -9.377308250243744e-01   -2.250620168990679e-01   +4.090437921332086e-01   -6.382779710524339e-01   -1.890139024127635e-01   -4.172565399160402e-01   +3.870789385699004e-01   +3.867228445415165e-01   +4.788991561281753e-01   +1.522621016833509e-01   +1.010421208684800e-01   -1.875655609919958e-01   -5.196528706403590e-01   -9.855820762297683e-01   +7.043368609851961e-01; -3.137908637036368e-01   +8.095234819505752e-01   +5.396461520558252e-01   -2.448442624558279e-01   +6.575138361740857e-01   +4.957991614427323e-01   -3.747236139823144e-01   -2.625259069966540e-01   +2.989526246105762e-01   +1.861810326059970e-01   -5.996058530670891e-01   -7.045887996151258e-01   -9.159854224620197e-01   +3.064245103997091e-01   -5.212216491576582e-02   +3.297624126164188e-01; -4.327215151113231e-01   +2.209056801534429e-01   -8.044676858681526e-02   +2.969093311180955e-01   -2.907098607260388e-01   -1.706809113221217e-01   -5.804723367467387e-01   +3.308145652283491e-01   -1.082493903740772e-01   +3.656301482871905e-01   -4.288851662101489e-01   -1.715804272066836e-01   -9.038786153771969e-02   +2.871546413670811e-01   +9.911875190064000e-01   +5.982379956406351e-01; +2.007470364466525e-01   -2.871130130874863e-01   -2.822933201319585e-01   +3.469850410056435e-01   -5.650315124527477e-01   +3.357476273580087e-01   +2.227946843254944e-01   -2.451993241796719e-01   -2.604411056833046e-01   +5.826651519582077e-01   -3.063524945572810e-02   +6.765437099760006e-01   +1.716995517323486e-02   -1.640441603659440e-01   -4.284348695651586e-01   -2.088551914812044e-01; -5.850416010879281e-01   +2.564056992886934e-01   +8.754800243274967e-01   -1.003094167460151e-01   +4.306193768405967e-01   -2.557551979524728e-01   +5.447451585928097e-01   +2.223332481880149e-01   +1.221817030133521e-01   -1.925621774876505e-01   +6.821723728726257e-01   +7.547675962083911e-02   -1.541176659127294e-01   -2.051960957788541e-01   -6.120136943114183e-01   -5.887679239407003e-01; +5.852372309081190e-01   +4.821202741438078e-01   -5.520098851336583e-01   -6.718645303827061e-01   +5.081838132701992e-02   +8.386873735653033e-01   -5.380363931306031e-01   -4.087417059340345e-02   -6.183785650813094e-01   +1.000000000000000e+00   -7.648229829048246e-01   -3.931618917935553e-01   +9.230128991009747e-01   -3.170355755246264e-01   -5.708042596813628e-02   +5.692694898772082e-01; -1.973007234580196e-01   -4.681896718754054e-01   -3.118628441330705e-01   -3.508643759817102e-01   -4.097728538639585e-01   +6.172263761361312e-01   -5.905579869729310e-01   +7.346340607027532e-01   +2.091411313134383e-01   -4.869175507257550e-01   +2.616700662194230e-01   -5.542339970589605e-01   -2.485102677530467e-01   -2.182647925958247e-01   -5.354786978127818e-01   +8.140181705995024e-02; -1.545701206487891e-01   -5.189520071421999e-01   -9.412804324703277e-03   +5.139948339634521e-01   +3.859320538876611e-01   +1.790390885920324e-01   -4.505099870920547e-01   -9.102949960399398e-01   -1.182762544661622e-01   -1.304219183452996e-01   -5.055406614741447e-01   -1.243342526845482e-01   -5.266448329724821e-01   +9.793101451820416e-02   +8.808449793037917e-01   +1.689357374777819e-01];
L1E_L1I_iGABA_netcon = [+1.936631381696296e-01   +2.018566307727261e-01   +1.506884742678103e-01   +1.080883538387653e-01   +7.891723509950561e-02   -2.317124796038322e-01   +4.716108221476077e-01   -7.524719779633121e-01   +4.585461171561645e-01   -5.907328186027878e-02   +2.247426266533494e-01   -3.878071970615624e-01   +8.922863187789395e-02   -4.597386989549662e-01   -3.880328027960944e-01   -1.031506753621839e-01; -3.171043989044736e-01   -1.976039843522637e-01   -5.621453192580742e-02   -4.241801795499598e-01   +5.607184543038967e-01   +2.902888079739899e-02   -4.317993774942289e-01   +2.352852631886737e-01   -4.339860948192389e-01   -2.887610050837330e-01   +2.286302519477026e-01   -6.126731413892718e-01   +1.390366555982423e-01   +1.019585399884952e-01   -2.119268555767776e-01   +4.018994357847269e-01; -1.285513369838618e-01   +2.169842732518518e-01   +2.483127231961000e-01   -2.640688650052965e-01   -8.861101613558330e-02   +3.250630225041140e-01   +1.816839036264600e-01   +1.553856602039357e-01   -4.014326277754297e-01   +1.963279243652980e-01   -4.971540129135281e-01   -3.492857228711930e-01   +4.558883742705557e-02   +6.379631794441375e-02   +3.502879430099163e-01   +1.000000000000000e+00; -3.995234184948206e-01   +5.497691813987189e-01   +2.806304995790004e-01   +1.106032460430323e-01   -6.491222497422812e-01   +3.282956378217511e-01   -2.966422351907247e-02   +2.239185793917740e-01   -6.315161914788037e-01   +5.023497794246559e-01   +4.344723274180708e-01   -6.839719000236075e-01   -2.563434613673731e-01   -5.728302931938898e-01   -2.408801606506473e-01   -4.259601882805663e-01; -3.277368275100185e-01   +2.340420465672646e-01   +3.866427493493659e-01   +4.505476993911322e-01   -2.777008886842342e-01   +6.374736646392982e-01   +6.901444759875170e-01   -3.208001156930221e-01   -3.548254335151682e-01   -3.897643409960854e-01   -7.370958543490679e-01   +3.644026392481968e-01   -7.086040880195253e-02   -5.363971457545178e-01   +1.444557084456425e-01   +4.318687351297434e-01; +1.553918277530559e-01   +5.735853437916317e-01   -3.925743632548033e-01   -4.151674838542049e-01   -1.707722115316463e-01   +2.408476452912820e-01   -1.596662745861499e-01   +3.233613079852717e-01   +5.468785282193744e-01   +2.731993435557989e-01   +7.248852783362658e-01   -4.931891194675326e-01   -3.776663317621015e-01   +4.076615119187969e-01   -2.198984977505425e-01   +6.906274149440064e-02; -3.488469911684747e-01   -1.918841014183285e-01   -6.170650259469108e-01   -1.537595982380430e-01   -2.554414640473962e-01   -3.247364720545248e-01   -4.127685376279248e-01   +4.055594767654400e-01   -2.123397652608827e-01   -6.349224260891631e-01   -2.382153844264651e-01   -3.886584704284845e-01   +1.176181581882686e-01   +1.183760069590191e-01   -3.752992904566915e-01   -1.904449980700948e-01; +4.864943735445023e-01   +9.824076804212417e-02   +3.594236347077419e-01   -5.748883686682632e-01   -4.371270107453935e-01   +2.936455406882255e-01   -6.516548924899441e-01   +1.798320778755439e-01   -7.377475298099513e-04   +3.274325250545142e-02   +3.472281305288036e-01   -3.232068852909805e-01   +3.635602236303767e-01   +6.520506078930964e-01   +7.612822163426283e-01   +1.533628310995699e-01; +9.113651248176721e-02   -1.198591167054408e-01   -1.766300119566646e-01   -6.282902348286242e-01   -5.189018718018431e-01   +1.420032431702263e-01   +2.534564175056225e-01   -4.167401198602089e-02   -6.416786736491367e-01   +4.361317174164041e-01   +2.962893006848959e-02   -4.888775079183012e-01   +2.578427974342193e-01   +3.050324451170600e-01   -3.577050710205095e-01   +3.620245087291375e-01; +1.486420876670151e-01   -3.572893091260305e-02   +8.306755557709075e-02   -5.230288579475326e-01   -5.372173598670298e-01   -9.811587290967044e-02   -2.173318783264344e-01   +9.471214822432236e-03   -3.589357953985626e-01   -6.060618934353053e-01   -8.567025606911515e-01   -5.232248882542231e-01   -2.161414533279128e-01   +2.042548923841836e-01   +6.890658545242768e-01   -4.800156464983913e-01; +4.509158636977321e-01   -4.323857892373963e-02   +8.525281332144229e-02   +4.145263066393662e-01   -4.333196848325384e-01   +8.735408999416285e-02   +9.186741804340018e-02   +1.839061206813609e-01   +6.913887927669586e-02   +6.181855191454706e-02   +1.199469444202503e-01   +1.723532463873770e-01   -3.233612081053609e-01   +1.538673216841093e-01   +4.214389049057524e-01   +6.222990872309672e-01; +4.905487129582669e-01   -7.166431769928583e-01   +4.856855726646123e-01   -5.823324561195956e-02   -4.921622791098176e-01   -2.228844528118917e-01   -6.838864271918544e-01   -3.404813333314808e-01   +4.487411756826433e-01   +3.074175823578421e-01   +6.360653587186381e-01   -2.215871391380479e-01   -7.698638347650162e-02   +8.149293111801913e-02   +3.169893746773868e-02   +1.128040746107935e-02; -3.155749698398115e-01   +4.790225748097559e-01   +6.351362362685816e-01   -5.290647740748893e-01   -7.312025960367036e-03   +6.184441427171268e-01   -2.626234961981137e-01   -2.913637301330252e-01   +1.091960593042897e-01   -5.125759092142103e-01   -5.481174313061693e-01   +4.344357899431504e-01   +3.673046688784946e-01   -3.395343563357342e-01   -4.556652071395770e-01   +4.005005164634759e-01; -2.197929391458975e-01   -2.748500102920805e-02   +7.156104879679653e-02   +5.796274101486024e-02   +6.925125415576798e-01   -2.592950658268578e-01   -2.983643855079559e-01   +1.824979298965191e-01   +9.542483139477840e-03   -7.039337991534841e-01   +4.113087904230228e-01   +4.219461519386951e-01   +3.638406992971978e-01   -6.776534014070464e-03   -1.170930407804221e-01   -2.432531777352374e-01; +8.118272234804395e-02   -1.271954062162029e-01   -4.695387873113537e-01   -1.389364069177176e-01   -2.641596435440202e-01   -4.454006835937901e-01   -2.571941160210200e-01   -3.235198291112060e-01   -3.304754877867656e-01   -3.624152740226830e-01   +2.938364745060316e-01   -6.048565319384664e-01   +1.127543748602595e-01   -3.078287618189544e-01   -1.039581289996108e-01   +4.765361437377860e-01; +1.848938660453727e-02   +1.421809834699423e-01   +2.647596829724098e-01   -2.883187183121288e-02   +4.053673696958969e-01   -7.475854318803699e-01   -7.019279681892953e-03   +3.187501693852001e-01   +4.885822107073852e-01   +2.299348216699016e-01   -2.375597236558213e-01   +3.734598518978232e-01   +4.763418336930332e-01   -4.506264134394495e-01   +2.908420972198067e-01   -5.949398363611721e-01];
L2I_L1I_iGABA_netcon = [+6.147871374167515e-02   +1.030965831696244e-01   -1.063370794874924e-01   +3.040861943420505e-01   -3.458325006074093e-01   -6.350192427019578e-02   -3.921521565522746e-02   +9.835679489446197e-02; +5.137939659828650e-01   +1.057095924888689e-01   +2.918386647272705e-01   -4.040432634118078e-01   +5.317877135158944e-01   +4.983601398389976e-01   -6.608916327287987e-01   +7.231877164669527e-02; +1.000000000000000e+00   +4.961370502806562e-01   +4.708013219827967e-01   -4.948885208332112e-01   -3.159960461618387e-01   +1.870059151458626e-01   -5.460977153152905e-03   +1.749200547170050e-01; -4.728464122264135e-01   +6.950903614584560e-01   -6.246864575596329e-01   +3.617832740638291e-01   +1.815438678625884e-01   -9.651072634278038e-03   +4.014884459083124e-01   -9.412614313254865e-02; -5.815418230568151e-01   +3.632341002951701e-01   -2.356384581060696e-01   +8.312589439349477e-02   -4.238576068490892e-02   +7.078757268526610e-01   -6.142285021366903e-01   +2.583012824335517e-01; +6.195527253886010e-01   +5.407992925796560e-01   -5.786578510894052e-01   -2.778458234538745e-01   -4.099455945846910e-01   +1.878540026915938e-01   -5.178555365997669e-01   +3.172326244290670e-01; -6.022955042459313e-01   -4.557152152037672e-01   -3.085349991985606e-01   +4.097920358095773e-01   +1.480044315170896e-01   -2.451724251040881e-01   +3.923072779914134e-01   -1.565659069293786e-01; -2.895557900723455e-01   -4.366690810754787e-01   -7.192355264657991e-01   -5.341655888530386e-02   -2.608743262769603e-01   +3.711175932736751e-01   -2.799992264335732e-01   +9.070595906971929e-01; +4.933437505859904e-01   -5.012094231306493e-01   +1.973601324899533e-01   -4.356860815123265e-01   +4.066339910881225e-01   -4.104371694313738e-01   -1.818468802822606e-01   +2.145468905753175e-01; -4.378411798190979e-01   -5.434563020297364e-01   +5.635173981930277e-01   +4.854955608530339e-01   +2.093062902831597e-01   -1.666576357884154e-01   +2.976260751468369e-01   +3.254712160635048e-01; +2.280492114897709e-02   -8.681254755451255e-01   +1.272861180002276e-01   +8.169134628340819e-01   +8.733211043431600e-02   +1.382951447399126e-01   +1.400911809245884e-01   +8.623836688409042e-02; -1.032738389028589e-02   -8.161756499213588e-01   +7.403473206106256e-01   +1.176534496228519e-01   +2.370287591662891e-01   -1.922624090235402e-01   +1.223798727194888e-01   +2.970632934281066e-01; +3.104334784007813e-02   -9.922084987576020e-03   -1.489053879842086e-02   +5.022566832123060e-01   +6.845748756925041e-01   +6.274870203696501e-01   +1.665801214617189e-01   +7.290425673155633e-01; +1.208615675502656e-01   -1.819064904736375e-01   -5.963591845586338e-02   +7.089245807813226e-02   -5.027649594773507e-01   +6.242250758433198e-01   -2.564909234722485e-01   +4.050329935089745e-01; +1.709793023776585e-01   -2.160243426620859e-01   +4.766852827641353e-01   -3.405485874993149e-01   -6.351904830791273e-01   +2.927564255277921e-01   +3.518942565731342e-01   -7.833721829043515e-01; -2.153281119921905e-01   -4.121856041753055e-01   -1.195961875561620e-01   -4.943263546867654e-01   +3.217279294722088e-01   +5.294909155817334e-01   -4.205268907123091e-01   -6.906087658361788e-02];
L1I_L2I_iGABA_netcon = [+3.219586938066636e-01   +3.303982779035488e-01   +3.624817614218590e-01   -5.643474262300162e-01   -2.840582950316196e-01   +5.024385513075040e-01   -6.686764060365300e-01   +3.582175755079958e-01   +9.245834015086032e-01   -6.258776030742419e-01   +5.602039283842456e-02   -4.685882668863288e-01   +9.429704025803067e-01   -7.743274733023404e-01   +3.719536222612702e-01   +3.833130883635041e-01; -5.951980251545520e-02   -5.254176190790898e-01   +2.062177252532892e-01   +5.705469936996087e-01   +1.163580014025685e-01   +1.865018327406860e-01   -5.213843704435385e-01   +3.965527659555398e-02   +5.095418000297590e-01   -6.663358096056864e-01   +1.486380078774684e-01   -2.524071136384299e-01   +3.559647819989614e-01   -2.784613479453577e-01   -3.435871163865897e-01   +5.825924009815462e-01; -1.378651210141711e-01   -7.653546647203366e-01   -1.473744615324697e-02   -4.819394171577112e-01   -8.156608839003100e-02   +2.782637490660662e-01   -5.326796042706375e-01   -5.673161632537033e-01   -4.218489439947344e-01   +6.854944142868167e-01   -8.272788431718553e-02   -2.371436593640801e-01   +5.308035994263385e-02   -6.345189538513496e-01   +4.537574611749914e-01   -8.817366736772547e-02; +8.131886829318308e-02   -1.120663811512412e-01   -5.129119400781860e-01   +4.195343101565888e-01   -3.311973110710731e-01   +2.617990951378086e-01   -5.003148597428494e-02   -1.868353822157148e-01   +2.802050565189168e-02   -3.391557404834079e-01   -7.071271516709773e-01   -4.538945853724241e-01   +6.446802110074473e-01   +3.079342305013087e-01   +6.148952280031100e-01   +2.076443284433137e-01; +6.327501471874927e-02   +3.350277033018340e-01   -7.588448803837767e-01   -6.117980961656116e-01   -2.752761618247848e-02   +2.431569752684888e-01   -3.994068207886515e-01   +5.687958058139054e-01   +3.203503897785343e-01   +2.532236761378031e-01   -8.286624286533434e-01   -6.498837481553149e-01   +3.211232834295913e-01   +1.404105821242122e-01   +5.708866554100680e-01   -4.544809990534704e-01; -5.951616422264452e-01   +3.053857320240964e-01   +8.492979657177474e-02   -4.534687220097541e-01   +2.458204414137302e-01   -6.797680448020583e-01   -5.521748635963233e-01   -8.592999526218860e-02   +4.214055516670678e-01   -5.461239331730341e-01   +2.762932417391811e-01   +3.047979043888318e-01   +6.896943788985369e-01   +5.373647210587438e-01   -5.001463993773816e-01   +6.043247484210221e-01; +4.388277559214772e-02   -4.390456259503384e-01   +2.215370083516865e-01   -1.681061654519928e-02   +4.163229038371046e-01   +1.991486118306594e-01   -5.383699642461676e-01   +4.550219512865346e-01   +7.368008839530285e-01   -7.838165901770736e-01   +8.685104329602963e-02   -4.441247902595636e-01   -2.736670927024816e-01   +6.531039440186852e-01   +3.619912578728647e-01   +5.402640543001246e-01; +5.571747095845934e-01   -3.715367077035521e-01   -8.098006318202047e-01   -8.113005984656878e-01   +2.241805707221957e-01   +6.268351019702165e-01   +9.928336214954146e-02   +6.973316408904752e-01   -4.323281993137099e-01   +1.000000000000000e+00   -1.130411314625373e-01   -2.576532760977801e-01   +2.891083587195317e-01   -3.158303907011770e-01   +3.514958551963406e-01   -1.187872144609837e-01];
L2E_L1E_iAMPA_netcon = [+3.934797424021418e-01   +4.381078140170975e-01   +9.266798633859076e-01   -6.879768214740996e-02   -4.713957824329855e-01   +1.619323845408615e-01   -5.223440319343668e-01   +6.026172546887723e-01; +2.117297692814883e-01   -3.570119465456905e-01   +2.884577792928059e-01   +1.282913618617358e-01   -1.845333832176618e-01   -2.645640883598706e-01   -1.698845170408896e-01   +3.514310894674001e-01; -4.794417875451215e-01   -5.199224529136455e-01   -1.487070957662609e-01   -1.000000000000000e+00   +4.268101249870977e-01   +5.998093897331097e-04   -4.488968522978536e-01   +2.289424379908740e-01; -2.441959692297004e-01   +4.416555135921667e-02   -1.274687927090070e-01   +5.503298480279237e-01   +1.535035661075897e-02   +4.447214722700643e-01   +1.604049392798428e-01   -3.823050116586958e-01; -3.510125990363628e-01   +6.350097531515725e-01   +3.417563137483614e-01   -3.952525982858882e-01   +7.336925169463507e-02   -2.225334788375394e-01   +6.102130948982271e-01   -2.759930123860928e-01; -7.597645244219879e-02   +1.859687216291301e-02   +5.497533967934409e-01   -1.133593943597341e-01   -5.851113115503469e-03   -4.916992553989532e-01   +2.682684122432987e-01   +3.597051524317028e-01; -2.352225586030811e-01   +1.420727811297575e-01   +2.892073662852750e-01   +7.708069116091244e-02   +8.590065670316832e-01   +6.952199320550352e-01   +4.514460098219881e-01   -2.697342990489976e-01; -5.424565517479316e-01   +3.630257834472191e-02   +3.995485769559089e-01   +3.043556852428559e-01   +2.625218723651027e-01   -4.221954689761100e-01   +1.872548120396328e-01   -2.014543074649389e-01; +1.406754133974885e-01   +5.162271086006033e-01   -2.092848616697529e-01   +7.493396916584059e-01   -2.299608275055510e-01   -9.810907690245400e-02   +3.136033042482345e-01   -2.574603027675206e-01; +3.243928085887254e-01   +5.447251223693484e-01   +4.280556318325629e-01   +7.425744101250457e-01   +5.336107523309536e-02   -1.218079270080041e-01   +2.670425134088517e-01   +9.189405431411796e-02; -4.745400019397106e-01   +2.869777820935137e-01   +4.799006414348949e-01   +5.870359277970622e-01   +5.537750315706070e-01   -3.045534398957401e-01   -3.365457486524223e-02   +3.377865378142879e-01; +3.196230614966809e-01   +1.487088386619982e-01   -3.354994847432063e-01   -2.281060394702243e-01   +2.537143004678236e-01   +3.414303000461145e-01   -5.532916786825531e-01   +5.131113000530657e-01; -9.187421925701914e-02   -5.146775967026562e-01   -3.049701091639579e-01   -1.787347222068326e-01   -3.131404313956526e-01   -3.795123273306243e-01   +5.543323194478281e-01   -7.785215805574539e-01; +3.480598231259201e-01   -7.815515189740342e-01   -3.077066737153969e-01   -2.721547351632628e-01   -5.241765893337090e-01   +8.418969827770217e-02   +5.145043445270324e-01   +3.313268653066199e-01; -5.860380719435672e-01   +1.775137040868053e-01   -6.696513429116459e-01   -4.655288642970412e-01   -5.853838584759100e-01   -1.427945398350325e-01   -2.498495484130847e-02   -2.353051349728381e-01; +1.556075347493724e-02   +5.517160081237995e-01   -2.045902166090554e-01   +3.673931141748465e-01   -5.872959369888463e-01   -4.372799698755855e-02   -8.053430283851910e-01   +6.311468779326939e-01];
L1E_L2E_iAMPA_netcon = [-4.817087154746442e-01   -2.732761145105941e-01   -3.307590130022839e-01   +7.498055164406559e-01   +7.107969526171740e-01   -1.211620240543520e-01   -3.763850265941999e-01   +8.788003732352391e-01   -5.328158800048588e-01   +5.023881886343460e-01   +5.635554058961560e-01   -2.118522410489682e-01   +5.898186684341697e-01   +3.190889982817033e-01   -1.297846915680634e-01   +3.709509245509434e-01; +4.619991925775255e-01   +1.133993295628922e-01   -4.727926915033377e-01   +4.513084661525590e-01   -4.545960213616025e-01   -8.052715866744579e-02   +2.996962249811229e-01   -7.840121633305971e-01   -4.566088955098843e-01   +5.387140780473631e-02   +4.216317563403252e-01   +1.379169378630477e-01   +6.654264203446300e-02   -7.028833664338469e-01   +6.652746441784194e-01   +2.744675621402003e-01; +9.364077034319829e-01   -1.366340918257664e-01   -5.534088286903323e-01   -5.750073898446567e-01   +4.241946507127999e-01   +3.391237793311788e-02   +9.127245179493565e-01   -2.491443601720095e-01   -5.505359107632698e-01   +3.284936992572339e-01   +8.031927495245207e-01   -8.776787528298087e-01   -4.701512733432792e-01   -3.077604079518420e-01   -1.970388514462197e-01   -2.995777008537525e-01; +5.156430556742346e-01   +5.901425941734799e-01   +4.705018969915575e-01   -1.875122524049664e-01   -3.010824588507436e-01   -2.602322198011632e-01   +1.665665470930920e-01   -1.094828108930761e-01   +5.739480999662779e-01   +5.769107952594351e-01   +4.501173372584217e-01   -1.000000000000000e+00   +6.636225793229048e-01   +3.277269351509283e-01   +5.278703920432681e-01   +4.296851031235999e-01; -8.164605976241714e-02   +3.705983767895004e-01   -1.294666200465322e-02   +3.865069931197509e-02   +3.980880554643403e-01   +1.168974620716804e-01   +2.258472013537726e-01   +5.209461965697200e-01   +8.898369405293176e-02   -4.400377903667537e-01   -4.133440893049875e-02   -3.111885660039658e-01   +1.861591840166623e-01   -1.885654715396576e-01   -3.125096152726797e-01   -4.914961169669507e-01; +6.524426217860030e-01   -2.581803029111268e-02   +3.731916582182349e-02   -5.877116182140228e-02   +4.257627094298442e-02   +8.852193867698557e-04   -5.538647231545243e-01   -8.197850321298832e-02   +1.759460684816333e-01   +4.794442296227131e-01   +1.287953455736541e-01   -3.439268571028449e-01   +4.927047259526585e-01   +6.238468248831959e-01   -6.814870658132023e-01   -2.982619338253383e-01; -1.376794671248414e-01   +8.120509316127194e-01   +6.627575272181098e-01   -2.856096431568362e-01   -3.708074988462364e-01   -5.488663906328677e-01   +4.912334787954883e-01   +1.973448641204811e-01   -8.213731450039103e-01   +3.312883382762956e-01   +6.526841252285025e-01   +6.712945733913486e-01   +4.532397858558137e-01   -2.545887397450155e-01   -4.761449361589162e-01   -8.057522822683401e-01; +7.875724715096766e-01   -1.136537323684187e-01   +1.607049088378864e-02   -3.766712061771854e-01   -6.361757746372287e-01   -5.486067037172873e-01   +4.172542808488744e-01   -3.009993987628783e-01   -9.860535314015197e-02   -9.189353105961620e-01   -5.238285916450141e-01   -6.583409703178351e-01   +7.699002945184327e-01   +1.078930065270633e-01   +4.009744406594166e-01   +7.370799283548465e-01];
L2I_L2E_iAMPA_netcon = [+3.951406266377375e-01   -2.121762044759528e-01   +2.558119555772949e-01   -6.164014839370456e-01   -5.140422229309883e-01   -2.607391846498378e-01   +4.866741347703352e-01   -5.146456910909726e-01; +3.333183339858242e-02   -7.971772308987399e-02   +6.291153171466409e-01   +3.425204902007267e-01   -1.120719633466889e-01   +5.831817413640953e-01   -4.796761830868947e-01   -7.113546850885268e-01; -6.128854506202496e-01   -4.678860516270256e-01   -4.600122535034173e-02   -5.801545102204611e-01   +1.063714211162116e-01   +9.496861085723457e-01   +1.403282002717874e-01   -6.639614740397686e-01; +1.608514232321740e-01   -3.506954025785992e-02   -8.123092574002355e-02   +1.924866196173739e-01   +3.766912264998186e-01   +5.608993100009720e-01   -3.684541744598132e-01   +1.808339472727776e-01; -9.036231662409286e-01   +1.908337764151639e-01   -6.135395280532134e-01   -5.140686564651856e-02   -4.742601712237450e-01   -9.194178636580375e-01   +6.941010445692506e-01   +5.050278462119614e-02; -7.751548093459479e-01   +6.555694428152481e-01   -6.933124622555057e-01   +2.572128513826745e-02   -2.443357181372169e-01   +5.866395523879286e-01   +2.025201518931883e-01   -2.078454882976809e-01; +4.069378206745458e-01   +2.422351133783529e-01   -7.808381404049430e-01   +3.688606747008877e-01   +5.485294282573825e-01   -3.577394200685342e-01   +3.853524144988842e-01   +3.735995062290799e-01; -2.040573903696452e-01   +4.536419856940428e-01   -4.976397901274519e-01   +1.972950646856024e-01   +3.725925538997670e-01   +6.807362436649806e-01   -2.921902012938962e-01   +1.000000000000000e+00];
L2E_L2I_iGABA_netcon = [+4.057190713023699e-01   +1.589069664058267e-01   -1.157073742420103e-03   -1.000000000000000e+00   -2.142833923648942e-01   +2.136937413398812e-01   +9.534774572277354e-01   +3.906402594835492e-01; -5.983463368907646e-01   -4.311760960877278e-01   -4.734337104405590e-01   +4.445196002844711e-01   -5.800169333953050e-01   -8.895580573567269e-01   +8.755240744639190e-01   -5.049364503408552e-01; +1.873916244583316e-01   +1.630684384833383e-01   +6.171490892669749e-01   -4.720198392672283e-01   +5.627304548363173e-02   -4.504574176468512e-01   +2.789543031655365e-01   -7.849612705256797e-01; -4.040556727499979e-01   -2.990476043534333e-01   -2.708708980716152e-01   -3.707362976676649e-02   +4.335405133420368e-02   -4.383710297816733e-02   +1.497426354888123e-01   -8.338417691791472e-01; -2.272084272465353e-01   -1.455789149056627e-01   -5.489132108120354e-01   -1.824369738465328e-01   +6.272769178243269e-02   +2.757496229170118e-01   +1.601910812953040e-02   +3.073493912739498e-01; +4.214783501189929e-01   +9.911795582151149e-01   +3.810875887362799e-01   -1.560267644594217e-01   -3.318023223509681e-02   -2.730735569583275e-01   +9.036857454030800e-01   -6.558805034231747e-01; +3.306799791346481e-02   -3.189184575494496e-02   +5.698979830954513e-01   +1.671203079478122e-01   -2.803047913030848e-01   +3.892270690973996e-01   -7.553494049774360e-01   -5.088789167684277e-01; +2.754712077355436e-01   +3.306440799584230e-01   +1.891571323959822e-01   -1.053661040129027e-01   +4.896089963999716e-01   +2.590393455490714e-01   +2.699761649244928e-01   -4.920464617712352e-01];
L3E_L2E_iAMPA_netcon = [+2.284962325422657e-01   -6.887566997398050e-01   +2.586560590984717e-01   -1.000000000000000e+00   +7.736918429534169e-02   +2.155553865181826e-01   +5.143921883883378e-01   +2.024955871661052e-01   -8.835498212168843e-01   +1.888561141006539e-01   +3.424091094511705e-01   +4.788366961895852e-01; -5.103317124989680e-01   -3.488927991929394e-01   +4.545847529188716e-01   +1.451374161376518e-01   -2.166251891789425e-01   +4.895414069047916e-01   -6.874157411173778e-01   +5.070021545983673e-02   +2.297473889806314e-01   -2.502809185447479e-01   +5.774786886712845e-01   -3.933189852562964e-01; -2.670751733293060e-01   +4.086524241109787e-01   +3.415589981194662e-03   -8.646238028214761e-01   +7.067986511891938e-01   -1.029373248772531e-01   -2.112798383759601e-01   -2.488819906040605e-01   +6.996091771667572e-01   -6.772680978924703e-01   +7.829351183841501e-01   -2.994707213738828e-01; +7.418655670214329e-02   -1.352309934948466e-01   -4.957845152397766e-01   -2.113288735661256e-01   -7.869720517287380e-01   -1.685424363099460e-01   +2.863305599457975e-01   -4.950931197489581e-01   +1.792032534613113e-01   +5.099265768991804e-02   +5.192352532205972e-01   +3.370343985436939e-01; -2.609348670280742e-02   -6.584438491056495e-02   -7.071692606258996e-02   +5.344403354697683e-02   +3.627343927314974e-01   +9.174123070455149e-01   -7.237485623093816e-01   +8.161871429536860e-01   -6.556554129503164e-01   -5.777307055465988e-02   +5.974204375894655e-01   -4.229477915399990e-01; +3.745771363633193e-01   -4.352096416175325e-01   -3.497442333398114e-01   -5.149310202855820e-01   -1.981609756031704e-01   -5.563071191781245e-01   -1.365126970555540e-01   +1.254406276617366e-01   +3.121853219754604e-01   -1.611947029936865e-01   +2.299180805483095e-01   -3.168547463635257e-01; -2.851244560554150e-01   +2.127046061352296e-01   -6.104263180902272e-01   -1.627448678586776e-01   -3.548425765670700e-01   -4.290135330696720e-01   -2.890923730681629e-01   -4.940984798699907e-02   +9.415902648238381e-02   -8.706426330454851e-01   +1.146323249732891e-01   -1.956464298363145e-01; -4.001276650057335e-01   +4.771310453321392e-02   +3.717855930227322e-01   -3.901684634981645e-01   -4.693218672185467e-02   -4.950021622222655e-03   -9.981490665940389e-02   +3.650242863780800e-01   -7.903748239373276e-01   -2.414598406749019e-02   +9.030111820800504e-01   +2.142581102889198e-02];
L3I_L2I_iGABA_netcon = [+3.592585382577245e-01   -5.176948204659523e-01   +6.282693185690727e-02   -4.370332188995342e-01   +2.859006837566286e-01   +6.111813027606169e-01   +2.872725379236910e-01   +6.683072705516544e-01   -3.560767862058075e-01   +2.428769585462487e-02   +5.763437764453201e-02   +4.060945435094305e-01; -4.309317557618567e-01   +3.444029921621428e-01   -6.317776459860649e-01   +7.914440137292595e-01   -5.580809763993808e-01   -3.042164304090989e-01   +4.429711705380167e-01   +6.244353621213345e-01   +1.766905180412859e-01   -3.158537838801899e-01   -7.596774907730204e-01   -2.021303349028779e-01; +2.527905654950963e-01   +3.521488901179504e-01   +4.303777828462495e-01   -3.168108039283464e-01   -7.325978668246440e-01   -4.829352134564963e-01   -7.245353464275200e-01   -5.855044239195143e-01   +8.427483451536322e-01   +5.217130035334234e-01   +4.025542775802832e-01   -8.267507337844969e-01; -9.239914418992792e-01   +5.154029643688986e-02   -3.316859121795424e-01   -6.816339740369434e-02   -7.073588619576736e-01   +4.194951558721947e-01   +2.747561076585378e-01   -4.528172393199382e-02   -3.081730940023756e-01   +4.050539537610381e-01   -4.754099232422467e-01   -3.675327382520187e-01; -2.676821667828213e-01   +6.226242725328771e-01   +8.199325944412126e-01   +8.897831095940077e-01   +2.512507885655756e-01   -6.362962148785563e-01   +4.568715997442681e-01   -2.020385326071965e-01   -1.000000000000000e+00   -7.390178942992630e-01   +1.867946787091170e-01   -4.860241560367135e-01; -2.584265956763872e-02   +2.870561372051783e-01   +2.763052822364501e-01   -9.316866853100885e-01   +3.049611970632587e-01   -3.875663551851546e-01   -1.648966639552349e-02   +1.345831441243249e-01   +3.444189267025933e-01   +1.214354194064426e-02   -5.857064066379297e-01   +2.212883167197660e-01; +8.342185728785617e-02   +3.198846267045966e-01   -1.592094684774779e-01   -4.221308237560488e-01   +2.037280734287162e-01   +2.488636673354825e-01   +1.535007446053589e-01   -4.753535123713681e-01   +3.390763479502891e-01   -3.458926066090166e-01   -7.229342088187598e-01   -4.053881238201038e-01; +3.899155913765633e-01   -1.466765614041320e-01   +1.085966301580132e-01   -4.523937670835358e-01   -4.306291832040396e-01   +2.510671723634635e-01   -6.221184929103778e-02   -4.965532476201547e-01   -3.802300393173517e-01   -4.004258324353525e-01   +3.736709005101090e-01   -2.698192065576792e-01];
L2E_L3E_iAMPA_netcon = [-5.020320387840486e-01   -1.128090644989673e-01   -3.534243928712351e-01   +1.666852680093206e-01   -6.885527906755933e-03   +1.428840282811205e-02   -4.611550306834023e-01   -5.150278840018862e-02; -1.719071614590056e-01   -5.574115390913866e-01   -2.185128395478799e-01   -1.865102805279821e-01   +3.567010227537163e-01   +5.516958720968327e-01   -3.531878050586469e-01   -4.768824751698316e-01; -5.551180766657279e-01   -7.855336061960164e-01   -4.858428010112582e-01   -9.599059306256270e-02   +1.185810667537553e-01   -2.712160289347829e-01   -6.170989221769878e-01   +5.252522228246164e-01; -2.509745255557420e-01   -2.450727769404915e-01   -5.610977963155430e-01   -2.610514787186142e-01   +6.630645828932396e-01   +5.795055075176078e-01   -3.213255419027195e-01   +1.773288423164974e-01; -8.654978073984081e-02   +2.353447486968932e-01   -1.740474010309356e-01   -4.635776025713416e-01   +6.073083195306118e-02   -2.086720189625206e-01   +1.000000000000000e+00   +1.334470275424883e-01; +3.396014641237981e-01   -4.514124922698077e-01   -4.664199812461884e-01   +1.175641127600096e-01   +1.676031138636471e-01   +5.209589896969268e-01   -2.975824109440761e-01   +5.516924960266316e-01; +1.330897456111750e-01   -7.286285703621038e-01   +4.761565469269643e-01   +8.661346751842637e-02   -5.118429664508967e-01   -3.997881042088577e-01   +1.649392675137034e-01   -4.522044610257385e-01; +7.132320861557587e-02   -3.757714529826490e-01   -1.286007846502023e-01   +4.610796066356064e-01   -4.009596751573465e-01   +5.022146484809014e-01   -2.446705550983263e-01   +1.086651543450858e-01; +1.199287638833059e-01   -3.596312064917623e-01   -3.013603164665148e-01   +1.649282282080712e-01   +6.265756670450834e-01   -7.177872913441515e-01   +1.010430458465712e-02   +1.381833269549333e-01; +2.568870628876196e-02   -9.351861509055888e-01   +3.953600925865947e-01   -2.774011492776201e-01   -9.596481619568926e-02   +2.848333084781152e-01   -9.895363891013664e-02   +2.385100216313032e-01; -5.984113226265011e-01   -6.054115617725981e-01   -2.074541689040498e-01   -2.173230280399121e-01   +3.495528276250437e-01   +7.282079443460910e-01   +4.535152562492734e-01   +4.425798788154485e-01; +4.532991401884530e-01   -2.642341730595821e-01   -4.406925765550935e-01   +2.386257505229653e-01   -1.757406578256143e-02   -1.048042616123019e-01   -4.968590891735959e-01   +6.539955764536557e-01];
L2I_L3I_iGABA_netcon = [+6.791936744054233e-01   +6.073041898431922e-01   +1.242492799998424e-01   +8.679807134645588e-02   +4.804010330207956e-01   -7.359412928374078e-02   +4.551031817578521e-01   +1.685233339274915e-01; +1.393434984699251e-01   -2.544203893171832e-01   +6.167687219808811e-01   -2.046018273822751e-01   +2.000408055160376e-02   -1.779864817227468e-01   +8.201251419995777e-02   +1.591576851334436e-01; -7.279923549404085e-01   -1.906073666810618e-02   +6.625884599110935e-01   -4.632553576981577e-01   +2.576458134651453e-01   +9.378816704671553e-01   +7.943369459102352e-01   +2.514628096508025e-01; +7.055300945584662e-01   -8.587816230426734e-01   +8.927208999715653e-01   -1.972278026453327e-01   -1.166131797050224e-01   +2.639403353712171e-01   -9.420615624237691e-01   +7.057615714928563e-01; +9.050183555735822e-01   -3.086898189962400e-02   +2.066139231063172e-01   +5.852293978907565e-01   +3.616101952087868e-01   +5.665222274614644e-01   -4.380519569264238e-01   +8.080975502045661e-01; -5.800920112245792e-03   +3.490098760890661e-01   +3.992136959374804e-01   +7.322903015181473e-01   +3.318563991206239e-01   +8.482174136375424e-01   +4.057078747158555e-01   +1.823453055415117e-01; +4.699794554969660e-01   +3.618959762634892e-01   +2.851613484577581e-01   +1.675937633444289e-01   +3.304130892559105e-02   +3.400949613431475e-01   +7.131683705924070e-01   +5.301700528462517e-01; +4.068077756630684e-01   +1.000000000000000e+00   -1.634706078714933e-01   -1.856965484515524e-01   +3.168593251103808e-01   -6.935221478701724e-01   -4.194315717305596e-01   -3.097122290669785e-01; -1.095844808763272e-01   +7.191620223625522e-01   +4.655720404804275e-01   +2.066713114236452e-02   -2.806385559662579e-01   -7.371855770174127e-01   -4.217651816680850e-01   +1.066765733489135e-01; -4.891154264925705e-01   +4.023993266494645e-01   -3.600933246412915e-01   -6.801033531076490e-01   -3.256264952463644e-01   -6.508020593735285e-01   -5.988254179556717e-01   +7.746757304996089e-01; +8.527035002318849e-01   +8.030788565397324e-01   +5.025645400258338e-01   -1.016574785810778e-01   +5.598721195780170e-01   -7.089201841206606e-01   +5.707309485116157e-01   +7.783466037524442e-01; -6.851254858240496e-02   -3.923923805733514e-01   -2.500407598433473e-01   +9.369760770361949e-01   +9.728053810410799e-01   +1.089188378484141e-01   -5.400671665994276e-01   -2.411802877740682e-01];
L3I_L3E_iAMPA_netcon = [+8.806589570375002e-01   -1.533511439978515e-01   +5.541599075344149e-01   -3.415649294224522e-01   +7.060629731813625e-01   +4.090162804895531e-01   -1.591188836586818e-01   -4.327018694558702e-01   +6.847420293423733e-01   -7.341793729206608e-01   +3.536326569948764e-01   +3.686796006295445e-01; -1.698342102913106e-01   -3.232352570937579e-01   +3.229376551721848e-01   +3.443475787318135e-02   +6.540932370730679e-01   -5.214042267762502e-01   -9.170223355727894e-01   +1.285815295921412e-01   +4.605762781383435e-01   +1.462174614275044e-01   -9.004184598837367e-02   +2.917242452074487e-01; -7.539053198447018e-02   -3.230028960835452e-01   -4.537437707184574e-01   -3.358187403766479e-01   -6.407710931942044e-01   +1.407544914011866e-01   -1.270485366942864e-01   +1.591970223764537e-01   +5.074890427575841e-01   +6.677792066879780e-02   -3.024101522184202e-01   -5.816556103884432e-01; +5.417320748759379e-02   -4.913032479541324e-01   +8.919551170025862e-01   +9.153180899119769e-03   +4.735408230627250e-01   -2.916449361388055e-01   -3.391560176499325e-01   -5.114301506602915e-01   +2.715743531653471e-01   -5.176134339610134e-01   -6.594488751429726e-01   +1.000000000000000e+00; +3.596970056615280e-01   -2.838004937667444e-01   +7.832510887936281e-01   -6.775436787674176e-01   -5.402519770102097e-01   -6.910172026343503e-01   -5.727567646994451e-01   +1.651586894103491e-01   -2.857514201820759e-01   -6.389210958301590e-01   -2.151283548328137e-01   -4.356344916281767e-01; +5.457004647248349e-01   -8.092322206416471e-01   -8.325990691262095e-01   -4.922829892479492e-01   +9.102908340174644e-01   +3.939497088330868e-01   +3.221845690260346e-01   -2.814078719044210e-01   -2.724318902659277e-01   -2.135633344187144e-01   +6.311041505184972e-01   -6.757997669408671e-01; -2.092791969736347e-01   -4.781922715079623e-01   +1.697179315673943e-01   +2.638394442452975e-01   +6.551099051047803e-01   -3.380669814233635e-01   +8.489259984861908e-02   +8.222445051526817e-01   +4.505193695320768e-01   -2.091398683254417e-01   +2.656381009907938e-01   +1.227141193313626e-01; -1.226696600384312e-01   -5.872696645451392e-01   +3.107199303980246e-01   +2.847826024900114e-03   +1.805500688101705e-02   +4.973040658932878e-01   +3.175805655126017e-01   -2.005699673093833e-01   -4.167567829408606e-01   +2.945947918088310e-01   +6.377942859181711e-02   +5.069768563910972e-01; -7.555265841516309e-01   -5.977587799017767e-02   -3.593275122241277e-02   -3.319940194962368e-01   +1.900464349373434e-01   -5.524906081181149e-01   +8.228679296679940e-01   -2.393885958954952e-01   -4.625366700000517e-02   -3.476465797191554e-01   +2.455226205968521e-01   -1.471212475655164e-01; -6.441990254804065e-01   -1.437251711801832e-01   +6.939241443431053e-01   +2.494425859901563e-01   +6.647622983283753e-02   +8.450412998265417e-01   +3.981852898585156e-01   +1.323672920232030e-01   -6.141137211512833e-01   +5.526720069421007e-01   -4.587063657033261e-01   -2.049201472811362e-01; -3.467540522437330e-01   -6.687887297995448e-01   +2.573580741575636e-01   -8.210628860506599e-01   +3.477593191804117e-01   +3.123492540390523e-01   +2.626233907440880e-01   -4.323369557994716e-01   -3.801158595242218e-01   +1.404298779675121e-01   +9.630038107900639e-01   -1.695392372438007e-01; -1.646724007408160e-01   +3.269881721008736e-01   +1.724475089080080e-01   -5.215948135581933e-01   -4.695360864638441e-02   -2.080646506418333e-01   -1.486934029218197e-01   -7.632659130034228e-02   +5.292202563414899e-01   -2.600555867197585e-01   +1.714944793332921e-01   +5.054279932653644e-01];
L3E_L3I_iGABA_netcon = [+5.703655534844224e-01   -3.611519699536557e-01   -3.464346886328311e-01   -7.996946802332526e-01   -3.899895657591625e-01   +4.420525219280600e-01   +6.079785615519291e-01   -2.536445961147888e-01   +5.478099837512507e-01   +4.204207023761962e-02   -7.839940974146657e-01   +8.573555460262923e-02; -1.202220439380395e-01   -2.421822243611593e-01   +1.481910833931639e-02   +3.045542647011830e-01   +1.078372182369255e-02   -3.742072893169910e-01   -6.040607395665943e-01   -1.007878012195560e-01   -1.970848796932651e-01   -2.451994651967681e-01   +4.305169967788675e-01   -4.321173865312274e-02; +4.482782796642650e-01   +1.849144944477237e-01   -2.004019107208574e-01   +3.995272073707665e-01   +3.171430187135869e-01   -5.718517272732965e-02   +7.052614866057428e-01   +2.079541991956735e-01   +1.795988337519549e-02   +2.189605654737086e-01   -6.494730093924015e-01   -1.560418185271955e-01; -7.529624374619300e-01   -3.160716455899542e-01   -6.178528151576905e-01   -8.880895415893456e-01   -2.904755815561582e-01   +5.906161156494808e-02   +2.598947477753213e-01   -5.033758155179605e-01   -1.052068936226301e-01   +2.427722944843987e-01   +9.556395287018998e-01   -2.519601314714321e-01; -2.479267571625187e-02   +4.003602672309191e-01   -5.433957126786721e-01   -2.322094506602930e-01   -8.153707774159816e-01   -1.061303483741017e-01   +7.145163434542784e-01   -3.917738993888915e-01   -2.135154310989550e-01   -2.741032233612323e-01   +4.183478853677135e-01   -5.125709889301462e-01; +9.603814102269762e-01   +3.944926492000118e-01   -8.510563310623885e-02   +1.311514790264417e-02   -8.388138296513694e-01   -7.161632304636446e-01   -2.674163774077451e-01   +6.687398308585497e-01   +5.281267897034223e-02   -3.969703460603679e-01   -4.333966719831586e-01   +4.761542523178594e-01; +8.034775039986951e-01   +2.936061729297462e-01   +4.842585296344570e-01   +2.235644852369634e-01   -1.991186554453222e-01   +5.350483744192166e-01   +4.513832286215890e-01   +9.252313906882675e-02   +4.352457807589805e-01   +6.351318876494921e-01   +6.802084819851237e-01   -8.004835804082182e-01; +5.053017190222728e-02   +4.044072643687443e-01   -5.967932403086288e-01   +1.000000000000000e+00   -6.785079345957232e-02   +5.556662975842620e-01   -3.435538450984167e-01   +4.872194988894768e-01   +8.530311790087662e-02   -5.665875360662851e-02   -3.880293956742480e-02   +2.007581142644339e-01; +6.301907547100523e-01   -3.716348668989348e-01   -1.910784433385861e-01   +5.093201387511600e-01   -3.363446252486341e-01   -7.594815007724511e-01   +5.096739880005943e-01   -4.300730139856692e-01   -1.463069445502996e-01   -5.195675887201622e-02   -3.191738218154970e-01   +3.158365045157136e-01; -2.473995739741166e-01   +5.836337965442066e-01   -5.022015868796148e-02   -6.548926351099817e-01   -2.116477127999677e-01   +5.075219845967257e-01   -3.483380700794503e-01   -2.776375731755935e-01   -1.886411962658616e-01   -1.222244230975737e-01   -3.482864222650209e-01   -5.619697872659855e-01; -1.032334078367928e-01   -7.803297180234529e-01   +5.096458157177637e-01   -3.707923014051467e-01   -3.929900960437880e-01   -2.980146972367839e-01   -5.560534484822301e-02   -4.536809042730200e-01   -3.398225459300362e-01   +6.752406984895056e-01   -6.071568644388839e-02   +1.351374692978715e-01; -4.058488685713176e-01   +3.314324158250797e-01   -1.631765936356986e-01   +5.720339637043222e-01   +8.706933606309283e-01   -2.980297112463212e-01   -2.906278863193371e-01   +6.279857453261347e-01   +9.119937829332092e-02   +5.828037474750095e-01   -4.501560710965912e-01   -6.771214236012335e-01];
L2E_Input1_iAMPA_netcon = [-9.804977647687724e-02   -9.775608540208987e-01   -1.647440634912281e-01   -9.104589584410918e-01   +5.596156504518583e-01   -3.783436390338090e-01   -4.414029591815871e-01   -6.380287307213534e-02];
L2I_Input2_iAMPA_netcon = [-2.435633431412310e-01   -8.687432421080806e-03   +6.746059292996920e-01   +1.768397766543484e-01   -1.000000000000000e+00   -1.924191929491123e-01   +8.867160502667090e-01   +3.753117702290821e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.4*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.4*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.4*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.4*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.4*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.4*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
