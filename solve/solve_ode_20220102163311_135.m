function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+6.877534520230014e-01   +1.493161009418890e-02   +3.224829819794792e-01   +3.292833137763763e-01   +6.444795593331025e-02   +4.057422671018965e-01   +7.155150863036452e-01   +1.631812739172291e-01   +3.107123537153392e-01   +6.116379677898816e-01   +3.098609600672705e-01   +6.575772856674862e-01   +3.497431246199117e-01   +7.280622845157132e-01   +3.820070720618307e-01   +2.829203510544465e-01; +1.422764772471698e-01   +4.332249802350986e-01   +3.006386261086396e-01   +1.136437261714767e-01   +2.346965091707617e-01   +6.376867366081689e-01   +1.278168295607136e-01   +3.259506692357081e-01   +5.072497650754304e-01   +7.569344392866468e-01   +2.267159256642112e-01   +4.915354763971951e-01   +5.242789291350539e-01   +2.597408485764068e-01   +6.953853703028825e-01   +4.428237839958481e-02; +7.301648912001948e-01   +3.653645889454530e-01   +8.004567432204547e-01   +2.198795036514028e-01   +7.232183858755592e-01   +7.196903095303263e-03   +5.283721490764840e-01   +8.332901750400803e-02   +5.170255465116240e-01   +5.822343678661425e-01   +7.613846734684928e-01   +3.609415501853567e-01   +1.147272017667399e-01   +5.250735445795127e-01   +3.959968220517273e-01   +5.400261150421323e-01; +6.900794645160456e-02   +2.604046498469498e-01   +5.958406266203210e-01   +7.284060159655075e-01   +6.544040077988708e-01   +2.930600006524726e-01   +2.243571402169654e-01   +2.427157192782647e-02   +6.105607429523362e-01   +1.057205268634903e-01   +4.049636828799631e-02   +1.784194719970143e-01   +8.068483575345430e-01   +6.960011721100032e-01   +7.352647230090535e-01   +2.405678177302387e-01; +4.428561846794260e-01   +4.027163618117911e-01   +3.856356702420842e-01   +6.097447526564012e-01   +5.301125178666621e-01   +5.794965297104885e-01   +7.132663578265793e-01   +5.891553071095545e-01   +2.894047616843431e-01   +1.675416544229191e-01   +2.662424149005853e-01   +1.272974729644890e-01   +6.988410487943992e-01   +2.078461933101393e-01   +6.916108838362001e-01   +3.103895787127813e-01; +7.531010006791816e-01   +3.276530025955987e-01   +5.094866521705229e-01   +1.233709681659051e-01   +7.220137665845610e-01   +4.836573920552280e-01   +2.569429002013648e-01   +4.993789423886898e-01   +6.099701293435332e-01   +4.353600754445016e-01   +3.718549818951394e-01   +7.803837129139074e-01   +1.636991341331466e-01   +1.668370745419833e-01   +6.150218663997388e-02   +4.085311770814932e-01; +6.406607702832544e-01   +5.156321874009667e-01   +4.938592589463305e-01   +1.808155099105140e-01   +4.777021032952217e-01   +5.154025559470702e-01   +5.181113610891445e-01   +7.397248032815040e-01   +5.842426259434226e-01   +4.420395004547462e-01   +3.877577749708140e-01   +8.103396803850602e-01   +2.484812208821608e-01   +1.268626337726906e-01   +4.781498496674680e-01   +2.424566618848348e-02; +2.803053328070034e-01   +8.999465169727064e-04   +3.365600010082951e-01   +5.042139069188724e-01   +4.659917626565260e-01   +3.244853756958817e-01   +2.408416824472189e-01   +5.316121840886187e-02   +5.815540659572980e-01   +1.497326852604531e-01   +3.154007907407297e-01   +1.473559970649719e-02   +7.500987365563431e-01   +6.716987026662253e-01   +5.437890838858252e-02   +6.730913598231389e-01; +1.478976398994700e-01   +9.338952954981921e-04   +2.129475120324093e-01   +3.353250991598274e-01   +6.864573995062638e-01   +3.426811539575778e-01   +6.133013676082081e-01   +4.493914931851950e-03   +5.314028161573103e-01   +5.968248719749709e-01   +8.588305584773859e-02   +7.039879104216477e-02   +4.295154780392508e-01   +6.439353549643144e-01   +1.227289646262319e-01   +2.565033218157108e-01; +6.243111367657408e-01   +2.502019362836215e-01   +6.860431255655046e-01   +3.861425041241535e-01   +5.886022519547013e-01   +7.263999468031068e-01   +4.086310014200950e-01   +4.806616654784968e-01   +5.883918146311166e-01   +8.644489990062776e-02   +1.111445406154388e-01   +2.434399491506375e-01   +6.965794210790822e-01   +6.362256589530254e-01   +5.219255551964456e-02   +1.132377507305336e-01; +3.609408684488102e-01   +5.274737568389084e-01   +4.767786825174020e-01   +2.314384287173636e-01   +6.497677530712739e-01   +7.322105587581081e-01   +7.674150301143073e-01   +1.805117816752458e-01   +4.698697992880509e-01   +5.691278089035797e-01   +6.810935845659853e-01   +1.380303151646834e-01   +5.529112955145135e-01   +2.395341165431472e-01   +4.045937535856337e-01   +2.684688297878284e-01; +5.739493159874286e-01   +1.238677382646078e-01   +4.190032297888237e-01   +7.259706531142369e-01   +7.183949112718275e-01   +3.927554721729590e-01   +2.723829677557525e-01   +3.736661311568892e-01   +6.953240855599615e-01   +4.065299910616700e-01   +1.772540573560053e-01   +1.766467527884704e-01   +1.284758124791812e-01   +3.794865153066266e-01   +4.327147647943604e-01   +3.007885063461800e-01; +6.395702870930789e-01   +2.567239074052220e-01   +6.904655823496478e-01   +3.179348191301402e-02   +4.129909474486522e-01   +2.872545480935743e-02   +1.771814997073239e-01   +3.648291356723507e-01   +7.545008342479662e-01   +7.992961295744102e-01   +6.876352530374286e-01   +5.053930680326484e-01   +6.629549598401010e-01   +2.892166560478430e-02   +3.281356248181059e-01   +7.997164677822299e-01; +8.274485134103329e-03   +1.489460085484463e-01   +1.496832444942202e-01   +7.131215973147699e-01   +1.525113289960784e-01   +6.757228308037433e-01   +5.887970198332887e-01   +5.369236756074522e-01   +6.542439459697318e-01   +6.822405350679465e-01   +3.986400174531669e-01   +4.244555243238932e-02   +1.004705922486653e-04   +6.416579929116564e-01   +6.929104146276627e-01   +5.761892681616441e-01; +2.434927779298508e-01   +5.398567099520011e-01   +4.138611309013723e-01   +4.155132559540073e-01   +6.801952665262008e-01   +7.460101324475992e-01   +2.143862952800198e-01   +9.276498137136625e-02   +6.328723841753283e-01   +2.482788116987985e-01   +4.689589046374915e-01   +1.946751485245328e-01   +4.683271516346840e-01   +1.993634608912575e-02   +6.985980822841312e-01   +5.364734177555421e-01; +6.872337799583873e-01   +7.817863790257959e-02   +2.398966482736915e-03   +1.959260128632564e-01   +5.135835873744428e-01   +3.025178564643373e-01   +4.309930489326931e-01   +2.401365174296783e-01   +3.896601063969544e-01   +6.315829954433915e-01   +1.024997039968716e-01   +6.753458316952393e-01   +1.862313627357002e-01   +1.357793612223712e-01   +2.038487430882349e-01   +7.455447673046627e-02];
L1E_L1I_iGABA_netcon = [+1.379762884765290e-01   +4.575963792094550e-01   +5.857121432579852e-01   +5.453567660109691e-01   +5.873178804953076e-01   +6.878814234985512e-01   +1.487369082801218e-01   +1.562048838999433e-01   +6.236467061891423e-01   +7.601302549893409e-01   +3.613529826146636e-01   +8.079350430448334e-01   +1.855756555807916e-01   +2.705497287219066e-02   +2.802710110124164e-01   +7.730068580355073e-01; +7.809257547813830e-01   +4.189774723462338e-01   +2.629437069784028e-01   +5.285964658852689e-01   +2.008661555370462e-01   +5.374826500090782e-01   +8.912500776255287e-02   +6.655051386100694e-01   +7.391895518503283e-01   +6.415159126917194e-01   +5.399838048965608e-02   +3.525835758911253e-01   +1.802882509207143e-01   +1.850567233517496e-01   +7.054473027573535e-01   +1.822828406405321e-01; +2.307692617947142e-01   +5.869687256109579e-01   +7.090157122107253e-01   +4.802045998064093e-01   +1.570385201863141e-01   +5.496650619008744e-01   +5.180605930731119e-01   +2.949045911179930e-01   +7.181077860947133e-01   +1.514717870418599e-01   +7.629182767439247e-01   +4.567813332383961e-01   +7.038578502055014e-01   +4.785368909552327e-01   +2.083893585118942e-02   +4.552898827744599e-01; +6.034004993745508e-01   +3.584723048861725e-01   +4.997625190750738e-01   +7.239022276545429e-01   +2.562952168046629e-01   +1.607260289800305e-01   +4.102480899072218e-01   +5.049474137925966e-01   +5.384439866225881e-01   +5.178115789496376e-02   +4.248000147903158e-01   +2.002559039405654e-01   +5.344543554329128e-01   +3.219500429309206e-01   +6.430489557981625e-01   +5.482672028968074e-01; +6.953791115647490e-01   +5.102140244239299e-01   +4.796329307753685e-01   +2.879004527948443e-01   +2.936783448577960e-01   +2.202405326251385e-01   +4.565867277390009e-01   +6.485430814844328e-02   +3.821007485005605e-01   +6.556493237342258e-02   +5.016720412657528e-01   +4.062561242936752e-01   +6.401002753110367e-01   +4.579614449088222e-01   +3.479768156567786e-02   +7.234014492437193e-01; +7.871888037162389e-01   +1.175759431995050e-01   +1.790689861162022e-01   +2.507099706660534e-01   +5.798800756607402e-01   +1.509619124868491e-01   +7.905000249311134e-01   +3.019204395817362e-01   +3.348332692258600e-01   +8.061732674148202e-01   +1.244684065264190e-01   +1.163754355430841e-01   +6.251857146422483e-01   +1.718330625463868e-01   +7.087475698807173e-01   +4.448238576534825e-01; +6.967830220993569e-01   +9.254623480600117e-02   +2.878783325639619e-01   +1.794392981075875e-01   +1.417621575528441e-01   +2.804940377169871e-01   +6.603462564882043e-02   +1.115715222192223e-01   +7.339006415672865e-01   +4.926306243223609e-01   +7.879430561540133e-01   +1.562797201251769e-01   +3.516208273815837e-01   +2.002421557093549e-01   +4.808991950793022e-01   +5.362853586443518e-01; +2.470945111046220e-01   +8.033808213326503e-01   +1.561785137226513e-01   +8.111224515133988e-01   +1.873938867803456e-01   +4.795952277112038e-01   +3.282890709101771e-01   +6.384092205136926e-01   +1.053280221901847e-01   +7.334268943108495e-01   +7.851892111550314e-01   +6.527292987446495e-01   +4.125300000436989e-03   +2.910200190866039e-01   +3.385245442916657e-01   +9.632665011041503e-03; +3.067274098619667e-01   +7.163971128193853e-01   +5.854251761923686e-02   +2.848174465746259e-01   +2.624801813843273e-01   +7.098415892535807e-01   +2.794706865195515e-01   +7.138648640261874e-01   +7.677216995372098e-01   +3.757546055563393e-01   +6.046755290674978e-01   +7.856592115976908e-02   +6.829899960408876e-01   +4.986538222179398e-01   +3.538067003060416e-01   +5.299049023594327e-01; +7.152656499161145e-01   +6.341641145379177e-01   +6.881142853113337e-02   +6.426850898642328e-01   +1.790255318656333e-01   +5.687521463899060e-01   +7.253805682252971e-01   +6.960848206301179e-01   +7.486151012098937e-01   +1.954005036868002e-01   +5.622738066087385e-01   +7.801614712843031e-01   +5.205308022122029e-01   +4.387830417907197e-01   +3.126262955551964e-02   +6.716331504518146e-03; +7.630589989071599e-01   +5.411335750113849e-01   +2.416916719188854e-01   +7.088574825611482e-01   +3.540289045403955e-01   +4.409062969711835e-01   +2.157357636394000e-01   +1.207379355488902e-01   +1.126211312269842e-01   +2.965741258805779e-01   +7.194390009021964e-01   +6.112717715313822e-01   +4.334829947068678e-01   +5.697284525800515e-02   +1.530148704564960e-02   +8.077297442420065e-01; +3.137623003342145e-01   +1.827744669400775e-01   +1.715663291489211e-01   +7.020740358937099e-01   +3.752171434875727e-01   +4.953279427159768e-01   +3.538695930819527e-01   +7.522415278692438e-01   +7.430077495448164e-01   +7.047645291087050e-01   +4.559991365639418e-01   +7.120885685400652e-01   +6.515880663553726e-01   +1.001847376408816e-01   +6.826571729683204e-01   +2.232739905748230e-02; +5.175390334292393e-01   +5.431937897254814e-02   +4.409486513205582e-01   +6.135179115283533e-01   +3.642766036939551e-01   +3.251516965641775e-01   +2.469404225862986e-01   +1.404428606170773e-01   +6.066920233259857e-01   +6.861017199187877e-01   +6.247609860205210e-01   +6.082184567053359e-02   +5.140714892061078e-01   +3.431714813454369e-01   +5.977491921303509e-01   +2.769288195885503e-01; +6.844477986620552e-01   +1.435322558247209e-01   +5.581890199361221e-01   +1.034428487900120e-01   +2.178814933911901e-01   +5.142023902999897e-01   +3.301952698199664e-01   +5.776226709433675e-01   +7.991894448513763e-01   +3.712011654606604e-02   +2.282293867560628e-01   +1.338853581894737e-01   +4.791800835009296e-01   +5.059431683654316e-01   +7.912815287128260e-01   +5.053749929508130e-01; +6.157616419865811e-01   +4.605430198168735e-01   +1.314517895784106e-01   +1.440553739775544e-01   +7.141217449340203e-01   +2.031978130404268e-01   +8.067149772336695e-01   +3.455379392831157e-01   +4.746432702286626e-01   +5.088012758276690e-01   +7.460465999058762e-01   +9.276339606435827e-03   +3.326437522976178e-01   +2.433594092141699e-01   +6.686376576143581e-01   +2.558081281271558e-01; +4.908261222778270e-01   +3.685844151174999e-01   +8.025762278327876e-02   +4.956466208881421e-01   +7.239333029993341e-01   +7.335485554451799e-01   +2.311392560043240e-01   +3.564158789166377e-01   +7.369707359846968e-01   +3.405037011141162e-01   +6.850862360008703e-02   +4.753674626775449e-01   +4.285377127181119e-01   +3.302066125928660e-02   +3.198035986744205e-01   +1.143807613577184e-01];
L2I_L1I_iGABA_netcon = [+2.394353981382555e-01   +3.169319854035552e-01   +4.190453174489889e-01   +3.650125503406345e-01   +5.188453584838564e-01   +5.228811032711804e-01   +2.971265729697481e-01   +3.438314563160678e-01; +1.712227470650632e-01   +5.656485831163516e-02   +2.065811202298994e-02   +1.266264729143849e-01   +6.538571448750377e-01   +3.155533752866028e-01   +2.003125210199821e-01   +6.366361192933251e-01; +1.777491186066646e-02   +1.698871598373927e-01   +8.620269048722227e-02   +5.950782379223420e-01   +5.594925925893692e-01   +6.746418470903227e-01   +3.380825528768037e-01   +4.180356563547003e-02; +4.854191442241072e-01   +6.134665234210789e-01   +6.387221146705412e-01   +7.247050244602161e-01   +1.560027624572672e-01   +1.742470313251156e-01   +1.887942585056413e-01   +2.774684479677516e-01; +1.066343933221103e-01   +3.567979347630323e-01   +1.888801754497380e-01   +3.596355235533854e-01   +7.711404554646031e-01   +3.519895834626038e-01   +7.941307843224477e-01   +1.785423589352556e-01; +2.844693257974528e-02   +3.907236769082877e-01   +1.929262711034281e-01   +7.857570600147169e-01   +6.676716654530638e-01   +4.478595978814207e-01   +2.823884878083655e-01   +6.962825727236457e-01; +1.836524873098438e-01   +1.720044229928535e-01   +5.940629454245108e-01   +4.236769567569215e-01   +5.361818707371794e-01   +1.352389695805057e-01   +1.984226512204111e-01   +3.709861850008531e-01; +4.491456078736000e-01   +3.552701816173927e-01   +7.649111769533149e-01   +2.175292550604831e-01   +6.345012026932123e-01   +6.357565219191412e-01   +6.202527468213795e-01   +1.757921631507013e-02; +1.646494680573382e-01   +4.766440203776880e-01   +3.129612370383857e-01   +3.582181855574630e-01   +6.702621415618153e-01   +2.556467770166970e-01   +6.901455377295630e-01   +2.027919193204340e-01; +3.874701170486338e-01   +8.029759158415974e-01   +6.354905808259639e-01   +7.953207987271347e-01   +5.398486492607976e-01   +7.472272428438939e-01   +6.384347678624160e-01   +7.703414612393343e-01; +4.887846401744741e-01   +2.233291081680240e-01   +2.190601494762749e-01   +4.996223018617860e-01   +1.701843341357175e-01   +4.976166177757940e-01   +1.760974983764046e-01   +7.573121881223782e-01; +4.626858523740093e-01   +4.942932985633013e-01   +1.960050956171226e-01   +5.357499172039524e-01   +1.328101423350571e-01   +7.648541082036961e-01   +2.295710693412428e-01   +6.545993468664560e-02; +4.353039614401195e-01   +5.266700502909583e-01   +2.099310515898589e-01   +6.062365875652219e-01   +2.204006877065663e-01   +6.806515210619615e-01   +3.020149693540206e-01   +8.028918650386950e-01; +6.196959902379696e-01   +5.042411253494637e-01   +5.472048046500377e-02   +5.196472454938238e-01   +3.110165345304950e-01   +5.357951202380362e-01   +1.701968040834820e-01   +4.073118986994294e-01; +4.418727049240410e-01   +5.111168965055015e-01   +7.111248246814854e-01   +2.238814421244738e-01   +3.898543674187800e-02   +5.226235505666336e-02   +1.873430310475103e-01   +7.743837523885412e-01; +5.254354160092850e-01   +5.180766577343975e-01   +7.679335675244002e-01   +9.037725928464536e-02   +3.846114482220312e-01   +6.061568134419154e-01   +5.818522822076511e-01   +5.156743750290055e-01];
L1I_L2I_iGABA_netcon = [+1.805895711938189e-01   +6.273292379923595e-01   +1.788170569336743e-02   +1.891201123689286e-01   +1.324967483754753e-01   +2.792788304399365e-01   +3.423267073877308e-01   +5.667237148581152e-01   +3.375802003870647e-01   +7.358492829553562e-01   +9.452889745597597e-02   +6.764613190180188e-01   +3.410739319367169e-01   +8.778530072650546e-02   +6.458301270315460e-01   +6.851005157380984e-01; +5.819247573231229e-01   +7.464455417872126e-01   +2.601844452643697e-01   +4.349925254790583e-01   +2.326026876215150e-01   +3.032004931093639e-01   +2.313507135209644e-02   +5.182641217414599e-01   +2.830813330318090e-01   +5.726115886741117e-01   +7.023725512176874e-01   +6.862179164980925e-01   +7.303164542137495e-02   +3.263773989914439e-01   +1.219699038253355e-01   +7.556025566080824e-01; +2.279310225921335e-01   +2.498338526241916e-01   +2.808936142514887e-01   +7.007598605716580e-01   +3.914929857609285e-01   +1.754807769246176e-01   +5.523088734207862e-01   +6.240435114574051e-01   +3.140497833503723e-01   +1.664177117869959e-01   +1.150570103065423e-01   +2.413907213939388e-02   +4.356032517848552e-02   +3.841927198441826e-01   +6.733396011059903e-01   +4.618936582325903e-01; +6.542846951447912e-01   +6.003012884720560e-01   +8.972156745083686e-03   +5.216395166310998e-02   +5.137412085887156e-01   +2.766281422528378e-01   +2.706524690835564e-01   +1.600764022006455e-02   +4.875092836310728e-01   +6.496739087517347e-01   +2.151919662240725e-01   +6.564480218542157e-01   +6.776978363119142e-02   +6.501852361780048e-01   +2.189621380815889e-01   +1.112868354859311e-01; +1.906835647909280e-01   +7.866165071146469e-01   +2.400915037282437e-01   +3.440691592957462e-02   +7.941998156943127e-02   +6.692124734740672e-01   +4.583127567361372e-01   +6.222963204162113e-01   +6.474466538438860e-01   +7.496530371165542e-01   +6.245771236596855e-01   +7.115827663708869e-02   +5.861952504090284e-01   +3.941886546138950e-01   +4.099661603868424e-01   +3.858094020772517e-02; +4.581639669051261e-01   +5.342916106030486e-02   +4.125656493762057e-01   +7.520672576926362e-01   +3.807489654032833e-01   +6.521951684664301e-01   +6.098237277156627e-01   +2.207346782793155e-01   +7.398589850290316e-01   +3.279842364999546e-01   +3.564618032604305e-01   +3.042372653383902e-01   +3.907044802751265e-02   +4.089091011615683e-01   +7.679851770610204e-01   +6.924955579447591e-02; +4.508842958559351e-01   +3.625873321768957e-01   +6.419825510450763e-01   +4.063953002554173e-01   +7.618211629604101e-02   +4.992006628267108e-01   +7.234733077075736e-01   +6.601654936290377e-03   +3.887326070769637e-01   +1.648099621418792e-01   +8.028545957491572e-01   +6.853767979053672e-01   +1.052294793301314e-01   +4.456288744135429e-01   +3.771332800015508e-01   +1.286180125823409e-01; +1.710109597310385e-02   +1.975360105892198e-01   +1.911703954400619e-01   +4.933401427079942e-01   +3.190926455470985e-01   +1.586408410930784e-01   +6.664550924587580e-01   +5.815878472587225e-01   +6.732826826905385e-01   +5.259295796110606e-01   +4.238406617849670e-01   +7.526095894599338e-01   +5.287892052279018e-01   +1.977301385656428e-03   +8.070380745475456e-01   +7.875657262663561e-01];
L2E_L1E_iAMPA_netcon = [+7.868487214168045e-01   +1.487642024151842e-01   +7.565828863367586e-01   +5.936144304557949e-01   +7.377617057157956e-02   +1.512334209460500e-02   +8.872040208514176e-03   +1.787446637963167e-01; +2.213803049717036e-01   +5.579489286981713e-01   +1.174101640248147e-01   +1.515499192067409e-01   +4.590444950050229e-01   +7.507590441232753e-01   +3.573801065023571e-01   +7.185644667748924e-01; +6.976432173604724e-01   +3.256241367394452e-01   +5.811751610711324e-01   +4.643697109899118e-02   +7.509400361726102e-01   +4.254422615520398e-01   +6.482892902051594e-01   +6.557213286078308e-01; +5.339642853782014e-01   +7.518349800343498e-01   +6.357087062736628e-01   +4.876573194818604e-02   +6.463298657457003e-01   +2.559970285713854e-01   +1.310461006604993e-01   +5.025300523921499e-01; +1.048136718539818e-01   +1.120607638699781e-01   +4.590134796929906e-01   +3.320387105610673e-01   +4.427443260064159e-01   +2.208222094433897e-01   +4.467304218923366e-02   +3.825152240029016e-01; +6.519658888131232e-01   +7.827040486424905e-01   +7.404056430801683e-01   +3.084181367317312e-01   +5.585657350202961e-01   +5.778105965810262e-01   +3.494564952488897e-01   +1.228076590736021e-01; +3.872830159436493e-01   +1.133740171791180e-01   +2.536049894943774e-02   +7.275095714405692e-01   +2.759383084288240e-02   +2.677704511798169e-02   +1.451458350693376e-01   +4.897417744363816e-01; +2.395465461527151e-01   +5.187905816024628e-01   +1.081568308352403e-01   +4.754192041074288e-01   +7.700882635075702e-02   +7.756849951860355e-01   +7.119963158785436e-01   +7.272088440212808e-01; +4.135478636757200e-01   +2.642836739378187e-01   +3.891922277435069e-01   +5.959160909895913e-01   +7.598988938501887e-01   +7.249669484045901e-01   +6.075839362212789e-01   +2.986289631486280e-01; +7.766731465973167e-01   +2.044969157262908e-03   +1.246033260032317e-01   +3.542006098424789e-01   +7.524580993114639e-01   +1.747033923846305e-01   +6.173969698474756e-01   +6.988789494612492e-01; +5.271893608247221e-01   +1.701522670892560e-01   +8.912139536661688e-02   +8.066419927543838e-01   +3.655120126483867e-01   +6.423428024244521e-01   +4.452357796331914e-01   +6.477164789141647e-01; +7.905059191022148e-01   +4.648688972386142e-01   +7.329807572114994e-01   +4.864898992328641e-01   +7.920118345036810e-01   +3.413870558755967e-02   +6.169964237438007e-01   +7.854433614622351e-01; +1.571886267205795e-01   +3.969720416890958e-01   +1.209121735020690e-01   +7.388433885547839e-01   +6.055322457782883e-01   +2.346803002366590e-01   +2.228601609642420e-01   +7.843655516680892e-01; +2.548036946162951e-01   +3.777569611124898e-01   +5.172999178844563e-01   +8.109328308839641e-01   +5.814913806582273e-01   +2.290727551202495e-01   +5.644525264093655e-01   +3.211782986578767e-01; +1.128427499956541e-01   +7.466167752693812e-03   +7.196767746062237e-01   +6.586408051833890e-01   +7.629613639477767e-01   +2.733073116516738e-01   +6.527662799733548e-01   +2.070163924560918e-01; +2.175646067713443e-01   +4.842697146525486e-01   +3.668824724097791e-01   +5.564901344954288e-01   +1.934402970366776e-01   +4.081623998227115e-01   +6.068870798559299e-01   +4.796219771618948e-01];
L1E_L2E_iAMPA_netcon = [+5.867314817529265e-02   +1.776569062997425e-02   +1.906858691946663e-01   +9.499688081398022e-02   +4.321768613679612e-01   +3.416756550366160e-02   +1.586264203193415e-01   +6.561347017988661e-01   +7.800196535744902e-03   +2.854627943831158e-01   +5.868436679019244e-01   +8.168894686993997e-02   +6.688801235042073e-01   +1.576254267196536e-01   +1.404532363674652e-02   +3.482346220989723e-01; +6.030141297941949e-01   +5.906064078030728e-01   +6.184849451414788e-02   +4.123853383938125e-02   +4.327828344708495e-01   +5.580335910704133e-01   +4.018259791701129e-04   +3.114804306993416e-01   +5.303704401170786e-01   +5.014789062975532e-01   +7.294770798582640e-01   +2.266272932515228e-01   +2.286017447233666e-01   +3.476376972325150e-01   +3.973682226327695e-01   +8.516871548813210e-02; +3.483404917730054e-01   +1.737118326689989e-01   +3.146683206033820e-01   +2.915028024581957e-01   +1.676534010691174e-01   +5.143132952211470e-01   +3.521163436825664e-01   +4.818572537952174e-01   +1.031546224929287e-02   +5.589045098563362e-01   +7.120654283953989e-01   +3.418249795952368e-01   +8.031682363160303e-02   +7.605914006298310e-01   +2.117525042846402e-01   +3.406704359267954e-01; +4.675924377964561e-02   +2.875969062828198e-01   +6.481171503840306e-01   +9.885808643844621e-02   +1.757919116132250e-01   +7.702107279580104e-01   +6.606414735771287e-01   +1.967398762478787e-02   +2.935304766817772e-01   +3.499034534149678e-01   +3.004535368273812e-01   +1.743499978105308e-01   +1.050934428991361e-01   +3.927343595460002e-01   +3.570381644475030e-01   +2.903757838160347e-01; +7.570956681260835e-01   +6.753145461618917e-01   +4.795252833776696e-01   +6.324336855844268e-02   +4.125502590737193e-01   +9.960378709148297e-02   +4.838875064918235e-01   +3.651342420701750e-01   +6.429541373060551e-01   +4.665638803569701e-02   +3.022355750394535e-01   +6.735448945875114e-01   +4.833538205011467e-01   +4.225628386269622e-01   +2.340469917712903e-01   +6.591098493208717e-01; +5.863809494016571e-01   +3.952481486594656e-01   +7.947296929790016e-01   +4.547165746161859e-01   +3.399496084883514e-01   +4.970350519574881e-01   +2.752372325143908e-01   +1.395715522164190e-02   +6.709119752529330e-01   +6.669090916075302e-01   +5.482582371008785e-01   +5.875167359623752e-01   +1.600616825777979e-01   +6.639064159263884e-01   +4.740717010944827e-01   +1.065334957750187e-01; +8.228581054807163e-02   +6.344325443619523e-01   +6.622103091593637e-01   +6.689068989714809e-01   +7.816024985373834e-01   +1.993015786925380e-01   +1.985702799795385e-01   +2.607787532849229e-01   +2.996216849308105e-01   +7.564842057988255e-01   +3.914052709882270e-01   +4.465690683932773e-01   +7.440183465261291e-01   +6.426318582035480e-01   +6.792791704251790e-01   +2.477353303582235e-01; +6.950796584109563e-01   +1.651498235285447e-01   +3.662877913202078e-01   +4.054869421141104e-01   +6.204239771593291e-01   +2.294543528836587e-01   +7.771616792056985e-01   +6.673954219105828e-01   +4.559171165131986e-01   +3.984534098194447e-01   +4.366054556472676e-01   +6.821140824820568e-01   +4.793476099023382e-01   +7.811627951572101e-01   +7.232298806010864e-01   +7.064380523065497e-01];
L2I_L2E_iAMPA_netcon = [+5.430251023900848e-01   +2.423619418666421e-01   +5.021628066331857e-01   +4.402544521666700e-01   +3.144327146218134e-01   +2.634826710454352e-01   +1.080788295351020e-01   +2.503269335234715e-01; +5.044514510776723e-01   +6.504271889107419e-01   +3.034011759650041e-01   +3.217532008894295e-01   +5.302287855439189e-01   +2.397105360440923e-01   +5.481970067757507e-01   +7.313254669639855e-01; +2.525714728640193e-01   +7.219407179684011e-01   +6.953440851139184e-01   +8.062222302545491e-02   +7.670548185017267e-01   +6.852344662475193e-01   +7.467789439425020e-01   +6.671813981723166e-01; +4.694293987065319e-01   +6.921598738641295e-01   +2.447537130657967e-01   +6.805087193910838e-01   +2.418355827623975e-01   +2.614028769908639e-01   +4.261091709643540e-01   +6.154400147751647e-01; +1.879962533708001e-01   +7.472856463528149e-01   +3.675667658004891e-01   +6.370066949077777e-01   +1.226600729685465e-03   +6.206004881245528e-02   +2.274513345512568e-01   +1.370119467854912e-01; +2.312540408751459e-01   +1.200487956927101e-01   +6.371252872716731e-01   +4.218549528101647e-01   +7.741253047972964e-01   +2.223557991801843e-01   +5.457757066726679e-01   +6.771909291809702e-01; +5.697080391391020e-01   +4.688917715291167e-02   +3.386785844717836e-01   +3.921724585835473e-01   +5.634637331303460e-01   +1.958758871624827e-01   +1.231893104430520e-01   +1.089344030448375e-01; +6.130287760782178e-03   +4.870554898751883e-01   +6.785025332551545e-01   +6.141615254924726e-01   +2.765618427737196e-01   +3.738026182518883e-01   +5.965102029454559e-01   +6.520181299476622e-01];
L2E_L2I_iGABA_netcon = [+6.327163677732836e-01   +1.289069786698371e-01   +6.462749921386808e-01   +6.981818356882553e-01   +5.898244441974293e-01   +4.819988701824505e-01   +8.853275302250549e-02   +4.058410199707917e-02; +3.362007535483545e-01   +1.636194196487825e-02   +4.069285611966283e-02   +1.066064619791103e-01   +7.030361878234805e-01   +1.245028496865686e-01   +6.282633752485688e-02   +1.903765629691274e-01; +5.094507385551089e-01   +6.640338977243012e-01   +2.881929500852893e-01   +2.994757483103567e-01   +5.853148369720571e-01   +2.814444752190801e-01   +9.670599850367609e-02   +1.682108041282448e-01; +6.058068483350805e-01   +2.008907202103293e-01   +8.103909341626383e-01   +6.234257127795038e-01   +5.401165520341060e-01   +3.000944070734593e-02   +5.102697349669753e-01   +1.855644624751108e-01; +4.769075968537950e-02   +7.921864453192294e-01   +4.703420578069684e-01   +2.251773741657526e-01   +3.536302891891041e-02   +7.914384844847060e-01   +4.093259879635991e-01   +5.829690858448007e-01; +8.793640172408108e-02   +6.989355570816185e-01   +3.176555337864508e-01   +3.921983106865031e-01   +2.220397614551300e-01   +1.106691607381313e-01   +4.710166922830986e-02   +7.305543066521076e-01; +4.702350924912492e-01   +4.410010488034964e-01   +7.214551272464454e-01   +1.813697486936265e-02   +7.955374495462929e-01   +2.889257112564667e-01   +8.056166714885333e-01   +3.113585655372473e-01; +1.070049838165372e-02   +2.492651640950908e-01   +5.320849092819140e-01   +2.576762240547752e-01   +9.451215623453515e-04   +6.099152315954402e-02   +7.439472582063861e-01   +5.115905750834142e-01];
L3E_L2E_iAMPA_netcon = [+4.914679864926383e-01   +1.950536190235360e-01   +2.341654079362097e-01   +6.929371386269310e-01   +1.859521943785330e-01   +7.636147745675178e-01   +6.715994699725754e-01   +1.916076391861441e-02   +5.058294899094585e-01   +1.670409215455057e-01   +5.812309697793605e-01   +6.691489668940460e-01; +5.736822989951061e-01   +7.713767898506685e-01   +1.358214269725384e-01   +6.182959662016149e-01   +6.325455431206676e-01   +2.269937341831675e-01   +4.326987302818112e-01   +7.041934792090104e-01   +7.000936843844977e-01   +3.396232916789865e-01   +6.531318320720260e-01   +2.375466624558894e-01; +1.326885108577271e-01   +6.383305961353835e-01   +2.064476028723156e-01   +7.508969564147753e-01   +2.182127426552967e-01   +3.903299767991885e-01   +6.949068796089350e-02   +7.100980629738061e-01   +1.468306261346594e-01   +3.559859548393449e-01   +3.029784034944121e-01   +2.341328198131778e-01; +4.996271196946530e-01   +5.247188704118385e-01   +2.700489269745549e-01   +1.421867321078854e-01   +1.772037724900760e-01   +1.084301221747631e-01   +7.128268778017020e-01   +1.990961479030357e-01   +1.137160709441879e-01   +6.794485136002022e-02   +3.190001634432360e-01   +6.171813548994445e-01; +2.593751150671763e-01   +5.023670025759672e-01   +5.746260138630723e-01   +6.871279450650238e-01   +2.581069068821870e-01   +4.764466275815785e-01   +2.112333309649537e-01   +4.122463698201768e-01   +3.402065479245023e-01   +5.758316435866192e-01   +7.934283322976209e-01   +6.863247363381929e-01; +2.097562107426013e-01   +5.440713300121174e-01   +5.906290112793767e-01   +4.222358940175147e-01   +7.983965182289251e-01   +6.638634832291667e-01   +4.713227677067535e-01   +5.964141538350042e-02   +5.151676423806946e-01   +6.364939126023402e-01   +4.724186224228824e-01   +2.222782492164398e-01; +1.508218109531924e-01   +7.522686879439826e-01   +3.021873521488709e-01   +3.843565625264068e-01   +1.428692504519057e-01   +3.584431141181134e-01   +1.847101309216627e-01   +6.882435385257522e-01   +5.266875097784504e-01   +7.048952228839734e-01   +4.378824892265079e-01   +3.951838848999014e-01; +5.980859973782621e-01   +6.669627882260994e-01   +4.015591865215213e-01   +6.351476896413745e-01   +3.404624277805793e-01   +2.482519868299153e-01   +4.576192651193307e-01   +5.453023654948888e-01   +7.198284728891782e-02   +3.181262189641351e-01   +6.627729640621763e-01   +3.543538081602977e-01];
L3I_L2I_iGABA_netcon = [+6.373189766032423e-01   +7.143916701983349e-01   +2.677157450265757e-01   +7.788150969358107e-01   +1.678473736784467e-02   +5.612970028337413e-02   +3.233261189385864e-01   +7.608796234867635e-01   +6.806741217801896e-01   +4.261948855145034e-01   +7.585127911929723e-01   +5.668790162144445e-01; +1.883779748835180e-01   +8.463739829470775e-02   +6.632801259502686e-01   +4.775682165349389e-01   +1.646403119798411e-01   +1.346573155709852e-02   +5.218032007544503e-02   +3.805207436439256e-01   +8.004958502504094e-01   +6.395748671736881e-02   +7.031984863529960e-01   +7.653336311334591e-01; +6.298469841399051e-02   +7.014908743337742e-01   +4.451321562122192e-02   +2.437198787155473e-01   +5.660636512225646e-01   +3.584966660163526e-01   +1.268006381069934e-01   +4.182291860196817e-01   +3.027303749746602e-01   +3.915276614771308e-01   +2.914374854302364e-01   +4.519819735316938e-01; +3.054553969697487e-01   +6.949372319664500e-01   +2.046718273798780e-01   +1.655052868127274e-01   +2.303400299806477e-01   +4.918195757125310e-01   +7.571249251773059e-01   +2.851794243325637e-01   +2.316670639451038e-01   +7.110466932316090e-01   +2.303395902805440e-01   +3.422830055743608e-01; +6.025469968568455e-01   +7.843552329022099e-02   +2.223598646696923e-01   +5.049290195120065e-01   +7.672671417939102e-01   +1.790358245117706e-01   +5.826048822780551e-01   +2.578069117280467e-01   +7.550490869089563e-01   +4.417211487386901e-01   +1.888830045828367e-01   +7.120452270836367e-01; +3.812127133094799e-01   +6.224100192918545e-01   +3.189788880407736e-01   +7.293881261836244e-01   +7.441793591399639e-01   +2.221107664862790e-01   +4.867829025766082e-01   +4.325515326044255e-01   +2.068589164262817e-01   +2.794489522721335e-01   +2.497881340280118e-01   +7.613076504858124e-01; +2.891689350590292e-01   +4.783861643798046e-01   +7.193811797502415e-01   +4.395165169968857e-01   +7.772002506397283e-01   +1.368137401711566e-01   +2.869477377645589e-01   +6.428991718061610e-01   +7.926683502054985e-01   +5.470713923847187e-01   +6.620792030836089e-01   +5.160611161081384e-01; +2.053728189410757e-01   +3.214980832375147e-01   +3.700815972277500e-01   +7.757648996831509e-03   +2.222091729958553e-01   +7.931697754146253e-01   +4.322269643620765e-01   +6.716951138496101e-01   +4.828131257390157e-01   +5.579155015573303e-01   +4.839381173092827e-01   +4.194563100076072e-01];
L2E_L3E_iAMPA_netcon = [+6.169987040753305e-01   +1.992708274512064e-01   +6.600963118154778e-01   +4.119875153628472e-01   +1.612186273833452e-01   +1.364456222133777e-01   +6.723273927726695e-01   +7.881201844078290e-01; +6.073707651040411e-02   +4.956500208157648e-01   +6.553953449509238e-01   +9.930369420989579e-02   +6.608900734774219e-01   +8.300507808165196e-02   +3.316837005758750e-01   +7.383267634903179e-02; +9.159792356003399e-02   +7.546747027806927e-01   +7.390453083999433e-01   +4.588456344189641e-01   +7.244654869508902e-01   +1.656438112847923e-02   +1.423729088652664e-01   +3.107123417607549e-02; +3.507162438392480e-01   +2.624332923247966e-01   +3.338819051206315e-01   +6.123381528231382e-01   +9.405063540401645e-02   +7.831083874373462e-01   +6.680783175593908e-01   +7.837120461017592e-01; +1.256704123506141e-02   +5.617294972352442e-01   +3.974704459372384e-01   +1.245050583303354e-01   +3.499246677256565e-02   +5.890117176229754e-01   +7.592345822654510e-01   +1.128243025854625e-01; +3.173440450214647e-01   +7.259133781586650e-01   +9.019680076986877e-02   +5.826697129279713e-01   +3.252902236273917e-01   +4.320330080372996e-01   +7.134409208046119e-01   +6.043143814216483e-01; +1.660598322626043e-01   +4.086562743499472e-01   +4.374216198615909e-01   +2.083367651286651e-02   +8.066177754324615e-01   +8.800562065648426e-02   +1.533112634888107e-01   +4.324654878169853e-01; +4.063015211606267e-01   +5.523125122323913e-01   +1.870591561764358e-01   +6.813527694412471e-01   +3.564279259319330e-02   +5.979221147583040e-01   +4.360059509516710e-01   +3.111209234415851e-01; +1.965627041466362e-01   +5.895588489095092e-01   +4.933279140339489e-02   +7.719178555481817e-01   +6.161085158979289e-01   +5.357869085623054e-01   +2.048195285714554e-02   +4.552438613787688e-01; +5.460530332225704e-01   +7.881066346465658e-02   +6.441076141638907e-01   +2.427279086615723e-01   +7.347201989982250e-01   +5.459126311320934e-01   +2.202079351167212e-01   +3.418839446559649e-01; +7.777759221943528e-01   +4.887635449245493e-01   +1.630927293704557e-01   +3.662283277154740e-03   +7.898460773975172e-03   +3.815606053923308e-01   +5.695621887102421e-01   +1.108407507117638e-01; +1.203824989917195e-01   +1.455438621699810e-02   +2.945530198191936e-01   +7.554860188067059e-01   +7.862367261082929e-01   +1.552615238536448e-01   +4.929040850182549e-01   +6.395176570155519e-01];
L2I_L3I_iGABA_netcon = [+5.332262966297479e-01   +2.809572379599974e-01   +4.755222528923214e-01   +1.293777722196070e-01   +3.763829595849680e-01   +3.680443908718040e-01   +8.112502717150674e-02   +7.626116493566736e-01; +7.446874345643211e-01   +2.405698348468101e-01   +6.060240200724942e-01   +2.781170802583339e-01   +2.088646733388003e-01   +2.663924189259971e-01   +7.401567918460998e-01   +4.363141495544494e-01; +7.552680205968211e-01   +1.351848096424325e-01   +6.962030915476720e-01   +5.650390706975152e-02   +5.660203872306354e-01   +7.851057011078063e-01   +2.061380869058014e-01   +2.891911936841526e-01; +2.305417427296957e-01   +6.408368596680185e-01   +3.890356583382309e-01   +6.638011443001017e-01   +7.987645709608507e-01   +7.690163291323916e-02   +1.985313157993883e-01   +3.043745282901660e-01; +5.594186441919136e-01   +4.280658674064361e-01   +6.025314890123937e-02   +7.096726870276343e-01   +3.363512727372297e-01   +7.045149276760739e-01   +7.882054497592446e-01   +5.586780153854936e-01; +8.850784597681807e-02   +5.938093238803152e-01   +4.866847520254824e-01   +4.744998852521361e-02   +7.260724820763120e-01   +7.706898838131251e-01   +6.846261628138588e-01   +3.656513985500166e-02; +2.530977371742604e-01   +4.095264233257564e-01   +4.517773207286817e-01   +2.838495814600132e-02   +7.104270245405560e-01   +4.139090838285872e-01   +4.177743397868675e-01   +5.217352271924650e-01; +4.792403520993171e-01   +1.553872757700008e-01   +7.091911121893493e-01   +9.208137407193848e-02   +8.019134372246211e-01   +3.387166955738710e-01   +2.110877720449239e-01   +3.683390647370774e-01; +3.429214797053448e-01   +6.284674834250948e-01   +5.710201659084835e-01   +3.773407775442235e-01   +7.509475577443376e-01   +5.479415080037501e-01   +7.995980772284879e-02   +4.538867452978635e-01; +1.620836827112089e-01   +5.461821749304948e-01   +4.199495429730676e-01   +6.799366269194366e-01   +5.375274708831328e-01   +1.571926855655893e-01   +7.924922588061535e-01   +1.620526124267477e-01; +1.123928184925625e-01   +4.241167569016062e-01   +3.523130271665130e-01   +4.398165568946268e-01   +5.466181234587474e-01   +2.521789906322711e-01   +5.304829669648521e-01   +4.298656202848648e-02; +6.341056594505186e-01   +4.926314238117179e-01   +1.004071427969378e-01   +4.091510925109864e-01   +3.188817371471306e-01   +3.880407870939545e-01   +4.169092064374357e-01   +3.446918631361794e-01];
L3I_L3E_iAMPA_netcon = [+4.370288298975010e-01   +2.485109082831335e-01   +1.040177325652934e-02   +7.227947751952131e-01   +6.524803768243809e-01   +1.229109669382895e-01   +7.196119184223330e-01   +5.918017810883867e-01   +7.173257431000534e-01   +6.570435482163749e-01   +6.789175003923019e-01   +7.923514207437311e-01; +9.914363518196001e-02   +4.502430825332420e-01   +4.567611093778286e-01   +2.287023279626679e-02   +4.220728482905812e-01   +6.651455521432375e-01   +3.605963813634021e-01   +7.495018469806294e-01   +6.681354177379291e-01   +7.671013123294156e-01   +6.912594187682509e-01   +2.627063222852371e-01; +7.941053891371022e-01   +7.438247532952198e-01   +2.496812165001716e-01   +2.617161124149408e-01   +9.764148347106781e-03   +1.912473524395736e-01   +1.563365259791152e-01   +5.215121733412077e-01   +1.255813768679895e-01   +7.019262019772831e-01   +5.016208148356085e-01   +8.908427802966484e-02; +4.577961614948895e-01   +3.055343931730313e-01   +7.303545444744196e-01   +7.163842502777206e-01   +4.840550855870916e-01   +1.043456150190672e-01   +4.406076263691912e-01   +7.060115045001479e-01   +6.824229268591617e-01   +6.834804241541183e-02   +4.698892982285089e-01   +1.330871492825619e-01; +4.815041954109091e-01   +1.522767225310779e-01   +6.372488471969595e-01   +7.192540539017556e-01   +6.609164603154668e-01   +3.596051244466135e-01   +3.726984353109729e-01   +6.647302219495351e-01   +6.370661058613879e-01   +6.118936517204205e-01   +1.352503083312005e-01   +6.135872497044401e-01; +5.325696514289207e-01   +3.038761868253079e-01   +5.276167894662670e-01   +7.278368744538402e-01   +6.573718388104389e-01   +4.581915173156899e-01   +7.821135379984959e-01   +6.758829979846444e-01   +6.943549356580521e-01   +3.892869858141955e-01   +5.162584865961844e-02   +2.008280762679938e-01; +5.227984185894208e-01   +1.943985749128875e-01   +1.311439752403247e-01   +5.998390583157486e-01   +4.398221783073095e-01   +7.055986998828591e-01   +3.226294650389462e-01   +4.349176435200978e-01   +5.406724477086483e-01   +7.605020247067124e-01   +7.900633502485195e-01   +6.407196767768943e-02; +1.357686472274878e-01   +1.267504164472632e-01   +6.911261026633666e-01   +3.991604412635227e-01   +7.107822059025600e-01   +3.545862705472509e-01   +2.529028541062870e-01   +4.241678562147848e-01   +7.036299365185846e-01   +5.532343546277720e-03   +4.468016669075852e-01   +2.243632760372309e-01; +2.467021110011408e-02   +2.782880833424291e-01   +7.785509945058080e-01   +1.739423216718105e-01   +1.348894827906684e-01   +3.351686893820826e-03   +3.799899092191111e-01   +1.358195275078984e-01   +2.653392922532710e-01   +3.298309414207320e-01   +4.253439792198198e-01   +3.572492685354416e-02; +5.788408510291182e-01   +4.122013762175892e-01   +5.885155855961445e-01   +4.092435884006555e-01   +7.086698517392972e-01   +1.852124478315778e-01   +5.792206029433678e-02   +4.982193658669220e-01   +3.873387037152972e-01   +2.971871240762325e-01   +3.269401324894657e-01   +4.175549891156023e-01; +4.120841297812129e-01   +9.413451819660675e-02   +5.915056009534619e-01   +3.288034036084119e-01   +3.329732685694937e-01   +7.553600425198945e-01   +6.676668581690240e-01   +6.584742874451259e-01   +4.398991303548657e-01   +4.120029324620137e-01   +5.354460419456871e-01   +2.111190830916540e-02; +6.526659048076754e-01   +6.489317986377346e-01   +1.923836655771375e-01   +5.859290192764969e-01   +5.843245961331353e-01   +5.331874598362963e-01   +2.688955224705947e-01   +7.395148162522003e-01   +7.625319597309956e-01   +1.617446486161803e-01   +3.056511434100057e-01   +3.358955294929235e-01];
L3E_L3I_iGABA_netcon = [+7.945049048665180e-01   +5.624875244557669e-01   +3.729827547233600e-01   +3.352500325723268e-01   +4.981389038309542e-01   +1.866203271854661e-01   +2.110385407328508e-02   +6.367762076522178e-01   +7.592508496244946e-01   +3.788301443586247e-01   +2.465853954658301e-01   +3.034723901013737e-01; +3.568321823210450e-01   +1.237972499638309e-01   +1.110890878410479e-01   +7.261094669793944e-01   +7.740407856256633e-01   +5.739925226763781e-01   +4.206325064646234e-01   +3.776637588500150e-01   +3.009637097675984e-01   +5.486676618228271e-01   +1.822948416322373e-01   +6.850024313266823e-01; +5.887267814536168e-01   +2.940974547979087e-01   +6.404224624306819e-02   +4.766409987932227e-01   +1.057451693610466e-01   +7.522606522670200e-01   +2.339374721565670e-01   +5.182278408801270e-01   +7.798051428210218e-01   +8.205262810560217e-02   +7.900730783792017e-01   +6.752101618338503e-01; +3.993221063009146e-01   +7.037542629130181e-01   +7.989027458454869e-01   +4.665373103055862e-01   +5.239527474403272e-01   +6.604737340060413e-01   +4.115890290405493e-01   +7.704714975145299e-01   +7.700329299517362e-01   +6.096902271556878e-01   +8.039341982011708e-01   +4.556664844724266e-01; +4.535663929252017e-01   +4.664299794026734e-01   +7.898679443956316e-01   +7.000427822164176e-01   +4.234303505990105e-01   +5.073482434086316e-01   +7.208489134811464e-01   +3.289340875424093e-01   +5.775062312849568e-01   +6.695560898331469e-01   +3.106404038639690e-01   +2.395676617530778e-01; +6.281799550384880e-01   +2.513515570254153e-01   +5.597485006426153e-01   +7.246757509551393e-01   +6.499469848675171e-01   +1.101317782184001e-01   +3.011689572015765e-01   +1.743079519586010e-01   +4.806001821958519e-01   +6.688119897233733e-01   +3.875207920388954e-01   +5.254280857780088e-01; +7.853036150906669e-01   +6.157220794929739e-01   +3.540757533489727e-01   +5.121045520690545e-01   +2.231774893794806e-01   +1.481282543709667e-01   +4.035301126445209e-01   +6.851942738447906e-01   +2.837006487188869e-01   +1.351299626198004e-01   +3.331490583365201e-01   +3.226137262838503e-01; +5.750118080636284e-01   +1.588285883724672e-01   +4.476712866757113e-01   +3.528860500188339e-01   +2.408592700530384e-01   +7.694228721753259e-01   +6.079682667274291e-01   +3.571474573673739e-01   +1.448671849058293e-01   +2.962220836512852e-01   +7.494888096826912e-01   +9.095269267289630e-02; +3.581571076564760e-01   +6.571764530398174e-01   +2.713353973674813e-01   +5.202571482462679e-01   +7.080710209476870e-02   +6.208125343784389e-01   +3.493810295156947e-01   +3.820936274141022e-01   +7.001331655819368e-01   +4.746810400771868e-01   +3.922394861986972e-01   +4.784105103384094e-01; +5.416768809292453e-01   +7.376990429703391e-01   +3.033327747675771e-01   +1.730577164704157e-01   +4.430453883049986e-01   +2.356863140266753e-01   +1.878681549755289e-01   +2.569058168443670e-01   +4.330163168691344e-01   +2.064952361260838e-01   +7.300832244107894e-01   +1.150874901705813e-01; +4.869008042954744e-01   +2.030301280404654e-01   +5.746786824470970e-01   +3.885312686160536e-01   +6.699184146885813e-01   +2.199576832049308e-01   +9.808402549595535e-02   +3.101768050939177e-01   +3.328590806546127e-01   +7.932655964975170e-01   +6.826766144425436e-01   +1.701724213431631e-01; +2.728812792635721e-01   +7.457216584761314e-01   +4.561349715169762e-01   +6.067596581600302e-01   +2.948986098097570e-02   +5.252439989930221e-01   +6.232717977735388e-01   +5.819632861429359e-01   +5.323740467769915e-01   +2.129294171148416e-01   +2.906543319492303e-01   +8.210037197585446e-02];
L2E_Input1_iAMPA_netcon = [+8.110838379673895e-01   +8.110049750400232e-01   +8.105917653875933e-01   +8.092366723533556e-01   +8.100865768360823e-01   +8.098771144926763e-01   +8.091340054483462e-01   +8.091044197219170e-01];
L2I_Input2_iAMPA_netcon = [+8.092173507659850e-01   +8.111116940605920e-01   +8.101010494364036e-01   +8.095635438740099e-01   +8.090516319263970e-01   +8.094327728482769e-01   +8.094861048787458e-01   +8.090816607645889e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.3*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.5*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.3*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.3*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.3*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.5*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.3*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.3*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = -20*((exp(-10*((t)-( 50))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 50))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
