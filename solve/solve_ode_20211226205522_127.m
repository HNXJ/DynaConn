function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-3.633196226398195e-01   -3.290345182154457e-01   -7.608115923136680e-02   +7.632344418749833e-02   +1.586314182127337e-01   -2.173685526730787e-01   -4.168922172704972e-01   -4.179454481309411e-01   -5.771743561060926e-01   -1.216632622478810e-01   +1.107449140276104e-01   -8.603587739676019e-02   +8.395959886057387e-02   -4.266008732470247e-01   +1.105834724920617e-01   -3.075689449001512e-01; +3.532610241944388e-01   +1.719646683905336e-01   +3.752666378951699e-01   -1.667059853790350e-02   +2.111567411438454e-01   -2.023429152680352e-01   +1.385916471513775e-01   +4.026089518433222e-01   +2.921355359843372e-01   +6.423786859615611e-02   +8.703423694996833e-02   -3.058195845935238e-01   +1.103194414067334e-01   -1.182551787653841e-01   +4.764394407862429e-01   +4.740702966725462e-01; +1.991958153352310e-01   -2.853779446333468e-01   +1.465743873422862e-01   +2.870950946428296e-01   +2.748234083646916e-01   +3.088202427943348e-01   +1.273086639202791e-01   +9.139996748626746e-02   -1.657951272677999e-02   +2.423081963411794e-02   -2.435857613552473e-01   -1.733590558110786e-01   -3.411531209045912e-02   +1.759041973460901e-02   +2.708108830330776e-01   -3.152909588749085e-01; -1.895421428247881e-01   -1.616425006652452e-01   +1.464744440012099e-01   -1.461740227917492e-01   -5.885373468029542e-02   +2.821436334064646e-01   +4.795560380271275e-01   +1.262242192794158e-01   -2.705370086136088e-01   +3.346439551708579e-01   -3.427475465014961e-01   -2.956904910616663e-01   +6.832613529472772e-02   +2.534564087155304e-01   +8.241102165176037e-02   +2.538561608698667e-01; -4.209158351160502e-02   +5.857607284479087e-02   +3.591771087364410e-01   +4.102923094734918e-01   -1.972287354902770e-01   +9.835080196473582e-02   -1.143437849734590e-01   -2.575630249877632e-02   +3.157449757169723e-01   +1.838563853554381e-01   -3.783361023748391e-01   -5.040210922981431e-03   +1.866627643365756e-01   +1.311550832402607e-02   +8.147402229238773e-02   -9.703999566834448e-02; +1.113359271835255e-01   +3.780257185751309e-01   -2.481675701896607e-01   -2.851202343502637e-01   -4.538113584222679e-02   +3.725270359855009e-01   -9.961352611376735e-02   -2.449055175995222e-01   +1.941093038084062e-01   +1.353369023266367e-01   -7.681670565354895e-02   +2.541358702653074e-01   -3.815304364429852e-01   -1.648075886149893e-01   +2.425151182865352e-01   +1.558028255081901e-01; +7.040140334118453e-02   +1.250770914272140e-02   +1.261734676859566e-01   -1.469992788197825e-01   -2.213655696468355e-01   +2.475658433152433e-01   +2.735957675174002e-01   +2.207594134814864e-01   -4.440257043035807e-01   +1.347943634834927e-01   -1.278793611375911e-01   -2.518052842330090e-01   -7.906044393771122e-02   +5.214019928488141e-02   -2.754793542965985e-01   -1.395065871185644e-01; -3.517005903699673e-02   +2.130478796362235e-01   +2.229173764075480e-01   +6.609637900115023e-02   +9.836467891157280e-02   -1.345710052831241e-01   +7.610509717613563e-02   +2.968257649240826e-03   -5.700368571505719e-02   -2.897578013965746e-02   -2.658433026925493e-01   +3.871746969486229e-01   +2.491460312347937e-01   -9.315988169875753e-03   +1.316981296125607e-01   +5.776840890650302e-01; +2.428763074804393e-01   +1.624568875821899e-01   -6.476027509324478e-02   +1.423302372307780e-01   +2.238508590169606e-01   +6.191935383910198e-03   -1.886331497915707e-01   +3.982402529890015e-01   -2.046117537467012e-01   -1.676725033275174e-01   -2.118418482144055e-01   -5.749921311571639e-01   +2.033993886468658e-01   -2.463548092476600e-01   -4.355336666003710e-02   +1.082904670036016e-01; -1.657614797971305e-01   -1.994029590826312e-01   -2.230655179905457e-01   +2.408755100159888e-01   -3.992818461557777e-01   -2.387805557778474e-01   +1.563602488835901e-01   -1.823191387864631e-01   +9.828752374867797e-02   -4.254436230757895e-01   +3.020356315233758e-01   -5.619843992028151e-01   +3.028125484198838e-01   +2.567381894803038e-01   +4.534611357388335e-02   -2.531718916887295e-01; -2.600859127399441e-01   +2.737256050734467e-01   -1.254044384402757e-01   +1.021586893069225e-01   +3.122379651107460e-01   -1.083582102498487e-01   -1.987392879925685e-01   +3.043663814140513e-01   +5.717264983602208e-02   +7.887457995894054e-02   +5.157001319298093e-01   -3.146688247514023e-01   -4.028779943198410e-02   +1.414348062417575e-01   +3.787741965731234e-01   -1.726144786520715e-01; +6.512717057494627e-02   -2.745164098913254e-03   +8.242619168623630e-02   -2.858421474884786e-01   -1.717492308303755e-01   -2.817012674765311e-01   -8.481827655019702e-04   -2.833116658327703e-01   +7.200498325348229e-02   -1.238658684253572e-01   -1.477984973098158e-02   -2.269132990928295e-01   +6.716606942850843e-03   -2.463456658764267e-01   -1.349343310882117e-01   +2.625454092201874e-01; +1.327450441207827e-01   -1.491423030299549e-01   +6.877668489162209e-01   -1.747000935957370e-01   -1.594986449575834e-01   +3.584799650752050e-01   +5.491206354354660e-02   +5.023155292511985e-02   -2.384030761379134e-01   -4.541658561614856e-01   -4.150492362275960e-01   +4.630161830203376e-01   -2.979318347249446e-01   -5.781904145748924e-02   +3.644868024499148e-01   +3.000976062712191e-01; -1.874942815052617e-01   +1.533217299707107e-01   -3.970702306050409e-01   -2.159920763603724e-01   +1.832954399984146e-01   -1.129776759936398e-01   +7.738406460034533e-02   +1.347612637168533e-02   +8.342216661694220e-02   +1.603816816389225e-01   +1.012996269128321e-01   -1.231282996655580e-02   -3.574504437794663e-01   -3.263064722908041e-02   -2.043058719870252e-01   +8.747731842439077e-02; +3.633381573739634e-01   +2.297859694655032e-01   +2.062587515529605e-01   +9.522452111024970e-02   +2.404749641711539e-01   +2.295361690051354e-01   +1.498218294882843e-01   -7.213454770707582e-02   -3.243016714316087e-01   -1.916613221726254e-01   -5.574986232729305e-02   -1.029831879700555e-02   -2.826447326492663e-01   -1.572776410025702e-01   -6.844598189305065e-02   +2.868447832527870e-01; -6.160654515519152e-02   +7.597543407927163e-02   -1.320303929471392e-01   -1.385344348450846e-01   -3.046486196910748e-01   -1.887936989369199e-02   -4.670725442142075e-02   -1.754651445936541e-02   -8.997201101418786e-03   +4.541989671399830e-01   -1.333177933927212e-01   -2.593901614804756e-02   -2.840240522029342e-01   -4.548688715165635e-01   +2.911458802221590e-01   +2.915308576472194e-01];
L1E_L1I_iGABA_netcon = [-2.182231043484755e-01   -1.276052544578298e-01   +1.581710361361040e-02   -1.634060868108541e-01   +2.190015423981142e-01   -1.760866009064105e-02   -1.421645183295531e-01   -3.037979229676264e-01   +8.798591655094862e-02   +1.381485283614920e-01   +3.646554327897293e-02   -7.990053876903613e-02   +2.780294414540031e-01   -2.800690219935300e-01   +1.176342428929633e-02   +3.259287924431420e-01; -9.076560096124769e-02   +3.430044209346576e-01   +1.255188200560931e-01   -5.076900086157831e-01   -4.810247285576572e-01   +1.087553740197462e-01   +3.837584075525202e-01   +4.452207765872290e-01   -3.847450817722767e-03   +8.871865081344317e-02   -2.094832779286381e-02   -2.789301953910366e-01   -3.471402784899165e-01   -2.508376166471643e-01   -1.919841745605328e-01   -5.028976241029730e-01; +1.718297022450238e-01   +2.510829638626989e-01   +6.324341578786181e-02   +1.900708186418906e-01   -7.595991378004352e-02   -1.559041914405644e-01   +1.232183711705588e-01   +2.255553146364715e-02   +2.509404538279901e-01   +1.900064741206500e-01   +2.325398577865193e-01   +3.201712961728553e-01   +9.627025025148504e-02   -4.430486796071000e-01   -1.284245995766704e-01   +4.953879973545994e-02; +4.012310163946955e-01   -1.276778594462309e-01   +1.077331190853702e-01   -1.201486776856797e-01   -1.784004309265648e-01   -2.686572705250796e-01   +5.754539950895015e-01   -1.125242306734099e-01   +2.831486506941122e-01   +3.256265938509355e-02   +2.933900489968307e-01   -4.014049194157936e-01   -2.185970431469230e-01   +2.836049614080887e-01   +1.598858209788725e-01   +7.053179876636330e-02; -8.302109235311522e-02   -7.471161238684315e-02   +7.781976001743449e-02   +2.477853545926558e-01   -2.130890508874256e-01   +4.958474776525348e-02   +2.738729483665659e-01   +2.397073707979343e-01   -1.561563840885766e-01   -2.470712347239151e-01   +1.206050683688487e-02   -1.098868795875654e-01   -5.326124764205430e-01   +1.719140738915057e-01   -1.055961784093182e-02   -2.241236974919728e-01; -1.331217897295491e-01   +1.117764679327521e-02   -4.173430872873647e-01   -2.653224097003802e-01   -3.452751640763398e-01   -2.230688044371048e-01   -1.458035895964625e-01   +5.401668315740729e-02   +8.375128491737185e-02   -3.399220699555208e-01   +1.346746482732501e-01   +4.855715127089176e-01   -1.403852954853546e-02   -8.059461189906217e-02   +2.181038526499316e-01   -3.496448232626781e-02; +2.292991789426475e-03   +1.118382954170205e-01   +3.067866220260580e-01   +2.143658257189658e-01   +1.239874749953040e-01   +1.225491990067612e-01   +1.035705201128172e-01   +4.836477154350483e-03   -2.063053870839268e-01   +2.721913545644624e-01   -4.430188784411768e-02   -2.758161855419173e-01   +1.685307577909558e-01   +4.127257429167787e-02   -1.084176740221421e-01   -1.368292176441581e-01; +1.734380349450160e-01   -4.724003550456638e-01   +4.204795582477853e-01   +2.393277089980417e-02   -2.558276147732521e-01   +2.281398192998167e-01   -2.943365693094780e-01   -2.850008560626700e-02   -2.570214173632432e-01   +3.864496810664863e-01   +3.106262598380154e-02   -4.705207092101609e-02   -3.453895718581236e-01   +3.692911419727467e-01   +3.549247329998068e-02   +1.721123504077881e-01; +2.721282146063785e-01   -2.597252610023729e-01   -5.273553061258712e-01   -4.608801418641580e-02   +1.357898037130227e-01   -4.425782322946533e-01   +5.531355497305426e-02   +1.447635785271283e-01   -2.683906594556566e-02   +1.612608193531592e-01   +5.219023235201214e-02   +1.779966978348173e-01   -5.039185414684255e-02   -1.495070170533135e-01   +2.105896532048300e-01   -6.652677144031574e-03; +9.698611796373577e-02   -1.366494770454016e-01   -1.146472262238617e-01   +4.397951576709721e-01   -4.805926734214608e-03   +1.163571233290302e-01   -1.368347028430640e-01   -1.489452829114855e-01   +3.523167153942269e-01   +1.766529950510015e-01   +2.454546443869453e-01   +1.502699184217118e-02   +2.417792127192969e-01   -3.607520403499025e-01   -1.936306626148239e-01   -4.196612883251110e-02; -2.706565333862352e-01   -2.318941577157567e-01   -1.167960683115202e-02   +4.111572509378928e-01   +1.806001758716460e-01   +2.560801060954478e-02   -6.166981761558887e-03   -1.004061743347331e-01   -1.051349892523862e-02   -4.945742519293618e-01   +2.637748556398355e-01   -3.418744502863851e-01   -4.187521154305948e-02   -8.771677913988660e-02   -5.645517916553724e-02   +1.517731817546041e-01; +2.602842737506380e-01   -9.111452637197123e-02   -1.596305559334122e-01   +1.766341928102496e-01   -2.462108778212953e-01   +6.372870465212918e-02   -5.312751314822911e-02   +3.494328660153214e-01   +2.409080829058357e-01   -9.023752695413464e-02   -1.266606328492474e-01   -1.249763568834754e-01   +2.089018230939347e-01   +7.487012129093210e-02   -2.241148662992958e-01   +3.749493833263078e-02; -3.470071172451428e-01   -1.158729896023500e-02   +9.088825966367403e-02   +2.051457647171959e-01   -8.697025878008771e-02   -4.997931312298256e-01   -7.576858674449211e-02   -9.784790740038378e-02   +1.557577478117239e-01   +4.812661509880550e-02   -2.714122570423678e-01   -3.860698950060085e-02   +1.412245704859963e-01   -4.289713353745404e-01   -9.812751491412047e-02   +3.814797857189426e-01; -4.288909432583695e-01   +2.832210564816041e-01   -9.987374121549708e-02   -3.450865026013168e-01   +3.894394766343618e-01   +1.793486092495051e-01   -1.361988767764460e-01   +1.327658215107407e-01   -2.639996290913431e-01   -4.144575127850328e-01   -7.392770906574338e-02   +8.488338855745919e-02   +1.039763158201250e-01   +2.180127117414332e-01   -3.179878231222251e-01   +1.134450615186710e-01; -2.275998441975703e-01   +6.830573226582985e-02   +3.045517461991706e-01   +4.737327894237406e-01   +2.764625595524812e-01   +1.247535350073280e-01   -2.867602002214803e-01   -2.311173421663590e-02   +1.425371852619279e-01   +2.802580554294564e-01   -6.331810408227979e-02   +6.401693296085277e-02   +1.883810942222036e-01   +1.192460238215972e-02   +3.180595808938043e-02   -4.691357199102171e-01; -1.511133299485107e-02   -4.144808873376019e-02   -4.621862759358043e-01   +2.133687594806085e-01   +1.679512159039293e-01   +1.222461495483155e-01   +2.742782406262388e-01   -1.074344131233633e-01   -2.179064230423227e-01   +3.558150787965230e-01   -3.093569730159524e-01   +2.991896053811317e-01   +8.143494293286505e-02   -1.366127946515724e-01   +2.306869053874142e-01   -1.152198543037774e-01];
L2I_L1I_iGABA_netcon = [+7.048819914245694e-02   -3.886176351237085e-01   +4.243384434520333e-01   +2.522611057633822e-01   -1.510064058131950e-01   -1.249922224400665e-01   -7.197149920569042e-02   -5.030775830578407e-01; -1.705606052885816e-02   +1.614318696461089e-01   +1.240026959636333e-01   +5.887715093698970e-02   -2.253972048871907e-01   -8.714974488249760e-04   -1.968058425375194e-01   -1.559169761069713e-01; -9.541751827222116e-02   -3.480548976098539e-01   +3.915384731438746e-01   -7.425651899474278e-02   +1.366450406075984e-01   +2.790721227170023e-02   +1.416734946261227e-01   +2.722153708727199e-02; +1.449918142488928e-01   +6.253927358941838e-01   +2.010215596902465e-01   -1.086628857088914e-01   -5.435209595789581e-03   +4.336096789697477e-02   -6.277945497179097e-02   -1.245255045021600e-01; +2.168507684349979e-01   -1.569784209815733e-01   -1.905299326802523e-01   +6.882114446520053e-02   +2.997841682432125e-01   -1.408147887979646e-01   -1.060054586114670e-01   -2.229202498296343e-01; +4.632166484759301e-01   -5.882687674350435e-02   -9.218084453572151e-02   -1.321957551225065e-01   -1.252962404837691e-01   +1.087236243229323e-01   -3.548475602769748e-02   -2.388561855016736e-01; +6.972446847824473e-02   -1.657912780742986e-02   +1.171571258543939e-01   -1.307489977815921e-01   -2.257108891384820e-01   -5.740755964685353e-01   -4.701898665084972e-02   -5.053340071431053e-02; +1.382968864237934e-01   -2.881021156709154e-02   +1.863199464909907e-02   +4.872838340162652e-03   -8.526064657102206e-02   +6.989703363958227e-02   +5.088573429344455e-02   +1.902471285367069e-01; -6.030991540441492e-02   -8.201150187088158e-02   -9.130138468706769e-02   -2.862160538831158e-01   +9.808525115482382e-02   -9.162169278236314e-02   +3.861860099258276e-01   +1.296426465458340e-01; +1.432198893243797e-01   +6.659684166984342e-03   -1.586306141383402e-01   +2.522484385548993e-02   -1.299513428663117e-01   -9.823146567556376e-02   -1.274750127573726e-02   -1.923498797677587e-01; +3.628284289916085e-02   +2.206852995711798e-01   +1.609142248184645e-01   +1.547276696002226e-01   -3.280644749408083e-01   -3.792262503142335e-01   -7.116093587415795e-02   +8.059925759908823e-02; -1.413189268189095e-01   +2.573080399354480e-01   +3.874797706998436e-01   -2.318742492837462e-02   +1.495001404661370e-01   -2.248412064815265e-01   +2.356916933144156e-01   +2.936665970163617e-01; -2.331311434247368e-01   -1.283229998068580e-01   +2.901596571282504e-01   -4.885992999489726e-01   -1.028127057713878e-01   +9.517212697294573e-02   -5.818808556554064e-02   +2.024536021979262e-02; +1.814586248625790e-01   -4.807746430897168e-01   -8.681537789804669e-02   +2.270495863237151e-01   +3.073441867686067e-02   +8.304759715793097e-02   -2.667247097838602e-01   -2.523309864777129e-02; -6.912271606197865e-02   +6.649708391712725e-02   +1.074021568914843e-01   -1.176598792510081e-02   +4.368531854205741e-01   -6.328262597621537e-02   +5.684579192100855e-02   +6.002560157368937e-02; +3.733491628937335e-01   -5.359849363112475e-02   +4.486254621116466e-01   -8.298581611623318e-02   -5.892969957714461e-03   +8.534939116089194e-02   +1.824605674067917e-01   +3.354015675360260e-01];
L1I_L2I_iGABA_netcon = [+1.635207857482350e-01   -1.130317153483788e-02   -5.780010762743530e-02   -8.731689318757309e-02   +2.337575540737399e-01   +4.360502776662671e-01   -1.401532899155704e-01   +2.937829200964909e-01   +2.352453708225677e-03   +2.598809782017809e-02   +4.627321226864031e-03   +3.068934576369725e-01   -1.455123054413849e-01   -1.673190966687475e-01   +2.190129127509789e-01   -6.072335680460178e-02; -3.326858819933162e-01   +4.231431140897642e-01   +6.532012363840267e-03   +9.145987016094383e-02   +8.218423713933394e-02   -3.313903618876529e-01   -1.697050624720112e-01   -1.835251845540180e-01   -1.167576835166773e-02   -5.358793225021035e-01   +6.160513032516540e-02   +1.268174396006588e-01   -3.016416516111016e-01   +1.700038183504316e-01   -1.137345493071267e-01   +9.938445281410505e-02; -1.895731442065094e-01   +2.679732558660189e-01   -3.378090552374818e-01   +3.195554690837268e-01   +3.047519917497313e-01   -2.030167495554920e-01   +5.140293533178342e-04   -3.813333281085739e-01   -3.741623285536368e-02   -9.561412881043591e-02   -3.931002561052501e-01   -1.479428886280277e-01   +2.049663263690261e-01   -4.774817211968673e-01   +7.263638769531088e-02   -5.070309505239234e-02; -1.481102296416609e-02   -1.562948703347905e-01   +2.184639226841886e-01   -3.283868778232401e-01   +9.137013486957588e-02   -4.917868877226417e-01   -3.166173078231685e-01   -2.158726146567067e-01   +4.407494459105194e-02   -2.294500803869387e-01   +1.477693261352051e-01   +3.568705923751174e-01   +2.894749683569579e-01   -4.233529215320924e-01   +2.844404465133690e-02   -1.314349845733077e-01; +1.498209649379229e-01   +5.809775697789080e-02   +5.692830300764593e-01   +6.393115308762008e-02   +3.454172128212344e-01   +3.232587108089923e-01   -2.356871736841454e-02   +1.895976649790331e-01   +2.264212557870719e-01   +3.721339760775118e-01   -1.722285303496393e-01   +2.224597890928869e-01   +2.285004034062313e-01   +4.173244896614677e-01   +5.282409599854770e-02   -6.027748453972170e-02; +3.862862470339180e-01   +3.317351315093305e-02   +1.752388280344197e-01   -1.652193732910637e-01   +1.434449305176300e-01   +4.134508392874390e-01   -1.048314047754469e-01   -2.836974517150646e-01   -8.492021482363320e-02   +4.497597765013185e-02   -5.120774555031007e-02   +9.614255930072868e-03   +3.617162374133870e-01   -3.531049384854046e-02   -4.236930574968871e-01   -9.400090644889142e-02; +2.639642702326433e-01   -1.595894690692391e-01   -1.442917406711325e-01   -3.196219290477585e-01   -7.510379898320881e-02   -1.418290396963586e-01   -4.103091163969524e-01   -8.362987933135621e-02   -2.497934045098523e-01   +6.455947063581589e-02   +3.234878019633475e-01   +9.434211673193969e-02   +4.177932501647484e-02   -6.246326817165425e-02   +1.799830190973016e-01   +4.661825670852158e-01; -2.944946764263481e-01   -2.670712163261035e-02   +4.724842895402248e-01   +2.669868979632584e-02   +2.193591081636545e-01   -2.843406398290690e-01   -2.992793500825826e-01   +1.932020325345342e-01   -1.175394922572089e-01   -4.079221060086629e-01   -3.909118778709647e-01   +1.651762587129054e-01   -7.990138279778343e-02   -2.756651040529716e-01   +5.772939226407060e-02   -3.112554978845979e-01];
L2E_L1E_iAMPA_netcon = [-1.040554657338683e-01   +2.013526396359321e-01   +1.972388814510385e-01   -2.399445010882137e-01   -2.003200437096635e-01   +7.165929935257517e-02   -3.505083236626263e-01   -1.689041175640840e-01; +1.430062427195070e-01   -4.607855922341398e-02   +1.741630072308867e-02   +5.131667599460289e-01   -1.254317050191876e-01   +4.778361127600875e-02   -1.670696904638070e-01   -5.537878125849466e-03; +1.217647974071418e-01   -2.967937182862448e-02   -1.628353641838557e-01   -1.355665987814254e-01   -1.816642808335767e-01   -2.500977237824215e-01   +2.863311860735943e-01   -2.263188416314621e-01; +1.890257539232805e-01   +4.405098986254555e-02   -2.982302301442839e-01   +8.416327745914229e-02   +1.818558544237100e-01   -3.311011982450868e-02   +3.639080638454933e-01   -2.114422243840329e-01; -1.478621981810537e-01   +2.273818846045333e-01   -2.789559671746435e-01   -6.748430422868414e-02   +6.565045300688535e-02   +1.710883826999481e-01   +3.796730710298427e-01   -2.424770956275238e-01; +8.530014342459982e-02   -1.956762629026206e-01   -3.166133509266653e-02   +2.432146938090353e-01   -1.709575095299148e-02   +4.722678409147567e-01   -5.411048359662820e-01   +1.240270638745483e-01; +7.555867653954190e-03   +7.136909964239138e-02   +1.790041110054004e-01   +1.917749209919578e-01   -3.067366276381332e-02   -2.721128368812398e-01   -1.854698678278973e-01   -2.795779328752432e-02; -4.053614674754581e-01   -3.173412951514236e-01   +2.209992411868074e-01   +2.159325856440383e-01   +5.522472409735670e-01   -3.326796372063818e-01   +1.820495578091244e-01   -4.734452363333951e-01; +2.165740255172677e-01   -9.476596345880725e-02   +2.849052946956587e-02   -6.645327612640609e-02   +3.816422624330885e-01   +4.195438432478586e-01   +9.572253711759521e-02   -2.751663475612144e-02; +5.340681270481559e-01   -2.404892024435276e-01   +2.068589505467363e-01   +3.579051159051866e-01   -2.545130939609739e-01   +2.625307908211260e-01   +1.885071147224568e-02   +2.893092421472089e-01; -8.286574664514587e-02   +9.882406589396470e-02   +2.504269075489888e-01   -7.451061074064005e-02   -4.645284128161524e-01   +4.727879885093765e-01   +1.795419041860173e-01   -1.230998707269298e-01; -3.387015478729489e-01   +2.847385180613063e-01   -3.044304008829145e-01   +2.631356067373394e-02   -2.728204618656652e-01   -3.668026052059848e-01   +4.106416955470894e-01   -2.107156387053045e-01; +5.744964656320743e-03   -4.330257049535785e-01   +3.452646233345274e-01   +1.119064414812317e-01   +1.987205020997827e-01   -2.202945590890699e-01   -3.788309986864944e-01   -4.147842634687009e-01; -3.182235083777414e-01   +2.711779350187070e-02   -5.091577504008955e-01   +1.540195248316246e-01   -7.474712266038314e-02   -1.024080959152912e-02   +1.248753418254469e-01   +3.379807100114904e-02; -3.704480837463631e-01   +3.559704749146551e-01   +3.987861229524512e-01   +1.598460741852381e-01   +2.729551326807068e-01   +1.557376976433187e-01   -8.469690898413373e-03   +1.696498851509219e-01; -1.447129963693906e-01   -7.993391861617906e-02   -9.850541490310685e-03   -2.058193721505747e-01   -2.558705696964719e-01   +4.973110030062312e-01   -3.040283602117464e-02   -1.434738592601609e-01];
L1E_L2E_iAMPA_netcon = [+4.262574611274889e-02   +1.601469053551650e-01   +2.448982181534102e-01   -2.429575283406656e-01   +2.398750925903697e-01   +3.092928217088098e-01   -3.588503207311499e-01   -3.112225232897032e-01   +1.743791497811665e-01   -1.240709795464117e-01   -2.438097574895422e-01   -1.879824799800963e-01   +1.411034964535343e-01   -1.910434905357555e-01   +2.948505507279926e-01   +1.246984387716190e-01; +1.899847994608892e-01   -2.127617917371953e-01   +1.663107844947927e-01   +3.008439172790685e-01   -1.411063085477465e-01   -1.604098084307946e-01   -1.805444287607411e-01   -4.073230508417580e-02   +5.237413318046402e-02   -2.309067963784642e-01   -1.870225618164577e-01   -2.706043385738097e-01   +3.758293073106176e-01   -4.057986929025447e-01   +1.387670879193836e-01   -1.599249685110371e-01; +3.019465880551536e-01   -1.388289787193547e-01   +8.397826439527124e-02   -2.193737225414032e-01   -4.681155329510328e-01   +1.550879192265488e-01   -4.005024556305467e-01   -2.195625258088645e-01   -2.308074972559926e-01   -2.554931979641682e-02   +3.436150234717594e-02   -2.246798947287477e-01   +2.103827348795333e-02   -2.116381773343062e-02   -1.246137189133488e-01   +1.367170725631117e-01; -1.225874141926819e-01   -4.921789742423753e-01   +2.321440860982286e-01   -8.351606292914732e-03   -1.928389001290217e-01   -2.562723271196272e-01   -2.063707725774817e-01   -3.805426749954204e-01   -1.929769437904086e-01   +4.085313827797347e-01   -7.921003390640655e-03   -2.895132519034113e-01   -4.321649159012134e-02   +1.914260748305361e-01   +2.123483762030111e-02   +2.950317497359854e-02; +2.161938122382077e-03   +1.525522811657788e-01   +1.942141390686599e-01   -6.146125301195534e-02   +3.569782099421934e-01   +4.448986692485178e-01   -2.295137734889305e-01   -3.731782138630426e-01   +4.566343928555748e-01   -2.499189881097362e-01   -6.051354649303727e-02   -7.758313309779274e-03   +2.623795527353858e-01   +1.721553837005637e-01   -1.952151275980422e-02   -2.926399375891106e-02; +2.722426621422470e-01   +1.632216322231058e-01   -1.027887170721099e-01   +1.451457881370023e-01   +1.025104512121847e-01   -8.570046322074831e-02   +3.852667399573604e-01   -3.123802762626070e-01   -2.197852565200803e-01   +2.577466718273506e-01   +1.040195488569599e-01   -6.360125876317088e-02   +1.466894498958822e-01   +6.051848414410607e-02   +3.009388796818859e-01   +3.208607418869825e-01; +3.176976919520223e-01   +2.855274070526936e-03   -1.419899565706001e-01   +3.222383239905087e-01   -1.721272212397482e-01   -4.493304853534335e-01   -3.450007487622722e-01   -1.215786136856096e-01   +1.806397443890817e-02   +1.593252824530122e-01   +1.174271923162871e-01   +5.547840920270465e-02   -1.949124833818213e-01   +1.738514339850487e-01   +1.657469032449680e-01   +2.615011344247370e-01; +1.876137724204156e-01   +2.777770431813966e-01   -2.633452355645191e-01   +3.027722009870832e-01   -1.414571145880947e-01   -3.105157559368671e-01   +2.589229610538580e-01   -3.053914216608633e-02   +2.534993344905345e-02   +2.686317553041564e-01   +1.647764682999283e-01   -5.345236831938612e-01   +1.636924616615713e-01   +3.756703042409233e-01   +2.707027697376673e-01   +1.921160297897964e-01];
L2I_L2E_iAMPA_netcon = [+2.872242586245578e-01   +3.723882083084796e-01   +3.641770221153467e-02   +4.125946447906227e-02   +2.360962424558010e-01   +5.837614292219278e-01   +2.473318671714721e-01   -2.516571330495002e-01; -1.876522914262524e-01   +1.929636881847603e-01   -1.632336473292655e-01   -9.516137449464757e-02   -9.489032198870012e-03   +1.798871205973544e-01   -1.969558332903788e-02   +5.502205467391508e-02; -2.082401286157185e-01   -8.297893428447886e-02   -8.163439138658173e-02   -8.311415659351323e-02   -2.840606549629647e-01   -6.714549614294273e-02   -1.541876746399762e-01   +2.036242544556049e-01; +1.300516258905023e-02   -3.651770344071188e-01   -2.533714158228387e-01   -1.040718095256943e-01   +2.124908553399748e-01   +1.817331812094960e-01   -2.030703056266689e-01   -1.368655637429128e-01; -2.368298476218029e-01   +7.866426052386959e-02   -6.421621238166281e-02   +5.690612283315860e-02   +1.263108509281331e-01   +3.315545621772588e-01   -7.907540731931029e-02   +3.671026360528235e-02; -5.977992970696143e-03   -5.521328507952012e-02   -1.844576264216714e-01   -2.776776742825492e-01   +3.373910549664356e-01   +1.328437604758002e-01   -3.453273277467431e-03   +1.764016306716217e-01; -1.540131326440200e-01   +1.674614609466208e-01   -6.308519412873648e-02   +2.353366861005745e-01   -1.593756557236976e-01   -3.504141146808406e-01   -7.852099542210358e-02   -1.003298214989476e-01; +3.579231237784022e-02   +4.601897197356769e-01   -7.469216213921534e-02   -2.472257027797240e-01   +4.171968168487319e-02   -3.364391807119401e-01   +2.856115687807385e-01   -3.837496963908676e-01];
L2E_L2I_iGABA_netcon = [+3.637448875463944e-02   -1.202023062034488e-01   +1.242004969848485e-01   -4.966451201851330e-02   -8.608322054492970e-02   -1.908246707014888e-01   -1.310347262294005e-01   -1.723236338162334e-01; -3.673630236626717e-02   -3.051615045073268e-01   -8.645421028581847e-02   +4.688911774105576e-01   -1.562123046200630e-01   +3.606252354491789e-01   -3.128188000808998e-01   -2.280447243879508e-01; +1.844630306480101e-01   -5.574415033863121e-02   -3.163213490818247e-01   -4.073427077741822e-01   -2.222609730022598e-01   +9.147583135691204e-02   +1.009151454970506e-01   +9.258289781088319e-02; +5.483400041408387e-01   -1.815321089739125e-01   +2.879674339635683e-01   +9.497674329250302e-02   +6.579955474226204e-02   -2.418517017630504e-01   +2.504503299174123e-01   +7.055527014397589e-02; -1.553337675663331e-01   -1.174428796069628e-01   -2.778502676469617e-01   -2.348868848683436e-01   +2.318236588591105e-01   -6.155083938024233e-03   +2.710575178597250e-01   +2.929137756604751e-01; +1.786767404569559e-01   +4.361553492527176e-03   -1.236207692193980e-02   -1.926963503039166e-01   +2.701340127067693e-01   -2.480679047564373e-01   -1.656153733423182e-01   -2.768440882437901e-01; -3.895290956555235e-01   -3.322452375355933e-01   +1.933275067676177e-02   -3.261102484381699e-01   -1.161266297717979e-01   +2.172389420557493e-01   +2.260337669969309e-01   -3.912019084630832e-01; +2.056737465275243e-01   +1.599694833569626e-02   -4.476675421098238e-01   +1.516223145387310e-02   +4.221621324762491e-01   +1.656600294446997e-01   +4.365524549678794e-01   +3.515370632427987e-01];
L3E_L2E_iAMPA_netcon = [-2.033006561950154e-02   -2.095852649680081e-01   -2.123446476377479e-02   -6.663513556513823e-02   -1.450835966319972e-01   +1.332582643073729e-01   -3.009252344125786e-01   -1.917550395303161e-01   -2.048798622609349e-02   -3.267221274869546e-01   -1.053966435956540e-01   -1.752836840216412e-01; +3.740202623873513e-01   -1.998413917243620e-01   -1.775380072125806e-01   +2.567301492344541e-01   +1.423767107474904e-01   +3.104468855051221e-01   +6.543703202379487e-01   -4.815441624255928e-02   +1.766955882951790e-01   -5.880721477173609e-01   -2.017019609090719e-01   +1.388504069602813e-01; +3.171681514090375e-01   -1.422803569227352e-02   +5.535464826863681e-01   -8.022681155845846e-02   -2.618811950720182e-01   +1.688364821561151e-01   +9.007635708526224e-02   +7.366433838276162e-02   -9.667704221556525e-02   -3.243225858071491e-01   -2.893319821402950e-01   -2.080516214952174e-01; +3.456613594826848e-01   +5.625896255700873e-02   -4.131214525536718e-01   +2.255009000801107e-01   +1.590927517865428e-01   -1.028493193331881e-01   -1.745154642606592e-01   -1.097194852557069e-01   +1.035087368182936e-01   -1.395885503120580e-01   +1.329587455761726e-01   +3.109996518434117e-01; -2.485055319241648e-01   -1.573873294975184e-01   -6.003054410207659e-01   +2.201546115409523e-01   +5.892588614662182e-02   -1.888582825416303e-01   -1.671644063992344e-01   -3.167563270478810e-01   -2.996613553048065e-01   +8.029989759236802e-02   -2.504726206450065e-01   +4.829088642298501e-03; -2.905454439099745e-01   -1.887100469122719e-01   +1.566813309477200e-01   +4.218168801853907e-01   -2.983247300253255e-01   +2.287426439633978e-01   -1.755774136985387e-01   +5.910358749622213e-01   +8.836222983528846e-04   -1.730312794760619e-01   -1.658480058467121e-01   +1.747189032386576e-02; +4.413132076232201e-02   -4.505098860182506e-02   -3.043646776047316e-02   -2.470803091632701e-01   +3.188566246863100e-01   +1.936752869169569e-02   -1.865411419243764e-01   -4.387776441172124e-01   -1.096680936864259e-01   -1.306335965378773e-01   +6.378752086004202e-02   -1.892128062094688e-01; +4.790943097772143e-02   +1.846134966873186e-01   -1.898739282396091e-01   +6.664911359746303e-02   -6.472383675649435e-02   +4.130739268383469e-02   -3.916175088535850e-02   +2.880815953426905e-02   -3.331197346719199e-01   +2.567015955842229e-01   -1.701710715046567e-01   -2.928900125897946e-02];
L3I_L2I_iGABA_netcon = [+7.059005909075219e-02   -4.199945076558567e-01   -5.584371377643962e-02   +3.711975653101396e-01   -2.085086042374477e-01   +2.408153084348247e-04   -4.604967676793307e-01   +5.562049231292859e-02   +2.878955240095496e-01   -4.772784666114587e-01   -3.467927323744973e-01   -1.126648791205942e-01; -8.516785887440488e-02   +1.449217525965921e-01   -1.238372528416934e-01   -4.156571866476087e-02   +8.712283618974759e-02   +2.441217375387471e-01   -5.532261000301522e-02   +4.866926837723090e-01   -4.214091514833165e-01   +5.285192410980258e-03   +3.587939829647326e-01   +5.985680633887140e-02; -3.144866146181255e-01   -3.218124066662580e-01   -3.487295379943396e-01   -1.544878715336104e-02   -1.412141292533780e-01   +2.852103237895010e-01   +2.019585467320454e-01   +1.405877697942329e-02   +1.876867370150923e-01   -3.269347021734863e-01   +4.242991741024047e-01   +3.412474843552489e-01; -5.007916131031064e-02   +1.342734396891058e-01   +1.336334432057129e-01   -7.858618806105197e-02   -4.654192325205811e-01   +3.429438744211531e-02   +2.397331895234244e-01   +3.508654174865514e-02   -3.341545008940734e-01   -2.520461787922787e-01   +3.324363089792371e-01   -1.041841602804165e-01; -5.228287553878445e-02   +1.409221834921566e-01   -2.648722702537241e-01   -1.575127639034374e-01   -2.968335234797965e-01   -6.592126361284679e-02   +3.860608422021591e-01   -1.460484231836193e-01   +2.899691327349637e-01   -1.635490054960397e-01   -2.144509640589629e-01   -1.279325337647587e-01; +3.106871634379481e-01   +6.819188560892964e-02   -1.287146736864483e-01   -1.090403235369098e-01   -5.184371832876969e-03   -4.443889415378794e-01   +2.158599821982475e-01   -7.237506432806134e-02   -9.285773901207744e-03   +1.007167776338884e-01   -9.270434699071156e-04   -2.249899430549380e-01; -3.714777803941935e-01   -7.291302864242316e-02   -2.067132281494942e-01   +3.957215673742804e-01   -1.896707011820807e-01   -1.280543183805922e-01   +1.705816003133218e-01   -4.500473749607883e-02   -2.869138731398769e-02   +3.031527383460677e-01   +1.933877373354908e-01   -1.225951585727619e-01; +3.385882384121550e-01   -6.699534933197034e-02   -2.915446113727193e-01   -2.549614720108121e-01   +2.151197286495093e-02   -4.068028809864730e-01   -2.968434901502268e-01   +5.967180772721634e-02   -3.621720645908719e-01   -5.249076479583091e-02   -8.307575691389002e-02   -4.587840776464589e-01];
L2E_L3E_iAMPA_netcon = [-6.868571086717939e-02   -2.294475370747115e-02   -1.909438622516575e-02   -1.290020839895090e-01   -1.800616679003075e-02   +1.195673395059452e-02   -1.455195578619281e-01   -4.486674756224976e-02; -1.685546120828230e-01   +3.371107450736943e-01   -2.367778853053316e-02   +1.727056981606391e-01   +1.976411483063632e-01   -1.963555220875608e-01   -4.463429424060893e-01   -3.930850953296733e-02; +2.621984464033469e-01   -5.799637607974349e-01   +1.752554820725719e-02   -8.185688879654884e-02   +4.301322256564809e-01   +1.169151812865724e-01   -2.597799180414306e-01   -4.198560333857796e-01; +3.624798830862552e-01   +1.558989318559389e-01   -9.232882980856659e-02   -1.828239843303567e-01   +1.146744171993723e-01   +5.982099327201926e-01   -1.646330914729995e-01   -1.408914201737735e-01; +1.907628114047663e-01   -3.108114548918020e-01   +3.368574122351125e-01   +9.054877486996765e-02   +3.842829367500636e-01   +3.956867955530079e-02   +1.330536965768194e-02   -2.373879519181789e-01; -7.054012222991554e-02   -1.802631334115769e-01   -2.212346154666702e-01   +1.391382577755256e-01   -9.809929832076045e-02   -6.731759486257036e-02   -7.361033998140668e-02   -1.423884024160528e-01; +2.821680584725303e-02   -4.066002064794676e-01   +4.149954160073993e-01   +8.585597122027699e-02   -1.870499357154448e-01   -1.591681457989895e-01   -1.155560502038624e-01   +1.902164119055551e-01; -2.887520136467409e-01   +1.391993681193935e-01   -6.731044886732437e-02   +2.097859251070711e-01   +2.011321135288203e-01   +1.983773291488519e-01   +4.524168419571096e-01   +1.875062728394310e-01; +1.465344892514947e-01   +2.580434165143271e-01   +2.379289050834104e-01   -6.550045606173419e-02   -2.089929933401180e-01   +5.459266452262382e-01   +1.237457563371867e-01   -1.805059599206383e-01; -3.503956212950563e-01   +1.688076011522539e-01   -2.837126104643216e-01   -2.372738299284881e-01   +2.900538830063052e-01   -1.850100767466129e-01   +8.183596358360579e-02   -2.178737602872387e-01; +3.744600761666939e-01   +1.787241444178786e-01   -1.110548962128766e-01   +2.012581497275343e-01   -1.370545087546843e-01   -1.118579422935160e-01   +2.281112323641506e-03   -2.326509271333581e-02; +7.642938247569840e-02   +3.253448188892933e-01   -2.524656613490617e-01   -1.064044910228501e-01   -5.557478923249266e-01   -1.886466220606147e-01   -1.376821700622724e-01   +6.544242890773488e-02];
L2I_L3I_iGABA_netcon = [+1.986060157982852e-01   -3.318060634733928e-01   +3.134575888772986e-03   +6.045066063844885e-01   -1.103536641030866e-01   +4.329257958438598e-01   +3.147082156900126e-02   -2.611803526164380e-01; -3.953809694966313e-02   +2.140463870702283e-02   +1.242420038795863e-01   -2.638513755183803e-01   -3.717197471865527e-01   +2.000482379815836e-01   -2.392155967873959e-01   +1.517936074190494e-01; +1.257580864952618e-01   +4.039671886515954e-01   -3.003379178578109e-01   +2.982747116809831e-02   +3.026406063839004e-01   +2.032074510323904e-01   +2.730831291772496e-01   -1.332702901147850e-02; -3.078822623137258e-01   +1.231239770138724e-01   -7.662564168740205e-02   +3.587083238351482e-02   +1.088817028795082e-01   +3.004832025413364e-01   -8.984543207345429e-02   +9.651413797032599e-02; +3.628657860531714e-01   +2.091058925327376e-01   -3.239576206045793e-01   +2.486206365768063e-01   -2.090788590349405e-01   +4.681492046597991e-01   +1.017059860203535e-01   +1.547613499260295e-01; +3.501302929807412e-01   -3.725639523628437e-01   +2.371622578965904e-02   +1.412393483080265e-02   -4.072773018176963e-01   +2.633791503226551e-01   -7.310679457092549e-02   -8.758106618916633e-02; -1.780407157103657e-01   +3.761674991779131e-02   -1.631847958690620e-01   +1.505195389329465e-01   +3.749186837534352e-01   -1.295906126220389e-01   -1.161971296316926e-01   -1.022610510756307e-01; +6.563526572634049e-02   -2.413598493576085e-01   -1.680890254089576e-01   -2.822058352275901e-01   +3.571582196520585e-01   -2.168139872543061e-01   +4.481153476779264e-01   -1.262566054506004e-01; +1.212836323112448e-03   +5.970602080099113e-01   -4.246024991429300e-01   -3.129968238957515e-01   -2.266850782025579e-01   -1.692347881705407e-01   -2.404521880290008e-01   +4.482066988620353e-02; +2.750864210591358e-01   -3.048781194900427e-01   -5.203160719085791e-01   -2.465206193114555e-01   -6.203836921683451e-02   -1.283004787375089e-01   -4.859449208719260e-01   +4.041890389313983e-01; -3.513716911182947e-01   -1.195331670799616e-01   -4.243981883251119e-02   +1.354700832062869e-02   -9.861015016804668e-02   +3.469667853870094e-01   -2.293960610943190e-01   -4.188578746910242e-01; +3.371846548030336e-01   +3.861275569175388e-01   -3.567960671495120e-01   -4.104209086121017e-01   -3.770518626681366e-01   +1.279353200397434e-01   +3.033420709028283e-01   -4.885751287681461e-02];
L3I_L3E_iAMPA_netcon = [-3.400301916146187e-01   +2.849839550321553e-01   -3.998514698324100e-01   +1.717580387381489e-01   +1.872185386509198e-01   +3.092807056758509e-02   +7.780249278009818e-02   +6.566272542481344e-02   -5.307150380616994e-01   +1.828526132423390e-01   +5.517114636406552e-02   -2.237351329250685e-01; -2.621640325139575e-01   +1.025707581859651e-01   -1.443704571972096e-01   +1.123103221877116e-01   -1.040412445836696e-01   +3.315996017371906e-02   -3.714737202877836e-01   -1.513112902769648e-03   -2.698384954510069e-01   -8.139043668299903e-02   +2.463579150970586e-01   -5.069262486340333e-01; -1.878660741197701e-01   -1.324629104105707e-01   +9.827567916099900e-02   +1.535605568280720e-01   +5.140149020513708e-02   +6.697338666028672e-02   -3.806050835353771e-01   -3.660503475621535e-02   +3.359145783794549e-01   +8.871682363176947e-02   +1.637477604376017e-02   +1.996443224460192e-01; -1.144611225919280e-02   +3.618675273224059e-02   -8.633729303779536e-03   +4.688168489304058e-01   +8.411059260811138e-02   -1.984535114425545e-01   -4.107316222539772e-01   -3.613041692131512e-01   -4.835677065915650e-02   +8.308407829273420e-02   +5.858325906369144e-01   -4.723101547528377e-03; -2.343635958850496e-01   +7.730620574233693e-02   -9.419546042021025e-02   -1.391552728032729e-01   -5.278246619598688e-02   +1.367243188920480e-01   -2.234232083049853e-02   +9.679235794541635e-03   -3.731814997414679e-02   +3.345629105757931e-01   +5.249925394952724e-02   +2.624377676403548e-01; -6.211850210459444e-02   +2.874093367823615e-01   -1.576620501268533e-01   -2.851585029663816e-01   -1.678035965709789e-01   -1.324620649364816e-02   -9.200919271779129e-02   -8.190255757214229e-02   -1.805253589706305e-01   +3.228391439229312e-01   +3.893735690397412e-02   +7.517256622099655e-02; -8.452736658453687e-02   -3.964199157914510e-01   -1.699974443627045e-03   +1.715225335582806e-01   -1.246648044196993e-01   -1.778427242731979e-01   +3.302079936506663e-01   -4.562359924387148e-01   +5.010049100451917e-02   -5.421469212369994e-01   +3.770356791789384e-01   -1.012562473560993e-02; -1.302788961884126e-02   +1.385821002452053e-01   +3.069028330025458e-01   -1.606012679406269e-01   -1.188483891334468e-01   +1.732127032783661e-01   -3.385013180877436e-02   -2.400664026351405e-01   +1.223672164599484e-01   -5.109392486937089e-02   -9.240233466096970e-02   -1.770798408257768e-01; -1.709493837831726e-01   +2.019683435081621e-01   -2.248155772721079e-01   -9.655721137405621e-02   +7.643345382968819e-02   -9.861190482283838e-02   +2.869661443629266e-01   +2.316732046053964e-01   +7.144366963261040e-02   -3.392971976626898e-01   -1.227596802712310e-01   +6.755635099777017e-02; +1.382787355992008e-01   -2.727985572298436e-02   +1.060883898985657e-01   +5.262464321118598e-01   +3.299281218303848e-02   +6.016443214980582e-02   +6.872326286817299e-02   -1.137823993975637e-01   +8.001168497649039e-02   -2.592191560179695e-01   +2.009384701080058e-01   +1.420042534155562e-01; +1.967270515246617e-01   -1.717821933263217e-01   -8.322104524514927e-02   -3.176261979968180e-01   -1.939803363949010e-01   +2.916073686076328e-01   -5.553821073401755e-02   -1.112426921545060e-02   +2.677513059661508e-01   +6.759485664046948e-02   +8.088118588417034e-02   +4.886974941824143e-01; +2.222816751343181e-01   +3.484546191328133e-01   +2.203669875727067e-02   -4.439428767822855e-02   +1.115371332114870e-02   +6.301244459902147e-02   +2.153360227136959e-01   -5.082967589249276e-02   +2.420610505363854e-01   +1.180405534670740e-01   -9.955652300290460e-02   +3.209795992845224e-01];
L3E_L3I_iGABA_netcon = [+2.495728443289702e-01   -1.857572592488415e-01   +1.460899891416660e-01   +8.854461932755733e-02   +1.917439990095249e-01   -1.054290170366767e-02   +1.630577911203611e-01   -1.912045115211160e-01   -1.782575080979826e-02   +1.930512527369124e-01   -1.818461346830859e-01   -4.244611670253360e-01; +2.887155202783430e-01   +2.587742811478422e-01   +2.465907262564898e-01   -3.913315979089008e-01   +1.163193371337407e-02   -4.408134635203782e-02   +2.444587656522027e-01   +1.365238428380905e-02   +2.871971990119066e-01   -1.864339392636861e-01   +9.924357017281764e-02   -3.774208215167594e-01; -1.305632665587377e-01   +3.730632126027820e-02   +1.041242227853579e-01   -3.080476035803726e-01   +9.761852220013606e-03   +3.864030557337232e-01   +7.834466640327231e-02   -3.893896939904018e-01   -2.300351506467281e-01   -2.233654456083937e-02   -1.593121869281214e-01   +1.380092878109725e-01; +3.626113113851515e-01   -4.097560780873035e-01   +2.788263366089324e-01   -8.348001677858383e-02   +2.269879885668198e-01   -2.872611336069392e-02   -2.121803905905184e-01   -4.306888289069388e-01   -2.864583497434677e-01   +2.755852094141200e-01   +2.793942044802520e-02   -1.994887073416099e-02; +2.808449617883928e-01   -3.838468905913610e-01   +4.727471518112663e-01   +9.977552541133028e-03   +3.263613191023920e-01   +5.340699020112236e-01   +1.946913389969643e-01   +7.151999382294746e-02   -6.397473030860147e-02   -1.545837572582753e-01   -1.808853279148666e-01   -3.578686206306636e-01; +9.050727535152912e-02   -1.257081721984092e-01   -6.197639687369746e-01   +1.965950806067084e-01   -4.289962346123479e-02   +2.819788815582663e-01   -3.961436098834561e-01   +1.210415644147864e-01   +2.155207684335908e-01   -2.531882711884955e-01   -2.496050263363926e-01   +1.037894088018179e-01; +3.247160025393790e-01   +1.826873743308795e-01   -1.654505304312440e-01   -1.033775975492643e-01   -3.001182932429348e-02   +3.470871533413840e-02   +9.148004388746152e-02   +6.664856750722338e-02   +1.925454525652693e-01   +2.793904264535194e-02   -2.369304319132502e-01   +2.275327943137237e-01; +4.651867993234669e-02   +3.639735515514090e-01   -3.868777648824326e-01   -2.839141009868936e-01   -7.668618615249444e-02   -1.433513129370804e-01   -2.535679804475327e-01   +5.096819660406369e-01   -4.839659837872544e-01   +1.273637970123722e-01   +7.357217085845226e-02   +2.291166331820495e-01; +1.792499661062394e-01   -7.870736638301870e-02   -2.784152089874254e-01   -1.020076929567705e-01   -4.288139705876254e-01   +9.890802017519866e-02   -1.081593128641251e-01   +4.635149932016408e-02   +1.844758029346739e-01   +2.479744133189102e-01   +2.751077104695562e-01   -4.772236777908382e-01; +1.516733363982850e-01   -1.991005079073989e-01   -1.447942502452900e-01   -3.953820964028533e-01   +2.521793344007335e-01   +1.670858278029003e-01   +8.014944316323920e-02   +1.279440522130358e-01   +1.462533585257832e-01   +4.116552796447248e-02   +9.017938369997279e-03   +3.637169408635381e-02; +3.903551379219910e-01   -2.421249820705161e-01   +1.380238229158562e-01   +2.181229386968529e-01   +5.030864568324464e-02   -3.327979650398972e-01   +2.625507413011036e-01   +3.527120446330457e-01   +2.103433166961660e-01   +2.052332520075664e-02   +4.128826982493555e-02   +6.398453259466626e-02; -1.270200241024989e-01   +1.052956065704809e-01   +2.620301842734795e-01   -1.938424343554256e-01   -3.058991352226448e-01   -2.361541683409716e-01   -2.196030482524005e-01   +2.664408379815958e-01   -6.761320903071312e-02   -2.352358782606458e-01   +3.011900602103559e-01   -1.041515749704922e-02];
L2E_Input1_iAMPA_netcon = [-2.891721070617281e-01   -2.773532007261846e-01   -2.735048667278428e-01   +3.072364549571399e-01   +2.029035396138231e-01   +2.636523691780893e-01   +2.100852165950693e-01   +4.028399220218931e-01];
L2I_Input2_iAMPA_netcon = [+2.629748174156545e-01   -4.128630767931573e-01   -1.309532788113189e-01   +5.068762375624577e-01   -1.818024572122379e-01   +1.270291500228122e-01   +1.828449278373425e-01   -3.804593628897193e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
