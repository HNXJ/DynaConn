function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.685241305059358e-02   +5.086560975691269e-05   +3.008704409318805e-02   +1.649505154515701e-01   +7.724397967843077e-02   +6.486969828919617e-02   +4.033567048441139e-02   +1.864829087737707e-01   +5.776071114505787e-02   +8.989012953559597e-02   -3.686422988734075e-02   -4.462453999980377e-02   +1.571532821261214e-01   -4.091708300105203e-02   +7.545211590081637e-02   +7.344593550901790e-02; +3.332343168052596e-03   +1.488059019686296e-02   +1.567473879660524e-01   +1.781333730353268e-01   +9.615998806578836e-02   +2.973635053697531e-02   +9.458832566288353e-02   +1.924265833550161e-01   +5.504193900413872e-02   +4.928399734554262e-02   +9.182150599763626e-02   +1.123254808734781e-01   -1.066622764080622e-02   -4.863218905284918e-02   +1.251116716117064e-01   +3.321612095230534e-02; +1.962010353677286e-01   +7.198283001950373e-02   +1.969862796170908e-02   +1.219272947051828e-01   +3.030642524447211e-02   -1.438670507310909e-02   +1.303656616307813e-01   +2.511777599669591e-01   -1.398653263711767e-02   +1.573556534850844e-01   -2.634943567333090e-02   -1.116839978005269e-01   -2.599158950625420e-02   +2.669656187107693e-01   +1.034936160949854e-01   +2.393066502708410e-02; +7.507712451121616e-02   +8.337192486907684e-02   -6.830419874629362e-02   -8.276361194953873e-02   +1.086291936598581e-01   +8.013708157009426e-02   +1.030940718812989e-01   +1.178465224931980e-01   +5.568149118449791e-02   +1.794260854844925e-01   -6.240093814801002e-02   +1.043625589578249e-01   -5.291928918566721e-02   +5.345722710527923e-02   +1.790105072512594e-01   +2.093212375280688e-02; +1.130653551320227e-02   -5.027633530790305e-02   +4.717248968775781e-02   +1.416763909058963e-01   +1.880919521866058e-01   +2.570441290160667e-02   +8.448728042431856e-02   +2.617637591750454e-02   -1.410822210607227e-02   +6.297501205063141e-02   +7.150725175567256e-02   +8.038407028008909e-02   +1.112579614221934e-01   +6.213385540230962e-02   +9.880206919036508e-02   +1.097127381207406e-01; +6.232253099056610e-02   +1.981857077371008e-01   +1.629279646341160e-01   +9.604347454585599e-02   +2.354680007383597e-01   +2.317340511622520e-02   +1.084464463922887e-01   +1.045359689010124e-01   +1.299790055725076e-01   +1.488579152307871e-01   +1.453191496051068e-01   +2.301950320871236e-02   +1.737449874352498e-01   +1.161366358763498e-02   +1.275668518511846e-01   +2.376715670786167e-01; +1.429627782185090e-01   +3.933513559598959e-02   -2.069895114381535e-03   -5.975958085948185e-02   +2.152027650185305e-01   -6.974779969190856e-02   +1.778892155417020e-02   +9.330719018104683e-02   +5.706603223253016e-02   +2.016806222315947e-01   +8.448620114442612e-02   +7.751453514583370e-02   -1.279013644533721e-02   +1.252102363231276e-01   +3.752856726049688e-02   +2.438923011168880e-01; +1.366623188960411e-01   +1.111293767108581e-01   +9.461928401388470e-02   +1.896668388498000e-01   +1.684986429270820e-01   +1.110702695034341e-01   +2.413834169439104e-01   -9.208737958433418e-04   +1.120486440635355e-01   +8.621543509619584e-02   -5.159644474356791e-02   +3.147536822091820e-02   +5.029243348729864e-02   -6.890527678842382e-03   +7.992720572248077e-03   +5.246186626249149e-02; +1.249383875649184e-01   +1.347881195478433e-01   +8.002498414959348e-02   +1.350102051208232e-01   +9.711345207382374e-02   +1.170232446623085e-01   +1.980790088556374e-01   +1.139742239695806e-01   +1.844445722912658e-01   +1.774809188826890e-01   +9.591031221213547e-03   +9.036059548272649e-02   +2.077505179172088e-01   +9.739153089253341e-02   +1.212878426805083e-01   +1.095335731773475e-01; +1.584220623129250e-01   +3.757673820150936e-02   -1.457446662143471e-02   +5.147020760488843e-02   +5.446201975994173e-02   +4.417888001852749e-02   +7.546114186761124e-02   +3.109929648880443e-03   +2.026019526167362e-01   +1.489973196028309e-01   +3.564244727334889e-02   +9.073176737607536e-02   +6.474676838835978e-02   -3.026937881021989e-02   -4.302992637645278e-03   +7.155336086012219e-02; +7.121080546763150e-02   +8.477003467330557e-02   +7.725618776606821e-02   +3.974785918055265e-02   +1.486361406533583e-01   +1.743216634504116e-01   +4.016882048070687e-02   +8.919284626086500e-02   +7.318215716353522e-02   +2.125988589403476e-01   +1.177061535935489e-01   +1.720174710662103e-02   +1.456075681175890e-01   +1.076030291052559e-01   +1.568294124557906e-01   +7.468147020543864e-02; +1.119685978881194e-01   +6.642916676371391e-02   +3.641536765881671e-02   +2.200489189521360e-01   +6.183290475795226e-02   +1.082984079184212e-01   +1.814963966110825e-01   +1.347339841854473e-01   +1.392322239336995e-02   -1.424991989471656e-02   +3.143306648433319e-02   +4.383278819971433e-02   +9.870689444917757e-02   +6.557263328190482e-02   -1.719347362463427e-03   +5.952573954157700e-02; +6.496602530737616e-02   +1.218719635677301e-01   +4.258093577427744e-02   -3.109295585701470e-02   +4.418523510894933e-02   +5.059068612018559e-02   +1.901879776751028e-01   +1.620474256457110e-01   +1.061710332629782e-01   -3.103739381912217e-02   +1.247446410506797e-01   +4.291212986091222e-02   +6.335188697319150e-02   +1.014186925587337e-01   +1.207025580602295e-01   -2.259240846643074e-02; +5.255559302412682e-02   -1.732443798637593e-02   -1.169738447809034e-02   +1.085409165472277e-01   +6.146783065000562e-02   +1.642084391788749e-01   +8.451072929552417e-02   +4.286705438668768e-02   +3.359219669232685e-02   +1.209563238168433e-01   +6.422844520684781e-02   +1.043052392860667e-01   +6.820535238339821e-02   +4.859864356683805e-02   +1.066284795991038e-01   +5.268929601501965e-03; +1.237777585083728e-01   -1.075619765695210e-02   +5.676731711541765e-02   +1.519174756296296e-03   +1.183657689520781e-01   +1.543496944329207e-01   -4.318376033405624e-02   +1.236076685087383e-01   +1.616887241991046e-01   +1.629512363793809e-01   +1.430235026835013e-01   +1.579092898734284e-01   +2.010638774345722e-02   +1.415220350164693e-01   +1.967904842104862e-01   -3.653814075017506e-02; +9.701230103861455e-02   -3.486367161153484e-02   +2.093525664548184e-01   +3.966692144578947e-02   +3.630178883293732e-03   +1.187290404123834e-02   +1.143379429500705e-01   +8.956856893706025e-02   +1.380273963290446e-03   -4.396471091172573e-02   +1.381757767434932e-04   -2.277798060590459e-02   +7.366400026010259e-02   +1.073299441780046e-01   +3.928540744814091e-02   +8.865212464301876e-02];
L1E_L1I_iGABA_netcon = [+6.349946247663861e-02   +1.058180422404720e-01   +1.907239096225475e-01   +1.263675004403419e-01   +1.825916492035348e-02   +5.539469075869487e-02   +9.042743053949788e-02   +2.007114093884882e-01   +1.231648256547546e-01   -3.333049493462573e-02   +1.914883705479220e-01   +3.342632942488627e-03   +9.304377211011747e-02   +9.678320831062806e-02   -5.502014979199804e-03   +9.886082985956797e-02; +1.844703170128001e-01   +2.382272924183085e-01   +2.814671957810146e-02   +4.166189802523745e-02   +8.541662328060365e-02   +1.129382022814020e-01   +1.937834046706977e-01   +2.135009922627224e-01   +9.087263424438574e-02   +1.385714609527938e-02   -4.358883015643505e-02   +6.235074052956589e-02   +7.888218066311320e-02   +3.209883938022819e-02   +8.797888521454927e-02   +3.100817422663929e-02; +1.046380747938032e-01   -2.103626399519071e-02   +3.222344533996695e-02   +1.402384457823583e-01   -4.938686812493403e-02   +5.592192281591522e-02   -3.442833977739382e-03   +1.035139888927694e-01   +3.706814700335169e-02   +1.041716712360030e-01   +1.460304183154413e-01   +1.133679025893158e-01   -2.904545691833278e-02   +1.251884365258796e-01   +6.615548381934365e-02   +5.171486939715116e-02; +8.404000402482165e-02   +4.309348435035873e-02   +6.460463317939276e-02   +1.470673663696558e-01   -6.357173134259157e-02   +1.012866632488011e-01   +1.229190297339333e-01   +2.719070493542392e-01   +1.959231148399056e-04   +5.649436686087661e-02   +1.401351580695994e-01   +1.972561960330233e-01   -2.773456775594907e-02   +1.737540108332556e-01   +5.107883016721249e-02   +1.664958155779674e-01; -1.864136809791643e-02   +4.514424964068649e-02   +2.482218656783329e-01   +5.961353184627575e-02   +4.084879196017616e-02   +1.099918283543573e-01   +2.646382175971789e-01   -1.432384053060594e-02   +1.459686134180463e-01   +1.701809276924949e-01   +1.437439775325491e-02   +1.265580008907579e-01   +2.970555749109558e-02   +1.420571980552832e-01   +5.097190244943648e-02   +2.261110556395851e-01; +1.129606263146429e-01   +1.586574555364986e-01   +1.219487337095558e-01   +6.581397427098101e-02   -4.106573535043480e-02   +1.849389766205972e-01   +1.172414126962706e-01   -4.613142617379785e-02   +2.096213735128304e-01   +1.670309662233687e-01   +7.801281398897096e-03   +4.035235535699897e-02   +5.342300729149500e-02   +6.878939835320902e-02   +9.840981194164514e-02   -7.892423245005883e-03; -2.334359258957069e-03   +6.501124198183225e-02   -4.788595694540966e-03   +4.144419181598556e-02   +1.615284912531537e-01   +1.649841275957055e-01   +1.491257480246775e-01   +1.760297040819645e-01   +6.653447967627087e-02   +1.309905805547902e-01   +7.308487707819915e-02   +1.498964326659436e-01   +1.015695008038597e-01   +5.195171974666851e-02   +1.050081984954416e-01   +4.435817415818449e-02; +1.513173443236509e-01   -1.659228487339265e-02   +1.228965135318099e-01   +1.183520903720896e-01   +2.435924910901821e-02   +5.534090386051827e-02   +8.639272194363018e-02   +7.070980869005349e-02   +7.654364164307001e-02   +2.083842153996672e-01   +9.902157865334082e-02   -1.207472984314261e-02   +1.475264435217349e-01   +1.599905222531583e-01   +1.656371806061285e-02   +7.832419225039217e-03; +2.396574155167946e-02   +3.157980452200289e-02   +1.555922193114688e-01   +3.611827248523641e-02   +7.309284174163450e-02   +6.851821755470416e-02   +7.545715634744091e-02   +1.098290969889918e-01   +5.855571463718864e-02   -2.138476892247630e-03   +1.616262403689830e-01   +1.276210358472200e-01   +1.369428633307321e-01   +5.400187804527027e-02   +8.089604341293286e-02   +9.474221409037809e-02; +2.026530931013495e-01   +9.316252896625661e-02   +2.003610651717736e-02   +2.154503466965502e-01   +9.567846219588033e-02   +1.463553523756530e-01   +3.719432184262323e-02   +5.228707680057064e-02   +1.769668772037178e-01   +3.475246799268404e-02   +6.977032976978685e-02   -6.100364229583637e-03   +3.035748607546158e-02   +1.449983472354860e-01   +1.065502286429288e-01   +4.314433990002618e-02; +1.523490015792523e-01   +1.916581072157045e-01   +1.455852037217507e-01   +2.723783343795148e-02   +1.645177457100173e-01   -2.917570020385350e-02   +1.114521619974545e-01   +1.288125340066982e-01   -8.406672205902371e-02   +6.901155263857213e-02   +6.749665674897447e-02   -9.041369017445783e-02   +1.148007483674462e-01   +1.057587138006994e-01   +1.956463502280979e-01   +6.876033880110013e-02; +2.197482243489035e-01   +3.757553825603545e-02   +1.511333065247983e-01   +2.046111704253018e-01   +1.212085551283717e-01   +3.407764055458205e-02   -3.371810304270099e-02   +9.697722935917827e-02   +6.586720066601015e-02   +9.484813880539922e-02   +1.972081919843285e-01   +6.472614142298602e-02   -1.047626997651776e-02   +1.681837643587246e-01   +1.346757260293515e-01   -4.150076479687434e-02; +1.148480352065987e-01   +7.925572308759248e-02   +3.777347726138726e-03   +1.762975166675774e-01   +2.305651610339308e-01   +1.239478998273263e-01   +1.301031602175990e-01   -6.650485478687880e-02   +2.199214556261737e-01   +1.477077959666158e-01   +6.206076220733885e-02   +1.842892786843045e-01   +5.501847930667951e-03   +2.839492894250329e-02   +1.001418983768718e-01   +8.854894033944437e-02; -6.228089118721990e-03   -5.979120092138426e-02   +1.334538212612234e-02   +8.275627733168260e-02   +8.265340845981038e-02   -4.256327741382435e-02   +1.039475454009432e-01   +1.873898705258193e-01   +1.493419411464846e-01   +4.669425268433866e-02   +7.905303999003574e-02   +4.060511784637861e-02   +1.888763070607581e-01   +1.737158107011483e-01   +9.848847039561336e-02   +3.532928938393425e-02; +1.527859776237238e-01   +1.393086384624151e-01   +2.333086077371343e-01   +1.347939704236870e-01   +1.200655029663104e-01   +4.926960913579626e-02   +1.754211209036618e-01   +9.973638728319739e-02   +1.720821463747294e-01   +5.419248055191872e-02   +5.473208383790487e-02   -4.124409691029222e-02   +1.081014952568368e-02   +2.154289931995082e-02   +9.005725831151837e-02   +8.097962893930151e-02; -9.422303131588791e-02   -2.805926732771039e-03   +1.052697062707478e-01   +5.672972449773071e-02   +1.370008984171276e-01   +2.248628140930091e-01   +2.387598296254744e-01   +1.410596963498993e-01   +1.070534059841640e-01   +7.089489907299226e-03   +2.270523866684500e-01   +1.069544329473498e-01   +4.537519258741582e-02   +1.622894667866741e-01   +5.880346133165910e-02   +3.008410069089668e-02];
L2I_L1I_iGABA_netcon = [+1.064395893156134e-01   +1.704657885810855e-01   -6.063670762285929e-03   +4.909993588979972e-02   +9.814581347915802e-02   +1.264656449248009e-01   +9.705655393873108e-02   +7.080316541395776e-02; +5.510389753105914e-02   +4.343132725781854e-02   +1.337514058784010e-01   +3.303354260593958e-02   -2.355940814438384e-02   +1.021052257309865e-01   +3.980801484275193e-02   -1.275643701632471e-03; -3.595330151790123e-02   +9.382564636330967e-02   +7.332920653797600e-02   +2.573116482338829e-01   -1.702642170688522e-02   +3.097320206064575e-02   +2.731162358532800e-02   +8.864138159180152e-03; +1.045472067672341e-01   -8.857957524933985e-02   +5.511872400935343e-02   +1.377351482329210e-01   +6.015636951306720e-02   -2.262805504535739e-05   -6.674309776785896e-03   +4.068207853567071e-02; +1.626507184275099e-01   +8.238287253014964e-03   +6.906565694239938e-02   +4.008226661018220e-02   +2.372593692380288e-01   +1.437665531253605e-01   +1.941728783136537e-01   +6.615574205378445e-02; +6.770851246273948e-02   -8.241315057917042e-02   +2.024182791757603e-03   -8.623133147455084e-02   +2.079903701068242e-01   +7.638935401752979e-02   +2.356519824562262e-02   +6.264983196463943e-02; +7.729456487604106e-02   +6.395562057630075e-02   +1.849739631305261e-01   +9.447676249122906e-02   +9.508128173148911e-02   +1.013574305943289e-01   +1.356052137195267e-01   +8.855248731507614e-02; +1.324882440718536e-01   -4.954883365326910e-03   +2.113619657888003e-01   -5.402457085076962e-02   +1.545912363425658e-02   -6.149573253714024e-03   +8.863119354664362e-02   +9.852785082462132e-02; +1.203927400248020e-01   +2.544557011117033e-02   +1.703872652182920e-01   +1.945905094532510e-03   +5.701156025393159e-02   +1.686761954037945e-01   +1.766084593347377e-01   +2.523056960742533e-02; +1.171883934414374e-02   +3.170606033736453e-02   +1.486809089862006e-01   +4.540887325861918e-02   +1.427491619239592e-01   +7.660787288288384e-02   +1.838561423245857e-01   +2.392771490793383e-02; +1.970392470127899e-01   +1.673603875209906e-01   +2.036439215572556e-02   +1.586025550929230e-01   -6.730529060525668e-02   -8.090088375540740e-03   +9.359953350481036e-02   +1.941426533598547e-01; +1.274122951704326e-01   +1.540773725359076e-01   +7.347353109741596e-02   +1.174531648766802e-01   +1.654527672375202e-01   +4.398430087106779e-02   +1.282603804529359e-01   +4.840411775911504e-02; +1.534402831208846e-01   +1.863939103906653e-01   +6.632797285398209e-02   +2.304259454193152e-01   +9.998763070596195e-02   +9.703504190780764e-02   +3.373940039434709e-02   +4.756152621407151e-02; +1.021544616685340e-01   +2.640055475755399e-01   +2.265388311115904e-01   +1.658449563093543e-02   +2.065784236040498e-01   +1.320147873953627e-01   -4.604728646616896e-02   +2.013544126432670e-02; +6.871919297311523e-02   +1.611068485961196e-01   +9.162835612442519e-02   +1.341086768187432e-01   +6.518874265679464e-02   -1.568590017051074e-02   +1.674813772827577e-02   +4.904343247909999e-02; -4.416953314600125e-03   +1.350712670447276e-01   +3.557028030234809e-02   +1.567556293930454e-01   +1.449193794494142e-01   +3.585400790002860e-02   +1.741253607171763e-01   -1.079135403100735e-03];
L1I_L2I_iGABA_netcon = [+2.400895650871076e-02   +1.844453637982745e-01   -3.403194746377715e-02   +2.016220024247352e-01   +2.155669045900435e-01   +1.076080610539321e-01   +1.375246193072498e-01   +5.202104158188241e-02   +7.776077767368827e-02   -2.558479834937366e-02   +8.745865911976589e-02   +7.225077625007192e-02   +1.425980468358288e-01   +7.541142221379651e-02   +1.754136777572250e-01   +1.702876073465897e-02; +1.182405773883248e-01   +2.511045282907449e-01   +1.090977523593642e-01   +3.468697430208929e-02   +2.226465912486471e-01   +8.617670816807527e-02   +1.138149031132323e-01   +1.210931470068695e-01   -1.877808628967101e-03   +3.470085471360412e-02   +1.054495182666637e-01   +1.275341632235969e-01   +1.423672734495116e-01   +7.750404136534564e-03   +8.494590662070770e-02   +1.358332197101238e-01; +9.289764147057600e-02   +3.366639516176018e-02   +8.533763319843415e-02   +9.123107146672138e-02   +5.992670439526160e-02   -6.896038181118296e-03   -3.444157492388711e-02   +6.773121878663088e-02   +1.292308091459660e-01   +4.715970530367114e-02   +1.928845118540957e-01   +8.279463954818328e-02   +3.322875472560104e-02   +1.100916130608300e-01   +8.587463523348093e-02   +7.545668532882824e-02; +5.264141618683467e-02   +1.498588613606720e-01   -4.206042027774533e-03   +1.491836478554819e-02   -7.375288575202774e-02   +3.887102538377098e-02   +9.761814219352673e-02   +1.695201441826917e-01   +4.417371187282790e-02   +1.363676191188988e-01   +4.947220996957931e-02   +1.273644068315670e-01   +5.535417711594887e-02   +1.786650634441893e-01   +1.357682800705702e-01   +8.917330113097340e-02; +9.092086378970063e-02   -6.345564123073594e-02   +2.023294303049827e-01   +3.073122164107659e-03   +1.956227312200894e-01   +6.214583924772870e-02   -7.455155866478166e-02   +1.293995085866987e-01   +1.645734957899912e-01   +4.575435699606184e-02   +6.371520625525401e-02   +1.722438683672781e-02   +1.418719265582660e-01   +4.707246271469936e-02   +1.420017902862392e-01   +1.218749836546978e-01; -2.393160337957261e-02   +1.319462237697747e-01   -6.476762694900566e-02   +2.059219407158834e-01   -6.765885579567515e-02   +2.926155142547618e-01   +1.993805882085410e-01   +3.708200063108812e-02   +4.394201520008473e-02   -2.850774535284640e-02   +1.411957763005773e-01   +9.067248943269768e-02   +8.098394422579988e-02   +1.214331194375124e-01   +7.439991532710268e-02   +1.512405783831721e-01; +2.191187392671377e-02   -3.983452451420914e-02   +1.715467989803462e-01   -2.215255078261203e-02   +1.125006645619481e-01   +3.520919861184217e-02   +1.418689457841256e-01   +7.089858258452697e-02   +1.741610372326592e-01   +1.645693113757792e-01   +4.805818932835988e-02   +1.451454978418365e-01   +9.911520703971448e-02   +3.620754362467573e-02   +1.828321622086258e-01   +1.593152891554679e-01; +6.707239404964295e-02   +2.181385976073695e-02   +1.975246008055656e-01   +7.593368777575225e-02   +3.725875291397326e-02   +1.430246985701626e-01   +6.789296531013747e-02   +2.602844531118559e-01   +2.477213945885317e-01   +6.158102166383649e-02   +5.321936751817596e-02   +7.985664715766806e-02   +2.997520033400142e-02   +9.170043375064177e-02   +9.059540464552507e-02   +1.599881853716003e-01];
L2E_L1E_iAMPA_netcon = [+1.187237108404489e-01   +1.295353504049153e-01   -2.144691866738698e-02   +1.067206519686144e-01   +1.432776451518823e-02   +6.758643118978430e-02   +1.739845349499262e-01   +9.116887720213161e-02; +1.590913739724387e-01   +5.065056935872239e-03   +1.826538509387999e-01   +5.177711431320357e-02   -2.149419709708353e-02   +9.133810485538324e-02   +6.412768731106341e-02   +5.262866880558714e-02; +9.514177793464695e-02   +1.040712700274923e-01   +1.493794984196704e-02   +1.298275523128248e-01   +1.481790935371610e-01   +8.022161319784584e-03   +9.524816833767513e-02   +8.228096077104777e-02; +1.290989101353309e-01   +1.239659529536112e-01   +1.203676902955599e-01   -2.130315019915327e-02   +3.375150057550176e-02   +2.416890007940580e-01   -1.731298715930469e-02   -1.409748891399164e-02; +4.591500361088727e-02   +8.295354252752937e-02   +2.657420834604754e-03   +1.551635342091660e-01   +9.187490718484602e-02   +9.479581357734698e-02   +3.624209489282516e-02   -4.809090575444531e-02; +1.247874592429877e-01   +1.370570636600402e-01   +1.941272950581286e-01   +1.296218991010611e-01   -7.239790948060050e-03   +1.417496229156461e-01   +1.056179509854938e-01   +2.524687491755045e-02; -7.599591646668537e-02   +1.122219344710731e-01   +1.108117297654474e-01   +2.519058333733836e-01   +4.669766346444369e-02   -5.051177035111575e-02   -1.010778425102573e-01   +1.873406870775355e-01; -4.301151801494048e-02   +8.528029015384907e-02   +1.814194286650513e-01   -5.602586658587411e-02   +9.344481098805391e-02   +4.295956665870599e-02   -2.814638138724637e-02   +8.098318884316996e-02; +1.245093292532241e-01   +1.530095227029912e-01   +1.418262261440872e-01   +1.005112312554158e-01   +5.578284895981989e-02   -7.607221691831364e-03   +5.028813449851414e-02   +1.320411892071778e-01; +1.250608812004047e-01   +2.269263329743912e-02   +2.190158327726806e-02   +6.404809325664326e-02   +5.682052194626313e-02   +1.800043278885872e-01   +1.118053774341373e-01   +3.214747633255230e-02; +3.127601196836763e-02   +3.119889010354133e-02   -1.718639999023281e-02   -3.929231481072353e-02   +1.888908116209685e-01   +5.399573529684137e-02   +1.854159121315012e-02   +7.247491615685088e-02; +1.554729241263979e-01   +7.589664225909656e-02   +1.320717069608657e-01   +2.639347065222614e-02   +1.560620943059550e-01   +9.409350898341934e-02   +6.753142602909759e-02   +9.596001009098191e-03; +1.046022483742283e-01   +1.974269593583162e-01   +6.322964296694421e-02   -3.582482885283891e-02   +9.570585092374347e-02   +1.248926610742431e-01   +1.232268528317223e-01   +2.563572760899461e-01; +1.432830651100924e-02   +4.299297859542386e-02   +1.696282535952315e-01   +2.313375181488644e-02   +1.227411642888711e-02   +2.039885146255182e-02   +2.272264249564635e-01   -3.205138208302663e-05; +1.551839557878353e-01   +1.507840857464958e-01   +1.189298768989502e-01   +1.019337049183930e-01   -3.771859634781476e-02   -1.048083423521647e-03   +2.289990957535942e-02   +6.838630660689020e-02; +1.170922362310874e-01   +7.083322821329074e-03   +5.084142654043590e-02   +3.440372975579938e-02   +1.660515226645136e-01   +2.074211898970904e-01   +8.395695306938508e-02   +1.771740657264719e-01];
L1E_L2E_iAMPA_netcon = [+3.478788364894728e-02   +1.312729155453703e-01   +1.173913789050976e-01   +8.548260979170361e-02   +1.233103844011983e-02   +2.813841170468538e-02   +9.135211278030649e-02   -6.793913987145742e-02   +3.751968804271683e-02   +1.869410440736994e-01   +7.758463877252675e-02   +2.370319865246435e-01   +2.049409892912052e-01   +2.083219322251567e-01   -2.324162123890016e-02   +1.221837998977750e-01; +1.878955978584007e-01   +5.046052229237870e-02   -4.752357211657680e-02   +8.156761323169956e-02   +1.203575908641257e-01   +4.108948491196052e-02   +1.069903839677159e-01   +3.863448495648360e-02   +2.303750138287813e-01   +6.899701648550244e-02   +5.777414613319681e-02   +1.059552711622587e-01   +9.100971256874101e-02   +1.538917308709707e-01   +6.188838967213511e-02   +6.338624097845844e-02; +7.908106576733312e-02   +5.275002926890236e-02   +5.638662540261877e-02   +1.440104680647072e-01   +1.552677915862477e-01   +8.081258035220679e-02   +1.130650746060316e-01   +1.087756477599275e-01   +1.048277205456857e-01   +7.592778817149284e-02   +1.409872082561395e-01   +1.588115118394939e-01   +3.027734162292862e-03   +9.017307645308351e-02   +6.755593161212123e-02   +9.183092017958264e-02; +2.401476903323310e-01   +2.809374189404242e-01   +9.219113725981422e-03   +3.898316724324805e-02   +1.470147597280561e-01   +5.807658567965186e-02   +1.216330258091018e-01   +5.749103898459829e-03   +6.090387151906569e-02   +2.206579156462790e-01   +4.595619895565875e-02   +1.046163008880008e-01   +1.264488530963880e-01   +2.029715984135712e-01   -2.434266193487507e-02   +4.936706908267009e-02; -1.776484436850073e-02   +6.663713298990434e-02   +3.014204646876432e-02   +1.785950337252175e-01   +6.192568536105032e-02   +1.363632713894533e-01   +1.432470933619231e-01   +7.881210167255123e-02   +3.988303749034622e-02   +9.696232504340853e-02   +1.490859227620436e-01   +7.176900867309664e-02   +9.675669057161745e-02   +9.927791808733583e-02   -1.426999033701312e-01   +1.080363543757169e-01; +5.894036687454400e-02   +2.090995759842020e-01   +1.574639578519647e-01   +3.757605130815687e-02   +8.220910495875816e-02   -5.700794647265931e-02   +1.400883749427267e-01   +4.445449240693641e-02   +1.151168244356205e-01   +1.067813003581822e-01   +1.375703566840004e-01   +1.214118843475165e-01   +1.381455215979539e-01   +4.837062758267982e-02   +6.864504183727153e-02   +1.440167623464056e-01; +1.217591417088029e-01   +1.245754341724441e-01   +1.274498204648934e-01   +1.760993746221186e-01   +9.356951827592870e-02   +2.755632138025337e-02   +2.647035013416323e-02   +1.313481207976959e-01   -9.273210610364453e-02   +3.942861053362041e-02   -1.043439639123977e-01   +1.728711526139269e-01   +3.552292138729543e-02   +2.213525225406627e-01   -2.681372873696262e-03   +4.923742543230045e-02; +7.416535571929922e-02   +1.530267637346004e-01   +1.572477463875501e-01   -1.658474008908856e-02   +9.710376060283910e-03   -3.362762672449431e-02   +1.923963500565552e-01   +1.347635573217286e-02   +8.374221712205875e-02   +1.176046279112671e-01   +8.004651340162468e-02   +1.438781505170805e-02   +1.354337416652956e-01   +5.869324879734607e-02   +9.351640668750923e-02   +1.175289521145837e-01];
L2I_L2E_iAMPA_netcon = [-4.227555340773809e-03   +9.984673080471561e-02   +1.175010599076077e-01   +1.352254777457635e-01   +1.203260280660947e-01   -2.973764961175150e-03   -2.277927471043875e-02   +3.809410268047123e-02; +5.655253911921091e-02   +2.771592868790067e-01   +8.537939423778018e-02   +1.873809255790314e-01   +9.890484810963579e-02   +1.705870502909852e-01   +1.440636743418607e-01   +1.765556731007966e-01; +8.790545479496395e-02   +1.317599268086499e-01   +1.897626597916393e-02   +6.407795758065099e-02   +4.539143199237981e-02   +7.598927228347119e-02   +1.029453233806420e-01   +9.366460083632136e-02; +2.007303861063089e-01   -9.250343689510096e-02   +1.223551040908587e-01   +9.573025370026034e-02   +1.221824969444886e-01   +1.084975048459929e-01   +9.091744566675294e-02   +8.599939955884252e-02; -1.039722299810814e-02   +2.187366204822389e-01   -5.681261357910821e-02   +6.760042414982750e-02   +9.355719022299364e-02   +1.484458171370618e-01   +1.577446384112255e-01   +1.349356454319023e-01; +4.550279417660427e-02   +4.270617107209682e-02   +6.496815702379355e-02   +1.533347152403227e-01   +1.262981188181525e-01   +2.231115772377072e-01   +1.917222834537641e-01   -8.612120079134797e-03; +1.166216718814558e-01   +1.374654956875055e-01   +1.943249409437307e-01   -4.862855633515135e-03   +5.757393896440949e-02   +1.016221260178116e-01   +3.923585894681134e-02   +2.188108242038372e-01; +8.861366151643316e-02   -2.624590128669087e-02   +1.701904930951144e-01   +1.473475555303344e-01   +3.575354034934428e-02   +1.822873405806984e-01   -1.330531368707560e-02   -1.063457252929810e-03];
L2E_L2I_iGABA_netcon = [+1.385642163369435e-03   +1.611025491082613e-01   +1.257160409262378e-01   +4.387476862231744e-02   -2.181074593261039e-03   +1.119985361509419e-01   +1.697777746989335e-01   +1.227677398588973e-01; -3.374855609978235e-02   +3.798555476140943e-02   +5.570634856316058e-02   -2.780467258830592e-02   +3.523069376241426e-02   +9.334897329719437e-02   +1.251081413972123e-01   +6.215293306239671e-02; +1.110697082297722e-01   +7.767716643610825e-04   +2.092240502285965e-01   +1.406330979162757e-01   +1.545594235064031e-02   +1.652323424705129e-02   +1.591739513140261e-01   +8.763233212332706e-02; +1.338072612596733e-01   +3.403586553496153e-02   +3.359225084069679e-02   +1.147214373741232e-01   +8.007084574511411e-02   +4.490552582985863e-02   +4.508041307907818e-02   +2.894782269276142e-02; +1.223438604015753e-01   +1.444777781738145e-01   +6.796836295351999e-02   -1.530787953261971e-02   +8.800034966506093e-02   +8.109171665158385e-02   +2.401401376304662e-01   +1.505982242787081e-01; +4.909349064890016e-02   +1.237830787958011e-01   +1.607137140524778e-01   -6.378027999194302e-02   -4.234275905278252e-02   +1.165436723780212e-01   +2.409501462423751e-02   +1.439736156564647e-02; -2.694247238430221e-02   +6.359029403917574e-02   +1.535754636063293e-01   +2.151406854454315e-01   -1.480694146154423e-02   +1.617351448406376e-01   +1.440102821564689e-01   +9.882988395220994e-02; +1.629302891397006e-01   +2.702879169444594e-01   +4.610262449873300e-03   +1.450969186775698e-01   +6.638248237773700e-02   +2.294116937667408e-02   -1.331634086341868e-02   -6.540535340860996e-02];
L3E_L2E_iAMPA_netcon = [+1.249763918147653e-01   +2.020200104591881e-02   +8.026512844800804e-02   +1.036918926671446e-02   +1.787924643908734e-02   +2.674132592381344e-02   +7.321401534200601e-02   +4.441024286612272e-02   +1.139153320096969e-01   +2.668347635535356e-02   +1.835446549141830e-01   +9.408907373861546e-02; +6.666756511078097e-02   +1.834195277515167e-04   +5.866354035258237e-02   +1.017862020120700e-02   +7.056595367945601e-02   +1.557668610532564e-01   +1.289898615798092e-01   +7.670061638196468e-02   +1.601615517951668e-01   +5.511260753186465e-03   +1.995456327554054e-02   -4.961966812481097e-02; +2.038681013892937e-01   +1.299679469208655e-01   +1.170714488718278e-01   +1.339209031669454e-01   +1.322307830708998e-01   -2.897618382858324e-02   +1.866912023086850e-01   +1.792258617782061e-01   +3.812730709418362e-02   +7.471414185150717e-02   +1.445121728679517e-01   +1.087068923313333e-01; +1.080065614559218e-01   -7.828058710063864e-02   +8.500867137563396e-02   +1.590731940442451e-01   +3.353897573395263e-02   -2.525292601391657e-02   +2.599988565487573e-01   -1.563207801910741e-02   +4.439501832611468e-02   +3.574939909950552e-02   +1.480320144035500e-01   +4.674809792536887e-02; +7.912549070152139e-03   -1.142507136946934e-02   +1.534053623111275e-01   +6.999513821641276e-02   +1.349588523410396e-02   +6.634680105682847e-02   +1.390072327568539e-01   +1.929842918930453e-01   +1.441501746411822e-01   -2.717988250996972e-02   +1.168390176554369e-01   +1.500061563890803e-01; +9.495638257370788e-02   +3.543664740832995e-02   +1.110165117466549e-01   +1.029947542527819e-01   -2.312693175895185e-03   +1.485970010924125e-01   +1.777993545536740e-01   +1.027012137852873e-02   +3.976585892824669e-02   +1.447784441026166e-01   +2.208873563065221e-01   -2.516114710687415e-02; +1.424006062843350e-01   +1.545093440551546e-01   +9.352489744627657e-02   +4.390689431142712e-02   +2.411542096697099e-01   +3.019177529528458e-02   +4.196623625167289e-02   +8.115545125705780e-02   +7.988093538274174e-02   +8.170636201675135e-02   -5.407570272982082e-04   +1.955318563520191e-01; +2.031272525125491e-02   +6.681277552259601e-02   +4.608030284651427e-02   +5.917117574058098e-02   +1.601190907545600e-01   +2.415671782595904e-02   +1.730114316391137e-01   +6.689089663136308e-02   -7.462944601013172e-03   +3.156551833652958e-02   +1.733820597827831e-02   +1.215076423819121e-01];
L3I_L2I_iGABA_netcon = [+1.459293842363914e-01   +1.340517525199648e-01   +1.441134024012238e-01   +3.317306182106556e-02   +1.368781565995011e-01   +1.451468646925492e-01   +1.606913284852260e-01   +8.570293629384340e-02   +3.755059131908887e-02   +8.182679472960891e-02   +6.164977325151116e-04   +1.135866753516623e-01; +1.451531816022635e-01   -3.235241612597186e-02   +7.868281070832571e-02   +1.549157762920298e-01   +1.315437921503319e-01   +1.126412852845985e-01   +1.063599336451151e-02   +1.544299739666524e-01   +2.928227039143030e-01   +1.982010475243090e-01   +1.023144462068984e-01   +1.858068882308525e-01; +8.946927755064620e-02   -3.121489749254475e-02   +1.535163064134862e-01   +9.284429395232185e-02   +1.351570027303464e-01   +1.514780549928665e-01   +6.570954217731587e-02   +6.462604193680135e-02   +1.408901772032608e-01   +1.797403368903573e-01   +3.920569733979910e-02   +2.098985703211378e-01; +7.309787128654202e-02   +2.145278838819156e-02   +1.377045446353174e-01   +9.832094154547802e-02   +6.241714616022144e-02   -2.370140452955666e-05   +1.881233272010541e-02   +7.026689697817140e-02   +1.291555423392181e-01   +1.058318888828273e-01   +4.643942377285826e-02   +3.616217542320693e-02; +5.847302831634450e-02   +1.223157938055717e-01   +1.993846675366620e-02   +5.980836621537886e-02   +1.406448277008873e-01   +1.379699555715148e-01   +4.513582184383780e-02   -1.341361478119793e-03   +1.045436653795839e-01   +1.516170639105319e-01   +3.345241280965437e-03   +1.676511308920184e-01; +7.997323136326048e-02   +1.197179091168473e-01   +1.085355432199869e-01   +1.519074269912751e-01   -5.492509206588343e-02   +5.960213327130147e-02   +1.569431416137199e-01   +3.049687641926162e-02   -1.605643638860274e-03   +6.396626615845882e-02   -1.209885731377707e-01   +1.979231383016256e-01; +2.025500722548972e-02   +9.141146746091405e-02   -5.412805063198883e-03   +1.647188824539360e-01   +1.044478134157740e-01   +3.593528612343540e-02   +2.287734839603407e-01   +4.219988430302456e-02   +2.441519139870653e-01   +8.013827045752045e-02   +2.708865751030499e-04   -4.187873409854660e-02; +4.215771625141176e-02   +1.303153102973819e-01   +1.119737876797574e-02   +8.855597332367869e-02   +2.052493812808638e-01   +2.376615826696950e-01   +1.068100416572057e-01   +2.227623873128561e-03   +1.423218247995825e-02   +4.877736783627755e-02   -3.605781171279903e-02   +1.996684023289691e-01];
L2E_L3E_iAMPA_netcon = [+1.293757331981517e-01   +1.002732653319922e-01   +4.312937195283569e-02   +2.460818230161726e-01   +8.435267305200507e-03   -4.237118736434649e-02   +9.848892398081024e-02   -2.683616236145996e-02; +2.078456031605938e-01   +1.540999698291081e-01   +7.873383597294084e-02   -4.966635421049508e-03   +1.559658253126736e-01   +8.987952420784873e-02   +1.467521549017221e-01   +5.723711644107381e-02; -2.493085723098847e-02   +3.775331412613708e-02   +2.474087103456947e-02   +1.125285236620412e-01   +9.887026761984327e-02   +1.530126819380233e-01   -5.046617401780892e-02   +1.956071619096246e-01; +1.552275161180178e-01   +1.051393939273543e-01   -1.250440615947417e-02   -3.041209254820582e-02   +3.135020900037950e-02   +5.311021722220451e-02   +5.671678720547330e-02   +1.176586691972623e-01; +1.271780085603116e-01   +1.597564998868553e-01   +6.118750505441928e-02   +1.730872626318519e-01   +3.739333408086795e-02   +4.916471519873100e-02   +1.707441833858603e-01   +1.559800878632474e-01; +9.044330495978313e-02   +3.572129009204127e-02   +6.201464264523172e-02   +9.177103085396333e-02   +2.018776486227430e-01   +1.431853007838180e-01   +7.292968952875797e-02   +1.498998708774316e-01; +3.997527853191524e-02   +1.334039221489995e-01   +1.186726012766582e-01   +1.141668242344664e-01   -3.157355195379762e-03   +1.282671155551164e-01   +4.926282657436298e-02   +1.647967543204371e-01; +7.985300992934623e-02   +2.759940268543828e-02   +1.507371508741563e-01   +8.447468007077394e-03   +7.941114833721702e-02   +5.043858591192863e-02   +4.629747348241578e-03   +1.772497140052343e-01; +7.618078073826209e-02   +6.163239163723666e-02   +8.566332368545659e-02   -3.130551333979724e-02   +2.800906689964169e-02   +1.414474506238618e-01   -1.021888407923876e-01   +4.592488304345695e-02; +9.832459537965443e-02   -2.336318456836683e-03   +1.408753565351202e-01   +7.429759674400116e-02   +4.529320135081084e-02   +1.102733153941575e-01   +1.676723068808388e-01   +1.227026340924120e-01; +8.235560713509141e-02   +1.066989615844440e-01   +3.463855750985827e-02   +7.031378138218955e-02   +1.172361427180191e-02   +8.296893748614108e-02   +1.305161618826206e-01   +1.697620751394879e-01; +5.425183712890158e-02   +3.030461544969018e-02   +1.093095958819377e-01   +7.268994007406315e-02   +2.656801062965672e-01   +1.153192856707666e-01   +6.675226571836274e-02   +2.161208418388710e-02];
L2I_L3I_iGABA_netcon = [+9.658111779933110e-02   +4.848570275903583e-02   +7.948080004633454e-02   +1.969420227415682e-01   +1.148921867012130e-01   -1.495859945987772e-02   +8.031746276063756e-02   +3.756603509446026e-02; +1.619358764003715e-01   -6.097923141810145e-03   +4.754014741996078e-02   +3.810763316799484e-02   +1.206157356581781e-01   +3.124889194847997e-02   +1.390632095012533e-01   +2.024545789274680e-01; -6.852056635883244e-02   +1.490966954736846e-01   +9.278637401684860e-02   -6.824358884191122e-03   +1.168477863461694e-01   +7.577475913664142e-02   +2.125097404338035e-01   +1.597746349283131e-01; +7.941366252595274e-02   -3.072096526099235e-02   +1.847899807203862e-01   +8.363451764386192e-03   +8.932669669470099e-02   +1.803679914885681e-02   +1.485752518646227e-02   +1.009537408806527e-01; +1.694094000417125e-01   +7.936829390131889e-02   +5.451064113061775e-02   +9.612534005910132e-02   +9.507271980742624e-02   +9.735223195072068e-02   +1.173614058685469e-01   +1.968208912724954e-01; +1.156358858927437e-01   +8.393352357108425e-02   -1.123248310362396e-01   +1.461324831191155e-01   +1.079298580110161e-01   +9.719772563975797e-02   +9.813245488314765e-02   -7.187869950099463e-02; +2.382900448183106e-02   +1.147158402211424e-01   +1.043351266795759e-01   +1.655224962242456e-01   +1.737278619329029e-03   +2.238896166788162e-02   +4.792542977904767e-02   +5.823898963825929e-02; +2.062498542204723e-01   +1.479553331484041e-01   +5.218618827525805e-02   +4.811574897896333e-02   +3.317653217949704e-04   +3.507464716891315e-02   +4.423836187440223e-02   +1.249627103114198e-01; +2.111684128220138e-01   +1.344680306714690e-01   +3.546215446576068e-02   +1.557787176820571e-01   +1.636981262073489e-01   +3.650679783453500e-02   +9.828535398825822e-02   +5.980427919149968e-02; +1.047281064673350e-01   +1.414303879583179e-01   +7.219494294867001e-03   +1.810853539370895e-01   +3.692556999631079e-02   +9.984060094186201e-02   -2.262825548310976e-02   +1.423275576279824e-01; +1.701826062911692e-01   +5.490500670748635e-02   +2.359090083587232e-01   +1.971838965737457e-01   +1.517538086823198e-01   +2.794448007963357e-02   +1.477853363095198e-01   +1.407848511845597e-03; +1.729246227505742e-01   +8.942956739856862e-02   +1.363730811354806e-01   +1.559938751261699e-01   +4.197561345932734e-02   +5.102461244706662e-02   +1.313475943753053e-01   +9.663299024686602e-02];
L3I_L3E_iAMPA_netcon = [+9.117636784343808e-02   +2.404999021521598e-02   -6.300273509524926e-02   -1.880298620105261e-02   +6.982999286279051e-02   +2.157077034933924e-01   +1.125984480077842e-01   +1.333019089129920e-01   +1.254337203524542e-02   +4.432273783054946e-02   +1.691593142111658e-01   +2.070537160464496e-01; +2.151136120005140e-02   -5.385561752822841e-03   +1.597508281034692e-01   +1.228702626330203e-01   -9.203369159758171e-03   +1.195502472264136e-01   +3.327203129284013e-02   +3.786531320750775e-02   +1.223581166075832e-01   +5.674387842873102e-02   +1.252195965187898e-01   +1.995435177769340e-01; +1.674071209655987e-01   +7.271527638140549e-02   +1.686425288527514e-01   +1.349737518145567e-01   +1.099759115747303e-01   +2.345487683352499e-01   +1.227906531961352e-01   +2.304491965580861e-02   +1.123888640951748e-01   +5.866331326358601e-02   +1.636203014636033e-01   +1.160387534069027e-02; +7.911032923152903e-02   +8.928583170579918e-02   +1.130725478434733e-01   +5.767186335628777e-02   +1.034581470848086e-01   -8.470380085379830e-03   +1.235360041081701e-01   +1.967606765513495e-01   +9.671963971373092e-02   +9.445631395066199e-02   +1.201839091846302e-01   +1.670503749273059e-01; +1.378049261075500e-01   +1.570074020542916e-01   +9.108558068538938e-02   +1.208156271026622e-01   +1.984676325110045e-01   +9.876167309092039e-02   +6.686893212815335e-02   +1.203429280097947e-01   +1.014625683214610e-01   -8.359863253042987e-02   -6.730232415116444e-02   +1.649777641621951e-01; +1.431923611244144e-01   +1.549141892955312e-01   +1.381068493805428e-01   +1.219218995980108e-01   +3.843752976591519e-02   -6.094443865788199e-02   +8.955351134668760e-02   +9.885941612683771e-02   +1.836899926495734e-01   +1.207099948447173e-02   +4.708081277151970e-02   +4.570680018403414e-02; +6.463436106068363e-02   +1.438016879738683e-02   +7.606928965288536e-03   +1.146198884684079e-01   +8.891801954429296e-02   +9.529821598866639e-02   +7.180764509614683e-02   +1.117056562044411e-01   +6.454625279072337e-02   +1.512724950573624e-01   +5.406205954446806e-02   -2.802852988389206e-02; +4.419237020998078e-02   +1.801623383121152e-02   +1.184678663501358e-01   +3.937932644695047e-02   +5.904812209855222e-02   +4.097764078327984e-02   +1.344703970954115e-01   +2.811588493719465e-02   +1.706455782202362e-01   -1.269665302167944e-02   +5.540622908240639e-02   -6.770817804112089e-02; -1.289586481574900e-03   +8.194330994384415e-02   +1.115826997473744e-02   +1.852331715353931e-01   +1.602402067360193e-01   +7.824486102236265e-02   +4.618008034262793e-02   +1.880569141398458e-01   +6.958778955965295e-02   +2.041962940678766e-01   -6.217124278249352e-03   +5.883375175464632e-02; +9.719232995218005e-02   +1.979358532082015e-01   +1.939257181592921e-01   +1.045594531292177e-01   +8.479584034178450e-02   +5.857290986804087e-02   +1.156874516687678e-01   +1.581263109076692e-01   +4.234039486927552e-02   +1.767034844189725e-01   +1.106419178395738e-01   +1.198051570444913e-01; +1.587761010515437e-01   +7.947944876173976e-02   +2.402237757122740e-02   -1.679447377509265e-02   +1.107313695899181e-01   +4.612803355619094e-02   +1.155542935497683e-01   +9.673153776883431e-02   +1.539349786988123e-01   +6.036680935013018e-02   +1.202359950752148e-01   +2.682425143954702e-02; +1.800364425758862e-02   +8.633161356289105e-02   -4.200880907782456e-02   +2.952002217958604e-02   +1.213170045683331e-01   +1.182906561907294e-01   +1.347025047896906e-01   +4.859804117055155e-02   +9.285084857383991e-02   +2.553886200764319e-01   +2.148603148559211e-01   -8.110078569659225e-02];
L3E_L3I_iGABA_netcon = [+5.434776864130407e-02   +6.889845340344414e-02   +1.384438121879689e-01   +1.084863312176603e-01   +1.351381132610852e-01   +8.557170936655289e-02   +1.131944820644202e-01   +1.653239031909436e-01   +1.985252734879766e-01   +7.942905929090555e-02   +1.029816417925606e-01   +9.690176680237741e-02; +1.379132883885211e-01   +8.369270920133948e-02   +8.141028771277665e-02   +6.440004573392610e-02   +5.769358262270517e-02   +4.972869469887042e-03   +5.818402704905835e-03   +4.814188304291708e-02   +7.462524482909939e-02   +1.761581169832576e-01   -1.425542460316555e-02   +1.251878626514576e-02; +9.566142986036918e-02   +8.437560836897584e-02   +1.804989037324017e-01   -3.752745966753004e-02   +9.123835649969339e-02   +1.320497865729500e-01   +5.975503566549446e-02   +9.699388981094671e-02   +9.091048028312279e-02   +8.585235741072277e-02   -1.506348307021300e-02   +1.211960029243115e-01; -3.598457756419002e-02   +3.626957253401590e-02   -4.501072408484293e-02   +3.735200412749191e-02   +1.423747168058267e-01   +5.297010051760920e-03   +1.116441561536411e-01   +1.023082802622322e-01   +1.267625424766609e-01   +8.160194783118550e-02   +2.107387446911343e-02   -3.899960421366828e-02; +5.027253490783032e-02   +1.141948055991756e-01   +1.060514345708505e-02   -6.335916316033387e-02   +2.904981643391808e-02   -2.476553242729287e-02   +2.224313154074950e-02   +2.318770250502565e-01   +5.975430481351993e-02   +8.355829022173011e-02   +6.562130170825589e-03   +1.706170398863824e-01; -2.803030064268981e-04   +1.654654096602715e-01   +1.647664895162556e-01   +6.635753107590657e-02   +1.164764855815221e-01   +1.428841562881172e-01   +1.423772128300660e-01   +7.911614933548351e-02   +7.012679633818827e-02   +2.069741922211019e-01   +8.155316927984554e-02   +1.263603405475376e-01; +7.940721542132392e-04   -3.165485768971211e-02   +6.485360047169506e-02   +1.600340140036643e-01   +5.682541861096579e-02   +9.692303408437823e-02   +6.123478377575193e-02   +7.212220047878003e-02   +1.330188472743292e-01   +8.672051852852300e-02   +7.214213791964239e-02   -1.176942776459896e-01; +5.119240769419907e-02   +1.473389459958359e-01   +7.679774296493745e-02   +1.123567840842233e-01   +2.048403756958791e-01   +1.174649717137840e-01   +5.689706406070737e-02   +5.178091213160282e-02   +1.112820931488769e-01   +1.312919394058193e-01   +4.385073226586525e-02   -3.710267457990339e-02; +2.376178126314316e-02   +1.492766440903102e-02   +1.758513978509663e-02   +1.744480606661059e-01   +1.248135411274812e-01   +7.135655664264234e-02   +1.263126704748017e-01   +5.411566259418488e-02   +1.667630154487300e-01   +1.646740309579024e-01   +5.486396692808695e-02   +1.842447519328382e-01; +1.211300260128733e-01   +5.395416727181631e-03   +8.882226618239426e-02   -7.683026281782279e-02   +1.900960038704284e-01   -1.014678049089156e-02   +1.299576232461570e-01   +1.149976688821599e-01   -1.056229079243437e-03   +1.549194749671993e-01   +1.396889571771689e-01   +3.640049966404646e-02; +2.216139311035488e-02   +2.476264353229400e-01   +5.073269246807202e-02   +1.202908197381349e-01   +1.507487532536548e-01   +2.540825384384952e-02   +1.200528546106928e-01   -5.684164983139103e-03   +1.281615997501040e-01   -5.111797246174261e-02   +1.583678125461812e-01   +1.486813310763175e-01; +1.855873272181568e-01   +8.576400902823961e-02   +8.904358702570478e-02   -2.907796094789768e-02   +1.679623898304271e-01   +1.240021730612397e-01   +9.751226803426163e-02   +6.015673941312057e-02   +1.494367923385784e-01   +1.305796744845344e-01   +7.693667287316944e-02   +1.416921704327685e-01];
L2E_Input1_iAMPA_netcon = [+1.038032338282973e-01   +1.105184267501758e-01   +5.519418933377189e-02   +3.632489689296996e-02   +1.584361678036905e-01   +4.416650974032352e-02   +1.890510596166927e-01   -6.015965984730448e-03];
L2I_Input2_iAMPA_netcon = [+9.421142960231438e-02   +1.190204324747629e-01   -1.240601595471169e-02   +1.550194544834458e-01   +6.858692383408038e-02   +1.641893789812717e-01   +8.995839093282065e-02   +1.690121354444357e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.6*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.4*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.6*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.4*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.6*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.6*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.4*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.6*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.4*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.6*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
