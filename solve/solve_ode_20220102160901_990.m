function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+1.252458821631890e-01   +1.372499399113968e-01   +4.343375334421955e-01   +4.395449540968387e-01   +6.641592587130005e-01   +1.945058477335014e-01   +1.515096338639068e-01   +9.709605657925320e-02   +1.588437297521060e-01   +6.304744963569050e-01   +1.046402119567697e-02   +2.444346572421697e-02   +4.296598765716915e-01   +7.391571943570117e-02   +9.095699244360665e-02   +2.973108047072109e-01; +6.845144662435834e-01   +2.637448335229610e-01   +4.861907227864766e-01   +4.079136115884766e-01   +5.452982768416984e-01   +4.875987799137130e-02   +6.793959836567050e-02   +2.036190435780127e-01   +3.407053464032249e-01   +1.564313329236959e-01   +5.087616684133001e-01   +4.882055856069573e-02   +4.087693692992986e-01   +6.408454614468084e-01   +1.744742628751174e-01   +4.127284893519056e-01; +5.899534305061013e-01   +7.104167307635451e-01   +2.670612860765113e-01   +1.149014771763485e-01   +6.366447596799193e-01   +1.602511531566370e-01   +5.291187284173962e-01   +1.887480746883891e-01   +3.464211456485105e-01   +1.026916201382260e-01   +5.716957766744480e-01   +3.219176438013042e-01   +4.424843518699911e-01   +5.542407106877808e-01   +1.876310508108591e-01   +5.971344702882581e-01; +1.738534398435753e-01   +1.757253815792860e-01   +4.444044540936872e-01   +6.051926279451428e-01   +1.279517399982136e-01   +6.580918902950240e-01   +6.883812838531319e-01   +3.187218648538536e-01   +4.737027350796084e-01   +9.209479698102385e-02   +4.769780346681370e-02   +3.101000975947534e-01   +2.800019498517335e-01   +6.370420498897138e-02   +1.260502782126713e-01   +4.944217312194023e-01; +2.328020413388297e-01   +1.661040152883984e-01   +6.757287623534992e-01   +3.959051384207978e-01   +2.770663011106425e-01   +5.233911493520954e-01   +5.973762624970551e-01   +2.728480170249530e-01   +7.056547700626286e-01   +5.500652716907868e-01   +2.704937650689961e-01   +1.531586344188296e-01   +2.742221232556764e-01   +1.833309042834040e-01   +4.736724719989184e-01   +4.143322655103967e-01; +9.948706490135119e-02   +4.206314803668652e-01   +4.584275209571844e-01   +1.734862314862799e-01   +4.412619780536480e-01   +5.519777680886594e-01   +1.759330031970592e-01   +2.078279414382824e-01   +6.998198736539475e-01   +4.873046897977001e-01   +1.515280575335013e-01   +6.667153728517741e-01   +2.280293520881563e-01   +6.105672397071396e-01   +4.960606883282225e-01   +6.936749857120413e-01; +4.854763728744587e-01   +6.499352169113221e-02   +5.858642096925174e-01   +4.618321274315891e-01   +4.669005629613424e-01   +3.061020579063417e-01   +4.923485160084990e-01   +6.235873566437373e-01   +6.034053155718009e-01   +6.744947908226970e-01   +6.382826836160117e-01   +4.549643949746801e-01   +3.313816902878929e-01   +1.488899797312218e-01   +7.771752450030950e-02   +3.380192878637009e-01; +2.572766690024113e-01   +2.813052994721306e-01   +1.500242214467513e-01   +6.421075733641575e-01   +2.605327864124022e-01   +2.267295973653527e-02   +4.050889131674777e-01   +6.560756816108230e-01   +6.112713788573085e-01   +1.475345905499121e-02   +1.172133892758479e-01   +3.517151848506886e-01   +2.089688098880085e-02   +7.015616452136557e-01   +3.307521938990892e-01   +6.999623978372733e-03; +7.229040789333321e-01   +2.856033338240204e-01   +3.223041913715513e-01   +1.854625021765944e-01   +4.558764447774872e-01   +6.171832286872652e-01   +1.587798688527711e-01   +4.373351898635276e-01   +1.239221397075564e-01   +6.180192573930370e-01   +7.475223337813804e-02   +4.729628743520889e-01   +1.221338283347103e-01   +5.250682696852061e-01   +2.119046046004154e-01   +8.982835385713235e-02; +5.308712120229563e-01   +5.321941312150731e-01   +3.666308817558063e-01   +4.581995725221908e-01   +2.376904835893288e-01   +3.868103906089830e-01   +2.473598284256805e-01   +1.967210593170151e-01   +7.182961541617078e-01   +1.732588948768476e-01   +2.945208030082964e-01   +1.552415063835584e-01   +1.180814422043087e-01   +1.374405212017141e-01   +2.620401007473649e-01   +5.507585439331701e-01; +9.370663615647164e-02   +6.363336586684556e-01   +6.194783701642533e-01   +5.510873077079209e-01   +2.451944933590201e-01   +4.419823164588902e-01   +1.988133629554956e-01   +1.693474999741703e-01   +4.623584928483634e-01   +4.400993314998983e-01   +2.359345458412744e-01   +2.820578271415093e-01   +5.849008428953828e-02   +2.908563227445047e-02   +6.176975150722610e-02   +7.018501897759341e-01; +8.399105124161489e-02   +7.193459843639557e-01   +7.053408964772802e-01   +7.292986073903841e-01   +7.202058159029258e-01   +7.120609282679977e-01   +6.235648191853842e-01   +3.713026969947945e-02   +3.898545997874028e-01   +6.398918479979352e-01   +9.717147312865489e-02   +2.302777162110184e-01   +5.920709692490154e-01   +3.684292435623309e-01   +6.314619566524562e-01   +2.387728485725661e-01; +3.139208425490468e-01   +1.179553787091783e-02   +2.639206949528362e-01   +2.256434124977091e-01   +5.353610061866216e-01   +2.532028637358619e-01   +7.114100657651162e-01   +2.887836702065419e-01   +5.003085232038845e-01   +7.000343370943438e-02   +2.136087502118582e-02   +1.554442271050452e-01   +6.632764592625522e-01   +1.488461905348591e-01   +6.033709158020729e-01   +3.559596780292639e-01; +3.713934170727695e-01   +2.686908126234118e-01   +7.167969383891422e-02   +1.017020374379245e-01   +3.539037621810094e-01   +4.655756471363310e-01   +5.640136760975875e-01   +1.116410178602066e-01   +5.402418818678505e-01   +3.689301176161983e-01   +2.148782081278736e-01   +2.779156313311881e-01   +5.496339309122966e-01   +1.081533778488562e-01   +1.924563933821726e-01   +1.449644927628022e-01; +1.924834429883724e-01   +6.371184934533295e-01   +3.932142098102748e-01   +4.143004505957431e-01   +1.870998427804574e-01   +3.834022128249423e-02   +1.490592762396354e-01   +6.906050889823270e-02   +2.254684813318119e-01   +5.464592229249563e-01   +5.163655792277831e-01   +5.691294635651009e-01   +5.566750341025851e-01   +5.225024461053802e-01   +4.087276466389673e-01   +4.546023290527976e-01; +1.502115484469438e-02   +6.619635621257006e-01   +1.717484404646966e-01   +5.811473738138103e-01   +5.618592944208819e-01   +3.487602789450506e-01   +7.112452641940177e-01   +5.516750668109800e-01   +4.502584331444057e-01   +1.129913520154207e-01   +5.452289369351915e-01   +4.847897338057726e-01   +5.513510253964465e-01   +7.265404196189326e-01   +2.205444765907167e-02   +1.967275058915154e-01];
L1E_L1I_iGABA_netcon = [+5.953487648772339e-01   +7.582430769550152e-02   +2.095692709600145e-01   +4.020182270747200e-01   +6.681624240724676e-01   +4.201626429070859e-01   +5.412381881419190e-01   +7.077777252309878e-01   +6.062048122686392e-01   +4.355669058771453e-01   +4.008381599382589e-01   +6.027650717565623e-02   +5.175806512690182e-01   +1.815309280727039e-01   +6.450540109612524e-01   +1.228882353701982e-01; +8.473297929439358e-02   +9.510761283694547e-02   +6.725321460239969e-01   +4.571632360283913e-01   +5.239157032999141e-01   +5.400104477686606e-01   +1.459048083843548e-01   +2.780292460946793e-01   +7.597316876395079e-02   +6.577278203490204e-01   +6.513681378182280e-01   +2.178183775488157e-01   +6.911614224290986e-01   +4.773714774381738e-01   +4.601053546567381e-01   +1.656401860337908e-01; +5.391358819451583e-01   +3.006664871663687e-01   +3.298650294445500e-01   +5.867644660928877e-01   +6.328446245733291e-01   +6.441899089091710e-01   +4.990518976451849e-01   +1.196637034184158e-01   +1.576713629844865e-01   +4.263809878662453e-01   +4.129778300642062e-01   +4.588602009319494e-01   +6.729465267349926e-01   +1.408394934821047e-01   +3.623445062670665e-01   +5.735915432766787e-01; +4.580013693356922e-01   +3.943783539823092e-01   +2.765507813526217e-01   +6.919634712988652e-01   +1.556592597550836e-01   +3.914845431202580e-01   +1.406926330229422e-01   +1.832576385995044e-01   +3.300426434889946e-01   +2.881687059928016e-01   +4.401776630713190e-02   +2.651847847994825e-01   +1.683492906953098e-01   +3.301144984936639e-01   +3.243333353148820e-02   +4.324021851326357e-01; +2.729955391095750e-01   +9.120524645928302e-02   +5.876208858169225e-01   +5.871978891191277e-01   +6.983028580353774e-01   +9.665750568632009e-02   +2.302427097601902e-02   +1.506528644375421e-01   +6.190581968690824e-01   +4.361529173183822e-02   +6.790713026439058e-01   +3.736605801479955e-01   +4.221596209353666e-01   +1.836613164689389e-01   +4.483829638864333e-01   +1.510940429292273e-01; +1.000907597199863e-01   +4.320911508094489e-03   +1.727509319901816e-01   +6.933723109060196e-01   +4.859230031035331e-01   +3.557541578582407e-01   +3.426939258385347e-01   +6.065958735649253e-01   +4.773479339261950e-01   +2.100527766349305e-01   +1.084793542357236e-01   +2.183515530666779e-01   +1.708894839589357e-02   +6.141499648840204e-01   +8.410264948564405e-02   +5.573222654177732e-01; +7.068888988651136e-02   +3.686615583515093e-01   +4.865195860056101e-01   +2.091994832312587e-01   +2.633196388268814e-01   +4.249783184899761e-01   +3.462141740290978e-01   +6.858375391087506e-01   +1.068829733859231e-01   +5.043856403208046e-03   +4.558032045130643e-01   +6.516831796102296e-01   +5.537057705547662e-01   +5.129406532314725e-01   +5.752340341272444e-01   +2.479755891399766e-02; +4.399835266352957e-01   +4.779087567098603e-01   +2.943428848131561e-01   +5.561905714079267e-01   +4.824390452292079e-01   +7.330874272336493e-02   +6.225769602840932e-01   +4.893627621781700e-01   +2.560718206376632e-01   +6.315356414974793e-01   +6.252501101736316e-01   +7.077987564443931e-01   +2.065833071219692e-01   +4.472116146214736e-01   +2.326604609783855e-01   +7.031181274065887e-01; +4.912013753979976e-01   +4.513965029814295e-01   +6.112533510654566e-01   +4.321707254843764e-01   +1.447256286555278e-02   +2.546473156497556e-01   +3.164657110052019e-01   +6.079658915488902e-01   +4.567926312740649e-01   +5.330557205733780e-01   +5.825440106919335e-01   +6.344382399181838e-01   +3.821069054981461e-01   +2.037127227671020e-01   +3.523893735841830e-01   +5.440988892218686e-02; +1.841722907473191e-02   +1.154569608170000e-01   +6.961098817632899e-01   +7.182593748919099e-01   +1.998265431653518e-01   +7.133929528432856e-01   +4.259803233955526e-01   +4.651858474630389e-01   +4.461188366062154e-01   +1.326733848225053e-01   +2.019112265356333e-02   +2.443643159092783e-01   +1.430859182392827e-01   +1.105121749557319e-01   +6.924748133497172e-01   +3.033378249109274e-02; +4.977537628490902e-01   +1.423271874433660e-01   +5.196282173777302e-01   +6.432525520484571e-01   +5.582202592370071e-01   +3.722627219131455e-01   +3.460406670466986e-01   +5.430885427271321e-01   +1.310186166159324e-01   +3.632872867278753e-01   +6.308720521554169e-01   +4.054510245407838e-01   +5.987260909758076e-01   +4.114932490385074e-01   +4.617063953809881e-01   +2.031725066921117e-01; +2.487651798820998e-01   +8.616950533343679e-02   +2.625352768856382e-01   +7.054498724376673e-01   +7.153846806164210e-01   +3.315260591977353e-01   +3.601197029639128e-01   +5.680097821021447e-01   +2.954451788321465e-01   +2.838298324640993e-01   +1.007111926799024e-01   +2.382836746346682e-01   +2.909949374467909e-01   +9.716366588401382e-02   +8.589685439973878e-02   +4.629519697557373e-01; +1.085688471687168e-01   +6.521604298101898e-01   +3.374169911926578e-01   +6.569505203308964e-01   +5.030279723759014e-01   +2.813593938357836e-01   +2.214453430515163e-01   +3.877241078789844e-01   +4.396900877326732e-01   +2.973552038114859e-01   +4.293932634874019e-01   +4.418843869897094e-01   +4.695707948397480e-01   +3.911820410631280e-01   +1.535486272833551e-01   +3.497478156792866e-01; +3.060622605577586e-01   +3.516956436166502e-01   +6.643093531022909e-02   +7.278288475890000e-02   +3.372207489510487e-01   +5.841259793221407e-02   +2.593570346682258e-01   +7.225584054917117e-01   +6.401254616712960e-01   +1.115769998018263e-01   +2.594791908329411e-01   +2.387933721713332e-01   +4.112242994285388e-01   +7.159653090809913e-01   +2.903768994064297e-01   +5.010485533526936e-01; +4.980746704322259e-01   +5.823974686509116e-01   +2.250547158546598e-01   +2.096049422198865e-01   +6.878075599015792e-01   +2.877351481932243e-01   +3.479305018912991e-01   +1.687911203713446e-02   +5.401491998739160e-01   +6.074468214193193e-01   +5.535918557612808e-01   +2.437492090176525e-01   +5.120970092567301e-01   +6.808778640902257e-01   +2.332412824688301e-01   +5.665398969851925e-01; +6.139734019437219e-01   +4.310472072917305e-01   +5.117133669427021e-01   +1.326428300209011e-02   +4.404539442370506e-01   +7.037324664917667e-01   +1.360284570736690e-01   +2.879594981071786e-01   +4.055762821614369e-01   +6.598072657796180e-01   +6.358921033428843e-01   +3.266676310298516e-01   +5.865509599784103e-01   +4.710110566981178e-01   +7.243478990044766e-01   +7.153003074058797e-01];
L2I_L1I_iGABA_netcon = [+9.503114799360263e-02   +1.908967747755354e-01   +7.010386679736632e-01   +1.845677060215583e-01   +2.526811331252145e-01   +5.508334389711189e-01   +6.781089954046990e-01   +5.706764104021840e-01; +2.566629485626898e-01   +1.017292916358761e-01   +6.217743733577363e-01   +3.619150759942464e-01   +3.273941218437674e-01   +7.295959095822571e-01   +2.108601787158680e-01   +1.837665610713374e-01; +3.290985684568693e-01   +5.583637948081780e-01   +6.926301108126401e-01   +4.025023517316523e-02   +1.953327307993060e-01   +7.852575361239646e-02   +6.436052336207151e-01   +2.879338718916133e-02; +2.517333224674121e-01   +4.105147944307784e-01   +2.377815117117550e-01   +1.631994332572417e-01   +2.126175489520400e-01   +1.120740441197591e-01   +1.855558523043467e-01   +3.118186732241642e-01; +5.331009691986559e-01   +6.898649506785332e-01   +3.421514733386252e-01   +1.208517134862162e-01   +2.119245633218763e-01   +6.359627817122886e-02   +5.942966866766594e-01   +4.597090440332586e-01; +6.669173664615730e-01   +3.659455669020868e-01   +5.646341533720484e-01   +3.037536251388798e-01   +3.209861628372734e-02   +4.901564309578517e-01   +4.086096424772582e-01   +5.070937198698804e-01; +5.129373327372685e-01   +7.045965495010100e-01   +6.919424385333408e-01   +4.808569689081897e-01   +2.594074400563021e-02   +7.194051388379273e-01   +2.862428005660333e-01   +4.268061427060520e-01; +5.622558457966631e-01   +4.344289282182310e-01   +6.896622774792575e-01   +7.254777198097180e-01   +5.707162884866227e-01   +9.027441593582171e-02   +2.161909183206004e-02   +6.717660922576248e-01; +6.941292482671675e-01   +3.782490763964689e-01   +3.947997616502200e-01   +3.442895842744211e-01   +5.724179180265679e-01   +7.026687446577224e-01   +8.578550856091202e-02   +1.548154244087576e-01; +2.229048757102433e-01   +3.235903130518953e-01   +9.121681978725228e-02   +1.749696722894983e-01   +1.760873221118611e-01   +6.574129248544650e-01   +5.299319124012184e-01   +2.090169288029818e-01; +4.587853151119089e-01   +1.665697187732397e-01   +7.296524685262159e-01   +1.271500530172271e-02   +3.303895431328597e-01   +5.580171386953180e-01   +2.507154161864513e-01   +3.519754018844251e-01; +3.856494037291480e-01   +2.312218259813306e-01   +5.196367856501529e-01   +2.671885235102281e-01   +3.701230317178269e-02   +4.887282763257764e-01   +2.950062427572780e-01   +6.567228295900238e-03; +2.600064246083857e-01   +6.757781056703939e-01   +4.360620503170767e-01   +8.169348435583826e-02   +4.229638768921068e-01   +2.350989354125234e-01   +5.194489236643047e-01   +1.371938148227402e-01; +6.810753000374138e-02   +3.808704040042211e-01   +5.865306536106720e-01   +2.583893639224718e-01   +5.588905121434805e-01   +1.478241074843422e-01   +1.442073807486162e-01   +3.564243910401726e-01; +4.764502361486012e-01   +3.527493033804237e-02   +4.023000902673729e-01   +7.142661197186084e-01   +3.336641982638530e-01   +4.928331117637198e-02   +1.530547614418776e-01   +3.504024292446045e-01; +5.746013060933569e-01   +4.678920644025172e-03   +6.169367651636622e-02   +6.494213650137604e-01   +2.690570522088876e-01   +5.355966732433793e-01   +8.521985632821628e-02   +1.980503071956889e-01];
L1I_L2I_iGABA_netcon = [+6.958931943610601e-01   +6.608581967986209e-01   +5.313297553438894e-01   +1.069225336009527e-01   +9.342154432501114e-02   +6.647488340920491e-01   +9.735164672894855e-02   +1.769317086467785e-01   +1.122230296766581e-01   +2.404793984520840e-01   +5.382676841340804e-01   +3.595220750984278e-01   +2.371164101886074e-01   +4.579102768821078e-01   +6.460685554599166e-01   +6.516876298549495e-01; +3.721629634691196e-01   +6.713666408313768e-01   +2.604325909937479e-01   +2.528060190268282e-01   +6.497583532349686e-01   +6.905612438799075e-01   +3.506924646663740e-01   +1.173383534237995e-01   +3.440740793677649e-01   +6.480598033486710e-01   +4.495859783537980e-01   +6.710907628176759e-01   +4.071378607819557e-01   +2.860874953921994e-01   +1.904591586253422e-01   +3.923692542296864e-01; +2.932222148217045e-01   +3.462652639688717e-01   +3.172748384082278e-01   +4.268258101541081e-01   +2.351683919496105e-01   +5.352819663208065e-01   +2.179294054407954e-02   +5.909986548340790e-01   +5.617744237181662e-01   +3.885575923029335e-01   +1.229005671472751e-01   +5.960202594852464e-01   +2.575925155412729e-01   +4.299294986535086e-01   +3.243198660329477e-01   +1.295787339527922e-01; +6.127674133221607e-01   +2.732191254915002e-01   +3.861114518120974e-02   +2.666779432347618e-01   +4.421294291033226e-01   +2.235101271926736e-01   +1.771317350731227e-01   +2.273817520645662e-01   +7.142539132916271e-01   +9.205269573382722e-03   +2.361943871653093e-01   +1.205770745035813e-01   +7.207958786764396e-01   +4.561901160427720e-01   +8.641685219693729e-02   +4.649760609165230e-01; +6.962959855876806e-01   +6.678593212066888e-01   +3.091227328396144e-01   +2.813363703064299e-01   +1.933230346013355e-01   +7.496294963877692e-03   +1.275822122176943e-01   +3.615506935988793e-01   +5.990061292732621e-01   +4.669201665640012e-02   +7.079863084299066e-01   +3.729666900591123e-01   +2.986920496245341e-01   +5.587702862606345e-01   +2.220409202713754e-01   +3.948075577061001e-01; +7.218881256691374e-01   +3.525375355477479e-01   +1.508655179106163e-01   +4.500986027358175e-01   +4.360202652413051e-01   +2.068561516217177e-01   +5.775938884387219e-01   +6.642525582335879e-01   +3.523036693023862e-01   +5.782620560487659e-01   +6.513641012803879e-01   +3.283956568176851e-01   +5.134835769671088e-02   +3.617067599284909e-01   +3.635147994183109e-01   +2.694736199547932e-01; +3.298608035786971e-01   +1.009436569474896e-01   +3.966690351163134e-01   +3.629876910756839e-01   +5.805224587027246e-02   +6.861640971718382e-01   +3.402153020033243e-01   +7.531163175886800e-02   +4.990933360457747e-02   +8.123418398962139e-02   +5.229137499253591e-01   +3.655638218034683e-01   +1.239175794582712e-01   +1.768292412024333e-01   +2.245791239850442e-01   +2.075620949925228e-01; +2.407430955168355e-01   +1.334109413878747e-02   +4.481196781988671e-01   +4.590062186966010e-01   +5.156116704948873e-01   +1.652424618537599e-01   +3.400023764708511e-01   +1.323786251900183e-01   +5.709752007425394e-01   +5.598200296047603e-01   +5.522503580184802e-01   +3.201210693562286e-01   +7.193684267630797e-02   +2.046013523785793e-01   +3.330982570288678e-01   +5.206768108274983e-01];
L2E_L1E_iAMPA_netcon = [+5.623837375343222e-01   +3.830635962484211e-01   +5.268693793564480e-01   +2.503330668172543e-02   +9.360430943166223e-02   +3.745833511842188e-01   +2.452388636893277e-01   +1.912646202494405e-01; +1.232961005155704e-02   +4.952812736236539e-01   +4.735571529538397e-01   +5.009502577445922e-01   +7.242439545938215e-01   +4.940410619007977e-01   +5.770880541127708e-01   +7.126612730398414e-01; +2.406477270291693e-01   +4.624745914326889e-01   +2.050900439238074e-01   +4.884586896213314e-01   +3.736508198059363e-01   +5.739309025282263e-02   +4.221880871363444e-01   +5.127767691612141e-01; +1.554684005063228e-01   +6.166417085704761e-01   +5.025203961145450e-01   +3.501891629482929e-01   +3.102365649779168e-01   +9.193615676128722e-02   +1.806955548081388e-02   +3.065959190772429e-02; +6.912644383739074e-01   +2.314031970185540e-01   +1.433398270176659e-02   +6.906607390858200e-01   +7.172571112015981e-01   +1.668122752999290e-01   +4.056475546897680e-02   +4.430592000433386e-01; +5.987981337857498e-01   +5.533333830123719e-01   +3.415627723825324e-02   +3.247111985065983e-01   +3.540614100116402e-01   +5.342051210327911e-01   +3.875239761148381e-01   +2.111836376680560e-01; +1.602576161820386e-01   +5.354821856672360e-01   +1.117116326260370e-01   +2.631081893833488e-01   +2.577090572226619e-01   +3.300996326461949e-01   +4.424920430679709e-01   +5.713745229597917e-01; +5.761099267712887e-01   +4.382697527965290e-02   +5.665861960843788e-01   +5.557035589122180e-01   +3.148456879577890e-01   +3.671434156902752e-01   +3.026440491140046e-01   +4.238430897401411e-01; +1.063265014320210e-01   +2.818575139611218e-01   +4.236166810829407e-01   +3.959889994486566e-01   +5.022928949479789e-01   +3.845852538808691e-01   +6.180172467032445e-01   +3.979856030632247e-01; +4.395277604667994e-01   +3.748433865261747e-01   +6.050683828772137e-01   +1.469858758908445e-01   +5.575564619762609e-01   +3.818571484862073e-01   +5.597531833318805e-01   +2.460736055004193e-01; +6.683252551693641e-02   +3.562551539069214e-01   +3.862452695737234e-01   +7.082513472471105e-01   +1.111236306450284e-01   +3.275610257455400e-01   +6.127124289812074e-01   +6.679012301774149e-01; +5.357018934067095e-01   +6.498720526108703e-01   +3.394450072082483e-01   +5.317476797999698e-01   +2.307636692248820e-01   +3.732257564772224e-02   +3.122436158191839e-01   +3.702063840771402e-01; +4.556372216385553e-02   +4.915364119153609e-01   +1.445800770724105e-01   +4.066970012876082e-01   +1.059215967640679e-01   +6.524553186238065e-02   +3.192633653357853e-01   +2.128356903003588e-01; +3.364828702976859e-01   +1.797054763959446e-01   +6.198798303209553e-01   +2.526371626881773e-01   +3.994492823266189e-02   +8.496412322362626e-02   +4.303102651914903e-01   +2.496472777709702e-01; +5.003704282893984e-01   +4.293682855841475e-01   +6.830400314641486e-01   +4.855125722939757e-01   +5.293096380014497e-01   +3.405568412494250e-01   +5.067649901065811e-02   +8.722267432758513e-02; +1.501887156727927e-01   +4.596862482512692e-01   +4.897633190872825e-01   +3.088840099524940e-01   +4.217239306024158e-01   +7.257589543540348e-01   +7.207659519322523e-01   +4.259490207566379e-01];
L1E_L2E_iAMPA_netcon = [+6.683385808264357e-01   +6.050548540438577e-01   +3.980883109429932e-01   +1.321635295496849e-01   +3.876723334261230e-01   +6.017789975353182e-01   +2.946779362718551e-01   +3.585667862426330e-01   +5.848849322859772e-01   +7.062320827772991e-01   +6.313004574357083e-01   +6.543966614136119e-02   +6.479411706848821e-01   +6.036701061241222e-02   +1.574263401880203e-01   +2.830688904752502e-01; +4.949283734948446e-01   +1.986317394706372e-01   +2.021923536340650e-01   +2.259818127236788e-01   +7.175395081301659e-01   +1.617944629106305e-01   +3.266918853578682e-01   +6.853880446416435e-01   +4.500545344425408e-01   +5.377635877504198e-01   +1.533387160429581e-01   +3.040551443995911e-01   +4.172864053327146e-01   +6.767560675372362e-01   +3.460286388693403e-01   +6.441405275060623e-03; +5.486464401296943e-01   +1.590143190747258e-01   +4.444348491039530e-02   +2.443023077541280e-01   +3.248358781083831e-01   +1.164263190137156e-01   +6.573633739040312e-01   +2.156304415000354e-01   +4.069398573789812e-01   +1.149546516165728e-01   +3.718586351885849e-02   +1.575894728081171e-01   +6.358081914188352e-01   +3.652879022762277e-01   +3.169716585103195e-01   +5.126118442624169e-01; +1.834036026565493e-01   +1.190653304339670e-01   +1.635694261832013e-02   +7.274763334017121e-01   +3.945675303943095e-01   +6.903921901229696e-01   +6.792152780262005e-01   +4.594647899512134e-01   +2.902100178915010e-01   +5.105453282370039e-02   +5.755165230627867e-01   +2.929156272693559e-01   +3.036297382220329e-02   +1.974145984118130e-01   +6.240470229674800e-01   +2.888677591133811e-01; +6.980378208373772e-01   +2.468293150825221e-01   +1.019624210919919e-01   +5.636799053252290e-01   +1.804026604615270e-02   +3.031577766952200e-01   +1.281058913004386e-01   +2.841980960871410e-01   +2.592487343434245e-01   +1.559749841520352e-01   +9.288551516140987e-02   +6.393039658758860e-01   +2.664226367745717e-02   +8.621375080446068e-02   +5.907195154658416e-01   +4.433740850388153e-01; +7.034421501893185e-01   +3.238334708544958e-01   +6.949834041551187e-01   +1.903600750880746e-01   +2.301490817711537e-01   +2.216546467174302e-01   +3.127421852113528e-02   +2.029134640060530e-01   +1.457899357877924e-01   +1.137840373235226e-01   +1.113553274966275e-01   +5.034671919239826e-01   +6.896620533364802e-01   +4.728600834236645e-01   +6.626714476645260e-02   +7.262489077394624e-01; +3.316405751045007e-01   +6.475323105633518e-02   +1.934750724522912e-01   +6.744517550472205e-01   +1.564611526079993e-01   +3.087804356342737e-01   +7.088763004198072e-01   +4.602675081850324e-01   +4.519371224227762e-01   +7.969060476988986e-02   +1.835199017441487e-02   +2.748889716941508e-01   +6.094338707208251e-02   +5.530774227271987e-01   +3.054926459396415e-01   +4.002312392914262e-01; +6.079914501776532e-01   +2.077050946906389e-01   +6.336623668704621e-01   +4.854683662370857e-01   +3.949585509574956e-01   +3.621958248516065e-01   +1.081615060252017e-01   +1.953019660200586e-01   +1.344033196536880e-01   +3.098175962075375e-01   +6.358459898927878e-01   +7.114263869873110e-01   +5.744649670163141e-01   +2.456135271041199e-01   +2.271543573436354e-02   +2.977899902817612e-01];
L2I_L2E_iAMPA_netcon = [+4.605473386779486e-01   +5.895301697073317e-01   +6.808957242883382e-01   +5.622357121522158e-02   +2.127001991082674e-01   +1.539126191101312e-01   +7.270158005819433e-01   +7.263567742558926e-01; +3.742114023661451e-01   +1.895330820005508e-01   +2.673528914533713e-01   +7.362362660064670e-02   +2.471414137393527e-01   +9.853645472687926e-02   +5.780081069437515e-01   +1.469856776840020e-01; +6.463902346147464e-01   +2.570445808014053e-01   +1.363303645096348e-01   +3.531642060533689e-02   +1.126976290255636e-01   +1.544979777264010e-01   +6.845800856486065e-01   +5.901501577748409e-01; +1.396594377585688e-01   +2.068368246295558e-02   +1.695416842853560e-01   +6.919469943025980e-01   +4.963614379128205e-02   +2.596016838008315e-01   +2.113589205328743e-01   +2.708649251116943e-01; +1.026618522672736e-01   +5.578396791980670e-01   +1.520396275696108e-01   +4.842854945633410e-01   +4.984427371445371e-01   +3.416924521812831e-01   +6.554686811640278e-01   +4.120664227402286e-01; +8.694277688758927e-02   +3.708011095065940e-01   +4.272828112185933e-01   +2.579794669235152e-01   +3.869054504750232e-01   +2.599049054956315e-01   +9.579433037635856e-03   +3.332115365326049e-01; +2.381907854153794e-01   +5.189899950052451e-01   +3.774836068553992e-01   +4.550264630597308e-01   +2.883768969705490e-01   +4.659147331781691e-01   +8.573184373859727e-02   +2.947287830249424e-01; +8.345920429146965e-02   +1.340661698857855e-01   +1.079704322399908e-01   +2.338583492049336e-01   +4.129397082767208e-01   +5.889558830909837e-01   +2.271893020078177e-01   +2.475733870439051e-01];
L2E_L2I_iGABA_netcon = [+4.857718484834467e-01   +1.469152508188004e-02   +1.306784315993276e-01   +4.849367771654753e-01   +9.016340651627344e-03   +3.555595716611241e-02   +4.075499071054132e-01   +2.481468087391221e-01; +6.822926088411352e-01   +1.059035005355238e-01   +1.982816815590339e-01   +2.822448560997661e-01   +5.637714408591643e-01   +5.241779765289103e-01   +3.136554868340340e-01   +7.241658956235725e-01; +4.103907844096435e-01   +7.674855849041740e-02   +2.825642055207300e-01   +5.893440814329486e-01   +3.940436004237559e-01   +4.281148936325599e-01   +6.287959831221939e-01   +3.553157419282078e-01; +2.335452651044995e-01   +3.691237580683165e-01   +4.801579069323768e-01   +1.804517344039434e-01   +1.083759153878180e-02   +4.814887724742162e-02   +4.074917137996931e-01   +6.367902283474967e-01; +5.133237460062855e-01   +5.151948118640504e-01   +3.061739318068005e-01   +5.409740538221585e-01   +3.659423646640774e-01   +5.183371949533003e-02   +6.178626903139173e-01   +2.799732539556372e-01; +6.878206633937032e-01   +7.370655297052522e-02   +5.534016833111350e-01   +1.620738104080285e-01   +6.348216328957924e-01   +3.820268948557408e-01   +5.658212921436474e-01   +3.977040101518498e-01; +1.869466428326926e-01   +1.705095586183911e-01   +5.588141311387476e-01   +5.854524657573470e-01   +2.518861106902635e-01   +2.410445538126203e-01   +1.511357536377746e-01   +5.242859100403328e-01; +1.836390761985964e-01   +1.149716793622599e-01   +2.016524171546532e-01   +1.979138202555200e-01   +5.189858565605000e-01   +2.616864773444743e-01   +6.995949718316968e-01   +4.704977304374843e-01];
L3E_L2E_iAMPA_netcon = [+4.350768214120378e-01   +4.008030114713867e-01   +4.847240225502634e-01   +4.222825947093254e-01   +3.370754702724734e-01   +6.483682139343226e-01   +7.084686088999197e-01   +1.263617958189166e-01   +1.411763716137276e-01   +7.284440376435096e-02   +4.257602127380425e-02   +2.370583410382643e-01; +4.981524715109582e-01   +6.101686448232667e-01   +4.561733154542864e-01   +4.588208311400649e-01   +3.398054437510915e-01   +1.426142254932755e-01   +6.765775489643402e-01   +3.439035794872049e-01   +3.039531748814256e-02   +6.348275367321918e-01   +5.606416070694292e-02   +1.805455195313295e-01; +3.735308869964879e-01   +4.332413004568306e-01   +3.874303158928261e-02   +4.689861316783514e-01   +3.251359957006180e-01   +2.517127833760057e-01   +5.639772214198832e-01   +1.075472421841862e-01   +3.662984953386552e-01   +1.276411912716378e-01   +2.538028176132289e-01   +5.231270613689818e-01; +5.350765422978064e-01   +6.941654998057042e-01   +2.875828654240823e-01   +2.499285969617058e-01   +6.352410830025965e-01   +3.075088193893662e-01   +3.989340994618851e-01   +4.626153790476533e-01   +1.586066742579943e-01   +1.249943731978502e-01   +5.193777631724660e-01   +4.122236719799514e-01; +5.137530961714929e-01   +1.907960410798258e-01   +4.164726420979820e-01   +5.882759856242291e-01   +2.951423198835986e-01   +1.748385179773875e-01   +7.273910822685503e-01   +2.008355643395101e-01   +7.699366993709190e-02   +2.967209686657059e-01   +6.880957355057482e-02   +5.874311309284606e-01; +4.308156929423755e-01   +4.155218122996976e-01   +5.127233755064564e-01   +7.210663965271095e-01   +5.516586539421594e-01   +6.152499578054552e-01   +2.098650516441312e-01   +5.775162050476960e-01   +4.183432453826278e-01   +4.379460091984348e-01   +6.086454587209954e-01   +4.728360081272620e-01; +1.311585402281732e-01   +6.729168816549758e-02   +3.663244974208111e-01   +1.218610001974811e-01   +2.714454691888202e-01   +2.425210972940197e-01   +5.899658772023503e-01   +2.686342463305683e-01   +2.491556346845292e-01   +7.016749499735412e-01   +3.479696811105659e-01   +4.958246898689689e-01; +1.093580951761753e-01   +3.057246404883692e-01   +5.605944410337883e-01   +3.861494964895409e-01   +6.466188432515636e-01   +3.997469646752707e-01   +5.814739763303277e-02   +2.204643457404845e-01   +2.649259167954973e-01   +5.733133632581793e-01   +6.712544715280847e-01   +2.608289522248848e-01];
L3I_L2I_iGABA_netcon = [+9.733327290268391e-02   +5.436138079604755e-01   +4.404798902116400e-01   +2.107281022798462e-01   +2.986308941558736e-01   +5.810549293758719e-01   +3.240256875928184e-01   +6.151447053954140e-01   +4.212450736315191e-01   +2.056843071657218e-01   +2.090583627194646e-01   +3.210143539002214e-01; +5.498298117759583e-02   +2.467522218992288e-01   +6.900896773562656e-01   +1.560778294128818e-01   +5.983000526056149e-01   +6.041202524095347e-01   +3.291060259461527e-01   +2.827573950491056e-01   +3.418549321127433e-01   +4.934179602697846e-01   +6.106523170172287e-01   +4.749040017180357e-01; +5.769622591719115e-01   +4.726487151397329e-01   +4.815779466118361e-01   +4.456606557685889e-01   +2.141791275305777e-01   +5.915509863214709e-02   +5.281783108878307e-01   +7.312718901374246e-01   +4.862530742987894e-01   +4.078665184606995e-01   +6.356456060673908e-01   +6.060170046754089e-01; +5.593332573015046e-02   +6.857162786177023e-01   +6.929402534904571e-03   +6.804728860371035e-01   +4.021437308107385e-02   +3.131864513977721e-01   +2.450538100412585e-01   +6.774206538461224e-01   +2.440673622745028e-01   +6.794760378896615e-02   +6.519822499778339e-01   +1.200366630961777e-01; +1.316293743761659e-01   +5.686008872348650e-01   +4.026875337283709e-01   +2.240053013841910e-01   +4.663940347511906e-01   +1.178692289025006e-01   +6.460213322133964e-01   +6.601171159249603e-01   +5.717450607852990e-01   +4.833055591955623e-01   +7.270286359525800e-01   +2.364440629354286e-01; +1.455381535757865e-01   +3.931113882198315e-01   +2.205305363342737e-01   +4.975649499643128e-01   +3.677377663208586e-01   +6.815515508599157e-01   +2.157362200336833e-01   +6.490961423406726e-02   +6.632495840270219e-01   +4.010048993763306e-01   +3.047732284716237e-01   +6.673063189335148e-01; +8.422585577929552e-02   +3.886954854772270e-02   +1.351788949573532e-01   +4.334408653693491e-01   +1.806501079670914e-01   +5.612993284749870e-01   +1.594721322725416e-01   +3.413791180015546e-01   +5.440398660979053e-01   +1.565644956543195e-01   +9.217722272542209e-02   +2.215790881246642e-01; +3.575052372327233e-01   +2.134353481481917e-01   +5.675260661850398e-01   +6.813997036066287e-01   +6.566950563338743e-01   +5.189562284330748e-01   +5.765066792936917e-01   +7.189378456256643e-01   +6.682683736345755e-01   +2.782385241576618e-01   +6.262420944303762e-01   +1.878825505266341e-01];
L2E_L3E_iAMPA_netcon = [+2.040111106906139e-01   +4.960345357860738e-01   +6.424642547150468e-01   +5.959929121408976e-01   +6.395121107179189e-02   +3.994716768882209e-01   +2.559699276003534e-01   +3.978993850275479e-01; +7.065245865486043e-01   +5.317632033703115e-01   +6.091507294791901e-01   +4.849791788071200e-01   +7.432836416621100e-03   +2.984161502246241e-01   +2.123794011217206e-01   +8.070425558992540e-02; +7.002816770490506e-01   +2.217737478591329e-01   +6.917337484986956e-02   +5.537944786555791e-01   +1.295226984904015e-01   +1.054793453957649e-01   +6.593664797833982e-01   +7.402776724881223e-02; +1.772589420519713e-01   +5.370913056825801e-01   +2.505985243749927e-01   +3.792847708976045e-01   +3.012696871474265e-01   +3.667845201731135e-01   +3.467000470945291e-01   +6.529240989469415e-01; +4.616273943436048e-01   +5.861271820663699e-01   +1.904167427448805e-01   +2.036756417105348e-01   +6.038796689776800e-01   +1.896308767464404e-01   +4.958617708595827e-01   +3.704780331070904e-01; +3.907896318747844e-01   +6.793840097021406e-01   +4.624674374148765e-01   +1.206688870280660e-01   +4.120725796939039e-01   +2.220787705318109e-01   +5.119488815357439e-01   +4.696178016063790e-01; +1.245086790666839e-01   +8.893596467957800e-02   +1.337622683711614e-01   +3.045321323425760e-01   +1.280677064304424e-01   +6.994501005439016e-01   +4.230418474768636e-01   +7.235948457783760e-01; +4.315065000278516e-01   +5.556099760536692e-01   +5.828372044722100e-01   +2.099328472796628e-01   +1.580089022796830e-01   +6.590907418499754e-01   +3.746503289702353e-01   +2.886196674355452e-01; +3.094747360881833e-01   +3.633238631234423e-01   +6.778090362393482e-01   +2.725578736167241e-01   +5.196284236318393e-01   +5.954007579190633e-01   +5.283054350359957e-01   +3.629927057808596e-01; +6.593560634511583e-01   +3.737145808587876e-01   +5.925329526110065e-01   +4.795008136190679e-01   +3.533613685334985e-01   +3.431127572307879e-01   +3.271100621234406e-01   +4.134596197943800e-01; +4.590781497249789e-01   +2.513661163325812e-01   +8.252761707990806e-02   +5.837299249325570e-01   +5.566283447567488e-01   +5.431969225997019e-01   +1.160250594788444e-01   +3.299085048833594e-01; +6.451880895269220e-01   +3.098408424007610e-01   +1.712100941493165e-01   +2.167859934634026e-01   +3.724498751362030e-01   +6.405481480599574e-01   +3.774548891576554e-02   +4.366672863917961e-01];
L2I_L3I_iGABA_netcon = [+1.352368072513683e-01   +2.608123453384380e-01   +4.340094243723495e-01   +3.121578684606151e-01   +5.254726806949018e-01   +5.034245775758703e-01   +1.355455722915545e-01   +6.208313761984442e-02; +1.435573852168632e-01   +2.939970716203190e-01   +5.895653686707067e-01   +6.569025194695857e-01   +2.982522769817034e-01   +4.530610741921541e-01   +2.062268583933417e-01   +6.659936935521628e-01; +4.982677925435637e-01   +5.965107106028809e-01   +3.976611063666562e-01   +4.616349598007826e-01   +4.167982307004503e-01   +5.634068292202229e-01   +4.173562883508162e-01   +2.044497511088213e-02; +5.614102902045465e-01   +1.536035223298129e-01   +5.038037929618706e-01   +6.046199287859754e-01   +3.101612222131810e-01   +1.079436143605067e-01   +7.218891084062252e-01   +4.304514647373275e-01; +3.972244542711333e-01   +9.405974903398587e-02   +5.107490142601389e-01   +3.307424160863743e-01   +2.431036915065217e-01   +4.575592035423632e-01   +3.087508116172127e-01   +2.225573251682496e-01; +4.687603058938559e-01   +6.491527430950544e-01   +3.567639299033207e-01   +9.919708111857746e-02   +6.524283418249537e-01   +2.410640787076488e-01   +6.909492158134407e-02   +6.862882769150653e-01; +7.273823038057292e-01   +1.220330658263024e-01   +2.775353275543609e-01   +3.022791406525452e-01   +2.800606300974409e-01   +4.323634853239516e-01   +3.877176246274092e-01   +7.291571739613940e-01; +3.924919408172405e-01   +1.179155447371096e-01   +1.201961120007193e-01   +5.531253434626477e-01   +2.149420677138795e-01   +3.672486603892411e-01   +2.012838719404216e-01   +2.212191922827111e-01; +6.183141938623755e-01   +1.138479495066828e-01   +4.003152274371653e-01   +1.047889567691580e-01   +4.391328864734377e-01   +5.616024166159054e-01   +4.359002419073751e-01   +3.668099645754812e-01; +6.701496950703444e-01   +6.089441024220915e-01   +2.872353932466871e-01   +4.457556680726807e-01   +1.851921873925859e-02   +4.639228420117359e-01   +2.457395255891430e-01   +3.129561135012084e-01; +3.715011313298830e-01   +4.248821715060908e-01   +4.009145837298004e-01   +4.998293323651627e-01   +3.123234764944667e-01   +2.053573799532333e-01   +5.780609567965776e-02   +1.075153497246766e-01; +2.234776884069961e-01   +4.452940269978414e-02   +3.305246973356053e-01   +3.348848504947050e-01   +4.723945262015625e-01   +5.432205460432324e-01   +6.197284284599974e-01   +3.276396272681230e-01];
L3I_L3E_iAMPA_netcon = [+5.930095718337443e-01   +2.539449265727606e-01   +5.206004284356990e-01   +1.123486730256560e-01   +6.986444938762972e-02   +5.478122776033831e-01   +3.342094666710793e-01   +1.622572334730036e-01   +2.594216894741499e-01   +1.710433933060767e-01   +6.993672593784651e-02   +4.578412193014240e-01; +6.047893469599916e-01   +5.004205114751840e-01   +6.452585751266763e-01   +9.409975922114550e-02   +4.380346120593795e-01   +2.108021451690541e-01   +3.404506582138052e-01   +1.723480571534753e-01   +4.605618633027094e-01   +6.665627251157603e-02   +3.045574786765379e-01   +6.049958105223172e-01; +2.356950546764452e-01   +2.115401239971385e-01   +1.845887942082006e-01   +5.832109738939195e-01   +5.549908560514218e-01   +6.388712337806760e-01   +2.691308782114809e-01   +6.373843505078027e-01   +7.189676427163736e-01   +1.377305901239588e-01   -6.556115256957274e-04   +4.655247393435358e-01; +1.406304266003085e-02   +4.429687002897361e-01   +1.197871025600871e-01   +6.382877794985197e-01   +6.270396440032967e-01   +1.046930887590530e-01   +6.155525140767928e-01   +2.502309372407323e-02   +4.598467769749250e-01   +2.174246966372438e-01   +3.907127851805408e-03   +5.622007264407263e-01; +1.153560124134635e-01   +4.645560979435336e-01   +3.610598061600334e-01   +6.539535593455285e-01   +5.802253497221655e-02   +1.699408451864055e-01   +1.489650165372261e-01   +1.109826674523739e-01   +2.364971587520415e-01   +2.284685015320287e-01   +3.665551978757057e-03   +2.723915771314936e-01; +5.686083915918000e-01   +1.868672143265322e-01   +1.122390384618050e-01   +3.416727714498669e-01   +2.451083117985625e-01   +4.066135414973058e-01   +2.474383600028756e-01   +4.525379713200736e-01   +9.618112187408265e-02   +5.472236869471611e-01   +9.549462452628230e-02   +1.135435654211596e-01; +6.008497998231862e-01   +7.102714561080787e-01   +4.490962314725046e-01   +5.403062281998548e-02   +3.521796837284821e-01   +6.217149098134915e-01   +3.645399306458605e-01   +5.620861113043314e-01   +2.567528596373104e-01   +4.130342883837376e-01   +4.150907872888892e-03   +3.455450240840918e-01; +2.758253456860922e-01   +3.824654914552497e-01   +4.001587568246752e-01   +1.712769201378394e-01   +5.724271198775919e-01   +5.953853562427939e-01   +5.804922583533307e-01   +6.270072289435352e-01   +4.802105498669288e-01   +2.329028210165716e-01   +6.466640051381023e-01   +3.347025077178006e-01; +8.929112729434907e-02   +1.140325079696177e-01   +7.062381727705832e-01   +4.714649879565459e-02   +4.843268466643634e-01   +2.688804588103122e-01   +6.279991297333584e-01   +3.858211454552390e-01   +6.116054823861818e-01   +5.826028467959666e-01   +3.157017372275221e-01   +5.212107630650653e-01; +6.470571047841199e-01   +1.660771048454114e-02   +9.790865629114666e-02   +7.733733140142919e-02   +1.798488348471850e-01   +7.113795042509317e-01   +6.667905121057837e-01   +2.567184240132470e-01   +5.868719105910202e-01   +4.597329883576590e-01   +2.252867429792397e-01   +3.774440548486195e-01; +9.345438674966188e-03   +6.348145146172826e-01   +6.192333193867645e-01   +5.398327957482701e-01   +6.914835309409689e-01   +4.205227383408752e-01   +5.392286031611541e-02   +6.099321131751648e-01   +5.167513330925206e-01   +2.388786015702623e-01   +5.364712225705619e-01   +6.232499578680789e-01; +2.785321502027272e-01   +2.970012976921474e-01   +1.877837023678531e-01   +4.074869764118397e-01   +2.277364850056931e-01   +4.326524865935278e-01   +2.534598184682367e-01   +2.167314240455753e-01   +2.540206545983318e-01   +6.251321221268632e-01   +4.273801986728051e-01   +2.943178805905838e-01];
L3E_L3I_iGABA_netcon = [+4.454125098786108e-01   +1.716486509137368e-01   +3.439342502328182e-01   +1.108365429103306e-01   +6.853265005685331e-01   +1.707829800760232e-01   +2.568903418196866e-01   +7.240011705496162e-01   +1.042076149217682e-01   +1.749173224040683e-01   +3.941220673309362e-01   +4.360502557423254e-01; +5.454088344836239e-01   +6.838727263835758e-01   +1.470453552509284e-01   +6.173482175309859e-02   +4.236646825961603e-01   +6.065552204714694e-02   +6.575885987693682e-02   +2.385914136771242e-01   +6.133629258176049e-02   +4.466120325802658e-03   +5.527489998209950e-01   +1.789932781286095e-01; +5.581245162723980e-01   +6.281005136490160e-01   +6.486024734609583e-01   +2.644829230905764e-01   +3.621992180938977e-01   +1.873369800029324e-01   +8.978514436837569e-02   +6.765772903521140e-01   +8.133263925419587e-02   +5.950086830197979e-01   +1.548040603806102e-01   +4.969592945647349e-01; +1.779566772801387e-02   +4.440461957232223e-01   +3.409961555574066e-01   +6.810921143817020e-01   +1.566804330686538e-01   +4.963587784157197e-01   +3.214107901877852e-02   +6.518926128417878e-01   +3.397254222453612e-01   +4.118177132389093e-02   +6.473960295122070e-01   +6.066635858348848e-01; +5.496785684749937e-01   +2.967350218725797e-01   +1.443912463062189e-01   +4.103993529170548e-01   +5.446157204506157e-01   +1.126996908672083e-01   +1.150278106577443e-01   +4.421914731215692e-01   +1.257556104179179e-01   +4.217813056859165e-01   +7.714740302503649e-02   +3.611131938376105e-01; +5.657292301295436e-01   +4.015641709742379e-01   +1.389283386605453e-01   +1.640647608143994e-01   +2.202623704607681e-01   +1.741375270005071e-01   +4.756597535664902e-01   +5.161918445224808e-01   +1.662100603827030e-01   +5.553084258443403e-01   +3.871171222698701e-01   +1.146970365893007e-01; +3.459265754291935e-01   +1.053363215768702e-01   +4.675962881591266e-01   +4.860468270202958e-01   +5.972606843384219e-01   +3.915405946573123e-01   +5.214594373116384e-01   +3.456017651997504e-01   +1.821708788366498e-01   +5.412507423516246e-01   +5.075538012634055e-01   +3.881688716343201e-01; +5.729017209584891e-01   +3.020336614481047e-01   +2.156374908896433e-02   +3.197448412896451e-01   +2.255080188023199e-01   +6.941194205268937e-01   +2.794636536312253e-01   +3.491341149331484e-01   +4.579451754935475e-01   +3.327711687158204e-01   +3.604728622442565e-01   +2.525857968445574e-01; +4.623528023405465e-01   +9.479342278709474e-02   +3.882051235792186e-01   +3.598715975002128e-01   +3.132584714256951e-01   +6.712914421804043e-01   +3.217791730528771e-02   +6.293984551600793e-01   +5.210173660092594e-01   +6.007286568196305e-01   +1.075532956763759e-01   +3.334683660912363e-01; +2.239039841042443e-01   +4.274801723017419e-01   +4.973527602715774e-01   +5.024147099543145e-02   +3.463214586605076e-01   +5.063796263680077e-01   +3.666901120211549e-01   +1.506173546680240e-01   +6.420341318090874e-01   +5.744342454086171e-02   +3.170285443998532e-01   +5.453441258103061e-01; +2.845471333379176e-01   +1.406025960911537e-01   +8.114944771056513e-02   +5.911276579752883e-02   +3.710189684183762e-01   +6.200251256260773e-02   +4.352957642755067e-01   +5.069938258314816e-01   +5.346392157884644e-01   +4.143922694128161e-01   +2.055304082550127e-01   +6.879225184791481e-01; +5.902067209681098e-01   +1.227041851622801e-01   +5.179273499788174e-01   +1.204904338060065e-01   +2.993104462665927e-01   +7.180920711332737e-01   +4.766808543683898e-01   +7.277037123010238e-01   +5.857960958437182e-01   +5.138229648628897e-01   +4.679511410943348e-02   +2.423247207060278e-03];
L2E_Input1_iAMPA_netcon = [+3.815015914572507e-01   +5.222557818341335e-01   +1.672813838590248e-01   +7.005690628561259e-01   +1.171557358977973e-01   +6.871068987906053e-01   +6.006800431996955e-01   +8.050286029555431e-02];
L2I_Input2_iAMPA_netcon = [+2.068397131081085e-01   +2.406648213193130e-01   +3.868462162143720e-01   +5.912708278057355e-01   +6.402075435960297e-01   +5.614230804275023e-01   +8.845454781531235e-02   +1.701702518962200e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 10*((exp(-10*((t)-( 50))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 10*((exp(-10*((t)-( 50))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
