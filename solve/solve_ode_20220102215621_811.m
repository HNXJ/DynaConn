function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.977407774257324e-01   -4.231585526090049e-01   +7.640494042560098e-02   +1.422743504598443e-01   +3.959670643010356e-02   +1.472168067432295e-01   -4.909701435652923e-01   -7.638677962879498e-02   +5.469574150410565e-01   +6.519114539203126e-01   +1.735785671286903e-01   -1.480147879756281e-01   +5.075074564801079e-01   -5.112088318078085e-02   -2.701713511057068e-01   -2.521128773329991e-01; +3.320176939783895e-01   +3.626706857010037e-01   +2.402868761897739e-01   +2.271351595594480e-01   +1.994222770298649e-01   +6.867232138452083e-01   -3.985286472269195e-01   -8.776033416144956e-02   +9.286331987759817e-02   -3.702363767970848e-02   +2.461685509191901e-01   +2.351105187532111e-01   +3.996205631623140e-01   -8.446492471659592e-02   -9.612231636337479e-02   -2.928076038378948e-02; +2.253708209541709e-01   +1.117642666859838e-01   -2.943404182111363e-01   +3.298711762424444e-02   -1.130418709171841e-01   +3.625113223425757e-01   +5.540753674263710e-01   -3.350367275887656e-01   +3.528453527459712e-01   +3.882570132477013e-01   +1.392171755190479e-01   -1.313388383307698e-02   -2.484866344611965e-01   -5.620262891018287e-01   +1.555378707168855e-01   +5.401562778597234e-01; +3.985053049704317e-01   -1.764007111638958e-01   +2.123607749197505e-02   +4.500201642197362e-01   +2.167193495113454e-01   +6.796580950683035e-01   +5.157532018759726e-01   +2.667307369720195e-01   +2.113042637466732e-01   -7.531370825825739e-02   +2.745800586490604e-01   +1.362851067737596e-01   -2.162725728481349e-01   +4.705168933311115e-01   +1.851519634895821e-01   +8.224398723633278e-01; +4.338235121135134e-01   +1.398081349546060e-01   +6.209142506616105e-01   +3.758128946153260e-01   -1.310652949472127e-01   +2.594942292547285e-01   +7.176485182036767e-02   -6.843478689258853e-03   +1.472949119013524e-01   +2.656284819252543e-01   +5.408928052702699e-01   +8.013333416202589e-02   +2.590229514532794e-01   -1.383525636281745e-01   +1.225144738145438e-05   +2.272066293669534e-01; -2.509559011943192e-01   +7.179203126285574e-01   +5.063644121370945e-01   +1.048126281359301e-01   +3.617956977617354e-01   +1.072163251780875e-01   +2.118612688169527e-01   +1.748173561843417e-01   +1.654655895410567e-01   +3.600458122196785e-02   +7.009603438891258e-02   -2.930359366012576e-01   +1.026622077001048e-01   +2.531851630588471e-01   -2.857444297357782e-01   -3.975779059989096e-03; +2.325344772509927e-01   +4.797039597796960e-01   +5.306329292785624e-01   +2.977625087443229e-01   -4.337554878404135e-01   +1.108636260001065e-01   +2.549522476002566e-02   -8.641161023456637e-02   -7.170662754135737e-01   +2.754929432647155e-01   +7.905392692112166e-02   +1.946924737004252e-03   +3.454842758066268e-01   -1.339307589509733e-01   +5.805957325411837e-01   +2.936079098312282e-01; -3.493279252270393e-02   +6.174940869207312e-01   -2.047763610300820e-01   +9.844335219034447e-02   +3.272320336578351e-01   +3.318127111038072e-03   +4.400879542962398e-01   +2.770991399801082e-01   +1.745181507816298e-01   -2.625985461377646e-01   +1.353166173387589e-01   -3.487012830719732e-02   +2.265951839205221e-01   -1.316851848019257e-01   -9.208227742577442e-02   +2.089916733440189e-02; +2.152626109632490e-01   +5.123775987080651e-01   -3.059742851486022e-02   -1.090123269033856e-01   +3.024858256368669e-01   +4.795194724903369e-01   -1.282896959378727e-01   -4.708313540774791e-01   +5.382764979410952e-01   -1.478533631823840e-01   +3.233346128908359e-01   -2.558400302446096e-02   +1.609090162032181e-01   +4.796792252637562e-01   -1.840526761311370e-01   +9.212697511458909e-04; +3.104539695834838e-01   +2.259234942230983e-01   +1.010879766651575e-01   +4.346570464800599e-01   -2.276478473596091e-01   +4.063012603220281e-02   +2.691643330082965e-01   -3.048183884991254e-01   -7.712982830454931e-02   -2.603967167852828e-01   +7.230517753150496e-01   +1.612681244490796e-01   +3.667745621300474e-01   +3.739228878405708e-01   +4.841499830734226e-02   -8.864009943955198e-02; +5.597677909203251e-01   +7.203720085457349e-01   -7.247397147211319e-02   -2.521576467455606e-01   +2.900235256585517e-01   -6.718744055663586e-02   -1.837956972608817e-01   -3.865047865738610e-01   +4.261831960224401e-01   +6.051016613562092e-01   +6.988773684819959e-02   +1.517449997810851e-01   -5.268141717251498e-01   -6.883766719502030e-02   +1.903682140118143e-01   -6.806809109162171e-02; +3.491823985116431e-01   +2.033670722965037e-01   -1.595007507992582e-01   -2.171581732953040e-01   -2.401954790589956e-01   +3.092006173588087e-01   +2.700570546908005e-01   -1.242433130909189e-01   +2.075919226424854e-01   -6.391109491826741e-01   +2.338145197379422e-01   +3.229664919103980e-01   +6.388215873134921e-01   +7.508021523958799e-02   -2.477275728989823e-01   -5.255188616392756e-02; -4.956347273358898e-01   +3.121938384135402e-01   +5.043032984432683e-02   +6.526634270533366e-02   +4.282866187327771e-01   +6.820412531231079e-01   -2.791757533308635e-01   +1.464907118971156e-01   +3.869938386321401e-01   +5.403879647363967e-01   +6.995997923529204e-02   +2.061362725824517e-01   -6.110225217897945e-02   +1.090172894149240e-01   -4.335520124997048e-02   +1.137095901704921e-01; -6.318930541965688e-01   +3.125754593507125e-01   +1.772242082173464e-01   -7.037731769405914e-01   +3.146537205420759e-01   +1.081009500874659e-01   -1.404246410304074e-01   +2.394071434305032e-02   -3.379687837539641e-01   +3.146642751650660e-01   +5.232066802799837e-01   -2.037189209374641e-01   -1.192382684216925e-02   +4.445369634218886e-01   -8.088858678229438e-02   -3.926497914328142e-01; +2.194024657769489e-01   -5.721372279305904e-02   +2.392671643773988e-01   +1.897170567860910e-01   +1.496814982274040e-01   +3.072443404526712e-04   -1.223965310284687e-01   +1.555469913199429e-01   +1.030443559775797e-02   -1.782308869306798e-01   +3.189827648985307e-01   +2.338905259164865e-01   +6.510335115422667e-01   +1.739918526934301e-02   +2.088187454713605e-01   +2.429034010260428e-02; -9.319395214655680e-01   +4.929838431985992e-01   -4.357477767549854e-01   +4.630750481170329e-01   +7.360799525949892e-01   +4.897589564503260e-01   -1.944343691550221e-01   +5.135744579235408e-01   -5.045536788598466e-01   +3.265507163247437e-01   +3.067834739251902e-01   +1.521928055935623e-01   +4.193969995294194e-02   +2.632780702556473e-01   -1.128794351280001e-02   +2.201125995120332e-01];
L1E_L1I_iGABA_netcon = [-1.367518482224455e-01   +6.947349177685831e-01   -5.328857339442342e-01   -2.980558765314740e-01   +6.208082162077859e-01   +2.669107742134394e-02   +6.208881382220722e-01   +2.918494866658314e-01   -3.545687491694427e-01   -9.319589919208221e-02   -3.263976400982012e-01   +5.971842276507684e-01   +8.305526740395097e-01   -4.278218746772459e-01   +6.408597531017833e-01   +5.370896838960604e-01; -1.005350628540200e-01   +1.527063173333227e-01   +9.437482449726180e-01   -3.214886242386183e-01   +4.264155999305599e-01   -3.493108002052865e-01   +5.292393167660794e-01   +3.796615506806776e-01   +3.054915886874549e-01   +4.252772864420829e-01   +1.589193369670494e-01   -3.049928558768393e-01   +4.350118107295872e-01   +7.010787248199206e-01   +5.555743891508701e-01   -2.583940837933707e-02; +2.866349051504351e-01   +4.118380331075072e-01   -3.669255006687608e-01   +4.637506756259245e-01   -3.958532697166814e-01   -4.293938570206097e-01   -3.169786265894064e-01   -2.602205411871082e-01   +2.888153275441108e-01   +5.273265991653979e-02   -4.027028006943774e-01   +5.658734325872486e-01   -1.903605129650890e-01   -3.894742117527678e-01   +7.380245837649418e-01   -2.162463612867468e-03; +4.524847084477397e-01   -2.303973955323462e-01   -5.269797088266434e-01   +1.437648555290834e-01   +2.944735368134487e-01   +3.590731979325253e-02   +1.791106482695708e-02   -1.199158662558976e-01   +9.143005052634443e-02   +3.992200367964664e-01   +1.648070770866377e-01   +3.022510014172733e-01   -1.358997591994183e-01   +3.426194677488539e-01   +4.093089683241007e-01   -1.847779607277417e-01; -4.360249971870002e-02   +2.965089731659967e-01   +5.688530978760968e-01   -8.248147745602785e-02   +3.794780440696970e-01   -3.718970557719127e-01   -2.591115619156008e-01   -6.350789785500662e-01   +1.069108465148122e-01   +2.988946317502993e-01   -4.667117786165561e-02   +8.414439144131092e-01   +5.634703861348164e-01   +1.144776912632111e-01   -4.440184259814531e-01   +3.091810439153670e-01; +3.068087426698795e-01   -1.609129413785096e-01   -3.638918953784687e-02   -3.672208410988857e-01   -1.014497655102475e-01   +3.059065539670749e-01   -2.339615339258411e-01   -4.150213229430686e-01   +1.308761656210238e-02   +5.638896009273264e-02   -2.355575261735743e-01   +3.689796834879877e-01   +2.466543192091235e-01   -1.587906960204496e-01   +3.678737901571144e-01   -2.948492569729784e-01; -9.396296608791845e-01   -3.984685840731213e-01   -1.734292222540372e-01   -7.028932658259085e-01   +4.140121848660641e-01   -2.153720105870877e-01   -2.358697207044136e-01   -2.109759829426654e-01   +5.943383997338989e-01   +3.828254566756346e-01   +5.302504259624063e-01   +1.578609696025444e-01   -1.393060350425818e-01   +4.011929206653316e-01   +5.800895299106367e-01   +1.862021805710322e-01; +5.705171984586804e-01   +3.614732399677645e-01   -3.972369579768258e-01   -3.736175123048201e-02   -7.601679527231217e-02   -2.796435256054225e-01   +8.109623396559127e-01   -9.996727847486897e-04   +4.110108958203260e-01   +1.037777319600738e-01   +4.010176584151866e-02   -3.098300292203057e-01   +8.184924678876527e-01   +4.442825260108337e-01   +3.662541432972487e-01   +8.251471518653875e-01; +1.280755282664890e-01   +5.338815522038559e-01   +2.989896446160869e-01   -1.982803181625273e-01   -4.433740270643873e-01   +3.756179387613183e-01   -2.498043460396373e-01   +1.811559921205505e-01   +1.116202219951316e-01   -4.342908510212406e-01   +9.525609983748642e-03   -3.097981525989482e-01   -2.219765042948502e-01   -4.719912768985993e-03   +5.917174970023008e-01   +2.159914500121630e-01; +3.738598099890665e-01   +4.874049466308780e-01   +2.669660776613847e-02   -2.907303212580725e-01   -3.896198678622974e-02   +4.009424886642690e-01   -7.897636658851942e-02   +1.335594690185495e-01   +5.515740560947563e-01   +1.330065659418034e-01   -6.095241045919970e-01   +1.677510599178660e-01   +6.154057097664806e-01   +1.154118212070903e-01   -1.936586457957060e-01   +6.651550247745906e-02; +4.078102284674505e-01   -5.596819912396646e-02   +1.755122306230846e-01   +4.781858829178034e-01   +1.396724108478872e-01   -2.190896791485462e-01   +2.364104142025578e-01   -3.063977757508198e-01   +7.354178089350136e-01   +3.297541173126511e-01   -4.374244965386787e-01   +5.283331956833917e-01   +4.679387960274554e-01   +1.747473801033420e-01   +1.616108101078719e-01   -5.780879753359025e-01; +4.250477534142490e-04   +1.996459990012211e-01   +1.399479237605331e-01   -4.380895563201647e-01   +2.892263501318045e-01   -1.383875525074489e-01   -2.476261931696004e-01   +1.720143876151575e-01   +1.700531171190183e-01   -1.617370350122807e-01   +2.826009329997345e-01   -2.450658057411466e-01   +5.553535686546783e-01   +9.931022067403919e-02   +4.450429646299051e-01   +8.359027224706608e-02; +6.361376011995687e-01   +1.669223653237348e-01   +3.898316241204559e-02   +1.976742265363479e-01   -1.460069773461823e-01   -1.426951589869874e-01   +2.020338730392887e-01   +1.030349535055994e-01   +2.712659799195652e-01   +7.681214047553264e-02   -1.327032965635970e-01   -5.629791857301941e-01   +4.103218586524767e-01   +7.675678646122550e-02   +3.055024338335820e-02   +1.905717540014697e-01; +5.173796827048924e-01   +3.088334484925898e-02   -2.457292361620368e-01   +2.236663888786444e-01   +8.772240237233127e-02   -1.144176371503897e-01   +2.703920824997049e-01   +2.834227331946771e-02   +6.081475669705594e-01   +1.180046009400624e-01   -1.525981799693060e-02   +2.767256219618816e-01   -1.936499893905263e-01   +2.064576877327452e-01   -3.467517448372389e-01   +1.469214463430374e-01; +1.344471300167996e-01   +3.282981869430543e-01   -6.315863176623018e-02   +2.406795833967806e-01   -2.103630610420672e-02   +2.300542850053366e-01   +1.083736660926190e-01   +2.387774328042615e-01   +6.404791875988273e-01   +4.926317009749005e-02   +8.455124429590044e-01   +1.543364111445915e-01   -2.832338828973886e-01   -7.008172076744836e-01   +9.178664871567701e-01   +3.059933257097019e-01; -4.853153739653172e-01   +1.949327591908550e-01   -1.760720710435768e-01   -3.462756248219482e-01   -1.241756332205877e-01   -1.535888288909570e-01   -2.339454079297926e-01   -3.681380872906828e-02   +9.216879273855583e-02   +2.681230236625096e-01   -5.688775425261200e-01   -2.196194019212266e-02   +4.038792384730013e-01   +2.753004479021608e-01   -3.788113995642569e-02   +1.936326550080897e-01];
L2I_L1I_iGABA_netcon = [-1.501605378218629e-01   -3.256258966477333e-01   -3.766854614992800e-03   +7.498173949120891e-01   -3.596417849790814e-01   +4.308371911602243e-01   -5.232408487411273e-02   -4.920526736320975e-02; -1.571692149155591e-02   +6.296158114461017e-01   -2.687772993945987e-01   -6.638023710939847e-02   +4.983402659120902e-01   +5.728059872685819e-01   +9.951243770968246e-02   -4.886205654143968e-01; +3.641452384676852e-01   -4.077068181832477e-02   -1.321946208067810e-01   +3.348969548257255e-01   -1.936166739901712e-01   -1.496940072085250e-01   +8.693332337562105e-02   +3.749021351283890e-01; +6.391977098669449e-02   +1.219579169393984e-01   +5.143851006411545e-01   +3.818605722823522e-01   +1.976993351406912e-01   +2.942066979591517e-01   +4.187352101828795e-01   -1.426264337096370e-01; +1.925253089961782e-01   -2.277983770374791e-01   +4.874995501646189e-01   +5.784960619277045e-01   +8.328342869906892e-01   +3.207202651618264e-01   +2.881871477517182e-01   +2.252897278181879e-01; -4.101879362469192e-01   +2.067665695630024e-01   +6.458784157792907e-01   +4.421688674254666e-01   -2.691196769514259e-01   +6.215316100360205e-01   +6.397664142941200e-01   +7.036369822309145e-01; +1.623121894894522e-02   +2.638356602663132e-02   +1.446929387269464e-01   -1.298449049303942e-01   -7.202480868019584e-03   +7.770899272991072e-01   +4.435005711121866e-01   -3.845270558134148e-02; -1.107490482537845e-01   +4.952165084762147e-01   +3.142546658124221e-01   +2.752770229883753e-01   +6.479564323623382e-01   -2.251760685745398e-01   +4.778936902013195e-01   +2.435684349480228e-01; +5.155393723626382e-02   +9.459381829492750e-01   -7.079328662418055e-01   +3.918570809334052e-01   +3.882664735615762e-01   +7.189897413534384e-01   +2.548788055599649e-01   -1.113304218469899e-01; +1.957485503215188e-01   -3.475514801436054e-01   +5.105547532300148e-01   +8.115196499893881e-02   +3.553739056947872e-01   +3.243570622646021e-01   -6.916028930633698e-01   +1.291165865771058e-01; -2.833252737016101e-01   +2.895996530518203e-01   +6.781428045757518e-02   +3.560607446224733e-01   +2.102971080675499e-02   -8.164148476393360e-02   +1.526053620156726e-01   +2.947094542565695e-01; +2.055073680135542e-01   +4.602011204748438e-01   +2.330127383200820e-01   -7.196353658285556e-02   -2.378624035174222e-02   +7.421186386564983e-02   +8.003990913658449e-01   +3.989374790945580e-01; +3.780073038066201e-01   +1.621341635811374e-01   -6.259075710462518e-02   +2.128964260768546e-01   +2.436636732489051e-01   -6.701135806449547e-01   -3.883645030664030e-01   +4.527944136564476e-02; -1.446321568797317e-01   -3.695285593933838e-01   -1.537468339991434e-01   -2.873409379231236e-01   +3.650644708438996e-01   -4.196984294258503e-01   +5.298035211399743e-01   +4.524519226330792e-01; +6.005457333999895e-01   +3.875998372857409e-01   +4.192058618597811e-01   +3.181740131356813e-01   -5.698295605050774e-01   +7.231039114397014e-01   +7.551093243468698e-01   +1.512770630971041e-01; +2.967661519457414e-02   +2.386575812418270e-01   +3.598929813650844e-01   +5.737589502965196e-01   +5.052347035641137e-01   +3.337516231870523e-01   +2.836945449645037e-01   +4.645196547838090e-02];
L1I_L2I_iGABA_netcon = [+6.034037140536319e-01   -3.073806691840308e-01   +6.062224140852390e-02   +5.132315345284858e-01   +1.477341016873225e-01   +1.699092952249807e-01   -4.022561959662154e-01   -3.176729291921827e-01   -1.065127058834555e-02   +3.662104600338234e-01   +2.045907204861686e-02   -1.387904609415341e-01   -2.732487053378515e-01   +1.007798252562988e-01   +1.838029144684932e-02   +2.185885531740865e-01; +1.772984540937819e-01   -4.337586795193251e-01   -1.223500600218599e-01   +2.594583921120385e-01   -2.271034403365764e-01   +9.350838856771732e-02   +3.869728722115316e-01   +1.956703124424989e-01   +2.067012128320397e-01   +5.838495943943172e-01   +2.353644147520715e-01   -5.384115735566663e-02   +4.802263623346431e-02   -3.598768727542733e-01   +4.715511188283814e-01   +4.382597424886334e-01; +1.921165921200453e-01   +4.028277676002311e-02   +2.809921674232363e-01   +1.131331043630773e-01   +5.684508273336136e-02   -5.080310360889695e-01   +1.802425007230536e-01   -1.341094788702986e-01   -1.172101138487827e-01   +3.069762887666299e-01   -3.987702558230314e-01   -7.519902463689225e-02   +1.688718916885523e-01   +4.657890221738568e-01   +6.518663687476695e-01   +2.231720891287607e-02; +2.446997549793574e-01   +4.578451250893348e-01   +3.412308904484450e-01   -2.403037538496849e-01   +5.060492574277662e-01   +8.368500935962151e-01   +2.761285308392235e-01   -2.021229153597429e-01   +1.273985270116939e-01   +4.540864332442991e-01   +3.220696452409065e-01   +4.564203838531888e-01   +1.431403525554500e-01   +9.663794313092903e-01   +1.451662529744444e-01   +7.586765744265132e-01; -1.424467441798991e-01   +6.770580794734112e-02   +2.296179503169462e-01   +3.581285521015210e-01   +1.246080945312582e-01   +6.124079899114241e-01   +4.674376260927267e-01   +5.270743837682496e-01   +3.068643594356121e-01   +2.906174617694273e-01   -1.638570770305803e-02   +1.901012462317879e-01   -8.199112356174127e-01   +5.833264311335491e-01   +4.724346995700180e-01   +9.569572013096226e-01; -1.052238035527670e-01   +7.324552267263368e-01   -7.265969174218881e-01   +2.011849760455402e-01   -5.410062013818051e-02   -1.804393056520418e-01   +5.300970288647097e-01   +5.014526318777690e-01   +2.942142168310150e-01   +3.064782242889076e-01   +1.762999857520448e-01   -1.477858871209717e-01   +2.696420932236712e-01   +7.591358922010544e-01   +2.695640628368757e-01   +2.698715904638969e-01; +8.207450268277303e-02   +4.859828352653174e-01   -3.091127907366975e-01   +5.930695673075060e-01   +4.496020939366079e-01   -4.946430420618996e-01   +2.408310386858268e-01   -1.817504766315276e-01   -3.855714984145613e-01   -2.991882537055407e-01   +4.173643134496147e-01   +4.559007467337970e-01   -4.473671393314979e-02   +2.523894667433233e-01   -5.331929457378103e-02   +1.912753948789351e-01; +3.487728942608616e-01   +3.423702524604152e-01   +7.538374512376825e-02   -2.237305865162290e-01   +2.963719878590224e-02   +2.609239907157345e-01   -1.415933233247957e-01   -3.160479854023081e-01   +1.701254333747183e-01   +5.678231365152102e-02   +2.305791631525497e-01   +5.657126027445786e-01   -2.754856859531391e-01   +2.497412187859671e-01   +1.874533900405358e-02   +4.241891808747054e-01];
L2E_L1E_iAMPA_netcon = [-3.098986168905792e-02   -6.305210809983177e-01   -9.727828513102003e-02   +6.053598907347931e-01   +2.681586217546881e-01   +2.610077480323626e-01   +4.482652149740495e-01   -2.412806255990510e-01; -1.425689327708985e-01   +2.487554223216167e-01   -5.619154931926924e-01   +5.161774897629393e-01   +2.773755041383929e-01   +4.259088932009381e-01   +8.892411967827521e-02   +2.911144754193172e-01; +5.213199832633778e-01   +4.192555463361138e-02   +1.334025002562785e-01   +2.485946248915621e-01   -6.681514868399155e-02   -4.593752506733410e-02   -7.972737774894503e-02   +2.661115052583014e-01; +1.761857019445232e-01   -2.069933006693130e-01   -3.770795861344101e-01   +3.833168810248621e-01   +1.909333966673800e-01   -2.414703967900552e-01   -3.771074490836563e-01   -1.131619406728478e-01; +1.394496510945330e-03   +1.077004496250304e-02   +4.450688763153102e-01   -4.078784792183571e-01   +1.355486343560096e-01   -3.287395276274898e-01   +1.280028147435206e-01   +2.589974732541612e-01; +7.546301153763826e-01   -1.072224167135018e-01   +5.801938587227201e-02   +6.512649033699361e-01   +3.495336900609845e-01   +7.534266045121547e-01   +4.838148793969406e-01   +4.617891597495888e-01; -3.667217767812843e-01   +8.630885034633289e-01   -6.316455067993640e-02   -4.325428264664276e-01   -1.044099807080381e-01   +4.067792902372842e-01   +7.899151538110536e-01   -3.662164858542394e-01; +2.626112650219127e-01   +3.166588221160163e-01   +7.832235866967420e-01   -1.661752805223594e-01   +2.431547607174155e-01   +1.377706397247710e-01   +7.173355513023080e-01   +3.308098469863366e-02; +1.068226593380435e-01   +9.775513733039878e-02   +9.210367543570912e-01   +6.736876488358918e-01   -7.967992202189255e-01   +5.659607518445726e-01   +7.014226461607026e-01   -4.095595670489746e-01; -3.664911989730143e-01   +4.641806967531464e-01   +1.787576402791335e-01   +3.747993351993737e-01   -1.726471300613641e-01   -3.457292995262476e-01   -2.109314852451470e-01   -1.386764680999175e-01; -6.018739719834371e-02   +7.077752582775829e-01   +7.850813933983454e-01   +2.516899639274189e-01   +1.676757921702401e-01   +2.394853656470889e-01   -2.255398733470889e-01   +1.194586104872058e-01; +2.417132253638586e-01   -2.357090985815010e-01   +5.398715673068069e-01   +2.788051073368298e-01   -3.971076273914413e-01   -8.081055154799888e-02   +1.058090992079495e-01   -3.454370035628500e-01; -1.767610296332935e-01   +3.596601254886219e-01   -1.007902425607963e-01   +4.920547229964997e-02   +4.208305165919689e-01   -6.487506900385150e-01   +2.625794094977448e-01   -2.493668137200189e-01; +3.712993180975693e-01   +8.967859884585887e-01   +4.383255445820569e-02   -3.495796414565115e-02   +4.770460315278400e-01   +2.242453406898095e-01   -3.070763334083120e-01   +2.435954887883220e-01; +1.071981036728075e-01   +3.227561250791517e-01   +1.281452496514557e-01   -8.305650367767840e-02   -4.595166429757273e-02   -2.185414272404553e-01   -3.026363374231240e-01   -2.750759088680644e-01; -2.623720144443201e-01   +1.662437681767642e-01   -8.019339829062753e-01   -5.954884977592108e-02   -9.496346776301433e-02   +6.171674313575214e-02   +7.428569469271342e-01   -2.924351405348836e-01];
L1E_L2E_iAMPA_netcon = [+2.952105351883370e-01   +3.852615655647176e-01   -9.595127324077790e-02   +1.065013524743511e-01   +2.145209838790209e-01   +3.362170250915635e-01   +4.088455278396975e-01   +2.724480712580030e-02   -2.348730182162002e-02   +3.755635739272191e-02   +6.445163687966414e-01   -2.286780972194395e-01   -1.913977718808285e-01   -2.010993824709011e-01   -8.131798535796229e-02   +6.352664167233112e-02; +2.856849722786470e-01   +8.900978258620713e-02   +2.643132200804066e-01   -1.904562575389712e-01   +1.815725680137963e-01   +2.230324829009299e-01   +7.714249943840381e-01   +3.814682176471557e-01   +1.093217155962431e-01   +1.745740936424795e-01   +5.944437317644755e-01   +6.163752749012584e-02   +7.855254286849900e-01   +3.097214802155644e-01   -1.246227555427810e-01   -3.297648733749673e-01; +9.280517270810730e-01   -2.245810318801015e-01   +1.528157152915722e-01   +3.422760597713499e-01   +5.031905533092990e-01   -1.243305218911329e-01   +2.009948124661162e-02   -1.235871651250386e-01   +2.236795440001048e-01   -2.415849690168738e-01   -5.922977046128977e-01   +4.698279041814838e-02   -1.962586542757676e-01   +4.240151876989846e-01   +1.101643813762055e-01   +4.994033939894634e-02; +2.419383079575332e-01   -9.314436120467687e-02   -5.000452668908690e-01   +4.945452555107974e-01   -1.120714486139390e-01   +7.211329331270744e-01   +7.488659771503240e-01   -3.859279102080048e-01   +3.271997495550465e-02   +1.616642472416129e-01   +5.567255295946668e-01   +2.069885843379833e-02   -4.306857525577429e-01   +8.085766896255645e-01   +6.191263666532408e-01   -1.390311561245311e-01; -2.533557311202297e-01   -4.987620454798174e-01   -1.405758565995242e-01   +2.333266814467703e-01   +5.606040189892893e-02   +8.919756450802840e-03   +2.282078711473316e-01   +6.300025761771390e-01   +3.837042535507652e-01   -1.335296669375145e-01   +2.378830321607593e-01   -4.543764457056660e-01   -2.927987199263233e-01   -1.195462626158082e-02   -5.025213041768017e-02   -5.138106272811855e-01; -1.534204857913378e-01   +7.351886527006641e-01   +6.493677281582777e-02   +5.029035446199779e-01   -2.294307868280435e-01   +5.615570207570675e-02   +7.324265571946500e-01   +1.791114070264113e-01   +3.588227186609900e-01   +3.244253328142855e-01   +4.181636592349033e-01   +1.439262337531746e-01   -1.195884252720832e-01   +8.864591478683505e-02   -1.523477828455642e-01   +7.963210846324507e-01; +2.824803385392777e-01   +4.931909042601050e-01   +7.901181644111613e-02   +2.074355475754204e-02   +3.540866281372609e-01   +3.491768739568671e-02   +2.267623215800510e-01   -8.102209345725995e-01   -3.920901548270349e-01   +2.344365200769731e-01   -2.475872011982800e-01   -1.045611831356790e-01   -7.747166261344659e-01   +5.142398386112863e-01   +2.072192594940110e-01   +6.548578174712415e-01; +5.141966251834529e-01   +1.137060551099745e-01   -8.050410585611957e-02   +5.853237634072330e-01   +3.829576278285409e-01   +5.189788602081800e-01   -4.153938801899518e-01   +2.612357694607233e-01   +1.709565250192443e-01   +3.134905340906458e-01   -1.117327292965243e-01   +1.916165580014612e-01   -7.526338722634208e-01   -2.802649839383823e-01   +5.474581015109986e-01   +2.570201880849526e-01];
L2I_L2E_iAMPA_netcon = [-1.859630989288755e-01   +6.130380764286052e-01   +5.478305474909695e-01   -9.491356459901130e-02   +2.191002812074492e-01   +1.461496211334990e-01   +5.875987645486687e-02   +4.941521122850321e-01; +6.210758532398446e-01   +3.225517978179020e-01   +3.974180261762480e-01   +8.596644473193912e-01   +4.626014999411503e-02   +3.115864481424037e-01   +3.153635038142524e-02   +4.278195953591414e-01; +1.004143802995343e-01   +3.062405618222739e-01   -2.567930617433414e-01   +4.265400490205498e-01   -1.839767972802313e-01   +3.895315952619440e-01   +6.477521346449011e-01   -4.507004315283662e-02; +4.668627564899565e-01   +5.102771526500532e-01   -5.244938112417074e-01   +2.907135812380665e-01   +7.130269633695010e-01   +1.798465412481740e-01   +2.883616962180774e-01   +5.212345571204449e-01; +6.174981999653583e-01   +3.552262967362981e-01   -4.167187796427614e-01   +3.113166783249711e-01   +6.358303977780242e-01   -4.843753875787608e-02   +2.201674611516407e-01   -3.137771724162992e-01; +3.471817052377681e-01   +3.549677709574687e-01   -4.572775178829844e-01   +4.367297335969080e-01   -2.596802614433258e-01   +8.832525811082223e-02   +2.149485516400093e-01   -1.987262414322559e-01; +7.975084103893034e-01   -4.037967948135420e-01   +4.817158667091410e-01   +4.090770551635814e-01   +1.245851130964728e-01   -1.756402614335393e-01   +4.739753485856100e-01   -6.394854515174537e-01; +3.584184544138330e-01   +1.104805293229740e-01   -5.527890290301217e-01   +2.797991923271949e-01   -3.268819332858082e-01   -2.663626999761582e-01   +6.803340985961151e-02   +8.382102891140135e-01];
L2E_L2I_iGABA_netcon = [+3.839082676606312e-01   +5.308553353674895e-01   -3.462288387216423e-01   -3.494419194748628e-01   +1.455999893066001e-01   +1.649143603824722e-01   -3.632228714240850e-01   +6.132460585963255e-01; +2.504967523752932e-01   +4.870093854998327e-01   +2.531771940241907e-01   +9.407131070061219e-01   +4.451911323701889e-01   -4.284246654801988e-01   -5.087518119162846e-01   +2.008548210040610e-01; +7.443750588762892e-02   +5.791291244096021e-01   -6.425704188503240e-01   -4.940692154634689e-01   -4.228370198278877e-02   +6.586252167014047e-01   +6.764195537503592e-02   -7.478029041998235e-03; +5.115924269414699e-01   +7.262958816447170e-02   +7.733204506657784e-02   +6.439881636617999e-01   +5.678000521372333e-01   -9.599537982735638e-02   -3.372496922781194e-01   -7.572806114148166e-02; -2.589679993002724e-01   -1.113289548728750e-01   -2.017530117525621e-01   +3.814139484324962e-01   +5.794568011532045e-01   +2.279973928171636e-01   +6.973735712986798e-02   +1.030909265545164e-01; +8.704635199671433e-01   +1.050434225124540e-01   +1.223435326291488e-01   +2.170968587338965e-01   +4.229275479910374e-02   -4.326309786376759e-02   +4.700082485305827e-01   -4.988905249786647e-01; -4.148529030180379e-01   -2.577298298851283e-01   -9.494001871980939e-02   +1.342881914226930e-01   -1.907595373487366e-01   +2.138986258444224e-02   +2.338131630636942e-01   +7.751780257443632e-01; +1.093387473011497e-01   -2.311311378160485e-03   +5.400052078565321e-01   -3.753254333593126e-02   +5.906340791320968e-01   +1.697506499774113e-01   -1.248427649660807e-01   +5.223850639837664e-01];
L3E_L2E_iAMPA_netcon = [-1.092897319764352e-01   -2.921796510400158e-01   -5.202605594847268e-01   +2.591906154050768e-01   +7.896109358433542e-01   -7.127769386413221e-02   -4.771541736013685e-02   +9.059424501090187e-01   +2.696717723448380e-01   +1.726065324836067e-01   +3.459330653077734e-01   -6.471582909994751e-01; -4.345725915457873e-01   +1.430890257823892e-01   -2.909318706315808e-01   -7.023812170237401e-01   -4.112390708330736e-01   -3.436962546366195e-01   -2.687303073095942e-02   -1.644213053342931e-01   -2.667913237323213e-02   +7.101921356267344e-01   -1.323294508508137e-01   +4.645281733666269e-01; -6.496189492930665e-01   -6.814894283603723e-02   +6.939198511786591e-01   -1.165210758580642e-02   +1.869543001105932e-01   -7.215260299018290e-03   -1.151685852918069e-01   -6.984502319968020e-02   +4.590952843402759e-01   -5.529536938499444e-01   +8.884943425044860e-01   +2.316146569673259e-01; +6.201865344020850e-01   +4.144015785423911e-01   -3.115801746710635e-01   +7.363440313421239e-01   +8.913505695696792e-01   +3.926236829664371e-01   +3.228642559917591e-01   +6.549164399960675e-01   +3.201518273359700e-02   -5.323499744129992e-02   -1.667767176933388e-01   +3.966525501285861e-01; +3.956625466981707e-02   +6.763538296097380e-01   +9.065175061714477e-01   +6.289733338354919e-02   +5.257715228262646e-01   +6.065129913427770e-01   -7.833197173171133e-02   -1.172411691563923e-01   -5.644645952763581e-01   +2.830485167060202e-01   -9.104952925933812e-02   +1.258689460133321e-02; -1.737098841916923e-02   +3.591416732542126e-01   +5.317995222487055e-01   +1.111179318171423e-01   +9.835301160882050e-01   +4.894261769528629e-01   -2.454000554748801e-01   +2.176790750690933e-01   -1.559124972863166e-01   +3.696450603423385e-01   -3.983969209390004e-02   -3.104687177360198e-01; +5.497771215006796e-01   +3.531062547725841e-01   -9.300777773123922e-02   -2.031389674664625e-02   +1.220502104920065e-01   +5.175939539256104e-01   -6.568608964390313e-02   +1.952505026580892e-01   -2.289126346374117e-01   -4.952697869076515e-02   -9.458462908703444e-02   +3.505280385940792e-01; -1.083809680930296e-01   +5.571086965827445e-01   +1.054330769504463e-01   -3.619910885948630e-01   +5.309134981697444e-01   -3.057320000814964e-01   +8.713645440243957e-02   -8.735909568640988e-02   +3.666348774089386e-01   -4.488464076989273e-02   +4.837193904429954e-01   +1.347224181737011e-01];
L3I_L2I_iGABA_netcon = [+7.111394309135988e-01   +5.370726676201494e-01   -1.419414600820005e-01   +2.133486809883552e-01   -1.996397418687911e-01   +1.369842606450657e-01   +9.566613693589593e-01   +5.562764677683392e-01   +1.163420739703979e-01   +5.609543350361548e-01   -1.705222990574647e-02   +2.640220246981066e-01; -9.779247086109977e-02   -5.339113476213506e-02   -5.710642886906606e-02   -1.045123509445140e-01   -7.195902500998809e-02   +1.868642578225698e-01   +1.871302117769048e-01   +1.676534181769671e-01   -5.170318425944412e-03   +5.434680292804299e-03   +1.073576874427203e-02   +2.959874751461138e-01; +1.350374878953060e-02   -1.620406527753016e-01   -6.637801003377002e-02   +4.396404015935933e-02   -3.472653666475690e-01   +3.981107888549151e-01   +1.526112645941697e-01   +3.160440368978196e-02   +2.237381289447578e-02   -2.750092537288997e-01   -1.145656177163072e-01   +4.471008304554155e-01; +4.033337170930214e-01   +9.188890145802456e-02   +2.221211618435679e-01   +5.400455401022342e-02   +1.476496901654101e-01   +4.096391466170135e-01   +3.556353759705014e-01   -7.864733515979069e-02   +3.283630678130142e-01   +4.030586655375337e-01   +2.561498246673518e-01   +2.493542612770623e-01; -7.355866209495904e-02   +3.784024283561050e-01   +5.633905031262965e-02   -4.182665114234910e-01   +2.345335109428904e-02   +3.636562705294681e-01   +1.213246203672960e-02   +2.497593161106398e-03   +1.840035431880380e-01   +1.998330691826851e-01   +9.146895513875179e-02   +7.840095467276149e-02; -6.001945464565088e-02   +5.737073677765343e-02   +2.482007214797910e-01   -8.232210801417672e-04   +2.506939882453614e-02   -4.165838232611355e-02   +1.056921720793065e-01   +1.437363324949562e-02   -1.551659570552701e-02   -6.529099203127406e-02   -6.372294931460981e-01   -2.021387732805424e-01; +2.089647708223581e-01   +1.044471876118414e-01   +3.184906899705117e-01   +3.446262654757715e-01   +3.643855938134884e-01   +4.681662906352633e-01   +4.255319776352219e-01   -1.619995728618648e-01   -1.214494168697356e-01   +2.387522255488086e-01   +4.110976259135747e-01   -2.820473593450203e-01; +7.148714886638896e-02   +2.971258369542917e-01   +1.047896792081963e-01   +6.509781694603790e-03   -2.751523843398168e-01   +6.177863302152570e-01   +7.095522221802179e-02   +3.843104516167811e-01   +2.637254525578324e-01   +1.591388615044437e-01   +1.576748753427479e-01   +4.266560080066741e-01];
L2E_L3E_iAMPA_netcon = [+9.111966544851968e-01   +3.400767258338975e-01   +3.440190977298976e-01   -4.047161384401211e-01   -1.481879528862799e-02   +7.326710441559327e-02   +3.851697664843725e-01   +5.225123029501249e-01; +3.392098034338811e-01   -2.744747707804928e-01   -2.174774789083949e-01   -1.748701393956253e-02   +7.528679683220625e-01   -5.761135207499228e-01   -7.373851744695271e-01   -3.617787218269389e-01; -1.859147744441253e-02   +1.236926269528436e-01   +2.753466658276429e-01   +1.245603627455633e-01   +3.140559510351544e-02   +1.310011461755461e-01   -1.538564934901725e-01   -2.559539431384287e-01; +4.298406715379009e-01   +2.221124020937157e-01   +6.811884826966355e-01   +8.804908466171346e-01   +1.698458808444518e-01   +3.758657857613434e-01   -1.954010501343195e-01   -3.633671764541690e-01; -1.378998010339010e-01   -2.261287926991206e-01   +3.309322263513776e-01   +3.482217103007413e-01   -1.303967313430046e-01   -3.258037453417602e-01   -2.120109137043084e-01   -5.732420146852174e-01; +2.604850008194501e-01   +3.632784083000388e-01   +4.165779969257846e-02   +6.132149735468020e-01   -2.245956356161937e-01   -2.349848583840831e-02   +3.042703370042467e-01   +2.418621518809209e-01; +8.173273906914834e-02   +5.577293708660601e-01   +8.050050747274466e-01   -3.088713147843993e-01   +4.527991495900592e-01   +3.341016177424357e-01   +3.153528410662620e-01   -6.192077754773288e-02; +9.319742584288693e-02   +4.239020652926720e-01   -3.033255384372796e-01   +1.709723902489715e-01   -1.469509666798080e-01   +1.470062559738024e-01   +3.032296981241803e-01   +5.833037868516933e-01; -4.455071737539917e-01   +6.056339779247381e-01   +6.771173645075433e-01   +6.409842876999718e-01   -1.964903671006809e-01   -3.952643695083299e-01   +4.721501655545258e-01   -1.836343756811676e-01; -2.574027788615433e-01   +2.134765818202401e-01   +2.616380904736786e-01   +1.367997357439510e-01   +2.488484471691716e-01   -4.369977865829295e-01   +4.894483329148863e-01   +4.636378680696641e-02; +5.620186120691183e-01   +5.020490744541605e-01   +1.771989404225835e-01   +4.838331972172975e-01   +4.013217915770715e-01   +7.715270431276933e-01   -2.894754464603957e-01   +1.711172772288664e-01; -8.167673170665835e-02   +7.023412889422065e-02   +6.456230141562080e-01   -9.673117719007354e-02   -2.330170383247460e-01   -1.125339462049045e-01   +1.391163090835764e-01   +3.240335490701697e-01];
L2I_L3I_iGABA_netcon = [+2.327224598269277e-01   +1.659425416243225e-01   +3.231093103158005e-01   +2.112569385454328e-02   +8.944672592658771e-02   +5.593305498635062e-01   +8.857262587721499e-01   +2.770002181775545e-01; -1.985098546340925e-01   +2.444027675202522e-01   +5.246739156412622e-01   -2.127995325567180e-01   -2.763859378953653e-01   -1.415434723879220e-01   +5.362505520267561e-01   +5.666803583405894e-01; +3.476530529919827e-01   +7.023311425628391e-01   +4.129853265540467e-01   +2.686116917099596e-01   +2.755177896473840e-01   +3.783796009865783e-01   -1.590470259093189e-02   +3.330524045286000e-02; -7.791895312155283e-03   -4.223365079064059e-01   +4.284159034258037e-01   +1.515493662097156e-01   -6.452025058910606e-02   -9.090715532083862e-03   +4.800744511928920e-01   +3.891254190597534e-01; -3.948525735540914e-01   -1.618753282801008e-01   +2.012456161933034e-01   +2.797336201119933e-01   -1.950623340044144e-01   +2.767091199152104e-01   +3.567301874785261e-01   -2.003958283617280e-01; -1.614075623796060e-01   +7.386008244713135e-01   +4.062264870420966e-01   +4.555985630947786e-01   +2.348044706169537e-01   +1.304092963904926e-01   -3.216291621212601e-01   -1.191081482169080e-01; -1.276670030543301e-01   +8.141581739558691e-01   +4.927099564539004e-01   +2.200244297249593e-01   -8.943973166614209e-02   -2.486582986385564e-01   +6.320116081593735e-01   +4.760027185204433e-01; -3.587705772488788e-01   +5.337424571276805e-01   +3.267555894630196e-01   +3.643031722589148e-01   +1.465691665821758e-01   +6.739200298711524e-01   +4.478894147625263e-02   +7.863756046255503e-01; -4.420695607951566e-01   +4.274006910150748e-01   +2.059959974896962e-01   +9.019556346788030e-02   +4.519042866619603e-03   -4.298223979483570e-02   +1.902316063592252e-01   +2.389338000199654e-01; -8.767669051521085e-02   -1.762828732221750e-01   +5.578402329796968e-01   +9.268982601776722e-02   +3.599960068082472e-01   +1.797230667153237e-01   +3.767997713780115e-01   +2.406126021499351e-01; +2.791335261695003e-01   -3.663372931397041e-01   -5.945603362409801e-01   +3.569629451230454e-01   +1.072218305373401e-01   +8.090096354115103e-02   +1.715056695411662e-01   +4.729385199060491e-02; -7.608860448523172e-02   +5.549165248635858e-01   -9.219823332666352e-02   +1.306526220449727e-01   +4.718548173854970e-01   +4.909316467061502e-01   -2.394476616092789e-01   -2.954599248857943e-01];
L3I_L3E_iAMPA_netcon = [+1.690860001446101e-01   -8.212632171321211e-01   +2.349788588964314e-01   -1.255042699025739e-01   +1.979372925355707e-01   +4.033582320650811e-01   +2.250467878040756e-01   +3.477058008647356e-01   +6.045698320788192e-01   -2.746848830835108e-02   +1.926388167091425e-01   +4.925150707861659e-01; -2.561476937364647e-01   +4.391473766738835e-01   +1.724038333931632e-01   +3.558491535556381e-01   +3.294031974925731e-01   +8.579911655293310e-02   +5.669275457070977e-01   +1.000000000000000e+00   +4.629769290170141e-01   -2.153791284477445e-02   -1.110083471777071e-01   -2.310836178567191e-01; +7.968356758653800e-02   +1.237044175704656e-01   +3.334431713821385e-01   -1.808167485939463e-01   +6.607333145814833e-01   +7.267434217290521e-02   +3.987007506241970e-01   -4.038855184924156e-01   +5.044185620056063e-01   +2.008888793113036e-01   -1.815874638051876e-01   -2.346507146322412e-01; -6.307715313310229e-02   -1.577886961530120e-01   +3.472987876041569e-02   -2.987595623712059e-01   +5.026356823559091e-01   +1.647482822681145e-01   +1.009299127890471e-01   +5.180346580107865e-01   -8.142385946998464e-02   +2.693482252052492e-01   +1.870634075206542e-01   +3.906504354195605e-01; -4.616710596253226e-01   +2.987482518359770e-01   +6.421768452364672e-01   +5.914287507788069e-01   -3.022386037747339e-02   +3.417613188194019e-01   +1.648929251676245e-01   +3.099727504978905e-01   +2.833584103296417e-01   -1.620152552990669e-01   +1.263329150158075e-01   +3.345892545318440e-01; +1.026241771498408e-01   -2.457847680335670e-01   -3.322118914789406e-01   +5.803299746596730e-02   +6.957245762779117e-02   -3.610676130715341e-01   +7.323920414072961e-01   +8.438273936430349e-02   +1.603104140263609e-01   +5.846435366578882e-01   -2.618413447966857e-01   +8.026756668075249e-01; +2.757732565519194e-01   +3.074454315921660e-01   -1.865099637446247e-01   +1.835840211098490e-01   +3.711410144889602e-01   +2.244356592413986e-02   +1.931473521141416e-01   -1.321640508488296e-01   +1.967812546338507e-01   -4.990817970861840e-02   +6.794780388923681e-02   -1.706945240820254e-01; +3.844083790583472e-01   +3.859085059843542e-01   -7.528124806769529e-02   +1.404835231201635e-02   +3.272748328928989e-01   +4.643820194234117e-01   -2.155430184181508e-01   +2.173151327144493e-01   -1.613411228257141e-01   -1.116748817899888e-01   -3.563671400214435e-01   +4.173716464358226e-01; -2.700027892314767e-01   +4.560622814294268e-01   +3.247383328729710e-01   +7.813522224301026e-01   -1.451654647151928e-01   +4.828742287872247e-01   +4.351376220787704e-01   +5.612858059399447e-02   +1.467596301747550e-01   +4.234786756602419e-01   +2.438890331978721e-01   +4.226899810777410e-01; +9.619175718063441e-01   -5.371920123947663e-01   +3.349890647076504e-01   -3.949455551232831e-01   +1.744028261777685e-01   -2.430675316617745e-01   -6.112191681938763e-02   +2.102489145712738e-01   -1.004583972240141e-01   -6.226479936956127e-02   +4.440499790155050e-01   -3.841262297390629e-01; -6.854600422177252e-02   +6.179155546066190e-01   +5.555113237940881e-01   +1.199968629365531e-01   +2.269561451191889e-01   +5.913058499071985e-02   +4.373792952163876e-01   +1.882869083463730e-01   +2.903460618930199e-01   +1.508818001933639e-01   -2.670177523262179e-01   +5.823069558065438e-01; -2.811268865618808e-01   +3.025158589988978e-01   -1.905897543433982e-02   +4.639884933805783e-01   -4.611817726098659e-01   -2.702321657574607e-01   -1.239627895682097e-01   +4.034944327273028e-01   +1.657189437256369e-02   -1.666698978967521e-01   -6.545130536895961e-03   +1.779758447421985e-02];
L3E_L3I_iGABA_netcon = [+4.193888903797147e-02   +3.754579310586299e-02   +1.867512800999949e-01   +1.224471969329540e-01   +1.826065343022798e-01   +4.915747275167494e-02   -6.044516540580903e-02   +3.299807244087912e-01   -1.464469524157596e-01   +6.153993744946747e-01   +5.543466424809663e-01   +4.577696789024651e-01; +5.286734984960854e-01   -3.155822475999192e-01   +1.410868156022447e-01   +5.335792892352635e-01   +3.005374995524853e-01   -3.295880595270251e-01   -4.567817273353991e-02   +3.376034216380823e-02   -2.039543023314666e-01   +2.244622610963208e-01   -6.070725589925738e-01   -2.421506303087728e-01; +3.517667175500598e-01   -3.107594256553559e-01   -4.852922341712363e-01   -2.975992333820303e-01   -2.259701932739839e-01   +4.503674692088206e-01   +4.670936925680433e-01   +2.810788949242537e-02   -1.464339609591503e-01   -1.099098844104560e-01   -1.124045934699630e-01   +2.243956163168493e-01; +1.320668826046157e-01   +6.935491806223384e-02   -3.064378003358212e-01   +4.929127263469074e-01   +9.864021509124393e-01   -2.220622806223065e-01   -1.203406765878473e-02   +2.200197105586496e-01   +9.792605565730631e-01   +1.578221760991375e-01   +5.801400053579618e-01   -9.932168641539998e-02; +2.661553841594251e-01   +3.371752545301895e-01   -1.103091865359855e-01   +3.686490848288088e-01   -2.232079972884232e-01   -7.352816401510621e-02   +2.365007641660739e-01   +1.853622852401920e-01   -1.003133791379696e-01   +8.657238188345685e-01   +2.536771625960602e-01   +2.918850267043191e-02; +1.321258646415719e-01   +2.160544191349021e-01   +1.576529609507317e-01   +7.591068657426809e-03   +1.389482335745478e-01   +5.067518099685214e-02   +2.926636893573737e-01   +1.719723388962337e-01   +2.004701117108834e-01   -1.160314153560319e-01   -2.297057796995572e-01   +3.426899110253902e-02; -3.749274670918814e-01   +1.187440643414238e-01   +3.337606313313912e-01   +8.530267420608785e-01   +1.587809715079629e-01   +4.201170496974085e-01   +4.844495576644994e-01   +7.450816740345331e-01   -1.494256102668989e-01   +4.689492369078763e-01   +4.124648263375431e-01   +3.975916315404834e-01; +1.406426039491263e-02   +3.303427503807639e-01   +3.945972694892039e-01   -1.366403108755023e-01   +3.041313794197383e-01   -3.260927012519428e-01   -7.256381689271705e-01   +6.509967640249837e-01   -5.156523053474278e-02   -5.663294288394438e-01   +5.666899663746343e-01   +4.174995526391764e-01; +2.047676477816275e-01   -2.146473852409923e-01   +6.306471769438682e-01   -4.301387970990710e-01   +4.236101191914866e-01   -9.436534337550714e-02   -7.287025149051137e-01   +9.180284936551819e-02   +2.052873823213373e-01   +6.243508912493697e-01   -1.123514217121902e-01   +5.027516429872598e-01; +1.686517270720853e-01   -9.263848446668312e-02   +1.878903850151711e-01   -1.027525950994572e-01   -3.834884903388809e-01   +3.299847847980040e-01   -4.122718229973569e-01   +2.734285726117778e-01   -9.058143948705571e-02   -3.905580771037410e-02   +3.474177390530430e-01   +7.022196385157799e-02; -2.381470877007714e-01   -1.082940849675604e-01   +3.177189506011122e-01   -4.623399683167402e-01   -4.026850984041195e-01   -9.680803206242589e-02   +2.854841044987021e-01   +9.212501038221424e-02   +2.899523028884694e-01   -3.958860000034209e-01   +4.795452492669713e-02   +4.702137928076541e-01; -2.941986218043052e-02   +2.191627279872108e-02   -3.750282004889435e-01   -1.618666131029456e-01   +8.183541964813107e-01   -9.859609306136324e-02   +4.348830515334547e-01   +4.675376538864034e-01   +3.766716971857709e-02   -5.007991342025153e-01   +4.200488727786764e-02   -5.576958908114473e-01];
L2E_Input1_iAMPA_netcon = [+9.057477673500631e-01   +8.851049848030997e-01   +8.877361874827796e-01   -8.079531681841362e-03   +3.941839493793443e-01   -8.089508111508815e-02   +5.548771225124814e-01   +4.769234598544845e-01];
L2I_Input2_iAMPA_netcon = [+4.161805481081891e-01   +7.962394111070001e-01   -2.405480137992910e-02   +6.885899789565283e-02   +2.421261855878911e-02   +4.278959420399480e-01   -2.959292261688722e-01   -6.651707712565244e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
