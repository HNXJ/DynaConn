function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.903936988225838e-01   -3.090482413003018e-01   +4.481818986345464e-01   +2.622716603142130e-01   +3.888823840866808e-02   +3.557243300904460e-02   -7.399572618191959e-01   +2.513035127312558e-01   +5.776259504480074e-01   +6.221998716417931e-01   +2.510928789222950e-01   +3.353745398519497e-01   +1.285713301656479e-01   -2.023301313494658e-01   -4.180138716058083e-01   +3.941953462708156e-02; +5.831963149782441e-01   +2.378244951988032e-01   -3.030891540904615e-02   +1.541581208227692e-01   -2.644808601767457e-01   +5.853672260915661e-01   -7.145152960178639e-01   +1.553456556229867e-02   +5.846940932175287e-01   -3.991818253938750e-02   +8.280823234913132e-01   +4.802530662144042e-01   +3.887772831623268e-01   -5.155186445940314e-02   +1.022216399048605e-01   -2.560434734191416e-03; +3.418883018069858e-01   +2.154302562340377e-01   -1.313493406497334e-01   +2.788558893297874e-01   +1.021426382367958e-01   +1.455540002846180e-01   +4.845359630139831e-01   -8.979569846511798e-03   +3.087267720713807e-01   +2.971706284701789e-01   +3.221278297438128e-01   +4.214982023794989e-01   +1.173356579782909e-01   -5.080871610764539e-01   -2.009177095461468e-01   -7.243484237931604e-02; +6.200861639528842e-02   -2.992432963997218e-01   -2.959663301778190e-02   +6.145820176218978e-01   +5.698538142461787e-02   +3.831389591727314e-01   +7.116195134284136e-01   +7.095084248936970e-01   +5.244195431837962e-01   +4.684193017367801e-02   +5.811407542386369e-01   +2.959618892046136e-01   +6.012276520303410e-02   +4.853817433698934e-01   +1.365160110350274e-01   +8.485631275175930e-01; +1.494810520009142e-01   +3.454620993380206e-01   +5.308661348989457e-01   +6.025271478714433e-01   -1.157565311070504e-01   +2.618480629975816e-01   +4.367036752804185e-02   +9.827482254824094e-02   +2.580296374470105e-02   +2.846016711131835e-01   +6.374044411902151e-01   -1.570882458426645e-01   +5.178709632455135e-01   +1.490359448469356e-02   +3.703970433961851e-01   +8.288911792096908e-02; +1.315571382961028e-01   +7.482578042439132e-01   +2.155705292235877e-01   -1.230724339118426e-01   +4.667137656060770e-01   +2.704385921476922e-01   +5.514476857434332e-01   +2.225745329224791e-02   +4.295300972609619e-01   +3.974617961399782e-01   +2.687128213751494e-01   -3.169977501560490e-01   +2.527106226672149e-01   +4.165010010915376e-01   -1.909906903458177e-01   -5.275586362579040e-01; +4.289016063409158e-01   +3.106606598592320e-01   +4.680259013573983e-01   +2.220333065038916e-01   -2.313195547247232e-02   +5.627659655962800e-01   +3.106754358554885e-01   +2.890849525641156e-01   -4.974133877052384e-01   -4.661101396140992e-02   -1.105468520863623e-01   +2.430331662899744e-01   +3.912113645953849e-01   -8.523084924614016e-02   +4.032208682221012e-01   +5.924167105896331e-01; +5.689545669433852e-01   +1.316310473834618e-01   -1.755998330821062e-01   +1.812462230027948e-01   +4.918381755002565e-02   +6.796127461936949e-03   +1.365415567909244e-01   +6.056977798390506e-01   +3.552193429267608e-01   +1.875401085991645e-01   +4.197131123942886e-01   +2.247120356038528e-01   +4.325708381960161e-02   +1.706362936883738e-01   -2.241343637958245e-01   +3.767651780275720e-01; -6.287449776491050e-02   +6.338421816135289e-01   -3.038871730916787e-01   +2.540535284680595e-01   +3.097406778593729e-01   +4.187180581278764e-01   -1.604077948093161e-01   -2.369847176975066e-01   +2.466053643565955e-01   -8.972921416349679e-03   +6.138827930414994e-01   -2.252672304734090e-01   +2.492635786397748e-01   +3.891396133865179e-01   -3.698180820612000e-02   -4.991585832225616e-02; +2.034886800375747e-01   +5.293211393012280e-01   +4.231997060782168e-01   +2.892026905410232e-01   +1.086960255045081e-01   +1.838693745736412e-01   +5.060210757818865e-01   -5.361028884962149e-02   +2.527868194697565e-01   +2.611586424731531e-01   +6.046346548953002e-01   +1.179539711040531e-01   +5.969282949343511e-01   -6.868313063027906e-02   +2.356350233817678e-02   +1.413768008488094e-01; +2.624159261962269e-01   +5.624372301211540e-01   -2.417782883096194e-01   +2.662601820628115e-01   +6.312497168774818e-01   +1.230916220516245e-01   +2.533258880341549e-01   +4.251287851333532e-02   +8.658798089869454e-03   +4.929441997415160e-01   -4.585551514814858e-01   +4.615146676259127e-02   -5.540190897908566e-01   +2.866259950943570e-01   +2.664146125596484e-01   +2.693260698895683e-01; +3.493812065601021e-01   +3.054866132929281e-01   +1.038959612723104e-01   -1.253550311167531e-01   +9.843475676436021e-02   +1.539880141935304e-01   +4.977107653600142e-01   +2.231713756676074e-01   +6.550850525087933e-01   +1.578578870041324e-02   +2.901677944295660e-01   +6.755458781361541e-01   +7.260132222800192e-01   +6.325307998295654e-02   -1.826565830352473e-01   +8.436923104771452e-02; +3.192519846459343e-01   +1.393228565158002e-01   +5.121844550320835e-01   +1.739745355910166e-01   +8.341619889852105e-01   +4.597426318283825e-01   +9.559039442031994e-02   +1.334865399139157e-01   +6.445914234264061e-01   +1.319269156211714e-01   +3.940396330069847e-01   +5.166945607483914e-01   -3.909212362128361e-01   +9.179297279562756e-02   +1.520575423773908e-01   -1.600520155691572e-01; +4.271175389988460e-03   +2.372779468008293e-01   +1.637311093633682e-01   -6.067009337735683e-01   +2.060431447367612e-01   +5.946561509503645e-01   +8.944776070465266e-02   +4.552439665383143e-01   -2.909042404463300e-01   -3.864572897044850e-02   +5.449151252595571e-01   -1.835461850850736e-01   +1.525010160445078e-01   +6.282776614283752e-01   -1.070199211716168e-01   -1.891896229588805e-01; +4.299607300500433e-01   -3.450997809997345e-01   +7.146054342896725e-01   +3.320076834663506e-01   -2.074736404133370e-01   -3.224255865260207e-02   +4.395379244757465e-01   +9.312723954011111e-02   +8.215159123671639e-02   -1.364541494804113e-01   -2.351992184700838e-01   +3.777391639508243e-01   +5.845759937938123e-01   +1.655338918651920e-01   +1.011136341501682e-01   -3.183972043265675e-01; -6.530789849497765e-01   +5.814896729653554e-01   -2.553487778439804e-02   +5.351919189468608e-01   +7.085049546133194e-01   +6.317909740396566e-01   +1.077257783625496e-02   +9.733280521255445e-01   -3.773110967752832e-02   +3.981104357163384e-01   +4.410728634001227e-01   +3.908851832408030e-01   +2.501317281280735e-01   +4.201487577139783e-01   +5.745165471787888e-01   +2.102539124491116e-01];
L1E_L1I_iGABA_netcon = [+4.445846251612799e-02   +4.024833487874301e-01   -3.404373273138406e-01   +1.809791673634033e-02   +6.713843491608461e-01   -2.485225430517993e-01   +3.165380290626063e-01   +2.876537451125560e-01   -3.804636097152492e-02   -3.806786357159361e-02   +1.892042640536452e-01   +1.854430652616069e-01   +9.510316967521382e-01   -5.063159621139202e-01   +1.634813850762473e-01   +7.438907217198064e-01; -5.125455743744857e-01   -5.691413390767901e-02   +6.632257298608002e-01   -2.303183806292420e-01   +2.778262928742821e-01   -2.236411570525339e-01   +3.613942737336516e-01   +4.344318387068542e-01   +4.285688962208345e-01   +2.818232391943638e-02   +4.379664703466751e-01   +5.374053160609878e-03   +5.754167047236594e-01   +1.869618063636903e-01   +3.797043454004643e-01   -2.023504725442891e-01; +6.047575526131927e-02   +1.943664023530171e-01   -1.700418743234660e-01   +4.173994408048967e-01   -1.302968070114814e-01   -1.743436246727058e-01   +9.658371953551800e-02   +7.214951429477882e-02   -3.383953363814351e-02   +4.436221174734435e-01   -4.685785412096032e-02   +2.257749390705170e-01   +9.003476152001576e-02   -5.625494552622125e-02   +6.685314234353937e-01   +2.880534367087691e-01; +5.145300579087336e-01   -2.331673161622152e-01   -6.296829723113956e-02   +2.119326470347177e-01   +9.239896489951580e-02   +4.446910306498952e-01   +2.412073337065235e-02   -8.723147362817042e-02   +4.205142671198711e-02   +2.657037702626311e-01   +3.012339743208680e-01   +4.918136106401818e-01   -1.448289617253584e-01   +3.633993428203820e-01   +8.790439468582724e-03   -3.036220190765351e-01; +2.395701710084583e-02   -9.868440846493111e-03   +5.616365604968955e-02   +4.574919560667033e-01   +3.656640625232593e-01   -1.496167531145750e-01   +2.216369966809521e-01   -3.853237938199415e-01   +9.293080867723810e-02   +1.630805955829006e-01   -3.065635197499345e-01   +5.772890943768191e-01   +3.022366022350113e-01   +3.123731088209806e-01   +7.202269624368690e-02   +6.109552751289662e-02; +2.254741922907966e-01   +2.199206946999560e-01   +2.431686915479814e-01   -2.027758166643112e-01   -2.755077087401374e-01   +7.582213353341585e-01   +6.253029029429602e-02   -3.289572121116728e-01   -1.489062079578650e-01   +1.626315745177493e-01   -4.898946298506261e-01   +4.186719988915190e-01   -9.619831763222705e-02   -4.924029992571306e-01   +4.964260596318151e-01   +2.094671511426756e-02; -8.700400255244614e-02   -3.856087551818326e-02   -2.361452469554464e-01   -2.205554760331021e-01   +5.139338714282895e-01   +7.854515610468296e-02   +2.713131819734568e-01   -2.002617148324845e-01   -4.543557004473857e-02   +2.352543018931048e-01   +5.276475725509441e-01   +2.985756722768920e-01   -5.114211879635808e-02   +4.452427970804908e-02   +1.000000000000000e+00   -2.490474970252822e-01; +1.500585011796460e-01   +1.376354318040180e-01   +4.670016076313822e-03   +1.492340499264025e-01   +1.088135191778458e-01   -5.804219960724147e-02   +5.836223670495985e-01   +7.990198129208119e-02   +5.653897865292982e-01   +2.667242902874062e-01   +8.797565378451529e-02   -7.358125723763023e-02   +5.039983225636121e-01   +3.567667553329962e-01   +3.440874891384832e-01   +5.213814232204924e-01; +5.736660640181641e-01   +6.191406016088217e-01   +6.104072884443158e-02   -1.121712763348364e-01   -4.982835551193209e-01   +3.190386173402533e-01   +1.024837319036772e-01   -2.144270700889576e-01   +1.312148205823749e-01   -9.634218366380275e-04   +1.981310880245122e-01   -2.841806118876610e-01   -1.895337301673442e-01   -5.334233845246033e-02   +5.501467169656420e-01   -1.398743923158729e-01; +2.282979787695159e-01   +5.457727985194772e-01   -1.426922017620184e-02   -1.051371114440222e-01   -2.006659255806288e-01   +5.500724561818374e-02   +9.639837545402261e-02   +4.277551906521528e-02   +3.591767980305028e-01   +1.165038119991111e-01   -4.699648359916206e-01   -8.126093286514217e-02   +4.085671167750962e-01   +4.635770785754868e-01   +2.611174091524847e-01   +4.257196332471912e-01; +2.783923460444933e-01   +3.699293514963190e-02   +1.196361505893137e-01   +6.223133024972762e-01   +2.667995894833060e-01   +4.457723187167749e-03   +2.331466977026344e-01   -1.821658509906849e-01   +4.002764738598916e-01   +3.234228056769507e-01   +1.960177180570724e-01   +6.067121278518067e-01   +6.977544372600709e-01   +3.363677164007614e-01   +1.632415277653110e-01   -2.479377877590458e-01; +1.907171339606335e-01   +2.785513049317880e-01   +1.552652289766690e-02   -5.832813222254914e-01   -3.077621077976342e-01   +3.010201058195392e-01   -4.494201395170724e-02   +3.603384998069794e-01   -1.290225376520344e-01   -2.449765066138130e-01   +2.379846356799780e-01   +2.869774341541987e-01   -1.184719702827542e-01   -7.667839884332688e-02   +2.991125894677579e-01   +2.779724827247153e-01; +3.428964571631675e-01   +4.959980231893625e-01   +1.874650509560947e-01   +4.522546117865360e-01   -1.675704975963512e-01   +2.461069182713373e-01   -1.112539199926932e-01   +2.693003114013095e-01   +4.891383364520792e-01   -1.487296650729422e-01   +1.453779942967388e-01   +3.796657328876502e-01   +2.763358501801685e-01   +5.960951092081117e-02   +4.501117583123304e-01   +4.163823672861244e-01; +5.174615625837846e-01   +8.521325870249470e-02   -1.528719860498175e-01   -1.137474755694572e-02   -3.683259804762361e-02   -1.488149632142748e-01   +1.729062311684796e-01   +3.723461764187380e-01   +5.558895091311181e-01   -2.601346302402401e-01   +4.288356586695400e-01   -2.372524816791222e-02   +7.068442749422024e-02   -1.722774955559826e-01   +2.516868227482292e-02   -3.348364766545565e-01; +4.264855954459947e-01   +1.484398881842412e-01   +2.732518101315573e-02   +6.617011931107516e-03   +7.338265163377425e-02   +1.456250364430156e-01   +2.912015241836880e-01   +3.722579827932711e-02   +4.634696910946923e-01   -3.157804332430524e-02   +2.501721934082286e-01   +8.885192968421091e-02   -6.880332538884714e-03   -3.861258534337889e-01   +6.845742573645228e-01   +4.816993843063617e-01; -1.746804491652344e-01   +1.354791642288489e-01   +9.973303538147816e-03   -7.716208851356718e-02   -4.545476282179692e-02   +2.903800894203129e-01   -6.669105997575421e-02   +8.807524194424800e-03   +4.521363544901782e-02   +1.900753268298682e-01   -4.420541537214825e-02   +1.270834688183500e-01   +9.989694434393152e-02   +2.464158209859474e-01   +4.180447066426968e-02   +6.956430387745733e-01];
L2I_L1I_iGABA_netcon = [-1.344064233524321e-01   -2.243049084710840e-01   +8.039411316561421e-02   +2.890083102595479e-01   -1.124978402446842e-01   +1.280254830179947e-01   +4.238967738212233e-01   -2.864864747644173e-01; +4.181356509030367e-01   +7.049611171462357e-01   -1.660592929882873e-01   +9.785459687822985e-02   +6.326547442838263e-01   +5.206085820171572e-01   +2.840429860521438e-01   -5.776217663148720e-04; +7.624221321629938e-01   +3.469959628998672e-01   +7.970045779836904e-02   +3.906845379092071e-01   +4.535717055110274e-01   +1.004863770883613e-02   +1.097600969398239e-01   -7.124917450877727e-02; +5.558573482544703e-01   +2.290191969188265e-01   +7.448583883628146e-01   +1.192886139996242e-01   +4.617441726787772e-01   +3.719852264279008e-01   +5.194724319903815e-01   +9.784468494003873e-02; -4.216809389610060e-03   +3.706015932854533e-02   +4.399808434247269e-01   +3.830316526801034e-01   +3.134271969506335e-01   +9.191429830980712e-02   +1.351764818395833e-01   -1.124525216531862e-01; +8.823758126980971e-02   -2.736619197990154e-01   +2.049816102283734e-01   +1.759063884958912e-01   -1.963237804051145e-01   +2.287543219589045e-01   +4.683727938620662e-01   +5.203047563058578e-01; +7.208417021212605e-01   +4.340409363795738e-03   +2.581295247454737e-01   -4.251013564150181e-02   +2.833115603396428e-01   +7.371540286341063e-01   +4.193862931828240e-01   +2.628925233046867e-01; +2.796307743649287e-02   +5.083731584144663e-01   +2.326608161272738e-01   +6.505598515523107e-02   +2.213856118579046e-01   -3.781797996611324e-02   -1.021685889105420e-02   -2.144656649086786e-02; +3.166606440670052e-01   +1.000000000000000e+00   -7.107358551103620e-01   +2.567584877729429e-01   -9.030586879348897e-02   +1.678966682939625e-01   +3.572194092164196e-01   -4.551962110407158e-02; +7.770584653486283e-02   -1.074402954397773e-01   +1.274189275967191e-01   +2.459839022265827e-01   +6.654558755060683e-01   -1.637332791646238e-01   -5.552323631939009e-02   +4.109729673477270e-01; +2.443863440339783e-01   +1.274475778865658e-01   +3.569280068704374e-01   +2.803820966432321e-01   -1.599464494089204e-02   -1.230020065371684e-01   +1.640880173898032e-01   +2.715557901385718e-01; +3.517354363601571e-01   +2.941088525395084e-01   +5.186568465167414e-01   +2.331224462866243e-01   +4.994635931657044e-02   +2.344545616333159e-01   +5.214164657172531e-01   +4.812276778979167e-01; +4.307698498274583e-01   +3.217088033676240e-01   +3.730557050054996e-01   -6.506988293015059e-02   +3.807082741425425e-01   +1.441347726939764e-01   -3.145468610904087e-02   +2.335973332164499e-01; +2.604830974563876e-01   -1.684776025141799e-01   +1.397438900387513e-01   -3.759755054520661e-01   +3.741612151422201e-01   -1.589564084902320e-01   +3.925406881162576e-01   +1.139742518945491e-01; +3.443043740676960e-01   +5.271267997477501e-03   +2.946487423578468e-01   +4.559460868490921e-02   -2.263184007578060e-04   +7.828989176694018e-01   +2.465174094452660e-01   +5.638468413450285e-01; +4.782319670376980e-02   -9.048535961874624e-02   +1.976756819354539e-01   +3.722597847117696e-01   +2.747194381505119e-01   +1.407780365240304e-01   +3.284945515544941e-01   -1.138122314036701e-01];
L1I_L2I_iGABA_netcon = [+4.966970481810553e-01   -1.210420366297692e-01   -1.462160217036147e-01   +4.961329094733656e-01   +4.492583185363920e-02   -1.369460588652257e-01   +5.786829570747877e-02   +3.353102216094749e-01   -9.558815440795161e-02   +3.791011209644244e-01   -1.140942774194027e-02   +2.685927666156858e-01   +1.735514061356548e-01   +1.526827906999896e-01   -1.157782341189694e-01   +2.417857810814202e-01; +3.996926013427308e-01   -1.323698382123229e-01   +1.413105830619734e-01   -3.408000298329678e-01   -8.515595161850209e-02   +1.127759475870835e-01   +5.328766871518755e-01   +3.291522162852027e-01   +2.897836250406277e-01   +8.109840924448697e-01   +2.645218791817552e-01   -7.679813650472854e-02   -2.108251087402981e-01   -4.363416096624040e-01   +4.533155975649136e-01   +5.004888113067625e-01; +1.358263128862953e-01   -2.817965970896253e-01   +3.715140546795831e-01   -8.489889517833946e-03   +1.843980721456367e-01   -2.806672513375573e-01   +6.898457389709741e-01   +3.937156819243317e-01   -2.750411538936325e-01   -1.307201785522913e-01   -1.397475189224551e-01   +2.864919200242430e-01   +4.827253379529731e-01   +5.319527920413949e-01   +9.447819904279753e-01   +6.090077275692182e-02; +3.514432318983285e-01   +5.959421316666226e-01   +4.666100791065511e-01   +4.421590792625054e-01   +4.769174657739262e-01   +5.655573127339715e-01   +5.222827033451286e-01   +4.448562335485469e-01   -1.762998062681455e-01   +7.077919874340218e-01   +5.577251338023786e-01   +3.029312861557451e-01   +2.250873115330498e-01   +1.315005039994332e-01   +4.589444378140219e-01   +2.346969509900931e-02; -3.160695931573419e-01   +3.644133873648109e-02   -2.157360774983339e-01   +3.592607159179566e-01   -8.537410504365492e-02   +7.434049448197563e-01   +7.305651864829718e-01   +3.745944725153590e-01   +5.461023370670530e-01   +3.981720068072032e-01   -2.697945080776613e-01   +1.871662117789311e-01   -4.018894521132634e-01   +1.927970564491222e-01   +3.611347862512242e-01   +4.357053483525439e-01; +1.581836640108988e-01   +3.921695971310645e-01   -2.149048392542608e-01   +5.249239191391386e-01   -2.937763349372087e-02   +5.238007805094535e-02   +2.952294188707014e-01   +8.681404751996069e-02   +9.739767720301681e-02   -1.685360512208845e-02   +7.586075031628085e-02   -1.663695309055010e-01   +5.554548845098909e-01   +1.000000000000000e+00   +2.597105492182549e-01   +3.354228882172451e-01; +4.584808153715736e-01   +5.241925000287808e-01   -4.264459338920152e-01   +2.228068403393930e-01   +4.337946485904083e-01   -4.089946945469172e-01   +3.784624623843107e-01   -2.492605103921653e-01   -1.709153404410390e-01   +1.504103133248733e-01   +3.529203865243467e-01   +2.976621598732286e-01   +2.176113346717632e-01   -1.337859722700323e-01   +1.244075192566800e-01   +3.424767092546726e-01; +4.490863775548256e-01   +1.974993838319607e-02   -1.366804573102111e-01   -2.702848754558771e-02   +9.519583065187144e-02   +3.756272337066607e-01   +2.434808400133542e-01   +1.051043650865714e-01   -1.188804195598807e-01   +2.924896886702851e-01   +3.534877447185328e-01   +5.106635160504580e-01   +1.389055541700361e-01   -2.409247287498639e-01   +4.362458471839169e-01   +4.561624431360667e-01];
L2E_L1E_iAMPA_netcon = [+3.012582565595315e-01   +5.113204703107234e-03   +1.402539273384454e-01   +3.596270531741436e-01   +1.000000000000000e+00   +5.349148044914520e-01   +3.364542694973525e-01   +1.841300030607856e-01; -2.028327430890217e-01   +3.147976553369173e-01   -1.044660341017631e-01   +2.970752581185661e-02   +6.552991808471149e-01   +2.024702502590304e-01   +5.595337785534734e-01   +1.576558303964260e-01; +1.859241752456477e-01   +4.728005926312472e-01   +2.978739228237065e-01   +7.466613190344461e-02   +5.832647929520102e-02   -2.863882816243665e-01   +1.291067574118175e-01   +4.757988823579443e-01; +4.926741641264693e-01   +9.794152562335184e-02   -1.659308115021925e-01   +4.812033415443908e-01   +1.354724925751416e-01   +9.793207182615549e-02   -1.225840665393083e-01   -8.304987265335810e-02; +1.011051897906330e-01   +9.558435374285167e-02   +6.371280343168744e-01   -1.239080075267864e-01   -1.411045066879596e-01   -1.276720241121265e-02   +1.010145792856908e-01   +2.682009074250088e-01; +3.920503728329404e-01   -2.407236226736586e-01   +3.268068764833598e-02   -3.037325306131597e-02   +2.277916343538580e-01   +4.603065835223035e-01   +3.861921770453613e-01   +4.663206996138385e-01; +2.749858644285037e-02   +5.353269798267620e-01   +1.642249041502156e-01   -1.448350591293741e-01   -2.573327770944702e-01   +4.673443029977037e-01   +7.363891086505134e-01   -2.226107902155991e-01; +3.197099807465795e-01   +5.183267822696985e-01   +8.721642376898462e-01   +1.862574681216318e-01   +4.085860311324386e-02   +5.083551202701719e-01   +3.903083845945049e-01   +1.245335103596475e-01; +4.596674149260693e-01   +5.336698526195176e-02   +1.949321258669291e-01   +6.374150270388342e-01   -1.749440997859459e-01   +4.780872139995574e-01   +5.822507040178609e-01   -1.106536641221653e-01; +2.308442225912468e-02   +1.112392548898110e-01   +2.060950792889305e-01   +2.074858456554763e-01   +1.325467509092523e-01   -1.646441421392727e-01   -2.357459999626370e-01   +4.314413118578303e-01; -1.904927719785697e-01   +5.279103276830047e-01   +6.880003106101787e-01   -2.053737959363104e-01   +1.937719374024947e-01   -7.342092977759047e-02   +2.091475515080159e-01   +2.292227582808968e-01; +6.369426885689414e-02   +2.297354764393063e-01   +4.980298369950105e-01   +1.205669628176274e-01   -1.057710488594960e-01   +3.456869941557254e-01   -2.387128885135871e-01   +1.222657187370685e-01; -7.733694349977242e-02   +2.891821830156697e-01   +8.512816151388018e-02   -2.946381397432886e-01   +7.002219041437020e-01   -1.680587338449511e-01   +3.992055805865027e-01   -1.973149765274003e-02; +1.462056543639240e-01   +7.182213284621596e-01   -4.202580055707050e-01   +4.726899451142248e-02   +2.372874128584922e-01   +2.644353850160894e-01   -3.253441462410310e-01   +1.146785825951989e-01; +5.883320444140264e-02   +1.598029700735017e-01   -6.486973429471579e-02   +2.971020368125651e-01   +3.497151347959376e-02   -1.845069637768558e-01   -1.453953757916112e-01   +1.643631007940873e-01; +1.102104480153648e-02   -1.078629475099969e-01   -3.003930815718093e-01   +5.887240572948046e-02   +2.754625203340085e-01   +4.121083095802490e-01   +4.922180815440952e-01   +3.665347153763553e-01];
L1E_L2E_iAMPA_netcon = [+2.936824001992177e-01   +3.737799794329148e-01   +1.803390397409610e-02   +3.461178124692806e-02   +4.222322161625617e-01   +2.163778319202656e-01   +1.937611316477251e-01   +3.153694265663976e-02   +4.448001694878849e-02   -1.181800403792973e-01   +2.499008558207318e-01   +1.237128900480177e-01   +1.793533033417646e-01   -5.212209455655639e-02   -2.948201519489846e-01   +1.246745072253006e-01; +2.468639891171536e-01   -2.483899450831377e-01   +5.663266426619143e-01   +1.650090934200024e-01   +2.102216976295160e-01   +2.919983491961399e-01   +5.120656766256144e-01   +1.288874854028564e-01   -2.302716181265332e-01   -2.300759435670297e-02   +2.580160748517623e-01   +5.561048671949522e-01   +5.872986194059100e-01   +1.553710456586814e-01   +5.057188181434593e-02   -2.070876982002712e-01; +6.415310098277709e-01   +1.616091712895831e-01   +1.549469580961780e-01   +1.091388173331227e-01   +6.035455720834854e-02   +4.116183581435950e-01   +1.282066703552368e-01   +2.993747187981350e-01   +1.187869989496956e-01   -3.283752293661395e-01   +1.688409106510261e-01   +6.436497655109994e-01   -1.891914203752374e-02   +4.493014505531370e-01   -5.713197854692856e-02   -2.644484100430121e-02; +1.308488912781481e-01   -2.651062415206832e-02   +1.127312458706101e-01   +8.465922333725003e-03   +1.059311055004508e-01   +5.592102779834450e-01   +1.000000000000000e+00   -2.220565789539639e-01   -1.658385153310077e-02   +4.312686375691819e-01   +4.020558190421622e-01   -3.268304024781243e-01   -1.763371996398602e-01   +7.349800304584714e-01   +1.545239406422624e-01   -2.938234245293088e-01; -2.748980967786515e-01   -3.767035968696389e-01   +4.035145116897422e-01   +7.795477967758602e-02   +2.975427379194855e-01   +1.885237453465082e-01   +3.412560834284475e-01   +4.149694391140686e-01   +2.987086809570403e-01   -3.768068965015267e-02   +7.249612998256716e-02   -3.085018629044255e-01   +4.723842581713624e-01   +1.319389728882757e-01   +3.243455009360622e-01   -2.177645974258828e-02; +8.915955139881604e-02   +5.129555197321620e-01   +3.109019927970156e-01   +5.752492165700339e-01   +2.351883828405621e-01   +7.798349848180050e-02   +7.172909657007805e-01   -1.114688514186548e-01   +3.468223194131670e-01   -9.136979293530756e-02   +5.727321092821021e-01   +4.182023373210342e-02   -2.594061374714545e-01   -2.529099525102906e-01   -1.509091327386482e-01   +4.240513064982576e-01; +1.688100840104437e-01   +3.025015540929036e-01   +2.443860503922280e-02   +3.874299464163019e-01   +3.444228277990718e-01   +3.231998748338900e-01   +3.520041889278238e-01   -1.717181814607762e-01   -3.101685675619711e-01   +2.158229690212576e-01   -4.935722659574675e-02   -1.771852315332131e-01   -2.304386808197683e-01   +4.593894408001006e-01   +6.293894844852913e-01   +1.955448263955082e-01; +3.929990037473263e-01   +3.056550209980031e-01   +3.993467194321870e-01   +4.416417428158490e-01   +2.620084390956355e-01   +5.069945155622211e-01   +5.700921556612250e-01   +1.924313539603357e-01   +4.455684014026091e-01   -1.128093489459873e-01   -2.656380623557405e-02   -7.527142170069767e-02   -5.818029866629149e-01   +2.397411487114401e-01   +2.919469133505677e-01   +1.687589245536077e-01];
L2I_L2E_iAMPA_netcon = [+3.030487243364870e-02   +7.127462122350665e-01   +4.643956168603057e-01   +5.617145700300877e-02   +3.560874502159374e-02   +5.124906730430862e-01   +1.342757217843184e-01   +5.274152350994319e-01; +5.866417669360653e-01   +3.560227335948631e-02   +7.928476808019482e-01   +5.503050847622658e-01   +2.568432483484166e-01   +1.584738529702904e-01   +9.110918025088947e-02   +5.260944796366299e-02; +1.667513661422267e-02   +3.390070448532906e-01   -7.511973435796607e-02   +8.147875252904996e-02   -8.603568651319948e-03   -7.102514033855978e-04   +2.633311303768231e-01   +6.299220973348493e-02; +2.533083529775772e-01   +5.605271865093133e-02   -2.731142727856596e-01   +3.885148688860250e-01   +5.000609081043796e-01   -2.503111822609375e-01   +4.503739080663396e-01   +2.330490746916257e-01; +3.620020089691844e-01   +2.802901929595196e-02   +7.437128797677181e-02   +4.775975908393123e-01   +6.819227308515091e-01   +3.279613307314867e-02   +4.914599218601706e-01   +1.317162824118727e-01; +4.094176563664609e-01   +3.360158997118124e-01   -3.447536233127467e-02   +7.419280442337510e-01   -1.593934759165033e-02   +2.297510598506431e-01   +3.515701159694651e-01   +1.039957854926903e-01; +3.848408236838671e-01   -3.980857812704936e-01   +4.771901543280274e-01   +6.339309611680088e-01   +1.055459532890676e-01   -2.110755716128933e-01   +7.116108824629042e-01   -1.622621975076181e-01; +3.181740650441763e-01   +6.347162932760050e-02   -3.637131419293932e-01   +1.253082728838450e-01   -1.035664677881647e-02   -9.469692138447036e-02   +3.867884748331830e-02   +5.649857956455573e-01];
L2E_L2I_iGABA_netcon = [+1.586852929748258e-01   +5.919894757808044e-01   +3.517993759854318e-01   -3.802481358445028e-01   -3.122156284864456e-01   -1.224680393762188e-01   -2.354790635957152e-01   +5.849592135832303e-01; +2.265169640068352e-01   +3.015716486490183e-01   +8.867803138827511e-02   +7.795602613612445e-01   +6.613126867568936e-01   +4.105032080516603e-02   -3.743182356842610e-01   +2.050393855402370e-01; +3.046471409298737e-01   +8.507357407644875e-01   -3.016687646804923e-01   -4.464815753323872e-01   +2.647956474788404e-01   +5.875073127346675e-01   +3.729799476351108e-01   +2.485962733414429e-01; +1.510930392859977e-01   +5.265227177204485e-01   -3.204931624429169e-02   +7.454198717196867e-01   +8.196879058838553e-01   -3.345007304836905e-01   -3.673277660529443e-01   -1.431560313870826e-01; -2.203165425513446e-01   -3.819009013147411e-01   -1.604322418934598e-01   +2.807423470737845e-01   +8.787754122637891e-01   +3.462595133134713e-01   -2.375422639646158e-02   +1.649259687796445e-01; +8.732749518208368e-01   +5.403924424481206e-01   +3.622878195846855e-01   +5.203735654889121e-01   +4.958026814816615e-01   -3.882464132408768e-01   +4.119536456365180e-01   -1.987637602387760e-01; +2.417093638189466e-01   +2.781360928227046e-01   -3.871036883523753e-01   -6.085528959632069e-02   +1.192097691089997e-01   -4.405131489724545e-01   +2.426872965109590e-02   +7.998093642765466e-01; -6.417538140354867e-03   +4.887280624226332e-01   +5.635911827258715e-01   -2.667170647386411e-02   +1.572296117738509e-01   +3.837497612259692e-01   +4.034457263126502e-01   +7.200703065329385e-01];
L3E_L2E_iAMPA_netcon = [+4.205062385376490e-01   -3.672519667169422e-01   -1.629709583014365e-02   +3.495312903478318e-01   +4.126527702222871e-01   +3.877769606699105e-01   -2.843567116094101e-02   +8.143223972270026e-01   +2.926371943277659e-01   +9.092680297914833e-02   +8.714854752671200e-02   -5.144800449449114e-01; +2.615131177284400e-01   +5.103750624541694e-01   +2.488468931981293e-01   +3.027241810619771e-02   +5.090247087299211e-02   -2.108413327241333e-01   -1.548351797090119e-01   +2.314497278477616e-01   +1.049861480290725e-01   +2.535186185437868e-01   -1.456043787075015e-01   +5.409263876523818e-01; -4.924853642571046e-01   -4.126781253969236e-01   +4.801114481454029e-01   +3.924861043652536e-01   +3.439906729146844e-01   +7.008385676737000e-02   +2.082834246915360e-01   +2.599158450139191e-01   +7.870393038492134e-01   -4.809822657545023e-01   +7.440246343896366e-01   +3.230994243993104e-01; +3.974706397056972e-01   +2.838510963299127e-01   +2.818718225641832e-01   -5.172520484722234e-03   +4.889009089483997e-01   +1.527494633303285e-01   +1.072285452513644e-01   +4.762851277545461e-01   +5.107728089583100e-02   -1.479686092073531e-01   -1.679438014731440e-01   +5.613796259052350e-01; +1.755030749370844e-01   +2.470785335204863e-01   +6.264515753627488e-02   +6.591763135765734e-01   +5.152167168601397e-01   +5.624750345794713e-01   +1.553626359037197e-01   +1.526616428312783e-01   -1.012163124309979e-01   +5.188605554007596e-01   +5.038335371402917e-01   +6.429265067638283e-01; +4.174837863152633e-01   -1.325176375280996e-01   +1.611853362559150e-01   -1.105313286565064e-02   +3.756348706446319e-01   +5.476254921598374e-01   -3.585128578175217e-01   -1.854921840418975e-01   +1.817829182399673e-01   +2.397787214080809e-01   -2.729962799807899e-02   -2.718226541850617e-01; +1.451081272507623e-01   +1.847435303880532e-01   +4.506896471824424e-01   -8.960545108215529e-02   +4.310343665461474e-01   +2.033657972283939e-01   +5.499152331584684e-03   +1.610960281550998e-01   +1.028453368391454e-01   +4.409693570501936e-01   -2.071760753769591e-01   +4.335087211373245e-01; -1.513832184116345e-01   +8.235255499704233e-01   +2.512545336487895e-01   -7.771121242387636e-01   +5.408504949532581e-01   -4.705544066769651e-02   -3.988102776853431e-01   -1.180654508449702e-01   +2.021412890704070e-01   +2.776461814331029e-01   -8.322576604827206e-02   +3.968237080986916e-02];
L3I_L2I_iGABA_netcon = [+8.135653218077298e-01   +7.153996169683539e-01   +8.768145069200156e-02   +3.144703110081366e-01   -5.507283190830906e-01   -1.700140425727443e-02   +1.000000000000000e+00   +6.156105555329394e-01   +6.618422184807917e-01   +1.138246716375745e-01   +1.996620203620041e-01   +9.735749776800304e-02; +2.110061830510644e-01   -5.860268124427313e-02   +1.873737237672599e-01   -4.930906104826877e-01   +4.477113063168655e-01   +1.244060287897971e-01   +2.243826022890601e-01   +9.670014172121537e-02   -3.562381122957802e-02   -3.555079315975533e-01   +2.552109181169208e-01   +2.550763151837490e-02; -8.119922971348774e-02   +2.736180471671654e-01   +1.883107071429898e-01   -1.764975639826384e-01   +1.204365207652318e-01   +2.971517469831068e-01   +4.013861694347768e-01   +2.881484334028169e-01   +1.426297131146350e-01   -2.498522614515732e-02   +1.343573483646723e-01   +8.249528349897454e-01; +5.595323532009440e-01   +2.424810216617959e-01   +8.378623141845979e-01   -4.609113461596140e-02   +1.723239949230434e-01   -1.861188405124099e-01   +2.680134525103987e-01   -1.343494024888325e-01   +3.350120169291380e-01   +5.928017505361847e-01   +5.756025283861282e-01   -6.488269818220987e-02; +4.968721754787124e-01   +3.409470332773737e-01   +6.639391969600340e-03   -3.226946504910776e-03   +6.347894707659391e-01   +5.241671174486671e-01   -1.682760837337937e-01   +8.095927481870476e-01   +5.966154618351763e-01   -6.979547392179176e-02   +3.383022549514933e-01   +9.947448146452877e-02; +9.821226676117879e-02   +3.757163387160731e-01   +7.171693745896791e-01   -8.383924103353935e-02   +4.043370112982593e-01   +2.401510524647454e-01   -4.364278542575561e-02   -1.695975577878838e-01   +5.854394979861454e-01   +3.737039899488713e-01   -3.757162388925255e-01   +1.611470598314353e-01; +5.947536529645526e-01   -2.135521129747947e-02   +5.701899834470213e-01   +5.497526341160412e-02   +6.464935004465980e-01   +6.814481756601295e-01   +4.035755460863901e-01   +2.852212117523730e-01   -5.658914478107330e-01   +7.269800858990223e-01   +4.297708836253621e-02   -3.430453274649530e-01; -4.453494163309593e-03   +2.092538533860032e-01   +5.109789946307456e-01   +3.224578562052427e-01   -3.155418859995519e-02   +3.517036412757438e-01   +7.240180320426695e-01   +7.098637612831432e-01   +4.574232925508728e-01   +2.924038200894800e-01   +1.781336358060578e-01   +2.800301154159318e-01];
L2E_L3E_iAMPA_netcon = [+4.690340708210545e-01   +3.577686906944265e-01   +7.429536105300969e-01   -5.814534945559497e-01   +1.527305223000307e-01   +4.754582174990917e-01   +6.478944163201369e-01   +6.827764277804400e-01; +2.744014076405716e-02   -6.401555631962193e-02   +1.321539159158984e-01   +4.018283538827553e-01   +5.739631707934846e-01   -3.636028910358782e-01   -3.098101516536964e-01   -6.339685764219550e-01; -4.403272455702126e-02   -1.280637546393457e-01   +1.686290183325324e-01   +2.538123973976202e-01   +4.555169389241402e-01   +8.517108890075722e-02   +2.022098584920139e-01   +7.676871178193194e-02; +1.686585212364390e-01   +1.755223532136929e-01   +7.934697574267662e-01   +7.839304242858494e-01   +1.982209065096638e-01   +7.492027441395527e-01   -2.010905666464814e-01   -4.158696763204851e-01; +1.258982169856603e-01   +2.149928007008759e-01   +6.613741482884125e-02   +4.529700242049768e-01   +2.488896421069157e-01   +1.912872426209452e-01   -8.024210740305374e-02   -2.598379406264848e-01; +1.654327201252764e-01   +5.314090043454166e-01   +4.345647281460273e-01   +6.821080086788942e-01   +1.588791622717563e-01   -9.440307705854964e-02   +1.042675620268725e-01   +1.190803891692897e-01; +2.989861326166044e-01   +8.010874328206347e-01   +5.750534809599263e-01   -3.621161044384427e-01   +1.209804950444120e-01   +9.783882446346462e-02   +1.877192870136560e-02   +9.799964704071794e-02; +3.889346091970660e-01   +3.842039897997755e-01   +1.468204855879161e-01   +2.413893646531061e-01   -2.539119654335274e-01   +7.247545773068760e-02   +1.326666512130119e-01   +6.467455395063668e-01; +2.503939378355565e-02   +5.013991977945484e-01   +5.712410468329526e-01   +4.265195063350238e-01   +1.468731038319553e-01   +7.104014754285737e-02   +6.142377557173857e-01   -1.706425069347423e-01; -1.549418045936481e-01   +1.318997351501186e-01   +4.041621949292855e-01   -2.682598537281744e-02   +5.174531013624886e-02   -4.089935258489110e-01   +4.191276383954874e-01   -1.565649952585964e-02; +4.363267020336437e-01   +3.440583686649210e-01   -2.043451453289168e-01   +1.000000000000000e+00   +1.613768394713202e-01   +5.712475109149699e-01   -2.444090141609633e-01   +2.967047687619646e-01; -1.336181554335572e-01   +6.559378333236364e-01   +3.149511417111727e-01   +3.814064720156428e-01   +3.415911273498090e-02   +5.895252550354210e-02   +6.326325338546027e-02   +1.542733410256101e-01];
L2I_L3I_iGABA_netcon = [-7.535881001282738e-03   +9.664221316178488e-02   +5.883766659270570e-02   +1.951669117614226e-01   +1.748716065593340e-01   +8.001636279336958e-01   +3.823602864218963e-01   +1.296227518879980e-03; -3.454610453565885e-01   +1.336768610301631e-01   -1.200159624926743e-01   +3.030409145681071e-02   +5.158429633492071e-03   -3.785105975176485e-01   +4.682778343111587e-01   +2.043947095205539e-01; +5.284748260149685e-01   +1.000000000000000e+00   +8.277586635668388e-02   +5.341196696704024e-01   +3.071650013663912e-02   +5.835463675357594e-01   -4.654016566449224e-03   +7.279373050938087e-02; -2.173376874602644e-01   +6.030879883609454e-02   +8.980785975200429e-01   -3.333539130027713e-01   +9.876271307580678e-02   +6.624360717529236e-01   +4.955992184153821e-01   +1.607081392963375e-01; +3.948900051143677e-01   +2.519370140652938e-01   +4.463834252453146e-01   +2.579719746395598e-01   +9.113023331572986e-02   +3.523343665780339e-01   +3.086043796790192e-01   +7.756367970023226e-03; +1.109658122314686e-01   +3.611480953394807e-01   +5.024363958272258e-01   -1.806933808104114e-02   +3.912863811312612e-01   +7.378193302834111e-01   -3.295268065116913e-01   +4.737186763300839e-02; +7.405191784553347e-02   +4.964619655475108e-01   +2.509163614775387e-01   +3.567166846424533e-01   +1.041971871694655e-01   +2.926367819517953e-01   +9.261631052284673e-01   +5.763383094231599e-01; -4.815451808275117e-01   +3.011343474371471e-01   +4.539382433582479e-01   -9.071534524649814e-02   +1.133961053570370e-01   +4.408144573221275e-01   +1.584500081324566e-01   +6.195786984164076e-01; -4.850551164660156e-01   +5.387968732037401e-01   +7.207437573576869e-01   -1.222492038690734e-01   +3.388893346588585e-01   +1.641093026008068e-01   +2.708577963191000e-01   +2.334244632897627e-01; +1.276631894157159e-02   -2.746987167060537e-02   +3.257145209739355e-02   -1.096652837192119e-01   +6.620349341488550e-02   +6.697144361483477e-01   +9.061886528875590e-02   +1.618930283533559e-01; +4.728025516750880e-01   +2.075204368902979e-01   -3.378345553551848e-01   +2.019122571800098e-01   +3.076162827934874e-02   -3.174393049370589e-01   +4.267510268579798e-01   +4.939184403925804e-01; -3.073996887324739e-01   +7.336012542415640e-01   -9.379519574821241e-02   +5.850637110909573e-01   +3.212630930469098e-01   +2.176102778302643e-01   +9.302323573476756e-02   -2.603787492889553e-01];
L3I_L3E_iAMPA_netcon = [+1.198232217001733e-01   -2.294801380892499e-01   +4.798183995453603e-01   +3.068782689071554e-01   -2.232600283274562e-01   +2.536583371885461e-02   +1.267411669043311e-01   +4.200083143446394e-01   +2.826902823700499e-01   +6.555617868734706e-01   +1.123600020255875e-01   +6.020175921630164e-01; +2.105907602822578e-01   +5.199422523115053e-02   +3.519088114302509e-01   +9.145131593925091e-01   +2.516907806266596e-01   -1.109158478388427e-01   +2.879426907865115e-01   +5.602267221190625e-01   +5.042153772790787e-01   +4.726257598517957e-01   -2.682355304396983e-01   -2.937570231832530e-01; +6.282767820542706e-02   +5.649049052209472e-01   +2.805492690965855e-01   -1.880278072066869e-01   +9.956924024042051e-01   +4.503971067220703e-01   +5.321160930455988e-01   -7.480074239686418e-02   +2.566341253368222e-01   +3.395382042712254e-01   -2.257231405295450e-02   +3.081536473433359e-01; +3.050981514209616e-01   +2.077109259975231e-01   +3.687239859871096e-01   -8.893481633708866e-02   -1.512837646254659e-01   +1.678490982577922e-01   +1.090815902262516e-01   +2.010600549863103e-01   +1.433529052667452e-01   +1.155090778106808e-01   -1.898667044009084e-01   +9.918554375110647e-02; +1.317754283115026e-01   +1.473956897371129e-01   +9.374194606350721e-01   +4.600534798045266e-01   -4.135335627708796e-02   +6.613037040376359e-02   -1.824512691799036e-01   +4.621506825940715e-01   +1.767401207015906e-01   +3.840101934805825e-01   +2.054347889921859e-01   +9.137264746683936e-03; +3.473892816493038e-01   -7.540978319704621e-02   +5.484599805049789e-02   +1.937711671698251e-01   +6.567599311095162e-02   -2.476610238553455e-01   +3.924383909386516e-01   +9.176243271576240e-02   +3.858255997331331e-01   +2.406631551644555e-01   +9.122177637186513e-02   +8.421659692311324e-01; +5.760378495760279e-02   +2.057737021755421e-03   -3.553723356026053e-01   -1.930495875392244e-01   +3.244384462539492e-01   -8.055864109321814e-02   +5.498215095898075e-01   +9.618172073234928e-02   +3.168144543635935e-01   -5.646774963498329e-02   +2.849389839034020e-01   +6.546652584269183e-02; -4.489041110058527e-02   +1.341004316720514e-01   -1.555116563454615e-01   -4.375659037602192e-02   +4.927460514082326e-01   +3.055971691012147e-01   -2.634133072338097e-01   +7.520791778160721e-02   -2.835440296123705e-01   -5.621473153203543e-01   -2.389318412512087e-01   +3.854812194820025e-01; -2.707133382259613e-01   +6.508695935431049e-01   +1.469042109270095e-02   +3.589834907342180e-01   +1.122011324666425e-01   +4.541051631759334e-01   +2.860522302912930e-01   +5.223625081237846e-01   -1.550781616538884e-02   -4.633184826570939e-02   +2.166604306066584e-01   +7.236122719227551e-01; +8.693783669647304e-01   -4.540945321697827e-01   +6.490877934849151e-01   +2.617585890111132e-01   -2.777092428924785e-02   -3.206836166944081e-01   +3.600744259564931e-01   +3.995197883138503e-01   -1.442075598856827e-01   -1.824103166599960e-01   +7.247322457713771e-01   -1.050707200846563e-01; -2.556009304342072e-01   +5.396562886989696e-01   +7.765870815196053e-01   +1.164232401211932e-01   +6.100900992024087e-02   -1.166930505856931e-02   +4.090914975599808e-01   +7.513935575897189e-02   +5.052431922007163e-01   +1.830915804388249e-01   -1.223319756013488e-01   +5.140973413290431e-01; +7.581289057724969e-02   +2.951364103845592e-01   +2.098932401924432e-01   +6.653256659720540e-01   -2.918675100331672e-01   -2.571995567648501e-01   -4.259523317358013e-01   +3.042883790863434e-01   +1.191389738234425e-01   -3.037585402593490e-02   +3.476251102229576e-01   -9.014452515743096e-02];
L3E_L3I_iGABA_netcon = [+1.460968927623977e-01   +1.739935718290085e-01   +2.686650057217716e-02   +1.533947954115558e-01   +1.777654010208486e-01   -5.281721417162242e-03   -1.735552866310568e-01   +1.401740528641942e-01   -2.008141379218326e-01   +6.156287129769066e-01   +1.848159766451700e-01   -1.651657014288595e-01; +1.326285300599555e-01   +3.663553838256141e-01   +4.095537958568620e-01   +1.263363314333467e-01   +4.693341280800232e-01   +1.169876404728032e-01   -1.699885200244486e-02   +1.006433943858050e-01   -6.215468762417701e-01   +1.805111403947454e-01   -6.338676870363278e-01   -2.254068361050868e-02; +7.655113069485293e-03   +1.075663714948734e-01   -3.608986579372948e-01   +1.600268939426387e-01   +1.042437043726131e-01   -8.241424143457354e-03   +4.865865184988305e-01   +6.612210578272573e-02   -2.261525653114944e-01   +2.224474626024421e-01   -1.302844411020100e-02   +1.381105552549144e-01; +7.065786231342870e-02   +1.667490866933966e-01   -5.200954306132188e-01   +5.022538429563551e-01   +8.355088763066038e-01   -7.427405037775069e-02   -1.166624361178916e-01   -2.001275949670152e-02   +7.475834447055413e-01   +5.068813451711186e-01   +6.827066994323350e-02   -1.629246943411319e-01; +3.001306592876117e-01   +1.757974326716938e-01   -6.141123027304278e-02   +2.277936095131705e-01   -1.512406737948127e-01   +4.499484280490353e-02   +7.649700389611977e-02   +5.259825339439028e-01   -3.406444685687250e-01   +4.307704566761575e-01   +3.303192178545348e-01   +1.088235499225137e-02; +1.638951908522996e-01   -3.853839110931589e-01   -7.334399725944729e-02   -1.752224572051281e-01   -2.745751368471626e-02   +2.232605909941659e-01   +2.094081719363342e-01   +2.039622424682143e-02   +4.302026349237401e-01   +2.532956928512722e-01   -2.157809288104588e-01   -1.186816743590958e-01; -9.635893079821467e-03   +3.760635480283195e-02   +2.192738737089631e-01   +7.051778311361865e-01   +5.179469770201024e-02   +2.586243170347136e-01   +2.680270702128261e-01   +5.356027503797121e-01   -2.293129221416411e-02   +3.501640314144344e-01   +4.580832556285745e-01   +3.223760010036569e-01; +1.963019739643377e-01   +1.737796183621887e-01   +3.285997668081003e-01   +2.097032900948342e-01   +1.277552304181258e-01   -3.137798760088119e-01   -2.438241511452684e-01   +5.036550277949526e-01   -6.710294392828375e-02   -9.206372165524301e-02   +2.513252158006374e-01   +3.414149117701366e-01; +3.717351286737174e-01   -7.601102623079617e-02   +4.042261991403219e-01   -4.871845829150205e-02   +4.070637264247542e-01   +8.668023433179829e-02   -5.631299545700313e-01   -1.708259252241895e-01   +4.655223534595727e-01   +5.044767844373691e-01   +6.403599294467073e-02   +5.020403457429256e-01; +1.738261138508176e-01   -1.060575190447272e-02   +2.967780152656266e-01   -1.271323940968376e-01   -6.281443554177689e-01   +7.039479706905954e-02   -4.782430725776000e-02   +1.501204291612343e-01   -1.847399703734812e-01   +1.594097252769727e-01   +2.184452856670210e-01   +1.593581790510358e-01; +1.562402343369051e-01   -1.410047496236864e-01   +2.571924296770827e-01   -1.963316195910584e-01   -1.787992444205243e-02   +1.419828161158921e-02   +2.891393017169514e-01   -1.538336383940736e-01   -7.542779816741965e-02   -5.671322566316882e-02   +1.845464136833778e-01   +1.633069173376937e-01; -5.882547346626743e-03   -2.109197946635179e-02   -2.755003127803451e-01   -1.282929714992711e-02   +1.000000000000000e+00   +3.130149262894573e-01   +5.019465020619225e-01   +3.085396894218441e-01   +1.108941293129460e-01   -3.152902705038128e-01   +2.933661152195314e-01   -3.606533512993177e-01];
L2E_Input1_iAMPA_netcon = [+9.184133561804302e-01   +9.836892285217244e-01   +5.659765420540926e-01   +7.205263479495172e-01   +7.882531718642857e-01   +2.474199254987255e-01   +7.447245618283456e-01   +7.076994789643580e-01];
L2I_Input2_iAMPA_netcon = [+5.392877411371805e-01   +5.355967906861162e-01   +7.672387215653661e-01   +4.240492592056790e-01   +1.175742656997326e-01   +1.000000000000000e+00   -7.516358520978204e-02   +2.405450226867490e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
