function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.148312077151130e-01   +9.499270672405812e-01   +7.037129407429228e-01   +1.599907230869426e-01   +9.249059789163476e-01   +2.148121651015718e-01   +7.446872299721133e-01   +3.064122486508769e-01   +5.336180448672907e-01   +8.339279790547017e-01   +9.734395895183826e-01   +9.713863121225258e-01   +7.005372138325298e-01   +3.685672442567197e-01   +2.980916515207755e-01   +3.829003545992642e-01; +3.492185487028874e-01   +1.143680620434795e-02   +1.422519292585833e-01   +1.739154415955112e-01   +7.663564864184190e-02   +8.119502910068641e-01   +7.963581870589924e-01   +7.563691710652211e-01   +7.919208094496357e-01   +1.857208567935302e-01   +4.734181755860299e-01   +6.624470914157444e-01   +3.712933464070296e-01   +2.782363298003211e-01   +6.868291600991309e-01   +9.583221811855697e-01; +2.030803865770844e-01   +4.756199865727866e-01   +8.147201395057731e-02   +7.110597301111452e-01   +3.108090220146433e-01   +3.830744705306383e-01   +6.621472941431460e-01   +9.555825133095389e-01   +4.551810610454410e-02   +9.241973186472220e-01   +8.708561367994617e-01   +2.049500306309846e-01   +5.469380409514799e-01   +7.344823967749256e-02   +7.787664477649455e-01   +8.136421370651106e-01; +2.273017787499688e-02   +4.900565900816357e-01   +4.343355158370444e-01   +8.381898215883640e-01   +6.347342175008246e-01   +8.656216504353409e-01   +4.398892657618741e-01   +7.820498419270834e-03   +4.635988310303816e-01   +4.240499490998210e-01   +9.449548442478215e-01   +8.990008700942188e-01   +5.125187302411240e-01   +1.531000423922156e-01   +7.208169442348528e-01   +8.941715127939470e-01; +7.641108130183899e-01   +5.188080473464889e-01   +9.018202298662212e-01   +8.220598637128027e-02   +9.105228495142013e-01   +3.204659419973683e-01   +5.806377747627121e-01   +4.014799599525657e-01   +9.415287390888981e-01   +2.964823124854855e-01   +2.371856324861329e-01   +4.853288648002592e-01   +7.680873342620740e-01   +3.665905381783425e-01   +2.773609342575271e-01   +7.234270262931392e-02; +5.714838697983170e-01   +2.849933100343431e-01   +7.282133899054042e-01   +8.401849542858327e-01   +7.962632110418093e-01   +3.798958604283359e-01   +5.184856525749000e-01   +1.550742431396274e-01   +4.733572739738260e-01   +3.505860179959072e-01   +9.237053358219142e-01   +6.652600093464660e-01   +7.694924036055972e-02   +7.157665453752600e-01   +1.723841507653296e-02   +9.053297173317691e-01; +5.794961991247117e-01   +5.625612075809520e-01   +6.820455323366207e-01   +5.463114895991791e-01   +6.435261345176032e-01   +6.412905061769772e-01   +7.245253260176596e-01   +8.246033185123337e-01   +7.789706632060769e-01   +9.746734916495782e-01   +6.316394752009508e-01   +5.283430189844026e-01   +2.560955768393267e-03   +5.353720895158784e-01   +1.680227928819017e-02   +6.690024680621378e-01; +3.864197318667409e-01   +5.101398181390666e-01   +2.042462023159267e-01   +9.680489179658930e-01   +4.441381845070110e-01   +3.888098836342079e-01   +2.212986368774816e-01   +2.878510650026228e-01   +1.104079716774638e-01   +5.362467435395788e-01   +2.875433712352360e-01   +7.065495276504251e-01   +4.071814882906687e-01   +2.306459652453948e-01   +9.355238929213254e-01   +3.469123400609755e-01; +5.532417836213830e-01   +6.721194510095930e-01   +5.288883913843651e-01   +6.754558481878483e-01   +7.481137737411422e-01   +7.442754596183002e-02   +1.000000000000000e+00   +9.774471508490941e-01   +5.190525283412106e-01   +7.921539833811311e-01   +8.499877586974912e-01   +7.214299878513961e-01   +6.600812175453897e-01   +4.741975720084122e-01   +9.361829474732229e-01   +8.403249064374166e-01; +1.884287444887820e-01   +6.157581337776423e-01   +8.286343925629881e-01   +3.343306622257243e-01   +8.290088259207751e-01   +1.993803622658307e-02   +6.229436369906071e-01   +6.255818150072472e-01   +6.383383261451396e-01   +7.992454235357280e-01   +1.629035179778291e-01   +2.964693867836131e-01   +3.728098330023813e-01   +7.186429930436978e-01   +3.761369710813232e-01   +1.930823860760879e-01; +1.187004779528881e-01   +5.636364947550628e-01   +1.774666356343586e-01   +2.168233363753916e-01   +3.451309425983463e-01   +8.768970167838129e-01   +9.854208168855262e-01   +7.474231334784127e-01   +5.801152460279806e-01   +1.408086883652582e-01   +8.288385041665298e-01   +1.139105792267770e-01   +3.976990061940499e-01   +5.196992747688340e-01   +1.058392985115395e-01   +8.429375893245777e-01; +5.801974617152787e-02   +5.041128507003233e-01   +5.156445446443008e-01   +5.734627371250428e-01   +1.443433489526702e-01   +1.555412463183230e-01   +4.973028743677951e-01   +8.809542876048748e-01   +8.399331035635949e-01   +4.523276992618539e-01   +2.158636980645844e-01   +3.276466131890676e-01   +1.335690876061995e-01   +5.169234550625914e-01   +7.263365292493398e-01   +4.256651507048856e-01; +9.378283774804569e-01   +6.632353338726220e-01   +3.566414374590519e-01   +1.465074419067730e-03   +5.020472200192820e-01   +9.207062932166225e-01   +5.232540719754083e-01   +3.308261652609929e-01   +1.147382661446701e-01   +4.555125117456548e-01   +2.659907247659993e-01   +4.616933934640592e-01   +3.396929608531343e-01   +3.888498879457775e-01   +4.557319891265195e-01   +5.595653659538270e-01; +7.465375368591578e-01   +6.396695262596527e-01   +6.526018049103024e-01   +5.914016112844891e-01   +4.135567627852537e-01   +5.634149994770253e-01   +8.549106095952616e-01   +9.601588260276492e-02   +5.147438488471762e-02   +9.599560590166294e-01   +9.103228234585678e-02   +7.151800711538534e-01   +1.213640506633945e-01   +4.835851991994555e-01   +1.562300107279432e-02   +4.481057492879273e-01; +2.396653571786932e-01   +1.428271670421368e-01   +2.813440583894659e-01   +8.981640075808481e-01   +1.773845247188345e-01   +9.240400523406286e-01   +2.500142318254504e-01   +4.479412128651194e-01   +5.236386759548411e-01   +5.208011483240784e-02   +9.165664407424425e-01   +4.026589241058600e-01   +3.711508893685779e-01   +7.458733219207372e-01   +1.225342457631068e-01   +7.593254552562232e-01; +2.021283759872401e-01   +1.769535020393396e-01   +4.322217552788504e-01   +2.584153961015365e-01   +4.929715588815713e-01   +5.974105700723391e-01   +5.781427318621427e-01   +2.367210169902995e-01   +7.018810210632599e-01   +3.659843922481738e-02   +7.279248031345109e-01   +2.413567050706465e-01   +2.506050729544919e-01   +7.055371448034561e-01   +6.587285852981574e-01   +9.454730765637162e-02];
L1E_L1I_iGABA_netcon = [+8.391895766769285e-01   +7.470783817614334e-01   +8.731770354517099e-01   +4.397542768582529e-01   +9.229249470175180e-01   +7.715815698434420e-01   +3.211561887470860e-01   +6.382667533815429e-01   +9.533991015487314e-02   +2.667274483605157e-02   +1.349371834379513e-01   +5.240993955403773e-01   +8.695664986516138e-01   +5.767460802872142e-01   +1.696404499704161e-01   +6.289814621828534e-01; +6.172041035349719e-01   +9.942631718974344e-01   +3.136226180165410e-01   +1.492157371994694e-01   +8.826154314731718e-01   +2.767104535916499e-01   +9.641087114156347e-01   +4.345462372953456e-01   +2.917171155525267e-01   +5.105009010243018e-01   +4.289233620532690e-01   +2.018573777956113e-01   +8.062799611524802e-01   +2.923104361805301e-01   +5.975997467121315e-02   +3.387101686552404e-01; +6.685364571978430e-01   +3.713115029928833e-01   +4.325540887308831e-01   +6.507638914297383e-01   +5.884950543793073e-01   +5.260060431299652e-01   +3.545238355923720e-01   +4.855094657111564e-01   +3.289967688841253e-01   +8.632933422275900e-01   +4.843742611885229e-01   +7.723688716244939e-01   +6.407814537773349e-01   +1.367519594667217e-01   +2.128874381440906e-01   +1.552795233312118e-01; +7.821565654552421e-01   +5.036036657107514e-01   +3.810207542838419e-01   +7.244950660805003e-01   +8.381418845491916e-01   +4.090234676492096e-01   +3.211548486051334e-01   +9.950094262877940e-02   +4.804550245280784e-01   +5.829532083032252e-01   +6.703216473179738e-01   +3.872283059764858e-01   +7.310514279526585e-01   +4.618902955332319e-02   +2.065147656341057e-01   +3.977733219370591e-01; +3.111792553368205e-01   +7.532824948969379e-01   +6.573059332665738e-01   +1.666536443392028e-01   +7.778426389108285e-01   +7.818552033842896e-01   +9.122913609368777e-01   +8.067127853484447e-01   +2.442073457073019e-01   +4.221024397363923e-01   +3.537939845090650e-01   +6.686074474052077e-02   +6.712632972113733e-01   +6.207119120023054e-01   +2.199082205487719e-01   +9.117718427137901e-01; +3.262370591661775e-01   +1.311736871678798e-01   +2.440465409437590e-01   +3.419556773194921e-01   +7.905943252694319e-01   +2.781841460285055e-02   +8.815409977248667e-01   +5.918770512793937e-02   +4.561250094051456e-01   +7.165246283261456e-01   +5.115498744654866e-02   +7.566312365550243e-01   +8.862520147653198e-01   +6.062318051549267e-01   +5.814377746857965e-01   +1.541385961665530e-01; +6.337188276519569e-01   +5.165384066032184e-01   +6.865353682908901e-01   +1.059422680352650e-01   +6.979483485947492e-01   +4.098850431389653e-01   +3.564038726663767e-01   +9.577608922408467e-01   +7.560750249830652e-01   +2.307992012002035e-01   +2.911201424250139e-01   +4.557816777972895e-01   +8.561578710760744e-01   +3.707649791225298e-01   +3.403349951835653e-02   +4.676316265978906e-01; +8.991028903277209e-01   +9.063888522231149e-01   +3.315852529396865e-01   +4.346951100293361e-02   +2.086435405170881e-02   +8.274870448312487e-01   +7.444334416786812e-01   +7.724049662596822e-01   +7.169149672400587e-01   +5.559606430007215e-02   +7.999947533092326e-01   +3.181008481967630e-01   +4.081575146095071e-01   +8.366674467998980e-01   +7.929254329231521e-01   +7.583842255736556e-02; +3.731030352855861e-01   +1.022158532147471e-01   +8.779982425286817e-01   +4.774135109953016e-01   +3.254295596753981e-01   +5.900708927398751e-01   +1.228463006849826e-01   +4.421478993522681e-01   +2.313663749606243e-01   +9.772411200433904e-01   +6.523282369660812e-01   +2.758056750370829e-01   +1.075294918901647e-01   +5.184340527653162e-01   +1.343143614008324e-01   +3.394056168391359e-01; +8.860133450963037e-01   +1.791645026606308e-01   +9.991892734822174e-01   +4.790976091915324e-01   +9.434173798261541e-01   +2.100030895838413e-01   +5.930987917161937e-01   +1.620398672815318e-01   +7.014030798136038e-01   +9.702378138303351e-01   +7.075215113484026e-01   +5.777109921650478e-01   +4.067952511889807e-01   +8.051364669231298e-01   +5.807639977404836e-01   +4.924390108843471e-01; +1.208394660334739e-01   +1.789425878901525e-01   +6.847937862914949e-01   +5.491131318166461e-01   +4.034728954154879e-01   +2.960961546744103e-01   +4.381229920135183e-01   +8.217277601708010e-02   +3.049851469219850e-01   +1.333273071283419e-01   +7.613661005567153e-01   +9.079921563959487e-01   +3.396909387297308e-01   +5.742567700064424e-01   +8.445983277157508e-02   +4.946901049867757e-01; +9.058240234443055e-02   +5.374084430772168e-01   +3.445216047340742e-01   +6.536750969814367e-01   +6.306545663629459e-01   +2.649064231399983e-01   +9.610857377338911e-01   +7.389181165809621e-01   +4.650122203788689e-01   -3.105278399491749e-03   +3.871883248846409e-01   +4.478327580512676e-01   +1.136624962021564e-01   +7.149395423394821e-01   +2.270632901092888e-01   +1.295521650125155e-01; +5.465856585339224e-01   +9.734409387824858e-01   +5.624337654178639e-01   +3.499585416010610e-01   +8.533513817328602e-01   +9.304688477622576e-01   +9.696994322143411e-01   +5.375491160471506e-01   +4.411079049195480e-01   +9.313091607131198e-01   +3.648022277242259e-01   +9.788413450308584e-01   +8.559642278609049e-01   +7.372128038412761e-01   +4.509191140284350e-01   +8.048726081935570e-02; +6.056267128684283e-01   +8.450556019658497e-01   +8.916378346636791e-01   +2.519816291062067e-01   +3.730896657944268e-01   +5.512990421353442e-01   +2.455054090885085e-01   +4.857555509553256e-01   +7.314292283675525e-01   +7.358146745290501e-01   +8.123194538550293e-01   +1.080755382439346e-01   +8.919373829684781e-01   +4.493226500407037e-01   +1.795171722271117e-01   +6.748238076004986e-01; +7.254317117542388e-01   +6.703308446785106e-01   +6.492163546689066e-01   +1.808766277163368e-01   +2.016755415427938e-01   +4.319373430353190e-01   +7.739214149876147e-01   +8.881702040746939e-01   +8.740629264163102e-01   +4.304880921818902e-01   +3.902056382984830e-01   +4.196687858091253e-01   +6.869439646271496e-01   +2.825616117728223e-01   +4.151255283784689e-01   +1.211240756293512e-01; +9.944290169298791e-01   +1.276033980663730e-02   +3.757511380838841e-01   +4.752189464392726e-01   +9.084563277048298e-01   +3.256243940208153e-01   +7.088564054335631e-01   +5.824537283357416e-01   +9.109181388153628e-01   +9.488637676338012e-01   +8.753587642585600e-01   +3.887090413262376e-01   +7.473075508175722e-01   +1.546635400537437e-01   +9.668626903782964e-01   +9.910339612610289e-01];
L2I_L1I_iGABA_netcon = [+5.737130037964405e-01   +5.646536167232746e-01   +1.063195717762313e-01   +4.556778564521790e-01   +7.967918758461582e-01   +9.767265515775420e-01   +2.228302693370577e-01   +7.619010471136463e-01; +5.611656569275678e-01   +9.511920315186339e-01   +1.232352081854207e-01   +5.672731813024675e-01   +5.431271135634852e-01   +4.245180342621000e-01   +6.629657380027221e-02   +5.018003989158697e-01; +6.127476572497236e-01   +1.161732018803568e-02   +4.346315838075632e-01   +8.175156267241450e-01   +2.606540347956693e-01   +3.920994001587093e-01   +8.323770515207293e-01   +8.267363158403115e-01; +4.692192549649230e-01   +1.256303174591249e-01   +9.312918396250575e-01   +3.567498548884808e-01   +7.834930501131282e-01   +4.601174748067967e-01   +4.346667229819557e-02   +9.207189683644835e-01; +4.360178426735964e-01   +8.555199659158519e-01   +1.376079709984368e-01   +2.474879400708655e-01   +7.770984808401090e-01   +1.234684489991606e-01   +9.101676531330316e-01   +7.099496818843348e-01; +6.513710253754600e-02   +2.182659299737377e-01   +8.244855832433103e-01   +7.659592288710457e-01   +1.455516802034068e-01   +4.589051537111970e-01   +4.525222823739737e-01   +8.022399783919111e-01; +6.410567198906336e-01   +7.056780248725280e-01   +9.299435143353449e-01   +3.582000199059473e-03   +8.243084321789632e-01   +2.637179634858121e-01   +2.829559013636974e-01   +9.590517973569631e-01; +4.243007444503038e-01   +7.764410638839707e-01   +5.738920599185329e-01   +2.732579551421232e-01   +6.219126262394180e-01   +1.002829585970514e-01   +7.606364162112749e-01   +9.497592453281560e-01; +7.518819473892275e-01   +4.235169100852921e-01   +4.996245471672319e-01   +3.095511711960203e-02   +4.557810452088535e-01   +6.598272609837130e-01   +9.244592571075070e-01   +2.972625339589075e-01; +3.084480538940427e-01   +7.313952002137440e-01   +9.327244425422755e-01   +6.685321096096050e-01   +4.824916847672746e-01   +9.439939350390992e-01   +1.388506982694951e-01   +3.519539678114591e-01; +5.985262975173764e-01   +4.573235248575070e-01   +8.613867132260747e-01   +9.714918964923893e-01   +2.190655044400720e-01   +7.615270162402400e-01   +9.496844867234610e-01   +5.439228921193409e-01; +3.321501636647051e-01   +8.066541266009069e-01   +2.547261503347582e-01   +9.450513787889143e-01   +8.574929343473330e-01   +3.935712919361931e-02   +3.084222864632493e-01   +2.110686345112870e-01; +6.445626848635291e-01   +4.327465104940431e-01   +4.596319577557420e-01   +4.805014680831219e-02   +8.784405630267814e-01   +2.642876684071667e-01   +2.105608742545178e-01   +8.140578894536281e-02; +3.133882040790454e-03   +1.484104629768143e-01   +7.379609431174529e-01   +2.915473455311251e-01   +8.429790003827382e-01   +6.411480132994724e-01   +4.625828083568569e-01   +5.100078097312073e-01; +1.446900400965055e-01   +8.055618773904435e-01   +7.528878614062838e-01   +4.846946186200971e-01   +4.388305220837315e-01   +9.357026349523037e-02   +5.937867944076517e-01   +1.965115806943672e-01; +2.500728654306673e-01   +3.787610823157914e-01   +2.372557796191208e-01   +8.869230533687187e-01   +5.441540769088520e-01   +7.643830573022238e-02   +5.505984128779491e-01   +1.451884585473041e-01];
L1I_L2I_iGABA_netcon = [+7.037946939731339e-01   +8.662428235865856e-01   +6.138387688050791e-01   +5.259203310743669e-02   +1.431863824974181e-01   +2.348098898849581e-01   +8.422239378133167e-01   +3.707279794740158e-01   +7.092134462709464e-01   +3.843189575776768e-01   +2.425804380282612e-01   +6.667774451457532e-01   +1.634995524846351e-01   +5.740483020751967e-01   +4.067933273432748e-02   +4.536444097419513e-02; +6.010286828239952e-01   +8.004469317783632e-01   +6.118433613698431e-01   +5.810586002013528e-02   +7.456862776334902e-01   +5.554435126872149e-01   +1.975746783464742e-01   +5.601662974339110e-01   +1.868086020915049e-01   +7.239993430721721e-01   +5.078270869799902e-01   +3.361231013364966e-01   +1.095357482900703e-01   +8.083629503189893e-01   +4.365735513421545e-01   +9.214983616516080e-01; +1.658455115637703e-01   +6.232050837073446e-01   +3.101933587908345e-01   +5.964446189388130e-01   +9.533582050929078e-01   +1.138639342189735e-01   +6.174653405253985e-01   +8.302859317444503e-01   +2.308180254035582e-01   +6.376862414970483e-01   +7.321935516091231e-01   +5.475270248693646e-01   +7.386628420054309e-01   +6.742316880407978e-01   +9.228186944043990e-01   +1.754344094879559e-01; +4.822868960448619e-01   +4.758014021654553e-01   +1.364872123789070e-01   +6.609662384303152e-01   +2.625266165953973e-01   +8.196834537372759e-01   +1.572381376087301e-01   +7.120566180869304e-01   +1.000000000000000e+00   +1.024225345815957e-01   +7.769424481398604e-01   +5.358340832780658e-01   +2.160406216118201e-01   +4.399966821669382e-01   +8.816113904900137e-01   +7.451873508512050e-01; +2.901990147395779e-01   +2.205488204641229e-02   +5.998436084600407e-01   +4.822804621318650e-01   +9.101364064829605e-02   +6.561780636324454e-01   +5.818897203098590e-01   +1.162096425999547e-01   +9.042826708616117e-01   +4.906514319659560e-01   +6.801242371878209e-01   +9.006602114212074e-01   +4.844450006612731e-01   +8.915605374982174e-01   +9.492959071882193e-02   +4.726913452716431e-01; +4.009647279095599e-01   +1.202820474181221e-01   +8.923680664412298e-01   +9.799219932292923e-01   +2.326477963310974e-01   +2.351751188057526e-01   +5.415096167410329e-01   +7.390026022122422e-01   +1.222449019727292e-02   +5.591945361937732e-01   +8.164381231627598e-01   +2.827846888524291e-01   +5.213749803433715e-02   +7.862911179229550e-01   +6.766924742927127e-01   +2.497170273360569e-01; +4.947256536200078e-01   +7.175323230858646e-01   +5.618903694522781e-01   +8.654494665425312e-01   +8.931621143262871e-01   +3.043340350918414e-01   +6.849237878893480e-01   +9.235758510602124e-01   +8.300456368134421e-01   +5.425189109403850e-02   +4.171396054525386e-01   +1.398392611224854e-01   +5.763967035516699e-01   +5.842443155984759e-01   +1.186937993766004e-02   +6.690126315050510e-01; +8.615009058418214e-01   +6.734387179140017e-01   +6.349603958712404e-01   +9.530685710598531e-01   +1.973143664823399e-01   +3.292016323435900e-01   +6.975035216812855e-01   +9.199466189103108e-01   +2.502663455193431e-01   +8.561899206293820e-02   +4.965982355272038e-01   +9.570590720246589e-01   +4.963214577829215e-01   +6.211030958164331e-01   +1.223308424860419e-01   +6.108900823092811e-01];
L2E_L1E_iAMPA_netcon = [+3.705385256670303e-01   +5.603920353278919e-01   +2.044684925262219e-01   +5.150172745617768e-01   +2.890115543250058e-01   +7.171652032065060e-02   +2.801905284477937e-01   +2.641372113370597e-01; +4.345575774301316e-01   +1.882529306376763e-01   +1.346308468404410e-01   +6.854023760605804e-01   +6.218485521694685e-01   +5.906252617892617e-01   +9.296284882721285e-01   +8.998038309770411e-01; +7.164413217645168e-01   +6.099674400007206e-01   +8.499079456604307e-02   +2.041346565976498e-01   +8.698466575686485e-01   +8.072009454622588e-02   +7.626601802346655e-01   +1.563772035414175e-01; +1.946444959948711e-01   +7.384638285521490e-01   +9.426887258702141e-02   +9.721921260335589e-01   +8.160458643118274e-01   +3.973838409495787e-01   +2.650649736636079e-01   +5.547667398015053e-01; +4.423825179792266e-02   +8.334602006030510e-01   +5.493288199684029e-01   +3.529590677613525e-01   +2.088716610011686e-01   +5.587794318973472e-02   +2.432571025515485e-01   +4.216707028054670e-01; +3.169719889214132e-01   +2.766041980204816e-01   +7.302258173038664e-01   +1.836226679184911e-01   +7.508238692786454e-01   +1.251026066346352e-01   +1.624577395760106e-01   +5.470217268803160e-01; +7.894063870377356e-01   +6.117463223163191e-01   +5.438229461158115e-01   +2.428400879960780e-01   +1.999594161079302e-01   +2.451741044626159e-01   +2.907205121013470e-01   +7.503591980801080e-01; +4.652972199189016e-02   +5.476054299912235e-01   +5.037795172959538e-02   +2.571580071120177e-01   +5.775301022887144e-01   +9.469338103690130e-01   +5.628525833817396e-01   +1.102294128723994e-02; +2.152710681537502e-01   +2.778540983398375e-01   +6.341187310767717e-01   +2.223428984401901e-01   +8.739915965702991e-01   +2.038475981435723e-01   +3.987741724748861e-01   -2.077718247971956e-03; +2.693472261737468e-01   +3.382639467921313e-01   +9.912748406346437e-01   +3.583973464982090e-02   +7.161524270298818e-01   +3.284759302398937e-01   +9.887179440587567e-01   +2.261727311798000e-02; +7.907900606593433e-01   +5.698126529853778e-01   +9.126469575515488e-01   +3.559874472267747e-01   +7.019519560051589e-01   +8.639037124916531e-01   +5.448492432620938e-01   +3.554083105706477e-01; +9.867743940839456e-01   +7.403112642101610e-01   +7.707269927554260e-01   +8.991716039094381e-01   +4.640939857903366e-01   +9.216584192471796e-01   +9.306035812114848e-01   +4.299203375824885e-01; +9.671959816658574e-02   +7.664371760989228e-01   +1.917704471366299e-01   +1.400510458527624e-01   +5.035111324743259e-01   +1.909250686728647e-02   +9.903304195094655e-01   +5.471279414212917e-01; +1.974828882256878e-01   +4.015796289607529e-01   +3.239768518216424e-02   +9.556037968355031e-01   +7.999722523786905e-01   +3.625294992773836e-01   +8.335065145449547e-01   +4.865333276047109e-01; +1.174136233974593e-01   +1.504065061354082e-01   +3.773206074958085e-01   +9.061794407086740e-01   +9.353240027921972e-01   +5.294810345097243e-01   +1.804831005408175e-01   +9.184676449873772e-01; +6.420156415916151e-01   +2.039848797316657e-01   +5.754745810911397e-01   +4.103511700644532e-01   +7.876625597943575e-01   +4.046099568839903e-01   +3.080797180607222e-01   +4.186915816311366e-01];
L1E_L2E_iAMPA_netcon = [+5.000239725488046e-01   +4.502207711921651e-01   +6.148650905428986e-01   +4.909010549510013e-01   +2.312770963639043e-01   +7.157253067932916e-01   +6.911012537211615e-01   +6.335842650980096e-01   +5.210326507289276e-01   +2.418212968928736e-01   +8.759788814835209e-01   +1.758161457495034e-01   +1.365094498433363e-01   +2.457414417089138e-01   +1.850542799040203e-01   +2.394168751413085e-02; +8.346986401311333e-01   +3.663630428418235e-01   +1.040479486185515e-01   +6.614359933409438e-01   +8.376171028740501e-01   +3.845163227338526e-01   +9.759896364185977e-01   +6.234279190210170e-01   +6.724074150294865e-01   +7.284024442783507e-01   +6.602385032811352e-01   +3.025632851217517e-01   +2.862981504364404e-01   +7.485985417842763e-01   +1.497191428933370e-01   +2.460788966466139e-01; +1.853466487771289e-01   +3.010586209603919e-01   +7.565855805508576e-01   +1.782931145916309e-01   +7.349126565566678e-01   +3.814766657073801e-01   +7.535682202840789e-01   +4.062952777902228e-01   +7.727565960746712e-01   +1.326570517160831e-01   +5.398706844731000e-01   +1.078219526613335e-01   +3.160872919774363e-03   +9.323653543517396e-01   +1.357079556689562e-01   +9.891115994011050e-01; +3.397999219062578e-01   +2.357851217617390e-01   +5.397331087023239e-01   +4.784682879186158e-01   +4.890654829559615e-01   +7.130959577671636e-01   +5.523401296684510e-01   +4.266601914657018e-01   +4.639192286792783e-01   +4.287802013687158e-02   +2.537857709379008e-01   +4.472849547726089e-01   +3.068335613265706e-01   +2.797707246722678e-02   +1.653507680746819e-01   +6.338716693551950e-01; +6.944613374781067e-01   +1.381112023233319e-01   +4.422858611855840e-01   +5.006705722402447e-01   +8.491468074148247e-01   +8.346474209654150e-01   +2.571888438151200e-02   +5.076285494815177e-01   +9.056128134607493e-01   +6.505529536443937e-01   +1.066002126342703e-01   +5.878947125915904e-01   +9.044724666189683e-01   +4.353491619628040e-01   +9.188188452781425e-01   +3.589262727219394e-01; +6.990134033540196e-01   +1.031378539738477e-01   +7.421546257297754e-01   +6.052103410415592e-01   +7.177623952989785e-01   +6.696230037969753e-01   +1.932377741723364e-01   +2.608457692198569e-01   +2.571599018343856e-02   +2.007317410428163e-01   +9.721820472103042e-01   +2.235108877652995e-01   +2.940794086189256e-01   +8.313302989616560e-01   +2.635446206425598e-01   +9.508071493901828e-02; +3.673639958997903e-01   +2.326654685362717e-01   +3.872024885299848e-01   +2.461671900739359e-01   +5.224282503995668e-01   +6.487474082298459e-01   +9.383380287721665e-01   +4.218429874474103e-01   +4.827165162947849e-01   +9.753556592405610e-01   +5.940168740263188e-01   +1.098171273534487e-01   +8.270486439997295e-01   +9.953590115860674e-01   +2.097640614672903e-01   +4.089899042332234e-01; +3.245330705482451e-02   +3.443594785621422e-01   +5.297124792370245e-01   +5.166434784945094e-01   +9.381158287433938e-01   +5.612027455402174e-01   +3.958823643122968e-01   +5.226816013579736e-01   +2.750495617544149e-01   +8.205708142129473e-01   +8.199623975621793e-01   +5.601044561710882e-01   +7.444969987390540e-01   +9.184471476512012e-01   +6.170347639076684e-01   +9.305984731971262e-01];
L2I_L2E_iAMPA_netcon = [+6.737416333243278e-01   +6.109523514453297e-01   +4.194870503411947e-02   +7.977575406297063e-01   +5.204774080671384e-01   +8.227364777170975e-01   +6.478516538993276e-01   +3.860840249135735e-01; +2.499896227193218e-02   +9.430283389268692e-01   +5.488552345802544e-02   +9.346606121819083e-01   +6.244797679688292e-02   +1.132965581124830e-01   +3.931286653684993e-02   +1.703728259396195e-01; +7.409280767416251e-01   +9.629951630064709e-01   +4.037857896748101e-01   +9.387582397952302e-01   +2.855199947356963e-01   +2.080986253999334e-02   +5.637992571314749e-01   +4.465090250989550e-01; +2.146043129679933e-01   +3.709000475652713e-01   +9.842601161253117e-01   +1.438873385889770e-01   +7.122385965859366e-01   +6.989857629431150e-03   +3.058968041204648e-01   +8.741935494282119e-01; +8.580212214339460e-01   +8.002038857916145e-01   +7.110285028843718e-01   +3.235845437342244e-01   +8.846128371530767e-01   +3.342966835860388e-01   +2.622922714812682e-01   +4.078249768340518e-01; +1.574858715225372e-01   +7.292444495626645e-01   +9.857234547460181e-01   +4.323488407251480e-01   +3.650106238895127e-01   +6.690119594902363e-01   +7.195210113705768e-01   +1.640341040805978e-01; +6.722051715072391e-01   +9.544346644435245e-01   +6.476815956800640e-01   +7.070525401080310e-01   +5.634575912368988e-01   +5.960413291083626e-01   +3.077586630335024e-01   +6.625075901878918e-01; +9.342460926648278e-01   +1.258937676906319e-02   +5.040003704072884e-01   +6.182293034901539e-01   +8.816603643543357e-01   +7.965677967890895e-02   +9.005664860111922e-01   +9.301580472796441e-01];
L2E_L2I_iGABA_netcon = [+6.200585081460677e-02   +5.226058394036822e-01   +3.505118945432874e-01   +2.576619284286891e-01   +4.315135579504482e-02   +8.950012571196626e-01   +3.420426719690879e-01   +4.529851083058415e-01; +3.541220894542184e-01   +6.577576378622829e-02   +5.588657041729127e-01   +9.826315523749267e-01   +3.613135577808125e-01   +5.432092270243140e-01   +9.326277814268357e-01   +6.769066549904650e-01; +9.318071482347832e-01   +1.810228512058122e-01   +6.902443528726674e-01   +3.489601194318869e-01   +3.825885706227530e-02   +7.161996354549277e-01   +9.138920698133963e-01   +7.713349387179058e-01; +2.398498007909484e-01   +3.119391597296027e-01   +9.179182277145362e-04   +3.986603121644941e-01   +4.853586872109464e-01   +7.147345888583525e-01   +7.255406914148457e-01   +9.271392747972209e-01; +1.063694119098332e-01   +2.467157939849445e-01   +4.472803601268250e-02   +7.516237967192779e-01   +7.280156437984755e-01   +1.716135214509363e-01   +4.425622537280948e-01   +6.557876646150632e-01; +7.144502105545352e-01   +3.239967843201529e-01   +3.031647912831710e-01   +1.063114617664185e-01   +1.422678095330930e-02   +3.529977869711377e-01   +1.539379179942117e-01   +5.003699759449147e-01; +7.379335178918779e-03   +8.774172334206553e-01   +8.722279851368747e-01   +5.937507357397693e-01   +5.134614395299759e-01   +3.819097426039135e-01   +8.297587624270900e-01   +3.431223185521481e-01; +1.778841532077120e-01   +3.042095952679273e-01   +6.265613384124622e-01   +1.220758423254754e-01   +2.411759278034876e-01   +7.571956971851311e-01   +2.535038432209600e-01   +9.478727205297149e-01];
L3E_L2E_iAMPA_netcon = [+7.684780015865737e-02   +1.559984980720247e-02   +3.673588645224887e-01   +4.946091889919668e-01   +1.931896637890136e-02   +9.595186677406189e-01   +3.605332766657349e-01   +1.870029751875199e-02   +2.041214182606932e-01   +6.646012484217054e-02   +2.454281633231348e-01   +9.991189404024724e-01; +9.540815084481270e-01   +9.764012101108210e-01   +1.158151516369686e-01   +6.511990530172790e-02   +8.087918405910748e-01   +3.873576735943344e-01   +2.286918633213531e-01   +1.246056420506463e-01   +3.584541288907115e-01   +7.423718159030874e-01   +5.347805901474124e-01   +3.447389078858058e-01; +6.651758254822583e-01   +7.201206372318232e-01   +5.131257272137466e-01   +8.655552120760457e-01   +7.934252263772074e-01   +6.639378229511816e-01   +7.278290548346974e-01   +6.657765302941702e-01   +8.899307433718322e-01   +9.914382777074940e-01   +3.316339144708260e-01   +8.247122230961277e-01; +1.667412658433663e-01   +8.717177260366223e-01   +7.816052601238899e-03   +9.983712757597016e-01   +4.219208131986477e-01   +5.851260100283835e-01   +7.706225628082832e-01   +5.083678563746769e-01   +8.174750412531833e-01   +7.676540610623594e-01   +6.727111701461997e-01   +1.105466717243878e-01; +1.964945725216689e-01   +8.200303767609217e-01   +8.708952216556225e-01   +1.223657988415745e-01   +6.298827910819761e-01   +5.410187530759644e-02   +3.412748051059573e-01   +7.533846767750932e-02   +3.195294689325610e-01   +8.855165454385756e-01   +8.769362625826539e-01   +7.782402326722361e-01; +9.943620166717502e-01   +3.491595578107824e-02   +9.083399717290318e-01   +1.033623613441245e-01   +5.691884898527962e-01   +7.344282209784206e-02   +5.728965444717443e-01   +5.384013337666066e-01   +5.992334429654794e-01   +4.058071175783951e-02   +9.839392324376759e-01   +1.511827651976476e-01; +9.271486579585632e-01   +9.512468713359647e-02   +1.077508189719531e-01   +1.491341731007251e-01   +9.025030034215218e-01   +2.318180273326143e-01   +6.411064004851074e-01   +6.815652145035069e-01   +6.971744540007846e-01   +7.951293253968837e-01   +1.421514857518417e-01   +7.330569263950983e-01; +9.803828690598481e-01   +9.029315427009850e-02   +4.437457238996866e-02   +1.246480927634738e-01   +7.476515542636042e-01   +4.166639295921216e-01   +3.698567654427850e-01   +5.893134765068183e-01   +1.776818017421886e-01   +7.101972430435715e-01   +8.773526634671591e-01   +1.144032567183600e-01];
L3I_L2I_iGABA_netcon = [+7.691530104242106e-01   +5.342170072046915e-01   +5.951973943446568e-01   +3.069043210755970e-01   +9.681739948340160e-01   +1.139878722896699e-01   +2.969504280580412e-01   +7.969510965280501e-01   +9.185662217925424e-01   +9.950916167830830e-01   +3.133180105233366e-01   +9.923993564581556e-01; +6.375951792526605e-01   +4.500248822306335e-01   +5.624041285089869e-01   +7.577151674279154e-01   +5.497814216502583e-01   +6.489708744886637e-02   +1.673654491934994e-01   +4.809044021527067e-02   +3.876227955070244e-01   +2.925611748205698e-01   +4.454179094329980e-01   +9.185870037700380e-01; +7.986219530484682e-01   +1.148547843187956e-01   +7.190416809922194e-02   +6.510545130551494e-01   +9.810490477032477e-01   +4.734550414036352e-02   +7.250654086364204e-01   +1.792694854959641e-01   +7.464509406950551e-01   +5.217388754508017e-01   +2.064032249899449e-01   +6.868140799199351e-01; +9.634990881241287e-01   +7.177629820598708e-01   +7.685743725046804e-01   +3.310116708793510e-01   +1.284177247856060e-01   +1.328590369670273e-01   +3.009128503241881e-01   +2.452739655323468e-01   +8.778572468064630e-01   +3.566724724376507e-01   +9.427612116877827e-01   +2.200256269317274e-01; +7.105824340399008e-01   +1.815112855455956e-01   +8.656267379956676e-01   +9.755450742397890e-01   +1.660457959174245e-01   +4.909741069719848e-01   +6.762206172331522e-01   +2.605348864397815e-01   +3.928096069739999e-01   +5.213429908605562e-01   +2.891014762475176e-01   +3.135101156791384e-01; +6.429717436079454e-01   +3.228983045941635e-01   +7.032263236733800e-01   +5.334675897389095e-01   +3.353523909705901e-01   +4.679043108751231e-01   +7.452996244007595e-01   +6.537159352922263e-01   +1.693508296020313e-01   +4.972317390040715e-01   +1.212657245534024e-01   +2.303812248448796e-01; +5.132170616217963e-01   +9.673881301839925e-01   +1.078514641821846e-01   +7.489613864888510e-01   +5.356701189942725e-01   +1.550770842086053e-01   +7.467267987229151e-01   +9.893326462480311e-02   +4.369672563178296e-01   +1.849398342788545e-01   +6.970692895333813e-02   +7.097937788816515e-01; +9.481106071622498e-01   +7.019529580035582e-01   +6.625454485744042e-01   +2.675063253699356e-01   +6.950122433505513e-01   +1.362862255595170e-01   +7.815133729163778e-01   +4.710449634030793e-01   +8.549649542022599e-01   +4.815091294947608e-01   +7.256639039002341e-01   +3.722829532184458e-01];
L2E_L3E_iAMPA_netcon = [+6.577711697720354e-01   +3.870723940051778e-01   +2.371942988819851e-01   +4.634934591549603e-01   +9.060821590921582e-01   +9.552662030352851e-01   +7.679428126243963e-01   +3.560752683584212e-01; +3.785181843781065e-01   +2.350385005973993e-02   +9.096499531592027e-01   +2.908770033036039e-01   +6.816101266475926e-01   +2.211437647091774e-02   +8.997609130237254e-01   +6.629257565242863e-01; +3.061428051019733e-01   +3.320305676335997e-01   +4.874026333201739e-01   +2.786175591320351e-01   +8.445642650148775e-01   +5.008102778135390e-01   +7.913227528248277e-01   +5.902132547722291e-01; +1.529316198457555e-01   +4.870094782558734e-01   +5.935950608103998e-01   +1.430774335582702e-01   +9.850000382074794e-02   +3.365049286733738e-01   +9.534300013692861e-01   +5.312246157550230e-02; +7.756236541735859e-01   +2.648945522777058e-01   +9.544628718536267e-01   +1.430787171070310e-01   +7.379195491560091e-01   +6.701693660516365e-01   +5.356841904348731e-01   +2.136261429278442e-01; +7.083264518231032e-01   +5.271697688282251e-01   +7.944512651921749e-02   +2.636222375247295e-01   +5.476636449861281e-01   +1.660483278294191e-01   +1.618040488553793e-01   +6.039521103770126e-01; +1.729599225572783e-01   +4.131432590978334e-01   +2.233898184192016e-01   +6.095804549464720e-01   +2.558576250393421e-01   +2.231968346152976e-01   +1.363605422854214e-01   +2.711301772179039e-01; +4.492574898923638e-01   -8.127120526380073e-04   +1.570905218203706e-01   +1.030744754254491e-01   +7.136487781539332e-01   +1.165342422755860e-01   +2.682027626664554e-02   +1.112580214133125e-01; +8.406308461493888e-01   +8.894132292070913e-01   +3.941392776200689e-01   +4.894557471936523e-01   +3.602401810753053e-01   +9.896099136488027e-01   +6.871666894690978e-01   +2.153702260857447e-01; +7.015550950417534e-01   +2.383674738933762e-01   +1.871166635891988e-01   +8.957819604278452e-01   +8.467618568448353e-01   +1.398216459896626e-01   +5.875752549580114e-01   +8.784204907895424e-01; +7.644334049819387e-01   +7.975777816300819e-01   +7.659564901496435e-01   +1.904789515178854e-01   +8.180177352510234e-01   +7.669327419395475e-01   +2.944716743529799e-01   +4.617342410366375e-01; +9.781204408069558e-01   +5.795516133845936e-01   +2.302677885690781e-01   +5.272724067756375e-02   +6.132970821254206e-01   +6.271203331592328e-01   +7.381321243446537e-02   +7.325010617515045e-01];
L2I_L3I_iGABA_netcon = [+5.915562523992208e-01   +1.439303992955062e-01   +3.446947142040738e-01   +3.700185259779200e-01   +5.979717672243636e-01   +5.069585888031997e-01   +7.712303610467344e-01   +2.678135932144638e-01; +8.398112465350075e-01   +9.913250824866379e-01   +4.413722387687408e-02   +5.378916038760572e-01   +4.751580103665563e-01   +2.404016223810793e-01   +1.773797635855388e-01   +5.917234060150859e-01; +6.045404269465540e-01   +4.837400897815547e-01   +9.454211533855456e-01   +9.723416555868070e-01   +3.821313784340643e-01   +2.718741204734644e-01   +4.531866789185451e-01   +6.824389476468026e-01; +7.461370353947767e-01   +4.056234261450860e-02   +8.651004622070455e-01   +9.949923030421948e-01   +9.816295546088565e-01   +4.088555978808929e-01   +3.016387128271337e-01   +4.158037475639693e-01; +8.482194391222858e-01   +2.686146712215218e-01   +1.352479661571561e-01   +4.144971447258241e-01   +1.383816588668405e-01   +2.613920396707439e-01   +3.841403174760531e-01   +5.101932648215715e-01; +1.461146547680222e-01   +6.719021964473748e-01   +5.908346508805357e-01   +4.481848863886643e-01   +2.712983592202066e-01   +8.538776950888174e-01   +7.993487603247691e-01   +8.154428027946610e-01; +7.435249515691523e-01   +1.462287227360771e-01   +6.912322782079962e-02   +2.484741365241371e-01   +2.246444371578504e-01   +4.819451523835698e-01   +7.820254407737275e-01   +5.392813165177335e-01; +1.566926175225938e-02   +7.715692495616768e-01   +9.499000369151164e-01   +5.971355414344123e-01   +7.955958970481460e-01   +3.404235342252859e-01   +6.460705565815439e-01   +5.888094147280765e-01; +2.243641212345945e-01   +2.686095216130185e-01   +4.967856370457591e-01   +7.468413780720368e-02   +8.202572468309457e-01   +6.375061473259417e-01   +2.455242301676296e-01   +5.362686654994926e-01; +5.338047190832924e-01   +8.813328361075055e-01   +2.591843304211672e-02   +9.079980904472037e-01   +7.955707632567693e-01   +4.125631504941396e-01   +6.071451931084243e-01   +5.394403537879816e-01; +7.180852027914804e-01   +3.663194601130281e-01   +5.299414479633662e-02   +4.800120106499029e-01   +1.128784156475760e-01   +5.475817530907533e-01   +4.183306935561946e-01   +1.519236427961849e-01; +4.318135495936566e-01   +9.710998223190454e-03   +2.998763643918443e-01   +5.054743728794614e-01   +6.342236389610515e-01   +3.382321324435059e-01   +2.954529408132988e-01   +6.994750782015021e-01];
L3I_L3E_iAMPA_netcon = [+6.045180328908901e-02   +7.725812280951543e-01   +5.531154961596192e-01   +5.726133810943339e-01   +9.156314835680545e-01   +8.338095539747262e-01   +8.468492313615286e-01   +8.600977641795373e-01   +5.316935839736434e-01   +9.909640112045067e-01   +4.816806239780476e-01   +3.508306424967585e-01; +9.225761004745757e-01   +8.398359249665831e-01   +8.470549580500202e-01   +9.371536478317842e-01   +5.929785320522027e-01   +3.973961509637795e-01   +6.284200849882978e-01   +8.571652965437653e-01   +5.651445716975195e-01   +6.993329526196876e-01   +7.427105228326009e-01   +3.972422094198151e-01; +1.854736066840023e-01   +5.938859190031878e-01   +9.698694000797918e-01   +7.808784752357281e-01   +5.757802809903203e-01   +6.974145702943120e-02   +4.407255398616682e-01   +9.500571400384572e-01   +9.851850044852456e-01   +8.431130831379974e-01   +5.915670732960941e-01   +9.875887757101132e-01; +5.425047804233267e-01   +7.645789983592761e-01   +4.635125683732588e-01   +5.932669830772044e-01   +6.543163644350686e-01   +3.772182292772675e-01   +2.331097513426370e-01   +6.952220965109154e-01   +9.603022014464372e-01   +7.345270901249527e-01   +2.568201466912636e-01   +2.942601500909658e-01; +3.977011867723915e-01   +6.641611313642478e-01   +7.706216610256460e-01   +5.794720571030795e-02   +4.312764506937595e-01   +8.540593945542680e-01   +5.039436708300085e-02   +3.608926720323463e-01   +5.602959931774755e-01   +9.966033100800218e-01   +6.083660024213330e-01   +2.276776847843000e-01; +9.470289205129021e-03   +5.847408381142341e-01   +2.400495223079102e-02   +5.411541881550159e-01   +9.380477286840627e-01   +2.502983852984105e-02   +7.048709190894838e-01   +3.742852899072925e-01   +5.266341021300708e-01   +5.061299949262850e-01   +2.286330136894973e-01   +3.289069117630399e-01; +1.050104565531461e-01   +2.387946415776136e-02   +6.755243210489547e-01   +8.623584812662588e-01   +9.923691235094001e-02   +4.238524816381630e-01   +8.477897163730330e-01   +8.436562775120412e-01   +4.758506843724667e-01   +1.929945893645099e-01   +1.935555560261988e-01   +1.672195765476212e-01; +8.552269055553978e-01   +6.853090431190487e-01   +8.388656293514213e-01   +3.387884442391000e-01   +4.058720915997497e-01   +2.511156078183202e-01   +4.069780314364042e-01   +3.851486875058909e-01   +9.018143228995933e-01   +9.553558776061388e-01   +3.562565231214062e-03   +3.828607039652239e-01; +3.388472493537521e-01   +3.263035006628164e-01   +6.871106604437638e-01   +1.781168763014883e-01   +8.935353720226933e-01   +7.327236096064688e-02   +2.923071389062266e-01   +7.714590236238079e-01   +4.813221747200028e-01   +4.513643015394005e-01   +6.529399269013452e-01   +5.275080697438675e-01; +1.505481736268102e-01   +8.183316335685123e-02   +9.001991202004146e-01   +8.786605850926055e-01   +7.355003748456771e-01   +9.183142556269752e-01   +2.593847337723685e-01   +7.767545699885557e-01   +4.875642007681051e-01   +6.082401109017925e-01   +4.004882637992761e-01   +5.944595956480078e-01; +8.031191555201636e-01   +7.436980375957170e-01   +9.578226110427208e-02   +8.411937368467699e-01   +9.578836469881128e-01   +2.642466318574452e-01   +5.089115325272175e-01   +4.326316686434898e-01   +3.120707144634984e-01   +6.424567053192525e-01   +2.709683588161610e-01   +1.700053024590693e-01; +6.512364974304766e-01   +9.682850728724106e-01   +7.708512327427247e-02   +8.319771668418076e-01   +9.734975001507696e-01   +1.054247794200815e-01   +1.196049149887108e-01   +4.845387230431422e-01   +8.543105405993456e-01   +7.626838958787219e-01   -6.254908272116458e-04   +6.974038103693278e-02];
L3E_L3I_iGABA_netcon = [+4.442905094650857e-01   +6.837955609254839e-02   +5.654871157246600e-03   +4.923856539377645e-01   +5.464689463974557e-01   +2.543452813141359e-01   +7.179646830683242e-01   +7.600687334006421e-01   +3.814335275285652e-01   +4.493222017504567e-01   +1.997448225590432e-01   +6.539872940020361e-01; +5.933589766326053e-02   +8.064726420469903e-01   +1.300889127816285e-01   +1.917897505943029e-01   +2.174681383948892e-01   +3.356551465012124e-01   +2.250014817556426e-01   +8.903633071256670e-01   +6.101707998835484e-01   +3.949201748719836e-01   +8.277988516838618e-01   +9.018211178696507e-01; +6.250305575593414e-01   +9.123514923629458e-01   +3.092493379805827e-01   +6.430354415581392e-01   +2.704672288064341e-01   +5.969065880001254e-01   +5.024564161100566e-01   +7.340285688206432e-01   +1.656224144178190e-01   +6.754193024847480e-01   +4.427150721202696e-01   +8.343770958067726e-01; +8.032056973621695e-01   +4.253253491696496e-01   +2.366336479876754e-01   +2.521981236055709e-01   +1.342594302368927e-01   +4.825263145543841e-01   +4.765517705351399e-01   +6.910414888275359e-01   +1.022739771692371e-01   +3.175177170679196e-02   +4.133368850953240e-02   +1.736335077115052e-01; +4.018400997685584e-01   +1.904004938065497e-01   +6.496430513997979e-01   +9.455377574935175e-01   +1.654746915220318e-02   +8.957614648498941e-01   +4.287887905590911e-01   +6.444786871146119e-01   +6.195001637555928e-01   +7.878386984477371e-01   +7.660863826557872e-01   +1.587337882795596e-01; +8.809639095534729e-01   +1.827649287305848e-01   +8.091267817707983e-01   +2.888780989260700e-01   +9.627874795206217e-03   +2.925207381833827e-01   +5.533951769201471e-01   +6.179095533900048e-01   +9.577522097341095e-01   +3.759647781934967e-01   +9.455807384547771e-02   +1.358870511214168e-01; +7.211625989813798e-01   +6.712685339479696e-01   +7.421116603046770e-01   +1.447036810754629e-01   +9.824804343441460e-01   +7.681185607007779e-02   +2.088720811198589e-01   +7.837667740967028e-02   +6.680911842499372e-01   +6.436705238208863e-01   +6.557293275437716e-01   +1.594455565909656e-01; +1.964078769715181e-01   +5.234133647641838e-01   +1.197959008534986e-01   +8.675957257310279e-01   +6.474195092920847e-01   +3.901212590433691e-01   +2.773599971547759e-01   +5.498072426904007e-01   +4.715825002695434e-01   +4.979807883524649e-01   +2.695663023186383e-01   +3.957482325194291e-01; +3.746339850570528e-01   +7.749796765720830e-01   +1.696414979960559e-01   +8.857182604911018e-01   +8.149312555314377e-01   +1.926691300428796e-01   +8.110039819450623e-01   +8.803217668478042e-01   +3.393975026646021e-01   +2.160019935664371e-01   +4.364128126244507e-01   +6.644052080698252e-01; +2.110220767317789e-01   +2.992964566100789e-01   +2.695000829286333e-01   +6.646987259665228e-01   +2.775891337034205e-01   +7.282405760843562e-01   +1.005919044176337e-01   +9.851545779691583e-01   +5.898868832996068e-01   +2.114258735823997e-01   +8.506613234226357e-01   +2.229587874608543e-01; +2.650565775093952e-01   +4.749954604144100e-01   +8.131804132728628e-01   +9.979163223328411e-01   +1.377462462337629e-02   +4.225540375133571e-01   +3.496729726070197e-02   +7.166228496409620e-02   +5.455803434599252e-01   +4.517705474008001e-01   +9.054470254706170e-01   +6.433845017009062e-01; +9.932366107350975e-01   +7.091217252087376e-01   +5.936531588912368e-01   +2.659605842637107e-01   +1.006230177322160e-01   +2.650786443438981e-01   +6.890234682518653e-02   +3.197298217959260e-02   +3.916584078647055e-02   +6.348556714802467e-01   +2.836578254743193e-01   +6.086528270886444e-01];
L2E_Input1_iAMPA_netcon = [+9.996723481449475e-01   +9.915403481629813e-01   +9.988475962550599e-01   +9.872938209253473e-01   +9.900137495341585e-01   +9.989986499842616e-01   +9.842153530599103e-01   +9.961147522323003e-01];
L2I_Input2_iAMPA_netcon = [+9.963571600828250e-01   +1.000000000000000e+00   +9.897951525691387e-01   +9.876034402603333e-01   +9.890237384674712e-01   +9.890006243745372e-01   +9.932257661413508e-01   +9.953001958144663e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
