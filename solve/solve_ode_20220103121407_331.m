function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+5.816504373471668e-01   +1.682451650386728e-01   +5.546930255817285e-01   -9.237850200047104e-02   -1.652833023911116e-03   +5.141102254184533e-01   +2.436323585866891e-01   +3.351043285991694e-01   +8.923457822945668e-02   +4.454266313780368e-01   +2.183588703582028e-01   +2.976474071815837e-01   +1.735740235059213e-01   +2.673029297965257e-01   +2.721536232073106e-01   -1.433131053623024e-01; +4.613461739247560e-01   +7.847484181634029e-02   -3.879888533290742e-01   +3.855855531476701e-03   +5.400779820311041e-01   +4.127384313479029e-01   -2.259057506126203e-01   +3.648800267746310e-01   +4.319054291345361e-01   +1.957696139398029e-01   +3.423477098814336e-01   +5.402472751151143e-01   +2.403044597999538e-01   +4.764977215734952e-01   -3.441087742139590e-01   +2.095278704036255e-01; +2.306384316538256e-01   +5.163985133868766e-01   -3.027976776082492e-01   +1.619377627648465e-01   +5.049311125245066e-01   +2.681526531058140e-01   +1.443559306158771e-01   +3.918407984271597e-01   -1.050099180383801e-02   +5.550593863103827e-01   -9.095516863498471e-02   +1.251552411553081e-01   +2.726674136982760e-01   +3.335879476800928e-01   -1.695436154665974e-01   +3.944480223859156e-01; +6.323632412889174e-01   -1.442487023088336e-02   +4.688560680469299e-01   +7.658950692024206e-01   +4.592030721497005e-01   +5.401244619882920e-01   +8.407157309638187e-01   +9.234861428891881e-01   +9.470042083633079e-01   +4.218810105738398e-01   +3.342436632209994e-01   +1.941902097494956e-01   +1.562072875708465e-01   +4.301410631774981e-01   +2.305952199861562e-01   +4.718275537378682e-01; +5.215010082342660e-01   +5.689602577918961e-01   +3.207328627873370e-01   +8.339183912910881e-01   +9.152373289528543e-02   -4.103318121225552e-03   +1.645776571068416e-01   +9.764948934129569e-01   +5.074232656881309e-01   +3.256995655857577e-01   +8.961533448938386e-01   +2.370375937464886e-01   +8.565773082147855e-01   -1.005095650844132e-02   +1.156251323764025e-01   +6.359477948049141e-01; +1.763649292154164e-01   +5.451460481309858e-01   +6.763179219157276e-01   +2.690436425659172e-02   +7.813273004740134e-03   +5.966915108230297e-01   +3.313415048032788e-01   +5.295157119487393e-01   +2.117671194011273e-01   +3.036903529550594e-01   -1.295149266836067e-01   +5.784179575288235e-01   +1.518076869046695e-02   +5.565307212114815e-01   +3.572719383558598e-01   +7.938199912461554e-01; +3.405654078013843e-01   +5.446983892808048e-01   +9.200875669729408e-03   +1.211870224726158e-01   +2.787956743828874e-01   +6.996878256764596e-01   +4.722395379759714e-01   -9.601719026370839e-02   +2.249570284724722e-01   -6.391861339057725e-03   +4.450565951992082e-01   +5.849501283200005e-01   +4.165598027709758e-01   +5.321532632909927e-01   +8.002140148991818e-02   +1.618120922625326e-01; +4.161733923226809e-01   +6.367423896327143e-01   +6.472164967544760e-01   -2.539956239754566e-01   +4.612776716118853e-01   -1.627690656992522e-01   +4.065553973765187e-01   +1.020447444943643e-01   +3.606395577609586e-01   +5.422139100227455e-01   +2.081333287976251e-01   +5.345784597245656e-01   +3.730002939516942e-01   +2.989074137524241e-01   -5.092192410074627e-02   +4.387247258264279e-01; +2.376879511837932e-01   +4.908303287575028e-01   +3.996888888184556e-02   +1.264588370200901e-01   +8.044455708754137e-01   +3.232598479542485e-02   +4.539127845238796e-01   +3.562862430815836e-01   +7.622853457219234e-03   +4.048433682131032e-01   +3.824713627680417e-01   -9.663072188479362e-02   +3.183537143531575e-01   +2.293673845410314e-01   +3.230091402286702e-01   -3.442613812824457e-02; +4.491438415489024e-01   +6.108023711910170e-01   +4.616838596893270e-01   +4.032995743027623e-01   +1.497560067911087e-01   +5.482117528914636e-01   +6.386915750631523e-01   +1.164158702963978e-01   -1.920626667138128e-01   +3.826500077717010e-01   +2.878034085907897e-01   +3.560502639484609e-01   +7.433119965048468e-01   +6.283577544485328e-01   +3.300595985060549e-01   +2.247151683683123e-01; +1.142092900705370e-01   +8.098612475863144e-02   +2.841141809121949e-01   +4.592501266185779e-01   +4.785930515055258e-01   +3.366020490726431e-01   +2.692431277891686e-01   +5.051630287353571e-01   +3.948488968594618e-01   -2.488951828267810e-01   -3.164819480964913e-01   +6.043394164764853e-01   +4.046284817581173e-01   +3.298185847114451e-01   +1.761103997662997e-01   +4.616033836953315e-02; +4.251050408676101e-01   +1.712458952039286e-01   +2.389563179587567e-01   +3.178949034178185e-01   +2.157408385296488e-01   +1.121720666232633e-01   +2.810583147786694e-01   -2.140300403821106e-01   -1.849411240850491e-01   +5.201823199116968e-01   +8.394293816442053e-02   -3.977790589111481e-01   +5.109054084605980e-01   +4.895904234678340e-01   +1.432439980254897e-01   +1.873750082317313e-01; -5.162336240792084e-02   +1.557521925908364e-01   +7.489458719603410e-01   +5.963148322180996e-01   +6.006044616959201e-01   +7.594555192385188e-01   +3.229134858839284e-01   +3.855138846071217e-01   +2.123277128946033e-02   +6.160170059956190e-02   +4.145101407292915e-01   +5.725448636669271e-01   +6.057944403767342e-01   +4.621010089011527e-01   +3.368679250834671e-01   +4.040407299975279e-01; +4.632988494605961e-01   +3.651518095386908e-01   +4.614515082613628e-01   +5.953887399968364e-01   +6.069210711350921e-01   +4.517580289721349e-01   +1.552017296169969e-01   +1.906053489069740e-01   +4.408645920081229e-01   -3.862929164596459e-01   +3.938727464440769e-01   +1.790122674380588e-01   +6.349788040851019e-02   -5.730967514941035e-02   -2.347353770644366e-01   +1.916531511299175e-01; -8.402250605213997e-02   +3.474215698146372e-01   +4.041315802227888e-02   +4.433759921127968e-01   +3.046208725080700e-01   +7.839076646322051e-01   -3.873959720921041e-02   +1.592153607024912e-01   -1.927770330573019e-01   +2.597804849147592e-01   +5.735128898222365e-01   +4.146397849333365e-01   +4.893316083259321e-01   +6.953339156003892e-01   +5.227776849009400e-01   +3.083620269241364e-01; +1.728979644118539e-01   +2.650335885011498e-01   -7.815419424143620e-02   +1.156312291516447e-01   +4.772516663353482e-01   +2.019967203604218e-01   -1.705496551845636e-01   +1.443672568836619e-01   +2.918288980044791e-01   +1.546053476143187e-01   +2.463509183912452e-01   +1.836742818102531e-01   +4.366895528358974e-01   -8.570293846948424e-02   +5.523758504682125e-01   +5.594257147524227e-02];
L1E_L1I_iGABA_netcon = [+4.235645315216768e-01   +4.119599803688906e-01   +6.502684010353759e-01   -5.664024229944287e-02   +2.193301345139270e-01   -1.048144836711385e-01   +4.099305862446467e-01   -1.347541876725403e-02   +5.732330609363733e-01   +7.273715853193679e-01   +7.298996463716888e-01   +5.081968700244094e-01   +7.326027351434177e-01   +2.870132153661776e-01   +3.858164142167950e-01   +2.084007770401818e-01; -8.865191368473467e-02   +1.796590227873243e-01   +1.635398917191330e-01   +3.558675809993994e-01   +2.326315104124673e-01   +2.689143007415142e-01   +6.569506190158324e-02   -3.050031129677426e-01   +8.788263647198270e-01   +4.495387072404260e-01   +3.927052251040674e-01   -8.019527804460797e-03   +4.734245817480844e-01   +5.107030030347218e-02   +3.434305357292204e-01   +3.869682805666040e-01; +6.956616734346258e-01   +1.656368413708267e-01   +4.112012306602101e-01   +2.859630392575083e-02   +5.268969406135963e-01   +7.685686670104376e-01   +2.318777213037358e-01   +1.118550412438498e-01   +1.463856763653440e-01   +1.497852750291659e-02   +6.861757396761197e-01   +5.669976443788759e-01   +5.081662471249530e-01   -5.278468550007469e-04   +5.018804308777649e-01   +7.770958930875924e-01; +9.409034579581227e-02   +7.292651715118754e-02   -9.189015060503812e-02   +5.573214945993725e-01   +3.025218386805184e-01   +8.926600540603218e-02   +6.473570407487844e-01   +1.869152303496567e-01   +5.579071554606898e-01   +6.768418284047681e-01   -1.190613899106483e-01   +1.720811770377742e-01   +6.744205255394470e-01   +1.835738304688487e-02   +3.189688596316361e-01   +5.022589887378500e-01; -6.271861328063251e-02   +1.657096788701848e-01   -3.303199368509195e-01   +1.277958420614352e-02   +2.152205583134408e-01   +6.056005008399327e-01   +5.550752559248201e-01   +5.263857177337870e-01   +4.723565903851197e-01   +6.339936968124062e-01   +7.061351636691046e-02   +5.331347326012442e-01   +1.049563986358215e-01   +3.733814180857127e-01   +2.329686924101968e-01   +1.348876031721692e-01; +4.748386975440517e-01   +7.565146228953173e-02   +3.723437051847277e-01   +3.892231553671097e-02   +2.332946798139512e-01   -6.104709109209620e-02   +5.365687970733599e-01   +2.442828998123360e-01   -1.252456739462057e-02   +4.821010995546566e-01   +2.772951723911488e-01   +3.695478191304007e-01   +2.947118258056101e-01   +3.685967884095335e-01   +3.739235321445813e-01   +4.706745083299363e-01; +1.176637153213116e-01   +4.527913952523530e-01   -2.650500710635105e-02   +1.803141703553655e-01   +5.008448488994027e-02   -3.303898186508289e-01   +6.254905071335249e-01   +5.561794475165818e-01   +1.017836734899244e-01   -8.779146258365175e-02   -1.055414660759207e-01   -8.737184497371679e-02   +8.726699980942222e-02   +4.162666227876048e-01   +3.715826261656233e-01   +8.912683126697651e-02; +2.025681459653710e-01   +6.908240199390091e-01   +7.150126238461098e-01   +4.670666575635133e-02   +3.376372466621025e-01   +4.405926489290492e-01   -1.688383491294757e-01   -1.352194386730661e-01   +1.907172271481866e-01   +9.416107835742231e-02   +6.388719003802599e-01   -9.403077231445653e-02   +1.957030503088921e-01   +6.138130975088956e-01   +1.037904932706016e-01   -7.837443661239714e-02; -1.368293937439599e-01   -6.436575741008869e-02   +3.380460390567250e-01   +2.347690537816671e-01   +6.135545587131105e-01   +1.666587039671651e-01   +2.853290080052239e-01   +2.588923424408161e-01   +4.460860025730993e-01   +8.478011569347725e-02   -1.347296700238184e-01   +4.301320408598001e-01   +1.373929698951610e-01   +7.357609052841028e-01   +2.512183211247336e-01   +1.589164751793872e-01; +2.059046211740762e-01   +1.000000000000000e+00   +6.282182554323700e-01   +2.492436906917635e-01   +1.042237498603025e-01   +6.142199772875649e-01   +9.878873807861714e-02   +6.457145085030543e-03   +1.213858951726464e-01   +3.014613610212541e-01   +4.130039365409157e-01   +5.655230917173856e-01   +3.775677155121224e-01   +2.268445345111773e-01   +3.023924555723238e-01   +1.093925688428983e-01; +6.007216208399418e-03   +8.814322622545052e-01   +6.247962770832811e-01   +6.647759574579526e-01   +3.170698988777132e-01   -2.491512298090725e-02   +1.236404976874856e-01   +6.245042817531914e-01   +5.314152859087494e-01   +1.863172691163468e-01   +4.801882951129744e-01   +3.090169306605166e-01   +2.135956646623159e-02   +5.277423616312604e-01   +1.913783327995849e-01   +5.338459902226724e-01; +6.366158959218647e-01   +1.929107511314962e-01   -5.859034460666872e-02   +3.936037093860466e-01   +7.883590945578196e-01   +2.018545678693704e-01   +5.560034933404204e-02   +3.758033054880464e-01   +5.914402095376143e-02   +2.571081354000097e-01   +5.054982596201878e-01   +5.304950998531075e-01   -2.865506644398445e-01   +9.637094174418212e-02   +2.975271738925351e-01   +7.374128751167091e-01; +6.226454961756335e-01   +5.984114782036519e-01   +6.383952749022215e-01   +2.165416785501713e-01   +2.106305340921122e-01   +8.852387080849931e-01   +2.341906625523897e-01   +2.307554257070991e-01   +5.061893024869111e-01   +3.088704529081511e-01   +7.006534449209533e-01   +7.037208221021185e-02   +5.213589810046728e-01   +2.249027456410156e-01   +9.066242067263081e-02   +3.454103330436872e-01; +3.340532569652727e-01   +3.914167806022956e-02   +6.507633533300549e-01   +6.519633967666265e-01   +6.708333205827751e-01   +6.352893496577227e-01   +7.053031334831028e-01   -1.082394372284669e-01   -1.329985864109093e-01   +1.850910366087047e-01   +4.326908342236760e-03   +5.433325610985162e-01   +3.516408549780128e-01   +2.915238831960161e-01   +4.913405207398440e-01   +2.417684605155598e-01; +4.976953679430145e-01   +8.708241786698017e-01   +9.796337912656057e-02   -1.548187996229251e-01   +4.576116068406544e-01   +1.930298162610123e-01   +1.865036556422875e-01   -1.886399514560015e-01   +4.866039630453210e-01   -6.778078183761992e-02   +3.325391373325131e-01   +4.087521064188920e-01   +6.802752636543019e-01   -1.803310930675827e-01   +2.057263468802842e-01   -4.051772444800239e-01; -1.163690893526615e-01   +3.264351401302687e-01   +6.193803244880409e-01   +2.013901331621819e-01   +4.661695674203104e-02   +3.387327734468401e-01   +7.977014018621649e-02   +7.085857725036780e-01   +3.794626621733166e-01   +2.613425544633661e-02   +1.527271318522531e-01   +5.944051025631467e-01   +4.119978114947543e-03   -5.551711684700045e-02   -5.263261629014038e-02   +6.681381752438073e-02];
L2I_L1I_iGABA_netcon = [+2.004522261186737e-01   +2.480250090257193e-01   +5.403118772985702e-01   +2.664336146501834e-01   +4.856204386391409e-01   +5.934259745637436e-01   +5.160330120106715e-01   +6.513968488199904e-01; +7.562000499502435e-02   +1.038327769611386e-01   +1.564594482902977e-01   +3.666489858899684e-01   +3.842880172952762e-01   -1.333251476549631e-01   +4.363345426939688e-01   +1.105481127738631e-02; +3.143664534725045e-01   +3.528299778823838e-01   +1.205096581553545e-02   +3.343932140246664e-01   +4.779558598776081e-01   -1.610326311471550e-01   +4.428418500191018e-01   +4.137012856984510e-01; +2.777735706377104e-01   +2.799605280777256e-01   +9.977511805728531e-02   +3.468473953921959e-01   +1.963432483548909e-01   -3.078849091735909e-01   +7.896510988919664e-02   +3.667232925011834e-02; +2.047560284177487e-01   +4.998548424638449e-01   +8.264295508212668e-02   +6.875509375154840e-02   +4.704109013748759e-01   +2.400587410995404e-01   +4.086412868405618e-01   +5.713772208022696e-01; +3.858561487640932e-01   +3.549900406092769e-01   +3.942957525593321e-01   +4.294181258360084e-01   +3.440089619884365e-01   +1.255864915141837e-01   +5.149777305850483e-01   -8.431580504978439e-02; +2.338563886426675e-01   +4.557239189268068e-01   +4.855658367958207e-01   +6.593773980104620e-01   +7.218306122676843e-02   -5.306240316078843e-02   +6.910395609715897e-02   +1.939595238488995e-01; +5.236936300676227e-01   +4.154848185178295e-01   -1.205826398584918e-01   +4.228363820745708e-01   +8.119623490398804e-02   +3.920694838517373e-01   +3.733304817464925e-01   +7.544978787043184e-02; +3.493882872859186e-01   +3.281905847229598e-01   +5.380136203763718e-01   +2.430198387167807e-01   +1.532996152833633e-01   +8.460848915147049e-01   +1.550956853195647e-01   +6.706094164247827e-01; +6.954429674272721e-01   +2.159359710665134e-01   +6.262054502748998e-02   +2.419447192444985e-01   +3.270356309942382e-01   -5.998357974410840e-02   +5.547442193694400e-02   +4.873568062086424e-01; +2.030465952841411e-01   +6.232419657077188e-01   +2.814648441057317e-01   +6.119206368911100e-01   +3.431863224033536e-01   -5.912215089980831e-02   +7.279723104522443e-01   +5.126660318265579e-01; +7.488926868295381e-01   +1.000000000000000e+00   -2.194016598224073e-01   -3.060920661799208e-02   +1.720999229017949e-01   +1.972495010888381e-01   +3.198586605180781e-01   +1.036953536110280e-01; +7.843298875586547e-01   +1.677820294514372e-01   +5.882827720917573e-01   +2.831042613546143e-02   +4.183901845748201e-01   +1.911853228331035e-01   +6.712699238080120e-01   +4.474861837563526e-03; +6.847772947180587e-01   +1.883117249000117e-01   +3.927309914425472e-01   +1.123139713498853e-01   +3.401155653414245e-01   +3.122707222492195e-01   -6.067719608126761e-02   +9.281169947227944e-02; -1.630000597396513e-01   +8.440931244532062e-01   +3.846148336364767e-01   +1.342531119802672e-01   +2.118363168374694e-01   +5.099436394840791e-01   +2.215367177075076e-01   +2.003750533901995e-01; +1.055977351873091e-01   +5.257965255150462e-01   +1.504908961715571e-01   +3.643676420528607e-01   +1.452709282563017e-01   +3.157473306693868e-01   +5.292910239642473e-02   +1.182779194293225e-02];
L1I_L2I_iGABA_netcon = [+1.241435262310688e-01   +4.200845830627778e-01   -1.521041217729494e-02   +3.816810852768279e-01   +8.137469141247334e-01   -2.233617981959387e-01   +5.872260660390279e-01   +1.685054897102657e-01   -5.626449289032698e-02   +3.179851546651297e-01   +4.290459862152492e-01   +3.806939660405915e-01   +5.581294785625394e-01   +1.536483328431152e-01   -2.511007414598895e-01   +2.976264686054906e-01; +8.512763741402850e-01   +2.609186389184094e-01   +7.045822994422243e-01   +7.181798569042293e-01   +2.660444034924480e-01   +9.753204318895556e-01   +3.795187240978002e-01   +1.816084211524754e-01   +4.192991375947028e-01   -1.109581166517004e-01   +9.529075620581591e-03   +9.051703629625795e-01   +6.040061470920846e-01   +6.455604416819953e-02   +3.789605443211110e-01   +5.803537097339477e-01; +3.778425075560461e-01   -3.107005184331086e-01   +8.638151828656484e-01   +5.212948562968028e-01   +5.377232174897029e-01   +3.329248439538966e-01   +4.631282107898974e-01   +6.163197271278034e-01   +4.531352794066724e-01   +4.126288069983559e-01   -2.077925230833945e-02   +1.675516243233479e-01   +1.186347519615113e-01   +6.662473315570490e-01   +3.315500793413868e-01   +2.312372959403698e-01; -2.923888359110607e-02   +5.821298621742319e-01   +2.060246280612899e-01   +1.101524191704386e-01   +2.415743408607567e-01   +3.000702843056077e-01   +9.968447670257577e-01   +2.609489380252246e-01   +8.539431909864990e-01   +3.109708492386702e-01   +3.564970317258285e-01   +6.360178775806009e-01   +5.072665120196563e-01   +2.399519157169874e-01   +7.789638212397287e-01   +4.445338727854820e-01; +3.907772249664339e-01   +7.533648391635115e-01   +2.439102640269563e-01   +2.969038033789024e-01   +1.855721605757055e-01   +8.004520353141747e-02   +5.431758572405841e-01   +5.545625070816118e-02   -1.804108227021884e-01   +1.896055581542425e-01   +3.036558643244379e-01   +6.894284360588731e-01   +1.592720365577408e-01   -3.736191290495199e-02   +5.215058820915759e-01   +5.923981209622466e-01; +7.520146746398253e-01   +4.496205141520804e-01   +6.726139265445175e-01   -1.748449081863565e-01   +4.614516814546600e-01   +8.923793246581371e-02   +8.987505808694730e-01   +1.897498528190187e-01   +5.400927167024971e-01   +7.269653802312218e-01   +9.242793642970321e-01   +1.164449770897478e-01   +3.251179883614382e-01   +3.056339289807462e-01   +2.549627245125365e-01   +3.167407172228485e-01; +1.245929731791340e-01   +6.254092281629753e-01   +6.490089245378482e-01   +4.204141998683245e-01   +4.497310127685468e-01   +9.416853446411960e-01   +7.825691635478583e-01   +2.897518663004643e-01   +1.897155452382599e-01   -1.104590706054841e-01   +7.602330924504469e-01   +1.248626746129225e-01   +5.916118577097988e-01   +6.927606821365837e-01   +8.431455816578926e-02   +4.289917089516672e-01; +1.756127848335583e-01   +8.018218652231871e-01   +4.042954419810508e-01   +7.206390929748591e-01   +5.096057321038605e-01   +3.368726541084225e-01   +3.583467323598608e-01   -4.642091105557243e-01   +1.372498335298258e-02   +2.747046024509023e-01   +1.271680268606411e-01   +6.676330159696849e-01   +7.764774064668103e-02   +8.037768346369580e-01   +3.295566654296289e-01   +2.981465050644486e-01];
L2E_L1E_iAMPA_netcon = [+2.496981998542552e-01   +3.412996246195897e-01   +4.603303358464822e-01   +4.436954917517955e-01   +2.573353909798213e-01   +3.177881117808162e-02   +3.128729790984067e-01   +4.101211445500262e-01; +3.435514694842064e-01   +3.659146042131239e-02   -1.198830219555306e-02   +1.838976132788290e-01   +2.950807546773844e-01   +1.672733150735733e-01   +7.214881372962963e-02   +5.088879756621756e-01; +9.151270848260269e-02   +2.345890113086898e-01   +3.384443566860845e-01   +1.000000000000000e+00   -4.294930604434814e-02   +2.245640774565622e-01   -4.062582459310755e-02   +5.814281617739954e-01; +2.419200177867197e-01   +8.095629137423944e-03   +2.573094465847330e-01   +3.159209277939129e-01   +4.404893603769001e-01   -1.898323572672255e-02   +4.675020420750829e-01   +2.823709964781632e-01; +6.542751786622717e-01   +6.954909511943219e-01   +1.908380735553368e-01   -5.248394562406087e-02   +1.674819469433034e-01   +1.547991644267643e-01   +1.862223651287691e-01   -4.890572074136595e-02; +4.808240033393638e-01   +3.454631015832551e-01   +5.282895417515562e-01   +4.638637174031465e-01   +5.912510233759032e-01   +3.300110964353774e-01   +4.354220895539284e-01   +5.489803613937705e-01; +8.162563631695235e-01   +4.446871642485166e-02   +1.350764501826299e-01   -1.302056887864448e-01   +1.237066701331080e-01   +3.707869232861962e-01   +4.374261620443144e-01   +6.015381076853488e-01; +5.657066833706034e-01   +4.191867061862513e-01   +2.520807378988112e-01   +5.368587935962613e-01   -7.780662833695695e-02   -4.136267317106431e-02   +3.224572167517220e-01   +9.425903415339933e-01; +2.057344239488819e-01   +2.155942235418204e-02   +4.256277715277770e-01   +1.910715202072994e-01   +3.904162548984493e-01   +4.790091634601717e-01   +3.775732087551589e-01   +2.116405845621928e-02; +2.916544263124071e-01   +4.186734400971633e-01   +2.281222775704332e-01   +5.618684614559236e-01   +4.513289227235891e-01   -4.163005474258171e-01   +5.004922867484007e-01   +3.310188727826847e-01; +1.486024034804591e-01   +2.118757325415075e-01   +4.324886158948645e-01   +4.483632744328725e-01   +4.280205149029478e-02   +2.132891841690391e-01   +4.420972782215954e-01   +4.296064014206255e-01; +5.125659242357482e-01   -5.993646275183004e-02   -3.459503232128848e-01   +6.892887780441503e-01   +4.513520727128104e-01   -1.181279743729551e-01   +3.382345213019954e-01   +3.023411527705832e-01; +6.478811064692518e-02   +3.448110402311869e-01   +1.760663083608708e-01   +1.465489045496735e-02   +3.270706433941180e-01   +6.790465933525117e-02   +1.307390885918250e-02   +2.462292183086839e-01; +8.337312292955416e-02   +4.546875790384950e-01   +5.248503547624734e-01   +4.103056427528219e-01   +1.511665616316628e-01   +4.304621763998210e-01   +4.636265186937773e-02   +4.149084595852160e-01; +2.200480668991283e-01   +6.685712557480419e-02   +8.713768731611826e-02   +5.135705799797300e-01   +4.023009261895284e-01   +3.004168494453263e-01   +1.773280744394092e-01   +6.314954847788031e-01; +2.148004266088181e-01   +7.300499878139030e-03   +1.653558764213205e-01   +1.725631094356187e-01   +3.704030226686433e-01   +1.667008803296792e-01   -4.918164774709793e-02   +1.019696571161927e-01];
L1E_L2E_iAMPA_netcon = [+4.899991687486600e-01   +6.494635454483290e-01   -4.418268727265637e-02   +3.149734001367476e-01   -3.671933847469540e-01   +1.370996494719725e-01   +1.903667767080567e-02   +7.639106328150708e-01   +6.689150982902661e-01   +2.621302898559135e-01   +5.106667179319302e-01   +7.038114493698805e-01   +5.310162094495936e-01   +1.247710885933809e-01   +1.418915645967858e-01   +7.151071740976276e-01; +4.313701134162923e-01   +4.189039374723580e-01   +5.924880849614756e-01   +5.219480698029997e-01   +1.680008573096060e-01   +2.577562594024109e-01   +4.064157066588339e-01   -1.946567266973118e-01   +1.191980868010440e-01   +4.260128916360086e-01   +4.811378776613015e-01   -8.393277095641009e-02   +6.233011943510869e-01   -4.954138590006267e-02   +3.449538990079245e-02   +9.508999309392199e-02; +9.000148577541311e-02   +4.558332247310543e-01   +4.251269217496979e-01   +4.474515726664723e-01   -2.019901815973195e-01   +2.255404031463965e-01   -8.130331746564167e-03   +5.842511251612331e-02   +2.991945213787858e-01   +3.070092100277585e-03   +6.390127485153642e-01   +5.073068019480544e-01   +1.958102149385810e-01   +6.412216053287750e-01   +5.791340507464890e-01   +3.653095712551973e-01; -8.182505852954081e-02   +2.835615919941975e-01   +2.153881193712019e-01   +3.720150471960911e-01   +2.674879119393445e-01   +6.250725210552903e-01   -6.797335260287567e-02   -8.390475282430149e-02   +2.337012094530100e-01   +1.386975234128087e-01   +4.579668947504657e-01   +1.353507574657310e-01   +1.613723810504624e-01   +1.665858516898513e-01   +7.283715820414846e-03   +7.612929702411565e-02; +3.012125908541013e-01   +6.793610988909641e-01   +6.657984864800089e-01   -1.271327088862068e-03   +2.314484912892712e-01   +6.934867678405656e-01   +2.683331667881192e-01   +1.331813732059155e-01   +4.869548330770729e-01   +3.870013313083069e-01   +1.000000000000000e+00   +3.793263892626033e-02   +5.898658728610936e-01   +7.291993479261890e-01   +2.854919934990978e-01   +1.756279569581730e-01; +3.748981039211061e-01   +1.983678522954736e-01   +4.580733520465510e-01   +5.847228411880858e-01   +2.863026700593032e-01   +5.466794940872373e-01   +5.840527116779972e-01   +3.590439045680766e-01   +1.758619531433757e-01   +4.339183400776165e-01   -3.094222599113457e-03   +3.548744049735718e-01   +5.080190837251537e-01   +2.686947275007225e-01   +4.803570718823456e-01   +5.765132986430896e-01; +5.926527243269701e-01   +1.532008440407817e-01   +2.599006745653541e-01   +3.917665972468532e-01   +3.198507256081137e-01   +1.531266780946174e-01   +7.441229099592261e-01   +6.586243495112906e-01   +3.734612385408138e-01   +2.092715319099200e-01   +4.681751971354993e-01   +4.082212035795355e-01   +2.296285227722314e-01   +4.892476438503549e-01   +2.430646362678635e-01   +2.880832370101031e-01; +5.227549898695613e-01   +4.206582286866118e-01   +4.253611956323082e-01   +3.845562884202467e-02   +7.368304724058148e-01   +3.485113739715018e-01   +1.778274945845666e-01   +4.451600716003903e-01   +4.241695379006454e-01   +3.678045781627880e-01   +2.011023052680052e-01   +1.618152456645142e-01   +9.618883141122966e-02   -1.948948082479736e-01   +2.293423176524621e-01   +2.891673666918245e-01];
L2I_L2E_iAMPA_netcon = [+3.904513659550750e-01   +7.984903384630131e-01   +5.183719322501623e-01   +7.262281129738780e-01   +3.988031914408547e-01   -1.788561967438303e-01   +7.301516772659196e-01   +6.814306468578958e-01; +7.038295720095670e-01   +8.103093910569197e-01   +2.851158950187972e-01   -6.451087950003234e-02   +3.946089293400625e-01   -1.548796386812481e-01   +3.677506410337142e-01   +1.117091532968865e-01; +3.681311295701025e-01   +6.015835077314702e-01   +5.875430495851903e-01   -2.965968924966279e-02   +3.056757056235254e-01   +5.509615339582431e-01   +1.427223309559315e-01   +2.655452100848805e-01; +4.542148902885494e-01   +8.005835294863136e-01   +4.437748184189249e-01   +1.219358197051441e-01   +6.558719126087919e-01   +9.206578579960584e-01   +6.693720699597335e-01   +7.743419442372151e-01; +1.000000000000000e+00   +4.445914035414102e-02   +1.057512803768796e-01   +4.435564564023484e-02   +1.160747715131177e-01   +6.741899235714655e-01   +5.538091775772798e-01   +3.779222277582514e-01; -3.952440835208865e-02   +1.189571380794490e-01   +5.916184644541419e-02   +3.105378665513773e-01   +1.115105742220828e-01   +6.163065491837729e-01   +4.789212449461473e-01   +4.124078604185427e-02; +8.066142363834942e-01   -1.201288084722117e-02   +3.788054401858004e-01   +8.847391032704328e-02   +3.412054440346033e-01   +2.847929770105960e-01   +3.369385543093119e-01   +4.474490417050775e-01; +9.640841701068159e-02   +2.106905465959977e-01   +3.889593168415170e-01   +1.340477624445960e-02   +5.517151059929334e-01   +5.037617582714085e-01   +4.530263266721907e-01   +3.863885773332878e-02];
L2E_L2I_iGABA_netcon = [+9.379774804899584e-01   +6.504320326236354e-01   +5.324209084006487e-01   +5.735166837737279e-01   +2.178700247108172e-01   +9.890963149396638e-02   +2.155611910846655e-01   +6.484194241756530e-02; +3.325559821224338e-01   +7.387403082186846e-01   +1.000000000000000e+00   +9.031183214036094e-01   +2.140431755086956e-01   +4.163732114438397e-01   +8.781704898038444e-03   +6.667087251028512e-01; +7.789624086532544e-02   +6.107693183701757e-01   +7.678059121226041e-01   +5.534496708033281e-01   +5.190633509571176e-01   -1.014635745375342e-01   +3.573884313550856e-01   +1.229934106935318e-01; +3.138561333300372e-01   +1.202112662827659e-01   +6.907267930513903e-01   +2.263615455378481e-01   +3.502650627107596e-01   +2.722128049860070e-01   +2.039752748217299e-01   -2.973839564365148e-01; +5.264377745298898e-01   +6.034036786628286e-01   +3.918884244535623e-01   +3.833435472337670e-01   +1.850839353865018e-01   +6.191824436590952e-02   +8.052430054315102e-01   -5.044750936249191e-02; +1.191306958483142e-01   +8.198507760375399e-02   -3.081470538612167e-01   +1.550373667705107e-01   +5.584985645285866e-01   +2.959630880427866e-01   +1.446807417719917e-01   -5.049572882624060e-02; +3.822577642006905e-01   +3.778793579069921e-01   -1.029135013650534e-01   +3.129893324399887e-01   +4.072669250155915e-01   +5.703797242959595e-01   +4.629602545853377e-01   +5.805472561384339e-01; +5.168488786686679e-01   +1.820707338538939e-01   +3.084854136076933e-01   +4.490055566669521e-01   +2.387410598397162e-01   +9.573215107216237e-02   +2.190967215384561e-02   +4.566704759472296e-03];
L3E_L2E_iAMPA_netcon = [-1.432206178319862e-02   +3.286172706635159e-02   +5.189296454466181e-01   +2.087874053480746e-01   +5.576298903924116e-01   +3.179826764113182e-01   +5.396887307611463e-01   +6.235848666600309e-01   +2.914718742191947e-01   +6.304048608919647e-01   +6.709635758371904e-01   +5.035821912357991e-01; +2.908072462232926e-01   +2.484806273835931e-01   +4.082926192256127e-01   +2.247370109977534e-01   +6.687376035930226e-02   +3.855481560528263e-01   +1.740986861702753e-01   +7.415185625757281e-01   +2.800124465333288e-01   +2.833112689073876e-01   +4.838843391664909e-01   -2.125667697481686e-01; -1.996310586105329e-01   +1.589806880495350e-01   -3.923516706882479e-02   +4.306446616002086e-01   -2.877007958157420e-01   +1.505383362419085e-01   +1.292128866029357e-01   +2.149912265182173e-01   -1.595654255343266e-01   +2.145567995858043e-01   +5.149488563206518e-02   +2.005301151918324e-01; +4.122322625198864e-01   +1.550828991876814e-01   +1.203475722505419e-01   +1.903189376503609e-01   +4.490250255711628e-01   +1.720567556626579e-01   +1.135991164292071e-01   +6.956832459132652e-02   +4.605697221913517e-01   +2.011460914409479e-02   +3.784956894602072e-01   +6.980699633344065e-01; +5.105100578793242e-01   +2.231729767221844e-02   +3.914019747802508e-01   +3.780577650451389e-01   +2.849916730216555e-01   +6.788493912306091e-01   +4.582356849267906e-01   +6.488798060441642e-01   +1.213464579146994e-01   +3.739382421237125e-01   +2.584023271719884e-01   +2.245406702889823e-01; +6.941163434339146e-01   +1.632473974675189e-01   -8.276128656699708e-02   +4.897125108946338e-01   +3.995535267459927e-02   +6.429955424044171e-01   +8.008225754784747e-01   +2.251128225542010e-01   +8.867746538496370e-02   +7.608608043317150e-01   +1.783152977424770e-01   +4.418149295564543e-01; +2.467066815866880e-03   +4.963404186825301e-01   +2.466595510229404e-01   -8.624237164449235e-02   +1.000000000000000e+00   -2.378109767175322e-01   +2.104856034905801e-01   +5.059742836854467e-01   +7.437618399653144e-02   +4.439645720536885e-01   +4.363791840949598e-01   +8.547841776767828e-01; +3.228477902258771e-01   +2.429689346258551e-01   +1.889044315291664e-01   +7.987827678314281e-02   +6.422658539667596e-01   -2.970416350325729e-01   +6.055535630583163e-01   +3.499246671694255e-03   -1.784477415738285e-02   +3.510765662950482e-01   +6.202823801958237e-01   +2.795966686434030e-03];
L3I_L2I_iGABA_netcon = [+3.715422682493411e-01   +4.556711861695407e-01   +5.234091191220673e-01   +1.760411412725163e-01   +1.694272697447017e-01   +4.642503011254732e-01   +4.380264905947462e-01   -2.084137658175350e-02   +4.078735574345211e-03   +4.066643936832808e-01   +4.104840786029764e-01   +6.017934036119459e-01; +2.601347808676492e-01   -1.496611179827805e-01   -1.759031031995184e-01   +6.643868696959994e-01   +7.249866951400175e-02   +5.332504760453134e-01   +2.314525009398462e-01   +2.164853284729244e-01   +8.736240083932737e-01   +1.360172311170816e-01   +8.115174253974343e-01   +2.570808075479666e-01; +7.954131514865496e-02   +6.020709955185943e-01   +6.859837297183169e-01   +5.133118227036629e-01   -1.772841711734980e-01   +4.988864335130188e-01   -2.412451077436191e-02   +5.273525633201699e-01   +4.838678510965809e-01   +5.208847751185549e-01   +5.401990876450281e-01   +4.522515606481531e-01; -1.424353856450100e-01   +5.147850886380518e-02   +7.943144094614544e-01   +4.734105294845813e-01   +2.639164119580642e-01   +6.155995939552470e-01   +5.094513823150380e-02   +2.168990587293169e-01   -1.585694573793499e-01   +3.285951429649767e-01   +1.747271989843379e-01   +1.843281977012658e-01; +3.328855535554476e-03   +2.953084166802493e-01   +3.778735139335668e-02   +1.502193170917167e-02   +1.909128803683501e-01   +3.545496550839735e-01   +3.393888565191505e-02   +3.410942453961806e-01   +1.281062791768178e-01   +5.115821780385953e-01   +6.757951752404099e-01   +4.422833032497751e-01; -5.994736465391586e-03   +6.078264986592059e-01   -7.647451683870231e-02   +6.331256675974868e-01   +7.152774569735406e-04   +3.959111707648831e-01   -2.293727146660068e-01   +1.035162375296402e-01   -3.637321964771503e-01   +6.556085441799118e-01   +7.040624479853578e-01   +4.411043702969032e-01; +4.746002333638396e-01   +3.557287272009345e-01   +5.412076193648262e-01   +4.350825561223624e-01   +3.288968972464212e-01   +2.779685793187228e-01   +3.726636147757300e-01   +1.364447875770732e-01   +3.304714815065555e-01   +7.396693110012572e-01   -1.529439389482432e-01   +3.564892861435571e-01; +4.823738673253097e-01   +6.854735330099574e-01   +4.131791071345262e-01   +2.549162988887094e-01   +4.333483393902179e-01   -4.322713512795323e-01   +1.000000000000000e+00   +5.522271551244760e-01   +7.975426392117902e-01   +4.345734727929027e-01   +3.148890633202730e-01   +4.702343366732031e-01];
L2E_L3E_iAMPA_netcon = [-9.813426169330645e-02   +2.846920818635366e-01   +7.392651973708926e-02   +5.465098865592765e-01   +3.333785600178383e-01   +2.815351333033808e-01   +1.120369367594126e-02   -9.131961343244038e-02; +4.795738795696869e-01   +5.072110273522913e-01   +2.418418467707122e-02   +5.817531614555710e-01   +6.289837867684413e-02   +3.666652012945866e-01   +2.125570872693638e-01   +5.802745351912971e-01; +6.155654360224465e-01   +2.619196269608940e-01   +6.871365751592579e-02   +1.337554492146947e-01   +6.286608552485538e-01   +2.073500213491213e-01   +1.427052311548950e-01   +2.509205562194000e-01; +1.722779050759776e-01   +7.145586893415969e-01   +4.482816774515165e-01   +1.490506993369743e-01   +7.090523917985053e-01   +4.322101161222766e-01   -5.252794025289895e-03   +4.449325062845350e-01; +1.084155876037551e-01   +8.670533495175835e-02   +3.889367950161602e-01   +3.640620128411374e-01   +3.540087824061911e-01   -1.091306255433562e-01   +5.946134873345325e-01   +1.450014831724706e-01; +5.201129870057185e-01   +6.094780852069395e-01   +2.129446393215618e-01   +5.995673817738970e-01   +1.390032880817913e-01   +2.122406857375855e-01   +2.659094196418050e-01   +6.316908246866633e-01; -1.489109224250002e-01   +2.360397026438760e-01   +3.691833048808236e-01   +5.822215130647178e-01   -1.408814866068570e-02   -3.790926008307050e-03   +7.711295649618669e-01   +3.570141147752357e-01; +8.417906839151479e-02   +6.993897537916453e-01   +2.060329633216988e-01   +3.133462773998910e-01   +1.392853916785791e-01   +6.157401660400655e-01   +5.040576532551886e-01   -7.588937015457145e-02; +7.170738224777338e-01   +5.582425410138019e-01   +2.452931755254230e-01   +6.145811623041117e-01   +9.635280561040596e-02   +1.948103472944334e-01   +4.643832415320700e-01   +9.702570892482139e-01; +3.434159922356534e-01   -1.044540340662253e-01   +3.407403845035732e-01   +6.855590555302091e-01   +4.912576038858613e-01   +2.306049365333133e-02   +4.845841020290849e-01   -4.418912368064998e-01; +2.051154981756969e-01   +4.070371482900809e-01   +1.941794045277342e-02   -1.307514595250810e-01   +3.126825733302426e-01   +2.896218244359461e-02   +1.427621708067171e-01   +7.877954464296997e-01; +2.627443192979150e-01   +1.345610911686161e-01   +4.499033580941035e-01   +4.064442257462193e-01   +5.455163446977945e-01   +1.974869011755915e-01   +2.239072455519645e-02   +3.449996103309325e-01];
L2I_L3I_iGABA_netcon = [+9.992102644554125e-02   +3.624741851509377e-01   -8.441288800788035e-02   +8.693173346104064e-01   +7.078316196777527e-02   +8.026996614416480e-02   +3.178387789613510e-01   +4.080414063767917e-01; +3.916398304354908e-01   +1.991450852312252e-01   +1.525151904984496e-01   +1.831101137895799e-01   +1.181715860979810e-01   +3.158127846936178e-01   +1.000000000000000e+00   +1.354780720091523e-01; +2.970233274732148e-02   +3.935309471973761e-01   -1.744509342013806e-01   +6.200783545293153e-01   +3.023747375561866e-01   -2.754865822640245e-02   +7.226022462525775e-02   +4.198308426104979e-01; -7.247316371754002e-03   -4.653019701215482e-01   +3.554423183385810e-01   +5.048296358431030e-01   +6.156429826344154e-01   +2.848860026315601e-01   +5.727686521616778e-01   +2.601049003234762e-01; +1.414702766405429e-01   +4.526294859688058e-01   +4.039785617148343e-01   +8.592041954286633e-02   +3.100010199744395e-01   +2.539721728275202e-01   +3.522989588624072e-01   +5.003937905401049e-01; +8.029070133081771e-03   +2.606373071786926e-01   -6.645284262118630e-03   +5.731818853819061e-01   +3.540729558353944e-01   +5.054955342442200e-01   +8.865872842651638e-02   +3.316409113334796e-01; +4.558207433625641e-01   +3.210946806980626e-01   +1.978351819204877e-01   +4.748714147018134e-01   +6.031387559889594e-01   -7.723009758074081e-02   -1.245968448904830e-01   +2.974781021766879e-01; +3.538118537622881e-01   +6.589043696838088e-01   +7.902258810222625e-01   +4.225518842676323e-01   +1.198713958469291e-01   +5.428119557700790e-01   +1.305796006515472e-01   -1.550789647778487e-01; -1.783447220305265e-02   +1.495338768097325e-01   +3.277728647192586e-01   +2.529081134669502e-01   +3.871490781533610e-01   +4.003749235897920e-01   +4.360651888630232e-01   +2.933514361434895e-01; +5.381345947432311e-01   +7.004833180731416e-03   +3.054049237996267e-01   +3.521318521103345e-01   +5.169165843198226e-01   +8.563768882726004e-04   +3.528275544093647e-02   +3.407809393342277e-02; +2.409994427738651e-01   +6.672301060877682e-01   +3.823747927535023e-01   +4.095969388981127e-01   +2.650027080476376e-02   +5.625297216024764e-02   +5.165425930722326e-01   +1.908451843288311e-01; +7.660433850717819e-03   +1.147755562199282e-01   -1.620355208304710e-02   +9.316326855097253e-02   +6.943914508884387e-01   +4.487333952255750e-01   +6.898571028065307e-01   +3.189456695966353e-02];
L3I_L3E_iAMPA_netcon = [+1.925266227304077e-01   +6.031315485655591e-01   -2.380749070885150e-01   +5.735257501770027e-01   +9.656721085135135e-01   +1.854087124304031e-01   +2.952011758308936e-01   +5.163235937593075e-01   +2.687994939198585e-01   +1.422929941140958e-01   +3.228049387873229e-01   +4.152166799709381e-01; +6.200761045426576e-01   +8.430982112171448e-01   +3.421068222737874e-01   +2.206860490988048e-01   -1.953174834342876e-01   +5.873679982570816e-01   +5.020545133795287e-01   +8.036402390588797e-01   -8.502606788173300e-03   +8.728308467026924e-01   +4.593438664691680e-01   +5.858238485999301e-01; +2.696610379263808e-01   +5.813485247207795e-01   +1.511472120570902e-01   -3.613429394262352e-01   +9.550800555038569e-01   +4.308328065837985e-01   +1.676073076054740e-01   +7.594583830005784e-01   +2.378030791549622e-01   +2.041331318971353e-01   +5.967814625551384e-01   +4.862404534004953e-01; +8.492291654708858e-01   +4.178750918412714e-01   +3.803769943304502e-01   +8.714174410193771e-01   +8.970109032535142e-01   +7.716578967804910e-01   +6.705289602790054e-01   +4.227073630660622e-01   +3.372379925127317e-02   +4.663159793830539e-01   +2.927181971431161e-01   +5.917706816928130e-01; +3.101734690232785e-01   +2.162115428966439e-01   +3.552182501902854e-01   -2.814237333952643e-02   +5.624311419879027e-01   +8.044438182106319e-01   +1.679578726005588e-02   +7.664425617193581e-01   +1.000000000000000e+00   +2.890905825564126e-01   +7.721462015291795e-01   -2.877327512882406e-01; -7.374816297285026e-03   +6.767136868324750e-01   +4.059203515469847e-01   +3.535259945641530e-01   +1.789998709719140e-01   -1.635320122495349e-01   +5.591230016887528e-01   -9.218371998465849e-02   +3.585344535320197e-01   +2.631568745748417e-01   +3.189658884137771e-01   +2.253179654510206e-01; -1.511454216781580e-02   +3.039027880386849e-02   +1.601911815077434e-01   +2.609840059056411e-01   +8.546110810962725e-01   +4.301015365838745e-01   +4.463339890485283e-01   +4.008737673140866e-01   +1.782679524130128e-01   +5.841469839769965e-01   +9.757965054467536e-02   +2.406639058743317e-01; +2.576233762645265e-01   -7.761707728586287e-02   +3.917803133997953e-01   +4.223776163589332e-03   +3.381459135673076e-01   -4.085143187283253e-02   +1.660918856845265e-01   +2.336626433989675e-01   +1.006168234740541e-01   +6.687302367847224e-01   +3.753066714838356e-01   +2.154332568912243e-01; +9.970152920896816e-02   +3.327206561987560e-01   +4.763586546830956e-01   +7.268783759827199e-02   +2.547722640849595e-01   +1.908784729384255e-01   +4.025647488443586e-01   +2.641901862128901e-01   +7.127800996022020e-01   -1.469497644414998e-01   +4.770883999924412e-01   +2.734592933252105e-01; +5.749206975089290e-01   +6.321505283475565e-01   +3.332122575709626e-01   +4.084182028079211e-01   -8.763566462166364e-02   +3.855768709303132e-01   +6.315681990405777e-01   +6.815795355615991e-01   +6.090350643003054e-01   -2.696699237870240e-01   +7.317096758354665e-01   +3.725925365053512e-01; -1.143408151003000e-01   +1.479303895969617e-01   +2.657507424908388e-01   +4.971252656736023e-01   -2.983552776084201e-02   +1.581624467563469e-01   +1.107260872238810e-01   +4.945067222775360e-01   +8.949491338816873e-01   +4.305156146684655e-01   +2.320625268794177e-01   +6.245645734380089e-01; +1.229656768296212e-02   +7.043170640698293e-01   +3.109959203642800e-02   +6.953791034717545e-01   +8.551350107705553e-01   +8.102178703061540e-02   +2.103695182868601e-01   +5.623497062485068e-01   +5.318742115885255e-01   +2.101847355095362e-01   +1.383966140754745e-01   +1.027505638189248e-01];
L3E_L3I_iGABA_netcon = [+7.137900140485626e-01   +6.817344046487518e-02   +2.014537525731259e-01   +6.286887960795978e-01   +5.589287945900324e-01   +7.374527720040722e-01   +5.564895142467966e-01   +9.155374162397787e-01   +4.204366632505666e-01   +2.857533174793662e-01   +3.694803095499160e-01   +5.123489238397543e-01; +4.559836562033400e-01   +1.910353226900352e-01   +8.454437310721026e-01   +7.258908968356982e-02   +5.575110539690882e-01   +6.126334918467131e-01   +8.335221392113107e-01   +1.282845895203755e-01   +2.284064751201580e-01   +2.141908757960245e-01   +1.488790205527327e-01   +5.291565291634182e-01; +4.127185046304483e-02   -4.169846933724899e-02   -3.920186079524864e-01   +7.751155344868462e-01   -1.743215930589454e-01   +6.408379592928807e-01   +2.251997610474938e-01   +7.136646146407114e-01   +5.183457323578344e-01   +6.401670584354224e-01   +3.933471380733796e-01   +4.399480504839585e-01; +3.901306266216183e-01   +6.845419434907296e-01   +5.029399336172155e-01   +2.738242287322850e-01   +5.778759227979208e-01   +1.236963808875846e-01   +4.048619739821941e-01   +3.874647518866411e-01   +4.778303973197698e-01   -8.068735293459021e-03   +7.506104369920803e-01   +9.851436537736007e-02; +6.999267273033841e-02   -2.216174558316235e-01   +4.538733277496737e-01   +4.606965246227261e-01   +1.830986340970352e-01   +1.384052861696423e-01   +5.456463887911535e-01   +4.214765334303360e-01   +2.642239471998187e-01   +5.584397642841067e-02   +4.530243613818203e-01   +1.712749706672825e-01; -3.147539321704381e-01   -8.396545124666552e-02   +7.064994403134618e-01   +5.580793637449367e-01   +3.984654233511775e-01   +5.916377289387691e-02   +1.058543386768431e-01   +2.270810465717460e-01   +5.257306847101381e-01   +3.421088884911832e-01   +4.389669145525998e-01   -2.707482708387161e-01; +6.611027540707046e-01   +2.714901232561265e-01   +4.571444548233588e-01   +8.557425473602601e-02   +5.455760645846247e-01   +2.802132643992784e-01   -5.948198725305004e-02   +6.040707369464341e-01   +5.110634722312992e-01   +4.014059583214146e-01   +5.505712398350564e-01   +3.199576941128618e-01; +2.011634516353529e-01   -1.033456524607644e-01   +1.680401445392865e-01   +6.194585897574207e-01   +6.797994935790144e-01   +3.555542932492450e-01   +2.811213791451285e-01   +1.008026376946444e-01   +4.663116274659381e-01   +1.595360026341854e-01   +4.672424345677740e-01   +8.173800111914149e-01; +1.698584005349705e-01   +2.408371065447081e-01   +4.180761005768298e-01   +6.746602491773633e-01   +5.555860078120274e-01   -3.843709353931905e-01   +6.457710937681818e-01   +3.486397286083215e-01   +1.325538307618119e-01   +1.645939287340711e-01   +4.703205469124983e-01   +7.851044293530625e-01; +2.459753015467555e-01   +7.687032852971747e-01   +8.550603310852661e-01   +9.760149721785497e-01   +3.903994033300383e-01   +3.356257022321453e-01   +7.405950542432685e-01   -3.410008928587339e-01   +7.372210428219940e-01   +3.347514321071860e-01   +1.400004525738702e-01   +2.557755914575697e-01; +4.000366282776128e-01   +5.923486903711948e-01   +1.412722048178178e-01   +6.590670041448281e-01   +4.983645118610627e-01   +3.033109796174877e-01   +5.073833929317149e-01   +7.179733893595688e-01   +6.257151862659025e-01   +2.223943803423514e-02   +3.081006131067633e-01   +7.237074265709692e-01; +6.883552406682294e-01   +2.437274869164941e-01   +2.898888172131304e-01   +4.903360242083725e-01   +3.848973169508106e-01   +4.854990263961053e-01   +3.750073416469997e-01   +2.362852039954423e-01   +1.785346118136785e-01   +2.757459224847704e-01   -3.206074848195248e-01   +4.442678019572842e-01];
L2E_Input1_iAMPA_netcon = [+4.514518795689109e-01   +6.036267618244325e-01   +6.519391899490488e-01   +8.536419652030607e-01   +9.227151421609600e-01   +6.282724061889988e-01   +9.973422059554424e-01   +5.027932137802076e-01];
L2I_Input2_iAMPA_netcon = [+9.174787833090430e-01   +4.133257002495244e-01   +4.844998172196010e-01   +5.288516719093249e-01   +4.807174305311243e-01   +8.934633658650221e-01   +8.573852493847489e-02   +6.019575942164047e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.4*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.4*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.4*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.4*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
