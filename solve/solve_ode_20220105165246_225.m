function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+8.235854070781775e-01   +4.228211583687433e-01   +5.303038362955704e-01   +6.368483656653352e-01   +6.001474494408404e-01   +3.414095221102467e-01   +6.477437383864413e-01   +8.393025497336609e-01   +5.443129925202335e-01   +1.930774290059202e-01   +4.476966337615968e-02   +8.224170857891644e-01   +7.676955834703864e-01   +1.096546775442957e-01   -5.221768442330150e-04   +8.431674735185476e-02; +9.836052699636472e-01   +9.571575962036270e-02   +3.242665698498556e-01   +9.565796360930036e-01   +3.871078750039035e-01   +6.065626408229841e-01   +6.785346974113614e-01   +8.317801453892385e-01   +7.224705387486191e-01   +1.382917954138685e-01   +7.534227707145466e-01   +4.300794737963442e-01   +1.675608445985816e-01   +1.356473001032359e-01   +8.652060084734147e-01   +6.267486786624822e-01; +7.307540792823571e-01   +5.973882257005776e-01   +1.059037105634554e-01   +2.419090695929491e-01   +9.156322015393160e-01   +1.914751590784812e-01   +6.346514802253395e-01   +2.563299184734316e-01   +5.212379001984564e-01   +6.959736606080130e-01   +2.419643315268845e-01   +8.874422867937360e-01   +8.637553070802733e-01   +6.787306715410981e-01   +6.127638237610141e-01   +6.613916684896683e-01; +3.438492636279285e-01   +4.723594430929683e-01   +6.118765281782022e-01   +6.753923246567743e-01   +1.009278701026641e-03   +7.389736244478342e-01   +9.455781595887435e-01   +6.133695188887448e-01   +9.935603801144703e-01   +9.284326219372049e-02   +4.429115645185913e-01   +3.920380951888743e-01   +9.903924870965475e-01   +4.940779800012784e-01   +9.886467860861560e-01   +7.304048769770766e-01; +5.859355266154010e-01   +6.959367341241359e-01   +7.796901367213734e-01   +2.886473161820757e-01   +4.626572191385426e-01   +2.422982043124458e-01   +2.092192544549604e-01   +5.822268441657025e-01   +2.210719345782555e-01   +5.239589115937040e-01   +6.875892699553062e-01   +7.692887993107543e-01   +5.156402869649064e-01   +1.894509941354202e-01   +5.266077908275801e-01   +8.926124532950386e-01; +1.086462446697526e-01   +7.005371967323487e-01   +4.243336059398332e-01   +6.708780324848075e-01   +4.250386169330752e-01   +9.188483796631399e-01   +7.090362060679058e-01   +5.408258198562148e-01   +1.046624432925967e-01   +5.307154694230310e-01   +3.585966120648125e-01   +3.972378642447310e-01   +8.838879814279260e-01   +4.944141067499569e-01   +4.807762724968609e-01   +9.822217114784032e-01; +9.056203026733397e-01   +6.396044666593882e-01   +9.038226617981478e-02   +6.945337783800196e-01   +4.609814791841300e-01   +2.701843137465866e-01   +2.373190951173176e-01   +8.707888888393157e-01   +1.111873930091197e-01   +8.619606326636077e-01   +7.368226669667604e-01   +8.102521729242956e-01   +5.873897988182728e-01   +1.480634628402828e-01   +8.023580522798658e-01   +7.693594056645674e-01; +8.808883771173607e-01   +3.345849690227460e-02   +2.653301435356158e-01   +6.702058303400971e-02   +7.703640279708123e-01   +7.654051944908328e-01   +1.196657880605241e-01   +2.647077389909723e-01   +6.543448793308959e-02   +4.852505941200070e-01   +3.942946851850087e-01   +7.549828107643499e-01   +1.551522384151064e-01   +5.347592575670065e-02   +2.284213522996463e-01   +5.830387191421016e-01; +8.179552177986203e-01   +6.825420369846587e-02   +1.538910981800912e-01   +2.529312194694157e-01   +3.240050082877063e-01   +1.900899276728819e-01   +6.078626107967726e-01   +3.164262832489776e-01   +4.040842122583492e-01   +3.923528041741621e-01   +6.844162556686643e-01   +3.774907254687215e-01   +1.999249221840292e-01   +8.511867502854211e-01   +4.964275846243022e-01   +9.264016584094329e-01; +2.602786319221246e-01   +3.188789801221649e-01   +2.817686859400891e-01   +2.217743820205703e-01   +7.840462759431023e-01   +2.861051359348167e-01   +4.517848590776322e-01   +1.191572019634636e-01   +4.476012453472876e-01   +6.716375302204589e-01   +7.044115536919546e-01   +2.166081851935582e-01   +4.075276412899668e-01   +5.618948518892957e-01   +8.987718376151692e-01   +5.813794360070098e-01; +5.939710529990631e-01   +5.299540028439867e-01   +4.420554579905194e-01   +6.682383443025274e-01   +4.704154233655177e-01   +9.098888567245390e-02   +4.587335791088710e-01   +9.403502804411495e-01   +3.652095233906408e-01   +7.421756078252241e-01   +4.428684342625250e-01   +7.901692387381488e-01   +7.483650484556066e-01   +9.301986594684015e-01   +5.759295562522966e-01   +1.624349109301243e-02; +2.321670000459616e-02   +6.542121319936428e-01   +5.264059659254231e-01   +8.442079597072700e-01   +3.575237434140799e-02   +5.782287777854437e-01   +6.623167852396193e-01   +6.458639950300081e-01   +7.626923709877695e-01   +5.192357029203164e-01   +1.849052154113701e-02   +9.497593944694709e-01   +8.241535862026130e-01   +6.980364661647872e-01   +8.447706448098415e-01   +1.212197637289223e-01; +4.261962554625070e-01   +4.078931858031952e-01   +4.584736860706087e-01   +3.449466602018494e-01   +1.769044679589885e-01   +6.840159215087694e-01   +7.701754846021870e-01   +4.799126224233506e-01   +6.265163997407056e-01   +3.451337272351646e-01   +3.294761883635318e-01   +3.286123626229279e-01   +7.915398755723395e-01   +5.842136189231687e-01   +7.389909706665460e-01   +8.623274898233222e-01; +3.119969643914604e-01   +8.192076049142254e-01   +8.751023906791248e-01   +7.822306929871643e-01   +7.205338899407260e-01   +5.470752380326919e-01   +3.501074599024758e-01   +6.397852053312664e-01   +7.726964019605438e-01   +1.497738123639004e-01   +4.232861797063409e-01   +6.724165252124075e-01   +3.192010521048592e-01   +8.155162943860285e-01   +5.861676133953334e-01   +4.835173296997016e-01; +1.603020635565729e-01   +7.204924742461223e-01   +5.194685561850300e-01   +6.764704266026530e-01   +4.738494334354431e-01   +4.240072644674435e-01   +6.621506344341461e-01   +5.444585016610348e-01   +9.330848670179622e-01   +5.863926132919216e-01   +2.693206776452717e-01   +4.399670876889558e-01   +5.336060849318360e-01   +8.810918420371812e-01   +2.449762090064522e-01   +8.448963543377495e-01; +1.778451913923355e-01   +9.685176901053195e-01   +9.449587728708212e-01   +7.495056808160241e-03   +1.529842900954808e-01   +6.431750730870347e-01   +4.154661500556697e-01   +6.470323606314310e-01   +9.734254891817583e-01   +2.613320430413237e-01   +1.969108504296869e-01   +8.330267516469602e-01   +9.022207866325629e-02   +9.890030245435709e-01   +6.654981855559993e-01   +2.095375203337319e-01];
L1E_L1I_iGABA_netcon = [+5.511709096191014e-01   +6.941905402699056e-01   +1.050260925843291e-01   +1.770057851076296e-01   +5.491668601966367e-02   +1.788451262844440e-01   +5.961610350747109e-01   +9.965710188132617e-01   +3.394168798370755e-01   +7.790972601679785e-01   +6.835313394618563e-01   +3.653186072634675e-01   +7.830575394190212e-01   +4.326841541604932e-01   +5.967413492769306e-02   +9.712430609838252e-02; +6.314106914618216e-01   +4.991792033988163e-01   +1.423412205042243e-01   +3.984764956524928e-01   +1.778236348789007e-01   +3.605971496257676e-01   +3.003539924220790e-01   +3.308862541610674e-01   +2.937790084453272e-01   +3.377208681883551e-01   +1.315923821634906e-01   +3.688484148254162e-01   +1.008717687090629e-01   +6.548035953224663e-01   +3.141660291658241e-01   +1.419427717403291e-01; +3.269381598249840e-02   +5.350936741321616e-01   +1.670541817125310e-01   +1.333215718344083e-01   +6.609335862254418e-01   +5.641971510601345e-02   +1.347492599103829e-01   +2.972657355936209e-01   +7.456732306706476e-01   +6.077387742071728e-01   +7.231122529496672e-01   +6.845854679278137e-01   +2.929086465033873e-01   +1.113617970259384e-01   +7.718327282300644e-01   +1.689799221930151e-01; +6.146312513140291e-01   +4.433099504587492e-01   +6.223378318909817e-01   +2.926302282205301e-02   +3.323769711688913e-01   +5.219210133065861e-01   +2.110408728165583e-01   +6.213590769675666e-02   +1.089135894021845e-02   +7.416118604735095e-01   +1.100150134490380e-01   +5.979770668613468e-01   +2.365568502594967e-01   +9.318874159859762e-01   +6.956150415548650e-01   +1.957886626384448e-01; +3.633534611661064e-01   +1.237007516930360e-01   +5.743358414998296e-01   +9.383210672490501e-01   +8.984711189663818e-01   +3.345910735810539e-01   +8.957018649568922e-01   +2.977908449900946e-01   +4.786175460248319e-02   +1.055439427493589e-01   +1.170546434099535e-01   +7.886632968853025e-01   +5.299431644105358e-01   +1.856587203831549e-01   +1.250372387729010e-01   +3.172837099306270e-01; +4.939275930742194e-02   +4.914644491456905e-01   +5.277723378194774e-02   +3.025721666475739e-01   +1.172136173297199e-01   +1.737673982697248e-01   +7.196565245907321e-02   +4.470857482288725e-02   +6.677793967028685e-01   +1.266354270104104e-01   +6.402973239680977e-01   +3.684430104513376e-01   +9.266336170636963e-02   +2.667135439100860e-01   +1.278306975320787e-01   +3.175187651157085e-01; +4.872448541987542e-01   +8.529469793467266e-01   +9.323541898866120e-01   +2.961303685915507e-01   +9.884326023376524e-01   +2.105248328004971e-01   +2.430950695886707e-01   +5.058356092134236e-01   +6.045277269777874e-01   +5.486582106361552e-01   +3.289633926963237e-01   +2.056074288110287e-01   +4.057436017762854e-01   +7.977719632869240e-01   +9.150539585033581e-02   +2.171937199788040e-01; +1.916630504750645e-01   +8.748013977296856e-01   +7.279672914017001e-01   +3.354400699532774e-01   +5.414012786728286e-01   +9.055378239056878e-01   +5.428526642588943e-02   +7.606377155857559e-01   +5.264768603760333e-01   +4.852999400315631e-01   +6.541310194918531e-01   +8.742554588062693e-02   +1.040551779508474e-01   +4.879362602155465e-01   +8.644915542727798e-03   +2.518180574132910e-01; +1.224623292625221e-01   +2.706774472433480e-01   +7.370926965055478e-01   +4.684155062355129e-01   +7.057928722606484e-01   +6.745116253751573e-01   +4.405343611952244e-01   +6.318083714266598e-01   +7.292946216245918e-01   +8.907956975434608e-01   +7.511284375163899e-01   +7.729683911023940e-01   +1.111683817210158e-01   +7.697297253645425e-01   +4.238383675534726e-01   +8.934160866617182e-01; +2.065010417366223e-01   +2.097242280172172e-01   +6.337321154114865e-02   +6.483380452554980e-01   +9.989663235502183e-01   +4.680806790171552e-01   +1.457430642579548e-02   +9.116636810909963e-02   +7.071922336847274e-01   +7.997816395294981e-01   +5.841788169301807e-01   +2.073270257655740e-01   +7.857612687073429e-01   +3.972390887301598e-01   +6.551375835064476e-01   +7.027773016231447e-01; +1.464248474599529e-01   +5.637083538945254e-01   +8.591517757681563e-01   +2.447878213880883e-02   +2.882051970958128e-01   +9.116706022865679e-01   +8.972396004278376e-01   +8.050116803292705e-02   +7.806315763984355e-01   +7.345386672604444e-01   +7.409797930226395e-01   +3.891481398760228e-01   +2.910377305413783e-01   +2.728118345563045e-01   +7.231788730867256e-01   +5.553069988277977e-01; +1.889184663163463e-01   +6.386322164479777e-01   +9.333541837141535e-01   +8.427791941169795e-01   +4.131732172555023e-01   +1.035440952844054e-01   +1.956427699150066e-01   +7.751931448737006e-01   +2.881874853672378e-01   +5.275911572783108e-02   +2.345463516807734e-01   +5.520925196273944e-01   +6.040800576210476e-01   +3.733773738179941e-02   +5.298372891004516e-01   +1.843704895333811e-01; +4.348108000412945e-02   +4.165991121482281e-01   +9.836191712060299e-01   +5.582158454483138e-01   +4.667254891168220e-01   +7.444690018626055e-01   +9.321141397300264e-02   +9.054315384953050e-01   +6.898624345673032e-01   +7.220293853684027e-02   +7.343570162775995e-01   +2.284109305038189e-01   +9.637199142196898e-01   +6.738193383755218e-01   +1.075090677997128e-01   +2.118981769157855e-01; +6.351735312717617e-01   +2.064314502774454e-01   +8.572398543562212e-01   +8.534407562867272e-01   +7.641431998814424e-01   +7.376026335509112e-01   +3.069898406233293e-01   +5.333883488136258e-01   +5.557295839581583e-01   +8.735376537574423e-02   +9.713706785423211e-01   +6.423350734506698e-01   +4.316699558971961e-01   +4.303888328836487e-01   +6.329901166993156e-01   +7.719647400119803e-02; +2.821098075053790e-01   +9.487906977013129e-01   +7.856307103581487e-01   +3.484689159583255e-01   +8.176929066262100e-01   +5.622536104765096e-01   +4.554222586273346e-01   +1.086147902146070e-01   +3.949296826425550e-01   +7.960768600011006e-01   +8.677614073291022e-01   +4.836075155679388e-01   +6.947769747558062e-01   +4.505772876765222e-01   +1.283219915166836e-01   +9.143473615121414e-01; +5.377351459452477e-01   +8.093356505049897e-02   +5.145506924218219e-01   +4.462375817270635e-01   +9.963683597260456e-02   +1.856999665282669e-01   +1.018916022061710e-01   +8.271458561472771e-01   +6.152144741571516e-02   +9.426090130603654e-01   +8.670794945387278e-02   +1.512829111153793e-01   +7.582148677959886e-01   +6.081921621494033e-01   +1.342243056446098e-01   +7.073920518045260e-01];
L2I_L1I_iGABA_netcon = [+5.586752275601655e-01   +1.592856320276536e-01   +4.234019118824777e-01   +6.830804716084815e-01   +8.088525350313008e-01   +7.953081263248808e-01   +7.884984257907445e-01   +2.611589709731059e-02; +3.128657289031638e-01   +7.585356633119978e-01   +4.290265813867027e-01   +4.632547449949037e-01   +7.479609597245470e-01   +5.776956070908124e-01   +8.509399035018892e-01   +4.210273591230544e-01; +1.655361055390266e-01   +8.704657673676411e-01   +1.250712260970208e-01   +2.133842196830087e-01   +1.188972593274931e-01   +4.412739346379464e-01   +5.062373712230817e-01   +1.830455870983565e-01; +6.213587760002586e-01   +3.509807771073440e-01   +2.376198801631645e-02   +9.876207663315408e-02   +5.251499111220189e-01   +2.573499224580232e-01   +6.357635295549977e-01   +7.264961220128958e-01; +9.877196285202596e-01   +6.858539518546236e-01   +2.899611801104487e-01   +8.231863114791093e-01   +3.253760189273139e-01   +7.520001622909634e-01   +9.518837977760750e-01   +3.698971325696194e-01; +1.710021340589755e-01   +2.933344319800645e-01   +3.184117933319798e-01   +1.759083146534959e-01   +5.462012529466834e-01   +2.288329966748616e-01   +4.442309250267389e-01   +8.417660066155459e-01; +2.583403896896758e-01   +5.301408720007849e-01   +6.541320777232340e-01   +1.641929959638400e-01   +4.005054443502140e-01   +6.549801009268708e-02   +5.832501426345470e-02   +7.330207123978456e-01; +3.971633554330689e-01   +8.327643717523243e-01   +9.570896375611435e-01   +6.677707737863673e-01   +4.151743228041411e-01   +7.666737908344806e-01   +8.674794024442065e-01   +5.694589519402600e-01; +7.468224185924872e-02   +5.991303423849230e-01   +9.369230137790153e-01   +8.933069360811328e-01   +1.793752425727126e-01   +6.717787982551603e-01   +6.310025546223843e-01   +1.775927144367690e-01; +6.839013296571873e-01   +3.350396124986953e-01   +4.582066872302401e-01   +5.164241021932319e-01   +2.555552796111396e-01   +7.143703995206612e-01   +3.532167286103313e-01   +9.592987187916062e-01; +4.036493950632316e-01   +2.990387257366443e-01   +2.398058957073725e-01   +7.027099542692716e-01   +1.955325142434942e-02   +6.426342338677982e-01   +9.968844344097753e-01   +2.655084229612995e-01; +9.825989869019082e-01   +4.531842849015710e-01   +7.645592033468417e-01   +1.521742007164689e-01   +9.231467325397194e-01   +4.188845773662607e-01   +2.248894681581500e-01   +9.246442203581117e-01; +4.009679333969161e-01   +4.237580086811026e-01   +7.593731956159298e-01   +9.530107871510136e-01   +6.544670929040344e-01   +3.903806556013818e-01   +6.520627601838188e-01   +2.219649064094608e-01; +6.217100595492508e-01   +3.596397521702455e-01   +7.399059682726608e-01   +5.402204869375739e-01   +9.333011794841566e-01   +8.172624227607951e-01   +6.041891762553308e-01   +3.726931617588054e-01; +1.552471350537752e-01   +5.605005457028323e-01   +7.445611496520379e-01   +6.810697425597415e-01   +1.640803054225377e-01   +3.163270225182139e-01   +3.875122723226236e-01   +8.789597194669782e-02; +3.821409856335824e-01   +7.431687309314693e-01   +1.082396813279186e-01   +3.722123689895857e-02   +9.219550133036897e-01   +8.158895262333179e-01   +1.401768266057606e-01   +6.415841735940789e-01];
L1I_L2I_iGABA_netcon = [+1.814830062481977e-01   +9.116363266412055e-01   +2.760963219580503e-01   +8.703537506173671e-02   +5.332296179861979e-01   +1.069951719765973e-01   +9.884734223220407e-01   +4.117868480779527e-01   +7.197644344564075e-01   +2.180127541411510e-01   +9.221188142156264e-01   +6.736506518636686e-01   +1.066587938100808e-01   +5.563191915482234e-01   +6.304425128332499e-01   +4.840983318097824e-01; +4.589778609954900e-02   +7.999343464789149e-01   +2.474993362416636e-01   +8.027648057348020e-01   +8.866679540309405e-01   +6.150425707077124e-01   +7.668773380710938e-01   +6.009957668190683e-01   +9.969998021199438e-01   +1.263028563871119e-01   +7.701101453046776e-01   +4.774497383859174e-01   +1.807837030139734e-01   +7.715588534026533e-01   +1.004073455655213e-01   +8.947437297381128e-01; +7.230956082507700e-01   +7.445632635052979e-01   +4.520271773932688e-01   +9.891483442038451e-01   +8.984766169750591e-01   +9.406279125973522e-01   +3.364183496217493e-01   +7.492940778424710e-01   +3.542736827300028e-01   +3.085013679928198e-01   +4.265867942338921e-02   +6.236760175090109e-01   +9.994527176857004e-02   +3.125171933677718e-01   +3.920421945858265e-01   +1.388163591455362e-01; +3.483001947335645e-01   +8.127179505290162e-01   +2.268886595117991e-01   +6.652774140229573e-02   +6.260264178761726e-01   +3.532535413695913e-01   +6.629203362688082e-01   +5.847472331177582e-01   +9.707395775949067e-01   +7.252056103417882e-01   +3.792628864013136e-01   +2.376490012956153e-01   +4.903747925162191e-01   +1.784110353149424e-01   +5.527568390480358e-02   +3.893387637841384e-01; +6.604481293726429e-01   +3.836008613327459e-01   +8.047634885749321e-01   +9.399388003952832e-01   +1.375638126231130e-01   +4.108862936475130e-01   +2.455762424923061e-01   +5.514316660446403e-01   +3.477052532842413e-01   +7.827918933793366e-01   +7.040869759654912e-01   +1.779952431820304e-01   +1.924664965772191e-01   +3.384337786252473e-01   +5.004751356435396e-01   +9.274732677884228e-01; +3.852447701435081e-01   +6.183073760121947e-01   +9.855322050822668e-01   +1.775087660537689e-02   +2.188962511763044e-01   +9.840459806150070e-01   +2.943203557027224e-01   +5.809310688780702e-01   +8.859359832941270e-01   +6.922943232415452e-01   +7.276194658900353e-01   +8.287533486037963e-01   +8.939703608199729e-01   +2.098170759813439e-01   +4.312658620214295e-01   +9.192722215252875e-01; +6.280625018831547e-01   +5.769628544229000e-01   +3.008905962388754e-02   +6.845482082695604e-01   +1.813615762493415e-01   +9.457954773558580e-01   +6.783928801994815e-01   +5.112761946490644e-01   +4.549306147293311e-01   +9.637850675064483e-03   +2.254913863650837e-01   +7.660150634026599e-01   +9.933201380726762e-02   +5.101415526209524e-01   +9.981453014609533e-01   +7.150585119514570e-01; +2.307716172508478e-02   +5.279492323354570e-01   +5.354352492560569e-01   +7.832742645268495e-01   +4.219885740806720e-02   +6.770223903357260e-01   +5.261955807660833e-01   +8.139048517430746e-02   +4.149272535501627e-01   +8.450002452130689e-01   +2.688178868377135e-01   +9.348652018241782e-01   +4.463942867364693e-02   +9.050359033543594e-01   +8.104952679801990e-01   +6.179048659674529e-01];
L2E_L1E_iAMPA_netcon = [+3.424181692685233e-01   +7.583864447415779e-01   +5.893909437212369e-01   +5.015697853188484e-01   +8.513440270916162e-02   +4.733871427994068e-02   +9.236431792125946e-01   +4.755718996373796e-01; +9.368188433358052e-01   +4.144096331625874e-01   +6.617067296236038e-01   +4.890568042121949e-01   +9.743639603747866e-01   +3.435012856985979e-01   +8.011599051256614e-01   +3.641630726357009e-01; +1.238108593848311e-01   +4.934714924312687e-01   +4.794403186861226e-02   +8.787521498910260e-01   +6.510426202669469e-01   +7.373110842951743e-01   +2.862243767241839e-01   +7.882057595175543e-01; +7.315562850964508e-01   +6.958378264656845e-01   +3.483444005626438e-01   +3.523028902945501e-01   +2.310581752865352e-01   +7.954436169829392e-01   +5.437428905701438e-01   +7.807553005670662e-01; +6.470424370236613e-01   +9.740058971302925e-01   +4.489166424053524e-01   +4.490339834422173e-01   +4.024168230473443e-01   +5.452028946253512e-01   +9.836308824299630e-01   +6.684478828426471e-01; +8.335853973983998e-01   +3.278447075743713e-01   +2.389387207045975e-01   +9.636766669208252e-01   +1.210521752619417e-01   +6.873461795871468e-01   +7.153264700049924e-01   +1.336441374806197e-01; +3.970341278063669e-01   +8.377646872700495e-01   +7.147866740062836e-01   +4.254301678635102e-02   +2.688093543544497e-01   +8.951177517720197e-01   +8.381326024782546e-01   +1.967640996840428e-02; +7.499851990521843e-01   +7.399894305195208e-01   +8.569301945657287e-01   +9.736621151823240e-01   +2.558422183767751e-01   +5.418167389169116e-02   +4.348678322193766e-01   +5.598722879390701e-01; +8.349017940708509e-01   +9.536491380562933e-01   +2.828337169407112e-01   +1.875858741407222e-01   +3.328553628887133e-01   +3.040858328097460e-01   +4.711294052717021e-01   +3.016789168703233e-01; +3.239892520894231e-01   +3.314705406079482e-02   +7.311276559234730e-01   +6.660838879426079e-01   +1.498463537473542e-01   +4.508715825010566e-02   +5.612438140374345e-01   +9.389087880128812e-01; +5.512534973011327e-01   +3.553802148690487e-01   +1.399728969851423e-01   +5.876452570602700e-01   +3.475987394636607e-01   +1.950495075512254e-01   +2.697615253229030e-01   +9.820165274293096e-01; +9.814610645084222e-01   +6.621583071627074e-01   +8.388044751126372e-01   +6.751648087917206e-01   +1.202680890696323e-01   +7.185807261072500e-01   +7.484564133286958e-01   +2.866469086318768e-01; +5.484019303473233e-01   +2.815517664245756e-01   +1.387400193684171e-01   +3.591436855049424e-01   +8.831239927221292e-01   +7.221652722484292e-01   +5.044618271158425e-01   +8.001734779036740e-01; +3.309413225515960e-01   +2.303257473164847e-01   +5.873647523572220e-01   +6.201454705072375e-01   +9.526971844001317e-02   +8.778549428578114e-01   +6.471134145568805e-01   +8.949761625805414e-01; +6.189659843609029e-01   +7.105562122282826e-01   +3.667276263283867e-01   +8.110155613307752e-01   +9.310768879008681e-01   +5.807297796824459e-01   +3.074581166639347e-01   +5.982625260130852e-01; +3.618005140725235e-01   +6.236268700723850e-01   +8.058221984961375e-01   +1.981176893421741e-02   +4.000918704324478e-01   +7.251393872218988e-02   +1.388358126793577e-01   +8.837835224867666e-01];
L1E_L2E_iAMPA_netcon = [+9.432266944464430e-01   +3.721356185592575e-01   +6.680683234573805e-01   +4.851445111625801e-01   +2.468517733805886e-01   +4.519569280206114e-01   +1.234249624646684e-01   +4.971906226276750e-01   +8.827231290363300e-01   +3.245614075748264e-01   +5.142452334329077e-01   +8.593815374097756e-02   +6.315903116453447e-01   +4.291071461742279e-01   +6.128489145670728e-01   +5.038492251717054e-01; +5.488917699612404e-01   +9.366340902337348e-01   +2.084928442630980e-01   +7.572327630817666e-01   +7.849688136485213e-01   +2.055753953165332e-01   +4.062999062634176e-01   +6.935009250690279e-01   +7.199713869027875e-01   +2.459552562541194e-01   +6.573341427008731e-01   +1.632826588083427e-01   +8.587073377740455e-01   +4.918165048692900e-01   +8.202742577092510e-01   +6.127346006771419e-01; +7.285818410514537e-01   +8.289946907238844e-01   +6.534597167268443e-01   +4.165422356648141e-01   +8.829918179134931e-01   +8.983231740021553e-01   +2.757602705686403e-01   +8.336790142711316e-01   +1.931430699463521e-02   +3.430683538636137e-01   +9.520099074078237e-01   +3.245127814788028e-01   +9.760843395702214e-01   +7.136272181870877e-02   +8.864509672193344e-01   +8.201837836215073e-01; +5.769904378283585e-01   +8.498979712091264e-01   +7.207311130894370e-02   +9.722121518602737e-01   +9.124226735002919e-01   +7.636083540525547e-01   +7.169886623846143e-01   +6.120382552479198e-01   +6.740531152714215e-01   +3.752324382508333e-01   +7.224025781254716e-01   +3.016455626185517e-01   +5.698831452667389e-01   +8.874796140239658e-01   +9.307014431533013e-01   +5.326170975338221e-01; +2.586845359223574e-02   +3.716431746961702e-01   +4.073242748839566e-01   +9.896272220818944e-01   +5.577152363838271e-01   +8.833851918127589e-01   +2.829441592784435e-01   +5.749674457607955e-01   +4.389373543426238e-01   +5.455742891338095e-01   +3.994883143500274e-01   +1.145006890321796e-02   +9.968672528293822e-01   +6.453033722040567e-02   +1.922332003537428e-01   +2.024132917223389e-01; +4.475645564348467e-01   +5.928233569600744e-01   +6.662872876887258e-01   +8.637060538169447e-01   +5.991839349935927e-01   +2.869012647038907e-01   +8.960343692565433e-01   +3.243837162548439e-01   +4.361932054459128e-01   +5.633305985368915e-01   +8.338690990472747e-01   +5.408313653135378e-01   +5.537788237225395e-01   +4.355880758459493e-01   +2.580225944670753e-01   +4.549911703221486e-01; +6.471196388069658e-01   +8.738917818139375e-01   +9.360430024021454e-01   +3.879829614454575e-01   +1.478758306400456e-01   +6.712646359355073e-01   +8.268961097711082e-01   +4.556103384747160e-01   +1.162426689962730e-01   +3.953300399539446e-01   +1.351734031938144e-01   +9.680713316226595e-02   +5.149744874571771e-01   +8.253380426427162e-01   +8.969377323548997e-01   +4.284927280176761e-01; +5.216269511760198e-01   +9.336629907090552e-01   +8.094184902909288e-01   +4.538715632614941e-01   +9.014221862497718e-01   +6.636610029666935e-01   +3.899968620911459e-01   +7.143711671685440e-01   +8.146021755247097e-01   +3.973458669812701e-01   +5.998471780500760e-02   +1.469806746596192e-01   +3.316761796882250e-01   +3.927717103086310e-01   +5.941826669676118e-01   +9.657574798741643e-01];
L2I_L2E_iAMPA_netcon = [+6.193495196474413e-01   +6.961251057789513e-01   +7.341001195188824e-01   +5.905748960953983e-01   +6.696740858992004e-01   +5.486311705611070e-02   +9.915658494344930e-02   +8.480646483635971e-01; +6.968905860622239e-01   +4.261710778769996e-01   +4.298175387135731e-01   +4.591299651559316e-01   +5.007428760236666e-01   +1.535965716619699e-01   +9.080015492531590e-01   +9.170315791421777e-01; +7.211164710730635e-01   +8.366919253494421e-01   +6.938947457285808e-01   +5.171770946966078e-02   +2.191846258350318e-01   +1.964292406046486e-02   +1.106178774041168e-01   +9.867616837810591e-01; +3.470536448392432e-01   +7.304880002089583e-01   +9.452661761684682e-01   +2.286256045654907e-01   +5.723893363362629e-01   +4.348599684921930e-01   +5.177792287510371e-01   +5.039356508949288e-01; +5.178412473845785e-01   +3.601217166606551e-01   +7.840682053824289e-01   +8.340450976911815e-01   +1.219796186105260e-01   +8.317957941897695e-01   +1.430810557951573e-01   +2.709923383972049e-01; +5.570371224463714e-01   +4.540696932283053e-01   +7.054644682529093e-01   +1.497898924350297e-02   +6.707167676485265e-01   +6.165125533138744e-01   +5.591053150147851e-01   +1.011164873755903e-01; +1.579433904712702e-01   +3.877684120349485e-01   +1.095606177168520e-01   +8.643353330437619e-01   +5.997520258772518e-01   +5.193765051632251e-01   +4.373872796358340e-03   +5.083663636116657e-01; +5.635977404909425e-01   +7.751143438070821e-01   +3.896074423542298e-01   +7.905632578565297e-02   +5.595103605437572e-02   +8.637539177900898e-01   +7.677097340641539e-01   +5.843766000860364e-01];
L2E_L2I_iGABA_netcon = [+7.641731587626224e-01   +9.419180946722844e-01   +2.385895602276109e-01   +8.335590602505959e-01   +2.576017765279903e-01   +7.528710389940277e-02   +1.735164401197402e-01   +5.239750423935058e-01; +8.273269181933325e-02   +6.569440409832396e-01   +5.781945737972325e-01   +4.025752835383355e-01   +2.986801992510817e-01   +3.945615696135660e-01   +1.393092120960122e-01   +2.648132036194120e-01; +6.600325638087826e-01   +4.516597468674092e-01   +8.665318815292131e-01   +3.908612454499036e-01   +4.248451009292979e-01   +3.745351231840795e-03   +5.983293937236481e-01   +6.806103466686103e-02; +5.168009888813274e-01   +8.398160761376526e-01   +4.055371381266318e-01   +3.620306132323253e-01   +1.184376243130266e-01   +2.197969345046219e-01   +8.994281860561731e-01   +4.363973889642931e-01; +1.721534045302658e-01   +5.332784251899804e-01   +1.117990192621207e-01   +1.382465698165549e-01   +4.971097917999636e-01   +7.034961017345578e-04   +9.386689443447219e-01   +1.730648337311335e-01; +9.398826452247785e-01   +5.539097097250183e-01   +4.437116778857716e-01   +2.576829815852193e-01   +7.065953323909078e-01   +1.903959124508075e-01   +2.199547722969959e-01   +2.722920310858764e-02; +5.909022086167870e-01   +6.806668175011481e-01   +2.977924716585641e-01   +8.653971508206253e-02   +2.433986697371186e-01   +1.424353898767033e-01   +4.814066880463331e-01   +9.537657820738636e-01; +4.404156578872520e-01   +3.670219865722403e-01   +4.008699897073224e-01   +4.293273050467808e-01   +7.846275597894586e-01   +2.679085757878571e-01   +3.765298504841056e-01   +4.309059972104006e-01];
L3E_L2E_iAMPA_netcon = [+9.615407832674737e-01   +7.732179773649509e-01   +9.110407798894520e-01   +5.311216996956760e-01   +4.795428350370384e-02   +8.190165141790914e-01   +6.250299366431524e-01   +7.487670709550910e-01   +6.736229592992640e-01   +9.055548161909728e-01   +5.824321059260182e-01   +5.899055642145697e-02; +7.622073030502982e-01   +2.271856752587107e-01   +9.075494210229604e-01   +7.163079544191370e-01   +5.521514004216954e-01   +7.268942261429014e-01   +5.419979267628612e-01   +6.461534186708002e-01   +4.317254062645483e-01   +3.938950727768030e-01   +6.868008840230768e-01   +9.807097845570085e-01; +8.315008755822346e-03   +3.706627864658866e-01   +5.915257320908902e-01   +1.798049711880335e-01   +2.745221395883198e-01   +1.776693996002690e-01   +4.379057975786516e-01   +1.220044099889737e-01   +6.926373920138237e-01   +2.512105644332419e-02   +7.203680952959790e-01   +2.849345796513721e-01; +6.799176074793161e-01   +8.920516650982390e-01   +3.312996675367866e-01   +3.353920516692070e-01   +2.431417283781830e-01   +3.610468817941820e-01   +2.868105925338040e-01   +5.053556474542994e-01   +2.571324589280081e-01   +6.704836083579602e-01   +6.494344631941034e-01   +5.937350115282368e-01; +7.048605404659338e-01   +8.567002751971917e-01   +8.530499087716583e-01   +1.869569377296194e-01   +2.425885997819462e-01   +1.871768734117383e-01   +5.013736757769985e-01   +3.474518793837994e-01   +1.164507112280541e-02   +8.369769809000955e-01   +7.255327570916836e-01   +9.613997302678469e-01; +6.451698875777249e-01   +4.012443851795924e-01   +4.424946556576965e-01   +3.214315617039888e-01   +1.545424950482185e-01   +1.127682341115037e-03   +7.630257869418307e-01   +9.096683819944230e-02   +5.316821743344415e-01   +9.712269949852715e-01   +3.744564246879125e-01   +1.871433900123719e-01; +5.537907108386645e-01   +3.190123379861619e-01   +9.023973955636500e-01   +4.040045770875554e-01   +9.584567341552576e-01   +3.144536757873396e-01   +7.616541092532718e-01   +1.479657537391217e-01   +2.797995652738627e-01   +5.666868358728732e-02   +5.805038386792171e-01   +1.927124366350302e-01; +2.177368110822525e-01   +6.088063683779930e-01   +3.425018084381592e-02   +5.486705388962853e-01   +9.362889713357689e-01   +6.985584506521404e-01   +5.769216513666594e-01   +1.989218683575008e-01   +9.459842166929163e-01   +4.495537904453707e-01   +1.148829530113256e-01   +3.406056776036989e-01];
L3I_L2I_iGABA_netcon = [+9.332712650712384e-01   +9.268517710563273e-02   +6.167365376543890e-02   +2.785091505631295e-01   +2.548292314688920e-01   +4.044853922522920e-01   +5.293113685687389e-01   +1.090269278332821e-01   +9.126738676370839e-01   +5.846869549866219e-01   +2.086931079986183e-01   +9.081642847492083e-01; +3.904781802553932e-01   +6.165632482645053e-01   +4.945203057299414e-01   +7.460688953980105e-01   +8.576251560154542e-01   +9.880118876400494e-01   +8.293123724631537e-01   +2.711144007948655e-01   +6.392731953369152e-01   +2.839246128089916e-01   +3.178286644810079e-01   +5.510932147479619e-01; +2.723885498989507e-01   +1.159126426551274e-02   +6.431678713270033e-01   +2.382029947866257e-01   +9.113399047162558e-01   +8.978486021730792e-02   +8.577157050213704e-01   +5.241677111274107e-01   +2.551958590835312e-01   +8.277874307666911e-01   +1.330861742999949e-01   +3.380229299977723e-02; +1.525540303519918e-01   +5.731160713362214e-01   +2.227208808307012e-01   +9.574576753002113e-01   +6.989931110787422e-01   +3.219736618385071e-01   +7.881591550128763e-01   +9.721871615960397e-01   +9.046547887499147e-02   +1.918436276496577e-01   +6.727033330233302e-01   +5.396947303344556e-02; +3.964966881175687e-01   +7.877764177191053e-01   +8.374752527389022e-01   +6.216397402246147e-01   +7.262695118745817e-01   +5.133315223123768e-01   +3.186611493823391e-01   +7.085420194290358e-01   +8.384901784557613e-01   +4.411905394672708e-01   +5.701298793415041e-01   +8.061320571454257e-01; +3.747726708130808e-01   +2.358505701311317e-01   +9.707885535002072e-01   +6.009304890206179e-01   +2.300067762550790e-01   +5.913554034724929e-02   +4.524099144742317e-01   +3.104328418831470e-01   +5.843544671762679e-01   +3.932910700253515e-01   +1.706394113045052e-01   +4.515167778989188e-01; +1.291699173182487e-01   +4.476997970436332e-01   +8.467536930515833e-01   +1.726104108077536e-01   +5.744277299637245e-01   +7.250109485985079e-01   +7.526720971592471e-01   +2.933771663414694e-01   +9.482274681472022e-01   +8.271095932612373e-01   +1.481551321289998e-01   +3.809144193023644e-01; +4.341449207059657e-01   +5.692881182086137e-01   +5.064660655404409e-01   +8.971213457646492e-02   +8.111596713076561e-01   +5.570832095546604e-01   +1.110533793516891e-01   +8.495464322466980e-01   +6.176240045380447e-02   +6.785678314066210e-01   +4.761233794241647e-01   +7.904470693052356e-01];
L2E_L3E_iAMPA_netcon = [+3.647229010479626e-01   +7.560944593600640e-01   +7.390959959099695e-02   +5.175404500381644e-01   +7.576393684056295e-01   +4.322276287968440e-01   +1.999114022241088e-01   +8.757704927989326e-01; +5.315600667150990e-01   +9.975903396340819e-01   +5.912861120785822e-01   +9.947652292026302e-01   +9.953122984635576e-01   +5.428762448047411e-01   +1.938725940932480e-01   +7.864531255947851e-01; +7.130282555939187e-01   +1.877619232427995e-01   +9.103965048076623e-01   +8.567856673675559e-01   +9.625370208740917e-01   +7.121667216125652e-01   +3.263489070131112e-01   +4.663957535278002e-01; +8.711178929195127e-01   +7.811379612130477e-01   +1.920199986550237e-01   +9.611354769265263e-01   +5.353914194818605e-01   +1.592148805542844e-02   +8.800975137094496e-01   +8.137046669386575e-01; +3.288177158395602e-01   +1.953837979556430e-01   +4.318333304875701e-01   +6.782520393576812e-01   +9.654403964166256e-01   +8.016026521704541e-01   +4.712942464990632e-01   +8.972314637799252e-01; +6.492537352367773e-01   +9.923435113852159e-01   +7.491060155112708e-01   +4.025377307107799e-01   +1.168063849073994e-01   +1.424048306259884e-01   +4.040947942381360e-01   +4.280283460778873e-01; +9.763509259157073e-01   +8.020534153139535e-01   +4.016050054662013e-02   +9.333156377825608e-01   +4.989930806471957e-02   +4.792704358848240e-01   +1.801296041522168e-01   +3.339710748088939e-01; +7.640739326560260e-02   +4.244231129844452e-01   +9.463110444363265e-01   +4.800936389169301e-01   +3.029486413391477e-01   +2.551632735877365e-01   +9.692718040745352e-01   +5.967406147665488e-01; +5.885020164553699e-01   +7.284391213716118e-01   +7.632946341647016e-01   +2.299025019478470e-01   +5.813637655525196e-01   +3.694791200892255e-01   +4.086174956998956e-01   +9.008856060954149e-01; +4.130365456418096e-01   +4.978529366416847e-01   +5.570197062365897e-01   +3.965205309629157e-01   +5.318885508567232e-01   +6.614962970342472e-01   +8.440222506767071e-01   +7.019994553529538e-01; +3.082916361220461e-01   +8.086660800488273e-01   +1.836648469076937e-01   +7.047200135724587e-01   +9.005269181072053e-01   +1.681124004260788e-01   +6.169277638921832e-01   +3.785805759842739e-01; +2.635353279080572e-01   +3.568335379979858e-01   +5.002633804370701e-01   +5.582879325526940e-01   +5.402365947678591e-01   +2.799878092375703e-01   +3.748039434330396e-01   +7.351278715262892e-01];
L2I_L3I_iGABA_netcon = [+9.545668731717516e-01   +3.166484321321782e-02   +9.059909018341021e-02   +4.593660833139521e-01   +3.274394401923926e-01   +3.677956776226172e-01   +6.851632504912285e-01   +8.046495910627041e-01; +5.427452769115867e-01   +2.083293565786394e-01   +5.934005962174526e-01   +6.380308303656385e-01   +8.040571321947882e-01   +2.095265300290126e-01   +9.099095891075504e-01   +6.660656638903024e-02; +5.385735050466325e-01   +4.546521640243870e-01   +2.405721193052143e-01   +9.163057200410580e-01   +9.999949957120706e-01   +4.408214167667716e-01   +6.106872122781100e-01   +9.487600519659211e-01; +3.097211576961431e-01   +1.265647882007098e-01   +8.390585953553329e-01   +1.615956432903072e-01   +9.795026850759263e-01   +9.544555166876144e-01   +8.996135545816327e-01   +4.957177949988348e-01; +6.970941060568450e-02   +9.495537314541624e-03   +8.578858556358955e-01   +7.137423785352777e-01   +1.257788181185505e-01   +1.236782616328756e-01   +1.940865624304502e-01   +7.538186479297542e-01; +1.824544755518652e-01   +7.275585827208184e-01   +9.609145215535942e-01   +5.771309972894728e-01   +2.305019969905645e-01   +4.692765767795143e-01   +7.533147151607069e-01   +7.402545581444957e-01; +9.193424014062705e-02   +3.533321916725997e-01   +4.882902730731852e-01   +4.320966655712742e-01   +2.412616283275763e-02   +8.552055551499891e-01   +3.474286790855941e-01   +8.306781796803951e-01; +4.639033096957225e-01   +7.792672421797342e-01   +2.182799287832736e-01   +8.827879537409029e-01   +6.076102098221389e-01   +4.248858277086707e-02   +4.189387993521524e-01   +1.559624272658233e-01; +1.003851331690561e-02   +4.360573191376930e-01   +2.266915403792888e-01   +3.912064825753913e-01   +1.095276033223857e-01   +6.896820487365577e-01   +1.542018881180925e-01   +4.571174960014542e-01; +9.141760873972516e-01   +4.373545556691596e-01   +5.366481512109548e-01   +1.776423633288124e-01   +4.069887482774217e-01   +9.771145194445114e-01   +8.188589581089460e-01   +6.183256966092142e-01; +6.423142503163500e-01   +5.053047322110805e-02   +7.620090837807543e-01   +6.311645541837194e-01   +8.837989591223818e-01   +2.840563221709125e-01   +6.226146756066725e-01   +9.298892648813182e-01; +2.073324563804851e-04   +4.830558220088243e-02   +3.460871198686364e-01   +6.236482035005523e-01   +5.483992639082094e-01   +1.337527751022238e-01   +7.399229009338680e-01   +8.339057550128512e-01];
L3I_L3E_iAMPA_netcon = [+8.951547830297449e-01   +2.552135169583113e-01   +7.402583983124785e-01   +6.815657166524114e-01   +6.016702177961876e-01   +7.483641804223263e-01   +7.454844917336780e-01   +2.233002058047960e-01   +4.548844076801668e-02   +8.009559942206111e-01   +2.904634063964731e-01   +8.021074029263561e-01; +5.822133889260610e-01   +3.228963929844531e-01   +6.933068426075520e-01   +2.363515141896100e-01   +8.559448173009288e-01   +5.432072166096464e-01   +1.267472729519545e-01   +3.509962859937859e-01   +2.141342142465473e-01   +2.339347411001280e-01   +4.030581955334489e-01   +1.040275110966588e-01; +5.826172506861811e-01   +4.021994543152690e-01   +8.231080037016921e-01   +4.558104784642353e-01   +9.899758893588794e-01   +3.394615231916092e-01   +8.218903972116588e-01   +2.864036147894560e-01   +3.970161258775036e-01   +9.312519386246948e-01   +8.625809346185779e-01   +8.209840474470969e-01; +8.550384091437806e-01   +4.051633578998408e-01   +8.288406629355647e-01   +3.835541482008457e-01   +9.288614802989779e-01   +8.324074197330338e-01   +2.657006733788393e-02   +9.272423787144034e-01   +3.339078424593064e-01   +7.634665484152611e-01   +6.147919866514074e-01   +8.410818792250331e-01; +3.335637190091351e-02   +3.860961523989209e-01   +2.950889036583635e-01   +5.377203771829034e-01   +4.102399829800710e-01   +5.509447214936345e-01   +4.160887393499328e-01   +5.109889414291904e-02   +2.288621821844868e-01   +8.276576097496419e-01   +9.907187235815105e-01   +3.558928144439877e-01; +8.844259146657522e-01   +6.087668648304659e-01   +3.092420560403691e-01   +9.911427174779177e-01   +9.171976965213993e-04   +9.576922624693349e-01   +7.302098780711307e-01   +5.930496595753376e-01   +9.348999407586633e-01   +5.732172086403272e-01   +2.037822110773492e-01   +4.298857801346067e-01; +4.064290828046679e-01   +1.654235039663895e-01   +5.239879479340298e-01   +7.556368755862967e-01   +5.425799725316321e-01   +8.935213160529143e-01   +7.817139096035312e-01   +1.619531723600073e-01   +6.816272001416859e-01   +7.924712027331576e-01   +8.278881967971744e-01   +5.700907335409144e-01; +3.690334074662428e-02   +1.889179441615889e-01   +3.266763928414598e-01   +9.818175384012381e-01   +2.081986545363475e-01   +3.575671479218682e-01   +3.675762556267340e-01   +8.373147237756060e-01   +9.631341937716518e-01   +3.289857156970127e-01   +6.764946502496666e-01   +6.998436662818233e-01; +7.461033685042502e-01   +9.617049781452727e-02   +8.339151749061986e-01   +2.354916244655517e-01   +2.196258486534105e-01   +5.479717165953197e-01   +7.465958436818547e-01   +1.678092111883034e-01   +4.390401411913270e-01   +2.236735314006721e-01   +2.485475161011101e-01   +7.431217078876803e-01; +1.553836346049327e-01   +3.223928718095120e-01   +8.088502010481931e-01   +5.284270570254400e-01   +3.281030423470884e-01   +3.464826108941086e-01   +8.928413837301694e-01   +5.015294622357530e-01   +9.388911992876832e-01   +3.111815057458500e-01   +4.769507137990509e-01   +7.568428590788557e-01; +1.444416169793913e-01   +7.697017750915937e-01   +5.583904491079370e-01   +5.322142058470461e-02   +9.594768643277907e-02   +6.233522760867447e-01   +2.442790397733960e-01   +9.986446500824548e-01   +6.197782841997440e-03   +5.849078912310521e-01   +3.992994252237264e-01   +3.890852549926048e-01; +6.065908292812864e-01   +2.352980553274384e-01   +2.638008372737053e-01   +7.578398641763081e-01   +7.492697454423255e-01   +7.983792611654457e-01   +1.288363399928430e-01   +3.549645492286657e-01   +6.112646025198414e-01   +8.302304666779103e-01   +5.988653644538281e-01   +4.269963484191423e-01];
L3E_L3I_iGABA_netcon = [+9.556754180411204e-01   +8.848727723452890e-01   +8.003799508092361e-01   +9.855431081002324e-01   +9.015529298310403e-01   +9.613499046961576e-01   +6.535605807023205e-01   +4.971194103967441e-02   +1.085480105951930e-01   +4.523255491913174e-01   +8.291788113545867e-01   +5.804255757246177e-01; +5.727175874296251e-01   +4.373227403559383e-01   +9.870025167936416e-01   +5.597709228544087e-01   +9.944245085761844e-01   +5.421784584396157e-01   +6.618726848360175e-02   +4.659759987835302e-01   +4.610074088921931e-01   +3.344270535540940e-01   +6.258696504167900e-01   +6.363902371255408e-01; +8.503292450764626e-01   +7.817227516483153e-01   +1.593047172009445e-01   +9.328932513706285e-01   +6.518308904831951e-01   +3.153182573936368e-02   +2.758750880504051e-01   +3.245543891879069e-01   +4.514527109921561e-01   +5.877574893752591e-02   +5.398754330022784e-01   +6.502964706328793e-01; +2.764960450448443e-01   +1.495425694289134e-01   +2.376114400507829e-01   +7.201771086461739e-01   +1.074074949702425e-01   +6.958540126448532e-01   +2.817970947994423e-01   +6.309530218745036e-01   +5.501108130685171e-01   +7.407902192743645e-01   +6.502526543748576e-01   +8.638768479911215e-01; +6.226535128641187e-01   +6.207035315667211e-01   +7.018473148243652e-01   +4.849584324366120e-01   +3.738034922422254e-02   +5.194521644928715e-01   +8.793528094325146e-01   +2.294684320009854e-01   +8.060916434561216e-01   +5.066297103058450e-01   +7.258045937229111e-01   +5.672837597844321e-02; +5.902145111800983e-01   +2.602411778041411e-01   +3.769882125578038e-01   +6.395159100767460e-01   +6.187207013288641e-01   +6.012971903132955e-02   +4.448872541131415e-01   +5.801737916383933e-01   +7.011537344483767e-01   +2.008181403370758e-01   +9.449498260139259e-02   +8.183330451594270e-01; +9.642877590858454e-01   +4.449736205616462e-01   +9.752892133182808e-01   +8.874960678819533e-01   +5.663746528543194e-01   +8.886838312619798e-01   +7.577795288323212e-01   +6.037713402316970e-01   +8.726884617177334e-01   +4.261982041577951e-01   +8.790670636840870e-01   +5.284600582105068e-01; +8.671702684848753e-02   +8.451758702739602e-01   +9.709874480318140e-01   +1.974609289713540e-01   +9.615350700473068e-01   +3.297953316257293e-01   +6.015638176188859e-01   +6.002284245663985e-01   +5.219499018623255e-02   +1.679340890216140e-01   +1.248322521160130e-02   +6.952842737948091e-01; +5.010632887912725e-01   +1.975477250011623e-01   +6.428034310265076e-01   +3.962095685573011e-01   +7.478000537310514e-01   +2.283110390640898e-01   +7.832230521344777e-01   +4.477405414221805e-01   +2.184483145917092e-01   +7.512944717007962e-01   +2.920894025743637e-01   +2.122727038269623e-01; +5.218500678186081e-01   +3.031095479928955e-01   +8.595789781936133e-01   +9.922627876680138e-01   +6.624219538440397e-01   +1.135143411037521e-01   +1.144158204064250e-01   +3.382569659168710e-02   +4.592247701478741e-01   +3.672721009786323e-01   +1.793673259222358e-01   +5.440833413915898e-01; +9.055075809933989e-02   +4.808233318564769e-01   +4.018808427989623e-01   +4.014883947854253e-01   +5.239584742636338e-01   +3.119664353062420e-01   +9.777737836517615e-01   +5.128414121878997e-01   +9.584405360547537e-01   +9.426680312351824e-01   +9.263101580726469e-01   +7.038226624824911e-01; +9.057520270056941e-01   +3.372930254320946e-01   +6.308268576006486e-01   +6.587881709952390e-01   +2.592011018766311e-01   +2.272117078192381e-01   +8.489217499904391e-01   +4.070657001574303e-01   +7.920285748832320e-01   +1.570422228904332e-02   +6.879161731027235e-02   +9.560526267364043e-01];
L2E_Input1_iAMPA_netcon = [+9.973090842976058e-01   +1.000000000000000e+00   +9.984338994759685e-01   +9.987494388476992e-01   +9.967861613854907e-01   +9.975131329998688e-01   +9.978003529660702e-01   +9.969734682743547e-01];
L2I_Input2_iAMPA_netcon = [+9.986551057942354e-01   +9.985328050257972e-01   +9.992409600024050e-01   +9.995572621257486e-01   +9.991095518339290e-01   +9.973872834650729e-01   +9.998662364677396e-01   +9.974506915583868e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
