function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.058670104579470e-02   -6.534498861377275e-02   +4.105093140959183e-02   -1.236065119803960e-03   -4.313536616421660e-02   -4.159339223416108e-02   -1.333322755980077e-02   -5.079660016895508e-02   +2.122012192950259e-02   -4.315319038762182e-02   +5.524921635742044e-03   +1.975996089090064e-02   +3.966316301274477e-02   -4.964624643982116e-02   +1.777636689943767e-02   -6.638833079381248e-03; -4.629683678705265e-02   +2.629264762517457e-02   -1.332061965331360e-02   +6.138603408966577e-02   -1.670475507417039e-02   +4.296897853751545e-02   +2.546953041104513e-02   -1.584578858261666e-02   -4.935441414099118e-02   -1.717375228831678e-02   -1.937228517998596e-02   +7.629628376896923e-02   +2.195455500213352e-02   -2.760016874726808e-02   -5.598190979643063e-02   +5.001607346973401e-02; +2.404167935487880e-02   -3.086232449306457e-02   +3.866248093387634e-02   +7.667796173928344e-02   -1.752782704765438e-02   -2.033473180680726e-02   -7.205582905578056e-02   -2.888689778351569e-02   -1.110036765469390e-01   +1.083164721255017e-02   +2.269754854307728e-02   +2.418093344459521e-02   +9.128494254862854e-02   -8.334653003704427e-02   +9.376648635127366e-02   -2.703991904135392e-02; -6.028173333108933e-02   -6.877160938491755e-02   -1.439191623171893e-02   +3.954612934189177e-02   -7.931193137224238e-03   -3.774564947028207e-02   -2.033233016354042e-02   +2.744723047711977e-02   -1.277445155028945e-01   -9.896381941097558e-02   +6.286128285617570e-02   +4.069923644357916e-02   +5.469540395223715e-02   +8.448620172797158e-02   +4.068339825505626e-02   -1.265523265185075e-02; -1.149271702811969e-02   -4.830008659914121e-02   -6.671094902715793e-04   -6.566774245563043e-03   -6.855372409385317e-02   +4.044181452474532e-02   +2.495610790018908e-02   +3.908435815664842e-02   +7.837829173844865e-03   -7.807752402847012e-02   +4.631441685393407e-02   +6.741513536685229e-02   +2.598919294540854e-02   +4.386747041525155e-02   -1.450014954923012e-02   -3.618464437994313e-02; -1.010115702130408e-01   -1.925298414293480e-03   +8.306417423186083e-02   -7.020612569674500e-02   -3.932934086582506e-03   +3.916200811544479e-02   +2.570033856820451e-02   +5.526578026262777e-03   -1.666249665467688e-02   +2.608999381320194e-02   -2.129185748259158e-02   -1.126879364593785e-02   +4.626493094885360e-02   +8.820869779246922e-03   -1.031114666589361e-01   +2.107550083027078e-02; +4.127233149304079e-02   +6.044751341584625e-02   -8.303525972224822e-02   -9.910374746741500e-02   -5.943352905351644e-02   -2.598338258874205e-02   +9.032850217666550e-03   -6.855864279221066e-02   +2.806000122592656e-02   -2.335139666153451e-02   +2.760095741581932e-02   -6.873532440222955e-03   +1.122346378459371e-01   -2.709613033590056e-02   +7.292608509063714e-02   +2.601324172471006e-02; -1.283765664231343e-02   +6.012372550382851e-02   +8.448038051989230e-02   -7.427533174981674e-02   -6.899191227370148e-02   -4.737251425530135e-02   +1.200305861861345e-01   +6.837355092156953e-02   -7.703136090259044e-02   -1.747112590801500e-02   +8.693712462105570e-02   -2.358692771205868e-02   +6.969330196970927e-02   -9.230003653526329e-03   +7.481751455372093e-02   -3.060063732698161e-02; -5.492453882573218e-02   -4.774396688351502e-02   +8.636780845343434e-02   +3.145899159070399e-02   -3.137085424252948e-02   +6.919267536763493e-02   +5.279815904228271e-02   -9.269821686592974e-03   -1.026188168415836e-01   +5.642974062924735e-02   +4.339269116367570e-02   -6.928961222330685e-02   +8.394231366581963e-02   +1.085789459788131e-01   -3.289444490775678e-02   +3.388004246982917e-02; +4.004788989325616e-02   -2.783762681679091e-02   -3.077600274881498e-03   +5.191064536829237e-02   +9.239556642955017e-02   +3.369774602946342e-02   -1.992509184143618e-02   -2.387329217559796e-02   +3.346100898790956e-02   +1.515243035221984e-02   -2.569490741549794e-02   +2.198530473166124e-02   +2.206110819769059e-02   +9.401925326852853e-02   -7.092776231100456e-02   -9.505759411243381e-02; +4.512172966140043e-02   +3.672452899348690e-02   -4.106033859421959e-02   -4.778575353160378e-02   +3.048136560144870e-02   +1.122666157322678e-01   +2.507928710417908e-03   -5.052210930544736e-02   +6.017039078469143e-02   -2.268206403334579e-02   +1.356088763969041e-02   -2.304563620045453e-02   -9.209717813008464e-02   -6.548611882350810e-02   -4.777785629536301e-02   -2.760042059195397e-02; -1.257976740831736e-02   -5.148507609256633e-02   -1.107894775933166e-02   +4.416566915998183e-02   -5.626285890218101e-02   -4.582416423132141e-02   +2.486070569077341e-02   +3.526555431849444e-02   -9.075028898717567e-02   +4.923838811665066e-02   +4.200887620829683e-03   +1.296380475045816e-03   -1.738662982233680e-02   +1.573518767498066e-02   +6.310545514251018e-02   +5.048787958197635e-02; +1.626933054298110e-02   -8.642718029315148e-02   +3.814352526106446e-02   +1.156860492086209e-02   +2.958853933539986e-02   -4.499545899269168e-02   +5.187885332735353e-03   -3.056535581132521e-02   +5.968380541814611e-02   -3.606047670431634e-02   -1.060381487949019e-02   +1.055190439532716e-01   +9.807590338757029e-04   +7.861939579338469e-02   +2.802524529977752e-02   -2.820772155725301e-02; +4.514610232970685e-02   +4.070256093811526e-03   -8.098998239557322e-03   +7.161717164634687e-03   +7.359132952509306e-02   -8.856099857020314e-02   +4.679660025406453e-02   +2.369299827886175e-02   +3.566287063369869e-02   -4.343342736748870e-03   -7.658564950695258e-02   -9.086440112131585e-03   -6.881570988945668e-02   -4.277552996314805e-02   +5.770245162976960e-02   -2.707815250925544e-03; -5.492947864514211e-02   +6.081036461924878e-03   -3.723007209122196e-03   +5.727610776059330e-02   +3.291883007912842e-02   -8.363153607323325e-02   +2.131002556105983e-02   +1.182848483735448e-03   -1.696585719370951e-02   +3.432210100287913e-02   +4.244864299624284e-02   -6.877716429781640e-03   +2.282942359730730e-02   -5.613013615019524e-02   -3.649508249545315e-02   -1.320261396427850e-01; -4.581585546563241e-02   +3.177433658432798e-02   +5.545309638695534e-02   -1.649578430685894e-02   -5.927192727807366e-02   -5.989310919975066e-02   -3.422909986693356e-02   -1.054563637259420e-01   -1.198359093656529e-02   +5.481005233908445e-03   -4.615532199813793e-02   -2.340946609051407e-02   -2.468917958990726e-02   +8.286608214936465e-03   -1.604149013718602e-02   +7.039927590670207e-02];
L1E_L1I_iGABA_netcon = [-3.071974270056149e-02   +2.534754079327716e-02   -2.856117452103796e-02   +7.975426218690639e-02   -3.421121910533406e-02   -2.038763657768981e-02   -8.276072319016076e-02   -4.295368523228664e-03   +7.501431813930461e-02   +1.076969952254520e-02   +3.307058014394877e-02   -6.412314988132975e-02   +5.569608515989751e-02   -9.458632675135182e-03   -9.476536746935041e-02   -4.694113308497193e-02; +4.066922507154229e-02   -7.570339068989919e-02   -3.896033116378728e-02   +2.031066670078946e-02   +1.311015040508040e-01   -8.271668936506268e-02   -8.944173833593599e-02   -3.208802193653769e-02   +6.160012378846183e-02   -3.018807897296209e-02   -2.652179438142782e-03   +4.302484201351827e-02   +4.705595701695547e-02   +2.566229506010769e-02   -6.286469353311458e-02   -1.413217915220265e-02; +4.206985086820966e-02   +3.203722736574006e-02   -3.558366566809674e-02   +4.336782613713691e-02   -1.100655175363574e-01   +2.461700032319646e-02   -2.958205576515063e-02   +4.643840832124978e-02   -5.406812808728330e-02   -7.877063055972137e-02   +7.744949565010995e-02   -9.068544262124917e-02   +3.734478379230399e-02   -3.285064020213110e-02   +8.457155100520906e-02   +3.166424921360082e-02; -3.600680969298611e-02   -3.286834551791703e-02   +2.053513445337798e-02   -5.278934272838064e-03   +3.190024144859781e-02   +5.333300257302713e-03   +1.137896269009665e-02   +4.158614890977796e-02   -3.839038617729809e-02   +5.279592331486977e-03   +8.575408286489576e-02   -5.405283063452164e-03   -7.578497441576065e-02   -5.200377111951032e-02   +5.490770384184779e-02   -3.707669560894400e-02; -1.357928308626629e-01   +5.018743572429298e-03   -2.469435326309721e-03   +2.894050576490148e-02   -5.711106364356245e-03   -5.987134518493548e-03   +9.490839369042778e-02   +9.337856443358655e-02   +1.008509292958304e-01   +3.122314651635275e-02   -2.709917007709397e-02   -3.900872422985700e-02   +6.313171472373734e-02   +4.169395370405022e-02   -1.576869815328348e-02   +2.180800646435089e-02; +6.104299528825574e-02   +2.548879199980577e-02   +5.462040736203214e-02   +2.696719157083104e-04   +1.729079346404715e-02   -2.613491549277380e-02   +3.360371079518958e-02   -6.127343195662893e-02   -2.590404994882532e-02   -7.701267853824027e-02   -2.018299628822621e-02   -5.262330923132152e-03   +2.199805365552151e-02   +2.746491379349500e-02   +4.956452284226111e-02   -3.858180507811444e-02; -1.948692634426757e-02   -4.911221770521307e-03   -7.224371951615101e-02   +5.517245036300012e-02   -8.897380992133254e-02   +1.765710885545163e-01   +1.011013445881509e-02   +6.547031361537721e-02   -1.875746512569780e-02   +2.387296990351507e-02   +3.425054709634900e-02   -4.145813970711350e-02   +4.902122455164926e-02   -9.226538193401725e-02   -8.288193105799468e-02   +6.286097736845211e-02; +1.249634992201438e-02   -3.263607599593761e-02   -4.576365594941204e-02   -1.855935997500276e-03   -3.956549399519002e-02   -8.636794920381213e-02   -1.009608727888641e-02   +1.298915850083792e-01   -3.949790454110029e-02   -1.849695102292430e-02   +8.673244011207313e-03   +1.338777771222435e-02   -3.526279885950338e-02   -1.397409308834224e-02   +4.193639183417754e-02   +1.120458837307173e-01; -3.554773408642497e-02   -4.688990321502449e-02   +9.062988430470047e-02   +5.391200078112580e-02   +2.880764493566370e-02   -6.262757630085430e-02   +4.501363916541947e-02   -2.211536992612019e-02   -4.923522441285665e-02   -6.001719900371491e-02   -3.756015854154113e-02   +2.542164230823507e-02   +2.569201313263728e-03   +5.747547688773799e-02   +7.027041138921723e-03   +7.714470980858235e-02; -4.129394814889147e-02   +8.033201018115286e-03   -2.456357191196574e-02   +1.522124905690399e-01   -3.947465053342397e-02   +8.189232784131073e-02   -4.498190602820056e-02   +4.744646269373144e-02   -2.427456334058386e-02   +9.027492141533843e-03   -5.967843301846892e-02   -2.743018484742226e-02   -1.367071218158093e-02   +4.583583230405407e-02   -2.356517699268561e-02   -7.388001444138224e-02; -8.438912830944688e-02   -7.202134069723584e-02   -1.223217172138153e-03   -9.354085696467170e-02   -5.966581169815999e-02   -7.982843455578195e-02   +6.009069785992584e-03   -8.409342098291327e-02   -7.740264802446953e-04   -3.025423273699439e-02   -1.587310212400078e-02   -5.949206677302570e-02   -7.641878200752605e-03   +7.687272465993886e-02   -6.743810148441631e-02   -2.391189857869681e-02; -3.911062434649491e-02   +7.189862669137620e-02   -2.193470216651967e-03   -5.316328994107688e-02   -4.519928936722180e-03   -2.018379045444336e-02   -3.981240570363268e-02   -6.101327132158794e-02   +9.446364840449827e-02   -6.661488986617605e-04   -6.420759851993812e-02   -2.533972992776966e-02   +2.461435074457929e-02   -2.919967564164071e-02   -2.701488616149660e-02   +2.709069817070566e-02; +5.582491866805191e-02   -6.431020954350835e-03   -2.665468277682434e-02   -3.692393871166200e-03   +1.897250434180122e-02   +8.610187833870028e-02   -5.752120853590008e-02   -2.920699612519274e-03   -7.596165400062618e-02   -4.560784662131039e-02   +7.898569661887232e-03   +3.550292784638078e-02   -4.567367304244938e-02   -2.209536956527541e-02   -7.859187703060617e-02   +1.169614603646254e-02; +1.666340623603495e-02   -4.940632988081457e-02   +1.349422920394977e-02   +1.872499770747672e-02   -3.799711139638924e-02   -1.310428020302317e-02   +1.175768287609445e-02   -6.765244055384147e-02   +6.287119890935608e-02   +9.557395389534831e-03   -6.891952519633933e-02   +2.817890878832709e-02   -1.102928559170294e-02   -2.961897671788807e-03   +1.148911617815186e-02   +7.212070769169202e-02; -7.236668463902432e-02   -6.354061200136463e-02   -4.999890291156853e-02   +1.673739034178461e-02   +6.403285501298225e-03   +3.010215624194034e-02   +6.178626415470943e-02   -6.215731443160392e-02   +3.837348541539123e-02   +3.863193386131709e-02   -1.599904759770522e-03   -3.429476514502931e-03   +5.547485383693825e-02   -4.117268261692332e-02   -4.628067975617312e-03   -1.008818280775426e-01; +5.021469220475530e-02   +9.778853253819460e-02   +8.634207604933113e-02   -8.761924407854814e-02   +2.301172952572158e-02   -4.467749604935231e-02   -1.493988936399280e-02   -3.250637622248809e-02   -6.546394742961470e-02   +2.960205950869543e-02   -3.479626242701189e-02   -6.180653960504552e-02   +6.225110777080955e-03   +3.163312360667477e-02   -6.907810655458238e-02   +5.061365549770923e-03];
L2I_L1I_iGABA_netcon = [-4.921434082470993e-02   +5.483326056456298e-03   +1.786369321163747e-02   -5.179956333480729e-02   -6.870530380546491e-02   -2.937127726784388e-02   +6.567250797692729e-02   -3.583865751820057e-02; -5.487315906615086e-02   -1.307323064538304e-02   -3.341763965092126e-02   -9.716941313968330e-03   +1.614308445540267e-02   -1.263481307110169e-02   +3.076797496191953e-02   +3.632006998535807e-02; -2.294895153253509e-02   +3.215231160819611e-02   -1.257582492673023e-01   +1.239968279938167e-02   +1.225342513023334e-01   -5.645737817145677e-02   -6.819327860658878e-03   -7.199424408773369e-02; -2.320720637670894e-02   +3.339955639028098e-02   -1.608443345240042e-01   +1.030455392436774e-03   -1.036858051257014e-02   +4.888581973694240e-02   -5.524736090787474e-03   -1.139166059175501e-03; -2.748906042131809e-02   -2.166196779788453e-02   -2.499797905105538e-02   +8.212956174515704e-02   +7.327889349478564e-02   +2.122326083994935e-02   -5.064389297094608e-02   +5.357280742124080e-02; +4.025585493601655e-02   +1.232224438584887e-02   +5.371880640486987e-02   +1.537923491219883e-03   +8.211908030395325e-02   +1.348949125278078e-02   -5.530981859498801e-02   -1.741430526566447e-02; -2.571548865376101e-02   +7.585701608253842e-02   -9.052172110642534e-02   +4.693504035348102e-02   +3.093432230429239e-02   +1.841978900670236e-02   +1.854911049442457e-02   +5.383504468771270e-02; -1.432804324895737e-02   -4.281487006142694e-02   -6.321818136719586e-02   +7.240540756771180e-02   +6.585818833873622e-02   +4.337688202196255e-02   -4.294824605786389e-02   +6.832486526622442e-02; -7.611098993873182e-02   -3.413081155423815e-02   +8.805968032577918e-02   +7.650655332436571e-02   -1.533444363935724e-02   +6.258543330355681e-02   +5.683678402063196e-02   +8.135546723135215e-02; +1.847045025876708e-02   -3.319137826874724e-02   -2.024458358608749e-02   -3.230393263715171e-02   -6.417202449297699e-02   +8.824344235269732e-02   +2.382214667383287e-02   -2.492088953563857e-02; -5.312525863781545e-02   +6.836732849810098e-02   +1.563339574325632e-02   +1.038208056932539e-01   -1.065576962571698e-01   -8.007662200525205e-02   +4.525235600408668e-02   +3.680873119864131e-02; +3.461457214113431e-02   +1.067526623857443e-02   -2.819043284446125e-02   +2.692946182033608e-02   -4.384157731830276e-02   +3.416066402291854e-02   -1.385636460298828e-03   +6.476388865380461e-02; +2.294888406149264e-02   +1.265174068680710e-02   -2.175004210559623e-02   +1.873316311572800e-02   +7.236614979182036e-03   +9.464528300980907e-02   +6.869740540465583e-03   +5.778005892824463e-03; +9.692100542187275e-02   -1.886024034386420e-02   +4.614779962259706e-02   +1.059716722354127e-01   -4.366907288538156e-02   +4.495318023367931e-02   -3.318399522583669e-02   +8.239881498382881e-03; -1.491650436480078e-02   -9.393802939271352e-02   +6.551235853134518e-02   -7.943905571312661e-02   -2.085352647928022e-03   +1.802707390382206e-02   -5.893986959692649e-02   -7.115065482305895e-03; -8.689360426842524e-02   -8.540864376576316e-03   -4.664547059001137e-02   -7.201149119115069e-02   -1.227032979700897e-02   -2.075946143898539e-02   -6.822834033345715e-03   -4.223335947298309e-02];
L1I_L2I_iGABA_netcon = [-3.245198497310837e-02   -2.252732785971140e-02   +2.755465374254010e-02   -9.008592496943076e-03   -9.035733157116975e-02   -8.633796852298422e-03   -8.871158076071847e-03   +1.067703586389289e-01   +5.337037780879849e-02   -1.225150612382470e-02   +2.339851339560310e-02   +1.978597225457036e-02   -5.306201699854515e-02   +2.668447431490883e-02   -1.671608116378772e-02   +1.520526258830854e-02; -9.826482269454301e-02   +5.111344372527888e-02   +2.308706040486890e-02   +4.100620328001731e-02   -1.736451000473753e-02   -7.419255818343821e-02   -4.339907404612800e-02   +6.916194287418762e-02   -3.682082425196102e-02   +3.477224034670566e-02   -8.518847255690945e-02   -7.636033000486550e-02   +8.232478434060131e-02   -6.209418378626030e-02   -2.731885673329360e-02   +4.249769256296015e-02; -2.651957163710549e-02   +2.641102403689345e-02   -4.408813260590289e-02   -7.000212222241421e-02   -9.246829716216397e-03   +4.488297041473530e-02   -2.231364179942737e-02   -1.830934380419385e-03   -7.866081500316268e-03   -5.151644624075392e-02   -2.666444353375993e-02   +1.008737248752443e-01   -1.798765288124483e-02   +3.018475086096584e-02   -5.944146488917072e-02   -3.747303467256012e-03; -2.277835916841029e-02   -9.278942739887820e-02   -9.022411292559785e-03   -5.103877138119626e-03   -3.205563167554579e-02   +2.481959014952870e-02   -3.681226303807246e-02   -1.844307764923296e-02   -6.261057810388806e-02   -3.372583392518060e-02   -3.417926630593010e-02   +4.552719025459154e-02   -6.241816006650593e-02   -2.799121061747154e-02   +3.912772585193557e-02   -1.034256974920237e-01; +2.517758402178594e-02   -6.147937216079970e-02   +4.024619779818334e-03   -5.695501996289093e-02   +8.235949784116461e-02   +6.941212975932411e-02   +1.910046635775372e-02   -6.405645045386078e-02   +2.887196878363333e-02   -3.206102825930261e-03   -8.026264783783293e-03   -6.557624941827354e-02   +6.751367737599932e-03   +7.955451839931223e-02   +2.998308929736503e-02   -4.394307084108864e-03; -7.820073534712303e-02   -1.732456880692727e-03   +4.227092239305985e-02   +8.008359603438192e-02   -3.183688314352468e-02   +8.038543433743735e-02   -1.011307272847689e-02   +3.458763681491327e-02   -6.333632449305474e-03   +3.248358939702818e-02   +3.435434670300659e-02   -2.006197457537262e-02   +2.814129704288476e-02   -1.156207146126075e-02   -4.069927946724226e-02   -1.587439818902207e-01; -3.426378687217088e-02   +1.163411428423674e-02   -2.190601532336688e-02   -6.029447461486900e-02   +1.483420356696922e-01   +1.149244237388619e-01   +3.375369550445735e-02   +7.201825087812475e-02   -3.385261489508013e-03   -1.382795018993415e-01   -3.053907700770023e-02   +7.371826911536293e-02   +5.976374977825120e-02   +6.187906089341809e-03   +4.096333601439905e-02   +1.959548252951463e-02; +6.522947808021552e-02   -9.138601770071988e-02   +3.083966168476088e-03   -2.694568826591867e-03   -6.438957446773502e-02   -5.599274311250432e-02   +8.668949654765185e-03   -8.064800758549144e-03   +4.502764267726913e-02   +6.937311014359657e-02   -6.197598094363528e-02   +5.143139070377836e-02   -4.794742289678065e-02   -5.046933247484239e-02   +5.063721306840456e-03   -5.456471384583587e-02];
L2E_L1E_iAMPA_netcon = [-6.788040170840313e-02   +1.388198198642770e-02   -2.526660788286283e-02   +3.908862663709499e-02   -3.708395625687396e-02   -8.811976188032232e-02   +1.211251601939388e-02   -2.061279236504823e-02; -1.779434700865320e-02   -2.064692865694895e-02   -5.079489250060838e-02   -5.940846437144379e-03   -3.157109230956136e-02   -4.274402454046171e-02   -1.472657854713549e-03   +1.387926781298243e-02; +7.947362940056034e-02   -1.214306427311167e-01   -7.675076725002884e-02   -5.203853501658955e-03   -3.418442830078843e-02   -4.068311635489091e-02   +1.055072589209546e-01   +7.740422258046181e-02; +2.100668288145846e-02   +7.093555178560874e-02   +2.061938694937606e-02   +4.249157716582338e-02   -1.817750068513873e-02   +6.938674774570611e-02   +3.759951649995748e-02   +1.547195853307004e-02; +6.181089240746902e-02   +5.440308181866665e-02   -1.242983893681153e-02   -2.933664156621242e-02   -6.395773146446423e-02   -3.940080685491127e-02   -3.422333083350519e-03   -1.414254291048308e-02; +8.065690141810856e-02   -1.659473022420397e-02   -3.373670167415834e-02   -1.012854657221962e-02   -4.857945421366427e-02   +1.223136888023921e-03   -4.284078292351974e-03   +1.130891856137086e-01; +3.208733547511261e-02   -2.894595354213624e-04   -8.839685392301483e-02   -5.094557059309925e-02   +3.938499874984658e-02   -2.384867924109699e-02   -2.626178584766085e-02   +6.963694194813314e-02; +6.203679731837095e-02   +3.820088032521538e-02   +1.646692625857057e-02   +3.986596893569671e-02   +2.787563010683561e-03   +2.847112641265920e-02   +4.898281599861519e-02   +3.255728590216424e-02; +8.132511848786561e-02   -8.814697627454192e-02   -4.010530162239935e-02   +1.127475051099275e-02   +2.935514361291067e-02   -2.339677163026789e-02   +4.991141418214555e-02   -9.598823844741818e-02; +6.506150121918443e-02   -7.341573746323665e-02   -1.239071994549697e-02   -5.095075624470359e-02   +3.553594162770898e-02   +5.529599018290358e-02   -2.466365541206038e-02   -2.426438431610813e-02; -4.552639484891551e-03   -2.467936250774792e-02   -2.714212942198132e-02   -2.994611661217141e-02   +5.257665255203148e-02   -4.503031340818954e-02   +1.207303626760769e-02   +2.744105740507199e-02; +6.930295275911236e-03   -3.173219530717505e-02   -2.339189292213940e-02   -9.002423528907477e-02   -9.219870829378080e-02   -2.937908120168919e-02   -2.295413643282464e-02   -1.879360282995383e-02; +2.801950938184333e-02   +2.192877275997231e-02   +5.415767746594168e-02   -8.385754971576180e-02   -1.409553380220772e-02   +4.392918263519938e-02   -1.673103234931466e-02   +6.382722794936829e-02; -5.398464759232526e-02   +8.512731897106567e-03   +1.602228078733658e-02   -4.336846170565092e-02   -2.003740146366430e-02   -9.155931070808242e-03   -5.816810861772124e-03   -4.844171026999058e-02; -4.854912312268801e-02   +5.277113459725507e-02   +7.170668138675215e-02   +1.266977002773803e-02   +2.466703957888097e-03   -3.557162706198333e-02   +2.228877576199830e-02   +3.397052915203003e-02; -6.369918658857421e-02   +6.423235833056390e-02   +6.119171187691447e-03   +2.496979653066126e-02   +1.859613362892496e-02   +5.602295100003248e-02   -9.149021413149005e-03   -6.273665479382397e-02];
L1E_L2E_iAMPA_netcon = [+4.018396972844162e-03   +8.745678794027951e-03   -4.675411742580392e-02   +1.781421661682951e-02   +4.190111432279790e-02   +7.638608460766140e-02   +9.499745742316587e-03   +3.478874030793544e-02   -4.699899357583835e-02   -1.088177465589438e-02   +1.027491220978126e-01   -5.814944428656214e-02   +4.732256497603851e-04   -5.161865913580611e-02   +3.387698497370337e-02   -6.373110023721057e-02; -2.409942032002511e-02   +3.465497223670748e-03   -8.871274066501283e-02   +9.084255799058108e-02   +6.522697231500808e-02   +2.853738162189832e-02   -7.168321151604705e-03   +1.561478714799536e-02   +6.064188429062574e-02   -6.505028456442363e-02   -1.108098800121543e-02   +5.651883626380831e-03   -1.545402068574127e-02   +9.955153414885717e-03   -3.563589422149828e-02   -2.880797157056784e-02; -1.362698541201841e-02   +7.098771120243635e-02   +9.338391104946388e-02   +3.132186028183132e-04   +8.368466012290316e-03   -1.290821390619841e-02   +6.323753277355168e-05   -3.870414115321822e-02   -3.055622071001606e-02   -3.120233634402188e-02   +3.977661102469338e-02   -1.950838181155011e-02   -5.576695234297716e-02   +1.064264660620535e-01   +2.814845540610254e-02   -5.043756969442521e-02; +3.604687207974622e-02   -6.577545839337720e-02   -5.342823289880334e-02   +3.054878792505611e-02   -1.197882468458360e-02   -6.003529435782306e-02   -3.225279388721516e-02   -6.033068983166211e-02   -1.109894223366398e-02   -2.200945257012654e-02   +1.077640933742459e-02   +1.877538731901557e-02   -2.242896501231897e-02   -3.979988902991734e-03   +2.745613490476370e-02   +8.258585148539135e-02; +1.267656726834571e-01   -8.159129170688995e-02   +5.058122805314411e-02   -3.038960589321458e-02   +1.610430710015126e-02   +2.415288545889132e-02   -5.470815342464022e-02   +3.317614355102848e-02   +2.259377871272976e-02   +5.990928687954776e-03   +2.510517033739394e-02   -3.255015469670038e-02   -4.001520341965898e-02   +2.367001614856161e-02   +1.796572893198112e-02   -1.371387188356168e-02; +6.655440943210181e-02   -9.157428817702343e-02   +1.002053374987123e-02   +6.465198275282212e-02   -3.761848231911939e-02   +8.368380807709916e-02   +2.539572825878608e-02   -2.011134417446620e-02   -1.429654395329746e-01   +9.156844775239002e-03   -6.153463683865863e-02   +8.354532231332898e-02   +9.117505585061138e-02   +5.491264126846484e-02   +5.411362266048567e-02   -1.701048328102587e-02; +7.601023775669347e-03   +4.750876866909891e-02   +1.232021346443278e-02   -2.244894888818995e-02   -8.868519661532769e-02   +1.547417995418148e-02   -4.802883500501089e-03   +8.349542982264094e-04   -3.026754526174289e-02   +1.481357006902259e-02   +3.581883395783293e-02   -3.932065213584487e-02   +4.291739756610385e-02   +4.024278644708959e-02   -6.610263986380663e-02   -6.229193264738143e-02; -4.831562824627320e-02   -3.651367116799126e-02   +1.424902442739296e-02   -2.196173820155406e-02   +1.175778850826440e-02   +3.601245643960249e-03   +2.677309052105255e-02   -1.278716338204373e-02   +2.206830807856649e-02   +2.541106899957282e-02   +3.451668625934640e-02   +5.221014514749268e-02   +6.137904166455078e-02   -3.943453035501398e-02   -5.656741833130124e-02   +5.102355837986774e-02];
L2I_L2E_iAMPA_netcon = [+7.455481844930363e-02   -8.333386631011239e-02   -5.611059105812465e-02   -2.019047550138085e-02   +6.816684844911601e-02   -2.137492818962164e-02   +1.837698193730834e-02   -5.518354516241062e-02; +3.950743854709404e-03   -5.173830138662531e-02   -7.166606861005539e-02   +1.031017512374561e-01   -2.326331077430720e-03   -5.025043101849581e-03   -3.574768258930346e-02   -4.335031903513841e-03; -5.766574693837560e-02   +2.867570857923535e-02   -4.481235220498585e-02   +6.241446933972085e-02   -3.419922307426389e-02   -5.426788112864684e-03   +5.227890013996606e-02   -6.863266419942357e-02; +7.325324728894056e-02   -1.667402187317955e-02   +2.050644122911296e-04   +5.258210318023800e-02   -9.699230855117354e-02   +5.840885287752831e-02   -3.667395212608841e-02   -5.158396806506167e-02; -7.025757052147483e-02   +8.291461713138527e-02   +1.903163193393602e-02   +5.551309539174635e-03   -6.910886042746398e-03   +8.159100249973937e-02   +9.328460907762338e-02   +6.905890326408881e-02; -2.365566001628570e-02   -3.929808047392201e-02   -5.084658142400247e-03   +8.231013488608270e-02   +5.424016845585924e-02   -4.825391101232191e-03   -1.534170924680176e-01   -2.257332940142047e-02; -2.992579120560736e-02   +2.598438155263777e-02   -4.508562390596262e-03   -6.044535154854237e-03   -7.888122812110367e-02   +7.151449303020506e-02   -3.212134920007688e-02   +1.634294714861257e-02; +9.811581125762676e-03   +6.479908437861051e-03   +1.799615550521664e-02   -3.223899413092077e-02   +6.495525496925322e-02   +1.954876560698409e-03   -3.968724522609327e-02   -3.138681851011296e-02];
L2E_L2I_iGABA_netcon = [+1.091581933542915e-02   -4.072047550881229e-02   +2.109843012469390e-02   +9.341293233015160e-03   +5.831444240149818e-04   -4.365312702547781e-02   +4.049218207511199e-02   -1.005963595597557e-02; +3.240716975096312e-02   -1.010236879467259e-01   +8.279038408424148e-02   +1.062651701853782e-02   +7.015738455261103e-02   -5.405802176303307e-02   -1.255727148791190e-02   +7.833295708550843e-02; -8.732943644759313e-02   +1.093462039528976e-01   -1.604834853392929e-02   +5.863145841660961e-02   +5.075495809442619e-02   -4.745663103483404e-02   +7.366205517570519e-02   -5.052554792349608e-02; +5.221111977060431e-02   +1.444901440112703e-02   +4.495427611358176e-02   -2.981212169732981e-02   +4.862850874065305e-02   -5.699834281941210e-02   +3.819914840873445e-02   -4.432082096648185e-03; -4.583969823202030e-02   -1.180588077356218e-03   -5.486816220702441e-02   +1.609809414746211e-02   -7.468894031800406e-02   -5.729147766149480e-02   +2.234171336731388e-02   -1.535811065181803e-02; +3.728682395375620e-02   -7.014096800976244e-02   +5.877445690645714e-02   +4.888766152882998e-02   -1.932836232230932e-02   +2.777648271517777e-02   -1.142474078942222e-02   +3.328822771060850e-02; +1.876656653254192e-02   +3.323606286404043e-03   -1.763845063963621e-02   +1.004228142414700e-01   +1.526129682391137e-02   +5.101239378135258e-02   +5.240189066868716e-02   +1.582458074822812e-02; -3.744695012444239e-02   +1.115524140696985e-01   -9.358919851129407e-03   +2.134060123936522e-02   -5.568669712563355e-02   -1.270235816740760e-02   -4.432767839297997e-02   -2.493319142716451e-02];
L3E_L2E_iAMPA_netcon = [-3.534708593387753e-02   -9.377737458489731e-03   +2.856432263249516e-02   -1.466819185556714e-03   +8.773674546839053e-02   -2.924890130805363e-02   -6.766797156045433e-02   -1.339760169690960e-02   -3.454997523005540e-02   -2.978898888419587e-02   +4.098278513412270e-02   +1.454892629385031e-02; -6.607454755971659e-02   +7.378523288868691e-03   +4.056132080829461e-02   -3.676714100804377e-02   +6.594168670542398e-02   -6.019672879536875e-02   -3.910501849131639e-03   -1.280925965644671e-02   +2.660068437231684e-02   -2.008461528748325e-02   -2.587569333390217e-02   -5.760467524087546e-02; +3.825507075504604e-02   -6.014164893437199e-02   -1.011415345529448e-01   +3.352868357247712e-02   +7.353788764888625e-02   +3.141162757047761e-02   -2.358815568784867e-02   -8.534626958208295e-02   -3.317975725176067e-02   -7.818371432607200e-02   -7.657730793804032e-02   +5.009932247068656e-03; +3.547733847588060e-03   -4.420524529353961e-02   +6.027216826328519e-02   -1.032826492876441e-02   +1.217479581182474e-02   +9.414272229666674e-02   +5.867648817166862e-02   +6.845086639457680e-02   -1.973141195825558e-02   +6.306094239718957e-02   +1.008192099267423e-02   +1.992063864937182e-02; +8.969606257696783e-02   +7.933173229331809e-02   -4.387045560305286e-02   +2.140334289993656e-03   +1.052132008186044e-02   -2.496593238600998e-02   -3.221523116954970e-03   -1.838823708772616e-02   +2.591024545858058e-02   +8.339985211372436e-02   -5.267619467191291e-03   +5.869862842240907e-03; -6.465208738063412e-02   +5.264367129750702e-02   +2.286467554694144e-03   +4.063738725422386e-02   -3.978345543439017e-03   +7.717668308979661e-02   +4.832748643823139e-02   +8.609413843642978e-04   +6.401200775421217e-02   +1.626002723736045e-02   +7.150241072760777e-02   -3.602619663606930e-02; -3.506351966186709e-02   -5.285449323458584e-02   -2.487833388875519e-02   -6.702390497513361e-02   +4.086478004440093e-02   -1.328394497974326e-02   +2.181813119822047e-02   +1.600584319442709e-02   -6.442308614445814e-04   +8.481959152528899e-02   +1.047104148543963e-02   +3.996485114460530e-02; -9.605953281220048e-02   -5.621693689448008e-02   -5.951546037750543e-02   +7.821642710928761e-02   +5.522611114415103e-03   -5.915991241745923e-02   +1.198306995277629e-02   +7.864443228606677e-02   +1.717658748681204e-02   +3.868849271377037e-02   +1.190240820068471e-03   -1.246456763338032e-01];
L3I_L2I_iGABA_netcon = [+1.071732713907057e-02   -4.492860447448296e-02   +7.483775340132520e-02   +7.693230836673497e-04   -6.327892006835845e-02   -1.054269569105635e-02   +4.617862885194678e-02   +1.072979439919644e-02   -1.702124196153144e-02   -1.020786862103861e-01   +1.043441046276368e-02   -7.831208414517898e-02; +1.996337450144870e-02   +3.994498520959087e-02   +4.339116061994119e-02   -4.493512735972637e-02   -4.285958652209300e-04   +9.221665486900364e-03   +2.191185375988491e-02   +1.379575346217441e-02   +4.937682617891960e-02   +6.376668181965739e-02   +1.952468528565775e-02   +1.200197006457838e-02; -2.766875673119942e-02   -1.225416567354631e-01   +6.792120101508352e-02   +5.770594982306988e-02   +1.763990031951253e-02   +1.997488332603804e-02   +4.796008191810471e-02   -2.005726100502662e-02   +2.910807255610836e-02   -5.776963914553099e-04   +3.841774798214145e-02   +2.649276747984441e-02; +2.974019411153655e-02   +9.199624930641521e-02   +1.653020893192173e-02   +2.513084371573127e-03   +9.458423335540106e-02   -6.816290967136664e-02   +4.073465786058342e-02   +3.207440829280364e-02   +1.427091861089302e-03   -4.344505014794978e-02   +3.481624384145472e-02   -2.978616424342419e-03; +5.057855042420360e-02   +3.512821756227250e-03   +1.884149409388873e-02   -2.069860930453709e-02   +3.087647877550336e-02   +7.317509965941391e-02   +8.942057208076146e-03   -1.485099484116874e-02   -5.776924019823124e-02   -9.543422138957564e-03   +2.878566901466137e-02   +3.070378667464793e-02; -1.637858064641226e-02   -5.407530089838346e-02   -3.644655746870502e-02   -2.077058751547387e-02   -6.154559926079542e-02   -7.959474753644581e-02   -6.293150086486371e-03   +4.866533314728857e-02   -8.464928590728725e-02   -5.764187177494411e-03   -1.556111904873176e-02   +5.926174294430424e-02; -1.306180209218656e-02   +9.835858820243477e-03   -5.538942745786225e-02   -2.565611351381199e-02   -8.415176134821352e-02   -2.209946198209005e-02   -3.835583137982319e-02   -1.098756585689308e-02   -3.482904348882600e-02   -4.980958355419701e-02   -3.683722093839936e-02   +2.641813527352265e-02; -4.490898621549241e-02   +4.055983582553145e-02   -3.850692643527732e-02   -1.154352640161804e-02   -9.436615008731657e-03   +1.681980588983501e-04   +1.037086033304955e-02   +6.826097267660622e-02   -8.537788795229323e-02   -3.120604473543586e-02   +9.243046580152887e-02   -1.725616044582656e-02];
L2E_L3E_iAMPA_netcon = [+2.588409141827700e-02   -3.312048876189147e-02   -5.292352714737305e-02   +7.752413070602754e-03   +7.908624356023457e-02   -2.332521310646015e-02   -7.802525628167765e-02   +8.202145195364059e-03; +1.021928719425697e-01   -2.046573392485697e-02   -5.111560278537828e-03   -2.973461495665346e-02   -3.071148892146254e-02   -5.552921879660652e-02   -4.388202811619216e-02   +1.096470256354815e-01; -4.717357399570642e-02   +7.170467999143992e-02   +3.731264365495459e-02   -2.906981786568600e-02   +2.486183894070829e-02   -1.601228332259603e-02   +3.125688794759226e-02   +1.372634574654389e-02; +1.034996196954661e-01   +4.888191090484269e-02   -2.184326763546534e-02   +3.224560688436379e-02   +2.528556817825708e-02   -2.534753212827578e-02   +7.824619422681159e-03   -1.559458120319636e-02; -4.939113616276239e-02   +1.270223405397737e-02   +1.540845757846905e-02   -2.011203158583743e-03   -4.630727122898218e-02   -4.635615780384593e-02   -1.246103943312492e-01   -2.184196039738413e-02; +5.199005627986794e-02   -6.285163787196650e-02   +1.230607430625442e-02   +7.997538308525382e-02   +2.241311894811647e-02   -6.087251772331852e-02   -4.037866392457576e-02   +4.217030420136142e-02; -2.233578058597140e-02   -3.539861361447896e-02   +3.120210508354161e-02   +1.130625937078018e-01   +3.577336752721723e-03   -1.557692088346684e-02   +4.660830604659213e-03   +2.418739823332700e-02; -3.914163664831453e-02   +1.072866032404916e-02   -1.885744826148407e-02   +4.578461013751048e-02   +4.669877558128453e-02   -4.064983597219229e-02   +4.597042510546430e-03   +1.943815850950399e-02; +7.804079911924268e-02   -6.342959810247452e-02   -6.127574125162230e-03   +2.045853949300503e-02   +5.346824460470326e-02   +1.373587305365878e-02   +4.605282531861737e-03   -2.067251226652040e-02; -5.623283320372984e-02   -1.061606672315380e-02   +5.122219250800210e-02   -8.898564489108519e-03   -4.297457221535239e-02   -2.611509446812758e-02   +2.530554397367772e-02   +5.906939625480599e-02; -6.330034494643492e-02   -1.448714769794067e-02   -9.075237314199082e-02   +4.604144175123998e-02   +5.567181559845966e-02   +3.662621544144957e-02   -3.845970367481481e-02   -2.258481847006319e-02; -1.671482229681004e-02   +1.739848448517411e-03   -2.688445123923624e-02   +5.414175691594433e-02   -2.431427470623476e-03   -2.366500074891735e-02   -5.310450462136344e-04   -1.279810568762853e-01];
L2I_L3I_iGABA_netcon = [-1.574359730041622e-02   +2.386966579241308e-02   +6.128705203455825e-02   -1.243584200855419e-01   -3.674545092451614e-02   -2.239790115692621e-04   +5.870979162152341e-02   -1.512108388515528e-02; -7.280744767598191e-02   +2.603156092805280e-02   -2.013945441930673e-02   +2.577110863291278e-02   -7.235421498998792e-02   -3.704750404328508e-02   +9.584167685287669e-02   +5.034986726628319e-03; +9.108845527815630e-02   -1.944023485550207e-02   -8.302160935988309e-02   -1.022827772720358e-01   -1.264985875092746e-02   +1.876022837243403e-02   +2.734312065855652e-02   +5.977632655903481e-02; -2.514221423281942e-02   +1.446111763545673e-02   -2.554254705019286e-02   -3.559027031238905e-02   +1.851665860645076e-02   -2.970573522354554e-02   +7.251500530827699e-03   -1.057111165568098e-01; -7.124578084505628e-02   +1.803890112309222e-02   -8.562829395955157e-02   +3.705647754537756e-03   +1.964659999807641e-02   +3.348303506801201e-02   -3.461826608372701e-02   +1.821007718038566e-02; +1.955363523534693e-02   -4.454386326635118e-02   -6.855496124535164e-02   -3.979598779464093e-02   +4.761762794760153e-02   +1.205481387227031e-01   +3.672830262547053e-02   -2.823467670444936e-02; +1.070893749158045e-02   +4.161548815937370e-02   +4.412061730798299e-02   -5.183787549960774e-02   +2.073070387755256e-02   -5.997534043207435e-02   +3.087126082524996e-02   +1.433635581047312e-02; +6.466271498995895e-03   +5.594908041619739e-02   -4.457801272466055e-02   +3.844181703748102e-02   -2.301937937894141e-02   +4.330883480245681e-02   -4.138057015899797e-02   -8.359856879639779e-02; +6.281516258561545e-02   +7.708407778352211e-02   -5.493315612262836e-02   +4.472402963508086e-02   +1.742225499991678e-02   -9.453762358631445e-03   +6.204851370558101e-02   -2.030559807160599e-02; -1.232737809062510e-02   -2.129426690001837e-02   -4.823882508433804e-03   -4.784086807463356e-03   +8.645346980326646e-03   -5.912333480798597e-02   -7.865767062240559e-03   -2.591578494672472e-02; -2.381677709456990e-02   -6.997127884242411e-03   +8.621003478182048e-03   +3.762234523445454e-02   +5.173635927806188e-02   +4.552490765167197e-02   -1.397084947240366e-02   +1.267814547343919e-05; -1.060993545653006e-01   +1.369318111527190e-01   +9.110766077956960e-03   +9.615732928980789e-02   +6.998384913971406e-03   -1.970285415157706e-02   +1.572781774170152e-02   -4.130168591322112e-02];
L3I_L3E_iAMPA_netcon = [+8.752538580991581e-02   -3.036815545346816e-02   +1.827729623719425e-01   +5.490696975760257e-02   +9.336132982307706e-04   +4.364932085108965e-02   -7.970111307144409e-02   +2.347621127128910e-02   -3.892294680245335e-02   +2.228911863601167e-02   -1.638317348469599e-02   +3.969140246259881e-03; -2.901508214156627e-02   -3.868494421169919e-02   +1.311679085869250e-01   -1.361492583052745e-02   -2.651327271547077e-03   -1.394080040787996e-01   +5.604588516991479e-02   +1.165336040103903e-01   +6.317499134238579e-02   +4.122384178226075e-02   -2.745254366507133e-02   +1.220087692725402e-02; +4.647268660208949e-02   -3.721475647004518e-02   -1.079159056108857e-01   +4.278981670550099e-04   +1.778432150852093e-02   +1.703027344505255e-02   +1.103358154581513e-03   +5.742634537398891e-02   +2.726254003108385e-02   -1.001385394173237e-01   -1.616552979182517e-02   +8.791418284498508e-02; +1.868364411809051e-02   +4.566476027468502e-02   +4.445242103518286e-02   -1.819489203679822e-02   -4.519522368975896e-03   +2.435961363618927e-02   -5.114674496177145e-02   -3.285327821676661e-03   +3.853678887756665e-02   -8.155451318343308e-03   -5.660596123025705e-02   +1.195751882872767e-01; +8.750461174380686e-03   -9.230323421540637e-02   -5.808311876691549e-02   -1.217740537379655e-01   +4.899931458379938e-04   -4.064749451056172e-02   +6.917543239628490e-02   +3.077186658119468e-02   -4.873542541519199e-02   -6.359307450351320e-02   -4.164843253602711e-03   -6.330354199397191e-03; +2.597198431069300e-04   +1.867438628056920e-02   +2.655621448806542e-02   +2.196924852762305e-02   -4.319275933502776e-02   +2.323207915147876e-02   -2.088748498483235e-02   +1.177702801572474e-03   -2.678695028751707e-02   +8.557185015383227e-02   +7.143385298559118e-02   -1.459822991981648e-02; +6.255701607792125e-02   -4.417405348689984e-02   -7.862473458222390e-02   +1.709618589985136e-02   +3.661239321160411e-02   +1.011003364699072e-02   +3.073805950384963e-02   +8.374908271891090e-03   +1.607524641053248e-02   -2.647102076811577e-02   +3.599853526798093e-02   +9.061111771266570e-02; -1.039421257732842e-02   -1.217474047437763e-02   +1.034574184500745e-01   +2.023410333672456e-02   +5.034447809660256e-02   +1.697293156415490e-02   +1.901235388293026e-02   +5.026367832028165e-02   +1.185465252378790e-02   -1.445315349339395e-03   +3.404630306469884e-02   +1.354785184689670e-02; +8.314784182584692e-02   -1.605776063001140e-02   +7.891576239374370e-02   -1.174081059599255e-01   -1.734412081225473e-02   +3.151088311999582e-02   +3.346346443718477e-02   +5.968406875352586e-03   -6.560240959583280e-02   -2.830888963215004e-02   -2.600353276894464e-02   -6.583405906427219e-02; +5.863759600950647e-03   -5.664529193168090e-02   -9.118597458104435e-02   +7.518968921548042e-02   -3.857256171414403e-02   -2.898095424011614e-02   -2.381082052465908e-02   -9.437553518800042e-03   +4.013084239231602e-02   +6.121089805380808e-02   +7.865465297614448e-02   -5.907132615250641e-02; +1.146188652926538e-02   +5.637921368120648e-02   -8.422869067644291e-02   -9.314002959995536e-02   +9.712786561722041e-02   -1.103072552160868e-01   -6.856247566468686e-02   +4.816307854899547e-02   +2.275376226512961e-02   -1.431448059235637e-02   +1.007561065930793e-01   +6.180511349535527e-02; -9.600774514569242e-02   +9.835019642955119e-02   -1.892155112229451e-02   +6.334969194800595e-02   +4.796328710266316e-02   -9.765306652666143e-02   +3.970770143636716e-02   -3.605101051327457e-02   -9.349311046348255e-02   +9.811693358886403e-02   +7.392557831741307e-02   -3.713946338009628e-03];
L3E_L3I_iGABA_netcon = [-4.795584117800859e-02   +7.014316490702618e-02   +4.870868952495448e-02   +1.095251487585396e-02   -5.972233295345913e-02   -5.030962913348744e-02   +7.225407268701667e-02   +1.131374824261802e-02   -5.617196502626117e-02   -3.453791080252759e-02   -3.006862102024950e-02   +5.289589599208322e-03; -2.299484627565091e-03   +2.286694724008991e-02   -4.133760531055723e-03   +2.177892722595695e-02   +7.306122319050382e-02   +1.332980572876142e-02   -2.141509931407293e-02   +3.133817278630310e-02   -5.554129938910946e-02   -9.054153781026740e-02   +1.369997375979365e-01   -3.321012619706135e-02; -2.895010744511197e-02   +3.038985520686029e-02   +4.881107790420024e-02   +5.458627773820559e-02   +2.997844317517914e-02   -2.804483368417169e-02   +1.954581581099470e-02   -3.420067966528077e-02   -4.172888385033410e-02   -3.651641018908464e-02   -3.226455475123020e-03   +9.312424645223182e-03; -1.654138972728543e-02   -5.814022728000586e-02   -4.244697041625572e-02   +1.228342517379494e-03   +2.956423822354896e-02   +4.759746685820263e-02   -2.467673982429407e-02   +3.869730936783682e-02   +7.093898431679682e-02   +1.411679517901413e-03   -4.255645701840539e-02   +7.992466737272521e-03; +4.847116204190739e-02   -7.044897093804564e-02   -3.115770034869507e-03   -8.585347266165912e-03   +2.486662344155313e-02   -3.465643689550262e-03   -2.282951818456998e-02   -8.453320817140461e-02   +5.085282283408132e-02   +2.857723060696929e-02   -6.456468615601986e-03   +6.816474726660129e-02; +7.698023874307935e-03   -1.070187776615677e-02   +6.722887640312628e-02   -1.922071180720045e-02   +6.090130946497432e-02   -1.779616141532907e-02   -4.842100443039751e-02   -3.805803712428931e-02   -3.474240752809437e-02   +3.264307816628047e-05   -8.196728006334315e-02   +2.057579204043099e-02; -1.019923108240849e-01   -9.188595662895458e-04   +7.125330421332586e-02   -9.475144793938912e-02   +4.772991694037786e-03   -6.147482469644941e-02   -1.601752539650629e-02   -4.384657291497958e-02   +2.255919124058186e-02   +1.437055893916639e-01   -4.535707656191086e-02   -4.550305988284795e-02; -2.462424161147874e-02   +2.304733770146857e-02   -8.291115101889067e-02   -4.485790843549317e-02   -5.108550189728331e-02   +1.585613470592405e-03   +2.736223264531213e-02   +8.334351842635770e-02   -4.124159464577004e-03   +5.218978478131991e-02   -3.225172881001544e-02   -3.463770042033269e-02; -5.761814140381515e-02   +7.366118786285648e-02   +7.057750486066142e-02   -3.951248448802835e-02   -5.078112724806791e-02   -1.211850912247633e-01   -5.733452039824963e-02   +3.168368162656317e-02   +7.098207877508567e-02   +1.120080241420141e-02   +7.200398318559527e-02   +1.192854910621290e-02; -1.799483159397632e-04   -7.682337778916391e-02   +1.002591041830693e-02   -1.334404869921722e-03   +8.015234487914580e-02   -2.430279024785929e-02   -3.565196465301484e-02   -2.152325526682827e-02   +1.008263529285789e-02   +1.823850678574218e-02   -1.901323203166351e-02   -6.017142067883199e-02; +7.960975822369967e-02   +5.271374925703085e-02   -7.361837905222529e-02   +4.944662516158439e-02   -3.980286892130336e-02   +1.249449555578962e-01   +6.076157334135628e-02   -4.168218120098517e-02   +4.758359154604949e-02   -2.226496361010730e-02   +5.219942447851336e-03   +6.993318779565626e-04; -9.230117387834431e-03   -9.869583143424650e-03   +5.437347912759113e-02   -3.499371242270226e-03   +7.160119539059676e-02   -1.975455174566169e-02   +1.563512968621457e-02   +9.601682045095201e-02   -2.001755870397283e-02   +8.627761705210006e-02   +6.240031117704051e-03   -6.215941174950053e-02];
L2E_Input1_iAMPA_netcon = [+9.011661726681833e-03   -3.466180725599534e-03   +3.383163054719914e-02   -6.430400737305236e-02   +3.761549756869188e-02   -4.264955919156642e-02   +9.014095014127865e-02   +3.917631855710557e-02];
L2I_Input2_iAMPA_netcon = [-7.297148074767706e-02   -3.477035841936855e-02   -2.023016358223028e-02   -1.263777554168440e-01   +9.055517451747096e-02   -5.034879801250631e-03   +8.101607162015877e-02   -6.260550802488830e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
