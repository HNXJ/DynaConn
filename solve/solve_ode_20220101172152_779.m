function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.816901290708674e-01   +2.517732108262136e-01   +1.858358103456988e-01   +8.015964197203909e-02   +1.129111408809887e-01   +7.028716052390659e-02   +1.082242644938589e-02   +3.029752477324649e-01   +2.679165725883627e-01   +2.217214257282639e-01   +5.829690168556732e-02   +5.630380878217709e-01   +3.363829596852899e-01   +2.294376224961173e-01   +1.837599709424057e-01   +4.034820758463120e-01; +3.398710471459474e-01   +1.129697545333054e-01   +4.024553501649333e-01   +2.295767392479575e-01   +5.807447469792902e-01   +4.425777741536919e-01   +2.851488533303814e-01   +4.153031943119490e-01   +3.864873929500993e-01   +6.266472367586812e-01   +5.913839334410214e-01   +2.176812100011050e-01   +3.197814298387009e-01   +2.344486254037541e-02   +3.887161747265545e-01   +1.210420735606696e-01; +2.923582490215446e-01   +6.045518138715595e-01   +1.835422135484037e-01   +8.773199013425544e-02   +3.358855836525978e-01   +6.347072842495304e-01   +3.850432730821840e-01   +2.566112284142772e-01   +4.213064080518112e-01   +1.733053106764238e-01   +2.170727324206889e-01   +2.570841711654946e-01   +4.080980791707347e-01   +3.078081775913586e-01   +5.267732280139862e-01   +4.211637150441049e-01; +1.099277194611457e-01   +4.285429391173750e-01   +4.946219492024536e-01   +6.627147135844541e-02   +4.580654804799922e-01   +2.436386657293878e-01   +9.738992286303383e-02   +1.304599378373923e-01   +5.082435920335769e-01   +2.400280932584924e-01   +9.350329863490126e-02   +2.827959259113472e-01   +5.142193114546564e-01   +3.438338373149750e-01   +6.097336548085253e-01   +3.286202165695475e-01; +1.331918235511935e-01   +5.399234043491634e-01   +3.197022349034617e-01   +5.309768517144177e-01   +4.702897913747455e-01   +2.620438236800840e-01   +7.760199684239663e-02   +1.511719945638531e-01   +1.968476618837126e-01   +4.447726677184421e-01   +4.338628342026508e-01   +4.445390302136870e-01   +2.511534446954628e-01   +4.668036084690458e-01   +1.189477099325904e-02   +9.940439359077291e-02; +1.617664912549676e-01   +5.792048430024659e-01   +2.430370124355283e-01   +3.646192712478044e-01   +4.505485939984070e-01   +9.715538213006242e-02   +3.243627439617454e-01   +3.576731890678937e-01   +8.033946300972400e-02   +3.543907372991817e-01   +1.924801922282823e-02   +1.586037811650900e-01   +1.273456104543291e-02   +5.239075584874362e-01   +3.592597551178708e-01   +2.920685647447414e-01; +5.469153277971349e-01   +4.030008659048102e-01   +3.839934432390406e-01   +4.465616976518856e-01   +3.323742647371256e-01   +2.557771045645509e-01   +1.054751052430929e-01   +4.586031500360490e-01   +1.254349109536192e-01   +2.554731315750631e-01   +9.077736835377639e-02   +1.035928893758760e-01   +2.878724511153752e-01   +5.777076186856723e-02   +1.555931404962899e-01   +4.360040025776856e-01; +9.154374730620941e-02   +1.275553553847321e-01   +4.166477450309388e-01   +5.237235283218427e-01   +3.406640235450459e-01   +1.330613640377221e-01   +1.122426786198381e-01   +9.205834029738519e-02   +4.431380105543298e-01   +3.689090488618991e-02   +4.942042496364482e-01   +3.602362180495913e-01   +2.360096785494238e-01   +6.212815861118599e-01   +3.495417291520838e-01   +6.818039963193624e-02; +6.499156769542418e-02   +2.777119421755114e-02   +6.153946644965181e-03   +1.113974080107153e-01   +3.155934318340404e-01   +6.280340863636609e-01   +4.788737173104688e-01   +3.235600882289371e-01   +2.493248351547210e-01   +5.355971872071099e-01   +1.255296447549741e-01   +1.507558030838769e-01   +2.309060133918389e-01   +4.854556155556002e-01   +3.031428915377484e-01   +4.188865737628890e-01; +1.887786380734799e-01   +9.121304101989212e-02   +3.393121582097704e-01   +3.886809595979206e-01   +5.040762208986106e-01   +1.043437128237636e-01   +8.839353703931062e-02   +6.015774830343488e-01   +4.233514276621824e-02   +3.297316384650263e-01   +2.469766950619133e-01   +5.506089023610345e-01   +5.734971746419595e-01   +2.842504386818169e-01   +6.839985569896154e-02   +5.048031570867591e-02; +2.335522980425727e-01   +3.961281740306394e-01   +1.759984443771286e-01   +3.527003629095746e-02   +1.690867601892226e-01   +4.110275639672940e-01   +5.188254102502793e-01   +4.275761729717893e-01   +4.046328896951101e-01   +4.479684404499293e-02   +2.052544399217732e-01   +6.391385866399717e-01   +2.788924553542272e-01   +3.583715512722126e-01   +2.597392625888129e-01   +5.322268164205380e-01; +3.027692057701339e-01   +2.089016171476052e-01   +6.281291310899202e-01   +2.598590760367572e-02   +1.537722856125049e-01   +6.326105508587400e-01   +2.084602656173073e-01   +5.304212651711940e-01   +4.787061896105812e-02   +3.279280208940521e-01   +5.162396532666059e-01   +4.875722852819821e-01   +2.196013549133176e-01   +5.706593928659676e-01   +3.732703471945102e-01   +3.453511448420629e-01; +5.560760287395951e-02   +4.651578438163289e-01   +3.601046334289701e-01   +1.112422685504902e-01   +1.438879168522329e-01   +4.805033379518700e-01   +1.559110183817830e-01   +5.558682474017371e-01   +2.963504660753655e-01   +5.744520519916494e-01   +4.551783621264437e-01   +3.169957141423652e-01   +2.339996842472364e-01   +9.763028444561125e-02   +1.554665643855283e-01   +2.736133994213813e-01; +1.364447376565008e-01   +5.353818610623495e-01   +5.357815624790874e-01   +5.128319618812169e-01   +5.071474784752427e-01   +1.178127168459588e-01   +1.417529866435475e-01   +2.863534284041979e-01   +4.743053896336253e-01   +3.653529541553270e-01   +5.577526900851892e-01   +1.108165351118511e-01   +1.722271060296308e-01   +2.002573393655529e-01   +2.413739714910947e-01   +2.907225563381113e-01; +2.302865759551864e-01   +6.605919934974012e-02   +3.276002629778648e-01   +4.304871483012151e-01   +5.331003125317669e-04   +3.016115655932592e-01   +3.126288202413576e-01   +1.349966956720753e-01   +3.186614954998434e-01   +1.436603009436723e-01   +1.119728522493376e-01   +4.718742904011555e-01   +4.775857636586736e-02   +3.900480725276973e-01   +4.956144083127497e-01   +3.711773376659185e-01; +5.696959420890031e-03   +9.861270473802528e-02   +4.998099076625786e-01   +3.319065550800158e-02   +3.117372356206646e-01   +1.588725178513558e-02   +4.168323268038284e-01   +3.393792049035130e-01   +6.157698685138965e-01   +2.625384037987796e-01   +3.200930170708521e-01   +5.049742134647176e-01   +4.041074624660385e-01   +3.385459516413266e-01   +2.074351022227674e-01   +4.286499257594114e-01];
L1E_L1I_iGABA_netcon = [+2.414933646209159e-01   +4.469005189977575e-02   +1.246546430177299e-01   +5.770534163051554e-01   +4.610791009067537e-01   +2.129240043544191e-01   +3.427954061952320e-01   +5.682220235383806e-01   +1.943162584297027e-01   +3.744556661862706e-01   +2.693657335891416e-01   +3.625728842104091e-01   +6.316434079699893e-01   +1.526304480091425e-01   +6.122628068287960e-01   +3.756135792759118e-01; +4.620293361145804e-03   +5.411652611299381e-01   +3.392640850063023e-01   +2.619600765051424e-01   +1.248578159459666e-01   +4.422959051277183e-01   +1.266195851841135e-01   +4.158987871431368e-01   +4.500152701674976e-01   +3.661127398427790e-01   +4.667028451061044e-01   +1.848854497019169e-01   +5.115398687817970e-01   +3.298690491939651e-01   +5.969188872956117e-01   +4.055572881352937e-01; +4.377047685195121e-01   +5.499344157176931e-01   +2.559655743858686e-01   +4.445797577213200e-01   +3.220032587814547e-01   +4.790168658464024e-01   +7.554167561719968e-03   +2.637926737017826e-01   +2.283930620394355e-01   +5.510384046628856e-01   +1.710604478519642e-01   +3.566080613468172e-01   +4.543896434541033e-01   +3.602317129903927e-01   +1.977584666748704e-01   +6.341955346583196e-02; +4.187556937124067e-01   +5.871424700203708e-01   +3.525725860300998e-01   +4.393288467615820e-01   +8.517391348604604e-02   +4.519936287626673e-01   +2.722737027083412e-02   +4.359628645471406e-01   +3.818872440833766e-01   +4.671729774448384e-01   +2.849193069610519e-02   +2.164975362129309e-02   +4.331218090847228e-01   +1.504160428279593e-01   +8.232756923709959e-02   +3.177308630016902e-01; +2.997799727369250e-01   +4.331114221792871e-01   +2.641511105586749e-01   +1.862884775867849e-01   +4.040537709561888e-01   +4.044458143525725e-01   +3.330951474288241e-01   +3.105439218615857e-02   +3.900954429016283e-01   +2.438768951640806e-01   +9.655650515470468e-02   +1.505708307925156e-01   +1.049179611313404e-01   +3.697796611403544e-01   +3.001875271796959e-01   +3.674055312788019e-01; +2.041767664768342e-01   +4.438824841275264e-02   +1.210547710384711e-01   +3.669337098504832e-01   +3.977718351774725e-01   +5.046723329742379e-01   +2.215405473610581e-01   +3.525614567689612e-01   +4.319726258866359e-01   +3.656558246991344e-01   +3.318710282863095e-01   +4.357302455004314e-01   +6.290085512430252e-02   +5.093808184829581e-01   +8.458461419870650e-02   +2.598276046462274e-01; +8.984387829927101e-02   +2.644724183281938e-01   +4.884261736515632e-01   +5.345885634634213e-01   +2.312054806667584e-01   +1.102387541986719e-01   +1.505152843321495e-02   +1.223587952848793e-01   +3.251201154477595e-01   +3.486387659089375e-01   +5.596647157810677e-01   +3.230709808121406e-02   +5.396552341047934e-01   +3.872317074465623e-01   +3.472356350043860e-01   +5.045038567082331e-02; +1.903112954769835e-01   +5.192168385575402e-01   +1.370718443026678e-01   +5.521806144380415e-01   +1.225111678723925e-01   +1.062440766100857e-01   +5.271993143200661e-01   +9.777901590744006e-02   +1.282500609274989e-02   +3.156528652266832e-02   +2.806311011203887e-01   +5.004371665898832e-01   +4.058958153709715e-01   +5.021548391398600e-01   +5.782792237471901e-01   +1.796623263220931e-01; +1.221511384829649e-01   +5.977369360969355e-01   +4.763226737051117e-01   +4.710324755246165e-01   +5.455421039364626e-01   +1.971961533793226e-01   +3.340518744085283e-01   +4.593222422529092e-02   +4.450071441651811e-01   +2.240148389426792e-02   +4.391736229140353e-01   +5.108567428687333e-01   +5.330957711285923e-01   +1.339957867139591e-01   +3.466282381215215e-01   +6.319078317045900e-01; +5.576192930627582e-02   +3.754856946881888e-01   +5.858199732368081e-01   +1.135639977853550e-01   +2.638374390153103e-01   +1.079869429409868e-03   +2.595311157137951e-01   +5.086937797496214e-01   +6.057775997526728e-01   +9.084586764414164e-02   +1.800956780142789e-01   +2.896865245185271e-01   +1.771301427828292e-02   +2.284327183877908e-02   +4.209734334457513e-01   +7.791831992768580e-02; +4.547709226410324e-01   +4.321397856436542e-01   +9.229212568390177e-02   +5.293105280415966e-01   +3.448366484744174e-01   +1.447792059603022e-01   +3.425845576437911e-01   +1.386492381213682e-01   +5.359711710025324e-01   +8.210460942681105e-02   +3.317636533992523e-01   +1.243708358630860e-01   +1.585525626023215e-01   +2.521978669111265e-02   -4.107975904697299e-03   +3.578645886698152e-01; +2.061986465302784e-02   +4.579996280079138e-01   +4.899381256387443e-02   +4.225863635258588e-01   +5.690433972552752e-01   +2.925642964960338e-01   +2.470945710640330e-01   +5.599883225444943e-01   +5.960101132529929e-01   +6.047542737134951e-01   +5.688648012696258e-01   +5.856241531975351e-01   +3.495535098776763e-02   +1.048215750440217e-02   +5.479640198784955e-01   +2.412943689246019e-01; +5.552695209658448e-01   +4.415210277704006e-01   +8.165137005185064e-02   +2.218005935578392e-02   +4.068788244993168e-01   +4.178475178411865e-01   +3.338849928632609e-01   +3.126853658811416e-01   +4.567467147234842e-01   +2.971560513276910e-02   +4.605005689079210e-01   +8.222310330680328e-02   +1.452730084671639e-01   +1.719326301034841e-01   +3.720228722430970e-01   +2.067449002523509e-01; +3.858692365239281e-01   +3.606057157552950e-01   +5.008266392462660e-01   +2.771605052407669e-01   +1.900632042632557e-01   +8.878303813150089e-02   +4.248229731729480e-02   +2.648887466286569e-01   +1.321086186048948e-01   +4.917580229704076e-02   +3.776991081083072e-01   +3.213920033975466e-01   +1.715080928455494e-01   +4.647695797334108e-02   +1.968021743095491e-01   +1.278934164016398e-01; +2.981954472605287e-01   +6.217738848351770e-01   +3.841921129305199e-01   +3.844909734437486e-01   +3.916996823024909e-01   +1.762168581209822e-01   +2.775524387383286e-01   +3.449333743850939e-01   +5.522923495418836e-01   +4.016711847307029e-01   +2.712018526328324e-03   +4.879990316229552e-01   +7.421511352504516e-02   +4.890820796156837e-02   +2.897577364282754e-01   +2.394304646032673e-01; +4.631389122112051e-01   +4.367811157242047e-01   +8.364537582353912e-02   +3.587774494890002e-01   +1.743808564428566e-01   +3.452757713618388e-02   +8.056664145693367e-02   +5.632906350744482e-01   +1.458685727592151e-01   +4.668915561482287e-01   +4.536493681343355e-01   +3.723663799195270e-01   +2.653878248235320e-01   +5.608407176184412e-01   +2.291185914720256e-02   +6.024296258265434e-01];
L2I_L1I_iGABA_netcon = [+1.327141203208050e-01   +3.638344978397663e-01   +5.773143181974971e-01   +6.336956593736662e-03   +4.761022760260074e-01   +1.334170216227859e-01   +9.139212024883223e-02   +5.479899372336413e-01; +1.894142062005704e-01   +5.376349432172458e-01   +1.255470728603630e-01   +3.381719615368504e-01   -1.192458471524502e-03   +2.536785223686407e-01   +5.384131003618410e-01   +3.535968108664111e-01; +6.805295099126915e-02   +4.233057158319743e-02   +3.218496659902038e-01   +6.222566593813422e-01   +4.311636444264842e-01   +5.158191401568502e-01   +2.441206530222985e-02   +5.393927967796305e-01; +1.054545881329331e-01   +6.443620754477788e-01   +2.203969672426572e-02   +5.228997482477924e-02   +7.798186961810111e-02   +4.322800351018812e-02   +1.663544454427437e-01   +4.237689476940390e-02; +1.879330147285185e-01   +5.969119662626463e-01   +4.315462253113457e-01   +1.499801547421050e-01   +6.118334383574496e-01   +1.236313373373445e-01   +3.800897085271665e-01   +3.920435913632054e-01; +5.053185099987237e-01   +5.687892953247228e-01   +2.325682147782958e-01   +5.820271241534467e-01   +3.903608783862515e-01   +4.128976516426610e-01   +2.226844482682985e-01   +2.206183354136843e-01; +7.899271136537342e-02   +3.303225396658820e-01   +2.120620222600085e-01   +5.416294471512698e-02   +8.810966970434622e-02   +1.106276463176867e-01   +1.084846356681778e-01   +1.660035136584823e-01; +2.123167876465584e-01   +2.336430774059954e-01   +4.154561073090251e-01   +4.170757853638422e-01   +4.327318189843904e-02   +6.253443468231982e-01   +3.349594937559493e-01   +1.424154658724716e-01; +4.117490603848166e-01   +8.970613023804840e-02   +5.918986246505119e-01   +6.697224041863215e-02   +2.698264349001423e-01   +1.575145065665641e-01   +3.200872692789605e-01   +6.114383215059915e-01; +3.261652879059638e-01   +4.979823980370078e-01   +4.423080522814242e-01   +4.407236781735908e-01   +4.310171867024341e-01   +7.999959111991063e-02   +3.690497769257498e-01   +1.717148736332154e-01; +2.576004211550141e-01   +5.511796228085312e-01   +3.946846326057673e-01   +4.025968645527668e-01   +5.284717662715891e-01   +4.843169415827235e-01   +9.402685871242534e-03   +6.143197840125588e-01; +5.807051266875194e-01   +1.216032508334532e-01   +2.900592994814177e-01   +6.138689381393571e-01   +5.691817958847601e-01   +2.707930065728104e-01   +3.575708539229128e-01   +6.163543787027321e-01; +4.349341492411224e-01   +3.658945392235662e-01   +3.703205307471439e-01   +5.658417193295486e-01   +2.801874156921107e-01   +1.574561556986303e-01   +2.296948497577257e-01   +2.032678344542897e-01; +9.373946014038945e-02   +6.273779449832699e-01   +5.930162378327205e-01   +4.488924670619555e-01   +1.837436368811786e-01   +6.915681211070070e-02   +1.506638269635096e-01   +3.009999542780575e-01; +3.865326853528639e-01   +4.757416764498387e-01   +1.438462250075053e-01   +5.584203328409748e-02   +2.238669814465125e-01   +6.306138368052662e-02   +5.264377291311333e-01   +1.341840023623704e-01; +7.077457975393070e-02   +2.759354046210644e-01   +4.681592982038312e-01   +6.283566305768243e-03   +5.730807637584550e-01   +4.029231780041867e-01   +3.649233401717049e-01   +2.779820413728877e-01];
L1I_L2I_iGABA_netcon = [+1.913358827581134e-01   +1.787703438358753e-01   +1.872936364941379e-01   +3.833865813548628e-01   +4.250633981504455e-01   +2.059710072060120e-01   +1.476485984165850e-01   +4.752985639798624e-01   +2.346397841962582e-01   +2.515984931587670e-01   +4.416999310763746e-01   +1.354511915578714e-01   +2.563890254617278e-01   +4.395039170092965e-01   +5.329421162587620e-01   +5.138680626509415e-01; +4.566258481771839e-01   +3.581833397276293e-01   +5.639962385748513e-01   +4.305356208138263e-01   +6.014614939603299e-01   +1.682535235225930e-02   +3.563181340423629e-01   +1.640705437557369e-01   +2.149108804687726e-01   +1.011721615853181e-01   +5.875949288674478e-01   +4.491989252326239e-01   +6.120220133917221e-01   +4.830350085552878e-01   +2.862812548316080e-01   +3.872393187357965e-02; +3.495306981000939e-01   +4.056832369616035e-01   +4.437801192569858e-01   +3.901629330372742e-01   +1.647824963926102e-02   +5.020335200905318e-01   +8.069509544195252e-03   +3.047457655279277e-01   +6.289681037470740e-01   +8.533132110903510e-02   +2.350116849114448e-01   +3.558246957810550e-01   +1.066849094225580e-01   +5.752941075280595e-01   +3.563194391590904e-01   +5.222065864370836e-01; +1.907970245386365e-01   +2.163317674227314e-02   +2.246883093657643e-01   +1.770890175596300e-01   +4.125201141453478e-01   +4.390686704850096e-02   +3.324562243650537e-01   +2.383682286481774e-01   +5.734350435543477e-01   +4.784358956560344e-01   +4.261830707546518e-01   +2.293124609765627e-01   +4.857450516418704e-01   +5.580541644390626e-01   +2.587428041532045e-01   +2.777181216735777e-01; +5.272067789269987e-02   +5.293015656887100e-01   +1.022808600011848e-01   +2.134113594319215e-01   +2.905871345956250e-01   +4.403915739677852e-01   +5.956493177704972e-01   +5.940861480893115e-01   +5.534773482394798e-01   +2.310307586032128e-01   +4.073459753839472e-03   +3.231218218567877e-01   +1.154401863025896e-01   +4.837453424576379e-01   +1.109975458434829e-01   +5.050962578842544e-01; +4.855066251504886e-01   +1.292456712398594e-01   +3.674801525379088e-01   +2.531484594969485e-01   +5.453664660969243e-01   +1.999517302354809e-01   +1.445299721404735e-01   +5.078897276556106e-02   +1.874066870222738e-01   +4.335049259853359e-01   +6.262840332721228e-01   +1.035996243745359e-01   +3.335507875291925e-02   +3.204888143165802e-02   +3.750687306407716e-01   +2.801791930153472e-01; +4.479014406373044e-01   +4.745698013957803e-01   +1.939681822122081e-02   +5.020835340352464e-02   +4.211373097182287e-01   +6.135107893336260e-01   +1.241772645525464e-02   +5.414185036278241e-01   +1.340688037452296e-02   +6.012522039361567e-01   +4.877202111413372e-01   +3.975352554289488e-01   +3.386969183513954e-01   +4.360697889369774e-02   +4.286800100962377e-01   +5.579156453305901e-01; +5.884511058166327e-01   +5.183456688530902e-01   +6.055940992837952e-01   +2.504796806424505e-01   +9.546068993339499e-02   +3.311951855683571e-01   +2.180236240806966e-01   +3.599496003771230e-01   +1.222861652326480e-01   +1.917029093263510e-01   +4.442721607954818e-01   +2.387953423801331e-01   +4.838108722134595e-01   +1.622874175394803e-01   +1.604858328706523e-02   +2.679908335956664e-01];
L2E_L1E_iAMPA_netcon = [+5.370854397878060e-01   +3.772709589091343e-01   +3.583032129944371e-01   +5.232058451230050e-02   +6.301989910543655e-01   +2.600069305151845e-01   +5.010938327953349e-01   +3.235795024588963e-01; +5.750466123261941e-01   +9.905633938335420e-02   +5.446067277331281e-01   +6.220381719559382e-01   +5.086920783164346e-01   +2.403574774250331e-01   +1.832258196916231e-01   +1.689912011571291e-01; +4.383447413326384e-02   +5.500033224504791e-01   +5.448726600316993e-01   +1.663992925102739e-02   +2.265271080494735e-01   +1.561934846287821e-01   +6.088877969394131e-01   +5.742401510699272e-01; +2.895730741004443e-02   +8.042712947836705e-03   +5.606345984774110e-01   +2.544100763537327e-01   +4.227394705140091e-01   +2.347816039798807e-01   +4.845910741834937e-01   +3.455338211472939e-01; +2.329775513285229e-01   +2.326595072197667e-01   +2.369117620249707e-01   +2.046194034638605e-01   +4.996331212438616e-01   +5.698306486754267e-01   +2.240564608298469e-01   +6.575084759225308e-02; +5.970053873677841e-01   +4.526232240463189e-01   +3.173456686133667e-01   +3.949806641081049e-01   +4.262330422651908e-01   +1.042648828509249e-01   +5.993062052143268e-02   +3.105219543573407e-01; +1.018199029189018e-02   +1.552669123889595e-01   +5.282679032032137e-01   +1.295108642195388e-01   +7.378564138487727e-02   +5.738391548496335e-01   +5.105163452760102e-01   +7.958453418740126e-02; +5.174015350985153e-01   +3.330273397945175e-02   +7.019105008956025e-02   +5.142962899964173e-01   +4.317062641304850e-01   +5.322528132154158e-01   +4.047514843549385e-01   +3.142538107776757e-01; +2.223613113189329e-01   +6.145211831260730e-01   +1.082756444206151e-01   +2.053280480965769e-01   +5.216151344290257e-01   +4.180738227127171e-01   +2.010120450355414e-01   +3.299151626918879e-01; +7.815222702496405e-02   +4.580653746880154e-01   +5.031005425649906e-01   +5.912434268397713e-01   +6.230335789784611e-01   +3.349706567769076e-01   +5.920172440796487e-01   +5.156664968194397e-01; +3.443988423024207e-01   +2.678176305699159e-01   +5.142873279378963e-01   +4.349662270848597e-01   +3.640818418828672e-01   +4.261597529226701e-02   +3.863656337072557e-01   +4.842660837745407e-01; +4.602085593738241e-01   +3.803293998786996e-01   +5.458055099600111e-01   +5.819880788840327e-01   +4.284218336618462e-02   +2.919229337060044e-01   +3.444220998523342e-01   +3.904427317207958e-01; +1.308429206224851e-01   +8.974226926974045e-02   +5.319563676615072e-01   +2.840705667500949e-01   +4.853526706164416e-01   +3.311101776987356e-01   +6.143011326736344e-01   +5.900417203458426e-01; +5.053545067413609e-02   +3.908048878847579e-01   +1.722425288076883e-01   +2.446566961908776e-01   +6.132072251646199e-01   +2.319594899086190e-01   +4.975046263413208e-01   +4.104178060125882e-01; +1.360024822895452e-01   +2.417999519875035e-01   +5.868617163815375e-02   +1.165764081171439e-02   +1.156321236818143e-01   +9.855500895943331e-02   +2.123538973994482e-01   +6.010523787135742e-01; +1.595319324096502e-01   +3.175760674641562e-02   +7.379272288585373e-02   +4.157278258808129e-02   +4.437636005783555e-01   +1.257855504675845e-01   +2.042071294379421e-01   +5.720460199135858e-01];
L1E_L2E_iAMPA_netcon = [+5.195663851684638e-01   +2.178921634187299e-01   +3.933749602748237e-01   +6.256556145677910e-01   +5.587045435585001e-01   +1.483173178483110e-01   +4.633534606460065e-01   +2.907647866789631e-02   +5.211443463676094e-01   +3.689387735025856e-01   +1.876246895096762e-01   +2.809153289573373e-01   +2.094813416681628e-01   +5.804588618422467e-01   +6.342938443536381e-01   +1.104262827245887e-01; +5.928819172483463e-01   +5.094650036722113e-01   +3.543761655009831e-01   +2.291913175291291e-01   +3.588186451385905e-01   +2.599444158041933e-01   +3.404106912283014e-01   +1.598013229733314e-01   +6.349351441465387e-01   +4.409256658414270e-01   +5.931817501799191e-01   +5.165295986777277e-01   +2.843195987501946e-03   +4.151678707094756e-01   +4.430745467261763e-01   +2.643022616196087e-01; +5.299625983200094e-01   +3.006304156812550e-01   +2.139375404196537e-01   +6.196764386025846e-01   +5.117398680816391e-01   +4.968829926013096e-01   +1.208402777238618e-01   +3.605233328448487e-01   +2.839502595604647e-01   +2.368136681821307e-01   +4.132810714049188e-01   +2.027073608374210e-01   +2.162073520324658e-02   +6.724621900417735e-02   +3.423640074194514e-01   +3.193059598465285e-01; +1.942318962387302e-01   +3.375885581623062e-01   +3.854934676179211e-01   +4.199308745491898e-01   +5.432255998515514e-01   +3.631361037516240e-01   +5.515553212721335e-01   +2.004463604604770e-01   +1.811779459349293e-01   +1.069983504366511e-01   +4.800175643281639e-01   +2.713539712833708e-01   +4.826620407437241e-01   +1.388339281396043e-01   +6.030832596385853e-01   +9.727031999193073e-02; +4.427312021209607e-01   +2.436592211495827e-01   +4.328851140194981e-02   +5.634012006705788e-01   +8.774939570558471e-02   +5.812151044337758e-01   +4.500373411267496e-01   +4.881962006573140e-02   +3.300982731157978e-01   +2.687336988062284e-02   +5.614371073099996e-01   +1.020042169409597e-01   +4.374932906233527e-01   +2.466770298131694e-01   +2.929802365202752e-01   +3.882164062302754e-01; +6.090739552015487e-01   +5.152469475680497e-01   +5.852937634330290e-01   +2.504638506486070e-01   +5.183499291021805e-01   +3.535797634375059e-01   +4.132101222520730e-01   +5.828353529871244e-01   +2.289083772103508e-01   +4.911540170036173e-01   +5.544871705111025e-01   +4.602678354763767e-02   +1.358837057307127e-01   +3.128615525794797e-01   +1.177295408276698e-01   +3.913610270397001e-01; +2.318312620015514e-01   +5.458389086030668e-01   +1.862272829139053e-01   +6.304356952600072e-01   +3.003610246176118e-01   +4.098666047939972e-01   +5.784292486773277e-01   +2.713711476911344e-01   +1.350423831191163e-01   +6.268224720784339e-01   +1.241071316025764e-01   +5.814415320245615e-01   +5.104373769216748e-01   +5.135911728053616e-03   +2.107262209946902e-01   +3.950065058436693e-01; +1.504171458303468e-02   +6.397726621415740e-01   +2.457505096741266e-01   +3.147705450214667e-01   +1.723445462652873e-02   +1.616781930574764e-01   +3.766009244929424e-01   +1.466363235382029e-01   +7.715887848516057e-03   +5.014179121561183e-02   +5.193458459588489e-01   +3.493419958975609e-01   +3.953536960170523e-01   +5.227020084400560e-01   +5.311976211244637e-01   +1.032998944796083e-01];
L2I_L2E_iAMPA_netcon = [+2.630433860328930e-01   +2.281379659068064e-01   +5.259346041224913e-01   +3.372761953006382e-01   +3.166073873293601e-01   +1.980495292739535e-01   +6.231566796224464e-01   +3.007645902623525e-01; +3.452059178363536e-02   +4.975392487918836e-01   +4.030812070472569e-01   +6.162171975326253e-01   +9.686533581911023e-02   +5.125671015438833e-01   +6.454388945658502e-01   +4.587735861513545e-01; +5.757752190436585e-01   +4.322480063341335e-01   +2.313096993718138e-01   +4.913140989195253e-01   +7.586937584917104e-02   +4.680335807258187e-01   +3.038395127529152e-01   +7.268134299068527e-02; +4.823693127077996e-02   +3.076906730561145e-01   +3.268812575072491e-02   +1.392427227577572e-01   +2.727630622723703e-02   +2.979689503796913e-01   +4.848357903201521e-01   +6.148084942008434e-01; +3.566646346613214e-01   +3.765157153471533e-02   +4.572381911365067e-01   +1.592178228245184e-02   +1.638051136122924e-01   +5.824315378703757e-01   +1.204362627305347e-01   +4.329167271158221e-01; +2.646843232963494e-01   +5.420304136225295e-01   +1.143061445727846e-01   +2.266994915533379e-01   +3.801786713484209e-01   +3.106613074414515e-01   +1.268521960702667e-01   +4.256058825375262e-02; +3.962588928027325e-01   +3.442941427886697e-02   +2.674764651869158e-01   +5.506198789483078e-01   +4.057374445765141e-02   +3.469894025581727e-02   +3.695955203185336e-01   +7.419977912132862e-02; +1.998574918789010e-01   +9.740793561313731e-02   +4.528957492069989e-01   +3.275387461305209e-01   +1.636598877930755e-01   +4.515489237252579e-01   +3.441567196624635e-01   +7.839936524338037e-02];
L2E_L2I_iGABA_netcon = [+2.923771083105980e-01   +6.381155925529529e-01   +1.760538276610149e-01   +5.561401235440433e-01   +3.532330771814227e-01   +3.061642327200682e-01   +5.785560440038369e-01   +4.207431576983124e-01; +4.677258986966122e-01   +1.053391831125383e-01   +2.730437912449243e-01   +5.054781148515721e-01   +2.994247293014914e-01   +1.090811870726449e-01   +5.537148293944930e-01   +5.578280573217340e-01; +3.329243255864422e-01   +3.199925781650168e-01   +3.979275380084776e-01   +2.100718507050461e-01   +4.482890665510598e-01   +4.696399401690544e-01   +4.729524070409495e-01   +2.854309324438284e-01; +2.629357973797947e-01   +3.870087977783722e-01   +1.749240412748126e-01   +5.319532576603648e-01   +6.406603285054894e-01   +5.494830439567966e-01   +4.553488415031673e-01   +5.833993035918734e-01; +2.052757475240545e-01   +5.778495655306277e-01   +2.842006294803055e-02   +5.145014928753073e-01   +1.884834367723604e-01   +3.761694392781017e-01   +1.479070865716640e-01   +2.767843594605390e-01; +5.210187990273821e-01   +1.386846594616676e-01   +2.575513660812533e-02   +3.103277846176710e-01   +3.424519332547712e-01   +3.506039218374921e-01   +3.620068908528901e-01   +2.088694193875577e-01; +4.732636706961649e-02   +2.889419967615205e-01   +1.930594785790896e-01   +4.275904867212013e-01   +4.019330769040507e-01   +5.349681874750021e-01   +2.953900389542422e-01   +1.402662533759839e-01; +5.034622006934524e-01   +3.367283504399444e-01   +5.964975649563249e-01   +1.497252260061855e-01   +4.788344008803136e-01   +2.061459025859628e-01   +2.001691031551982e-02   +4.261583809214585e-01];
L3E_L2E_iAMPA_netcon = [+1.315385964215658e-01   +3.713535852025144e-01   +4.078676183355253e-01   +1.536984617308620e-01   +4.450449905305132e-01   +2.170277588707737e-01   +5.484701652699217e-01   +3.751832726909107e-01   +6.277638815802402e-01   +4.704046863820897e-01   +3.149054566501973e-01   +4.717338140009238e-01; +4.884284972750591e-01   +1.520112847737634e-01   +3.438204886546675e-01   +3.892998472425165e-01   +5.866869309590000e-01   +7.067007156332254e-02   +5.854274863939782e-01   +2.789494314971137e-01   +3.161532601342470e-01   +1.250427278749131e-02   +3.097577553620753e-01   +1.415492880196290e-01; +4.397205059650563e-01   +4.005731898917928e-01   +8.733400758628077e-02   +5.380111187018219e-01   +1.141644945512033e-01   +4.090922501114466e-03   +6.008112748252453e-01   +4.578072891911220e-01   +2.443925751076982e-01   +4.690465150385308e-01   +2.170994907257358e-01   +1.750781421008933e-02; +3.271732638998086e-01   +4.116775950709023e-01   +6.139800618200726e-01   +3.946735906450206e-02   +5.049372466591646e-01   +5.783679388094579e-02   +1.420142987980363e-01   +1.571860012308672e-01   +4.482909146467307e-01   +1.787690615661612e-01   +5.601805452321064e-02   +4.883885034592667e-01; +2.177261981737741e-01   +1.202980589909915e-01   +1.688630822281795e-01   +2.576067369570700e-01   +4.485422869923523e-01   +3.270280743034219e-01   +3.644775701886470e-01   +4.992771451344021e-01   +3.994550695663313e-01   +1.802809926231421e-01   +4.134804635031299e-01   +3.274992674806315e-01; +3.859651218415263e-01   +5.386449161822640e-01   +2.137171306939516e-01   +5.633728394618752e-01   +6.982768863808184e-02   +1.893768903087079e-01   +6.158127397081354e-01   +2.387356272997463e-01   +4.202893291742119e-01   +6.957816963689427e-03   +2.101048650616776e-01   +6.266942135935457e-01; +4.564425005458810e-01   +4.073474746751045e-01   +4.713231383049452e-01   +6.006656059246754e-01   +5.546573931360393e-01   +2.849601816263111e-01   +3.927555510900580e-01   +1.769227879702567e-01   +2.481993601713103e-01   +9.838174197353251e-02   +3.179749970570842e-01   +1.366411944183322e-01; +3.528027639063271e-01   +5.385528471459308e-01   +1.847149313552399e-01   +3.054286852503944e-01   +4.765954156024874e-01   +1.820544186094439e-01   +3.383154062403823e-01   +1.437985846680680e-01   +2.053394210064942e-01   +1.473185856893791e-02   +5.896831331721054e-01   +7.668037718826244e-02];
L3I_L2I_iGABA_netcon = [+2.042613720894695e-01   +1.528427830641361e-01   +5.010359229478126e-01   +3.059086781307200e-01   +4.554066409960852e-02   +3.960859266669305e-01   +2.186097110651664e-01   +2.502527508945330e-01   +6.358069896279978e-01   +3.038078663643277e-01   +5.519139300045648e-01   +4.806829590350395e-01; +2.446648636693570e-01   +3.869136377267666e-02   +4.224160450506269e-01   +4.061221149791987e-01   +6.324728789581697e-01   +3.146673895669486e-01   +3.840949412160296e-01   +6.336118654618821e-01   +2.455932815014256e-01   +1.259909790381633e-01   +4.371473709598517e-01   +3.857722765163801e-01; +2.850219763260880e-01   +3.994896714520593e-02   +3.708409850967626e-01   +2.859742620546622e-01   +4.859002275913507e-01   +3.969867442512272e-01   +2.099058483950458e-01   +5.741837724195805e-01   +4.337213699365950e-01   +2.897920929382406e-01   +4.672202847691410e-01   +2.910907869950358e-01; +3.279180738745984e-01   +1.351327093741712e-01   +4.354606917523463e-01   +8.655911048281328e-02   +3.748460903445245e-01   +3.883212754637440e-01   +1.839174608929846e-01   +4.412213821696286e-01   +4.557030667572172e-01   +6.529626946172548e-02   +2.288340702879646e-01   +5.599988117561141e-01; +5.273644551023150e-01   +2.477743714231683e-01   +4.661341049608161e-01   +5.213377282810593e-01   +4.467856402504529e-01   +4.344131673815733e-01   +4.666740645757114e-02   +2.985741628240151e-01   +9.083626962877402e-02   +5.349694378711871e-02   +1.707827602601135e-01   +7.262956055962091e-02; +1.014875450649968e-01   +2.396898353323355e-01   +5.514635321093764e-01   +3.627170381001952e-01   +9.174662031185996e-02   +5.316516555293407e-01   +2.646551446245335e-01   +1.621374194940398e-01   +1.027941836690699e-01   +4.751878984616745e-01   +1.418855540637597e-01   +3.377960603297844e-01; +5.718459220914506e-01   +6.061586672890882e-01   +1.879371943652865e-01   +4.138760370612924e-01   +1.214488477259201e-01   +1.421914965047632e-01   +2.138420399807893e-01   +2.323836721182713e-01   +6.333073975387209e-02   +4.065469176224095e-01   +3.071681307623006e-01   +6.200163680901638e-01; +6.141259135135406e-01   +1.805676678897308e-01   +3.945831818034129e-02   +5.111846255110180e-01   +6.235030799141524e-01   +6.124864958485806e-01   +4.158519128378247e-01   +2.571327019722154e-01   +1.742832734953055e-01   +4.428356079979874e-01   +2.580458633761991e-01   +2.128791625050899e-01];
L2E_L3E_iAMPA_netcon = [+6.311255338121087e-01   +1.298106617681176e-01   +2.412356144573911e-01   +5.010516978628823e-01   +3.597379348840535e-01   +4.900552852466998e-01   +3.792357647530216e-01   +2.903067107646041e-01; +6.544568038953053e-02   +9.201516274632963e-02   +2.579722220233487e-01   +2.441076071363069e-01   +9.482386780370287e-02   +3.776184732638139e-01   +4.512945637320886e-01   +5.783222502639037e-01; +8.989724370287569e-02   +2.822817258377129e-01   +4.999713194647068e-01   +5.582648957164589e-01   +6.295575712775159e-01   +1.616615708383179e-01   +6.197083985876808e-01   +2.739371909694810e-01; +5.891846761633236e-01   +5.650895800330219e-01   +3.159588114328131e-01   +5.839941760416052e-01   +3.290092868463236e-01   +4.411054813225148e-01   +4.986920543602542e-01   +6.215229060111978e-01; +5.638513583215504e-01   +6.283801769383722e-01   +1.708859091263813e-03   +3.355531558667830e-01   +3.345726995284449e-02   +4.921572802662872e-02   +2.206756148288826e-01   +4.396744654462031e-01; +5.973815495876529e-01   +4.659266015949226e-01   +2.945759949451451e-01   +4.627283864735913e-01   +3.089294325157535e-01   +3.912489456355646e-01   +1.436644302288163e-01   +2.044154927538526e-01; +9.808704270039977e-02   +4.588289026213969e-01   +3.257945180291884e-01   +6.296803861755546e-02   +6.847820249325879e-03   +3.160619957542842e-02   +1.523064078051417e-01   +3.057146123453776e-01; +2.489716927630110e-01   +2.844754787647874e-01   +3.380383797334382e-01   +4.943572777052046e-01   +2.120054558437166e-01   +4.290726873837348e-01   +1.130238059925773e-01   +3.883309956043182e-01; +5.550381663402517e-01   +7.707099883109217e-02   +6.132796190137141e-01   +3.217819328311080e-02   +5.117726140117140e-01   +3.088602013432948e-01   +3.164868118352088e-01   +5.338891544263885e-01; +2.622299708206104e-01   +2.469074030031908e-01   +3.818186248394863e-01   +3.565303098659998e-01   +4.949864868551231e-01   +4.193065523163881e-01   +3.760296237867863e-01   +5.760668833550556e-01; +7.822237539003379e-02   +4.683056112614343e-01   +2.372904326184667e-01   +2.730921352467212e-01   +4.304113168520615e-01   +2.682935812444734e-01   +2.709417506240374e-01   +3.046903931628749e-01; +2.362895463489079e-02   +4.387221967650957e-01   +4.695632774307043e-01   +3.713831775423537e-01   +4.252196521595882e-01   +4.743311598234000e-01   +2.653130051642490e-01   +1.034551833406376e-01];
L2I_L3I_iGABA_netcon = [+9.197347843113615e-03   +4.243863375884043e-01   +2.895294826024811e-01   +5.295249167537704e-01   +3.759385518659937e-01   +2.050157626191644e-01   +3.730412278634040e-01   +2.673465308416425e-02; +2.560235886721914e-01   +3.813467983801154e-01   +1.411830642403563e-02   +4.578181718441495e-01   +5.708998328401602e-01   +4.546953165668803e-01   +5.156419477595088e-01   +2.711983895367012e-01; +2.633567765940363e-01   +5.441589192099440e-01   +4.885252032470316e-02   +1.310832430729656e-01   +2.260008038878343e-01   +2.478695012252687e-01   +1.847174034093366e-01   +2.703956122395721e-01; +3.022442229228867e-01   +4.934796198468005e-01   +6.546811030596399e-02   +6.349281066156476e-01   +5.471876322879964e-03   +6.319420343292487e-01   +2.715295514394860e-01   +4.971453842112348e-01; +4.027248672369140e-01   +4.606701392442352e-01   +9.102865588044773e-02   +5.381027021553678e-01   +3.406096833476531e-01   +1.211718087606707e-01   +4.309489662841806e-01   +2.508327971673899e-01; +4.223836589237925e-01   +2.260983416152044e-01   +4.024081626124966e-01   +6.102497340703016e-01   +4.403113040540101e-01   +1.243068339404003e-01   +4.119337084672490e-01   +1.018701469041564e-01; +2.248790011027984e-01   +4.777353427995985e-01   +6.111420148773234e-02   +4.696075246443742e-02   +1.727986692807559e-01   +4.901589858695194e-01   +4.000790725226485e-01   +3.438239304611693e-01; +5.468668061723458e-01   +3.930024963388050e-01   +1.869949684007412e-01   +3.067236154197817e-01   +4.342076051560543e-01   +5.255837193289099e-01   +3.466912299546779e-01   +3.567480348315649e-01; +2.041727354793314e-01   +4.048546571800866e-01   +2.844442491506705e-01   +1.366414481226788e-01   +3.166860963543832e-01   +4.141025039734497e-01   +2.873040093723573e-01   +2.683913443969435e-01; +5.187132387021063e-01   +1.909224449649583e-02   +1.978906232443413e-01   +2.907398222615661e-01   +3.746677310302612e-01   +2.814982290944522e-01   +1.617588001055925e-01   +4.002291927901044e-01; +1.828699191656522e-01   +2.912222954871368e-01   +4.926557381577873e-01   +7.930781058084033e-02   +3.904077346613098e-01   +3.220874801138812e-02   +4.687729154063026e-01   +2.507355827560044e-01; +5.574404430007790e-01   +4.873039803914547e-01   +4.898735172285634e-01   +1.641964086184017e-01   +6.218189024862852e-01   +5.967859167393703e-02   +3.944278690758509e-01   +2.200193930121223e-01];
L3I_L3E_iAMPA_netcon = [+4.263511702058483e-02   +4.073585045948182e-01   +3.039680431375016e-01   +2.922139727860383e-01   +1.965170158521860e-01   +1.737487477148849e-01   +1.542895469985499e-01   +3.655639433757526e-01   +4.662690676773475e-01   +3.386243256973259e-01   +1.659947952551029e-01   +4.194259064578584e-01; +3.573354563681044e-01   +4.297402852410525e-01   +3.178712960741066e-01   +5.119913207493642e-01   +2.992545523486704e-01   +4.357954975928288e-01   +6.236075934934729e-01   +3.478059806744476e-01   +1.877834497119392e-01   +2.645707816106891e-01   +7.522302275873492e-02   +6.264771716407799e-01; +5.205248551871173e-01   +5.292526022654870e-01   +3.394650133793377e-01   +5.321679959022709e-01   +5.140477543175324e-01   +5.429358621906443e-01   +1.399439582952004e-01   +7.263218072439279e-02   +5.241325401470046e-01   +3.401588355537682e-01   +1.525085169487538e-01   +1.790328409235682e-01; +2.567852257731616e-01   +2.800734488756292e-01   +6.712928910580467e-02   +1.418336182258122e-01   +6.731467597841258e-02   +2.491018514743523e-01   +5.001983536374639e-01   +1.096927883130421e-01   +3.237252377953600e-01   +2.666609344188163e-01   +4.295708178031102e-01   +2.003736590169482e-01; +3.030331911518683e-01   +4.382649664131767e-01   +3.717289865444151e-01   +1.341519707801284e-01   +3.054525005250465e-01   +1.714554084046702e-01   +6.339212195375785e-02   +1.556994458306210e-01   +8.622892853516095e-02   +6.136339065301704e-02   +1.912410811050571e-01   +4.053559082297662e-01; +9.124145544056837e-02   +1.406622884034097e-01   +3.054802614217083e-02   +3.343913170161115e-01   +2.786918876535256e-01   +1.870678231848409e-01   +1.501258324099657e-01   +3.159060190383779e-01   +2.046957343201751e-01   +1.192136775907859e-01   +4.761082948510030e-01   +5.893984023219393e-01; +3.655860636594158e-01   +5.574540439550200e-01   +7.712848747394861e-02   +6.002599536327972e-01   +5.603836344854505e-01   +2.713749191068843e-01   +2.869046156374452e-01   +1.080037953117418e-01   +2.135470161802360e-01   +4.683670090802388e-01   +1.630093580560010e-01   +6.281197952822732e-01; +5.322028042782731e-02   +4.119874878843761e-01   +2.259504045695840e-01   +6.025252676480836e-01   +6.011540670973603e-01   +4.539885941565050e-01   +5.110491938889726e-01   +2.216354704039722e-01   +9.972843612584309e-02   +3.341688854486173e-01   +1.707792972317535e-01   +1.208555013594773e-01; +1.766739035931327e-01   +4.310760714272940e-01   +2.159885816042895e-01   +1.087762502761769e-01   +3.673546920716572e-01   +3.973447926406201e-01   +5.269503225960259e-01   +5.060094620850697e-01   +4.347138720375195e-01   +6.094568247344585e-01   +1.966211623630023e-01   +8.998444046317494e-02; +2.095164329285935e-01   +1.036284868640300e-01   +1.024416803860090e-01   -3.741269627721562e-03   +1.963685989790240e-01   +1.022870882057994e-01   +2.415693052832988e-01   +1.234944942595774e-01   +5.200360502690263e-01   +5.636896611263711e-01   +3.337711268053689e-01   +2.501802552032089e-02; +1.064751398636308e-01   +2.662703418132789e-01   +5.422210642995516e-01   +1.099462435909420e-01   +5.730334485223593e-01   +3.735486885544762e-01   +4.511572827849984e-01   +6.391193619104371e-01   +9.937500529247091e-02   +6.050860496207421e-02   +3.503115577424468e-01   +6.288639752703971e-01; +5.110128309662659e-01   +4.059943198954657e-01   +4.861322129848826e-01   +5.326210236832535e-01   +6.081810417295002e-01   +5.943494302027138e-01   +3.757228665050998e-01   +2.603732061165307e-01   +5.278509216164415e-01   +1.338047510053617e-01   +3.590917592520032e-01   +3.799080751302851e-01];
L3E_L3I_iGABA_netcon = [+2.637390882747154e-01   +1.854340556528768e-01   +1.321071917343413e-01   +6.210736322651706e-01   +4.615994753109409e-01   +5.469510677145408e-01   +3.570732933321856e-01   +1.827915894652962e-01   +1.684897472231479e-01   +5.935746382192679e-01   +5.829659771628539e-01   +3.299116274350207e-01; +2.195115138815328e-01   +4.231973166374624e-01   +1.717205112134659e-01   +7.161927618914105e-02   +3.512877828584547e-01   +5.644557793556937e-01   +6.041432824339873e-02   +4.998942358754895e-01   +2.746618573303880e-01   +3.782684090549617e-01   +3.076064496985766e-01   +1.064969765300040e-01; +4.320405563697619e-01   +2.727981562979725e-01   +4.348890999513288e-02   +1.109349305208322e-01   +2.009628996042129e-01   +5.106465785843783e-01   +4.344368322196622e-01   +3.418406163901373e-01   +5.296558824908977e-01   +3.964457295382156e-01   +5.813054027647392e-02   +2.715605788758787e-01; +1.391498561930637e-01   +3.315460883614558e-01   +1.228074998684297e-01   +1.293476555175432e-01   +1.618788408295915e-01   +5.443621097627989e-01   +1.401917153072632e-01   +4.702669603362015e-01   +5.901100435735530e-01   +4.991846118434473e-01   +5.596400698264795e-01   +4.342910800492969e-01; +3.484388643338417e-02   +2.178595880011226e-02   +5.275734707169146e-01   +3.984360144993676e-01   +6.270648193905679e-01   +3.164326430099694e-01   +3.547674255980575e-01   +5.488190954490786e-01   +4.625934527619055e-01   +3.399962636398221e-01   +3.309125179590479e-01   +3.286161780284250e-02; +3.153998270717481e-01   +1.285658332690992e-01   +3.056266579962444e-01   +1.789925238010169e-01   +4.430526445638976e-01   +1.788539342929082e-01   +4.328774630391926e-01   +2.318908203711859e-01   +6.328457223777212e-01   +2.098717707874144e-02   +4.155004592915594e-01   +3.387424651833078e-01; +5.402982189653966e-01   +4.650621338748166e-01   +1.736475251866512e-01   +9.449425114740961e-02   +2.543318528532465e-01   +2.690086506569559e-01   +4.524880432207223e-01   +1.833076836444603e-01   +4.326873847164438e-02   +5.495694219021605e-01   +2.813616948638787e-01   +1.225959685318807e-01; +2.253064706280294e-01   +6.329490261145995e-01   +3.454460125659665e-01   +9.960797957817473e-03   +2.594252863466484e-01   +1.360451133769358e-01   +6.502757226593313e-02   +5.881746550414307e-01   +5.053961629894023e-01   +9.861266544929773e-02   +3.932766969635151e-01   +3.131366372527241e-01; +3.506643277008142e-01   +2.268924758439129e-01   +6.102339145272042e-01   +9.759652606441585e-02   +5.888900852778971e-01   +2.679871968218967e-01   +1.330138003634163e-01   +4.840685761533348e-02   +3.687905922599409e-01   +6.233543501854879e-01   +1.411264731252622e-02   +2.623086248720856e-01; +2.081817876810292e-01   +2.840363069534655e-01   +4.811639161323460e-01   +1.072616675897055e-01   +2.139326108108115e-02   +3.257749009064393e-01   +1.020576003035571e-01   +2.926665700844304e-01   +1.851800825174098e-01   +9.503418867075982e-03   +1.099671082730707e-01   +4.102623949079950e-01; +3.407799412136009e-01   +1.102743325151421e-01   +3.189561933787396e-01   +4.681803036191597e-03   +2.099474108061762e-01   +4.345457324826323e-01   +5.194183771414009e-01   +2.854831340080374e-02   +6.001487837648694e-01   +2.523534691296339e-01   +5.397542716585103e-01   +4.089810758747796e-02; +4.755964309821574e-02   +4.436475705658000e-01   +2.525441413603832e-01   +2.603208544024751e-01   +5.409914567367323e-01   +3.649192843845888e-01   +1.640184043494035e-01   +4.528484258923150e-01   +1.783364543830296e-01   +4.238323928918877e-01   +2.104065911851943e-01   +2.994139296851149e-01];
L2E_Input1_iAMPA_netcon = [+1.473137739765655e-01   +6.234596366389362e-01   +5.591787524631250e-01   +3.754554317469550e-01   +3.282375908545849e-01   +3.049295352206139e-01   +5.031430497657409e-01   +2.574397100811082e-02];
L2I_Input2_iAMPA_netcon = [+1.569873432711167e-01   +4.605443768901555e-01   +3.980978383016042e-01   +5.207762889933181e-01   +2.531035569650233e-01   +2.220175156577101e-01   +5.059056998100818e-01   +2.075463564980623e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  5.6 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = -10*((exp(-10*((t)-( 50))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 10*((exp(-10*((t)-( 50))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
