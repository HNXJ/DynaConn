function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.311587214272308e-02   +7.736668193253997e-02   +2.536620847343191e-02   +1.034731761315496e-01   +2.279134032257804e-02   +6.128914887398147e-02   -8.783498036753608e-03   -5.860429851048907e-03   +6.071255021673919e-02   -5.291099624056793e-02   +7.830925295391272e-02   -2.326463135914892e-02   -1.528224241158662e-02   +1.186717679615162e-01   +6.748723677458268e-02   +5.289391520031457e-02; +4.638777943765528e-02   +8.059792259783993e-02   +8.690749415882265e-02   +4.199061233605859e-02   +9.297627412424108e-03   -3.237275694970461e-03   +5.850954567370850e-02   +1.241673863396350e-03   +7.202797161091204e-02   -3.328103795961404e-02   +7.485347748070151e-02   +1.321827307821045e-02   -9.390906527302752e-02   +5.060911671279165e-02   -7.603482144746389e-02   +3.938603651821598e-02; +9.790975164527052e-04   +4.479156855987570e-02   -1.732655964218018e-03   +2.295083207874569e-02   +5.898900106998183e-02   +4.410893855723969e-02   +3.709407489536921e-02   +4.004853512221802e-02   -2.133128220220645e-03   +3.315330215094939e-02   +8.684840874767161e-02   -2.158025526799924e-03   -7.677984022722514e-02   +4.945416892174833e-02   +4.863250621272781e-02   -2.750351994195922e-02; -9.304300156175789e-03   -5.889680781706073e-02   -3.947913857182507e-02   +7.715091579276968e-02   +1.144276119203807e-01   -2.493392553161919e-02   -3.943833330800998e-02   -6.158285196887020e-02   -3.080727045513346e-02   +7.176197472227785e-02   +1.006053446819397e-01   +6.327256951880188e-02   -8.063972104431491e-02   -7.898213320051817e-02   +1.128885902728548e-01   +7.205273296550084e-02; -1.024530998812418e-01   +1.254491690357210e-01   -1.102512268356681e-02   -5.119888777976415e-02   -2.725819389656690e-02   +3.152477383873686e-02   +3.431005665588280e-02   -3.626424697597739e-02   -1.019513337938333e-02   +4.063290361327022e-02   +2.476895480597159e-03   +4.375423432952536e-02   +6.943631340348956e-02   -8.830683440826968e-02   +3.050056361342066e-02   +8.378786107658961e-02; -4.151148607782168e-02   -1.189479220970064e-01   +6.327679162716909e-02   -7.632098948726103e-02   +4.376765671996419e-02   +6.966091894145075e-02   +4.117875663500612e-02   +7.209719552712027e-02   +3.093469510618241e-02   -1.407606482331355e-02   +2.105606613020375e-02   +5.815938785191718e-02   +2.675497705005829e-02   +8.571242696969666e-02   +6.656338193959510e-02   -9.312829253707577e-03; +8.866304074738679e-03   -3.367051384334928e-02   +6.123411260106891e-02   -1.141999573214453e-02   -3.177780242315918e-02   +1.752828862801973e-02   +9.947074796819928e-02   +6.277328591120654e-02   +6.765750922771209e-02   -3.743934707332434e-02   +4.220726184530788e-02   -6.818043697602760e-03   +5.878263438215239e-02   +3.350366132873718e-02   -2.349599702462500e-02   +3.223299997503795e-02; +7.080550805148189e-02   -5.634544135244252e-03   +3.492435275812143e-02   +9.360049214502798e-02   +4.828803035465300e-02   +4.728416808145341e-03   -3.119259668989655e-02   +2.985549642141655e-02   -7.579641535711730e-04   -6.938282678012098e-02   +5.241846599373835e-02   -1.039404445903422e-01   -4.073592386918215e-02   +2.364412329864858e-02   +6.398451847425857e-02   +5.081979019280015e-03; +1.717074645763636e-02   -1.903744033839109e-02   -1.766956966126586e-02   -5.700688684447298e-02   -2.170235285335537e-02   -9.427357179606059e-02   +9.573519808164270e-02   +7.131809151385227e-02   +7.346183006370158e-02   -2.269765819175040e-02   -1.000782198734114e-01   +2.404729960715274e-02   +4.816598117427906e-02   -5.352755759797605e-02   +9.344314632710200e-02   +3.300936822550127e-02; +3.064354372969221e-02   +6.192194011692739e-02   +5.079521574042828e-02   -6.882412533702625e-02   -6.615832575005527e-02   +9.648307568743505e-03   +6.043558748026610e-02   +1.841839743146619e-02   +4.160718102402542e-02   -5.800669948017828e-02   -4.479517870633869e-02   +5.974745823548941e-02   +9.070408741483979e-02   +3.534272510575789e-02   -2.143221249855054e-02   +3.806713564456845e-02; +5.504650044058811e-02   -3.377899585327604e-02   +7.620831643546927e-03   +3.911247825392002e-02   -4.813845081426175e-02   -5.007036854483093e-03   +4.500732446138289e-02   +9.161546670593539e-03   +4.200103004379612e-02   +9.022018836717954e-02   +9.145321488451011e-02   -6.854200531778129e-02   -6.198287412193984e-03   +7.580557728821137e-03   +7.614885155223111e-02   +1.330498367114595e-01; +2.919378520887561e-02   -6.441204154705665e-02   -1.583846015821876e-02   +1.326781669301251e-02   +4.084960938659470e-02   +6.904274893401323e-02   -2.219281114597800e-02   +7.438127261907264e-02   +2.072987548249631e-02   +1.868918107236008e-02   +6.264862761448456e-03   -2.124801796563840e-03   -9.007973511469854e-02   +3.724992137526194e-02   -6.923642553604967e-02   +6.004441268278074e-03; +5.327998483944965e-02   +1.011669780934789e-02   +2.279166176422102e-02   -3.928884462024083e-02   +1.368066633930186e-01   +6.514578283812343e-02   -6.156749570310142e-02   +7.315521587251123e-02   +8.033348849031134e-02   -2.095409377869722e-02   -4.151305661504553e-02   -7.430444193862283e-02   +3.766291280405119e-02   +1.261215153522016e-01   +1.119489603893290e-01   -3.612615044394842e-02; +1.382456966340521e-02   +9.365844328662788e-02   +4.797331985314007e-02   +1.760975369898547e-02   +1.639926412246690e-02   -9.761539223216931e-03   +4.659218258418693e-02   +9.081761685011504e-02   +6.756969579898793e-02   +1.219016557734337e-02   -5.713518728467293e-02   +4.891601207362543e-02   +3.019103643873650e-02   +3.274736297015449e-02   -7.855349323266017e-02   +1.072835594929003e-03; -3.518013192436066e-02   -3.796073277449676e-02   -5.743583379540682e-02   -4.702625323582850e-02   +5.088934630250298e-02   +7.677689888282799e-02   -1.606954096463841e-02   +1.211329852601148e-01   +6.135813152859754e-02   -4.176620855867090e-02   -3.248608545671583e-02   -8.719758830793584e-02   +1.434772025449405e-02   -6.464650973155770e-03   +5.676302804513156e-02   +1.180951195376419e-02; +1.242869113992691e-02   +4.273216661096994e-02   -4.448377435421370e-02   +9.032242888670891e-02   -3.798528590081775e-02   +2.989771336284664e-02   +3.350770866166743e-02   -3.422222019012046e-02   -3.728090344635553e-02   +1.418924136413933e-01   +1.159089535296219e-01   +5.456818021439794e-02   -6.113690087502355e-02   +6.458194252887291e-02   +4.982309531041782e-02   +3.874025688579125e-02];
L1E_L1I_iGABA_netcon = [+4.148702600819072e-02   -6.346092064409845e-02   +2.292680166421929e-02   -6.697130773005973e-02   +2.726448854887605e-02   +7.018818441240021e-02   -7.822224893566067e-02   +6.526602313306917e-02   +5.880405096122873e-02   +9.759995175159170e-02   +6.246558866444124e-06   +2.812524587947449e-02   -5.519544283811369e-02   +4.456007427710566e-02   +3.866413962019089e-02   -3.112423011977967e-03; +1.018216075268912e-01   +1.348709495534065e-01   +8.250680503384906e-03   +4.673866730804146e-02   +6.981852159684412e-02   -6.962807862453045e-02   +3.797413087499149e-02   -6.878680705101857e-02   -4.143333625314093e-02   +7.079766240827604e-02   +2.642470144046236e-02   +9.953525338287619e-02   -1.460200714077129e-02   -9.102953324436804e-02   +5.845789953320465e-02   -3.311223691240726e-02; +2.296218360756770e-03   +8.408040646235407e-02   +8.816339508886217e-02   -3.333110056173628e-02   +2.477426525027332e-03   +1.112817487826746e-01   -4.587115729341046e-02   +6.380637794039477e-02   -5.746662466302904e-02   +1.631749777904694e-02   -3.614956374645450e-02   +6.442685294257403e-02   +1.335265536712666e-02   +2.003356807839218e-02   +6.059343184401984e-02   +1.479399493755053e-02; -1.167493057095025e-02   -6.864287520435089e-02   -1.708263193756947e-02   -7.899423916864429e-02   +4.517091518477953e-02   +2.550662270963986e-02   +6.739110793394040e-02   +9.516386970312250e-02   -7.143005316573657e-02   +4.364984020420145e-03   +1.415143000728643e-01   +1.209379800871340e-02   +6.131863406611936e-02   -3.642348673151458e-02   +1.865937706840267e-02   +7.304876176424741e-02; +1.107699790798618e-01   +3.167402143056516e-02   +6.312290147079713e-03   +2.933864527410025e-02   +5.098607891026444e-02   +2.123303217344048e-02   -1.274496012209483e-01   +1.771523301938063e-02   +3.286013699328777e-02   +5.437316341289300e-02   +2.251193305566371e-02   +1.195165398942244e-01   +2.248018570777433e-03   -4.995887886937554e-02   +5.200006076530558e-02   +5.717035282348766e-02; +2.795117111125719e-02   +4.832365402220389e-02   -4.461923136541422e-02   -4.881929955634723e-02   -7.566275403960830e-02   -1.666793845472491e-02   +3.462412156469692e-02   -5.883204564402385e-02   +3.746207532821337e-03   +5.153574323080638e-02   -9.807064500599025e-02   -6.413640723346659e-03   +1.148801899331654e-02   -3.257631411017525e-02   -6.145864094989419e-02   +5.388870799456883e-03; +7.574513923882023e-02   +9.063243095172038e-02   +1.603017949370950e-01   -6.249240478335746e-02   +2.514486938707228e-02   +6.066311006294013e-02   -1.397639974725758e-03   +9.033916210343818e-02   +1.627571991804442e-02   +1.470520995695985e-02   +1.180009711387570e-02   +7.766209223593573e-02   -5.270026467277227e-02   -3.961254719082342e-02   -2.506098233335253e-02   +4.984903945503188e-02; +2.992612252138285e-02   +8.989328962354994e-02   +2.651379158061541e-02   +1.315027821234068e-01   +8.909802017626173e-02   -6.726006324580464e-02   +3.939057685637545e-02   +2.126986150636487e-02   +2.879986076028444e-02   -5.092450633741530e-02   -5.501779170025416e-02   -2.507416347806926e-02   -2.259545469807070e-02   +4.998078749011176e-03   +2.645433437439738e-02   +8.928782808963760e-02; +5.467391210693820e-02   +1.060597919374657e-01   +2.961525304335376e-02   +6.491710441654670e-02   +1.074969873087016e-01   +3.881338664013461e-02   +3.247005643398021e-03   -3.456381791227939e-02   +6.766864432523679e-03   -9.569361508219880e-02   +5.685736697276322e-03   -2.694670366564297e-02   +1.488156514144622e-02   +3.324120547728554e-02   +4.020328869549284e-02   +6.082055532293106e-02; +8.804430329967240e-02   +3.148842073439494e-02   -9.123751788031696e-02   +6.567489778652003e-02   +9.122423236327583e-02   +9.296459346748956e-02   +4.615828429108038e-02   -2.511515510555555e-03   +1.019576309610757e-02   +9.327398452563220e-03   +4.256602784907068e-02   +7.163275866753134e-02   +6.213049797897046e-02   +9.203801777028713e-02   -3.634882119630181e-02   +1.201706268238913e-01; -5.451345248663343e-02   +3.114322643542120e-02   +6.356184531538113e-03   +2.974469383612847e-02   -2.293825756579178e-02   +3.441462308828774e-02   +3.239396029287477e-02   +1.088127195950937e-02   +1.866897721257409e-02   +5.771249299053200e-02   +8.030967385578089e-03   +5.357045149010602e-02   +3.480607645507315e-02   +3.301591428182302e-02   +3.290177343802003e-02   +8.166160607817384e-02; +1.990492052770271e-02   -2.419987937585677e-02   +1.101100457181477e-01   +1.079567780689711e-01   +7.196715544705041e-03   -1.011305912268711e-02   -1.981859392566365e-02   +4.586654082923582e-02   -3.219113767083128e-02   -3.247388571434764e-02   +6.380906480582586e-02   -1.643631960391528e-02   -1.562983958785255e-02   +2.294580388404114e-02   -9.676087249543402e-02   +4.751171684608133e-02; -1.000816838820640e-01   -9.666681109645675e-02   +6.447258928463984e-03   +1.474593176056901e-03   +3.239145257989011e-02   +5.190841086974826e-02   +1.063903048465509e-01   +4.205051007581210e-02   -3.548772794679680e-02   +4.211390452038971e-04   +8.682412995729460e-02   +2.203738893640033e-02   -2.269757662521888e-02   +1.223399024488622e-01   -4.108736220631765e-02   +7.829654148602572e-02; +9.624444686067091e-02   -2.273122988249139e-02   +2.742863744589990e-02   -2.782370398795385e-02   -7.958217182070285e-02   -7.975140572925653e-02   +1.531106635943224e-02   -4.823283591223404e-02   -2.818234883873642e-02   +3.111421874387766e-02   -1.122805717637808e-01   -2.583882552003865e-02   -8.973584585389413e-02   +3.819121989027440e-02   -2.804861450687738e-02   -8.814774935022746e-02; +9.417301794409694e-03   +9.566865017461110e-02   -5.802598996785294e-02   +7.617607816970950e-02   -1.973971061986493e-02   +7.378926709369946e-03   -6.701075604541081e-04   -3.204136099881465e-02   +3.524846039743110e-02   +6.187318213103101e-02   +4.330822642861728e-02   +8.657267719188762e-02   +2.841539985174878e-02   -8.414641998430196e-02   +1.188877380428091e-02   +8.656055413223618e-03; +8.610589924856391e-02   +1.598998856671820e-02   -7.753403764537585e-02   +1.021008692492037e-01   +9.808687425302096e-03   +8.919474569909074e-02   -7.279604695597195e-03   -3.309525572188771e-02   +3.507375081259566e-02   +3.137535330223406e-02   -8.759672524080886e-02   +1.135569989449157e-01   +6.673271169463020e-02   +6.866297514458780e-02   -3.869276935784675e-02   +9.487449208301733e-02];
L2I_L1I_iGABA_netcon = [+1.219399664942493e-01   +4.012424300389336e-02   +1.005253024566148e-01   +3.944198115322321e-03   +1.339466398164506e-01   +1.094121459089903e-01   -3.980355023700224e-03   -4.460496016705652e-03; +4.229138487584225e-02   -2.254717448913623e-02   -6.117502564156105e-02   -6.795310066050023e-02   -1.216177208812933e-02   -8.227005159104428e-02   -7.185306731329452e-02   +7.972799614312211e-02; -3.090597323507143e-02   -3.881798627179558e-02   +4.774294095308631e-03   -1.150855987933399e-01   -3.874186600783230e-03   +1.459516359124538e-02   +1.478629366052868e-02   -5.401229826011877e-03; +9.979243599439672e-02   +6.589157791354563e-03   +3.500226595315847e-02   +1.017861549358281e-01   -8.406750065534785e-02   -4.733853273959123e-02   +6.670736870923664e-02   -7.279637745306800e-02; +2.622177724449549e-02   +4.265287144122667e-02   +5.380194879007714e-02   -6.918778560902675e-02   +3.410041021320667e-02   -1.477015126225836e-02   +6.443401126814634e-02   +2.362469578809662e-02; +4.450143695167827e-02   +6.378006327238722e-02   +1.477101760084144e-02   -4.824863189165915e-02   -4.411735220159488e-02   -1.853623710219362e-02   -1.256690261999825e-02   +6.085305216663976e-02; +7.930654047018962e-02   -5.602126298466256e-02   -3.403477911017941e-02   -1.454142294416107e-02   +3.403180012211016e-02   +1.091439628381800e-01   -7.867163388719605e-03   +5.415282490742972e-02; +5.765858435147127e-02   -3.909260988937666e-02   +3.309687155722893e-02   -4.685963334546747e-02   -4.074507231161247e-02   -1.139858673858359e-01   -7.046960912698642e-02   +1.026903726381843e-01; -2.098441845977244e-02   +3.887257278391880e-02   -1.572369595117390e-05   -9.061371060361820e-02   +4.714027200388439e-02   -3.137665084261363e-02   +7.816583575008994e-03   -3.729778776758627e-02; -2.234815551176565e-02   +5.869705560677091e-02   +1.379143186581702e-02   -3.268018452220033e-03   +1.008760750222631e-02   +4.332200683993437e-02   +7.274696990844404e-02   -3.514215291075827e-02; +8.686260098326301e-02   +9.342289041089050e-02   +9.260616168031539e-02   -3.270950092958123e-02   +6.964508886250068e-03   +9.531940260210767e-02   +2.621586037792343e-02   +1.183030378463335e-01; +7.136717295111833e-02   -3.274738661208686e-02   +1.543307083484853e-02   +6.036066693339582e-02   +2.330021860077498e-02   -6.728608370229164e-03   -7.337208273303070e-02   +3.086831450895008e-02; +1.656272511188626e-02   +4.741217816722972e-02   +1.335986721397028e-02   -3.176117066580338e-02   +4.559791043397370e-02   +5.746048104698200e-04   -8.045289746855483e-03   +6.001326542370657e-03; -1.230669744359804e-02   -4.666342602416627e-03   -3.009146716392621e-02   +6.959356812687750e-02   -1.501244566166517e-02   -5.065102050853598e-02   +5.100921385080859e-02   +2.950873818874688e-02; +3.686678181704307e-02   -7.089387169808600e-02   +5.111326050120293e-02   +9.033074874203494e-02   +1.180579100236249e-01   -2.943575120220874e-02   -3.927015389158021e-02   +2.475914081070461e-02; +1.684395115688880e-03   -5.257605185867889e-02   +1.744605522978440e-02   -3.903236028693224e-02   +1.546353764950219e-02   -7.953500254182702e-02   +1.523861181812176e-02   -4.791249957119454e-02];
L1I_L2I_iGABA_netcon = [+1.668443008815442e-02   -7.248475507413206e-03   +9.703390890667354e-02   -2.266714525230145e-02   +1.081080334308511e-01   -5.561904945198109e-02   +4.922715238507307e-02   +5.547066188754932e-02   -2.362996176276001e-02   -5.583533299780528e-02   -6.472280501221159e-02   -5.347803235568439e-02   -6.534894854451503e-02   -3.122208112298345e-02   +1.179259163549276e-01   +6.892150544907631e-02; -9.957925146266397e-02   +6.761873465186984e-03   -2.862586442264283e-02   -7.071240529214264e-02   -4.313965860537743e-02   -4.287218835126626e-02   -1.135249653727987e-02   +3.129448705290515e-02   -3.989868340437103e-02   -4.438038125585179e-02   +4.880664921067209e-02   +8.511674289866088e-02   +1.005755131369822e-01   +4.131319527589897e-02   -4.092432866661687e-02   -3.189891285395334e-02; +8.093597471722230e-02   -7.698352447652157e-02   -4.887877554927618e-02   -4.287448761136792e-02   +3.730447943678820e-02   -1.318163736351192e-02   +1.352991808602053e-01   +4.994871296058225e-02   -1.728339180153216e-02   +3.809126487152585e-02   -2.067121558383896e-02   -2.615741200705830e-02   -7.944465395507912e-02   -7.622439626545344e-02   +8.963817704195245e-02   -4.331544107926152e-02; -1.634152987990047e-02   +1.228827404742474e-02   +6.382652744795250e-02   +6.511836783990485e-02   +3.320474104495404e-02   +6.948545236281076e-02   +1.820976088709027e-02   +4.271851324580506e-02   +6.491204660045173e-02   -2.052976884209749e-02   +6.456554795219271e-02   -2.419870979911920e-02   -1.133185810119167e-01   +7.326126600916373e-03   +9.866294509695483e-02   -1.104712741441051e-02; +3.573819815418338e-02   -2.369105158956950e-02   -3.402620883464112e-02   -9.882731450169664e-02   +1.231289953251799e-01   -9.040722722553621e-02   +3.506491667242221e-02   -1.238749258993144e-02   +5.677730553015742e-02   +1.185690077783494e-02   -4.583733633064910e-02   -4.526140672060451e-02   +8.387383499418885e-02   -5.174439095972851e-03   -5.232696719310651e-03   -7.340077915364074e-02; +6.752969246705107e-02   -1.030691429408466e-01   +1.315052410394799e-03   +5.350297416113767e-02   -1.001053689626898e-01   +6.667801434752846e-02   +4.589707830200011e-02   +2.942745897331939e-02   +2.104422742375575e-02   +7.767266405926193e-02   -9.242268460965752e-02   +4.811196084580579e-02   -7.403153268971592e-02   +2.261471240576594e-02   -9.524381256226389e-03   +5.388718537299654e-02; +7.336128340517058e-02   +1.850077240991457e-02   +2.808394189545035e-02   -4.529042859703905e-02   +4.854265592976979e-02   +2.326338273308554e-02   -1.570493957290226e-02   -1.855772018192708e-02   +6.129727847254277e-02   +2.811335331921734e-02   +6.802876024903097e-02   -6.719622064502373e-02   -2.590815482596037e-02   -8.671500228954188e-03   +5.525729308291135e-02   +4.708423301158002e-02; -6.499627952945661e-02   -3.029864481357762e-02   +2.959483461310052e-03   -7.085089035336825e-02   +4.506436473862360e-02   -1.042974254818916e-01   +5.820121984568338e-02   +5.231317806881865e-02   +3.852506984824264e-02   -6.045075035375998e-03   -3.324163827166667e-02   -1.475391380722311e-04   +2.360556796999844e-02   -5.736333493236319e-02   -4.909173421078113e-03   +3.893021843293401e-02];
L2E_L1E_iAMPA_netcon = [-1.822209126469633e-02   -5.536860202652442e-02   -7.439975580013763e-02   +1.004153770217187e-01   -3.734083883209605e-02   +7.814201575776313e-02   +2.617504843135348e-02   -7.752526683056083e-03; +7.987823020803474e-02   -1.861275327329944e-02   +2.506152774697086e-02   -1.281897085598276e-02   +1.595630115203569e-01   -2.565578787456630e-02   -8.646611049034345e-03   +3.188170763794708e-02; +6.555032093856902e-02   +8.369385976279195e-02   -7.862115727681460e-02   +6.137965388512339e-02   -4.595737519574507e-02   +7.251983388081824e-02   +2.906581310906102e-02   +8.836342594364430e-03; -1.018584160557473e-01   +5.714413502444726e-03   +3.637090356022007e-02   -3.884638143241242e-02   -3.033115675372408e-02   +6.980581914889909e-02   +1.185750352107216e-02   -2.316365839405288e-02; -3.556615554239223e-02   -4.023396014516355e-02   -4.020174739262313e-03   -3.217056911335325e-02   -3.222272279633770e-02   +2.774093746999260e-02   +8.319623894444936e-02   -4.057497803133674e-03; +3.344288500615010e-02   -6.107536608747417e-03   +8.088852966067799e-02   -3.738346821657106e-02   +1.242519376569869e-01   -1.055240525004827e-03   +4.106725637321085e-02   +1.163860855606332e-01; +2.605484514426744e-02   +1.005661437066245e-02   -2.836444198388936e-02   -4.198897517756649e-02   +5.523538303996812e-02   -4.693606585160220e-02   -3.085097427532204e-02   +4.133562530673425e-02; +4.305785209248154e-02   +1.119770251345208e-02   +1.156224757304641e-01   +7.943203101921224e-02   +4.619397179861121e-02   -3.502361184292426e-03   +1.784675185956393e-02   -2.686745983985646e-02; -5.572679954107467e-02   -3.921222973421771e-02   +7.547951294179950e-02   +7.948953033241682e-02   +1.063217826400815e-01   -7.138946608965206e-02   +2.672519982185800e-02   -8.790750316106738e-02; +7.601692219403504e-02   +4.000944761162424e-02   -2.229306131924493e-03   -8.563814485883073e-02   -5.709792522728126e-02   +5.296578411076118e-02   -1.499925624012442e-02   +8.462426623130351e-02; -4.389248516313705e-03   -7.006268725350676e-02   +1.063465473490239e-02   +3.438513303258982e-02   +1.226398004536775e-01   -7.553941395399784e-02   +1.575599488781835e-02   -2.876493418374364e-02; +9.217046552621145e-03   -1.414942290910275e-02   +4.538557417797727e-02   +6.697113135257211e-02   +2.051686910240963e-02   +1.355503705407077e-02   +6.952872619039586e-03   +5.413347715198623e-02; -2.896859787308136e-02   +2.102037506421103e-02   -1.232738980330210e-02   +8.168957301183075e-02   +7.555321960440578e-02   +1.036951981089443e-02   -1.422553281300400e-02   +6.787397688580886e-02; +2.779180957039725e-02   -8.076819456960888e-02   +1.084173924825139e-01   -9.576901863124779e-03   +2.501822606968759e-02   +7.491452619763554e-03   +8.724288592435361e-03   -1.298296063637771e-01; +6.977432335970010e-02   -2.056425505451734e-02   +6.333459285552495e-02   +3.200887355405257e-02   -2.480158232191083e-02   -1.632332078811094e-02   +1.004256775493310e-01   +2.954944765505696e-02; +1.442304161355064e-01   +2.418461867249430e-02   -4.114321228276305e-03   +2.492340188222528e-02   +8.490865858569829e-02   +3.268778863000624e-02   -5.046266624840449e-02   +5.416498776760977e-02];
L1E_L2E_iAMPA_netcon = [-2.138574351756947e-02   +4.455853535269035e-02   -5.453058351076164e-02   -7.920803872941001e-04   -2.550728405589630e-03   +3.687503408653613e-02   -1.284960554739051e-02   +2.983285408110118e-02   +4.931148304947201e-02   +8.135253704890218e-03   +3.675453899834168e-02   +6.409055174681275e-02   +7.447593449663385e-02   -4.739477765239409e-02   -2.704728714798871e-03   -1.276516759990961e-02; +5.912899060732807e-04   +9.377483096951289e-02   -5.760721275044980e-02   -7.981560243101841e-02   -3.426320839425021e-02   +1.285331629796587e-01   -7.478383642611489e-02   +4.704103639577267e-02   +1.899601398364432e-02   +1.684194255629374e-02   -9.126487408398690e-02   +1.567987896898568e-02   -3.930293823180500e-02   +1.213829613910407e-02   +9.516853329115930e-02   +5.609266439816007e-02; +6.331113587761486e-02   +2.525342703270005e-03   +4.320302822742502e-02   +3.132704061830846e-02   +1.340022258336489e-01   +3.236110962279898e-02   -1.132158251953008e-03   -6.091327194396700e-02   -2.721812107528432e-02   -2.031360655910543e-02   +2.454787834177571e-03   -1.629602820941099e-02   -2.795554024682403e-02   +1.906600518725068e-03   -4.740493644329576e-02   +1.514349269247843e-01; -5.785220355042694e-02   +3.986459053186352e-02   +2.274421449402908e-02   +1.166567640724101e-01   +1.302664853128937e-01   +7.936017241445187e-02   -3.430983724388563e-02   -4.200748418569461e-03   +9.921524375152690e-02   -6.261465336390545e-03   -2.460688991027568e-03   +7.188805076745253e-02   -8.123681076037959e-02   -5.576663863272908e-02   +1.094406609501034e-01   -4.397293061495872e-02; -1.141764958832139e-01   -1.201080598529993e-01   +3.920637977181009e-02   +4.298964045378585e-02   +3.035241811994343e-02   +1.085154391741237e-01   +8.777189099445187e-02   -6.684776771016326e-02   +9.563523507480190e-02   +4.736784164384823e-02   -3.158943745340360e-02   +3.573719870461656e-02   +8.107937918656211e-02   -3.163603475050118e-02   -6.329438200053833e-02   +1.080525332711372e-01; -2.231033630657975e-02   +4.874255987082506e-02   -4.167394247145038e-02   +2.122209499949214e-02   +5.811854235411289e-02   +6.620619459031706e-02   -6.246669506996090e-02   -8.788460704675474e-02   +1.387391250627931e-02   +1.131235646107348e-02   +1.152774739875857e-01   +2.987482593153621e-02   -2.721177670030068e-02   +6.214488918125244e-02   +3.021376477589390e-02   -6.362868054500898e-02; +1.724133333120944e-02   +1.027000184814560e-02   -2.424033295725569e-02   -9.883586697214095e-02   +2.406469595575259e-02   +1.701223980491731e-03   -4.935434687106161e-02   +6.247121678718114e-02   +3.684966869504371e-02   -2.274973848323077e-02   -1.112842986466108e-01   +4.453322058086143e-02   +3.123349753221904e-02   +2.502936772122686e-02   +1.047411507534722e-01   -2.711170924020009e-02; -9.299303255250108e-03   -9.743560743209850e-02   -4.716389470883071e-02   +5.122734377649824e-02   +1.355388419727347e-02   +8.722993835839289e-02   +2.439929577365613e-02   +6.889094417467963e-02   +9.949249731895324e-02   +4.719950474872869e-02   +2.236924483410263e-02   +5.379665764903233e-02   -2.413529520484515e-02   +4.021387650481511e-02   -4.387506749755005e-02   -6.740699680717280e-02];
L2I_L2E_iAMPA_netcon = [+6.768434384898657e-02   +8.649844873308818e-03   +6.079444266006448e-02   +7.117275076195907e-02   +8.477729891400179e-03   -5.334701496266568e-02   +3.447607415590302e-02   +7.282953570162955e-02; -1.776240613055570e-02   +6.273079665907444e-02   -3.758470342740051e-03   +6.817690359998171e-02   +7.563100466659614e-02   -5.237165425499209e-02   +8.391334702991440e-02   +2.993661815144447e-05; +7.579929691841306e-02   -1.056652013472873e-01   +5.848434366979645e-02   -1.988748936855890e-03   -1.142379284789992e-01   -4.921335668839703e-02   -8.228833189139489e-02   -5.537717084465156e-02; +6.321420945748076e-02   -8.958474473013089e-02   -8.305082566415274e-02   -1.118261142393421e-01   +3.597786960988378e-02   +6.190326525953593e-03   -1.022019498871799e-01   +2.346321974568195e-02; -1.864356815775228e-02   -3.525322221507859e-02   -3.651076549145067e-02   +1.290183713017689e-01   +4.163587151126899e-02   -3.413772226929045e-02   +2.621584583550641e-02   +5.731249198665055e-02; -3.183098490668680e-02   +3.830625266221070e-02   -4.692460681729090e-02   -5.033554269034440e-02   -4.902036690644231e-03   +1.671938987894359e-02   +1.003216099106703e-02   +1.656449263838570e-03; -3.571231729032526e-02   +7.022658435364067e-02   +5.268129207404847e-03   +4.810183102673416e-02   -4.117641638286237e-02   -4.975959347911528e-02   +2.548384708635097e-02   +1.374383743194298e-01; -1.048174264777853e-01   +4.071803192387030e-03   +2.079637623361643e-02   +8.438419067050121e-02   +1.211057025340633e-01   -1.851377276636430e-04   +3.524788746264856e-02   -1.779907135707461e-02];
L2E_L2I_iGABA_netcon = [-1.125436975720672e-02   -6.336606160648403e-02   +9.137549663570169e-02   +3.693362675614327e-02   -6.954111875753139e-03   +8.850834170627550e-02   -2.788662499512984e-04   -3.172859064112572e-02; +2.735015302435561e-02   -1.124631298552590e-02   +8.644377758188253e-02   -4.688783598923210e-02   +6.645044509465516e-02   -8.167272017810476e-02   +8.582066542248595e-02   +4.820694911474802e-02; +7.537117183040463e-02   -7.290393620764807e-02   +8.101642285449775e-02   +3.932917344406696e-02   +7.085229841962339e-03   +6.024500044446152e-02   +6.847021296615886e-03   -3.275880763581458e-02; +6.060569658366176e-03   +7.066080654702538e-02   -7.684777785381547e-02   -3.796107203694681e-02   -1.763517273453877e-02   +1.160705959331940e-01   +6.586876442632610e-02   -5.730250303449878e-02; -2.521452838606862e-02   -3.366142901852247e-02   +5.087143174509531e-02   -2.520691159907897e-02   -5.336357497439973e-02   -2.222870412584438e-02   +8.765650337578899e-02   +5.738214629933348e-02; -2.961544460618555e-02   -8.100775017507063e-02   -7.224145570203419e-02   -5.183289528285659e-02   -7.414018226792629e-02   +3.255826089905164e-02   +3.952685430074522e-02   +5.760852481137606e-02; -2.104751932202695e-02   +4.195811321120655e-02   -4.856764382595045e-03   +3.961293940840716e-02   -2.424520488473034e-02   -6.577164382757117e-02   +1.427467205213543e-02   +7.603237190992918e-02; -2.971584037375343e-02   -4.179683561815042e-02   +1.637434689452027e-01   +1.009949335648187e-02   +1.529900849487421e-02   +1.094608993724976e-01   +1.480098461422176e-02   +2.561747932617778e-03];
L3E_L2E_iAMPA_netcon = [+5.364908452167939e-02   +2.453200286605503e-02   -6.681778182317046e-02   -4.233800101836764e-02   -6.384770099788613e-03   +7.253956270110747e-02   -5.507030936746157e-02   +5.162301510726649e-02   -8.857368746278149e-02   +2.462915391736695e-02   -3.094626452226246e-03   +9.581778838509290e-02; +4.262346310983336e-02   -3.698138073840018e-03   -7.757602013862915e-02   +5.701179495174286e-02   -2.719116164185870e-03   -4.555784692606819e-02   +9.115624632088390e-02   -5.851344706038861e-02   +2.057967245962343e-02   +5.038477523494532e-03   -8.437195920041557e-03   -6.714338360387404e-02; +5.746463585106783e-02   +6.174581239080625e-02   -3.019855635137771e-02   -1.534971169656549e-04   -2.808379122698956e-02   -5.661386412933967e-02   -3.540290470474224e-02   +4.757375449304360e-02   -2.775735365364733e-02   +8.084326994776965e-02   +5.559903171139216e-02   -5.104624766407288e-02; -3.263787064666451e-02   +4.993875505429596e-03   +9.345395271937305e-02   +4.206389696370154e-02   +2.730795351185891e-02   -1.634306577817823e-02   -6.658541833189383e-02   +9.572727536509187e-02   -5.950852891786059e-02   -7.162289311377820e-02   -1.558988505162653e-02   +8.986757539705309e-02; +5.818798910452072e-02   +4.819062051988664e-02   +1.116748030934227e-01   -5.312859012165297e-02   +7.869496121960715e-02   +5.522392140117184e-02   -2.465559462478546e-02   +6.435458398946235e-03   -6.453307197456212e-02   -4.120485933601425e-02   +5.016764637879001e-02   -5.344122131673202e-02; -2.366881606510667e-02   +3.341760466409092e-02   +5.922920252532458e-02   -1.893796492367761e-03   -5.768126119879965e-02   -4.708974702819724e-03   -1.211855739022762e-02   -5.087546686808220e-03   +2.452179195843518e-02   +4.398687108459656e-03   -4.821850619589541e-02   -2.373773441534366e-02; -1.270200144732390e-02   +2.169499778421097e-02   +2.492740156033796e-02   +7.148608539978196e-02   +3.148638339741053e-02   +6.972126003397092e-02   +1.410927123062670e-01   +1.592286878814596e-02   +5.473393890364343e-02   +1.280453623639869e-01   -1.043280760410305e-03   +9.373963395209517e-02; +3.962402030183068e-03   +5.530271921949655e-02   -3.047708507475100e-04   -4.661245239461374e-03   -2.248113692827416e-04   +3.407717995203824e-02   +5.980145785390635e-02   -5.138558753842874e-02   +2.881425283503551e-02   +1.032882186349312e-01   +2.025956239749932e-02   +4.961833809384499e-04];
L3I_L2I_iGABA_netcon = [-1.302028173453220e-01   +6.696864080995148e-03   -4.168179693462878e-02   +3.851148721262000e-03   +8.311329101975141e-02   +2.438336416658688e-02   +6.225910997162177e-02   -3.715964690832146e-02   +9.912526359242488e-03   +5.528945910177391e-02   +1.567876943823215e-01   +1.133987703962856e-02; +1.493599471892226e-02   +1.572795119271428e-02   +1.619133719217490e-02   +1.077653805297214e-01   -3.865892139306318e-02   +1.130882089184576e-01   +7.493314860301263e-02   -2.481503393905372e-02   -5.984763809596104e-02   -7.629320689884150e-02   -1.504295993547359e-02   +7.990838825478432e-02; +6.748719886833855e-02   +5.427541465320317e-02   -2.954804272726000e-02   +3.639590665569913e-02   +6.009499248884816e-02   -8.770332405224553e-02   +7.081355908278403e-02   +5.597069497796280e-03   +8.888393002371701e-03   -6.953194502493433e-02   -3.475757025451390e-02   -8.721469235830458e-03; +1.300530477731992e-02   -6.054037934890227e-02   -8.513802734100498e-03   +8.229241257452515e-02   +1.279994563255894e-01   +8.373666573004518e-02   -8.340182504514923e-03   +4.385970346455955e-02   +2.059288816601780e-02   +7.814155380309584e-02   +1.091558842022194e-03   -4.078944801543787e-02; -1.229427733489180e-02   -9.739624824304897e-03   +4.636582410735798e-02   -1.159518783349760e-02   -4.527553312509358e-02   -4.227283497192369e-03   +2.532791225019242e-03   -9.350670792269117e-03   -1.833052769700081e-02   -7.792418387655892e-02   +5.295193915059000e-02   +4.503229292353227e-02; +3.764596477475250e-02   +5.683487015047785e-02   +6.329328577723904e-02   -3.265801026543377e-02   -3.719313290644244e-02   +1.058968396687116e-01   +4.689486659314559e-02   +3.733066167762048e-02   -5.850049592251919e-02   +4.791713360299076e-02   +2.495796414551044e-03   -2.416827077046308e-02; -9.050581096381599e-04   -4.384180530427935e-02   +9.968356840596906e-02   -4.844685733186035e-02   +9.487717429099533e-02   +1.462889008071111e-01   -1.121810370887555e-01   -8.125802129499024e-03   +1.436156556397471e-01   +5.250357591673888e-04   -6.614782045629293e-02   +7.353954389083979e-02; +3.858167439816006e-02   -3.884417452936217e-02   +1.438009844728577e-02   +4.325034555629907e-02   -6.025126900968275e-02   +5.182580160050466e-02   -4.838388855499834e-02   +6.550360095467563e-03   +6.486923952814633e-02   -4.814438900401188e-02   +8.289350923744709e-02   -4.211941482735396e-02];
L2E_L3E_iAMPA_netcon = [-3.880618578348025e-02   +4.824972226211900e-02   +3.493560094416573e-02   -8.160096844322655e-02   +2.838151988953608e-02   +7.914596643270169e-02   +2.486886191397907e-02   +1.108902819063631e-01; +8.208896449551838e-02   +1.478828798383483e-02   -5.736599824107032e-02   +4.787863361632003e-02   +3.987847797194972e-02   +5.787213271056934e-02   +5.371545936720691e-02   -4.628105035871080e-02; +1.379842988787099e-02   -6.086278909708562e-02   +2.295507137597201e-02   +1.026704819532615e-01   +1.381456445408106e-01   -4.239561175604430e-03   +7.074172528680157e-02   +4.461383675278652e-03; +4.256006776070362e-03   -4.912628818220646e-02   +3.921799925415861e-02   -1.031770632172912e-02   +7.981329216674191e-02   -2.366104584078746e-02   +5.807370354602215e-02   +7.457074672452453e-02; -3.149007146557704e-02   -7.659051808476568e-02   +4.982016772974125e-02   +2.532391828728714e-02   +4.489577417960397e-02   +8.207933249325922e-03   -2.922510302209350e-02   +7.726294715969068e-02; +2.396648885187256e-02   +1.371520046687109e-02   +4.338707264292160e-02   +1.851966843875086e-02   -7.851813812812031e-02   +9.612111872298736e-03   +4.249604969928000e-02   -6.023601810662124e-03; +1.484945311074229e-02   -1.714256928660015e-02   +4.739591506489037e-02   +9.422433160540555e-02   -1.379773849074250e-02   -6.798844002664055e-03   -3.090861883898188e-02   -7.481126214065015e-02; +6.378775590657579e-02   +4.165704543481984e-02   +6.272225742341175e-02   +3.910556522480103e-04   -3.081506776290649e-02   +1.065226351005515e-01   -2.266159556311743e-02   -8.903841621058103e-02; +6.056200401896530e-02   -5.151522184975127e-02   +3.276224144977979e-02   -4.654889840389420e-03   +1.552503790882438e-02   +4.409274774898526e-02   +3.065142514780229e-02   -4.899047815939288e-02; -2.450832790190273e-02   +9.297364863365049e-02   -1.255374202745469e-01   -2.517010777937597e-02   +4.888662720337244e-02   -4.008414919564611e-03   +3.412883060138902e-02   -2.696490975668412e-02; +1.079139696534102e-01   -1.911885724713375e-02   +7.850034856529026e-02   +9.280038332116414e-02   +8.529030172290293e-02   +6.695451596347281e-02   -3.429745902491836e-02   +1.144055896805400e-01; -8.223726559263979e-02   +1.716678277951939e-03   +1.726273536256238e-02   -3.700925982140804e-02   -9.922236619868623e-03   -2.614703855144000e-02   +9.467349795130148e-02   -2.106576870109136e-02];
L2I_L3I_iGABA_netcon = [+4.951492048025329e-03   +1.030152095752753e-01   +3.301106420516040e-02   -4.444196372573438e-02   +8.143850281264726e-02   -5.839975435232084e-03   +4.425421783993368e-02   -1.051446862428031e-02; -4.754539261726144e-02   +6.725763515831948e-02   +9.944790157877312e-02   +2.147110847329698e-02   +3.142886603197163e-03   +1.679478038107918e-02   +1.080142086076249e-01   +7.820550632073642e-02; -9.460749756961945e-03   +2.427523673603970e-02   -1.312803871158631e-02   -1.665430895141967e-02   +9.710443503612043e-02   +1.142073711856419e-01   -5.018632827662258e-03   +8.893635945892103e-02; +6.574801570314213e-02   -8.705564583706792e-02   +6.919770042219073e-02   +3.368401443857552e-02   +1.104658598450099e-02   -4.304804130533896e-02   -9.518748732728718e-02   +5.916279335169639e-03; +4.535783962293580e-04   -5.233326488954203e-02   -8.468461966895605e-03   -7.602412523819209e-02   -4.840115607013558e-02   -6.654588683843599e-02   -5.170870301715878e-02   -3.192799257355298e-02; -1.060954619625388e-01   -2.838869710199333e-02   +7.729521017062793e-02   +4.225116406759221e-02   +1.736599310653468e-02   +3.323158567469361e-02   -7.642152730215664e-02   -2.062487070368888e-02; +7.139730944169149e-02   -1.707648486652993e-02   +1.018765752010178e-01   +3.818043103056035e-02   +1.079418021890381e-01   +9.370571345962933e-03   +8.892029270045068e-02   -3.626659205593645e-02; +3.560646320710636e-03   -9.451718037627332e-02   +2.019098907369892e-02   -8.172095464850891e-03   -1.679893416503473e-02   +3.717029680019057e-02   +3.923989588420039e-03   +6.301183589958015e-02; +7.085803302935273e-02   -1.502649131772943e-02   +6.832025780018558e-02   +4.475845982493223e-02   +5.644799590053119e-02   +6.133757354979450e-02   +1.084689997071749e-01   -9.015864111217312e-02; +1.988847503793983e-02   +1.688595666133176e-02   -7.284720364744315e-02   -3.024001170518956e-02   +1.238148747993738e-01   +1.069864962029968e-02   +1.901646240710016e-02   -5.313362004703988e-02; +3.844210437524588e-02   -4.750634899188577e-02   -2.979587645721898e-02   +9.672325192507680e-02   +2.144393152760385e-02   +1.252612596303436e-02   +5.525817305963122e-03   +8.921862958242374e-02; -7.482027816940423e-02   +4.175875661977059e-03   -2.585882453352500e-02   -2.169342685415434e-03   -6.772386261358676e-02   -1.301213962328772e-02   +7.991420405775283e-02   +4.364679143385895e-02];
L3I_L3E_iAMPA_netcon = [+1.183552419152419e-02   +4.614160798308244e-02   -1.171489423755468e-01   +4.435825609746805e-02   -5.364013036559116e-02   -6.763674393612124e-02   +4.352075295916809e-02   -3.525391913376738e-02   -2.644439933682904e-02   -3.845617400921317e-02   -7.034582293895641e-02   +1.756251821494171e-02; +4.030286032442115e-02   +3.271300907019244e-02   +6.458509585862511e-02   -2.714419187565119e-02   -4.983383219369465e-02   -1.701703224970819e-02   +8.495022018839297e-02   -1.084999311635873e-03   -1.817711149484527e-02   +7.643134038497922e-02   +1.197235352998343e-02   +5.375003667432572e-02; -1.743919442037698e-03   -1.953938476013070e-02   +2.037604650799711e-02   -6.459455848533381e-02   +1.380478309438700e-02   -4.481117109525663e-02   -1.699818014899775e-02   -8.697204209452813e-02   +4.491606605060450e-02   -3.726283601175797e-04   -2.570795293099019e-02   -8.935557441888942e-02; +6.542543035932395e-02   +1.023154739719947e-01   +3.069608095374062e-02   +6.455494156534425e-02   +3.945478523158651e-03   +6.309375444255426e-02   +2.170397014471447e-02   +2.644900293212304e-02   -7.662596023214438e-03   +4.834613960467106e-02   +3.959340576115641e-02   -7.233008341033888e-02; -5.296150378978841e-02   -4.228400113078897e-02   -8.627611323671437e-03   -3.313664109992295e-02   -9.008929025110243e-02   +3.576685330456501e-02   -5.029031284278503e-02   +2.399323989487321e-02   -7.728523641172017e-02   +9.826879796317738e-02   +5.099749934284719e-02   +2.509874333440018e-02; +3.480560150463945e-02   +8.433854701781830e-02   +6.243208160534544e-03   -3.411793842247166e-02   -5.170714260085639e-02   -6.767166314700143e-02   +3.641259919625878e-02   -5.513600287861772e-02   +3.182916237425439e-02   -2.655134277155328e-02   +3.593033094856678e-02   +8.781839917278846e-02; -4.440239682399823e-02   +9.049709974079426e-02   +9.318057816356634e-02   +6.372659705039843e-03   -4.467778832188668e-02   -9.990463588184019e-02   +1.492797194440942e-02   -3.864506509128279e-02   +4.603653316986804e-02   +9.327863587494223e-02   -1.112430755513487e-01   -4.530868359111225e-02; +4.863630835610488e-03   +7.114443273869331e-02   -7.051310621630881e-02   -3.963567746360473e-02   -8.037707813473796e-02   +5.381000684326526e-02   +1.882940601273750e-02   -5.167426005355234e-02   +6.776263212026895e-02   -8.622927629267431e-02   +6.678445490143871e-02   -4.267723384659508e-02; -1.564374392699211e-02   +8.073329374600174e-03   -6.163000032196421e-02   +2.939458482578309e-02   +3.476500438415660e-02   -6.558941438598098e-02   +1.160543694444814e-01   -8.708620943311873e-02   -8.964522691344737e-02   -5.077816333123627e-02   -1.078214177383296e-02   -2.566589899311262e-02; +7.130244057156114e-02   +1.951897760213279e-02   +6.767009752359006e-02   -9.254424670737632e-02   +7.841607393090409e-02   +1.212564931358228e-01   +5.824792494331435e-02   +6.493890831758911e-02   -5.739265493403114e-03   +1.018514020148528e-01   +3.084751539515374e-02   +6.040528191997289e-02; +6.209212409282969e-02   +3.974701942915537e-02   -7.464603192956193e-03   -3.154287615786069e-02   +5.507121923061636e-02   -2.208781853462190e-02   +8.047383474142900e-02   -5.150469268806279e-02   -1.607689831065612e-02   +6.089058108843688e-02   -1.569441346787390e-02   -7.825613739308160e-03; -6.334548720195124e-02   +3.880738298112882e-02   +1.487415933077856e-01   +5.269041632122978e-02   +3.814206387949393e-02   +4.866149437841445e-02   +8.078249722875208e-02   +8.086416304299665e-02   -5.133959559585241e-02   -1.190435521279876e-02   +4.201942772946124e-02   +1.348938293802567e-02];
L3E_L3I_iGABA_netcon = [+8.218065213031196e-02   -4.170651436581289e-02   +3.792760813791241e-02   +8.036433418257166e-02   +5.034095947218096e-02   +9.212135428810971e-02   +1.176555970732043e-01   -3.729559921799337e-02   +5.102883182815807e-02   +1.786081915306097e-02   +1.396711741970260e-01   -2.360445347380231e-03; +1.599692418873461e-01   +1.064568319658694e-01   +6.889293491398080e-02   -8.842538947677170e-03   +1.131394642859446e-01   +1.017769260968406e-01   -1.113319999874161e-02   -1.989193652808012e-02   -6.753048436256476e-02   +1.130714311430112e-01   -5.249285897139072e-02   +1.258791448000969e-02; +8.503420303744330e-02   +3.680874316371346e-02   +8.381239961798452e-03   +1.946080433828838e-02   +1.023986442693197e-01   -4.488894894467642e-02   -5.400190419436602e-02   -1.657042981950760e-02   -1.870434369507451e-02   +9.839047933248157e-02   +4.411154350503348e-02   -5.049770312590363e-02; +3.109425167373077e-02   -4.628763684750486e-03   +8.071165573379456e-02   +1.116182176604305e-01   +1.417379577489265e-01   -8.540120888784242e-03   -1.407527928728101e-02   +5.296472524159119e-02   -7.874006360582228e-02   +3.215278638420836e-02   -1.489340292485961e-02   -3.255679594013918e-02; +8.566660435142957e-03   +9.215313369383045e-02   +9.736283649384302e-03   +1.863162987623343e-02   +8.441967445138712e-02   +6.720909489839531e-02   +3.881970508726250e-02   -8.339404263520790e-03   +5.635517554783846e-02   +8.053814808725175e-03   -1.007413849742341e-01   +2.762233157193063e-02; -2.281899665147066e-02   -1.239201008278198e-02   +5.481446848665848e-02   -1.065239932993393e-01   +3.567144746056000e-02   +8.470609544713105e-02   -3.396043163479931e-02   -3.005533022180422e-03   +3.405515627748071e-02   +2.658445848375667e-02   +3.353154080196714e-02   -7.593604495446762e-03; -8.287680765685485e-02   +3.312116157455060e-02   -3.204819089406172e-02   +1.586709802805544e-02   -4.608021506690625e-02   -7.500673890751143e-02   +1.603906725840546e-02   -3.345491832488317e-03   +2.457915127753126e-02   -3.134073245603645e-02   +8.385227909182139e-02   -8.167466764000715e-03; -4.543483374767050e-02   +4.862057013013939e-02   +1.376853239192648e-02   -1.316926450424520e-02   -1.168215995669963e-05   -1.192559906560622e-02   +5.713500397906989e-02   -1.254482483575516e-02   +5.226154818549605e-02   -1.111205714779753e-03   +6.135030672374021e-03   -1.190906910306790e-01; +2.939022105659413e-02   -3.238440956859729e-02   +8.008886726444048e-02   -2.520795893725497e-03   +1.028122732598156e-01   -5.796468340184695e-03   +3.274041304508687e-03   +5.371503155182539e-02   +2.012486375018101e-02   +9.485957312269809e-02   +2.286652889710663e-02   +6.998925592566885e-02; +1.204680494758201e-01   +1.172797500214300e-02   +7.581388923113630e-02   +7.246076736135750e-03   +1.328058860127858e-01   -5.217274602494085e-02   +4.680746815896149e-02   +1.568026323646717e-03   +4.688935196684553e-02   -6.301058607868647e-02   +2.095173865651037e-02   -4.304599669883140e-02; +1.255428899871458e-02   +9.168122390630040e-02   -3.747006440344187e-02   -1.941707174603619e-03   -3.989700137029076e-03   +3.885228956508024e-02   +8.904851598236613e-02   +1.047560711874049e-02   -1.148029153647079e-02   +7.811924981879126e-02   -4.219168061085382e-02   -8.684786218917284e-03; +3.944512287687125e-02   +5.764240856625777e-02   +1.973627701295707e-02   +9.377894258672786e-02   -6.157309778894115e-02   -3.138065876318372e-02   +8.517972030964320e-03   -2.690324978858169e-02   -3.429106333789970e-02   +3.943683908626213e-02   +6.712801409635341e-02   -7.461053892432154e-02];
L2E_Input1_iAMPA_netcon = [+5.217232070179758e-02   -9.062192513165304e-02   +6.737360608220730e-02   +4.117871350277497e-04   -2.514331975697524e-02   -4.350838597949117e-02   -6.878301585535052e-02   -5.665683147749302e-03];
L2I_Input2_iAMPA_netcon = [+1.662983884697709e-02   +1.062202050051877e-01   +4.270994901288822e-03   -4.227398061234464e-02   -6.648205951590100e-02   +8.265378089200107e-02   -7.814100682892031e-02   +1.129167496475149e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.3*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.9 + 0.6*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.3*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.3*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*1.0 + 0.8*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.3*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.9 + 0.6*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.3*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*1.0 + 0.8*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.3*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*1.0 + 0.8*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
