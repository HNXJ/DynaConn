function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.219887439183507e-01   -2.332745084877227e-03   +1.409600217935764e-01   +2.858661965653700e-01   -3.524300062960499e-02   -1.940469342543075e-01   +9.863545136881730e-02   +8.000718538685728e-02   -1.942391686681279e-01   -1.984800543892251e-01   +1.439883424052861e-02   -1.832881119560274e-01   +1.697359783877550e-01   -7.584223093062628e-03   +7.771607015653484e-02   +9.652984821741431e-02; -2.844873992728689e-03   +7.366248660970262e-02   +2.121079703561684e-01   -2.163376549285037e-02   -1.919434350739806e-01   -1.343929342619289e-01   +7.302864792388425e-03   +6.221693143881458e-02   -3.082552065201173e-01   +4.111941716519347e-01   -1.940163142705839e-02   -1.345116522693039e-02   +1.244639380138940e-01   +2.165376855058541e-02   +8.468639875600122e-02   +1.190798521511272e-01; +2.427229559236189e-01   -1.747431725418606e-01   -3.380119739435048e-02   +8.193341565187351e-02   +1.462127411711241e-01   -1.377260263355884e-01   -3.726920239652914e-01   -9.127392001948165e-02   -2.240710461629099e-01   -1.861648671448796e-02   -5.901971287958804e-02   -2.635725053693969e-01   -2.842111960293804e-01   +2.633249152742342e-01   +2.320848662852415e-01   +2.136921317654016e-01; +2.528250868148517e-01   -2.930491579873592e-01   -1.040905455835712e-01   -1.359088652728365e-01   -3.555899894595860e-02   +3.485037739294312e-01   -6.415829642644087e-02   -3.068377916620717e-01   +2.158577736864613e-01   -2.693251643338283e-02   -2.846204639543944e-01   -1.648743560442703e-01   +2.028319442625049e-01   -7.302016193334736e-02   -2.010861755118455e-01   +1.593930520447425e-01; -1.402070643372895e-01   -4.599705857776743e-02   +1.061428337976765e-01   -1.169665405823564e-01   +2.692496514681522e-03   -2.686374653276207e-01   +1.383071892089339e-01   +4.125898032145520e-02   -1.137888972662040e-01   -3.058383956637828e-01   +6.061027217438753e-02   +4.480927486521860e-04   +2.887898636854349e-01   +1.775008945237789e-01   +2.666157610742110e-01   +1.567894337501313e-01; +3.769110125159881e-01   +2.218813951125967e-02   -1.267546128243732e-01   +7.285181826737536e-02   -1.541729659147791e-01   -2.211143355481798e-01   -1.255006871686280e-01   +1.215561875450164e-01   +1.882920215117093e-01   -1.304290471034165e-01   +2.176250564399747e-01   -2.893809841317739e-01   +2.310500792845522e-01   -3.337583296514245e-01   +2.560775161578544e-01   +6.025702133873737e-02; +9.754468460527500e-02   +3.310557743851189e-02   -6.086591847617551e-02   +1.274223750081942e-01   -8.730860666592423e-02   +5.353543148139651e-02   +5.314450354306979e-02   +2.080454228983211e-01   -3.341186041348325e-01   -2.102123342756496e-01   -5.543173185342419e-02   +1.432367649125955e-01   -2.269288215718078e-01   +2.615533948645533e-01   +6.688304457112661e-02   +1.204215901026272e-01; +2.194617450956204e-02   -1.886164545397282e-01   +2.779143846600881e-01   +1.366049482075389e-02   -4.216883527697116e-02   -2.315945184760357e-01   +2.135991637369609e-01   +1.620199003748905e-01   +1.096165964543661e-01   -6.277921637660777e-03   +5.947143335874844e-03   -5.575473979043986e-02   +2.123763079607901e-01   -3.429562390393932e-02   -1.271980106895196e-01   -1.716142443786313e-01; -5.831988539325358e-02   -5.082807792884002e-02   +2.629305333590955e-02   +1.518356128578400e-01   -1.256181941004550e-01   -1.136779102533870e-01   +5.374460262225794e-03   +6.924402653418506e-02   -1.533094913937016e-01   -2.684938240831958e-02   -2.780663630912426e-02   +2.676744348839046e-01   -1.916126914768773e-01   -2.263163989888025e-01   +2.173086530439459e-01   +2.765066741460819e-01; -2.752373606834575e-01   +1.240630926957980e-01   -5.331293039302103e-02   +2.638090317845890e-01   +1.845559198563444e-02   +3.653229477946667e-01   +3.395692306715373e-02   -2.300026409829505e-01   -2.683109669728883e-01   +1.400505817018333e-01   -8.210351414476698e-02   +8.036972544056456e-02   -2.289612511282915e-01   -1.386089835587698e-01   -5.738586091656815e-02   -6.886558385292901e-02; +2.891822286960990e-02   -2.333151632101049e-01   -1.672190471462410e-01   -4.613622113414046e-01   +2.038890234524693e-01   +2.518079824564351e-01   -2.047961260143592e-01   -8.153341899993469e-02   -2.481278041978977e-01   +3.392745965927961e-02   -3.201734931128561e-03   +1.628767514180847e-01   +3.580648839652305e-02   -1.297945134950532e-01   +9.118661213900406e-02   +1.928555176732807e-03; -2.449330609776692e-01   -4.523807830394366e-02   +2.512092471870624e-01   -2.315558959227175e-01   +3.285168479929971e-01   -2.011484486397837e-01   +8.047069293975159e-02   -2.126125925922025e-01   +5.427190220076120e-02   +3.408517708513963e-01   +1.318808588456549e-01   -4.625152492470000e-02   +8.732388437204808e-04   +1.911133267912102e-01   -5.616198439707955e-02   +1.343744229177013e-01; +4.057247424290563e-01   -1.350973524489231e-01   +2.642310729915563e-01   -1.669573346005515e-01   +8.224529910910104e-02   +2.013653672874944e-01   +6.057603351833834e-02   +8.245541785224804e-02   -3.868001776292437e-01   -2.288930263383272e-01   +3.924871195811441e-01   -2.248006755895303e-01   -4.221475485283205e-03   -1.629687613245878e-01   +1.864538210812249e-01   +3.244360725926955e-01; +9.096263582880090e-02   +4.749153783401792e-02   -3.591475598085164e-02   +2.027733712658652e-01   +1.465076795139507e-01   +6.603995861134471e-02   -1.137831974192632e-01   +5.107970877636203e-02   +1.147121382882520e-01   -1.770377652470295e-01   -3.927961964023788e-02   -5.969064428235017e-02   -2.944724282899500e-01   +3.069378091078501e-02   +3.879368345494619e-02   -9.093905587349690e-02; -8.091896949987243e-02   +7.158132739283861e-03   -1.614203993800120e-02   -1.719237274951010e-01   +1.612064073380436e-01   -1.309569357119917e-01   +9.412651416473794e-02   +1.259707916412560e-01   +5.503144179919371e-02   -1.063488294460192e-01   -6.981942742560418e-02   -2.742460675016682e-02   -5.325593827099315e-02   +3.198328391897717e-01   -2.118374058547327e-01   +1.109357301507785e-01; +1.452845772318914e-01   +1.169023391554870e-01   +1.068417392205895e-01   +7.876824362893931e-02   -2.326397828862791e-01   -2.709709353462203e-02   -2.071079671209621e-01   +2.099950193062885e-01   -2.886956150988568e-01   -1.529133851386212e-01   -1.429968071762852e-01   +5.424760553302090e-02   +8.137320872108220e-02   -1.295961929525761e-01   -1.137402205684680e-02   +1.278360234726181e-01];
L1E_L1I_iGABA_netcon = [-2.360680975405670e-01   -2.574869353113186e-01   +2.921452788861517e-02   +6.602031656678346e-02   -1.438807609525603e-01   +8.231623698827545e-02   +2.664400987094990e-01   +8.442591357448113e-02   -2.551344351388691e-02   +5.681789492682263e-02   -2.377976823833151e-01   +2.577432660186945e-01   -2.290060799481736e-01   +2.807298098237601e-01   +1.667017653838120e-01   -6.936971771416527e-02; +7.077117458358362e-02   -2.702697898414486e-03   -2.442554512657820e-01   -5.075646853552621e-03   +1.387171641416110e-01   +3.480326351862545e-02   -2.880153884135487e-01   +1.962083041331944e-01   -1.349339858703514e-01   -3.038370400005702e-01   -1.266660234197106e-02   +3.887849491205046e-01   +3.775205785788514e-02   -2.511471354865209e-02   -1.239089375981876e-01   -1.070389153865897e-01; -1.496948969413704e-01   -4.239114898294377e-02   +1.298551877815602e-01   +6.505537644927466e-02   -1.416833046438771e-01   +3.506285738442062e-02   +7.107541859458759e-02   -1.957466313782270e-01   -2.234576936799754e-01   -3.385736896036057e-01   +7.887582482178132e-02   +6.437900789753416e-02   -1.367444288546827e-01   -6.031791143526819e-02   -1.405649848502631e-01   +3.273299557977695e-01; +1.488887217406182e-01   -5.405318181493335e-02   -5.499119892818733e-02   +1.007632765968741e-02   +5.805516365061789e-02   -2.620896751515939e-01   -3.975667949551485e-02   -1.561084331777288e-01   -1.599199573297821e-01   +1.355570000573748e-01   -3.279962366533006e-01   +2.198531407465676e-03   -1.030698994558758e-01   -2.142805852468380e-01   -2.761150567028734e-02   +3.011649609117537e-02; +7.247563495493881e-03   +2.444918798967410e-01   -2.914060189404975e-02   +1.541898278397208e-01   +2.209534184650281e-01   +3.238333700473087e-02   -3.261656151523997e-01   +3.133593783702665e-02   +7.685723521573856e-02   -1.549947675911173e-01   +5.368076849013723e-02   -3.242242314970938e-01   -1.731046247725141e-01   -2.360134315531564e-01   -1.583984725879257e-01   +3.422696016492316e-01; +1.061923351465953e-01   -8.243435309151445e-02   -1.205284617566736e-02   +8.971268866540498e-02   +8.241464080249672e-03   +8.601295838505518e-02   -3.355397422326677e-02   -1.163307071024022e-01   +1.324618675533951e-01   +9.135779926528143e-02   -2.595060390051318e-01   -9.797154763344831e-02   +2.023064653968733e-01   +1.281759064351778e-02   +1.134005686773234e-01   -6.403411817019465e-02; -4.889990347927112e-02   +3.366688660825225e-02   +4.444206115576829e-02   -4.221694952821097e-01   -2.008066192330062e-01   +2.606273888716079e-01   -7.990768318730079e-02   +1.055153133688999e-01   +1.565271802802090e-01   -1.030418143033348e-01   +2.610000118395948e-01   -1.069179323647075e-01   -2.392372946731256e-01   +1.635931612629250e-01   -1.072439443069611e-01   -6.392033566599703e-02; +3.896415985304243e-02   -1.342345387567212e-01   -4.829907038736583e-02   +2.033559323427460e-01   +7.480766873737728e-02   +1.534312664593715e-01   -1.257392067949995e-01   -6.303558571222626e-03   +4.463912060936454e-02   +1.580701661332898e-01   +3.176566476936962e-01   +1.184176624350741e-01   -4.358750631182116e-02   +2.302622588889741e-01   -4.775239505228586e-01   +2.515425708624369e-01; -1.179627101332554e-01   +2.012911669781344e-01   +6.261262505705405e-02   +2.167266449961447e-01   -6.050697608186234e-02   -2.650921791523630e-01   -1.448922343499111e-01   -2.525522280297617e-01   +2.449420390552496e-01   -2.497853618903888e-01   -1.731349327281728e-01   +1.385479869558120e-01   +2.937305162495104e-01   +2.326025162371050e-01   +6.412062717493168e-02   +1.677408317412055e-01; +1.527954457157075e-01   +1.296202794579498e-02   -4.852903122767268e-01   +7.645800230950608e-02   -3.544756548684320e-01   +2.619794168630724e-01   -2.345573512538472e-01   +1.635865267503820e-01   -1.188613250984062e-01   -1.777200892818658e-02   -4.778679282361687e-01   -3.441940679948477e-03   -8.808739258470522e-02   -1.534374536834105e-01   -1.363705402770421e-04   +9.964004062231610e-02; -2.021094909943967e-01   +2.699879270850649e-01   -7.460370344741078e-02   -6.506982701024415e-02   +3.457769645407631e-02   -2.059753967412755e-01   -1.533836899961101e-01   +1.128008733913715e-01   -8.894952348969846e-02   +8.031116774216164e-02   +3.333052830122386e-02   +5.720351252485420e-03   -9.864073247457505e-02   +6.511363072045862e-03   +2.551347302799958e-01   -1.567886882049708e-01; +8.927195723827383e-02   -1.895152486519863e-01   +7.055874023483534e-02   -2.697168850923111e-01   -2.021662911250445e-01   +8.591929360836788e-02   +1.708761401499002e-01   -2.411359536975589e-01   +4.844064568361545e-02   +5.607844663471490e-02   +1.843229852021289e-01   +1.461977367769851e-01   -1.966791079894087e-03   +1.397226232609151e-01   -3.105358993596349e-01   -4.607051776692694e-02; +1.046920763889547e-01   -1.053639004441490e-02   +1.756536746031799e-01   +2.625823537071547e-01   +3.215356790957279e-02   +1.485127357385378e-01   +3.428293197691736e-01   +1.087473948812595e-01   +8.915350763214774e-02   +5.705420966205618e-03   -4.621179430611425e-02   -8.906474722550223e-02   +4.957769794366785e-02   -3.242031603674040e-01   -3.739999210652360e-02   -2.701878909601492e-02; -8.180845834413336e-03   -3.349911755469702e-01   +1.649936515673542e-01   +3.935157025870115e-02   -5.473357489101623e-02   +3.588282596076331e-01   +3.460725561010169e-01   +2.154712275177914e-01   -5.221038295023862e-02   +9.563735422467354e-02   -8.486229124308303e-02   +1.680231311495550e-01   -5.904381792074624e-02   +2.233251055218261e-01   -1.389031344105524e-01   +3.250431069601064e-01; -2.147499957261560e-01   +1.241271637687460e-01   +2.480113918947752e-01   -2.689574003050635e-02   -2.163662416520081e-01   +2.334805342986160e-02   +3.037306569774933e-01   -1.817331870690759e-01   +3.996771014630221e-01   +1.309149771493959e-01   -2.792237845498590e-01   -4.117539014213245e-01   +1.469679713862841e-02   +1.732569057461880e-01   +1.251893473180245e-01   -3.190283687588313e-02; +2.639948446899271e-01   +1.864899995028672e-01   +3.933404655301050e-01   -4.201563220508205e-02   +3.223716189282660e-01   +8.382152180943767e-02   +2.368266095206945e-01   -1.117377819034784e-01   +2.009157948567717e-01   -9.764708614584408e-03   -2.770329205231227e-02   -5.607756142561124e-02   +7.779031111864551e-02   -2.230141340683112e-03   +1.478908162801247e-01   -9.698414536410377e-02];
L2I_L1I_iGABA_netcon = [+8.653618865042847e-02   +3.459152000187850e-01   +2.127523199513869e-01   +6.710395257134190e-02   +1.584799628167717e-01   +1.447204552158053e-01   -2.363498889466071e-01   -2.277121508520794e-01; -1.699768677574522e-02   +7.251938066088850e-02   -7.860108635509461e-02   +1.578249382350259e-01   -2.773313722773650e-01   -1.073295739052904e-02   +2.982070028760024e-01   -1.833317914398932e-01; -1.764392867448236e-02   -1.236716393424388e-01   +1.554282245028196e-01   -1.995072969627122e-01   +3.480913646301571e-01   -1.928212047580455e-02   +2.541499293699758e-01   +1.636398604589105e-01; +1.244833741492278e-01   +1.198486396540262e-01   -9.831374527125659e-02   -1.896635794440213e-01   +2.137451360478272e-01   -5.513123562373828e-02   -3.582728011190832e-02   -2.234384008519667e-01; -2.988383322070883e-01   -1.634317386455791e-01   -1.125633788957931e-01   -2.699732358332925e-02   +2.236788688845540e-01   +2.629807940095757e-01   +7.875864926585742e-02   -1.067607313086967e-01; +1.162693965870549e-01   +1.354180540244758e-01   -1.230064790246475e-01   +3.813919959344658e-02   +1.164523097236712e-01   +2.781393776702993e-01   -1.756205353237552e-01   +1.840358871665369e-01; -7.547556539010111e-02   -2.272836535051448e-01   -7.460195056225669e-02   +2.131695408494380e-03   -2.320672687812317e-01   -1.399453909755695e-01   -1.169563618723487e-01   +3.158024091281950e-03; +1.749452737593956e-01   +1.582207690367859e-01   -1.014378051814537e-01   +2.094049570743201e-01   +1.678088277010924e-01   +1.647530068369664e-01   +1.512987293681596e-01   -1.386653276905242e-02; -1.591797260518344e-01   -3.057004409348273e-01   -1.077025689207008e-01   -1.001114651445327e-02   +1.702808533631284e-01   +8.688468291488291e-02   +4.609486783546961e-02   +2.430275197426233e-01; +2.043298877765859e-01   +3.233252193161980e-01   -5.587011632055802e-02   +1.012720601929484e-01   -2.402968897586228e-01   -1.490216507053740e-01   -1.920206631935825e-01   -2.087259714102207e-01; +3.953940392226730e-01   -3.636417930859816e-01   +8.894328628964165e-03   -5.328440524320566e-02   -1.971099933559783e-01   -2.232738671198325e-01   +5.079396077230718e-02   +6.955420025952608e-02; +7.816988014194715e-02   +8.898501508262988e-02   +9.370063758329403e-02   +2.772256556804046e-01   +2.543410639382454e-02   -7.602149712044864e-02   +7.010022047525113e-02   +1.125962223569152e-01; +4.727565047241364e-02   +1.333517452692364e-01   -1.334523533968997e-01   +1.235409770002977e-01   +1.595093125952242e-01   -2.988494033672584e-01   +2.653324967457335e-01   -2.522854221558941e-01; -1.683662671572131e-01   +8.339310233401410e-02   -2.579894539902392e-01   +9.243873319954882e-02   +2.240827688640892e-01   +2.068724375741514e-01   -3.247731338410573e-02   -6.293447559646463e-02; -5.285177504228313e-02   -3.663959647720186e-02   +2.652286466612941e-04   -1.123344332854939e-02   -3.415787268533256e-01   +7.648181126698600e-03   -1.256844489210659e-01   -1.974299604722939e-01; +3.139291039740937e-01   +1.637989031373348e-01   -1.228173324595576e-01   -5.440774565001266e-02   -2.557357934293399e-02   +1.848036529125102e-01   -3.853369621906375e-02   -9.100100272250611e-03];
L1I_L2I_iGABA_netcon = [-1.425490566579881e-02   -5.916593925512081e-04   -5.934977546807876e-02   -8.068182401035161e-02   -2.099058345596332e-01   -7.197306051879493e-02   -2.235580334636411e-01   +1.091370896283191e-01   +3.161880422312205e-01   +1.765998163682964e-01   +1.676897106041716e-01   +2.293419066003121e-01   +2.321965075168715e-01   -6.879696353479958e-03   +9.498893585233681e-02   -8.207855045714040e-03; +1.155974543180829e-01   -9.125233602991842e-02   -2.227479040986520e-01   -1.134924085776876e-02   +1.246736628359130e-01   +6.558927071504053e-02   -2.318212527902575e-02   +2.571590479934258e-01   +4.360058934086361e-02   -6.268421215092768e-02   +6.949522398796393e-02   +6.609498820122812e-02   +1.446652271165106e-01   +4.546173531987810e-02   +1.185395207184384e-02   +1.148278938560066e-01; -9.942613731451960e-02   -1.786051661805159e-01   -7.095980412163158e-02   +1.034254198554357e-01   +1.363599940377458e-01   +2.003294194839803e-01   -3.333534587568712e-01   -7.537347822550831e-02   +2.051693038429567e-01   -1.522874831488172e-01   -1.692946968086070e-01   +2.640585490723513e-01   -3.438298974188607e-02   -1.059282803198815e-01   +1.956848598334135e-01   +1.386104141076876e-01; -2.570399527828460e-02   +1.869235868452314e-01   +1.801019794722469e-02   +3.859893241591222e-01   +1.689187656754044e-01   -1.100802137255773e-01   +1.589295911249373e-01   +1.883195720460838e-01   -2.466260556752246e-02   -6.057968064474247e-02   +1.703450738388789e-01   -2.839718129366944e-01   -3.348942293934923e-02   +7.609776789197290e-04   -1.177888642534609e-01   -1.271309726128157e-02; -2.843464877376117e-01   -4.882158708053179e-02   -4.185345035420962e-02   -3.382828497648843e-01   -3.012820373837591e-01   -6.814362498142094e-02   -2.150413564363031e-01   +1.417682919855921e-01   +2.996453687373087e-02   -1.272630535259370e-01   -2.566964702445627e-01   +9.573603437108896e-02   -1.782289662750587e-01   +1.167094109175730e-01   +2.640780251466422e-01   -6.473851843540640e-02; -1.094610642740991e-02   +2.037263352937178e-01   +7.528999325334076e-02   +1.366684592188355e-01   +3.147591377705699e-01   -2.013880567831380e-01   -8.287564406521841e-02   +1.178514525835696e-01   +3.172992637257428e-01   -2.339875281511617e-01   -6.440543575916051e-02   +2.173580135369321e-01   -1.589029387454176e-01   -6.744004707017907e-03   +5.956736841673158e-02   +3.054895480986539e-02; +2.300375893842036e-01   -3.678843794284977e-01   +4.259119017470345e-02   +2.025774272943354e-01   +4.291319013331138e-02   +1.973978052853489e-01   +1.011773290510405e-01   -1.241103415094652e-01   -1.166078285853800e-01   +1.724648088836253e-02   +3.467526612267935e-01   +2.921598335646505e-01   -1.252398998963733e-01   +2.401680760269341e-01   -1.347290814938132e-01   -2.627920016510935e-02; +2.168667286150451e-01   -3.555783579946630e-01   +1.441757168960461e-01   -3.607402673288262e-02   +3.677421254800639e-02   -2.482528384542308e-01   +1.896400685070966e-01   -1.470623804166824e-01   -1.115503716246917e-02   +8.389316687589389e-02   -1.235405517651352e-01   +1.289417785484334e-01   +1.298744407610049e-01   -2.484968946687495e-01   -2.089052304722338e-01   -8.766147849397168e-02];
L2E_L1E_iAMPA_netcon = [-1.731346950490262e-01   +3.349544260791531e-02   -2.123738516738201e-01   -1.118209189343262e-01   -1.002756544470935e-01   -2.367329724492147e-02   +9.055570423446672e-03   -1.501387936467285e-01; +1.602151339101109e-01   +1.653955558214994e-01   +8.765317391641321e-02   +1.230261334510576e-01   -6.019635570909317e-02   +7.101951537315442e-02   -3.265349865301557e-01   -2.023163796868135e-01; +1.586017712996880e-01   +1.798744150222579e-01   -3.837903879499914e-01   +6.720335809882545e-02   +1.104178842737274e-01   -2.115517718752193e-01   -2.239029404835037e-01   -2.767791606839873e-02; +2.888577593948284e-01   -1.033072876390401e-03   +2.105002657174739e-01   -9.862000509181329e-02   +9.489114641800088e-02   -2.240370388417713e-02   -9.925371141940095e-02   +2.844639782476569e-01; +2.542148395409722e-01   +3.486557086801004e-02   -3.525625732270055e-03   +1.461364560787434e-02   +8.067131913689959e-02   -1.524632553535190e-01   -3.274339523740663e-02   +1.146895145126195e-01; +4.651578612048352e-02   -2.107845174285985e-01   +6.397347208541904e-03   -1.892688434302530e-01   +2.007687599355817e-01   +2.573223264876643e-01   +2.469547070210265e-01   -5.649899868126432e-02; +2.156398273133888e-01   -8.133245595555938e-02   -1.699532202066995e-02   +4.584106157010263e-02   +3.455606659319997e-01   +2.120427954859161e-01   -1.199244260445249e-01   -3.309416497517914e-01; +2.086870397919707e-01   +1.801530732631955e-01   +2.620655435185830e-01   -1.366764328638386e-01   -4.783289510116986e-03   +1.879772093651772e-01   -7.161610163227020e-02   -1.939160743052435e-01; +1.290404864518292e-01   -5.503576778731323e-02   +5.930165377551257e-02   +3.326547670230066e-02   +1.726196383751505e-01   -3.131666227752783e-02   +7.723771779452185e-02   +3.738333468159905e-02; +5.717549703237892e-02   +2.467248350214322e-01   +3.634145106941448e-02   +2.350235774919923e-01   -1.645863052297976e-01   +4.573476495059070e-02   +4.563181468906482e-02   -4.880594283582246e-02; +2.061820258878396e-01   +1.751757675935036e-01   -3.139021530658918e-01   -8.523994857137929e-02   +1.382910848256623e-01   +3.667733769034778e-01   -6.383783384954402e-02   +2.656294314318567e-01; +2.181846150081591e-01   +3.974608187712531e-03   -8.364736329086403e-02   -1.801896854133875e-01   +1.322253707618574e-01   +3.649328109624250e-01   -1.095400836467611e-02   +5.915607551336161e-02; +1.211373421892649e-01   +3.874079999474327e-02   -1.318702737841823e-01   -8.434053018893997e-02   +2.442587544227953e-01   -1.405749650180110e-01   +4.663315426562534e-02   -3.861077610588157e-02; -6.110846016625612e-02   -4.310038937417536e-01   -1.387743611360456e-02   -3.330458624335971e-01   -2.802722088841488e-01   +4.053575806086784e-03   -1.752125379126788e-01   -1.076151840802451e-01; -1.893794850739858e-01   +1.624706196963213e-01   +5.875285696344825e-02   -2.596155857376576e-01   -4.836697045177464e-02   -2.363286587378747e-02   +6.596275950255664e-03   -1.877021075102132e-01; -3.488296413064602e-01   +1.656981341385521e-01   -4.493796742994360e-02   -1.514915338268520e-01   -2.848296667629203e-01   +7.008848154645361e-02   +9.046459533879656e-02   -1.400146737866237e-01];
L1E_L2E_iAMPA_netcon = [+7.736876980717293e-02   +5.016085571931528e-02   -2.369512585878712e-01   -2.215869919778667e-01   -2.098398955966578e-01   -7.590470603370642e-02   +8.074322881601861e-02   +1.621177284291242e-01   +8.952058260678511e-02   +1.639240263639643e-01   -1.522646433583498e-01   -1.210221520725085e-02   +2.069293906687101e-01   +2.169948823782689e-01   +1.813733868572489e-01   -4.223470649266882e-02; -2.150345999895678e-02   +4.958977656008184e-02   -1.615375282694557e-01   +2.724019622927674e-01   +2.271707695357300e-01   +3.893742946998076e-04   -1.869940814117564e-01   -2.302192957098171e-01   +1.023985325531562e-01   +5.011233331197643e-02   -1.758977406301319e-02   +3.138433715978689e-01   +1.975604650034722e-01   -1.381728746443039e-01   -2.586301813653838e-02   +1.408196849590176e-01; -5.562589826564132e-02   +7.261906863406258e-02   +1.138562591840655e-01   -7.132831130311033e-02   -4.575383339448899e-02   -1.755647914498299e-01   +3.107573588074666e-02   +5.894099985942866e-02   -1.471456843928867e-01   -2.564116067920746e-02   -2.137462000838360e-02   -5.957782732948540e-02   -2.030356574906474e-01   +1.930483529618880e-02   +3.273667035110439e-01   -1.079882663622550e-01; -8.474151221944783e-02   -4.281940436311991e-02   +2.365018789990319e-01   -2.279644205308726e-01   -1.933660141735448e-01   -1.966960372675197e-02   +2.758910028123321e-01   -1.312302729071520e-01   -1.593580647701553e-01   +6.801447975195739e-02   -1.887112573888329e-01   +2.810814935994229e-01   -1.041495890788033e-01   +2.403876533456827e-01   +1.318110959259489e-01   -1.314584131971717e-01; +7.120860614227495e-02   -1.398431830788522e-01   +9.965889136434769e-02   +1.721455084223807e-01   -1.231129320192401e-02   +1.706962094645199e-01   +6.389861536518215e-06   +3.351950451546735e-01   -1.829279324065435e-01   +1.645757283223553e-01   +1.955520152496640e-01   +2.392816590835825e-01   +1.716353772112761e-02   -1.375388101371392e-01   +1.370890706712230e-01   +3.663868445692142e-01; -2.372913088129028e-01   +1.146700419900761e-01   +1.002994459476579e-01   -9.608100748078902e-02   -2.822838355591569e-01   -2.365838519066501e-01   +2.880441843159056e-01   +5.816447123215125e-02   -1.563437977304873e-01   +4.002031278389169e-01   +1.714860597905587e-01   +2.573571326734284e-01   +1.906042140512030e-01   -1.710466533761780e-01   +1.053450090253136e-01   -4.087545947864334e-02; -1.669473698031246e-01   -3.914966832880395e-01   -2.201552874315476e-01   -3.159886218785952e-01   +1.855213252427728e-01   -2.432878086642344e-01   -2.109909186601883e-02   +8.754451842779329e-02   +4.902317473646088e-02   -1.352176640591951e-01   +2.030449180755797e-01   -4.008458543500226e-02   -3.884097678699505e-02   +1.901583560768121e-02   -1.672543817461288e-01   +1.553644589524485e-01; +9.437593266073879e-03   -1.514249596657298e-01   -7.409775172132281e-02   +6.187280820835830e-02   +5.531899406694239e-02   +1.318311917845431e-01   -1.512658250120179e-01   +2.831005770978012e-01   +7.984861022063466e-02   +2.588367511452104e-01   +2.455847796470107e-01   +9.585289130126136e-02   +9.313502635873469e-02   -1.578751115211305e-01   +2.167112552967492e-02   -1.892753888795073e-01];
L2I_L2E_iAMPA_netcon = [+4.198703557304323e-01   -1.165604173354230e-01   +1.610237689871900e-01   -6.812349603592671e-02   +1.871726877784694e-01   -4.659016444318022e-03   +1.290144503787283e-03   +2.286060624116586e-02; -3.366161098857864e-01   +3.531652785998681e-01   +6.679164162351242e-02   -8.099436275799597e-02   +1.579612910682135e-01   +2.724948175679835e-01   +1.977044231259016e-01   +2.920376393602691e-01; +4.367335294245450e-01   +8.857103781854347e-02   -4.189678375103940e-01   +6.509122014893672e-02   +1.306186766211568e-01   +1.163515968664664e-01   -1.184173635473339e-01   -4.839750017705971e-02; +3.904410761739281e-02   +7.544544140545786e-02   -2.982737312694699e-01   -7.563333546809739e-02   -1.538027195460994e-01   +1.935129775638665e-01   -9.297175008675446e-02   +2.415317568833060e-01; -3.395114048247453e-01   -2.644311089357601e-01   -2.302626875422786e-02   +2.186027844293011e-01   +1.665349797631804e-01   -2.667847962396150e-01   -1.713745501085841e-01   -1.618300917270916e-01; -1.117263044262178e-01   -3.530524925630968e-03   +1.647946622124878e-01   +3.338554827620495e-02   +1.094460615453358e-01   -6.246813688915062e-02   +2.490551485838558e-01   -4.142821253432153e-01; -4.252698935969598e-01   -2.027433292834884e-01   -1.235732991451854e-01   -1.836615269701905e-01   +7.108612553392706e-02   +5.871082152067704e-02   -2.105183987891912e-01   -5.924721015123634e-02; -2.206143747203296e-01   -3.301068119846949e-01   -9.183465966959989e-02   +2.821738434140086e-01   +1.579119560969085e-01   -1.770000996034301e-01   -3.441795741524331e-01   +2.880210560054907e-01];
L2E_L2I_iGABA_netcon = [-2.032150219169907e-01   -1.969692935106560e-01   +2.481405715487561e-02   +2.261783985966887e-01   +3.158688509053770e-02   -2.427562860938023e-01   +1.461502250660487e-01   -3.171031507110017e-02; +2.439003414153365e-01   +1.764482978456974e-01   +4.944071979349679e-03   +8.182298180324601e-02   -2.039066783420095e-02   +1.001052982848927e-01   +1.262949495534720e-01   -1.802260700659887e-02; +1.433277527655753e-01   -1.182495100791519e-01   +7.951861717181827e-02   +1.894844929918703e-01   -2.316375083740295e-02   -5.884081030259569e-02   -2.412379002779028e-01   -2.061588097243046e-01; -1.691075374309783e-01   +9.628730127305231e-03   -2.643864550689754e-01   -2.398349673860718e-01   -2.289410442457636e-01   +1.643192591709816e-01   -3.472441650417051e-01   +1.189812726476992e-01; -1.144449196871050e-01   +6.895711462543078e-02   +2.182351716727921e-01   -2.034674013987482e-01   +4.482061085996791e-02   +1.320725163481015e-01   +4.502381148284156e-02   +2.381600653964486e-01; -1.738149205301000e-01   -2.146351389570962e-01   +3.200823329087446e-01   -1.534520257120027e-01   +1.665266894550385e-01   +3.971919907089122e-02   -1.980683238577670e-01   -7.252693737285669e-02; -2.451480250821940e-01   +1.507085649158546e-01   +3.247522763935068e-01   -2.711054662984455e-01   +2.334198150010245e-01   -2.846944746050794e-01   -5.323525246369290e-02   -2.055845815502871e-01; +2.665203904541704e-01   +1.254901798680485e-01   +1.511389593136005e-01   +9.963553764945435e-02   +1.239542496746778e-02   +1.619855486631153e-01   +7.577084164278505e-03   -1.717017307314952e-02];
L3E_L2E_iAMPA_netcon = [+4.670696484044770e-02   -1.244995013804734e-01   +2.340441283916301e-01   +2.479619928904646e-01   -3.506032141554959e-02   -1.879700595415069e-01   -2.266281770894082e-01   +2.048776708888183e-01   +2.258784542472891e-01   -2.125143234047426e-01   +1.836559640291094e-01   -1.335012911201184e-01; +2.048537597070108e-01   -9.380673068999090e-02   +6.776041844540742e-02   -7.483606125043250e-02   -7.451734086069731e-02   +1.834094353160341e-01   -2.269671096011233e-01   -7.567013035447717e-02   -1.393018992704552e-01   +2.390739670199399e-03   +3.801200074427122e-04   +1.717577989483138e-01; -2.565348103921056e-01   +1.312477162484726e-01   +3.011385892434494e-01   +2.710822304598661e-01   +1.485480719407726e-01   +2.027022938105816e-01   +3.949552247692521e-01   -8.311620722987326e-02   -2.437612022860850e-01   -6.175789150466504e-02   +1.617236862425973e-01   -9.987451786180872e-03; +3.139893765267571e-01   -1.940363253207713e-01   -2.674343233037281e-01   -6.140680606610514e-02   +9.749200425086468e-02   +2.477637356271251e-02   -4.458798872652717e-02   -6.746521579385453e-02   +9.379033705585293e-02   -2.061868181754820e-02   -6.856966623416955e-02   +2.324386986982064e-01; -6.440890490997699e-02   +2.657984407110824e-01   -1.007348107264930e-02   +2.916825722867031e-01   -4.335760606767632e-02   +2.849609620165357e-02   +8.526105323555749e-02   +1.861603748503716e-01   +2.679960719912586e-01   +1.361306942402948e-01   +2.046670316831166e-01   +1.499968383856972e-01; -1.361305212936378e-01   -1.293649894883440e-01   +2.142237178145040e-01   +2.580454621889890e-01   +4.487889262412280e-01   +6.487043542830778e-03   +7.531095480193697e-02   -1.392143357680122e-01   -3.150626523475959e-02   -1.002364314145757e-01   -6.969997336450769e-02   -5.693304119431473e-02; +1.029361861032272e-01   -1.653589767049761e-01   +1.101105728775058e-01   -2.084950536623641e-01   -1.069591706820229e-01   +5.388538630196722e-02   -1.633101387094120e-01   +4.449807556085833e-02   +3.742567981244824e-03   -8.596742274222693e-02   -1.248646739123224e-01   +1.145962251503923e-01; -5.404515473140400e-02   +1.627880040551047e-01   -9.688752604527641e-02   -2.994298809752917e-01   +1.335735032380087e-01   -3.779655059482852e-01   -1.361240201183223e-03   +2.475944598733244e-01   +1.230603427345253e-01   +2.116959985647689e-01   -1.185653880064886e-01   +1.306868279281942e-02];
L3I_L2I_iGABA_netcon = [+2.985700040036270e-01   -3.231329155985175e-01   +2.993533840289816e-01   -1.556302339482381e-01   -7.366981729259706e-02   +8.898554896739333e-02   +2.204764323500754e-01   -1.134842096121423e-01   -1.942297302607783e-01   -1.855456570075040e-02   +3.658645086425604e-01   +9.166734872494253e-02; +2.079141971668199e-01   -3.781520676591239e-01   +5.991150450675359e-03   -4.336293984376620e-02   +7.484224693980600e-02   -9.988127125447246e-02   +1.706737923332479e-01   -1.231582467183920e-01   +2.641950758333722e-01   -3.122818337704715e-01   -1.499170094807893e-01   +2.846776959352930e-01; +7.335579271988488e-02   -3.299380950409735e-01   +3.424261829826671e-01   +1.738807936103494e-01   +2.362645781257148e-01   +1.708630437010334e-01   -1.508078109217294e-01   -3.631360472326058e-02   +4.205067299364598e-01   -3.452668185092438e-01   -9.852792847439454e-02   +1.205517734005371e-01; -1.314863485571987e-01   +1.030047215474076e-01   -4.991276262101818e-02   -4.647950213181928e-01   +3.445030891583035e-01   +2.414643591214856e-01   -3.731768153682542e-01   +1.802181795279877e-01   -1.526356924861461e-01   +8.273534465109270e-03   -2.261554136607307e-01   -3.103744079139392e-01; -1.217398092546187e-01   -1.764556745454134e-01   -1.920638216823217e-01   -2.702585362727092e-01   -6.698642755210492e-02   +3.990604892706480e-02   +1.615000229148518e-01   +9.158957206547495e-02   -1.232495777163647e-01   -7.612654836401317e-02   +2.469090361419202e-02   -5.113720678545593e-02; -9.949681451166381e-02   -1.568917709086326e-01   -2.070300697188866e-01   +1.749732087616287e-01   -2.025496062169365e-01   -3.255617409604505e-01   +2.200943600363306e-01   +2.787360030782997e-01   -4.725535598443609e-02   +4.129428972012171e-02   -4.298273989602733e-02   +1.926469089670646e-02; +1.538040311678008e-01   +4.029239045828358e-02   +1.166046286000186e-01   -3.384015077858782e-02   +2.085483404082088e-01   +2.766643515535371e-02   -2.456355160487099e-02   -8.448063084503515e-02   -3.931350595709912e-02   +2.906123156599162e-01   -1.485561255054534e-01   -3.417197000857213e-01; -3.234652609298407e-01   +1.574544052726795e-01   +1.239478416266506e-01   -3.305039887937634e-02   -2.183511008544591e-02   -1.259551994142372e-01   -4.186146802399365e-02   +2.688974099228961e-02   +4.705886425763602e-02   +1.524929322384569e-01   -2.111368164268749e-02   +1.164061391514927e-01];
L2E_L3E_iAMPA_netcon = [-2.267423387457817e-01   -1.992138280184240e-01   -2.109906125745717e-01   +1.435503204099574e-01   +1.215538405308777e-01   +2.222564997149063e-01   +1.315541113606508e-02   -6.235918841229818e-02; -1.041523302322975e-01   -6.082143344950058e-02   -1.846553003210242e-01   +9.500997719111112e-02   -3.710377233886326e-02   -3.086411103800211e-01   -1.481459031205258e-03   +5.095930670711984e-02; +3.526066610731465e-01   +6.367431570187115e-02   +1.144379910800238e-02   -1.084612451911812e-03   +1.613361971203799e-01   -3.836384738091329e-01   -1.492399160424563e-01   +2.258553958950256e-01; -1.760397188457999e-01   -1.309793256749048e-02   +1.857682303284268e-01   +2.264752152933701e-01   +2.405843612513345e-01   -2.880087557735856e-01   +1.241269814039915e-04   +2.286438930816361e-01; +1.283821979655220e-01   -1.489098957082688e-01   +2.441408556029395e-01   +2.683545860588656e-01   -1.321641449768911e-01   -1.777852796284385e-02   +1.778505878391945e-01   +2.443213480327355e-01; -1.625937741214169e-01   +1.046423908449476e-01   +5.710198325160800e-02   -3.921571478379887e-01   +1.670365337553958e-01   -6.609587069129425e-02   +2.993161027268120e-02   +1.197980952884192e-01; -7.266398094368443e-02   -6.649915843886854e-02   -1.348757916966641e-01   +8.319303878430837e-02   -3.051282621603346e-02   +2.895024405724872e-01   -1.457143431189498e-01   -3.139220460893685e-01; +3.091571579125933e-02   -4.538212904094878e-01   +1.315928395141427e-03   -1.828414183416975e-01   -4.004761767400785e-02   -3.955037659169183e-02   +2.297086904525072e-02   +9.660088390705503e-02; +1.340023087739805e-01   -2.617012962550743e-02   -1.089465145527948e-01   +6.872398491556780e-02   +5.073803677194947e-01   +8.111427615743468e-02   +2.991983061824761e-01   +9.628652204278919e-02; -2.257145963612062e-01   -2.210460137137635e-01   +2.940379462105613e-02   +2.344727082543728e-01   +1.550210224524407e-01   +2.354738906514099e-01   +1.140574348825542e-01   +3.319243891863749e-04; -2.943470581213526e-01   -1.727820795930611e-01   -1.613494402938301e-01   +2.561828872600939e-02   -1.372095632768378e-01   +1.965740053436240e-01   +1.409285697575328e-01   -6.272539321431980e-02; -2.658656960941973e-02   +1.783835950785107e-01   +4.340283777037319e-03   -1.706294948130060e-01   -1.133349623146229e-02   -4.323721850690195e-02   -9.534060071821919e-02   +1.366490076284394e-01];
L2I_L3I_iGABA_netcon = [-1.731029577509212e-01   -1.283369413638062e-01   +1.464497436212903e-01   -1.117609510587004e-01   -4.260514641770907e-03   -1.094334757008420e-01   -1.558604742273652e-01   -9.226732453147160e-02; -1.659186926831374e-01   -1.947302556970583e-01   +1.339268913375674e-01   -1.377526674341770e-01   +8.269191157577682e-02   +2.459433310420023e-01   -2.500925442139845e-01   -1.414600571169767e-01; +1.092622254227467e-01   +1.028443042374633e-01   -1.432606997657412e-01   +2.743156261393259e-01   -4.959078637407750e-02   -7.028592999321182e-03   +1.757272641677711e-01   +2.429199005920408e-02; +7.042278379200927e-04   -1.153989832189403e-01   +2.006886399918426e-01   -2.925433510076883e-01   +1.391806915105299e-01   -2.096088410666033e-01   -2.002320994334156e-01   +1.702726029205522e-01; +1.014523148704140e-01   -6.155736469284818e-02   +2.348805763355374e-01   -9.361297062927360e-02   +4.124587879481345e-02   +3.781578339119364e-01   -1.083166211153937e-01   -7.435282063991028e-02; +6.239963923396636e-02   -4.589440752641471e-02   -1.883698506773536e-02   -6.643950380117589e-02   +5.561387063386981e-03   -1.316881102780685e-01   -1.769003224237563e-01   -7.862420125000108e-02; -1.245931378360748e-01   -8.172992305694327e-02   -2.208964738679041e-01   -1.182020150215286e-02   +9.302208970766737e-03   +3.324724504706754e-01   -8.081556790053229e-02   +1.464462815725349e-01; -3.566115040496123e-02   +1.028509100957412e-01   +1.228011326089315e-01   -1.427815988012893e-02   -3.139547201010684e-01   +1.210093316606724e-01   +1.861143645515222e-01   +1.042461796982995e-01; -6.194008112900030e-04   -2.252797751211931e-01   -1.489115528667533e-02   +2.237841549061932e-01   +5.139827224883653e-02   +9.159062354559995e-02   +2.946127185387192e-02   +2.110355980529650e-01; +2.701430770222101e-01   -2.587146340738674e-01   +1.965217296987518e-01   +2.221097532352851e-01   -1.309022214524213e-01   -1.136976107154019e-01   -6.009371449964876e-02   +3.683469228473123e-02; -1.068312628926469e-01   -7.080577267017553e-02   +9.980543861621005e-02   -1.452881110161657e-03   +2.776987237003852e-02   +2.075915491541997e-01   +1.928814536392170e-01   +3.835948692418164e-01; +1.280990394672179e-01   -2.117211891860503e-02   -4.695724337676901e-02   -1.506569883723465e-01   +3.677308068900872e-02   +3.306511114490776e-02   +4.468636754700880e-01   -3.828243676856516e-01];
L3I_L3E_iAMPA_netcon = [+2.852182743477774e-01   +7.855539383038587e-02   +2.709628447372477e-01   +2.008040453954454e-01   -1.840507290031416e-01   -5.896466380582231e-02   -2.133838750942226e-01   +2.527123884240328e-01   -1.086677697100864e-01   -3.950309147740561e-02   +8.325439063534691e-02   -6.222252432807787e-03; -6.936007062849008e-02   +6.515167901971719e-02   -2.856840647567910e-01   -7.201053381959061e-02   -7.091056904625674e-02   -7.360834507596051e-02   -1.439579466606206e-01   +3.040682939462700e-01   +1.975345608577457e-02   +8.224880559184888e-02   +4.549467339127358e-01   +4.061694589465017e-01; -3.520476075212555e-01   -8.436951372905788e-02   +1.111447600067788e-01   +2.539118312732451e-01   +1.176645099435382e-01   -1.162579770289792e-01   +1.817102513120007e-02   +2.773307219903270e-01   +1.670353332888747e-01   +1.614932372045615e-01   +4.776783124593245e-04   -2.596557027940286e-01; -9.850805714518716e-02   -1.295987799799689e-01   -7.956020386629933e-02   -1.878866427422524e-02   -2.086728538775395e-01   -2.893084234222095e-01   +1.152216202599096e-02   -1.257146346158689e-01   -3.477492645733661e-02   -1.131085411886838e-01   +1.304594756024482e-01   +1.928157200597996e-01; -4.655786078765598e-02   +1.969556488859144e-01   +2.233130039705618e-01   +1.183380219680508e-01   +1.579022838530945e-01   -1.752481760214209e-01   +1.561550054540727e-01   -1.859845306010380e-01   +3.340490653013317e-01   +1.517429613264616e-01   -2.002692064221021e-01   +5.354363271565862e-02; +4.052176909568417e-02   -8.974345796271122e-02   -3.325610017926976e-01   +1.446936294309694e-01   -8.920100760263475e-02   +2.077573074542614e-01   -1.339380847668464e-01   +1.072830348806426e-01   -7.837544997303740e-02   +1.196677454421663e-02   -1.452700106068164e-01   +2.679172678786343e-01; -7.356220825885179e-02   +1.467457317638496e-01   +5.557102085400251e-02   -3.801452459178538e-02   -1.922064615358000e-01   -5.227999924062712e-02   -4.307204750877537e-02   +1.619459566713054e-01   +7.960685966654943e-02   -1.977476649406859e-01   +1.565009242385866e-01   -3.125691688780168e-01; +1.674052062230595e-01   -3.761819008237516e-02   -5.524124025745177e-02   -1.974944334040509e-02   -2.557891618187562e-01   +2.535218465291846e-02   -1.549391207566185e-01   -2.152751636818119e-01   -1.414639131865080e-01   -1.278243584391692e-02   +3.349312166644564e-02   +8.019349382250344e-03; -2.068964661534660e-01   -2.176036559324404e-01   +1.428229056641674e-01   -7.883828137616397e-02   -1.390244293039675e-01   +1.664795677838258e-01   +6.231250074607701e-02   -1.651580610631080e-01   +2.791017552395322e-01   -2.773454532356396e-01   -2.289727612334660e-01   -7.880809368163778e-02; +1.596513949187341e-01   -1.519983854232825e-01   -6.921587066114913e-02   +1.250010304206826e-01   -2.494229604429974e-01   -7.723270199691427e-02   -1.693771474798904e-01   +8.457687356004634e-02   +5.681872161259677e-02   +4.170785489141013e-02   +8.017202284369551e-02   +2.146359619615185e-02; +5.947444129265422e-02   -2.247682694405138e-01   -1.165098148329814e-01   -1.379591233183526e-01   +2.144105051065978e-01   -4.809109161612315e-02   -9.162096998679220e-02   +1.019925243288611e-01   -2.379858275078082e-02   +2.498790571798432e-01   +1.412858002978601e-01   -2.266138084449376e-02; -4.142238513016072e-02   -1.612372235986623e-01   -3.711293605377871e-01   +4.170316381293506e-01   -1.131348935688599e-01   +1.803835835630558e-01   -1.070558346544997e-01   -2.550568835600547e-01   -2.909836179558224e-01   -3.591879317631875e-01   +6.645726421751486e-03   -2.594238606300319e-01];
L3E_L3I_iGABA_netcon = [+2.830284748514361e-01   -3.024984661181420e-01   +3.518610743410301e-01   -1.155029346932979e-01   -1.206219999345851e-01   -1.220011273420120e-01   -1.770363306052231e-01   +7.755810466367183e-02   +1.765687284309494e-01   -1.285685554780527e-01   +5.747488360289485e-02   +8.301048766201322e-02; -9.574133530266565e-02   -1.925666164300437e-01   +1.374100320415031e-01   +5.837723352934690e-02   -1.817365320312866e-01   +2.008444702346590e-01   +1.287036942561769e-01   +2.199193781048055e-01   -2.065196545583602e-01   -3.488561999199656e-01   +7.977505406836366e-02   +1.066504895686769e-01; +1.835799499324718e-01   -2.609275656859069e-01   -1.225050575049536e-02   -1.263360891907512e-01   -2.060027785223239e-01   +1.642820876534785e-01   -1.365355428032841e-01   +8.739629601843879e-03   -1.187028970951677e-01   +1.883384460698482e-01   +1.211890493718435e-01   -2.773160381614121e-01; +1.179325874190314e-01   +3.014971628788349e-02   +3.398198632622184e-01   +8.998967289634555e-02   -6.446018843542761e-02   -2.027775441126185e-01   +1.906207851203554e-01   +1.773069451231343e-01   +1.109249796096003e-02   +7.525253797472098e-03   +8.784873158630925e-02   +1.781723468694787e-01; +5.256468049076687e-02   +1.257216583258839e-01   -6.547051696378203e-02   -2.596364104257661e-01   -2.588322528813504e-01   +2.118825160647125e-01   -3.120656657456738e-01   -1.318998748231080e-01   +1.835765282999743e-01   +1.178788110490335e-01   -2.145431447342232e-02   +7.263278612295015e-02; +5.301123283540266e-03   +2.049563691124817e-01   +1.518890716725880e-01   +3.123619817966053e-01   +5.800775358116132e-02   +1.287219101652867e-01   +2.651780913746360e-02   +1.198196252349722e-01   -1.390140856842345e-03   +1.505355849825388e-01   +5.061934129640906e-03   +3.994648925413365e-01; +1.562280531889258e-01   -2.532028197991888e-01   +1.218756679781746e-01   -1.173217143845858e-01   +5.293329541662616e-02   -8.857097086910891e-02   +1.992463987685736e-01   -7.390561969187112e-02   +7.855635050200732e-02   -1.119865195169667e-01   -1.072637658431399e-01   -6.857377667229335e-02; -6.777752243455609e-02   -1.509885018764035e-01   -9.773288449199802e-02   +1.913232541094156e-01   -2.322327166205199e-01   -1.380148943792014e-03   +1.917165371147137e-01   +4.948093575567612e-02   -1.925120216076089e-01   -1.882889387686321e-01   -8.137231325259464e-02   +1.176056624795550e-01; -1.918550875621161e-01   -1.644977582777412e-01   +1.220813253762553e-01   +2.105871314288999e-01   +5.629237731826674e-02   -1.751314209499558e-02   +6.695835601107325e-02   +1.037543662589979e-01   -5.384990677653068e-02   +1.941924851247522e-01   +1.923391091416465e-01   +8.886120152418459e-02; -2.404866037610303e-01   +9.156435831845983e-02   +8.732288206272064e-02   +4.868585228280485e-02   -1.113988594522811e-01   -1.546997052002551e-01   -1.575242589784604e-01   +2.105965411888754e-01   -6.691900283711608e-02   -1.968576200350100e-01   -2.133082539111833e-01   +3.030428493830445e-02; -2.696244912321773e-02   -1.800575592948946e-01   +1.756732143263713e-01   +1.644669478863737e-01   -4.339003260426182e-02   -4.088666115136862e-01   +8.212631064437032e-02   -2.994074810079358e-01   -6.914521487283311e-02   -3.045451817594369e-02   -6.512705859786533e-02   -2.058167736661960e-02; +5.314220123526338e-02   +8.368273980117383e-02   -1.041971058040085e-02   -4.378101027416911e-03   -2.861848191443693e-01   +3.174821173737972e-01   +3.578800790629619e-02   -2.297511458418314e-01   +1.624736034201942e-01   -2.771648959221359e-01   -2.033160636695942e-01   -1.204829821355047e-02];
L2E_Input1_iAMPA_netcon = [+2.066611937772973e-02   +1.403253101785094e-01   +1.023682516462393e-01   -1.177654093323059e-01   -2.230341244952488e-01   +1.410982067558859e-04   +3.095196369016755e-01   -1.677673462455685e-02];
L2I_Input2_iAMPA_netcon = [+1.691184267776630e-01   +1.469735631455013e-01   -1.331599854106958e-02   -1.735097821690293e-01   +9.377834380646599e-02   +9.319123725498359e-02   -2.548656151120758e-01   +3.679836141379635e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
