function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-5.146983866614976e-01   -7.364107372251591e-02   +5.916306934152280e-01   -2.054498081139670e-01   -2.684802754075438e-01   -2.040620092040007e-01   -3.282519419240867e-01   +8.439838829165411e-01   +4.529683161620900e-01   -4.398871374557792e-01   -2.197713208096986e-01   +3.465892782290442e-01   +4.053739627995123e-02   +3.700745994761741e-01   +2.661936331277792e-01   -4.941875775286141e-01; -6.912453166121795e-01   -1.236118342248977e-01   +3.931970088315768e-01   -5.592637737423324e-01   -9.577907006325413e-02   +3.761330362137946e-01   -1.503023025152784e-01   +8.510208757666263e-02   -1.089973098937986e-01   -2.311579711517591e-01   -3.945213074763476e-01   +7.560719717296502e-01   -7.727122106893171e-02   -1.288533632827399e-01   -4.227310302760788e-01   +2.821910403605447e-01; -4.317835373068735e-02   -2.128581335032987e-02   +2.251034620200619e-01   +1.783727889102538e-01   -3.298964913129279e-01   +5.599915910446117e-01   +4.144684178465428e-01   -6.126824604139800e-01   -6.834680038069535e-01   +7.070083951626588e-01   -4.186796510791917e-01   -3.938663306150847e-01   -3.730110587078345e-01   -2.248107563077377e-01   -4.063799395880382e-01   -4.186516779887933e-01; -5.131980703323120e-02   +6.608532644181556e-01   -1.161725447104975e-01   -7.318911199336188e-01   +2.982165115959222e-01   -2.479115437512949e-01   -9.101744491430393e-02   +3.245334725346258e-02   +6.133400738284273e-01   -6.230279843363848e-01   -3.093232069564927e-01   -2.121998388411265e-02   -4.161308863095016e-01   +3.881420728749702e-02   -3.077185016575621e-01   -3.194682009624125e-01; +3.435922581174368e-01   -1.991787935641350e-02   -1.201386347813104e-01   -1.535344288863808e-01   -3.207721298257141e-01   -2.530630676052151e-01   +1.704770842133571e-01   +3.483582168511528e-01   -2.846183643702002e-01   +5.232227377704429e-02   +6.287613124211058e-01   +2.693643574073166e-01   +2.046346233152276e-01   -2.178404205223443e-01   -1.663188644136708e-01   -4.122261757994958e-02; +3.699656247254916e-01   -6.746799383502914e-01   -6.846435336322644e-01   +3.007170777059804e-01   +6.567092980918738e-01   +4.520565715372454e-01   -8.262071156744762e-02   +1.229352148854496e-01   +3.465039144026858e-01   -6.685186500248228e-01   -1.449910164335645e-01   -5.001829108715649e-01   -4.551110349218013e-01   -1.918912888411533e-01   +4.268752298606205e-01   +8.610304971379583e-01; +6.289065441450181e-01   +3.810157083405567e-01   +2.423153501361054e-01   +7.211073543781656e-02   +7.200066947388231e-02   +3.596667011272958e-01   -2.700063994706569e-01   +1.471619586195146e-01   -2.394051155759571e-01   -5.043645557840692e-01   -1.629912970431267e-01   +8.747207864652113e-01   -2.278259813035118e-01   -4.329923376308565e-01   -2.476405846184121e-01   -4.360978554807549e-01; +3.502493331472148e-01   -1.191250989647353e-01   +8.717238447619995e-01   -6.536775446844865e-01   -3.287259237324509e-01   -2.565045516186254e-01   +5.976512162150133e-01   -6.613009183240203e-01   -4.627622340614384e-01   -5.394209964362774e-01   +4.543058588081098e-01   +4.067962375001632e-01   +4.518651443412178e-01   -1.980758297018034e-01   +1.725130282651551e-01   +5.712077784030154e-01; +3.189780816808670e-01   -4.319362106986421e-01   +1.600593984778651e-01   +1.146487919831579e-01   -5.675184133084613e-01   +2.458172415073352e-01   +1.331214939068051e-01   +3.558661905440971e-01   +1.753688489885010e-02   +8.532743492086491e-01   -1.743472843834988e-01   +5.050588601810595e-01   +1.010066114483698e-01   -2.556037658711366e-01   +5.617127656400628e-01   +8.432495500401195e-01; +3.035292267795289e-01   +1.650435760729598e-01   -2.927956508946312e-01   -5.958646008198704e-01   +3.731794487467244e-01   +3.601819596770074e-01   +3.326729512533867e-01   -4.127214371253753e-01   -1.082850077784298e-01   +9.164217154408205e-01   +9.654963281451634e-02   +4.214988552737397e-01   -4.355299424302538e-01   +2.236912992708347e-01   -3.219851414457006e-01   +4.539652058002530e-01; -2.535122440398309e-01   +5.383877410267702e-01   +9.260127933764978e-01   -8.060726004704009e-01   +6.614770391312883e-01   -3.783554140264943e-01   -3.033658061110951e-01   -4.308775221601300e-01   +3.105831505501714e-01   -5.940136737606588e-01   +2.293777386689571e-01   +5.333822493465710e-01   +4.282268259620631e-02   -1.574331311691479e-01   -5.232052819781668e-01   -1.944668087118721e-02; -3.499031920739470e-01   -1.991592140905673e-01   +2.999343879143029e-02   +4.328246880787706e-01   -4.109426550131549e-01   -4.793092072698318e-02   -1.219577241105253e-01   +2.561370185679628e-01   -5.738298810055334e-02   +1.432848161221650e-01   -9.202050439162623e-01   +1.000000000000000e+00   -2.591400112060993e-01   +1.059372420332115e-01   +3.987867796861649e-01   -1.209233167711968e-01; -6.565406524510945e-01   +5.223115796735143e-01   -3.702473759542013e-01   +3.507990081892475e-01   +5.492524594138088e-01   -6.421174932476706e-01   -4.184545029719430e-01   +4.011041287036599e-01   +3.090904911726305e-01   -2.064133827656933e-02   +2.372820668503681e-02   -5.082118579814566e-02   +7.956808143269142e-02   -5.406336215172957e-01   -7.455666232421707e-02   +2.080523952534773e-02; -2.574602547062633e-01   +2.991564155458125e-01   -7.430174893650997e-01   -2.747260038240328e-01   +2.990352721118110e-02   +3.709094377996880e-01   -1.420793003634697e-01   -1.919020014656429e-01   -7.739285114611273e-02   +6.834956672903832e-01   -2.508944402056199e-01   +2.386314651791794e-01   +5.330478224800957e-01   +4.805817859669024e-01   -2.434626923844377e-01   +3.091234698166668e-01; -3.220067338774867e-02   +5.396747949210721e-01   +4.290506523157557e-01   -6.521743224709443e-01   +7.036199708047790e-01   +4.223106084570299e-01   -7.186498271552332e-01   -4.637231106615812e-01   +6.412707297914395e-01   -5.402567086918971e-01   +7.115255613491913e-01   -5.051314052476984e-01   -1.082073815374949e-01   +2.574266735464290e-01   +3.447502234878517e-01   -1.297439767714181e-01; +3.738467345622473e-01   -4.350738698692804e-01   +2.560920775185954e-01   +8.506335822870570e-02   -3.162651606419921e-01   +1.989593470361086e-01   +3.266129290262655e-01   -1.902403493830971e-01   -4.836397668691932e-02   +2.669654742292765e-02   -4.338578480717008e-01   +5.904570530821001e-01   -3.238064374715150e-01   -8.007138857871570e-01   -7.013866990480992e-02   +9.558178532918664e-02];
L1E_L1I_iGABA_netcon = [+4.547413559308035e-01   +5.651632271961793e-01   +5.194741143996382e-01   -2.648815367552923e-01   -8.549354855352973e-01   -2.171704438709394e-01   -3.257872947629992e-01   +8.378517336911456e-01   -6.890180620361470e-01   -4.161350960248982e-01   +3.731739785161641e-01   +5.491998268763791e-01   -3.134580311823034e-01   -4.406217774252158e-01   -5.188574425579578e-01   +5.009177241411454e-01; -9.788972101337468e-02   -1.558457011876365e-01   -2.046642695935306e-03   -5.055958408151598e-02   -3.112019326941673e-01   +4.779093246927023e-01   +2.672354956687535e-01   -2.674288913684228e-01   +1.002739141788654e-01   -1.005798345927156e-01   +4.301157998291414e-01   -4.356496046084621e-01   +7.223533756503631e-01   -3.577171967212767e-02   +4.320562610942183e-01   +6.063442490276055e-01; +7.398203955182646e-01   -1.401668190066388e-01   -6.944165618834490e-01   +4.455780751201707e-01   +1.468699391864530e-01   -4.792689075941107e-01   +7.163702283970158e-02   +2.470198838554669e-01   -3.694760960966221e-01   -5.318543764998757e-01   -3.700788535800285e-01   +2.113394575333352e-01   -8.736586581773767e-02   -1.958676442748974e-01   +2.935455967849415e-01   +3.131556004155934e-01; +4.195912340710597e-01   +4.669487725528186e-01   +5.637910761429807e-01   +5.270578242872768e-01   -6.476826339676193e-01   -6.026278554993929e-01   -3.571592269584334e-01   -2.806756679678997e-01   +8.034502763454948e-01   +4.734097309106111e-01   -2.465800628936502e-01   -2.313015291216226e-02   +4.837917998452570e-01   -6.114536538088695e-01   -1.295441014243385e-01   -6.313652580263454e-03; +2.337975849261592e-01   +1.000000000000000e+00   +1.928146266844915e-01   -4.931108605769778e-01   +5.234345229545112e-01   -5.607121351726863e-01   +3.705865629984020e-02   +2.227501445059214e-01   -6.197021184353665e-01   -6.512338150551340e-01   +4.778636589993460e-01   +4.040237336734821e-01   -1.074647061017308e-01   -1.710219962111006e-01   -1.954243887797990e-01   +4.112441049245102e-01; +9.714294708450609e-02   -4.243363925747928e-01   +5.134508570460584e-01   +1.321822078385727e-01   -5.875746423662783e-01   +1.776078316541521e-01   -4.787857934064359e-01   -7.295833315018573e-01   -4.766479005755803e-01   +9.148260370159149e-01   +2.650119775406536e-01   +1.346152024328571e-01   +5.489670207825199e-01   -5.719082719508590e-02   -3.741200295621717e-01   +7.596700055048939e-01; -1.362522264896409e-01   -3.344598085058454e-01   +7.440875749500443e-01   -1.447892663616927e-01   +5.229126300128383e-01   +2.779821412825623e-01   -2.464173587441021e-01   +6.250533531589156e-01   -3.389149035423856e-01   +2.014253707825906e-01   +2.359459230323311e-01   -3.396787128213340e-01   -2.108163904901768e-01   -4.494675827376953e-01   -3.929587046211642e-01   -1.107899612554908e-01; -3.099613386189815e-02   -5.769308771237860e-01   +3.056689336814825e-01   +2.200284961042024e-01   +1.537677708558055e-01   +4.544105222242587e-01   +7.621561045356207e-01   -2.696968403416270e-01   -7.513634466488992e-01   +4.048247717496706e-01   -8.799796971109126e-01   -1.712542740355181e-01   -6.389149497007057e-01   -1.557759081151386e-01   -3.192657467248148e-01   +2.562823843003776e-01; +2.948758075764643e-01   -2.509375183730164e-01   +4.206122974717513e-01   +1.285090687320535e-01   -4.941412218844968e-03   -9.088522006102980e-02   +1.936015057344052e-01   +2.074067824202336e-01   -6.747527360905803e-02   -3.246095230867359e-02   -3.650019978874107e-01   +6.337318431517227e-01   +5.656423875366003e-01   +6.517458549097910e-01   -8.787671684213085e-01   +3.849228272531714e-01; -6.989918675883607e-01   +6.858425574573046e-02   -3.119793121810317e-01   +3.428213793831188e-01   +5.340700856486694e-01   -3.036976969776593e-02   +1.241747889058259e-01   +7.095554295634172e-01   -4.834947364227066e-01   -3.498318555245400e-01   +2.101276316461769e-01   +3.683330271859456e-01   +7.469392700264715e-01   +6.237392537471451e-02   -3.841828669370454e-01   +2.734883686525700e-01; -2.214110694041434e-01   +7.043427807757022e-03   -1.689814188681591e-01   +1.124747822000149e-01   +3.527671052764744e-01   -1.996125573992344e-01   +4.981448089321714e-01   -4.681270938927610e-01   +2.039651974809030e-02   +2.390122504320627e-01   -3.589943767871897e-01   +3.684331326661138e-01   -1.286693317836206e-01   -1.640862354458712e-02   +4.241036416862579e-02   +4.125596299725286e-02; -7.178962750730972e-01   +2.714841200373819e-01   +1.039338483130633e-01   -2.823507075694794e-01   +1.982194537047478e-01   +9.307633199146403e-02   +6.037683758027120e-01   -2.003337766493623e-01   -2.420093239537746e-01   -5.009960309359477e-02   -1.809509719351281e-01   -9.556567235975494e-02   -2.508109382332644e-02   +6.278121743102554e-01   +4.756020383584047e-01   -3.264227076684054e-01; +5.133258297448092e-01   +2.063720921835754e-02   +8.116347482301648e-01   +2.109691755862471e-01   -3.696248237696500e-01   +2.411112286670181e-01   +8.435599269067515e-02   -6.323309273397202e-01   -1.508286241162261e-01   +2.407258514262692e-01   -4.169681094837673e-01   -6.314012857960498e-02   -6.239276008139679e-02   +3.744990830889539e-01   +2.994234032991109e-01   -3.118278719431009e-01; -5.131472474237260e-01   -8.275850339457522e-01   +4.818682452800061e-01   -2.253035265886377e-01   +8.341284957162676e-01   -7.101297740172389e-01   -7.712414816975716e-01   +6.228508270916597e-01   -1.189436136428526e-01   +5.230573705860098e-02   +2.027085952251736e-01   -5.405332709530540e-01   -9.406588380873396e-02   -7.237034231832773e-01   -5.946041545985576e-01   +5.209440639044403e-01; -5.838514333689228e-01   +5.028717957172190e-01   -1.749569012981081e-01   -4.392850436660939e-02   +7.292148779443337e-01   +4.520318227117321e-02   -6.057805806678381e-02   -5.875010816896000e-01   -7.640963470590885e-02   +7.455923726713002e-01   -5.055920967382102e-01   +6.041440535336607e-01   +5.425192397937880e-01   +4.020834125807646e-02   -2.398282360858217e-01   +3.710594876671703e-02; -3.436754139267894e-01   -7.346515413349383e-02   +3.465062831489355e-01   -7.804507938064429e-01   +1.735548805781083e-02   -1.977063315524242e-01   -3.744809806743390e-01   -2.539239316294888e-02   +8.263718344404002e-01   -3.811016659390893e-01   -6.339916257853345e-01   +9.897552065449167e-02   -3.681387876174802e-01   +3.230280273007337e-01   +2.270349302722213e-01   +7.695977607445852e-01];
L2I_L1I_iGABA_netcon = [+7.800050063782873e-01   -3.876512439879092e-01   -3.157154213090962e-01   -2.830777073220470e-01   -2.808859536955740e-01   +4.556002048398745e-01   +4.134889924839860e-01   +7.810293292481186e-01; +7.715604405934409e-01   +2.199591197819507e-01   -2.940168585844604e-01   -5.544969785728999e-01   +5.228974644034182e-01   -5.554906704557871e-01   +3.018476054458848e-02   -3.039067603765704e-01; -2.812185681841096e-01   -5.794547110201872e-01   -3.516958857045732e-01   -3.001301132808364e-01   +9.319918454982588e-03   +4.683123807392023e-01   -7.822262027844787e-01   -1.000000000000000e+00; -1.493867016468985e-01   +2.850801801705317e-01   +5.083429085110009e-01   -4.861510045827832e-01   -6.587302893099025e-01   -7.421264629258871e-02   -6.734048061064858e-02   -1.572986866442053e-01; -4.788906330310994e-01   -1.581271189588549e-01   -5.183545017569835e-01   +5.323276368108885e-01   +5.292684861082423e-01   +1.237061999513625e-01   +1.484208540148079e-01   -5.924945425894694e-01; +6.174564706314827e-02   +6.342235471435880e-01   -6.920352271148480e-01   +7.923375883982497e-02   +5.481368804029323e-02   +1.088216771508658e-01   -3.498938395239408e-01   +5.088406754821519e-01; -2.403773374956257e-01   +2.428584917640843e-01   +1.613831421270558e-01   -7.149076298050669e-01   -2.402005114381472e-01   +2.848082333368773e-01   +8.869731972697269e-02   +3.134909922913230e-01; +1.256230669525042e-01   -4.704593514913864e-01   -1.212345458240025e-01   +8.011410229648331e-01   +1.081170402504646e-02   -1.189691629483421e-01   +2.358070837954992e-01   +3.718370123769479e-01; +7.139663200154491e-01   +5.115638510077677e-01   +2.118913290117296e-01   +1.258598118084778e-01   -9.471835166080161e-02   +8.509627363185625e-01   -2.487544731803499e-01   -6.425534119163107e-01; +3.096585998122473e-01   +4.270658477905968e-01   +3.760272528124340e-01   +5.808638799832351e-01   +3.348699776446805e-02   +4.857047582878578e-01   -5.553818594648952e-03   +3.076414268516079e-01; +1.436430264938454e-01   -6.232084777791798e-01   +3.416655860358737e-01   -4.409268038521212e-01   +5.983479185989430e-01   -8.984640380721809e-02   -2.945193844621670e-01   -7.888776195570230e-01; +2.831643563969688e-01   -2.037430823959821e-01   +1.087694922711516e-01   -1.335999967097642e-02   +3.174831519302059e-01   +7.184321351365299e-01   -7.283318834595499e-01   +2.754152691747709e-01; +4.125905979324299e-01   +5.003204109269159e-01   -3.362421951702473e-01   -3.019984371407701e-01   -2.086846746284908e-01   +1.658656817309536e-02   -4.837738986284937e-01   -6.771480003772403e-01; +1.223099839956544e-01   -3.634344575422815e-01   +7.037247219011104e-01   +3.914369942365344e-01   -2.920529729551123e-01   -1.396196982785249e-01   -2.615933010235542e-02   -6.735359749166240e-01; -6.132123008093323e-01   +4.017550829179009e-01   +1.057868086220349e-01   -5.971587037263594e-01   +4.248016311276441e-01   +4.113820220486607e-01   +3.984121184705361e-01   -6.988464387294398e-02; +1.545552489863448e-01   +3.854370975054452e-01   -4.849579099119251e-01   -4.470979561027596e-01   -3.712036355728411e-01   +5.528867510394252e-01   -3.218943804681256e-01   +5.300346865671652e-01];
L1I_L2I_iGABA_netcon = [-7.760288595562279e-02   +5.967364431536621e-01   -1.673520864947159e-01   -4.346726523152450e-01   -5.811877719775613e-01   -6.538508947063828e-03   +1.000000000000000e+00   +2.225154431368698e-02   -2.120826418457826e-01   +3.987060751471361e-01   -4.932175090178641e-01   +5.131484339467757e-01   -4.308954034785726e-01   +6.721099719934889e-02   -9.607337745281415e-02   -2.455536406426699e-01; +6.814590616524361e-01   -3.781514424921433e-01   -6.787011967108080e-01   -7.357639391121838e-02   -4.573537697887079e-02   -1.520103199498995e-01   +8.120644372898720e-01   -6.371432105656100e-02   -3.568633898010741e-01   +3.518812904577325e-01   -5.320327267336034e-02   +3.741596532564470e-01   +5.789136810870719e-01   +6.205581206655918e-02   -6.561040683864399e-01   +8.385989657041722e-02; -1.908788439330734e-01   +7.088212707183623e-01   +1.745309520458849e-01   -1.225051921920441e-01   +7.469805088012721e-01   -6.971399193701062e-01   +5.779136799251849e-02   +4.804954996106621e-01   -3.806756471530380e-01   -7.883130414512797e-02   +4.938339143743055e-01   -6.608606873459530e-01   -9.002037912865569e-02   -1.865604648096096e-01   +5.755175450132902e-01   -6.956701962574638e-01; +3.082994934180560e-01   -4.174638928019253e-01   -5.450657734214857e-01   +4.827717336668074e-01   -5.907501695773767e-01   -2.309636496966242e-01   +7.246048567786549e-01   +8.639457859015103e-01   +9.400265274595389e-01   -7.001038029440205e-03   +2.872756005645016e-01   -6.387479952564705e-01   -4.610827304974486e-01   +4.451732157645564e-01   -5.389287346992112e-01   -5.575621464624118e-01; -8.704530448364015e-04   -5.044946800190290e-02   +4.355898965873795e-01   +6.723481933791697e-01   -3.982060822459974e-01   +4.360450747819380e-02   +6.206985206702799e-01   -1.279298218614527e-01   +4.966938387831612e-01   +9.929098781906565e-02   +4.871265287052104e-01   -2.906923841479314e-01   -2.709768044685101e-01   -9.849352813613277e-02   -6.803246636854110e-01   +2.680740015403918e-01; +5.500181195385054e-01   +2.139298814815088e-01   +1.031204274911944e-01   +5.585179408656717e-02   -1.784847816791140e-02   +2.429657058361089e-01   +7.525477777591028e-01   +6.311008660581609e-02   +5.014472512139559e-01   +9.592474842806301e-02   -5.981929540974152e-01   -3.045360361572403e-01   -4.552918956909797e-01   +4.983461042984570e-01   -2.274430414633074e-01   +2.685887172145835e-02; +4.570631568455105e-02   -1.911405370511437e-01   -6.804549665282073e-01   +7.166972419904020e-01   -3.579649268560058e-01   +5.582456196808702e-01   -5.049952465560770e-01   -5.373457628765604e-01   +7.839498634120660e-01   +3.576210423735571e-01   +2.770236192637274e-01   -3.700550426792067e-01   +7.982024316234305e-01   -3.679883399125434e-01   -6.156771553456782e-02   -4.672303805371281e-01; +4.099099552380965e-02   -4.687441708790167e-01   +3.809419637742591e-02   +4.310029748915668e-03   +9.106260978504294e-01   +2.396831798485504e-01   -2.920479019443094e-01   +2.481319093478603e-01   +3.022505183467204e-01   +3.610390325044111e-01   -5.614255754558612e-01   +4.786788709457226e-01   -6.189846341871978e-01   -6.025553037023694e-01   -2.726113539935395e-03   +2.133182864722207e-01];
L2E_L1E_iAMPA_netcon = [+1.329652331541441e-01   +1.637860134676422e-01   +6.171385884810643e-01   -5.781607920124360e-01   +4.250302506086495e-01   +2.999812207851667e-01   +3.820794776946768e-01   -4.406891050961498e-01; +2.356101162020058e-01   +5.691353551815155e-01   +6.947478647649870e-02   +2.521562328404321e-01   +2.195449341943368e-01   +8.368873650743620e-01   +7.947477490127594e-02   +4.357132549051752e-01; +5.299093046728952e-01   +8.545557115341706e-02   -2.546319537892498e-02   -5.696713686292785e-01   -5.976444565063890e-01   -1.622997551809409e-01   -9.170531354500194e-01   -2.639072163400257e-01; -9.119513597124332e-02   -8.712766512304611e-02   +3.964495746622307e-01   -2.848461400032945e-01   -7.953345920964473e-01   -6.336707838484439e-01   +2.770752088167247e-01   -1.437310666587845e-01; +1.605811399921639e-01   +3.023155079616399e-01   +2.912421600198046e-01   +7.774516012671087e-02   +2.550268666622220e-01   +8.917660835713241e-02   -7.202182286189965e-02   +5.680537874003603e-01; -9.613558494029513e-01   -2.974382457766970e-01   -2.961754068754472e-02   +3.019218390711590e-02   +3.222379406556635e-01   -1.000000000000000e+00   +3.763678698780762e-01   -1.605742759498882e-01; +5.712467579642103e-02   +6.038204656163915e-01   -5.169884185770703e-01   +4.270091780310413e-01   -4.440949801353102e-01   +4.702487849410342e-01   -5.575517829419679e-01   +3.566713043569125e-01; +3.710593680018414e-01   -2.148570418336292e-01   -4.241053172840207e-01   +6.282857776158879e-01   -4.620426541529506e-01   +3.896706236571231e-01   +3.266920679383496e-01   +2.143001964605643e-01; -3.438003489153189e-02   -1.876358141900301e-01   +5.278179280876008e-01   +2.606089280457882e-01   +2.404250176617109e-01   +5.839702667570390e-01   +6.624374446927361e-01   +2.304121531441518e-01; +6.903502269424375e-01   +3.101843726981491e-01   +7.579905389239228e-01   -1.825582304177420e-01   +1.581927538921022e-01   -7.031979762214504e-01   -1.452750500008766e-01   +1.351096682362112e-02; +3.705424735168300e-01   -9.113035173101668e-01   +5.902477522287769e-01   +6.059090105449437e-01   +1.604035668716170e-01   -1.097532068136928e-01   -6.510948644024607e-01   -1.104932422628652e-01; +1.682322770697479e-01   +2.210970200021513e-01   -4.476293401369436e-01   -5.020946943269581e-01   +3.662506806686598e-01   +5.431671865328574e-02   -5.560312615029642e-01   -6.029481176564343e-01; +5.943109014744382e-01   -7.106469047644691e-01   +3.583888508368132e-01   -2.350246754278534e-01   +7.003446674619068e-02   -1.407410656167443e-01   +3.362430023242687e-01   +1.050427303968038e-01; -6.957971128873194e-02   +3.084612570106705e-01   +2.503166853082458e-01   +3.147463844796637e-02   -6.258256586074754e-01   -5.468869789358964e-01   +3.406403104595291e-01   +1.243338242809068e-01; -8.594608068694287e-01   -4.444027010240849e-01   +1.370045220814375e-01   -2.123564116013238e-01   -5.479306244709059e-01   -5.154939696957322e-01   +3.698428673518737e-01   -2.488749164089259e-01; -6.754809274441260e-01   +6.508941288106679e-01   +1.748006812795063e-01   -3.921143695387327e-01   +3.339610445812511e-01   -1.970364720845393e-01   +7.696360508148469e-01   -3.428831380855004e-01];
L1E_L2E_iAMPA_netcon = [+4.760285295223471e-01   +1.962078338245640e-01   +4.794460807777582e-01   -8.707243951528960e-02   +8.298492461104767e-02   +5.232164017052455e-01   +3.636576760983826e-01   -4.984776459383006e-01   +2.848949930282028e-02   -6.274122347091389e-01   +4.945154098273920e-01   -1.349670420143029e-01   +1.042531902719539e-01   -1.243815859121665e-02   -1.359347564434071e-01   +1.557670420230588e-01; +3.609308969544242e-01   -4.160051663112233e-01   +6.069277945692250e-01   -4.476559713404329e-02   +2.610837858862231e-01   -9.964070544476176e-01   +6.889043878006643e-02   +2.873864968645967e-01   +7.948714940066864e-01   -8.223101799690674e-01   -5.213660043217813e-01   -4.538312312716988e-01   +1.371726929955577e-01   +1.688124887025794e-01   +1.450670333856499e-01   -1.471683416318568e-01; -1.195985217699810e-02   -5.756980535663212e-01   +2.913419545285548e-01   -8.378014002236025e-03   -7.592827459485890e-01   -6.653039229754980e-01   -2.886956002376075e-01   -6.920241611670739e-01   -1.000000000000000e+00   +9.795464487301671e-02   -9.531586108589769e-02   +2.152388742966546e-01   -3.988445979905743e-01   -8.452186412549679e-03   +1.720011479234648e-01   +3.119889980632705e-02; -1.799222963514990e-01   +1.222990396562823e-01   +5.530880411424081e-01   +2.814051883021593e-01   +1.524764773026419e-01   +7.169656589388737e-01   +2.195587826458408e-02   +3.360783109757354e-01   +2.443771676469383e-01   +3.250302864758271e-01   +4.674945685324996e-01   -3.856860782747702e-01   -6.730971186763001e-01   -3.374339218199435e-02   +3.292287033659451e-01   +5.717457493071988e-01; -1.277352874545080e-01   -5.649466117191380e-02   -7.034051736689747e-01   -8.044590089519364e-02   +3.490776054010251e-01   +6.964548495704457e-01   -1.952441121988259e-01   -3.879475172908973e-01   -8.422175674906865e-03   -5.501388420326120e-02   -4.531122496251892e-01   +5.488019118808665e-01   -3.147699442634863e-01   -1.118390185863268e-01   +5.012579168718593e-01   +1.961328436851845e-01; +3.915615361437290e-01   +1.318552469258046e-01   -1.399358351594894e-01   -2.432928478399498e-01   +4.139371962943096e-01   -3.513621926763014e-01   +2.085424487812613e-01   -5.414783271782302e-01   +4.464899504009585e-02   +4.723742471484428e-01   +3.183818557167066e-01   +2.277571697224547e-01   -5.046460902176990e-01   -2.448117063455365e-01   +2.819339690257948e-01   -5.700523554600196e-01; +2.616650289915753e-01   +1.202687065212019e-01   -7.331229872235324e-01   -1.375558100123326e-01   -1.250260836679997e-01   -2.535466104873331e-01   +6.157254409465575e-01   -2.990173387211206e-01   +2.364533081272552e-02   +5.769132032902861e-01   +2.940015179566666e-01   -4.311479309093910e-01   +2.744319522718085e-01   +3.754609775549392e-01   +6.453373061041031e-01   +6.144069074290408e-01; -4.387994302906432e-01   +5.022007288193970e-01   -6.363810367469901e-01   +3.958201031310970e-01   -1.103982089420386e-01   +2.233922322217202e-01   +1.019217535045216e-01   -8.555342269117806e-01   +2.691568784320291e-01   -4.086795033084735e-01   -3.517177701353300e-01   +5.323013898195921e-01   -6.873379477155183e-01   -2.130519053522891e-01   +5.855108522172509e-01   -3.865352493986769e-01];
L2I_L2E_iAMPA_netcon = [+2.041933866526926e-01   -4.326278135092776e-01   -8.524251417447457e-02   -9.749318802173634e-01   -4.014939297882298e-01   +2.021524376017506e-01   -5.243204582344685e-01   +5.714621689035547e-01; +1.648853290231717e-01   -5.892776322949101e-01   -4.352016733019393e-01   +4.269452600811242e-01   +3.223070420676980e-01   +3.687993348340063e-01   +4.684015516134411e-01   +6.030207522473994e-01; -5.843482183123554e-01   -6.115043443185680e-02   +1.229256857448885e-01   +6.888888796549487e-02   +2.594326525105763e-02   -7.214787828674745e-01   -1.921042496316328e-01   -1.107372712022511e-01; +3.488057301511466e-01   +3.193363757060045e-02   -1.204151274503709e-01   +5.802563037254650e-01   +1.275485212585678e-01   +1.444047530188745e-01   +2.740919923995088e-01   -3.278216593200527e-01; -6.455832141481571e-01   -4.010422086962213e-01   +7.631433158451988e-01   +3.740777462894167e-01   -2.154112995280910e-01   -4.226985008531216e-01   +1.055272836506963e-01   +1.000000000000000e+00; +9.297032826278032e-01   -5.398856472810861e-01   -7.731278186989901e-01   -7.299861609973224e-01   -4.884947392895342e-01   +4.317145659347000e-01   +2.306058260357683e-01   +4.303482655014275e-01; +6.653425390814789e-01   -2.041481165838707e-01   -5.755269294340558e-01   +1.073169495398358e-01   +1.907576175928786e-01   +7.543055537447614e-01   +3.078664012250746e-01   -7.832281358011305e-01; +4.572272206563024e-01   +9.662747075193089e-01   +5.216897619763019e-01   -1.747026477733064e-02   +1.019999559241378e-01   +6.864696497086301e-01   -3.500000451470689e-01   -5.878600870144637e-01];
L2E_L2I_iGABA_netcon = [+9.510574796122662e-02   +2.023230364573165e-01   -3.925675739860383e-01   -1.630566008677510e-01   -4.998587066637035e-02   +1.017511596683959e-01   +1.000000000000000e+00   +7.377495162689289e-02; +3.237281144218357e-01   +1.937368612515679e-01   +5.347802156476327e-01   +6.388951046247879e-01   -8.332285085048274e-02   -2.730202521470503e-01   +2.986349341516189e-01   +6.530259581754932e-01; +3.261810590510351e-01   +7.702808197583270e-02   +3.618111744580631e-01   -1.284844961711459e-05   +6.037753803336932e-01   +3.438968237117042e-01   -4.303157133891223e-01   -4.572565952325675e-02; -4.632104990349930e-01   -7.029177964195975e-01   -1.100184861939661e-01   -2.639870687346433e-01   -1.669683605086193e-01   +2.879823359654915e-01   -3.534031438235099e-01   +4.395137613338825e-01; -1.129198491544315e-01   -7.427948332036403e-01   -2.596473830130989e-01   +2.005023415144828e-01   -1.702609955871201e-01   -6.441410701764093e-01   -2.333602769126232e-01   +1.940700086882764e-01; +1.565558164455604e-01   -5.758439152404964e-01   -3.081046998102847e-03   -6.994635599704506e-01   +7.221192997245676e-01   -6.290035943185754e-02   -2.244679391749685e-01   +3.874366792111483e-02; +5.595743009234031e-01   -3.882013406229954e-01   -3.816396906796055e-01   -7.522373109487229e-01   +1.820083274583029e-01   +2.962885845356317e-01   -6.586754466655529e-01   +4.898975074648725e-01; +4.945754342855678e-01   +9.236607217644057e-01   +3.729237119847900e-01   -3.953239978650543e-02   +5.841239116084892e-01   +2.462627190330766e-01   -4.442762845226607e-01   -7.641505972539714e-01];
L3E_L2E_iAMPA_netcon = [+2.232216291201321e-01   -4.519441155274198e-01   -2.644614006328785e-01   +4.995568065314198e-01   +7.544374907180450e-01   +2.241515341034428e-03   +4.821713059625304e-01   -5.150000380930571e-01   +8.469344277185062e-01   +3.674837779377860e-01   +3.568064081335408e-01   +7.193906152417310e-01; +3.278968600931304e-01   +3.994675199162591e-01   +3.695843940484396e-01   -1.130050803802198e-01   +1.017192354622294e-02   -5.425507957409555e-01   +3.218011705713538e-01   +7.071996280933269e-01   -5.423871271119859e-01   +4.514330632684320e-01   -9.456975379896913e-02   -4.200143254607678e-01; +1.257209193543971e-01   -1.502541123794923e-01   -8.566940302272001e-02   +3.908896881674614e-02   +4.384666619385414e-01   -8.815924487120503e-01   +4.239903430075209e-01   -9.194838594659173e-01   +5.424439432491267e-02   -5.115615077121508e-01   +6.617220669533663e-01   +1.000000000000000e+00; -3.957277734975903e-01   -2.520404115081729e-01   +1.843820546959163e-02   -6.775179165916476e-01   -4.023480817141027e-01   -5.808206839551378e-01   +3.716342744285276e-01   +4.032849725608774e-02   +4.987113841234379e-01   +6.014861369251931e-01   +3.887532439622493e-01   -8.025806435071697e-01; +3.347607778890483e-01   +4.499415746601059e-01   -6.729293346378820e-01   -2.591217083338255e-02   +8.655668052764119e-02   -5.346159660929520e-01   +4.907003125889288e-01   +5.305158278632167e-01   -4.529874989569020e-01   -2.760753344923437e-01   +4.627153578657044e-01   -5.271161854839670e-01; +7.884246491032114e-01   -8.748602962648856e-02   -1.141301847831321e-03   -1.857494216007622e-01   -8.024271428789236e-02   +3.134421814232906e-01   +3.733143015460149e-01   +3.795609928281337e-01   +3.383409515954936e-01   -4.785460149453820e-01   -4.809982389288645e-02   -6.997389944972775e-01; +3.905270215184064e-01   +2.630166194719460e-01   -3.760186181497399e-01   +1.320892046407066e-01   -1.573898175258011e-01   +6.896640862557020e-01   +7.251130505707608e-01   -7.278954350158280e-01   -8.644426774682654e-01   -5.136478961907491e-02   +3.829930026959912e-01   -9.742350401576902e-02; -2.431559301211417e-01   -3.722323603341247e-01   +5.710628088483298e-01   +3.618221748887607e-01   +1.744641785086741e-02   -6.714130095188892e-01   +5.753027833994495e-01   -6.056188959050395e-02   -8.190131334800422e-01   +6.535319691344994e-01   +1.493417398072460e-01   +9.313392560209788e-02];
L3I_L2I_iGABA_netcon = [+5.848212536453014e-01   -2.134959206548061e-01   -2.500437429195262e-01   +6.232767159682532e-01   -1.476635307516277e-01   +4.682561115287510e-01   +2.040530694437313e-01   -2.378694332801984e-01   +4.514093880614015e-01   +4.911352531192866e-01   -2.741792862999409e-01   +4.701204441273411e-02; -4.931074798093340e-01   +4.813810114767598e-01   -3.498224406484750e-01   +4.735187450875941e-01   -3.665860387423208e-01   +4.161675495847870e-01   +1.669739927711365e-02   -6.010393322928402e-01   -8.383098993539241e-01   +1.267270882116718e-01   +8.286864008289846e-01   +3.847934749152895e-01; +5.914777355897837e-01   +2.745877128738235e-01   +6.247617981405010e-02   +2.072212681204117e-01   +2.299052622088952e-01   -1.120788664918801e-01   +2.890864710634963e-01   +4.305451031577596e-01   +9.020195575243917e-01   -6.890280952791473e-01   +6.346762484958663e-01   -2.065323382082186e-01; +4.241640802104359e-01   +3.971023159280703e-01   -5.301595086532457e-02   -3.325825477910794e-02   +4.796741213730649e-01   -2.652282110563141e-01   +3.161982596065812e-01   -2.383743285808793e-01   +1.931967848753618e-01   +4.628696541044203e-01   -4.459857651528267e-01   +1.672278376352180e-01; -2.807284666968139e-01   +1.374695894539346e-01   +2.169321469461823e-01   -2.248393159202497e-01   +2.681276517942288e-01   -6.739689777363215e-01   -9.688485516395321e-01   +8.526891814611343e-02   -6.284001052459426e-01   -2.435394909708266e-02   +5.119720981886262e-01   -5.522499342037290e-01; -3.870335553334983e-01   -3.285077457010169e-01   +2.515607457793309e-01   -1.027835422164816e-01   +4.530603724552328e-01   +3.331818454178373e-01   -6.920376830962155e-01   +4.187013570900976e-01   -2.252924865971514e-01   -2.654097478304329e-01   +9.060356692892092e-02   -6.539806116748091e-01; +1.425801181446067e-01   -1.230331825314501e-01   -3.030563838486914e-01   +5.422839308575059e-01   -5.527455662271531e-01   +6.001495387388326e-01   -3.750040047433686e-01   +7.109563010648892e-01   -1.178961824016884e-01   +5.624745237922220e-02   +5.026141430535497e-01   +2.906987392669731e-01; -8.368599130665919e-02   -8.389241717250970e-01   -1.575647104464520e-01   -3.390059316107330e-01   +2.400508393068189e-01   +5.720797500775769e-01   -2.183502477477276e-01   -7.291335737777631e-02   -1.914269767623441e-01   -3.885597901913395e-01   +7.095930829091895e-02   -1.000000000000000e+00];
L2E_L3E_iAMPA_netcon = [+1.127040602976389e-01   +5.197064407131650e-02   +2.346091990527136e-01   +6.435049276583187e-01   +3.691135411894577e-01   +9.613359961399907e-01   -5.013970029931121e-01   -4.148804410537137e-01; +2.886345093162395e-01   +4.591655971440031e-01   -2.711047282687462e-02   +2.542491316053161e-01   -2.466974184805753e-01   +2.015415923350941e-01   +7.009749134192820e-01   +5.842163330184793e-01; +1.230213393795968e-01   +2.662145744503602e-01   +3.810170185960748e-02   +2.084925172519835e-01   -1.212545287717884e-01   +5.119757312018677e-01   +2.345057643132026e-01   -1.359359370149447e-01; +2.699349852861593e-01   -2.234796207886108e-01   -1.706721970571395e-01   -4.733237292103172e-01   +1.102033439969825e-01   +5.683147276435727e-01   +5.890677926150439e-01   +3.634515792526726e-02; -2.841272982537421e-01   +3.224794189453996e-01   +6.977000351609612e-01   +2.943986985531551e-02   -7.311600715517114e-01   +4.192536016197748e-01   -1.235511451663172e-01   +3.487689146060010e-01; +5.204782078991866e-01   +4.666707696051267e-02   +6.393085486064710e-01   +5.562488729489794e-01   -1.081993484912141e-01   -4.456018416892791e-01   +2.056546655436327e-01   -6.239029919620376e-01; +6.449967530164877e-02   -4.658590229452399e-01   +5.747441420551481e-01   -1.194835576935403e-01   +5.742518643425470e-01   +7.419658143345655e-01   +2.729007655891706e-01   -1.183550512889738e-01; +5.065826856593818e-01   +5.705387517379448e-01   -7.958086027224340e-02   -5.067721265322102e-01   +1.131185336933213e-01   -8.882584103535826e-01   +2.759244801158177e-01   +4.881151910592346e-01; +1.785773870736763e-01   +6.677400799563621e-01   +4.679810950947456e-01   -1.163914029964262e-01   -3.606333494820797e-02   +1.703839349389048e-01   +1.550111677622272e-01   -6.912204351088695e-01; +1.193810876309698e-01   -9.558010181388018e-01   -2.784844508954209e-01   +8.111030807132463e-01   +8.540963787671950e-02   +3.552121515332566e-01   -1.000000000000000e+00   -4.402688102452632e-01; +3.145978990919701e-01   +4.328026462567561e-01   +4.153247600482644e-01   +5.131945956485565e-01   +5.120874384710614e-01   +1.603101565959872e-01   +5.177413935367177e-01   -5.661529904658511e-01; -5.492051806186320e-02   +8.632697776692211e-02   -1.237375150484499e-01   -4.889940871367714e-01   +4.207239025809397e-01   -3.010189274288458e-01   +4.723972479137874e-01   -6.647130502487029e-01];
L2I_L3I_iGABA_netcon = [-2.320846086915961e-01   -7.494191726833443e-01   -1.000000000000000e+00   +2.487595226538848e-01   +3.913728130835907e-01   +6.964915970220596e-01   +4.374227931121129e-01   -3.014551877136879e-01; +5.094565567107057e-01   -2.042686498244627e-01   -3.333850380325289e-01   -2.582867153926273e-01   -3.276405994623182e-01   +5.177269653060014e-01   +6.917043830088393e-01   +2.271139079913826e-01; -6.743969702026695e-01   +7.225286705541877e-02   -2.749291930424487e-01   +3.113083463715758e-01   -2.029644367304781e-01   -1.382270562199281e-01   +1.738001159343352e-01   -1.898996804444675e-01; +1.422197317991706e-01   -1.637375879553232e-01   +3.745404181746619e-01   -1.361507823648276e-01   -1.133686807440276e-01   +7.402479515603427e-02   -2.282510558122852e-01   +4.595125582056193e-01; -3.538891346954334e-02   -4.011810911482745e-01   -9.166437543931735e-02   -2.330590432844811e-01   +8.710592358423198e-01   +4.410866410107643e-01   +2.438516865969926e-01   -1.619438964022458e-01; +2.942296195173750e-01   +1.313997440720431e-01   -5.840697621148876e-01   +5.033177227406332e-01   +5.595390695138753e-03   +4.898614783897762e-03   +8.737179625956479e-02   -1.455626389129410e-01; -2.952010391976663e-01   +3.269700189922640e-01   +1.547696983783116e-01   +6.159011422658818e-01   +1.776692759092203e-01   +2.214961174292815e-01   -6.481461826179366e-01   +1.540194317991040e-01; +1.605622769662023e-01   +1.843174785131557e-01   -1.486691021897591e-01   -4.647559435370618e-01   +1.832475606911435e-01   +5.974613016924631e-01   -3.003080850193542e-01   +2.047211189880370e-02; +4.882923306078219e-01   +4.683206276963002e-01   -6.356514999996911e-01   -7.365681800515181e-01   -9.420988717892999e-02   -2.006769136313332e-01   -1.662065837037186e-01   +3.379425753934083e-01; -4.456621705122093e-01   -4.191830875664101e-01   +8.048989775860573e-01   -1.113401865932509e-01   -4.042665160422275e-01   -2.076640052245117e-01   -3.692771500275983e-01   +4.772916661423044e-01; -1.285213153788198e-01   +1.149621853728414e-01   -6.065619229442112e-02   +3.471031734680656e-01   +3.454882767095281e-01   -4.710142095541667e-01   -2.066956237921738e-02   +6.708130964694010e-01; -1.975835312835440e-01   +1.579493390321699e-01   +8.740118369908195e-01   -5.628339497871934e-01   -1.523985243467799e-02   +3.829258991961375e-01   -3.805811122752788e-01   -2.191916222979050e-01];
L3I_L3E_iAMPA_netcon = [+4.102096031597362e-01   +7.293588058716561e-01   +3.926443104130690e-01   -6.549375694927129e-01   +4.475998096363499e-01   +2.917036128586847e-01   -2.763914140905867e-01   +3.647312292047555e-01   +2.685942021114597e-01   +6.771384620184688e-01   -1.523590054804290e-01   -7.355129219858712e-02; -1.223669374983048e-01   +4.091304249482431e-02   -1.331546906592820e-01   +3.639511392833973e-02   -4.353758693437688e-01   +3.359998402087933e-01   +3.950211335434780e-01   +6.016743188444018e-01   +6.453439025054070e-01   -8.282500236005417e-01   +4.443255045312535e-01   -2.067606621461119e-01; -5.656272918915606e-02   +2.125835242822584e-01   -4.291767577778117e-01   +1.263391814556745e-01   +2.220177944905272e-02   -6.637905253127013e-01   -5.036193249287568e-02   +3.445127107427393e-01   -2.332649486833749e-01   +5.378822598057769e-01   -1.920721011564658e-01   +5.385111369794443e-01; +3.699931455067657e-01   +2.235940292671834e-01   +1.405559982613408e-01   -9.166900014305673e-02   +9.130071842041917e-02   +4.021130578767381e-01   -7.190653816966531e-01   +4.314303910314707e-01   -4.600806382335050e-01   +3.732835024169170e-01   -2.723814695649679e-02   -2.804085046840542e-03; +2.435815806918525e-01   +7.027119073902276e-01   +7.145161496499973e-01   +7.792053982355848e-02   +2.218913154241311e-01   +6.991843948120027e-02   -1.522335970867852e-01   -8.412942930553180e-01   -4.890963507934806e-01   -5.168744662780126e-01   -2.724787366174462e-01   -4.654601059697812e-01; +2.618205178507129e-01   -7.924154559307045e-02   -7.018676065774715e-01   +4.809981577486083e-01   -4.703549268775017e-02   +3.858363589479010e-01   -3.829521525281739e-01   -1.651673724413493e-01   +4.725565253680003e-02   +3.034718367233807e-02   -4.135527523016788e-01   +3.081705125315252e-01; +1.000000000000000e+00   +1.767487279835986e-01   -7.127072748633961e-01   -2.472277516649990e-01   +4.639282536065754e-01   +5.536670255747092e-02   +4.303316251837249e-01   -1.834211563427091e-01   +6.785080602539836e-02   +5.579017099665602e-01   +2.585338432438659e-01   +2.435507833096726e-03; -8.903553361262564e-01   +4.969996207741272e-01   -4.755842005610709e-01   -2.599055006236135e-01   +4.119216152906812e-02   -4.491410823215405e-01   +2.541851007655130e-01   -1.468057296070009e-01   +5.147402519295319e-01   -1.803352232901247e-01   -4.250428152388792e-01   -3.160118549166337e-01; -1.835619999981875e-01   -2.999650559888574e-01   +6.009773324900893e-01   +1.464646883402428e-01   -3.699202515808853e-01   -2.475269958941100e-01   -6.457137168502930e-01   +1.844647296408910e-01   +4.126781194622098e-01   +1.682478624886643e-02   +3.853137753789944e-01   -6.553934374162010e-01; -3.840205179520444e-01   -1.019756213238039e-01   +5.339654123103996e-01   +6.752098459385821e-01   -3.914560127089476e-01   -1.363552380047208e-01   -1.372355050578472e-01   -1.788077590003575e-01   +7.262708090425798e-02   -4.046500513062652e-01   +1.398801768693144e-02   +5.859382445867017e-01; +3.127622683981128e-01   +1.944043876725678e-02   +4.219526632790291e-01   +1.437098052426720e-01   -2.081961351223131e-01   +2.526526829486893e-01   +2.252140684139014e-01   -6.947354151378657e-02   -1.788460889011462e-01   -1.464301060114771e-01   -8.988887968691158e-03   -7.710951694062045e-02; -5.836188300729633e-01   +4.495012670872484e-01   +4.149528311980784e-01   -1.479298968656017e-01   +8.540373726854049e-01   -6.130875435367960e-02   -2.847445450748168e-01   -7.139777669675661e-02   +3.875096085686276e-01   +6.837720645728958e-02   -2.078061866239652e-01   +5.886245300491801e-01];
L3E_L3I_iGABA_netcon = [+4.023212721655400e-01   +1.943771121125947e-01   -1.898313865820944e-01   -7.546579426438891e-01   -4.529862059118557e-01   +2.088899879955697e-01   -6.184521648686714e-01   -2.514011644900204e-01   -1.000000000000000e+00   +2.075590360358479e-01   -2.216110428596290e-01   +2.345490324565638e-01; +2.934468316374864e-01   -2.193367454502136e-01   +1.646277997822956e-01   -9.490154033502751e-01   +3.708656183142200e-01   -6.594454863816570e-01   -5.113896992188411e-01   -3.798016147110244e-01   -2.087684368601315e-01   +6.363060218086878e-01   +6.656133870766001e-01   +9.434029290227025e-01; -4.179112298881013e-01   +4.148294010886747e-01   -4.333364717246629e-01   +4.586061266648716e-01   -2.741051472008523e-01   -6.284879222877310e-01   +3.682339059709345e-01   +5.817601313495707e-01   -2.589391905785412e-01   +6.565440437588680e-01   +1.309507917935848e-01   +5.244983127322261e-01; -7.594400579858149e-01   -3.539845657953034e-01   +6.617799077287871e-01   -6.108122716679729e-01   -1.225525150883766e-01   -1.000167213779586e-02   +2.157312025958940e-01   +5.851609275516255e-01   +2.406315732481605e-02   -2.866612888372132e-01   -7.317596271309219e-01   -7.448184546721124e-01; +7.123522483901560e-01   -4.923742474266942e-01   +1.070184735975587e-01   -1.408224989980655e-01   -6.698819127786147e-02   -5.854717492124695e-01   -4.330596100364771e-01   +1.785310750142056e-02   +7.655365985115810e-01   -2.758203781134685e-01   -5.373334498784849e-01   -7.740505390651825e-01; -1.614731672780674e-01   +4.047065541272878e-01   +8.523916635863402e-01   -2.421238568978423e-01   -4.467078789184667e-01   -5.254263983722322e-01   +6.988684225473946e-01   +6.217055893380027e-01   -6.996503468344043e-01   -2.422278364823995e-01   -5.882955241836151e-01   -3.413714719135302e-01; -4.090383534077127e-01   +7.056642679567859e-01   +2.756000760247141e-01   -1.589547790010267e-01   -1.379260671502615e-01   +7.963209290674005e-01   +1.962028533702345e-01   +2.912771624083693e-01   +1.526604778539434e-01   -1.082710978415027e-01   -5.267311433565216e-01   +4.859362530158780e-02; +1.318631854300364e-01   -6.974010165868628e-01   +5.318103864472764e-01   +1.454185009388582e-01   -2.772335944067146e-01   +4.950142734929314e-01   -1.825209464958542e-01   -5.192026299309562e-01   +6.354765002321272e-01   -7.516627569427708e-01   -8.680301124022165e-01   -2.473456166731501e-01; +2.333427942572681e-01   -2.455166295214568e-01   +4.563244592918377e-01   -8.447466677528889e-02   -6.769833155371763e-01   +6.352978779040355e-01   +1.342053162302894e-01   -2.304699152716291e-01   -1.413377270394783e-01   +8.635069084362473e-01   +8.496165647180819e-01   -1.041838205145034e-01; +1.214741677602105e-01   +4.277735312516924e-01   +1.945941869099878e-01   -6.425951527641680e-01   +3.715876045548296e-01   -5.584983193362101e-01   +4.612465896584076e-01   +3.884162155599807e-01   +7.174201091562390e-01   +6.867368377366764e-01   +3.176297812535542e-01   -3.362830715339855e-01; -1.850249955335529e-01   -2.424340909138212e-01   +3.070526103075183e-01   +5.918019620000370e-01   -7.261859863085399e-01   +7.738769175299379e-03   +4.978636691246602e-01   +1.634162812521426e-01   +4.863657322608301e-01   +9.424134204131202e-02   -5.088053233011236e-01   +6.873882076147746e-01; -4.864909604700253e-01   -1.585839907813424e-01   +6.383903700456105e-01   -6.101436091721804e-01   +3.032950030999719e-01   +2.006419263777865e-01   +3.091198752695818e-01   +3.785339093600421e-01   +2.138105079726659e-01   +2.643641710854253e-01   +3.684963549539593e-02   -1.102826608220034e-01];
L2E_Input1_iAMPA_netcon = [+3.580652166844606e-01   -4.380328229818469e-01   -7.361890230733674e-01   -3.584480873488440e-01   +3.824226284360384e-01   -6.961122655138524e-01   -2.240739223111806e-02   -1.000000000000000e+00];
L2I_Input2_iAMPA_netcon = [+5.963193884274293e-01   +1.985403273151157e-01   +1.000000000000000e+00   +7.755110390186871e-02   -2.430254406421236e-01   -4.088848596139112e-01   +7.379894446548479e-01   +1.382462257808001e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 100*(sin(2*t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 100*(sin(2*t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
