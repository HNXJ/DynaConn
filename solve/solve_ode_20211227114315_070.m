function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+4.429212305837285e-01   +2.263940840390452e-01   +1.623362665330481e-01   -2.746593507335113e-01   +2.827374563850252e-01   +2.455199771821000e-01   -5.357877215442967e-02   -1.373291628421194e-01   +2.462679711273953e-01   +3.814242150694403e-01   -5.217859379744395e-02   +2.954298514969712e-01   +3.796515519158659e-02   +1.261372586300035e-01   +1.808534408466692e-01   +2.528623050270501e-02; -1.042624837424079e-02   +9.137598505492928e-02   +1.127008235459663e-01   -1.434239695498926e-02   -9.779994873138158e-02   -1.044870558330662e-01   -3.192216580619789e-01   +2.231205354181191e-01   -2.202880278820983e-01   +8.614422285768905e-02   +1.697920894760486e-01   -3.094053826650758e-01   +1.524929109491185e-02   +2.490952551129321e-01   +4.414868131132317e-02   -8.631126461068062e-04; +1.176040581115021e-01   +1.724720171265484e-02   -2.423370246598269e-01   +4.872874842985307e-01   +5.291246317394042e-02   +1.513038851382162e-01   +4.617591344382237e-02   -1.615513620403934e-01   +2.489346063171934e-01   -4.371697579420033e-01   +2.384606113160418e-01   -1.526302407280805e-01   -4.438540441423047e-01   -8.347947564241368e-02   -2.470950507981299e-01   +2.742362777753448e-01; +3.326345742372745e-02   -2.093490541481544e-01   +2.078885109843501e-01   +8.387827223863618e-02   -3.630116912490704e-02   -2.858214732084655e-01   -1.764450365382549e-02   +2.153045244109759e-02   -2.060455222227799e-02   +1.965948055310127e-03   +2.249437114733785e-01   +2.960539952625316e-01   +1.945448091016454e-01   +1.479473682621578e-01   -1.765300756032982e-01   +3.273499347673373e-01; -1.536014163298804e-01   -2.777358436499078e-01   +8.603029192891189e-02   +5.915594255555299e-02   +2.088456580711461e-01   +1.181191887808981e-01   +1.101316621038161e-01   +7.291530699404175e-02   +1.313149569487012e-01   +4.188224959905030e-01   +1.821397553320515e-01   -8.908812268857647e-03   +2.315429348478136e-01   +2.607448784753978e-01   +1.199111695988780e-01   +2.653704641944308e-01; -1.047038267093753e-01   +2.490922759970047e-01   -1.188025881752105e-01   +1.568294610055065e-02   +4.029551179099253e-01   +5.990797643683394e-02   -2.443763923696746e-01   -1.821147356585102e-01   +1.382697535560587e-01   -3.274316792263470e-01   +3.056049481538117e-01   -1.664650808564180e-02   +2.989248994612540e-01   +6.836906380652732e-02   -2.481427022048572e-01   -5.422149985830843e-02; -1.045910959459860e-01   -5.800978248771686e-02   +1.157886617824179e-01   -3.292702817028118e-01   -5.216970756662613e-02   -1.398626579764033e-01   -2.360553022143740e-01   -6.506564338363746e-02   -9.575107611163453e-02   +1.694418473048892e-01   +8.994492277582393e-02   -1.739966285473807e-01   +7.196819891900438e-02   +1.044467980695249e-01   +1.615300231241205e-01   +3.031612139889739e-01; -1.125104594962006e-01   +3.478838543524918e-02   +3.093199213416323e-02   +2.012352044263515e-01   +9.860157377735466e-02   -7.168520624482974e-02   +3.677701602654747e-02   -6.473934609615781e-02   -3.212763446611582e-01   +3.257623687110393e-02   +1.646741336693669e-01   -1.397891497096695e-01   -2.135044900593149e-01   -2.089289297499262e-01   -2.890275323819497e-01   -4.134957078566814e-01; -1.571506443291115e-01   -6.781818144219637e-02   +4.191099076015775e-01   -1.324427381116309e-01   +1.287582439136691e-01   -2.777229413776232e-01   +2.296126584906168e-02   +2.093102716809176e-01   -8.842585858204535e-03   +2.014600404089035e-01   +3.573085468934680e-01   -2.992629087913410e-01   -2.379765578433905e-02   -1.342808488686901e-01   +3.697185014843609e-01   -2.174903161483641e-01; -2.142048691978849e-01   +1.932139776549427e-02   +1.075820311268997e-01   +1.281328035230263e-01   +1.623479959450380e-02   -2.353926381090805e-01   -8.398184050427515e-02   -1.356989262542889e-01   -8.066601878836285e-02   -2.191778694355004e-01   +2.285363424815279e-03   -3.626873677891520e-01   -1.649901366675846e-01   +2.032604053773118e-01   -4.407146934053824e-01   +3.212578727824306e-01; -5.627152984169771e-01   +8.907964715660559e-02   -1.122801861465788e-01   -2.683420592360130e-01   -6.898306496868054e-03   +2.153302852353102e-01   -7.990643161107619e-02   -1.657049147869375e-01   +1.551381795209184e-01   +7.430983191620798e-03   +1.389197360783089e-01   +2.211048477058092e-02   +1.499001015862412e-01   +9.346364957627207e-02   -1.071226105622011e-02   +2.837064051667563e-01; -5.644771421981860e-02   -1.621599453221956e-01   +2.243250380166285e-01   +2.715482903589758e-01   -9.237698404943363e-02   +3.423680094991001e-01   +8.393211913633453e-02   +3.469715263907130e-01   -1.466332477365987e-01   -1.124255086575519e-01   -3.656215123803432e-02   +9.716027243088683e-02   +1.107829725762810e-01   +1.603449758588741e-01   +4.226644102127104e-02   +2.175363289303383e-01; +2.831889665575692e-02   -1.827806292615383e-01   -7.258558833678615e-02   -3.645255185366816e-01   -5.219483795654214e-02   -4.510887923469162e-02   -1.142942512350076e-01   -1.086079390908539e-01   -1.881740022779088e-02   -8.452134954329941e-03   -3.389256389053588e-03   +2.606518339157852e-01   -1.655584986359425e-01   +3.899045009386591e-02   +1.194647050132496e-01   -1.041890629902928e-01; -3.014008925595902e-01   -6.718257546133377e-02   +1.045271645635310e-01   +3.522657641675710e-01   +3.250716559382480e-01   -3.259501272131030e-01   -6.253389415096930e-01   +4.386129950775930e-01   -1.620753564151252e-01   +5.210689339352466e-02   -2.716215297009381e-01   +2.419654630372940e-01   +1.925479914397449e-01   -5.841066857328066e-02   +7.730086394086177e-02   -1.226192689640569e-02; +2.826868014874021e-02   -1.672439737253813e-01   -4.131633895152351e-01   -2.341419300151761e-01   -1.787576632765797e-01   +2.826393860633662e-02   +3.029238262365981e-01   -5.187774106747850e-02   -3.210971419331787e-01   -1.631533988241748e-01   -4.695201719593310e-02   -1.719084458452915e-01   +2.670282077005665e-01   -1.749864884221153e-01   +1.630082991334384e-01   -1.352586714154391e-01; +4.950338079948338e-02   -4.898049193933370e-02   +1.656538627838118e-01   -1.593617829193082e-01   +1.580915282470925e-01   +1.671996861481834e-01   -3.463371271370552e-02   -1.735234360775583e-01   +1.216501933783001e-01   -1.100105243364647e-01   +2.381004473941130e-01   -2.868105358401518e-01   -1.464668223559124e-02   -1.261074080546924e-01   +1.813019717353000e-01   -1.602048592696901e-01];
L1E_L1I_iGABA_netcon = [+3.274207672926571e-02   +1.291339158654803e-01   -3.619523147163022e-01   +1.654583322103364e-01   +4.351941596899098e-02   +5.889812411765837e-01   -7.090042015980516e-02   -1.394629328462806e-01   +2.283594935533600e-01   +5.015013933749953e-01   +1.584905087663875e-01   -7.881201282200440e-02   -1.113464003359960e-01   -5.160198349596340e-01   -1.206806604665685e-01   -2.201664314827656e-01; -2.579017844412013e-02   -4.130415813627272e-03   -2.879691769541488e-01   +7.408487930649216e-03   -3.767159903057089e-02   +1.415179385169919e-01   -1.207047116337142e-01   +2.016021338845046e-01   +3.622750150493946e-01   -2.528365290163481e-01   +7.033505545264297e-02   -1.134042246466128e-02   +1.068774044113408e-01   +3.886760666313713e-01   -1.720797812287714e-01   -2.819490645921481e-02; -1.037934091205097e-01   +2.451559029865260e-01   +6.872666093312055e-02   -2.987379535230829e-01   +3.958194193129105e-01   -6.134535218312979e-02   -6.992252762152286e-02   +1.822910284545637e-01   +8.653120579328855e-02   +1.736100077947461e-01   +2.256397548012544e-01   +7.936240230148078e-02   +4.366821581990784e-01   -3.462057004033474e-01   +3.494772562942761e-01   -1.670008783682234e-01; -3.236135370714662e-01   -1.861246690079741e-01   -2.590079177947391e-02   +5.188308515350845e-02   -5.669432157413730e-01   -7.071257582055079e-02   +3.706179795952684e-01   +3.545369459317811e-01   -1.385765525421149e-01   -3.627207522715635e-01   -4.003425379926220e-02   +3.227612715520400e-01   +2.513702114431500e-01   +2.851038407791864e-01   -2.266194061764345e-01   -2.101273480037842e-01; -4.550460787636590e-02   -1.732384144762205e-01   -2.579095444256468e-01   -3.361820410586265e-01   +1.158349973564884e-01   -1.028590302032434e-01   +2.020764487633415e-02   -2.984906835659069e-02   -2.851897908633148e-02   +2.066138810647342e-01   +2.826076955270348e-01   -1.081302913663701e-01   -6.970135254316259e-02   -8.966530211972072e-03   +1.887597767118748e-01   +2.051100778445768e-01; +6.628159075057428e-02   +1.016552939547763e-01   -2.530122532349958e-03   -1.614810679911584e-01   +2.719052463489127e-02   +4.357044666084792e-01   -2.610961765660392e-01   -6.052202742300720e-03   -4.143918298814945e-01   +8.537747656493025e-03   +1.447541377548189e-01   -2.075023458829319e-01   -3.916946484095622e-02   -2.795152710306322e-01   -2.437369854401936e-02   +4.150046019093171e-02; -2.252875444069605e-01   -1.287415692679543e-01   -1.058903644842723e-01   +1.635232346281161e-01   -1.139988240992758e-01   +8.669880899793131e-02   +1.117731015944853e-01   -1.999991628686849e-01   +4.257609785066701e-01   +1.233668633740763e-01   -1.454556825705850e-01   +3.128760229049602e-01   -2.632679343853511e-01   -2.300201893827214e-01   +4.169000465489137e-01   +9.182572936394363e-02; -4.312095278433741e-01   +6.241652646048722e-02   +2.765149284609072e-01   -3.357513922373437e-01   -5.554588113970085e-02   -1.332965127138158e-01   -1.706647188646280e-01   +5.783538510402459e-01   +1.220286716985206e-01   -3.396102698335364e-01   +7.700366053458343e-02   +2.285066029405811e-01   -2.429393228351716e-01   +7.983923980328353e-02   +7.592153284289536e-02   -2.744239700781034e-02; -3.090521754867573e-01   -9.690321993793077e-03   -2.436208955549842e-01   +2.600928375698257e-02   +1.966145611010892e-01   +4.326209431762584e-01   +1.118187293684515e-01   +4.028890240852273e-02   -2.022008309753473e-01   +2.994981579131500e-01   -2.733926480074215e-01   -2.773055059577316e-01   +1.756302459573522e-01   +2.221608295526473e-01   -2.980264489188347e-01   +3.102752308986428e-01; +6.107518904677772e-02   -1.917589258412122e-01   -2.410046226388332e-01   -7.475396349354413e-02   +2.347186075185861e-01   +4.096845575380776e-01   -2.450114602965234e-01   -1.513870534403042e-02   -1.048189591306608e-02   -8.185530681819098e-02   -1.810732548235655e-01   +2.735872634388090e-01   +2.764171034028016e-01   -1.284539059221534e-01   -1.403217522445674e-01   +1.213198594296463e-01; -4.839515064505977e-02   -3.584249961178673e-01   +1.461293250626583e-01   +5.254246630252664e-01   +2.936149700571544e-01   -2.901719755208006e-01   -7.019783774288166e-02   -3.159529151326893e-01   -3.286582022206176e-01   -3.339287144475962e-01   +1.191378082816468e-01   +5.233716662751069e-03   +1.931816242154938e-01   +1.555755625456479e-01   -1.785205757912752e-01   +3.518129843766251e-01; +2.990057106243195e-01   +3.077311226714853e-01   -2.306767278303147e-01   +2.755693619904392e-01   +6.822214578346605e-02   +4.160529161009311e-01   -1.250972959805188e-01   +1.632776646812813e-01   +1.059906684094378e-01   +1.798402871299940e-01   +2.669271867953367e-01   -6.196636888634280e-02   +3.651806128394695e-02   -2.770628046950319e-01   +7.177059128156155e-02   -1.622117258186635e-01; +4.075076387386584e-02   +2.225592217027099e-02   +5.621908327348801e-01   -9.685617909199457e-02   -1.291090144657593e-01   +8.122555188988835e-02   -1.700299989365421e-01   +4.173636027995629e-01   -1.093252440345998e-01   -2.848663841629550e-02   +1.885511027395057e-01   +3.536929708744800e-01   +4.786885076184506e-02   -2.975802047586287e-01   -3.703201824090652e-01   -7.660510578479379e-02; +3.856524844795586e-01   +1.302863743762123e-01   -1.747697656275789e-01   -1.319002256223152e-01   +4.390405206506670e-02   -2.007515358646269e-01   -1.982221306717919e-01   -1.996559600333699e-01   +4.058748456453148e-01   +2.696748507204201e-01   -1.508802154255262e-01   -3.457286453698194e-01   +5.774336107587257e-02   +1.781591959831746e-01   -2.541238754277475e-02   -4.323303653746624e-01; +3.482456395921970e-01   -1.587073345405380e-01   -2.893036269134120e-01   +8.136785050390338e-02   -4.063297307074261e-01   +1.712250032210743e-01   +2.538401459694124e-02   -8.686217605242116e-02   -6.621573769253236e-03   -2.897893742489867e-01   -1.122829965334196e-01   -6.674267784220620e-01   -2.067112814783365e-01   +9.025965073514476e-02   -4.996545639705392e-02   -4.170843953674194e-01; -2.487024990315193e-01   -2.140822512926058e-01   -9.278078318718069e-02   +4.078137660812627e-01   -2.503347303859742e-01   -1.879158600636270e-02   +5.503988093976615e-02   +8.497369853896203e-02   +1.631412623619544e-01   +2.570230505005180e-01   -1.374864854006398e-01   +4.148783516716780e-01   -1.571677198873178e-01   -1.009995173689011e-01   +1.888386936422536e-01   -3.828713726237236e-01];
L2I_L1I_iGABA_netcon = [+2.972188622261496e-01   -1.509426942281073e-01   +8.908403847836534e-02   -2.269188535426345e-01   +2.182322587127722e-05   +4.269415277466670e-02   -2.432067264128939e-01   -1.325042967422587e-01; -2.117474412513425e-01   -2.059381009295136e-01   -5.526106997153360e-02   -3.426907929260986e-02   -2.059083048876202e-01   +3.321523716869605e-01   +1.328938030256531e-01   +2.218725378163903e-01; +2.267232203235980e-01   -1.750694722294193e-01   +1.475605699513710e-01   +1.320523998331394e-01   +4.703354474801151e-01   -5.117649401696759e-01   +3.879714389250045e-02   -7.818039825569592e-02; -5.276781719102805e-02   +2.526650123709175e-01   -2.044478208911753e-02   -1.079780507264297e-02   -1.228155321204381e-01   -2.799629953090760e-01   +1.195632027453823e-01   -1.140600473604991e-01; -2.479374167947847e-01   +2.116450572648124e-02   +2.995451065557997e-01   -3.085425191354091e-02   +1.726438007614360e-01   +2.366995384644890e-01   -4.176181823390211e-01   +4.325182113473269e-03; -6.272283255337438e-02   -1.904556091412188e-02   +2.412969606497339e-01   -1.303298423385064e-01   +8.491780155965332e-02   -9.740580318379705e-02   -3.721270419549688e-02   +1.219538327730743e-02; +5.871171557776840e-02   -1.554410525007017e-01   +9.708059755013189e-02   +4.037236984274046e-01   -2.950223918910466e-01   +1.748352173393417e-01   -8.451084873500911e-02   +2.254615059814394e-02; +1.796275938085876e-01   +1.260746070270427e-01   -8.366901251940852e-02   +1.345339270814502e-01   -1.017883615032766e-01   +2.247875470457028e-01   -1.284502195707984e-01   +3.552735285266166e-01; +9.642231810625668e-02   +1.618133537215024e-01   +4.349997306447777e-01   -1.353634024557432e-01   -4.604029632407605e-02   -2.366234013925905e-01   +2.508336480564499e-01   +1.422059029539420e-01; +2.407561804156931e-01   -1.393659386624894e-01   +4.189926435946425e-03   +4.908763106325184e-02   +2.268676975990995e-01   +6.398001052994964e-02   -3.719208787543301e-01   -3.398523795158224e-01; -1.706153024543854e-01   +1.034778671707664e-01   -1.375985317986716e-01   +2.208680424760871e-01   -8.194207041843071e-02   -6.804917849344175e-01   -2.990080642627092e-02   -2.431086554841307e-01; -5.872621226092282e-01   -2.453947604958285e-01   +9.762451081796032e-02   +4.224026534190923e-03   +2.211530164136687e-01   -1.881951916280424e-01   -7.385636288044352e-02   +6.721807584145792e-02; -1.131448613698539e-02   +1.153370368887292e-01   -5.583665532313314e-02   +2.600597020356121e-01   +3.293223934218178e-02   -3.456098611736634e-02   +2.795773672839413e-02   +1.733379654349096e-01; +1.936906774504120e-01   +1.414022658935755e-01   -4.182437276849535e-02   -1.927230807420137e-01   -4.725560122691316e-02   -1.189306530593465e-01   +5.535482513835697e-02   -1.943923664667085e-02; +1.204331078697436e-01   -8.647764930543222e-02   +1.858963574847443e-01   +1.057291375417123e-01   +2.585449360421316e-01   -3.433920362119119e-03   -9.795321242700772e-03   -5.304568780749955e-02; +6.811008826360125e-02   +1.120299188377270e-01   +3.568333119333096e-01   -1.389893554137478e-01   -3.377823796120676e-01   +4.406579313419069e-01   -2.282429081841507e-01   +8.983897768663339e-02];
L1I_L2I_iGABA_netcon = [+6.698389221725844e-02   -2.735669820625940e-01   -1.538259310895221e-02   +1.419614887400902e-01   +1.762446923838437e-01   -3.210784276470923e-01   -1.822305445417887e-01   +8.190725268442017e-02   -1.283271970751975e-01   -1.701992309504498e-01   -9.809157127687779e-02   -3.067917779616275e-01   -6.737585633004017e-02   +4.859307916035985e-02   +8.477696068786186e-02   +1.751216432686123e-02; -4.337427430871491e-01   -1.127165279170137e-01   +3.148086863777034e-01   +1.159519369019972e-01   +2.020856983546117e-01   +4.730601387134152e-02   -2.517702932043627e-01   -1.109634710737511e-01   -3.310166252434937e-01   -2.248364750951266e-02   +3.493793899280623e-01   +2.284921223940736e-01   +1.011743316432825e-01   +1.145397922435669e-01   -1.322538155228765e-01   -8.481319804263587e-03; -8.371062607532698e-02   -1.408970124872089e-01   +1.402974255219569e-01   +1.392771941668973e-01   +2.117010379566435e-01   +8.567451683207947e-02   +3.417410997607147e-01   +1.950941003312463e-02   +7.002621120736377e-02   -3.023839728685619e-01   -5.045214503208506e-01   +1.758870211164995e-01   +2.508441013008750e-02   -1.672387581401906e-01   +3.706885260155944e-01   +9.347140152504536e-02; -3.310537489086954e-03   +1.539201501016546e-02   -1.436458998141449e-01   +5.462644354812109e-02   -6.091597258625039e-02   -3.210997929896935e-01   +2.796898437075386e-01   +4.074883507877172e-03   -1.776267068347128e-01   +3.890620120448149e-03   -6.255778278928845e-02   +1.748729941240843e-01   -1.280065807818703e-01   -8.291851769935599e-02   +7.455682316608317e-02   +2.987337406961341e-01; +1.239560382835320e-02   +2.855753049505414e-01   +3.490530741358955e-02   -2.688050651191060e-01   -2.780983070905442e-01   -3.380444431053166e-01   -4.163716222776420e-01   -1.764057123265668e-02   -6.676473389099305e-02   +4.193107543083439e-02   +4.002222922274423e-01   +2.033181465373409e-01   -7.573124678571332e-03   -8.118273413756172e-02   +1.637834496192770e-01   -2.682393844197714e-01; -1.764770227543078e-01   +4.227553972576329e-01   -1.577914014414258e-01   +3.474745813100349e-02   +2.141275879910767e-01   +2.389553443738902e-01   +3.079449186606484e-01   +1.236557151725009e-01   -3.837291585531918e-02   -2.930339455558120e-02   +1.126293736251115e-01   -2.204663801753166e-02   -3.819123058582892e-02   +9.506141718668026e-02   +2.019815025232864e-01   -1.710612443661969e-01; +4.409558078984266e-01   -1.394978816370312e-01   -2.922068188797546e-01   +2.131417326051085e-01   -2.036135426334286e-01   +1.163095540309853e-01   -1.895983852230979e-01   -7.606551362372099e-02   +3.551104206038639e-01   +2.537015355021544e-01   -9.734970411669652e-02   +2.973806427772160e-02   -4.233531229253065e-01   +1.016628616310055e-01   +2.462621268092651e-01   +2.619637507627158e-01; +2.748502590622788e-02   -1.018516818698525e-01   -2.899776988388043e-01   +8.271958935823884e-02   +3.668361572093055e-01   +1.451261368514830e-01   +1.404062928208100e-02   -2.861812609013023e-02   +2.052531906980712e-01   -7.878194795562836e-02   +1.488200102682675e-01   -2.960298901876356e-01   -4.158729463821028e-01   -1.776769418526870e-01   +1.045007799061470e-01   +8.132941406125915e-02];
L2E_L1E_iAMPA_netcon = [-1.209648537132051e-01   +1.044183580615813e-01   -1.178534131898245e-01   -3.231297194522935e-01   +5.043788810948999e-02   -7.799946902484930e-02   +2.598988674374744e-01   -2.787528514017980e-01; -1.162389912374040e-01   -9.658539034801247e-02   -7.391909760213373e-02   +3.571278688323262e-01   +2.544788047244205e-01   -1.663713807417658e-01   -4.678679981842442e-02   -1.371578596792208e-01; +1.057734847660058e-02   +8.482994221745868e-02   -3.998752244193882e-01   -6.265154675968802e-02   +3.097027612429589e-01   -3.371614740245470e-01   -6.664345112486188e-02   +1.115028664874236e-01; +1.008213610419309e-01   -1.329899388568486e-01   -1.680133872093301e-01   -2.774487718003210e-01   +4.407879664407727e-03   -2.097767072843456e-01   +3.591017594671503e-02   -2.584073269063382e-01; -2.611497299702342e-01   -3.823932400501084e-02   +1.710747608510345e-01   -5.032520159916973e-02   +1.210332858629541e-01   +1.283706647033485e-01   -7.214474847826929e-02   +1.278846320568117e-01; +2.455501318748898e-01   -4.173058361847709e-02   +1.404770871404645e-01   -1.440519487877220e-02   -3.488454117776142e-02   +5.580448522171792e-02   +1.473412571487375e-01   -4.713422835483622e-01; -3.855812545570646e-01   -6.559625636794481e-02   +1.772362815041348e-01   -3.661227394179322e-01   -2.038767823399728e-01   +2.175990232657773e-01   -3.403423165378056e-01   -1.919662533361282e-01; -2.768469154753563e-01   +2.116865242098030e-01   -9.003610827497871e-03   +8.329638802559390e-02   +1.659376630503378e-01   -6.025110544223822e-02   -1.846687021290517e-01   +2.362454723842910e-01; +2.988125708123326e-01   +1.505145209961928e-01   -9.391204162006855e-02   +6.178868069901146e-02   -3.226606571965496e-03   +8.374728182233160e-02   -2.774672725002540e-01   -3.700250099828618e-01; +2.798901728958388e-02   -3.240737380870878e-01   -2.648883111405295e-01   -5.117553533826473e-02   -1.856296807907453e-01   -2.329346450480388e-01   +1.197050555349640e-01   -7.385038821591226e-02; +1.600795945236089e-01   +2.347705194351398e-01   -1.725837366259453e-01   +2.776855557497586e-01   +3.400743197856340e-03   -2.560223931235744e-01   -1.581846790685263e-01   -2.512929414196690e-01; -4.412277839494708e-02   -1.883905076831761e-01   +1.912327044935903e-01   -2.047795310844368e-02   -2.577088586123033e-01   +2.488663829666604e-02   -5.261545199516632e-02   -5.468137838286365e-01; -1.318076144100907e-01   +3.002357751383627e-01   -4.795638648897074e-01   -9.109541880074470e-02   -2.745780639305861e-01   -1.593205305739192e-01   +1.906032730042020e-01   +1.420996842591414e-02; -1.112881464162174e-02   -2.133849708556030e-01   -3.207097350803960e-02   -1.724655808618272e-01   +1.415440295180291e-02   +2.112250671753619e-01   -1.746250958457083e-01   +1.102299747394942e-01; -2.043616580151572e-01   +3.580063441531818e-02   -2.624590277721708e-01   -1.121797127046804e-01   -1.372920618403341e-01   -7.848078023902515e-02   +1.526214683325497e-01   +2.631577006232229e-01; -7.033519856896349e-02   +1.877932949839524e-01   +3.041178008391280e-01   -5.570177013433837e-02   +2.131969667249822e-01   -1.334631175611807e-01   -1.863693434688337e-02   -2.145778416416487e-01];
L1E_L2E_iAMPA_netcon = [-2.470774397335179e-01   +2.024222715612781e-01   +4.853514600981734e-01   -3.886290819735717e-01   +1.347295485443245e-01   -8.411063582773777e-04   +4.307459001179194e-01   -3.891968661459215e-01   -4.539772528471384e-02   -2.931327451834151e-02   -6.781885428526453e-02   +1.250859573573675e-01   +3.475746507124087e-01   +1.343800770889775e-01   -3.310921004744363e-01   +2.801667633750352e-01; -2.311605527741686e-02   +4.211290284178386e-02   +3.621573724177107e-01   -5.445103552954902e-01   -2.441701000141326e-01   +2.148352440579566e-01   -1.762822665157971e-01   +2.829949577661191e-02   +4.542264107814484e-03   -6.561222809689789e-02   -3.489293551939303e-01   +5.062204174792455e-02   -9.749217156239956e-02   -1.058354349900223e-01   +1.623403886730063e-01   -1.499690759815625e-01; +1.542363036933307e-01   +2.316151690712667e-01   +2.861431912486678e-02   +2.192535561896151e-01   -3.217445604491442e-01   -3.420950635304189e-02   +2.372849373849398e-01   +3.765308037352814e-02   +1.682941480099084e-01   -1.142044539919824e-01   +4.333035294223852e-01   +5.123641038153551e-02   -4.089540445562633e-02   -1.145078690894630e-02   -9.404398564101052e-02   -1.031258939851014e-01; +2.641898091465983e-02   +3.026830886711049e-01   -5.785382721031414e-03   +7.940104910153530e-02   +1.587111750453393e-01   -1.600222894516306e-01   -9.410501346222538e-02   +3.690247699802148e-01   +5.164616167316699e-02   -7.020160432832612e-02   -2.044875791392198e-01   -2.847044183002858e-01   +3.645705440979095e-01   -1.471367202979984e-01   -1.819967989236450e-01   +5.537511916626908e-03; -2.513946909164716e-01   -1.556076935487895e-01   -3.955642905521818e-01   +5.403716194708339e-02   +2.375241824200127e-01   +1.768231445277570e-01   -2.071863732272872e-01   -2.005787653476822e-01   +7.977987168073045e-02   -1.153344734308139e-01   -3.675447785377299e-01   -4.662828118099606e-01   +1.778837450340505e-01   +7.369946932748730e-02   -4.810220710067863e-03   +1.281165413483416e-01; +3.352369337521301e-02   -1.279615491395151e-01   +3.466278018854124e-02   +2.375752183445765e-01   -2.362389335651325e-01   +5.065920369856419e-02   -1.950761203579194e-01   +1.420977187012848e-01   +2.505411319297770e-01   -2.806532891833681e-01   -4.294393460448949e-02   -1.230340971501112e-02   -9.819689670861877e-02   -2.754054411722315e-02   +1.524286612947985e-01   -2.393127562375440e-02; -1.370709495737334e-01   +1.780294689809708e-01   +2.342041063075039e-01   +3.500596879074025e-02   -9.808072299361364e-02   -3.116303231993253e-02   +1.151085778335974e-01   -8.495158601392888e-02   -1.285985202417675e-01   -1.622576655559286e-01   -1.069407995516043e-01   -3.072715169204987e-01   -5.083150193392619e-02   -1.703473943007390e-01   -2.022433059716812e-01   -6.089208159989574e-02; +1.976494087961683e-01   -1.604495167732211e-01   -9.321789918527640e-03   +2.710311408840479e-01   +1.392735804301823e-02   +1.968079070591230e-02   +1.753799886511553e-01   +1.239365562930586e-01   +3.782907099274462e-01   +2.348837076648915e-01   -4.605567090424280e-01   -3.455760641231518e-01   +2.298552080082059e-02   -4.794105426081623e-01   -2.199138883943373e-01   -8.331506114252890e-02];
L2I_L2E_iAMPA_netcon = [-2.699875992817287e-02   -1.882932154034294e-01   +2.997364899338614e-01   -2.842789740673282e-01   +4.712674532885799e-02   +4.174490320853963e-01   +1.592868994364388e-01   -5.566849953580530e-02; -1.367817663580006e-01   -6.398815710933856e-02   +2.839280667369242e-01   +2.446152746940440e-01   -6.057049575010594e-02   +2.242816835799963e-01   -9.570274239821594e-02   +1.799891956704568e-01; -4.275152626806052e-02   +1.066661576744865e-01   +1.101089010943459e-01   +1.041971156024708e-01   +8.428269966381670e-02   +1.505921465730852e-01   +6.391884680367145e-02   -1.974767855439098e-01; +4.535519135666314e-01   -4.947592280826843e-02   +4.829239460156005e-02   -7.692663016624468e-02   +6.278681300366813e-04   -1.061168207448323e-01   +1.831018353106491e-01   +3.728651158300435e-02; -1.362324124566273e-01   -1.193302327403076e-01   -2.671636556626632e-01   +5.292726950379625e-02   +5.574303925638918e-02   -2.277980035014068e-01   +2.076707927473291e-01   -1.649573371961910e-01; +3.476824007473932e-02   +1.411084279621181e-01   +2.770816960785611e-01   -1.697213090791597e-02   +1.155267424884856e-01   +1.891581528392658e-02   +1.925741110687730e-01   +6.970433987293261e-02; +3.283349307400828e-01   -3.188238559143461e-02   -1.636203717531721e-01   +2.104381743947004e-01   -1.444127235589303e-01   -3.877559756571567e-01   -1.024105005223366e-01   +1.250630041288146e-01; -1.381926860873074e-02   +5.165547051489298e-02   -2.200734256240854e-01   -4.244146477512167e-01   +1.363877046409852e-01   +1.069747406735751e-01   -1.726947185463415e-01   +1.712887250795888e-01];
L2E_L2I_iGABA_netcon = [+1.979103708650154e-02   +3.214491861762711e-01   +3.756061926568605e-02   +2.016143072218567e-01   -2.913983741180584e-01   -4.613868125198499e-02   -7.861184237726022e-02   +1.509363421121376e-02; +2.781731317039381e-01   -2.051007611249103e-01   +1.668479438973902e-01   -1.305570430384286e-02   +1.186487456892899e-01   +1.199038994914450e-01   +5.277220290691928e-03   +1.229463842599800e-01; -8.538101179642801e-02   -7.609797840103918e-03   -3.897823842756775e-01   -5.013727645089324e-02   -2.115789655151805e-01   -1.714853589019689e-01   -3.774065395355253e-01   -1.379523532433857e-01; -2.393000462290736e-02   +1.279493145659464e-01   +1.218234002538852e-01   +3.000473645584352e-01   -1.196459368844295e-01   +1.005771434847316e-01   +1.806301191178319e-02   +3.873938235237023e-01; +1.658472751872918e-01   -1.142118350020224e-02   +1.372965974019001e-01   -1.837254404408326e-02   -4.117959833924050e-02   +1.063481462641827e-02   +8.855781805653827e-02   -4.201565128112397e-01; +1.040497381908282e-01   -3.142319074473235e-02   +2.303387438221299e-01   -4.216114145692337e-02   -6.364755532997279e-02   +2.358484483411445e-01   -5.050279014579859e-02   -9.033864463480132e-02; +1.059645069938279e-01   +2.608920780162940e-01   +6.535553038845227e-02   +5.869034221333964e-02   -8.655460553153742e-02   -9.442836961699913e-02   -7.707021892494413e-02   -1.039507051244501e-01; -3.002679063745256e-02   -3.076110288715915e-01   -3.065461937971095e-02   -8.145367686506909e-02   -1.561351976323441e-01   -2.760238828411185e-01   -1.246855265583468e-01   +3.638565637919372e-02];
L3E_L2E_iAMPA_netcon = [-2.314010805535373e-01   +2.516525691098284e-01   +3.771950061133182e-02   -7.078180421895994e-02   -2.085554688609985e-01   +3.838182073455064e-01   +8.893413747737688e-02   -4.974100771694412e-04   -2.049617449695711e-01   -4.818626390025213e-02   -3.817042365499469e-01   -3.759077600516986e-01; +9.712039374379999e-02   -2.557525083786477e-02   -7.459477506407100e-02   +2.503686641064648e-01   +1.227985824526981e-02   +6.459464991775554e-02   -1.561073983375835e-01   +1.284217441889501e-01   -2.337685899988435e-01   +1.004342619622044e-01   -1.146892665950199e-01   -3.237080775241391e-01; +2.897786008346520e-01   +7.748358199438377e-02   -1.189458396631163e-01   +1.724489285718842e-01   -9.123159629318424e-02   -2.969333971618289e-01   -2.509203899361261e-01   +4.086170417366619e-01   +3.176626707254396e-01   -2.376309906145464e-01   -2.216405993705705e-01   +9.571141282708440e-02; +1.890040010901730e-01   -1.465756513557911e-02   +1.655253787023759e-02   -2.603550460155538e-01   +8.167369090003873e-03   +3.583363817287745e-01   +2.870690974239121e-01   +2.312076356389449e-01   +4.193127462266859e-02   -2.856749275983788e-01   +3.106719356357237e-01   +2.520216435142322e-02; +2.267079083789100e-01   +1.096341453626824e-01   -2.010088435818569e-02   -1.798018170718348e-01   -2.517664463147109e-01   -9.341860687831272e-02   -1.739489361194712e-01   -1.914147773306754e-01   +5.518214290017370e-02   +5.476300490371293e-02   -1.641894897350247e-01   +5.773070100069050e-02; +5.874838716706217e-02   -1.274676424480094e-02   +1.239944687736964e-01   -2.996220200338459e-02   +3.345550410083989e-01   -1.311779795822298e-01   -1.791954043298241e-01   -1.699176582923881e-01   -1.078469577539355e-01   +6.574480927613140e-02   -1.653610915777092e-01   +2.397746022929378e-02; +1.148641807983286e-01   -1.246619978831923e-01   +8.577563238463340e-02   -1.232522547029795e-01   -1.606084325808799e-01   +8.885870908179877e-02   +2.215899961192747e-01   +3.252364083857835e-02   +1.490248348009804e-02   -1.378938241064432e-01   -3.753369194734930e-02   -8.928654747254203e-02; -6.474605440917883e-02   -1.872075076861797e-01   -8.929311691624831e-02   -8.316428669680741e-02   +3.682574079203023e-02   -4.723248019934288e-02   -1.597123999474684e-01   -2.468380933703758e-01   +7.919516459429926e-03   -1.913746720879534e-01   +1.142113947260670e-01   +1.704666781833055e-01];
L3I_L2I_iGABA_netcon = [+1.508406441276778e-01   +1.113898374913983e-01   -3.112780826594168e-02   +4.668658276223001e-01   +2.066080614475818e-01   -1.574960372775988e-01   -2.229168159709918e-01   +3.451527262476856e-01   +1.577412048575079e-01   -5.378188817690358e-02   -1.192039163861421e-01   -1.222825522992349e-02; -1.573321296216144e-01   -3.555719968284470e-01   +7.614318870434622e-03   -2.541649810957532e-01   +5.160767349162694e-01   -1.075838229133578e-01   +3.563295106528755e-01   +4.602734354443310e-01   -2.376063035313123e-02   -2.826686502770615e-01   +5.981626126549282e-03   -4.859381575533259e-01; +1.925699387576049e-01   -2.107098058194324e-01   -3.802261935637729e-01   +3.792713046521565e-02   +1.476827244950363e-01   -1.850434485376617e-01   -8.847972778641928e-02   +6.682301834960241e-03   -3.062956648297717e-02   +4.412569151559817e-02   +2.571945933815932e-01   +1.698460338064606e-01; -1.455850131380995e-01   +6.339735457074401e-02   +1.789441462344536e-01   +1.838388276078861e-01   -9.679940605656127e-02   -1.680323673979010e-01   +1.395880568513745e-01   +2.040847706149980e-01   -5.266820500666161e-02   +1.713933252075222e-01   -9.618778226248988e-02   +1.241098358583494e-01; -1.390972310251919e-01   -1.823454923254962e-01   -3.291773278893642e-03   -9.226757072062375e-02   -2.702742647545838e-02   +4.300110620090171e-01   -3.259131744561547e-01   -5.606583055043505e-01   +1.527159333771698e-01   -2.670350427144935e-01   -1.216217721186408e-01   +5.543521857931563e-02; -7.189552224466254e-02   +1.080398334600098e-01   +1.635301669528677e-01   -5.748389002349849e-02   -1.624170681554465e-01   -2.705788216007247e-01   +2.285441920838734e-01   +3.563718827868244e-01   -3.436413722506497e-02   -8.464234008534627e-02   +6.013681085313431e-02   +1.071498111961340e-01; -2.071916611881509e-01   -1.128242435948359e-01   +2.094171272624094e-01   -8.990134945237241e-02   +2.265164979658041e-01   +3.647948540403397e-01   +3.070597171829023e-01   +2.403955931066313e-01   -1.300955465630324e-01   -2.696702181446666e-01   -1.573558390810489e-01   +9.469487625072280e-02; +2.869972815238236e-02   +3.965495037422460e-02   -2.759660803431073e-01   -1.886125311484136e-01   +3.361311897377201e-02   -7.219112768388578e-02   +1.671370900017539e-01   -4.735063749532263e-02   -1.327508229423584e-01   +3.492024169330146e-01   +4.729336660739147e-02   +1.972362665824003e-01];
L2E_L3E_iAMPA_netcon = [-2.028479475403123e-01   -1.206676998100751e-01   +9.503530714404615e-03   -6.203433625076415e-02   +1.820845154905686e-01   -3.607754433631128e-01   -7.139059665273796e-02   +2.748622437691752e-01; -1.638853294427093e-01   -6.358246300273666e-02   +2.589488586678933e-01   -1.832755938546912e-01   -2.798448173722053e-01   +2.158709158258920e-01   -2.401853146439712e-01   +1.604373344256673e-01; +4.787887264298694e-02   +7.630600927381452e-02   -1.314701797044117e-01   -1.813402277570529e-01   +3.553144312123085e-03   +1.344056057926922e-02   +1.749598956219714e-01   -4.654365764632420e-02; -4.098816016602103e-01   +5.561662262399951e-01   -2.270226867262793e-01   -1.981874574461676e-01   +2.221045709923697e-01   -1.434950371818135e-01   -2.469880544820102e-01   -1.139449991515764e-01; +1.982943127056846e-01   -1.846563090905300e-02   +1.430300856863372e-01   -1.032267258104104e-01   -1.919381751585382e-01   -1.757010763121583e-01   +5.434905129688706e-02   +3.309546875746422e-01; +4.215315809873506e-02   -2.734128563091193e-01   +7.772772590319416e-02   -2.664116791880919e-01   -1.313120572637272e-02   +1.691797733330814e-01   +2.587181618293171e-01   +1.592636384052778e-01; -1.974469076910563e-01   +4.051445637777851e-01   +1.162616279241549e-01   +2.846996835271398e-01   +2.158258315684468e-01   +2.428498894324821e-01   -2.071243285840407e-01   -1.778492327289107e-01; +3.649500296197354e-02   +4.189164038649993e-01   -3.622208570761634e-01   +4.479462473546136e-02   -3.600882785049192e-03   -1.957381189812766e-01   -1.801962451250440e-01   +2.171952078743558e-01; -3.619806700965963e-01   +1.198176718075061e-01   +3.020283242460958e-01   +2.902146912792555e-01   +5.544947603991409e-02   +9.777932309682977e-03   -1.493266481807108e-01   +1.030141678281108e-01; -2.259867428474769e-01   -4.602783444133063e-03   -3.752898564694902e-01   -3.891824948528433e-01   +1.108308550240214e-01   +2.060416251749304e-01   +4.444278007413049e-01   +4.753944849596173e-02; +2.367573054858637e-01   +1.576259468506768e-01   +8.760430314812012e-02   -3.261557728576561e-01   +1.069902289249147e-01   +1.010926196054314e-01   -3.722055744162600e-02   -2.860816067066879e-01; +6.636317254962093e-02   +1.120073337663675e-01   +1.827943723203880e-01   -4.430357403582893e-01   +1.078641653984325e-01   -7.742542516187891e-02   +1.641251272127826e-01   +2.388438809149403e-02];
L2I_L3I_iGABA_netcon = [+2.236884986675699e-01   -2.287508965535490e-01   +1.799635891491966e-01   +3.642772251731163e-01   -4.767592650329538e-02   -3.462111362031423e-03   +2.634216360770573e-01   +2.950759932525171e-02; +2.006441990184229e-01   -6.232215541872060e-03   +2.493081771994925e-01   +1.445729398692000e-02   +2.450454813084886e-01   +2.788743067686023e-02   -3.463407575868417e-01   -2.697004630874326e-01; +7.050817434364612e-02   +1.582517708007021e-01   +1.016363932308686e-01   +1.597925707025363e-01   +3.476723772760669e-01   +7.256885510075547e-02   -1.247530649864423e-01   -1.941708023310391e-01; +9.299578235404446e-02   +2.495509185273515e-01   -2.216123585105991e-01   +4.103057254423723e-01   -1.850561693346995e-01   +2.494251532675230e-01   +1.324871844826177e-01   +1.417020541211532e-01; -1.934860360500081e-01   -3.490861914924618e-01   +1.072008704300188e-01   +4.489121378871766e-02   +8.922392825866896e-02   +1.729150586109663e-01   -4.102510670120444e-01   +3.385975886711939e-03; -3.388018819564714e-02   +2.208358561498752e-01   -1.680405518505284e-01   +1.217546379186687e-01   +2.259371078343043e-01   -3.627092803639904e-02   -1.604970699739407e-02   +8.566367303386302e-02; +2.718472634767365e-01   +4.110252236921255e-02   -1.668790315792139e-01   -1.416493533651872e-01   -1.096043355271249e-01   +6.968595415112623e-02   -2.336358063458331e-01   +5.079253899742037e-02; -1.487210919672657e-01   -2.396753161737236e-01   +1.466410933770567e-01   +9.813277706998774e-03   -1.998309532859934e-01   -4.793003233211458e-02   +2.728286366733501e-01   +1.170496188855241e-01; -1.646982390926046e-01   +2.694488859662821e-01   +1.248534061322242e-01   +1.719151575703950e-01   +1.820575256246480e-01   -2.025241113629428e-01   -2.385839388160765e-02   +3.362465541350258e-01; -1.981682708160132e-02   +2.121202361232568e-01   +3.585276385018584e-01   -1.954959970738400e-02   -2.095152146400467e-01   +1.262915792520745e-01   -1.140091665746129e-01   +1.004616726159753e-01; -1.431419103071780e-01   -1.686592913693026e-02   +3.365854170606694e-01   -1.700593545147208e-01   -1.325566002316682e-01   +2.046753095563232e-01   -2.728042694512051e-01   -7.710236959043636e-02; +3.515758911503090e-02   -2.777566429806013e-01   -3.097330098952270e-01   +2.274433428766298e-01   +2.899192088673839e-02   -5.699164079301448e-02   -6.865560142738586e-02   -1.536429008407148e-01];
L3I_L3E_iAMPA_netcon = [-3.958039375154904e-01   -2.019949059363830e-01   -1.004536930761738e-01   +2.678883563419067e-01   -2.459113272503800e-02   -1.361684185706746e-01   +1.156760618048836e-01   -2.608561593922188e-01   -2.354407883713086e-01   -6.403394146306243e-02   -1.821280926714883e-02   +1.012470398543971e-01; -1.813414620818791e-01   -3.363782200181560e-01   -1.377830847471341e-01   -8.299403284751936e-02   -8.802015265539848e-02   +1.117488221512964e-01   -3.250658598493124e-01   -5.077497167646385e-02   +8.499514209754012e-02   +6.379099433300871e-02   +5.545106734038918e-02   -2.787853112265414e-03; -2.610847954542878e-01   -1.705095799053913e-01   -1.032036416247773e-01   -5.970831260141050e-02   +7.259450797632580e-02   -2.677563979126831e-01   +7.151709895414160e-02   -2.214010319374038e-02   +1.804806556952459e-01   -2.037280237913153e-01   +1.123292162391418e-01   -1.665658829683367e-01; -2.363606120840505e-01   +3.465942236696258e-01   -9.885899150391175e-02   -1.373745418691076e-01   -9.069932062718824e-03   +1.819250059647089e-01   -2.139445543021976e-01   -7.506456446291783e-02   -5.421514290014914e-01   +1.088563585851978e-01   +2.624910138829154e-01   +1.048446100789129e-01; -1.336876463731388e-01   -2.202104385439735e-01   +2.449982206448442e-02   +4.200612549765614e-01   -1.704891887039971e-01   +1.885280955147604e-01   +2.040771108484466e-01   -1.504952302302404e-02   -2.761999202641643e-02   -9.251780024011363e-02   +8.871670295278315e-02   -2.137280660432422e-01; -2.990037650245206e-01   +6.729791885192041e-02   +3.139809459438749e-02   +1.319196092081773e-01   +5.545707743618952e-01   -9.322267473275650e-02   +2.064213262452145e-01   +2.866911474457189e-02   -6.946821253507601e-02   -1.751016703980026e-01   -5.401558117756136e-01   -7.364985054580453e-02; +2.070642335987821e-02   +8.670597575574077e-02   +2.058953011651414e-01   -1.061440200124131e-01   +3.471818692787178e-02   +1.219318579724553e-01   -1.592822955328026e-01   +5.675157911206510e-02   -7.642373593352082e-02   -8.659545322031270e-02   +3.679802336096188e-01   +5.570514645002832e-02; +4.951777318521792e-01   -4.474879823644722e-02   +1.757163854304978e-01   +1.705667183404098e-01   -1.470915299767617e-02   +7.004748316287207e-02   -4.309212940391963e-01   +5.834822758840433e-02   -3.964383906708148e-01   +2.903035384330513e-01   +8.901405647126659e-03   +2.262446959154087e-01; +5.118154071557546e-02   +3.865081062033201e-01   -3.285816727984892e-02   +5.267277524399162e-02   +3.962394067767179e-02   -5.362200349350993e-02   -1.116702839491399e-01   +1.919877922401380e-01   +3.224880951168902e-01   +1.883955190388791e-01   -2.407787660993361e-01   -3.029918611025954e-01; +2.605409508289263e-01   -2.929260090412039e-02   +2.877409879882742e-01   -1.118890155338251e-01   -8.677599952392354e-02   -1.350642918393438e-01   +1.383753906325282e-01   -3.866401093834246e-01   -1.193916864457735e-01   -8.533587742733473e-02   +4.291037532887745e-03   -2.469810347888175e-01; -2.011866090790933e-02   +2.626213268082536e-01   -5.290112711023946e-02   +2.455709146888191e-01   -1.139526576438205e-01   -4.367494285586003e-02   +1.869915734536911e-01   -9.731092654861453e-03   -4.201311167343437e-01   +2.531479932205834e-01   -1.816838117520064e-01   +6.978262882671279e-02; -8.918931535289620e-02   -1.553403403295184e-01   +1.412397658243297e-01   -4.934463115977150e-02   -8.264218392141444e-02   +1.882269791702444e-01   +1.845341539967309e-01   -2.024562065597172e-01   +9.605149428326669e-02   +2.718230107915605e-01   -4.372213295986108e-02   -1.954544039925165e-01];
L3E_L3I_iGABA_netcon = [+4.130360263577668e-01   -3.124524900799543e-01   +3.137291361435424e-01   -2.534781187544077e-02   +2.795357240583091e-01   +1.066597945654805e-01   -1.003639336085116e-02   +3.420124030558993e-01   +1.652518977988937e-02   -1.156507374680837e-01   -9.191109022220047e-02   -2.314827137154317e-01; -2.708418656421154e-01   -2.683507007207182e-01   -1.213723388378215e-01   +9.129455752296675e-02   -2.379153975499502e-01   -5.470394617469514e-02   +1.355275732502595e-01   -6.182693412597054e-02   +5.394852482239461e-01   -1.472347795863749e-01   +1.145278456308887e-01   -1.470532135934015e-01; -2.759302200402262e-01   -1.338050901892315e-01   -2.538214952123304e-01   -1.848031483565026e-01   +1.328580678821163e-01   +2.578471785738267e-01   -6.470112512517084e-02   +1.518426215363857e-01   -2.300152423482871e-01   +2.456444027732312e-03   -4.572886246798495e-02   +2.516730015847403e-01; -1.582032576684116e-01   -2.570643749521601e-01   -1.197529711194276e-01   -7.402164020808735e-02   +2.906870742672545e-01   -6.450401944833029e-02   -1.999200064079074e-01   -9.164589422349748e-02   -1.484303903532193e-01   -1.964129558710723e-01   +1.534216697082760e-01   -3.198292539145348e-01; +2.191064980780263e-01   +6.202733771123636e-01   +3.091841358787563e-01   +2.041249207861136e-01   -1.631621905602531e-01   -1.447932406907321e-01   -1.151529965940512e-01   -3.911853627259037e-01   +2.957369146891610e-01   -2.060299252803566e-01   +7.617678719940114e-02   +5.932103801593716e-03; -2.449981404431899e-01   +1.118519308168048e-01   +1.300008468979827e-01   +1.384798563266145e-01   -1.691386029656224e-01   +2.227228037748185e-01   -7.826484601901068e-02   +4.339620026418189e-02   +9.592841693609216e-02   +5.082206149459886e-01   +3.875143223870752e-01   +4.667020161625625e-01; -1.401988844992023e-01   +2.046493991856019e-01   -6.402387972021699e-02   -4.527208357918151e-03   +3.347734899708125e-01   -1.143204536030226e-01   -4.640754227923779e-02   +2.087753579978810e-01   -4.103341773435114e-01   -2.907722877800248e-01   +4.247387848909019e-02   +6.624129877224760e-02; -1.591719970434438e-01   -9.822697612345926e-02   -8.331702558914400e-02   -1.818016688662339e-01   -2.221993762861832e-01   +3.391801913871785e-01   +4.584178600810074e-02   +2.340097498848682e-01   -2.748787255009715e-01   +2.821135640004249e-01   -1.942172778524249e-01   -3.998662866481554e-01; +3.084625715200022e-01   +2.709516301549975e-01   -1.199960605890543e-01   -1.700805215848066e-01   -5.085383163903971e-01   +5.359228703933611e-02   +1.492334300749655e-01   -5.192932535581184e-03   +8.324955640461780e-02   -4.521236248415327e-01   -2.610164652864789e-01   +4.766789416234521e-02; +4.046092766637540e-01   -2.671186928940061e-01   -2.881389242265969e-03   +4.197941042875833e-01   -8.121630904913467e-02   -2.100942960235191e-02   -2.049043291369771e-01   -1.670880690022589e-02   -3.142985286784282e-01   +1.642669803250024e-01   +1.621651082615110e-01   +3.963340165464344e-01; -2.592024387213908e-01   +2.178126490818842e-01   +1.725265855485482e-01   -3.310612265102983e-01   -1.236138057824978e-01   +2.026049319588389e-01   -2.964596014809500e-01   -4.764875788858342e-03   -8.609975019815214e-02   +7.073043585522162e-02   -1.207105605695024e-01   +9.506577635975320e-02; +4.718964141473571e-01   +6.688527289232027e-03   -3.890437955234652e-03   +4.485279617857429e-01   +4.107145489714369e-02   -1.521281793678123e-01   -2.844598751962979e-01   +5.116595101124223e-01   -5.136553337104451e-02   +4.293046957384450e-02   +3.213361034820187e-01   -2.139726942731114e-01];
L2E_Input1_iAMPA_netcon = [-3.344254197885866e-01   +2.075038202314352e-01   -2.322548053142409e-02   +6.706185330041424e-02   +3.723712400279478e-02   +1.280942523097335e-01   -1.168111459312517e-01   +3.547796212071432e-01];
L2I_Input2_iAMPA_netcon = [-1.881636698823425e-01   -7.730389871604035e-02   -1.738441686670456e-01   +1.032450833206349e-01   -2.057939628474421e-01   -7.216003487900538e-02   +8.020654935185356e-02   +1.439222429739791e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
