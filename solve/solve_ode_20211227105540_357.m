function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.448126692139608e-01   +2.148919268501636e-01   -2.099313937402328e-01   +9.316024883344785e-02   -1.173609291616753e-01   +2.591573081299476e-01   -1.158637029214497e-01   -1.133939107351378e-01   +3.239334500968631e-01   +6.951322752202385e-02   +2.061080287370197e-01   +1.229221566072858e-01   +1.673157913790360e-01   +2.908512720945303e-01   +2.428872352028663e-02   +2.825106429265646e-01; +1.346171288889484e-01   +2.540105152733941e-01   +3.414963134234774e-01   +2.332732986896478e-01   -1.165280542201012e-01   -7.050058364531238e-02   -3.034222597943039e-01   -2.940805251899442e-02   -1.149826287272455e-01   -2.443371089538592e-01   +9.756935672313685e-03   -3.944429092963933e-01   -5.899133855894674e-02   +1.517868610830033e-01   +2.967091916493509e-01   -1.955011628766147e-01; +2.922786691764492e-01   +3.464163623685068e-01   -1.367045665772698e-01   +2.145471778456876e-01   +9.696457112807659e-02   +1.224072597144948e-01   +3.045541041991450e-01   -2.072178210104911e-01   +3.749573727517767e-02   -4.665547717214145e-01   -2.276969065119305e-02   +1.269672976004059e-01   -2.365382114717716e-01   -5.998576933627055e-02   +9.130402529025088e-02   +1.070260901430046e-01; -1.549448913106353e-01   -1.309332909238345e-01   -4.185754268556521e-02   -1.231292526456837e-01   +1.579527948596956e-01   +2.047734686004657e-01   +1.392736885955708e-01   +1.647946393548080e-01   -2.735263671173934e-01   +2.182568487530832e-01   +2.492502127474340e-02   +1.194949058719901e-01   -2.445705281008526e-01   -1.231051915878486e-01   +2.492594177920451e-01   +2.179846644101459e-01; +6.449026477849393e-02   +3.957622144952329e-02   -1.726077617054714e-02   +2.293056874187034e-01   +3.874013724837729e-01   -2.460814398994826e-01   -4.305518819385964e-02   +4.536864079131183e-01   +3.613805444974980e-01   +2.154047549135839e-01   -1.494138576425547e-01   +5.753201667209010e-01   -1.294297983780215e-02   +2.372202126587929e-01   +1.459614231703498e-01   +5.420970423432092e-01; +1.269196869436440e-01   +2.304974193436066e-01   -3.839842586128629e-01   -1.323158185123365e-01   +1.510497666818961e-01   -4.151065434129830e-01   -2.503430140371756e-01   +2.299669883840133e-01   +3.820063408920850e-02   +1.800118183436420e-01   -2.515408290272900e-02   -2.285400214287029e-01   -3.794681166512359e-02   +9.924739646461846e-02   -2.755853672757245e-01   -7.142222347443009e-03; +3.511386766811642e-01   -4.095528959706116e-02   -2.445186801851800e-01   -3.857293975197119e-01   -2.945985412310427e-01   -2.936949207738307e-03   -3.094553254808361e-01   +9.830249109456067e-02   +6.204177173288481e-02   -1.994983848889199e-01   -2.830765972312005e-01   +1.395368916155268e-01   +3.758258126482328e-01   +2.963493297501728e-01   +2.081324166911045e-01   +1.721987685784424e-01; +1.424894746134476e-01   -9.668133353197327e-02   +1.954771584778727e-01   +3.617451449971110e-02   -1.593479333267766e-01   +2.536186458035522e-02   -8.796279491045497e-02   -9.901708358428474e-02   -1.038884001663780e-01   +3.074961871263569e-02   +5.509586343063677e-01   +2.826033587421298e-01   -1.019588232556639e-01   +3.367081714176210e-01   -3.381503237184783e-02   -4.634514913252281e-01; -1.009170115420587e-01   -1.033804536129970e-01   -3.110203378692909e-01   -3.254142823290159e-01   -6.233950404360088e-02   -9.219510765738356e-02   +1.636686386284993e-01   -1.852604730198457e-01   +1.721442958520440e-02   -1.314323503817960e-02   +4.234128373815725e-01   -2.146799266709751e-01   +1.701439316636219e-02   -2.193099395213347e-01   -2.628619056254679e-02   -1.693949373801039e-01; -2.956354501834610e-01   -2.888146936819053e-01   -1.672989720817899e-01   -5.844528422935032e-02   +5.623540712826114e-03   +2.303045414056661e-01   +4.978267908689824e-01   -4.422387202925706e-01   -4.980411343266637e-01   +1.975679905649227e-01   -3.110517663375895e-01   +2.941479762150584e-01   -3.922051895349088e-01   -7.288179898255426e-02   -2.374642222060955e-01   +2.733226977564520e-01; -2.568513561112211e-01   -1.550347182492353e-01   +1.234740108511714e-02   -2.879254688356032e-01   +2.596040507183150e-01   -2.667346046039215e-01   +1.898970662317739e-01   +2.557178409786004e-01   +2.519916068450762e-02   -3.544932386055929e-01   -9.132982833160602e-02   +7.081666868380738e-03   -3.593726523202612e-03   +2.844284501327496e-02   +1.943748855916781e-01   +1.576775362396080e-01; -3.403715110120480e-02   -1.996778499758631e-02   -2.309716713001858e-02   -3.272082098723086e-02   -7.654787643787973e-02   +1.640241978239004e-01   -4.559165710774177e-02   -3.539122450288042e-03   +2.343392775752716e-01   -9.700103586848129e-02   +1.311506999096189e-01   +2.553736407920094e-01   +3.742291208045628e-01   +1.376990138684176e-01   -3.685698905725467e-01   -1.258623660231499e-01; -1.451768590848327e-01   -3.365819199635646e-01   +4.308207046099452e-02   -8.464742150511539e-02   -2.053391241958699e-01   +2.905115964798816e-01   +9.819672251079115e-02   -2.388492852861737e-01   -3.808272426702050e-02   -3.896199785772274e-01   -2.099633821607308e-01   +1.485539937826954e-01   -2.827711878346209e-01   -1.330332526153247e-01   +5.694740396794766e-02   -1.532727577947642e-01; -9.536738396395845e-02   -5.019856533306960e-02   +6.234619124216290e-02   +4.772101879075595e-01   -2.958440852635175e-02   -3.539083082247645e-02   -3.392505935902732e-01   +1.005092872020831e-01   -4.173738844645789e-01   +2.012653625314913e-01   -2.552506458265080e-02   +1.755085182271539e-01   +1.466765435467456e-01   -2.315443405424575e-01   +6.189312902841851e-02   +5.083507296867135e-02; +2.822763490293797e-01   -2.248958469223351e-01   -1.850121496270082e-01   +7.885001823012301e-02   +2.972395167450613e-02   +6.617349405238901e-02   +3.085779641937957e-01   -1.800923592514887e-01   +9.918804450228050e-02   +1.046993317285781e-01   +2.760014688789339e-01   +3.766749502712193e-01   +3.909578350532572e-01   +5.345967377008190e-02   +8.201074024226723e-02   -3.010865849434978e-01; +4.146058968935485e-01   +3.843040384865709e-01   +1.097480056640727e-01   -1.151627890103804e-01   +1.989353129444302e-01   -3.135877527078363e-01   -2.178302548567898e-01   -1.545789159546070e-01   -7.207630418015273e-02   -7.348987427413084e-02   +1.991042432749008e-01   -6.442826852602138e-02   -9.097689012260712e-02   -4.439130541688426e-02   +3.107121069431081e-01   -3.275922150248577e-01];
L1E_L1I_iGABA_netcon = [-2.541690019817648e-01   +5.966008243662737e-02   -1.719025602569147e-01   +5.196647333283190e-02   +4.650978012929640e-01   +3.960813257343292e-01   +5.786426257115218e-02   -4.543174793624878e-01   +1.799838156314635e-02   +3.364541135690159e-01   -6.890747072405225e-02   -2.088611860541633e-01   -1.746837719124443e-01   -5.661829008224208e-02   -4.204773669195702e-01   -2.353835784795429e-01; +1.287852125437572e-01   +4.019132501685604e-01   -1.362858590105952e-01   +3.314618316241077e-01   +1.089380482523691e-01   -1.485993043117147e-01   -1.265905955418095e-01   -6.867640376164422e-02   +2.514948760505432e-01   -2.219403912080485e-01   -6.419460579284381e-02   +2.431891327932046e-01   +5.374632643651248e-02   +2.534525302842926e-01   -1.630340350933448e-01   +1.679035346768661e-02; -8.109405365657395e-02   -1.943820214317564e-01   -2.193179634150206e-02   -1.331069590233264e-01   +1.977185653884275e-01   -7.674564791081037e-02   +6.519593364218181e-02   +2.548766932520373e-01   +1.341735711133757e-01   -1.793284135636084e-01   +7.625604013161302e-02   +8.893581229907765e-02   -1.231867189282053e-01   -3.534881374078144e-02   +5.534753269063316e-02   +1.539220673354350e-01; -6.948304202704372e-02   -1.468064638156844e-01   +2.067220059145206e-01   -3.361885739345624e-01   -3.168557728268861e-01   +9.876842339108172e-02   +2.996605262012508e-01   -3.878567553560866e-01   -3.879176907173039e-02   -3.389382835168623e-01   +1.514322247859422e-01   +3.687454802509658e-01   -2.461516774896059e-01   +9.954524989986570e-02   -1.315458828368583e-01   -5.051474506023725e-01; -1.897524980541284e-02   -2.962299741710792e-02   +3.519617512040570e-01   +5.297513934525502e-03   +1.798042427384197e-01   -2.386313776449518e-02   +8.676114536346924e-02   -2.499735435824536e-01   -2.552579848388823e-02   +1.281343420363310e-01   -2.101839223444331e-01   -2.314202811989076e-02   -1.158034551681115e-01   +1.455914368552556e-01   +9.257148096413365e-02   -4.081073244165795e-01; +2.146766289230610e-01   +1.413460648938236e-01   +1.564178755354393e-01   +7.738735731362226e-02   +3.063814114743223e-01   +2.745608328301991e-01   -2.352533251613182e-01   +8.809756834849017e-02   -2.200035632453698e-01   +3.654000326175562e-01   -8.634232826230052e-02   -2.367778447752946e-01   +6.890359555866432e-02   -4.749980076936655e-02   +6.213285862715028e-02   -3.138653595515182e-01; -3.700043838132026e-01   +3.892618826700454e-01   +1.300020989470331e-01   -1.076089341060761e-01   -3.872920219676979e-01   -3.050521590467862e-01   -2.891246675558665e-02   +2.713377232824276e-01   +3.332875836283714e-01   -1.011793867392515e-01   -2.617227371446452e-01   -1.591125949515743e-01   +6.106298842533370e-02   -5.175168434222657e-01   +2.018425152428338e-01   +3.251394306598910e-01; +6.086602810665916e-02   +6.197784507279348e-03   -3.173557082943206e-01   +1.904438755756838e-01   +4.149880971130607e-01   -6.507762899995320e-02   -1.752180570374808e-01   +3.304621980242307e-01   +1.704395925558538e-01   -1.407468766430486e-02   -2.299064820438859e-01   +7.724656606406814e-02   -4.864182554839393e-01   +1.974240152121572e-01   +2.053119107564068e-01   +4.533438127337730e-02; +3.106157914837837e-01   -1.695076928359246e-01   +2.943228071827800e-01   +3.385712632639751e-02   -1.665269144755978e-01   +4.259379274908829e-01   -3.168213230325326e-01   -8.102418626626304e-02   -1.206922508883423e-01   +4.993345031753768e-02   -3.850165465999997e-01   -2.113037978036343e-01   -5.955122866883997e-02   -2.347091670454512e-01   +6.516778069491611e-02   -8.129046844413595e-03; +5.708985358900407e-02   -2.538712741963572e-01   +2.205482034200398e-01   -2.801141207737560e-01   +2.439071230116757e-01   +3.810502545596381e-01   +2.101206844918834e-01   -2.687195781844807e-01   -6.078088752330812e-01   -1.677268577400342e-01   -2.525980108000090e-01   +5.234611722540317e-01   +3.448831935594449e-02   +2.616240016140008e-01   +1.109560402482435e-01   +3.071443248232225e-01; -3.825819532951727e-02   -2.370632884397967e-01   -2.488558563591410e-01   +4.472066130193896e-01   +1.115787010762789e-02   +3.581708539507106e-01   +2.900461405483165e-01   +1.838812029158376e-02   -6.021283093459392e-02   -2.731468748952295e-01   -6.055599657706926e-02   -5.991760510289035e-02   +2.680341761156453e-01   -1.169211033095869e-01   -3.003268157923880e-02   +2.715732805604948e-02; -2.331518244239920e-01   +2.122569750732585e-01   +2.105434533987602e-01   -4.127351635834189e-02   -1.593698714804948e-01   -1.482947635269891e-01   -9.830288453746147e-02   +1.691884772316259e-01   +2.203102425308506e-01   +2.331838771769079e-02   +1.647368203161697e-01   +2.108641700855838e-01   +5.335051409840147e-02   -2.627934503371895e-01   -5.833933442555778e-02   -5.333060267993865e-02; -2.572829179308529e-01   -2.903746140234856e-01   +8.748357973043597e-02   -2.083619609067126e-01   -2.667208799341501e-01   +8.876101365189415e-02   +8.222263669049979e-03   +1.663701057537138e-01   +1.487867189538429e-01   -2.379011385481419e-02   -2.095009237238492e-01   +1.863315188650702e-01   -1.205440474896961e-01   -3.705881478732352e-02   +1.678396393444242e-01   +8.056688443552595e-02; -8.134657209651178e-02   +2.213206305972880e-01   +4.888562901293808e-02   -1.698600996204121e-01   +1.288701157698897e-01   -3.641845865397714e-01   +2.583542168882668e-01   -2.464500213472381e-01   -3.117401646591583e-02   +4.445630781303275e-02   -2.317420281951746e-01   -8.766537115760538e-02   -2.479150036785047e-02   -2.028036304671516e-01   +1.439972733550787e-03   -1.493058618863256e-01; +3.473089065739411e-01   -1.139305967622586e-01   -1.064539322871278e-01   +1.922674602180813e-01   +1.218842231314038e-02   -2.937067672565369e-01   +1.371888626534853e-01   -2.987300788446767e-01   -1.583081415142811e-01   -1.645035716175285e-01   -7.626924233988258e-02   -3.051864465388950e-01   +8.056047901511654e-02   +5.590321521347219e-01   -2.908450590509037e-01   +1.898624372773132e-01; -3.065717174077387e-01   -2.035056147623948e-01   +1.990327231875968e-01   +1.733578481251161e-01   -2.283718979508828e-01   -1.587722035768667e-01   -2.493247645791441e-02   -2.044183194436192e-01   -4.487794861386395e-01   -1.263072664901223e-02   -6.564001352680082e-02   +2.763885330626837e-01   +2.229490019319355e-01   +5.060491544362149e-02   -3.927282404669991e-01   +8.783459044919979e-02];
L2I_L1I_iGABA_netcon = [-1.326076736502908e-01   +1.198115263247845e-01   +6.528406918125773e-02   -4.891188491075624e-01   -7.514280959899053e-02   -2.678837689678560e-01   -1.634776501357313e-01   -3.640513659430560e-01; -5.436554971928030e-02   +1.480718154444123e-01   +3.530381051403783e-03   +1.894441214866358e-01   -4.236047174737165e-01   -4.251488609613246e-03   -8.428324323643516e-03   +3.606489680899823e-01; -1.921075457625332e-01   -3.940632600107125e-01   -1.691455321495189e-01   -3.954823357209865e-01   +4.111731014520055e-01   -8.040882590111331e-02   -2.021988887954286e-01   +1.185195948946305e-01; +1.649457589000608e-01   +3.381487666849753e-02   -2.032194347404828e-02   +4.466678239421902e-01   -1.730843038434018e-01   +1.221003977867890e-02   +3.604966059220353e-01   -6.860939042342401e-02; +1.171987239731194e-01   -2.904170508295062e-01   -3.486916700482467e-02   +7.240367079038962e-02   -2.674365163122869e-02   +2.091045853061732e-01   -5.963946498749229e-02   -2.992397263540379e-01; +1.681705702491410e-01   -9.615328558795888e-02   -4.117173878260800e-01   -3.945142957667385e-01   -9.919653497690070e-02   -3.335535591691305e-01   +2.454531133888359e-01   -2.701922184705229e-01; +2.933775160534992e-01   +2.013868806551993e-01   -2.791092835937894e-01   +1.863838243851066e-01   +1.763949384410573e-01   -1.565598213108224e-02   -2.077924594835577e-01   +5.556159213880681e-02; +1.143609457942053e-01   +2.553895565626338e-01   -7.994497476336671e-02   -1.120845895552836e-02   -1.612554871401277e-01   +2.200417405774626e-01   -1.891513013201873e-01   -1.817936083817352e-01; +7.981427201618230e-02   +8.235649559361033e-02   +5.382282746156405e-02   -4.141737553364044e-01   -3.351195036424518e-01   +6.481141899827592e-02   +8.390508241665878e-02   -2.471920670225102e-01; +2.352217385165943e-01   +1.762816926711901e-02   -1.253353700237894e-01   +2.941675284735695e-01   +1.112628023369062e-01   -1.305918343089405e-01   -2.580233505351374e-01   -1.272176616882344e-01; +3.020123831004015e-01   +3.934743506690853e-02   +2.167118605832563e-02   +5.244737262417992e-01   +6.371547378091649e-02   -6.079827791265360e-01   -7.404192711858815e-02   -1.783317448939822e-01; -3.126218765779611e-01   -2.668549789037218e-01   +1.066430183512006e-01   -4.750630612286605e-02   -1.396405399183278e-01   +1.393937580993649e-01   -6.073978462776156e-02   +2.477951770279612e-01; +4.310239156560218e-01   -2.524005665452158e-01   -2.491606532892160e-01   -1.989068774416499e-01   +2.016598424860216e-01   +2.790930815132318e-01   -2.869999327740911e-01   -2.043412321714775e-01; +1.189115865677986e-01   +1.631601674825373e-01   -1.492616796577788e-01   -1.329302155604820e-02   -3.291737907392862e-04   -4.368143333814962e-01   +8.979561931923626e-02   -6.576162864052443e-02; +3.055308483917910e-01   -2.364887180277150e-01   -1.641037862564187e-01   +3.082539831359896e-01   -1.674523343980661e-01   +9.693760366914916e-02   +1.648045382263908e-01   +3.730509922593548e-01; +3.781659045194411e-01   -8.669442216618481e-02   +7.956901766360526e-02   +2.896680046898295e-01   -1.420897958557293e-03   +2.685616516268922e-01   +2.692430262250889e-01   -4.497666038919439e-01];
L1I_L2I_iGABA_netcon = [+1.094974884986289e-01   +1.879016869910098e-01   +3.520046351155355e-01   -8.936980397624278e-02   -1.159471395956951e-01   +2.646428141831128e-01   +4.237664132538948e-01   +9.419614975699458e-02   -3.230969612754277e-01   -1.018712508071680e-01   -2.980251317263377e-01   +2.569702135186555e-01   +1.814456736789828e-01   +3.062109210630742e-02   -4.019654789936853e-01   -1.917243141068731e-01; -2.834183497037875e-01   +1.353526495526678e-01   +1.994837986342270e-01   +4.166993522536712e-01   +3.618403717177620e-01   +2.092001928004924e-01   +3.191413213477761e-02   +1.329313605979877e-02   -1.807783744391442e-01   -9.347224681857710e-03   +2.168542629808539e-01   +4.032331093617206e-02   -1.370164169511427e-01   -2.470580723688100e-01   -1.893924489212737e-01   -8.026268768497127e-02; -2.912960810861337e-01   -2.056009656391247e-01   +1.485788907261140e-01   -2.970212972878520e-01   -1.276361102396123e-03   -4.977999864965601e-01   -2.656775236583912e-02   +5.642964427907413e-02   +1.224063187839062e-01   -2.943376607390864e-01   -3.169870991520439e-01   -1.310600281795171e-01   -2.151088729768457e-02   -3.551895107771188e-01   +2.893305266500038e-01   -1.550606694157544e-01; -7.110832359085202e-02   -8.468295381985232e-02   +3.835758017714028e-01   -7.055222507745199e-02   +1.211961734840493e-01   -3.004582004942655e-01   +1.841768379748968e-01   +2.693025240940105e-01   +1.244858406461732e-02   -9.896438942303180e-02   -2.360989009471214e-01   +1.162185229466386e-01   +5.197784093521172e-02   -2.617718292820411e-01   +3.089173363504719e-01   -1.092667495550690e-01; +9.705221488843038e-02   -1.086420333130077e-01   -1.625925340254454e-01   +3.936787009085343e-01   -4.053074112642426e-01   +9.606586935886346e-02   -1.056696459774336e-01   +8.185301523160071e-02   -1.945989902271860e-01   -1.152122650467449e-01   +3.847732937455834e-01   -1.877744891137565e-01   +1.322974192632648e-02   +3.162080489759508e-01   -7.130502237745004e-02   +3.195095879609158e-01; +2.587114457448202e-01   -1.059904827948789e-01   -4.717014886282098e-03   -3.083427053463962e-01   +5.893789533297527e-02   +6.950498595290812e-02   -1.947037196461994e-01   +2.754759329325161e-01   +4.069079704826377e-01   +4.138862604107887e-02   +3.061522656779802e-01   +6.946837849605274e-02   -2.940549916036373e-02   -2.301788179353507e-02   -1.967235477049169e-01   -1.769908453117149e-01; +2.235828634390538e-01   +2.804863338107529e-01   +2.178477628274279e-01   -1.374112362656630e-02   -1.699480290438023e-01   -2.109503889253350e-01   -2.166827271617068e-01   +6.527258090784888e-02   +1.483025170693856e-01   +1.242047355369411e-01   +2.429117357355354e-01   -2.278271676512657e-01   -3.031911643080977e-01   -4.480816752943040e-02   -7.508099479452268e-02   -3.635951897561837e-01; +2.393022851100064e-01   +3.408249961783428e-01   +2.498009296559908e-01   -8.060590053685987e-02   +3.397851878780689e-01   -2.335081378991375e-01   +6.617451213278579e-03   +4.264842152670381e-01   +2.634569911416071e-02   +1.159797565662694e-01   -5.912649304503806e-02   -1.271727806911331e-01   -2.030448284906116e-02   +3.675599208722961e-01   +6.149149488237846e-02   +1.983614765336018e-01];
L2E_L1E_iAMPA_netcon = [-6.147719440208259e-02   +1.771585011440932e-01   -1.965880504357515e-01   -1.707394809958097e-01   +5.366177045390631e-02   +2.783776165577794e-01   +3.517311184326506e-01   -2.517326595360493e-01; -1.102487448627906e-02   +5.927431887960827e-03   -4.237528917790773e-01   +1.992229003036309e-01   -1.442562868456645e-01   +9.531900640793997e-03   +2.632039253942831e-01   +1.967845412059195e-01; -2.629305641250913e-01   +6.007394364806298e-02   +1.654284458962357e-02   -2.648586156894867e-02   +2.834272246740672e-01   -2.483009937307289e-01   +2.105018526334806e-01   -1.225393303580865e-01; +7.084659376215995e-02   +1.383642050327689e-01   +2.985604801705321e-01   -1.988769130061656e-01   +2.277401005645285e-02   -3.142022560381635e-01   -3.381897708112613e-02   -1.846962250440662e-01; +2.850531415172897e-01   +1.613039478733630e-01   -2.004698568340271e-01   +6.896035464317170e-02   -1.943426212030749e-01   -2.148046068842893e-01   +1.395961242160731e-01   -3.298260348986955e-02; -2.731953875773840e-01   +1.711021113791173e-01   -2.520860902746794e-02   -8.086967026681208e-02   -1.624014041548370e-02   +4.285705543088680e-01   +1.251701869077922e-01   -3.630141663064849e-01; +3.327631367278464e-01   +2.262800375579630e-01   -5.130950310571369e-03   +1.025638032333219e-01   +3.615398284868812e-01   +4.012514574175249e-01   -1.138656401875021e-01   +2.233026082702551e-01; +4.285625826568971e-03   -1.545572671342979e-02   -1.122780237397892e-01   +3.258875595169429e-01   -8.338588960046325e-02   -5.323091405850288e-01   -3.066974545473802e-01   +1.348390656838477e-01; +1.740826870331585e-01   +1.792855604102547e-01   -4.796495370088296e-02   +1.132580601160406e-01   +2.647233315199201e-01   -1.163098130045747e-01   -4.046821262541599e-01   +4.282350714503888e-02; +2.125583792296977e-02   -2.117478669917094e-01   -2.679506042807195e-01   -3.259215698270451e-01   -1.368242049183005e-02   -1.704231330549939e-01   +3.364026360626062e-01   -7.511385464549182e-02; +2.545516436071124e-02   +5.131001797174515e-01   +1.957228612701036e-01   +8.549688025593169e-02   -2.375524761787000e-01   -2.076500348624660e-01   +6.746973149852566e-02   -1.867719109734978e-01; -1.263557652806348e-01   -2.175252569512584e-02   -3.221723732146158e-02   +4.422446361070743e-01   -6.717343758978236e-02   -3.023448245277426e-02   +2.060973707266894e-01   -1.345948154965546e-01; -4.162227032012852e-01   +4.699163464592743e-02   -8.354128689612712e-02   +2.522277909831513e-01   -2.023734834493457e-01   +6.107501254808050e-02   +8.078727552969531e-02   +8.254264582257358e-02; -2.787057463663511e-01   +6.984815953128068e-02   +2.810665281620504e-01   +4.553355324919102e-01   +2.007775221476841e-01   -2.812473849062721e-01   -7.154152218477719e-02   -3.207772382080826e-01; +2.275967525187242e-02   +1.927962338855958e-01   -2.664923039926287e-01   +1.172980640468186e-01   -2.113871716766115e-01   +1.485780732088648e-01   +1.735700707743451e-02   +9.095010673921897e-02; +2.914354977702429e-01   -1.895976239558679e-01   -2.410647627493578e-01   -5.229429689087649e-02   +4.154938171307900e-01   -3.648632067217605e-01   -4.437990576750331e-03   +1.776869762080975e-01];
L1E_L2E_iAMPA_netcon = [+5.891502531169279e-02   -7.156678081030060e-02   +2.576877191225467e-01   -1.565429687782973e-01   +1.733349656197990e-01   -2.744160322395312e-01   +2.903900333915828e-01   -2.519450253336456e-01   +3.708414098896910e-01   -4.429562296911996e-01   -2.097510108770491e-01   -4.451439171245837e-02   +2.421614046600699e-01   -5.606112635785282e-02   +1.555233281035978e-01   -1.585565808242915e-02; -3.685516486667850e-01   +1.970535939733610e-02   +6.228236727936071e-03   -2.799270761935237e-01   -2.111751996033064e-01   -2.312434904625353e-01   +1.087311895018719e-01   -2.415710101830598e-01   -4.913186021012483e-03   -2.239985062209162e-01   +1.208490555765646e-01   -8.706581570772184e-02   -5.572421419496282e-01   +8.323378336751194e-02   +3.020277275985804e-01   -3.243859283610916e-01; -6.319467419758379e-02   +1.926567555401629e-01   +3.922640161046703e-01   -8.324019154506673e-02   +1.129386309706906e-02   +4.418081476681032e-02   +1.343579131889646e-01   -1.074469435802028e-01   +1.947932631441853e-01   -8.669312497851675e-02   -6.913573956031616e-02   +3.955864812981945e-01   -1.730278918378195e-01   +4.890080661841926e-01   +3.278459999732026e-01   +1.468671764755720e-01; +2.540640167005111e-01   +2.559853600326662e-01   -1.193827763778044e-01   +1.670137260064181e-01   +3.595761754273173e-01   -2.336518033567450e-01   +2.136594812131427e-01   -2.215567458589646e-01   -6.734843488174272e-02   +2.817291412272356e-02   -2.150791066273973e-01   -1.082737267528785e-01   +1.760080664326345e-01   +9.713128446610736e-02   -1.440047381878003e-01   -3.563132154282004e-02; +2.597465383359720e-02   -3.492897431268113e-01   -3.423157051193507e-02   +4.861113074262909e-02   +2.519840272282678e-01   +2.207209613819201e-01   +2.399322939069595e-01   +1.727883987396658e-01   +2.186767478283912e-01   -1.383834207736826e-01   +3.373915500091264e-01   -1.351523072952419e-01   +6.158532705632556e-01   +2.665427363661969e-01   -1.602319381355833e-01   -4.152158939478726e-02; +3.242372988171909e-01   -3.713712855510086e-01   +1.540439318604865e-01   -1.076565809962061e-01   +5.172478516739728e-01   -3.294027498847230e-01   -1.481940874612619e-01   +6.744061367521813e-02   +6.632862772075011e-02   -1.713617057625572e-01   -2.426161943054876e-02   +5.127316497650820e-02   -1.026262673039109e-01   +1.316830808943809e-01   -5.235615203434851e-03   +1.523805015120792e-01; +1.088581171798076e-01   +2.776620915091171e-01   +1.098062730607204e-01   -3.961621551977355e-01   -1.691600621368144e-01   -6.220103037930555e-02   -2.621385284614837e-01   -1.425718439164924e-01   +3.211775892422385e-02   +1.264848748627284e-01   +2.235761454588073e-01   -1.435817722812933e-02   -1.008354126261101e-01   +1.548107378408348e-01   -1.952611188948948e-01   -1.847374835101147e-01; +1.152505720872168e-02   -2.481307773879363e-01   +2.161687833768874e-01   +6.005613629795471e-02   +1.767892132627339e-01   +3.992481996466917e-01   +7.829245002540507e-02   +1.499559183475031e-01   +1.066794531141660e-01   -2.466085125679312e-01   +1.500183785438594e-01   +6.543926359104357e-02   +3.130516882283622e-01   +1.349056174700837e-01   +3.095540678373143e-01   -1.647734695185698e-01];
L2I_L2E_iAMPA_netcon = [+1.897114332749225e-01   +5.161652597620993e-01   -7.267254629844164e-03   +1.241089248497344e-01   -9.407513765953592e-02   +1.789601682852358e-01   +3.189575195698137e-01   -3.096321457133581e-01; +3.836361263206213e-01   -3.326802819659445e-01   +8.530705546638910e-02   +1.022762285230965e-01   -3.498338966365125e-01   +4.628732574446742e-01   -5.731796713779080e-02   +2.095455328737606e-01; +5.654183859768596e-02   -8.243755973767342e-02   -2.189518730494872e-01   +1.662317682782683e-01   +5.062026447580265e-02   -6.626217914960339e-02   +3.250061885260877e-01   -2.927422035160565e-01; -2.523817126021768e-01   -1.958223422620876e-01   +9.548374649228475e-03   +3.809661208194567e-02   +2.483285332374681e-01   -1.025230908269639e-01   -1.845829885989577e-01   -2.556214457588327e-01; -3.890328489846447e-01   -2.259807825239895e-01   +1.791720676951140e-01   -3.976416449543608e-01   -9.142448551046428e-02   +6.399248446351205e-02   +1.092522303094576e-01   +1.091327986628400e-01; +9.278352564829781e-02   -8.021021800863989e-02   +6.186798942198501e-02   -3.675033801987735e-01   -1.382757604783957e-04   +2.641989171197833e-01   -3.915218978698437e-02   +2.547342076163764e-01; +3.821863319559001e-01   +1.246062392388645e-01   -4.294087801284038e-02   +1.507161504996813e-01   -5.405076298494077e-02   -1.311225101110349e-01   -1.614980899744482e-01   +2.457408308805315e-01; +1.051600157267350e-01   -1.099442775622379e-01   +3.924833688248855e-01   -5.535514552963582e-02   -1.017042571653832e-01   +2.673267344134279e-01   +1.299052641636966e-01   -3.415278217050338e-01];
L2E_L2I_iGABA_netcon = [+2.308796882041989e-01   +4.121144223366391e-01   -1.451357304540802e-01   +3.316438362467714e-01   -3.649349827360418e-02   -1.951933652740048e-01   -2.052754661142831e-01   -1.013785020511801e-01; +2.455767914318659e-01   -1.775334046515552e-01   +1.119157804163597e-01   +4.697624826238579e-02   +1.694298909378317e-01   +2.574209157272613e-01   -3.675654939019182e-03   -8.890601704347412e-03; -1.780192912472927e-01   +1.078862713440803e-01   -2.121771485477599e-01   -5.269762382516727e-02   -9.440979084302281e-02   +3.061603675760291e-01   -2.725994635979854e-01   +1.696663353783695e-01; -6.885839412172082e-02   +4.524866655695971e-02   +1.247020277058612e-01   +2.946998383427193e-02   +3.274933162886153e-01   -5.481062172014968e-01   -1.083485385238075e-01   +2.100617739763521e-01; -2.011103536184802e-01   -1.833022057607831e-01   +2.538256207741242e-01   +1.455506823872894e-01   -1.003286808630975e-01   -8.326343489218081e-02   +9.011793806810470e-03   -1.592109697104991e-01; +1.059702764506270e-01   +1.013901437474128e-01   -2.143920849708038e-01   +8.764234401152024e-02   -1.136078868769135e-02   -1.654189003637314e-01   -2.547437269814186e-01   -3.633356673062052e-01; -3.838503496137494e-01   -4.295220409779379e-01   -1.398988444557608e-01   -2.615928440841723e-01   +2.293200522368566e-01   -3.848204253317696e-01   +1.051468946292625e-02   -8.701154637744429e-03; -3.959006473247590e-01   -2.586648497594808e-01   +1.964056479904594e-01   +1.874337756326811e-01   +3.144290152933635e-01   -3.408235947568774e-01   +2.268873468853239e-01   -2.484270578021235e-01];
L3E_L2E_iAMPA_netcon = [+1.885674146462640e-01   -5.408395700975344e-02   +2.427314493019584e-01   +2.953882433207841e-02   -4.558201666933960e-01   +2.830535043400022e-01   +1.375580305635860e-01   +5.103183400134284e-01   -6.777819585614116e-02   -5.256573267603858e-02   +3.637765617272051e-02   -3.957789223388074e-01; -1.512596964976259e-01   +2.779868616218389e-02   +2.904968684057175e-02   +1.743997868435751e-01   +2.091602326229040e-01   +1.818998644062082e-01   -3.014743098502368e-01   -2.351769521793297e-01   -9.332783011257159e-02   +3.329946881325390e-02   -2.973073505389583e-01   -2.517382034253418e-01; +2.926608658463528e-01   -4.355513086305658e-02   -5.687643620192064e-01   +1.447292237414438e-01   +3.250058126102368e-01   +3.409506805534526e-01   +1.723047693433984e-01   +1.043353335253995e-01   +1.332874130531845e-01   +2.908580274495774e-01   -3.070518028863397e-01   +9.906168636593729e-02; +3.314488565135223e-02   +1.825888869894049e-01   -9.233959560637035e-02   +1.844072122739811e-01   -1.294880186642546e-01   +4.010669045074138e-01   +1.607612864339766e-02   +2.007862526342612e-01   +1.417181628896809e-01   +6.910856254529335e-03   +3.357160948297008e-01   +4.959286604386930e-02; -5.217798046839805e-02   +1.666830872104028e-01   +1.041873847296337e-01   -1.027689014428866e-01   +1.403693568746943e-01   -3.626215570456381e-01   -2.871671727991455e-01   +1.088711546909745e-01   -2.720627386142507e-02   +2.346791475307102e-01   +3.042946980371449e-01   -8.707922247199909e-02; +2.354010706239398e-01   -2.535242525072889e-02   +3.036391636984832e-01   +7.938459800785908e-02   +1.427222299159432e-01   -4.761750153729050e-02   +3.339264982510567e-01   -3.688287531474248e-01   +2.034632155558107e-01   -1.729856528371907e-01   -2.372311522812638e-01   -9.787385944770657e-02; +8.618667226602034e-02   +1.130680206532572e-01   +1.604662720254443e-02   -1.177093047618819e-01   -7.047467827968540e-02   -4.154652274228695e-01   +1.967837877194742e-01   +3.884179933763262e-01   +2.133102409398916e-01   +1.396068697561763e-01   +1.313612266440517e-01   -9.217171032243851e-02; +2.073212924773237e-01   -9.495730350512038e-02   +4.007323628064822e-01   +7.859181618006524e-02   -2.153160128515698e-01   -3.184543146078760e-01   +3.506427135578264e-01   +3.304323897704575e-02   +2.381957595102960e-01   -2.251608234630488e-01   -4.214670915134642e-01   +3.520660453278512e-01];
L3I_L2I_iGABA_netcon = [+2.583295186639754e-01   -2.381190719524838e-01   +1.226831484756676e-01   +2.237857634860646e-01   +1.146537529293492e-01   -1.755865254445600e-01   -2.590622357678324e-01   +2.818894635400044e-01   +4.292469266170400e-01   -2.578269292885385e-01   -7.898493444010701e-02   -4.820815001157074e-02; +1.175565138736990e-01   +7.995164756325857e-02   +1.166670885135877e-01   -1.811732071641452e-01   +1.693778970718338e-01   +7.915868989488829e-02   +2.133552818593898e-01   +1.253639108210673e-01   -1.830296574704202e-01   -2.848677641918965e-02   -2.796650923300295e-02   -2.112313835145951e-02; +1.786494931534974e-01   -1.464430672708465e-01   -2.874130145752400e-01   -2.814384662095528e-01   +4.282761263546398e-01   +2.305056631616386e-01   +2.283235961545301e-01   +2.379710202781655e-01   -3.712375157080628e-01   +2.041565208421957e-01   -4.851530479235390e-02   +3.373025713016274e-01; -2.253493757101426e-01   +1.017986857287242e-01   -4.687892758727183e-02   -4.354854260995107e-02   -3.068021219358021e-02   +4.459195099250429e-01   -4.019138911841067e-01   +1.710053533259888e-01   -9.585808539333965e-02   -1.039283187965122e-02   +1.387050674008400e-01   +1.091996632550055e-01; -5.058812485189482e-02   +1.794590366955665e-01   +2.266859215580981e-01   +1.653400090741173e-01   +5.991099389704296e-04   +2.147058491386652e-01   -2.273474311112692e-01   -1.332585169480470e-03   +3.326161744552734e-01   -1.278409062542737e-01   +1.580628928137945e-01   -2.657945693555733e-01; +3.844637276669082e-01   -1.758244730128672e-01   +4.680384791193140e-01   +3.517613028393052e-01   +1.031531464988518e-01   -4.414665805978528e-01   +1.047977874468268e-01   +4.207571220231546e-01   +3.620727547170272e-01   +1.465795122577236e-01   -2.659036208194273e-01   -3.827679999289934e-01; -2.267387573605716e-01   +2.603892816634124e-01   +2.869131517220680e-02   -1.362267890273706e-01   +1.101176529281067e-01   +1.277226366819477e-01   -1.626218886780154e-01   +7.900032507067969e-02   +3.585620469822534e-02   -1.046570752990606e-01   -3.580836122679949e-02   +2.092850474669462e-02; +1.197245396405942e-02   +1.672205596238537e-01   +5.424089272959409e-02   -1.735707743154017e-01   +3.022282935888102e-01   +4.405985357339582e-01   +8.855153174381124e-02   -1.821134093432615e-01   +6.692273290041234e-02   +3.413797994639208e-01   +4.382800006104857e-01   -3.844602946601263e-01];
L2E_L3E_iAMPA_netcon = [+9.528143700282839e-02   -4.466692635731392e-02   +2.456564823946934e-01   +4.044097445796829e-01   +1.251954746359858e-01   -2.674411845473507e-02   +1.732808124550490e-02   +2.538278889506436e-01; -1.457394011962593e-01   -3.472110324459309e-01   +2.700899324391925e-01   +1.177531459301586e-01   +1.023665642655170e-01   -9.989273144546838e-02   -3.342866138405484e-01   -8.429949721979051e-02; +1.673859339368984e-01   +2.999779898998370e-01   +2.256585122630985e-01   +2.077043248075507e-01   +1.792626782943369e-01   -1.226973040072527e-01   -6.819055571858666e-02   -6.780597077538894e-02; +4.287976537673775e-02   -2.176480080546191e-01   -2.733652999533731e-01   +6.839317747386919e-02   -1.797650102303111e-01   +1.613144699459713e-01   -2.775350194603032e-01   +2.854447136034358e-01; -2.774567994027802e-01   +5.640648388621759e-02   +5.601836126841360e-02   +3.201975777194143e-01   -4.055141883765002e-01   -5.410737478348779e-02   +7.514648838710741e-02   -1.507287443465375e-01; +2.317334713102372e-01   +1.496734460627527e-01   +1.736946951351434e-01   -1.392983143547485e-01   -1.759919471206820e-01   +4.983398106094751e-03   -1.272048480875226e-01   +1.563444572389504e-01; +8.331406780412415e-03   +7.830699901017399e-02   -3.465799882361621e-01   +4.257283347968560e-02   +3.233086203872069e-01   -3.480352581046947e-01   -2.071036535815488e-01   -1.481359762163434e-01; +3.908298293586025e-02   +3.453641514595926e-01   -3.772055851184217e-02   -2.536071440467506e-02   -4.932974208286818e-03   +5.114089103902853e-02   +3.343725475847516e-02   +2.646953043825034e-01; -2.126343445032926e-01   -4.637558757886364e-01   +1.373687374514101e-01   +2.816416039001426e-01   +2.115938956958131e-01   +3.135418702365030e-02   -1.958660657851125e-01   -2.752794535832651e-01; -5.515439110296437e-02   +3.422861630020099e-01   -1.191231089062960e-01   -3.521960773634713e-01   -3.475188814993666e-01   -1.801560812049744e-01   +4.486725862404643e-01   -2.106713522903283e-01; +4.430736193201237e-01   +8.565765344361087e-02   -3.691527229103491e-01   -6.116450043285086e-02   +1.984957229744521e-01   -1.571078688138824e-01   +2.734012178248512e-01   -2.964275657945832e-01; -8.586427131589613e-02   -1.629606223463066e-01   +2.815249348335594e-01   -2.494102010404975e-01   -7.410690895806721e-02   +2.259743709661849e-01   -3.747172524970405e-02   +4.690821149893204e-02];
L2I_L3I_iGABA_netcon = [-2.342592089265327e-01   -2.873921258059762e-01   -3.029806857968543e-01   -3.345882190626009e-01   -3.440184407139276e-01   +1.848273924064413e-01   -1.747356157132902e-01   +1.625554458468354e-01; -4.644711672869765e-02   +3.565448635606972e-01   -1.479976210049479e-01   -1.053738195673853e-02   +2.698583266487192e-01   -2.642353604649272e-01   -4.070970330270761e-02   +1.632872763257197e-01; +1.401755005679766e-01   +1.989077060728481e-01   +1.753542024321803e-01   +1.450799225603939e-01   +4.353516936643086e-01   +3.023210866880208e-01   +2.295747642382241e-01   -1.785153252182793e-01; +2.514357508394278e-01   -3.176356209729500e-01   +3.865701722891648e-02   +3.427670669197733e-01   -2.350192546050560e-01   +2.629947911593772e-01   -1.766041946902558e-01   +1.413919124597461e-01; +9.102496156843901e-02   -1.934534799244276e-01   +3.689560904594374e-01   +2.165942925262010e-01   -1.332184979101939e-01   +5.609962954798623e-01   -8.876504942434776e-02   -3.501589425951186e-01; +2.547522152716944e-01   +1.853853577063680e-01   +2.543674558561895e-01   -1.813634429979293e-01   -2.773114698430470e-01   -1.351475397768941e-01   -2.802417584026182e-01   +1.833701485458928e-01; +8.795498589264056e-02   +4.302828833452395e-02   -1.508487558189689e-02   -1.223782246870568e-01   -4.203152537535098e-01   -1.320919219437854e-01   -2.653193646179091e-01   +1.633958617986238e-01; +3.382434895711908e-01   -1.063617304434660e-01   +1.829386094500350e-01   +2.270685457309907e-01   +1.034032659253802e-01   -5.087185443361510e-02   +3.338165367399083e-01   +1.927650406997511e-01; -1.640950454280276e-01   +8.646430556767129e-02   +1.443327423237775e-01   +4.508587929444724e-01   +2.616300655637896e-01   -1.425071337620065e-01   +1.644990727443617e-01   +3.109001611812016e-01; +2.024769625415749e-01   +4.919548118794345e-02   +1.937821984857801e-01   +3.241026827413727e-01   +2.913247682785600e-01   +1.065230849812556e-01   -5.659385283823622e-02   -2.432930833036552e-01; +4.768594148657165e-01   +6.656056711374322e-02   +4.796688629761177e-01   +1.589439167740754e-01   -2.354476237696778e-01   -1.394812210708880e-01   -1.614933804050869e-01   +1.701102800479579e-01; +4.274787165247795e-01   -2.811079063256692e-01   +1.995623044618541e-01   +2.281634938158728e-01   +2.598555735674966e-02   -2.259641061797550e-01   -1.283746503336230e-01   -9.771413296560297e-02];
L3I_L3E_iAMPA_netcon = [-2.588460557694577e-01   +4.208554877752105e-01   +6.497575112092172e-02   +3.448497456197380e-02   -8.243550527982807e-02   -4.488902085333319e-01   -3.218698574704881e-02   -9.948101076833193e-03   -1.764203473714966e-01   +7.623468050296046e-02   -1.073945877901986e-01   -2.303147523931611e-01; +1.702072795388655e-01   -3.245714702473859e-01   -1.800183312768827e-02   -1.664701248021079e-01   -1.242195691806116e-01   -2.978484218133264e-01   -2.604145246845104e-01   -2.344677800916067e-01   -2.922236385381554e-01   -2.115352606130823e-01   +1.282027885333437e-03   -2.048631429351634e-01; -2.937683451000168e-01   +3.041324417647485e-01   -1.167756724085105e-01   -8.631737313528426e-02   +1.457968930217925e-01   -1.008898499159655e-01   -7.903504371451719e-02   +2.012031334953188e-01   -3.417823272008792e-01   -1.385543959517517e-01   -3.928143662006911e-01   +2.845360718395183e-01; +2.054186310135723e-02   +2.816583747253240e-01   -3.580306580603166e-01   -3.760177168006816e-02   +3.850323569373676e-02   -2.445457807801620e-01   -8.469059641181924e-02   -5.715046893304603e-01   -4.050447632878810e-01   +6.218189803617075e-03   +2.030410953483173e-01   +2.623628586584143e-01; -3.954548964905282e-01   +2.554714454994597e-01   -2.295784313545565e-01   +3.964476473474692e-01   -1.141415002065720e-01   +1.999843851954901e-01   +6.786154014267948e-02   +4.310953462491816e-01   +3.563593550460567e-02   +2.446906796600610e-01   -8.957356830042185e-02   -9.549489038502587e-02; -2.545616180069127e-03   -1.000837407169377e-01   +2.948345327118012e-01   -1.727091071910805e-02   +3.305091966881438e-01   +2.574469560253310e-01   +1.277453060082061e-01   +3.115121508375172e-01   -2.325915882287585e-01   -3.511793621579383e-01   -5.807773542092581e-02   -4.709044052818959e-02; +5.013498628114725e-02   -2.986077851797099e-01   -2.943156008204221e-01   +2.943739200927201e-01   -1.796746433810302e-01   -1.432337739288841e-01   +1.294193376613841e-01   +4.884493176866671e-02   +1.348930577154869e-01   -2.121030305687670e-01   +3.132498887394031e-02   +5.651494799090714e-01; +2.633672583827159e-01   +6.549974936350428e-02   -9.749064350160069e-02   -8.990553073207649e-02   -6.791793374595834e-02   -3.766245655706729e-01   +1.277926487591999e-01   +2.712047984335779e-01   -3.618761268384262e-01   +1.679364899765614e-01   -1.803000452207924e-01   -1.138151964707143e-01; -9.910109408940564e-03   +1.155762797015158e-01   +2.425778986153674e-01   +1.369894613872190e-01   -2.571283008432532e-01   -1.063675858985696e-01   +2.638946842414496e-01   -6.870688509498708e-02   +1.268893210772613e-01   -2.591934009418214e-01   +2.243911113159215e-01   +2.470793107683777e-01; +2.252342069537831e-01   -1.720698621930951e-02   +3.660409599311824e-01   +3.142199518119440e-01   +2.020428235434490e-01   -2.548979894757600e-01   +1.415711434301632e-01   -1.664062910529370e-01   -2.298272386275438e-01   -1.978369412934695e-01   -6.927903062125400e-02   +5.874753208116391e-02; +3.134694929566853e-01   +3.182749326080436e-02   +2.043981258016741e-01   +1.256683134636392e-01   -1.305787727189014e-01   -1.756255103646586e-01   +2.868765548490330e-01   -3.608019852462253e-02   +1.809904479565764e-01   -1.778486402909652e-01   -3.824807480802658e-01   -6.113598340302048e-02; +1.363373006535878e-01   -1.624138575384619e-01   +5.946246474470784e-03   -2.482039204800383e-01   +2.031698805111090e-01   -1.522711837833771e-01   -2.286891168094415e-01   +9.716791476234982e-02   +1.589267175975550e-01   -2.972452190247478e-01   -1.308442619531234e-01   +1.467102162982075e-01];
L3E_L3I_iGABA_netcon = [-5.265985902207018e-02   -1.548827376279690e-01   +1.139428217077519e-01   +7.873120825598288e-02   -3.107243564845249e-01   -5.228148813247547e-01   +6.131381817130188e-03   +2.283288949568250e-01   -2.780622551695165e-02   -2.500486478028240e-01   +4.381768230987072e-01   -6.200526001823679e-02; +2.154224777730328e-01   -6.017504136371186e-02   -6.401907849078736e-02   +3.918982533319053e-01   -1.055926173499048e-01   -1.414086431298677e-01   +5.950562600082879e-02   -1.491307386758011e-01   +5.270523127311439e-01   -2.133867783380752e-01   +7.639361454759912e-02   -2.068399304866596e-01; -4.828211475838124e-01   -3.615105996204557e-01   -1.572308282719436e-01   +4.854317649731460e-02   -1.954569088677325e-01   -1.382332931599509e-01   -5.205487420704947e-01   -2.615655255243401e-01   -1.371971966101086e-01   +2.084587662277154e-01   -2.594895531983277e-02   +3.638017025255785e-01; -5.353730429594215e-01   -2.671985818400519e-01   +1.816935349082103e-01   +1.662330654155800e-01   -1.390374820703020e-01   -9.400779096137588e-02   -4.102305525125345e-01   -1.215868109176620e-01   -5.581622211814147e-02   -1.725831340068180e-01   +1.532875207520633e-01   -2.354234268569717e-01; +2.545352146387812e-01   +2.528231265168620e-01   +4.472106909441468e-01   -1.895533744851171e-01   +1.426252655629813e-01   -1.514079754238041e-01   -3.028457399830901e-01   -2.412660835485854e-01   +1.166565889078688e-01   -5.208484564376622e-01   +4.221539784475135e-02   +1.876532007607426e-01; +9.480326278133697e-02   +2.625595464593173e-01   -2.114458223827156e-02   -1.990677124074997e-01   -6.903111894357146e-02   +2.424077368522558e-01   +4.525024545171251e-02   +1.582277641060357e-01   +2.472905810597781e-01   +3.465397058886798e-01   +1.788675398317913e-01   -1.111774398632160e-01; +4.062403495657164e-02   +4.262585282474414e-01   -2.785050710356607e-02   -4.707728788730478e-02   -2.577557626345914e-01   +2.898456896510418e-01   -3.927207716268354e-01   +2.147281492655493e-01   -4.424320644982901e-01   -2.389601763683195e-01   +2.506798379241397e-01   +2.456765412385573e-01; -3.733992756467674e-02   +4.405596661173945e-02   -1.783528943886243e-01   -8.481906670737799e-02   -1.708730649014071e-01   +7.608183599449508e-02   +8.746177416939178e-02   -9.344565850632636e-02   -4.001474207277136e-02   +1.260124889420522e-01   +1.670332749606795e-01   -2.649617607473509e-01; +6.697464096667964e-02   -3.036071048872566e-01   +2.524919329655983e-01   +2.573735717089303e-02   -7.601953223565111e-02   -2.856413428949439e-01   -2.581357509163722e-01   -7.073553020276613e-02   +8.460434426274359e-03   -3.440355897609805e-01   -1.015906819544462e-01   -3.782739153786602e-01; -1.156346609595218e-01   +3.087713615870302e-02   +4.446570034637426e-02   -3.241320061856123e-03   -1.023205393849499e-02   +1.437680836177117e-01   -2.382086207818955e-01   -2.501592164607795e-01   -2.755198801150149e-01   +7.735542661298611e-03   +3.900870474691343e-01   +1.227914244770387e-01; -4.018760567460219e-01   +1.310262947428061e-01   -1.565451236240717e-02   -1.016840171547517e-01   -1.113572752648823e-02   -3.565525154005164e-02   +1.066335461823515e-01   -2.566235768665203e-01   -5.756279323600955e-03   -2.990510419832724e-01   -2.236900697906694e-01   +4.860823503034886e-01; -3.929652805013209e-02   +3.416054517787200e-02   -7.256236607790924e-02   +5.025669721488575e-01   +1.568226882889645e-01   +7.141397972166189e-02   -3.864366358316940e-01   +1.929433275980436e-01   +1.599004726989048e-01   +4.380708883768475e-02   +1.882539893517505e-01   -2.829865167757527e-01];
L2E_Input1_iAMPA_netcon = [+1.814009173600531e-01   -2.394143712045504e-01   +4.453312054766076e-01   +1.048117603179757e-02   -2.694697410227809e-01   -3.206400418393630e-01   +2.628605206249465e-01   -2.144898605509906e-01];
L2I_Input2_iAMPA_netcon = [-1.551709501085926e-01   +8.576380063500874e-02   -1.140298893352884e-01   -1.519359434453610e-01   -2.168756163710159e-01   +4.320302151490479e-01   -6.427756140811454e-02   +8.045075721575543e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
