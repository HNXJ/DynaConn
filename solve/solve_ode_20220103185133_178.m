function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.147454476160977e-01   +9.460516187609189e-01   +6.996470012909157e-01   +1.554723995392202e-01   +9.222637562295510e-01   +2.192984308393869e-01   +7.402054959001559e-01   +3.014940155507913e-01   +5.327030317993621e-01   +8.297633199663644e-01   +9.686573327844131e-01   +9.643256554311095e-01   +6.958381973247123e-01   +3.709783785654486e-01   +2.972930873162860e-01   +3.782168937936804e-01; +3.451533690708376e-01   +1.401209861691204e-02   +1.409453443205053e-01   +1.748400322435432e-01   +7.204285809285463e-02   +8.071128544380158e-01   +7.947958359001311e-01   +7.577955222796200e-01   +7.845991640163500e-01   +1.819120854244442e-01   +4.657880453481122e-01   +6.559573476445365e-01   +3.754422690832729e-01   +2.750204211532219e-01   +6.850911157411327e-01   +9.534601023194439e-01; +2.078335143344612e-01   +4.671007340972063e-01   +8.306665086395747e-02   +7.032551808799615e-01   +3.145791440428619e-01   +3.819531403841072e-01   +6.635230438683365e-01   +9.523792762430646e-01   +4.919229403303763e-02   +9.264323388527700e-01   +8.693896200625499e-01   +2.094414627442892e-01   +5.414935742580177e-01   +7.501346890520726e-02   +7.722127345417804e-01   +8.118136742203611e-01; +2.538851418920616e-02   +4.899792320470780e-01   +4.326597079012474e-01   +8.322073670997400e-01   +6.276725841562524e-01   +8.559175145659353e-01   +4.417389312886261e-01   +8.449054850274697e-03   +4.628164821121200e-01   +4.208984405280417e-01   +9.458672196317136e-01   +8.978995933370175e-01   +5.179043730163368e-01   +1.508047632324575e-01   +7.201507535835805e-01   +8.910632887578374e-01; +7.659597387754770e-01   +5.152751290929828e-01   +8.948914374339417e-01   +8.117043500855343e-02   +9.055883071452728e-01   +3.243894623234501e-01   +5.746211695867381e-01   +4.071584401089986e-01   +9.384862820486337e-01   +3.014531216106695e-01   +2.329452821213418e-01   +4.880286058622046e-01   +7.635114492087262e-01   +3.645839616873607e-01   +2.787382669312898e-01   +6.812584932344351e-02; +5.709548564828465e-01   +2.876858230429966e-01   +7.322827991758087e-01   +8.352645803076459e-01   +7.970589563383588e-01   +3.789622062836360e-01   +5.175931529136454e-01   +1.514441472322433e-01   +4.726741156383046e-01   +3.488142163130303e-01   +9.185446973616799e-01   +6.617481776926821e-01   +7.957168452185208e-02   +7.186962663810331e-01   +1.383396353769063e-02   +9.035590056167127e-01; +5.767521743246743e-01   +5.644856487344544e-01   +6.802770966167422e-01   +5.411233050717794e-01   +6.428860130325378e-01   +6.369669008648683e-01   +7.248428793689718e-01   +8.206330023052052e-01   +7.794377497964381e-01   +9.727344145444264e-01   +6.347881964212141e-01   +5.264426083960554e-01   +4.759872146737378e-03   +5.323291996238557e-01   +1.476908949478612e-02   +6.684933271498399e-01; +3.904807527237790e-01   +5.094953647008923e-01   +2.005601398827848e-01   +9.631712642794549e-01   +4.408064263820268e-01   +3.881118153252067e-01   +2.230803298730555e-01   +2.876224535195998e-01   +1.091540646289974e-01   +5.311003616339689e-01   +2.833366740041263e-01   +7.082896447628716e-01   +4.002919105001181e-01   +2.321363028908054e-01   +9.363493676788148e-01   +3.472164629283857e-01; +5.560845640318167e-01   +6.786706807248309e-01   +5.290935102344905e-01   +6.772548354891119e-01   +7.479560513977607e-01   +6.687125159319249e-02   +9.979372981777861e-01   +9.786760266985476e-01   +5.221998242840323e-01   +7.898465303032381e-01   +8.550532408778585e-01   +7.191019666534232e-01   +6.622605401413488e-01   +4.709309798695503e-01   +9.331059016146412e-01   +8.368543250063124e-01; +1.829656395573222e-01   +6.153160400083830e-01   +8.301586170212544e-01   +3.368225397476032e-01   +8.252381549103759e-01   +1.673022525178381e-02   +6.200605075162827e-01   +6.248101590912358e-01   +6.366671554821385e-01   +7.932933581565855e-01   +1.653768521937387e-01   +2.948278428945759e-01   +3.676951998612580e-01   +7.166518705156393e-01   +3.747667964239706e-01   +1.990890578630667e-01; +1.182495145376917e-01   +5.656521102844283e-01   +1.750308051568394e-01   +2.212926550268167e-01   +3.411762197983905e-01   +8.787395451218035e-01   +9.798660464081680e-01   +7.438180147118927e-01   +5.782894803738526e-01   +1.452615602915365e-01   +8.281259124236934e-01   +1.169648441752413e-01   +3.916763372605584e-01   +5.142334986131760e-01   +1.097048388548209e-01   +8.416008039143709e-01; +5.905549370460868e-02   +5.045359172334102e-01   +5.188684374552033e-01   +5.692816176785505e-01   +1.394812997247157e-01   +1.579501599298036e-01   +4.946597604756620e-01   +8.735034056180825e-01   +8.350808742247422e-01   +4.560270260651788e-01   +2.166519974200878e-01   +3.248112322065679e-01   +1.348435243363547e-01   +5.144105638882254e-01   +7.197427872947632e-01   +4.254313992174417e-01; +9.329308072965469e-01   +6.677348849178724e-01   +3.554933516598962e-01   -2.751830043004719e-04   +5.041503729321155e-01   +9.143137438122214e-01   +5.237030851144725e-01   +3.290054161806493e-01   +1.160425147077335e-01   +4.581650628313478e-01   +2.679794317517380e-01   +4.561089274502740e-01   +3.382433661567609e-01   +3.859060114563327e-01   +4.494942402223404e-01   +5.584348009249801e-01; +7.455842125102221e-01   +6.329159275358637e-01   +6.444196201094071e-01   +5.884244145406421e-01   +4.132671746692934e-01   +5.561001213663238e-01   +8.554506514129131e-01   +9.912584750140760e-02   +5.274754418350298e-02   +9.536244641335915e-01   +8.600910145537981e-02   +7.174382644836323e-01   +1.224795053580236e-01   +4.795314839897215e-01   +1.196331847047574e-02   +4.480042831334199e-01; +2.426918517721188e-01   +1.455344673161691e-01   +2.817183920322697e-01   +8.918698164884865e-01   +1.716658604936979e-01   +9.225238512784426e-01   +2.534538378428732e-01   +4.507173916578106e-01   +5.174290988694247e-01   +5.331739332393953e-02   +9.165080529539190e-01   +4.054031854177854e-01   +3.691275105488105e-01   +7.396261980495175e-01   +1.236381636306242e-01   +7.596962917654138e-01; +2.040364509913375e-01   +1.790733890632752e-01   +4.371945577643211e-01   +2.543412494926516e-01   +4.942725851527154e-01   +5.973305511978334e-01   +5.821719254433521e-01   +2.393741333863484e-01   +6.969116351333772e-01   +3.676307042165871e-02   +7.263993641675163e-01   +2.418803311381540e-01   +2.511702912952222e-01   +7.018330885644473e-01   +6.584618429647473e-01   +9.560689922740218e-02];
L1E_L1I_iGABA_netcon = [+8.436146254813454e-01   +7.524990372485806e-01   +8.740945517556423e-01   +4.352800963463822e-01   +9.176240695065173e-01   +7.795672928340520e-01   +3.213131007617035e-01   +6.412752601256819e-01   +9.448079467262513e-02   +2.593453405437273e-02   +1.290642849453249e-01   +5.209516164360596e-01   +8.700725504283812e-01   +5.766213467332374e-01   +1.653710762885096e-01   +6.275518286474200e-01; +6.215921492154194e-01   +9.948540650965514e-01   +3.089507210104598e-01   +1.473292615995505e-01   +8.833120329396152e-01   +2.727840661743999e-01   +9.632570465522907e-01   +4.294815839613813e-01   +2.922473347670673e-01   +5.146330174679646e-01   +4.248989767421510e-01   +2.035255246059128e-01   +8.035122630268202e-01   +2.884462679879364e-01   +5.445452323550226e-02   +3.369218019235075e-01; +6.718904898244388e-01   +3.709509929600168e-01   +4.333782728308731e-01   +6.540623892960542e-01   +5.857908508735850e-01   +5.264676888397372e-01   +3.530924797787960e-01   +4.779677163466773e-01   +3.255034312469067e-01   +8.629220633084281e-01   +4.805499704232343e-01   +7.756178651003989e-01   +6.463988324472082e-01   +1.322059728987151e-01   +2.109292207912924e-01   +1.559280977725259e-01; +7.822734381749848e-01   +5.023948849573497e-01   +3.813401576242924e-01   +7.211907637423765e-01   +8.355765732139621e-01   +4.025293509278642e-01   +3.194572820205483e-01   +1.009416541208583e-01   +4.827960641874461e-01   +5.815874006765271e-01   +6.742070703059484e-01   +3.906002057942322e-01   +7.347007928770602e-01   +4.990884129982141e-02   +2.041886374731910e-01   +4.026664813636345e-01; +3.094462418404740e-01   +7.590772304154044e-01   +6.567727929406275e-01   +1.620792576561060e-01   +7.759896160842378e-01   +7.788703644943760e-01   +9.084072395157058e-01   +8.070579005435952e-01   +2.418936494846982e-01   +4.227118676578752e-01   +3.570909762893813e-01   +6.723071571827749e-02   +6.669114500333732e-01   +6.248095662743957e-01   +2.176981208528651e-01   +9.129174688240171e-01; +3.302007424421113e-01   +1.267415525223074e-01   +2.373300059131662e-01   +3.429058008016850e-01   +7.847842042131583e-01   +2.548797110553107e-02   +8.854077019999697e-01   +6.513226959127037e-02   +4.534652973508150e-01   +7.129182869747420e-01   +5.009748319497440e-02   +7.556011033759061e-01   +8.809957357066650e-01   +6.061697844232766e-01   +5.778362513756986e-01   +1.490485386989365e-01; +6.336878065443347e-01   +5.179772206182389e-01   +6.855284742973007e-01   +1.071170137479710e-01   +7.010818465126142e-01   +4.121549414591131e-01   +3.518784240413131e-01   +9.541658737014176e-01   +7.591777796800037e-01   +2.337599276285911e-01   +2.907408190897913e-01   +4.530997623709699e-01   +8.527453875262549e-01   +3.716140311701137e-01   +3.348992477272741e-02   +4.639280946271054e-01; +9.014690488821656e-01   +9.057439033526532e-01   +3.262382010623304e-01   +4.071319898685236e-02   +1.857474706262987e-02   +8.263118865022623e-01   +7.498401663017471e-01   +7.726749717133221e-01   +7.185957627383981e-01   +5.819941492487717e-02   +7.941975731444593e-01   +3.186865649762354e-01   +4.037273968173896e-01   +8.317560243262979e-01   +7.947901227710291e-01   +7.934963757999398e-02; +3.714167895208668e-01   +9.929566817497829e-02   +8.810830812179636e-01   +4.785777346737702e-01   +3.308748592318150e-01   +5.924404063164536e-01   +1.263690141405657e-01   +4.403843912457862e-01   +2.372047999245699e-01   +9.770474563687183e-01   +6.514789639437909e-01   +2.774260642872655e-01   +1.061168282618028e-01   +5.193935621373802e-01   +1.345014386810344e-01   +3.426135518058359e-01; +8.816340071500001e-01   +1.789261537587463e-01   +9.986388505144580e-01   +4.765823065529379e-01   +9.475485784847213e-01   +2.130937909267236e-01   +5.990113205388979e-01   +1.661725998484829e-01   +6.992658281123374e-01   +9.692582000571105e-01   +7.104433648109902e-01   +5.838929629198075e-01   +4.033445511512459e-01   +8.010866329182712e-01   +5.825019898502224e-01   +4.969478012403246e-01; +1.248611583059766e-01   +1.727949410103687e-01   +6.808638733975957e-01   +5.461099621230271e-01   +3.984949345177182e-01   +2.958297361853186e-01   +4.366564804237770e-01   +8.060319693684317e-02   +3.049224796694277e-01   +1.367032010068774e-01   +7.649018384431702e-01   +9.120326641801685e-01   +3.410985369824161e-01   +5.704719488424637e-01   +8.545952607094684e-02   +4.890989425776719e-01; +8.874108069674155e-02   +5.341690611800284e-01   +3.442346672534663e-01   +6.510426612256937e-01   +6.320577354782518e-01   +2.680772327090544e-01   +9.595333292552940e-01   +7.417256509183064e-01   +4.698768136230863e-01   -2.815709878251125e-04   +3.834512964210746e-01   +4.502349227531199e-01   +1.147430720581034e-01   +7.144331403705801e-01   +2.288312534900740e-01   +1.271879779237100e-01; +5.459585158906559e-01   +9.791796973874533e-01   +5.607386541205078e-01   +3.492579666709590e-01   +8.594969614429777e-01   +9.281099533913185e-01   +9.643212722103227e-01   +5.436595293487428e-01   +4.444469289309257e-01   +9.363538433741783e-01   +3.617439433545154e-01   +9.802978411790869e-01   +8.522981572800019e-01   +7.332294116683491e-01   +4.520000047120054e-01   +8.554275400118319e-02; +6.107038943343237e-01   +8.439557304126952e-01   +8.911258845909720e-01   +2.564665693356413e-01   +3.767728081553570e-01   +5.530809681114206e-01   +2.427653117918647e-01   +4.858663238683279e-01   +7.339139627375595e-01   +7.409043109064796e-01   +8.097576436872315e-01   +1.112605801512746e-01   +8.927905031002524e-01   +4.551151410331122e-01   +1.780370826155786e-01   +6.741813737113542e-01; +7.272446185514516e-01   +6.725596552582285e-01   +6.468779291329960e-01   +1.761180839426245e-01   +2.049447333252273e-01   +4.320066269158774e-01   +7.708386444771738e-01   +8.961454578998390e-01   +8.768200047978921e-01   +4.324092158674316e-01   +3.858600081700953e-01   +4.156320255317906e-01   +6.859117002009851e-01   +2.834493129735128e-01   +4.141344836197107e-01   +1.222148861164481e-01; +9.917982757553944e-01   +9.550847955496086e-03   +3.767454903968849e-01   +4.785296832604798e-01   +9.116836398406302e-01   +3.273229208428742e-01   +7.124860702213084e-01   +5.822192720469451e-01   +9.132296526381299e-01   +9.443949303721845e-01   +8.711649220962697e-01   +3.835886282311557e-01   +7.427794080256821e-01   +1.514533655896139e-01   +9.654514104780035e-01   +9.885553950796455e-01];
L2I_L1I_iGABA_netcon = [+5.737166665645653e-01   +5.646867325550057e-01   +1.084484745422285e-01   +4.601363327157911e-01   +7.965454035368205e-01   +9.782298584145174e-01   +2.242122555364988e-01   +7.589169180179497e-01; +5.587817592903382e-01   +9.535631400584537e-01   +1.183000609692628e-01   +5.669831537558166e-01   +5.419313948570665e-01   +4.225317862952674e-01   +6.630087737185485e-02   +5.062169602372714e-01; +6.113850017513091e-01   +8.446817239352559e-03   +4.340387301728614e-01   +8.165179830764115e-01   +2.577978606214743e-01   +3.930979626584735e-01   +8.355155849027101e-01   +8.287062456618621e-01; +4.667303034855442e-01   +1.266414248815965e-01   +9.323539962369830e-01   +3.554533101101773e-01   +7.809194232886518e-01   +4.612543212866444e-01   +4.144709945754550e-02   +9.279144077906263e-01; +4.341069105404162e-01   +8.540919216703157e-01   +1.400756033903755e-01   +2.480382302877329e-01   +7.797400677717305e-01   +1.215834422399036e-01   +9.098838550880046e-01   +7.107214696612797e-01; +6.308950325298247e-02   +2.179753176405648e-01   +8.261340095276769e-01   +7.706145437426792e-01   +1.441757649491221e-01   +4.547406896752725e-01   +4.490741250409660e-01   +7.983260833560399e-01; +6.467298719611837e-01   +7.101518046183825e-01   +9.327982698938815e-01   +1.873510659708967e-03   +8.235751184978296e-01   +2.648436409685802e-01   +2.846818327779152e-01   +9.591819402063160e-01; +4.266615352486840e-01   +7.744146217772451e-01   +5.731718290520507e-01   +2.768397046976486e-01   +6.237853379953288e-01   +9.274422034766694e-02   +7.554661935536227e-01   +9.520387690370733e-01; +7.561353676967136e-01   +4.213542597851288e-01   +4.989479332026266e-01   +2.281363383688724e-02   +4.561730450299251e-01   +6.618192350373244e-01   +9.266558992407493e-01   +2.957650213576135e-01; +3.058932713563968e-01   +7.253227222406556e-01   +9.310532619413715e-01   +6.704190548971205e-01   +4.832929659142979e-01   +9.449937440318853e-01   +1.410217032787662e-01   +3.520299060559325e-01; +5.972679255182815e-01   +4.577778035379608e-01   +8.626920524586450e-01   +9.672400373130389e-01   +2.187911410034664e-01   +7.653535803440404e-01   +9.559018697014712e-01   +5.413256212448994e-01; +3.348955720910369e-01   +8.053356197756320e-01   +2.540860823829633e-01   +9.458084469648612e-01   +8.574268190541492e-01   +4.277793263306885e-02   +3.046052805303539e-01   +2.130697071344267e-01; +6.435586723282140e-01   +4.281481293478211e-01   +4.580593801604262e-01   +4.557319421104215e-02   +8.805979454563272e-01   +2.608301035137277e-01   +2.098155881703510e-01   +8.100781746840942e-02; +1.048514530571973e-03   +1.491075144861046e-01   +7.409258426993456e-01   +2.870070736450792e-01   +8.460656842952223e-01   +6.341791250391748e-01   +4.639251454640545e-01   +5.068288362595218e-01; +1.446770188669631e-01   +8.048423477577976e-01   +7.529757968539611e-01   +4.870413004034058e-01   +4.425998020071135e-01   +8.927601078704220e-02   +5.977196004352175e-01   +1.948951059235028e-01; +2.476018239000642e-01   +3.817032745457997e-01   +2.299581643848012e-01   +8.877707420376320e-01   +5.429477467729207e-01   +7.528339219855709e-02   +5.515762132078584e-01   +1.458333166423483e-01];
L1I_L2I_iGABA_netcon = [+6.990031930775837e-01   +8.666198322004566e-01   +6.146693360381763e-01   +5.478372093504410e-02   +1.431038903630947e-01   +2.345262642348770e-01   +8.380490184964344e-01   +3.702487962324563e-01   +7.067935228186735e-01   +3.843201059745320e-01   +2.396284343178389e-01   +6.662915508132544e-01   +1.683128249301394e-01   +5.698955060122789e-01   +4.375604117754692e-02   +4.866846990546390e-02; +5.987649007325676e-01   +7.977407996085580e-01   +6.103273662131582e-01   +5.736195377721616e-02   +7.446939532733782e-01   +5.566926393580629e-01   +1.973812124177337e-01   +5.584201264005237e-01   +1.865844279918442e-01   +7.198299930549360e-01   +5.136655588453338e-01   +3.288075976132908e-01   +1.144307113325300e-01   +8.095700737991303e-01   +4.425620306371238e-01   +9.214200118919915e-01; +1.628000113863309e-01   +6.275015226725945e-01   +3.148382031486006e-01   +5.970407597443422e-01   +9.516232902425978e-01   +1.142701709722276e-01   +6.173712112189492e-01   +8.295314469817360e-01   +2.309372434166657e-01   +6.422181814396446e-01   +7.319615871766038e-01   +5.513057158239584e-01   +7.358399034112729e-01   +6.741085008358836e-01   +9.171058288383904e-01   +1.739042526037062e-01; +4.835313967670595e-01   +4.724370558503296e-01   +1.426249369669909e-01   +6.577016952894628e-01   +2.662320740707044e-01   +8.182313840111352e-01   +1.549851067235100e-01   +7.069470134743558e-01   +9.988186706310305e-01   +1.019696036519612e-01   +7.704630380454471e-01   +5.322982934134567e-01   +2.109089071455367e-01   +4.435277970058832e-01   +8.846242946563303e-01   +7.443300518069715e-01; +2.857372032790451e-01   +1.866597787817083e-02   +6.055322377384313e-01   +4.808368800747765e-01   +9.485359822650630e-02   +6.505618655643512e-01   +5.836904725729094e-01   +1.160811221376831e-01   +9.060448726176156e-01   +4.919903988381462e-01   +6.773320572401930e-01   +9.012112894307757e-01   +4.842693178405638e-01   +8.940299311105832e-01   +9.250873790863991e-02   +4.749357524916012e-01; +4.036830527758096e-01   +1.180413735720565e-01   +8.891695669654659e-01   +9.785657474311701e-01   +2.319030509779797e-01   +2.380420618162985e-01   +5.452666126362911e-01   +7.406457265170844e-01   +1.129840274875588e-02   +5.609344745580619e-01   +8.137355882816817e-01   +2.834780051357079e-01   +5.071281643065623e-02   +7.831348339498071e-01   +6.758063472784489e-01   +2.466740087039321e-01; +4.918088825134054e-01   +7.193692659913756e-01   +5.623410586887322e-01   +8.641145828409710e-01   +8.955706425863360e-01   +3.017882829199874e-01   +6.812051090745046e-01   +9.242712505742682e-01   +8.334584999750874e-01   +5.579274245532962e-02   +4.187937467537373e-01   +1.391358051069889e-01   +5.712368684543976e-01   +5.819934171844521e-01   +9.243923240487112e-03   +6.629571222116821e-01; +8.626899921312482e-01   +6.823794391000637e-01   +6.333237691834743e-01   +9.547249232068857e-01   +1.998923123066057e-01   +3.305785948338169e-01   +6.988189178659501e-01   +9.238301397859789e-01   +2.537337360508227e-01   +8.875130349184031e-02   +4.976988367841744e-01   +9.577262400820867e-01   +4.911607336454317e-01   +6.158852297787929e-01   +1.217976441151236e-01   +6.088986112189221e-01];
L2E_L1E_iAMPA_netcon = [+3.678657797704841e-01   +5.616537845304157e-01   +2.010050142340421e-01   +5.134820402691753e-01   +2.902431286947227e-01   +7.441436285931212e-02   +2.789562937819532e-01   +2.666993701271313e-01; +4.371214082336901e-01   +1.929496651372899e-01   +1.367380287508909e-01   +6.856860451127309e-01   +6.196900935618368e-01   +5.929485388277872e-01   +9.292713746589208e-01   +9.044834915696557e-01; +7.181044693315678e-01   +6.130114647500490e-01   +8.212038775842159e-02   +2.065967358166634e-01   +8.626517933549183e-01   +7.551980224811700e-02   +7.643922953087841e-01   +1.592633183176975e-01; +1.912008644629772e-01   +7.407373709330863e-01   +9.078813520070683e-02   +9.712141911704780e-01   +8.205545361606754e-01   +3.971579064265913e-01   +2.615092335220284e-01   +5.537141499153094e-01; +4.032325508574573e-02   +8.314279303955493e-01   +5.514469039648361e-01   +3.501224625597027e-01   +2.054627255029191e-01   +5.893000629767816e-02   +2.433892218966315e-01   +4.220786731671189e-01; +3.148953517028948e-01   +2.767033466295201e-01   +7.321099502772606e-01   +1.849310523155580e-01   +7.506020148257766e-01   +1.285305669111454e-01   +1.653929476536235e-01   +5.467855222958570e-01; +7.899855703582428e-01   +6.083893856027421e-01   +5.446315838370576e-01   +2.382252164151822e-01   +1.984825519042424e-01   +2.450143891960425e-01   +2.874670193223908e-01   +7.545623416009589e-01; +4.709650570581089e-02   +5.476187597982588e-01   +5.474366124633291e-02   +2.538921093319348e-01   +5.777956436346466e-01   +9.442751137081569e-01   +5.641338279920842e-01   +1.390147130130138e-02; +2.156585552060672e-01   +2.737986503976090e-01   +6.329634282569587e-01   +2.228702784357358e-01   +8.770092404594826e-01   +2.032612238585037e-01   +4.051446321702068e-01   -1.557176994906285e-03; +2.738504122139772e-01   +3.394333797501687e-01   +9.939821107743890e-01   +3.580053782276758e-02   +7.147251269422229e-01   +3.279644076970084e-01   +9.875142433239541e-01   +2.107724298437759e-02; +7.898904937963248e-01   +5.666337395272272e-01   +9.152522248762335e-01   +3.567252494960415e-01   +7.006822537450347e-01   +8.665504381067499e-01   +5.447366994901388e-01   +3.591347329638184e-01; +9.903473851484335e-01   +7.436705729847841e-01   +7.682749885812242e-01   +8.986541185210851e-01   +4.679949774836467e-01   +9.227349088859768e-01   +9.293069942162389e-01   +4.267227653043021e-01; +9.472868857064298e-02   +7.724215262463852e-01   +1.904450565783657e-01   +1.406828338877484e-01   +5.040100166153227e-01   +2.385895432861268e-02   +9.929019138697240e-01   +5.445267041985258e-01; +1.959149633059948e-01   +3.977313943974521e-01   +3.162042028822620e-02   +9.554656440037524e-01   +7.962612262975957e-01   +3.647685552484300e-01   +8.364542189350055e-01   +4.921537491859915e-01; +1.164247396575184e-01   +1.486845213910471e-01   +3.730938979403614e-01   +9.021098155291983e-01   +9.400959593263497e-01   +5.276969686128009e-01   +1.809895498079310e-01   +9.205234621928514e-01; +6.473441923705696e-01   +2.075086423025084e-01   +5.752794669304044e-01   +4.106842745325883e-01   +7.824142882771298e-01   +4.070839548791044e-01   +3.138178491670306e-01   +4.160788263804010e-01];
L1E_L2E_iAMPA_netcon = [+4.965246114695365e-01   +4.489302980301922e-01   +6.157710624712559e-01   +4.907780069248289e-01   +2.299789838294471e-01   +7.205339469993337e-01   +6.945622899836248e-01   +6.331200364960550e-01   +5.219950080258516e-01   +2.416162404050818e-01   +8.767012719561353e-01   +1.734944912650846e-01   +1.378631985656394e-01   +2.435915409501837e-01   +1.832804079775993e-01   +2.371521667282126e-02; +8.386609807474339e-01   +3.693507568300102e-01   +1.041330652635639e-01   +6.611845466003733e-01   +8.357960214513100e-01   +3.804204000894310e-01   +9.792260394414450e-01   +6.266844828981680e-01   +6.727862344079217e-01   +7.284931497237588e-01   +6.588003353612497e-01   +3.021364259925181e-01   +2.819859053103704e-01   +7.488800594695555e-01   +1.462343634734003e-01   +2.505262639689485e-01; +1.849760824664517e-01   +3.009414068008127e-01   +7.525705218448050e-01   +1.788575810555386e-01   +7.342340245473258e-01   +3.837083391174153e-01   +7.502209576920635e-01   +4.065493128213273e-01   +7.780928780002390e-01   +1.363433754941364e-01   +5.377026926536026e-01   +1.091299399668800e-01   +7.037189902316266e-03   +9.367770466785530e-01   +1.318175896583572e-01   +9.892010281958658e-01; +3.366737155033821e-01   +2.325670065813808e-01   +5.365856564109348e-01   +4.800863580919263e-01   +4.887439745977393e-01   +7.156993700276630e-01   +5.540083195018928e-01   +4.251736602905843e-01   +4.645250449952308e-01   +4.081599370121043e-02   +2.525576263924476e-01   +4.514094633708828e-01   +3.061240096988536e-01   +2.970910876675888e-02   +1.715987141721341e-01   +6.298825993019541e-01; +6.922229014618781e-01   +1.366022857494865e-01   +4.438320626739295e-01   +4.986139268624613e-01   +8.487136015068037e-01   +8.393936186520168e-01   +2.993083372805034e-02   +5.105889817292145e-01   +9.076934459166646e-01   +6.499052159686907e-01   +1.044981715282651e-01   +5.844491755974134e-01   +9.049212299235988e-01   +4.352227917447536e-01   +9.228534063045335e-01   +3.578008010367710e-01; +6.926256479677778e-01   +9.976091752489161e-02   +7.429151092622344e-01   +5.999817523873093e-01   +7.154630466379249e-01   +6.683675943666751e-01   +1.947478912105788e-01   +2.595089874530803e-01   +2.566479144914404e-02   +2.001371895332524e-01   +9.720650499078646e-01   +2.243699148654551e-01   +2.944147710471742e-01   +8.307027313713754e-01   +2.587091928729438e-01   +9.393634675385720e-02; +3.680762153239336e-01   +2.269178478525736e-01   +3.879768681994995e-01   +2.405967413812622e-01   +5.210671777273415e-01   +6.509789945423980e-01   +9.415087480848828e-01   +4.233163434446843e-01   +4.795327961671234e-01   +9.735660032887175e-01   +5.973522314631898e-01   +1.105682624456440e-01   +8.328410153409628e-01   +9.996474918498451e-01   +2.058668872409915e-01   +4.097180086162217e-01; +3.491885267515934e-02   +3.461487678777114e-01   +5.260266000245754e-01   +5.165700214286333e-01   +9.380242067932824e-01   +5.634553877507031e-01   +3.975367371749710e-01   +5.238490252786444e-01   +2.716333032152605e-01   +8.208393661703154e-01   +8.188357560637243e-01   +5.602930731358167e-01   +7.451781413236498e-01   +9.202161199397760e-01   +6.132812693743871e-01   +9.312907215783582e-01];
L2I_L2E_iAMPA_netcon = [+6.777941832039650e-01   +6.145766983689541e-01   +4.141648920878064e-02   +7.932018364831128e-01   +5.245282540546604e-01   +8.261408813862973e-01   +6.439702756685448e-01   +3.863073064313985e-01; +2.344810461744738e-02   +9.452482567192410e-01   +5.409046114355943e-02   +9.294115646396082e-01   +5.479701799286401e-02   +1.078550227924465e-01   +3.947577826227556e-02   +1.669776191217680e-01; +7.333393316738938e-01   +9.636989331816365e-01   +4.008253772694426e-01   +9.366569864466998e-01   +2.867922153822376e-01   +2.316412916544050e-02   +5.684968990592186e-01   +4.440053183389690e-01; +2.127261583492032e-01   +3.684123188106352e-01   +9.836017365310536e-01   +1.462539031830050e-01   +7.101066882849404e-01   +1.174182538687597e-02   +3.039118537694888e-01   +8.731961031787823e-01; +8.603673931376995e-01   +7.950775500184492e-01   +7.125598264058978e-01   +3.192786357423469e-01   +8.786667554665691e-01   +3.364308227673710e-01   +2.612658619575117e-01   +4.112061015845136e-01; +1.573395764954819e-01   +7.280502613595486e-01   +9.880764048939912e-01   +4.276883588533408e-01   +3.662257517133068e-01   +6.632950857260969e-01   +7.217511723467056e-01   +1.625417543806051e-01; +6.685241420139794e-01   +9.539946224020917e-01   +6.455061194267252e-01   +7.011180565743403e-01   +5.610018451878108e-01   +5.952304454063582e-01   +3.055211324885315e-01   +6.624796340736625e-01; +9.359775357228657e-01   +1.151639239715168e-02   +5.025509637890702e-01   +6.156980101070577e-01   +8.839486015977700e-01   +8.093503397811974e-02   +8.948807914667006e-01   +9.255595685510649e-01];
L2E_L2I_iGABA_netcon = [+6.033602267874761e-02   +5.186399839223664e-01   +3.524652916104551e-01   +2.621377925734901e-01   +4.266694953773672e-02   +8.906679499097119e-01   +3.443457423552826e-01   +4.513290060538943e-01; +3.536541673105878e-01   +6.970581611285882e-02   +5.572281245592651e-01   +9.850651428125753e-01   +3.608866074419099e-01   +5.405783605347306e-01   +9.349944685842770e-01   +6.712997446278324e-01; +9.316339485500732e-01   +1.841570187566869e-01   +6.920154390378186e-01   +3.493937805796937e-01   +3.584465635361757e-02   +7.171249452807041e-01   +9.187102643791608e-01   +7.688729432948539e-01; +2.420673238836837e-01   +3.174297432736621e-01   -6.368055406029758e-03   +4.026607018487215e-01   +4.854885656428149e-01   +7.109925751681754e-01   +7.251669543436443e-01   +9.269184620917778e-01; +1.024196839665129e-01   +2.439223795089834e-01   +4.775532031523951e-02   +7.518770685299164e-01   +7.235194157748432e-01   +1.696047174519233e-01   +4.430478084010108e-01   +6.584819283203794e-01; +7.163285126602680e-01   +3.225798329740800e-01   +3.075835412439979e-01   +1.010900459169490e-01   +1.419637290710184e-02   +3.522974703046417e-01   +1.509820368610475e-01   +5.020740258200547e-01; +5.639727585411458e-03   +8.788625067133914e-01   +8.690873598652267e-01   +5.904334946724858e-01   +5.173909102107141e-01   +3.787411673370761e-01   +8.313679729583504e-01   +3.416294027242684e-01; +1.855103174394957e-01   +3.007705084963709e-01   +6.272857629170875e-01   +1.239698867846717e-01   +2.393333769322834e-01   +7.573047369043150e-01   +2.570214661997687e-01   +9.459090625925598e-01];
L3E_L2E_iAMPA_netcon = [+7.991632951685443e-02   +1.486173957652660e-02   +3.682065187876943e-01   +4.960911292284596e-01   +1.703369265636056e-02   +9.557488154866131e-01   +3.594622642778705e-01   +1.350457895086646e-02   +2.040553601388230e-01   +6.218996614180295e-02   +2.435621015932994e-01   +9.985019965238605e-01; +9.526640107080291e-01   +9.767605654006259e-01   +1.165738977058226e-01   +6.588236961259832e-02   +8.058006865498497e-01   +3.875000538999808e-01   +2.246047789483015e-01   +1.207519034296395e-01   +3.566457687269610e-01   +7.412017420654603e-01   +5.340805904755132e-01   +3.442929679223373e-01; +6.627750799445948e-01   +7.240861501933064e-01   +5.145359416036165e-01   +8.617672831364828e-01   +7.916494405890759e-01   +6.645300215041680e-01   +7.251046689907087e-01   +6.694735396108723e-01   +8.878054556386005e-01   +9.903010911519609e-01   +3.332173446203310e-01   +8.220956027821634e-01; +1.686162407647429e-01   +8.724613270721363e-01   +7.002193761688118e-03   +9.966978801610630e-01   +4.234771227780743e-01   +5.854088266911088e-01   +7.721682573001569e-01   +5.077822558971760e-01   +8.081348635610620e-01   +7.672676957270966e-01   +6.745928667447780e-01   +1.089343130463647e-01; +1.969101485944973e-01   +8.152823775540047e-01   +8.691450293351918e-01   +1.227111652807034e-01   +6.309364520181197e-01   +5.924396066415407e-02   +3.423495389623034e-01   +6.974651505058156e-02   +3.198211762737504e-01   +8.818028005571384e-01   +8.752196043075985e-01   +7.730987216287799e-01; +9.952765178505925e-01   +3.037811139304537e-02   +9.037066581958421e-01   +1.002451757513770e-01   +5.683615884741394e-01   +7.543210802677495e-02   +5.760225727783320e-01   +5.354755679303165e-01   +6.007210189649334e-01   +3.629256356064648e-02   +9.829269944181780e-01   +1.500824499518656e-01; +9.255801897560232e-01   +9.645918049759809e-02   +1.127694696348866e-01   +1.495738198293874e-01   +8.960006699490397e-01   +2.282314536881752e-01   +6.433169259486129e-01   +6.779269058709602e-01   +6.988802355358931e-01   +7.942530819938534e-01   +1.456082979144979e-01   +7.309719679589838e-01; +9.823102259365752e-01   +8.537999602483985e-02   +4.427628965861453e-02   +1.292356406649500e-01   +7.493866151442360e-01   +4.207303845958953e-01   +3.665588636691006e-01   +5.880197417136577e-01   +1.777730608673794e-01   +7.066178818162239e-01   +8.766418034865661e-01   +1.087970466497066e-01];
L3I_L2I_iGABA_netcon = [+7.684770745084792e-01   +5.349598660167827e-01   +5.965839296623824e-01   +3.036462529468952e-01   +9.652903048559119e-01   +1.146510458222927e-01   +2.976589757254723e-01   +7.950289341723331e-01   +9.141930119320906e-01   +9.959599301056928e-01   +3.099291488069534e-01   +9.966717141625708e-01; +6.363630793601988e-01   +4.531176072897363e-01   +5.635477751208716e-01   +7.634698733752388e-01   +5.437523204320484e-01   +7.089094487875920e-02   +1.673509456468065e-01   +5.223639639355364e-02   +3.859910348375449e-01   +2.876502699420634e-01   +4.421243860046963e-01   +9.150404809292467e-01; +7.960099637635029e-01   +1.147243139454257e-01   +6.805277838797337e-02   +6.475881909220459e-01   +9.817166623165139e-01   +5.055443981061662e-02   +7.247057200127959e-01   +1.811760575936853e-01   +7.514225674643973e-01   +5.156317424347067e-01   +2.094815078556450e-01   +6.908316143845290e-01; +9.591790499404328e-01   +7.208499307167187e-01   +7.681448207083466e-01   +3.321812346007979e-01   +1.246697438935742e-01   +1.306147950691245e-01   +2.987886218854524e-01   +2.460736668728797e-01   +8.782430957606240e-01   +3.586267672971369e-01   +9.409065044034052e-01   +2.210258416296169e-01; +7.174991127739141e-01   +1.851541805144019e-01   +8.681968396900528e-01   +9.705653843748675e-01   +1.685945679774234e-01   +4.908720263131865e-01   +6.781423671652999e-01   +2.613213383178870e-01   +3.922155773596654e-01   +5.170089729296835e-01   +2.904498929329282e-01   +3.141736177275573e-01; +6.439055980997743e-01   +3.249644982888089e-01   +7.095566402346699e-01   +5.321543226659037e-01   +3.343192918368296e-01   +4.680825735320263e-01   +7.465447193698137e-01   +6.477030500339833e-01   +1.671961078117307e-01   +5.008788561814882e-01   +1.221545438524048e-01   +2.368761946653706e-01; +5.113530311277138e-01   +9.672997998460021e-01   +1.085612885205915e-01   +7.517190020260321e-01   +5.308134121015284e-01   +1.585390670927752e-01   +7.452909476292892e-01   +9.778472468671998e-02   +4.370334866340145e-01   +1.883063693249218e-01   +6.976552227280874e-02   +7.086175953384322e-01; +9.514786696741370e-01   +7.011076091953219e-01   +6.652803949766201e-01   +2.704641567506136e-01   +6.924785784308365e-01   +1.382890063272139e-01   +7.848044441531381e-01   +4.691471664646130e-01   +8.582133832304790e-01   +4.774815055575228e-01   +7.289244045560802e-01   +3.749798878655246e-01];
L2E_L3E_iAMPA_netcon = [+6.561681945818070e-01   +3.867849526158459e-01   +2.346618694929552e-01   +4.634541196006743e-01   +9.049677602975258e-01   +9.502513564606085e-01   +7.625550949858102e-01   +3.548492213161850e-01; +3.841951304011050e-01   +2.323549420736378e-02   +9.043050636531048e-01   +2.836049045130042e-01   +6.798829754327642e-01   +2.626429310207604e-02   +9.033604524571968e-01   +6.641269658673445e-01; +3.081256115375179e-01   +3.301592968922024e-01   +4.874708811114285e-01   +2.762089316943047e-01   +8.421749606876645e-01   +5.011903255706146e-01   +7.959579125450568e-01   +5.923409483907049e-01; +1.573965249862261e-01   +4.846913288350672e-01   +5.962076883529940e-01   +1.420284084109356e-01   +9.454909923485721e-02   +3.388792646787787e-01   +9.563218018724747e-01   +5.475952527275182e-02; +7.778983108052041e-01   +2.614236299336543e-01   +9.553445355544037e-01   +1.399710691097430e-01   +7.351531629291040e-01   +6.719573408342253e-01   +5.352077491099697e-01   +2.165154604110097e-01; +7.093083873717253e-01   +5.267456834314186e-01   +8.515901534453484e-02   +2.655507418274906e-01   +5.431458228793702e-01   +1.678855712978674e-01   +1.642712407402759e-01   +6.027243407360459e-01; +1.732820175575806e-01   +4.167285637354030e-01   +2.228224402639687e-01   +6.103004001231714e-01   +2.562443012094022e-01   +2.269963258614334e-01   +1.350553039967134e-01   +2.691297845432518e-01; +4.481482441278863e-01   -4.852964059134906e-03   +1.512553571472104e-01   +1.058155536186061e-01   +7.144495133449590e-01   +1.181628604470949e-01   +3.411028117504239e-02   +1.094550942839132e-01; +8.375919079986899e-01   +8.938760067565952e-01   +3.893320973495554e-01   +4.850911180362347e-01   +3.598650814556736e-01   +9.929001091864037e-01   +6.809629556705188e-01   +2.114680482221786e-01; +6.970325049055202e-01   +2.383640543632050e-01   +1.851613744412081e-01   +8.934439067293221e-01   +8.543877543907317e-01   +1.397334181491687e-01   +5.872209564365922e-01   +8.732024252722954e-01; +7.652296828932504e-01   +7.928147565912410e-01   +7.629111575461313e-01   +1.880038386701869e-01   +8.188159562948808e-01   +7.688655109976867e-01   +2.990913125917649e-01   +4.593277587648479e-01; +9.800606690303739e-01   +5.788510185210782e-01   +2.289562575671176e-01   +5.176573784680609e-02   +6.110367467273866e-01   +6.346949364121204e-01   +7.386255274901631e-02   +7.271640369661722e-01];
L2I_L3I_iGABA_netcon = [+5.894616534499427e-01   +1.472939374232793e-01   +3.443233458548581e-01   +3.693538130361370e-01   +5.990969746521413e-01   +5.073942825127794e-01   +7.734241779134224e-01   +2.648426178424022e-01; +8.458736191189083e-01   +9.906747972465283e-01   +4.623036537918830e-02   +5.375067561615157e-01   +4.784022216160373e-01   +2.371033300663022e-01   +1.789910741231213e-01   +5.853148299971425e-01; +6.051199145462346e-01   +4.810205129459913e-01   +9.421007629323461e-01   +9.747860961344863e-01   +3.769817877410582e-01   +2.719835623259896e-01   +4.542525826339054e-01   +6.795288656848103e-01; +7.436493730435809e-01   +3.546411749770700e-02   +8.674706177177252e-01   +9.971269646650918e-01   +9.783417995571548e-01   +4.054301436712344e-01   +3.055016860967078e-01   +4.151416863771348e-01; +8.492387750239550e-01   +2.698960800758042e-01   +1.329260578661411e-01   +4.150459182457351e-01   +1.385168022726109e-01   +2.600089768248950e-01   +3.876114172061096e-01   +5.118258272614318e-01; +1.462290382922403e-01   +6.762122918056362e-01   +5.914085977157163e-01   +4.512563182073343e-01   +2.712459270551091e-01   +8.541377588908587e-01   +8.032036177135782e-01   +8.146911431843930e-01; +7.419357982613021e-01   +1.473804586768191e-01   +6.259457486007862e-02   +2.548686182122880e-01   +2.253529941082424e-01   +4.795285839850391e-01   +7.781799840078292e-01   +5.446058050956906e-01; +1.725711469317955e-02   +7.744301509076381e-01   +9.474092998821829e-01   +6.014026859939335e-01   +7.906500792145458e-01   +3.413126597990088e-01   +6.449423713529960e-01   +5.891066441689400e-01; +2.285454290191708e-01   +2.674986671079211e-01   +4.966961401677182e-01   +7.813437442558675e-02   +8.170917422752064e-01   +6.394388777890769e-01   +2.419217380037395e-01   +5.354165230717275e-01; +5.375333577582503e-01   +8.811691374903564e-01   +2.642092171021200e-02   +9.121588009250950e-01   +7.921083098674752e-01   +4.159558415684852e-01   +6.096166714920092e-01   +5.419893268554947e-01; +7.208827105080748e-01   +3.684966271542515e-01   +5.745952206960832e-02   +4.725970934433905e-01   +1.128063146338370e-01   +5.429720420281068e-01   +4.200075112850686e-01   +1.513061445375016e-01; +4.335909602928070e-01   +9.833128605629390e-03   +3.002745109145490e-01   +5.083712358420673e-01   +6.330309039871674e-01   +3.392901183175651e-01   +2.938692182178326e-01   +7.028288804230945e-01];
L3I_L3E_iAMPA_netcon = [+6.484481295995775e-02   +7.736448788210100e-01   +5.555239427874734e-01   +5.734673518209370e-01   +9.201391345943005e-01   +8.347939984813065e-01   +8.490357259919165e-01   +8.626574039385173e-01   +5.339888107787147e-01   +9.884624208384066e-01   +4.814929067786017e-01   +3.509763973178596e-01; +9.221660783108477e-01   +8.392096699913876e-01   +8.443941625318329e-01   +9.350480272999869e-01   +5.920071208161605e-01   +3.924344890363106e-01   +6.282427930534475e-01   +8.559200448620425e-01   +5.668721682304546e-01   +7.011829376715600e-01   +7.392749232833147e-01   +3.998705559490781e-01; +1.807981429348838e-01   +5.926125245022663e-01   +9.690683567391908e-01   +7.789803502757481e-01   +5.749286592682918e-01   +6.937976324119104e-02   +4.446154309276056e-01   +9.492582665378189e-01   +9.804278118565017e-01   +8.440126713899591e-01   +5.948743802014432e-01   +9.873427746393819e-01; +5.438342011353648e-01   +7.675894038203215e-01   +4.670342175940724e-01   +5.976882038658425e-01   +6.584478501773559e-01   +3.732549047319842e-01   +2.346106231079241e-01   +6.934911105232445e-01   +9.678710978932941e-01   +7.381446056294123e-01   +2.631417502640457e-01   +2.970324808853826e-01; +3.969191448194773e-01   +6.583642796896158e-01   +7.758986557192910e-01   +5.800214518028921e-02   +4.351935702215690e-01   +8.499126693294827e-01   +5.043170997596907e-02   +3.636588001315675e-01   +5.605132943166770e-01   +9.958943974079688e-01   +6.076358976026492e-01   +2.241393179376189e-01; +9.514420096906152e-03   +5.891396579196577e-01   +2.102336939260623e-02   +5.435339669119378e-01   +9.357517395802892e-01   +2.445699004576248e-02   +7.132358876864304e-01   +3.734105971535450e-01   +5.328536116047942e-01   +5.076581011106868e-01   +2.322810833194730e-01   +3.310468779420662e-01; +1.024603091016468e-01   +2.625391061442006e-02   +6.772346192943476e-01   +8.642263408187782e-01   +1.019987764809375e-01   +4.220070286307059e-01   +8.487200639493628e-01   +8.426610939820975e-01   +4.783175104008123e-01   +1.897607243369537e-01   +1.948545273630550e-01   +1.652005057339140e-01; +8.563498919973109e-01   +6.928432077849286e-01   +8.353134480929758e-01   +3.385569770217333e-01   +4.097082494497622e-01   +2.548857491887124e-01   +4.049674782519757e-01   +3.834002982624081e-01   +9.006554391628836e-01   +9.596604248885389e-01   +2.223173652822886e-03   +3.842873863742575e-01; +3.385093873128331e-01   +3.271770846259001e-01   +6.844088860727744e-01   +1.790618448494761e-01   +8.925980040165450e-01   +7.403422480965494e-02   +2.867180447834538e-01   +7.695280211676673e-01   +4.818982932343139e-01   +4.529425452124600e-01   +6.465682571835202e-01   +5.259317230041758e-01; +1.499563881920607e-01   +7.601733806002341e-02   +8.964489940589884e-01   +8.813565105396163e-01   +7.382414085477695e-01   +9.209751396827591e-01   +2.628709300469513e-01   +7.725823247109730e-01   +4.873450503383955e-01   +6.051812050042712e-01   +3.996777188501713e-01   +5.948030090719898e-01; +8.073772341804699e-01   +7.438455406321707e-01   +9.518959768845731e-02   +8.415879781710507e-01   +9.584935217504487e-01   +2.680407340206131e-01   +5.046982333186258e-01   +4.338573723650442e-01   +3.141762122893756e-01   +6.433876661063348e-01   +2.718379997963530e-01   +1.699377567778605e-01; +6.556460495893893e-01   +9.652437333007986e-01   +7.142411132929934e-02   +8.335774019137874e-01   +9.703252454072371e-01   +1.007904791721187e-01   +1.167426294089924e-01   +4.879835674499700e-01   +8.593809867591895e-01   +7.668401037193898e-01   +4.161748954172794e-03   +7.267510628584878e-02];
L3E_L3I_iGABA_netcon = [+4.377223094631281e-01   +7.133403596120221e-02   +4.763460629567880e-03   +4.949782763330169e-01   +5.436746958531715e-01   +2.519801262450309e-01   +7.182830990175736e-01   +7.609363042993442e-01   +3.781747781430386e-01   +4.485631370036895e-01   +2.003969372755244e-01   +6.495596466596051e-01; +5.804265300985619e-02   +8.078339245443870e-01   +1.326452477635589e-01   +1.942620596724633e-01   +2.118306689102574e-01   +3.345960229198797e-01   +2.226773752108956e-01   +8.889202313330802e-01   +6.113007991313276e-01   +3.944377641883274e-01   +8.282713657824041e-01   +8.982099574240379e-01; +6.251497986096523e-01   +9.099808192918744e-01   +3.085613895238059e-01   +6.418670760196169e-01   +2.693239018254626e-01   +5.914340723929669e-01   +4.983649729369568e-01   +7.314573917194890e-01   +1.682474684894497e-01   +6.677720614862611e-01   +4.467126066754037e-01   +8.381379347331396e-01; +7.983918415563704e-01   +4.254320448617267e-01   +2.384822326187390e-01   +2.554914972134765e-01   +1.329106899073279e-01   +4.820079829656033e-01   +4.752637588378958e-01   +6.972808793679831e-01   +1.053478381828927e-01   +3.367344046072180e-02   +4.256497877991673e-02   +1.708235269088192e-01; +4.010038518722280e-01   +1.841970788171587e-01   +6.496284245659322e-01   +9.483910630322865e-01   +1.655792324274881e-02   +8.976909875261563e-01   +4.313235067683278e-01   +6.466906967607531e-01   +6.256549178182793e-01   +7.869751034784385e-01   +7.689985074871586e-01   +1.609304473392180e-01; +8.844738778900402e-01   +1.833556100473471e-01   +8.084729802199929e-01   +2.879191122909928e-01   +1.529814144349387e-02   +2.950236039993526e-01   +5.568271558581940e-01   +6.209046424731856e-01   +9.527961415149662e-01   +3.785573604497832e-01   +9.835477178900474e-02   +1.357250608074637e-01; +7.222535081867629e-01   +6.722302583894710e-01   +7.394223964750728e-01   +1.489788913213374e-01   +9.789162357309031e-01   +7.932320307588844e-02   +2.069844238744186e-01   +7.855952529368565e-02   +6.656402938642423e-01   +6.508109768486540e-01   +6.526843922413765e-01   +1.589310961179733e-01; +1.971690425477316e-01   +5.243191310138029e-01   +1.228197683694094e-01   +8.704655548067985e-01   +6.468213211744283e-01   +3.922481070364888e-01   +2.774127657918519e-01   +5.482923802184946e-01   +4.727860276919286e-01   +4.972191866394614e-01   +2.702759511655006e-01   +3.944360579262832e-01; +3.740327639040901e-01   +7.767152824214085e-01   +1.728397950692034e-01   +8.868635772714096e-01   +8.160148743491021e-01   +1.987654616966877e-01   +8.120144733260579e-01   +8.845035314707715e-01   +3.407337409190324e-01   +2.127241772574707e-01   +4.367217605969442e-01   +6.671699605995978e-01; +2.114452717989359e-01   +2.991822927892706e-01   +2.743151471696362e-01   +6.685305222908390e-01   +2.759508954700655e-01   +7.227090288512934e-01   +9.565114959950922e-02   +9.871759135492217e-01   +5.909923752687978e-01   +2.169379592485342e-01   +8.491923429744594e-01   +2.226791229485101e-01; +2.591463203883451e-01   +4.740202759429377e-01   +8.149779586565873e-01   +9.973881014042065e-01   +1.595446984950022e-02   +4.217377451992301e-01   +3.304718151107069e-02   +7.102600923516075e-02   +5.454973263453393e-01   +4.516655187564138e-01   +9.020812937736372e-01   +6.435125832408963e-01; +9.916035015180392e-01   +7.063898090151377e-01   +5.916624496282771e-01   +2.679937752429644e-01   +1.015993474632776e-01   +2.684299175459048e-01   +6.487610553448622e-02   +3.282102417149005e-02   +3.955729959852922e-02   +6.291633421228618e-01   +2.849897723531031e-01   +6.118876088425883e-01];
L2E_Input1_iAMPA_netcon = [+9.921256580161587e-01   +9.901073829063139e-01   +9.999898614985020e-01   +9.871396272948668e-01   +9.850580806714986e-01   +9.990279324588810e-01   +9.829606202238396e-01   +9.967015243341198e-01];
L2I_Input2_iAMPA_netcon = [+9.923427797902483e-01   +9.987913692112282e-01   +9.849998162114830e-01   +9.946364821654140e-01   +9.886767928579113e-01   +9.900164585777289e-01   +9.951076606094571e-01   +9.964797379815837e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
