function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+6.450919907372691e-04   -7.674269211716822e-04   -1.293234391492885e-03   +3.494679638301261e-03   +3.195695589232753e-03   +4.544492264430958e-03   +2.363698029669477e-03   +7.881086775873105e-04   -3.140110429931990e-04   +7.392433000400607e-03   -1.365265572203410e-03   +4.163184987797552e-04   +3.838532490810299e-03   +6.026810404723767e-03   +7.342893002130063e-03   +1.665158721280422e-03; +1.902260481801266e-03   -2.087152272889082e-03   +2.389837401464176e-03   +3.806221257032357e-03   +3.446599216798593e-03   +2.396333213442011e-03   +5.059533241733303e-03   -1.676767543999806e-03   -1.971560788678980e-03   +7.334148949506372e-03   +6.658148325878156e-03   -1.574009548742050e-03   -8.484439866489604e-03   -1.389515184674041e-03   +2.333025967428292e-03   -6.310970113095225e-04; +3.006645965771309e-03   -4.149388622139018e-03   +1.816593973163009e-03   +1.668271521319955e-05   +6.831730682969339e-04   +1.074759098659057e-03   +5.438755195071726e-03   -3.304475537208681e-03   +7.811650712747368e-03   +2.740597401805154e-03   +5.714835870480012e-03   -3.315415593604467e-03   +3.512998368907818e-03   +2.348286073955036e-03   +1.657841435475060e-03   +1.421393963670184e-03; +6.712718820046168e-03   -1.908530709028129e-04   -5.097802522307812e-03   -1.461270852796173e-03   -5.948680305215061e-04   +1.908253063159831e-03   +8.158470524614657e-04   +2.439365369377911e-03   -2.157537089340239e-03   -1.098707290586065e-03   +4.194630074340018e-03   +5.157327802098566e-03   +7.766957368884558e-04   +3.435053299563014e-03   +8.820307209142068e-04   -8.235422532605828e-03; +3.880566844457233e-03   -1.076651493648412e-03   +6.274637647437300e-03   -1.997865735728134e-04   +2.271545436248418e-03   -4.422820912906235e-03   -7.479451867377638e-04   +2.148341711328041e-03   -6.264027670415909e-04   +2.310821716303994e-03   +6.005417784337441e-04   -1.103274855815361e-03   +4.582426145886183e-03   +7.315923712610400e-04   +5.269164824490344e-04   -6.571166739448764e-04; +4.448048863505960e-03   -4.613203857107490e-04   -6.466111278261889e-04   +4.236786633314313e-03   +5.942381265294406e-03   -1.138895110108159e-03   -4.222434580967245e-03   -6.452964809166579e-03   -6.575045282181606e-04   -1.676300998878755e-03   -3.630764363833514e-03   -2.942832629038313e-03   -8.412725896183916e-04   +2.053395287966402e-03   -3.801399180445046e-03   +3.269881828090948e-03; +5.221634336018141e-03   +2.204291012124590e-03   -5.483324019201581e-05   +2.135872429838799e-04   +7.722019110943897e-04   -2.434617455476406e-03   +3.188709115922298e-03   -1.335701375896911e-03   +4.071902781930035e-03   -1.172217601781464e-03   +2.805680164188314e-03   +6.604960735789915e-05   -3.739927127205241e-03   +4.785106171962235e-03   -1.622820896899361e-03   -6.116845705963873e-05; -1.395002693966107e-03   -1.953011727391566e-03   +5.178354088416656e-03   +5.386774448778442e-03   +1.515465076176410e-03   +1.237162561971426e-03   -1.131846927095533e-03   -2.114711416266683e-03   +7.049406941592075e-03   -2.798097302957744e-03   +4.011097679651896e-04   +2.048643457361650e-03   +5.907659141533712e-03   +1.390857311619771e-04   +5.432215950627549e-04   +4.835602342534578e-03; -2.980788596447305e-03   +3.758285166250433e-03   +4.259519318847572e-05   +2.116438542934942e-03   -1.656344009067460e-03   +1.832847972377860e-03   -2.248403507940681e-04   +1.844841954471176e-03   +4.638675373241582e-03   +3.752568905063909e-05   +3.367103177460372e-03   +3.233299734887124e-03   +2.015661534205642e-03   +1.348580089064564e-03   +2.823944529595499e-03   -1.453556599746742e-03; +2.770061568919142e-03   +2.330209890771793e-03   +8.656483769835334e-03   -4.160605252852220e-03   -6.766392787392549e-03   -1.375585777428070e-03   +4.028005960674316e-03   -3.688462057762742e-03   +5.563875259556187e-03   -3.334396267686085e-03   +2.034342177717178e-03   -1.287196402619007e-03   -4.043683330331132e-04   +1.216025648404058e-03   +2.991867052580696e-03   -6.854549372791357e-04; +6.111317669181869e-03   -1.425100611296278e-04   +1.668391112565203e-03   -4.911825026344672e-03   +2.134245034528197e-03   +5.274667226381617e-03   -9.725039842608768e-04   +4.409444069932847e-03   -2.727420648125915e-03   +1.780234768078273e-04   +3.182321349635086e-03   -2.231420922009132e-03   +1.235299714247812e-03   +3.983641018672131e-03   +1.130415414037071e-03   -3.041345531121910e-03; -1.985265861992382e-03   -6.038237091525367e-03   -3.669783071654145e-03   -2.025857702856670e-03   +5.747448104503047e-03   -3.480095573805912e-03   -1.326193772182894e-03   +4.605292958883499e-03   +6.503467563904506e-03   -5.124627859733450e-03   +1.855241486039114e-03   -3.047229507097729e-03   -3.679866402730187e-04   +5.316715560696053e-03   -4.933004976163061e-03   +5.029426362101106e-03; +9.394514093488945e-03   +6.210331806622769e-03   +1.892054218484417e-03   +2.188212242243198e-05   -1.373698125288200e-03   -4.539736203205851e-04   +1.366566781507929e-04   +9.751356767240900e-03   +6.504274181703368e-03   +9.586096692432789e-04   +3.165925946464228e-03   -6.313113736947534e-03   +5.578278871304101e-03   -4.069129066981517e-03   -4.351249498708915e-03   +2.425128312879449e-03; +5.058049990156906e-03   +5.272892600819942e-03   +6.523107256703770e-03   +2.930267659760245e-03   -9.332370477902270e-04   +2.987402187715138e-03   -2.640643122042776e-03   +5.562916193236140e-03   -4.935091639737235e-03   -5.087901692411037e-03   -4.105174404633755e-03   +6.773478729332946e-03   -2.338533770751388e-03   +1.001696445751302e-04   +4.039883844618253e-04   +3.808916545656280e-04; +5.800926336299060e-04   -5.794307549255200e-04   -1.180522427262023e-03   +3.315736103604825e-03   -1.081061894473778e-03   -1.373191662404022e-03   -5.088457035720744e-04   -5.614643330176514e-04   -7.629708765942592e-04   +7.642826250053459e-03   -2.841208236972322e-03   +3.591462017551767e-03   -4.192580851677589e-03   -4.940932446174200e-04   +3.555167866674628e-03   -5.465208036707637e-03; +2.991151583082290e-03   +2.996763699255336e-03   -6.040591136179083e-03   +1.253085447692591e-03   +8.361724034484021e-03   +3.482248657026060e-03   +1.621605891106175e-03   +5.316303144923979e-03   -1.000742898004662e-03   +5.579069938531429e-03   +2.818619464491353e-03   -2.341271016049255e-04   +3.834499838409110e-03   +1.346941079516735e-03   +5.609284990863127e-03   -1.269198836264837e-03];
L1E_L1I_iGABA_netcon = [+4.093716480296055e-03   +3.194617604161660e-03   +1.338927653737203e-03   +1.954007622307731e-03   -5.280352929881196e-03   +5.216397997277714e-03   -4.471289896238243e-03   -3.098270016923390e-03   +2.410563566905505e-03   -8.963165663710500e-04   -7.756843493041052e-04   -1.673903212158295e-03   +5.892490014217156e-04   +6.651652718296141e-03   -5.734806734260225e-04   +3.285327604482112e-03; -3.058401079257755e-04   -4.535939679048590e-04   +6.239947252402070e-03   +2.457534921157841e-03   -1.424319965915926e-03   +3.609005067815764e-03   -1.734846080934129e-03   +1.500531210740663e-03   +3.235738509556721e-03   -1.007788448902961e-02   -4.800258898140067e-03   +3.689858471987118e-03   +3.785412024292768e-03   -1.372438164718847e-03   +2.805737275930053e-03   +1.535485683427015e-03; +5.584591208478839e-03   +4.459688662370939e-04   +6.586069698699498e-03   -2.482046953542287e-03   -1.412489973220618e-03   -1.462160922310986e-03   -5.816623644836875e-04   +3.287905136647592e-03   +7.283125638322010e-03   +2.622094951142860e-03   +5.677334256846761e-03   +4.715504716300781e-04   +6.491471058229200e-04   +5.174192592240453e-03   -6.018383311031761e-03   -3.362080507834591e-03; +2.282539804134586e-04   +5.789731689197626e-04   -2.579500071921400e-04   +2.321612130574130e-03   -3.075465400987991e-03   +5.862239130039647e-03   +1.690207684549886e-03   +2.148343495876580e-03   +1.977253795969502e-03   -7.423616360007624e-03   +3.021522598683188e-03   +3.744271959899233e-03   +3.635848194017614e-03   -4.185924093259598e-03   -1.399640143942014e-03   +3.563016202065827e-03; +3.439882564951332e-03   +3.037864665296922e-04   +5.086484934366503e-03   -3.804586544731349e-03   -9.341279358857516e-03   +7.395268967201791e-03   +7.103653827599758e-06   +6.450288644678385e-03   -5.991145692368718e-03   +9.583027766262145e-04   +2.738168257824572e-03   -1.751068903179785e-03   -2.878466341338845e-04   +8.434937992872237e-04   +9.049184097814800e-03   -1.225465851200319e-03; +5.374113927659638e-03   +4.200498235583588e-03   -8.647878064511986e-04   -2.287889054306309e-03   +2.372156353408451e-03   -2.622682828444259e-03   +8.322048718239205e-03   +2.945502511368434e-03   +4.857279955466099e-03   -1.723434011467145e-03   +4.100141345093147e-03   -2.159014976110033e-03   +2.637257429816886e-03   -2.229679404873065e-03   +2.939773786574877e-03   -5.547402378921271e-04; +5.614197023370614e-03   -8.814256546360736e-04   -1.474002088115663e-03   -6.050933330299744e-05   +1.090045615509664e-03   +7.173453264971157e-04   +5.208816052254562e-03   +5.878933069504675e-03   +5.115018374919121e-03   +3.701575667339493e-03   +5.310508002399072e-03   +6.648563865128763e-03   +9.517722690234993e-03   +1.336638341189811e-03   -2.088211905602484e-03   +2.033169389112057e-03; +8.940929452521795e-05   -1.604707942027187e-03   +9.265616389859239e-05   -1.503057118852881e-03   +4.110177149812758e-03   -1.986043178902897e-03   +1.314231929273710e-03   +2.681379611158274e-03   +6.696260638668957e-04   +6.889429784706863e-04   +5.398931314654466e-03   +4.858031397396413e-04   +2.792208700387624e-03   -8.698424621039640e-04   -3.250498936912702e-03   +5.491508656172333e-03; -3.838925477353324e-04   +3.258102239399488e-03   +3.418230405394601e-03   +9.380641810122783e-04   +1.135794349209265e-03   -1.938279649244994e-04   -5.084330924207362e-04   +7.146873945303880e-03   +4.720329096838610e-03   -3.467079814194396e-04   +3.637442866128143e-03   +2.737517356714606e-03   +7.043336016636165e-03   -1.296288746610123e-03   -3.628629634673769e-03   +3.197617518157931e-03; +1.796735472464603e-03   +4.319247083035430e-03   -4.165732483692272e-03   +3.407242653980729e-03   +4.154067245728322e-04   +1.923241704270079e-03   -6.284248574516366e-04   -6.545728646675836e-04   +6.095135646467274e-03   +3.746881553162083e-03   +1.716233132430382e-03   +2.594792639230798e-03   +1.744407402072573e-03   +3.423808190365646e-03   +3.861331216045516e-03   +1.714572582178681e-03; +4.909571376603347e-04   -2.762124334309148e-03   +2.008067820836634e-03   -3.179362982915614e-03   +2.650230047800686e-03   -4.227550578740379e-03   +9.809852571283677e-03   +5.309181286566804e-03   +4.628846462672817e-03   +2.419593937040001e-03   +7.445718311472082e-04   +4.212189304623546e-03   +1.473946295643101e-03   +1.517536877491179e-03   +8.431909724949006e-04   -3.057756092711115e-03; -4.440080563656669e-03   +5.995693067304913e-03   +1.894067294712266e-03   -2.944038261386952e-03   -3.633902642170842e-03   -1.990307330492948e-03   -4.447346165333596e-04   +6.417301746495480e-03   +6.862432431401094e-03   -1.382554487220971e-03   -6.561250374096103e-03   -5.467307504513496e-03   -4.655800727168448e-03   +4.438316163288515e-03   +2.004292624822440e-03   -2.513746738603699e-03; -2.885236577126649e-03   +5.818849557645425e-03   +9.300257212745670e-04   +2.983264997341903e-03   -7.095940377093406e-04   -6.599959116404584e-04   +6.759191297908130e-03   -2.762953415692775e-03   +5.342396538530366e-03   +2.174727742128345e-03   -8.420277548395927e-04   -1.276970172041794e-03   +1.563946400643635e-03   +7.363828256220718e-03   +4.985494978119124e-03   +1.998795426750312e-03; +2.357157946047934e-03   -8.240593205483023e-04   +6.141089644148368e-04   +2.842041775995482e-03   +5.473325579244898e-03   +4.713084833058527e-03   -5.666106723302127e-04   +1.667077824984946e-03   -2.806292154039161e-03   +6.137700869303909e-03   +1.202040072877608e-03   +6.562566696718696e-03   -2.135639163629454e-03   +2.086447116133632e-03   -1.372381014308850e-03   +4.205751016951483e-03; -3.157394520544330e-03   -3.821341222762652e-03   +4.483516047661927e-04   +2.241760306910800e-03   +1.027603912617774e-03   +7.062742552195573e-03   +6.609399193764260e-03   +1.882658427027648e-03   +1.021619468666318e-03   -5.838902527320058e-04   -1.591195047841942e-03   -7.551812912296250e-04   -7.627555186986251e-03   -2.813822447749753e-03   -5.768192527035248e-03   -4.997869362905655e-03; +3.043029177023391e-03   +6.892578452709819e-03   -1.700985421729604e-03   +2.443854057022946e-03   +2.134719937756254e-03   +4.468463965856597e-03   -1.399173016977101e-03   -2.353147257886737e-04   -2.625807062729507e-04   -3.047230718179331e-03   -2.569753075597139e-03   -4.572830787292304e-03   +9.214843750536812e-04   +7.895409287902302e-03   -2.629805291446057e-03   +2.709451847231380e-03];
L2I_L1I_iGABA_netcon = [+1.699622153216958e-03   +3.700772684541738e-03   +2.897569277689387e-03   +2.636227913648762e-03   +2.415552587352504e-03   +1.758729669010990e-03   +3.290316972939203e-03   +4.736559573547454e-03; +6.346038843196810e-04   -2.151817414465616e-03   +4.486251584623731e-03   +9.638560359304929e-05   +3.618352532428268e-03   -5.635676847845118e-03   -8.914557810483187e-04   -3.197959179204868e-03; -3.335276445560449e-03   +2.450607668039437e-03   -1.898658858739425e-03   +2.355191194543493e-03   -1.086449039062958e-03   +4.917803229881628e-03   +4.582830708455311e-03   +1.547715005823322e-03; -2.764592634482302e-03   -4.072500299738662e-03   +2.956574960633553e-03   -2.818173781425543e-03   +3.530108348041932e-03   -3.788522367278649e-03   +1.566193124615068e-03   -4.147464459535123e-03; -5.680094308148646e-04   +3.675999917305902e-03   +2.792403936797929e-03   +3.106007200470887e-03   +2.350484398349596e-03   -2.301921888049645e-04   -1.758845915655406e-03   +4.067162208751568e-03; +6.275528715154752e-03   -4.155955120144858e-03   +2.406736834139358e-03   +1.421117462316879e-03   +1.328873155568170e-04   -1.021738696974808e-04   +4.504029672967001e-05   +3.399776119366924e-03; -3.351685570823319e-03   -7.614120156073616e-03   -4.933714090097329e-03   +6.712883159949790e-03   +1.962113111369772e-03   -2.053166633305490e-03   -3.944330529742244e-05   +5.662652086225412e-04; +1.602893500115869e-03   +1.132579634704194e-03   -8.430573519346250e-04   +5.734412161048404e-03   +5.193139882561783e-03   +3.735395197490120e-03   +5.976381301607148e-03   -4.434827211220124e-03; +4.136106522899121e-04   +6.814551565315842e-03   +1.689243758256553e-03   -4.344063283884638e-03   +3.451080659835767e-04   -4.061355332699082e-03   -4.931610897329174e-04   +3.638473674176229e-03; +4.239227457041867e-04   +7.034455872142829e-03   +2.978131660368066e-03   +3.069961501262955e-03   +2.513998868017608e-03   -4.788927221724601e-04   +6.759417472524377e-03   -2.341911434048587e-03; +1.033135253130343e-03   -4.998786282280442e-03   +2.456670011181971e-03   +3.124300713106927e-03   +3.605670899669101e-03   +3.632295095249267e-03   +6.113748610938318e-03   +1.618502039322544e-04; +3.896004183211722e-03   +3.511644620783392e-03   +4.898599004552780e-03   -9.465531494692492e-04   +3.306365565656328e-03   +4.353506438652628e-03   +2.910344765881616e-03   +6.849068552497952e-04; -4.875411314144768e-03   -2.992563351618036e-04   +2.441005675977105e-03   -6.204756075989270e-04   +1.485015112271610e-03   +4.489591045348622e-03   +4.859767901954965e-03   +1.064029528134823e-03; -4.205010625854325e-03   -1.922195041319805e-03   +3.581871330809883e-03   +2.787426864567523e-03   +9.909788424230315e-04   -4.500253830837991e-03   -3.542496719963265e-03   +5.010805920252322e-03; -1.364863768621917e-03   -7.046064000351421e-04   -9.627375351602950e-04   +2.363255752860194e-03   +1.055336141970558e-03   -2.843537687286410e-04   +4.483109751116474e-03   -2.242117196194275e-03; -1.162851590524392e-03   +1.968818405327767e-03   +3.189531725313261e-03   +4.184525967678436e-03   +2.424352127140372e-03   -7.027095598650325e-04   -1.185385043428878e-03   +1.683513496945098e-03];
L1I_L2I_iGABA_netcon = [+2.178489681678812e-03   +4.669866336745989e-05   -3.123392911462098e-04   +2.670733900531799e-03   +9.672264557669891e-05   +3.527019023532609e-03   +4.122632945895515e-03   -1.881686005429284e-03   +2.622006503414057e-03   +4.419479952838686e-03   -4.597976637794498e-03   +1.493478855478825e-03   +5.216981682806517e-03   +6.123709136954536e-04   -3.368425094410616e-03   -4.254502869342729e-03; +1.714364901678672e-03   -1.915967998898542e-03   +5.008839086520765e-03   +6.228839859200843e-04   +8.022236274638399e-03   +6.013829257598140e-03   -1.784352245655994e-04   +6.298680418051373e-04   +2.664360167075528e-03   -2.176982029327719e-03   +3.095468155720309e-03   -2.539224460070703e-03   -3.466751770998422e-04   -1.082625111248446e-03   -4.210718685672968e-03   -3.300884558983691e-03; +5.218636995685784e-03   -4.404316821607149e-04   +1.079897772980038e-03   +5.430384767114904e-03   -6.413468291583099e-04   -3.163415247613421e-03   +2.404193110928369e-03   +2.298844061023425e-03   +1.009227349080972e-03   +6.825334493910863e-04   +4.918550795798888e-04   -7.997155478302096e-03   -2.456207748172006e-03   +7.701756241203477e-03   -8.373030766220752e-04   -2.709233380094889e-03; +2.196009621516973e-03   -1.622633409511687e-03   +3.326243016601110e-03   +3.856263876426264e-03   -5.508549010081207e-03   -5.871564758372246e-03   -1.035077472033236e-04   +8.466510336292173e-03   -7.558574990788585e-04   +1.410777674762432e-03   +9.132810715834156e-03   -3.749825159134627e-04   -3.342443527991591e-04   -5.833573900207647e-03   +5.236411900104172e-03   +3.436576897859583e-03; -7.295999908413756e-04   +5.471688959939047e-03   +2.432877865403300e-03   +4.542410237438072e-03   -3.814111639506720e-03   -1.829638866586340e-03   -8.371684343510035e-04   +3.984944672722277e-03   -7.526412507157161e-04   +8.637812454872498e-04   +9.281495251766867e-04   +1.592152971917006e-03   +9.509516388484631e-04   -3.198243528214472e-03   -3.496378178637511e-03   -1.609019707540010e-03; +1.616191272971133e-03   +3.309199799018178e-03   +9.190747298607250e-04   -2.416966497961927e-03   +4.080829071628217e-03   -2.489387600625168e-03   +2.282707271292523e-03   +3.237459764646574e-03   -2.365148189217255e-03   -1.524968791641557e-03   -1.106267501369522e-03   +2.246804600304957e-03   +4.388521492690106e-05   -2.349010192742657e-03   +6.154340687419196e-03   +4.779112930196899e-03; +1.495344740963649e-03   +6.740903229097418e-03   +3.746087564772464e-03   +1.189298006296816e-03   +4.764320186499426e-03   +3.231486833992154e-03   -2.447113394703114e-03   -3.482440337213589e-04   +2.518746024021031e-03   +1.277124490319837e-03   +1.354889161375442e-03   +5.019501111330042e-03   +1.664903829709386e-03   +9.302249795406150e-04   +1.447642750049872e-03   -2.515047464181961e-03; -4.520073943288672e-03   +5.296603207809327e-03   +8.698184570409202e-05   +1.595312922902777e-03   -2.340201395302114e-03   -5.476783233956748e-04   -4.350306184301954e-03   +5.625691472017828e-03   +3.010873499731590e-03   -1.729429642642343e-03   -2.567533421399819e-03   +2.874724421383589e-03   +3.029242099577450e-04   +1.606443194910471e-03   -1.309888449642711e-03   +5.614347153426361e-03];
L2E_L1E_iAMPA_netcon = [+6.310100026000506e-04   +5.879617129849431e-03   -1.814930562621819e-03   +3.613267646967465e-03   -9.657615832436210e-04   -2.937374778177422e-03   +2.476434585884717e-03   +6.144077667309273e-03; +3.061664990554733e-03   -2.807120494631520e-03   -2.569750804197395e-03   +5.758969835753296e-03   +4.144621834287909e-03   -2.462358730778962e-03   +3.598192074723520e-03   -3.938428351461639e-03; +4.418693185486641e-04   -1.946265478662275e-03   -2.671550508369100e-03   +2.669392005744464e-03   -5.001618812988677e-03   +4.046417746218464e-03   -4.151162005127340e-04   -2.430893868435140e-04; -4.674510421921505e-03   -1.617493288810812e-03   -1.058496272773353e-03   -2.473279892242169e-03   +2.626495189196742e-03   -1.725053201028313e-03   +2.708299151426124e-03   -1.209183877324336e-03; +8.116868168917624e-04   +2.527811327919241e-03   -2.107308863595654e-03   -3.295010705166960e-03   -7.566346756120944e-04   -4.489118497672447e-04   -2.534599651425293e-03   +1.517024981510806e-03; -1.094247967787346e-03   +3.852382460288241e-03   +3.837452771476975e-03   +4.818032855673371e-03   +2.637742332458728e-03   -2.655132104397589e-04   +8.115070619488797e-03   +6.767104415723557e-03; +1.217801016249910e-03   -3.434678962992824e-05   -1.346208712286792e-03   +4.817596403787211e-03   -7.212186217266497e-03   +2.688187433605977e-03   -7.116580349087835e-03   +4.267113627912943e-03; -4.690469477669349e-03   -2.476307251448680e-03   -4.316155499234768e-03   +3.452301700015161e-03   -1.588429888613706e-05   -1.224662668646583e-03   +4.416431334318833e-03   -1.650594458779834e-03; +7.445579491815313e-04   -7.166240146716950e-04   -1.715079645632090e-03   -2.793313263737894e-03   -3.267155304923209e-04   +4.553042084371059e-03   -9.928908720773933e-04   +6.784075888488663e-03; +5.637467932760155e-03   +4.990393699838168e-05   -3.505189525379693e-03   +3.836965938907629e-03   +1.638469176707801e-05   -1.321690622701341e-03   +5.373306723103399e-04   -2.468269881532559e-04; +2.022524238072149e-03   +6.895462711481304e-04   -1.200014224167154e-03   -6.397352890223747e-04   +1.623452378461331e-03   +2.183641368773612e-03   +3.985491677705476e-03   -3.807514729474332e-03; +3.248359986251194e-03   -2.916017699750518e-03   +1.654191322949682e-03   +5.221238885656381e-03   +7.372954641665483e-04   +1.122880630031694e-04   +1.012000410942186e-02   -7.758428095238218e-04; +2.635516315689038e-03   +1.336984577332097e-03   +8.943988406596465e-03   +3.089233584234758e-03   +5.336514755476111e-03   -3.672054332762796e-03   +7.512063956252226e-03   +5.282590481836651e-03; -8.800170699340367e-04   -7.920346056675953e-04   +1.667399173469675e-03   -3.464379701783224e-03   +1.047415298020775e-03   -1.096776206118923e-03   +4.220329716428251e-03   +2.006767380977542e-04; -3.483558324114191e-03   +6.307157518158823e-03   -6.790356465168885e-03   +7.104142716041826e-03   +2.403173616790540e-03   -3.070514729744834e-03   +1.260675586413460e-03   +4.351902361869380e-03; +2.101276015712808e-03   -5.417536655734755e-04   +3.069381674622943e-03   +2.482335890064600e-04   -1.195716759521592e-03   -1.606453804468091e-03   -3.001716379913520e-03   +8.951828380166397e-04];
L1E_L2E_iAMPA_netcon = [-1.352119666766478e-03   +2.235630436940995e-04   -4.709590365108518e-03   +2.488637311330118e-03   +3.534194832273849e-03   +7.302139731935085e-03   +1.300179800251246e-03   +6.895287139547322e-04   +3.269206483621999e-03   -9.134585471305896e-04   +5.357967905266804e-05   -3.193465761848722e-03   +6.335274297455548e-03   -1.284138295031120e-05   +1.504053260887708e-03   +1.929838697373208e-03; -1.082575296664077e-03   +5.600192288663442e-03   +4.801741744469583e-03   -4.015461151972731e-03   -3.791317884413996e-03   +3.746672304219238e-03   +1.348619522000762e-03   +3.008330482633487e-04   -2.863085404705121e-03   -1.028625146231927e-03   -6.299046878440510e-04   -1.830974476592944e-03   -5.326033929527663e-03   +1.227485316555105e-03   +4.714477932668435e-03   -1.334917813410833e-03; +2.681952520050652e-03   +3.156709164279637e-03   +3.131203523044883e-03   +6.534754105911996e-03   -6.174807600031856e-04   +3.280383504720266e-03   -2.779389321210463e-03   -3.612580515689798e-03   +4.383841710539512e-04   -2.266574089598888e-03   -7.364367780724717e-04   +1.254498089373303e-03   -4.554194343877662e-03   -2.514016568827224e-03   -1.065089416475805e-03   +2.180307210770312e-03; -3.995653836312784e-03   +2.373606468975458e-03   -3.202748881477840e-03   -2.607952565347702e-03   +4.001588047862527e-03   +7.725822703467237e-03   +5.093345963676040e-03   +1.759886362241470e-03   -1.671680357543576e-03   +3.169740324842629e-03   +2.079434449329379e-03   +5.048715434779812e-04   -2.649279462263805e-03   -6.549543603502477e-04   +4.968500003626835e-03   -3.962240267502102e-03; -2.439109785351816e-04   -8.912055943481093e-04   -1.133846697137189e-03   +1.535417520409113e-03   -1.333451080294424e-03   +6.236615747813303e-03   -3.962651135523431e-04   -2.602991131479477e-03   +7.112487927891860e-05   -4.752513139340254e-03   -4.772453138493961e-03   +1.117577141512161e-03   -2.601722210838892e-03   -2.918053840054202e-03   +9.934142459812442e-03   +2.011247489526271e-03; +4.220754390697610e-03   +9.286584891494193e-04   +1.977778551485922e-03   -3.314158385866887e-03   +2.684403711302459e-03   -5.192320849101916e-03   +6.998851662111554e-04   +4.990115451170408e-03   -3.148534507750825e-03   +1.064800905500620e-03   +9.537739186812277e-03   +5.983743531149971e-03   +3.448925575822829e-04   -8.583626897004299e-03   -1.372637338419088e-03   +4.742176673124036e-03; +1.262055316941923e-04   -9.925987845358871e-04   -1.848860038638555e-03   +4.677681492831895e-05   -1.080155723669709e-03   +3.644110646307043e-03   +8.103411397880563e-03   +4.616479300025391e-03   -9.714493400042230e-04   -4.474881776686749e-03   -3.547111071662922e-03   -1.807232003949843e-05   -4.846880190011145e-03   -9.652935239662503e-04   +9.324078680047556e-04   -1.843220487145388e-03; -6.784165873098064e-03   -1.977777472200038e-03   +4.295950425494547e-04   +2.177921556109300e-04   -1.955700409387782e-03   -3.579544209967978e-03   +4.631403645723645e-03   -2.651692498838975e-03   +5.260729985322553e-03   +3.874710207158663e-03   -3.917234945925621e-03   -7.508881767208414e-04   -7.095056044666072e-04   -4.116627985433442e-03   +4.046979133177977e-03   +1.358121056357796e-03];
L2I_L2E_iAMPA_netcon = [+7.962921707578949e-04   +5.291606043046184e-03   -4.591822515521082e-04   +3.645199097039364e-03   +4.397813336964410e-03   +2.625687255089784e-03   +7.147919315993376e-03   -4.309444257508160e-03; +4.533490750196314e-03   -8.567572957553266e-04   +1.420643501673221e-03   +6.824401096659208e-03   -1.546487313251469e-03   -7.209107092720535e-04   +4.011126337929470e-04   +2.283320349422909e-03; +5.256600198132165e-03   -1.743968496835414e-03   +4.256460926535460e-03   -2.720323458960330e-03   -1.389467312213170e-03   +1.551828456519407e-03   -3.353987649646955e-07   -4.486601822112435e-03; -2.619848754515687e-03   +1.848844798808942e-03   +7.199294411943490e-03   -4.716967636553774e-04   +4.485451609833503e-03   +3.719284586649575e-03   -2.959312727967196e-03   +8.440876230823131e-03; +3.671533882976851e-03   -7.850208937564613e-04   -2.556280851575748e-03   -4.983392359464635e-03   +6.276031442304379e-03   +1.802850467497754e-03   -6.570200999602676e-04   +2.575572971496107e-03; -2.973964248782919e-03   +3.040509902331581e-03   +7.094989746462555e-03   +5.855565174740691e-04   +1.760546083810947e-04   +1.872958945643758e-03   -6.320396688180113e-04   +1.914364822059966e-03; +4.328959425856549e-04   +2.865665101344898e-04   -3.872490158430096e-03   -1.136197824277933e-03   +3.524859567674898e-03   -1.141918290022173e-03   -4.948117541378390e-04   -4.418574941352162e-04; -3.694118788600294e-03   -3.466416953513161e-03   +3.822463394100212e-04   -6.294966768410353e-03   +3.115780852360975e-03   +1.759088402669209e-03   -9.963673212967602e-04   +3.253220133222596e-03];
L2E_L2I_iGABA_netcon = [+2.878902967215559e-04   +1.978566587482930e-03   +4.810844096666452e-03   +3.831183610821859e-03   +8.687197104425549e-03   +3.729277269814517e-03   +1.415256318328317e-03   -1.550658101100989e-03; -1.073902643951217e-03   +3.289533561430093e-03   +1.776517488406055e-03   -1.462357124641450e-03   +4.853018455837295e-03   +4.802357075899114e-03   +4.033744792628254e-03   -1.553878691303551e-03; +7.197867191643575e-03   -2.055644049540323e-03   -1.682496497667484e-03   -5.585127657931478e-05   +7.129081374470034e-04   -2.034688075752853e-03   -6.793726872697636e-04   -1.803611675970396e-03; +4.782480576675555e-03   -2.676881061562971e-03   +2.606987356870849e-03   +6.501209603760874e-03   +3.836514746734974e-03   -2.421530528000371e-03   -6.474808355629100e-03   -1.068667718674403e-03; +9.103505065177472e-04   -2.000209112427027e-03   +5.810662727665811e-03   +5.881315329344600e-03   +8.245636794103743e-03   -7.398121095289753e-04   +1.589885977539124e-03   +2.129438131094221e-03; +4.614140995589561e-03   +2.540004725353117e-03   +6.602328696652361e-04   -3.711804224037201e-04   +3.290925878531104e-04   -7.993270384247530e-04   +8.643123520756217e-03   +1.925594553540430e-03; +2.443885066201353e-03   +6.598489413126253e-03   -5.214893024041451e-03   +2.386016982524122e-05   +4.174469202831027e-03   +2.229502813941318e-03   +1.481172520672299e-03   +3.140213757399590e-03; +8.795894444948093e-05   +1.144037234930666e-03   +2.887448561693234e-03   -7.621058114793180e-04   -9.485515094253996e-04   +5.322909719843640e-04   +2.808730977143316e-03   -2.590579133092004e-03];
L3E_L2E_iAMPA_netcon = [+2.242406536926342e-04   +5.599586843589129e-03   +1.500131887056007e-03   -6.322478187516468e-04   -5.241424330015511e-03   -2.983120554005618e-03   -4.022604827670698e-03   +3.410248862611981e-03   -2.978058848030552e-03   +4.944369593539593e-03   +5.821598909026122e-03   -2.787458967653983e-03; +5.691252586918558e-03   +1.104667203475041e-03   +2.141368899536990e-03   +2.825218816562859e-03   -2.025999971866825e-03   -3.908097013638803e-03   -3.867874534914070e-03   +7.627657345543029e-04   +1.266045402921140e-03   -9.626976892944689e-04   +1.697671434519553e-04   +5.191068993830013e-04; -4.857399666151085e-04   +2.994416554527186e-03   -1.524217251863663e-03   +3.270544772717994e-03   +2.829209000067759e-03   -1.309647545693539e-03   +5.017264932748778e-03   +3.029530924353816e-03   -1.597500687894247e-03   +1.825058394211155e-03   +1.938878532067177e-03   +4.364721030107804e-03; +2.981445837112720e-04   -3.395851366797973e-03   +3.361515535615859e-04   -3.465478287196220e-04   -5.547079002248696e-03   +2.202300144138310e-03   +5.449465995271041e-04   +5.307434152043751e-03   +5.112274458825553e-03   +4.188043022041399e-03   +3.853034606780397e-03   -2.587891731349410e-04; -1.368990061496649e-03   +4.768394707329825e-03   -3.451070456914915e-04   +9.872493076713449e-04   -9.129371317906118e-04   +2.154826547573014e-03   +2.646769812259858e-03   +2.161850143940588e-03   +5.193702635595361e-04   +7.386550290612116e-03   +2.021074311973260e-03   -8.033134383611485e-05; +1.893973005647179e-03   -7.627608895255252e-04   -1.215506680732748e-03   -1.680336095139907e-03   +2.683683924579229e-03   +5.071374732851658e-03   +4.405039471658942e-03   +5.394720229515114e-03   +2.499650033247057e-03   -5.473497157318370e-03   +3.119908632298648e-03   +2.837050364442296e-03; -1.502588766395631e-03   +1.794012235295087e-03   +7.452849697209680e-03   +3.470356155250409e-03   -5.193554623266721e-04   +4.971902114702855e-03   +4.335134075978990e-03   +7.419345730839242e-03   +4.326948186856261e-03   -5.521151170938932e-04   +3.274371748152242e-03   -5.848902988720779e-03; -4.126037578543311e-03   -7.023616407430457e-03   +2.658175888342699e-03   +1.937634373629666e-03   +1.560139959997243e-03   +4.847885185687321e-04   -4.071541508146547e-03   +4.572964308988549e-03   -6.726774141239530e-04   +9.609305223000033e-04   -1.426170570358855e-03   +1.596771691282209e-03];
L3I_L2I_iGABA_netcon = [+1.234571730751255e-03   -1.713453334164330e-03   -3.213937710420684e-03   +2.990418954816887e-03   +1.409040487953957e-03   -1.811097049700654e-03   +3.751723041149930e-04   -7.915516168898172e-03   +3.438927370718166e-03   +3.711373057008813e-03   -1.256707173641201e-03   +9.078807245441925e-04; +3.601113623694785e-03   -2.495990057773583e-03   +2.619469816005129e-03   -7.501377024515576e-04   +2.441190645347572e-03   -1.516841172933662e-03   +2.891318616825368e-03   -3.405298773865740e-03   +5.821028805009606e-03   -2.219125998853592e-03   -6.526907556799112e-03   +6.562923289091752e-04; +3.780834023999799e-03   +5.908305009953554e-03   -2.245192552519062e-03   +3.243290509762401e-03   -2.359415510958599e-03   -8.439621094918780e-04   +2.762220533904798e-03   +4.027769263638395e-04   +7.062502276852086e-03   -1.745510376772542e-03   +2.459197602604242e-03   -1.685154353236661e-03; +7.276671006147461e-04   +9.741493423412293e-04   +6.314787234739517e-04   -5.968863970102576e-03   -3.454756473900343e-03   +8.021707474761235e-03   -3.629936337013856e-03   +5.212440614630445e-03   +3.410863293719667e-03   -4.825529781751192e-03   -3.737115624527049e-04   +4.551114821559512e-04; +2.966548139740353e-03   -2.118547276889310e-04   +1.784794474610146e-03   +3.652537967992163e-03   +1.405578751739301e-03   +1.812448393465149e-03   -3.517845171317328e-03   +7.869371626210923e-03   +4.316584086665398e-03   +7.276293743707565e-03   -5.729473215689797e-03   -4.837158146175197e-03; +3.647198558947723e-03   -4.412557144792167e-03   +4.755328283343840e-04   +4.175564041478395e-03   +6.695892191919158e-03   +4.815047332299072e-03   -3.965576086336293e-03   +7.814672087087304e-03   +7.770768705977285e-04   +8.053251464248002e-05   +2.672769494237984e-04   -5.368457551221183e-04; -6.147628058474736e-05   +3.842302648633890e-03   -3.200131217774733e-03   -1.194905414732056e-03   -2.499236305270850e-03   -1.952537170093183e-04   +1.164835566574285e-03   +8.269349109592487e-04   -5.910817314718152e-04   +4.745549613054130e-03   +9.919759425897671e-04   -4.326460277839042e-04; -2.772180145372982e-03   -1.685062866943314e-03   +1.290990693054105e-03   -2.249032577710472e-03   +2.993612576389386e-03   -1.600428085659003e-03   -1.654046775369325e-03   +1.289906727767504e-03   +5.188529784564934e-03   -3.074659538154791e-03   +9.847227239065668e-04   -1.485931226387079e-03];
L2E_L3E_iAMPA_netcon = [+4.318433246654927e-04   +2.493534263305607e-03   -2.520496458655119e-03   +3.623892294249535e-03   -4.055280515352528e-03   +2.101326903331783e-03   -3.101787765967981e-04   +1.666177426180846e-03; +1.647339265237530e-03   -3.282432143867862e-03   +3.643330034190964e-03   +9.492182331825177e-03   -1.106037419408697e-03   +5.139334491551321e-03   +4.499596853765016e-03   -6.609936364906120e-03; +4.346035345537348e-04   +3.659191573953858e-03   +4.899622954382201e-03   +2.386727969883953e-03   +4.569040414342362e-03   +6.465231937988083e-03   +2.114056859959373e-03   +5.468009491908394e-03; +2.405423690289393e-03   -3.457932195538704e-03   +9.011417298409287e-04   +1.300929362463391e-03   +1.134643684978671e-03   +5.174822628964415e-03   -4.843020940462975e-03   +6.683783184455414e-03; -2.496602546199107e-03   -2.904669242361884e-03   -1.305960034419014e-03   +4.484103217981885e-03   +4.364807463087218e-03   -2.644092996887362e-03   +4.142018515199685e-03   -3.978711149981138e-03; +4.828340431585717e-03   +3.835126373860328e-03   +1.360327260823357e-03   +2.715680057286183e-04   +1.365238723015475e-03   +3.037375372224010e-03   -5.856151330183457e-03   +4.112240732994972e-03; +2.200211655147786e-03   -3.856583395705799e-04   -1.065024324851823e-03   -5.129006044277472e-03   -5.840655300313124e-04   -3.141088008740670e-03   -3.937340229405741e-04   +2.779530947641790e-03; +3.557879868467978e-03   -2.879147341055759e-03   -1.808426935088713e-04   +1.733533606993660e-03   +3.302219305342489e-03   +6.269600449512686e-04   +1.270761027415677e-03   -3.124215409048452e-03; +2.258007246547772e-03   +7.523219220799345e-04   +1.331874825322855e-03   +3.157734624544633e-03   +6.846810211016364e-04   -2.169301114181434e-03   -1.509783931513773e-04   -2.074279580858788e-03; +1.010874106372160e-03   +3.925780361035178e-03   +7.158118591942932e-05   -7.633190383464057e-03   +4.375590963941872e-03   -1.638064188775357e-03   +3.270697560653397e-03   -1.496850414216137e-03; +7.325970748872839e-03   -6.231536176566947e-04   +2.925738117608026e-04   +1.654781385690732e-03   +3.964952717777879e-03   +6.933966045494474e-03   +3.431464643005261e-03   -2.576654018097557e-03; +7.061610943637269e-03   -1.400763880018158e-03   +3.666878787397680e-03   -1.158854927673853e-03   -1.701010149860453e-03   +4.319483549387403e-03   +6.398427445794757e-03   +1.976839314971244e-03];
L2I_L3I_iGABA_netcon = [+2.847074855996580e-03   +6.431062430613109e-04   -3.418904593896842e-03   +3.577409708286663e-03   +5.872564367270707e-03   +2.718956740382697e-03   +8.622872341527432e-04   -2.803406496117601e-03; +1.241068633718836e-03   -1.343397576755088e-03   +5.323286500067243e-03   -4.722495860507050e-03   -2.078442564126560e-03   +3.506266935472349e-04   -5.241405932877713e-03   -9.149178756097467e-05; +9.273831211594587e-04   -4.313427597350670e-03   +4.348151430616856e-03   -1.272774816983784e-03   +1.676346535127321e-03   -5.017970958773861e-04   +6.694407913256303e-03   +4.720990517224249e-03; -5.312939087029752e-03   +1.699796092989200e-03   -1.128359884087773e-03   +5.058889692873220e-03   -5.573544406147207e-03   -5.902373664042591e-04   +1.809338056736898e-03   -2.190446003904364e-03; -2.888047224050375e-04   -5.473259528262695e-03   -3.330521581346270e-03   +1.210007472226466e-03   +3.167576338813853e-03   +3.401730770615885e-03   -4.418834433713425e-03   +2.321635435985220e-03; +1.038171541733909e-03   +5.180204709428325e-04   +4.068220259717059e-05   -1.241840118583365e-03   +2.674251912794312e-03   +1.356227057914984e-03   -1.611755801935991e-04   +3.522865242270579e-03; -1.733365796221516e-03   +2.585115968284485e-03   +7.116607750530558e-03   +2.459134619425130e-03   -3.813850305422224e-03   -1.565288858054726e-03   +1.750263397065969e-03   +1.973400553703089e-03; -3.236323940850775e-03   +1.454492778346366e-03   +8.133844047007992e-03   +1.596593566020963e-05   -6.003707233166477e-04   +5.471258547939353e-03   +2.341660331515636e-03   +4.887330291313658e-03; +4.020087832928163e-03   -1.692475879945080e-03   +2.833141931695899e-03   +4.382839207609017e-03   -3.462343864890973e-03   -1.870439082652340e-03   -1.465454217085752e-03   +8.040678335188636e-04; +3.403907968389111e-03   -2.496187600259983e-03   +5.415865932915883e-03   -1.889793602266803e-03   +7.065798596999414e-03   +3.524468450130785e-03   -1.682400875967650e-05   -3.823887647642525e-03; +1.892836034232574e-03   +4.558891080739868e-03   +3.711829742372962e-03   -4.493181383943348e-04   +5.396191606428166e-07   +3.776125520835962e-03   +1.469642050188906e-03   +6.694062573879092e-03; +2.117939733319994e-03   -4.996776590190643e-03   +6.646557877953542e-04   -7.014348915628654e-04   -2.504584214199069e-03   +3.644467267216856e-03   -3.022256172533501e-03   +4.606700995186112e-03];
L3I_L3E_iAMPA_netcon = [-2.283354414305295e-03   +1.641705136516755e-03   +5.290972315520549e-03   +2.405572362816296e-03   +6.751709906283361e-03   -1.182000511056628e-03   -1.300300802786717e-03   -6.619519901040607e-03   -6.007666650920866e-05   +2.218707099688878e-03   -2.377275636536715e-03   +3.081773535958586e-03; +2.070591579458655e-03   +6.439080981647593e-03   +6.111659783132343e-04   -2.147572216293120e-03   +1.152315019728911e-03   -7.062944731327063e-04   -6.147662625387236e-04   +1.539062062717419e-03   +2.444662145093431e-03   +1.187538953988172e-03   -1.702373062729668e-03   +4.914631586522195e-03; -3.268058057569519e-03   +8.229879850125788e-03   -3.897574460703637e-04   +2.287502191808658e-03   +1.084578829546867e-03   +6.364086531580647e-03   +4.785524606362924e-03   -1.182996572243058e-03   -1.645034431779633e-03   +1.541356128309253e-03   +1.650780097275383e-03   +3.282236445453258e-03; +4.972753538813603e-03   +4.525074901877414e-03   +1.177251551614053e-03   +1.463537851600757e-04   +9.826470957223955e-03   +1.173048909979641e-03   -7.544895823259900e-04   +3.615643131817574e-04   -2.282627260899606e-03   +7.033159157767934e-03   +6.039513415066037e-04   +5.770881918965507e-03; -2.880929117724374e-03   +2.273953841693546e-03   +2.143350862834153e-03   -1.154454738143146e-03   +4.349563581069317e-04   +4.089214475514261e-05   -5.052750142950231e-03   -1.598428333500258e-04   -5.293544117173877e-04   -1.035766393251699e-03   +5.518460944472827e-03   +6.558987329329707e-03; +3.807587827589518e-04   +4.283043651678378e-03   +2.418693648370595e-03   +7.829588136161681e-03   +1.498553889637586e-03   +3.757275807072589e-03   +3.369310107056191e-03   +1.811603279644863e-03   -1.075146891970601e-04   +5.974645436418491e-03   +6.820272970527565e-05   +2.704323401497904e-03; -4.882266312522387e-03   -4.830162047033348e-03   -2.627407274185496e-03   -2.543462385029021e-03   +2.121547346531996e-03   +1.168060516890564e-03   +3.019515189631625e-03   +2.625606357212675e-03   +2.302069561642289e-03   +3.011569873111789e-04   +7.966029002156683e-04   +4.115474960280609e-03; +2.166000596941550e-03   -5.859938800547402e-03   +1.277739674897004e-03   +1.076984670015176e-03   -2.327328726482621e-03   +2.583904328983489e-03   +3.395688496849803e-03   -5.711806538304718e-03   +2.412689102450993e-03   +1.651734517276441e-03   +4.422739704200007e-03   +5.172028665289751e-03; +5.428188061165349e-04   -1.125184360357962e-03   -2.075652570031065e-03   -7.317432691370970e-04   +1.970831640944924e-03   -1.646698490898563e-03   -4.324678857865509e-03   +1.347865887260431e-03   +4.296035402368881e-03   -1.127549743438984e-03   +4.714868844441725e-04   -4.041739459046393e-03; +3.220189258579945e-03   +3.773867440873487e-03   -1.296399564621096e-03   -1.035056486973391e-03   +4.544728855034175e-03   -1.378979908512089e-03   -2.394909016031298e-04   +4.534872398811651e-03   +3.703115231050890e-03   +6.743775804221776e-03   +2.932311826316421e-03   -2.894625296707483e-03; -7.868576965178785e-04   +2.083932750474353e-03   +2.594318515685987e-03   -3.840971699712423e-04   -4.863082061329124e-03   -6.172681664160311e-03   -6.400003028054336e-04   -1.608562398422462e-03   +8.206453028935655e-04   +4.978553204721294e-03   -3.197241940605450e-03   +4.597529536594614e-03; -2.012094194619410e-03   -2.389008764269796e-03   -7.995384143626957e-03   -2.055656024990773e-03   -3.676447631240095e-03   +2.038432595456992e-03   -3.140208149548832e-04   -3.160065319607960e-03   +2.526367940592119e-04   -3.516753665050135e-03   +2.267645092070269e-03   -2.436652459593439e-03];
L3E_L3I_iGABA_netcon = [+1.533714212611936e-03   +3.488928210325452e-03   -1.540434248623520e-03   -4.815904841219072e-04   +3.519206417824969e-03   +6.406735505883978e-03   -1.350507477970980e-03   -3.610433373751296e-04   +2.171297370561588e-03   +4.936989643128315e-04   +4.668296745588598e-03   +2.372898655601759e-03; +2.106679686576222e-03   +2.247339932354799e-03   -2.802269221115161e-03   +4.422205583020472e-04   +3.396632240478570e-03   -5.256488550567267e-04   -1.749288541868764e-03   -3.844318356772481e-05   +1.980235219886701e-03   +7.855064335847574e-03   -1.937821412559814e-03   -1.554012905880938e-03; +1.025824979974072e-03   +3.512554702503118e-05   +4.617099230984429e-03   +8.423811388473741e-04   +1.779967441032756e-03   -1.151901862004846e-03   +4.453247597869183e-03   -4.617848249685371e-04   -2.640494128946073e-03   -3.358665603004369e-04   -4.620497441537108e-04   +3.264656372469073e-04; +1.220805579234493e-03   +3.367316773021721e-03   -4.123905416034619e-04   +9.307650275676179e-03   +7.024600279728604e-04   +1.911791386022754e-03   -1.245878194246555e-03   -1.634067008974045e-03   -4.791685895490810e-03   +9.678005884619348e-03   +2.475212621870994e-04   +5.244824184330284e-04; -9.585175127373440e-04   +1.147747775747023e-04   -1.998024324006392e-04   -1.610311315254047e-03   -6.919820317049295e-04   +3.285933921404223e-03   +2.410214828069840e-03   +4.956760497422257e-03   +2.479605372734952e-03   +1.177737948127109e-03   -5.763081790119962e-03   +4.046106274149027e-03; +2.922457697876633e-03   +2.846524147888985e-03   +9.998021923936926e-03   +5.683148769499453e-03   +2.875966344774096e-03   +5.736263851728303e-03   +2.336998017813003e-03   +2.458262513892564e-03   +4.081646239024236e-03   +8.769943952049698e-03   +3.271701014915832e-03   -2.122561992510088e-03; -1.914240763021638e-03   -2.925243451199186e-04   -4.297801019016394e-03   +8.341740827217026e-04   -1.034239266444790e-03   +5.519460171798028e-03   +7.259409524646658e-04   +5.474438823597417e-03   -4.379939102423272e-03   +3.104616579110260e-03   -4.281536015934556e-03   +5.987921763821692e-03; -8.024880218755916e-03   +2.218012005645513e-03   +4.335847615120035e-03   +8.345668143116915e-03   -2.125068026553144e-03   -6.370625230341646e-04   +3.019224966032890e-03   +7.266136438288510e-03   +3.230903775884968e-04   +4.580197276667760e-03   -2.096534325366316e-03   +7.367106695107064e-03; +4.853905370448278e-03   -2.476950732265027e-03   +2.157382119003039e-03   +1.839539717313040e-05   +3.742038497828406e-03   +4.387331454217451e-03   -2.127134043652180e-03   +4.551915634110015e-03   -3.397429839974208e-03   +6.417932482458939e-03   +5.694080428083009e-04   +3.810607176076878e-03; +1.754788231282737e-03   +2.297674477868978e-03   -1.965270895029683e-04   +1.430279158541382e-03   +3.075786092741330e-03   +2.898617564560079e-03   +2.563511349935618e-03   +9.097880530257046e-04   +5.344266841597698e-03   -1.591730712419560e-03   +1.000063672526498e-03   -3.042721683246534e-04; +2.442668697242837e-03   -2.795360959259108e-05   +3.767581061604503e-04   +2.214168656332294e-03   +2.439162391867032e-03   -2.058679218126016e-03   +4.582836031224203e-03   +3.481128452250135e-03   +1.373686951637837e-03   +7.824814102099615e-03   -2.532236573108375e-03   +3.179147914449685e-03; +6.547490432748833e-04   +7.793112478970772e-03   +3.063142917021289e-04   +1.044389766662903e-04   -2.199959249563574e-03   +2.698827019398947e-03   +2.911214576594154e-03   -2.345461692408015e-03   +7.175980698624735e-03   +4.090478547522185e-03   -2.158265174494324e-03   -1.976413512124213e-04];
L2E_Input1_iAMPA_netcon = [+3.158722828902465e-03   +3.087359645130788e-03   +4.092075817772106e-03   -1.313903118338031e-03   +7.537414792349759e-03   -4.576719901521354e-04   +6.145946822516011e-04   +1.688850750222419e-03];
L2I_Input2_iAMPA_netcon = [+1.507695455215079e-03   +3.394025186242452e-03   +1.533118900535486e-03   -5.314407258623520e-03   +2.007645332894439e-03   +2.138135637552961e-03   +5.906959396947796e-03   +5.178056149286851e-03];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
