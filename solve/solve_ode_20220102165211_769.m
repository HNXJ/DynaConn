function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.178256810784059e-03   +1.081110846100278e-01   +1.871063260021220e-01   +1.479487646359734e-01   +1.288022450509196e-01   +2.005554915317385e-01   +1.007471691758606e-01   +4.345724733936217e-02   +3.735393243815077e-02   +9.019543579300507e-02   +1.251228028731928e-01   +4.398603519099670e-02   +8.824798129928924e-02   +1.402896290714511e-01   +9.044744663674040e-02   +1.924823160644990e-02; +8.038273421980366e-02   +3.922669112955642e-03   +1.088903736210117e-01   +1.297923342988784e-01   +5.782364472085022e-02   +6.331745442760267e-02   +1.880144526263847e-01   +2.005502976121233e-01   +1.406454028240625e-01   +4.481502041106888e-02   +2.070069298148689e-01   +4.754537936475454e-02   +4.598134971915947e-02   -1.858974859730573e-03   +1.117872620997795e-01   +5.905246965160539e-03; +1.390310012984801e-01   +1.437602886520212e-01   +1.794501632101904e-01   +9.432706393848507e-02   +1.921759472871005e-02   +1.769106068659526e-01   +1.795742487567373e-01   +8.750499031171716e-02   +9.625702654052895e-02   +8.214973973657581e-02   +9.902477265370488e-02   +3.019064908476566e-02   +1.752694140090476e-02   +3.294081121080693e-02   +1.729476150955388e-01   +1.250916592096494e-01; -2.940311217314599e-04   +4.971632496856150e-03   +9.831645951665535e-02   +1.292471956312384e-01   +4.353294848436048e-02   +1.614185990987378e-01   +9.427963603384330e-02   +1.980509839204792e-01   +9.620795256466463e-02   +5.816615726237837e-02   +1.799771462996518e-01   +1.852951894307698e-01   +2.247478263504449e-02   +1.915908955969683e-01   +4.588068957393107e-02   +6.257901880482382e-02; +1.009315063980100e-01   +1.335078517505206e-01   +1.285087118783876e-01   +1.473481972909264e-01   +8.188932624220598e-02   +1.748416346767443e-01   +1.050006209453529e-01   +5.574891852310074e-02   +1.127566501944898e-01   +1.762825093172555e-01   +7.686737540419276e-02   +1.448787510761288e-01   +4.855474760320362e-02   +6.726705649101634e-02   +1.867367689301179e-01   +3.370393262013117e-02; +1.017722649864490e-01   +2.893090822886697e-02   +1.747704893196339e-01   +3.763734457133016e-02   +1.272166447938207e-01   +6.571923965057858e-02   +9.088732335136927e-02   +4.265392603680822e-02   +9.892759391774623e-02   +1.004271440055338e-01   +1.500679778094015e-01   +5.319168993949692e-02   +9.728288238175699e-02   +1.116528256742305e-01   +9.641260177269109e-02   +1.485447586817768e-01; +6.344422369862622e-02   +1.393253361315594e-01   +1.940522382933245e-01   +1.340716622769058e-01   +8.022023729631732e-02   +1.247463160479583e-01   +7.953018121646803e-02   +1.683711639725369e-01   +1.987841950063692e-01   +7.793888093979098e-02   +3.496601473402916e-02   +3.722759280234094e-02   +8.937909779779542e-02   +1.969303218332215e-01   +1.123905704275336e-02   +4.911613642215693e-02; +1.172218585167474e-01   +7.137590700894061e-02   +1.575618577310362e-01   +1.297350372719795e-01   +1.264197157561061e-01   +3.142925670397218e-02   +1.172303882581175e-02   +9.421884125171208e-02   +1.623959865841838e-01   +1.365114920916985e-01   +5.826488738625039e-02   +1.568985803427185e-01   +5.811895732933359e-02   +2.118268203371104e-02   +1.495162056891854e-01   +1.285831991086231e-01; +4.948637564110101e-03   +1.388396944795726e-01   +1.387124455695167e-01   +1.401601286845822e-01   +2.138359522838703e-02   +1.820204986217958e-01   +8.659490358356124e-02   +9.224740033835109e-02   +9.854981315623500e-02   +9.797257842944497e-02   +3.737617774043916e-02   +1.873764390645342e-01   -1.686039220824408e-03   +1.568566502452736e-01   +7.603225158711120e-02   +1.019215385487608e-01; +1.430283237259645e-01   +2.631507034655357e-02   +1.842769209974638e-01   +1.695731388366953e-01   +1.310077298375412e-01   +3.923058708744483e-02   +1.847160278228305e-02   +7.541855093922870e-03   +1.538312921298591e-01   +8.596032126704163e-02   +2.575192234050636e-02   +1.144350756806491e-01   +1.747414012823593e-01   +5.039273771508322e-02   +1.762335161658076e-01   +1.306211731834835e-01; +8.386588835116936e-02   +1.044274992610997e-01   +1.019825958980766e-01   +1.611804984020920e-01   +1.797091647340520e-01   +4.144250131026422e-02   +1.331623750439310e-01   +1.199680727414814e-01   +5.245904506398174e-02   +5.575627911616827e-02   +1.491314097452183e-01   +1.964988585797618e-01   +2.758909817441425e-02   +1.470003675527748e-01   +1.570445363290089e-01   +4.025820998613158e-02; +1.095370509157181e-01   +6.074115068441374e-02   +2.371160234448360e-02   +5.209918255064602e-03   +2.000265181742602e-01   +1.840824970627080e-01   +1.123275862554402e-02   +1.429986948068002e-01   +1.458245824493390e-01   +6.288091292133077e-02   +2.696630698067565e-02   -1.154523907974600e-03   +1.875675161853159e-01   +1.897457592329545e-02   +1.128807246385799e-01   +8.522905529587051e-02; +1.341196219599113e-01   +1.507242328480724e-01   +1.826685937354434e-01   +3.383397723804371e-02   +1.317661827507950e-01   +1.444523781937521e-01   +1.459642691150060e-01   +1.313647160266559e-01   +1.880117541866932e-01   +8.815884904378314e-02   +8.525766469346312e-02   +1.846428473597858e-01   +1.685971289356444e-01   +1.456812549572628e-01   +9.778563951739463e-02   +1.830721815204575e-01; +1.779412735822988e-01   +1.357344084196916e-01   +6.243299271291416e-02   +1.239354973698472e-01   +2.288041335019217e-02   +5.126648799915381e-02   +1.577586970676362e-02   +5.248698981899080e-02   +7.271962891331786e-02   +1.483933751229151e-01   +4.163104153584475e-02   +1.687395467710580e-01   +1.152471865944310e-01   +1.282944082064523e-01   +8.526733126837231e-02   +6.579329257696240e-02; +8.675738805091432e-03   +1.112166698262309e-01   +1.712600527913751e-01   +1.105260175299653e-01   +5.690356388047641e-02   +3.829709883662710e-02   +6.183562918020714e-02   +8.465246792987891e-02   +4.499755058719820e-02   +2.064964861395795e-01   +6.832239327656010e-02   +1.273813371954512e-02   +3.705784211871339e-02   +1.513179811471797e-01   +4.312378503915144e-03   +1.395876820842648e-01; +1.631711049704917e-01   +7.488130882901002e-02   +4.095847084491284e-02   +1.951816945425490e-01   +2.399988998077546e-02   +3.281472998234739e-02   +1.836931864473232e-01   +3.251039184115975e-02   +1.199257266920640e-01   +1.612912291916951e-01   +1.371150001927794e-01   +3.320423102539887e-02   +1.573860189766016e-01   +1.600784874482573e-01   +1.922075575323901e-01   +1.796818503580425e-01];
L1E_L1I_iGABA_netcon = [+1.029197922614927e-01   +1.275691016295613e-01   +7.539788225789983e-03   +6.407810970979180e-02   +1.666569047657303e-01   +8.189032478659823e-02   +7.560132178956395e-02   +4.767139247228094e-02   +2.278517981703900e-02   +7.311510983191649e-02   +7.072144905575684e-02   +1.223709526865168e-01   +6.218427940634448e-02   +1.832250661400207e-01   +4.450168399966233e-02   +1.037632493455990e-01; +2.465889456077839e-02   +1.877798312447762e-01   +1.022737937975024e-01   +1.809903608153938e-01   +9.210132236689302e-02   +8.962922291236121e-02   +3.600648202597345e-02   +9.808780279451135e-02   +1.038775653674797e-01   +2.943873788353773e-02   +3.751060919722343e-02   +1.476005569054180e-01   +9.793449863869741e-02   +1.459110249269475e-01   +1.030174634994331e-01   +1.504780735177524e-01; +1.315371573705819e-01   +2.089797484264327e-01   +1.644600929192606e-01   +1.349706720434793e-01   +2.079560644028035e-02   +1.203177396454670e-01   +1.366393436639688e-01   +1.788282281391473e-01   +1.814098031103445e-01   +1.974302511574372e-01   +1.369092698691521e-01   +1.058994780693677e-01   +1.975355747653858e-01   +1.701482221541473e-01   +8.954475435164362e-02   +1.210217779744658e-01; +1.776753077727679e-02   +2.860701142834932e-02   +1.827201203703759e-01   +1.221850986606863e-02   +3.708934368689611e-02   +1.470053808509557e-01   +1.488181643068578e-01   +1.159572840852438e-01   +1.063871649684447e-01   +1.966356268923983e-01   +1.323056389249630e-01   +1.717402690754883e-02   +7.628468699081389e-02   +4.013850814725439e-02   +1.924787111327267e-02   +2.017415218241107e-01; -1.217758989762653e-03   +1.778461342667366e-01   +1.025182955579200e-01   +2.335572136974083e-02   +8.638357449337038e-02   +1.704629989866155e-01   +1.498732803165077e-01   +8.389489463495325e-02   -1.048791750851201e-03   +3.555661912039661e-02   +1.441790820617005e-01   +2.243131603660083e-02   +1.710171015721642e-01   +9.730494772905339e-02   +1.310937090529990e-01   +1.096147828656626e-01; +1.614635105535732e-01   +1.898255087607734e-01   +2.374138333435155e-02   +1.414490033673789e-01   +7.573585321203370e-02   -4.144908426275041e-03   +1.417623728011655e-01   +6.021469566683224e-02   +1.736627366226911e-01   +2.765510056017038e-02   +1.960794685241611e-01   +2.824400403183432e-02   +7.542342871563754e-02   +2.691959545883345e-02   +1.097501384559431e-01   +2.569500594548658e-02; +1.085948679236333e-01   +4.048718387339456e-02   +2.546368898337237e-02   +5.383959147643891e-02   +4.308139196026288e-02   +7.937773711680861e-02   +6.262429743700038e-02   +1.123443292081098e-01   +1.830012117695687e-01   +3.497953175672155e-02   +1.600421480427537e-01   +2.104359315636135e-01   +2.039115111409704e-01   +1.014820851931271e-01   +1.065480485128428e-01   +6.390149447946028e-02; +5.913924457432242e-02   +4.340290501925231e-02   +8.372004998513808e-04   +2.664038139427870e-02   +1.443389878422995e-01   +1.047064302661128e-01   +1.028980894638375e-01   +1.251163882810745e-01   +4.443076519178257e-02   +8.906433207776719e-02   +1.737674344915243e-01   +1.954535145038598e-01   +1.110744716560458e-01   +9.705373008075471e-02   +3.456988480672501e-02   +1.463022095734528e-01; +6.046796789757137e-02   +1.269784916411434e-01   +6.030251536613990e-02   +1.288432528199360e-04   +3.387507927829660e-02   +1.392548039548750e-01   +1.676380113809202e-01   +1.837802898356327e-01   +7.356394513174641e-02   +2.357753434844847e-02   +1.541463815788959e-01   +7.628356593100595e-02   +1.804023557828294e-01   +1.978428365175641e-01   +1.221278295877483e-01   +1.903373532693523e-02; +9.295619171941978e-03   +8.200179078848410e-02   +3.705769113686560e-02   +1.180581780207323e-01   +7.876718982936348e-02   +1.709790616108860e-01   +6.012755381053962e-02   +4.377780305277122e-02   +1.889339066819639e-01   +1.562206272508831e-01   +4.603860089526391e-02   +1.250182923907537e-01   +1.553453769689548e-01   +4.073788157375816e-02   +1.599611464097077e-01   +4.043475061717558e-02; +1.759067245889617e-01   +2.238827130370348e-02   +6.902507570227502e-02   +8.209601377395799e-02   +1.101644226089452e-01   +1.343996455664330e-01   +9.029549846515775e-02   +1.984909287913370e-01   +6.405529942784990e-02   +7.954880130809099e-02   +1.222269659812797e-01   +1.032685718725672e-01   +4.876305100902647e-02   +1.988957458103904e-01   +1.788238320667924e-01   +6.859765673051409e-02; +3.710972673816060e-02   +1.868310707999065e-01   +1.164879998733159e-01   +1.902227096727438e-01   +1.980301401382691e-01   +1.350449464742419e-01   +1.006152521827944e-01   +3.272796565401426e-02   +1.481838874007718e-01   +1.024458289659390e-01   +6.890932170781452e-02   +1.683053899164669e-01   +1.438816584524254e-01   +9.667984483110473e-02   +1.663647586616049e-01   +4.903934680077784e-02; +1.442022617883948e-01   +2.223393064785876e-02   +1.125681561415977e-01   +2.681434182783621e-02   +1.081925059490045e-01   +1.208177143866129e-01   +1.224822871476285e-01   +4.632808721454078e-02   +1.532909749893175e-01   +1.787405563584871e-01   +3.805065081541167e-02   +1.583494739665562e-01   +1.979511983867476e-01   +1.293887627615228e-01   +7.235363479028811e-02   +2.386013174543941e-02; +5.019541306787679e-02   +5.753771535936245e-02   +5.089968650849504e-02   +2.042675437088726e-02   +4.301704411723876e-02   +1.782852798229967e-01   +1.931592927300858e-01   +1.544272045394680e-01   +8.993327824924986e-02   +1.294792668217833e-01   +2.050255545554062e-01   +1.506563357889819e-01   +1.292981920104723e-01   +1.773810762103697e-01   +1.327985243625092e-01   +1.475746256621158e-01; +8.830048709761834e-02   +3.567734724113673e-02   +9.500501713714535e-02   +1.740917588549465e-01   +1.266872152475662e-01   +1.057925080126419e-01   +2.364334046554312e-02   +6.724187542408899e-02   +3.536558932523150e-02   +1.097082028514644e-01   +5.684456788037155e-02   +9.080214486014784e-02   +7.168971333585729e-02   +4.562234678069876e-02   +2.788876590006501e-02   +6.303305557280836e-02; +9.132755176764962e-02   +9.652689458851440e-03   +4.174944119375334e-02   +1.889640717838160e-01   +1.948588389659085e-01   +1.604004623295158e-02   +4.079961643472759e-02   +1.655245149354143e-01   +1.664888434139001e-01   +2.619810824396798e-02   +7.561502750902312e-03   +1.247828937013753e-01   +1.366426842224698e-01   +1.098284365552108e-01   +8.067800139524967e-02   +9.719604362508355e-02];
L2I_L1I_iGABA_netcon = [+2.036398951177695e-01   +1.024621919870275e-01   +5.890596199376921e-02   +1.785175591012557e-01   +1.931940180203352e-01   +1.890142358410265e-01   +7.415299660165471e-02   +1.603156366109905e-01; +1.644367405145962e-01   +1.740149543197845e-01   +1.451734960833105e-01   +6.028596140473493e-02   +8.843059488438743e-02   +1.388179266620040e-01   +1.893182553107827e-01   +5.064318758181086e-02; +4.376676849658152e-02   +4.573164054822422e-02   +5.499557950522301e-02   +6.454285456450215e-03   +1.654135410283980e-01   +1.964083130208411e-01   +2.312412448264020e-02   +1.230520945991408e-01; +8.305251950907655e-02   +1.616466835409937e-01   +1.376810779740271e-01   +1.291595031357972e-01   +1.287685249199678e-01   +1.277579218001644e-01   +1.044517367879297e-01   +1.635801923823263e-01; +6.680089828411499e-02   +3.366188437322330e-02   +1.269449248151802e-01   +1.218378832611206e-01   +9.767511140483233e-02   +1.569494580942636e-01   +1.028657458104330e-01   +1.180179283904478e-01; +1.594983052045316e-01   +1.494260804473438e-01   +1.895527702759912e-01   +8.901325318656148e-02   +5.785149260561159e-02   +1.427199902219982e-01   +2.263657668235879e-03   +1.435217945856384e-01; +2.643236857105039e-02   +7.488359281265869e-02   +7.574594750584968e-02   +5.304342039563738e-02   +1.484992186983274e-01   +5.492454472463146e-02   +4.240046497573204e-02   +1.355037402457303e-01; +1.192921002590319e-01   +7.377731958729737e-02   +1.665274272226186e-01   +8.406916458958157e-02   +6.057703051311348e-02   +1.468079106699982e-01   +9.420630513108130e-02   +6.827806145786468e-02; +8.447965197372566e-02   +1.427683872421141e-01   +4.053831801018269e-02   +4.935837608677456e-02   +6.647124137391142e-02   +3.243642563308841e-02   +8.765256214855184e-02   +1.985145471768045e-01; +1.138839996504394e-01   +1.380210680749570e-01   +5.071618263945713e-02   +1.107275869347130e-01   +8.650576521846400e-03   +1.463667354378637e-01   +1.861577472734015e-01   +1.350522077147201e-01; +1.113381284711302e-01   +1.635386824939340e-01   +1.733871301476982e-01   +7.014174151534908e-02   +1.470213652129470e-01   +1.986641872253833e-01   +4.076115299970277e-02   +5.425536942021133e-02; +1.605380133977023e-01   +1.033388981427364e-01   +1.186445771851316e-01   +8.685924745801420e-02   +1.986038695819833e-01   +5.585246131183966e-02   +1.326603493734199e-01   +7.450782676231775e-02; +6.540865329993537e-02   +1.994720710139025e-01   +1.887579028669974e-01   +4.140662403872781e-02   +1.156249381833641e-01   +6.749440516000106e-02   +6.579865603033230e-02   +1.107290760050389e-01; +1.486995584475405e-01   +5.188719034408721e-02   +2.058437157762127e-01   +1.068498370970368e-01   +1.684617110300843e-01   +3.798521675233267e-02   +1.955779081336424e-01   +4.960847071378655e-02; +2.022068641038589e-01   +4.294160683504576e-02   +5.856854399450257e-02   +1.927516722695399e-01   +1.375505790584259e-01   +2.241288889849246e-02   +8.241839553921343e-02   +1.447694671920896e-01; +4.234509904169906e-02   +1.476747356931409e-01   +1.447757413566392e-01   +1.295707536555034e-01   +1.735022086258908e-01   +2.414044287756506e-02   +2.045286025770899e-01   +6.012720018656915e-02];
L1I_L2I_iGABA_netcon = [+1.220286257254527e-01   +1.393888877640765e-01   +6.106606519566622e-02   +1.619345319830213e-02   +1.106272014767561e-01   +7.328305683758990e-02   +1.988685939242492e-01   +1.457766762298877e-01   +8.242478666816402e-02   +1.571468641027481e-01   +2.874947393046417e-02   +6.172546788463475e-02   +2.141938216911457e-02   +3.333403829735813e-03   +3.705557615306345e-02   +1.683968887126892e-01; +1.649729155976621e-01   +1.253966034113266e-01   +8.210457611469547e-02   +9.647167396927217e-02   +1.905138353179612e-01   +9.544797632854070e-02   +1.375399102305689e-01   +1.953142113010685e-01   +9.356951225907752e-02   +1.994076905162722e-01   +1.337352579618200e-01   +7.540946321504545e-02   +9.835615775788897e-02   +1.676238306235953e-02   +3.444356942415305e-03   +1.829904188558177e-01; +1.770346659314101e-01   +1.226848886459684e-01   +4.000072521789672e-02   +1.690921438834482e-01   +6.723603708560751e-02   +1.809440995841335e-01   +1.519572315071128e-01   +1.345990517108128e-01   +7.792144709413364e-02   +7.568941592903869e-02   +1.408460279080650e-01   +8.243078278671902e-02   +6.916602560978916e-02   +3.515634044812477e-02   +1.234273550642962e-01   +2.943890433845043e-02; +8.054594080116396e-02   +6.727279049530489e-03   +1.222768580779838e-01   +1.750072041525712e-01   +2.174925079462995e-02   +4.531517005971939e-03   +7.445964661111808e-02   +6.738450548468065e-02   +1.597293326478903e-02   +1.330224652084802e-01   +1.146756628854042e-01   +9.689701881647447e-02   +4.576217611729146e-02   +1.488633939132197e-02   +1.642858006977767e-01   +1.078915239694423e-01; +1.577496438650850e-02   +1.725993224626623e-01   +1.690906356030785e-01   +1.377870684068772e-01   +1.235954768994124e-01   +1.046954792906548e-01   +1.277929807933721e-01   +1.746841215815227e-01   +1.250366616542387e-01   +5.185169813340810e-03   +6.835143448169786e-02   +3.670944864260323e-03   +5.359412640854123e-02   +1.813076021319352e-01   +4.267259711618070e-02   +1.019323288228882e-01; +1.316612620975023e-01   +1.486896553923781e-01   +2.634478066124476e-02   +1.827395842104576e-01   +1.199770003025298e-01   +1.991204767796996e-01   +1.496864623342135e-01   +1.718361684805227e-01   +1.139782226905990e-01   +1.175502088827853e-01   +2.054567842371758e-01   +1.657110705727250e-01   +3.361684464598042e-02   +1.851579500598056e-01   +1.487336538124317e-01   +1.885114737595007e-01; +1.571837578936204e-01   +2.525757903591091e-02   +1.756317989794273e-01   +2.056738685876817e-01   +8.337627036656586e-02   +2.004821149742381e-01   +1.069329317508273e-01   +9.992381161000685e-02   -3.741680235388343e-04   +1.181385647024292e-01   +6.195205418633739e-02   +6.974145061040041e-02   +1.583185432364136e-01   +8.257910483169117e-02   +1.681117002730627e-01   +1.157975938544294e-01; +1.480359442060459e-01   +1.750866699370110e-02   +1.829550296267194e-01   +1.468589807098294e-01   +1.963864458701694e-02   +1.630244922135946e-01   +1.239085865878166e-01   +1.602469599194054e-01   +6.828359068008397e-02   +1.804255650713918e-01   +5.663077144277857e-02   +1.028042021107421e-01   +1.052487150241244e-01   +5.459848054561635e-03   +1.822083550465887e-01   -1.127619318291543e-03];
L2E_L1E_iAMPA_netcon = [+1.637374244846245e-01   +6.196258413955675e-02   +2.978285546164905e-02   +2.044749320582768e-01   +1.479859707421970e-03   +9.968101316983619e-02   +1.416830922700392e-01   +2.175979982973074e-02; +1.965150418300503e-01   +1.769476920768777e-01   +1.153137846593888e-01   +7.910437982341988e-02   +1.025629535725148e-01   +4.197900448382788e-02   +1.893511750744357e-01   +8.397222543362021e-02; +2.071663906759380e-02   +2.665997903938628e-02   +6.285883338126028e-02   +2.811303229775973e-02   +1.288072160365014e-01   +1.694670802855054e-01   +6.306646765387082e-02   +6.644649876510415e-02; +5.625090914184678e-02   +1.483513989563179e-01   +4.029921218192779e-02   +1.399439060891557e-01   +1.560412044589806e-01   +6.233810770290749e-02   +1.882146824955614e-01   +1.707646189779902e-01; +3.464614944399500e-02   +2.045952742544603e-01   +2.826245103546186e-02   +4.323036018225360e-03   +1.904683718464512e-01   +1.961629161865340e-01   +1.377963947510529e-01   +8.985618017737995e-02; +1.427971191493925e-01   +1.039927142494872e-01   +1.943333800817947e-01   +1.567804135085415e-01   +1.412842971903508e-01   +5.090164648906454e-02   +1.598210312532164e-01   +1.420865572978746e-01; +1.872099328491932e-02   +6.850961401316288e-02   +5.193659566093944e-02   +9.393695260396510e-02   +1.859734667642467e-01   +9.613742603337516e-02   +3.594063036424269e-02   +7.315576699257745e-02; +8.994252480107844e-03   +2.829870962457599e-02   +1.075390936309908e-01   +1.354693296617508e-01   +7.908031366953985e-02   +1.839706309231203e-01   +1.955234041657206e-01   +1.899629100580495e-01; +7.367607558012804e-02   +1.812126134026983e-01   +8.014207325101524e-03   +5.379569568248563e-02   +2.936243707460970e-02   +2.027195387183874e-01   +1.178856458161416e-01   +1.712665917400795e-02; +5.420689537742521e-02   +5.834132281046273e-02   +1.765995450785633e-01   +7.868815618197884e-02   +1.664172042217515e-01   +1.634566921641798e-02   +2.754395504846392e-02   +1.928269175351746e-01; +1.201370747137717e-01   +9.901848580426120e-02   +3.697149703553024e-02   +1.261065187230061e-01   +8.739070293373992e-02   +8.619880356782497e-02   +1.245464938603148e-01   +1.836017258340902e-01; +5.194982713360070e-02   +9.282584817128130e-02   +1.681456419098711e-01   +1.518085416775926e-01   +1.381639428341779e-01   +3.764896153821638e-02   +2.097145877881584e-01   +5.016145179696001e-02; +1.209683355540865e-01   +1.727059954137686e-01   +4.905801609138933e-02   +9.316888214176713e-03   +2.015023695608785e-01   +1.417032977416351e-01   +8.701755115067779e-02   +1.663714316252967e-01; +8.214707208064218e-02   +1.147535041269757e-02   +2.238456499392390e-02   +1.421891780686690e-01   +1.682690017431202e-02   +6.139464085255664e-02   +1.013126364622372e-02   +1.562504159610388e-01; +5.898667787634700e-02   +4.091432394727653e-02   +1.365571539852890e-02   +1.582843030420417e-01   +1.939099924348853e-02   +1.927081314179964e-02   +8.402077681814257e-02   +4.703830668698824e-02; +3.110810107483393e-02   +9.573836328071704e-02   +2.274537481979472e-02   +1.094451051125941e-01   +5.198957036089881e-02   +1.128340612880500e-01   +2.362239399481229e-02   +1.687919417716750e-01];
L1E_L2E_iAMPA_netcon = [+7.545496987377993e-02   +3.230086001320916e-02   +1.944772478787120e-01   +1.922378907946170e-01   +6.604203649521075e-02   +1.992677048919700e-01   +1.011585748430915e-01   +2.012910654442796e-01   +2.822902471224231e-02   +1.340505740391149e-01   +1.267693985200833e-01   +1.568501452240979e-01   +7.695481219372903e-02   +1.384253422651541e-01   +1.175478207249158e-01   +1.011855854539466e-01; +8.130625024429076e-02   +1.058670174877977e-01   +4.325259159332689e-02   +1.545872998245730e-02   +1.652711207795145e-02   +1.332533092985814e-01   +1.421315061051103e-02   +6.803600417534167e-02   +5.128289156109025e-02   +7.076053416025124e-02   +5.482690626531690e-02   +1.946809564327482e-01   +3.145374970431988e-02   +5.137269780514406e-02   +1.213854672114244e-01   +5.460876193526225e-02; +7.198352520489668e-02   +1.201421436682504e-01   +1.868451414516736e-01   +1.884382884146186e-01   +1.942277373438935e-01   +2.230177175138033e-02   +6.562632298474427e-02   +1.775648199380772e-02   +8.718301264724218e-02   +1.222611433314907e-01   +6.167248488217227e-02   +2.471008140314028e-02   +1.474104574224225e-01   +1.261976053114700e-01   +1.758912363764258e-01   +1.855767199414640e-02; +1.575617646666800e-01   +7.992478339246916e-03   +4.515464995087263e-02   +3.812245986474960e-02   +1.458379207410605e-01   +6.433119959933158e-02   +1.914736045511025e-01   +1.799919358983327e-01   +1.562386729900002e-01   +1.611207488385507e-01   +9.341939713583947e-02   +1.090932358318829e-01   +1.934693636157200e-01   +7.014102134288319e-02   +1.892749696994235e-01   +2.003437568167232e-01; +2.966028421911471e-02   +1.809742640228281e-01   +1.770076211811271e-01   +8.184384139754013e-03   +3.625438873748926e-02   +1.683031693142338e-01   +1.874939459974274e-01   +3.524512827259204e-02   +1.193782677722397e-01   +8.692256391877257e-02   +1.159259299813745e-01   +1.585108686074841e-01   +5.155584700360696e-02   +1.140971332508144e-01   +2.050054218218507e-01   +1.240195073040511e-02; +1.113990450152897e-02   +1.802378730875221e-01   +5.819940423097761e-02   +1.714565169385080e-01   +2.065893889700749e-01   +1.801325877816216e-01   +1.099838556674191e-01   +1.901141794470056e-01   +6.725169678297244e-02   +8.441834801625170e-02   +1.737017928816257e-01   +1.863770449700140e-01   +1.717837074146473e-01   +1.277759156201370e-01   +4.106404459409307e-02   +1.141721127217276e-01; +6.776435407728865e-02   +4.291674656505014e-02   +1.206814347486871e-01   -2.344886630938296e-04   +7.957669562862091e-02   +1.053358638530172e-01   +1.579950609940554e-01   +1.212503650645793e-01   +1.208953570889143e-01   +1.667581312930091e-01   +1.354714312956487e-01   +2.823170072199809e-02   +8.169575749250299e-02   +1.156411663289706e-01   +5.292440621246713e-02   +6.746642124315466e-02; +1.669674620808325e-02   +1.057984162755542e-01   +9.608226768956882e-02   +8.406609700165837e-02   +1.525445923239516e-01   +2.014107744043905e-01   +1.971062764734379e-01   +1.332644514480134e-01   +1.801714584811488e-01   +8.818478058821273e-02   +7.005880519636835e-02   +2.004897142356066e-01   +1.404519264304929e-01   +1.853893717676818e-01   +6.893372344893724e-02   +2.041345420641463e-02];
L2I_L2E_iAMPA_netcon = [+1.336446511889432e-01   +4.945908391954971e-02   +1.852114649919632e-01   +9.800750692236788e-02   +1.598038758652307e-01   +5.789237052941855e-03   +4.112839789455426e-03   +1.879180991738777e-01; +3.360176573751781e-02   +2.077311254542752e-02   +3.853765095770777e-02   +1.752847236410035e-01   +1.578817486842346e-01   +7.849812069248191e-02   +1.434446752253842e-01   +1.009510980960282e-01; +1.719995222152730e-01   +1.525286983714772e-01   +1.669962835886963e-01   +1.561162146643154e-01   +1.069150897930521e-01   +1.042999902265584e-01   +1.021164326351044e-01   +1.537252924822492e-01; +8.043210875810514e-02   +3.339167125526506e-02   +1.875976623347469e-01   +9.113648453229227e-02   +1.942718901337349e-01   +3.241451598851550e-02   +9.290839269848997e-02   +1.733852637861596e-01; +1.384995301735110e-01   +1.761823648380792e-01   +1.290206535457863e-01   +1.253647773810760e-01   +1.855497007871645e-01   +1.541118108510828e-01   +8.573300379937261e-02   +1.494044062977652e-01; +1.243954657548957e-01   +3.894952317614877e-03   +1.804539373375424e-01   +1.530205817743557e-01   +1.083655957047188e-01   +4.285355706401874e-02   +2.516287684535549e-02   +1.415668000978316e-01; +2.001598707039235e-01   +9.682980816027552e-02   +3.488411551497035e-02   +9.452359260298355e-03   +2.680984066955050e-02   +4.446743480336018e-02   +3.317851749915386e-02   +4.311769195352204e-02; +1.904401893291068e-01   +6.058923848756140e-02   +1.158545057501346e-01   +9.428427333817407e-02   +1.741597868659861e-01   +5.450360921709858e-02   +2.183889298308566e-02   +8.452983314269738e-03];
L2E_L2I_iGABA_netcon = [+1.908422699400296e-01   +4.497882289178670e-02   +4.126977867961167e-02   +3.320504587246172e-02   +1.376688651611838e-01   +8.034671892669985e-02   +1.723495407002910e-01   +1.960268464481937e-01; +4.965553414598373e-02   +8.386358906616651e-02   +2.786864304978359e-02   +6.905553346671660e-03   +2.052110286384395e-01   +1.477245400193259e-01   +1.571808278970432e-01   +1.710993686436743e-02; +1.321640208991712e-01   +7.481474610921608e-02   +1.152665196176277e-01   +1.588572706345105e-02   +8.108453210751655e-02   +2.246714095646225e-02   +1.939462145964504e-01   +1.722390211091867e-01; +1.737653788067907e-01   +1.508018098631547e-02   +5.575671305779770e-02   +1.510064392779905e-01   +1.913388886672675e-01   +1.321470136130820e-01   +9.071357516565624e-02   +1.378817329085215e-01; +3.467487632545004e-02   +1.879612308894398e-01   +1.111554900767015e-02   +1.674433355048476e-01   +6.285307069158146e-02   +7.283689870411178e-02   +1.146657173684240e-02   +5.656004199509754e-02; +1.502746675608454e-01   +7.904982885356578e-03   +1.102856437884961e-01   +1.611682412289356e-01   +1.822239053725428e-01   +5.394647241109745e-02   +1.941252523384673e-01   +1.532648935072048e-01; +3.055150718197725e-02   +2.044164562576626e-01   +6.117926945254018e-02   +6.681757146526186e-03   +1.497916990501083e-01   +1.079001299364045e-01   +1.201942399909500e-01   +1.257352716629195e-01; +1.803362699336818e-01   +6.774080161218934e-02   +1.033369117819264e-01   +4.426864610753119e-02   +9.633528726709209e-02   +1.596273249458839e-01   +1.958096159177024e-01   +1.310496763341075e-01];
L3E_L2E_iAMPA_netcon = [+6.655784291082535e-02   +1.362978443956310e-01   +3.041720974072524e-02   +1.680423918234743e-02   -2.960325331449447e-03   +2.026984854175632e-01   +7.952306733779209e-02   +1.765481831325144e-01   +2.037751282727251e-02   +5.775121292530203e-02   +5.400759984022714e-02   +1.495447414915956e-02; +5.721524775207298e-02   +1.896903498207826e-01   +6.233191366361881e-02   +7.109680157625048e-02   +9.830333367688134e-02   +1.133856855217283e-01   +1.825729952165513e-01   +2.036414285055888e-01   +1.199745082403912e-01   +1.972414244251140e-01   +6.831226463628960e-02   +4.944889916751752e-02; +1.490547295356792e-02   +1.596615657933931e-01   +2.154014748806336e-02   +1.533064842749872e-01   +3.339587114159055e-03   +4.384619150674150e-03   +1.069225530838512e-01   +2.013773794860477e-01   +1.245929563423624e-01   +1.243033254067158e-01   +5.233298852737292e-02   +1.381844899154494e-01; +1.050862633105160e-02   +4.074136691122444e-02   +1.690669369571051e-01   +5.436853659157825e-02   +5.981462374703540e-02   -6.533874727715442e-03   +6.999896507401497e-02   +1.323446538959726e-02   +3.981152055816917e-02   +7.134488889928453e-02   +4.236492481169038e-02   +6.668561076476040e-02; +1.863501308544943e-01   +7.481077809579273e-02   +6.827758981613606e-02   +2.005317015499445e-01   +1.417385036079467e-01   +7.366160311997823e-02   +2.008123661384486e-01   +3.252682824286852e-02   +1.722872815862941e-01   +9.906539027040923e-02   +1.410021267586890e-01   +7.888745937561432e-02; +1.831091028555751e-01   +1.239816924655516e-01   +2.062515218332264e-02   +9.760657961555172e-02   +1.315030752164684e-01   +1.955937388643831e-01   +1.853522291065386e-01   +7.660745229498728e-02   +9.585022652784991e-02   -2.098788592202570e-03   +1.344141080601036e-01   +5.267804906317902e-02; +1.310233781556032e-01   +1.071877674546117e-01   +1.308338608494088e-01   +4.723579666131114e-02   +1.436692378451383e-02   +7.726948010648264e-02   +2.307760376336221e-03   +7.344002675027173e-02   +6.288102494670901e-02   +1.893619597945378e-02   -1.365474205573958e-03   +9.564337049470520e-02; +1.700407643889187e-01   +2.668478176609457e-02   -2.064152680513716e-03   +5.823663278369150e-02   +1.118642549761236e-01   +2.168823271128541e-02   +5.329654848542777e-03   +9.420986463011972e-02   +9.906178243798987e-02   +1.706728205805793e-01   +1.942669825136699e-02   +1.283184335972272e-01];
L3I_L2I_iGABA_netcon = [+1.964432293156767e-01   +1.062366613591488e-01   +1.359182677583133e-01   +5.662090937737384e-02   +1.999895161164569e-01   +8.667506502163683e-02   +1.162615605094653e-02   +5.482743154293234e-04   +1.772451825604211e-01   +9.556987647003780e-02   +1.916441101042668e-02   +1.558583507155010e-01; +1.850086721510454e-01   +1.996023313148214e-01   +1.784114776637073e-01   +3.495555304512661e-02   +1.034243539017031e-01   +1.686518949444044e-01   +1.015332700598498e-02   +4.713548357956691e-02   +9.975072672322059e-02   +1.376006819730994e-01   +2.760696453640214e-02   +1.306107003076273e-01; +2.586589601008250e-02   +1.775123570724138e-01   +1.877970730736211e-01   +1.972537888936382e-03   +1.401702963988387e-01   +4.003007338112607e-03   +1.293486418209604e-01   +1.947280668228426e-01   +1.471413461260033e-01   +1.488485495463513e-03   +1.301369771932950e-01   +2.511615266024911e-02; +2.031163952142593e-01   +5.214144078647023e-03   +8.563280743785841e-03   +1.352482912041282e-01   +1.814005547720705e-01   +1.097071433463431e-01   +5.304819119247668e-03   +1.002309828980139e-02   +1.822009199989638e-01   +1.660783973870792e-01   +2.075793061469730e-01   +1.093145433110959e-01; +3.542777185199496e-02   +1.968859038187650e-01   +8.478334525434404e-02   +9.135518156427302e-02   +1.217566813887460e-01   +1.923819928268645e-01   +8.258311217675576e-02   +3.001405782224914e-02   +2.113281340078839e-01   +1.044464614960205e-01   +4.592696969819712e-02   +3.741940717278737e-02; +1.109391492317165e-02   +1.366675039963075e-01   +4.026984244916604e-02   +6.408974367310555e-05   +2.815790710195227e-02   +1.361658540643441e-01   +1.441735989155138e-01   +5.211412190734981e-02   +9.454754564024842e-03   +1.559237466608988e-01   +1.789587210910313e-01   +1.324929357394387e-02; +1.262026511105913e-01   +1.809533012052600e-01   +1.184992463884261e-01   +1.402908145789459e-01   +8.767907227182030e-02   +5.851771405293366e-02   +1.394022690934136e-01   +4.050819813902714e-03   +1.759117990697805e-01   +7.796199122653912e-02   +1.004350952639280e-01   +1.465643618652343e-01; +1.042686118734530e-01   +3.656544412427418e-02   +7.228719194326361e-02   +1.260353339270630e-01   +7.249379267673592e-02   +2.400621251550015e-02   +4.937070827742220e-02   +5.557004263509085e-02   +1.149853699995447e-01   +1.955655859203640e-01   +5.613793645164777e-02   +6.059382271738909e-02];
L2E_L3E_iAMPA_netcon = [+1.398478668930952e-01   +1.378501179004071e-01   +5.200651925422051e-02   +1.725914871015518e-01   +1.263483233491104e-02   +1.035432681109613e-01   +1.432096954022260e-01   +1.943130998980671e-01; +1.115876763120192e-01   +1.504021215624693e-01   +1.541107438709324e-01   +1.603802290743291e-01   +1.590063766638121e-02   +1.128009420804922e-01   +1.756182571449448e-01   +1.418648141081601e-01; +1.687844578883037e-01   +1.782737409822270e-01   +1.722620179904931e-01   +1.901638588091877e-01   +1.185749089119951e-01   +1.310068155003691e-01   +1.796146217834316e-01   +1.219954467056365e-01; +7.976271284709001e-02   +1.984863037534508e-01   +1.774823964058674e-01   +1.247281028354314e-01   +1.022684845946543e-01   +1.106052892568014e-01   +5.932094474422792e-02   +3.545277243868819e-02; +2.808349687078784e-02   +1.141657687645927e-01   +5.404081166164051e-02   +2.048639304737363e-02   +3.603200333884075e-02   +1.085618876059152e-01   +1.819371763126647e-01   +1.543171508758374e-01; +9.703309990670222e-02   +2.103753046527073e-01   +1.855549425421544e-01   +1.147001768827027e-01   +1.046333872851587e-01   +2.017749454607999e-01   +1.497246991998923e-01   +2.016718588530340e-01; +9.752749503797627e-02   +2.035963958725944e-02   +1.076942546211598e-01   +1.761297266667853e-03   +7.068636672368685e-02   +1.650005128271451e-01   +7.560490982217608e-02   +1.583390620172087e-01; +1.937252905906776e-01   +1.402748889870465e-01   +9.542739435497501e-02   +1.649441612561157e-01   +7.112279456248817e-02   +1.597252504798670e-01   +1.021230289347373e-01   +8.516341461158931e-02; +1.025127210663198e-01   +1.131209702509268e-01   +1.852084033838687e-01   +1.276382021419674e-01   +1.198334074263716e-01   +7.292958592761148e-02   +1.194164034939224e-01   +1.393548276163130e-01; +4.999052786333219e-02   +3.081483830404168e-02   +1.602411581452458e-01   +1.800779709080441e-01   +1.862177830247180e-01   +6.156390575473545e-03   +3.240755533057535e-02   +1.307215154308707e-01; +1.199825281005298e-01   +6.628192291301416e-02   +1.512954576922736e-01   +1.688781201469338e-01   +1.879321901490696e-01   +2.034097806147178e-01   +4.962463874196987e-02   +6.898559085194356e-02; +2.502488641497169e-02   +1.214226208458415e-01   +9.034627522081649e-02   +1.799143288829205e-01   +9.802571737574442e-02   +4.508175400055895e-02   +1.290104763884875e-01   +1.810406556285601e-01];
L2I_L3I_iGABA_netcon = [+1.933594561339144e-01   +8.887304902993469e-02   +5.738080227524259e-02   +1.425146463532544e-01   +1.509252787814579e-01   +1.742077090467858e-01   +4.499807981913625e-03   +1.048341389001831e-01; +1.148469235666444e-01   +9.588309872220295e-02   +1.416205674133953e-01   +3.357676049462660e-02   +1.840833902743370e-01   +1.675190713336746e-01   +9.349785452991621e-02   +5.828357792191117e-02; +1.588939421088785e-01   +1.520752780693540e-01   +1.956903207052225e-01   +1.212290329252084e-01   +7.136910860695098e-02   +1.242035479384717e-01   +8.440973236332200e-02   +3.089620713052036e-02; +4.461165808486055e-02   +1.698843270792188e-01   +4.239608343803706e-02   +1.039686547367804e-01   +1.013012145392048e-02   +6.701930003209229e-02   +8.187722900763461e-02   +2.058770474454215e-01; +6.410929993963146e-02   +8.015061948585328e-02   +1.025650282307060e-01   +9.614688950586532e-02   +8.140748220570181e-02   +1.329643277955232e-01   +1.895427096659349e-02   +3.025017986983273e-02; +4.120724115009102e-03   +5.825932965508826e-02   +8.025208724895312e-02   +3.815693508310673e-02   +7.409764201106955e-02   +8.444256439575105e-02   +1.073194244647990e-01   +1.486650213211619e-01; +7.481174835398588e-02   +9.650636181594609e-02   +1.969384108085626e-01   +1.268984047424250e-01   +1.542612500902871e-01   +6.332188744897702e-02   +6.489010145085637e-02   +6.558466372750642e-02; +6.118052422978301e-03   +2.055853905895115e-01   +6.548193269448899e-02   +1.797375758170598e-01   -8.572109228759509e-04   +1.550875487316531e-01   +1.158029355849397e-01   +1.559686217138798e-01; +1.797972945263158e-01   +6.035568452998612e-02   +1.743747296151578e-01   +1.028719822404376e-02   +1.041964229457957e-01   +6.127884985894463e-02   +8.739201604778085e-02   +8.874091589861000e-02; +1.513701888680980e-01   +1.084483014170632e-01   +5.358390676552802e-02   +1.041626024048186e-01   +1.273326393213632e-01   +7.007162588305429e-02   +4.329647455377242e-02   +6.559942451911238e-02; +1.519347512854043e-01   +2.002646025317507e-01   +1.120660390597447e-01   +1.395031569759913e-01   +6.106661455414807e-02   +7.530317771769483e-02   +1.929497490853130e-01   +2.568016417532606e-02; +1.594724570035963e-01   -7.098655252224253e-04   +7.317389496225878e-02   +2.957158450258260e-02   +3.099233717924000e-02   +2.019679935878092e-01   +1.039712637476562e-01   +1.128784866340465e-01];
L3I_L3E_iAMPA_netcon = [+9.110835230308328e-02   +2.079135360716674e-01   +5.201707306438880e-02   +1.274811099379547e-01   +1.595058199885488e-01   +6.808455786856278e-02   +5.946806406528225e-02   +4.998314124190911e-02   +7.103136662627152e-02   +5.577451548834401e-02   +5.428892218153369e-02   +1.053315906986627e-02; +7.567785959881407e-02   +1.802789540439065e-01   +4.137798682035957e-02   +3.150776032911552e-02   +1.671793564394483e-02   +1.143748530413509e-01   +1.154545222957363e-01   +1.089609326332868e-01   +4.599918734588346e-02   +9.980942461850595e-02   +1.504960967543784e-01   +1.125677050274261e-01; +8.278856471844504e-03   +1.242458385217338e-01   +9.842542868863298e-02   +1.200713702042968e-01   +1.021826163442870e-01   +8.708981194204103e-02   +1.046684123016558e-01   +9.446645764789659e-02   +7.793917037601611e-02   +1.147017034497458e-01   +9.388814050899874e-02   +1.163264695178856e-01; +7.878572665154895e-02   +1.502624371929085e-01   +1.316348815496524e-01   +8.981591460845233e-02   +9.129088628549252e-02   +1.840509635963386e-01   +1.572668778843245e-01   +2.831744924578630e-02   +1.932991787351711e-01   +1.808606098271406e-01   +3.645767644632275e-02   +1.548151864761471e-01; +2.440394577119063e-02   +7.011601215909032e-02   +4.096509827162879e-03   +1.705998617290669e-01   +1.585519972360225e-01   +1.123853133528163e-01   +1.981729962363560e-01   +1.234487631330109e-02   +1.880241783679151e-01   +1.195605359652352e-01   +7.124401679115824e-02   +2.166472669879694e-02; +7.375248942569332e-02   +1.312859859733829e-01   +1.702324133792279e-01   +8.859019803431153e-02   +2.039548260954083e-01   +1.177363236627900e-03   +1.772483853490319e-01   +5.893805189058920e-02   +1.392564463459068e-01   +4.832458940233463e-03   +6.883347761617438e-02   +3.454581497720050e-02; +1.616134743017009e-01   +7.854396339995183e-02   +7.633851797103085e-02   +5.864607470253407e-02   +1.371426468745749e-01   +3.861108876814248e-02   +1.115030584571127e-01   +1.894601544100777e-01   +1.721175286446272e-01   +2.052576001876479e-01   +1.160583480698549e-01   +1.439946312720393e-01; +1.524552702297640e-01   +4.299864935098696e-02   +1.431253148876193e-01   +1.272164177913860e-01   +2.040075507347567e-01   +1.220755415167063e-01   +1.889945589217924e-02   +1.031024706259819e-01   +8.735075208409646e-02   +6.330899078704272e-02   +4.719489985738333e-02   +1.892106813893785e-01; +1.551276269972648e-02   +1.726208050368568e-01   +1.501175199744632e-01   +1.650108107494734e-01   +7.287275974691941e-02   +1.528489088251934e-01   +3.742160269205166e-02   +1.604339785984021e-01   +1.688208821078971e-01   +9.391587692456504e-02   +4.430141435185411e-02   +4.189210128975115e-02; +1.917497930101902e-01   +1.665294025221170e-01   +8.423056262483831e-02   +3.991953736084261e-02   +1.155658307419079e-01   +1.646382034858436e-01   +1.050475105352996e-01   +1.812256589389104e-01   +1.419892863519346e-01   +6.691211687702639e-02   +1.809397804300432e-01   +4.358716537163902e-02; +8.764003986728081e-02   +7.609381949977624e-02   +2.063119134384465e-01   +1.932249790469196e-01   +4.467731134741831e-03   +1.240962787401284e-01   +1.380802530981994e-02   +5.093765115655156e-02   +7.366654065993590e-03   +2.022433935789320e-01   +1.522100638848818e-01   +7.832229251568562e-02; +1.811127101610057e-02   +3.537389716757120e-02   +8.645247878392926e-03   +8.836060441015070e-02   +9.085197005202671e-02   +4.691901225780543e-02   +1.653403981548182e-01   +3.416409861487906e-02   +6.560545593948400e-02   +5.183525243156310e-02   +1.552924871100501e-01   +5.972503424479729e-02];
L3E_L3I_iGABA_netcon = [+4.021658212566617e-02   +9.400898078422427e-02   +6.982906219930664e-02   +1.864117033518340e-01   +1.673960151973585e-01   +1.108887549053557e-01   +6.975565921155756e-02   +1.561158060246681e-01   +1.283865463509547e-01   +1.522798419722759e-01   +1.264445577088655e-01   +5.364827567426562e-02; +1.575568652204755e-01   +1.315290027190953e-01   +6.883932138302468e-02   +1.482450278161344e-04   +7.277243331899305e-02   +1.530867146918120e-01   +1.359811882414366e-01   +2.018232449527748e-01   +1.730104533935906e-01   +9.553889106217547e-02   +2.645675161926081e-02   -2.047532504356803e-03; +1.209234354582515e-01   +2.004253494019644e-01   +2.001398503736351e-01   +1.710511981589841e-01   +4.654892673915648e-03   +1.551711023950253e-01   +1.249578969854787e-01   +1.417675352878218e-01   +8.309148919849947e-02   +8.631127384622810e-02   +5.441379751313512e-02   +2.620016010560634e-02; +8.987879384183070e-02   +2.105836501931337e-03   +3.377341276802778e-02   +1.456428780639280e-01   +1.450392533496688e-01   +5.467623359074456e-02   +8.635283153439317e-02   +7.786842261141191e-02   +1.999495833128438e-01   +9.601645487914465e-02   +6.337461181379750e-03   +1.247978142070583e-01; +9.183989009562434e-02   +8.459202658887906e-02   +2.068071253253040e-01   +5.067966102866758e-02   +1.060664465662785e-01   +1.562606578173759e-01   +2.011659245388923e-01   +1.951584945602889e-01   +5.139718701094282e-02   +1.226341133450442e-01   +1.730824540221033e-01   +9.877745447875260e-03; +1.404330236336492e-01   +9.919828074613719e-02   +1.719669431385404e-01   +1.440892591233887e-02   +1.080005038431424e-02   +2.055534013884202e-01   +1.329734774803285e-02   +1.305819426309475e-02   +1.701919846015126e-01   +1.208520425419087e-01   +5.191830011870276e-02   +4.484328410766855e-02; +1.160772669221724e-01   +7.496422425336928e-02   +1.055131001493902e-01   +1.157003470372275e-01   +1.390720927674787e-01   +1.017805750449531e-01   +6.528187725739722e-02   +6.136200273727931e-03   +7.275001463474479e-02   +3.394813684719467e-02   +6.581472910558628e-02   +1.455855641214429e-01; +6.213406929220722e-02   +2.838255761263890e-02   +2.590870717218190e-02   +1.844754213544146e-01   +9.292423001883150e-02   +1.607103563157761e-01   +1.090781553274161e-01   +1.574156877929933e-01   +1.614717984502403e-01   +1.740384328943046e-01   +3.332501624194038e-02   +1.230689064850143e-01; +5.459756929403235e-02   +3.644628352843961e-02   +1.601178799470473e-01   +7.033581737024217e-03   +1.918662991925957e-01   +1.816466666099979e-01   +3.705269161375199e-02   +1.511360546867667e-01   +4.667699888545026e-02   +7.981470223182080e-02   +8.915144469167975e-02   +1.231333083396337e-01; +1.685173669465659e-01   +6.487557641635243e-02   +1.699987995728428e-01   +6.541455562613313e-02   +7.658510609884887e-02   +2.020296639256492e-01   +1.532576412476490e-01   +1.165098201513433e-01   +1.931309394462500e-01   +2.014225652363485e-01   +3.808610843401546e-02   +7.876216366926619e-03; +1.095425333214239e-01   +2.880408377421717e-02   +4.301241001267085e-02   +4.295377282410295e-02   +1.608399711214541e-01   +1.060717571304449e-01   +1.795565032531918e-01   +1.251951597108615e-01   +1.192375601409483e-01   +4.096123259323689e-02   +1.610045900697437e-02   +1.636070589585373e-01; +1.322295758913500e-01   +1.030581291446289e-01   +2.047680814380634e-01   +1.423145539699872e-01   +3.987381644253331e-03   +1.044536259545586e-01   +2.026836934957111e-01   +1.707750687572661e-02   +1.556797094547791e-01   +7.955527777945738e-02   +9.901781579206949e-02   +8.438282394060005e-02];
L2E_Input1_iAMPA_netcon = [+2.049085404632248e-01   +2.083246215239453e-01   +2.102242012709848e-01   +2.083369003755951e-01   +2.080679090067618e-01   +2.138241289457460e-01   +2.085183356620453e-01   +2.073992079850831e-01];
L2I_Input2_iAMPA_netcon = [+2.055135293527263e-01   +2.129192209222167e-01   +2.058450933859715e-01   +2.072894980280127e-01   +2.050947422331495e-01   +2.070387064877550e-01   +2.061300993954961e-01   +2.041622446633109e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.0*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.0*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.0*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.0*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.0*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.0*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
