function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.082934675544942e-01   +8.479097373439091e-01   +9.749106464284157e-01   +2.335370132145823e-01   +2.482993334206155e-01   +8.327797708875406e-01   +1.041756608159273e-02   +4.698378062066857e-01   +3.661426054616738e-01   +2.245214842667220e-01   +3.719141576702688e-01   +1.767280806203545e-01   +5.277185416539014e-01   +2.975958354864676e-01   +2.473949056091898e-01   +7.679990029157671e-02; +1.322651238569879e-01   +9.750433834836565e-01   +8.651978291076052e-01   +7.467022332746682e-01   +3.596266499690836e-01   +7.874763460269254e-01   +7.185487209963389e-01   +1.727893332746155e-01   +8.298163885254142e-02   +7.316744284893989e-01   +6.417947089923893e-01   +7.115887596604666e-01   +5.312332877996351e-01   +2.801225468239666e-01   +7.105976146146891e-01   +2.974911669533645e-01; +3.310837993060641e-01   +3.555623041012446e-01   +3.678764966810081e-01   +6.414091247693848e-01   +5.367137766159651e-01   +4.440589334170756e-01   +6.699526015423182e-02   +7.576211541543728e-01   +3.734336389259632e-01   +5.522065319728854e-01   +9.243829055054842e-01   +2.417977952204937e-01   +5.238678122632584e-01   +2.761634635262002e-02   +4.589090545439306e-01   +9.267279564383744e-01; +2.482019309653957e-01   +6.693563831269524e-01   +1.071134338701224e-01   +2.575368809391064e-01   +1.000000000000000e+00   +9.067147288180374e-01   +2.506839041299586e-01   +6.593156188873329e-01   +8.069783896285612e-01   +5.017774091505297e-02   +2.177929071749440e-01   +9.421257079826552e-01   +6.291487185928477e-01   +1.487280007517506e-01   +7.450440168373513e-01   +4.797488353656414e-01; +5.072044932980557e-02   +7.562551209185160e-01   +9.153289600371730e-01   +8.855036209813542e-01   +5.905714874657244e-01   +3.482444058201092e-01   +5.333507032528391e-01   +2.313815238586402e-01   +3.131761763231750e-01   +5.761421197546558e-01   +2.911676535806259e-01   +6.451824014812209e-01   +4.021704828269565e-01   +9.152015030779950e-01   +2.457331826428650e-01   +9.513601492209703e-01; +1.361420984949118e-01   +1.980882751128765e-01   +8.030231643937735e-01   +8.124386191553176e-01   +6.746225940482803e-01   +9.608919768721752e-01   +3.892737510992793e-01   +4.573603087342524e-01   +8.979472409132455e-01   +9.096593737314986e-01   +8.616688567173599e-01   +2.289374894000733e-01   +4.104733592131053e-01   +1.070422502178522e-01   +9.861848644240392e-01   +3.675442848291963e-01; +2.576929501282120e-01   +8.249936371747589e-01   +3.950398942452721e-02   +4.127524454508075e-01   +9.260388703918742e-01   +5.646190098472510e-01   +4.896820659615734e-01   +6.122907117917885e-01   +9.270431313385561e-01   +9.693678342054101e-01   +7.243607226794365e-01   +2.254264045738250e-02   +4.208801504218329e-01   +4.257823288868486e-01   +7.678445183135286e-01   +9.774967189388258e-01; +7.050885529452483e-01   +8.099876753408071e-01   +8.439310890074398e-01   +4.094270719777065e-01   +6.295449811169760e-01   +4.808185822080621e-01   +7.793760776404404e-02   +3.740048503756630e-01   +9.898362389853483e-01   +9.098949440648108e-01   +8.000025936598475e-02   +8.018344398419729e-01   +9.340478880179119e-01   +6.502322691353666e-01   +3.211949169919890e-01   +9.501792393066791e-01; +5.819280615142783e-01   +1.923685264640007e-02   +3.151626429753828e-01   +6.936807777562087e-02   +4.970078416354344e-01   +1.037920508277888e-01   +1.926460855987324e-02   +6.577442759228217e-01   +5.960162712496471e-01   +8.356040287010632e-01   +7.936511490176180e-01   +5.626425501646078e-01   +4.087887410734640e-01   +2.204825575971684e-01   +9.772013366085327e-01   +8.030221008992106e-01; +7.539166457575960e-01   +5.447847754355327e-01   +5.928739528743928e-01   +2.343596020207295e-01   +4.377749898029528e-01   +3.505041285708632e-01   +9.644844515140272e-02   +3.097544578001266e-01   +7.145366792957920e-02   +9.325790017997175e-01   +5.602427614917750e-02   +1.244643362962985e-01   +3.203631278795796e-01   +7.638465818443240e-01   +3.142536979031976e-01   +8.734248900281565e-01; +4.672353051946347e-01   +1.567072612037759e-02   +3.167258547007396e-02   +1.136724189786371e-01   +9.922556015708232e-01   +6.042113480883912e-01   +2.652109648229043e-01   +2.127583678506628e-01   +2.623550272040245e-01   +9.091278213272314e-01   +6.846665224959371e-02   +8.340570731562618e-01   +5.790529616564047e-01   +9.176476144236883e-01   +3.881952074679344e-02   +1.645852314033959e-01; +1.185572752153344e-01   +5.288030070068900e-02   +9.697691808674683e-01   +5.118564041094048e-01   +6.700117549205701e-01   +5.700136123634464e-01   +7.238071774941635e-01   +4.442815277966286e-01   +6.096879626348752e-01   +1.384130971147192e-01   +3.767377849771333e-01   +9.104080321274374e-01   +1.117747251890785e-01   +4.944504398096530e-01   +4.450497985032015e-01   +9.486415716947141e-02; +5.188808002118431e-01   +2.902118648932789e-01   +6.874866142804760e-01   +3.493138224110438e-01   +3.794780031879433e-02   +5.599508508257746e-01   +4.749063184846816e-01   +8.022625637620625e-01   +2.212202527808937e-01   +9.708718214866329e-01   +1.219932294619673e-01   +4.165975827982873e-01   +2.394060898383243e-01   +2.106240360367798e-01   +3.349323256093759e-01   +1.964455835657302e-01; +7.627415978541198e-02   +9.300831842766810e-01   +8.078058631904078e-01   +7.981417459978085e-01   +8.288011426485072e-01   +5.753612147037888e-01   +3.674715043251918e-01   +8.823106562231529e-01   +3.697408155690151e-01   +3.644815437199731e-01   +9.810876699014041e-01   +6.591489361473422e-01   +6.244548904216789e-01   +5.204004847308430e-01   +1.342042751225925e-01   +3.938621136477957e-01; +1.627871251834720e-01   +2.727028800884985e-01   +1.232291200971780e-01   +4.127569679989165e-01   +4.252078501766401e-01   +7.715722948741850e-02   +6.955449919191439e-01   +2.658137395234499e-01   +8.792061567855827e-01   +5.897135845587325e-01   +1.571982318068149e-01   +9.564162805986743e-01   +6.867783302149204e-01   +2.746007933860907e-01   +7.174691872814876e-01   +1.425429040453650e-01; +5.965562321655720e-01   +2.872051483811950e-01   +2.987172051847058e-01   +6.817612389978240e-01   +5.656564883542095e-01   +6.655491935809562e-01   +2.299188524838621e-01   +8.123543592900491e-02   +6.067085752287172e-01   +4.587586982146283e-01   +3.612015724336306e-02   +4.917569595968210e-01   +2.057692822376150e-01   +9.670117593366018e-01   +9.406335779900912e-01   +2.946685248140214e-02];
L1E_L1I_iGABA_netcon = [+3.092162077188817e-02   +2.390901420640653e-01   +9.299231641752586e-01   +2.725717030123779e-01   +4.448145464244873e-01   +1.627793353194804e-01   +3.066548009104905e-01   +2.990293279852789e-02   +2.576605310035197e-01   +8.564351198082214e-02   +4.816769951069927e-01   +9.686944047950476e-01   +1.989864603680775e-01   +8.998706398197533e-01   +1.256369432440246e-01   +5.023713764895114e-01; +7.795727500167526e-01   +8.349378559672752e-01   +5.059171452885017e-01   +8.761044543862140e-01   +7.432564875978310e-01   +9.204599401670718e-01   +6.616002272694349e-01   +9.173351949272049e-01   +9.786223349057306e-01   +9.639028282029718e-01   +1.129092010990744e-01   +1.508944292988313e-01   +5.937481652935594e-01   +9.865798938986291e-01   +9.662106629509117e-01   +3.013581145190851e-01; +3.584775317639333e-01   +8.285906649343149e-01   +9.825516658035924e-02   +7.923154673015061e-02   +6.841165155903274e-02   +2.200740715134602e-01   +6.049793912040269e-01   +6.383022741572708e-03   +1.063008601582423e-01   +1.222636553572144e-01   +5.470231734851181e-01   +4.689817506691292e-01   +8.718154508082481e-01   +8.354325246778370e-01   +8.405567103825251e-01   +8.082993612820449e-01; +3.491280538931567e-01   +5.615580148704028e-01   +6.960422016814908e-01   +7.638209456162693e-01   +6.496470637882744e-01   +7.039650110197840e-01   +6.224395637361357e-01   +8.981972710926903e-01   +5.469081489848263e-02   +3.802436538812742e-01   +5.238544908100208e-01   +2.112738836617088e-01   +7.896848206343514e-01   +4.239457043991085e-01   +9.403947087828968e-01   +6.057425442627546e-01; +7.606704520501071e-01   +6.266912587236255e-01   +8.606490713090432e-01   +3.689706620491730e-01   +9.832131527459309e-01   +5.343993867646690e-01   +3.773461942010999e-01   +4.397720803634420e-01   +2.812992627614216e-01   +1.220779959479726e-01   +6.774106284860039e-02   +5.162403868160144e-01   +9.192330083245420e-01   +8.143287930137504e-01   +2.676067639078585e-02   +1.722669880592791e-01; +2.729493171847782e-01   -5.764340573824889e-03   +2.818873430968478e-01   +1.211147393333506e-01   +7.399525539873967e-03   +4.176166429025877e-01   +8.918070691264597e-01   +3.431063254435887e-01   +5.926411007584043e-01   +3.794787837935440e-01   +9.806334673196536e-01   +2.326737642676651e-01   +2.801339605635575e-01   +1.842263377978083e-01   +7.384403301716664e-01   +4.661569546293645e-01; +6.645460305262190e-01   +5.554620573789489e-01   +3.848286467267213e-01   +7.988059221683408e-01   +3.286544143183555e-01   +8.772065076738473e-01   +6.637075361172288e-01   +5.691354529598720e-01   +9.149282514212377e-01   +6.687005210846766e-01   +9.486334740186347e-01   +2.902816894991124e-01   +8.349529249050279e-01   +6.241424048569935e-01   +9.970649202353508e-01   +8.782400405120728e-01; +9.959411502581789e-01   +1.492509387639486e-01   +5.861744113000881e-01   +5.417347858365693e-01   +6.438181377451691e-01   +2.221180016230047e-01   +3.038761135514437e-01   +6.395921804804575e-01   +2.082539772496001e-01   +7.987195226810571e-01   +8.111937541549912e-01   +9.945112465635372e-01   +2.738460861244428e-01   +8.151706043634085e-01   +5.262466323896061e-01   +6.293835679666739e-01; +5.519831388061308e-01   +9.898996961758992e-01   +3.769036701688135e-01   +9.719994613005614e-01   +2.480431907251692e-01   +6.923526589900203e-01   +6.296695226151695e-01   +9.934732363460902e-01   +8.679511647106736e-01   +1.374944289093216e-01   +2.125901330350002e-01   +2.341143308071969e-01   +8.716709108913395e-01   +1.762244131078449e-02   +1.311776957412809e-02   +4.885951764595761e-01; +2.858711398118693e-01   +4.106132420975670e-01   +5.804283526876035e-01   +2.859901656668438e-01   +8.337225426866621e-01   +4.320213829587860e-01   +3.343653112834731e-01   +8.731002534829511e-01   +9.465398099508558e-01   +9.754402921492582e-01   +8.174064165346812e-01   +9.340698467593080e-01   +5.085413292542187e-01   +4.078098695759478e-01   +3.478616527289120e-01   +8.833088215515130e-01; +1.199372933682924e-01   +2.445912583221633e-01   +7.875651467642184e-01   +9.231069919344637e-01   +1.443405197405257e-01   +6.196005964960386e-01   +6.843742609918085e-02   +4.808214105589490e-01   +4.057949033539889e-01   +7.265308257137000e-01   +2.587976864638040e-01   +9.083307864884781e-01   +8.688644564842071e-02   +5.244310763997714e-01   +5.101411024155408e-01   +5.118009243698496e-01; +1.848845867804011e-01   +9.808902655369904e-01   +7.754939606760963e-01   +5.615089216001207e-01   +5.192373717420996e-01   +6.134158324569058e-02   +1.530060965386329e-01   +4.013819317198224e-01   +1.573205173113330e-01   +5.805520754707953e-01   +2.982751552670229e-01   +4.470638566457988e-01   +4.387537516457233e-01   +9.344879878892109e-01   +4.392044233133521e-02   +4.704821224311709e-01; +9.295148539520212e-01   +1.165597641501416e-01   +5.007988212561122e-01   +5.787430254330214e-01   +6.824711621398761e-01   +6.195496676574367e-01   +1.852803601966635e-01   +5.814914453025435e-01   +5.066212540927574e-01   +3.441236694325746e-01   +9.886159047913082e-01   +9.911828644668544e-01   +8.724661800515504e-01   +6.063950652640576e-01   +3.563091095820219e-01   +7.548016420096206e-01; +4.633131593599761e-01   +8.758546421371027e-01   +3.060523119751605e-01   +4.074894720856118e-01   +7.701841724637534e-01   +1.575674093148628e-01   +3.858480091924330e-01   +6.502643446970270e-01   +3.261907567931515e-01   +4.783332674689961e-01   +1.889656417340664e-01   +1.623505219815133e-01   +3.176562782903387e-01   +3.099914770385024e-01   +6.332916266103409e-01   +9.562348111972067e-01; +6.191069504063232e-01   +6.375305712986123e-01   +6.790655037500244e-01   +6.938365552985848e-01   +8.728402338393615e-01   +1.427153476639009e-02   +8.645556773059127e-01   +3.908690073222919e-01   +8.404948559404480e-01   +5.125199470334454e-01   +7.072354442388742e-01   +6.090882881501779e-01   +2.252549606265327e-01   +5.225688547257813e-01   +9.129753680279662e-01   +5.188973700677142e-01; +4.906426213393473e-01   +6.606030489662523e-01   +6.073725912367363e-01   +2.654790650725992e-01   +4.365508554775499e-01   +2.882773119756272e-01   +6.288923240023564e-01   +2.115712759651133e-01   +9.118371680316111e-01   +2.945382485787140e-01   +2.315359367077023e-01   +1.697196972328862e-01   +8.703409608833060e-02   +4.881013894400963e-01   +9.308309445745100e-01   +9.575062946708460e-01];
L2I_L1I_iGABA_netcon = [+6.949673494827173e-01   +5.286452004521797e-01   +7.459853523276639e-01   +5.858350424437306e-01   +9.610362854052095e-01   +7.679112331610718e-01   +9.195948473107025e-01   +5.669508849266940e-02; +5.853380680518750e-01   +9.640325950933014e-02   +2.169820401264939e-01   +8.993355831536320e-01   +2.142757410597926e-01   +4.826237054795690e-02   +9.487506892164941e-01   +8.136942976077632e-01; +9.668073183340913e-01   +4.941699725343774e-01   +7.031907358491422e-01   +7.101732429619494e-01   +8.644706550960383e-01   +7.718637845024183e-01   +2.500737279465301e-01   +1.755139057324367e-01; +4.598334356566984e-01   +1.661859956363606e-01   +9.638055969051357e-01   +4.762945884790586e-01   +8.578019919326025e-01   +3.594707274862747e-01   +9.010332439955505e-01   +2.488935279666048e-01; +8.119671283786699e-01   +5.596891917163778e-01   +7.108982319277444e-01   +2.726855125344065e-01   +9.911631122466213e-01   +4.346204253104292e-01   +6.085511006876235e-01   +2.406880209484739e-01; +5.931699499645217e-01   +6.031923281817053e-01   +8.182271104518039e-01   +2.252383278950794e-01   +1.849255811346819e-01   +8.279718048937345e-01   +9.779754163108082e-01   +5.914036197918615e-01; +9.362585559174967e-01   +4.855040446099460e-01   +2.596275947112310e-01   +2.715652930716891e-01   +7.799779966450560e-01   +1.644350459620793e-01   +7.208066275936081e-01   +3.376699795970522e-01; +9.683525580573392e-01   +3.830179731065624e-01   +7.034677449842606e-01   +9.697694295709595e-01   +1.145414236323576e-01   +4.630404353620380e-01   +4.613585545833838e-01   +2.894422853644741e-01; +8.432383393722017e-01   +2.158829918839684e-01   +5.249627821759509e-01   +2.662372542717238e-02   +8.806870475829875e-01   +3.585694471335882e-01   +8.393537821228874e-01   +7.931477928813080e-01; +4.577187324301068e-01   +9.897486511456364e-01   +6.995740782364305e-01   +8.817823729960982e-01   +4.305149846801681e-01   +8.619606208932669e-01   +9.507830567973249e-01   +3.328214596669486e-01; +5.404337034165065e-01   +6.456591116589261e-01   +5.215945386213640e-01   +4.396251071850149e-01   +2.949607253579524e-02   +9.577372856967146e-01   +7.312839622323724e-01   +4.695540042981421e-01; +1.884467535087535e-02   +4.244547504459048e-01   +3.541525244256204e-01   +4.240698262668282e-01   +3.664055425407940e-01   +5.995852597039766e-01   +3.057726204841729e-01   +5.757271711047047e-01; +4.516775813270290e-01   +1.454796539993193e-01   +6.840797363295669e-01   +7.632394775559646e-01   +2.263719070117220e-01   +6.767016870882329e-01   +4.421258110842939e-01   +8.117367267487365e-01; +4.291419289620979e-01   +5.020970104421567e-01   +7.952444902400576e-01   +3.917289149085207e-01   +9.640734529131609e-01   +4.573841279361583e-01   +3.950439544058451e-01   +3.306473437631343e-01; +6.744496136777299e-01   +1.766715060471613e-01   +3.384990647397493e-01   +2.719538258575352e-01   +6.378726623415061e-01   +6.597930125766618e-01   +3.328490748983340e-01   +7.952769723570394e-01; +8.469235782336586e-01   +4.236409168974269e-02   +7.584235426199841e-01   +2.696435568661083e-01   +4.182307740218519e-01   +6.683976596945700e-01   +1.498754719008321e-01   +3.170266030496544e-01];
L1I_L2I_iGABA_netcon = [+5.386250387517989e-01   +1.828900112099464e-01   +7.864827385202935e-01   +2.985326050846083e-01   +6.801902194664304e-01   +3.532887195771530e-01   +8.399768684714538e-01   +2.417544314441968e-01   +6.355122468183817e-01   +9.634429309964059e-01   +4.094301377282482e-01   +4.879040759416405e-01   +3.980305061959716e-02   +8.283584546087187e-01   +6.613547449962530e-01   +4.839966095990472e-01; +3.272739847718720e-02   +8.550752634825876e-02   +3.057652145487448e-01   +3.254486966762085e-01   +8.912294406638837e-01   +3.540145874576350e-01   +3.317864012504741e-01   +1.427714692259364e-01   +4.868149203561475e-01   +2.454120487002908e-01   +2.981070202624441e-01   +2.903475079373199e-01   +9.328161538118666e-01   +1.537686287118728e-01   +9.097474815560594e-01   +2.399081385478801e-01; +3.485818565401825e-01   +6.306927048354173e-01   +4.204299686375084e-01   +7.110172384996184e-01   +2.708702112061965e-01   +5.424050804029722e-01   +8.039858424575249e-01   +1.089212547310936e-01   +8.202867207876504e-01   +5.404522096636573e-01   +6.772747734647691e-01   +9.079789746541377e-01   +9.897994053765344e-01   +7.107089428850267e-01   +3.239747579756824e-01   +1.297729483495948e-01; +8.666571183647821e-01   +1.600717118924276e-01   +6.285624020885382e-01   +9.553675769600458e-01   +4.984264591004481e-01   +9.913399892170308e-01   +6.770011930317362e-01   +8.323519898295897e-02   +3.598155272885933e-02   +3.805488906495509e-01   +4.195792546556653e-01   +5.887872552489976e-01   +3.429582260331885e-01   +5.241943054385089e-01   +2.067728415705786e-01   +1.454728746450780e-01; +9.755286401521894e-01   +8.374546841156260e-01   +7.795584071743566e-01   +6.807894341241417e-01   +2.935133021770638e-01   +6.942215042249468e-01   +7.579860322057020e-01   +6.900943385113071e-01   +1.016211986085948e-01   +7.212449518580880e-01   +1.840377294830180e-01   +3.754762749879860e-01   +6.663859476286059e-02   +2.093369008801991e-01   +7.488253710411247e-01   +9.952330767377187e-01; +5.784869896538198e-01   +4.638147210080227e-01   +1.362039888600959e-01   +4.034731038977833e-01   +9.734042233280715e-01   +1.366133335668067e-01   +7.438188189609750e-01   +6.801724115067563e-01   +5.565816590819090e-01   +7.870054206545003e-01   +3.238596967816137e-01   +5.084468468594163e-01   +8.631311497922891e-01   +9.051545020992602e-02   +1.791233492438731e-01   +5.124117277366375e-02; +7.971874314629589e-01   +9.230959105304196e-02   +3.920166978761731e-01   +3.291957082113047e-01   +5.499776566886994e-01   +9.323802273097467e-01   +2.697859985812833e-02   +2.376757816637153e-01   +7.638441230188808e-01   +9.697004944750235e-01   +9.252769148462866e-01   +8.937032160717598e-01   +1.244137226309313e-01   +3.201773863423908e-01   -4.996810388678465e-03   +6.055171485262516e-01; +8.688359902290359e-01   +4.409550898247306e-01   -1.143017538197255e-03   +9.157912322240686e-01   +1.938349255624548e-01   +9.321502242961003e-01   +8.264081922529605e-01   +3.827514671606685e-02   +7.781953485901159e-01   +6.831148957912710e-02   +9.241444982663721e-01   +1.928486378494672e-02   +8.470412205118746e-01   +9.207521168879763e-02   +9.896872199722697e-01   +6.940562663552634e-01];
L2E_L1E_iAMPA_netcon = [+2.896891072855657e-01   +9.088405869596958e-01   +6.351812395711339e-01   +7.156701875586928e-02   +3.093195785794888e-01   +4.221410669278360e-01   +1.423592652608618e-01   +6.301187431375358e-01; +2.940238292432935e-01   +2.151747077167201e-01   +7.797067076648350e-01   +9.270280695911373e-01   +3.727910609754515e-01   +5.656441955391528e-01   +2.670590559566783e-01   +1.327770509265616e-01; +5.579623572384437e-01   +9.358375728794248e-01   +7.963971353078684e-01   +1.021184931801609e-03   +6.613615812569286e-01   +4.604584048182492e-02   +4.621562942613648e-01   +8.662209197006523e-01; +5.282103021569035e-01   +6.341057239282719e-01   +6.701903831648129e-02   +5.630435892831560e-01   +2.823910515399513e-01   +5.106016417592624e-01   +2.219319754511855e-01   +4.354735652556251e-01; +8.224013347908165e-01   +7.955238445700098e-01   +8.120868907468929e-01   +5.328543794021899e-01   +7.767930331211711e-01   +3.730803537048814e-01   +5.263335563500151e-01   +5.693050631306829e-01; +5.131353845493597e-01   +6.591178535519373e-01   -3.836980553714072e-03   +6.640163400661934e-01   +6.778038788228606e-01   +9.100898711696155e-01   +2.412079682343797e-01   +2.460495584660063e-02; +4.536737903322372e-01   +3.360256662368223e-01   +2.573462632662675e-01   +4.004684185054397e-01   +4.280064863348632e-01   +2.355052181456920e-01   +5.182023070450233e-01   +2.839261275429540e-01; +7.752717712814030e-01   +1.625420709501911e-01   +3.433683370907948e-02   +9.652888776900690e-01   +5.237569288680617e-01   +3.574062175155934e-01   +5.689448378922446e-01   +5.888623222833765e-01; +7.464940488481066e-01   +5.969015019768823e-01   +6.688123509837223e-01   +1.333754981689004e-01   +3.962843477150301e-01   +2.469840911432332e-01   +1.378583675980377e-01   +9.900024750838178e-01; +2.821050689045675e-02   +1.312233458385601e-01   +1.374656612912128e-01   +1.818943560425139e-01   +2.629921372007242e-01   +6.507522662260318e-01   +8.857289985733187e-01   +8.676441873902004e-01; +2.902374659035123e-02   +2.489757826735829e-01   +6.577042821464537e-01   +5.500681883341406e-01   +1.429231926431853e-01   +4.593557754760979e-01   +1.738977485493231e-01   +7.759969204035609e-01; +3.839588895715573e-01   +5.292000347236394e-01   +6.070682390069212e-01   +5.192885527630978e-01   +6.913439932640946e-01   +3.407646424602121e-01   +6.445474892618780e-01   +4.909318494410806e-01; +6.470147146733373e-01   +7.141954380804544e-01   +6.339037820793491e-01   +2.657118593170755e-01   +2.453514467585505e-01   +9.586702846545496e-02   +8.195229705135303e-02   +6.213677160958807e-01; +8.049441765677882e-01   +8.278465945127789e-01   +6.502903772812808e-02   +9.451693797479446e-01   +4.674692918704362e-01   +9.266771007039794e-01   +6.419600139745811e-02   +2.277929430150190e-01; +9.465273684687239e-01   +1.849966191845173e-01   +3.963839539457241e-01   +6.022328317673785e-01   +3.613889001448322e-01   +2.257589097768175e-01   +6.505142437948016e-01   +3.802352858806646e-01; +8.546726224548533e-01   +6.334064309180153e-01   +6.955329446301893e-01   +3.813040884087178e-01   +5.191343263224065e-01   +9.049676220354276e-01   +7.876892970821058e-01   +1.302380063711092e-01];
L1E_L2E_iAMPA_netcon = [+9.109329145353409e-01   +4.950485058586445e-01   +6.002378401959417e-01   +5.022966313988507e-02   +9.861088638499148e-01   +2.476520135212755e-01   +5.335734674487339e-01   +5.249668577946885e-01   +9.683332587388972e-01   +5.434627552936679e-01   +6.380697843575733e-01   +4.978563857642498e-01   +5.101823789608850e-01   +3.570484196784561e-01   +5.490189533978598e-01   +1.785423339070051e-01; +7.828910676927605e-01   +2.189997600761646e-01   +9.743089007287165e-02   +5.475104258461965e-01   +8.402372173708056e-01   +6.692474095577385e-01   +9.376214666649356e-01   +2.852030339104681e-01   +3.362675211710931e-01   +3.619919182638900e-01   +8.283537582222571e-01   +6.868768429479496e-01   +6.541792688349615e-01   +9.096963533911504e-01   +3.957699469787005e-01   +5.603970137202113e-01; +7.914650541066337e-01   +1.167776838703002e-01   +9.622288803646799e-02   +9.649041384253728e-01   +2.564005530533588e-01   +3.771315421780403e-01   +9.947781780100305e-01   +3.104607617678555e-01   +1.736854653481325e-01   +6.300926658480557e-01   +8.550176159121655e-01   +4.696117600868495e-01   +9.086347709488085e-01   +9.948627229116633e-01   +8.755793618965495e-01   +6.688782580692603e-01; +7.246227605440355e-01   +1.349623581816977e-01   +5.827231734563385e-01   +4.313974983605471e-01   +4.139561896308536e-01   +8.433644898788707e-01   +2.130601080857347e-01   +1.663626910338448e-01   +6.279245014927871e-01   +4.400933118364848e-01   +3.971543629820851e-01   +9.663408850130129e-01   +7.695820681086597e-01   +8.257420722124513e-02   +7.461895444178529e-01   +7.803526846333990e-01; +5.961639753760627e-02   +2.841671683048675e-01   +1.687326817572165e-01   +7.877266922470950e-01   +2.070510992287100e-01   +4.615312613666211e-01   +1.000000000000000e+00   +3.182511951632641e-01   +1.656702079672385e-01   +7.604309214543267e-01   +9.225525120144083e-02   +5.806772635165320e-01   +1.109706622711630e-01   +6.336235882003575e-01   +4.098758027952358e-01   +1.114355862453667e-01; +6.400308944559694e-01   +4.868760870117019e-01   +4.088386416853479e-01   -1.330733794160437e-03   +9.854118394497706e-01   +7.894912773376363e-02   +5.085246765576201e-01   +2.151997260167383e-01   +8.332607935513339e-01   +4.809992158588753e-03   +7.627615086386623e-01   +7.208440761076837e-02   +7.226335394174620e-01   +5.203830096646739e-01   +6.847654668995323e-01   +3.204004554724950e-01; +3.077513682046719e-01   +6.409769563291470e-01   +4.195479431750561e-01   +4.253935476971614e-01   +4.133239183579514e-01   +9.384888841244728e-01   +9.366486877071627e-01   +3.897844733924575e-01   +6.916385605161912e-01   +7.677409753163482e-01   +6.332882272479304e-02   +1.491310357018138e-01   +8.473462361519574e-02   +3.724231333754470e-01   +3.811541058034694e-01   +7.638159463492484e-01; +2.163426575499595e-01   +4.702786167589820e-01   +2.997173405959395e-01   +4.260647493193573e-01   +9.323535706757866e-01   +4.910459544005035e-01   +9.735210234038519e-01   +9.031922173963388e-01   +4.011155927839517e-01   +6.807397220041139e-02   +3.726295397681627e-01   +3.346633159995947e-01   +3.663305289887686e-01   +7.549232784723967e-01   +8.131868617292672e-02   +5.369880000237347e-01];
L2I_L2E_iAMPA_netcon = [+3.607942718212223e-01   +2.061648491579768e-01   +4.118507943320173e-01   +5.855360024537654e-01   +1.880643680774271e-01   +9.078663464855961e-01   +6.443698012985122e-01   +2.676483138228066e-01; +5.253638534606170e-01   +2.272051633761740e-01   +6.175841962317501e-01   +2.466894573064605e-01   +6.737509109756175e-01   +8.118975064906616e-01   +6.495729990438150e-02   +5.049704434183095e-01; +6.111744120641095e-01   +3.756466853024457e-02   +6.687639998479199e-01   +5.980957974005721e-01   +1.599550156834816e-01   +6.178824685512690e-01   +8.325417977567079e-01   +3.050315709661631e-02; +4.759227801825024e-01   +2.718589740936096e-01   +8.372981967677934e-02   +9.876103334270691e-01   +3.410285832602843e-01   +6.003460010334608e-01   +9.463536180754415e-01   +1.782283092296825e-01; +1.337252198720026e-01   +4.404054972566668e-01   +3.783024761731093e-01   +8.127766333600636e-01   +8.297987880531115e-01   +5.782938951588890e-01   +6.988284223212926e-01   +3.030268718137976e-01; +8.782063211361160e-01   +5.363076195015871e-01   +8.761037390618847e-01   +8.624079312934386e-01   +7.549983700701303e-01   +8.467335560769125e-01   +9.051996022625550e-01   +5.349480668271573e-01; +1.544123394515984e-01   +5.756690011995814e-01   +9.318742675792393e-01   +9.284409329548710e-01   +1.023812315147434e-01   +7.571213940076329e-01   +2.653715058688909e-01   +6.477489741826609e-02; +5.647396232265279e-01   +3.816763949912905e-01   +1.583513320577561e-01   +2.864310291911634e-01   +7.319120498767349e-01   +3.934089286165494e-01   +9.736255429235923e-01   +6.391428578376099e-01];
L2E_L2I_iGABA_netcon = [+5.055831056541107e-01   +6.589518984841932e-01   +6.773285636251081e-01   +6.435202854205578e-02   +5.206676515706865e-01   +5.122879144576997e-01   +3.508443244626294e-01   +7.560435317474135e-01; +4.581128445070702e-01   +3.928313693472360e-01   +5.590890888818181e-02   +5.118351842055150e-01   +4.978012574148084e-01   +6.162932024708785e-01   +4.829603203164679e-01   +4.956438831040454e-01; +6.453532536190536e-01   +4.787189890692046e-01   +4.233859374925750e-01   +5.630609432556398e-01   +3.545125563223337e-01   +2.957574959623347e-01   +1.984808987512854e-01   +9.990876027176661e-01; +7.559937876561486e-01   +5.589135977080097e-01   +4.554654760950171e-01   +9.137936785414316e-01   +2.225727712003580e-01   +3.875252923128926e-02   +1.305586289600192e-01   +4.841322491330726e-01; +5.158337245932221e-01   +8.362229715224330e-01   +5.281621808775884e-01   +8.636465062399419e-01   +3.596516834711617e-01   +7.883269539965493e-01   +7.215774054800269e-01   +3.612243345603527e-01; +4.421618085199776e-01   +2.968377270817303e-01   +5.383042320153838e-01   +3.872118572710208e-01   +7.959081145456655e-01   +9.119836249591428e-01   +1.906164233089135e-02   +4.981510974252314e-01; +9.118457865768018e-03   +5.111436149419883e-01   +8.625383757387627e-01   +5.923761033089163e-01   +5.085181038637115e-01   +4.008464856634829e-01   +9.569611584773149e-01   +2.219931761643533e-03; +9.275038038521969e-01   +5.713562512503951e-01   +9.800478362215961e-01   +4.988492979631803e-01   +9.807636806422573e-01   +5.902575132699623e-01   +4.158768717152752e-01   +3.835112708684020e-01];
L3E_L2E_iAMPA_netcon = [+2.451162522555033e-01   +9.214189834618129e-01   +4.194830024395682e-01   +8.155366795626465e-01   +1.687087955491144e-01   +4.383015583304865e-01   +4.513274796831738e-01   +9.582243102183054e-02   +1.261458821151660e-01   +5.762444039571867e-01   +1.660859326538000e-01   +4.877603760921787e-01; +2.430406519477932e-01   +5.322493366299075e-01   +1.952020647084615e-01   +2.773834551952774e-01   +6.276168973333404e-01   +9.589762620758344e-01   +7.595571628370892e-01   +5.939642099630404e-01   +2.902780619203085e-01   +4.974485596200042e-02   +9.516193138055065e-03   +1.060580190322409e-01; +8.224252088597663e-01   +3.821087973221359e-01   +5.336430538464516e-01   +8.206924598047986e-02   +8.791074235422013e-01   +8.670133111439282e-01   +5.505315907812324e-01   +7.546198912488182e-01   +6.952791252400731e-01   +3.833190413098419e-01   +4.316888962843713e-01   +9.320761734799410e-01; +2.036777016027801e-01   +4.447234379320711e-01   +2.263210969698122e-01   +8.220306439892778e-01   +5.282458089196799e-01   +5.984869239657753e-01   +8.856383863312225e-01   +3.152006306596695e-01   +8.513711858659010e-01   +8.341657833882187e-01   +4.825424167210771e-01   +2.066350903392719e-01; +2.213686925478774e-01   +8.243100527324709e-01   +4.132138451837791e-01   +7.995993403180514e-02   +2.089165764240323e-01   +9.895666090923566e-01   -2.467633710774136e-03   +6.845227103449396e-01   +5.225035777388658e-02   +8.349647103718333e-01   +2.854563310782566e-01   +2.510722957269730e-01; +4.238293246083723e-01   +3.566232091418143e-01   +8.321316100298738e-01   +9.780901068862382e-01   +4.443392686814315e-01   +1.000000000000000e+00   +1.473781737682976e-01   +4.337705947607972e-01   +5.033552097621531e-01   +8.032360450733707e-01   +6.631669083580212e-01   +8.251909970818746e-01; +1.810204607958193e-01   +5.136421843211160e-01   +6.070947914887699e-01   +1.026768133689790e-01   +6.195481722789710e-01   +4.741780833951920e-01   +8.068962533415802e-01   +1.431035766659651e-01   +4.535103708072501e-01   +3.615918023533844e-01   +9.664775980321354e-01   +7.689310215480590e-01; +5.791816671364748e-01   +5.731688128654585e-02   +4.119931908944997e-01   +2.072197023228165e-01   +2.226104373875165e-02   +9.546396982718793e-01   +4.027001386842329e-01   +4.252444622627358e-01   +8.962325232361049e-01   +9.561517817173060e-01   +9.486909412000381e-01   +3.331503042842014e-01];
L3I_L2I_iGABA_netcon = [+3.138429341599425e-02   +4.878728307794211e-02   +1.014859596690298e-02   +6.938944876386774e-01   +7.292274472993887e-02   +4.559927072516375e-01   +8.416965637248812e-01   +4.353495509353372e-01   +4.539206443509119e-01   +9.840560987548107e-01   +9.550829792628779e-01   +6.562893121931686e-01; +3.731334205908392e-01   +4.522050494211318e-01   +2.984696883796026e-01   +6.277969004086220e-02   +4.592262151921505e-01   +6.270389723789376e-01   +4.348167431567161e-01   +9.059106100175310e-01   +1.296089812693003e-01   +9.739914893130006e-01   +3.026091496021023e-01   +6.250271337340911e-01; +3.011783367729260e-01   +7.559957629372290e-01   +3.194142934860626e-01   +8.130150464935721e-01   +3.685752866299346e-01   +8.344615342658449e-01   +9.355050269123680e-01   +4.596316175724018e-02   +6.307023629504753e-01   +4.672194648896511e-01   +1.556593858521138e-01   +5.728079500942471e-01; +6.387449249180215e-01   +9.548796904400233e-01   +3.783412549313834e-01   +2.822382118501303e-01   +1.760585613569572e-01   +5.990915786770368e-01   +2.386770476199165e-01   +3.377149760485753e-01   +9.342221358771274e-02   +3.697376355690570e-01   +5.445386675203956e-01   +8.388142317818550e-01; +9.470132464483051e-01   +1.241103881854831e-01   +4.706053644815958e-01   +8.179101164244320e-01   +5.213056389283359e-01   +8.916553777198237e-01   +1.247903626055219e-01   +5.356381081902133e-01   +5.626217127502010e-01   +8.361808724879325e-01   +7.790488447109403e-01   +5.343826297545075e-01; +9.765231735355061e-01   +1.986445221895119e-01   +1.198009331399763e-01   +7.402079168646837e-01   +9.768748853243695e-01   +7.279532043642916e-01   +8.926440509876037e-01   +4.921681159512383e-01   +1.302722328521100e-01   +8.940579079564556e-01   +4.165479137430603e-01   +6.595081259049751e-01; +1.017486184997891e-01   +5.405022970375698e-01   +9.568098775780477e-01   +5.965230683130035e-01   +9.936300348963459e-01   +8.661175627806935e-01   +8.702696360184936e-01   +8.506466559725419e-01   +6.129807118965686e-01   +3.572206630772327e-01   +3.110993535911624e-01   +6.023373906003507e-01; +3.454479533884298e-01   +1.588675524520745e-02   +7.854474332819793e-01   +2.045294809022314e-01   +4.770945274352537e-01   +3.157072683034166e-02   -6.394954096260581e-03   +9.902298632028150e-01   +5.120502644904812e-01   +1.066549280323378e-01   +7.426776616973553e-01   +1.198798057556334e-02];
L2E_L3E_iAMPA_netcon = [+9.277905785075770e-01   +2.937576496499297e-01   +5.730701610618818e-01   +6.633843711094289e-01   +1.384762516587872e-02   +6.832695121403466e-01   +7.454432681448177e-01   +4.796017125405980e-02; +3.332014559783109e-01   +5.828761869874327e-01   +6.499823128823582e-01   +7.560331961572482e-01   +2.100641214347859e-01   +2.288433776772365e-01   +8.421985987073397e-01   +1.124006882838727e-01; +6.106932282017866e-01   +5.120985982407121e-01   +9.090931504697379e-01   +7.065228026666170e-01   +9.222736593470373e-01   +4.863625299516277e-01   +9.867344693068308e-01   +5.418280200081378e-01; +1.652462748160728e-01   +9.645742162501590e-01   +9.318841611524016e-01   +4.296580300609337e-01   +3.622491548346826e-01   +9.695604178428447e-01   +2.245486186122277e-01   +5.444628921446392e-01; +7.456773490740695e-02   +2.138559125888515e-01   +7.222666223406785e-01   -5.553430730440423e-03   +1.912449749571283e-01   +4.925438505935045e-01   +5.403774292913325e-01   +6.676076239818188e-01; +4.339849985768385e-01   +7.571015862603967e-01   +2.048398725829810e-01   +8.282040028591232e-01   +4.542911928525509e-02   +5.258532613165646e-03   +4.808660004588602e-01   +3.153819026673562e-01; +5.117397790713182e-01   +8.130700263561671e-01   +7.810554948065840e-01   +2.727972215062864e-01   +8.445132215968199e-01   +2.106624069332053e-01   +7.281503043191305e-01   +1.000000000000000e+00; +1.764696692660780e-02   +5.969775514207084e-01   +9.576281491524126e-01   +4.578201824802718e-01   +8.456357450820171e-02   +7.429254772392645e-01   +1.227125749942350e-01   +3.797838254658517e-01; +9.821593397739168e-01   +9.417060910804839e-01   +6.187325769673999e-02   +1.402001476786799e-01   +1.604816340016790e-01   +9.417783696274747e-01   +2.541489614755332e-01   +9.398931757454034e-01; +1.479228583716803e-01   +3.622955592613423e-01   +7.902140325376479e-01   +3.348682228064219e-01   +4.015876456330619e-01   +9.864307562625096e-01   +2.006122060633616e-02   +9.889202990773390e-01; +6.735749842960423e-01   +4.190781581600175e-01   +2.362441043216097e-01   +1.852301771082046e-01   +1.407047744014970e-01   +3.212621775446377e-01   +2.343974981076249e-01   +1.062746531187965e-01; +1.054704542746992e-01   +6.503744415286071e-01   +7.936747962833410e-01   +4.672872896032074e-01   +4.586521252310718e-02   +7.857762155592256e-01   +7.892835892122565e-01   +8.088690973745543e-01];
L2I_L3I_iGABA_netcon = [+3.669738700233640e-01   +6.543353766960485e-01   +2.601821671964695e-01   +7.217604382104312e-01   +6.013735362429800e-01   +4.981094788078756e-01   +4.177262972616496e-01   +5.085082783728880e-01; +3.332751614744979e-01   +1.705042925859980e-01   +5.289834846196479e-04   +8.843316010110930e-01   +7.807807423246215e-01   +6.044536926043537e-02   +1.080781166865326e-01   +6.945050071697850e-01; +3.365516086056045e-01   +6.467528203795250e-01   +4.035505150332548e-01   +1.345077503329254e-01   +8.736779602305687e-01   +5.946788035357190e-01   +1.733592046453128e-01   +1.077441338039363e-01; +6.448429142222645e-01   +8.945038765740543e-01   +6.377201048295419e-01   +5.323637842609693e-01   +5.632042713043569e-01   +7.298500444851560e-01   +4.605655566452979e-01   +7.469007116633093e-01; +1.877550113325917e-02   +1.665901368260427e-02   +1.249485200129925e-01   +6.550298717710386e-01   +2.497124415943149e-01   +7.229359764526716e-01   +4.762697724807543e-01   +3.859510172823664e-01; +5.076610439103824e-01   +4.841957689133667e-01   +4.720414808675743e-01   +7.600892525054594e-01   +2.978109510579331e-01   +9.278205190448683e-01   +3.289308380053647e-01   +1.182324647769467e-01; +2.744380228235665e-01   +5.366807807548542e-02   +5.058294369955534e-01   +1.000000000000000e+00   +6.897421837715332e-01   +8.967173772538233e-02   +2.766848526257784e-01   +8.298836778176438e-01; +2.405242565378291e-01   +9.600649213217652e-01   +9.975618899594612e-01   +9.846579005651419e-01   +5.243887137214931e-01   +1.403534236350290e-01   +8.022143852569444e-01   +1.190786953048178e-01; +3.726914781846402e-01   +5.213717248517741e-01   +3.414993384282052e-01   +2.024578552206431e-01   +3.343126774566331e-01   +2.973461529071330e-01   +6.142185396110089e-01   +5.233251634367759e-01; +4.059719330420166e-01   +2.187009361926554e-01   +1.990629505356394e-01   +3.598350393547209e-01   +9.902864414635540e-01   +4.857254289197415e-01   +4.850669847410774e-01   +9.757987899617045e-01; +6.370362360884019e-01   +1.284745521961682e-01   +3.010993478946187e-01   +6.701950814550864e-01   +5.054167924626012e-01   +7.767059921662715e-01   +9.494367864583272e-01   +6.987035639184944e-01; +4.187606513283453e-01   +2.676798625783457e-01   +6.739645339651191e-01   +2.928334547096693e-01   +8.162304459413804e-02   -4.700191001274463e-03   +3.155990241712869e-01   +7.102909665131549e-01];
L3I_L3E_iAMPA_netcon = [+7.176199073851257e-02   +7.300048450801695e-01   +1.348336140939488e-01   +2.257315837392485e-01   +2.958821221857802e-01   +6.720217311840933e-01   +8.510159227857363e-02   +3.958447850169148e-01   +5.364613646723948e-01   +3.083638432931657e-01   +6.156645216275349e-01   +8.754735563722981e-01; +3.364376934707849e-01   +8.641945835214001e-01   +2.566763255725544e-01   +3.871762285256324e-01   +8.533705266643261e-01   +3.508298611296012e-01   +3.883067635890617e-01   +4.393119227014771e-01   +6.257737316168708e-01   +2.902893956150589e-01   +7.486749709222167e-01   +2.264549277207209e-01; +4.661080336550464e-01   +3.569287551204381e-01   +7.522540032000182e-01   +9.426394489791736e-01   +6.413581297963153e-01   +6.153103250916017e-01   +9.932484513275205e-01   +4.082332172397078e-01   +2.420723880013048e-01   +2.990273845938954e-01   +9.382741820382776e-01   +8.245842265794870e-01; +5.743600111931463e-01   +7.684100152912451e-02   +5.922039379685765e-01   +8.077245318476260e-01   +4.716916006426953e-01   +5.847804956402417e-01   +5.840017156431331e-01   +6.955261252179535e-01   +5.709177257875783e-01   +2.209098196910814e-01   +4.377353893690677e-01   +4.558638797222465e-01; +9.835829275033857e-01   +8.821921739478865e-01   +6.052388504013347e-01   +4.874374839857034e-01   +2.614386021486290e-01   +3.608200589985863e-01   +1.985215571777595e-02   +2.447680615940305e-01   +1.604731165755462e-02   +2.795928828678352e-01   +9.906422130426146e-02   +5.240025496214287e-01; +4.307481139723808e-01   +2.104953436434127e-01   +6.480866492286786e-01   +4.608107755412478e-01   +9.355038777890460e-01   +6.552007668404232e-01   +3.124868540696351e-01   +8.280098099175924e-02   +1.956248002404574e-01   +5.544166862681522e-01   +3.574629431925000e-01   +5.939116471459344e-02; +4.898059745768589e-01   +2.013621677987243e-01   +8.738099993656420e-01   +8.836032064146365e-01   +1.747624016592760e-01   +3.269991670091900e-01   +3.569995546690394e-01   +1.349042110323789e-01   +9.460659598886672e-01   +6.668887074782125e-01   +2.480924070659611e-01   +4.809217172268159e-02; +3.598395256191915e-01   +4.815848894694267e-01   +2.111750598773984e-01   +5.911129913004963e-01   +8.789312989103367e-01   +2.810207472005680e-01   +3.985640527977322e-01   +2.819418718415135e-01   +3.435000221075944e-01   +2.518539055145417e-01   +6.774226209742752e-01   +5.903390660785275e-01; +3.176201325404273e-01   +5.502447387995197e-01   +3.521784540543611e-01   +5.736342618828763e-01   +5.609805828076874e-01   -6.948615915563857e-03   +7.663231613570712e-02   +7.727654910718322e-02   +2.941081440280583e-01   +2.178942029441407e-01   +9.128799564878756e-01   +9.030158008960147e-01; +7.429021295431510e-01   +6.099454381596809e-01   +5.938607120963914e-01   +3.974963162909828e-01   +4.957282821775310e-01   +3.968234641931468e-01   -8.793697226862598e-03   +6.408602723863810e-01   +2.359146060958142e-02   +9.137093988631064e-01   +4.872734238493783e-01   +1.746973212318430e-01; +7.588010231313996e-02   +2.747863638324568e-01   +6.530219063482248e-01   +2.347796306956514e-01   +6.925584942714341e-02   +5.077523487395255e-01   +9.297566099558421e-02   +7.598312400842189e-01   +7.897953506542685e-01   +1.725872931115522e-01   +6.502402506828459e-01   +2.634500607097895e-01; +6.399444539031648e-01   +6.280528486827954e-01   +4.415026540255714e-01   +6.155687043952581e-01   +6.535095646437090e-01   +4.406803180432611e-01   +3.657276128271602e-01   +8.411001319964769e-01   +6.433037456905146e-01   +4.115345803110024e-01   +5.411491501347109e-01   +4.155709493973031e-01];
L3E_L3I_iGABA_netcon = [+3.697135356414542e-01   +7.692267359425941e-01   +7.383975188007066e-01   +9.610668571974391e-01   +4.568925131555581e-01   +1.073949672574736e-01   +3.211691593687750e-01   +7.247488282669405e-01   +8.170106704565965e-01   +2.595412953513032e-01   +5.492673012666029e-01   +3.108373441216763e-01; +8.796063807303058e-01   +4.146427585112470e-01   +6.212668511268338e-01   +4.097385763005109e-02   +9.621243966603795e-01   +4.180753733015855e-01   +8.602035842823275e-01   +7.525262064140029e-01   +6.609416646895032e-01   +7.530499677098492e-01   +2.646513109281189e-01   +5.445252049020276e-01; +8.519478349256480e-01   +3.398637428892540e-01   +3.897967556933802e-01   +4.821003238000975e-01   +5.682012553004858e-01   +5.611656973236139e-01   +2.614162255371164e-01   +8.848824890388181e-01   +6.332812668504443e-01   +1.028291711619796e-01   +8.253873029230809e-01   +8.525682337615373e-01; +1.059181145464925e-01   +6.808797339997066e-01   +3.251413411071825e-01   +3.215812596447122e-01   +7.997753378999811e-02   +7.433880032981706e-01   +2.600018929659248e-01   +1.214202265506904e-01   +2.838229014914203e-01   +4.985711216692740e-01   +8.034896069046285e-01   +5.797391771185808e-01; +2.688334874397809e-01   +7.876123784884143e-01   +6.099748282946380e-01   +2.932960535601746e-01   +6.650246335949044e-02   +6.221292475133879e-01   +9.326112071174468e-01   +2.493255881615485e-01   +3.357452184882024e-01   +8.193683209691319e-01   +6.502548313208699e-01   +2.276348508815118e-01; +4.693411502431021e-01   +8.329248424362903e-01   +7.658335252129600e-01   +5.100431082432194e-01   +7.728021423418818e-01   +1.067307961838696e-01   +4.138430256287836e-01   +3.769795946022445e-01   +8.341217502682665e-01   +8.871175660726249e-01   +8.446172977711708e-01   +2.771924797858483e-01; +5.116563514504172e-01   +8.019512703345070e-01   +2.397698412639198e-01   +2.275192694658819e-02   +4.295971651188868e-01   +6.670559595430620e-01   +6.463039603963197e-01   +2.116215955065292e-01   +9.920363820455705e-01   +6.495984858231835e-01   +2.877528004468677e-02   +4.129890569338155e-01; +4.701326381847770e-01   +4.355678407185619e-01   +8.736232966640632e-01   +3.828661343438819e-01   +6.880818201531497e-02   +1.174945197465157e-01   +6.206864952289600e-01   +3.926611054127261e-02   +6.234251688582785e-01   +8.665873509061296e-01   +2.386064017516624e-01   +9.964894825777241e-01; +3.281123115114254e-01   +5.850910028833188e-01   +2.305082265762808e-01   +6.945593611912925e-01   +9.376498839720842e-01   +2.311636639118991e-02   +3.491733073968483e-01   +6.057648352614077e-01   +6.266613585471189e-01   +9.808864581840802e-01   +6.954349468178120e-01   +6.471974933331806e-01; +9.530483226227308e-02   +1.063915445203402e-02   +3.353145189031617e-01   +5.931494765100601e-01   +7.838781960417074e-01   +2.676505174704771e-01   +1.084174759543461e-02   +2.969843977433436e-01   +7.323059846162037e-01   +2.986112522901194e-01   +6.382349364355017e-01   +7.588459554909369e-02; +9.529562000769197e-01   +1.092179447871316e-01   +7.473752433514990e-01   +4.948192197568276e-01   +4.452059871710872e-01   +8.718764594382310e-01   +8.814250984847702e-02   +8.212231294645993e-01   +3.707584496297867e-01   +9.754621633880682e-01   +4.306773042443088e-01   +7.505395868103844e-01; +6.736528081798674e-01   +8.478929930802572e-01   +5.116553721614435e-01   +9.024222609715007e-01   +8.729990826433182e-01   +5.181657482731210e-01   +9.911889077842616e-01   +9.294142565266269e-01   +4.876204256255248e-01   +9.341528649224518e-01   +5.584287178682771e-01   +9.379182431611842e-01];
L2E_Input1_iAMPA_netcon = [+9.908507014829424e-01   +9.935518833870980e-01   +9.955560982993290e-01   +9.950424760681975e-01   +9.897483184340494e-01   +9.926755451208008e-01   +9.790494648063800e-01   +1.000000000000000e+00];
L2I_Input2_iAMPA_netcon = [+9.789565100921809e-01   +9.978269330229604e-01   +9.798413571239060e-01   +9.776644875393917e-01   +9.792556591643844e-01   +9.813276572815517e-01   +9.767773119635306e-01   +1.000000000000000e+00];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
