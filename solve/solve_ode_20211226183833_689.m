function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-3.744153676696139e-01   +8.963688196642967e-01   -5.709391561321072e-01   +2.416647356472481e-01   -3.330440241308188e-02   +1.160820812877459e-01   +4.523274448891093e-01   +2.551720540139696e-01   -6.312366626400408e-02   +3.479973173305341e-01   -1.340022917304115e-02   -6.146675187639275e-02   +2.864132644835923e-01   -5.583638377625241e-01   +2.230012811820906e-02   +1.107584590677214e-01; +5.679736537613918e-01   -1.685899299935794e-01   +5.069829123497458e-01   -4.028677108712422e-01   +2.139646496123695e-01   +5.940123413064383e-01   +1.852674808070829e-01   -4.096556005113536e-01   +1.001304482262011e-02   -9.495245663805663e-02   -9.881237506688562e-02   -3.793515326997586e-01   +2.347757244256737e-02   -3.686956352443918e-01   +6.244969794508040e-01   +3.915218504025783e-01; +1.041633762403267e-02   +1.719613861025275e-01   +4.678557453186770e-01   -1.788008198495998e-01   -1.982893350799266e-01   +2.303780294456212e-02   +7.717603984809847e-02   -2.011673311675329e-01   +1.579610544890835e-01   +2.295244690922608e-01   -4.114503573788231e-01   -3.074222383452263e-01   -2.118708796874704e-01   +3.135489841712342e-01   -8.959137835682290e-02   -3.428271252908285e-01; -4.638517936831394e-01   +2.258222700283229e-01   +9.144626441403425e-02   +3.168662915161349e-01   +2.910689207790395e-02   -2.992899704147566e-01   +5.224979305887927e-01   -3.345791245337906e-01   -6.448388323609382e-02   -6.708228519391053e-01   +2.442660485541528e-01   +7.344704977776234e-02   -3.692788520354659e-02   +2.529505598200105e-01   +1.792259909208803e-01   -8.903311129013874e-02; +1.458434349669675e-01   +2.499571952580491e-01   +2.338037808025488e-01   +5.373948563112005e-01   +4.380937142237501e-03   -4.279506673043976e-01   -2.082605995103894e-01   +3.245505230610454e-01   +2.164281728700254e-01   +3.359414060122874e-02   +2.906212087262402e-01   +3.308957912573161e-01   -3.249186572933814e-01   +2.463255666850266e-01   +5.644462390228230e-01   -5.966554446872822e-01; +3.973143206506606e-01   -1.419642461417473e-01   -1.533187773380895e-01   -6.498035127035652e-01   +2.983851892395506e-02   +4.150588351610585e-01   -1.750921975773432e-01   +2.524709013207752e-01   -5.939404012675766e-01   -9.585851749220481e-02   +6.820105280965949e-02   -4.239837991215062e-01   +5.429606034699208e-02   -1.582612770961868e-02   +5.045586310636245e-01   -3.683128107491709e-01; +2.026198838877136e-01   -2.873229643636197e-01   -4.034312683947816e-01   +2.351705788179182e-01   +2.916560125488481e-01   +2.519129185943413e-01   +1.023515820696582e-01   +4.462996825131640e-01   -6.828406482037380e-02   +2.943856513458439e-01   -2.610184482663582e-01   +5.829963863924721e-01   +4.022492559044437e-01   +1.621997381298624e-01   -3.548791899807276e-01   -6.508894175909796e-01; +3.627847339150259e-02   +2.362957664312428e-01   +1.176623304498826e-01   -3.796842438728398e-01   +3.515292387455184e-01   +7.545490567553520e-02   -2.375833375688545e-03   +1.061534665348669e-01   -2.654939127910474e-01   -7.212801184567991e-02   +4.877129591625485e-01   +4.614970527210025e-01   -1.789901003993528e-01   -1.324443588790903e-01   -5.159907789580759e-01   +5.320029730326138e-01; +5.921948375210296e-01   +3.048924173019008e-01   -1.704454411456881e-01   +2.106104180266235e-01   +6.558241108221201e-01   -1.977638738109784e-01   +3.510242883065477e-01   -4.275846548599046e-01   +1.599009000296937e-01   +7.659426269408844e-01   +4.606579312686832e-02   +4.863587645353144e-01   -5.919808869613215e-01   -1.094970541943638e-01   +2.658059185501337e-02   -3.626463603310008e-01; -3.818702389992573e-01   -1.099758144853358e-01   +3.053534845017363e-02   +9.998841378359949e-02   +3.618773545130975e-01   -2.383458855260122e-01   +1.951872746214980e-01   +2.697295443476039e-01   +6.284045819717463e-01   -6.922333728829952e-02   -4.822578475051041e-02   -3.906168160797140e-01   -2.358013186428982e-01   +6.887554404966334e-02   -5.152150377407529e-01   -3.787071045401219e-01; +6.118669396075879e-02   +2.576945240761403e-01   +1.083856763251111e-02   -3.812515235219360e-02   -1.721897548726522e-01   +1.458605558207372e-01   -4.933252951580935e-01   -2.651178719713989e-01   -3.084461222249299e-01   -4.984627035471972e-01   +6.755148749877782e-01   -5.189433244877988e-02   +1.850419672643325e-01   -4.981384700485044e-01   +2.828740565340315e-01   +8.714706718904336e-02; -4.638870669248932e-02   +3.864037414061457e-02   +6.157390841951155e-01   +2.057950646129141e-01   +3.148641594587113e-01   +4.865050515008660e-01   +1.114975997237846e-01   +4.325866131694589e-01   +1.523663816002349e-02   +2.724422482076706e-01   +1.366864473021802e-01   +2.134356997547217e-01   -6.595767357763824e-01   +4.571195954468381e-01   -7.561653667925199e-02   -3.073741057399104e-01; -5.120828587719163e-01   -9.966059903822958e-01   -4.150454953465687e-01   +9.334222930062600e-02   -1.997616491772431e-01   -5.263454609317296e-01   +5.214457190734337e-01   -4.123648813635524e-01   +1.862015783278356e-01   +3.853342028782404e-01   +7.838154277535206e-01   +4.482073748428306e-01   +1.964635718381379e-02   -1.082503412110700e-01   -1.557760609991665e-01   -3.292058136178253e-01; -4.250911434662222e-02   -1.640869144509559e-01   -2.571335200318707e-01   -6.710012406018657e-01   +5.709317776931546e-01   -2.200895973876565e-01   +2.124590538285047e-01   +5.017099135470492e-01   +1.284686149851834e-01   +6.060189026989246e-02   +3.823413859663143e-01   +2.022003791629648e-01   +3.946396783321913e-01   +2.895464984513317e-01   +2.760058955803466e-01   -4.290441559881499e-01; -3.891662178321489e-01   +3.569658184474832e-01   +4.972993426111917e-01   -3.270137099752092e-02   -3.585600456105619e-01   +2.991272553961240e-01   -1.477333188695952e-02   +2.452483168069466e-02   +5.505925900404572e-01   +3.935265644069572e-01   -3.210140124343220e-01   +4.686496747841097e-02   +8.841263452600992e-02   +3.886522757154802e-01   -1.148549708105871e-01   -3.552449089493454e-01; +2.715677016786722e-01   +4.062577323580496e-01   +3.365498911891451e-01   +2.133351252170254e-01   -3.971226603374278e-02   +7.475568252503085e-01   -3.539233940660626e-01   +4.278644503160012e-01   -8.357463159087189e-02   -1.710329114619795e-01   -5.610736093062271e-01   -1.251508767233425e-01   -1.166016644669797e-01   -1.724564515749085e-01   +7.421004559296554e-02   +7.515443327414770e-02];
L1E_L1I_iGABA_netcon = [-1.580304155693159e-02   -1.279344923550128e-01   -4.184189819046442e-01   -1.619275169358184e-02   -1.987004968264733e-03   +5.780066707480118e-02   -2.307536781892136e-02   -6.886229880089495e-01   +6.669327978448893e-02   -2.399899953617497e-01   -1.571135877817212e-01   -2.198690314731258e-01   -4.743805776684924e-01   -1.880804062553869e-01   +4.351419423921130e-01   -9.281085160720869e-02; +1.029805244757581e-01   +4.043126890221999e-01   -7.324716819162045e-01   -1.462805543604776e-01   -4.151493884127848e-01   -2.449954180721851e-01   -2.317370000989365e-01   -2.088562269489941e-01   +5.718724674245429e-01   +6.230242487213752e-01   -2.046235413125653e-01   -3.001127415501389e-01   -2.905354817345048e-01   +3.052847639412685e-01   +3.003931760813281e-01   +1.113915249570916e-01; -1.285334423058987e-02   +8.248738740910952e-02   -2.288417106874902e-01   -2.147757419242415e-01   +5.000137832361318e-01   -8.926608232666678e-01   +3.048481720751899e-01   -4.963195689167126e-01   -2.240402346262892e-01   +2.217739493255452e-01   -3.778763467015704e-01   +2.830659069016917e-01   -2.911780678583994e-01   +4.778951279474901e-01   -1.648943899889661e-01   +5.008576879319870e-01; -7.139786082749675e-01   +1.652757178400349e-01   -3.031970218711003e-01   +2.284071740914912e-01   -5.434135419578746e-01   +6.840003812260756e-01   +1.899959773369915e-01   +9.227965142755160e-02   -5.653998864269147e-01   -3.040220849972535e-01   +5.235430642998121e-01   +1.455715906990541e-01   +6.354075770478691e-01   -7.212192317098606e-02   +3.503080852964560e-01   -2.253630964174897e-01; -1.705216910487195e-01   +5.665467285758776e-01   -6.383253088421358e-01   +6.372701210542724e-01   -5.229599857995074e-02   -4.875380551441593e-01   +6.532759056859302e-02   -7.233048582541421e-01   -4.644595498145014e-02   -7.896563993961186e-02   -6.808977839783666e-01   +1.693027096125886e-01   -5.715673788069044e-02   +4.190515462195585e-01   +3.140251366281148e-01   -1.348927412635564e-01; -2.212551039033953e-02   -1.538483244830101e-01   +2.086153145737829e-01   +2.849827043288879e-01   -2.455558733837563e-01   -3.937635883042387e-02   -1.670395513461654e-01   -4.787394095754025e-01   +5.052075948038376e-01   -4.424007056584980e-01   +1.393378566112860e-01   +3.971229196481789e-01   +4.896415254026871e-01   -4.578750990287414e-01   -8.083417713328712e-01   -2.604898639711399e-01; -2.362528472115782e-01   -2.232903300361379e-01   +1.693567500431631e-02   +2.105995313933434e-01   -1.096875248423843e-01   +2.073926338058850e-02   +6.754548599459763e-01   +7.936156731479957e-02   +7.468921234594589e-02   +5.288551037320424e-01   +2.003372111979956e-01   +4.802072547909784e-01   +7.863757938891976e-02   -7.449182921190438e-01   -1.757050452522718e-01   -3.587336146244572e-01; +2.373139340073528e-01   +7.450465319538002e-02   +3.518591455481209e-01   +5.584851444471735e-01   -3.729069785088677e-01   +5.596102372371954e-01   +7.550219670611706e-01   -7.415380936882776e-02   +3.376144335965140e-02   -1.922944697417615e-01   -4.073975638355597e-01   -3.663787193828806e-01   +8.357765246504426e-02   +3.645038183241462e-01   +5.167568060593616e-01   +4.833477225150080e-01; +2.517060343032264e-01   -1.156220835152610e-01   +4.371345744414885e-01   -2.027360346105271e-01   +1.644523190296447e-01   +2.483685141517539e-01   -7.479960841117615e-01   -3.272608245207115e-01   +2.380198887144491e-02   -6.166971608159771e-02   -5.957212831363332e-01   -8.176053834744690e-02   +1.064490193878474e-01   -4.025438715391935e-01   -2.273921669869750e-01   +7.725099639819929e-01; +2.439419142359105e-01   +6.760553345151019e-02   -8.990646024793075e-02   +2.398161615226153e-01   -3.892401553350636e-01   -5.353889483524038e-02   -3.516181432334786e-01   -7.094879468802397e-02   +2.329585592893274e-02   +3.338366281964507e-02   +1.127331691851926e-01   +4.628428061181072e-01   +2.852088480823805e-01   -2.577769517366452e-01   +6.369473482100424e-01   -8.912242576025176e-02; -5.153061314991862e-01   +1.236120164602266e-01   +6.192621156505449e-01   -2.150902545916895e-02   +1.481090086898330e-01   -7.822408998278736e-01   -2.191033597229511e-01   -7.866847199459034e-01   -5.262147504377430e-03   -4.563992190091410e-01   +4.495786560565261e-01   -3.921508237229194e-01   -9.309150062649121e-02   -5.708831388607398e-01   -1.472647865216174e-01   +9.085778384114110e-02; +3.892320351938619e-01   +4.463755720694793e-01   +7.207264312735118e-02   -8.586547310910164e-02   -2.671085283615272e-01   +1.803758708389833e-01   -6.907071552460247e-01   +4.416867737937037e-01   +4.126535183407991e-01   +6.208136127582401e-01   -5.626105126872261e-01   -8.277512733606619e-01   +4.879327521819814e-01   -2.312861923228047e-01   -1.199605889761237e-01   -5.017461391530244e-01; +4.704824984827318e-01   +4.152603484175027e-01   -4.432538635446714e-01   -7.789052846993147e-01   -1.500006305389768e-01   +9.809222087400016e-02   -2.492606167561741e-01   -4.105991674655811e-01   -1.132020179981903e-01   -9.402201323268684e-02   +8.783113013251839e-02   -2.918410161703524e-01   -9.416568465819009e-01   -9.679674219272385e-01   -1.862154403305830e-02   +5.751251608275192e-02; -9.235965429101210e-02   -2.226964577006053e-01   +1.418298176186219e-01   -2.030137855342979e-01   +2.742218793012400e-01   -2.459157789175916e-01   -7.294387979200179e-02   -9.005693352731357e-02   -1.980867443389160e-01   +3.206967975038792e-01   -7.708785827262252e-01   -6.163877981903479e-01   +3.455708262993045e-01   +4.960537896925743e-03   +2.654126339248934e-01   -5.653849464772751e-02; -4.206944795661255e-01   -4.847945493539645e-01   -1.980338198016456e-01   +4.979372844064285e-01   -7.469236701957045e-01   +8.190092953555692e-02   +1.999199059698717e-01   +6.817419942634492e-01   -1.184774313750847e-01   +3.726425920376564e-01   -6.482331200415314e-02   +6.057895600508014e-01   +1.059119252488478e-01   +4.803597407008127e-02   -2.005592983800142e-01   -7.096479365477339e-01; +6.233270855546946e-01   +1.450539353499433e-01   +1.669417507778514e-01   +2.249048047671035e-01   -6.116362895684282e-02   -8.251533027261460e-01   +1.099814690535462e-01   -2.767656649144046e-01   +1.449851376336250e-01   -4.756657461278466e-01   -2.433677760788026e-01   +4.677068918676581e-01   +8.920647659674433e-02   +1.863367526945349e-01   +1.271654528197865e-01   +4.579376672334136e-01];
L2I_L1I_iGABA_netcon = [+4.428484488224740e-01   +8.617708051538941e-02   +1.577728195579984e-01   +2.050377215339683e-01   +1.090048241635528e-01   -2.532879802948291e-01   -4.089735681801371e-01   +1.802999698564484e-01; -3.256134101135135e-01   -8.540286735295731e-02   +2.225766334750652e-01   -7.828453736107646e-02   -4.544376989615609e-01   +9.119954533708510e-01   -1.392687274382257e-01   +2.623855408248006e-01; +5.406312888320780e-02   -1.632599573341204e-01   +2.699122901312425e-01   -1.619914067599060e-02   -5.894161510561335e-01   +3.073765307796729e-01   -3.460634063880779e-01   +1.610811487693128e-01; -5.484458766559008e-01   +4.851971004808071e-01   +1.299988539929778e-01   -1.021156803654663e-01   +1.805293152181038e-01   +4.173211722710984e-02   +3.481233594557400e-01   -3.594518695647000e-01; -8.641719192055569e-02   +9.828343119847074e-01   +4.975397247168279e-01   -4.306140369490808e-01   -2.537503804479956e-01   -1.594631491145015e-01   -1.530783794188173e-01   +3.117232017617996e-01; -6.946966579765558e-01   -4.118245095389683e-02   -1.844797241145576e-01   +5.163083216161950e-01   +2.311634337341400e-01   +2.798527293656482e-02   -5.735858490331620e-01   +1.789420839785840e-01; -6.331402255957780e-02   +5.741242360617109e-01   -1.393578904368001e-01   -1.068578792819491e-01   +1.787903653211752e-01   -4.682521281997962e-01   -7.993800040532384e-01   +4.384703635526167e-02; -1.594162261215211e-01   -1.997134246746082e-01   -5.556388027352976e-01   -2.673746795327843e-01   -7.710789085857342e-01   -1.341938196863764e-01   +5.007150788829895e-02   -1.354746562199119e-01; -1.454508522718823e-02   +5.372120663944751e-01   +3.052246660816207e-01   -3.246281354910522e-01   +3.568426182450797e-01   +6.785174963882110e-01   -5.042586086790848e-01   -4.491979127984742e-01; -3.764464007025148e-01   -4.675255599388968e-01   -2.994007330847301e-01   -2.231600367407132e-01   -1.735576857694201e-01   -2.240383416176520e-01   +1.744042234583938e-01   +3.775949284555212e-01; +2.665722468553928e-01   -3.351936455168146e-01   +2.804496385965607e-01   +3.679225795455618e-01   +5.136981684087180e-01   +1.878911414362763e-01   -7.382888899001397e-02   +1.210543728177986e-01; -3.945912718411548e-01   -4.272775654466804e-02   -3.629617015745462e-02   +1.184050868584869e-01   +4.501402339785316e-01   -1.178525412518578e-01   -5.033742630811179e-01   +1.059823693678748e-01; -1.140416690038145e-01   +3.833872833132020e-01   -1.745960704821924e-01   +5.740647644977942e-01   -1.375477741947899e-01   -2.131039866735776e-01   -6.069384410326437e-01   +9.047791581309243e-02; +1.609869597463816e-02   +1.686746202868729e-02   +9.280636491656763e-02   -3.109793375610097e-01   -1.332177784982825e-01   +5.042974823895795e-01   -2.097532592529227e-01   -1.618535544230402e-01; -1.949590955700083e-01   +3.195247948838874e-01   -4.656007092696815e-02   -2.631482023666779e-01   +3.594412365390847e-01   +2.546636438127566e-01   +5.639684548636442e-01   -1.791360553196116e-01; -5.236775432797189e-01   +2.799681882623409e-01   -1.310007648010766e-01   +1.731231576214785e-01   -1.543287293326149e-01   +8.692962148577618e-02   +3.175463068807352e-01   +6.736913985305385e-01];
L1I_L2I_iGABA_netcon = [+3.788397875521808e-01   -6.113101662862283e-01   +6.002459309374941e-01   +8.779601015752972e-02   +7.993219748956302e-01   -1.371408351579588e-01   -5.317201769971128e-01   -7.368520475184296e-01   +3.612409407137539e-01   -3.151990500156964e-01   -3.932662324249390e-01   +3.434632799407473e-02   -5.645592583461779e-01   +1.645903089340184e-01   +6.131137707343707e-01   +4.735632393226206e-01; +8.597270424577771e-02   +3.784259103405407e-01   -6.395687942117988e-01   +2.980296267515136e-01   -2.399297798306260e-01   -3.779218401121869e-01   +3.272986952876446e-01   -5.576986780109328e-01   -2.395806591267948e-02   -2.283223348557157e-01   -3.696863963676100e-01   -1.789056536186990e-01   -7.472322828838682e-01   +2.638052474878183e-02   +2.554477410882132e-01   -2.875816047168611e-01; +2.692413782725353e-01   +9.187413133498933e-02   +4.513358666941216e-01   +6.328295478501659e-01   +1.693545763502696e-02   +2.569510035813248e-01   -2.410327869066760e-01   -3.803669607034419e-02   -3.227972884004837e-01   -8.441050178622227e-01   +3.712840885460447e-01   -2.655277780966621e-01   +2.256254568971851e-01   +4.971162758071603e-01   -5.627445828323729e-02   +4.094665711770454e-01; -5.125353508029563e-01   -5.867732113068636e-01   +1.932971188320126e-01   -1.106527850858772e-01   -8.293284140204443e-02   -4.344326793942974e-01   +6.046499588726832e-01   +1.704551791600216e-01   +1.977010639799447e-01   +3.217375808160613e-01   +2.343422016407989e-01   +8.192207319131761e-02   +3.724688661301432e-01   +2.926224285323913e-02   -2.030466260165448e-01   +1.295218593014310e-01; +4.378592860241044e-01   -1.902524492874829e-01   -2.273221542938358e-01   -4.935193021122048e-01   -6.978444053204972e-01   -1.893667388194937e-01   -8.859554107507778e-02   -8.855290879581093e-01   +6.495861456072860e-01   -4.210713831848327e-01   -4.628318445986878e-01   -8.771879794570307e-02   -1.137559899531705e-01   +4.441368967699978e-01   +6.079456363536716e-01   +2.403725287801539e-01; -2.645944591287724e-01   +3.441884350086348e-01   +6.597991405946316e-01   +1.851928154691717e-01   +5.998998808357514e-01   +3.830563216110459e-01   +2.676579273638860e-03   -3.481797037824881e-01   +4.875786236319846e-01   -2.820433588404921e-01   +2.939773859152293e-01   -2.398872599268726e-01   -2.466064467658969e-01   -3.168384641036917e-01   +6.713826992873881e-01   -3.370606881062771e-01; -4.156538757123129e-01   -3.070309135086960e-01   +4.376157331183078e-01   -4.828349700506186e-01   -5.211750125820340e-01   +6.062981974943044e-02   -9.732943997661840e-02   +2.614128307949688e-01   +5.096868446350594e-01   +1.184768347030656e-02   +5.427912232737812e-01   -4.185595938042421e-01   -6.020981458118434e-01   -4.803743546985968e-01   -3.720380187685171e-01   -1.791758417941210e-01; +3.673884092439794e-01   +3.250824315215177e-01   -1.430192836684913e-01   +1.294987246872846e-01   -1.580855717310519e-01   +9.530147277170532e-02   -3.048143125662792e-01   -1.715089405834401e-01   -2.149874035236524e-01   -1.513623867815648e-01   +1.576302016389566e-01   +5.672746830822774e-02   -4.515670121945553e-02   +6.898196775584503e-01   +2.456252363153179e-01   -3.705116482915138e-01];
L2E_L1E_iAMPA_netcon = [-1.123566132118078e-01   -4.817700764377861e-01   +6.532753890388851e-02   +2.122171873629164e-02   +6.898030383607393e-02   -4.426582395414747e-01   -5.062895556876807e-01   +1.946432403865413e-01; +2.618777107596287e-01   +3.913941924948431e-01   +2.767409096650954e-02   +9.590276347183388e-02   +6.014600579820891e-01   -2.822920705253062e-01   +1.619523500603373e-01   -1.824514213359188e-01; -4.769877529011353e-01   +2.309176280210127e-01   -4.554541084612728e-01   +3.262107758021658e-01   +1.838204611180668e-01   -8.165429939238357e-01   -6.421694674066886e-01   -7.307760558967702e-01; -1.533502078278839e-01   +2.298993699457610e-01   -5.235832022460325e-01   +1.156972689699553e-01   +1.650542540121266e-01   -8.019936671421156e-01   -2.603891448270332e-01   -3.351689972074732e-01; -3.242813123791947e-01   +3.304823496036565e-01   -4.128141409875662e-01   +9.943594068719720e-02   -1.261400482002077e-01   +6.012151433667576e-01   -1.568911248836571e-01   -9.746089078462777e-01; -2.420783629917032e-01   -4.510334481318701e-02   +1.371569144764972e-02   +3.639419093599067e-02   +2.442943728729742e-01   +7.047783662078687e-01   +2.237306827612875e-01   -4.014710787398028e-02; +4.003570916462109e-01   -5.207999023652936e-01   +3.824361433411080e-02   +5.534583956313932e-01   +4.978666619705469e-02   +5.025667127211134e-02   -3.992580260554881e-01   +4.286897831856868e-01; +1.572840489029009e-01   -3.335359754236658e-01   -2.996160644818694e-01   +1.527926397696937e-02   +2.374694528126571e-01   -1.160773313671892e-01   -1.518697552530561e-01   +5.345485155352167e-02; -1.084625344782289e-02   -1.430777063757607e-02   -6.724324695625328e-02   +1.218192086755857e-01   +7.849520816989888e-02   -5.161274650599661e-01   -2.303847651098523e-01   -3.815784129651724e-02; -2.244156126666884e-01   -2.772742015547099e-01   -6.709944576832767e-02   -3.279300561019692e-01   -3.290001629742224e-01   +1.601968349378961e-02   +6.158586769505606e-02   +4.863415135573801e-01; +2.963528880283283e-01   +5.979896610519120e-02   +1.440046558192415e-02   +1.412391591499313e-01   +5.349933429896724e-01   -3.767837390781448e-01   -3.394409639176180e-01   -2.895367781585656e-01; -4.816654688413415e-01   -7.351635172196127e-01   +9.070684111526367e-02   +4.140831394649013e-01   +2.615990067048632e-01   +7.900207818669594e-02   -5.097238411460077e-01   +3.115405222732096e-01; +2.324988244929589e-01   -1.179238683909806e-01   +3.554526313015225e-01   -9.389385928705543e-01   +9.058626994705993e-01   +3.295686380120288e-01   -3.985053560597040e-01   +4.423208462751408e-01; +9.794356718826729e-02   +3.980356002450489e-01   +2.939126451700186e-01   -8.315872553015852e-02   +2.986837588723001e-01   -2.390955624641933e-01   -2.043159771803667e-01   +2.276646549099229e-01; -1.147545028662284e-01   +1.792699087222323e-01   +3.297476269809980e-01   -6.165365290193964e-01   +4.325670880491184e-01   +9.754894200740596e-02   -1.397061238805274e-01   -5.922654211340709e-01; -2.270769271542983e-01   +3.582432901649035e-01   +1.357844822129394e-01   -3.767854482002605e-01   -5.109682282965033e-01   +2.000195402941947e-01   +6.081471107658626e-02   +6.037803282146512e-01];
L1E_L2E_iAMPA_netcon = [-1.111316224572602e-01   -7.481475548590436e-01   +3.198972652827167e-01   +1.879585595440227e-01   -3.066157296120709e-01   +6.438864170556179e-01   -4.922707374418273e-01   +4.217452611858819e-01   +1.115865459278352e-01   +6.935042354534959e-02   +2.498303452201809e-01   +4.887750639025286e-01   -1.533083131557571e-01   -4.856748113292512e-01   +1.546030705392374e-01   -9.044399035189825e-02; +2.782752228620085e-03   +2.997805393637523e-01   -2.593658936052741e-01   -3.734667412892877e-02   +2.752026608801344e-01   +2.738010001016312e-01   +9.214106178765676e-02   -7.166270315335008e-02   +5.387281022605107e-02   +1.538262340157271e-01   -3.449566863962616e-01   -8.451722425408577e-02   +2.815864513826726e-01   +3.362396321386375e-01   -1.593588301571798e-01   +1.240764755877644e-02; -5.318305886243596e-01   -3.819060116070000e-01   +1.454849186234205e-02   +8.064199389482325e-02   -3.227937579270141e-01   -5.422117047926359e-01   -1.801820306043922e-01   +1.464579639155437e-01   -3.371809498202730e-02   -2.636017409249797e-01   -8.727337943894080e-02   -7.524834663007809e-01   +1.081480496019908e-01   -4.502683781330351e-01   +7.947069206365653e-02   -5.003737735487984e-01; +6.527829975078737e-01   -4.888223832673377e-01   -4.020334043553715e-01   -3.522734970692479e-01   -1.103595228467355e-01   +5.428117596633916e-02   -2.604453775544107e-01   +2.652111980621423e-01   -2.328609431734765e-01   -1.018192580741004e-01   -4.590701495809222e-01   +1.901612285458692e-01   +1.441996978672185e-01   +3.180357217817638e-01   -1.083823132150798e-01   -4.493585244448741e-01; +4.928458115318596e-01   +2.338604372787007e-01   -1.757878658899102e-01   -4.562890378009782e-01   +2.971264095454953e-01   +2.851898682186679e-01   +2.208976630383913e-01   -8.030611976208392e-02   -9.018560408830744e-03   -9.091411780979065e-02   -2.253663323277802e-01   -9.199834356140718e-02   -1.944822282090488e-01   -4.874428196624162e-02   +5.524544613877704e-01   +2.081702980106839e-01; -1.034388104195294e-01   -1.000000000000000e+00   +2.931490638394190e-01   +2.229254823145247e-01   -1.634265061007681e-01   +4.310650280269019e-01   -1.987766761013359e-02   +1.465972561157046e-01   +3.054966444708677e-01   -4.948393928389311e-01   +3.484478906517384e-01   -1.695662012057793e-01   +2.899418221223150e-01   -2.012524887227453e-01   -1.179568857625386e-01   +4.034953798900534e-01; +1.275398399905789e-02   +5.191207589339655e-01   -4.988583205488835e-01   +9.856458968363008e-02   +1.307581626945085e-01   +2.448574784254486e-02   +2.148210342069760e-01   +3.512616007351975e-01   -6.380223155148733e-01   -2.787441466076827e-02   -2.394736914015747e-02   -5.781568901382499e-01   +5.168347830826783e-01   +1.267768280657737e-01   -3.728195910100742e-01   -2.983310765648954e-01; +4.214274503868399e-01   +2.051856886662605e-01   +1.421610511807737e-01   +5.341234688869991e-02   -2.375984067860926e-01   -5.146379893779746e-01   -5.415978904625193e-02   -4.818581819110853e-01   +1.178807641826986e-01   -6.100887829507168e-02   +3.307271159069898e-01   -1.463612640553323e-01   +4.090438964250823e-02   -6.972457573668633e-03   -8.444457461283099e-02   +3.015754338090001e-02];
L2I_L2E_iAMPA_netcon = [-1.166966608703243e-01   +2.234353344011368e-01   -1.686352964748835e-01   +6.842904317128723e-03   -1.523898887321685e-01   +3.572579968961240e-01   -2.025129463671384e-01   -1.528102637888223e-02; -9.800834163351948e-01   -3.030769483303992e-01   +2.145753477924832e-02   -3.898837230056553e-01   +3.391600659970526e-01   -1.720490661133893e-01   -1.659577946074508e-01   +2.110073530249591e-01; +5.883167273238755e-01   -3.293996605089967e-01   +8.735503479804144e-02   -3.384432554247137e-01   -3.548878179503958e-01   -1.436905757247449e-01   -2.614447526723627e-01   -2.328204959701041e-01; +1.151434068888180e-03   +1.098897677073223e-01   -6.494081335265557e-02   -4.786695892662268e-01   -1.216561276252200e-01   -2.696573011824411e-01   -4.693120762226538e-01   +2.816531758833878e-01; +3.304170710202258e-01   +4.833299698150350e-01   +3.854297956059666e-01   +3.568523558719195e-01   +1.603063837592174e-01   -4.326862428047655e-01   -4.184332897280838e-01   +1.352938586814754e-01; +5.473640679765172e-01   +3.929242603662809e-01   -5.802771445661706e-02   -9.344910270944867e-02   -1.017637469924254e-03   -4.971099856592656e-01   +4.772696260617734e-01   -3.869234153189197e-01; +2.343921331472972e-01   -1.485193401908490e-02   -3.354911096407088e-01   +2.744628511434331e-01   +6.994805496895647e-01   +9.109553283862201e-02   +1.943519951047360e-01   -2.534513609642842e-01; +2.344509160538941e-02   -5.358005211359320e-01   -1.891580736128718e-02   -4.093566313343048e-01   +2.988755544237328e-01   -4.113842286157383e-01   +6.830584024179537e-02   -1.065197703104126e-01];
L2E_L2I_iGABA_netcon = [+5.178442307588902e-01   -9.464101176184094e-01   -3.917436512965428e-01   -5.490208600489985e-02   +2.726212450639556e-01   -2.714772480001351e-01   -2.298140893114695e-01   -1.397325060704050e-01; -2.438586366926183e-01   +3.079381299572320e-01   +2.507696671488427e-01   +9.304173516658379e-02   +1.488701389217004e-01   -1.136369555741979e-01   -3.878583058567130e-01   +7.367390976458119e-02; -1.411280405420663e-01   +1.109284391745752e-01   +2.339308576335104e-01   +9.347029355253851e-01   +2.563914197166567e-01   -4.516238598544247e-01   -1.859787364901344e-01   +1.323729595470905e-01; -2.454705142179052e-01   -7.359031878814967e-02   +9.311087974650677e-02   -2.189490818081387e-01   +2.690468223964266e-01   -3.250863689985187e-01   +3.656005901664175e-01   +8.312791875767922e-02; +5.186589451465775e-01   -4.309106191984582e-02   +5.967104815198414e-01   +6.396978920983341e-01   -4.550477632366436e-01   -7.687252863009661e-01   +9.017459510821117e-02   -2.052106837322203e-01; +2.658424094748598e-01   -1.486012440127712e-01   +3.991608756866171e-01   +7.463529437346906e-01   +1.833098511638930e-01   -8.942488098980161e-02   -3.719165269295101e-01   +2.629358763267996e-01; +6.612223213202029e-01   +4.375278216358981e-01   -1.859734372963376e-01   +4.545981388476798e-02   -4.180891938499424e-01   -1.470674559010198e-01   +1.995874688317847e-01   -3.472922721598539e-01; +2.503690618052724e-01   +3.064651140601299e-01   -6.185284738278922e-01   -4.498685626279860e-01   +1.942183703567646e-01   +1.525918943260685e-01   +1.657681445664274e-01   -8.463138619117001e-01];
L3E_L2E_iAMPA_netcon = [+6.066508356179444e-02   +2.002532583212417e-01   -1.022901774410981e-01   +3.209650298576205e-02   +4.895604563347474e-01   -5.265864212227396e-01   +2.165468047326212e-01   -3.799011954583797e-01   -3.047962300478506e-01   +1.479786554928520e-01   +1.428122231874100e-01   +4.320225467201246e-02; +6.679934190655765e-01   +3.957897298581390e-01   +5.746497095985039e-01   -9.110400335841176e-02   -3.052643972052305e-02   -2.206689396689929e-01   -5.666771868871721e-01   -4.841111451614351e-01   +2.691256890307686e-02   -1.794048643061097e-01   -2.860298956065163e-01   -1.274217439610359e-02; -1.819089110880248e-01   -5.675267581502894e-01   -4.691413721088078e-01   -8.565913697892920e-02   -8.662649142550052e-02   +2.010691373862623e-01   +3.423873603461184e-01   +1.837827794811123e-01   -5.343771570357817e-01   -8.492897096323396e-02   -1.672000330254455e-01   +4.936730504415407e-02; -2.092116289337842e-01   -6.912938162742437e-01   -1.092843091253864e-02   +2.161016561073067e-01   +4.118660347922912e-01   +2.506887863041138e-01   +3.887830736166519e-01   -4.005676845094298e-01   +4.774299750371740e-03   -5.566233237884533e-01   -1.245320958406740e-01   -1.829962241408566e-01; -9.976967632525313e-02   +1.184569150858024e-01   -4.233411112034308e-02   -6.740084586985243e-02   +3.556866820712948e-02   +1.703412579067007e-01   -3.111706549530609e-01   -1.158657967361165e-01   -1.072140313441821e-01   +1.318705846031168e-01   -4.274641559286538e-01   -4.944348940691559e-01; +7.154252078972897e-01   -5.457633312925989e-02   +1.588368694019501e-01   +3.601076405823236e-01   -9.647108865722398e-04   -6.437290455804205e-01   -1.161955675131919e-01   -3.399623790541176e-02   -1.820710572604194e-01   +4.331828052098866e-01   -2.315397947733178e-01   -9.611840635952093e-02; -3.904325622394076e-01   -7.149677410590749e-01   -6.234083654355521e-02   -4.772457860749675e-01   -2.931443192504946e-01   -2.158241026364555e-01   +1.072075730918539e-01   +1.136575726800106e-02   -7.666615239428382e-03   +1.457223243300380e-01   -3.024456299050665e-02   -4.666053765376439e-01; -4.320758447631612e-01   -1.030134959764401e-01   +2.590068008550697e-01   +5.182584509429019e-01   -1.821621683605502e-01   +3.454175186229516e-01   +4.903214768895265e-01   -2.383335325431999e-01   -3.041553816568962e-01   +1.195406072136943e-01   +3.129676382295983e-01   +3.793822347820489e-02];
L3I_L2I_iGABA_netcon = [-6.140106984196511e-01   -2.466641080396863e-01   +1.766279726463334e-01   +1.526794746122487e-02   +3.111242999735515e-01   +8.850163020822049e-02   +2.286524400284844e-01   +2.425683648276147e-01   +6.763270421349481e-01   +9.421501074371924e-02   +2.937708460617930e-01   -1.397929563366749e-01; -3.171842281787493e-01   -1.493605178615533e-01   -7.777467103952127e-01   -4.946290944528167e-01   +7.863915348603570e-01   -5.672103569619158e-01   -3.876339724402715e-01   -4.802220170239541e-01   -1.986174572751782e-01   -3.934825918761733e-01   +6.825624603461389e-02   -5.553841856249253e-02; +4.885221997804472e-01   +2.128409124689383e-01   +9.250719142921987e-02   -1.865084671957702e-01   +8.030316056553601e-02   +6.688715452832791e-01   +4.016429530229020e-01   +8.080801823101422e-01   -3.655064591753868e-02   +4.257476934212752e-01   -6.839600945911604e-01   +6.476692412957821e-02; -3.584951163031149e-01   +3.215788912347046e-01   -6.892034696972889e-01   +8.275994605022505e-02   +7.209514410086793e-01   +4.619217242892213e-01   -3.233119954980170e-01   -6.532222422107427e-02   +4.452924049071947e-01   -3.916080245326279e-01   -6.190145171455741e-01   +2.229238875642651e-01; -5.779233154097183e-01   +2.014219145876415e-01   -3.803113926962449e-01   +3.633966153532038e-01   +2.641255297762224e-01   +1.104786335364004e-01   -3.870326525982520e-01   +3.277903919737042e-01   -1.361303652983603e-02   -7.865822046348121e-01   -1.598290903900014e-01   +5.667722695588375e-01; -1.759532499062717e-01   +7.925639438320663e-02   +5.776622876367553e-01   -5.405720591720912e-01   -4.464242927007998e-02   -7.885163892821537e-02   -4.061413015010062e-01   +5.013261112793426e-01   +6.218367103411118e-02   -6.234112030476855e-01   -8.322958470201358e-02   +8.167161348247224e-01; -5.752646720208473e-01   -2.316009138825818e-02   -3.970236660506688e-01   -4.521320784738315e-01   +1.003084297835664e-01   +1.664962268872313e-01   +3.708355793201547e-01   +1.951916693267484e-01   -5.716279904918409e-03   -2.305695489006931e-01   +3.223223346167208e-01   -1.300204266811482e-01; +5.197189805438354e-01   -3.249660412361445e-01   +4.977364217658611e-02   +3.377917025674994e-01   +3.718149020201676e-01   +3.237113003062904e-01   -1.470090237975556e-01   -2.016622989323730e-01   -1.425345776179687e-01   +7.153315996079158e-02   +5.513728094063767e-01   +2.789107032078541e-01];
L2E_L3E_iAMPA_netcon = [-9.027994432106158e-02   +8.572838607700640e-01   -1.259263301634594e-01   +6.814135184034912e-01   -5.892764402522106e-02   -1.380381240911821e-01   +6.270446333653718e-02   +2.451396123722699e-02; +2.602859971793950e-01   +3.128788604845925e-01   +1.322673615192595e-01   +2.427388091358795e-01   +3.337920068722275e-01   +1.557012463086535e-01   +5.954839280925782e-01   +3.656648676275903e-01; -1.754223432467590e-01   -3.985274632429341e-02   -2.500226594682618e-01   +9.031296027178701e-02   +1.041017044540775e-01   +5.626497352628750e-01   -5.719206796994277e-01   +2.333046718902466e-01; -4.521706571089110e-01   +6.142306403183655e-01   -1.367558787330857e-01   +1.251851713243536e-01   -4.684908072211196e-01   -4.898464527259129e-01   -1.467189720659016e-01   +8.109080044628661e-01; -4.705224011563364e-01   -6.042628280478549e-01   +7.679185654496076e-01   +2.727493300103396e-01   -1.697623662637409e-01   +4.234413833136043e-01   +5.549553615386664e-01   +2.035484893530118e-01; -6.295124089558908e-01   +6.031534020210674e-01   +4.825968110946826e-01   -3.623538668562517e-01   +5.941965961533101e-02   +2.670152554717627e-01   -1.083011766224626e-01   +1.880443137421441e-02; +4.569527655669037e-02   -3.068906794947485e-01   +1.924877923446941e-01   +7.145878520060760e-01   -7.035698101087986e-01   -4.505920753251097e-02   -1.765134823042326e-01   +2.103693207437264e-01; -6.529986776141257e-01   +4.286429353107741e-01   +2.525033717100689e-01   +3.660999084376528e-01   +3.438959966849805e-01   +9.230697099252416e-02   +6.105435781376528e-02   -1.109208529876626e-01; -1.965028429723369e-01   +6.851820812477607e-01   +2.563158397299184e-01   -8.234364916101972e-02   -3.807872222489711e-01   +3.102237968761465e-01   -3.978826017471341e-01   -8.259263779235776e-02; +2.087040520338615e-02   -6.774948018610404e-02   +2.549556922421372e-01   +4.929150677720837e-01   +3.926527236345015e-01   -6.075588344164269e-01   -9.884216606900374e-02   -7.171106608456554e-01; +6.178254254627695e-01   -2.392101789659220e-01   -2.047975577928873e-02   -1.085625321854746e-01   +4.431342069878745e-01   +4.300570374863904e-01   +5.578539809975067e-01   +4.723784829990486e-01; -7.192215053224185e-02   -3.238792338739171e-01   -2.565193663824237e-01   +7.402362743251816e-01   -3.062204723169680e-01   +3.553452921118949e-01   -4.533222386837713e-01   -1.325899842015812e-01];
L2I_L3I_iGABA_netcon = [-2.353073810701165e-01   +2.335918848688009e-02   +1.979831314884294e-01   +1.295545392738331e-01   +3.632591495167526e-01   -4.486427529460257e-01   -2.101188200619069e-01   +1.275538733657854e-01; -6.470582992027759e-01   -1.480684576767330e-01   +2.480180253691651e-01   -1.640324142346157e-01   -1.382286089116079e-03   +4.320600021393142e-01   +2.532616685193910e-03   -4.798748453623651e-01; +2.573611701945745e-02   -4.847286668310073e-02   -7.298272429053870e-02   -6.349691057214529e-01   -2.671222606981073e-01   +1.280789453611203e-01   -5.056204945016969e-01   -1.256911555763171e-01; +6.782063139502532e-02   +2.115168173122771e-01   -8.748801969941949e-02   -3.763816320668758e-01   +3.106770039313109e-01   +4.935462169596262e-01   +1.744746608321174e-01   -1.380289262399158e-01; +4.287656830268902e-01   +9.029485995242652e-02   +8.467603861403218e-02   +5.307865162240075e-02   +4.918398301536197e-01   +7.829116321772053e-02   +1.008005393489053e-01   +4.591484130099166e-01; -2.110278701923429e-01   +2.848906790677396e-01   -3.769288147917568e-01   +2.063073862274894e-01   -1.603684271318863e-01   +6.596622808304086e-01   -1.253516634205831e-02   +7.188341804757742e-02; -4.374644375894702e-01   -2.982994569842410e-01   +1.397250654292124e-01   -1.689806990268439e-01   +4.806980533828751e-01   -2.011848690839055e-01   +1.973208095859700e-01   -5.613121289354131e-02; -2.816372878268258e-01   +3.154839203908823e-01   +3.410698317570351e-01   +1.393779229762014e-01   -7.417633189197532e-01   +7.872851336970605e-01   +2.451879906152318e-02   -7.245598893960525e-02; +5.421693935950597e-02   -9.302780595082587e-02   +2.697691025603872e-01   +1.530750803769321e-01   -2.996852022248979e-01   -2.559445235435046e-01   +2.107187124876915e-01   -3.076472422182698e-02; +4.792148812965483e-02   +3.625848524175278e-01   +1.337607193962132e-01   +1.386199824011154e-01   -1.467935751267258e-01   +3.030514395768935e-01   +1.093263086222937e-01   +1.802010917480220e-01; +4.040434425145645e-01   +7.252579104136067e-02   +1.169842904218575e-01   -1.761125639801868e-01   -8.714346536583566e-02   -1.071775264777307e-01   -4.184560985151283e-01   +2.570034202581034e-01; -1.253014284643393e-01   -3.075501558366489e-01   -2.039385012473478e-01   -7.533013824120797e-01   +3.388477410268971e-01   +1.159357336158490e-01   -1.180667428862997e-01   -5.531644293007965e-02];
L3I_L3E_iAMPA_netcon = [+4.915380188608502e-01   -3.876074380145607e-01   -4.027600320673111e-01   -2.649417956022598e-02   +1.531209610454117e-01   +5.666191537492701e-01   -1.728670230929315e-01   -3.668548638200911e-01   +3.057861461892208e-01   +2.684874923819373e-01   +4.195572603713086e-01   -4.051901283762539e-01; +2.785727022346585e-01   +6.382111557762516e-01   +6.041398711290058e-04   +2.935524301841150e-01   -1.022896486115700e-01   -5.271662519975992e-02   -1.724589093972647e-01   +1.533690125536235e-01   -6.460559763851821e-01   -3.374064416809727e-01   +1.762806807024527e-01   +6.239820279617408e-02; -2.076902401223426e-01   -1.923361433981224e-01   +3.618642132005418e-01   +3.972545007636401e-01   +3.590790869762288e-01   -7.097645182861917e-02   -1.673960194824112e-02   +1.254421440370518e-01   +1.342146909855909e-01   -1.246227616241062e-01   +3.042696796405148e-02   +5.658034904848749e-02; -1.237595955673632e-01   -1.230317497417783e-01   +2.081072783475232e-01   +2.758469949223150e-02   -2.815960453040552e-01   +2.259778186354210e-01   +3.096386106133431e-01   -1.575805610180224e-01   +5.950141847992133e-02   -2.968432039348112e-01   +6.970108523550227e-01   -1.114918180352245e-01; +2.753078765203931e-01   -1.763374511732982e-01   +1.147990824972205e-01   -2.892688608387624e-01   +4.351019367621548e-01   +5.343756502059156e-01   +3.726275987799761e-01   +5.720328539116819e-01   -7.159362672586997e-02   -1.416574388727192e-02   +3.810693916227917e-01   +4.210222437347709e-01; -8.292384223687130e-02   -4.415577284832441e-01   -4.487831976122040e-01   -2.591085429825297e-01   -5.152995924100425e-01   -3.590276317639930e-01   +3.736543091454074e-01   -5.385356165161553e-01   +8.030178344849061e-02   +1.101091106401231e-01   +5.283607974920522e-01   -2.938929878833585e-01; -2.335897385854653e-01   +1.303408583541568e-01   -9.935733656924638e-02   +3.059765297306215e-01   +3.765738654227778e-01   -3.039634101988570e-01   -1.158633771991062e-01   +1.897740897537587e-01   -3.958058037518050e-01   -1.252984384637861e-01   -2.316577955470330e-01   +3.202591156643909e-01; +3.593403532018657e-01   -3.990671014813418e-01   -1.687471163669695e-01   -5.111862606221357e-01   +4.458309469091366e-01   +5.395235977050288e-02   -1.814105395566951e-01   -5.748313331871727e-01   +6.030335307344372e-01   +3.154865932815839e-01   -2.879410583174854e-01   +5.981738285670581e-01; -4.712780400518410e-01   +2.273964819573706e-01   +3.466483313279622e-01   +2.517073050701804e-02   -8.419023137840420e-02   -7.199876611452424e-01   +4.046999891292821e-01   -3.353844518304105e-01   -9.789093249021952e-02   -1.202060125509333e-01   -1.319314678137105e-01   +2.984782328568293e-01; +9.359301308835805e-02   -4.993322745697523e-01   +2.562550029345881e-01   -1.899481649155175e-01   +7.638428776327458e-01   +7.280797165071100e-01   -2.326247781412129e-01   +9.557743275492996e-01   -5.619717469995071e-01   +1.042140752934574e-01   +7.175110670475293e-01   +1.519981632946633e-01; +8.181521796088170e-02   -5.862664318394870e-01   -1.285416822990034e-01   -1.238121093733523e-01   -1.071136276958373e-01   +7.051225131275447e-02   +2.964474580429918e-01   -2.939937076607871e-01   -6.699647160790942e-02   -1.482138560228801e-01   -3.391058542635825e-01   -1.373450855158293e-01; -4.878259343448857e-01   +3.920341482673106e-02   +3.627822009358099e-01   -2.058712933688230e-01   -1.301650092978600e-01   -1.063087468267756e-01   +6.639640283889034e-01   -2.696983987650753e-04   -3.427693679154988e-01   +1.837208256632768e-02   -1.550034481402167e-01   -2.579578253362072e-02];
L3E_L3I_iGABA_netcon = [+2.393244276440075e-01   -4.828704734971012e-01   -6.211898134047933e-03   +3.427233587813159e-01   +1.816409616892901e-01   +4.040179197081806e-01   +2.565098710343466e-03   -3.175838466162572e-01   +1.104187183566673e-01   -1.761926313496039e-01   -1.301149682340646e-01   -3.451722278995705e-01; +1.989358476196987e-01   +1.535421354307834e-01   -4.211527379219324e-01   -5.746931321798483e-01   +4.358603261561562e-01   -7.725380116721930e-01   +1.176779880686598e-01   -1.002571351559969e-01   -7.854642239502243e-01   +1.694245994141012e-01   +2.514127657519311e-01   -1.966848042360786e-01; -5.911498997365134e-01   -4.143804057058792e-01   +3.071657026992267e-02   -1.463214795361665e-01   -3.798543492755959e-01   -2.561481462504021e-01   +1.636116411996180e-01   -4.628092856018635e-02   -5.154457140859652e-01   +3.619491472951513e-01   -1.544555269780282e-02   +5.636106242325982e-01; +1.313409932006662e-01   -3.213102313061704e-01   -2.482089562654475e-01   -1.449202056995905e-01   +3.625448228707311e-01   +2.178592648236657e-01   -4.335162670894454e-01   -5.277579710048982e-02   +1.002285440882339e-01   -3.494282134284705e-01   -3.219322513518263e-01   +5.413396749220022e-01; -3.680592293812464e-01   +4.209523016588539e-01   -2.778324736041642e-01   -4.049206914770779e-02   +4.823905413000654e-01   -5.647817409253119e-01   +3.190566630889856e-01   +5.360591205038525e-01   -2.959580118922827e-01   +4.316518274625420e-01   +1.041035555409913e-01   +2.607923541845159e-01; +1.491966961707384e-01   +7.434804230191800e-01   -5.873057820745803e-01   -1.951121728349864e-01   -1.370000003704964e-01   +7.571061138507850e-01   +4.707227729035622e-01   -2.768279966849518e-01   -1.714183874548934e-01   -1.213870536070377e-01   +4.014134018149078e-01   -1.275177940761937e-01; +1.522900791761537e-01   -7.337719014994171e-02   -1.813365074214203e-01   -2.108226526349858e-01   -4.596427214235984e-01   +1.105134447044599e-01   +4.765197882103633e-02   -3.143455502505861e-01   +2.915959834197336e-01   +3.776646440022185e-01   +4.630115152760246e-01   -3.862687249696163e-01; +2.455979970701711e-01   +6.399168347424908e-01   +5.597029323312969e-01   +3.797449404509828e-01   -3.597474112685918e-02   +4.794477221098008e-01   +7.712779835410731e-01   +2.218004918028796e-01   +1.560741340920069e-01   -3.708316952225825e-01   -2.904482287536275e-01   -1.916640781645165e-02; -2.002888439921630e-01   +3.692410272967868e-01   -2.727288101775108e-01   -3.313469992617760e-01   -3.050603969084225e-01   +1.958613092715574e-01   -3.554598391700223e-01   -2.626468820348297e-01   +1.597496825021995e-01   +6.884572627664734e-02   +6.247057131297530e-01   -2.013246917320248e-01; +1.102252386222358e-01   -2.643060760483223e-01   +1.695125019896636e-01   +1.257532266996434e-01   -2.847086741036123e-01   -8.204008616469653e-02   +4.821128922671196e-01   +2.642026045629911e-01   +1.590257485334364e-01   -8.917767938857492e-02   +2.549073165136655e-01   -5.175218003464001e-01; -9.632275982351060e-02   +1.127639488590986e-01   +6.613712241477674e-01   +7.991910541769714e-01   -3.467360425903175e-01   -1.829455393048907e-02   -1.529718799278811e-02   +2.160593097028631e-01   +5.396962087254792e-01   -1.138247118669047e-02   +4.489078311710827e-01   -6.918397878217022e-02; -3.320732691818568e-01   +4.447359960341268e-01   -1.013214652524164e-02   -6.743104120106985e-01   +2.055075889062811e-01   -3.983127875809128e-01   -3.312499501771017e-01   -5.740692713999858e-01   -4.070609831457098e-01   +7.328649325165776e-02   +1.351765198589258e-02   -1.022240061034986e-01];
L2E_Input1_iAMPA_netcon = [-1.625154002134422e-01   +3.855779545655023e-01   +5.675172978353018e-01   -4.604193492256887e-01   -1.784827409450281e-02   +1.087491767740284e-01   -4.725008316043747e-01   -2.800392043661187e-02];
L2I_Input2_iAMPA_netcon = [+2.404973626424097e-01   -5.750055219135378e-01   +3.850390421220108e-01   -6.163328160356956e-01   +2.872616929669608e-01   -4.356834927238217e-01   -1.743853748021737e-01   +7.252437339613147e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
