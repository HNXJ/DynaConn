function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-4.966621175814248e-01   +3.815344116271299e-02   +1.029639283186742e-01   +1.322330812297840e-01   +1.146987695117564e-01   -3.156849515734128e-01   -2.108678705633417e-01   -2.885043123833087e-01   -4.544518962357350e-01   -2.139564279995003e-01   +1.929817140841222e-01   +2.312860467821339e-01   -2.937349970148579e-01   -4.749485623627590e-01   +3.547438254887444e-01   -4.080200925490671e-01; +2.419235798395299e-01   +1.476963701389207e-01   +6.091150233398934e-01   -4.307878355592820e-01   +1.306276227137208e-01   -1.490030218344873e-02   -1.934723814625519e-01   +3.856627550101085e-01   +2.493760831509739e-01   +3.659163856701623e-02   -5.497496080562717e-03   -2.805782305365609e-01   +1.865731928942628e-01   -5.123476366876817e-02   -3.398174397033599e-02   +1.539633995362755e-01; +3.885952941921856e-01   -3.913765122486481e-01   -1.237138403378284e-01   +1.373130464975746e-02   +3.733341189341680e-01   +5.257090147376973e-01   -1.052024282786686e-01   -1.336239754622336e-01   +1.470240835022446e-01   -2.036472296545081e-01   +6.894495964382674e-02   +2.094729814352631e-01   -1.001941877818469e-01   +3.689166751194971e-01   +3.158379010888328e-01   -2.958705900432708e-01; -7.453505780803307e-02   -2.403725015828465e-01   +1.707591715813326e-01   -1.897345125248487e-01   -3.865878605315685e-02   +3.689287103594927e-01   +2.309644958128193e-01   +2.046741455491756e-01   +9.654343022786213e-02   +1.574258758181338e-01   -2.675502966017831e-01   -5.267516161467728e-01   +3.770485760733218e-01   +6.241747947916666e-02   -4.496478504024989e-02   +4.375965320276168e-01; -1.895013462769680e-01   -1.409120889185182e-01   +1.005835599752601e-01   +5.764544275893393e-01   -3.867997945013532e-02   +3.646562722362630e-01   -1.793161204363439e-01   -2.486683433480963e-01   +1.914016987101984e-01   +1.019067196294968e-01   -5.400447563059788e-02   -2.919621558600312e-01   -1.832890978652456e-01   +1.796035786095558e-01   -6.419902619604023e-02   -2.722781963800724e-01; -9.332422860901418e-02   +3.358215050824992e-01   -1.243481949608665e-01   +7.789687938815218e-02   -2.782098965195591e-01   -5.786927093892094e-02   +1.175531400541116e-01   -4.220181230772490e-01   +4.816297109941889e-02   -5.062337177499485e-02   -1.612994408950005e-01   +1.650996395810345e-01   -3.506193059073207e-01   -8.082711091908509e-02   +3.769237500722469e-01   -2.053777985252228e-01; -4.479973478178925e-02   +2.154328265643513e-01   +1.235136573856651e-01   +1.634879753202702e-01   +5.959649947946588e-02   +1.660198377138810e-01   -1.278720623849503e-01   +4.698946270678230e-02   -1.822852454309054e-01   -9.414241655461777e-02   -4.487686466661631e-01   -4.489470982986301e-01   +3.190111999424521e-01   +3.220594799316709e-01   -4.733536805837101e-01   +4.748942953177809e-02; -2.120735853822788e-01   +2.223451869771473e-01   +2.496455876740680e-01   +1.361965837971864e-01   -1.799807984363243e-01   +2.578169725030208e-01   +3.146662875253744e-01   -1.475551296199714e-01   -1.292302103969640e-01   +1.028365695273342e-01   -1.413699116606236e-01   +6.763166529094149e-02   +3.133601145510067e-01   +6.364744461220732e-02   +2.147421482239698e-01   +1.685525084730613e-01; +9.156705138397285e-02   +1.360696997899621e-01   +1.190303730883825e-01   -1.475385539743959e-01   +1.217992907775053e-02   +2.166659458003254e-01   +9.938917305788533e-02   +3.636600570473690e-01   -4.343733623561920e-02   -1.030203774944912e-01   -1.557580977990843e-01   +1.073883133687958e-02   +8.696653633245427e-02   -3.870050544231043e-01   +9.337966181198099e-02   -1.408336721825959e-01; -4.347233615713174e-02   +6.773541840449393e-02   -1.405485646858257e-01   +3.952076060854979e-01   +6.863143356158871e-02   -1.594522726478956e-01   +1.813166650237810e-03   -2.645434411383871e-01   +2.621498935019624e-01   +4.088645872776853e-02   +1.214138639569670e-01   -4.449521616515200e-01   +3.614922808006906e-01   +4.030496031382869e-01   -2.313455556718549e-01   -2.437867479560708e-01; -1.734551770659668e-01   +1.855926175682548e-01   -1.046759064562264e-01   -6.388155951449027e-02   +2.945085930031169e-01   -1.937837500584926e-01   -3.509766248177624e-01   +4.488042909644460e-02   +7.549902808103304e-02   +2.750200590772663e-02   +4.255750704628678e-01   -2.357475236905732e-01   -4.144262131360060e-02   +3.064359061937799e-02   -1.827737233278170e-01   -2.074712354951642e-01; -1.546020154976360e-01   -2.894943945894136e-01   +1.472495749324718e-01   -5.736461095489406e-03   -2.361073434977429e-01   -7.666287632885453e-02   +1.745815282593043e-01   -1.612248431725330e-01   +2.339053788615018e-01   -1.683073046751905e-01   +2.746093161543969e-01   -1.419276382724465e-01   +6.403596244321294e-02   -3.581178296657969e-01   -1.203541471172201e-01   -1.013527807494963e-01; +4.126972557918704e-01   -2.878892133228069e-01   +7.065156269888173e-01   +2.697212814102921e-01   -1.987531313122510e-01   +1.791879484857062e-01   +2.949095195788788e-01   +1.283573447130129e-01   -2.764749815930644e-01   -4.145730022381934e-01   -9.669654526646959e-02   +2.946661036368416e-01   -3.670469315928881e-01   -2.346376812384479e-01   -9.829988152787551e-02   +1.566517392225652e-01; -4.144559357963286e-01   +2.116208982498295e-01   +1.228215347492236e-01   -3.530683956684870e-01   +2.038028106859161e-01   -1.570689895769729e-01   +1.672103480211138e-01   +1.670218253607588e-01   +2.723496018231610e-01   +2.235992194544184e-01   -1.823101806095822e-01   +1.876088069637857e-01   +1.034283900943581e-01   +2.468638128363099e-01   -2.360167674808139e-01   +3.411536912283035e-01; -1.331678141563430e-01   +1.023740699280237e-02   +6.699772611600595e-02   -2.652105073662080e-01   +3.716292993541848e-02   -5.338373951869807e-02   +2.337835542894741e-01   +2.767571568091455e-01   -3.827225720284595e-01   -2.061506411945749e-01   -2.953298889882419e-01   -6.439683076155234e-02   -4.477644253043408e-01   +1.150924833132584e-01   -1.200400369729532e-02   +3.946239110744219e-01; +1.403617166102768e-01   -3.091192704277563e-01   -7.528857981624312e-02   -2.213305564070463e-01   -3.819864467946683e-01   +2.564166851834541e-01   +1.147390866878869e-01   +1.549347893955183e-01   +1.444968991529511e-02   +3.850713069579661e-01   -2.598500890169644e-01   +3.794284600191942e-01   -1.995572367134043e-01   -4.579527204137565e-02   +1.533317622568774e-01   +1.746993099499092e-01];
L1E_L1I_iGABA_netcon = [-3.267091848189184e-01   -6.302132491393192e-02   -6.608490383770829e-02   -3.007291458817982e-01   +3.493934893234505e-01   -4.391907922602428e-02   +1.886243388434070e-01   -1.707020103391787e-01   -1.993853339539245e-01   -1.134359747796346e-01   -1.290339251512874e-01   -1.798376882338867e-01   -5.480837339210513e-02   +1.838149819013151e-01   -1.080163454337346e-01   +1.147822922583751e-01; -1.737781766577959e-01   -3.347872883428779e-02   -8.775809823416153e-02   -2.672629225988114e-01   -1.951034243084476e-02   +2.651268477382088e-01   +4.311281718280099e-01   +4.412624156416887e-01   -1.163927375167197e-01   -4.271101205268379e-02   +2.454535243929218e-02   -4.019445793916063e-01   -4.496330913890788e-01   +2.581873581231131e-01   -1.309726141461183e-01   -4.935240298642263e-01; -1.785743791782188e-01   -6.485734362193407e-02   -1.678475656529685e-01   -4.225720102037014e-02   -4.899971004448064e-02   +9.348143553969182e-02   -1.327661900027276e-01   -1.289441443159700e-01   -7.893657644876254e-02   +2.012897573536621e-03   +3.971797202177785e-01   -1.009230283307823e-01   +1.688035065715815e-01   +1.257532804741929e-01   -5.404390174707381e-02   +1.799062979056541e-01; +1.013418453684098e-01   -3.100172511163785e-01   +2.870653489363764e-01   +2.879458865903308e-01   -1.156855491973278e-01   -2.609340786039282e-01   +1.663832899186387e-01   -3.705018984174415e-01   +1.866634253510960e-02   +6.996169652582536e-02   +4.797032405132343e-01   -4.436379186597878e-01   +1.091424882572181e-01   -1.703781885541390e-01   +2.827871444047222e-01   +3.131715055013448e-01; -1.304327411919599e-01   -3.050539551688168e-01   +2.585530137191955e-01   +4.219221965355210e-01   -4.534566633712121e-03   +1.570958494400449e-01   +1.345649761360877e-01   +1.208827496915523e-01   -1.813362734216650e-01   -2.475179322657207e-01   +2.110533874799364e-01   -1.009565076250402e-01   -4.515639035218895e-01   +4.253211397449019e-01   -3.513458510816837e-02   -2.751700250516181e-01; +6.956671798820517e-02   -6.117864196479801e-02   -4.978586202378357e-01   -3.191132626726065e-01   +2.157519775430468e-01   -1.255065736286956e-01   +2.484622810538046e-01   +1.964187846166328e-01   +4.568030348920818e-01   -2.576471492413928e-01   -1.896492277783604e-01   +3.331683303521426e-01   +1.940717704948610e-01   +1.029229480569774e-01   +1.130318445587379e-01   +7.685822497568719e-02; -3.283332469388761e-02   +1.581896963627460e-01   -6.786298097723786e-02   -2.323942988472861e-01   +2.606561957686160e-01   -6.945410395488825e-02   -1.163956529331789e-01   +1.957729494916316e-02   +6.491280624515816e-03   +5.204285716863815e-01   -3.121140369592376e-01   -5.107955061498738e-01   +1.838748340026107e-01   -1.928303047730639e-01   -1.850846986089132e-01   +1.023584797038278e-02; -1.664190277371099e-01   +9.271284929506302e-02   +2.844683750893724e-01   +2.182449948900299e-01   -1.618594888807530e-01   -3.769079835602065e-02   -3.695728652421912e-01   +3.083380705790787e-03   +4.409685748080139e-02   +1.887817224756847e-01   +6.737013426777599e-04   +2.282378236743560e-02   -1.300482287449654e-01   +3.441914001123121e-01   +1.880168938698194e-01   +1.421265580692551e-01; +1.400870558305702e-01   -3.372734572109317e-01   -3.384313922184529e-01   -9.409006813350428e-02   +3.577023424961158e-01   -2.493197409514442e-01   -1.466937875775099e-01   +1.704428215087969e-01   -1.571454066753370e-01   +8.009474467395102e-02   +2.988447628290179e-01   -3.282065859978403e-01   -3.899386694712023e-01   +6.521681232985324e-02   +2.580837570690493e-01   +1.968411716288418e-01; -9.938791385984606e-02   -3.673134839049817e-01   -9.754740531044584e-02   +4.280106844984455e-01   +1.212530080204210e-01   +2.501774545154407e-01   -1.234391243981234e-01   +1.849420695601896e-01   -9.876767194425576e-02   -1.702719404791498e-01   -2.222629518140183e-01   -2.525772370421829e-01   +4.803390310654088e-01   -5.063564934955321e-01   +7.444947345480610e-03   -1.693170774039160e-01; -1.936386252530590e-01   -2.828124543512142e-01   +3.601858416178017e-01   +2.741376828182812e-01   +3.811174702366269e-01   -1.701174803852472e-01   +3.372256177729860e-01   -2.159913292486878e-01   -4.021396456168977e-01   -1.580652819884946e-01   -1.012188581248663e-01   -8.287617808748249e-02   -9.380267344034247e-02   +2.187005158797611e-01   -1.510008879074526e-01   +3.374209689171902e-01; +3.360198713352357e-01   +1.579419105451372e-01   +1.070601071703226e-01   -2.171092829706018e-01   -1.597167079143252e-01   -1.681164458185417e-01   -2.690247712598253e-01   +1.991536365116730e-01   +4.139653276164591e-01   -1.965135306736798e-01   -1.262125587104145e-02   -1.189403337967048e-01   +2.732685987741734e-01   +1.638738097855649e-01   -1.399273816974445e-01   -2.010516360131210e-01; +3.823894441052988e-02   -1.335322804175904e-01   -2.277373513987587e-01   +2.411535121389787e-01   -1.421536030096319e-01   -1.360471235196722e-01   -3.307379476371013e-01   +1.575965370153397e-01   +2.571169612359460e-01   -1.298240377559742e-02   +2.864926380169670e-02   +2.847215576563938e-02   -2.024669302640728e-01   -3.609170178091534e-01   -4.077390802500691e-01   +2.490569549364125e-01; -3.954220121636945e-01   -2.642418435207295e-01   +1.402954042609859e-01   -2.832214936432964e-01   +1.768904762826707e-01   -1.439859182664419e-01   -6.885160413672253e-02   +1.073669552095857e-01   -4.816936473968270e-01   -3.443100112634426e-01   -6.669507616262969e-02   +2.165753648089104e-01   +3.739966756052849e-01   +7.500467714584053e-02   -6.051339393604840e-02   +1.201452941952909e-01; -1.265538261612148e-01   -1.234661656358090e-01   +6.231342960349023e-02   +6.237358131195922e-02   +3.600865357134287e-01   +3.651452235522399e-01   +7.415910655485572e-02   -2.226997171941264e-01   +8.757822388061560e-02   +4.652825560892715e-02   -1.810076191060598e-01   -6.990418617713118e-02   +2.322146220628396e-01   -1.598404170969030e-01   -2.156272305969760e-01   +4.577059587862309e-02; -3.775895627088456e-01   +1.183487095064313e-01   +2.624966382066829e-03   -9.040702936658321e-02   +4.372422429910893e-01   +1.793674464854899e-01   +2.928656653595879e-02   +8.237271106640277e-03   +1.766087604463361e-01   -2.145793553767978e-01   -1.276615177404080e-01   +3.730215697423741e-01   +3.601885728201516e-01   -2.853211421758390e-01   -2.078272924256489e-01   -1.040821120994689e-01];
L2I_L1I_iGABA_netcon = [-2.280663620702675e-01   -2.791383078154062e-01   +5.860046337433518e-01   +1.128104886450229e-01   -4.586863022454757e-01   +2.978090133605467e-01   +2.588945121932471e-01   -2.402376304996187e-01; +1.537624905741710e-02   +2.328970951469615e-01   +5.371588696439420e-02   -1.204581515358569e-01   -3.954373914632128e-01   -1.077385966463988e-01   -5.156587495716296e-02   +7.423473138038372e-02; -1.814670836062048e-01   +7.337431761379887e-02   +4.500103691892965e-01   +6.799358635032247e-02   -1.594843442214499e-01   -3.268019071475204e-01   -3.070057240514351e-01   -2.397913032745898e-01; +1.255870082700312e-01   +4.233014551411444e-01   -2.157436432867076e-01   -1.124006932256786e-01   +1.133369895814626e-01   -2.600497167706224e-01   +6.132065704604849e-02   +6.347593287437883e-02; -2.470476541708039e-03   -4.205046836916075e-01   -1.362672170826290e-01   -1.981181575855420e-01   +1.255096345381976e-01   +2.415661549530962e-01   -4.653507755836524e-02   -2.203604863495151e-02; +5.056196719742891e-01   +6.832165161560422e-02   -3.277267692102138e-01   -2.914750674563530e-01   -2.706404003114514e-02   +3.187779534326318e-01   -6.852920729453341e-02   -1.817554996722220e-02; -2.791494098281809e-01   -3.722556748729355e-01   -1.368464372356412e-01   +2.302511943129156e-01   -1.632410981271461e-01   -1.648632447317725e-01   -2.477564813113200e-01   -1.593384904009438e-01; -1.692078048027067e-01   +1.035357404145343e-01   -2.185664362113414e-02   -4.656657224452868e-03   +1.605448040352944e-01   +1.354155809454415e-01   +1.638485401630569e-01   +4.759827090633176e-01; -2.047553050179055e-02   -3.662515522512089e-01   -1.838897366790777e-01   -2.056949320924369e-01   +1.030274859547066e-01   +1.973346846608114e-01   +1.503616979985731e-01   +1.420373258284573e-02; -2.329218457515592e-01   +1.133806734310394e-01   +5.328740975129290e-02   +2.188614993399145e-01   +2.680264303044352e-01   -5.666185143629404e-03   -9.406238582495181e-04   +1.380621006835598e-01; +1.276221180712324e-02   +4.295911334250399e-02   +1.780958496743256e-01   +1.807216167579374e-01   -1.128860898908396e-01   -1.207915023832712e-01   -2.417930872121835e-01   +8.051936930201173e-02; -1.625990980145007e-01   +1.591260723861629e-01   +3.351718758614720e-01   -1.175867154606723e-01   +2.415593507469880e-01   -2.945797877804933e-01   +4.103714225697772e-01   +3.089131712355238e-01; -8.056396147933872e-02   -1.773981184451869e-01   +2.944264946627940e-01   -5.334983007831343e-02   -2.353813457184638e-01   +1.533295383803477e-01   +2.393586734349260e-01   -1.859672423260363e-01; +7.169325169766182e-02   -2.089793265284138e-01   -1.583756356939410e-01   +4.728951533959986e-01   -6.596532092571822e-02   +3.937173566155500e-02   +2.690597359673225e-03   -2.624539379650425e-01; +9.775061406641061e-02   +2.126545636094439e-01   +3.561385935894769e-01   +4.228800777430735e-01   +3.797441485978235e-01   +4.438492720559106e-02   +2.388612533490346e-01   -1.608243155873284e-02; +3.810297047334868e-01   -3.116685806629607e-01   +2.403565112346283e-01   +1.378461128942449e-02   +2.785940132654795e-01   +7.338596158959571e-03   -1.439774684364631e-02   +6.623753126961253e-02];
L1I_L2I_iGABA_netcon = [-1.562582897322334e-01   -2.976071512634549e-01   -6.051334411253452e-02   +1.903244138938550e-01   +8.688844877215053e-02   +3.946413161256245e-01   +2.725125632864484e-02   +4.614626494294743e-01   -2.502670217560658e-01   +8.412747960209854e-02   +6.697257325577764e-03   +2.197857541456649e-01   -2.227932366971683e-01   -1.935891026405676e-01   -1.076253321565279e-01   -1.000943240770061e-01; -1.842526409827043e-01   +3.925705135567911e-01   -2.862563455315957e-01   -2.843656747625455e-01   +2.217810609494891e-02   -2.119279484995480e-01   -4.368088306905729e-01   +9.200714013233874e-02   -1.605582914205180e-01   -4.392682511000142e-01   -1.918627269679770e-01   +1.453897391398252e-01   -2.007205520794463e-01   +7.463397138465148e-02   +8.261925309616283e-02   -2.065088596380518e-01; +1.433833351646517e-01   +1.494700782614828e-01   -3.565417026745977e-01   +6.888371032825155e-02   +4.823134932227718e-01   -6.535802666744139e-02   +3.246340294782972e-01   -2.538115759226020e-01   +1.263155820523448e-01   +7.178147145254336e-02   -1.683881692981569e-01   -3.117350463297787e-01   +3.211509822604108e-01   -4.485913427299171e-01   +3.357581303633748e-01   -2.673249687797661e-01; -5.616252757442053e-02   -2.805769652199942e-01   -4.177713022652661e-02   +1.911988545635056e-01   +3.843674133648707e-02   -8.647203250589985e-02   -2.474243645304616e-03   +1.316428614554773e-01   +5.120740716557700e-02   -3.894339808406169e-01   -1.185116781813457e-01   +1.021096410906813e-01   +9.907030945710175e-02   +2.976131059483536e-02   -1.508107645385362e-01   +1.503604929370441e-01; +2.640494101836434e-01   -2.384373979552645e-01   +4.051282993301845e-01   +1.436665049648494e-01   +2.489416820940707e-02   +1.235637938136100e-02   -1.857157878728929e-01   +3.022041788927515e-01   +2.493644603709861e-01   +2.700018717236889e-01   +1.309302686886801e-01   +4.213007304529438e-01   -6.230618751764413e-02   -1.182263538679835e-01   -4.251589235642666e-02   +7.597513186624502e-03; +1.639591251233890e-01   -1.482483097971625e-01   +2.778770663875314e-01   +3.347334833267337e-02   +4.594839196112323e-02   +4.302395238876508e-02   +1.854637487134538e-02   -3.294276592339221e-01   -2.067000394469614e-01   +1.817279317695172e-01   +1.229771206513806e-01   -2.965100403309668e-01   +3.990024159432614e-01   +6.625806999568290e-02   -2.588179565674825e-02   +2.543185709296772e-01; -2.154952493273107e-01   +5.005084992125704e-02   +1.872532051994721e-02   -3.004801390483156e-01   -2.611831199688115e-01   -1.312498778653563e-01   -1.632864283657057e-01   -4.651660748429647e-02   -2.962232364199909e-01   +1.917406274056854e-01   +3.728378240583835e-01   +1.215653326098037e-01   +1.127681322074810e-01   -1.308801378288570e-01   +2.169181832173612e-01   +2.218691872323853e-01; -5.025362051179647e-01   +4.615030341672943e-02   +7.653307379244167e-02   +3.918013715544808e-01   +8.501927982459964e-02   -6.086575289575291e-03   +3.387027883214259e-02   +1.374197110142775e-02   -8.364230419737270e-02   -2.492031751174728e-01   -2.022682849539448e-01   +2.272987477370590e-01   -4.178181955604251e-01   -2.354478811950824e-01   +1.613566636697255e-01   +1.204667626303934e-01];
L2E_L1E_iAMPA_netcon = [+8.988086701475025e-02   +3.339576095840264e-01   +3.003365001513994e-01   -2.510848301826528e-01   +7.175246819947660e-02   -1.889134045424294e-01   -1.109643158034454e-01   -1.245645312627688e-01; +3.048555653203847e-01   -1.092745259929026e-01   -4.097044321882675e-01   +1.287728355168798e-01   +4.927399832876794e-03   +1.273672641134985e-01   -2.551040909938022e-01   +6.534330822334941e-03; +1.934008909460570e-01   -3.447004659814688e-01   +2.908760180165301e-01   +3.132337425031242e-01   +8.066087349965678e-02   -8.818568064528046e-02   +1.323550392103364e-01   +2.327906619584816e-02; +5.302570612985141e-04   -2.669302219512619e-01   -1.980590775874354e-01   +1.443088704382965e-01   +8.585232661668321e-02   -1.180961841368066e-01   +1.564200215165589e-01   +2.711511885133198e-02; +1.669090673283434e-01   +6.990263206670930e-02   -2.122865308760083e-02   +2.628038112747235e-01   -3.132602432373156e-01   +1.315791322593359e-01   +1.341292565301662e-01   -1.166681264042077e-01; -1.874492942427911e-02   -5.329215572587362e-02   +1.640108551409982e-01   +1.048891075617733e-01   +1.754956144989958e-01   +3.417546178985593e-01   -1.820249302136516e-01   +1.006520441220291e-01; +3.382686236418888e-01   -3.219583509284570e-01   -7.437652312341503e-02   +3.714517346201273e-01   +1.408293851366675e-01   -2.552582833426808e-01   -2.505805234346354e-01   +3.603915450042367e-01; -1.693442355266516e-01   +1.206033593884846e-01   -4.815578449366484e-02   +2.808530014011278e-01   +4.843244140364431e-01   +9.263262030773350e-02   -1.758977832765267e-02   -4.948265335675933e-02; -3.032851977172003e-01   -8.863681869749526e-02   -1.638453352124824e-01   -1.729517566836965e-01   +1.723658953240423e-01   +4.112175852242420e-01   -1.149560461614307e-01   -1.015383912417634e-01; -1.325867785785489e-02   -4.392601777256459e-02   +3.295567941943817e-01   +3.858674800206671e-01   -1.206189065046466e-01   +1.128964758515105e-01   -2.201492521479349e-01   +1.343705578369237e-01; -2.258548724486900e-01   +1.382933059377791e-01   +5.374410574812893e-01   -3.761929158967736e-01   -1.116753281816035e-01   -1.453634399952139e-01   -7.280257443481084e-03   +5.726764295512634e-02; +4.656806355138890e-03   -3.794937266649917e-02   -2.911913153762315e-01   -2.223188169441057e-01   -1.259299737244620e-01   -3.873051117348096e-01   +4.401913141818904e-01   +2.677382886817346e-01; -7.600772983593880e-02   -5.561753362596393e-01   +3.079074499977577e-01   +2.251715893524860e-01   +5.660197199122999e-02   +2.724194003880570e-02   -2.948458109709782e-01   -5.230382693979270e-02; -1.031126879504098e-01   +9.758325353360769e-02   -4.462075818136854e-01   +7.307230614590245e-03   -7.391077114763600e-02   +2.195454197428287e-01   +1.257449806909852e-01   +2.591971477322256e-01; -3.607737485318862e-01   +2.638375019727951e-01   +1.418173682191764e-01   +3.447206344872092e-01   -3.037563453047745e-03   +3.505553561552698e-01   +9.786814233329977e-02   -4.962993916239097e-02; -2.826570356326434e-01   -1.817498730754891e-01   -7.035518949404372e-03   -5.495550754805373e-03   -3.750554041497738e-01   +3.960753780932910e-01   -3.659632111656425e-01   -3.751437126250970e-01];
L1E_L2E_iAMPA_netcon = [-8.870910114822522e-02   +1.659947185890309e-01   +7.454754970505989e-03   -1.633554771147056e-01   +4.971993887126455e-01   -5.063643934644149e-02   +1.489069538559203e-01   -2.853788735464215e-01   +3.430506112674016e-01   +1.773007708706421e-01   -1.170865616835768e-01   +1.690210737742174e-01   +3.479034015103557e-01   +2.857334362448575e-01   +2.641159719903591e-01   -6.587899425182039e-02; -9.424525897575364e-03   -2.813719432719441e-01   +3.401256222146141e-01   +1.741591986760554e-01   -3.343868836563556e-02   +1.375877934778967e-01   -4.198347560814164e-01   +2.943824360042813e-01   -1.089903705632399e-01   -3.320587242176922e-01   -2.999783305982116e-01   +1.239436889823918e-01   +3.115136830256228e-01   -2.147058817496159e-01   +7.619935178931553e-02   -1.482787690199086e-01; -4.715074134355421e-02   -1.886387335828355e-01   +2.571411646841818e-01   -1.077737998347050e-01   -1.597785528719345e-01   -4.219080758058213e-03   -3.803023140042602e-01   -1.833460714466291e-01   +1.690166002982377e-01   +3.151907770616979e-02   +2.673005287364991e-01   -5.393540513722278e-02   +2.639286725191262e-01   +2.681098651344042e-01   +2.969531124218411e-02   -4.162879701066852e-03; -2.628562564499850e-01   -3.293320804289549e-01   +1.376417677217760e-01   -8.673342822428365e-02   +1.494234026253752e-01   -2.433597826378339e-01   +1.139361499913973e-01   +1.500524140660031e-02   +7.219042391950051e-02   +3.901353983258137e-01   -1.742215791038601e-01   +1.531416659836263e-03   +8.367468474004223e-02   +8.387639534802840e-02   +5.880985524058913e-02   +1.485292888517337e-01; -2.070489682392686e-01   -9.502255147409261e-02   -5.826797919394663e-02   -2.814223727724760e-02   +3.172401803269666e-01   +3.577832492788601e-01   +1.893381461177390e-01   -4.509425675904450e-01   +3.892730859000945e-01   -8.866623999652917e-02   -4.166639003248206e-01   -6.969342529646365e-02   +1.390001061744283e-01   +2.899265149145128e-01   -8.872517313081915e-02   -2.407886925673396e-02; -1.239047155824174e-02   -1.514256931338659e-01   -4.169644893459216e-02   +9.981427459271344e-03   -1.890507160327353e-01   -2.084128209262034e-01   +1.093793012753414e-01   -1.946270885956582e-01   -1.806346506839069e-01   +1.017507318683886e-01   -1.749227989284403e-01   -1.466951051292331e-01   +4.170804072178990e-01   -1.291208445621662e-01   +4.689491101382371e-01   +4.912889851810401e-01; +1.198813295271320e-01   -2.482379370187806e-01   -3.964358865417600e-01   +4.644547501956588e-01   +9.268583706968611e-02   -5.738222551420081e-01   +4.711268843341654e-02   -7.221551322204887e-02   +1.585445788205044e-01   +1.045131897098590e-01   +2.757925764231404e-01   +3.153004279105409e-01   -4.998423570736452e-01   -1.125130591859843e-01   +4.022991237351631e-01   +1.305753197278879e-01; +2.049084753531805e-01   +1.395691110362151e-01   -9.308981084056062e-02   +1.918238941638119e-01   -2.147353116768082e-01   -4.047629772486863e-01   -1.248758446551833e-01   +1.896907774957839e-01   +2.792551170141337e-01   -1.153712689045093e-01   +4.758071563963134e-01   -1.992125902358650e-01   -1.410984942448088e-01   +3.820873728717699e-01   -2.040378672131218e-01   -1.351326101174095e-01];
L2I_L2E_iAMPA_netcon = [+4.196788191381478e-01   +4.549203501086130e-02   +1.084586742252573e-01   +1.514775785987977e-01   -1.108032639968463e-02   +2.101872527937859e-01   +2.214482508296223e-01   -2.466833478005467e-01; -1.821826323770938e-01   -9.441732140994866e-02   +1.065295766235007e-01   -1.518371503902469e-01   +2.023429193279176e-01   +2.959446781203344e-01   +1.037415046443869e-01   -1.463600321756579e-01; -1.524922370704270e-01   -1.709723030057030e-01   +8.340979518597524e-03   -1.638006387007909e-01   +7.189781416050237e-02   +1.601429439483815e-02   -2.382684638201960e-01   -2.826377911418515e-02; -2.115732955026112e-01   -4.338414344928306e-01   -3.235468148333906e-01   +4.655792222724804e-02   +1.236643473610657e-01   -9.592368386306066e-02   +1.284331317764205e-01   -2.027683013106180e-01; -2.897865496185981e-01   +8.039278171668490e-02   +1.651040364063827e-03   -1.297339057756871e-01   +3.431333668326485e-01   -4.865756947573413e-02   +5.421449012255790e-02   +1.472365633546193e-01; -9.185434168152401e-02   -2.728127610500633e-01   -2.424907238852024e-02   -1.421965577844450e-02   +3.382097119079146e-01   +3.482900810586931e-02   +1.130923142948979e-01   +2.609392438547483e-01; -2.601557198457353e-01   -1.046025500307418e-01   -5.958809632778946e-02   -1.372076051091733e-01   +1.247928582303539e-01   -3.275096228255605e-01   +2.383128242350542e-01   -4.581283104341070e-02; -6.432156560130026e-02   +7.602688816402106e-02   +7.836797439167796e-02   -3.227996243585898e-01   +3.604323728410624e-01   -3.132529017474536e-01   +1.528475458941582e-01   -2.562999899301469e-02];
L2E_L2I_iGABA_netcon = [+9.758596415648196e-02   -1.421379234825423e-01   +1.267934466819691e-01   +2.356482417837832e-01   +1.591447219497492e-01   -2.723439385199485e-02   -2.025793062692731e-01   -3.322335381926235e-01; +3.663416772287308e-01   -3.701631929403888e-01   -2.480839985530953e-01   +4.729644205168919e-01   -6.376614498924159e-02   +2.707647308706265e-01   +2.128813296339913e-01   -2.167979111775779e-01; +3.503811615716891e-01   -2.188315430812482e-01   -2.019619985388895e-01   -1.042579287966856e-01   -3.658855572493575e-01   -1.574731184352160e-01   -1.632489975931390e-01   +1.846101822548141e-01; -4.668524171537453e-02   -3.898324453787732e-01   +8.930762208352278e-02   +1.331091101903707e-01   -1.059866816210878e-01   +5.668003980814046e-02   +2.594381582180451e-01   -3.316926610507852e-01; -3.613873559997423e-01   +2.374008475712119e-02   -2.632959713631691e-01   +3.134591679435757e-03   +2.994649316424696e-02   +6.032965471989649e-02   +2.830651607098591e-01   -1.231517910087352e-01; -1.699377377258907e-01   -6.863614071003414e-02   +3.137248878399725e-01   -2.312051669170725e-01   +2.701584043163520e-01   -1.192398562097629e-01   +1.399023338261502e-01   +7.206728465758880e-02; -3.437926462540133e-02   -3.771637548016906e-01   -2.262265810485213e-01   +5.592865156362067e-02   -3.764902299889590e-01   -1.726176753148363e-01   -1.022338876689023e-01   -2.409875187874751e-01; -1.921067267443193e-01   -2.273314373699934e-01   +3.050776509277964e-02   -1.452968268877349e-01   +6.706800387920277e-02   +1.731048971209817e-01   +1.706361007789248e-01   +5.172181831864453e-01];
L3E_L2E_iAMPA_netcon = [+1.303271429874354e-01   -9.504017987857424e-04   -2.562219241086341e-01   -1.180794908941178e-01   -6.589543612421470e-02   -1.320507309671782e-01   -9.713333367600401e-02   +4.906137875210070e-02   +6.384116604196544e-02   -4.097233828170821e-01   -1.658608726976384e-01   -4.093472240785631e-01; +1.821641016553339e-01   -2.841932126843619e-01   -2.084096399762852e-01   +6.620295154934770e-02   -6.552471947267113e-02   -1.684316317961312e-01   +2.229852652368232e-01   -3.268026302476041e-01   +7.191986089028100e-02   -6.458397388477819e-01   -6.839564200644110e-02   -4.332413733724172e-02; +8.142623133007332e-02   -3.256527686713893e-01   +3.135784493400177e-01   +2.659827196437664e-02   -2.429410755919908e-01   +1.603204036550759e-01   +1.542393310984783e-01   -9.919553461724298e-02   -1.957436487224344e-01   -1.670435733094035e-01   +1.664644359083318e-01   +1.483561409568064e-01; +1.189836016102472e-01   -1.681672539360808e-01   +2.000756836405999e-01   +4.468131168698413e-01   +7.004338538147319e-02   +1.031240552920283e-01   +5.495202004646743e-02   -2.072866107654918e-01   +1.278215945371556e-01   -2.883292050561090e-01   +3.926164197702694e-01   +6.173118793420948e-02; -2.929636376672086e-01   -9.610538914859140e-02   -3.962845736737975e-01   +2.467211066939080e-01   -2.161113008056778e-01   +1.521011212138068e-01   -2.446373952019955e-01   -2.280545204944526e-01   -8.429238115230717e-02   -4.541424718474565e-02   +3.120894613409693e-01   -1.852699513969820e-01; -2.932104323939350e-01   +2.005006975605821e-01   +6.718472364610061e-03   +3.842893571916699e-01   -2.167683815946918e-01   +1.085209641067867e-01   -2.408385161961048e-01   +2.671094602274841e-01   -3.033786989835946e-01   -3.566512751120134e-01   +1.632668904159368e-01   -1.432901801450746e-01; -2.178977898270232e-01   -2.356006016867124e-02   +1.001458546785254e-01   -2.358083504991633e-01   +8.774803065598541e-02   -2.355119950322397e-01   +2.193819131469404e-02   -4.621152237703164e-01   +3.175322899384159e-01   +1.214916169997044e-01   +2.798205207327756e-02   -1.891887015572083e-01; -3.167563836633795e-02   +3.266369002428502e-01   -1.128744505026156e-01   -1.237392463595375e-01   -2.998793410745854e-02   -2.305203232004062e-01   +7.465903041664244e-03   +9.806037454476595e-02   -1.411851304444462e-01   +1.548069692924006e-01   +1.018826753957473e-01   +7.001605103107003e-02];
L3I_L2I_iGABA_netcon = [-4.068637460128577e-02   -3.246116197989197e-01   -1.578853642837740e-01   -3.243672818118071e-02   +8.924950484098651e-02   -1.747912769164801e-01   -4.536544654969145e-01   +1.334294663545274e-01   +4.347082788792340e-01   -2.385590835733087e-02   -3.379785998717871e-02   -1.309985031541883e-01; +1.363289838504811e-01   +2.411295442420980e-01   +2.070141402351094e-02   -6.576866410607372e-02   +1.584342887696824e-01   +7.726498836477451e-02   +1.498761936024698e-02   +1.704249447775618e-01   -2.313003975253932e-01   +2.338991949323851e-01   -7.142970139482380e-02   +6.737310515397829e-02; -4.917698635857882e-01   -4.424876447397670e-01   -2.047928830910525e-01   -2.230313564270457e-01   +9.683780665387554e-02   +3.807442641760544e-01   +3.199470341272777e-01   -1.298250370886305e-01   +3.461277329343584e-01   +1.252190703751981e-02   +2.468253860048276e-01   +3.379053959336763e-01; -1.895796020750948e-01   -4.244871330538573e-02   -1.709783097531591e-01   +2.043884001769599e-01   -6.359633409458707e-01   -3.960219107842355e-01   -6.380464218268461e-02   +1.606235511670016e-01   +8.879451677001393e-02   -2.628347596455813e-01   -1.653682243161334e-01   -1.366377664307927e-01; -1.976825172066344e-01   -7.889854744203621e-02   -5.102775566859692e-01   -4.468738740631649e-02   -2.227768484054385e-01   +1.527874351803342e-01   +5.224472653898197e-01   +1.098678020976972e-01   +1.395084938512210e-01   -3.140432262377458e-01   -3.336040516800079e-01   -8.548953582883853e-02; -9.751432953180886e-02   +1.961492255758226e-01   -7.743790809178147e-02   -2.313209924464703e-01   -1.459718013129158e-01   -2.961910528330194e-02   +1.540946040250270e-01   +3.247534352242668e-02   -7.091572944746849e-02   +6.773982939572008e-02   +1.937716289585257e-01   -7.771873746101354e-02; -2.164188606120590e-01   -7.049601856246542e-03   -1.948726676382804e-02   -8.475669862791343e-03   -1.746894664465198e-01   -1.761557398813521e-01   -9.466383836300710e-02   +3.362201630236301e-01   -2.108566620908745e-02   +2.294350145817449e-01   -6.417649223891689e-02   -7.991172630677117e-02; +5.989847615966118e-01   -1.203780905934631e-01   -5.083326740662524e-01   -3.691979166492039e-01   +1.497305855133576e-01   +1.712974400340026e-01   -7.291642545863308e-02   -6.450996269952819e-02   -3.892624895105151e-01   -1.837730783230913e-01   -1.948020619708261e-01   -4.447660666374558e-01];
L2E_L3E_iAMPA_netcon = [+8.831077424179561e-02   +2.742649548461699e-01   +1.612196177124902e-01   -2.229443127085865e-01   -5.632785071217977e-02   -8.827786966064283e-02   -3.074309643442110e-01   +7.181112699052651e-02; +3.960732887398899e-04   +1.641113702752157e-01   -5.907873015332964e-02   -2.207705988626572e-01   +2.941986492230705e-01   -4.433135283397787e-01   -4.147670984014422e-01   -9.369069172340336e-02; +2.492138314539318e-01   -4.386508711337178e-01   +1.156474853193976e-02   -3.682103639237371e-01   -1.543010189391785e-01   -1.797802102333394e-01   -2.393959478994198e-02   -1.683499006479821e-01; +5.403919101891475e-04   -2.316387032861419e-01   -3.562184919742869e-01   -1.011233092279323e-03   +2.725626698754305e-01   +4.642095191033287e-01   +6.095476847629044e-02   +2.760400355265622e-01; -1.208262034999963e-01   -3.666965790376169e-01   +4.420883003121258e-01   +1.489336455036318e-01   -1.714318594452377e-01   -2.881790021185947e-01   +1.833003672029383e-01   +2.477670825790168e-02; -1.466606814342676e-01   -4.655433614914437e-01   -2.929029675937025e-01   -4.934952256115058e-02   +2.013996283263253e-01   -2.598696966604510e-01   -3.805067447437737e-01   -1.742546392013463e-01; +3.359531230028197e-03   -4.705159078002485e-01   +4.307669292595946e-01   +3.278926362516731e-01   -3.320833523366262e-01   +2.689433138321788e-01   -1.860542159356316e-01   +4.076265444413103e-01; +1.579031186227481e-01   +1.585413621291172e-01   -2.864684263912408e-01   -9.785985601903122e-02   +3.053149563086512e-01   -1.456472008281145e-01   +1.436944908937319e-01   +1.282166588763831e-01; -2.384786343287315e-01   +3.044067417981396e-01   +3.215156206260532e-01   -3.250494512284394e-01   +1.930628433947099e-01   +3.367691683560069e-01   -1.664799842647131e-02   -2.426484267655959e-03; -2.568037822982286e-01   +1.073794810629570e-01   -2.880751564163554e-01   -1.185939754360652e-01   +1.340653257586329e-01   -4.198722577762217e-01   -2.552035774910273e-01   +2.216315401865351e-01; +3.743558522129214e-01   +1.133743490776514e-01   -3.479251793121978e-01   +3.536695746649106e-01   +8.553574212134778e-02   -2.270415525630177e-01   +1.946285456458373e-01   +2.357950532129261e-01; +8.067877879005657e-02   +9.462878013045789e-02   +1.134464627531787e-01   +1.236418687252598e-01   +6.321760587413405e-03   +2.083109785882246e-02   -8.797266462288457e-03   +9.241253976881766e-02];
L2I_L3I_iGABA_netcon = [-2.583498746069736e-01   -1.856787826851947e-01   -1.061370930251480e-01   +5.000937488141622e-01   -1.129938210094966e-01   +2.563989195915246e-01   -4.505332843286372e-02   -4.822023350855239e-01; -3.283040026382128e-02   +1.191856986306758e-01   +1.845489114012713e-02   +2.425252133460686e-02   -1.851706021987340e-01   +3.488686610320871e-01   +6.336084875435635e-02   -1.915101063970882e-01; +4.058461468180240e-02   -2.058652148057255e-03   +3.675421975835869e-03   -2.572398444668491e-01   -9.097625632389042e-03   -1.087800663910321e-01   +2.012379417040256e-01   +1.928372275325566e-01; -2.930857342926629e-01   +9.282719734899005e-02   +2.162309302774999e-01   +3.394614501307373e-02   +1.568279793151026e-01   +2.825080031248856e-01   -2.203992222760913e-01   +1.797955006160555e-01; +2.922761593975569e-01   -5.286834917898878e-02   +2.424009265130162e-01   +7.490227697553493e-02   -4.029034182503960e-01   +2.786661824283697e-01   +2.392015960776142e-01   +4.393139229851227e-02; +9.425011176452225e-02   -8.977243514869054e-02   -3.038597490304276e-01   -3.010675595716313e-01   -6.189374111895002e-02   +1.134747314627082e-01   +1.316502725686794e-01   +8.689971770101196e-02; -2.798809576951005e-01   +1.665143656871597e-01   -2.018256132468669e-01   -1.672207503411490e-01   +4.608105398165603e-01   +3.578073370043844e-04   -2.638189626346655e-01   +2.592100346297750e-01; +9.815339427116225e-02   -7.744358087579586e-02   +2.408502973971475e-01   +7.598325767300171e-02   +2.655568061741789e-01   +1.369549619273864e-01   +5.880418591344718e-01   +1.624747080340918e-01; -3.756658315743005e-02   -7.589710603100688e-02   -4.915594799331565e-01   +3.081573012667219e-02   +6.564544178825314e-02   -4.420967663352482e-04   -4.886477347567328e-01   +1.296521237786102e-01; -1.416157340670696e-01   -1.001220366551119e-01   -4.349187302223343e-01   +1.154516204623229e-01   +2.096435378151741e-01   +4.992411978454028e-02   -2.403461682710072e-01   +3.629469607621211e-02; +4.379432474089118e-03   -3.223701810298558e-02   -2.272800023383433e-02   -2.056052460920942e-01   +2.044765260059004e-01   +1.752193093647573e-01   -1.040144848922155e-01   -1.499552933345007e-01; +2.193981407719185e-01   -1.143781632688430e-01   +1.326859381654976e-01   -3.352091281118328e-01   -3.768937825808450e-01   -1.395867738592916e-01   +6.545308485040720e-02   +1.025260454265667e-01];
L3I_L3E_iAMPA_netcon = [+7.714038155867819e-02   -1.059836282804921e-02   +1.201003124870164e-01   -1.489795495250810e-02   +1.538927291994485e-01   +2.999722537989054e-01   +1.732270572597753e-01   +5.364601138776993e-02   +5.169977850007962e-02   -2.402686490711551e-01   -2.717016947032255e-02   -1.976207639369564e-01; -6.034590260974688e-02   +1.948037528422095e-01   +1.992947303661451e-01   +1.256636966590885e-01   -2.780693654112766e-02   +2.764937386341418e-01   -2.335562109444260e-01   +2.222813793903736e-01   -1.126195432561866e-01   -1.188552621649241e-01   +2.600200136447403e-01   -2.662373162287763e-01; +1.771985371164110e-01   -2.984690085322583e-01   +3.269364430668657e-03   +4.617554888360215e-02   +3.263505808248722e-01   -1.901166836308310e-01   -2.603645381792846e-02   -2.897592782381618e-01   -9.171729941561646e-02   +3.206825629653115e-02   -5.734822324665199e-02   +4.449065633357787e-01; +1.378008242148908e-01   +1.847687897673900e-01   -3.259139594187817e-01   +3.457478847656212e-01   +2.526013667869596e-01   +6.542422027326014e-02   -4.591467870774260e-02   -1.380064158838761e-01   +1.259366511856859e-01   -3.601065820308065e-01   +1.707668138845492e-01   -1.689304771986974e-02; -3.408817606828791e-01   -6.509894057417578e-02   +1.256719722035335e-01   -1.471779215760946e-01   +2.116571506864930e-01   -9.799236662875251e-02   +1.839628059956040e-01   -1.989862716968082e-01   +1.797456081829883e-01   +1.186949029628966e-01   -3.801468957736597e-02   +3.211639157954112e-01; -2.837700307651844e-01   +1.769139963969804e-01   +3.137435250446469e-01   -4.506355227132278e-01   -3.912550367540350e-01   +1.694449272839293e-03   -2.195534836204339e-01   +4.712937343781633e-02   -2.872435635114012e-01   -7.041407836678057e-02   +3.737244144857216e-01   -2.248587093049697e-01; +8.949039498151751e-02   -2.065668837627773e-01   -2.994857403603781e-02   +2.614543714189262e-01   -1.913926786112187e-01   -2.524143526404611e-01   -2.534052129847297e-01   -4.201121177394619e-01   +2.653467709885829e-01   -3.580760463377357e-01   +1.709372617891405e-01   +1.581729299863796e-01; +1.048934713534678e-01   +1.505044634924494e-01   +3.024808368228725e-01   +2.842608960806715e-01   +1.112593186966633e-01   -1.783740480854624e-01   +2.848598680319236e-01   -7.897083979291976e-02   -4.590716998543753e-02   -1.135147292428462e-01   -2.161094655354593e-01   -9.498597620479669e-02; +6.654356997865998e-03   +1.192651444062079e-01   -9.960604450731103e-03   +1.237522997885452e-01   -1.045475133217986e-01   +2.453619110677465e-01   +3.012735625626596e-01   -2.839889004269125e-05   -2.812818718497498e-01   -3.621464946421904e-01   +1.337516182933975e-01   -4.959001594707718e-02; -9.245924980549179e-02   +2.393289738092562e-01   +2.069371923032105e-01   +1.854919902186671e-01   +3.078799122513375e-01   +1.975849019942397e-01   -1.352746806839792e-01   +2.271924964503677e-01   -6.714401970232983e-03   -1.732384625284401e-01   -6.417402427784535e-02   -6.892837037425732e-02; +1.534286184693558e-01   -2.937743401447044e-01   -2.504174156599276e-01   -5.942287106134597e-02   -4.382744291686358e-01   +1.185664455653113e-01   +1.552265832050530e-01   +3.547323218447584e-01   -1.068562149352027e-01   +1.871976815640164e-01   -1.467757173390849e-01   +2.477802990440340e-01; -1.150700219045338e-01   -5.096894524344389e-02   +2.062623164817039e-02   -3.433852031706889e-01   +1.118952658144926e-01   -3.067333293374889e-02   +2.620885869971734e-01   +3.322737299058414e-01   -1.047633394904971e-01   +2.494522146701664e-01   -3.433815051801916e-01   +2.155212808459556e-01];
L3E_L3I_iGABA_netcon = [+1.926383889623686e-01   -3.451903562055127e-01   +9.435710965886167e-02   +1.736926614900714e-01   +3.913985089373262e-01   +3.442863585050757e-01   +2.791711508810973e-01   -1.328316740295803e-01   -2.971356616184783e-01   +1.623602489585145e-01   +1.793526051196981e-01   -1.086988868084135e-01; -1.508192410477276e-01   +4.147934772692258e-01   +2.614524954278011e-01   -9.931515063475879e-02   +3.734871767202559e-02   -9.395261380356240e-02   +2.662759571292905e-02   -2.759002054913385e-01   +3.113863970478548e-02   -4.006115012826397e-01   +2.683960009797497e-01   -9.927674087549197e-02; -1.840263669147713e-01   -3.218193762237691e-01   +8.953843099375408e-02   -9.674836655036519e-02   -1.395857137516505e-01   -1.215492591760340e-01   -2.817977422660936e-01   -1.680543881769143e-01   -4.913140222058454e-01   -1.155921880828253e-01   -3.613255302554265e-01   -1.871298179306730e-01; +4.710464684416190e-01   -4.492493958610873e-01   -1.928803314986403e-02   +1.393483157708812e-01   +1.467098650032776e-02   -1.208168143946056e-01   -6.796594989570029e-02   -3.971049037888352e-02   -1.750265840518287e-01   -1.445765460848422e-01   -1.430695465093177e-01   -2.123302333803074e-01; +2.085630932132512e-02   +2.043024242811308e-01   +5.081516408894772e-01   -1.834195863542198e-01   +1.016296256240184e-02   +2.748185704426870e-01   +2.475825253711654e-01   -8.717911498130546e-03   +1.171252293273702e-01   -1.129300094330963e-01   -3.747546999374702e-01   -2.553773396782197e-01; +9.629433987311681e-02   +2.291717087522208e-02   -9.261611324290722e-02   +1.980168337720668e-01   +5.232425456291064e-02   +3.201449629045350e-01   +1.609614895315501e-01   -7.595819714045576e-03   -2.114112993331752e-02   +1.234581244830804e-01   -2.888106724583593e-01   +3.553421288855135e-01; +1.710401838680453e-01   +5.223701477974257e-02   -3.935901346380010e-01   +1.503589578143588e-01   -3.024136938310937e-01   +3.610644170620055e-02   +1.961094889817550e-01   -1.561619174310011e-01   +3.495626709545802e-02   +9.565500789061833e-02   -1.753637537214486e-01   +2.950757062687437e-01; -2.204490963034166e-01   +3.953457914269344e-01   -3.985457668708510e-01   +2.181264007764662e-01   -1.772654518936178e-01   +2.568746218439724e-01   -3.842986891493808e-01   +2.384512645214046e-01   -2.588180319712327e-01   -1.106104685904373e-01   -2.711236819319983e-01   +2.862778078004953e-01; -1.523328747621070e-01   -5.689614755211065e-02   -5.622067780684516e-02   -2.722501334154421e-01   -7.049188091263474e-02   -1.192914879516013e-02   -2.397126315395311e-01   +2.610622446551977e-01   -8.500253223813184e-02   +1.649465012073784e-01   +1.741454141434896e-01   +1.685151804146334e-02; -5.447382607394026e-02   +1.942877021552493e-01   +1.460337929839478e-01   +5.756814961714357e-02   -2.838929895564632e-02   +3.645559261248974e-01   +3.598742321440820e-01   +2.363451289717762e-01   +4.460519376785476e-01   -1.739925797132255e-01   +1.739148359981845e-01   +1.908395688358148e-01; +5.901377133851462e-01   -3.861477845929888e-01   +8.325645739719557e-02   -7.050971864632535e-03   -2.901309853481896e-01   +1.701851894884782e-01   -2.022294955909716e-01   +3.217183221157298e-01   -1.212514825794996e-01   +2.983591677499919e-01   +2.972440149170147e-01   +4.086513415731423e-01; -1.905170062591672e-01   -1.248573302172883e-01   +3.406370803802591e-02   -1.146325043924701e-03   +4.773568330931502e-02   -3.792393526953531e-01   +2.538434898042893e-02   -1.092886975304846e-01   -3.371267856375142e-01   +2.466835598080415e-01   +3.114888687811046e-01   +4.077561534109843e-01];
L2E_Input1_iAMPA_netcon = [+2.315114845431041e-01   -1.498077124989236e-01   +1.196610294228678e-01   +1.109913656333200e-03   -1.872205850401941e-01   +3.486639412090026e-01   +2.697789581626898e-01   -1.046075986812947e-01];
L2I_Input2_iAMPA_netcon = [+3.586819731862692e-01   -4.966301138838966e-01   +1.334945718900745e-02   -8.284138738948013e-02   -1.377578255032949e-01   +2.452223472011600e-04   -1.527759807821249e-01   -1.245757458307533e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
