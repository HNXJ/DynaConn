function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-1.188310393190000e-01   -3.654046414601730e-01   +3.960754891814487e-01   +1.600806193466981e-01   -7.198402225430604e-02   +6.688174976730479e-02   -3.784045005192713e-01   +1.991142840865309e-01   +5.728262177036033e-01   +3.466256565239703e-01   +2.138558385321821e-01   +5.520836895751662e-02   +3.744660046260173e-01   -6.144746307369090e-02   -1.069323386168618e-01   +2.060182308711980e-01; +5.658878125211856e-01   +3.570821554819054e-01   +3.758642270752297e-02   -1.751993703493082e-01   -4.210733275208214e-02   +4.311617507374955e-01   -4.052155505011215e-01   -3.043709750792355e-02   +3.716885129452741e-01   -6.140535877796502e-02   +4.819057672914225e-01   +3.020987723605962e-01   +4.720379369741673e-01   -1.531501059427890e-04   +2.067536967512443e-01   -9.603047148290923e-02; +5.287339394725029e-01   +1.594035049958301e-01   -1.391952697623191e-02   +3.442481469006572e-01   -1.072737544072347e-01   +2.567684025083825e-01   +3.219019695451298e-01   -1.867602333762804e-01   +3.143230533774434e-01   +2.917991948896250e-01   +6.065789275245241e-01   +2.745840057405797e-01   +4.882250051429978e-02   -4.555525019867671e-01   -2.219659073389021e-01   +2.397520896936059e-01; +8.225661444017013e-02   -7.570810694955714e-02   -1.784965582739822e-01   +6.241448794311820e-01   +4.096694266251102e-02   +5.401630875577796e-01   +7.155550897848840e-01   +7.920483698035010e-01   +3.492654838027526e-01   -2.628081604856592e-01   +4.416811777082353e-01   +2.262104891632249e-01   +8.109705074592857e-02   +4.694055169827493e-01   +2.344434367628595e-01   +7.297369331849266e-01; +8.244594627235506e-02   +2.515244065529255e-01   +5.379144413679340e-01   +5.583368479294750e-01   -1.093743252757005e-02   +2.178115770275153e-01   +9.395134205551772e-02   +6.126479054192994e-03   -1.081178999729689e-02   +6.038143070063730e-01   +7.233648940352979e-01   -2.160324612471470e-01   +4.149773109767464e-01   +2.632765505075130e-02   +1.908747640265249e-01   +1.927409623032796e-01; -6.987187415083028e-02   +7.520869062066123e-01   +3.351541321482200e-01   +1.270785784856379e-02   +4.393413817753946e-01   +3.446519793418377e-01   +3.755278316652471e-01   -2.178134189640828e-01   +2.405467416726601e-01   +1.021301122820664e-01   +6.356589803080065e-01   -3.350907336803454e-01   +5.643994090701004e-02   +1.774464168206043e-01   -9.381745119316794e-02   -7.446535391472000e-01; +2.814000096564939e-01   +4.069531906803977e-01   +3.842461721675111e-01   +4.251541099601707e-01   -2.115098583736726e-01   +4.141359623502141e-01   +2.238616974239008e-01   +5.597632007180298e-02   -7.343319561588589e-01   +1.984766926487131e-01   -3.384732160866324e-01   +1.608644181031150e-01   +6.594635307468232e-01   -2.827136966442966e-01   +4.563976937858769e-01   +7.509714559752867e-01; +4.157496623777815e-01   +4.470915960221019e-01   -5.360710318777651e-02   +3.813212372448587e-01   +1.967348180503429e-01   -1.839225915358908e-01   +3.411473795025319e-01   +4.059073959185445e-01   +4.768287011320577e-01   +1.032063337660760e-02   +5.903650934706671e-01   -4.119562959792277e-02   +1.524229679971553e-01   +3.199785624921430e-01   -1.227210184161782e-01   +1.577178551356928e-01; +2.602852823596833e-01   +6.239518388968114e-01   -3.154165146988254e-01   +1.442224657952716e-01   +2.748703116760569e-01   +6.008943918097878e-01   -9.069744962257442e-02   -3.627665094098502e-01   +2.256794141323852e-01   -1.237897956710708e-02   +4.410268910945618e-01   -1.309922967142653e-01   +3.343278195455306e-01   +4.109144153360973e-01   +4.134197344709019e-02   -2.883895110908010e-01; +3.331048763391923e-01   +8.390203742117364e-01   +2.125602609424987e-01   +1.820329118384403e-01   -1.120191701730723e-03   +1.011914252031003e-01   +5.280854193046137e-01   -1.142721855596487e-01   +2.493015558570534e-01   +1.199487606423013e-01   +9.330828994465354e-01   +1.980944834518784e-01   +4.919131031422675e-01   -2.481658873431181e-02   +9.047704001061849e-02   +5.513751547860932e-01; +3.138142813488020e-01   +1.000000000000000e+00   -1.709531988538099e-02   +2.500362449320506e-01   +5.785529964978665e-01   +1.586345487685488e-01   +1.028191060467104e-01   -7.946666018421371e-02   -4.899684490643071e-02   +5.637919713401952e-01   -3.007572602055090e-01   +1.125089696897500e-01   -5.296331672692696e-01   +7.007410976274840e-02   +3.214475562806106e-01   +1.763617145249330e-01; +2.926860994570322e-01   +3.127202503139259e-01   -7.229775584155647e-03   -3.485497846585536e-02   +5.233923177408945e-02   +1.785710976145731e-01   +3.722584556280188e-01   +1.076727160079995e-01   +5.073598131553169e-01   -3.151722793757892e-01   +5.051571773839431e-01   +8.098102898597106e-01   +6.317308444718118e-01   -2.933501219962849e-02   -2.512172425937433e-01   -2.206793143319479e-02; -1.206741242789524e-01   +1.961111646374253e-01   +4.014116538839611e-01   +2.182766220760569e-01   +9.899909858583840e-01   +5.651318841861563e-01   +3.340616391766210e-02   +1.204825167096383e-01   +4.740757966316653e-01   +2.995109683749328e-01   +2.912185621243790e-01   +3.878330628166726e-01   -3.250341869017984e-01   -5.400967638004075e-02   +2.643055379157771e-01   -1.306794125190713e-01; -1.019584667406189e-01   +4.133885775790569e-01   +2.453793889737783e-01   -4.067356859588996e-01   +2.460832069863027e-01   +4.439270856585805e-01   -4.064731017114602e-02   +2.616027134761219e-01   -1.676739830385178e-01   +5.714960583067723e-02   +6.243162100096310e-01   -1.389929702770729e-01   -9.180908902842529e-02   +6.070047637011647e-01   -1.769653719893842e-01   -2.821311119365583e-01; +3.912559261753656e-01   -2.726976909009196e-01   +5.909088699945738e-01   +2.090512431928077e-01   -3.537727859740174e-01   +1.389614729064200e-01   +3.996251611162960e-01   +1.617218985927697e-02   +6.260123674547856e-02   -4.099637678721575e-01   -8.077239800411806e-02   +1.434775423810422e-01   +4.916954094043518e-01   +2.043732698942397e-01   +3.583395357235700e-01   -1.886912203539212e-01; -5.647955384424771e-01   +3.371811907460678e-01   -1.056925092843669e-01   +2.451598059009960e-01   +8.970663865722314e-01   +5.361276727890274e-01   +4.684785763732427e-02   +7.494241668157997e-01   -1.420153180249950e-01   +3.479025656373713e-01   +4.709067258804194e-01   +3.018173929289532e-01   +1.238431248716327e-01   +4.843129301568953e-01   +3.034631048157763e-01   +1.667481249181468e-01];
L1E_L1I_iGABA_netcon = [+9.848790534952258e-02   +4.843187168800088e-01   -4.672049914797493e-01   -1.556879362132599e-01   +7.770060498744268e-01   +4.179889820753280e-02   +5.855006106996858e-01   +2.230079907774536e-01   -2.122998202384290e-02   -2.773994292839800e-01   +5.734466572889402e-02   +2.290292565311647e-01   +7.575339875374553e-01   -1.631815733203181e-01   +4.187300630984939e-01   +8.785693797430033e-01; -4.700548251919063e-01   -2.984366102930580e-01   +6.709556174799878e-01   -5.623152204716846e-01   +3.926189661478997e-01   -3.899866835102906e-01   +4.122978983523261e-01   +6.551104261538498e-01   +2.065091378529685e-01   -1.682473018537084e-01   +2.821078366453099e-01   -2.678506594388858e-02   +5.581024462504189e-01   +2.587008533916241e-01   +5.113246482645807e-01   +1.350707692829611e-01; +7.243154265333267e-02   +2.750102284106546e-01   -4.104565446774517e-01   +4.625208140441531e-01   -2.409292115408332e-01   -2.217748257978674e-01   -8.043821370079113e-02   +1.039992819014875e-02   -6.819488709147620e-02   +1.208924298483340e-01   +6.204109998164684e-02   +2.990892629840237e-01   +8.815100518814897e-02   -3.254311875984787e-01   +6.257101244859987e-01   -2.948535921996913e-02; +4.333701008156360e-01   -3.306918660989773e-01   -2.619159248795990e-01   +1.321151687668164e-01   +1.709654958230016e-01   +2.149313552749998e-01   -1.317181698785962e-01   +9.871209086719801e-02   +9.012211068770266e-03   +2.281367923632717e-01   +3.279911963987608e-01   +2.784444426152934e-01   -2.093880272854706e-01   +3.670136524741171e-01   +5.558129448137616e-02   -1.311520164489974e-01; -1.464939897266367e-01   +1.390203902123675e-01   +2.730919030417552e-01   +2.813301726471663e-01   +4.445506676807250e-01   -1.646017846167704e-01   +2.829149482622086e-01   -4.684685157864971e-01   -2.115696678061424e-01   +3.525598735763324e-01   -2.334054784401600e-01   +5.044859552710282e-01   +5.848947774600252e-01   +6.022236695568395e-01   -2.919739171325375e-02   +6.287908266428409e-02; +2.300794243138166e-01   +9.689871807157108e-02   +2.433687155906184e-02   -2.962081715465834e-01   -2.849725494046318e-01   +7.399613456103467e-01   -1.332486355063150e-01   -1.889680373714501e-01   -1.638193153412532e-01   +2.646863471346086e-03   -2.631503135174505e-01   +5.285890125582619e-01   +4.395780584788646e-02   -2.814849421656085e-01   +3.592022375980539e-01   +6.389332344749044e-02; -4.016814888337063e-01   -2.116963801823455e-01   -4.323554934979814e-01   -3.859949548728960e-01   +5.752390640805498e-01   -1.355870889882603e-01   +1.302883049800489e-01   -2.212832493408783e-01   +2.875132060091736e-01   +2.199445936239091e-01   +6.969679748387183e-01   +1.766800154122554e-01   +2.770373445428426e-01   +1.870573757736589e-01   +8.837755271329273e-01   -1.985727516656898e-01; +1.450630172786975e-01   +5.033066591228464e-01   -2.314216703464527e-01   +2.489823245309469e-02   +1.182757782433358e-01   -4.217470902203232e-01   +8.261337825990380e-01   +2.141834878819940e-02   +4.665627732831461e-01   +1.516689235422617e-01   +1.654962620651276e-01   -1.391901843761000e-01   +6.506237885258546e-01   +5.135166555010530e-01   +4.118444892756721e-01   +5.994324848554539e-01; +5.154536709386535e-01   +7.047257042016610e-01   +8.711432646202578e-02   -1.131378313773969e-01   -3.510401067723229e-01   +6.230089570402975e-01   +2.286801538480064e-02   +3.408931345930535e-02   +1.773012527635426e-01   -1.874397624455204e-01   +8.154758428530959e-02   -1.732578656585457e-01   -3.028047393916224e-01   -4.171301566292588e-02   +7.395484938432557e-01   -3.160220511879365e-01; +2.026721827685838e-01   +6.036248668085511e-01   +2.652005731662152e-02   -3.436884543068964e-01   -3.430823065040610e-01   -5.092365550150634e-02   -4.183155601634733e-01   -1.260525669231606e-01   +4.423800988641451e-01   +1.505329628146537e-01   -5.078632703148119e-01   -1.072970525607071e-01   +4.569057972549779e-01   +5.015670280806360e-01   +4.025731092693465e-01   +4.301888244576366e-01; +2.196214892600759e-01   +1.686588766732066e-01   +2.609329047816984e-01   +7.852839695983471e-01   +3.357746447686731e-01   -1.635985488525005e-01   +1.786145867866065e-01   -1.042932298685420e-01   +7.288349436721377e-01   +2.161317583677915e-01   -1.246871079567516e-01   +3.394845455134012e-01   +7.763171353240758e-01   +4.353996788963039e-01   +3.845121186922649e-01   -3.756780361265842e-01; +2.276076855901735e-01   +1.372165747444704e-01   +1.194478741636320e-01   -7.642538299596535e-01   -7.621984168002818e-02   +1.401794028945602e-01   -1.534381603237152e-01   +9.242604171152864e-02   -3.899448927512658e-02   -1.105583295537905e-01   +3.476816743747326e-01   +2.346323721045054e-01   +1.238532328254009e-01   +2.043801555988711e-04   +2.819315662159110e-01   +2.074624696616111e-01; +3.250718941598676e-01   +6.085027702592407e-01   +1.722212541754241e-01   +2.695287340437023e-01   -1.776984643184044e-01   +7.600530087227362e-03   -7.011551638185749e-02   +3.742156389219271e-01   +4.644479016938021e-01   -8.605430500344477e-02   -8.229686980596818e-02   +2.777916857369584e-02   +2.789023549164975e-01   +2.988047964607415e-01   +3.934921201660457e-01   +2.906122959680467e-01; +5.787343315061759e-01   -1.674385950115118e-01   -3.187400677126970e-01   +2.989972510024655e-01   -3.272700436276245e-02   -1.362088311830738e-01   +3.006446079864714e-01   +1.613879788236145e-01   +5.371359241552953e-01   -3.987358336254290e-01   +1.674381739862406e-01   +2.384024453234698e-01   +2.268147202211570e-02   -3.405988883101229e-02   -2.123750573008063e-01   -2.394861133250073e-01; +3.434575851791013e-01   +3.433982315688299e-01   +1.182791112307360e-01   +3.795627255849493e-02   +5.579372969217515e-02   +9.698851228884632e-02   +1.763021112854603e-01   -1.558782558723970e-01   +4.339153487792535e-01   -9.290267366367705e-03   +3.899053844673306e-01   +6.427630477666690e-02   +1.821944542857417e-01   -7.460173025457232e-01   +8.452088217324045e-01   +1.552924907812332e-01; -2.426090141506115e-01   +4.834625626674758e-01   +5.412663832248215e-02   +2.420574459599044e-02   +5.144254427724999e-02   +6.040120261910617e-02   +1.121843678920773e-01   +1.722633799883481e-01   +1.280248522514295e-01   +3.052777388996447e-01   -6.338849573373156e-02   +1.839949706082273e-01   +4.121514618640886e-01   +2.803677150928499e-01   +1.301573791548779e-01   +5.758760143012540e-01];
L2I_L1I_iGABA_netcon = [-2.455769486271765e-01   -1.739739916473081e-01   +1.290758350403737e-01   +1.261260783626406e-01   -2.858526191749358e-01   +1.387224335398844e-01   +1.917277429984360e-01   -3.469524705442352e-01; +2.853056650466858e-01   +7.197991446618470e-01   -8.796575434776440e-03   +2.100057940115444e-01   +6.558342313494134e-01   +4.925432201902561e-01   +1.617781879060111e-01   -1.786584516493955e-02; +5.516013945171329e-01   +2.775988067360634e-03   +1.602557294260378e-01   +2.663833004442532e-01   +2.168332732221975e-01   +2.987623995719356e-02   +1.108453357089704e-01   +7.083490518899874e-02; +3.062350496578788e-01   +1.369947502230983e-01   +7.872070174929655e-01   +3.678490042090492e-01   +4.799237655225562e-01   +3.052023282446103e-01   +4.295365858373510e-01   +1.166982143591093e-02; +2.437552607792500e-01   -1.605021531395924e-01   +6.554728669635983e-01   +2.799277936705557e-01   +5.638366491651640e-01   +1.445180342335990e-01   +5.540295148444405e-02   +4.875809886452136e-02; +2.856706487352652e-01   -2.738602317030097e-01   +2.568887832477780e-01   +2.369081746368032e-01   +3.663878120829875e-02   +3.366407668161833e-01   +1.120308278799891e-01   +5.161393133667037e-01; +3.598207375858203e-01   +2.859142588252410e-02   +3.038235025790733e-01   -7.112010653119248e-02   +3.108404171749237e-01   +7.105776655872441e-01   +4.732635576662485e-01   +5.148829737173597e-01; -1.286250013225484e-01   +3.009437168136979e-01   +1.168484637545923e-01   +2.463998038304481e-01   +2.718400076377095e-01   -1.895365523249775e-01   +2.391347422394360e-02   +1.227115598081099e-02; +3.563803190838311e-01   +1.000000000000000e+00   -4.526990252170077e-01   +4.630851766347293e-01   +8.246374440282618e-02   +2.372321517209434e-01   +3.661338537516511e-01   -2.371122155860418e-01; -1.144364778421443e-01   -2.005525255649835e-01   +1.223559465112735e-01   +6.902343096025192e-02   +5.668039099248784e-01   -2.125406200478308e-01   -2.216543890548286e-01   +4.763491134877191e-01; +8.649586731905785e-02   -3.396660611423342e-03   +2.551746197917933e-01   +7.250105386652975e-02   +1.609437907038333e-01   +1.698466589611498e-02   +2.792390589012579e-01   +2.099660045915880e-01; +4.572169563185117e-01   +3.410449447263023e-01   +1.663520719667382e-01   +3.026496574401941e-02   -1.144127967099364e-01   +1.109854520215950e-01   +5.967430276349968e-01   +5.387053850271936e-01; +2.883029668939834e-01   +3.517009069630877e-01   +2.415091712143318e-01   +1.935747307967594e-01   +4.499639523743408e-01   +7.695238446281731e-02   +7.040388064079321e-02   +1.881216320213856e-01; +1.224915516079460e-01   -2.151975287997472e-01   +3.693949635882007e-01   -5.481777696836581e-01   +3.861205826824967e-01   -1.779315457193558e-01   +3.092006326585571e-01   +3.009494544085110e-01; +2.149469957113889e-01   +1.831117773789153e-01   +3.737861888157549e-01   -5.874253953189084e-03   -2.325595072090867e-02   +9.244724166972041e-01   +5.261313210991254e-01   +7.391856127086146e-01; -2.247529808902540e-02   +3.022681855966562e-02   +5.733331674261710e-02   +5.194862847169723e-01   +5.642010499791003e-02   +1.124084423084438e-01   +1.591441338880171e-01   +1.048834948227055e-01];
L1I_L2I_iGABA_netcon = [+3.726947340321343e-01   -3.408380181744773e-01   -1.616427762191098e-01   +2.274173649456384e-01   +1.823199894148569e-01   +1.432921543089860e-01   -3.498788666790595e-02   +1.554479541258233e-01   -1.630797195470562e-01   +2.999946481327676e-01   -6.607681794719940e-02   +2.026765778097286e-01   +1.286657749853643e-01   -1.017926313659433e-01   -8.357926488425553e-02   +2.654740947154113e-01; +4.668825571171649e-01   -2.451423734792254e-01   +9.919962719771566e-02   -3.133317527997664e-01   +1.538942523648779e-03   +5.600489560938229e-02   +2.317062276078233e-01   +3.325092851640397e-01   +7.807917253667629e-02   +4.978659909485704e-01   +1.002219507611893e-01   -2.825922378651649e-01   -4.742594557615382e-02   -2.308272441079909e-01   +4.081900632386544e-01   +2.883088287699117e-01; +2.973636998643526e-01   -2.519898075200500e-01   +4.546351757156608e-01   -1.094623458195714e-01   +1.485217115362319e-01   -1.456640558404144e-01   +4.506266631676058e-01   +2.420299732907096e-01   -6.988053623599048e-02   -1.089298447525651e-01   -2.278989387819516e-01   +1.790407150909733e-01   +2.481941529183158e-01   +5.077763146593504e-01   +9.554359228788092e-01   +8.155115630963562e-02; +3.005291599989174e-01   +6.668415594525769e-01   +3.596113300056186e-01   +2.032921812839518e-01   +4.440264849504089e-01   +6.502712376261861e-01   +3.900787448504128e-01   +1.994257307244738e-01   -8.507188016578848e-02   +7.437078368098540e-01   +4.418616503578344e-01   +2.457293935786157e-01   +4.505672534116486e-01   +2.586731454298594e-01   +2.799098133874836e-01   +1.860260678312344e-01; -5.486224297282229e-01   +2.275316140118633e-01   +7.373937933645258e-02   +4.392600619034176e-01   +1.575457189950257e-01   +7.423128624979002e-01   +3.441648878906583e-01   +5.092478161336454e-01   +3.644399951426439e-01   +3.551631652860913e-01   -1.615929546628512e-01   -1.219264247526877e-01   -4.847858177562555e-01   -6.801359130893050e-02   +2.954655061653695e-01   +4.632218704202840e-01; +1.667518564582355e-01   +3.272410720735214e-01   -3.073022967398000e-01   +4.899998849867022e-01   -1.521202430289191e-01   +4.485166961204841e-02   +3.472667353015725e-01   -2.048360977568104e-01   +1.989741019960934e-01   +1.081009307751451e-01   +1.071717057643286e-01   -1.588754494331612e-01   +4.360126884908627e-01   +1.000000000000000e+00   +1.320498829201691e-01   -7.183400022894809e-02; +2.142135348886782e-01   +3.155304398074758e-01   -4.260473467757876e-01   +1.535648139458012e-01   +4.121173191816265e-01   -4.286734710112126e-01   +3.963326592738193e-01   -4.866681811988349e-02   -2.610241694862884e-01   -2.003529360996210e-01   +3.297147136852705e-01   +1.839689385775433e-01   +2.386716047569211e-02   -1.076444599196032e-01   +5.938149027205434e-02   +2.892563108092591e-01; +4.539280239869586e-01   -4.559377238811158e-02   -2.479036801306132e-01   +2.387189663361894e-01   +2.081081733074417e-01   +3.012500811929486e-01   -9.583272829833792e-02   +1.467493398502348e-01   +1.489404025829066e-01   +2.314518658921570e-01   +4.045587985012339e-02   +6.135353985722071e-01   +9.693745753863328e-02   -9.975303408605614e-03   +5.616844321507435e-01   +4.231760197701877e-01];
L2E_L1E_iAMPA_netcon = [+4.307429082906760e-01   -2.498425367674814e-01   +1.149439588728448e-01   +5.294033099500211e-01   +7.671134970988915e-01   +5.954990364622074e-01   +4.388498045370631e-01   +1.255513355376397e-01; -1.950940810430663e-01   +5.609381389333331e-02   -1.384682533027485e-01   +1.286836359716841e-01   +2.270318965557706e-01   +3.110467105226267e-01   +4.630148402931658e-01   +2.553580075376942e-01; +4.993864998205688e-01   +2.684582835150557e-01   -2.843881567430693e-02   +9.280617977954064e-02   -1.973990494517524e-01   -1.699048595876219e-01   +1.000435040122263e-01   +3.902501121970656e-01; +4.794919597473449e-01   +3.973299282085369e-02   -3.330764703407949e-01   +5.159315966646527e-01   -2.924465041065452e-02   +2.433360190399123e-01   -4.302681751899162e-01   +9.726490578703689e-02; -1.783222325089195e-01   -5.240197124942246e-02   +4.105478110710445e-01   -2.196395859492789e-01   -1.307880550903856e-01   -7.655923241443249e-02   +6.942745128132730e-02   +4.190392766145932e-01; +4.383545243187186e-01   -2.860276957057039e-01   +2.382080791518033e-01   +2.264223743765915e-01   +1.646125610774879e-01   +7.820987739818166e-01   +5.499654008928595e-01   +3.827230467131300e-01; -1.859366852883894e-01   +4.469369407646410e-01   +2.281309956569790e-01   -9.766017829570006e-02   -3.508408026526803e-02   +1.456171409864018e-01   +6.340005370671448e-01   -4.129246945372528e-01; +3.659931182922809e-02   +3.625254109251291e-01   +9.839089294726389e-01   +8.073908302568396e-02   -2.116382817050126e-01   +4.170544978222919e-01   +2.366328552846059e-01   +1.721182180547959e-01; +5.133816362972613e-01   +8.610665299956601e-02   +4.141536640644127e-01   +5.186971486181676e-01   -2.938816472253267e-01   +5.554595909863835e-01   +4.843377070615150e-01   -1.659569200458194e-01; -8.260321608442271e-02   +2.058556378901818e-01   +2.416973863642485e-01   +1.161128637157918e-01   +1.567035054156008e-01   -1.692571072895415e-02   -4.033849790848983e-02   +2.328540645282576e-02; -7.213093856139724e-02   +5.338092200081310e-01   +6.038165906414100e-01   +5.889107943941693e-03   -1.880466248586347e-01   +2.978642021689121e-02   -6.023301396790939e-02   +2.337153498028552e-01; +1.641796571545819e-01   -1.725022664082359e-01   +4.203532808096744e-01   -2.019608145585703e-01   -3.021863848498298e-01   +2.366457109905363e-01   -2.245371874591501e-01   -1.080451831511158e-01; -1.529472368089067e-01   +2.858605844521688e-01   +7.546095927295442e-02   -2.495472476741967e-01   +5.975020981716335e-01   -3.005320158314744e-01   +3.026018342221470e-01   -6.226306670253959e-02; +7.761408988803203e-02   +7.574301307116382e-01   -2.769634098229464e-01   +1.065402034183148e-01   +4.200621648371009e-01   +3.265421751745257e-01   -7.079144964732338e-02   +2.202449712052225e-01; +1.724720525598527e-01   +6.488104901001679e-02   -6.529115726897128e-02   +2.774613791706164e-01   +9.622766584211782e-02   -1.895358173724838e-01   -1.973009296099907e-01   -8.385984171929622e-02; +1.665018090594108e-01   -1.960348947443654e-01   -4.981722880232297e-01   +9.039062624505691e-02   +3.266646627657487e-01   +3.622156630823397e-01   +4.667910622458166e-01   +1.410035695939496e-02];
L1E_L2E_iAMPA_netcon = [+2.497487450777843e-01   +3.987661036162757e-01   +2.524744451560170e-01   -2.921899001183040e-01   +4.411262742984922e-01   +2.095250022296265e-01   +1.198157846645368e-01   -2.937689757095044e-02   -1.501337936918945e-01   -1.967381273674617e-01   +4.860429059199447e-01   -1.718844892924190e-01   +1.914151197878695e-01   +1.485343599080239e-02   -3.074127757877068e-01   -8.761210318895028e-02; +8.362780668226279e-02   -3.230027782901156e-01   +5.140253420897991e-01   +4.025356566116367e-02   +1.025615631349032e-01   +2.103124251843020e-01   +5.206867877667692e-01   +1.728272251990463e-01   -1.879076149659171e-01   +1.228562732658613e-01   +3.297554820878040e-01   +3.385251017308988e-01   +3.650698832402643e-01   +1.984564849340021e-01   -7.436291975871911e-02   -2.830770098835634e-01; +8.455769215204929e-01   +9.013178408625620e-02   +1.006271045062091e-01   -3.331238912112309e-02   +2.481368029854423e-01   +1.640612535093238e-01   -1.656406872271317e-01   +2.610260178819653e-01   -2.655402126809676e-02   -4.236710583230682e-01   +6.548006438049979e-02   +3.376504392369838e-01   -6.761350240879191e-02   +5.223426126605192e-01   -2.829385349322311e-01   +5.719454911500454e-02; +1.386472146164838e-02   +1.139608629745834e-01   +7.815290356903658e-02   +2.841518962396788e-01   +1.584125879794696e-01   +5.989542356986068e-01   +9.488181381867534e-01   -2.524688444569749e-01   -2.738822778849180e-01   +3.985701910887045e-01   +5.021410606982745e-01   -2.128553745759196e-01   -3.407020401453265e-01   +8.695909020529842e-01   +3.874671386863001e-01   -2.610973470500045e-01; -7.163910748584615e-02   -5.488103692956763e-01   +2.130412694978265e-01   -1.064684816859562e-01   +1.869183353283169e-01   +2.724103855788784e-01   +3.847496123748288e-01   +6.553390510345823e-02   +4.163712464347031e-01   -4.495281705437724e-02   +4.667439226167479e-02   -4.916589244995263e-01   -3.002421714784018e-02   -6.060005795752622e-02   +2.784979761512987e-01   -2.056383749751682e-01; +1.644571063370381e-01   +4.596776951022450e-01   +8.745324421364317e-02   +6.409883469181097e-01   +9.634053207947538e-02   -2.823592872491021e-02   +8.431216512537727e-01   -3.876523445674132e-02   +3.093994032302165e-01   -1.150821271808831e-01   +4.679618324166216e-01   +8.257917115480959e-02   -7.005040431787146e-02   -1.192022785440612e-01   -3.704142043609838e-01   +6.454220474730528e-01; +2.146395508923271e-01   +1.704327980203227e-01   +8.368251946995975e-02   +1.348845377515528e-01   +1.853909323280082e-01   +1.555028747975533e-01   +3.506926364745714e-01   -4.630939822857936e-01   -1.136812100224736e-01   +2.559478712837944e-01   -2.210429114421320e-01   -7.724954094290615e-02   -4.523130562001300e-01   +3.721550411774489e-01   +5.203894423126538e-01   +2.846948395794534e-01; +3.991509796866571e-01   +3.593873165695086e-01   +5.513731047627509e-01   +7.071982368039630e-01   +2.563922051149278e-01   +6.024628607933967e-01   +2.545523001658740e-01   +1.734489905948146e-01   +2.573727860885637e-01   -3.044503100740698e-02   -3.148399444257275e-01   -1.368690837768179e-01   -5.395912969139198e-01   +3.972405576781601e-01   +1.716706190740905e-01   +4.258471033445885e-01];
L2I_L2E_iAMPA_netcon = [+2.432684359772379e-01   +6.408067305648919e-01   +1.744381037789482e-01   +9.912030355806253e-02   +2.843874150833276e-01   +5.134329381717992e-01   -2.724328530520145e-02   +6.756131666586155e-01; +7.199362879879183e-01   +1.923213631356296e-01   +6.171965309006594e-01   +7.224833520426932e-01   +4.029713240567561e-01   -1.193877430643912e-01   +2.276233547663454e-01   +2.101040927137557e-01; -1.004942829691524e-01   +2.184383579752131e-01   -1.799715147928769e-01   +1.396710574242174e-02   -8.872314574399429e-02   -1.369493580757859e-01   +2.819455429588478e-01   +1.891554173754598e-02; +2.440228991219702e-01   +2.627716854120499e-01   -4.549631023732580e-01   +1.721129885925745e-01   +6.179645495578812e-01   -1.052435975455931e-01   +3.870753383770451e-01   +2.369948178346690e-01; +3.126914730180879e-01   +1.039165866405981e-01   +1.440740790072229e-02   +3.821220976853715e-01   +7.235001047577557e-01   -3.087527155511282e-01   +3.228611041890145e-01   -1.003585097068213e-01; +4.865808332245490e-01   +2.498918500546684e-01   -1.207592920372289e-01   +3.652481679221178e-01   -1.865455786286263e-01   +1.284834304714999e-01   +9.483245889894670e-02   -6.247902851157504e-02; +4.302378872569397e-01   -6.069392660504286e-01   +3.927172273909849e-01   +4.944933516108123e-01   +1.600271126053784e-01   -3.694262982886785e-01   +9.004998519155138e-01   -3.206076426453178e-01; +2.466723831484974e-01   +5.882517170403183e-02   -6.399240218981123e-01   +3.567093536605479e-01   +3.808070240617674e-02   -1.945532365893473e-01   -3.111470015522431e-02   +6.380258576273609e-01];
L2E_L2I_iGABA_netcon = [+2.148854761360830e-01   +2.742664820970613e-01   +1.948618871995624e-01   -4.333839065507423e-01   -2.178367807074277e-01   +9.667193128244937e-02   -6.733974770254401e-02   +7.326587302728681e-01; +2.511963589285722e-01   +1.398555260344159e-01   +2.294307169741866e-01   +9.948379171078719e-01   +7.782361336147026e-01   +1.575359418143337e-01   -3.565824757704714e-01   +1.398069981359779e-01; +1.967482325823752e-01   +6.645919399100825e-01   -4.627699147893255e-01   -5.258008285689316e-01   +2.846637932732272e-01   +7.072164475692735e-01   +1.266542631518563e-01   +2.148757282742864e-01; +1.710056332917202e-01   +5.464233770906014e-01   -6.180144917494051e-02   +6.800479058820001e-01   +9.873176456269687e-01   -5.451305812245967e-01   -2.141521016637245e-01   -1.597949047668303e-01; -1.081667370906363e-01   -2.270564503390846e-01   -2.700524287620520e-01   +2.540060552205472e-01   +8.586433729715748e-01   +3.555833399913959e-01   +1.431890294387610e-01   -2.849415077813020e-02; +8.773402884580929e-01   +3.774739436040787e-01   +3.581771745740215e-01   +5.341675141425691e-01   +4.272055666344376e-01   -3.574278046550575e-01   +5.653940911900310e-01   -5.293425108080275e-01; +1.671434469228797e-01   +2.160707268173667e-01   -4.946810547876836e-01   -5.478234755252417e-02   +6.619280333193094e-02   -5.054654922668229e-01   +7.849327015735609e-02   +1.000000000000000e+00; -5.633104278597937e-02   +3.817608306590495e-01   +3.936767542076001e-01   +2.792546599309365e-02   +4.327187374566875e-01   +5.033794377221024e-01   +2.381731156151313e-01   +5.312101517381465e-01];
L3E_L2E_iAMPA_netcon = [+4.320097324655380e-01   -9.964637623039854e-02   -1.785675193968873e-01   +3.152319239645686e-01   +5.047614652793222e-01   +3.280741154895450e-01   -3.696414421232086e-01   +8.028024699952447e-01   +2.617614596846917e-01   +1.601306194257720e-01   +3.123870120997423e-01   -6.185887746647346e-01; -3.311781200122323e-02   +1.920616581917997e-01   +5.556602254009457e-02   -2.469933033650377e-01   -3.029254649838721e-01   -2.684755675478558e-01   -3.644773104686665e-01   -1.055960070653607e-01   +1.758358074688793e-01   +4.047729057058088e-01   -2.789713373644607e-01   +7.060725894409788e-01; -3.406609642604245e-01   -3.214005487895329e-01   +5.036554307047445e-01   +2.938203704957649e-01   +2.334014441061118e-01   -2.807226395804628e-01   +1.033356936604752e-01   +2.229406831315646e-01   +7.005949362023292e-01   -4.789189065945795e-01   +9.657418106750716e-01   +5.423580965904874e-01; +3.401194522111908e-01   +3.451077634221856e-01   +8.733680823514908e-02   +1.627238027464960e-01   +4.191644159929327e-01   +2.852064027505516e-01   +3.355571910283670e-02   +5.523213840403691e-01   -9.322462186053207e-02   -2.181090536051845e-01   -2.834279108952965e-01   +3.460725580558540e-01; +1.392442034483312e-01   +4.862959001507266e-01   +3.744451737021320e-01   +2.896063375338697e-01   +4.729645452087058e-01   +4.386189658286256e-01   -1.373976803339066e-01   -1.058395885344295e-01   -1.266528314499305e-01   +5.310984333758151e-01   +3.691143427966049e-01   +4.999635455298662e-01; +3.095767000789777e-01   -3.608261687199958e-02   +2.903401119607119e-01   +2.754409687493263e-01   +4.811359710413267e-01   +6.456119583239108e-01   -4.022292601412493e-01   -2.398239281017075e-01   +1.214076875945954e-01   +2.900451628146625e-01   -2.009190249490266e-02   -1.842671080223501e-01; +3.936160165373739e-01   +9.799896535819341e-02   +1.219818970001170e-01   -1.505475801462988e-01   +2.210093689720701e-01   +4.606047217925173e-01   +6.925740900287622e-02   +3.584298287207578e-01   +3.164971715172053e-02   +2.601187964687794e-01   -9.270816671835283e-03   +3.089609930200246e-01; -1.390250436924351e-01   +7.880547049377384e-01   +1.342590955802406e-01   -5.671203724540157e-01   +4.282378262454850e-01   -3.353625223763483e-01   -5.297981241856035e-01   -2.381048599736206e-01   +3.913945617733260e-01   +2.580094817777499e-02   +2.768319167897089e-01   -7.431103041847648e-03];
L3I_L2I_iGABA_netcon = [+9.617785295620606e-01   +6.174000216901822e-01   -1.793221705585499e-01   +5.914137046130682e-01   -4.620066493849319e-01   -5.338137845765006e-03   +8.635481234587199e-01   +5.743609760044912e-01   +3.852775309708180e-01   +1.704390873415859e-01   +6.297638300634682e-02   +1.664952058741212e-02; +5.459631379022251e-03   +2.065164373578596e-01   +1.028360674148745e-01   -4.147618953579011e-01   +4.092024208599627e-01   +2.206389890452856e-01   -1.974587965839285e-01   +2.164545962659865e-02   +1.902077004578754e-01   -2.350768777497552e-01   +3.377965093019908e-03   -1.780360896947099e-02; -2.666026053680010e-02   +1.511063468004836e-01   -9.528652548926070e-03   -2.789735366907681e-01   -1.947639652402718e-01   +3.922223567482997e-01   +2.573659269247383e-01   +1.798695784418393e-01   +6.204790444606435e-02   -8.997834152654709e-02   +5.087921904065807e-03   +7.881444035113658e-01; +4.678898069576958e-01   +1.823503060409252e-01   +5.401721485121528e-01   -8.532637983528166e-02   +1.663763524883427e-01   -5.326658408393827e-02   +1.184702691080458e-01   -1.329955264896300e-01   +3.597153576054519e-01   +6.475310039901063e-01   +5.013400610658414e-01   -3.950416520279705e-01; +3.084835049755855e-01   +2.500365234836540e-01   -2.135748157888991e-02   -1.522345053524301e-01   +3.288466387035998e-01   +5.946900421275239e-01   +2.520090753210073e-01   +5.605879730195337e-01   +4.405507567935871e-01   +2.130677200510931e-01   +2.521668051383590e-01   +1.412203688941268e-01; -1.049930257395973e-01   +4.920172490745341e-01   +6.346542894349513e-01   -5.162603929406251e-02   +1.892132979830380e-01   +1.439966489212666e-01   -2.009926800226507e-02   -1.980482811794338e-01   +3.432924598579100e-01   +1.536151962808470e-01   -6.440826032238719e-01   -6.693370474491669e-02; +3.426260228207310e-01   +4.235019741234920e-02   +5.087284418765808e-01   +2.474280798581882e-01   +5.448883764771116e-01   +7.621776580303236e-01   +3.081787563571100e-01   +1.276681183043605e-01   -6.518334728655477e-01   +3.870872316093268e-01   +3.429416974339946e-02   -3.747046476388065e-01; +1.136687824853850e-01   +3.521724451110335e-02   +4.190432222793941e-01   +8.420793437055803e-02   -1.715945924123639e-02   +4.813077258076676e-01   +6.293381647404740e-01   +4.902200798940446e-01   +4.524574259196497e-01   -2.790565166853696e-02   +1.891067627652917e-01   +2.631066796387826e-01];
L2E_L3E_iAMPA_netcon = [+2.583149147592064e-01   +1.696107119299429e-01   +6.848893198665537e-01   -5.944828867233882e-01   -5.171952042684740e-02   +4.259390075104078e-01   +5.939316171122591e-01   +5.095343387892157e-01; +2.272375612880140e-01   -9.515438235577132e-02   +8.545655585934078e-02   +3.908235039311703e-01   +6.247917765199129e-01   -4.488359455666631e-01   -5.294931642074420e-01   -5.509002376134855e-01; -4.517309140818830e-02   -2.394487061057022e-02   +1.712242266416275e-01   +2.519536308529701e-01   +6.240661765312494e-02   +4.688781641669026e-02   +2.390446022674734e-01   -2.511321517700112e-02; +3.962170243224380e-01   +5.893327859388485e-01   +7.607332206063493e-01   +9.553796999948542e-01   +2.128928118611162e-01   +5.044632671336152e-01   +4.699908131818711e-03   -6.345803330202530e-01; -2.069798438556085e-02   +2.227898866709983e-01   +9.874184125191982e-02   +5.530135281257658e-01   +8.389829603128347e-02   +2.507905831422941e-01   +5.635905974423001e-03   -3.859501600180213e-01; +6.836642043165765e-02   +4.233416654346065e-01   +5.215786555588960e-01   +6.715593353182011e-01   +1.827496918374699e-01   -3.058400663737169e-02   -2.303484826902673e-01   +2.677560204462551e-01; +1.751349295309455e-01   +9.054969069978684e-01   +4.370561226891092e-01   -2.521539945054355e-01   +2.241050386275656e-01   +1.143647987922621e-01   +2.772166166038513e-01   -2.431270477939057e-01; +3.817095417368205e-01   +4.613035129584596e-01   +2.283885043566815e-01   +1.954995181560361e-01   -3.367232037503629e-01   -1.381696889885008e-01   -1.755895030316992e-01   +4.749618363475241e-01; +1.736601742295489e-01   +6.514341157275716e-01   +6.984844275343274e-01   +7.304799972631452e-01   +6.625690570748137e-02   -8.771282072365721e-02   +5.233180526122347e-01   -1.940604519385828e-01; -1.798756788961368e-01   +4.337745711805791e-02   +3.867500880716362e-01   +6.950221355452640e-02   +1.527901241841334e-01   -4.271803786226867e-01   +2.278812489840311e-01   -2.050824156561525e-02; +5.424559648859586e-01   +4.119803138943054e-01   -1.253966362959737e-01   +5.839507968794007e-01   +3.183769603721117e-01   +8.484531220222321e-01   -4.410518787246235e-01   +7.962210293546762e-02; -1.521653896971262e-01   +4.313019761999162e-01   +3.469067833623651e-01   +1.068673687052891e-01   +1.933865474248901e-01   +4.215351923263347e-02   +1.210823028406427e-02   +2.326214032080086e-01];
L2I_L3I_iGABA_netcon = [-1.066060095127333e-01   +5.541134335481608e-02   +1.773433785685541e-01   +1.820670617497539e-01   +2.579089625129344e-01   +6.755702959910375e-01   +3.514263188817450e-01   +3.250734840147542e-02; -2.229327228470632e-01   +1.585353981487800e-01   +5.533708224846703e-02   -1.028401314807504e-01   -6.456162122904677e-02   -2.474361590287766e-01   +3.054840450481210e-01   +2.366106545080085e-02; +2.461337977006607e-01   +9.924186455677371e-01   +1.404603923755729e-01   +2.308279135642234e-01   +8.248308750614569e-02   +6.444378948256867e-01   -1.831245900977203e-01   +1.422327021429110e-02; -2.653989728269273e-01   -5.393221902033353e-02   +9.247005649946829e-01   -1.133498049595177e-01   -6.504868862294408e-02   +5.588883416170642e-01   +5.858323369552432e-01   +2.586213540141915e-01; -2.599533551954187e-02   +2.380609809944825e-01   +4.370884780154450e-01   +2.804553594731037e-01   +1.633967373005500e-01   +3.527286265614293e-01   +3.660697036109116e-01   -8.263633520838203e-02; +2.029208802407550e-01   +5.190671966364860e-01   +2.473845790884360e-01   +1.048036037104402e-01   +4.316459147162022e-01   +3.537644758003561e-01   -1.059749729114107e-01   +1.385746455424556e-01; -9.445054834591531e-02   +6.543561105094376e-01   +3.000832277319082e-01   +1.055106926790569e-01   -3.081441935590708e-01   +1.703837732500297e-01   +8.692282920920228e-01   +4.079595681068378e-01; -2.902298263812694e-01   +3.761840790836407e-01   +3.385038310151756e-01   +9.852097983949316e-02   -3.086395754386448e-03   +4.948749396404398e-01   +2.093900611748460e-01   +5.162046359628164e-01; -4.027629695562206e-01   +7.475152749150694e-01   +5.930353682357513e-01   +2.356243339327998e-02   +1.885724651696998e-01   +1.630250779731560e-01   +8.329447233299027e-02   +5.425139966679526e-02; -6.503248791393333e-02   -7.991390009111024e-02   +1.238858085695614e-01   +9.612797021860241e-02   +3.785812522842445e-01   +2.981640876260740e-01   +6.263956135090583e-02   +1.495049521392456e-01; +6.981228009101037e-01   +1.560565949209552e-01   -4.891596204259975e-01   +4.171894601112067e-01   +1.775123991186822e-01   -3.648845379506407e-01   +3.234489838659121e-01   +5.503508043865123e-01; -1.593702484343299e-01   +3.984600422708522e-01   -6.766309553976649e-02   +3.016619692857528e-01   +4.416423975517488e-01   +3.492806050974480e-01   +1.692801787073559e-01   -2.230815924431543e-01];
L3I_L3E_iAMPA_netcon = [+3.042824477174012e-02   -3.893554944619470e-01   +3.298415722575608e-01   +1.921633518062321e-01   +7.970150393095751e-02   -1.784655604179678e-01   +5.014877339674698e-02   +6.032506684451059e-01   +4.577585822182842e-01   +3.609722000717991e-01   +1.409840357526540e-02   +4.795048404236628e-01; +3.562975752060010e-01   -2.373044191169177e-02   +2.732354283829299e-01   +6.939595312540595e-01   +4.122974343019029e-01   +3.393602321835966e-02   +3.869360581242647e-01   +5.602358031588555e-01   +5.633781447063763e-01   +4.651005758073375e-01   -2.188288413076408e-01   -7.851559525278426e-02; +3.460417594058736e-01   +5.218279455976027e-01   +8.137921375961064e-02   -5.443960068292171e-02   +9.429172524051956e-01   +4.914486556432180e-01   +4.583520676921268e-01   -1.656007397208025e-01   +3.317435738226359e-01   +1.239580749649902e-02   -7.700736393210500e-02   -2.823710577570871e-02; +2.830970712040194e-01   +1.050044153560671e-01   +2.048565656380095e-01   -1.965850158741839e-01   +1.180842812717760e-01   +3.315373299113576e-01   +6.078955082313560e-02   +3.434603169340996e-01   +2.476080419627685e-02   +1.977529572314637e-01   -2.178379928429453e-01   +9.351345281352022e-03; +4.172239900648026e-02   +3.579768230939622e-01   +8.491520423248566e-01   +5.814849108980261e-01   -6.211964248105686e-02   -1.690516235197150e-01   -9.259945991954001e-02   +4.350416168505956e-01   +3.971619509268871e-01   +7.907597208005120e-02   +1.889592532064506e-01   +1.399388492333961e-01; +1.511840328658591e-01   -7.913397484027263e-02   -2.626596813087640e-01   +5.198721297693455e-02   +5.523281392920393e-02   -8.233451926191732e-02   +6.537645124991212e-01   -5.592373479493183e-02   +1.773285260181670e-01   +7.259490670750066e-02   +7.595470601793854e-02   +6.549945758302438e-01; +1.705513635747075e-01   +1.227507527417333e-02   -2.681302925864169e-01   -9.849500180466494e-02   +9.804453416960628e-02   +1.137147335233094e-01   +3.622897209014270e-01   +9.705592483894855e-02   +1.925002017944835e-01   -9.659133637873216e-02   +1.252727263699362e-01   -9.047307079695752e-02; -1.734569762530614e-02   +1.886050853350981e-01   -2.543553837499338e-01   -1.922836877455829e-01   +4.075976766763035e-01   +4.196468531259810e-01   -4.512902489300148e-03   +3.408788155765063e-03   -2.042881815171005e-01   -2.333232646159885e-01   -2.008171072606900e-01   +2.994198112863592e-01; -4.972443952353864e-01   +6.086045649810724e-01   +5.358517983938450e-02   +5.743852021007032e-01   +6.799320566729497e-02   +4.287371834188047e-01   +4.970195275578871e-01   +4.698319503829154e-01   +1.101479168322681e-01   +1.513424881653200e-01   +3.027719843179631e-01   +6.104099175236281e-01; +8.754924760740134e-01   -6.026791909577190e-01   +7.590192743379111e-01   +8.963914911259607e-02   -1.218378101144974e-01   -1.645016593963608e-01   +2.858041236164185e-01   +1.552426765216746e-01   +3.659788189230458e-02   -2.734110363196494e-01   +5.942903028602492e-01   -3.874374963177396e-01; -2.823278719703390e-01   +4.159355424248730e-01   +4.094724875089313e-01   +2.251697337564418e-01   +1.614359727578913e-01   +1.014528946059140e-01   +3.226604535776498e-01   +3.638185557656833e-02   +6.030698102383607e-01   +1.515521697575638e-01   -2.731261577641816e-02   +3.239026153332250e-01; +3.161217356168911e-01   +3.652201147240653e-02   -1.832780910006133e-02   +6.111037511493727e-01   -1.341922722831913e-01   -2.603392913774054e-01   -4.193518325776319e-01   +2.276770869300939e-01   +1.775199784895140e-01   -3.365056526565046e-01   +2.598119710238118e-01   -7.712436552263988e-02];
L3E_L3I_iGABA_netcon = [-1.449638494512727e-02   -3.094890652449926e-03   +3.308200332138426e-01   +3.431449293435648e-01   +4.176861671651064e-01   -2.202154032654254e-02   -4.075491308517175e-01   +1.983988491450507e-01   -1.742035575741213e-01   +6.161741661049310e-01   +2.588412256349746e-01   +1.534750522729352e-01; +1.785848082374158e-01   +5.709888596830816e-02   +4.751459791640510e-01   +2.877259393491322e-01   +4.397532090969289e-01   +1.682414293803860e-01   +2.457019666353973e-01   -1.600137044622719e-02   -5.705712321942976e-01   +2.192400219173095e-01   -6.190624188158658e-01   -1.175688879601181e-01; -1.086282129986201e-01   -1.325515190595556e-01   -4.223616816983003e-01   +2.987867106159273e-02   +9.485359148404207e-02   +2.627107075296281e-01   +4.791686009601849e-01   +3.933554344271716e-02   -1.956284960613747e-01   +9.281754465818953e-02   -2.614138377223709e-01   +9.096510643608567e-02; +3.255956675585889e-01   +8.517990146818877e-02   -2.968950473168437e-01   +7.983743262540949e-01   +8.500418377229539e-01   -1.880737102668173e-01   -1.158275430824215e-01   +9.100120548270112e-02   +8.999971623164130e-01   +5.207554934057871e-01   +2.390428385992150e-01   -3.086970413337011e-01; +2.109076507566647e-01   +1.704534437728882e-01   -2.647281929822544e-01   +1.787059352310237e-02   -4.161831322399175e-02   -2.488188452361816e-01   +2.714159373028025e-01   +3.604575697591464e-01   -3.386259372900187e-01   +7.125028518444870e-01   +3.710224008175227e-01   -1.708931000551218e-01; +3.791642543659809e-01   -3.263244913001890e-01   -2.146047144309719e-02   +7.194390120661558e-02   -3.594077197369681e-02   +6.879385843159858e-02   +4.239328813940590e-01   +4.591668830330220e-02   +3.198136685503893e-01   +1.506418656632466e-01   -3.396799059857557e-02   -3.685006755377571e-02; -2.041776148437310e-01   +7.794280973264903e-02   +2.216972390845835e-01   +8.737129675577063e-01   +1.661001036852870e-01   +4.480816388906279e-01   +3.699456288738767e-01   +5.965651902616057e-01   +1.119099335865396e-01   +2.664630361301107e-01   +3.246436158685405e-01   +3.328089415719027e-01; +1.819377050324852e-02   +5.142984724345322e-01   +6.192810711340879e-01   -4.639668416586731e-02   +1.624497706634712e-01   -4.347493620061320e-01   -6.224185727053152e-01   +5.629929544633621e-01   -2.607471009823249e-02   -2.825080822658799e-01   +5.531552798271938e-01   +2.266401945179599e-01; +6.064303080094375e-01   +2.421128996880760e-02   +4.749523214846086e-01   -1.666332614334190e-01   +3.673555930373149e-01   -6.817325424450345e-02   -7.632261426715234e-01   -3.986016771495636e-02   +4.611481669508558e-01   +2.404295805149695e-01   +5.726743878421309e-02   +4.457422214147632e-01; +1.871691893695609e-01   -9.779406469350080e-02   +4.730789860923999e-01   -4.893701607754096e-02   -7.534958403324702e-01   -6.998755066256590e-02   -4.141125235877193e-01   +2.504512741725552e-01   -7.351272151519914e-02   -6.539867263110946e-02   +2.174960628740290e-01   +1.679376150555844e-01; -3.997828580479221e-02   -3.139279146505724e-01   +2.723064497110836e-01   -7.046614291775809e-02   +5.369771458491167e-02   -7.151987833463304e-02   +2.468869615684038e-01   -1.353099124484802e-01   -2.761593958249271e-01   -2.833682680292159e-01   -4.863930608460170e-03   +3.335524910392196e-01; -6.591847144277636e-02   +6.836453870362517e-03   -4.791849456472519e-01   -1.202733222104825e-01   +9.806960807625100e-01   +4.986347029947587e-01   +4.818622559462338e-01   +3.044725766986737e-01   +9.286916918994510e-02   -3.455126122105401e-01   +2.707969882898398e-01   -4.231859811442588e-01];
L2E_Input1_iAMPA_netcon = [+7.925714004273127e-01   +1.000000000000000e+00   +7.117820182535153e-01   +3.936812266908086e-01   +4.580975053834457e-01   +2.758068262667770e-01   +8.153784733527694e-01   +5.247239902771743e-01];
L2I_Input2_iAMPA_netcon = [+6.475533517314652e-01   +6.875591602469008e-01   +4.994855991614729e-01   +1.903726970935108e-01   -1.716621409051795e-02   +8.907966726994286e-01   -9.763722590341123e-02   +1.011642622767695e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA))))))))) + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.2*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA)))))))))) + 0.2*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.2*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA)))))))) + 0.2*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA)))))))) + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.2*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA)))))))))) + 0.2*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.2*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA))))))))) + 0.2*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
