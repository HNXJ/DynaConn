function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-7.839380381884560e-01   -6.585757437430840e-01   +1.818214168457413e-01   -2.195646644452922e-02   -7.124438833060087e-01   -6.388595494823250e-01   +3.977088516668278e-01   +6.963023777998014e-01   +6.832736308599020e-01   -4.089368532336702e-01   +5.333005080690464e-01   +2.533824719313952e-01   +4.325450490678322e-01   -2.623906164283197e-01   +3.739675547318072e-01   -1.226560416493579e-01; +8.374250669520756e-01   +7.703850241352179e-01   -2.699271376674193e-02   +9.388503358525344e-01   +5.620260334466707e-01   +2.123214824715002e-01   -3.909723059412321e-01   -9.092656844268464e-01   -5.156695322829314e-01   -4.081529390401160e-01   +8.005505160045723e-01   +5.645528992076541e-01   +5.445971717509980e-01   +6.958542136638428e-01   -6.491120023769612e-01   +5.597303592445749e-01; -4.265822553102566e-02   -2.441212318353039e-01   -6.589284574489701e-01   +6.790123891119448e-01   -6.878638732708525e-01   +8.573218334731801e-01   +8.661544350518641e-01   +1.426072208496373e-01   -8.145188338471103e-02   +1.004735488051309e-01   -6.508884473472650e-01   -6.821250421612152e-01   +3.454851391760054e-01   +5.034331709056872e-01   -5.360192428189878e-01   +7.039838037297722e-01; -8.066795379695831e-02   +2.522325839022252e-01   -9.784661826871801e-01   +6.233522595972495e-01   +3.400442487122950e-01   -1.040376010025437e-02   -1.043073886663384e-01   -3.033635784089913e-01   +6.433694179114428e-01   -3.330945980869588e-01   +5.774673576547302e-02   -1.299686393652018e-01   +7.109692892477416e-01   -1.688686497644149e-01   -6.749818611565239e-01   +4.292820677176223e-02; +6.235011956957165e-02   +3.658755520900000e-01   -1.947326486028720e-01   -3.266494817687342e-01   -2.952347965629196e-01   -2.676426596636650e-03   -2.948874682472602e-01   -2.657294139822005e-01   -6.198626480767816e-01   +2.903553710844162e-01   -9.016021610663172e-02   -4.504174654986338e-01   +4.222059666896152e-01   +1.323381137183505e-01   +5.085593668730946e-01   +9.870618184509536e-01; -3.089860051673315e-01   +1.743834753373010e-01   +6.593122181818543e-02   -6.820190816480667e-01   -4.331101597426977e-01   +1.554072369070836e-01   +2.746158272186737e-01   +7.594431122892050e-01   -1.898311181744661e-01   -6.399585091159274e-01   +4.908123677697313e-01   +2.165980778356711e-01   +1.628305065561422e-01   +5.541488712685788e-01   -4.034065236559550e-01   +2.083974927100508e-01; +3.773445094933736e-01   +3.316179176626288e-01   +7.958628825635198e-01   -1.949069310014117e-01   +4.157974861155447e-01   +1.665030732418408e-01   -3.395375361229376e-01   -4.089595032958583e-01   -6.454903255922123e-01   +1.797012770650400e-01   +9.462343503428394e-01   -5.521784187917332e-02   -7.592182698820380e-01   -5.208925272109618e-01   +3.611980782214666e-01   -5.758934839446123e-01; -1.496109916987740e-01   +4.713745475057537e-01   -3.751441022721168e-01   +4.641439819749626e-01   +4.148661263353278e-01   +4.775762272687069e-01   +7.848892162489159e-01   -8.552017777705450e-01   +3.166920653736918e-01   -4.527330702594357e-01   +3.339821636286380e-01   -3.836271197930514e-01   -4.430806966491641e-01   +5.805258911863754e-01   +4.779707973395178e-01   -4.519954621562045e-01; +9.798134925094706e-02   -2.563754908120000e-01   -7.623064669112398e-01   +5.343573608907852e-01   +6.704557541379943e-01   -6.024248755477870e-01   +6.989833248267845e-01   +1.522533797602512e-01   -5.611305680857761e-01   +6.803453312821534e-01   -9.430903356181300e-02   -3.359475078162230e-01   +2.874169752642694e-01   -3.501718031449984e-02   -7.328114994827001e-01   -4.479644788977292e-01; -3.832903766353917e-01   -4.891911302042835e-01   +4.074933256106293e-01   -4.742235355208786e-01   -4.093541787898567e-01   +3.576740475098848e-01   +6.066165025377387e-01   +6.704089916130346e-01   -2.189126808228301e-01   -7.086188124746150e-01   -1.188403242348125e-02   -4.796239536466609e-01   +2.897053094058264e-01   -7.840843909694728e-01   +6.208001414798232e-01   -7.780487137108695e-03; -1.999668562528552e-01   -4.967652920152600e-01   +6.734145276843646e-01   +1.931648067807496e-01   -7.999026893613337e-01   -4.825710988803454e-01   +6.199235886272594e-01   +5.355506372143616e-01   +4.469875194339575e-01   -8.099678856100669e-01   -5.964222015833697e-01   +6.418423004772609e-01   +6.611975840548795e-01   +1.139348349307722e-01   -3.926830752799516e-01   -1.335963891177675e-01; -3.108152530253050e-01   +2.004538191140057e-01   -4.318412236637853e-01   -7.337259814991629e-01   -5.809866682293744e-01   -5.280490526440781e-01   -5.226002318336063e-01   +8.986431040669808e-01   +3.852907631102184e-01   -3.025363565523176e-02   +5.472320644433412e-01   +6.003542297592457e-01   +8.185440568658275e-01   +9.792092163663423e-01   +3.883247508059578e-01   -1.644472008581285e-01; +3.379659202150457e-01   -5.713137668423716e-01   +4.529010901593481e-02   -4.307548069213905e-01   +7.911356209561761e-01   -6.637417623845040e-01   +4.991061089033145e-01   -5.605358506870676e-01   -5.432617562786732e-01   +2.022763380527480e-01   -2.978309669928389e-01   +8.375247663276351e-02   -4.737359650453077e-01   +6.019448048168272e-01   -1.596235787069677e-01   +2.683487086649401e-01; -4.600976534186034e-01   -8.274915824973891e-01   -1.275961319957631e-01   +7.577931286670613e-01   +4.368201924924301e-01   -7.630837599811435e-02   +2.521481813669373e-01   -7.294572070351014e-01   -2.714119805312308e-02   +2.390028903113125e-01   -9.638418515068331e-03   -1.489557378905426e-01   -2.112670451267616e-01   +7.881134291733101e-01   -2.865181995583440e-01   -3.945357148284039e-01; +6.825320927471719e-01   +1.875501168451633e-01   -5.123594903239777e-01   -2.184561960182972e-01   +1.487319854748756e-02   -6.385539747072093e-01   -2.979816154592642e-01   -4.235587236366208e-01   -2.192380824867730e-01   -2.486288412634173e-01   -3.594316604488795e-01   -1.471800715513930e-01   -7.977630604034668e-01   +1.829808892491362e-01   -4.028173014360553e-01   -2.288275200953570e-01; -1.548057968082039e-01   -4.017945226638679e-02   +5.712532706951701e-01   +7.368215071773371e-01   -7.120522534524876e-01   -1.805214904526440e-01   -1.000000000000000e+00   +1.123168677654042e-01   +2.078117063986593e-01   -1.337497394117675e-02   -2.384703672638173e-01   +6.296849498854539e-01   -9.168405279362992e-01   -7.597457225874409e-02   +6.436340033566774e-01   +8.438072282506459e-01];
L1E_L1I_iGABA_netcon = [-4.483763987916290e-01   -1.120626332663001e-01   -9.245441542846057e-01   +1.632049934119357e-01   +6.209735282784121e-02   -1.351944331525184e-01   -3.747554180147716e-02   -7.386477350591436e-02   -5.607026705160607e-01   +7.532614507582113e-01   -3.112294507264243e-01   +8.091500752768892e-01   +3.457782131011720e-01   +4.105287948166982e-01   -2.841072648766858e-01   -2.598328971442251e-01; +5.363683165945340e-01   -5.370922228878466e-01   +3.244008698315734e-01   +4.203674757015294e-01   +6.169380323586927e-01   -2.320582324720103e-02   +4.009876973602075e-01   -2.375035057986508e-01   +4.535734166645837e-01   +4.428005474197372e-01   -1.296883789139444e-01   -4.198984120669935e-01   -3.493196660542597e-02   +3.102281527563019e-02   +7.041047614374587e-01   -5.686494989322075e-02; -2.893581539579434e-01   +4.120800283079892e-01   -5.672318125820287e-02   -7.025771896745314e-01   +6.560891014459365e-01   +6.527188840792193e-01   -1.586250544812194e-01   -3.889701555865059e-01   -3.051971187734255e-01   -4.694234386871380e-01   -7.539760696468463e-01   +6.610336354672139e-02   -7.826457905545420e-01   +4.603229678953102e-01   +4.842211435958539e-01   -3.840585386737518e-02; -2.418685029421525e-01   +9.282953010209434e-01   +5.929757874593858e-01   -5.467936695622646e-01   -8.100173346954388e-01   -5.303958998026923e-01   +4.151100644004844e-01   +1.895746584214492e-01   +5.238534524237019e-03   -6.844027870924493e-01   -6.139839963941136e-01   -2.750205182584110e-01   +5.761543199590911e-02   +8.403540127296846e-01   -6.976084697860779e-01   -5.999712606157803e-02; +1.443671315922397e-01   -7.106272053013908e-01   -1.989048198157140e-01   +5.348240521782953e-01   +1.566958267940085e-02   +7.242693481699738e-02   -2.488636488555510e-01   +8.561233190500589e-02   +6.487322047720774e-02   +6.270597760285509e-01   -1.000000000000000e+00   +6.804384473084988e-01   +9.240925419620762e-01   +4.890080965970689e-01   -2.705823207010734e-01   +6.964422446341058e-01; -6.022023227635769e-01   +5.158521683887822e-01   -3.607002243414788e-01   -4.239562955036788e-01   -3.411225490414734e-01   +7.338322460507964e-01   +5.540744197667455e-01   +1.474558315288321e-02   -6.718261968626463e-01   +5.739563893822673e-01   -2.761324075474549e-01   -2.739154927439349e-02   -2.364462623856559e-01   -4.515404867076721e-01   -3.793302748106827e-01   +5.018115460516863e-01; -2.716670274554505e-04   -1.731743070317615e-02   -1.000611651641991e-01   -6.230772153543820e-01   -1.774072088628901e-01   +4.809614299911195e-01   +1.017076108428677e-01   -4.837850980537473e-02   +6.039465026236619e-01   -6.780943185345997e-01   +2.455132952586593e-01   -2.061164303408319e-01   -7.568620743578960e-01   -3.670951695132740e-01   -4.929978800922641e-01   -3.443593073585711e-01; +2.558108397224159e-01   -7.132120654532140e-01   +7.408045328227156e-01   +6.847120321312193e-01   -6.159358251723510e-01   -6.324693158822602e-01   +3.791430467601801e-01   +2.152629341828116e-01   -6.989945969302372e-01   -4.878450382323664e-01   +5.308974969802165e-01   -4.384026458961215e-02   -1.950513082118332e-01   -3.156621120292000e-01   -8.671584221493904e-01   -9.085574065850490e-01; -3.807190182702397e-01   -2.864401227867799e-02   -1.409888515122028e-01   +3.728257228636723e-01   -1.761680598765711e-01   -3.963497233553639e-01   +6.675596804600784e-01   -2.493702965287204e-01   -7.745208435300306e-01   -3.984242479453258e-01   -3.403841628473964e-01   +1.430552871076571e-01   +4.754014330943724e-01   -1.198973651424267e-01   -5.052844944491578e-01   +6.540295708137663e-01; -6.539581743987941e-01   -4.897959550739143e-01   +6.673003457710931e-01   -3.140168105015565e-01   -5.750760912088619e-01   +4.624800971124216e-01   -9.152031892107639e-03   -2.163525874538353e-01   +4.158194580366840e-01   -2.308374021449127e-01   +5.501155892025230e-01   +1.104130570843376e-01   -3.679497219614224e-01   -3.819468503329151e-01   -4.089365911066664e-01   +1.453312054059223e-02; +2.138865583318842e-01   -8.727866954553215e-01   +4.771622673690594e-01   -3.264941353225553e-01   +3.539227847600888e-01   -7.701825258826431e-01   +6.558493688089542e-01   +7.514585057752673e-01   -4.652813365477353e-01   -3.232889351229664e-01   -4.809695142457084e-01   +5.414987918563931e-02   -7.203096918282944e-01   -2.469115610926448e-01   +6.043305696373260e-01   +6.686438356168161e-01; +8.147575186779573e-01   -4.751297507850353e-01   -4.988237431911629e-01   +4.742717465382125e-01   -7.531300922310863e-01   -4.354981350663190e-01   +5.765360709097989e-01   -6.392419358304386e-01   +3.489118596181361e-01   +5.615770871769228e-01   +6.402594346377699e-02   +7.320167134362067e-01   -6.713995845713356e-01   +2.041051948363426e-01   +3.107508241684516e-01   -5.298609490584776e-03; -4.067520735251738e-01   +5.026404053946768e-02   -9.538394853779726e-02   +1.352701378490124e-01   +1.605187932742789e-01   -4.054810903683680e-01   -1.408208076796799e-01   +2.951170640540424e-01   +7.513445192050349e-01   +7.743594662656311e-02   +2.685598690039317e-01   +7.833687194725995e-02   -6.750831204951718e-01   -6.231795384061872e-02   -6.098078553131395e-02   +7.416257804951116e-01; -9.652525929458899e-02   +1.147889308923795e-01   +8.198902246127195e-01   +4.016431340192879e-01   +7.110411326369981e-01   +2.189299223409200e-01   -6.102155384662582e-01   +5.660689659036799e-01   +7.207012369753787e-03   +5.148501718369590e-01   +2.311762603104940e-01   +7.092981620887866e-01   -5.903322591716921e-01   -6.860549589436556e-01   -2.373228804807916e-01   +5.277710468698086e-01; +4.726980839304791e-01   +4.182143831701278e-01   -9.495866585082335e-02   -7.865664374281839e-01   -1.099764850846053e-01   +4.280877483538427e-02   -7.052230670925635e-02   +7.006360563251284e-01   +3.790129670084493e-01   +6.376822705128676e-01   +3.534790135652383e-01   +1.574945701330143e-01   +2.563236307455757e-01   +5.140033296981635e-01   -1.563335958314885e-01   -7.127296964887591e-01; -5.156062377056783e-01   -5.420803984839065e-01   -6.268178148863766e-01   -2.031271980402671e-01   -4.258264206109265e-01   -6.591601435202525e-01   -5.010552128761530e-01   +7.055880704982491e-01   +3.660509551979164e-01   -1.063255071142512e-01   +9.449655830051237e-01   -6.037565706010095e-01   -7.702120353584464e-01   -9.487917505685315e-01   -3.787933798372676e-01   -4.543836654508679e-01];
L2I_L1I_iGABA_netcon = [+8.968357809395817e-01   -5.706271500811648e-01   +1.186824991092644e-01   +5.076934370191047e-01   +9.274269999654430e-01   -5.620842001641244e-01   +6.936488853076121e-02   -2.464348915562498e-01; -5.630939816323213e-01   +2.641515895439939e-01   +1.446867685359303e-02   -8.377694467093645e-02   +1.054783002593387e-01   -1.929399590162909e-01   +6.174170859111586e-01   -8.733476804868165e-01; +2.369612194283482e-01   +3.205516387434199e-01   -1.221328742343370e-01   +9.677001814494151e-01   +1.102122775336541e-01   +2.216850407679485e-01   -7.405860544424181e-01   -8.650943706952122e-01; -7.887383075640572e-02   -7.719623264852810e-01   -3.577012236982839e-01   -1.226036889949711e-02   -6.951172843999329e-01   -2.627287504106215e-01   +6.773601026785503e-01   -6.758449385112772e-01; -1.963722439096476e-03   -6.151539857529670e-01   -3.447044740258416e-01   +7.923637906211488e-01   +4.083499641880111e-01   +7.619063204840438e-01   +5.715832881197925e-01   +5.965998621737968e-01; +2.373224847838830e-01   +7.311331168581529e-01   -4.642380913127622e-01   -5.013241452566081e-01   +3.449068896946994e-01   -3.184002694442991e-01   -4.358609577326414e-01   +4.751648554477560e-01; -1.379119959268844e-01   -7.442487863794170e-01   +2.426992142340763e-01   +6.694781990105764e-01   +8.284923439165641e-02   +5.249317393021926e-01   -1.000000000000000e+00   +1.939176762909016e-02; +1.788262802585696e-01   +5.782108411142409e-01   +5.642087460365253e-01   +1.914473865842877e-01   -5.185330031124834e-01   +4.548442054274428e-01   -7.987731037609198e-01   +6.442043167981608e-01; +4.030462156319743e-01   +7.001971498229352e-01   +3.360523651086898e-02   -7.294827427900398e-01   -4.109588288767906e-01   +3.310259929914851e-01   -1.500284657325100e-01   -2.206412035106274e-01; +9.076986453342483e-01   -4.185119137736121e-01   +6.394681120844050e-01   -8.014272933033328e-01   -4.631719261194527e-01   +8.335122795817647e-02   -3.356998009802595e-01   +6.071159159313706e-02; +6.227989886866834e-01   +7.353357989903034e-01   +4.838684889223970e-01   +9.057364481497058e-01   +1.647608352090854e-01   +5.795774207020972e-01   -4.607931401352462e-01   +2.023657713447074e-01; +8.793271750409416e-01   -5.203764046145990e-01   -7.570345957066584e-01   +3.996027844903372e-01   +5.909935952583850e-01   +6.556332276208363e-01   +4.087244971269041e-02   -4.747877536989824e-01; -1.780212018641538e-01   -8.866266804049050e-02   -2.031307881609066e-01   -1.941019141326978e-01   +5.761734715657520e-01   -4.581006041320371e-02   +5.421913191262687e-01   +1.406843889918249e-01; +5.280679034909330e-01   -9.050873638559914e-01   -6.214369956440214e-01   -6.606268167414406e-01   -2.366633291805659e-01   -3.988844052398954e-01   +7.583542737685959e-01   -5.261399269253627e-01; -3.756903962314664e-01   -5.138181698604671e-01   -5.929007277395771e-01   -3.762146349710220e-01   +7.127101695779332e-01   +5.202493385965162e-01   -5.181856604290074e-02   +2.435605048927179e-01; -4.430064747934351e-02   +6.536429875331424e-01   +5.324990923845069e-01   -3.603141048950180e-02   +4.896900332030254e-01   -4.746741560594235e-01   +4.900100406254191e-01   -2.289897437332704e-01];
L1I_L2I_iGABA_netcon = [+8.116375392982456e-02   +7.012290163164538e-01   -3.014139557871524e-01   -2.304809147874306e-02   +3.685894862298458e-01   -4.921238686789266e-01   +2.451218554006586e-01   -5.565951674734433e-01   -8.876351736423148e-02   +2.146217551828322e-01   -3.942689543626642e-01   -2.100965360116078e-01   +5.877219025710264e-01   +7.238280291986915e-01   +6.261270641077771e-01   +2.402739316087107e-01; -2.890652904723036e-01   -7.600536447495281e-01   +4.866961082753726e-01   +6.600815623827736e-01   -2.288698499703034e-01   +3.107757008103068e-01   +1.251358442900301e-01   +2.577320257577044e-01   +1.988138872533425e-01   +3.879649801280080e-01   -7.969316248716177e-01   -3.633725240667124e-01   -4.175243949080527e-01   -6.120454963377199e-01   -5.604070029788544e-02   +6.766276713872768e-01; +4.480291571746010e-01   +4.351145308595902e-01   +4.898137680653437e-01   +3.084744433321998e-01   +6.694972845154918e-01   -7.750381252462776e-02   +1.066280054077527e-01   -3.192979109160765e-02   +5.566901460529270e-01   +4.071846115118812e-01   +6.743748732493700e-01   -2.139540742982145e-01   -2.675601622267078e-01   -4.897260679686999e-01   -1.061176524162182e-01   +5.487639556575409e-01; -5.859745978974270e-01   -5.655401938001319e-01   +7.411232115617895e-02   +5.023905005946572e-01   +2.671618374722877e-01   -4.543176783012486e-01   -2.613358483579697e-02   -1.067793977938847e-01   -4.626632715983626e-01   +1.310780957718187e-01   +4.420063397633075e-01   -2.091539054701834e-01   +3.092882380146231e-01   +5.259119079856282e-04   +3.780173574835574e-01   -2.886776707686197e-02; +3.864641338658460e-01   +6.138667136215694e-01   -3.293696869064761e-01   +5.030289112604469e-01   +2.141191237766469e-01   +5.640235153381872e-01   +1.427436962530919e-01   +6.852980753158615e-01   +5.193571343850907e-01   -5.589748159417799e-01   -7.213662086128909e-01   +1.000000000000000e+00   -3.407399696253323e-01   -2.366451313897555e-01   -4.084623607415323e-01   +6.175808920798312e-01; +5.361872840116702e-01   +2.736082146398654e-01   +1.530242108775849e-01   -8.411271798701202e-01   -6.385246042815274e-01   -3.934843026882822e-01   -2.399819459023986e-01   -1.222820962771265e-01   +5.106143046948510e-02   +3.658053482653834e-02   +3.200294606520018e-02   -5.357912736057656e-01   -1.527012554872485e-01   -2.079111765681531e-01   +6.916594036256201e-01   +1.319709313250877e-02; +4.836998602805823e-01   -3.136118252565511e-01   +7.210525182674778e-01   +8.714544193545568e-02   -1.737663309079503e-01   -6.902358674026402e-01   -7.291011626025821e-01   -3.364633121520055e-01   -5.193586232825170e-01   +9.100348611903102e-01   +2.711584249197840e-01   +3.859943858763155e-01   -6.686475125447805e-01   +5.434438184481271e-01   -4.666796929560814e-01   +8.728980785563530e-02; +1.763374534850314e-01   +2.162724230031215e-01   +5.558587402068200e-01   +4.958814738656534e-01   +5.404907634372993e-01   +5.102614778439738e-01   -5.833676577262872e-01   -4.584161770007107e-01   -3.309494176184113e-01   -6.035859071605445e-03   -6.779780341115832e-01   -2.329899276910897e-02   -3.774767336917235e-02   -6.596077956827009e-02   +9.498201626589092e-02   -3.710054977703009e-01];
L2E_L1E_iAMPA_netcon = [+7.519068132202298e-01   -7.707315346436843e-01   +8.227283082181225e-01   +4.896307659107656e-01   +1.288881055563939e-01   -4.957449838601534e-01   +4.723984751443894e-01   -3.852378000897012e-02; +3.562538116369933e-01   -1.896583196566227e-01   +5.857434550935020e-01   -5.198283285790438e-01   -4.636033851509364e-01   -2.807042713475618e-01   +5.494178571562616e-02   -5.177230633180148e-01; -1.949715880047218e-01   -2.840109792982677e-01   -1.500485753371875e-01   +1.000000000000000e+00   +2.191459170110571e-01   -3.953889306705633e-01   +5.610471563642249e-01   -1.933730187333672e-02; -3.898703707882709e-01   -9.036828391386585e-03   +1.930755231619884e-02   +3.020984782971660e-01   -4.669018753834629e-01   -2.035242541889888e-01   -4.304169070396205e-02   -2.927150460201992e-01; +7.288678474768004e-01   -2.417665024055091e-01   +1.598100978936320e-01   -1.636650844413216e-01   +5.279313489191240e-02   +7.362899016684767e-01   -6.027181752481301e-01   -2.677231970829039e-01; -9.689863838644742e-02   +7.567022457585965e-01   -1.658279278952961e-01   +5.834757936719528e-01   +6.318884112912070e-01   +7.093721729177619e-01   +3.976482397280665e-01   -2.511486628170512e-01; -4.775785550298324e-01   -5.841657952722077e-02   -6.010025304772800e-01   +4.294470547918769e-01   +3.435425132194822e-01   -3.073778405208407e-01   +4.485143979410910e-02   -6.102519908274424e-01; +5.524355713880293e-01   +7.044354050706118e-01   +6.387496173347377e-01   +6.034425330720544e-01   +9.116630619158307e-02   +4.306801818996306e-02   +7.523108436003369e-02   -3.580559496376188e-01; +1.368710014151801e-01   -6.491312656430101e-02   +5.189394009110861e-01   -4.502019014837206e-01   +3.556504965257207e-01   -8.545694668571286e-01   -2.473983690210116e-01   -5.430432533816741e-01; +1.813033556824244e-01   +6.492682943921947e-01   -1.508982622588562e-01   +2.770896628429280e-01   +4.087304181408349e-01   +4.507981738092230e-01   +5.879978669712713e-01   -2.982121625110877e-01; -2.371000123510337e-01   -3.678439169524914e-02   +9.203972916124397e-01   +5.125692027165935e-02   +3.419096683520940e-01   +8.591312220110195e-01   -4.967087447495940e-01   -3.176882198272465e-01; +1.450730515525831e-01   +4.151300721965017e-01   +3.783859339081111e-01   +3.371079505652462e-01   +6.491638370388815e-01   +7.623789053659507e-01   +1.095686349951706e-01   +1.411611992388345e-02; +6.046861996906528e-01   +4.761935107049130e-01   +1.493221509035526e-01   +2.298448757510130e-01   +5.422382779190965e-01   +6.240764196688355e-01   -3.498008732746091e-01   +2.990554333536408e-01; +7.439133858798460e-01   +6.305688757360826e-01   -5.900289475208670e-01   +1.059725507101261e-01   -6.839870809038247e-01   -7.775698619098070e-01   +1.774483371456249e-03   +3.098752743841322e-01; +4.276714202155346e-01   -1.905228363662221e-01   +2.837638354459132e-01   -6.707099212625471e-01   -9.802968025172659e-02   +5.604875804391997e-01   -3.638995378455312e-01   -3.795959583627486e-01; -2.011741142185733e-01   +6.219319238842056e-01   +6.806792677097735e-01   -8.583353363093423e-01   +5.151613091161220e-02   +5.744217992385908e-01   -5.997596389924689e-01   -3.021288773324466e-01];
L1E_L2E_iAMPA_netcon = [+2.615818665114818e-01   +2.307914659918952e-02   -3.144412067060373e-01   -7.088972384465363e-01   -5.075393834312804e-01   -5.351245684557843e-01   -5.333478329256912e-01   +6.933669869342659e-01   -5.800582075046349e-01   +4.438261110303059e-01   -1.663588500192184e-01   -1.578583359314186e-01   -2.274601033802628e-01   -7.877477061706192e-01   -3.734954975564750e-01   +2.710162374395566e-01; +3.828227406933680e-01   +5.424705180742029e-02   -2.538110592964722e-01   +4.956815024117051e-01   +5.586154935596815e-01   +5.095623712111632e-01   -6.752357707337885e-01   -2.780797416540161e-02   -6.590303787737399e-01   -8.379226554689060e-01   +8.140904267162684e-02   -3.831218953402515e-02   -4.086279899594060e-01   +5.714644396776649e-01   -1.782202671618234e-01   -8.166890223181525e-01; -8.762324536795413e-01   +9.427279677194258e-01   -7.532103878089759e-01   +3.039566160049540e-01   +6.724478240150100e-01   +8.111458374217677e-01   -5.716233559645809e-01   -2.898923669261490e-02   +2.846926447147076e-01   -1.770860479917881e-01   +5.137044036260310e-01   -3.718171820460546e-01   +6.461591795502976e-01   +5.633716926826461e-01   +6.095150327286571e-01   -5.699566213199813e-01; +2.831921803758886e-01   -7.723144153316551e-01   -7.359711992412373e-01   +1.000000000000000e+00   -5.784111677955773e-01   -6.135175914166319e-01   -1.189794299574482e-01   -5.401449446305259e-01   +5.355182465708163e-01   +3.588830690472080e-01   +2.686739343584997e-02   -2.327349608353456e-01   -7.987153070100379e-02   -6.152205439316263e-01   +3.589958682765966e-01   +3.821924098010421e-01; +6.137217843105657e-01   -2.563809328421001e-01   -8.376560228928492e-01   -9.516721381222519e-01   -6.950058538807673e-01   -3.818375071862276e-01   +4.697774256662801e-01   +4.665656669933904e-01   +6.449207886840942e-01   -5.977723829837074e-01   +6.036957517209692e-01   -5.299985426034112e-01   -9.647819872794693e-01   -6.645644701450395e-01   +4.431258551710819e-01   +7.013754777938206e-01; -7.524103897192624e-01   +2.268520581193620e-01   +2.970960142152659e-01   -9.084640673587566e-02   -8.561493357101364e-01   +8.365486186961781e-01   -7.083959397897349e-01   -5.387464849662559e-01   +8.709612005289730e-01   +4.294611207300717e-01   +1.592511729718934e-01   -3.599398717493244e-01   -3.164940897768654e-01   +2.954137567681629e-01   -6.570973431018670e-01   -3.514055210420609e-01; -1.138429143112012e-01   -3.370149109192191e-01   +7.765123233981188e-01   +1.662991690586660e-01   -5.211652075975705e-01   +4.233273853254109e-02   +2.667349488387083e-01   -4.533965789981102e-01   +6.450886552054479e-01   +4.841217985631173e-01   -8.262855507544418e-01   -6.004374168716436e-01   -7.291496994401452e-01   +2.677119148528250e-01   -4.085023909325142e-02   -5.006470598423181e-01; -4.641451602010521e-01   +5.425577379738704e-01   +7.234013808726655e-01   -3.999880284588354e-01   -1.360217246437528e-01   +3.964372027466449e-01   -1.605155211410970e-01   +2.158570064150133e-01   +5.080154792186216e-01   +3.717523637066773e-02   +5.203874364596029e-01   +3.248933668096219e-01   -4.145705583336937e-01   -6.446262045661943e-01   -1.543569157489351e-01   +1.669911837739367e-01];
L2I_L2E_iAMPA_netcon = [-9.852203616047897e-02   +3.375301626728054e-01   +1.109036144249643e-01   +3.418081463161394e-01   +1.338743616268100e-01   +1.872595124778417e-01   +1.615234007126674e-01   -2.989733142455932e-01; -3.503674998770928e-01   -6.998171426159068e-01   -8.369383676929116e-01   +7.872308203775147e-04   -4.969346092718272e-01   +1.543573257551565e-01   -2.135591105182741e-01   -1.564669796663310e-01; +4.491376117987280e-01   +6.695707690736247e-02   +1.578422091026361e-01   +8.597041735862329e-01   +8.631782981741899e-02   -3.141537564872625e-01   -4.456712554362555e-02   +7.276569720462256e-01; -4.342851075652206e-01   -4.021788615699017e-01   +5.965198094697999e-01   -2.540822606731716e-02   +7.430695315549140e-01   +6.608180108192081e-01   +8.159909069080241e-01   -3.848890540203589e-01; -5.133981037719847e-01   -3.815793338548725e-01   -7.651663901702915e-01   +5.199183467666076e-01   -7.979220855601263e-01   +1.052647859475666e-01   -3.494835191656452e-01   +3.708381102973877e-01; -3.733151699570802e-01   -2.845988165845446e-01   -3.015241553802875e-01   -2.469983601678380e-01   +6.082700392354051e-01   +5.405474784459839e-01   -1.914266358139578e-01   +7.389481735486531e-01; +7.359057232484724e-01   -1.000000000000000e+00   +5.866826018097780e-01   +3.834224743991957e-01   -6.677124751825310e-01   +3.955932613051754e-01   -1.227876517280140e-01   +3.549173214601912e-01; -5.756129491422574e-01   +8.991052800276096e-01   -1.771676500755953e-01   -4.624267712499616e-01   +1.672862601320600e-01   -3.407335878789398e-02   +7.456816891217586e-01   -4.049698111832596e-01];
L2E_L2I_iGABA_netcon = [-1.035965237808206e-01   +8.412660364338459e-01   -9.375223982237067e-02   -1.153241130538350e-01   +3.782255749445788e-01   -2.834514612609077e-01   +4.314628686400323e-01   +8.801279914896168e-01; -1.711637927725159e-01   -2.702510473060987e-01   +8.090882672589396e-01   -6.141342425568319e-01   -3.554534190259688e-01   -6.469056498339967e-01   +3.870077447349959e-01   +1.108315882729104e-01; +4.714209035176044e-01   -6.960233012004101e-01   +9.635873811231617e-01   +7.335390471017901e-01   +7.330672697664370e-01   +3.240776618175906e-01   +8.722940640119755e-01   +5.680395169758546e-02; -6.188877957579362e-01   +2.401060035739724e-01   -1.281356852272361e-01   +2.289847925195234e-01   +7.433997710370200e-01   +8.766881414973778e-01   -8.771540196044660e-01   +1.624748602052399e-01; +1.578972846989073e-01   +3.294398203170150e-01   -3.862084088653724e-01   +7.957170631273547e-01   -5.985821498306811e-03   -7.052640638304640e-02   -1.551867369497785e-01   -3.867136314108540e-01; +1.074290623247545e-01   -7.513975820099859e-01   -1.199125130393965e-01   -4.265714225380359e-04   -1.000000000000000e+00   +3.946300108577365e-01   -7.888538619070796e-01   +6.033010387160799e-01; +1.035759850604143e-01   +6.147198402704768e-01   +4.703866263111506e-02   +1.009374741673273e-01   +3.162449586523576e-01   +3.818555353108154e-01   -4.268356125497782e-01   +1.502914609171316e-01; -5.420064388791320e-01   -1.999518443129572e-01   +7.566955027417935e-01   -6.650813437172074e-01   +7.650136402004795e-01   -4.781490276873436e-01   +9.654253129520185e-01   +3.621922526245648e-01];
L3E_L2E_iAMPA_netcon = [+8.180912345123559e-02   -3.044322187976840e-02   -1.340493443258500e-01   +2.528746544315061e-01   +8.572944729528026e-02   -4.496660118563258e-01   -1.575315215033962e-01   -9.150650631642671e-01   -3.279559096253916e-01   +4.668547420780345e-01   +6.838841296869820e-01   -6.464705979015632e-01; +2.003715487113223e-02   +1.908196000564177e-01   -2.149636786255335e-01   +4.290458168748279e-01   -7.330106374572080e-01   +2.783172219729027e-01   +6.584058717332917e-01   -7.506870828085587e-01   +1.484045229730139e-01   +2.783451068571876e-01   -6.898971729849020e-02   -4.029269111084246e-01; +7.151240220217322e-01   -4.076691035452873e-02   +8.572538417451157e-02   +2.879050460014351e-01   +1.834337389566494e-01   -3.603448117836500e-01   -8.250869049298606e-02   -3.755989023038764e-01   +1.908920958953408e-01   +2.116141093588957e-01   +5.255807374561456e-01   -6.585379981832313e-01; +7.929787851829744e-01   +9.899320315299803e-01   -6.741418159627956e-03   -4.552116653503054e-01   +4.957644035704359e-01   -6.013608831016887e-01   +8.459408851016097e-01   +6.357245614843425e-01   -6.186900328365447e-01   -8.339436984374541e-03   -5.021306891015033e-02   -1.659404722831873e-01; -8.782310927879408e-02   +1.626004729958052e-01   +2.930971223973408e-01   +1.231932873220537e-01   +1.036039822460667e-01   -4.868785123623839e-01   -8.080083128929852e-02   +7.308401260749723e-01   -2.310055726716519e-01   -3.755592696068370e-02   +4.715469113007108e-02   -5.337505152064934e-01; +2.360664941549410e-01   +7.236275029103788e-01   +4.206416993167983e-01   +9.238846034295950e-01   +2.996428557157182e-02   -5.054035626240153e-01   +6.762259869205312e-01   -6.453003641681366e-01   +8.801656370430596e-01   -3.679228016506529e-01   -6.232167713339535e-01   +6.189423567986216e-01; +7.417319535156660e-01   -4.809910977494143e-01   -1.262228881194137e-01   -2.161679961580413e-01   +9.108414965325676e-02   +3.733420599509416e-01   +5.110813129532408e-01   +6.917344294251317e-01   -4.930741762909223e-01   -1.000000000000000e+00   +2.354947921136718e-01   +3.775015635213628e-01; -2.204399544782144e-01   -4.695152258247088e-01   +1.112810324927471e-01   -7.317915985176104e-01   +4.148347136776911e-01   -9.025825984058666e-01   -2.547992035729702e-03   -1.024419793823678e-01   +4.255659837846127e-01   +2.399844901722414e-01   -2.233634019545480e-01   -8.229580938940753e-02];
L3I_L2I_iGABA_netcon = [-2.920241424375797e-01   +7.033454925201890e-01   -7.345505770064605e-01   -4.585771255696756e-02   +5.606607051505164e-01   +4.768001823567106e-01   +8.513152058736593e-01   -3.366151807939719e-01   -2.796670863081647e-01   -9.712619437542003e-02   -1.651018008227499e-02   +2.423714894140514e-01; +5.190623619075418e-01   +6.738689007764092e-01   +5.469760178053054e-01   -7.516882229963264e-01   -9.076027786563701e-01   -6.249422411944556e-01   +5.956137896635263e-01   -4.080917217889406e-01   +5.702567420805150e-01   +2.622098837084260e-01   -6.283147387960085e-01   -3.098544356467204e-01; -1.236408554444823e-01   -7.611284589853158e-01   +4.160238449539608e-01   -2.263231883421428e-01   -5.559985457098471e-01   -8.060534835287113e-01   -5.279477235141646e-01   +2.242607065093628e-01   +8.381006952543140e-01   -5.745258514938819e-01   -6.655359845223996e-01   +3.209039070227093e-02; +4.125690943063108e-01   -3.789952418966958e-01   -6.911694867087237e-01   +7.351769714205082e-01   -9.557497845073518e-02   +6.166370632837046e-02   -2.847748572742482e-01   -5.324254890142527e-01   -3.140846081524416e-02   -2.042185240159918e-01   +5.408933060081461e-01   -8.033546031835784e-01; +4.088151592735659e-01   +1.688572658545522e-01   +4.747281614663622e-01   -1.902600125893563e-01   -5.048724491653658e-01   +1.324269586711617e-01   -4.791758088930500e-01   -4.007360383532049e-01   -5.633784410445318e-01   +3.577489741283850e-01   +7.524127937839001e-01   +6.235199425096998e-01; +7.100200489253452e-01   -1.066307606956059e-01   -6.961530183110327e-01   +4.566405142461530e-01   +1.940533866130739e-01   -5.849634754050070e-01   -3.162521586787063e-01   -3.523750723609280e-01   -6.803198010734549e-02   -4.491990223199288e-01   -3.486704776126738e-01   +7.244033304970023e-01; -2.398622507691394e-01   +3.395048178312097e-01   -2.303495605896909e-02   +6.795775528415013e-02   -4.362237006681062e-01   +8.737721772885489e-02   -2.956506986771706e-01   +3.495164963883091e-01   +1.713669703280316e-01   +1.676276498551716e-01   -2.312664051843095e-01   -7.333782926716818e-01; +2.088971189880634e-01   +3.572609200471910e-01   +7.357744346909402e-01   +2.600070215551007e-01   -6.463232634300846e-01   +1.000000000000000e+00   +4.009479792525004e-01   +2.854958469388691e-01   -7.158950827352846e-01   +5.443727424898516e-03   -9.528886072823588e-02   -7.047002188547388e-01];
L2E_L3E_iAMPA_netcon = [-3.138069022126049e-01   +3.276680786650367e-01   -6.919265403246173e-01   -1.812566205469724e-01   -1.705073597953136e-01   -6.284668835938796e-02   -1.172053418213082e-02   -3.361598924096952e-01; -6.577630333411878e-01   -6.258914250891408e-01   +3.259523450744411e-01   +7.762513964101362e-01   +4.657361531087910e-01   -7.344616543592889e-01   -3.121093455630098e-01   +7.316802708895433e-01; +1.962367149535923e-01   -9.230174132331621e-01   +1.681185215048194e-01   +3.709417788520188e-01   -8.917326798686188e-01   +1.648579976064204e-01   -2.182715112702892e-01   +6.356570444668583e-01; -6.617942089005763e-01   -1.220740716028425e-01   -9.470597266825048e-02   -1.793037011781765e-01   -8.340793898789621e-01   +1.000000000000000e+00   +1.010922474936900e-01   -5.411948285293566e-01; -1.304063273562968e-01   +2.569357886014857e-01   -9.688405962027372e-01   -4.620667526991772e-01   +1.587711694175049e-01   -3.869287720648986e-01   -4.486271109208102e-01   +2.007929999685536e-01; -7.433514404406039e-01   -1.427950958538305e-01   -2.217859633204231e-01   +9.574769716092130e-01   +1.519454876892408e-01   -7.396643020608534e-01   -1.893055400152252e-01   -2.097692196773769e-01; -6.425162805547662e-01   -8.384925602818080e-01   +7.927752909085976e-01   +4.422188808414285e-01   +3.432584504102926e-01   +4.244163039769774e-01   +3.150509827328382e-01   -2.821690337164391e-01; -1.131810700499895e-01   +4.786146027061716e-01   +1.661381346521351e-01   +8.320775094088800e-01   -8.406727338529161e-01   -4.752631643650245e-01   +5.441220293708032e-01   +5.183160681570973e-01; +1.496829670024634e-01   +9.374709324038933e-01   -1.229411718487638e-01   +3.030391776696172e-01   +6.182451789691955e-01   +4.196004768549218e-01   +7.639283317140368e-01   -6.858377905329557e-01; +7.784440213013571e-01   -7.584807727680973e-01   -6.874311698653253e-01   -7.073886340542932e-01   +6.578154096442647e-01   +4.666435858131196e-01   -1.698083402795796e-01   +7.135442369023561e-01; +8.183258051594641e-02   -7.806349007584204e-02   -2.078318116420835e-01   +2.044935860244175e-01   -7.067152027634329e-01   -2.813865701470216e-01   -1.991933682505579e-01   -4.895077982643279e-01; +2.554728005559027e-01   -4.002329060691858e-01   -2.865831573370941e-02   +3.511715591536807e-01   +6.707137687883060e-01   +5.028372772103108e-01   +4.971313484836488e-01   -2.420354875963833e-01];
L2I_L3I_iGABA_netcon = [+2.537480024694676e-01   +1.000000000000000e+00   +4.098013834257165e-01   -4.131822694038391e-01   -7.075548984751454e-01   -6.514760143847390e-01   -3.035461701047057e-01   -4.102991533830765e-01; -5.048954456953344e-01   +8.163161451800839e-01   +6.841669098054637e-01   -6.755957793725674e-01   -2.581667707197914e-01   +4.558566783761701e-01   -5.973216163723640e-01   +3.123633903359636e-01; -6.320897920502636e-01   -4.038851967916722e-02   +1.265422325385560e-02   +1.812590963436666e-01   +2.980213048227830e-01   -2.842033860447954e-01   -4.200259889715808e-01   -2.318757422790897e-01; +4.970745988950802e-02   +1.338276326044456e-02   +5.779459189295862e-01   -1.086270765086136e-01   +3.847925331163092e-01   +3.291560719794321e-01   -1.624023255070079e-01   -4.683640997626031e-01; -4.611833493203714e-01   +5.604329522432604e-02   +9.754335151794641e-02   -6.396134497162588e-01   -9.572951416734573e-01   -2.160856444692802e-02   -7.106919381143753e-02   +5.605258677325037e-01; +1.886098937192234e-01   +5.531282177384746e-01   +7.363914696200615e-01   +2.422872940287288e-01   +3.589931526367689e-01   -7.085063684200855e-01   -6.760809515678252e-02   +1.150333662028372e-01; +8.134731691704242e-01   +4.511312746942306e-01   +1.365611039285089e-02   -2.882945451925764e-01   -2.779624655539962e-01   -3.008092825949323e-01   -6.210008477414594e-01   -6.545163921547816e-01; -7.998684130998392e-01   +3.278887921015610e-01   +2.463099968773277e-01   -1.625349477250435e-03   -4.179797748683623e-01   +6.792778278035211e-01   +2.357475035963146e-03   +7.098032972152416e-01; +3.509398841755110e-01   -2.644760634972587e-01   +3.715517971936724e-01   +5.644085349226146e-01   -5.942996631613731e-01   -4.365904183765026e-01   -6.303453444296273e-01   -2.726375354050578e-01; -6.912335945806037e-01   -2.873146308066277e-01   +7.737901295031727e-01   -4.680807338641728e-01   -1.840587597749278e-01   +7.741561074529473e-01   -1.540225391240811e-01   -4.230444479903148e-01; -4.625630882456896e-01   +1.437999435863800e-01   -6.595208532054174e-01   +4.635613029996285e-01   -2.183087520005789e-01   -8.533303207740750e-02   -6.774758925847780e-01   -5.927189538388536e-01; +1.276562821798082e-01   +1.840882678098377e-01   -6.677182128368869e-02   -5.747733510561216e-01   +8.297815003956630e-01   +4.554893410960295e-01   -3.285942714925124e-01   +3.221012421486033e-01];
L3I_L3E_iAMPA_netcon = [-5.349994166472539e-01   +9.604003776807717e-01   -4.396693381480978e-01   -9.867377889848779e-02   -1.482979904443582e-01   -2.182454075785832e-01   -3.472830562115531e-01   -2.730564150014047e-01   +3.598996023795895e-01   -5.936638877889026e-01   +1.782867730561501e-01   +4.135443654558196e-01; -3.074300868444875e-01   -3.003881659056437e-01   +4.472539289841873e-01   -1.433896314084693e-01   -1.430805835019182e-01   +3.084044573715901e-01   -1.618367261973133e-01   -1.939570990611202e-01   -6.882228043533325e-01   -3.292457962003356e-02   +4.750005822895816e-01   -5.712790965426821e-01; +1.375249941382721e-01   -6.614444878373616e-01   -4.031853735188383e-01   -9.347557844382189e-01   -4.530773427187827e-01   +1.605978197904361e-05   +4.256830566800884e-01   -8.472456533027363e-01   +7.704237542976399e-01   -6.106597323067008e-02   +4.097078064732026e-01   -2.119621007892689e-02; -1.974725979245862e-01   -1.728381274594990e-01   +6.543124068139384e-01   -5.291769568503079e-01   +5.949174120320909e-01   -4.169997103072674e-01   -4.811753515360606e-01   +2.380875993397138e-01   -8.201552169245917e-01   -3.577392905287521e-01   +2.937378644238117e-01   +2.295340375224073e-01; +9.512113921649334e-01   +6.965075938187224e-01   -2.363752046792016e-01   +9.863643949645809e-01   +2.325943461348180e-01   +7.711836208018510e-01   +5.501485210787167e-01   +4.806321369352653e-01   -3.010862732057648e-01   -2.783463413210330e-01   +5.760456367962261e-01   +1.955530068855909e-01; +1.830082429546769e-01   -1.375082906464196e-01   +8.825905398707690e-01   -1.646980629858053e-01   +1.088254330893394e-01   -7.100855994692732e-01   +9.372669047847901e-01   -1.911700687973343e-01   +7.507026119523237e-01   -5.896310489963329e-01   -3.636268819454286e-01   -1.429826830551363e-01; -1.278257356225533e-01   -2.483747308351406e-01   -6.050512573029183e-01   +4.064555818604987e-01   -6.284239106516223e-01   +4.385977286980142e-02   +6.826328222018474e-01   -3.181080450821187e-01   +6.687701124725136e-01   -2.944988205214054e-01   +2.066237102456539e-01   -2.837930431675074e-01; -5.621596602375106e-01   +2.267853857999256e-01   +3.107364177323546e-01   -6.945544377381591e-01   +7.903287662986778e-01   +5.243550606976758e-01   -5.031540474026595e-01   +5.872579651337086e-01   -6.115379076886091e-01   -7.474824268637807e-01   -3.492418236698238e-01   -9.697518153328666e-01; -2.373847083748120e-02   -3.293093284788555e-01   -2.325431612378545e-01   -4.334270645940361e-01   +1.965049557558715e-01   +6.336934204612223e-01   +7.220337018084183e-01   -6.396857505177150e-01   +1.000000000000000e+00   +8.393954797883323e-01   +6.322617340223764e-01   +4.680704417536465e-02; -2.531617703144025e-01   +6.778170527638654e-01   -1.650844495779788e-01   +1.541520050277092e-01   +6.152051070281050e-01   +4.008865650236448e-01   -3.151353570633298e-01   +3.185982477381463e-01   +2.817717621251801e-01   +9.328508946872488e-02   -1.660971319941369e-01   +5.255726794052510e-01; +5.598670846382026e-01   +5.214967535483646e-01   -1.247084300710570e-02   -5.577218433429282e-01   -4.626823547817053e-01   +1.080566077320597e-01   +7.694540705697438e-01   -4.345738330137723e-01   -4.888044365759961e-01   +5.216837260268778e-01   -5.296556614287756e-01   -4.466960393949691e-02; -3.611191897718176e-01   -7.520082018263933e-01   -2.934482967318410e-01   +7.678298669205192e-01   +6.842303533835958e-01   -6.459132425870358e-01   -5.991159949905762e-01   -1.760852575148344e-01   +1.544198529056998e-01   +6.258546696598580e-01   -2.989484968888585e-01   -6.113360369529991e-01];
L3E_L3I_iGABA_netcon = [-6.718147116762498e-01   -5.072384124874632e-01   +3.771255242279411e-01   +1.842827572837940e-01   +2.685592618461317e-01   -1.632959606916762e-01   -5.574656307033549e-01   +1.624213345671792e-01   +5.920167073563102e-01   +4.940835628703031e-01   -6.283838528835468e-01   +2.432969052598825e-01; +3.342338628580728e-01   +7.974296615848511e-05   +7.099453175025620e-01   +7.066302737860227e-01   -2.971818886318979e-01   +3.719891030772334e-01   -3.477105074551580e-01   -5.594167637968619e-01   +3.277019083356786e-01   +4.394206897722160e-01   -5.389493871350906e-01   +8.265807955242669e-01; -1.515052741611272e-02   -6.152350954058531e-01   -7.217746752570414e-01   -1.925200172975046e-01   +2.570101134217959e-02   +5.948426978658171e-01   -6.489679293847826e-01   +3.905277694159549e-01   +3.943560119247684e-01   +7.201770414706782e-01   +2.365148477848298e-01   -7.217102549768738e-01; +5.352146004238552e-04   -2.793532368426914e-01   +9.853007033632499e-02   -8.525358020957809e-01   +4.218453757491807e-01   +5.560779989418364e-01   -5.538214007562303e-01   +7.223657060273336e-01   +5.583528135607031e-01   +8.845017447057473e-01   +5.664627430407051e-01   +6.890279104382266e-01; -3.095903197065443e-01   +6.336016132707067e-01   +3.903761307917623e-01   +2.287836926044147e-01   -2.550470945096385e-01   -3.814306280440595e-01   +6.058469040577646e-01   +9.768494406856570e-02   -1.000000000000000e+00   +4.019889169484396e-01   +6.745034777006674e-01   -1.605743738962205e-01; +2.993182707309767e-01   -6.592675948154096e-02   -5.654890529344643e-01   -1.763608592747135e-01   -1.147986510464158e-01   +3.549578501261625e-02   +2.560562359902198e-01   -1.765227328809921e-01   +3.235438742622496e-01   -4.528060056669000e-01   -8.993863624705851e-01   -4.709898723112254e-01; -3.533977195715251e-01   +2.320340379648667e-01   +1.723810177303884e-01   +8.834801894935997e-01   -5.787195767381276e-02   -9.190814470531961e-01   -1.204371299093282e-02   +2.372446807928608e-01   -5.817293579282383e-02   +5.837947107129419e-01   -5.813326082987995e-01   -7.220581677499441e-01; -1.547883017977597e-01   -3.809777256566475e-01   +1.884945619561703e-01   +6.658452826562843e-01   +5.479172680443490e-01   +5.111314771473353e-01   -2.729575568597252e-02   +6.599233292616784e-01   +4.556250482243049e-01   +4.077268252619238e-01   +1.042273659386772e-01   +2.328977257836368e-01; +1.134836372391833e-01   +4.248224487822015e-01   -9.353155519578974e-01   -3.849306444946475e-01   +2.052066904080336e-01   +1.059374354550322e-01   +2.993946766060768e-01   +5.913144575532705e-01   -7.757697605747943e-01   -4.765955372902688e-01   -7.488421822142471e-02   -2.659377042131936e-01; +3.755532985419287e-01   -5.747481888539699e-01   +9.491773453299319e-02   -4.460538914467701e-01   -2.590239378993773e-01   -6.709250970831893e-01   +1.595597355510843e-01   -1.313299802901367e-02   +6.364680836847243e-01   +6.810377319723460e-01   +7.983868341235386e-01   -4.906360400039539e-01; +6.614525224636123e-01   +9.598083819184139e-02   +3.024907294265071e-01   -7.987973404560871e-02   +6.290793946378344e-01   +6.889683162460544e-02   -4.335402739263056e-01   +6.110875064645070e-01   +3.659527032433036e-01   -6.002213280011960e-01   +2.546080972182436e-01   -5.622427462728982e-02; -3.421707538488054e-01   +2.156389851249756e-01   -6.615169926753418e-01   -4.366720814775635e-01   -3.678409951082835e-01   +3.360955996947489e-01   -1.592305855757481e-01   -4.241932846166870e-01   -1.219289801815233e-03   -7.852464424932379e-01   -3.521476348340527e-01   +5.343344418810113e-01];
L2E_Input1_iAMPA_netcon = [+4.403164444865585e-01   -2.853693866251371e-01   -1.000000000000000e+00   -6.007160514410399e-02   +2.699168408366453e-01   -4.606909989549549e-01   +6.354612574136774e-01   +1.565074271872492e-01];
L2I_Input2_iAMPA_netcon = [-1.000000000000000e+00   -1.795960850104818e-01   -4.641157612244707e-01   +3.241440334446764e-01   +2.695025408191567e-01   +7.156460693114793e-02   +3.117371958844916e-01   +7.067508569891504e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
