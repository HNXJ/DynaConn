function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-2.525467122388608e-01   +1.179451333666880e-01   -1.512786555613211e-01   -4.014495037700775e-01   -9.825135338123655e-03   -2.008089841292927e-01   -1.253555817600650e-01   +3.901032032636010e-01   +4.634219239458446e-01   +8.111623637846177e-02   -9.121113445089453e-02   +5.147735279007445e-01   +1.969734325515012e-01   -1.267299368391365e-02   -1.208057750658362e-01   -2.724853001303148e-01; +1.260319525043610e-01   +1.235789619345911e-01   +5.360406974878754e-02   +1.218271608893891e-01   -1.097899223331944e-01   -8.528568261626673e-02   -1.636709027817075e-01   -3.812305203934096e-01   -3.260392640095559e-02   -1.488567756669785e-01   -1.733761952435749e-01   +2.516399243560322e-01   -4.446134015735406e-01   +1.088708635064878e-01   +8.737093187552547e-02   +2.588774700053594e-01; -1.905520421472656e-01   -3.880614597883441e-01   +6.272179791012450e-02   +1.755370908832151e-01   -5.176409589819700e-01   -4.534977507500822e-01   +3.796050606326349e-01   -2.047786569096048e-01   -3.967978719686908e-02   -3.416441043349008e-01   -1.596555437460754e-01   +3.105201583324228e-01   -6.616999254181924e-02   +7.471137338285525e-01   +1.466341244341332e-02   +4.415521474500234e-01; +6.605096439879133e-01   +9.272530472645593e-02   +8.257431424562282e-02   -5.025183349441362e-01   +1.548920466547220e-01   -3.981499319603714e-02   -4.323498751922114e-02   +4.180727268935445e-01   +3.465358112579767e-01   -6.277988472413629e-02   +9.166702900652629e-02   -1.215403804232994e-01   -1.957180877663993e-01   -2.397395658708555e-01   -1.623700129643353e-01   +4.825610449562810e-01; +6.331917158985000e-01   -1.507559018652293e-01   +1.715023089004017e-01   -1.444203212790331e-01   -7.658558136646232e-03   +6.337474577443172e-02   +1.893449372995964e-02   +1.602113015928770e-02   +4.213612699884482e-02   -2.333853508337735e-01   -4.975627712915019e-01   +2.930994239902986e-01   +2.738479683308872e-01   +3.596148929361551e-01   +1.112743372430422e-02   -4.118972360794724e-02; -1.904726757005454e-01   +3.213677452295145e-01   -5.853141157456739e-02   +9.798374583449940e-02   -3.373328626138030e-01   -3.635214397463715e-01   +2.627647922669917e-01   -5.116560135147448e-01   -3.766829163253475e-02   +3.839416916469676e-03   -3.518642112476776e-01   +4.881177368112901e-01   -4.000317976959606e-01   +2.189790082562943e-02   +4.128267129267688e-01   -3.260676920995528e-01; +1.711757258623052e-01   +3.411438656972874e-01   -2.139860950869533e-01   -4.793415577629412e-02   -2.215611545575004e-01   +1.265897843881578e-01   +1.927701258402690e-01   +3.882712049969712e-01   +1.895403951729351e-01   +5.336217776373737e-01   -1.744965069813026e-01   -8.161684959841871e-02   +5.200301705106705e-01   -2.733401872766946e-01   -3.999716539094473e-01   +4.470877288560833e-01; +6.949432621696545e-01   -5.516191546854021e-02   +5.148437945980667e-01   -5.186897661480323e-01   -1.038693265435039e-01   +6.936495992220539e-02   +2.901218762803425e-01   +1.206224609039304e-01   +1.349039034490267e-01   +3.483349152051356e-02   +2.038531414637756e-01   +3.554934930297143e-01   -7.575817668686917e-02   +4.053255232007573e-01   +2.226041620371760e-01   +1.990641514132675e-01; +1.534060426771037e-01   +3.156500574424618e-01   -3.898932078760869e-01   +8.997492443352491e-02   +2.027278538572506e-02   -3.303741080340391e-01   +1.842072616728076e-01   +3.456794181602942e-01   -1.448212690523812e-01   +4.546800102255124e-01   -5.036168729008831e-01   -2.025625965552280e-01   +4.208253121845946e-01   +1.384403046463396e-01   +2.143623457324682e-01   +6.623791127383538e-02; +6.064404440019289e-01   -1.763263935855809e-01   +2.246088390696791e-01   +3.118100809293181e-01   +3.027801016709532e-01   +1.258527869989731e-01   +1.610192689818419e-01   +4.356114274955963e-01   -7.733686138077908e-02   +1.551352386588972e-01   +6.582278520642554e-03   -2.418771177356036e-01   +3.080803194781389e-01   +4.253020524020995e-01   +4.565779506553749e-01   +3.003510054273598e-01; -3.128358672181789e-01   +2.426756803162792e-01   +2.387429019024862e-01   -1.275807483953709e-01   +2.951025235297370e-01   -2.207466534348992e-01   -1.744904656992931e-01   -2.984195758307053e-02   +3.735510220746989e-02   +6.611991614306884e-01   -4.954487679626740e-02   -1.289230501682192e-01   +2.675393846940048e-01   +5.310695046759827e-01   +3.772599692879396e-01   -1.144042960931990e-01; -1.366715312376758e-02   +8.379993244061398e-02   -2.926738667979046e-01   -1.114759543412686e-01   -1.123036086324481e-01   +4.565541914948182e-02   -4.858397922751298e-02   -1.970205502137432e-01   -1.859973661488895e-01   +9.374652312296783e-03   +1.213964782463293e-02   +1.507079701796977e-01   +6.266550896926723e-02   +5.887710346700682e-01   +1.198402551234114e-01   -5.483403735259901e-02; +6.567372743852179e-01   +1.665848188257668e-01   +8.541777549013294e-02   +2.983196485524185e-01   +3.959608353793048e-02   -8.221349311727755e-02   +3.494488993042350e-02   -1.675192419068259e-01   +3.868011939379256e-01   +2.459003746468834e-01   +9.138576980835807e-02   +2.560468178210711e-01   +2.795280283273253e-01   +6.066087715609282e-01   -1.828610703160918e-01   -2.761704830652488e-01; -1.459877777880455e-01   -5.040990536273321e-01   +2.047675821195989e-01   -3.145620291254196e-02   +2.603888133462084e-01   -3.086467534228425e-01   -1.616020411372892e-01   +7.691605067387315e-01   +1.522111304740385e-01   +1.813510674336273e-01   -3.191660995869507e-01   -1.382948849064223e-01   +1.074314080091429e-01   -1.852043505890494e-02   +5.344265225283745e-01   +3.662153429584931e-01; +2.677387274275923e-01   -2.492816919607483e-01   -1.753905892102466e-01   +1.904161342243452e-01   +2.077351986948597e-01   -9.662686071504056e-02   +3.853152830276825e-02   -3.958272742023853e-01   +4.659402315296468e-01   +1.122463412942189e-01   -3.262618909543781e-01   +7.047935889307807e-01   +1.625802147971681e-01   -2.276569779775230e-01   +7.782613527819314e-02   +3.504319338197662e-02; -1.254399210612797e-01   -1.632746037468939e-01   +1.530428763461425e-01   -3.262410741219752e-01   -2.757903461846911e-01   +3.850701695144880e-01   +4.779401752703032e-01   +1.660633030486414e-01   -4.224718103217354e-01   -5.191348721575689e-01   +2.340169153518046e-01   -8.038961826317358e-02   +3.299728821014338e-01   -6.561301637352306e-02   +2.374047853867276e-01   +5.003926732236076e-01];
L1E_L1I_iGABA_netcon = [+2.577121854978696e-02   +2.814830930419697e-01   -2.337467456742308e-01   +9.382660477456260e-03   -4.250825835058948e-01   -3.411364931082275e-01   -1.439592529703972e-01   +1.230514176287490e-01   +3.998997700797753e-02   +1.749001604996216e-01   +1.171802288169645e-01   +4.792372346550358e-01   +2.617704756396650e-01   +8.974777551630663e-01   -3.461567080989182e-01   -3.150930382800728e-01; +2.084049852765383e-01   +4.743355129560376e-01   -3.105410662227447e-02   -4.397338198268963e-02   -2.688815957874136e-01   -5.370345512884439e-02   +3.427824781837159e-01   +2.343680912051354e-01   +1.937662886850554e-01   -6.082597233111693e-01   +4.333270998855342e-01   +5.208595552851980e-01   +1.872585275467773e-01   +6.513864876686447e-02   +2.289729791285740e-01   -6.062218361499216e-01; +2.960795942311293e-01   +4.318735215689742e-01   +3.160836059520926e-01   +1.740657926770003e-01   -4.919767789186135e-01   -3.211266983807208e-01   +2.873328868232199e-01   -7.646802815832190e-02   +5.415119221164377e-02   +1.982684103650538e-01   -1.566952602596841e-01   +7.776710376571828e-02   -1.718936445242009e-01   -1.908180731686869e-01   -2.416588837684961e-01   -4.133253076360505e-02; -6.372506613916294e-01   +1.425223109695614e-02   -7.696743101029555e-01   +4.664062322512672e-01   +2.399412330246701e-01   +1.825481825669293e-01   +1.148496389048415e-01   -1.308118832832774e-01   +1.651942143667458e-02   -4.513964148399382e-01   +2.325960233607103e-01   +3.946315935637302e-01   +3.375498900189701e-01   -3.284349846949061e-01   -1.157270600811102e-01   +9.909906477445651e-02; -8.537274059099133e-02   +9.518552425514619e-02   -4.608983978156564e-02   -8.764282977947099e-02   -1.602980817077828e-01   +8.043696226463611e-01   -5.748592126978002e-01   +5.101841844442229e-01   +6.951658309485647e-01   -3.583036077855360e-02   -2.754353431256669e-01   +2.100772228972198e-01   -6.805901492838923e-02   -2.997938990387292e-01   -8.640645103650303e-02   +5.875658681837363e-02; +3.901074602404979e-01   -3.653303661209351e-01   -8.670247355049615e-02   -5.713974621525136e-02   +2.651810095566572e-02   +1.275470418267828e-02   -3.390718114272413e-01   +3.289127656198291e-01   -4.567695296969105e-01   -1.822718599615080e-01   +5.555317999705597e-01   +7.435859313295491e-01   +1.263218149830751e-01   -3.093007135572849e-01   +1.418955787980485e-01   +3.075859555241395e-01; -2.966456674541576e-01   +6.074985007606414e-01   +2.739750070064338e-02   +3.496778315451855e-01   +6.314073005577816e-01   +9.098210443552460e-02   +2.337183110095879e-02   +3.420863995513953e-01   -1.483411410816641e-01   -5.685653021720442e-02   -4.168598654145459e-02   +4.810259700346166e-02   -4.148518431118465e-01   +3.065779316498937e-01   +2.443042241500115e-01   +2.791976689581406e-01; +5.648317995627219e-01   +1.708726050490987e-01   +2.673624324792717e-01   +1.627699722095498e-01   +1.093307641086048e-01   -1.005161978897563e-01   -1.578080247968454e-01   -6.125499608809132e-01   -3.141891485474228e-01   +4.739913796632336e-01   -2.491297065026906e-01   +2.918618703944135e-01   +2.610716566427278e-02   +2.026446751044653e-01   -2.031888941945372e-01   +2.144308818265335e-01; +3.552321302979061e-01   +5.090637764959931e-01   -6.971517990505098e-01   +3.133674200954066e-01   +1.123258987832943e-01   -7.277389526923030e-01   +7.714853639754821e-02   -6.989184237649253e-01   +8.491869325294638e-03   +2.188120839083273e-01   -6.576444244080328e-02   +6.593185468066156e-01   -1.626336736358232e-01   +1.658875311304838e-01   -2.622272845625879e-01   -1.173493786255258e-01; -5.791273138615970e-01   -6.064436805010662e-02   +2.380823403769782e-01   +1.094748102281110e-01   +1.963299343137416e-01   +2.802331746668353e-01   -2.328737044197892e-01   -1.455680019143703e-01   +1.750621438019766e-01   +1.595873912232017e-01   +8.366470615600048e-01   -3.893537920729159e-02   +2.942438545219991e-01   -1.461063909263571e-01   +6.653931336237331e-01   -9.088907382481590e-02; +2.790447919243264e-01   +7.786487133023370e-02   +3.266090243094117e-01   -2.265295772275092e-01   -1.343836629777869e-01   +3.706963724855733e-01   -1.892739213489754e-01   -9.684272829874244e-02   -6.481725086372402e-01   -1.270334803730201e-01   -3.198416215404543e-01   +3.941004263676817e-01   +9.226147069173725e-02   +6.261803372744330e-02   -6.638769614631310e-02   -3.389518712027845e-01; -2.058406768977065e-01   -1.051141766765399e-01   -1.909121137136170e-01   -1.903151548083434e-01   +5.022182091689881e-01   -2.864310596179980e-01   +4.852200660296555e-01   +4.672949059509768e-01   -1.039714846279231e-01   +3.326210914124798e-01   +5.276120916158300e-01   +1.389417606415954e-01   -1.666415153058428e-01   -4.138148290819983e-01   +1.106162099942032e-01   +1.296248637584175e-01; -2.999511340096034e-01   -3.429138470846881e-02   -3.492254716856635e-02   -2.995681882775008e-01   +1.626269995621825e-01   +2.469018672347448e-01   -4.325562869479503e-01   -3.133463449714029e-01   +3.441614780340104e-01   -1.907555397897224e-01   -1.686133192311995e-01   +6.254819388029029e-01   +1.629279067974728e-01   -4.562336020111750e-02   -7.045916316960381e-02   +2.433413555359693e-01; +4.572441732218118e-01   -4.303833186619414e-03   -1.133195639224994e-02   -2.204707696255515e-01   +3.887299047695984e-01   +5.307767706102983e-01   +7.519008068115540e-02   +6.968083519584400e-02   -5.132477815116574e-01   +2.587593616499985e-01   -3.934779921820058e-01   +6.725969572033652e-02   +3.433981117049079e-01   +6.743183479676734e-01   +4.864144782234172e-01   -1.988985124547049e-01; -2.670735406170672e-01   +2.543072007219397e-01   -2.859594317562237e-02   -1.842028175546152e-01   -6.253813407207823e-01   +4.338392264932985e-01   +3.967091695622779e-01   -1.080836691928589e-01   +3.451502634154563e-01   -2.318161349242524e-01   +2.775806011458025e-01   -3.649155726583347e-01   +1.127000919052941e-01   -1.445138707828482e-01   +1.304683332198435e-01   +4.591214177239937e-02; +7.249081634711718e-01   +5.355965213248645e-01   -3.907202382255615e-01   -1.834191710743609e-02   +1.972338777045488e-01   -4.241938762751780e-02   -2.736640513618493e-01   +5.574703980355631e-01   -1.860438387483817e-01   -3.554874128186178e-01   +5.848809148412062e-02   -7.564288990505945e-02   -7.417136928588448e-02   -3.520644559798725e-03   +7.936512860843778e-04   +2.927168603787346e-01];
L2I_L1I_iGABA_netcon = [-2.925447282802444e-01   +1.277520914044358e-01   -1.882158749441343e-01   -2.087689105434573e-01   -4.963581896082386e-01   +4.352290664301935e-01   -9.908110113818513e-02   +9.875268933781822e-02; +2.546249304737767e-02   +4.985546479427606e-01   +3.467731095319264e-01   -2.915237968909847e-01   -2.498917307694928e-01   -1.362952431845788e-01   -9.107471227024330e-02   +2.680777252474643e-02; +7.719844726602516e-02   -3.592398592203679e-02   +7.237706570875750e-01   +1.363042645468221e-01   +1.511579377240926e-01   -1.182034298201546e-01   -2.848660756938519e-01   -4.598396535510092e-01; +8.927070974973331e-01   +1.008967483409146e-03   +2.074500899110520e-01   -1.755769100869938e-01   -4.431625764379513e-01   -4.082900687489099e-01   +2.816358053876776e-01   -3.799341351039294e-01; -2.486131818827753e-01   +6.557681557816918e-01   -4.676394233517731e-01   +4.936852054917738e-01   -1.162592837765286e-01   +4.407496457429599e-01   -5.761111677380021e-01   +6.209901437701699e-02; -5.744326746282291e-02   +2.348984595891521e-01   -6.155953044769827e-01   +1.606463997629391e-01   -1.967427274780417e-01   +1.039156109809430e-01   +5.988259702226003e-01   +2.497021759080795e-01; -2.790570932966462e-01   +3.487944456679147e-01   -3.221433620678349e-01   +1.483921688877378e-01   -1.238593270114320e-01   -1.244282071723823e-01   +3.611217678268038e-01   -3.537166539726923e-01; -3.671891915852860e-01   +1.263457953896104e-01   -1.588764018491477e-01   -1.093488754507048e-01   +4.750168201501693e-01   +3.692885532194461e-02   +2.834034101267316e-01   -2.858104201746017e-02; -6.235873857521565e-02   -8.839451841806302e-02   -3.437999153689292e-01   -7.870161732535452e-02   -4.277103817744201e-01   -8.138474517620577e-02   -3.095016307463245e-01   +2.757492037998489e-01; +3.527923094192096e-01   -5.139211864722103e-01   -2.378370927816775e-01   -3.211840259711706e-01   +5.292405078615865e-01   -2.713148278591031e-01   -1.570995158511582e-01   -2.064309473335540e-01; +7.947762391142341e-01   -2.815170894766365e-01   +4.805677436909798e-01   +2.033022587609978e-01   -2.999178969992549e-01   -3.645602049305192e-02   +5.643923132374148e-02   +5.029953541049080e-02; +3.697742256242564e-01   -1.378130810062734e-01   -1.776548419021058e-01   +5.351544913732088e-01   -3.357621890623068e-02   +3.076565594312660e-01   -9.542085265595579e-04   +3.326667857321635e-01; -1.566636948639717e-01   +5.111313669059784e-01   +4.495367415031710e-01   -2.825823898839280e-01   -5.402726153596624e-02   +5.845888892640548e-01   -1.935222096909892e-01   -1.565505272127741e-01; -1.316835708247139e-01   +6.074146311365367e-02   +2.258092562511074e-01   -1.631877740398648e-01   -2.984479061790044e-01   +6.267128856447786e-02   +1.737165946191438e-01   +5.814406643054965e-01; -1.035478126172882e-01   +6.969615777928742e-01   -3.244996756115898e-01   -2.331625502631117e-01   +2.833948305220689e-01   +3.160287110197757e-01   -4.876292759187304e-01   +3.625831557783670e-01; +2.342546507293372e-01   +6.166807310931200e-01   +2.927446100900636e-01   -1.841852259555595e-01   +1.164646720470667e-01   +5.243589492588779e-02   +3.260989930980945e-01   +3.192185574559717e-01];
L1I_L2I_iGABA_netcon = [+9.871365226321503e-02   -1.732525189355508e-01   -2.739691176418186e-01   +1.786758532526000e-01   -1.337465585249161e-01   -1.653124870266542e-01   +3.071050828524560e-01   +6.837928129294391e-01   -9.330363460581068e-02   -3.705201319553728e-01   +4.037498194012712e-01   -3.081910990761573e-01   +1.015912245342424e-01   +1.231274313738487e-01   +1.656285469851168e-01   +4.037654988660135e-01; +3.325285904348152e-01   -6.792864361845430e-02   +1.774534047766299e-01   +1.686231859766267e-01   -3.766947178297425e-01   +2.123591714666896e-01   +3.809334374066933e-01   -1.999472889257611e-01   -3.098632975818127e-01   +3.141833061023976e-01   -3.177507030205026e-03   +4.234591012537041e-01   +2.144189313808121e-01   +2.666905942309478e-01   -7.143515651118721e-01   -1.820097635386839e-01; -4.547401856681449e-01   +2.854618946848992e-01   -3.053544240179883e-01   -1.821567934479599e-01   -1.157308948049540e-01   +4.913240420451420e-01   -3.007903623224385e-01   +3.578914676421823e-01   -1.141247878684209e-01   +2.751531622717558e-01   -4.403755868579762e-01   +1.303278399551194e-01   -1.046011787111172e-01   +4.038734264328421e-02   -7.223577381455382e-02   -1.504745149078694e-01; -2.405640727963710e-01   +5.056604602474062e-01   +9.221125269566575e-02   +1.070859456393983e-01   +9.068389774600601e-01   +2.772956544844009e-01   +7.466978536783855e-01   -5.588572071163577e-02   -1.817681446513099e-01   -2.055150763184736e-01   -3.215472062712789e-02   -4.257713000371326e-01   -7.458702035014070e-02   -9.458190964946626e-02   +2.651014838901501e-01   +1.917871305122523e-01; -5.841869570537349e-01   +5.676637176556982e-01   +1.984597192177224e-01   -4.494502053080444e-02   -7.766428275303978e-02   -4.050655259858983e-01   -2.940054172548660e-01   -5.241347545555386e-01   -4.919647816786260e-01   -2.595759571503858e-01   -1.245076101979085e-02   +6.642694842663862e-01   +2.355402501197446e-01   +4.873907961714704e-01   -1.650918241419810e-01   -4.023885086179261e-01; +4.166498452355801e-01   -4.895661378375906e-01   -1.538277613753012e-01   -1.668038554675383e-01   +5.196605073979951e-01   +1.696876616485233e-01   +1.780499967779532e-01   -3.931957978959396e-01   +1.579295170227866e-01   -1.739676691242786e-01   +4.711557515188090e-01   +4.324795580181424e-01   +2.174708789992985e-01   +1.623032922276554e-01   -4.718357255362030e-01   -1.857285746153317e-01; +2.609879062456414e-01   +5.726375356399156e-01   +3.466263485351402e-01   -2.907364316520602e-01   -1.207137429967823e-01   +1.794922406687224e-01   +4.124687149468708e-01   -1.446003152811921e-01   -1.366117688167577e-02   -4.853390177925165e-01   -4.443064629410516e-01   -1.243247003805492e-01   +1.015054203165196e-01   +2.997388341608950e-01   +3.848004428210748e-01   +3.444703764500565e-01; -1.679120468438659e-01   +3.468366119947254e-01   +2.055649909954327e-02   -5.703847280330356e-02   +5.618504686026148e-01   +2.655399821222386e-01   -4.067678640710460e-01   -1.170324220569540e-01   +1.620016666854373e-01   +5.246819454919209e-01   -6.109840871378044e-03   -5.022001570705964e-01   +4.622324620324325e-01   -1.571826131058969e-01   +8.693618256951149e-02   +3.199846035614093e-01];
L2E_L1E_iAMPA_netcon = [-4.250935010947109e-03   -1.863598792458027e-01   -5.702436393596279e-01   +3.753217363029012e-01   -3.804847579761302e-01   +2.208950205300342e-01   +2.214959518310575e-02   +6.999331403215796e-01; -1.164598024840599e-01   +1.510828941681943e-01   +6.400389880012247e-02   -3.533105645735254e-01   +2.709227260075556e-01   +1.793090254683757e-01   +4.631671401206456e-01   -6.983742038893932e-02; +2.011327635345257e-02   -5.872555644966755e-02   +4.850644874491400e-01   +4.021886584063675e-01   -1.255190416947194e-01   +4.555243655392990e-01   +1.859175467809962e-02   +6.789013416703982e-01; -3.993661425225558e-01   -1.896234344389369e-01   +3.937406101061343e-01   +7.504644612214393e-01   +2.237297169175229e-01   +4.916675645288436e-01   -4.426727853370434e-01   -2.846759974632305e-01; -2.257665295822260e-01   +3.159931486882898e-01   +2.557124183922826e-01   +5.460567894849367e-01   +6.505815170907611e-01   +2.843164199673912e-01   +3.315793229733088e-02   -2.691187221564190e-01; -1.380779850423794e-01   +6.248116684119744e-01   -7.378666183901468e-01   +6.582906350739906e-02   -1.424774823700745e-02   +1.204045499407857e-01   +1.843764881330766e-01   -1.629912577131917e-01; +2.247424288056621e-01   +1.250997196478699e-01   -6.742176849306950e-01   +1.327358627381977e-01   -3.321423952231896e-01   +1.210345295567673e-01   +3.829589692042529e-01   +3.450150935334771e-01; -2.099699074153496e-01   +4.158106312304065e-01   -5.734137346271921e-02   +6.761360887428797e-02   +7.056541478621815e-01   -4.902121165696748e-01   +1.260819041510867e-01   -1.177015650251986e-02; -3.630187376078662e-01   -2.787297317514532e-02   +3.476575399419975e-01   -1.081117168608256e-01   +2.046084973059225e-01   -2.192069334298859e-01   -3.765975365413974e-01   +2.383038252102591e-01; -5.209094025021520e-01   -2.790869181220602e-01   +1.522286933680732e-01   +6.655473482922974e-01   +2.542343921040284e-01   -3.829266874912635e-02   +2.924244690050433e-01   +2.537379379530053e-01; +3.345401624463145e-01   +3.256945435771411e-01   +3.995512564824649e-01   +3.936197936853494e-02   -6.391161728041360e-01   -4.927397157609399e-01   +1.539334469957748e-01   -1.282876650280637e-01; +1.078999714149111e-02   -2.451609962594104e-01   +1.454061155245483e-01   +1.362516515010270e-01   -1.031105126117000e-01   +2.251612056994778e-01   +6.828652515231831e-01   +1.806567730752096e-02; -4.354813682196876e-01   +5.665133210904435e-01   -2.305856054688383e-01   -3.916209057386734e-01   +7.036420634586736e-02   -3.028393144068901e-01   -5.340970062075174e-01   -1.047871699113138e-01; +1.765261800019552e-01   +1.156181004432053e-01   +5.232715135892265e-01   +4.066244456996784e-03   -4.288733934900446e-01   +1.889299764629987e-01   +5.997114939508214e-01   +3.303268423908439e-01; +2.872053483771817e-01   +2.088313980576483e-01   +1.825319171885101e-01   -2.929785805012476e-02   +1.053557849262098e-01   -1.197673015085013e-01   -4.066983616533626e-01   -2.264430765517895e-01; -4.169844339946756e-01   +3.500138412825198e-01   +3.581609611762923e-01   +6.725481949052668e-01   +5.800066180157687e-02   +1.918020146906973e-01   +4.275136916220096e-01   -1.237265082366297e-01];
L1E_L2E_iAMPA_netcon = [-1.341715898414651e-01   +3.757076615012466e-01   +8.561636597956229e-02   +3.987260517839430e-02   +2.049474400341345e-01   +1.377512334508116e-01   +4.081082583530018e-01   +5.802612582530305e-01   -4.681308308147182e-01   -2.415091179126010e-01   +1.625180252080886e-01   -6.430837088640935e-01   -5.052791592782118e-01   +7.652345950173577e-03   +4.119995649654506e-01   -3.270246132678053e-01; -4.858915021382971e-01   +3.051642027496692e-01   +1.184108463986432e-01   +2.997112240237934e-01   -8.898816791204556e-02   +7.228131883586704e-03   -1.383506730316488e-01   +2.406951025740258e-01   -2.333986474607807e-01   +2.827023238895398e-01   -1.604969096763830e-01   +5.169835464411686e-01   +2.167660619980284e-01   -4.801525938281263e-01   -3.527454511816495e-01   +1.531058092021361e-01; +3.852629030095731e-01   -1.258698554820675e-01   -6.723489693656808e-02   -1.405292159310814e-02   -1.374275613419266e-01   +5.608246786710775e-01   +2.735242683885399e-03   -1.384850095019294e-01   +2.773801308806833e-01   +4.147246904807516e-01   -4.208110164129218e-01   +2.077981279344273e-01   +3.789605582637849e-01   +4.390460298332260e-02   +1.613523406692770e-01   -2.832715718958823e-01; -2.397153875691831e-01   +9.880151346226704e-03   +2.076252629843582e-01   +3.250716626126063e-01   -3.665979059193811e-01   +1.296979933913523e-01   +3.226912011347488e-01   -7.660373039469140e-02   -4.086763104893845e-01   -2.582068627130953e-01   -5.343015068750501e-01   +9.642068140866587e-02   +3.376518515944474e-01   +4.736200905471326e-01   +3.823640948996788e-02   -1.729962574100871e-01; +4.573477452561946e-01   -1.049690290033865e-01   +3.961087991055412e-01   +2.977968698423561e-01   +8.668600432194713e-01   +4.247104572517597e-01   -5.968160429890684e-02   -1.930180055538031e-01   -1.553740772170005e-01   -2.251114262130590e-01   +1.394093071459911e-01   +1.237415641905823e-01   -9.893967810366278e-02   +3.700854548205160e-01   +8.523841372588592e-02   +4.441979920015865e-01; +2.099825050608091e-01   -3.292666977696225e-01   -2.219384769089277e-01   +3.987225177908394e-01   +1.638921033480110e-01   +6.194455791263374e-01   +3.821010792881764e-02   -4.502826221823071e-01   +3.700615611670047e-01   -5.309755087084351e-02   +5.982376080324854e-01   +5.180242624152681e-01   +3.807482449858197e-02   -2.272683517995679e-01   -3.796855222431221e-02   +4.451480158726400e-01; +1.170896752846401e-03   -4.777515713945600e-01   +2.099694665458964e-01   -2.115698355335393e-01   -8.130964158652579e-02   -3.230088329023945e-01   +7.239849829714444e-02   -3.290901604014197e-01   -8.027492876776079e-02   -1.119293519291548e-01   +1.287848827436406e-01   -5.097345650111896e-01   +1.259435974779445e-02   +1.316567651874505e-01   +3.945348275649865e-01   +5.643453982739464e-01; +5.293606448501133e-02   +3.808227798737020e-01   +5.553579022785670e-01   -2.784601225760136e-01   -4.014315220037118e-01   +1.909038465044425e-01   -3.998702143359985e-01   +4.593583865291878e-01   +8.226376722952719e-03   +4.500264043738230e-01   -7.819595769153456e-02   -4.015949517132638e-01   +6.768218027093552e-02   +2.132072851419645e-01   -4.447386847552977e-01   +3.269037558944172e-01];
L2I_L2E_iAMPA_netcon = [-2.655733444456810e-01   -3.042839833937134e-01   -3.007754398409572e-01   -1.272738425193777e-01   -3.975785463624411e-01   +7.503452069472633e-02   +2.475622005520371e-01   +2.550595063218407e-01; -2.879375747308760e-02   +1.741530007018295e-01   +1.489893652789804e-01   +2.367587956152190e-01   +2.365328079802383e-01   -7.270062076591505e-02   +8.873224840512343e-03   +2.948244419757444e-01; +4.223695548214846e-01   +7.189629845529882e-02   +3.589577004992400e-01   -4.180442943844667e-01   -3.809488197803354e-01   -1.503260088896964e-02   +2.606558049319086e-01   +2.046019732840498e-01; +2.379846022963584e-02   -1.387373142521934e-01   -1.045443107579455e-01   -2.451204275163392e-01   +2.883011242518583e-01   -1.602106586292920e-01   -4.062324405101321e-01   -3.301913628080293e-01; -1.726973802126595e-01   +3.877625408684172e-01   -2.173661229848911e-01   +1.525908846269944e-01   +5.218515978033337e-01   +1.920806824626642e-01   -1.727620909447109e-01   +2.457061953520167e-01; +5.157545030336708e-01   -1.758032946748476e-01   -9.875626882283700e-02   -1.500816954417941e-01   +8.126034559538745e-02   -6.345937897031425e-01   -2.048449481152630e-01   +4.624169438104944e-01; +7.903476213257121e-01   +1.168297102717820e-01   +1.644059024311428e-01   +3.618342734899535e-01   +2.288872254646352e-01   +7.724767348067894e-02   -3.183977077954031e-01   -1.789855462353015e-01; -1.639555513009900e-01   +2.483702845732275e-01   -6.424224935747458e-01   +2.330780384338315e-01   +5.832945460266609e-02   +1.899257385496111e-01   +1.343213311843782e-01   +1.891593144082033e-01];
L2E_L2I_iGABA_netcon = [+2.987548356594701e-02   +7.725929367520512e-02   -5.084763801941896e-02   -3.058543733986709e-01   +5.739371980097782e-01   +1.327633628866539e-01   -2.768911824467606e-01   +6.106883138228572e-01; +8.114606552380086e-01   +3.545519341905480e-01   -1.019539941240095e-01   -1.538762879961701e-01   +2.922986727486967e-01   +4.346193660647751e-01   +2.606185684419747e-01   -5.605243041970004e-02; +5.581837033000855e-01   -9.398141146562189e-02   +4.633168536281116e-01   -1.865133285115015e-01   -5.140576663185025e-01   +5.297747277179921e-01   +2.057513564485498e-02   -3.570768855817747e-01; -1.951829926749420e-01   -3.314919817286891e-01   +6.297376771072080e-01   -4.038187335966619e-01   -2.905276637998673e-02   +1.301324846612981e-01   +7.165372624928485e-01   -3.105172052924503e-02; -1.183154790167729e-01   -5.732150446898361e-01   -4.365354913069005e-01   +9.946408807859647e-02   -4.531568095288049e-01   -8.982647855122397e-02   +1.494372793510616e-01   -6.472004347387386e-01; -5.890486454362165e-01   -3.217664118713165e-01   -5.166709501082577e-01   -4.153093218546501e-01   -2.655813073441887e-01   -1.561871101668104e-01   -1.139362582229004e-01   +4.567575322303420e-01; -2.020196561952629e-01   +1.857807616645298e-01   -4.932419007142456e-01   -8.213930776040526e-02   +1.101800356624887e-01   -1.624363404634436e-01   +4.690555702241483e-01   +3.367455695587719e-01; +1.015165218833952e-01   +4.253670302659882e-02   +5.320062510406799e-01   +5.444968118129829e-01   +4.344514613494296e-01   +1.608922782528549e-02   +2.608461462805415e-01   -1.856205138696514e-01];
L3E_L2E_iAMPA_netcon = [+1.559743555554323e-02   +8.470785341083550e-02   +7.783772701282499e-02   -1.163699806167192e-01   +1.205129088158378e-01   +3.814638194673161e-01   -3.581839598214890e-01   +1.719659951221906e-01   +2.111032197743191e-01   +1.664368866051743e-01   +5.555795209658934e-01   +3.462328087840939e-01; -2.261683114769902e-01   +3.482410635832287e-01   -2.433021708405648e-01   +1.189655486099349e-01   +1.592044760017532e-01   -2.809896127300293e-01   -6.013302932465751e-02   -7.090637415398075e-02   +2.436256274275135e-01   -4.779849224356664e-01   +2.843807354694936e-02   -3.717381980663386e-01; -4.741479644618852e-01   +3.942669174558086e-01   +5.213290876200394e-02   +1.952488996932800e-01   +2.216371142800295e-01   -3.318439980387140e-01   +4.273542245844287e-01   +3.437829416136490e-01   +1.128114038611586e-01   +4.809352880846693e-01   +3.263391297922530e-01   +3.096888044629771e-01; -8.080767246396464e-02   -1.561138455634773e-01   -4.153914358331788e-02   +4.209257024296100e-01   -5.353565818315248e-02   +2.407599492652148e-01   +6.030609414092043e-02   -1.192972773485731e-01   -3.938984271496705e-01   +1.078416051162430e-02   +1.373251987144987e-01   +5.068260191535697e-01; +2.178258896526127e-01   +4.767049472740206e-02   -2.068325788020126e-01   +1.967643016780853e-01   -1.155093789907482e-01   +5.212067498493320e-01   +5.567425605020474e-01   -1.144817673090423e-04   +3.009216318603029e-01   +4.028434174914579e-02   +1.395090389731221e-01   -1.319787539860401e-01; -5.432138209824342e-01   +2.373762330751729e-02   +7.673638909771031e-02   -3.679124596845461e-01   +1.046891850255852e-01   +1.256130793926322e-01   +3.190688501628147e-01   +5.487222257761937e-01   +6.358915067526816e-02   +2.812342644902445e-01   +1.983956251636186e-01   -3.336106135232851e-01; +2.737806262403530e-01   +2.747681891330818e-01   +1.932725860517872e-01   +6.555239535464016e-01   -1.293827102772997e-02   +3.129794149701387e-01   +2.993416990705826e-01   -3.665278200765467e-01   +3.760321814684850e-01   +2.254132475138402e-01   -4.531854905999899e-01   +7.217994863445967e-01; -2.666443930227466e-01   +5.766265884284398e-01   +6.254027707596465e-01   +3.513732674229036e-01   +1.315535887071947e-01   -5.427763800955823e-02   -3.864403708804102e-01   +5.916764488118116e-01   -3.773143845355049e-01   +2.203428541859082e-01   -4.938098155336376e-01   -4.569695286371942e-01];
L3I_L2I_iGABA_netcon = [+3.873141113696330e-01   +1.049227829516473e-01   +6.528891822753641e-02   +5.814556195017575e-01   -2.044873287553781e-01   -1.612640005327634e-01   -3.556961771091384e-01   -7.826531731885009e-02   +6.293645141991069e-02   -2.388949693555860e-01   +2.768598306334118e-01   -3.139495977739424e-01; -2.463273593012046e-01   +8.561688343594313e-01   -2.568144712737332e-01   +1.332226587166301e-01   +6.357659993955406e-01   -2.885713480613053e-01   +5.637991699454527e-03   +6.492228360527593e-01   +1.203601233772107e-01   -1.094665999711945e-02   +3.822584677234072e-01   +3.678383851187114e-01; +3.692128578867415e-01   +8.931124807799479e-02   +4.915419043295523e-01   +3.385760016244010e-01   +1.937144813312291e-01   +2.716156234297308e-01   +4.839420447121435e-01   +7.577507462685973e-02   +4.184740630972788e-02   +5.605913100403523e-01   +6.275150383529424e-02   +8.742685770774123e-01; +7.525689982987308e-02   +5.533182405588518e-01   +2.934113341078192e-01   +8.472635597076751e-02   +3.330723645726391e-01   -2.990565165928326e-01   +2.966176828479069e-01   -1.972320662087431e-01   -4.113400519546537e-02   -3.774142116050778e-01   -3.936179418409197e-01   -8.761467061190627e-02; -2.938874058220211e-01   -4.004069758932686e-01   -5.549287681837570e-01   +1.479585100535624e-01   -8.167804235598822e-02   -2.039881595281562e-01   +3.584529153614456e-01   +1.746450038153285e-01   -3.505932041551053e-01   -6.547145534281892e-02   +2.872124493054633e-02   -4.366795904562660e-01; +3.412154121516332e-01   -9.882345420127128e-02   +2.620454396549351e-01   +4.527936268400695e-01   +1.888743289864507e-01   +2.746875950820126e-01   +7.174839713480680e-02   +8.164236012061347e-01   +1.256230740237431e-01   -1.511976987043460e-01   -3.523014469495312e-01   -4.742030632767749e-01; +8.275017782693975e-02   +1.232564795713300e-01   +2.920439229428600e-01   -3.982117052472814e-01   +2.736667353841506e-01   -3.805930916441878e-01   -7.130154131856162e-01   +1.494089084210129e-01   +2.518864645478040e-02   +1.782478733453589e-01   -1.510120986001499e-01   +7.222921442105985e-01; -3.869164826159538e-01   -4.123123805496151e-01   +4.823807948635435e-01   +6.304323695880613e-02   +2.345854834539915e-02   -5.373590798676727e-01   -4.860179304993144e-01   +2.619789948198885e-01   +2.639426083528675e-01   +1.094423180781372e-01   -4.791853252197547e-01   +3.365675793918831e-01];
L2E_L3E_iAMPA_netcon = [-6.535645832085019e-01   -1.263640697633025e-01   +2.157200466582195e-01   +8.003252905537132e-01   +2.223916497380491e-01   +1.457516555071958e-02   -1.087259641136713e-01   -5.796017361517366e-01; +2.744820440589679e-01   +4.334505910700643e-01   -6.037713846984982e-01   +4.038472085098938e-02   -1.982813745629685e-01   +5.773594681396099e-02   -5.584345139999173e-01   +2.575663097520287e-01; -6.396857030245666e-01   +2.162133226539159e-02   +2.350376545326558e-01   +1.006597113750659e-01   +3.251093475810952e-01   +9.464598435232224e-02   -2.578330234715007e-01   +7.117034095852941e-01; -5.739309789101791e-01   -1.309406650796255e-01   +3.891879973764556e-01   +1.286194420973015e-01   -3.268000633218899e-01   -2.684454461162848e-01   +2.879149301776758e-01   +2.632624152449144e-01; +2.311340353299916e-01   -6.129362976947060e-01   +7.271072071689993e-01   +5.684378504578766e-01   +2.844042255233399e-01   +3.240838698106248e-01   +6.588943777294720e-01   -2.400437269320842e-01; -2.980335731480769e-01   -8.810395124400253e-02   +6.603371722441952e-01   -5.704122412077588e-02   -1.115992956096401e-01   +3.258238598014920e-01   -3.934963254908102e-01   +5.061593199287514e-01; -1.785387902725707e-01   -4.936878669150805e-01   +1.942046905275051e-01   +3.593210876631785e-01   -3.536684044574026e-01   -1.993679985962242e-01   +1.047332774451919e-01   -1.889866781917667e-01; -2.097238280669363e-01   -3.382836286447209e-01   +4.717461108983048e-01   -6.774062618126149e-02   +1.233925949491601e-01   -2.648579251268859e-01   +1.684399035900167e-01   -1.722053742573922e-01; +4.625204575097001e-01   +1.600908332956390e-01   -5.421989145217413e-02   +4.708868944944883e-01   +6.903449287568051e-01   +6.558564274440446e-01   +5.231418986996558e-02   +3.688581720549025e-01; -3.124406980543510e-01   +1.813059384371764e-01   +5.554138247174507e-02   +2.041151863660543e-01   -1.599265489554950e-01   +1.243374028240094e-01   +1.579642248251817e-01   -1.918507010398099e-01; +9.609267202617640e-02   +2.365953732937112e-01   -1.574130269628604e-01   -1.273103902632530e-01   -6.500585712984087e-01   +5.951500162695310e-01   +5.285378978911079e-01   +1.722186174967533e-01; -2.808108862242548e-01   -5.869835968848368e-01   +6.512174478278426e-02   -1.011130676379167e-01   +4.211020181165125e-01   +2.298220273295616e-01   +7.867916787526789e-02   -2.054361077224720e-01];
L2I_L3I_iGABA_netcon = [-4.270514581528416e-01   -2.655230958837663e-01   +9.870378178230876e-02   +4.365640034465039e-01   +1.484979469861799e-01   +1.075430102187705e-01   +4.383903210043162e-01   +2.302939794152436e-01; +6.236963829141266e-02   +7.044789956116724e-01   -1.548480836715982e-01   +2.527031507551972e-01   -2.085213085200924e-02   +7.682115259346572e-02   +6.750414398012833e-01   +1.997507936007510e-01; +2.912499917511924e-01   -3.861017805620170e-01   +4.462149527131951e-02   +2.220829941377530e-01   +5.807851669910508e-01   -3.954204748353292e-01   +2.896900769953715e-01   +3.387304423380778e-01; -2.446344945362584e-01   -1.187641533435299e-01   +3.549525317853764e-01   -1.137185968048897e-01   +4.872177563071206e-01   +3.144515797385256e-01   +6.363703332214838e-01   +1.409432045485441e-01; +1.211742492006545e-02   -2.844613806553054e-01   +2.925664909862463e-02   -2.327455020280981e-01   -4.138477434262529e-01   -1.355701362151773e-01   +3.788722668285263e-01   +5.905965059609148e-01; +1.212509423670572e-01   +3.856667737441535e-01   +4.231510441114922e-01   -4.968698723162663e-01   +1.588745578773341e-01   +8.303477256356762e-02   +7.655644797142709e-02   +2.096443110239582e-01; +1.841486979891721e-01   +5.649574219041953e-01   +4.842598309398956e-01   -4.969976247519409e-01   -3.127334200947397e-01   -4.440993848602489e-01   -2.173241384630885e-02   +7.582913462706935e-02; -3.213280873259428e-01   +1.736231940037711e-02   -5.140256064729291e-01   -2.969577053374134e-01   +8.685936139840486e-02   -4.424095348073421e-01   +5.285369073905770e-01   +4.418091806419923e-01; +6.772449873754379e-01   +6.505839453810192e-01   +2.531941067966287e-01   -1.476641132014765e-01   -1.366790434179964e-01   +5.489617724702915e-02   -1.374716511839533e-01   +4.073614904975405e-01; -7.050248022493090e-02   +6.993905632017922e-01   -7.657646253623987e-03   +2.171297536947334e-01   -9.733027197040234e-02   +5.205724929913472e-02   -4.901573947643011e-01   -2.639209181921228e-01; -1.667896011172390e-01   -1.383724265297289e-01   -6.113081759050565e-02   -5.133375336875740e-01   +2.161382354806405e-01   +6.517363476919955e-01   +5.166836030202420e-01   -1.890532344684717e-01; -1.356856503412304e-02   -5.777309889625379e-02   -7.110305912337460e-02   +3.128429874056309e-03   +7.701263213369264e-02   +5.828433462862530e-01   -5.793742210629416e-02   +1.197230440685861e-01];
L3I_L3E_iAMPA_netcon = [+3.050477966098237e-01   +3.885321604479137e-01   +6.201670696743100e-03   +2.782813806864260e-01   -2.717317783823486e-02   +1.269751533957850e-01   +1.853632766260255e-01   +1.402249826545803e-01   +2.984685040371196e-02   +6.295492622813179e-01   +3.140564955881067e-01   -4.356011960300660e-02; +9.428509351455693e-02   -1.108090427277138e-01   +2.692589174428509e-01   -4.777017400312863e-01   +2.135646254076214e-02   -2.598235308165624e-01   +1.316314946118511e-01   -4.749602774628192e-01   +5.354209265357295e-02   +5.785059568890873e-01   +7.184300835632595e-04   -1.031172504867360e-01; -1.160463661876404e-01   -1.535339377136297e-02   +5.148943185614260e-01   +2.353414057349378e-01   -4.212047055641041e-01   +3.735476263436547e-01   +4.833145446081507e-01   +7.801714638264540e-02   +3.079962879111866e-01   -3.169231506271010e-01   -6.633470180177136e-01   +1.868278179259515e-01; +5.675913136771602e-01   -2.766782343231318e-01   +3.103492385545581e-01   +2.923396323200589e-01   +3.929777886669066e-01   -2.494129287437809e-01   -2.241030562604861e-02   +3.786515395382128e-01   +1.605465228706815e-01   -5.649977898808300e-01   -6.581724270526670e-02   +1.131852120006167e-01; +1.708276612766613e-01   +3.126963014162626e-01   +2.194178280423065e-02   -2.564811519033929e-01   +3.616291743193347e-01   -4.399991456908221e-01   -4.452971366019307e-01   -9.028093840104634e-02   +2.679580991922648e-01   -1.869151084322077e-01   -1.047939800618873e-01   +1.955725603941189e-01; -9.027164242131915e-02   -5.169504430673691e-01   +2.260200919738906e-01   +2.212661749935132e-01   +2.731232937016942e-01   +2.209711199111814e-01   -2.843151816662022e-01   -6.273535180226446e-01   +1.116336498833106e-01   +7.310376746647126e-01   -6.889052925869894e-01   +3.405966058224779e-01; +6.823678499787214e-02   +7.530510919358353e-01   +2.515542276603264e-01   -5.661740473960053e-02   +1.978722910952048e-01   +6.978169593178238e-02   +3.258871876867531e-01   +6.376937845391625e-01   +1.860204367663144e-04   +3.806371117151530e-02   +2.083736909433059e-01   -3.796884452162214e-01; +3.535546847304565e-01   +6.391944144627038e-01   -2.636245314436745e-01   -6.487947466017711e-02   -1.442208686996218e-01   -2.358912246793135e-01   -3.641233073324012e-01   -1.057120432282513e-01   +1.196928611927136e-01   +1.011416183433392e-01   +8.137754015326710e-01   -1.623072202860644e-01; +1.565836992912280e-01   +3.772290924620623e-01   +2.267879598045883e-01   +2.385496922170179e-01   +2.752486940779426e-01   -4.571394032042943e-01   -3.284593606541526e-01   +1.968073598019591e-01   +2.196779046376807e-01   -1.973427024695103e-02   +4.762861121413087e-01   +5.712125117195235e-01; -1.474232252775243e-02   -3.069288235281302e-01   +3.540293283954929e-01   -1.073820914743864e-01   -1.944256067392614e-01   +5.612091002787404e-01   +3.199655149045798e-01   +4.284769919826085e-01   -2.232144605946693e-01   -2.068938615799614e-01   -3.155290217542899e-01   +8.273501695288864e-01; -2.266185780423041e-01   +3.635686634221009e-01   -1.569596392976400e-01   +3.467536765727974e-01   +3.655857091738156e-01   +5.051042996033575e-01   -1.275401412823328e-01   +1.670722676359397e-01   +4.321874940789598e-01   +8.525356018396255e-02   +7.823228805336087e-01   +8.561856518116184e-02; -4.230338623952177e-01   +1.451278938762818e-01   +7.496890800290897e-01   +3.016115221436650e-01   +2.863929430741271e-01   +1.109903025344736e-01   -2.128896426647056e-01   -1.192609808116406e-01   -6.271952705689730e-02   +1.273934624896282e-01   +1.035845229433727e-01   -1.141189836457256e-01];
L3E_L3I_iGABA_netcon = [+7.232740660316378e-02   -1.052007904339501e-01   +4.980635873145280e-01   -1.679754149590851e-01   +4.258688999645238e-03   -5.847951787541756e-01   -2.004095859709099e-01   +3.034308714650922e-01   -4.568067272375533e-01   +6.287718118085949e-01   +2.658485025302012e-01   -3.185661058994484e-01; -6.412933147654525e-01   -7.082454702181227e-01   +3.463636610232921e-01   +1.521903538128244e-01   +2.828490208701208e-01   +2.496828804980874e-01   +3.806859556337747e-01   -2.401887333422363e-01   +3.901465589976306e-01   +4.140961020907529e-01   +2.151038263330499e-01   -6.528069087024313e-01; -3.571202007481053e-03   +1.942782359301626e-01   -3.792864123605138e-01   +7.969264558652886e-02   +4.580004814220897e-01   +3.395262848015903e-01   -4.346412478586746e-01   -2.338433503185718e-02   +5.276813068502613e-01   -2.841038026564991e-01   -6.048992748692891e-02   +7.078947574360139e-02; -4.313707057277013e-01   -2.617125360038640e-01   -1.418813922261223e-01   +4.624407047079998e-01   +8.093833537310088e-01   -7.950188557032077e-02   -4.801116338610081e-01   -1.293751333823383e-02   +4.714473327565776e-01   -4.461073965270061e-01   -4.363129283054943e-01   -3.711247497399480e-01; +6.477018581367623e-01   -4.903459688410104e-02   +4.232177775243424e-01   -9.886781152634222e-02   +2.543722275472877e-01   +6.215905287671619e-01   +3.061432282660759e-01   +1.055518103879966e-01   -3.002629713512305e-01   -1.833499936890030e-01   +6.652451695887254e-01   +7.698026875555374e-02; -1.882944752113698e-01   -2.448568814696770e-01   -4.689096266189537e-01   +2.918379683188997e-01   +2.306837339590051e-01   +1.841833758779031e-01   -3.698054218018060e-01   +4.329552404854019e-02   +6.408297137619835e-01   -3.820193088474391e-01   -2.105498649931964e-01   -4.207405235183574e-01; +3.384831310449372e-01   -4.740747168610766e-02   +6.455448397123404e-01   -5.386023900573890e-01   -5.338784283420011e-01   +6.480331831229653e-02   +1.780060426673427e-02   -3.902365648047689e-02   -1.246381928331148e-01   -6.906652762103579e-02   +1.766321417685009e-01   +3.020309609887269e-01; +9.358761099411345e-02   -3.900642206978852e-01   +2.805059961590116e-01   +4.307467070900788e-01   +5.170981354696174e-01   +1.776941443535544e-01   +2.552931353919393e-01   +2.892192459564144e-01   -1.045192952067170e-01   +2.156552464266865e-01   -4.653569757252541e-01   -1.108004828451956e-03; +4.048130866761251e-01   +6.017703911613642e-01   -8.071251317462580e-02   -4.268121869036127e-01   -6.476305932769649e-02   +5.972151193340978e-02   -2.814664185394877e-01   +2.110162846166486e-01   +4.321532265906270e-01   +3.557560162747665e-01   +3.991599549336357e-01   -2.598739491439869e-02; +3.444830396877803e-01   +2.125063729076420e-01   +7.402714733096684e-01   +1.667673721987224e-01   +2.420105706538480e-01   +4.790008748142413e-02   -2.924722943991862e-01   +1.944029149613196e-01   -1.956576809964111e-01   +4.354353079624211e-01   -8.582707327409980e-02   -5.623456015499528e-01; +6.387700978832000e-02   -2.026392292775717e-01   -1.680500857522423e-01   -2.512254248285394e-01   +8.994809981622043e-01   -6.976907045804615e-02   -2.872288705486758e-01   -6.961520931936493e-02   +1.705773512496803e-01   -1.368931468547750e-01   +2.684640267910629e-02   +8.117961528443934e-01; -7.563080520255097e-02   +5.620962613584429e-01   -9.575018253146525e-02   +4.882410562432809e-01   -3.259073904716855e-01   -4.424976520323330e-01   -1.403126743651625e-01   +1.455373650868674e-02   -6.142698469065427e-03   +1.954585959991881e-01   +4.721856073135967e-01   +5.732835770328604e-01];
L2E_Input1_iAMPA_netcon = [+4.703603959562035e-01   +4.794643689955695e-02   -3.036561906796186e-01   +4.152969402111458e-02   -7.230810242027164e-02   +1.881278443419254e-01   +8.671125214487537e-01   +1.356839014319868e-01];
L2I_Input2_iAMPA_netcon = [+9.311309557403255e-02   +8.875882037392811e-02   +3.130884224562084e-01   -4.980786715172010e-01   -7.231092298581075e-01   +2.695579031000822e-01   -3.824578435444673e-01   +5.604023523539146e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
