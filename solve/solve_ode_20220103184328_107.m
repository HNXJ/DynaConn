function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+7.141224503709662e-01   +9.460377953558735e-01   +6.982621820115320e-01   +1.549224860216640e-01   +9.216484080592434e-01   +2.193400393292064e-01   +7.405976083508489e-01   +3.025827597890896e-01   +5.330329333294159e-01   +8.288024333295405e-01   +9.685085803886516e-01   +9.645132296359846e-01   +6.962303120589584e-01   +3.710998421006834e-01   +2.973170849213285e-01   +3.777645694331660e-01; +3.459780714200546e-01   +1.302676581468599e-02   +1.416466790780361e-01   +1.765207405036095e-01   +7.082844864520617e-02   +8.080644866064577e-01   +7.943678393618409e-01   +7.591241062588177e-01   +7.844080838677862e-01   +1.815243031731397e-01   +4.660178684310853e-01   +6.559970121773467e-01   +3.759787951407608e-01   +2.753711377709521e-01   +6.848490829362555e-01   +9.536804835462770e-01; +2.077985614764687e-01   +4.676996152653445e-01   +8.323950731344056e-02   +7.027897073081489e-01   +3.130250317304447e-01   +3.814047539050681e-01   +6.634142045035467e-01   +9.530104027288193e-01   +4.857704947282605e-02   +9.259059251361234e-01   +8.698276174101256e-01   +2.090463961103823e-01   +5.417692883113029e-01   +7.557552291251445e-02   +7.729398395554793e-01   +8.118181254636039e-01; +2.479656896096656e-02   +4.897965116655771e-01   +4.327780492391944e-01   +8.324344923951468e-01   +6.280963470321286e-01   +8.567664124024917e-01   +4.409133237895554e-01   +8.720605432783708e-03   +4.623053061398987e-01   +4.205370231121263e-01   +9.464975531585560e-01   +8.969116748546010e-01   +5.183203669840407e-01   +1.507163569564595e-01   +7.203997498778527e-01   +8.922350901595033e-01; +7.657804969484755e-01   +5.158041709244424e-01   +8.949320510410012e-01   +8.125264866371790e-02   +9.058424361784778e-01   +3.227491989269139e-01   +5.752019020822795e-01   +4.070576387310352e-01   +9.377783090320003e-01   +3.001550845199675e-01   +2.321416255213804e-01   +4.880020058875604e-01   +7.636108626564332e-01   +3.649539124393757e-01   +2.785749008785173e-01   +6.881823242330110e-02; +5.712722646986638e-01   +2.873007872408555e-01   +7.320268390033272e-01   +8.347100365230818e-01   +7.961640469624738e-01   +3.791358033920497e-01   +5.183888160894292e-01   +1.521411961443770e-01   +4.735814357696060e-01   +3.485677942817888e-01   +9.178943638911216e-01   +6.619072251880422e-01   +8.013384854234187e-02   +7.169346234744971e-01   +1.403901598613385e-02   +9.023404463542373e-01; +5.770309441778763e-01   +5.652290961158251e-01   +6.807428007316939e-01   +5.417096657581726e-01   +6.431227860284294e-01   +6.367095866640579e-01   +7.250393710388233e-01   +8.217232331483008e-01   +7.784487742225822e-01   +9.716804694828376e-01   +6.342787264834443e-01   +5.259841343496950e-01   +5.066813239824788e-03   +5.321776469032086e-01   +1.506138587223870e-02   +6.677105553914366e-01; +3.900105558036509e-01   +5.099466628301592e-01   +2.020591520598523e-01   +9.622644920406686e-01   +4.398589364422307e-01   +3.868583491367276e-01   +2.228071064403287e-01   +2.879322204959809e-01   +1.092726376410787e-01   +5.306169099530488e-01   +2.843346917411453e-01   +7.085835163495655e-01   +4.008172448813989e-01   +2.321634150158572e-01   +9.363159405671465e-01   +3.469674044517035e-01; +5.568934476991979e-01   +6.788116082925448e-01   +5.298630133020636e-01   +6.775122289086623e-01   +7.483535723867542e-01   +6.725654607193639e-02   +9.973917415243875e-01   +9.775529862318686e-01   +5.218471881626606e-01   +7.899671421292410e-01   +8.557018034470295e-01   +7.185819744257674e-01   +6.627181063828759e-01   +4.710545273683663e-01   +9.338641160272091e-01   +8.370241047271072e-01; +1.831558699399393e-01   +6.153735135277363e-01   +8.306403171357405e-01   +3.359335088263307e-01   +8.254681449771540e-01   +1.712398223588984e-02   +6.197696469617000e-01   +6.257954289371963e-01   +6.357147972805514e-01   +7.940383598363803e-01   +1.658152300378287e-01   +2.940375826517931e-01   +3.682399609064819e-01   +7.169331385601402e-01   +3.736855409495580e-01   +1.987873296276081e-01; +1.179570665049022e-01   +5.649896737516906e-01   +1.752551217412330e-01   +2.208427848556312e-01   +3.415307528902662e-01   +8.793736000490298e-01   +9.803402241345147e-01   +7.429197625618539e-01   +5.786114049774832e-01   +1.437625312926071e-01   +8.271486573498269e-01   +1.172362511682137e-01   +3.928311587869279e-01   +5.145566134443285e-01   +1.088907304152776e-01   +8.411469911456358e-01; +5.917256865121009e-02   +5.052908193197048e-01   +5.179186853091422e-01   +5.685590515887999e-01   +1.393921010450779e-01   +1.576173975417103e-01   +4.954668314014528e-01   +8.720678744711152e-01   +8.356525503474542e-01   +4.567191708158861e-01   +2.167562067013811e-01   +3.248951036491201e-01   +1.343074925817132e-01   +5.134137032070362e-01   +7.191568851567306e-01   +4.248460036519706e-01; +9.326731137878298e-01   +6.673933222333807e-01   +3.563659101317012e-01   +2.260471419915743e-04   +5.040708739276241e-01   +9.138270933362576e-01   +5.220983522304530e-01   +3.293908398949797e-01   +1.151822836640979e-01   +4.582432019069118e-01   +2.675298842408854e-01   +4.570650393021821e-01   +3.383789411570447e-01   +3.858885320736835e-01   +4.485920641887832e-01   +5.581932060392205e-01; +7.456325454279491e-01   +6.332685684094070e-01   +6.457993118258840e-01   +5.885176968358544e-01   +4.139343800892838e-01   +5.570715259501726e-01   +8.541014240281316e-01   +9.829467145907007e-02   +5.123001876691256e-02   +9.544756849787371e-01   +8.690124227228027e-02   +7.163059842734605e-01   +1.230477427799388e-01   +4.783787943821376e-01   +1.274763729572181e-02   +4.473877773201132e-01; +2.434043056172625e-01   +1.442069615001456e-01   +2.816978856273198e-01   +8.911014342115766e-01   +1.714015101259294e-01   +9.222924805388260e-01   +2.537056996986283e-01   +4.503100380342944e-01   +5.176737798872992e-01   +5.305988469953354e-02   +9.165071112943552e-01   +4.051826704513480e-01   +3.683660194346379e-01   +7.396854125121973e-01   +1.236899713665563e-01   +7.602565914641727e-01; +2.042681137614801e-01   +1.785755570071090e-01   +4.364093415670482e-01   +2.544748099288756e-01   +4.940788411629665e-01   +5.976625762952932e-01   +5.823438792771880e-01   +2.400446112980397e-01   +6.967548625691755e-01   +3.588936556358521e-02   +7.258942603485017e-01   +2.421408405794412e-01   +2.508400418884167e-01   +7.016590103451009e-01   +6.589861421610960e-01   +9.530163505179991e-02];
L1E_L1I_iGABA_netcon = [+8.432987452855748e-01   +7.524002418021096e-01   +8.741071833682765e-01   +4.358816112369993e-01   +9.179659209849169e-01   +7.794921918211657e-01   +3.218084218732541e-01   +6.413618573950519e-01   +9.430994212938615e-02   +2.626836082940024e-02   +1.291508867222106e-01   +5.197955611808459e-01   +8.696398591481690e-01   +5.759466195035318e-01   +1.660632778001499e-01   +6.274502520837341e-01; +6.208838681805654e-01   +9.952039621602708e-01   +3.093630575584631e-01   +1.472183810786280e-01   +8.829351220791205e-01   +2.724990593539783e-01   +9.628160561474701e-01   +4.297587902927859e-01   +2.927851913060610e-01   +5.140924745900706e-01   +4.243007143862516e-01   +2.038059323888617e-01   +8.029336840490671e-01   +2.884627222050294e-01   +5.447220774435347e-02   +3.370028739715699e-01; +6.709636902219787e-01   +3.708095475483471e-01   +4.330811801358267e-01   +6.544484641355880e-01   +5.857982772327884e-01   +5.270282227229631e-01   +3.527970171297000e-01   +4.784432425200281e-01   +3.264958808238937e-01   +8.623689585590936e-01   +4.811399598478271e-01   +7.753704891276912e-01   +6.460616298280836e-01   +1.321603582871569e-01   +2.118391002380215e-01   +1.569490478240955e-01; +7.818249262153598e-01   +5.029996063489619e-01   +3.814849680485356e-01   +7.212527119509917e-01   +8.355150333607096e-01   +4.032314528137514e-01   +3.199587307801096e-01   +1.003337188613356e-01   +4.830811777388093e-01   +5.823210472079229e-01   +6.736226956489907e-01   +3.912012397264634e-01   +7.345994997467207e-01   +5.045512839502653e-02   +2.039186473671564e-01   +4.020789245276233e-01; +3.091085036084195e-01   +7.580061914610864e-01   +6.566535761339830e-01   +1.618313225684035e-01   +7.758036352952749e-01   +7.794774610391885e-01   +9.086117631102619e-01   +8.066251817989397e-01   +2.413869956391463e-01   +4.220983922048175e-01   +3.571269863564704e-01   +6.667513920002967e-02   +6.672083962468333e-01   +6.234271717060651e-01   +2.175485245212321e-01   +9.132711808887830e-01; +3.295448417874734e-01   +1.263321349861624e-01   +2.377926688638004e-01   +3.431749318745401e-01   +7.857647758192717e-01   +2.568612634336038e-02   +8.853306252224127e-01   +6.470565834653379e-02   +4.537278043117092e-01   +7.135448592471547e-01   +4.958456024419419e-02   +7.565247098256773e-01   +8.810308309724941e-01   +6.052030422993000e-01   +5.785537174408464e-01   +1.491382454975263e-01; +6.338981397297337e-01   +5.179183058095017e-01   +6.863164917765587e-01   +1.060951005550207e-01   +7.013034271177224e-01   +4.116631904750371e-01   +3.533071187907341e-01   +9.543740481168635e-01   +7.583720871434546e-01   +2.339371585277055e-01   +2.903365513407996e-01   +4.534739681956502e-01   +8.529070471761692e-01   +3.716634981757954e-01   +3.372043274107264e-02   +4.639188585138274e-01; +9.020004993938391e-01   +9.061690731674122e-01   +3.265398413653068e-01   +4.128660814873501e-02   +1.793825845665642e-02   +8.263398322004264e-01   +7.501323225421470e-01   +7.734929776317760e-01   +7.177270259830859e-01   +5.948887741606981e-02   +7.942054746064563e-01   +3.195709338801417e-01   +4.038669593068921e-01   +8.316978648613645e-01   +7.956100482929545e-01   +7.764402658112278e-02; +3.712769608675277e-01   +9.956089120611172e-02   +8.803007348086613e-01   +4.782553430101869e-01   +3.301323134119892e-01   +5.930164606053953e-01   +1.268518173398734e-01   +4.408730843673830e-01   +2.382816939869626e-01   +9.764974850822303e-01   +6.514399669779262e-01   +2.775504424337409e-01   +1.048922105001705e-01   +5.199881512329443e-01   +1.352131561841906e-01   +3.424733405929124e-01; +8.817365911054688e-01   +1.789939904789258e-01   +9.990674849687080e-01   +4.772375936040701e-01   +9.469995825804107e-01   +2.129058719003172e-01   +5.995726103032317e-01   +1.654911103781317e-01   +6.990071656312243e-01   +9.694677426311530e-01   +7.096120818530555e-01   +5.841954198848415e-01   +4.036594346771883e-01   +8.008910608031938e-01   +5.826269489849906e-01   +4.960846752766466e-01; +1.243420630753900e-01   +1.726291315622112e-01   +6.809725330589476e-01   +5.461087728542023e-01   +3.989524522385272e-01   +2.966790731046532e-01   +4.371578938133559e-01   +8.087213049912818e-02   +3.062475301824884e-01   +1.371578747748360e-01   +7.647659198857591e-01   +9.116286106646693e-01   +3.403384468402204e-01   +5.700523100256997e-01   +8.568291247201613e-02   +4.898305637656253e-01; +8.809031161367226e-02   +5.344694882892908e-01   +3.449684411215742e-01   +6.524854861828218e-01   +6.317971900834768e-01   +2.686643132095826e-01   +9.586290471799759e-01   +7.419811944002132e-01   +4.694425111719074e-01   -1.833822347346781e-04   +3.843363304691771e-01   +4.510768926359749e-01   +1.146490800641905e-01   +7.143008276156878e-01   +2.283614464000846e-01   +1.278441202009616e-01; +5.460388290916496e-01   +9.788672463901142e-01   +5.611825831889191e-01   +3.490462258027138e-01   +8.595144866720223e-01   +9.284499021949942e-01   +9.644822272822670e-01   +5.439200669207579e-01   +4.442238602365189e-01   +9.359714935672039e-01   +3.616205147426646e-01   +9.804414438617365e-01   +8.522466572549323e-01   +7.329952315131897e-01   +4.522445619092876e-01   +8.526853056089756e-02; +6.102346596940493e-01   +8.434862540779138e-01   +8.904143150852775e-01   +2.567044126650970e-01   +3.767160318618634e-01   +5.531172176669162e-01   +2.424573352663189e-01   +4.854329381200370e-01   +7.337027658920054e-01   +7.407315691031368e-01   +8.104919962318768e-01   +1.104732344731014e-01   +8.920865143654867e-01   +4.543522811755024e-01   +1.791508675438520e-01   +6.736072424917317e-01; +7.277649994168294e-01   +6.725928447645156e-01   +6.466791124726635e-01   +1.763489371806814e-01   +2.041411358323182e-01   +4.330105479752376e-01   +7.702394476201643e-01   +8.951076572328448e-01   +8.757188552978749e-01   +4.330071830104499e-01   +3.852580986332780e-01   +4.158744580470253e-01   +6.859356464128750e-01   +2.826808767413320e-01   +4.154894914536552e-01   +1.221362672353001e-01; +9.914124835124938e-01   +8.820818618796774e-03   +3.770530219724891e-01   +4.783039451427860e-01   +9.116939706810280e-01   +3.281480514405272e-01   +7.125277202705143e-01   +5.831023505491110e-01   +9.129352838748616e-01   +9.437504757495359e-01   +8.711747800821193e-01   +3.832105323774286e-01   +7.428239177654811e-01   +1.515631306263668e-01   +9.655927484203682e-01   +9.894976050846142e-01];
L2I_L1I_iGABA_netcon = [+5.742910202013721e-01   +5.644790615798160e-01   +1.082864349708475e-01   +4.590609371512776e-01   +7.963329081002922e-01   +9.787404779874299e-01   +2.240146703202072e-01   +7.585243800221847e-01; +5.577081599223034e-01   +9.528038301806976e-01   +1.191940472636397e-01   +5.678251012580237e-01   +5.416550853400831e-01   +4.232231143842029e-01   +6.580415287959733e-02   +5.060106497987824e-01; +6.113591472622276e-01   +8.962952885331950e-03   +4.332950218346953e-01   +8.180927386672940e-01   +2.574160135906033e-01   +3.934701348604862e-01   +8.355448846278876e-01   +8.280419721050586e-01; +4.668629171512268e-01   +1.268590556171738e-01   +9.331277374576930e-01   +3.547613334621219e-01   +7.818003501764070e-01   +4.607868801357310e-01   +4.158559735565879e-02   +9.274790625388137e-01; +4.344949616017019e-01   +8.532308633670964e-01   +1.402382702114682e-01   +2.482885240184292e-01   +7.786920092867409e-01   +1.212656948463610e-01   +9.093914407299484e-01   +7.106087466902157e-01; +6.313858185935921e-02   +2.179188848163673e-01   +8.261299570931742e-01   +7.710179033710322e-01   +1.445776928165359e-01   +4.547291541471584e-01   +4.503157724167702e-01   +7.980228129258793e-01; +6.466662414936071e-01   +7.095942624346357e-01   +9.323246234059844e-01   +2.390978302590043e-03   +8.231220774427910e-01   +2.656066767756955e-01   +2.851953098420552e-01   +9.579741995572987e-01; +4.259269414976445e-01   +7.745286092187816e-01   +5.728097522663103e-01   +2.761508760337886e-01   +6.231355319502661e-01   +9.290200618049484e-02   +7.543733633444218e-01   +9.508460112156275e-01; +7.561076050099823e-01   +4.205763278790856e-01   +4.988531874663230e-01   +2.319452979799141e-02   +4.574486871683744e-01   +6.621290652054300e-01   +9.262474681602638e-01   +2.955727237750472e-01; +3.071224683832948e-01   +7.250784237016176e-01   +9.310749496448497e-01   +6.698959834732039e-01   +4.841024505695532e-01   +9.455382476475883e-01   +1.418310476739109e-01   +3.522431965352762e-01; +5.984907052972323e-01   +4.581045657220277e-01   +8.615429075732866e-01   +9.671046183134869e-01   +2.191437826677658e-01   +7.645548919601930e-01   +9.560961261959573e-01   +5.413160835571302e-01; +3.346586593761027e-01   +8.046756869954194e-01   +2.531338382132784e-01   +9.453446156761401e-01   +8.575295528271640e-01   +4.254558336897198e-02   +3.036821180736237e-01   +2.134908398826088e-01; +6.436402965131182e-01   +4.275364759206077e-01   +4.585513314610741e-01   +4.737991986905059e-02   +8.796561957272188e-01   +2.616282273311069e-01   +2.095024449126862e-01   +8.102700840391482e-02; +1.510128470953612e-03   +1.485854395030621e-01   +7.408865067742205e-01   +2.863403912883032e-01   +8.455368161918909e-01   +6.344054539115769e-01   +4.638420318563964e-01   +5.064474979390455e-01; +1.440917084514181e-01   +8.044906002388194e-01   +7.524950607703770e-01   +4.868771930546316e-01   +4.429312168020824e-01   +9.008638084906925e-02   +5.972573648019284e-01   +1.949007327150841e-01; +2.478255791653404e-01   +3.816837767512661e-01   +2.302125620821633e-01   +8.867875904932970e-01   +5.435401787057305e-01   +7.453716822829012e-02   +5.526199370018844e-01   +1.448412128131627e-01];
L1I_L2I_iGABA_netcon = [+6.982326117045503e-01   +8.673166063850093e-01   +6.140151357390368e-01   +5.522543113973251e-02   +1.430149100423840e-01   +2.351683909381262e-01   +8.389154089997917e-01   +3.704911459213409e-01   +7.063455982867877e-01   +3.843334246911053e-01   +2.395304277366948e-01   +6.662778149344086e-01   +1.673928851846821e-01   +5.700462940684641e-01   +4.388800218679400e-02   +4.951320076295222e-02; +5.976612078977708e-01   +7.981736791754978e-01   +6.106158702517812e-01   +5.756751144174958e-02   +7.446061669086765e-01   +5.562835003781327e-01   +1.977867843743942e-01   +5.593897668785072e-01   +1.870050918000679e-01   +7.197646598717592e-01   +5.132497326747986e-01   +3.299034862571742e-01   +1.158746924072311e-01   +8.098279162295023e-01   +4.420533782380085e-01   +9.212177894016924e-01; +1.628160846470975e-01   +6.272634909954604e-01   +3.132689644369318e-01   +5.967199032765453e-01   +9.511658469271742e-01   +1.134584677460729e-01   +6.170567189241390e-01   +8.303015134182669e-01   +2.308620020299891e-01   +6.414822262564165e-01   +7.322409785970456e-01   +5.515620939927144e-01   +7.365418689902112e-01   +6.736560145701407e-01   +9.169070934602620e-01   +1.740429023715241e-01; +4.829048538744016e-01   +4.719506162895645e-01   +1.420932890001370e-01   +6.571946676342009e-01   +2.659733759367390e-01   +8.185615283592473e-01   +1.549841328290422e-01   +7.075038641241020e-01   +9.984945826681436e-01   +1.007396558365685e-01   +7.714321572238733e-01   +5.321520480076841e-01   +2.103341900563462e-01   +4.440346153404583e-01   +8.843253155116433e-01   +7.433657344218343e-01; +2.854512654157882e-01   +1.925627583466287e-02   +6.051419437288198e-01   +4.795547877676685e-01   +9.538888359860745e-02   +6.508938522824900e-01   +5.837339625248054e-01   +1.155133771220563e-01   +9.049988232981173e-01   +4.920454406163625e-01   +6.767693359977467e-01   +9.015111605306861e-01   +4.838108039158601e-01   +8.937188487079383e-01   +9.275956440201452e-02   +4.761094743127155e-01; +4.035078489944008e-01   +1.178709940708622e-01   +8.899979848527277e-01   +9.785369789700344e-01   +2.309964709739664e-01   +2.373251173758427e-01   +5.451753093754791e-01   +7.402505201925110e-01   +1.148609076461766e-02   +5.625442520994625e-01   +8.131242381531043e-01   +2.842601528488191e-01   +5.073645656268826e-02   +7.837020857288438e-01   +6.754185102173084e-01   +2.462477763095563e-01; +4.907196159682728e-01   +7.192013529617384e-01   +5.622644638919114e-01   +8.633192059003139e-01   +8.962234390929851e-01   +3.016334481917791e-01   +6.818921873247857e-01   +9.241784501759844e-01   +8.346753780453343e-01   +5.622093905978226e-02   +4.182504369197657e-01   +1.393203208574610e-01   +5.713245757093043e-01   +5.816553784503774e-01   +8.930361965123878e-03   +6.628673301460046e-01; +8.618458701019954e-01   +6.825260768147594e-01   +6.328314560856834e-01   +9.538273259274648e-01   +1.992612003090790e-01   +3.307454885277740e-01   +6.985579550578972e-01   +9.234049666248956e-01   +2.523040274482261e-01   +8.921950311281890e-02   +4.972971644963952e-01   +9.566616017907266e-01   +4.913007472268483e-01   +6.160845875232612e-01   +1.210816880210151e-01   +6.082786573825113e-01];
L2E_L1E_iAMPA_netcon = [+3.678422412593103e-01   +5.623798024183819e-01   +2.008228520800545e-01   +5.144578767494583e-01   +2.897206553177938e-01   +7.494061606761999e-02   +2.781252677116071e-01   +2.667436045516096e-01; +4.372745077975482e-01   +1.932165249394330e-01   +1.371476241612236e-01   +6.847985890303030e-01   +6.201217574373522e-01   +5.943046089996108e-01   +9.283081030953767e-01   +9.045718998411216e-01; +7.181219377410210e-01   +6.134446183476161e-01   +8.176569286294547e-02   +2.074782157065755e-01   +8.631580169890167e-01   +7.718710053096806e-02   +7.638353084703068e-01   +1.596689813499339e-01; +1.914377991356944e-01   +7.404071484974313e-01   +9.133094931220258e-02   +9.719403451842803e-01   +8.207564235163102e-01   +3.974958099615921e-01   +2.630400699017533e-01   +5.539961070918658e-01; +4.052295073817432e-02   +8.323630772943483e-01   +5.516538706679468e-01   +3.506067919446888e-01   +2.060800958102341e-01   +6.009023484437612e-02   +2.425325434391715e-01   +4.232390490757217e-01; +3.151838230725034e-01   +2.781057195405596e-01   +7.313878476853267e-01   +1.839807085306164e-01   +7.508103655996464e-01   +1.284779259074861e-01   +1.656417147812072e-01   +5.475596402179699e-01; +7.899871659003468e-01   +6.081689564009167e-01   +5.439265752385682e-01   +2.381022275741949e-01   +1.988174819713965e-01   +2.437480928359612e-01   +2.875616351340279e-01   +7.541223508190907e-01; +4.779796211881521e-02   +5.475093251270491e-01   +5.452937941385124e-02   +2.542891773016170e-01   +5.776810569240586e-01   +9.437196212461796e-01   +5.645796510014701e-01   +1.306100621757636e-02; +2.160647418153451e-01   +2.746765671918212e-01   +6.325168981077672e-01   +2.220370001618057e-01   +8.770732969347963e-01   +2.035582756638102e-01   +4.045423193494530e-01   -7.732531279586789e-04; +2.739294038818933e-01   +3.402390665869441e-01   +9.943435162837740e-01   +3.576131662924430e-02   +7.135674902084164e-01   +3.269197553383611e-01   +9.860941575632685e-01   +2.110051231902739e-02; +7.890634982609024e-01   +5.668509992755271e-01   +9.145440473434316e-01   +3.565950757000418e-01   +7.008444578080844e-01   +8.666569342755651e-01   +5.445046683041241e-01   +3.589411093504822e-01; +9.908895664908086e-01   +7.436601415350947e-01   +7.679885320793925e-01   +8.990521717249172e-01   +4.678685922877264e-01   +9.225192408010809e-01   +9.285677361699911e-01   +4.263422132708019e-01; +9.500698994483955e-02   +7.715849982632892e-01   +1.920624864546999e-01   +1.399341691521611e-01   +5.046182274893062e-01   +2.321470182368311e-02   +9.922801317072796e-01   +5.450340119525283e-01; +1.958339798965416e-01   +3.984232503599321e-01   +3.237002391780049e-02   +9.555421177003990e-01   +7.963607861608055e-01   +3.644568106943033e-01   +8.356387204555292e-01   +4.922225115769785e-01; +1.164973737351197e-01   +1.489330453006082e-01   +3.736988767458428e-01   +9.022333757536751e-01   +9.399378069394874e-01   +5.281792803219423e-01   +1.801663260041629e-01   +9.203177264931137e-01; +6.473052209615808e-01   +2.079346725467505e-01   +5.753069367322009e-01   +4.101189826331020e-01   +7.820901796778544e-01   +4.064823561652886e-01   +3.132098056120548e-01   +4.159985312903671e-01];
L1E_L2E_iAMPA_netcon = [+4.969113716520766e-01   +4.501189247004861e-01   +6.164820183687671e-01   +4.906685979300943e-01   +2.299850758198846e-01   +7.215744234238993e-01   +6.943182169572188e-01   +6.324624677310242e-01   +5.225581201184722e-01   +2.403870936205357e-01   +8.770746080409282e-01   +1.743568355691220e-01   +1.366489430291116e-01   +2.434646371764924e-01   +1.837095690060793e-01   +2.307136157016195e-02; +8.383340454775695e-01   +3.696116071613250e-01   +1.031267189736119e-01   +6.614876967389127e-01   +8.361720487364477e-01   +3.810259251955198e-01   +9.800459687667987e-01   +6.267371206859473e-01   +6.727753494180633e-01   +7.294229389833154e-01   +6.586179909315322e-01   +3.029282055945572e-01   +2.830283338440775e-01   +7.484948188266741e-01   +1.465660073486158e-01   +2.514084336266168e-01; +1.854117756447884e-01   +3.002740252119137e-01   +7.520276609277191e-01   +1.782342137435192e-01   +7.345330023903011e-01   +3.844155583566454e-01   +7.505844420264880e-01   +4.072002471529255e-01   +7.765445668432945e-01   +1.359449201205413e-01   +5.373137701944418e-01   +1.092708582588510e-01   +7.221593411096097e-03   +9.367458322736599e-01   +1.326239030843347e-01   +9.891086993460014e-01; +3.366382721909754e-01   +2.331792227603550e-01   +5.371808083358012e-01   +4.784676283900829e-01   +4.891493404639569e-01   +7.156556376031000e-01   +5.532572263883010e-01   +4.251088752425530e-01   +4.634743655767617e-01   +4.096930205076212e-02   +2.519259537618274e-01   +4.515243564823317e-01   +3.059720476269799e-01   +3.007780740836940e-02   +1.723451425530680e-01   +6.294332527609635e-01; +6.928169793751083e-01   +1.367946592708008e-01   +4.438295017820432e-01   +4.990533524199244e-01   +8.487607528460748e-01   +8.384560541219286e-01   +2.956708011508735e-02   +5.103584890262858e-01   +9.074833589777356e-01   +6.499074910565057e-01   +1.055149910360459e-01   +5.843142175240740e-01   +9.045223966844969e-01   +4.353217362590754e-01   +9.224102386673667e-01   +3.576206091217169e-01; +6.923325913498988e-01   +9.965776599126958e-02   +7.437829542069625e-01   +6.006098139068243e-01   +7.143086487909706e-01   +6.679897970950488e-01   +1.956048520376608e-01   +2.593524051475615e-01   +2.529262990338146e-02   +2.001470083870718e-01   +9.714995728237100e-01   +2.245053336371733e-01   +2.936215202090436e-01   +8.315519722004335e-01   +2.591763272142572e-01   +9.388374783233679e-02; +3.679376162050484e-01   +2.267001950330939e-01   +3.875829996116054e-01   +2.406595267218072e-01   +5.225249105177917e-01   +6.505222731141904e-01   +9.416288526105999e-01   +4.229107380497605e-01   +4.806820122595730e-01   +9.731546126828903e-01   +5.974305651024597e-01   +1.106837039445489e-01   +8.332743677453208e-01   +9.992104371992567e-01   +2.058836391993190e-01   +4.088843654677273e-01; +3.396258402992409e-02   +3.469122454849778e-01   +5.264185724352232e-01   +5.172236369924872e-01   +9.378476291362490e-01   +5.636609524890906e-01   +3.972716619915528e-01   +5.234793387482638e-01   +2.708116908384692e-01   +8.206756707847741e-01   +8.193706883724380e-01   +5.610923463798080e-01   +7.453737590203376e-01   +9.204631899920808e-01   +6.136208532405226e-01   +9.314217117555975e-01];
L2I_L2E_iAMPA_netcon = [+6.770768412836220e-01   +6.144419372563543e-01   +4.180317721471509e-02   +7.924644421853381e-01   +5.236423634865564e-01   +8.257661845056751e-01   +6.442334162569738e-01   +3.864394714597600e-01; +2.314832311403953e-02   +9.449258458028840e-01   +5.463315992499840e-02   +9.304033170494290e-01   +5.366433180810677e-02   +1.083475095425237e-01   +3.964528625367732e-02   +1.670591255130928e-01; +7.343515138575595e-01   +9.642900789721941e-01   +4.015265864596405e-01   +9.365621305553611e-01   +2.871966908794090e-01   +2.310718514387398e-02   +5.680566654852229e-01   +4.439552585638202e-01; +2.139700470389989e-01   +3.691809949172529e-01   +9.841043467433465e-01   +1.462256411365880e-01   +7.097005415221681e-01   +1.217317492346545e-02   +3.050640963967244e-01   +8.733860737058754e-01; +8.610942129314592e-01   +7.950796271531849e-01   +7.120220881282516e-01   +3.194735049641410e-01   +8.781325925077220e-01   +3.363233988741467e-01   +2.604613726943168e-01   +4.112098627124667e-01; +1.567003168283450e-01   +7.287428621163597e-01   +9.886590552518821e-01   +4.289637926848793e-01   +3.657677563246050e-01   +6.634855639680221e-01   +7.216217677959104e-01   +1.625036929638584e-01; +6.684432860006345e-01   +9.536925100039911e-01   +6.455790696104865e-01   +7.022865469772958e-01   +5.607088174781303e-01   +5.954160837113183e-01   +3.057114430677800e-01   +6.622529759161203e-01; +9.348932890006526e-01   +1.117816612478746e-02   +5.018325897321150e-01   +6.149609427670054e-01   +8.842112450869343e-01   +7.986333686548965e-02   +8.961518035850350e-01   +9.253909336492773e-01];
L2E_L2I_iGABA_netcon = [+5.966073284906506e-02   +5.203657927305523e-01   +3.524684989583755e-01   +2.616396673174277e-01   +4.199457137569504e-02   +8.904973806923787e-01   +3.439609845151885e-01   +4.511375881134628e-01; +3.540060687017165e-01   +6.922409233404536e-02   +5.573665090272185e-01   +9.844768980786506e-01   +3.607451657852281e-01   +5.401090715765382e-01   +9.351999231531349e-01   +6.711324776476518e-01; +9.329648291169077e-01   +1.846004408433881e-01   +6.918581287972432e-01   +3.496241742971837e-01   +3.616697695292988e-02   +7.172696518507587e-01   +9.188074978530627e-01   +7.688939605767680e-01; +2.411045607818525e-01   +3.164868406926416e-01   -6.044300666018775e-03   +4.019045765678806e-01   +4.861086784696645e-01   +7.104960330960980e-01   +7.250927160219613e-01   +9.269903015899826e-01; +1.027764717918118e-01   +2.443080466575963e-01   +4.829810214151772e-02   +7.523781389594137e-01   +7.228843545719388e-01   +1.685271839232226e-01   +4.429941023483128e-01   +6.583609187203426e-01; +7.161380421387342e-01   +3.217921880433073e-01   +3.085429219047160e-01   +1.016807855179580e-01   +1.453069865963372e-02   +3.514775096211377e-01   +1.518293072656338e-01   +5.014472078756973e-01; +5.861314576216180e-03   +8.795569664486579e-01   +8.688855462127527e-01   +5.904308419646654e-01   +5.173658391209156e-01   +3.794734757985394e-01   +8.318310981775111e-01   +3.424074372166034e-01; +1.852689908677365e-01   +3.011628810772822e-01   +6.276314297824918e-01   +1.230480109558807e-01   +2.394192439577903e-01   +7.583628108333629e-01   +2.570846326417762e-01   +9.457906429863834e-01];
L3E_L2E_iAMPA_netcon = [+7.922959966165960e-02   +1.630002694832643e-02   +3.678323142032193e-01   +4.965071021307771e-01   +1.822059444311522e-02   +9.553597126274100e-01   +3.599569003222763e-01   +1.391295073320353e-02   +2.037332037069787e-01   +6.174218487735458e-02   +2.430040528944768e-01   +9.986137489214624e-01; +9.519595120088539e-01   +9.769145779446318e-01   +1.151553473878262e-01   +6.527893540904539e-02   +8.065446957213901e-01   +3.871751379518502e-01   +2.242017841904693e-01   +1.221099620139924e-01   +3.557365229902626e-01   +7.414666690991351e-01   +5.333009546347796e-01   +3.448677180338504e-01; +6.626463079326246e-01   +7.249380858244249e-01   +5.141866537702893e-01   +8.619705347606074e-01   +7.922945465245745e-01   +6.643450429774982e-01   +7.247372302370014e-01   +6.694132412607168e-01   +8.878147371129299e-01   +9.905583761934142e-01   +3.332431478522904e-01   +8.224030015097973e-01; +1.685471348039678e-01   +8.718402485348578e-01   +6.816155250943025e-03   +9.967023766353510e-01   +4.232235047446414e-01   +5.843361300707093e-01   +7.724406538249159e-01   +5.081258546875653e-01   +8.089891225651745e-01   +7.677865002287361e-01   +6.741808347746477e-01   +1.099073142512242e-01; +1.964517881858966e-01   +8.142640629145739e-01   +8.692848769926791e-01   +1.226958037717281e-01   +6.305106447124046e-01   +5.917134577342378e-02   +3.425739876929410e-01   +7.066376411873058e-02   +3.194063639478076e-01   +8.810593480145822e-01   +8.754141351485393e-01   +7.731642405586875e-01; +9.948324786867712e-01   +3.084116844771518e-02   +9.042172513032617e-01   +9.993091637566226e-02   +5.678234127634411e-01   +7.628443179105537e-02   +5.767293243188735e-01   +5.359840821133520e-01   +5.993596646035824e-01   +3.618214982453118e-02   +9.824382686929937e-01   +1.503329122702741e-01; +9.253805035113608e-01   +9.612848796431873e-02   +1.130094331344596e-01   +1.491609990835467e-01   +8.961752225438109e-01   +2.273784867365428e-01   +6.427749005009507e-01   +6.781649547257521e-01   +6.985836657837784e-01   +7.936575093538096e-01   +1.450601766925781e-01   +7.319579388254256e-01; +9.816390529223724e-01   +8.593259910328968e-02   +4.461659573463445e-02   +1.286734407467978e-01   +7.488005257079737e-01   +4.200395005336386e-01   +3.654787612533740e-01   +5.880603259899947e-01   +1.782715388345815e-01   +7.067587221936822e-01   +8.769905884742037e-01   +1.094386547748356e-01];
L3I_L2I_iGABA_netcon = [+7.674753550245270e-01   +5.357660920027572e-01   +5.973088839265954e-01   +3.050799476135521e-01   +9.667837298720250e-01   +1.152000088056284e-01   +2.982872430558017e-01   +7.953756397443985e-01   +9.142516931261465e-01   +9.944082868478015e-01   +3.095775938226668e-01   +9.962628640135431e-01; +6.374253624374200e-01   +4.527044313374885e-01   +5.622506223053029e-01   +7.623867265826040e-01   +5.442692367060069e-01   +6.984834949492839e-02   +1.687564625993781e-01   +5.256268856689766e-02   +3.858968392704377e-01   +2.871027905955903e-01   +4.428304944276363e-01   +9.144339543800997e-01; +7.963150569646510e-01   +1.145554865656689e-01   +6.828283099848835e-02   +6.471259295405422e-01   +9.816496093148649e-01   +5.128106698194331e-02   +7.239627661152346e-01   +1.818176935897870e-01   +7.499955004304713e-01   +5.156360924623341e-01   +2.085240863412500e-01   +6.919818044632700e-01; +9.600960976890025e-01   +7.199519511430484e-01   +7.682473091179449e-01   +3.316184048213294e-01   +1.242809708941044e-01   +1.298990030968216e-01   +2.986609186760670e-01   +2.463867965865174e-01   +8.791981907260268e-01   +3.592606111345352e-01   +9.412416912335637e-01   +2.217446952514211e-01; +7.168125380654604e-01   +1.863433843267071e-01   +8.681390668226970e-01   +9.710592063607916e-01   +1.682824384654963e-01   +4.918480688161613e-01   +6.776759903972365e-01   +2.614755150840985e-01   +3.926063532377846e-01   +5.171697611253551e-01   +2.896409705128983e-01   +3.152046823798571e-01; +6.434577356570992e-01   +3.249447126667391e-01   +7.081867968467935e-01   +5.318114356992261e-01   +3.344348671737431e-01   +4.674812159005386e-01   +7.455916354070372e-01   +6.471024611775984e-01   +1.679290863672310e-01   +5.012085288713022e-01   +1.225946217186383e-01   +2.367117744489519e-01; +5.124042028809852e-01   +9.667620209578126e-01   +1.079944833795323e-01   +7.517096351448048e-01   +5.312480512344365e-01   +1.584499357627550e-01   +7.463962056910336e-01   +9.818531665947246e-02   +4.366874718849135e-01   +1.880863892200008e-01   +6.936534818468695e-02   +7.076460235996780e-01; +9.519331647616142e-01   +7.010453146825463e-01   +6.660952852966193e-01   +2.690784354398152e-01   +6.924148347639267e-01   +1.379915704449250e-01   +7.845383565379409e-01   +4.689389209578789e-01   +8.573592388448403e-01   +4.777074549276811e-01   +7.294768372789348e-01   +3.759439580759349e-01];
L2E_L3E_iAMPA_netcon = [+6.567133217413832e-01   +3.867509862999532e-01   +2.350135923327721e-01   +4.645561912434824e-01   +9.045108484445175e-01   +9.501391759665514e-01   +7.620636024264457e-01   +3.544963236287792e-01; +3.837850399714277e-01   +2.300493573912029e-02   +9.055099231381567e-01   +2.837120123523286e-01   +6.791153597704799e-01   +2.557752983808787e-02   +9.035599865288408e-01   +6.636902527884031e-01; +3.079975313726752e-01   +3.295325331358770e-01   +4.871435381859618e-01   +2.762527784790877e-01   +8.428313953574514e-01   +5.017806186311421e-01   +7.964753102971717e-01   +5.925590439237405e-01; +1.575265295258739e-01   +4.847367457072033e-01   +5.955593299517311e-01   +1.426078512443369e-01   +9.527143003602923e-02   +3.396954123854458e-01   +9.563804177680938e-01   +5.362316976468663e-02; +7.775528569262372e-01   +2.626585427367217e-01   +9.553001638212146e-01   +1.399650179832923e-01   +7.350296277951073e-01   +6.726306464562080e-01   +5.349572513417055e-01   +2.163396453690315e-01; +7.088626432852104e-01   +5.257342863788090e-01   +8.484498089258724e-02   +2.644711853559605e-01   +5.438367204665999e-01   +1.674929243914498e-01   +1.637102685225350e-01   +6.014675265302887e-01; +1.728776983859073e-01   +4.160936989410836e-01   +2.214446665900360e-01   +6.110579618143026e-01   +2.564592791593018e-01   +2.260080726411909e-01   +1.341895599138332e-01   +2.695581540271267e-01; +4.483783371538809e-01   -4.528489141152539e-03   +1.525281143018189e-01   +1.064427071674642e-01   +7.148148379331162e-01   +1.179749696632244e-01   +3.356769269631547e-02   +1.096401814585918e-01; +8.379064378548745e-01   +8.940408157772364e-01   +3.901225506354868e-01   +4.846377976954018e-01   +3.602187270791096e-01   +9.939762444726683e-01   +6.811079345327089e-01   +2.109533835657942e-01; +6.981472118714936e-01   +2.396450851488310e-01   +1.848491149563098e-01   +8.940847549220339e-01   +8.531825753832502e-01   +1.399710409979168e-01   +5.867081925084350e-01   +8.734448461262900e-01; +7.658228258570696e-01   +7.921991370585520e-01   +7.632267603524240e-01   +1.886339953014007e-01   +8.192165595522376e-01   +7.693013797553164e-01   +2.988501979900815e-01   +4.590801847450197e-01; +9.806793032247267e-01   +5.781262166159382e-01   +2.279607562648335e-01   +5.215941303136058e-02   +6.106592761608748e-01   +6.342150204470427e-01   +7.374788011034705e-02   +7.268066207999240e-01];
L2I_L3I_iGABA_netcon = [+5.894015355575328e-01   +1.469639376603689e-01   +3.440602327630346e-01   +3.692556898727287e-01   +5.995117928740454e-01   +5.071657727311745e-01   +7.728916995019982e-01   +2.647609105710566e-01; +8.462235642039176e-01   +9.900004361864096e-01   +4.551702515341402e-02   +5.376730971122293e-01   +4.784095838477886e-01   +2.372656095759057e-01   +1.787543445183117e-01   +5.853006563703179e-01; +6.043749877956289e-01   +4.810726744592967e-01   +9.415683334610958e-01   +9.746206099766979e-01   +3.769860970471901e-01   +2.723154826805275e-01   +4.537431699304926e-01   +6.795802383495931e-01; +7.448788456461574e-01   +3.615753965006858e-02   +8.663111864979052e-01   +9.967348749432674e-01   +9.787890425527271e-01   +4.052113902213271e-01   +3.059373755121572e-01   +4.157362808478225e-01; +8.500053932635052e-01   +2.699549453982234e-01   +1.339334111688894e-01   +4.144227551847731e-01   +1.387224931053525e-01   +2.606542385767928e-01   +3.878770495049817e-01   +5.111000090396350e-01; +1.461566786826999e-01   +6.754537335076060e-01   +5.900486407047075e-01   +4.506423958427425e-01   +2.715393865663353e-01   +8.546046411847541e-01   +8.035461310103618e-01   +8.140575030580396e-01; +7.420121468097838e-01   +1.464943724235231e-01   +6.273466667373580e-02   +2.549480690204372e-01   +2.259992202622625e-01   +4.786500249144318e-01   +7.780167425596858e-01   +5.441590151872567e-01; +1.707634260619840e-02   +7.736597881400945e-01   +9.465649537580463e-01   +6.010986236627699e-01   +7.924422097193586e-01   +3.415278465958183e-01   +6.462043116496990e-01   +5.893785259384750e-01; +2.280867309671931e-01   +2.669206819941396e-01   +4.973283805069602e-01   +7.793366294135026e-02   +8.182856938546694e-01   +6.392732973792911e-01   +2.423209012631345e-01   +5.351111589238788e-01; +5.381351243041144e-01   +8.805659485936972e-01   +2.655132166257428e-02   +9.121728086864849e-01   +7.924803384289704e-01   +4.158142720393710e-01   +6.082714798209863e-01   +5.412432951788237e-01; +7.199876232759556e-01   +3.691901912098765e-01   +5.738154176965835e-02   +4.732448607685033e-01   +1.130691267932140e-01   +5.437420375096017e-01   +4.187914872959576e-01   +1.513452744915952e-01; +4.342686014417107e-01   +9.754408587485447e-03   +3.010917042468139e-01   +5.075548744008754e-01   +6.324712797934254e-01   +3.403912638781585e-01   +2.943103867725481e-01   +7.038144075134840e-01];
L3I_L3E_iAMPA_netcon = [+6.333006380084023e-02   +7.728563352543151e-01   +5.546460731139636e-01   +5.733244120754076e-01   +9.203455882222811e-01   +8.351559944718757e-01   +8.500208046168826e-01   +8.627700612562743e-01   +5.336756356821795e-01   +9.879992044309571e-01   +4.821931786736275e-01   +3.499335704256763e-01; +9.220251654601602e-01   +8.388463449496334e-01   +8.439534737781271e-01   +9.357370348950030e-01   +5.927707495966232e-01   +3.925800682977256e-01   +6.285427419815434e-01   +8.565141799838419e-01   +5.676098887489757e-01   +7.012481055447416e-01   +7.398484009325960e-01   +3.999828269129649e-01; +1.802791218250785e-01   +5.932316184488791e-01   +9.697352828661691e-01   +7.789017863355351e-01   +5.760752337875560e-01   +7.048368914555574e-02   +4.441805689567248e-01   +9.489592832055264e-01   +9.802123195530196e-01   +8.441031440931956e-01   +5.950689439076312e-01   +9.878816725011961e-01; +5.430174572830008e-01   +7.668669961606650e-01   +4.656312783091584e-01   +5.961943958550768e-01   +6.583800174443789e-01   +3.737278735510365e-01   +2.346584911945373e-01   +6.944331170084032e-01   +9.680560053681498e-01   +7.381429423061840e-01   +2.635063844519953e-01   +2.978592476541235e-01; +3.979525042617922e-01   +6.587840831524991e-01   +7.761362660682984e-01   +5.816477776821460e-02   +4.357271372688672e-01   +8.492479814338569e-01   +5.090019392457071e-02   +3.631205104705225e-01   +5.600038204060120e-01   +9.957865603204933e-01   +6.072920783763899e-01   +2.247182578836410e-01; +9.290597866013857e-03   +5.889143756434700e-01   +2.216779661235503e-02   +5.440024622223237e-01   +9.352116008850043e-01   +2.496106607336092e-02   +7.124452443765190e-01   +3.733838573133950e-01   +5.322248012353064e-01   +5.073728135400567e-01   +2.319971615062563e-01   +3.303553337220704e-01; +1.028726032310382e-01   +2.598012378883412e-02   +6.772578693906123e-01   +8.644028639911139e-01   +1.030246518441560e-01   +4.211001702726657e-01   +8.477185160268785e-01   +8.418428236076005e-01   +4.791293786353482e-01   +1.892162176263165e-01   +1.948617447802463e-01   +1.649215462367354e-01; +8.559611148239726e-01   +6.927705115791948e-01   +8.349302912592402e-01   +3.383781309724960e-01   +4.088591347144360e-01   +2.541694413389259e-01   +4.053261144380833e-01   +3.843712894023347e-01   +9.013948897160550e-01   +9.593094654501820e-01   +1.779242915827935e-03   +3.839716167086335e-01; +3.379077272875420e-01   +3.277318008271341e-01   +6.843399904144695e-01   +1.785335806154335e-01   +8.922899787557810e-01   +7.410353707001843e-02   +2.868704052501325e-01   +7.704901694400069e-01   +4.821170631284692e-01   +4.516919445804282e-01   +6.463139192437868e-01   +5.260578229115369e-01; +1.494822084594188e-01   +7.633504961000021e-02   +8.959558039428096e-01   +8.806745915915299e-01   +7.388753748815829e-01   +9.201604634427928e-01   +2.623310784690580e-01   +7.737105128049337e-01   +4.864621880225357e-01   +6.059880549180970e-01   +4.001424191662175e-01   +5.958044025863182e-01; +8.079489943494267e-01   +7.445292746250384e-01   +9.551237771548891e-02   +8.418226956920182e-01   +9.587247990763004e-01   +2.687675094846247e-01   +5.056366467653924e-01   +4.332922645847994e-01   +3.137947210925776e-01   +6.451931806906536e-01   +2.719980701989803e-01   +1.694576234239548e-01; +6.549044413963891e-01   +9.655334145581997e-01   +7.011141839681186e-02   +8.338502436688949e-01   +9.697022602069815e-01   +1.013296243707258e-01   +1.170498684523531e-01   +4.871944316059896e-01   +8.592258994268939e-01   +7.659487138096852e-01   +3.239659381198476e-03   +7.299968252696387e-02];
L3E_L3I_iGABA_netcon = [+4.368299579153220e-01   +7.139391547612237e-02   +5.742045415425309e-03   +4.951021771877446e-01   +5.435389865228891e-01   +2.522807499953932e-01   +7.184153002564561e-01   +7.614700520670979e-01   +3.784841539397013e-01   +4.485416381900100e-01   +2.001276832740049e-01   +6.498492730410376e-01; +5.758155286274225e-02   +8.071700597837784e-01   +1.325963630939330e-01   +1.928789869499448e-01   +2.116273226066525e-01   +3.339083933717721e-01   +2.222442158428240e-01   +8.886827407583709e-01   +6.105200885198443e-01   +3.939711403309194e-01   +8.283587421860231e-01   +8.993407916246250e-01; +6.263643715799221e-01   +9.088849233421175e-01   +3.087317527645978e-01   +6.422391148049741e-01   +2.698636390420754e-01   +5.910785534691860e-01   +4.978300830781190e-01   +7.315356629946042e-01   +1.678157047909073e-01   +6.683257718469431e-01   +4.471035209260937e-01   +8.384576627286304e-01; +7.988979807239759e-01   +4.258039065886782e-01   +2.390398002806638e-01   +2.554497852495278e-01   +1.324942566248468e-01   +4.817389473679782e-01   +4.761324676215196e-01   +6.977054422257453e-01   +1.054952579715295e-01   +3.358237160417331e-02   +4.178145469117690e-02   +1.705282658555771e-01; +4.006965167426196e-01   +1.840210272504432e-01   +6.485774544854491e-01   +9.487815333682829e-01   +1.570595904400392e-02   +8.982130763886621e-01   +4.309991545935415e-01   +6.463210795022395e-01   +6.256979484713090e-01   +7.869978184866240e-01   +7.688100308055664e-01   +1.608039092059760e-01; +8.835743564774297e-01   +1.831343535107940e-01   +8.077982411065796e-01   +2.870281838915666e-01   +1.477564815147415e-02   +2.947524906918383e-01   +5.563594164311686e-01   +6.200408110926867e-01   +9.517306488647993e-01   +3.787192470444173e-01   +9.771958410159458e-02   +1.352004159865136e-01; +7.229880007559337e-01   +6.724575564255464e-01   +7.415042302337110e-01   +1.496971630518935e-01   +9.792730135668209e-01   +7.885377803419845e-02   +2.069343189208628e-01   +7.806338192597218e-02   +6.653488077489772e-01   +6.512604117653646e-01   +6.526031014460951e-01   +1.592462636026098e-01; +1.973591115945836e-01   +5.244320300779244e-01   +1.220878047554965e-01   +8.703082789730919e-01   +6.472088809473406e-01   +3.920074689105441e-01   +2.765806560349500e-01   +5.488183774883826e-01   +4.722771214311218e-01   +4.975085389040759e-01   +2.708877633838107e-01   +3.944070389313709e-01; +3.746768740218580e-01   +7.767852437500949e-01   +1.720751975787921e-01   +8.868314030810515e-01   +8.162181888835885e-01   +1.988506135076485e-01   +8.126773892078114e-01   +8.841959375423831e-01   +3.401968904000307e-01   +2.126383384275735e-01   +4.368430322095784e-01   +6.666688910341140e-01; +2.129248852951650e-01   +2.995040338571804e-01   +2.738050564797525e-01   +6.685829244400228e-01   +2.763763584295817e-01   +7.226206772119209e-01   +9.523052762911169e-02   +9.875963680566046e-01   +5.908643479598304e-01   +2.160281514154896e-01   +8.486124618195707e-01   +2.231652890745259e-01; +2.591728769907831e-01   +4.738038956989316e-01   +8.144150035179847e-01   +9.976504433960546e-01   +1.503909140282090e-02   +4.217446955791886e-01   +3.343202625764855e-02   +7.126875519052343e-02   +5.465386435699972e-01   +4.516630882273820e-01   +9.023283102812467e-01   +6.434463947415021e-01; +9.923625243698622e-01   +7.072393179712551e-01   +5.916916568120448e-01   +2.676358605305797e-01   +1.018783136998476e-01   +2.679889177791633e-01   +6.445131938665147e-02   +3.277598446080224e-02   +3.883032356971341e-02   +6.297688152514288e-01   +2.858039539841831e-01   +6.121447463935075e-01];
L2E_Input1_iAMPA_netcon = [+9.924883237465877e-01   +9.897649156084803e-01   +9.995536647790924e-01   +9.875561907620620e-01   +9.851607838087917e-01   +1.000000000000000e+00   +9.839952787848519e-01   +9.977628390607862e-01];
L2I_Input2_iAMPA_netcon = [+9.916014902479572e-01   +9.989380022884908e-01   +9.844563299743511e-01   +9.953109771750660e-01   +9.884367323212551e-01   +9.893497075632636e-01   +9.960668123448938e-01   +9.970215063261226e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last =  11.21 * ones(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
