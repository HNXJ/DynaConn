function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [-3.133799542886266e-01   +1.798298979010313e-01   -1.861296198287872e-02   -1.179440997041024e-01   +2.299449688644265e-01   -1.639702354639710e-01   +1.175614420518284e-01   -2.893011448998861e-01   -5.472839700399733e-01   +3.711577740508583e-02   +9.854246516138837e-02   +9.300025349557360e-02   -1.437161811256411e-01   -1.326660948418245e-01   +3.465482121843393e-01   -4.496793607737093e-01; -1.769898047366656e-01   +1.139971996064167e-01   +5.060823297659648e-01   -1.555301160127759e-01   -2.804736469477246e-01   -4.800232246896791e-01   -2.387801452907128e-01   -2.072552924567330e-01   +9.637225047985523e-02   -2.976086348804163e-02   +1.624118478369800e-01   +2.216241990535479e-02   -1.732411901112009e-01   +2.306383698331051e-02   -1.740872165072603e-01   -9.486215698716430e-02; -5.466394894174414e-02   -3.711572738080624e-02   -2.940613295911287e-01   -3.268860147583203e-01   +3.739462921889422e-01   -1.485548695481628e-01   -1.144140773943361e-01   +1.546482618291257e-01   -1.144954731800961e-01   -1.031925542908467e-01   +7.263101531423563e-02   +1.759823306307026e-01   -1.123696761209794e-01   +7.554556229531401e-02   +3.910929283993644e-01   -7.131023373395981e-02; -9.065687958272342e-02   -3.528865850725605e-01   -7.829582097611204e-02   +6.798706916601366e-02   -2.742600979840064e-01   +1.525998901041070e-01   +3.442542137753246e-01   +2.083010864842302e-01   +1.248119372536878e-01   +5.166685377690685e-01   -1.759744880153853e-01   -3.808176472300526e-01   -8.834785104027770e-03   +2.574576902625034e-01   -2.064095184061675e-01   -3.204518628051185e-02; -2.900416388177728e-01   -3.103607777523362e-02   -1.371121321187086e-02   +2.194457332550275e-01   +1.172656176533565e-01   +1.093959825988907e-01   -2.586383649054037e-01   -1.079155213705068e-01   +1.641960592958046e-02   -1.049268216710070e-01   +3.960988048795244e-02   -6.651530479942766e-02   -5.777810595469055e-02   -1.688713850081183e-02   -1.616108670085390e-01   -1.812778357289127e-01; +2.037561450141429e-02   -1.338772320298792e-01   -1.542844062276967e-01   +1.235288131223529e-02   -2.871865242542703e-01   -6.876979463048927e-02   +1.939218977396918e-01   +1.022092224171963e-01   -1.400589286707006e-01   -3.431550589710354e-01   -1.581684368892525e-01   +1.491016402511871e-01   -3.913472101508835e-01   +2.599335826455391e-02   +7.702611003619084e-02   -3.185560756909357e-01; -9.976882893120208e-02   -3.771282222814314e-02   +3.498762222572734e-01   +3.966633274594000e-01   +1.621669259614069e-01   +2.230351950225323e-01   +2.337487779425948e-01   +2.069767358938997e-01   -1.291956655757198e-01   -6.754158703490279e-02   -1.346406506167958e-01   -2.793547364024550e-01   -3.622609879510935e-02   +7.531249154015673e-02   +5.134477081341790e-02   +3.051655356698219e-01; -2.578408742975289e-01   +1.429079657605022e-01   +9.696973630435868e-04   +1.778526427509630e-01   -2.575957785000743e-01   +2.102143544261159e-02   -2.993261506556560e-02   -9.942776854148075e-02   -1.370677613382631e-01   +6.814854273758442e-03   +6.722997144686652e-03   +4.831102084173804e-02   +2.414556125787537e-01   +2.743059443407038e-01   -2.379774667893737e-01   -2.683849173006511e-01; -9.685515666321785e-02   +1.099261691738117e-01   -3.422519672259194e-01   +2.047588787287301e-01   +8.689458294387493e-02   +2.895644019993415e-01   +6.558540769905644e-02   +1.275197875767055e-01   -2.075229104500290e-01   +2.422001030152045e-01   +8.427815429405128e-04   -1.690613600466239e-01   -1.923412608921009e-01   -3.362291591250970e-01   -1.554279830340911e-02   -2.535765807655285e-01; -1.157078445254095e-01   -6.162215461147158e-02   +2.795460802953875e-01   -8.830103712857093e-02   -1.151949451353467e-01   -2.613645066628265e-01   +3.019623791066708e-01   -2.650306260078712e-01   -6.296982574842089e-02   +2.670299262963840e-01   +2.108404751738137e-01   +1.166089749579801e-01   +3.185133397660918e-01   +1.689350604778568e-01   -3.522296097048725e-01   -3.179255503094843e-01; +2.213298197698726e-01   +2.727315287116276e-01   -1.173602151112100e-01   -3.768613262022846e-01   -8.221445521507154e-02   +2.686581094614833e-02   -2.184142958268552e-01   +1.074975982470870e-01   +1.599887047378122e-01   +4.923926196140004e-02   +1.935995448138888e-01   -2.595941067365809e-01   -1.891602353518375e-01   -8.811555349876185e-02   -8.068315622446644e-02   -8.343317829564670e-02; -3.062070630847338e-02   -8.670509299654383e-02   +2.651175530784540e-01   +3.873852905225632e-01   -6.190842297813896e-02   -3.096778049449334e-02   -1.432563295665007e-02   -1.342995455148299e-01   +2.420426520888211e-01   -4.682343687513060e-01   +1.083967142328551e-01   -4.182640440103930e-01   +1.379016584687498e-02   -1.558398154703125e-01   +1.901908691722682e-01   +1.032612158405957e-01; -4.272811815142235e-02   -4.231029351021421e-01   +4.505009868437900e-01   +1.327121414927399e-01   -1.799065385840994e-01   +2.353449540909726e-01   +1.229006805830085e-01   -9.803653144235536e-04   -3.292793197195730e-01   -4.407404886494017e-01   +3.057027793792259e-01   +1.597297757024924e-01   -1.690158454019051e-01   -2.713721828056955e-01   -1.963905637184151e-02   -4.917689575072133e-02; +4.396509421886012e-02   +1.835749234375668e-01   +1.222757594012474e-01   +8.765260714399578e-02   +2.752346871008667e-02   -6.735992896172861e-02   +1.972721226958355e-01   +6.837292110699703e-02   +2.166880615852536e-01   +1.346693537088098e-02   -4.674256785892413e-01   +5.249410120813734e-02   +3.979676274565553e-01   +1.844856520545371e-01   -3.310436588280629e-01   -1.792461706277174e-02; +7.591590203034701e-02   +9.380393652463233e-02   +3.219919247988186e-01   -7.853063336166322e-02   -1.460490481672784e-01   -5.604225788353595e-03   -2.462913803779225e-01   +1.987809648056187e-01   -1.511267010460450e-01   -4.851917036876771e-02   +1.108525861180094e-01   +2.301133859656627e-01   -4.027467899886863e-01   +1.239279171190538e-01   -1.096215459855634e-01   +9.785893332603726e-03; +8.039165457560170e-02   -2.057295120096852e-01   -3.097422039775763e-01   -1.942587977006807e-01   -3.619936907408009e-01   -7.262446434579904e-02   +8.996284121588721e-02   +5.141434564890142e-02   +1.981644955493682e-01   +2.485766765586549e-01   -2.900646206588431e-01   +3.588755964143385e-01   +6.176869581933794e-02   +4.232305701471666e-02   -1.199309911606130e-01   +2.742724920878623e-01];
L1E_L1I_iGABA_netcon = [-4.816758114123547e-01   -3.764642544161275e-01   -3.023836013600547e-01   -2.463584483713953e-01   +4.796518000328764e-01   +1.192427768057346e-02   -1.365246186471362e-01   -3.120529336084491e-01   +1.396382024053732e-01   -2.642687616593697e-01   +5.376621084994401e-02   -1.950111060131660e-01   -2.785271714143476e-01   -1.904541974191226e-01   -1.756955937403475e-01   +5.003645796227834e-02; -1.339476894855521e-01   +4.354472051778948e-01   -2.915269249111737e-01   -5.654165215366767e-02   +2.655050966048998e-01   +9.923047899624976e-03   +2.280781530829977e-01   +1.363960014423037e-01   +1.730153417027064e-01   +9.024554560652093e-03   +1.390503466423852e-01   -3.601413281054201e-01   -2.803111988954733e-01   -6.640680918505308e-02   +1.066395226638857e-01   -9.207005566775397e-02; -1.849312108753697e-01   -5.427933915369157e-02   -2.164791536537533e-01   +1.714860911526709e-01   -2.710689333591267e-01   +2.677789570426195e-01   -7.213689272642350e-02   -9.058430470005781e-02   +9.500114631173755e-02   +2.798585359346381e-01   -2.813714508978192e-01   -3.502088626483210e-02   +6.795970015313324e-02   +3.396286493649516e-01   -3.192958750897190e-01   +3.000534193689072e-01; +3.708568026138392e-02   -1.720164360514890e-01   +2.944142871431471e-01   +4.174898059171258e-01   +1.540693805233624e-01   +1.870275620006639e-01   -2.555659929226753e-01   +4.411892999536463e-02   -3.642291841383573e-01   -1.974282791903842e-03   -1.968590164177121e-01   -1.282884979317330e-01   +3.896798572152002e-01   -1.069756237162164e-01   -2.391521072420472e-01   -4.776030468307726e-03; -1.703454505683893e-01   -6.001265905139738e-02   -1.016095701494335e-01   -5.605751544556095e-02   -2.760446064627597e-02   +6.979471687469190e-02   -1.878087600964681e-02   +9.497132885844603e-02   -1.030342775496043e-02   +3.143007631979283e-01   +1.219436137151364e-01   -1.490180484288174e-01   +2.573201149389240e-02   +4.129443593921478e-02   +2.245028098245081e-02   +4.378646174671680e-02; +2.487847336820856e-02   -2.298706461616138e-01   -1.786733102581811e-01   -3.678979453746564e-01   +4.239880291351385e-02   -9.589976303623904e-03   -3.787252037896732e-03   -1.244796367015636e-01   +3.369482012501398e-01   +8.681440277068270e-03   +1.138398793582974e-01   +1.745720902881382e-01   +5.992778553926020e-02   +1.606735036192171e-01   +3.003109764117035e-01   +2.125436315586952e-01; -1.017253329729622e-01   -1.219689738251132e-01   -3.420571999915728e-02   -1.210739044433600e-01   +1.557819498464598e-01   -1.409654070236673e-01   +1.654875512945867e-01   +3.008144958905508e-01   -1.550757499664946e-01   +1.102716112641839e-01   -1.406551186033965e-01   -2.770220766286033e-01   +1.668279260621537e-01   +1.652451011971197e-01   -9.869349156641843e-02   +2.487664550893273e-01; +5.628061003500948e-02   +2.718087575905387e-02   -1.179252298855741e-01   +2.072451497519609e-02   -1.306357112389266e-01   +1.540749628334742e-01   -1.396684456262219e-01   -2.074833430330348e-01   +1.873257480445752e-01   +3.694059326642998e-01   -1.898386480173355e-01   -9.265926171490355e-02   +2.659135512841501e-02   -1.086666947569619e-01   +9.968732121006860e-02   +3.726350676632214e-01; -6.631414917256186e-02   -3.493567974514963e-01   +2.613616480621618e-01   +2.786798004856127e-01   -1.141778010468595e-01   +9.255069082835357e-02   -1.690895368594593e-01   +2.819878524123013e-02   +2.747685472527198e-01   -9.480434013544384e-02   +4.413770281266902e-01   -1.757856877110713e-01   -1.621070082640341e-01   -1.461358361828946e-01   +4.053013255682189e-01   +4.286966911303169e-02; -2.591293257518982e-01   -1.520754906598814e-01   -6.421831454377427e-02   +3.441793475420544e-01   -2.574502206440228e-01   -1.157463436794645e-01   -3.579788173519011e-01   -2.181274475439095e-01   -1.038070823390093e-01   -2.945272714146703e-01   -2.771450935066383e-01   +2.303274502189712e-01   +2.524684046102909e-01   -2.682141755986567e-02   +3.685997945561971e-01   -5.518674307728824e-02; -2.656625483865862e-01   -2.196905493289111e-01   +1.855113271442509e-01   -1.204005026160365e-01   +7.137185866005258e-02   -3.088024848031445e-02   +4.493337673505868e-01   -6.588943871359237e-02   -1.240398572545403e-01   -6.934424228697519e-02   -2.658403610641135e-01   -1.175746212578542e-01   -2.263131224519019e-01   -9.158464805307569e-02   +5.338191607938933e-02   +9.262612331676440e-02; +3.059500299929171e-01   -5.681598994163350e-02   -2.701037268442454e-02   -1.533611364149303e-01   +2.372246419581313e-02   +2.241918323866028e-01   -2.538638817733097e-02   +2.947839721489867e-01   +5.423029440869755e-01   -2.969241675871675e-01   -1.087456848391838e-01   -1.693013093250840e-01   +3.415793257498180e-01   +4.123915178876672e-01   -2.364465548283881e-01   +7.741656799794658e-02; +4.919992246502501e-02   -2.680867958342923e-01   -9.049645181085617e-02   -1.155708798693431e-01   +9.708055975500046e-02   -1.406396151257507e-01   -2.060825333462445e-01   +1.784684012105572e-01   +2.704432928171032e-01   +5.935292524386099e-02   +4.762414861129041e-02   +1.130259237964137e-01   -4.361710099891914e-02   -2.592202767173142e-01   -1.786076251011874e-01   +5.321248412794300e-01; -2.095431682932225e-01   -8.307161805744780e-02   +1.325198102440188e-01   +2.009180247331760e-01   -1.346136287184810e-01   -1.529786572118075e-02   +9.818660942423643e-02   -4.508504876177957e-02   +3.637519441099321e-02   -3.149253465174110e-01   +2.582099587905845e-02   +5.234607415563794e-02   +1.466075419904796e-02   -8.741401415641852e-02   +1.307477598673216e-01   +3.838075785316408e-02; -2.825970869672017e-01   +2.256137598658919e-02   +3.289687835861054e-01   +3.065836677494712e-01   +4.403433840431630e-02   +2.428517238775664e-01   -3.217095582564253e-01   -1.695415939888185e-01   -5.390584412319460e-02   -1.685686443000491e-01   -1.613186544621724e-01   +2.530803223665546e-01   +2.586623630028340e-01   -2.492087322285699e-01   +2.184270561131761e-01   +1.924896595805580e-01; -1.669155293291432e-01   -1.884161185446985e-01   +1.067068798411108e-01   -3.667848319338827e-01   +1.948203599381192e-01   -1.030753787119250e-01   +2.488245885671227e-01   +1.093769715756378e-01   -1.153692195912053e-01   -1.543066402760665e-01   +2.637024073568468e-02   -3.095285254207147e-02   +1.639688581981831e-01   +2.433931552497519e-01   +2.611626666360350e-01   +5.888513724458727e-02];
L2I_L1I_iGABA_netcon = [-3.078936077819875e-01   -9.575383432717374e-02   +1.396941671281148e-01   +2.371254879805364e-01   -4.097859341142199e-02   +2.648499084197652e-01   +1.448251373878792e-01   +5.794626916049353e-02; +5.908287930292452e-02   +1.149317976892777e-02   -4.162165020691672e-02   -5.207182480649228e-02   -3.848428305225235e-01   -2.644306477268822e-02   -6.684883877736027e-02   -2.481771948438369e-01; -1.551380818389081e-01   +2.811473813827295e-01   -1.596372152712970e-01   +3.192328020874483e-01   +2.611250130573325e-01   -1.343585348976723e-01   -2.023643944299109e-01   +2.393534617905481e-02; +1.993685737066246e-01   +1.464369889894140e-01   -1.682232200562933e-03   +1.229683591886098e-01   -5.456990526959461e-02   -1.239827291126474e-01   -1.790303453090241e-01   -3.017155172062640e-03; +2.943621441775116e-02   -6.316925176883279e-01   +1.316874426534368e-01   -7.858149786893551e-02   +4.556235983170591e-01   -1.414443100869675e-02   +4.368312481673971e-03   -4.889490004578534e-02; +1.778962628838008e-01   +4.276074164694757e-02   +3.089685538431533e-01   -1.647035961534120e-01   +3.060153571800783e-01   +2.321848997050338e-01   -9.143452742966535e-02   +9.646249863185213e-03; -4.895069371869764e-02   +1.397383664863325e-01   +1.177084323183445e-01   -1.396982308218068e-01   -3.683214388390061e-01   +4.591835140319425e-03   +1.676717359815914e-01   -1.014432774030468e-01; -1.839219480015427e-01   +1.042786257878168e-01   -1.265614488654241e-01   +2.461622091276814e-01   +7.081167741782099e-02   +3.737224467832210e-01   +2.336208102013223e-01   +5.134579869734749e-01; +2.724562610725312e-01   -3.234106134878520e-01   -1.112073168102313e-01   -6.363043910968130e-02   -3.229293706571143e-01   -1.651787014038797e-01   +2.095144028513636e-01   -2.496944522022666e-02; -6.315404939854484e-02   -4.853730591610961e-02   -1.487681747878060e-01   +4.046592506944001e-02   +5.539596761884148e-01   -1.499091586363691e-01   -1.481598636829238e-01   +9.763539607369857e-02; +8.713462443468162e-02   -2.446714850340807e-03   -1.011385819998992e-01   +1.289176216700522e-02   -3.565617442508999e-01   -2.085252887970661e-01   +9.781532323332026e-02   -3.091683109676625e-02; -2.278186476638812e-01   +2.446885769464019e-01   +1.603444913725214e-01   +1.116551883690172e-01   +4.078149434661676e-01   -1.416385174756508e-01   -1.572958895285800e-01   +1.255019875683397e-01; -4.169284668318035e-03   +7.288932937220853e-02   +1.191119030333298e-01   +1.409159704470914e-01   +1.377531483176822e-01   -3.879639617605772e-02   -1.991233658431124e-01   -1.134138245048834e-01; -8.167164350951177e-02   -3.311171745873417e-01   +2.455006413111381e-02   -9.238258562612320e-02   -6.559235236013702e-03   +4.409973649586356e-01   -2.721634028072029e-01   +1.596512908430938e-02; +8.382147015100649e-02   +1.942036345053831e-01   +8.479484988430916e-02   +8.068323192113588e-02   +1.526389341338949e-01   -3.557274294378177e-01   +1.515995967740078e-01   -1.154848128838247e-01; +2.375713228867962e-01   -8.225093269702512e-02   +1.656312894836471e-01   +1.365438356849792e-01   -8.346815330613548e-02   -2.360778066762023e-02   -1.790235510354758e-01   +1.218191200820513e-01];
L1I_L2I_iGABA_netcon = [-1.688876859684429e-02   -4.282817647681543e-01   -5.602647371955143e-02   +1.252527536972569e-01   -1.445295359126309e-01   +1.668464303268506e-01   -1.931702534984867e-02   +1.835189689835176e-01   +5.583917712508062e-02   -9.393505518231396e-02   +1.348326920566534e-01   +2.657428282159549e-02   +3.129607795952138e-02   -3.712856331675984e-01   +1.015476377732125e-01   +2.409810168473802e-02; -1.354709607002691e-01   +5.341374957403724e-01   -1.257991404053493e-01   -3.577252033709186e-02   -1.377038535426676e-01   -3.974988717117524e-01   -3.881886362881129e-01   +1.691746226259733e-01   +2.332241533676164e-01   -5.207258618699540e-01   -2.017457261411010e-01   -5.785708972702413e-02   -1.252848870268518e-01   +8.134957797408614e-02   +2.285040691214138e-02   +1.885712239424110e-01; -1.439900239315716e-01   +1.979336711229008e-01   -3.953349235389961e-01   +1.533767936762791e-01   -1.883587654634672e-01   -6.823859986076598e-02   +2.763013213586421e-03   +1.093019110546559e-01   +2.102688494592570e-01   -1.455407163940384e-01   -6.475091031873867e-03   +6.222571984604154e-02   +2.820804263433380e-01   +9.926992583633577e-02   +9.495465401757039e-02   -2.457776904633052e-02; +2.359159331973363e-01   -1.749755924594342e-01   +2.933885144047838e-01   +3.200292296735293e-01   -2.688122898542358e-01   +3.000021921808348e-02   +1.307827855246122e-01   -7.446110703154782e-02   -2.162997909529856e-01   -6.511344992541285e-02   +4.009654332847903e-03   -2.717391771183274e-01   +1.920650581309033e-02   +5.285172541721533e-03   -3.218040196541420e-01   -3.380956503917752e-02; +3.088830395939512e-01   -2.847501389191950e-02   +2.387210067780632e-01   -1.771527793792573e-01   -2.058063523615009e-02   -5.876812039186138e-02   +2.282762324496695e-01   +3.587903301610061e-01   +1.572426411580064e-01   +1.970937735199248e-01   -2.238674259850575e-01   +3.121266749935457e-02   +8.222824962686406e-03   -2.705102861947734e-02   -2.493280714108508e-01   -9.261646762360007e-02; +1.075589776797116e-01   -2.371970689482247e-01   +2.920506982920526e-02   +1.481865272978964e-01   +1.311020649865430e-01   +3.467529422755845e-01   -1.284597071542896e-01   -3.260554973824428e-01   -4.589698652221330e-02   +1.628338476332803e-01   +3.743690904342803e-03   +5.494379106215719e-02   +7.778275815258298e-02   +8.968586517054503e-02   +2.754627525979362e-02   -5.786274924049546e-02; -6.369302743717144e-02   -1.111203281301829e-01   +1.666647818991706e-01   -3.933989668821826e-01   -1.604472199243152e-01   +1.213261106332541e-01   -4.376431797323833e-01   -2.804306537523928e-01   +2.172689844324629e-01   -7.734157116032889e-02   +3.073340732616944e-01   +3.028196593649971e-01   -2.408750710569246e-01   +9.553844044678170e-04   -7.497334724244080e-02   +4.166461827225204e-01; -8.115895460168665e-02   -1.272678626448973e-01   -7.467800276940220e-02   +8.036099426466216e-02   +8.136826166460426e-02   +7.990961439897359e-02   -9.463260882833324e-02   +1.541611665479055e-01   +1.168581830490359e-01   +1.294267401580805e-01   -1.571690793352859e-01   +2.256687895811275e-01   -4.303421104543482e-01   +2.312804223600997e-01   +3.043379912526621e-01   +3.173487641572605e-01];
L2E_L1E_iAMPA_netcon = [+1.861552153810767e-01   +2.909831332906819e-01   +1.027662913663979e-01   -1.661322013715307e-01   +1.474240528398660e-01   +1.234047973451073e-01   -3.005815703492831e-01   +2.364772455923125e-01; +3.125111733350097e-02   -6.572287835129489e-03   -4.758717458712105e-01   -4.010523299873716e-01   +2.026057394457555e-01   -3.279439733292251e-01   -2.749304076731184e-01   -2.167569155579477e-01; -1.838264717950270e-01   -1.288951721948428e-01   +4.554574082470687e-01   +1.938921316121796e-01   -3.509759061381974e-02   +2.536662373686836e-01   +2.837995767495944e-02   +2.909321963429360e-02; -1.489023779611078e-01   +9.188933051627314e-02   -2.561315414965912e-01   -1.687242332935975e-01   +1.931651250730534e-01   -5.049309103878907e-02   +2.818719292215852e-01   +1.258770135150419e-01; +2.956249012848156e-01   +2.238332173457520e-01   +2.018242568244639e-01   -1.320083917879215e-01   -1.356884454257730e-01   +3.274689254420128e-01   +6.957855521542475e-02   -1.931933798277665e-01; -1.570848075446185e-01   +2.741224174292001e-01   +9.105710896728492e-02   +2.393287962542149e-01   +2.017000755740447e-02   -7.821970456167184e-02   -2.069041358805872e-01   -1.449267810508242e-01; +1.556433092949789e-01   -2.414021188864788e-01   -4.267207086929330e-02   +3.163985424025557e-01   +1.386120284453307e-01   +1.137220201381831e-01   -2.824655663203032e-01   -5.559467378940289e-02; -4.782037342045349e-01   +1.889411018192286e-01   +3.006791957849737e-01   +3.551541961970792e-01   +3.584816595756033e-01   +1.760443674876845e-01   +2.146009386833458e-01   +5.102910406967058e-02; -2.666876116872508e-01   +7.799714997172041e-02   +9.474261875669205e-03   +3.657747829932969e-01   +1.209089256026565e-01   +3.148336328626880e-01   -9.561052366181026e-02   -4.436781877427494e-01; +6.044083884095611e-03   +1.141023076995891e-01   +1.469896788279175e-01   +9.294616500168898e-02   -1.560273379026099e-01   -7.665821927276016e-02   +2.577848045394835e-01   -1.180656213026040e-01; +9.651269366647050e-02   -1.847290440009511e-01   +4.296446264683577e-01   -5.104649618345961e-02   +2.998713247091761e-02   -5.934223300672729e-02   +8.306007681656614e-02   +2.816907539096727e-01; -3.527260141796055e-01   +2.485360183396236e-02   -8.480962076161713e-02   -2.290986907420589e-01   -2.745754906259536e-01   +4.500351012959712e-02   +3.125681286558329e-01   +9.577408409219407e-02; -1.383275454324175e-01   -2.445348643613337e-01   -2.752084881614377e-01   +4.224134457137471e-01   -6.013591112204861e-02   +1.210187202756933e-01   -4.515382150196373e-01   -1.984196433007037e-01; +2.621140147968849e-01   +1.366202093636382e-01   +1.042036041712237e-01   -6.342139193155989e-02   +8.209661531052229e-02   -7.869254639220880e-03   -9.551310205901706e-03   +1.281156590603191e-01; -1.791328438322120e-01   -2.040431357885729e-01   +1.303180459456518e-01   +8.027513360450823e-02   +8.928334377651639e-02   -3.498567920736040e-02   +1.033298453427698e-01   -1.160950641055911e-02; -3.080967462052361e-01   -1.977340811068696e-01   +1.370001689082760e-01   -3.516980779129151e-01   -5.636621250711966e-02   +2.269328939931821e-01   +5.418019705712263e-02   +2.029676587736093e-02];
L1E_L2E_iAMPA_netcon = [-2.528105552036785e-01   +1.636113401146549e-01   -4.028212678039078e-01   -6.142068538884377e-02   +1.243070548137049e-01   -1.807944887545046e-01   -2.117366085496344e-01   +1.783827604830229e-03   +2.030611784248413e-01   -8.522284204079886e-02   +4.322300843552958e-02   +2.655209242497907e-01   +1.595056473357150e-01   +1.509978267476876e-01   -1.249647595275110e-01   -7.741831670059135e-02; -1.695519813881059e-01   -1.464335821793639e-01   +8.000283446164143e-02   -3.984735851081462e-02   +9.997111809798277e-02   +7.610792880051724e-02   -5.187657431680990e-01   -2.007616287836083e-01   +1.554600736413548e-02   -1.713497408099943e-01   -3.653842561640984e-01   +2.023570240152363e-01   +1.052597248684213e-01   -2.376534309424048e-02   -1.100843708122577e-01   +1.316780543275720e-02; +1.799409025272852e-01   -7.942870225646523e-02   -6.217001688919477e-02   -1.411578348923712e-01   +1.327629453180583e-02   +1.762927146736871e-01   -2.062651153385549e-01   -5.255165872890854e-02   +5.749650221731287e-01   +6.640442514204976e-02   +7.029931621553964e-03   +9.641170319989140e-02   -1.677445479412291e-01   +1.897018714966941e-01   +1.335574377830391e-01   +2.788610474882641e-01; -3.028847226520494e-01   -1.893069322695241e-01   -8.870620848859187e-04   -1.350412844268004e-01   +1.551661870419423e-01   -9.799759371194008e-02   -1.877728383242763e-01   +1.866808947703194e-01   +1.682328542531918e-01   -8.336180314428253e-03   -3.989602858959863e-02   +9.866535066144064e-02   -9.571415854747192e-02   +1.270471796711598e-01   +2.391408208870297e-01   +2.402660918050815e-01; +3.526865773735319e-02   +2.774339092511726e-01   +2.446746157705807e-01   +1.086972954870525e-01   +1.764504077257594e-01   +1.492911145905818e-01   -1.946230344759295e-01   -3.810330862428202e-01   +2.269081970211724e-01   -3.277263197569420e-01   -3.083461750044745e-01   -1.403623211988633e-01   +1.815912834368077e-01   +9.378134430247090e-02   -2.599233387548291e-03   +4.687748883530122e-01; +2.387425698314216e-02   +7.926867296472136e-02   +4.499260052285229e-02   -2.708176065595578e-01   +6.727497728082213e-02   -3.294753028994986e-01   +7.376196495352494e-02   -2.177164261798821e-01   -3.739219047359901e-01   +5.382544972577807e-02   +1.083935760268420e-02   -1.829791711917861e-02   -3.588931831988126e-02   +1.628562734096760e-01   +2.568590035138423e-01   +1.160942929282307e-01; +4.357662606932964e-02   -2.044505619809480e-01   -3.950680081892473e-01   +1.583385401833603e-01   +1.137616320471073e-01   -3.066121284063999e-01   +1.178563005138494e-04   -1.141085370269884e-01   -9.094882537733731e-02   +4.804773647201128e-02   +7.879047151308244e-02   +4.423365730734211e-01   -4.131852722387150e-01   -1.059241180257763e-01   +5.154030081036014e-01   +8.059709664606424e-03; +3.126930312849766e-01   +8.018959557001562e-02   -1.448044054620475e-01   +2.817826583426224e-01   +9.662197305008907e-02   +2.928407747525840e-01   +6.087361052074336e-02   +2.811150334465903e-01   +1.344786973221215e-01   -2.138818525266614e-01   -2.028369030062395e-01   +1.946800577126680e-01   -1.812499798386626e-01   +1.202286184502795e-01   -2.799624420437686e-01   +1.951032197516337e-01];
L2I_L2E_iAMPA_netcon = [+2.150070913433184e-01   -3.409327578939218e-02   +1.672536602346913e-01   -3.830299762891140e-02   -1.349526777300717e-01   +1.311877996764261e-01   -5.089127502826571e-02   -8.775536477914832e-02; +2.675095058783218e-01   -3.309387689000211e-03   +1.530551837706517e-01   +3.876158739663758e-02   +8.008097974591133e-02   -1.439116054937504e-01   -1.657984918903113e-01   -1.470003024755936e-01; +3.261785961333195e-02   -3.799987468254474e-01   -2.865610787192213e-01   +7.373207400833537e-02   -2.758028225921729e-01   +7.867024359768439e-02   -8.053922193985696e-02   +1.412502420210317e-01; -2.163043252884556e-01   -2.088754196608460e-01   +9.613679591731440e-02   +3.370472742574356e-02   +1.336112344782278e-01   -1.207673105864055e-01   +1.634016251723040e-01   +3.923905624035329e-04; -1.530815527501433e-01   +4.723456671916220e-01   -1.599474252621223e-01   -2.897571566891810e-01   +4.962727947172006e-01   +9.235808271592011e-03   +1.863887790561427e-01   -2.928329634163699e-01; -2.682262999251194e-01   -2.509320327459445e-01   +1.878216282138145e-01   +2.911025036889322e-01   -2.585512343094540e-01   +6.180026113493976e-02   -8.394097260769974e-02   +2.984252077552477e-01; +6.196171288959424e-02   -8.023340105867520e-02   +2.690911333381111e-01   -2.588093867800997e-03   -1.045374524473817e-01   -9.015825608779737e-02   +2.195419787513526e-01   -2.931620162254103e-01; +1.516159052444084e-01   +2.700473727854516e-01   -1.925538387265754e-02   -2.817811738281301e-01   -5.353443051379886e-02   -8.076302130030917e-03   +5.734994371270941e-02   -2.865803629952101e-02];
L2E_L2I_iGABA_netcon = [+2.537498424615759e-01   +3.275559892578364e-02   +7.886650944393794e-02   +7.302233366130625e-02   +2.014800413654693e-01   -1.097926563012427e-01   -1.924301099616622e-01   -4.092922387925897e-01; -4.686265518291680e-02   -2.763504807218418e-02   -1.517480473522619e-01   +3.927942695207932e-02   -1.386829606091777e-01   +1.445900245469892e-01   +3.350928529309307e-01   +1.020607575223250e-01; +3.453854990695501e-01   -2.094043838996929e-01   -7.626506056519194e-02   -5.538347262373572e-02   -3.469566503357902e-01   -2.456923447393424e-01   +1.425360429608678e-01   +4.023743673577180e-02; +6.519237465001887e-02   -1.288654444224968e-01   +4.076908916496863e-02   -6.275623868813075e-02   -1.705307180737861e-01   -2.622038108354355e-02   +3.499022265069769e-01   +3.107419678651961e-02; -4.178457067545859e-01   -2.411904684424590e-02   +1.774511311252306e-01   -8.494693357343677e-02   -2.135324836992226e-01   -3.259854872771666e-02   +4.314217626445481e-01   +2.592141017872780e-02; -7.409245854545746e-02   -2.964857150326621e-01   -3.195808929658994e-02   -7.315807044471580e-03   -2.316181713189636e-01   -2.405742007019829e-01   +3.696522248210330e-02   +1.019209924633811e-01; +2.486194707953574e-01   -2.549140065162375e-01   -1.894309271161183e-01   +1.228159397085754e-01   -3.582010070771486e-01   +6.450653647074975e-02   +2.564272364260018e-01   -1.151438033194867e-01; -1.841307778990342e-01   -3.480952135563287e-01   +3.772532778696106e-01   +8.618821559832408e-03   +8.898513701100495e-02   -1.254124436716086e-01   -1.240132727492135e-01   +5.088531780863274e-01];
L3E_L2E_iAMPA_netcon = [-9.472306252636850e-02   -3.597810405650742e-01   -2.046731977241975e-01   -1.142848213822888e-01   +3.765407689863325e-01   -1.699085023117738e-01   -1.897850278495204e-01   +3.613934258011081e-02   -1.912602684361657e-01   -2.494377716633735e-01   +6.128843804099974e-02   -2.832235194280845e-01; +1.879444118301249e-01   -1.654597383224712e-01   -2.988251628785483e-01   +2.187851880866188e-01   +1.888629891031161e-01   +2.215312465463828e-02   +2.267479651739310e-01   +1.610590541009193e-01   +1.372184063532594e-01   -2.971150362094646e-01   +7.646484969398953e-02   +1.025758209272414e-01; +1.497794853292322e-01   -2.219325506821908e-01   +2.900330552087420e-01   +8.441629208908612e-03   -3.959258292646802e-01   +3.006754643830844e-01   +2.186172916341781e-01   -2.250961219794392e-01   +8.501179002772615e-03   -8.573065378412895e-02   -8.854934151921488e-02   +2.803759412772059e-01; +1.745889959471685e-01   +1.717082054469252e-01   +3.754302503247130e-02   +2.116817589073823e-01   +1.237134002715803e-01   -3.577007328024659e-02   +8.928432959653834e-02   +2.456468970705217e-02   +3.052093867268568e-01   -3.137348704711397e-01   +5.393358132554189e-02   -3.165535839560407e-01; -1.934720319491571e-01   -1.569826618034549e-01   -5.937543287309400e-02   +1.775524811105972e-01   +2.204376425829324e-01   +1.317660393455525e-01   -2.878492540992730e-01   -2.389245980879812e-01   -1.962447488185066e-01   +5.801038181845163e-02   -5.487990447335345e-02   -1.983984362403773e-01; +1.443592343207193e-01   +2.350259815656754e-01   +1.809449120223544e-01   +3.777244382221748e-02   -1.669388263333907e-01   +1.521413433182413e-01   -2.898988228664401e-01   +1.874315440865021e-01   -6.401953401623162e-02   -1.889751185460126e-01   -1.757378892047998e-01   -2.834533510801807e-01; -2.872593612459730e-01   +1.455966158682616e-01   +8.430890816548171e-02   -1.659870856602904e-01   +1.166535245977885e-01   -1.796318289355388e-01   +1.645932106269574e-01   -3.005552205562826e-01   +3.098344083948854e-01   +9.253931567162953e-02   -2.592711351633446e-01   +1.414859754431383e-03; -3.406744838754765e-01   +4.214736282304042e-01   -2.978639376870028e-01   +3.095721963329634e-02   -9.506000789684776e-03   +1.233236067128067e-01   -7.141558143003435e-05   +1.014610799620441e-01   -6.154023030805873e-02   -2.504427606579301e-01   +1.509598036863953e-01   -1.014297264917753e-01];
L3I_L2I_iGABA_netcon = [+3.852839187076457e-02   -8.576084175030357e-02   -3.101511253462036e-01   -2.807346887896771e-01   +1.154994483274240e-01   -2.845033272287821e-01   -1.444625247939027e-02   +2.504872672143585e-02   -1.030474407733448e-01   -4.383924750493755e-01   -1.395729674485303e-02   +1.759147168474030e-01; +1.826981645844091e-01   +4.562165926127948e-02   +3.448193589651011e-01   +4.723024631969534e-02   -3.138293744483509e-01   +1.667364896248500e-01   +8.232110491691286e-03   +1.085024587342958e-01   -2.486913458210187e-02   +3.575802515174089e-01   +1.525650513455846e-01   +2.962499627458343e-01; +1.465063951744712e-01   +8.470112067812816e-02   -3.107090399291033e-02   -4.842444347940954e-01   +4.185133383273105e-01   +1.965781177007818e-01   -7.179255028040710e-02   -6.078945307550397e-02   +2.590314124809506e-01   +6.588838533873630e-02   -3.847468597424154e-02   +2.772755614609560e-01; -1.879858110100739e-01   +6.293180184704078e-02   -2.022930577841157e-02   +8.015941668445471e-02   -2.496909219961188e-01   +2.243758840709938e-01   -1.866589820698190e-01   +4.691595343499577e-02   +2.577571488375565e-01   +7.272577035060360e-02   +5.196630465473810e-02   -1.890896923642936e-01; +4.015154759649799e-02   -1.330757785840548e-01   -1.573842209272774e-01   -2.693297453722274e-01   +9.251319219224038e-02   +2.724519024570486e-01   +2.670710792980164e-01   +5.186052721274429e-01   +7.610207181266015e-02   -4.191712040609267e-01   -3.733832401339823e-01   +2.498301986779574e-01; -1.212308648405330e-01   +2.385623219650161e-01   -2.493533222212985e-01   -2.671799009424326e-01   +6.582556472917198e-02   +9.402739269563115e-03   +3.537092402208821e-01   +2.930040590333987e-01   -2.150669927782570e-02   -1.377800908936329e-01   +1.762394818828506e-01   +2.166196335766880e-01; -1.067807255996618e-01   +2.833874580345467e-02   -2.138351127054982e-01   +4.829059087261831e-02   -3.858211081747009e-01   -1.839411297785444e-01   +1.088417785705237e-02   +4.746705997660201e-02   +2.470105985533454e-01   +7.706750938986159e-02   -2.302701114971525e-01   -3.939452999748454e-01; +3.631641367138699e-02   -2.170479299209175e-01   -2.826002239351775e-01   +8.946467168071552e-02   -1.224078057391781e-01   +1.266958350671032e-02   +3.391477781319553e-02   -5.724084773269569e-02   -1.897646026595946e-01   +3.290380590380204e-01   -4.967802906516127e-02   -2.372706854787521e-01];
L2E_L3E_iAMPA_netcon = [+3.073027162316419e-02   +2.304183417794586e-01   -1.571834062893636e-01   -9.019892458679601e-02   +2.226490697305721e-03   +1.299225421868664e-01   -1.336696940739732e-01   +2.380206843309030e-02; -6.566436726761431e-02   -8.688133195401140e-03   +2.024549560525200e-01   +1.395964354940342e-01   +9.836745792711334e-02   -5.480142818089213e-01   -2.601207922787618e-02   +1.745523896672731e-02; +2.546819963543887e-01   -2.590089669477053e-01   +2.229707288373600e-01   -3.204001491577164e-02   -2.205352793272839e-01   -4.312216368000014e-01   -2.676830928372063e-01   -2.573771358203150e-01; +2.975036980114997e-01   +2.206950411321554e-01   +1.652860383899839e-01   -4.513270000578157e-02   +1.216505956407212e-01   +3.724546484250665e-01   +6.470313082931475e-02   +4.646657625223823e-01; -4.412291507505647e-02   -1.563026769087433e-01   +3.775921604588614e-01   +2.938292309085435e-01   +2.241712889086572e-01   +1.219192642617699e-01   -6.542564476206807e-02   +8.049419474948846e-02; +1.569739437882009e-03   -2.939510620474363e-01   -6.409592736048580e-02   +1.112739988367742e-01   +3.211896052521955e-01   -1.343364633138561e-01   -3.033530968026945e-01   -2.648496346749132e-01; +7.501009228390831e-02   -1.461925411451460e-01   +1.130598595551335e-02   +2.864471628328921e-01   -3.288447850688618e-01   +8.897767425633921e-02   -1.925995116609249e-01   +2.007235887075060e-01; +9.394382322676989e-02   +1.305084530398354e-01   -5.021478187433843e-02   -2.198409481257954e-01   -8.625303506865768e-02   -1.068588368449864e-01   -3.120571635727285e-01   -1.546557454955229e-01; -8.959870482667641e-02   +3.471667214809279e-01   +2.714116603968904e-02   +3.145954560490716e-03   +3.893058790500270e-02   +4.441497037232908e-01   +1.635534796607521e-01   +5.371354225962482e-02; -2.738610893773191e-02   +2.662162500647005e-01   +9.356499765241086e-02   +3.103085598617160e-01   -1.526559417901747e-01   -2.727061181465729e-01   -1.544086877694226e-01   +1.293666636875546e-02; -1.057358725970948e-02   -2.319965817365258e-01   -1.258351236528511e-01   +1.141157673129521e-01   -3.919198485931338e-02   -1.552396463264594e-01   +1.948229699969224e-01   +1.383755596378094e-01; +1.856845856652277e-01   +1.826426281236213e-01   +3.796964857990360e-01   -6.698164560931807e-03   +2.209403408808524e-01   +4.707539979761757e-02   -4.742007600525303e-02   -2.205685938290551e-01];
L2I_L3I_iGABA_netcon = [-1.983089007431512e-01   -9.556221870633388e-02   -1.996598347431453e-02   +1.255306614569407e-01   -1.087162979327370e-01   -2.409120688422310e-01   +2.040555621064170e-01   -1.058547510005221e-01; +4.898961458320861e-03   -1.302008673856714e-03   +3.485489542965665e-01   +3.210917935859148e-03   -4.779249488443660e-01   +1.740533283445937e-01   +1.038120422342694e-02   +1.481528205972590e-01; -5.491195613411780e-02   +6.608392053003652e-02   +3.089542457705204e-01   +6.523294638042809e-02   -2.752586003090660e-01   -1.283522241138688e-01   -3.428095683578062e-01   +1.806117004078904e-01; -1.184545492850930e-01   +1.687900672648326e-01   -1.015043700209809e-01   -5.396586431257856e-02   -9.333710486851887e-02   +1.946562992242434e-01   -3.255591482169848e-01   -1.886351104084739e-01; +3.581680731309398e-01   -1.950672014638956e-01   +2.107050168810847e-01   +1.563669000479711e-01   +1.381437103358613e-02   +7.988380824492268e-02   -2.582424269234490e-02   -2.208590594808333e-01; -2.985376587822303e-02   -1.567552613404407e-01   -4.284573695721137e-01   -2.578126875380850e-02   +1.694710187152502e-01   +2.233822483881168e-01   -2.097447800358121e-02   +4.625630218087642e-02; -3.434945123627354e-01   -5.197605501528650e-02   -4.586006807126008e-02   +1.720418486078792e-01   +3.758216376225103e-01   -4.697587468554217e-02   -7.259456475273945e-02   -9.281466282496717e-02; -1.979085635458286e-01   -3.749081507397001e-01   +1.430319459340069e-01   -1.377305492248533e-01   +5.327434601985137e-02   +3.848306453172467e-01   +8.325809294172215e-02   +2.311054281076856e-01; +2.192508570668650e-01   +2.423781789765000e-01   +6.412853382104186e-02   -1.282085905667474e-03   +2.109799319068731e-01   -3.728394727316504e-01   -3.212876478242269e-02   +2.041617637282916e-01; -2.523080996190626e-01   +5.528629837522765e-02   -3.789122901404737e-01   -1.117561354651225e-01   +3.292625751833633e-01   -3.677825190840577e-02   +1.142273221283452e-01   -9.869666304215902e-03; -8.359414271352841e-02   +1.110311795572612e-01   +1.717479984193700e-01   -2.154467873623718e-01   +2.045450601360431e-02   +4.233107370405231e-01   -9.986164326524011e-02   -2.040511656467530e-01; +1.258205223781456e-01   +4.261538445463006e-02   +1.500527681508889e-01   +4.169269069150296e-02   -1.166884037815358e-01   +2.956923633026749e-03   -3.244354628484277e-01   +5.416783504995286e-02];
L3I_L3E_iAMPA_netcon = [-1.849263352440836e-01   -2.368538952926975e-01   +1.468574912950983e-01   -8.186111710909919e-02   -1.463118086667678e-01   +9.953999040536307e-03   +1.986272272708324e-01   -3.780008723291970e-01   -2.627940226338964e-01   +6.016222925702502e-03   -1.217072276365297e-01   -1.233187222524103e-01; -3.692855851992742e-01   +1.937528639398615e-01   +3.414046447125562e-01   +1.254343954585287e-01   +1.498784091023469e-01   +7.585988632491125e-02   -2.981112349706109e-01   +1.797068577835380e-02   -2.151248513898099e-01   +5.693892956757850e-02   +4.037677114520384e-01   +1.099728201457044e-01; +1.229245475397157e-01   -2.959647625416140e-01   -2.742949704266957e-02   -1.094234116144749e-01   +1.806078044874315e-01   -7.355641390620699e-02   -2.126054332763627e-02   -4.017524445464958e-01   -3.998724119069762e-01   -2.459524223605054e-01   -3.022096584269819e-01   +4.163599998594333e-02; +1.556476129160394e-01   +1.153162026234855e-01   -5.164777038286346e-01   +3.123749840343998e-01   -8.232507258413255e-02   -2.457131620383212e-01   +1.505863703306350e-01   -1.179959975581856e-01   +6.596596169169916e-02   +6.439541925021883e-02   +6.067036028616907e-02   +1.747758301678854e-01; +1.476977446133456e-01   -1.687595210417244e-01   -2.049302339279951e-01   +8.349843371787680e-02   +2.432090196104529e-01   -1.772276261032630e-01   -7.737608419143405e-02   -2.941696807104103e-01   +2.219404196040003e-01   -2.960287732435904e-02   +1.131055892588937e-02   +2.010908843856983e-01; -5.885341636779240e-02   -1.288519921691203e-02   +7.600894846674601e-03   -2.554095599841895e-01   -2.017161638988999e-01   +4.645708889466567e-02   -2.693104334643339e-01   +2.782625269179312e-01   -1.227505033294268e-01   +2.791044575147270e-01   +1.959685686063619e-01   +2.143915541768024e-01; -1.256670831380848e-02   +9.972023712436230e-02   -4.654105353577766e-02   -3.255576331927512e-01   +2.499432759984839e-01   -2.211623247917172e-01   -8.136237941836202e-02   -1.081971852662227e-01   +3.649289260117168e-01   -3.478448215474910e-03   +7.460760983762478e-02   -3.580413320024703e-02; -2.425482081504751e-02   -7.740788442949204e-03   +1.057109534663299e-01   +2.261563083084384e-01   -9.378042338114637e-02   +2.355849261564737e-01   -7.415483432152568e-02   +1.576368151242181e-01   -2.926212499571232e-01   +1.774852698883103e-02   -2.483739144532499e-01   +8.819121680749537e-02; -1.416573354801188e-01   +1.908154110793422e-01   -2.356207110971011e-01   +3.642829520444825e-01   +5.079977183816142e-04   +6.078070465367957e-02   -1.922362619169422e-01   -2.673751502416200e-01   -1.213935852186823e-01   -2.754295482796295e-01   -1.975301394315493e-01   +1.760531913945392e-01; -3.701291222098230e-01   +1.288292631979307e-01   +9.085678377022828e-02   -2.230331228778298e-01   -2.524169981722820e-01   +1.005337060327345e-01   +1.464909815117931e-01   -8.645706734335359e-03   -4.534560657242248e-01   +2.183446427564468e-01   -2.089917314817815e-01   +6.587654522766703e-02; -8.300852849802101e-03   +1.745314132677612e-01   +1.518431491345983e-01   +8.026455886837486e-02   -2.404046580624569e-01   +1.311355720896579e-02   -2.166235704230134e-01   +8.972302345534318e-02   -1.956790391873695e-01   +2.942180387212377e-02   -1.696442344809873e-01   -3.365362911849057e-01; -1.465467699179580e-01   +6.949735815800051e-02   +1.145920948552046e-01   -2.281491842210698e-02   +9.172055585354351e-02   -1.253054447736374e-01   -1.035775132212921e-02   +5.560546551536936e-02   -2.669773872924983e-01   +3.591231476655848e-01   +2.522205219042075e-01   +1.237970141714223e-01];
L3E_L3I_iGABA_netcon = [-1.418966896540198e-01   -3.006003433268382e-01   +2.956553854939445e-02   +2.912811882217189e-01   -5.265922429917484e-02   +3.575345368139531e-01   +3.327697557884042e-01   +2.643871728160575e-01   -1.722903583803309e-01   +2.470277680269807e-01   +1.129072139181030e-01   -6.582850865758880e-02; -4.484863439631122e-01   +2.171244871974203e-01   -1.164401961652927e-01   -6.921399320476743e-02   -7.326453124239866e-02   -5.369910348925791e-02   +2.771409135336669e-01   +5.868584659762138e-02   -9.134519349977582e-03   -6.934646811802836e-02   +5.437030775151062e-02   +5.994295714465910e-02; +2.907190132165617e-01   -4.633157660937179e-02   -1.543033330377093e-01   +3.667075787483893e-01   +2.601095028049215e-01   -1.999347967251154e-01   -3.646639198676916e-01   -1.595569575322550e-01   -4.718317035258140e-01   -4.999480239795009e-02   -4.714680701273597e-01   -6.740884663204096e-02; +2.897837763312403e-01   -5.164746045044023e-01   -1.952787444388096e-01   -1.217135185568434e-01   -1.611685104574513e-01   +4.007153856329684e-02   -4.577530809527700e-02   -2.822952098181560e-01   -2.204174827937405e-01   -1.335783806357737e-01   -3.987987636897450e-01   -2.208958179578502e-01; -1.021609725342955e-01   +2.661749750494848e-01   +1.939675916216285e-03   -4.341211998658325e-01   +1.311307833949001e-01   +1.354206301601843e-01   +3.345275895740160e-01   +2.801616130038633e-01   -2.713067010110721e-01   +3.188155845683187e-02   -3.899407915562719e-01   -2.350824557981077e-02; +4.227975122136488e-01   +1.426868350984503e-03   -4.383564315781279e-02   +2.409044000302597e-01   +2.833059949476595e-01   +1.487327124465175e-02   +3.216337086699232e-01   +2.081841026452287e-01   +2.517756281296645e-01   -3.144324106756881e-01   -1.825702848604557e-01   -1.217528067839879e-01; +6.564749070803189e-02   -3.822630446859761e-01   -4.904871761076782e-02   +1.250426588836950e-01   -2.982025445327624e-01   -3.374964754125317e-01   +1.115351513328351e-01   +2.004984070402463e-01   +1.252897695881213e-01   +1.490618927773784e-01   +6.942542419209581e-02   -2.963904705158734e-01; -2.228055866772891e-01   +7.360802107491239e-02   -1.710449958332985e-01   +1.561624917287281e-01   -2.959544310747715e-01   +3.130716490308785e-01   +4.188294295164083e-02   +4.224190988120680e-01   +6.767659507501975e-02   -4.171968304691777e-01   -1.968299245207942e-01   +6.164515249476495e-02; +7.553696332108428e-02   +7.938811603326446e-02   +1.032751653577385e-01   -1.344214795622328e-02   +1.923489387190620e-01   -3.183792693866573e-01   +9.998594463329946e-02   +4.080001311906357e-01   -1.693777598110430e-02   -3.950664343670395e-02   -4.263014094408320e-02   -2.731250783515287e-01; -2.229014468665185e-01   +3.952709636163246e-02   -1.845561968090826e-01   -1.519457638963442e-01   +2.312862404534815e-01   +3.113801489791812e-01   +3.651767544305347e-01   -5.939777420622910e-02   +3.367702975025916e-01   -1.409384372249518e-01   +3.612290159301934e-02   +9.143761185295646e-02; -3.377966948924060e-03   -2.136801070740060e-01   -1.401762082437502e-01   +1.197340290829719e-01   -1.397903656596942e-01   +1.591691937864894e-01   +5.716543116642596e-02   +3.504593746542680e-01   +1.399203663791691e-01   -1.142839901369754e-01   +1.619826288840483e-01   +1.105737015485127e-02; -5.356403298979143e-03   -7.728335267023896e-02   +5.824576611995666e-02   -1.545063616873880e-01   -1.596435997745858e-01   +5.593966261093834e-02   +2.004623431133432e-02   -3.148364643906203e-01   +5.905799644295717e-06   -2.484403188703797e-01   +3.544809872746874e-01   +1.147659047552186e-01];
L2E_Input1_iAMPA_netcon = [-1.425080882627263e-01   -2.914689790895867e-01   +1.884185192289907e-01   -2.815934066273228e-01   -8.097698106544125e-02   +2.651205199844751e-01   -7.238209231930738e-02   +3.561924052454075e-01];
L2I_Input2_iAMPA_netcon = [+8.222623697622340e-03   -3.257869077655542e-01   +1.557573735429290e-01   -1.176434361208347e-01   -4.548986550346138e-01   -5.723815460716294e-02   -2.698458997001896e-01   +7.900857666429967e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
