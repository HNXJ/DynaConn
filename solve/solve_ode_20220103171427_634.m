function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+3.209217452188511e-01   +5.146675594037262e-01   +5.739102436219564e-02   +6.226361327047492e-01   +5.227087769561326e-01   +1.832305385479728e-01   +7.306989125376007e-02   -1.516916514073066e-01   +1.814117479404873e-01   +8.332621026742267e-02   -2.282726001137421e-02   +3.140211877631419e-01   +1.154948776766072e-01   -1.916798211693319e-01   -2.374429873854935e-01   +4.667781091198822e-01; -1.992484648633218e-01   +1.851922745999924e-01   -2.211309355447831e-01   +2.644439531563445e-01   +1.571189863339147e-01   +6.390394632425859e-01   +3.403105622299395e-01   +3.739757974561784e-01   +1.793516791196066e-01   -1.463435749697097e-03   +2.557806717716510e-01   +4.418005890081538e-01   +1.747497611736632e-01   -4.151661697569771e-02   +4.079772665129213e-01   +1.710577822916084e-01; +4.668349445955853e-01   +3.302458131522696e-01   +4.227287549577998e-01   +7.821249042157842e-01   +6.726211324688639e-01   +3.940178806209271e-01   +5.543282811282955e-01   +3.486773843637040e-01   +3.811523482898009e-01   +5.797712932502096e-01   +1.514220358511022e-01   +7.832801738401461e-02   -1.238933757350631e-01   +5.395876512335509e-01   +4.493521015117889e-02   +1.601883028647952e-01; +9.368590357294937e-01   +6.681186756832753e-01   +3.239857005393439e-01   +1.026732861906719e-01   -8.761900182259111e-02   +1.410772366284424e-01   -5.967101346394256e-02   +4.464108231986357e-01   +1.362161785999060e-02   +2.546939929985798e-01   +4.762191043539437e-01   +2.213942820899576e-01   +9.060834265938188e-02   +4.352111078985217e-01   -5.134940620190485e-02   +3.335035480188822e-01; -1.090134868579713e-01   -3.520015928722084e-02   +6.839267244845352e-01   +2.207113676157888e-01   +3.888149160979629e-01   +3.036081908240349e-03   -1.027117708369407e-01   +2.202884785754850e-01   +4.105743327676142e-01   +3.489439965217264e-01   +4.089748965512187e-01   +1.066106271400599e-01   +4.632515188670371e-01   -2.207430111518353e-01   -1.242753815892946e-01   +6.621801358358903e-02; +3.162478764386872e-01   +5.041795306292398e-01   -4.818056251476564e-02   +6.298852232349025e-01   +3.864000019444573e-01   +4.685449407528833e-01   +1.208933528865018e-01   +4.798759446898828e-01   +5.674422312377077e-01   +2.942851270561236e-01   +3.250131629429809e-01   +1.435121041493974e-01   +9.398464147802474e-02   +1.659248106936187e-01   +8.062005211083347e-02   +7.198350657653862e-03; +1.714174733246057e-01   +4.714574686329366e-01   +4.451818079281067e-01   +4.334905940871426e-01   +4.385237117410072e-01   +2.660455951840041e-01   +7.474375889754780e-03   -1.094758169936232e-01   -5.022748736083649e-02   +5.291713333063387e-02   -2.498463178837732e-01   +4.097383289964668e-01   +4.782472292060477e-01   -1.009922886991864e-01   +2.941830783152415e-01   +2.695624520556583e-01; +3.956378552846933e-01   +3.687016504253700e-01   +2.123886941325082e-01   +2.080576559435517e-01   -2.100874540912509e-01   +4.149777913466063e-01   +8.466400346677572e-02   +3.382792857299506e-01   +6.694097972767002e-01   +1.043757482061932e-01   +3.301209495457951e-01   +2.774786591665443e-01   +1.712684316720422e-01   +1.091190077672212e-01   +8.681749834196283e-02   +2.084315520425470e-01; -1.092731833310625e-01   +3.684990724160873e-01   +2.260246326827043e-02   +6.741888972021645e-02   +3.676562129859593e-01   +2.496867233061554e-01   +3.097027516707727e-01   +4.971360802116905e-01   +4.282320985298361e-01   +3.464271369772238e-01   +6.449919008117273e-01   +2.023084793897743e-01   +7.442025075724275e-01   +4.738787706577219e-01   +8.448173893041891e-01   +5.087439635394985e-01; +9.846309556035354e-01   +4.242055371108107e-01   +1.410523106705430e-01   -3.618429375679897e-02   -1.213598043465202e-02   +7.119550162319050e-01   +2.625239232572891e-01   +6.150452633931198e-01   +1.653862777525763e-01   +6.035699302661103e-02   +2.869290657553251e-01   +5.174163644648496e-01   +1.608778436583571e-01   +3.133536072039043e-01   +5.491845841833921e-01   +1.701969064255092e-01; +2.070677752832490e-01   +2.411275081848699e-01   +4.953879003577654e-01   +2.624831234707865e-01   +1.721630037774983e-01   -9.034347928892444e-02   +3.201375733148576e-02   +6.132027875304895e-01   +5.945978977118539e-01   +1.979094471438516e-01   -3.763035778365403e-02   +1.275709725839645e-01   +7.073272539758062e-01   +1.401322088448239e-01   -1.921820769571987e-01   -1.662869657485396e-02; +1.125409278175133e-01   -1.185008870328008e-01   +5.778307897926872e-01   +4.645102108559737e-01   +6.726691451399348e-01   -1.547857714336530e-01   +6.106108491247245e-01   +4.312605156777246e-01   +6.058491790669641e-01   +4.032637386721746e-01   +4.180937467665340e-01   +1.996127023110564e-01   +5.245107492758443e-01   -5.032525871137583e-01   +2.680452056137125e-01   +4.335783729951470e-01; -2.116078050210498e-01   +4.159692264603816e-01   +4.914171093716439e-01   +4.203691375438082e-01   +3.730891888600651e-02   -2.799307392014088e-01   -5.075294047007596e-02   -1.949330349415206e-01   +9.834273950371840e-02   +4.471670902108015e-01   -1.473303439323466e-01   +5.129785431966628e-02   +2.536583690700543e-01   -2.702279704751913e-02   -2.395485764930070e-02   +4.503807045873595e-01; +1.669434571094819e-01   +1.047832814832231e-01   +5.183648708570555e-01   +5.862701169882889e-01   +3.661757446887034e-01   +2.820890404592798e-01   -4.612518132263190e-01   +2.796704383911620e-01   -4.762781313006702e-02   +3.064962451293665e-01   -5.965626890318682e-02   +8.942498530286298e-02   -4.938510434005389e-02   +1.174457874374754e-01   -1.495453771666835e-01   +5.583101475578829e-01; +2.597763675130666e-01   +3.670183003315045e-02   +3.036319474922074e-01   +3.005305095907960e-01   +6.762341725267523e-02   +2.574487298369103e-01   +5.127720681869503e-01   +4.452238936328304e-01   +1.945573519516796e-01   +4.258917107113417e-01   +1.277675644801477e-01   +1.993163868445528e-01   +2.288533363594837e-01   +4.147218649884842e-01   +8.638768009575098e-02   -1.759450929880692e-01; +4.556011715170200e-01   +4.394319179194722e-01   -9.202598205005241e-02   +1.579574447518024e-01   +4.119756447685101e-01   +2.813904877667390e-01   +4.631354351309057e-01   +1.127587869911336e-01   +4.242740563919975e-01   +8.567903387579072e-02   +5.886899712348067e-01   +3.830946663415384e-01   +1.000000000000000e+00   -1.200775306667543e-01   -2.975065013615356e-01   +1.445536450010253e-01];
L1E_L1I_iGABA_netcon = [-3.731761253908717e-01   +2.834498652264084e-01   +4.902249296997985e-01   -2.394436897478081e-01   +1.276427682598383e-01   -8.579598283404358e-02   +4.478867215041309e-01   +3.341613399217541e-01   -2.780055444725718e-01   +5.305800387776173e-01   +1.124664140641108e-01   -1.517309711177291e-01   -4.924721154347067e-02   +2.674680941840012e-01   +5.170783984710178e-01   +6.510101163397383e-01; +2.972829784855253e-01   +2.652428631349921e-01   +6.496378971852637e-01   +1.198933499724821e-01   +5.458940175293698e-01   -3.588528068780235e-03   +4.766722201849738e-01   +2.776234496004572e-01   +2.259313123015913e-01   +1.280905826957796e-01   +6.314417926318183e-01   +5.791799037922037e-01   +4.017816395323568e-01   +6.012044091638041e-01   +4.408795303452721e-01   +1.674604751759765e-01; +2.898403196579249e-01   -1.723837498809149e-02   +6.237278377987197e-02   -9.268992685062113e-02   +3.671961779690669e-01   +3.502912933420998e-01   +1.351541825333667e-01   +4.787041784964340e-01   +2.541254179827743e-01   +1.733896540421721e-01   +1.226473365298386e-01   -1.796757034008449e-01   -5.404274052256874e-02   +2.864283085768848e-01   +3.340308174256915e-01   +4.161961751126271e-01; +5.399476807815454e-01   +5.060771328720099e-01   +6.816056865467471e-01   +2.527676553674644e-01   +4.172368632711412e-01   -2.753208997404462e-01   +2.830307001079138e-01   +6.085139483363534e-01   +3.243297025697508e-01   -3.719627445676087e-01   -1.609810362173759e-01   +2.698011443373849e-01   +6.028507950488890e-02   +1.159170876993499e-01   +1.781482802864069e-01   +9.710560656187998e-02; -7.458328432962608e-02   +3.633714283834442e-01   -4.011995930534668e-02   +3.934511298207657e-01   +3.629920511674028e-01   +7.197565595706043e-02   -2.247657562518200e-01   +1.699472495085714e-01   +6.260140367582092e-01   +2.519176440957429e-01   +4.877368204833567e-01   -1.882916562182521e-01   +6.237781347105383e-02   +3.415878104398817e-01   +1.955012503347289e-01   +3.087516985131262e-01; -1.276066094007226e-02   +2.280121280254105e-01   +6.798355363934468e-02   +1.570877551327615e-01   +4.652404301871677e-01   +1.862256548884057e-01   -1.729686011369808e-01   +5.533734773094079e-01   +2.843108498598097e-01   -1.579169885144383e-01   +7.738464950859215e-02   +2.061461521073641e-01   +5.138398868817691e-01   +1.714884291224488e-01   -1.139502533672079e-02   +4.162375380129951e-01; +1.980557003431890e-01   +1.829846737582116e-01   +2.345051127440417e-01   +2.829207303337606e-01   +3.166359718265121e-01   -5.383919603892386e-02   +1.720927085595784e-01   -3.503600586152328e-01   +3.166726878423579e-01   +3.624451591443038e-01   -1.766515550315265e-01   +2.421024646293961e-01   +7.650726277623904e-02   -1.179906391541574e-02   +3.792948256777650e-01   +6.109939226661509e-02; +1.642862526504583e-01   +2.554792222367354e-01   -7.864768299066145e-02   +7.637324491015977e-02   -2.213223845671690e-01   +3.265456575896717e-01   +2.728497075656793e-01   -9.333770753226303e-02   -2.319157038916502e-02   +4.310274730715649e-01   +5.571717769671777e-01   +2.236587981438469e-01   +5.036305710704928e-02   +5.333511144017123e-01   +4.142336728932610e-01   +6.670866174437544e-01; +2.884059746203770e-01   +1.000000000000000e+00   -1.520891987496898e-01   +5.993899133891397e-02   +2.089102786979488e-01   +5.496644394963337e-01   +3.479628316224007e-01   +3.943464751210293e-01   +5.698447921117706e-01   +4.536126627380387e-01   +8.092174432108550e-02   +7.366343615002625e-01   +5.483958486929280e-01   -2.316791631214681e-01   +2.430500332510956e-01   +3.445578682674128e-01; +4.171058167554828e-01   +5.894582888980593e-01   +2.932899425602318e-01   +3.850747387581490e-01   +3.367812468970617e-01   +2.873740085104722e-01   +4.545259170118316e-01   +2.879403893290937e-01   +1.484207588820940e-01   +2.821807380227630e-01   +2.342639834905920e-01   +5.938947663663612e-01   +3.133092057227720e-01   +5.250782461051519e-01   +1.592954687508326e-01   -3.487507640371369e-01; +6.660703255570841e-01   +2.072951272486554e-01   +5.540116327689652e-02   +2.368059075758538e-01   +2.594493950224570e-01   +5.133296524620615e-01   +2.688526421641429e-01   +6.293138121265044e-01   +1.679089977894532e-01   +4.781365547892324e-01   -2.570445130800763e-01   +6.874772360513379e-01   +1.641706001775943e-01   +3.321197138907881e-01   +6.211333779279588e-01   +1.971784275532773e-01; +1.254339181893290e-02   +5.025231526230930e-01   +6.527788736842496e-01   +7.924654258702678e-02   +5.862092261274098e-01   +7.168197637700364e-01   +5.292362456220945e-01   -7.435432513438185e-02   -1.823342757077929e-01   -1.079295032420899e-01   +3.728904369161599e-01   +2.238617631783077e-01   +2.885758072213668e-01   +7.461853602484837e-01   +5.015645168793762e-01   +2.178844124103121e-01; +3.840168941824210e-02   +7.301981376862606e-01   +1.280057039287949e-01   +1.550322147619480e-01   +4.345906203201047e-01   +2.920303029732211e-01   +4.191298598028049e-01   +8.214796492636850e-02   -1.430242451145963e-01   +1.550630557747931e-01   +3.154000120073181e-01   +2.806997814243270e-01   +4.161217662500031e-01   +1.806719990981037e-01   -5.803741440175444e-02   +2.220034825418169e-01; +1.721111026671164e-01   +6.463555229805036e-01   +3.890613097006496e-01   +5.188694852518845e-01   +6.388632574408277e-01   +6.418735119978504e-01   +8.134436375888640e-01   +2.922582732269166e-02   +1.760446385000493e-01   -1.837736450877402e-01   +3.651138333689692e-01   -3.109770030305110e-03   +8.279303172487573e-01   +4.193076320648246e-01   +2.831141679135893e-01   -6.812316499279465e-02; +1.713884340165522e-01   +4.358336094434416e-01   +2.554246602362297e-01   +6.029054945721134e-01   +3.039192951649273e-01   +1.664320493248205e-01   +2.115511906244360e-01   +2.746626370150793e-01   +2.389142354604045e-02   -3.261830280701172e-01   +2.809729231546970e-01   +4.626854452209244e-01   -5.513360696255584e-02   +1.749997007225882e-01   +4.573636944330698e-01   +7.464109334383211e-01; +6.887655926593171e-01   +3.266158496183162e-01   +2.339719318920033e-01   +3.749893042197887e-01   +5.457238651426045e-01   +5.700927334426610e-01   +4.326635559598488e-01   +3.869627447201692e-01   -1.711277494971032e-01   -2.951750642448247e-01   +4.253017762387856e-01   +1.679679348022552e-01   -2.515850378331011e-01   +4.653764972160099e-02   +2.871648133730232e-01   +1.578260906493490e-01];
L2I_L1I_iGABA_netcon = [+5.690189065822430e-01   -6.006342689890046e-02   +1.245246321747568e-01   -5.097917641028475e-01   -9.172167307646681e-02   +4.723768385368940e-01   +6.414318668752830e-01   +6.247198982996084e-01; +1.128295916393881e-01   -6.590427094358468e-02   +4.465859600672648e-02   +1.337126324862941e-01   +5.629410817770057e-01   +6.590313764057559e-01   +6.558481965152295e-01   +2.074310834150685e-01; +8.295848876312019e-01   -2.065286264634417e-01   +3.270230309419458e-01   +4.224464469790886e-02   +1.815049795741114e-01   +1.787754900870981e-02   +7.485248494539457e-01   -6.972002229412059e-03; +1.276286309817529e-02   +8.769763358477153e-01   +5.106710211583130e-01   +9.110867809011444e-02   +6.796381940945327e-01   +2.924499004804025e-01   -3.571187021241894e-01   +6.649487897108435e-01; +3.681149681895932e-01   +7.954295849325534e-01   +9.313927585492413e-02   -4.186060415261755e-01   +9.087481016516673e-01   +4.570937179444006e-01   -1.209030551584301e-01   +8.934329549106815e-01; +5.629963895306753e-01   +4.585199885753894e-01   -1.233107928787018e-01   +7.271314026773517e-01   +4.569583265383566e-01   -3.961538455587463e-01   -3.627218273546681e-01   +1.032588103168803e-02; +2.759423609447015e-01   -5.229013801950450e-02   +3.038671397234892e-02   +5.547758817955936e-01   +6.813088682237496e-02   +3.286474010049646e-01   -4.667225900923782e-03   +3.927974825880607e-01; +2.086259890153483e-01   +1.742974219009232e-01   +5.489049833133440e-01   +2.565893701700628e-02   +7.167340639343279e-01   +1.481215438572956e-01   +1.629076917244824e-01   +1.113266083825196e-01; +1.526853217001231e-01   -3.157454652371045e-01   +1.080618249104958e-01   +7.094632278647162e-01   +1.966546031212745e-01   +8.133650167564382e-01   +2.179763130027292e-01   -1.923964156922117e-01; +3.346907281408632e-02   +2.853693612031187e-01   +4.428808297483064e-01   -2.837765263224689e-01   +3.804797154967728e-01   +4.040118768395985e-01   +4.743830531580744e-02   +1.174784055958530e-01; +1.334454715982748e-01   +1.892270919879276e-01   +5.846552457712022e-02   +7.597667196396036e-01   +2.817280607982056e-01   +5.487865510517450e-01   -1.834414022604444e-01   +9.951733555276925e-01; +4.197948002079824e-01   +6.967708992635101e-01   +3.708236064753280e-01   +5.874219998886133e-01   +3.867247375353138e-02   -2.271113625962294e-01   +6.293702228548160e-01   -1.433280768915609e-01; +2.984484010490011e-01   +5.173678373124588e-02   +7.720877633964586e-01   +6.362884069162792e-01   +4.214149659474076e-01   -5.386033325994004e-02   +2.470755362243024e-01   +3.288928259494044e-02; +3.907777337318503e-01   +6.274959831046087e-01   +3.073753442978243e-01   +8.267706128173758e-01   +2.662861225454501e-01   +7.632694633180044e-01   +4.721534759233378e-01   +3.859516367886426e-01; +3.312179777264102e-02   +7.039987194368870e-01   +1.000000000000000e+00   +7.393189538386336e-01   +1.216257301932114e-01   +4.856176849683742e-01   -1.723650415137924e-02   +7.473334665810162e-01; +4.281896286395215e-01   +5.559879646524438e-02   +9.250146636328219e-01   +4.141291758480261e-01   +1.954409126839338e-01   +1.873788496461044e-01   +8.616573003778801e-01   +9.120621362541370e-01];
L1I_L2I_iGABA_netcon = [-1.948296638805743e-01   +5.845093182431966e-02   +1.428468345867934e-01   +6.520767182798384e-01   -1.904866632098418e-01   +4.248142366447162e-01   +5.220157126018836e-01   +2.231861998135864e-01   +6.333079959884564e-01   +4.857103065018636e-01   +1.610659865392510e-01   +3.251829507690961e-01   +6.604493780908079e-01   +2.770689418115984e-01   +2.110750251314453e-01   +7.946762132920159e-01; +8.247244928354956e-01   +4.083936203821131e-01   -1.713943840339200e-01   -4.527465272812603e-01   +3.010880428999161e-01   +9.735336303948116e-01   +1.983923857010758e-01   -2.105940698834040e-03   +6.592683256876585e-01   +8.476141455907203e-01   +1.600388361082640e-01   +5.821137592954200e-01   +2.102748859843575e-01   +1.782226835635949e-02   +4.877620200496064e-01   +2.006743796449328e-01; -9.036611265262626e-02   -2.476081224024778e-01   +3.229927906101414e-01   +1.207884719674852e-01   -5.567230638868089e-01   -4.047417330956437e-02   +1.305098962964096e-01   +6.070626237258474e-01   +2.115134772695405e-01   -8.535632846630557e-02   +1.341810093002179e-01   +1.985742671136610e-01   +7.794521689670875e-03   +3.980223263950657e-02   +1.464079874336856e-01   -8.704606677093885e-02; +1.492432400334259e-01   +1.558037312201444e-01   +2.721882558480991e-02   +1.299000853490346e-01   +1.433836217378430e-01   +4.564262615207652e-02   +3.008191213907474e-01   +5.365448222266258e-01   +1.303344073235968e-01   -5.681477704135288e-02   -9.882848486116405e-02   +9.101610719886118e-01   +9.491135581642196e-02   +5.109081546248282e-01   +5.554159819890205e-01   +1.914500905137313e-01; +6.552517360434545e-01   +6.180579072785164e-01   -1.240052911963916e-01   +3.823234385780540e-01   +3.085191385910264e-01   +1.838145464596637e-01   -4.692704247671746e-02   +2.479777971965360e-01   +5.262566287852805e-01   +3.524419590286865e-01   +5.201322185488108e-02   +3.663091814702508e-01   +5.693519334994749e-02   +2.864713486100615e-01   -6.123780674286098e-02   +2.946154050139413e-01; +7.200985014689759e-01   -7.821006230677910e-02   +4.138400566296103e-01   +5.434215776430816e-01   +2.837084965077329e-02   -5.566891451109877e-03   +4.069450492862650e-01   +5.317877111231695e-01   -3.423781155486924e-02   -2.521041658967269e-01   -1.796258124453528e-01   -1.727853026133351e-01   +7.754378848143986e-02   +1.000000000000000e+00   +2.325727969331605e-01   -7.170827989920346e-03; +4.914428668514902e-01   +3.890946309272577e-01   +1.410492897281150e-01   +7.074639649038819e-01   -2.404238057651215e-03   +2.388467645318968e-01   +6.632364737536048e-01   +4.737842372310245e-02   +5.458816034010051e-01   +4.630018791755269e-01   +4.488315142196284e-01   +9.444164531144070e-02   +7.027238202681347e-01   +2.712246932539356e-01   +4.384420252999653e-01   -2.907641097350119e-01; +4.786355642236666e-02   +1.626095068770542e-01   +7.864622108698765e-03   -3.689830102940450e-01   +5.858210340053368e-01   +4.352555014584411e-01   -1.749806228289029e-01   +3.486435504808107e-01   -1.298529661355615e-01   +1.249027510161442e-01   +1.621359797897986e-01   +9.438763833451906e-02   +1.991582551989231e-01   +7.590217148016707e-01   +2.792339191196737e-01   +2.491929193411004e-01];
L2E_L1E_iAMPA_netcon = [+3.121804247402637e-01   -3.257135443367835e-01   -2.921230295418203e-02   +1.838575963589237e-01   +3.378718850767248e-01   +1.012563523060201e-01   +6.173653522299865e-01   +1.408304315092525e-01; +5.414934121014232e-01   -1.490469432324016e-03   +6.410934441845972e-01   -2.801077813090465e-01   +3.893230087503298e-01   +7.152956840166858e-01   +7.483312143438730e-01   +5.058122408885496e-02; +4.100561732216199e-01   +2.723798813880052e-01   +2.773802671940335e-01   +5.667717021562630e-01   +1.908478195117357e-01   +2.103821081364551e-02   +4.231006815573140e-01   +1.793136265267104e-01; +2.437152169418764e-01   +1.000000000000000e+00   +6.854330032123632e-01   +4.438510706360480e-02   +2.521541013470893e-01   +4.557918567952983e-01   +3.394673638409646e-01   -3.008437960659277e-01; +5.487961154267913e-01   +2.355774165409871e-01   -5.244474599169285e-02   +3.781921582621928e-02   +2.742357317126488e-01   +5.139492245715234e-01   +3.724463985760328e-01   +3.566649207148555e-01; +3.422936030033815e-01   +4.374098918380699e-01   +5.472747717439245e-01   +7.845263843072784e-01   -3.441844220424777e-01   +5.949059633026799e-01   -1.202082660311410e-01   +1.593214666438542e-01; +1.610139204481291e-01   +4.881050876613995e-01   -2.372021424876967e-01   +5.300002101706849e-01   +5.425610431259777e-01   +3.052815217995611e-01   +2.859875699611695e-01   -1.957374408689770e-02; +2.479498272734216e-01   +1.384015788314150e-01   +6.699387253610233e-01   +4.224847871452440e-01   -1.372105609756615e-01   +1.032739925149373e-01   -4.052808020569650e-01   +2.135746479159723e-01; +7.386119762585814e-01   +2.418538884797299e-01   +9.053490413852411e-01   +3.652182050935182e-01   +2.116691167841152e-01   +4.141111506722654e-01   -9.060033651819711e-02   -2.492905494208578e-01; -4.418387523293730e-01   +2.084108064812635e-01   +4.903090546502114e-02   +1.094300754073605e-01   +2.126330174961216e-01   +8.513955646203966e-02   +2.140763538261074e-01   +3.843061097956779e-01; -4.922031780202714e-02   +8.216727615413649e-02   +4.157065286329326e-01   +4.739531236023372e-01   +4.954913837431518e-01   +6.488590544482165e-01   +1.857340037312033e-01   +2.361184216025722e-01; +6.760962405210623e-01   +3.926811403457093e-01   -3.477158029592405e-01   +7.011692052473761e-02   +4.178993006119168e-01   +2.742902368556623e-01   +3.478239682518252e-02   -1.777387614935595e-01; +5.764697666508081e-01   +5.781407212691994e-01   +3.655649963404335e-01   -2.754304045848709e-01   +4.582662231705869e-01   +1.380121681251444e-01   +3.319346860849367e-01   +3.571121124399897e-01; +1.710982014467577e-01   +7.347057657385272e-02   +2.623620586057803e-01   +2.744292972323385e-01   +8.107457726559042e-01   +6.060139007758650e-01   +1.553538258759500e-01   +4.573754936583427e-01; +5.733742281411520e-02   +7.239534359155991e-01   +1.179880880956580e-01   +2.377333722557326e-01   +2.695813629350013e-01   +5.946686083173844e-01   -3.425065360578299e-02   +3.725667454642205e-01; +4.563058220345199e-02   +3.825287439436313e-01   +6.812145886732378e-01   +1.229581891361482e-02   +3.926028494410362e-01   +3.067647375503709e-01   +2.169319641198307e-01   -3.279064887202497e-02];
L1E_L2E_iAMPA_netcon = [-2.722305928553113e-01   +5.270327605422800e-01   -1.519298507966531e-01   +4.041088718004314e-01   +1.008003497726100e-01   +2.233303615490876e-01   +4.101887315662938e-01   +2.802884685824904e-01   +1.229981799692804e-01   +4.865659246473608e-01   +2.929163125235437e-01   +3.461569392775108e-03   -4.193063154282593e-02   +2.156096847811487e-02   +5.804724911429062e-01   +3.929442488977368e-01; +6.240821836578310e-01   +9.008790942353441e-01   +4.516153149763811e-01   +2.696193173687673e-01   +2.579082024383986e-01   +7.405288414870640e-01   +9.230314915318606e-02   +1.568413061014261e-01   +7.255778759506587e-01   -6.961619217266871e-02   -3.925402732709065e-02   +1.864417229102406e-01   +5.577686353793679e-01   +4.828802762282856e-01   +9.501123670826163e-01   -3.344441119074680e-01; +1.247619603637403e-02   +7.769612895610450e-01   +6.615413989249235e-01   -4.917530443876898e-02   +8.989921836624908e-01   +3.549953858547962e-01   +4.313022654134115e-01   +4.547698848616434e-01   +3.074937656985939e-01   +5.529669732263028e-01   +2.709191262102100e-01   +2.400277423123709e-01   +5.830681711165715e-01   +9.060179136594793e-01   -1.766950777853039e-01   +7.750541033486037e-01; +5.929842818626794e-01   +5.123425958835474e-01   -5.511267003909331e-03   +3.658502639767772e-01   +6.002046068405186e-01   +8.886181623123892e-01   +7.608459315936122e-01   +5.061027057932950e-01   -7.334608891269027e-02   -5.057295263562236e-01   +3.485637842328745e-02   +5.238911915830043e-01   +2.366189594241499e-01   -4.636527734524351e-02   +3.853381111846572e-01   +3.162931222728296e-01; +4.530336197913338e-01   +6.374458145077085e-01   +5.767816756444198e-01   +2.917272953187117e-01   +8.003906912071217e-01   +1.705877302298717e-01   -3.259151835722617e-01   -6.147732273563152e-02   +2.398101465695082e-01   -4.305111791076567e-01   -2.542143958476663e-01   +8.839466677588516e-02   +1.708188347671354e-01   +6.762722991009071e-01   +4.228843912251390e-01   +5.282493800567286e-01; +3.467346650375761e-01   +7.675459648442853e-02   +2.021094100837532e-01   +4.384779201749099e-01   +1.056822330383722e-01   +7.236899265096614e-01   +3.369735695299985e-01   +2.808970149828944e-01   +2.176004997663268e-01   -5.845671314134845e-03   +6.053397969242738e-01   +1.393949473466495e-01   +6.891608791174103e-01   +6.487918912211916e-01   +2.060054573489966e-01   +4.008222324789594e-01; -1.421140932553981e-02   -1.002251863270307e-01   -1.358716161623914e-01   +4.786773067388655e-01   +1.686950690459372e-01   +1.527668111396407e-01   -1.872399344373865e-02   +7.101818743360678e-01   -2.244176348099411e-01   -1.411660612590142e-01   +2.271586165215450e-01   +2.133006806124168e-01   +1.696535401608450e-01   +1.763039927057959e-01   +2.676022117666925e-01   +5.355511361044495e-01; +4.131615631542725e-01   +5.498448694620963e-01   +8.463622619942953e-01   +3.517119168574259e-02   +4.932366596109892e-02   -1.012156634410002e-01   -3.501561162024329e-01   -3.663860932435057e-01   +1.562481543803479e-01   +1.214807212967959e-01   +4.820288410631018e-01   +9.836423002025774e-01   +1.000000000000000e+00   -3.118355022374768e-02   +3.152361915337005e-01   +8.097083137737355e-01];
L2I_L2E_iAMPA_netcon = [+2.500156103429537e-02   +4.894603844248736e-01   +2.024184031953313e-01   +5.209727124537892e-01   -2.099207851810750e-01   +5.503272372005311e-01   +1.943291216997726e-01   +2.960354060601892e-01; +5.561266992958115e-01   +2.693123787469339e-01   -3.672132615107375e-01   +5.698840128851262e-01   +5.204970695185952e-01   +5.252635557520302e-01   +1.000000000000000e+00   +2.745288125220058e-01; +3.012351401359358e-01   +1.341219469436708e-01   +7.405989911733969e-01   -2.356617121662320e-01   -3.873738080965478e-01   +3.411299960956720e-01   +2.858793765789192e-01   +6.458311540544593e-01; +2.338006959057908e-01   -7.989882488552733e-02   +2.487602210726657e-01   +6.612309863867446e-01   +6.749020274563063e-01   +4.234668867681619e-02   +7.032936838888901e-01   -2.315503736162369e-01; +6.159234549305185e-01   +1.399460904918853e-01   +6.721687695017895e-01   +4.026234507067777e-01   +2.815881153690630e-01   +4.770131198053761e-01   +4.478146210544711e-01   +4.381766853024578e-01; +7.126830518532246e-01   +6.463697310984582e-01   +4.290957170510118e-01   -4.993827464830646e-02   +2.970799648845430e-01   -2.472351331384149e-01   +4.508384356403534e-01   +1.906351030988730e-01; +3.395838962592195e-01   +1.670164311024519e-01   -1.798842762115814e-01   +4.057419900513427e-02   +7.095107901712230e-01   +2.962160042574943e-01   -5.754125240116426e-02   +6.752204557002445e-02; +3.502734043945130e-01   -2.548634873083082e-01   +4.381242810258250e-01   +6.084829768647462e-01   +5.618410431646328e-01   +1.041878093959731e-01   +8.526841670166943e-03   +4.825496368886614e-01];
L2E_L2I_iGABA_netcon = [+6.569569273515168e-02   +1.289643698898343e-01   +8.156233385280890e-01   +1.967589589812571e-01   +3.062541405291121e-01   -3.535074954787578e-01   +5.637124197638606e-01   +6.368368633881407e-01; +1.296945187351000e-01   +3.528454588949563e-03   -9.582076659772368e-02   +2.693355786394845e-01   +7.028449883456335e-01   +2.671492507105473e-01   -3.725746389401350e-02   +2.461221990871940e-01; +4.229630028945340e-01   +6.912132716946889e-01   +5.740737369333512e-02   +2.299569926861058e-01   +9.962008059725601e-02   +9.801600859122754e-02   +8.704305814746566e-02   -1.215608528019169e-02; -3.649144730003278e-01   +9.754901777620663e-02   -4.705002207538348e-02   +4.922998348275642e-01   +1.121147731593165e-01   +1.204427330907631e-01   +5.492279816400617e-01   +1.978834862297295e-01; +6.145039716287798e-01   +6.099200434770867e-01   +3.044148769223653e-01   +5.612117898633523e-01   -2.632923808546505e-01   -1.005400145290356e-01   +1.580434257562791e-01   +4.971469276113041e-01; +3.781108618764296e-01   +2.573407271328781e-01   +1.131093560081560e-02   -3.652776797282209e-01   +7.383391029373477e-01   +3.543882920224042e-02   -6.006511814807646e-02   -3.021900831176548e-02; -8.431173758677440e-02   +2.962109816596702e-01   +2.658664063096982e-01   +6.696639461368098e-01   -2.057006548445448e-01   +1.000000000000000e+00   +3.659649497526893e-01   +5.706815787537743e-01; -1.032045425496436e-01   +1.851977806522480e-01   +5.071868400595090e-01   +1.058953385158146e-01   +4.601086914315485e-01   +2.340311525859436e-01   -1.900453326341944e-02   -2.178794515560971e-01];
L3E_L2E_iAMPA_netcon = [+1.993969452981393e-01   +3.355845391344300e-01   +3.735069078577112e-01   -5.711005999650332e-02   +6.284901121876004e-01   -1.133831329948865e-01   +6.754307761094875e-01   +5.727522508510480e-01   +2.753185472350263e-01   +5.289781160608750e-01   -1.198498918528247e-02   -2.484017944956040e-01; -7.054117331941664e-04   +2.832567133780928e-01   +4.535325666348739e-01   -6.293134451997796e-02   -1.611928521505996e-01   +3.548909478393978e-01   +2.633041255295211e-01   +4.137310261092608e-01   +7.332076759427292e-02   +3.621695543977313e-02   +5.612705362467022e-01   +3.196509145885181e-01; +5.069742091441108e-01   +2.482908581956088e-01   +1.353804044907659e-01   +6.729990225882847e-01   -4.223047435866740e-02   +5.721441044398515e-01   +7.332615933449426e-01   +1.000000000000000e+00   +3.944202688264520e-01   +2.248795059390462e-01   -1.996669597084249e-01   +3.678981083587702e-01; +2.418324100345607e-01   +2.822641637882028e-01   +5.832801915688085e-01   -4.903283731328952e-02   +5.967015779435966e-01   +8.286714034426633e-01   +2.660550271431056e-01   +1.625904073013374e-01   +2.959248787377218e-01   +3.755309761321917e-01   +4.837395314394510e-02   +2.315161765941703e-01; +5.106216653232095e-01   +6.620318867914379e-01   +8.477562507859804e-02   +6.020182637626278e-02   +3.192302265706961e-01   +2.967756560143720e-01   +1.623685020800016e-01   +5.306383059118713e-01   -2.192383087915712e-01   +3.707217393166622e-01   +8.578200186620023e-02   +4.199839876261159e-01; +1.547138508893571e-01   +2.830828359455217e-01   +1.019515817916231e-01   +4.398920826477763e-01   -9.267390181787766e-02   -2.622840632082752e-01   +5.133401468513634e-01   +7.247078249823063e-01   +2.847048297795732e-01   +6.367286848005423e-01   +3.553730010369739e-01   +2.126320435661698e-01; -2.096798822461794e-01   +1.885229571529621e-01   +2.086952252860263e-01   +2.913013304410029e-01   +2.950046000626635e-01   -1.024144902966471e-01   +4.148767827300470e-01   +2.727362010951058e-01   +2.957247997538770e-01   +5.837571121207004e-01   -1.427841738565327e-01   +4.792619750177771e-01; +3.761695093268941e-01   +2.222310501482585e-01   +6.127352868477364e-01   +1.207408698815490e-01   +2.125638385190977e-01   +6.852302432563404e-01   +3.578501372096972e-01   +1.266908688278288e-01   +7.793119407786914e-01   -2.875499550853289e-01   +5.034253060063748e-01   -2.868663899700562e-01];
L3I_L2I_iGABA_netcon = [+4.080471259063156e-01   +5.907631872983913e-01   +4.074471544966272e-01   +8.763211688169475e-01   -4.286485346257763e-02   +1.253366829715992e-01   +2.846821407202458e-01   -5.764015323984346e-01   +2.066115655167494e-01   +2.628750464466626e-01   +3.896320641993843e-01   +9.534701868179867e-01; +5.551845739533946e-01   +2.457476654813459e-01   +1.513574180314600e-01   +7.790069167987013e-01   +2.379319227778623e-01   +4.213355064204746e-01   +4.757955056730196e-01   -2.714112083252622e-02   +3.839475449121559e-01   -3.128831716455320e-01   +3.379156139289508e-01   +1.030834949383718e-01; -7.486726022545337e-02   +3.176217038524294e-01   +5.508776842686113e-01   -6.440246465153772e-02   +6.573244981369604e-01   +3.690065379769672e-02   +2.752417023623487e-01   +5.688381984973411e-01   +4.461050826429516e-01   +5.485253789807120e-01   +2.607608563980310e-01   +8.760604270374577e-01; +7.059609472879440e-01   +8.508937813005791e-01   +7.437587310633929e-04   +6.662942329147499e-01   +2.571096339186961e-01   +2.622961831405237e-01   +4.009741394501299e-01   +1.112289258197858e-01   +2.558228851722585e-01   +3.199504617030079e-01   +2.052922112534991e-01   +1.131800054206442e-01; +1.089055860605951e-01   +5.757959838755092e-01   +5.187566445199306e-01   +3.178483504485715e-01   +5.067068811264350e-01   +2.144024728535486e-01   +3.209959956601453e-01   +2.891332085576217e-01   +7.065057115353824e-01   +1.823393386933102e-01   +1.508272418733404e-01   +6.013064746443926e-01; +2.885787898285769e-01   -3.492878883263482e-02   +6.754324944053693e-02   +6.416817592585617e-01   +5.622614832467423e-01   +4.984881780366979e-01   +4.228663300919752e-01   +6.156247203485777e-01   +1.695339643416569e-01   +5.693947339642461e-01   +2.402778185680500e-01   +6.984073219910124e-02; +6.757010853148435e-01   +7.076373342705284e-01   +2.417727656907750e-01   +3.190363428647472e-01   +1.000000000000000e+00   +1.348873382972170e-01   -4.423112152891434e-01   +5.476098733071375e-01   -2.537399681411320e-02   +5.538334722048184e-01   +2.923817791717199e-01   +8.923429861387675e-01; -5.651482030924500e-02   +6.435037459699982e-01   +1.028502217022679e-01   +3.564144441932671e-01   +4.006755609044776e-01   +3.737808274918987e-01   +2.954154202854267e-01   -3.036862564624520e-01   +1.771439514820999e-01   +2.388980839843915e-01   +1.367447320713361e-01   +6.914330150646671e-01];
L2E_L3E_iAMPA_netcon = [+2.999047501424817e-01   +5.936329258677369e-01   +1.031104932018717e-02   +1.829873679632301e-01   +8.875467077536379e-01   +1.075643906517844e-01   +3.018741894680801e-01   -1.353189936252167e-01; +3.914215047523789e-02   +5.685785499898224e-01   +6.049763636326649e-01   +2.504597337082063e-01   +2.168516919759522e-01   +2.602172765725768e-01   +5.002556026495346e-01   -4.895802405987534e-01; +5.227057916803231e-02   -1.932279176014911e-01   +1.397765011824874e-01   +9.567693523775442e-01   +1.000000000000000e+00   -6.859935229473495e-02   +5.618366350310074e-01   +4.378108974013468e-01; +4.188857676852702e-01   +8.491067465520873e-01   +5.488719667609285e-01   +3.888212803835781e-02   +7.388089239214467e-02   +4.533411980080903e-01   -1.393562647883796e-01   +6.648683366780574e-01; +5.688412055659123e-01   +4.468573284201238e-01   +4.338223661610534e-01   +1.689863745771103e-01   +9.604675526188927e-01   +6.524528476744007e-01   +4.750022544486844e-01   +5.487223942145243e-01; -2.845956268859788e-01   -6.184873127535642e-02   +2.862625580146496e-01   +9.568912914359772e-01   -4.040833932228455e-01   +1.716508614794324e-01   +6.974838859420814e-01   +7.751542058551190e-01; +1.975673928894281e-01   +2.494824818327692e-01   +1.136188868118136e-01   +8.673277223067016e-01   +3.547810633865474e-01   +8.004509181301631e-02   +5.078136415398973e-01   -6.497968566659706e-02; -2.989977849925858e-01   +1.994683177484014e-01   +3.204013937644340e-01   +4.960553941541881e-01   -4.492716747562833e-02   +4.391707622727495e-01   +5.603615530264137e-01   +4.802294514288149e-02; +3.029281245582282e-01   +4.758701772860240e-01   +1.406181614147949e-01   +2.608044288923178e-01   +6.573430972300938e-02   +2.423610698087329e-01   +4.779482628262697e-01   +3.517750942838373e-01; +7.148213970898191e-01   +1.277787296301423e-01   +6.105845836978219e-01   -5.714751220626061e-01   +4.294850670381416e-01   +1.431658701924006e-01   +4.653270979693606e-01   +4.973600731355373e-01; +1.782018329003336e-02   +1.700401761558384e-01   -2.070150949467207e-01   +2.147789075473793e-01   -3.170782232785646e-01   +3.854225708210746e-01   +5.301383354516284e-01   +8.263320364590462e-01; +4.497788559449249e-01   +8.856892489911788e-02   -4.815807849555167e-02   +1.276937949865162e-01   +1.463803765540930e-02   +6.726928404306035e-01   +3.681600829852138e-01   +9.268809310526023e-02];
L2I_L3I_iGABA_netcon = [+2.706850776116180e-01   -3.057822320417990e-01   +4.009853262760820e-01   +5.071166866216194e-01   -4.994969413763804e-02   +1.863938477052715e-01   +4.006953972805386e-01   +2.293670849301522e-01; +5.038533564319960e-01   +3.317892064084128e-01   +4.690543376128239e-01   +3.785427899683708e-01   +4.148375863866476e-01   +1.052452569404870e-01   +3.461416225688887e-01   +6.578764448845251e-01; +2.542259901043457e-01   +1.151380095332358e-01   +9.084085801553213e-01   +2.446249306026399e-01   +7.377669931622026e-02   +6.587332110457743e-01   +1.036317612556742e-01   +1.663816864494314e-01; +1.284291071208274e-01   +7.465023459045215e-01   -1.659425615699639e-01   +5.419333690888248e-01   +2.442605209153170e-01   +2.725321233861934e-01   +6.507018047348727e-01   +5.449176004640182e-01; -3.558089461983788e-01   -2.225373384571047e-01   +6.884588971468362e-01   +3.911238597017387e-01   +7.950553957791183e-01   +4.973221809473611e-01   +7.318660622237689e-01   +6.607910738356249e-01; +1.000000000000000e+00   +4.262890848657124e-01   +3.097487455845277e-01   +8.567462918826055e-01   +3.241021343493897e-01   +1.777050963232940e-01   +2.906239047955781e-01   -5.691429013800452e-02; +7.102337047210595e-01   +4.013946033016255e-01   -1.785997495773778e-01   +5.828486015117653e-01   +3.533087317662070e-01   +4.590541864253224e-01   +6.531354066326067e-01   -3.096453579721710e-02; +6.711211648409000e-01   +6.143872648392191e-01   -1.419246794516310e-01   -5.174290765401664e-02   +1.754138284354574e-01   -1.481104560199857e-01   +7.770614847890891e-01   +4.720697233917999e-01; +7.191681090728728e-01   +3.661546115816112e-01   -2.678642748629335e-01   +3.382824117133881e-01   +4.102649511214611e-01   +6.573289488875140e-01   +1.700259310291132e-01   +2.648877480578178e-01; +3.184943604102784e-02   +3.274354668588170e-01   -6.092541379820413e-02   +1.120001770661040e-01   +8.892970283707523e-02   +2.726833801438153e-01   +3.551380373061208e-01   +8.166998477523632e-01; +4.656171064520014e-01   +6.688345002778247e-01   +2.596861457548201e-01   +6.840007520755453e-01   +4.389902723531861e-02   +6.490202375016395e-01   -2.325822425363634e-01   +4.712619263091166e-01; +1.424996442519723e-01   -8.512814721680516e-02   +4.058897956544638e-01   +3.805394142445315e-01   -2.397586076771664e-03   +8.687926088104732e-02   +7.908300864922316e-01   +6.353758701615837e-01];
L3I_L3E_iAMPA_netcon = [+2.948194130007823e-01   +2.478796609616191e-01   +1.347908695948836e-01   +2.300106604390323e-01   -1.549676033578648e-01   +4.708435599644998e-01   -5.635856740033106e-02   -2.206451062542787e-01   +5.274285002453849e-01   +1.375500256824666e-01   -5.382420093066889e-02   +4.177307622313431e-01; +7.336960040264923e-01   +3.340836421045793e-01   -5.220577316332607e-01   +7.887256198076231e-01   +4.151074810583661e-01   +3.995212590154801e-01   +5.768866001675819e-01   -8.944719954463799e-02   +3.277783728617942e-01   +7.850400757159556e-02   +5.663143058587927e-01   +1.633875228691931e-01; +3.938938562470927e-01   -1.068343762973332e-01   +5.936800461269265e-01   +3.826131591121633e-01   +8.948148012064179e-02   +5.694552412222859e-01   -3.363149537358734e-01   +5.264253048356362e-02   +3.670277151722303e-01   +2.945118458483852e-01   -5.565536256604795e-02   +4.586603575335777e-02; +3.757235369653170e-02   +4.033390447924698e-01   +3.883912068095154e-01   +4.748953146059655e-01   +7.869281680705346e-01   -4.638320855922158e-01   +7.508957947502432e-02   +2.894179654731179e-02   +1.231241367461568e-01   +3.380228946671409e-01   +5.371872489849342e-01   +1.000000000000000e+00; -6.410045664933621e-02   +5.776192513635443e-01   +3.025775413849635e-01   +5.533215369029352e-01   +5.073766257446375e-01   +3.678585178636962e-01   -1.154885101596328e-01   +8.936217515002290e-02   +8.074504290709221e-02   -1.131527882485868e-01   +6.413271229475114e-01   +4.515040470058798e-01; +6.844090992932449e-01   -6.510120909853109e-02   -1.158496124171066e-02   +4.046390336294691e-01   +3.482225622574631e-01   +5.775291988932529e-01   +3.396876967609445e-02   +4.766149214452166e-02   +3.241220405211846e-01   +3.412782056460359e-01   +2.760736666809437e-01   +6.856176449234702e-02; +2.382546675363267e-01   +7.385805945394454e-01   +9.512056028299125e-02   +1.231648218065867e-01   +2.393664805244797e-01   +1.772129992565337e-01   -5.407861934424082e-02   +4.539024281613693e-01   -1.033770297758475e-02   -7.370366373570235e-02   +2.648654789888890e-01   +3.889318278865778e-01; +1.273602191215546e-01   +3.632290527087226e-01   +5.066421646549356e-01   +1.010795825317201e-01   +5.744146502287480e-01   +6.413466851377204e-01   +3.978360970621892e-01   +1.369212298061770e-01   +1.468219374735687e-01   -2.767758890221409e-02   +2.947584771033226e-01   +1.506965267425861e-01; -3.718023744524458e-01   +4.320125578276644e-01   -9.633460231900680e-02   +5.849762550515359e-01   -3.037069762879098e-01   +3.329670073063223e-01   +1.542278079678847e-01   +8.031272233120744e-01   +4.510027267927054e-01   +5.615126313617591e-01   +1.257718287418965e-01   +5.981330830500353e-02; -5.835551692811167e-02   +3.834433494769794e-01   +2.889921458195788e-01   +8.398699473998289e-01   +3.979985333106969e-01   +5.518194342953283e-01   -1.395667189449809e-02   -6.799860732580655e-02   +7.105132024851973e-01   +7.012811228833717e-01   +3.754884096683017e-02   +6.780367226076225e-01; +3.442561105058842e-01   +7.992205076182586e-01   -1.155545136109584e-01   +2.089400872060806e-01   +6.065114921130003e-01   +3.753442298758100e-01   +9.523495943567594e-01   -2.306578248344414e-01   -1.478172358242068e-01   +1.771933528307482e-01   -2.355566091132181e-01   -7.533583964428984e-03; +5.415427852519380e-01   +4.201769103948712e-01   -5.731781223356373e-02   +4.964859579514758e-01   -8.920196257312768e-02   +3.557576143902668e-01   +7.520548442386686e-02   +4.022698015263341e-01   +4.699091635106806e-01   +1.096053696838638e-01   +2.393624319361828e-01   +3.630582681388241e-01];
L3E_L3I_iGABA_netcon = [+3.711819069083055e-01   +5.136907283329172e-02   +1.214519913416857e-01   +1.834293143406557e-01   +4.100279095409372e-01   -1.611850736402924e-01   +6.883578186269125e-01   +2.801980449423109e-01   +4.998716359869455e-01   +1.000000000000000e+00   +9.126880911192610e-01   +4.613353220875467e-01; +8.955434891801294e-03   -9.029488222522603e-02   +2.188168777694598e-01   +6.132125297683052e-01   +3.586761266546479e-01   -4.054084432165520e-02   +5.167846086148541e-02   +1.420180529831929e-02   +4.864196543317953e-03   +1.135259738138691e-01   +8.033709208078826e-01   +2.057281314293430e-01; +5.370547000507334e-01   +1.585625249527681e-01   +4.139296065639674e-01   +7.557235897342329e-01   -1.782647316692074e-01   +1.711624743328256e-01   +6.258590685028136e-02   +2.821554675967613e-01   -2.906225374654633e-01   -3.404346113554282e-02   -1.660594356121267e-02   +2.385658571909042e-01; +5.261462823200356e-01   +1.562995172496153e-01   +2.581204981643646e-01   +2.912796569650137e-01   +2.369317456817327e-01   -1.003913631235705e-01   +8.982644235166029e-02   +7.701195763658072e-01   +7.814389521549900e-01   +3.420301056688759e-01   +1.037578848008801e-01   -4.126864760311971e-02; +8.949334186119323e-02   +1.540012776483348e-01   +1.203400704294535e-01   +7.373078178920757e-01   +4.116916432575651e-01   +8.014940662292613e-03   +6.612763332925866e-01   -4.094766963258726e-02   +2.170653788893306e-01   +4.646671389989240e-01   +7.378471752077501e-01   +1.958020304597534e-01; +5.233141366403654e-01   +2.986699697661717e-03   -7.412920540663401e-02   +6.740567987092337e-01   -1.290690879945312e-01   +6.100634784257093e-01   +1.284596734211825e-01   +1.473964637035104e-01   +5.628157398235984e-01   +2.944715676466974e-02   +2.468467715337228e-01   +6.092147133577455e-01; +3.381775454786759e-01   -3.589774540405913e-02   +1.089542561553351e-01   +1.326855195633072e-01   +6.801096791726398e-02   -2.481452330257674e-01   -1.792572073132022e-02   +1.227637450165974e-01   -2.163907597710072e-02   +5.947265250553542e-01   -2.557832832509662e-01   +1.160539835885838e-01; +2.778928276169675e-01   -3.341693188335961e-02   +7.224138084828678e-02   +8.162311565524916e-02   +5.889538379107697e-01   +2.003441661209357e-01   -2.316154081617694e-02   +5.342635365674903e-01   +4.598596838455252e-01   +1.152334962205668e-01   +5.796650905885851e-01   +4.861997460925405e-02; +1.968234406678225e-01   +4.724921626606084e-01   +2.733665128651195e-01   +1.501222433474345e-01   +3.017585599924560e-01   +1.893395086194869e-01   +8.467380464764578e-02   +1.319210116517794e-01   +6.450467506306001e-01   -8.049185787196318e-02   +3.473464479570230e-01   +5.615379947033440e-01; +1.713441326308545e-01   +5.412292873923172e-01   +1.976993055865342e-01   +5.244877758873481e-01   +3.036360510790118e-01   +2.831799008104314e-01   +2.925639167873295e-01   -2.768837765935557e-01   -1.442857504401109e-01   +4.388675977879007e-01   +3.698936752529012e-02   +3.328632497247269e-03; +1.130604520550057e-01   +4.029267267384701e-01   +6.610558803908677e-01   +8.528867737867328e-01   +2.132646080446522e-01   -3.827681590931797e-02   -2.984397966359357e-02   -4.282799276195740e-03   +4.647096612445208e-01   +3.269760209984317e-01   +8.708644931218663e-01   +3.999341378325064e-01; +3.747878620626942e-01   +1.920772561745141e-01   -9.080072702575445e-02   +3.019849201543203e-01   +1.269340749703216e-01   +1.727279743815246e-01   +2.275654258232239e-01   +5.050702568310828e-01   +2.034575887541741e-01   -2.373093104010664e-01   -7.338928320103601e-02   +9.301824925013068e-01];
L2E_Input1_iAMPA_netcon = [+1.979974251099379e-01   +5.759405308534513e-01   +6.215187362753555e-01   +3.558081074515054e-01   +4.012530941028463e-01   +1.000000000000000e+00   +4.846175450582152e-01   +7.329772843590915e-02];
L2I_Input2_iAMPA_netcon = [+5.833346075234339e-01   +1.000000000000000e+00   +5.087945193278676e-01   +3.789335716587977e-01   +2.636215067114964e-01   +6.787468495634907e-01   +4.094964491225334e-01   +7.392083352032613e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last =  11.21 * ones(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.2*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))*0.4 + 0.2*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.5*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.5*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))*0.9 + 0.5*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.2*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))*0.4 + 0.2*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.5*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))*0.9 + 0.5*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.5*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))*0.9 + 0.5*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 20*((exp(-10*((t)-( 200))^2)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = - 20*((exp(-10*((t)-( 200))^2)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
