function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+6.762484390226885e-01   +1.758926028615262e-01   -9.770355335642547e-02   -5.132453499469347e-02   +3.691792369768027e-01   +3.388849127007836e-01   +3.592979338389342e-01   -2.451210242092495e-01   -2.636828841451411e-02   -4.117076013822376e-01   -1.168108438442963e-01   +8.785495142592498e-02   +1.201162751017840e-01   +7.809062154254816e-02   +3.867448268120479e-01   -6.337621191622591e-01; +1.904928207731856e-01   +3.493383626979338e-01   -3.202468145518494e-01   +3.804358938858417e-02   +5.925748387185710e-01   +2.529280912683891e-01   +6.524346476266006e-01   +6.651213277014139e-01   -1.127231481155448e-01   -6.140975968521185e-01   +2.914711434681698e-01   +1.640850708339393e-01   -2.574151793656729e-01   +5.368129400338005e-02   -1.063153878473931e-01   +2.195760412010633e-02; +1.789296095145890e-01   +2.204860497731709e-02   +3.051436845360579e-01   -2.267408285302392e-01   -4.748398792354956e-01   +1.431696777058707e-01   -1.227678338169194e-01   -4.062504447192251e-01   -3.489701148708029e-01   +2.793384337444652e-02   +3.186409526865293e-02   -1.345828003773647e-01   +7.300507067346521e-01   +4.034207658303555e-01   -8.399230308973693e-02   -3.589253993325536e-01; -2.750363276242130e-01   -3.603563486663427e-01   +2.085787039928277e-01   +2.870546821096395e-01   +6.639804066042840e-01   +1.558581238649217e-01   +1.925689928284888e-01   -9.451383928125905e-02   -8.936966771494718e-02   -5.542886734633379e-02   -1.334236232360700e-01   +2.947413742158768e-02   -8.501089008051643e-02   -4.732843296994054e-01   +8.965660577942750e-02   +1.025667947349987e-01; -2.300029126384202e-01   +2.514893893853819e-01   -1.248326641799809e-02   -1.073391311236478e-01   +5.631937467408822e-01   +1.189142015195644e-02   -1.377183841066046e-02   +1.594231879297999e-01   +1.726156515327529e-01   -1.133605247434243e-01   -2.613426596639720e-01   +6.082204357985599e-01   +2.654500175264633e-01   +3.305120968439020e-01   +2.475665943130008e-01   +5.418810355941194e-01; +1.327114234703397e-01   +3.997888420485726e-01   -1.076086689466365e-01   +3.532371658223477e-01   -1.819315076829947e-01   +2.179397515343621e-02   -3.045146846985557e-01   -5.003553479836221e-01   -4.486435917585199e-03   +3.219416043501465e-01   -2.417907647441958e-01   +1.611917328664094e-01   +1.385837036912813e-01   +2.741107518666960e-01   +4.433987533439234e-01   -3.148695390559367e-01; -1.033259689210661e-02   +2.410919155085159e-01   +5.308088681380201e-01   -3.816585634809016e-01   +2.714221947179901e-01   -7.864415367492692e-03   +2.253691194178540e-02   -4.250669932642850e-01   +5.030512424661884e-01   -3.606213620584400e-02   -4.343754622106512e-01   -9.900503956167592e-02   -3.850030905255659e-02   +4.804452456399519e-01   -7.926079721157567e-02   -6.880939378254207e-02; +3.580703268812893e-03   +2.969443316882207e-01   -3.322331183015054e-02   -1.980093025051815e-01   -1.754955152510657e-01   -2.008861888303045e-01   +3.289763838266910e-01   -2.737300230813811e-01   -3.588479651941104e-01   -1.442288721119934e-01   +2.855674433073684e-02   -5.517949102396602e-01   -9.170692678434594e-02   -2.883044667914578e-01   -3.180769431957813e-01   +3.117110713609048e-01; -4.634322095108206e-02   +4.204611909343108e-01   +1.906271392361995e-02   -4.519086791978617e-01   +3.515271077713915e-01   -1.324168868057267e-01   -1.229267042690762e-01   +4.230329599947591e-01   -2.453015695466050e-01   +1.961183954284565e-01   +2.342987851505590e-01   -1.147652978390209e-01   -3.627464171324499e-01   -3.275327615671954e-01   +4.466699531587746e-01   +7.066104014357592e-01; -1.294551922959144e-01   -1.015912770869496e-01   -2.453899307056155e-01   -1.506683066926695e-01   +5.852766284515146e-01   -1.678965300974366e-01   -2.263437541663982e-01   -5.356673833912194e-01   +1.205900452634594e-01   +1.904395068408041e-01   -3.689801541339178e-01   -8.468274508773040e-02   +1.680314096875429e-01   -1.476136280647065e-01   +4.079917057439584e-01   +4.479716203576943e-01; +7.132682078122919e-02   +8.355985941344407e-02   -4.257039222091694e-01   +7.252072378566519e-02   +4.484889804349859e-01   +3.346865667139473e-03   +6.580409942545469e-02   +2.955688137027930e-01   +2.001660147862417e-01   -3.335871086647027e-03   +1.329734772670697e-01   -3.076620523936398e-01   -3.374187131526252e-01   -3.176539655396784e-01   -1.490471114464451e-01   -5.043743218498969e-01; +4.135896028262658e-01   +6.774486521903518e-01   -1.068191219200683e-01   -3.440861720342989e-01   -2.581231958936106e-01   +1.239919418095812e-01   +2.562622290038727e-01   -2.097848867090673e-01   +3.901747618420160e-01   -2.101293971492793e-01   -3.975134631765589e-01   -2.424797143592239e-01   -4.173070453553990e-01   -8.618975424846766e-02   +9.761344461406529e-03   -3.364126076640169e-01; -3.177601463576668e-01   -4.283899166612732e-01   -4.207871313399166e-01   -2.208072909954557e-01   -1.773393030570665e-01   -9.945393609248009e-02   +7.085536831307570e-01   -2.218000048033850e-01   +2.013777916948027e-01   +4.821459993702685e-01   -3.824145685384700e-01   -4.015601691129796e-01   +2.254142500729189e-01   -1.603058588450238e-01   +2.202863643772723e-01   -1.016166087280596e-01; -2.820703740609314e-01   +1.080387308070764e-02   +2.372351444460978e-01   +6.173029693484088e-02   -3.102257308654258e-02   +1.880668038254914e-01   -1.833216964105393e-01   +1.862914185082629e-02   +7.072743278366149e-02   -2.564331925698240e-01   -4.676399177617667e-01   +2.074559110800350e-01   -4.131661292148600e-01   -2.673107150358508e-01   +8.658181344726082e-02   +2.408910849202587e-01; -2.600438561178517e-01   -9.410573722826583e-02   -3.505216582555225e-01   +7.866257746903407e-02   +3.202595652056913e-01   +3.614910674008633e-01   -7.271567318845568e-01   +7.232327529165072e-01   +1.333580698481095e-01   +1.153785230458199e-01   -4.376348963408674e-02   +3.216287258628826e-01   -2.315326047923732e-01   +1.028508592328653e-01   +5.318715897971456e-02   +1.185910019241557e-01; -8.607312359196770e-02   -3.630541578150409e-01   +2.995837237683154e-01   +3.158002798826416e-01   -1.512314125552746e-01   -7.875070119667511e-02   -2.199895884423200e-02   +9.181380008646171e-02   +1.986269601493919e-02   -2.634323430787630e-01   -1.760981355500969e-01   -1.280881803856102e-01   +1.755890525608481e-01   -2.616685413937205e-01   +6.658297663596066e-02   -3.338098211516090e-01];
L1E_L1I_iGABA_netcon = [+4.096408047195250e-03   +2.010759127566063e-01   -3.831856957937299e-01   +1.347051284445579e-01   -1.052235442861163e-01   -3.397118546139206e-01   -5.382195055991319e-02   +4.801870116770954e-01   -1.897741301260309e-01   -2.933312207562352e-01   -5.750490778242769e-02   -5.887904718044721e-01   +2.689827876354512e-01   -2.438309168472066e-01   -1.606005778126534e-01   -1.257267750283120e-03; -3.850502721734398e-02   -2.951621703883907e-01   -1.482356217443996e-01   -1.849103902037226e-01   +6.090804348836215e-03   -4.001731317723272e-01   +6.887423520936756e-03   -2.872627326687965e-01   -2.129750678324447e-02   +2.826261355196129e-01   +7.382011329817589e-02   -2.674659788991911e-01   -2.212796324747568e-01   +6.287673421176675e-01   +2.978768598820616e-02   +2.142164926446884e-01; -1.693318473236196e-02   +4.439461737200571e-01   +4.206460330992701e-01   +2.878207124750193e-01   +5.355329014910844e-02   -5.130091482455450e-02   +7.921140314192389e-01   +4.186095175052770e-01   -5.471566831375719e-01   +4.339890984408973e-01   -1.869130187993542e-01   -5.673185793633932e-01   -3.356943640046369e-01   +1.120511496980095e-01   +7.991614832844551e-02   -7.155024523363942e-03; +2.526749074472567e-01   -3.737650936143659e-01   -1.175148297629605e-01   -1.347713822353467e-01   -1.528113815686718e-01   +8.754604302125726e-02   -4.491894207075979e-01   -9.510706455864859e-02   +6.553073365856603e-02   +3.684176966841433e-01   +2.261010714500875e-01   +2.718876292422621e-01   +1.810016563910056e-01   -5.205499230658204e-01   +5.667325124528931e-01   -5.757650169181217e-02; +1.295337686276263e-01   -1.559071369127316e-01   -3.527071634873636e-01   +8.464616639062077e-02   -3.389113863303041e-01   -4.081749789953420e-02   -1.282453271269459e-01   -1.469333608762267e-02   +2.322205785179028e-01   +4.024298507718368e-02   -4.084502161596242e-01   +2.032417051400331e-02   -1.784000441619218e-01   +2.905725740383334e-01   -6.577111762459587e-02   -1.457139619348229e-01; +3.084926190048808e-01   +1.481674742049424e-01   +2.240697813775239e-01   -1.923480306262950e-01   +1.676968344700251e-02   +8.409438524202538e-02   -4.361294453455164e-01   -1.110993762082582e-01   +2.926979946138760e-01   +2.606000049302690e-02   +7.729853760455142e-01   +4.983749255236587e-01   +4.899263942165384e-01   +1.745858067349593e-01   +8.123219167990989e-02   +4.866626369024113e-02; +5.630471962858602e-02   -7.122233875035830e-01   +6.969039060454565e-02   -3.081894249107734e-02   +6.470875383678636e-02   +1.862750693813403e-01   +2.590894314485619e-02   -4.361773037873623e-02   +5.501054924826210e-01   +1.774401885925472e-02   +1.115141682677586e-01   -2.322623909605050e-01   -8.526646379792320e-02   +7.296462230636921e-01   -2.866332738933322e-02   -3.981385671990793e-01; +1.637854417986945e-01   -2.837895492576764e-01   -5.805185462989825e-01   -1.942118523115447e-01   -2.784283651330186e-01   -4.728293192767236e-01   +5.347772040932375e-01   +1.853492672656885e-01   -3.386393653710651e-01   +2.174195121161675e-01   -3.647205305263776e-01   -2.571923612952596e-01   -3.497984610373873e-01   -2.237114060383121e-01   -3.397633617558999e-01   +8.837997920443756e-02; +4.328366992806897e-01   +4.248161101703912e-01   +4.125118241700975e-01   +7.441095352055649e-01   +4.190828081214374e-01   -4.523910282350054e-01   +3.310806699017331e-02   +7.623609753295710e-02   -1.368457887591752e-01   +1.143628313574140e-02   +1.478574190294317e-01   +2.231240363218358e-01   +7.313152374812807e-01   +6.335769711502178e-01   -4.188904234687194e-02   +7.475478518036557e-02; +1.023601564121727e-02   -3.544061863703103e-02   -2.919552670738655e-01   +2.704790050466321e-01   +1.395050409265569e-01   -3.367478830093898e-01   +1.307740583559710e-01   +2.312381298870667e-01   +3.142987448868045e-02   -5.710499216879757e-01   -6.046892852549596e-02   +1.415748131744666e-01   +3.529303972173596e-02   +4.177346756822280e-01   -4.255581386072688e-02   -3.607530457127233e-02; +3.952794605832182e-01   -5.003828944128750e-02   +1.611289902089037e-01   -4.071236765029090e-01   +4.435227603414506e-01   -1.316072165358618e-01   -1.681716468391303e-01   +1.160142445461038e-01   -1.656303338499553e-01   -3.337034750223188e-01   +2.096660912261565e-03   +2.857365059280266e-01   -4.470839850289106e-01   +2.773117593140617e-01   +2.239145588234295e-02   -3.617390377236113e-02; -2.018550359665059e-01   -3.604704251786551e-01   -2.345012639620476e-01   +2.491116301433773e-01   +1.114555099248712e-01   +2.194248114199133e-01   +2.153674282321448e-01   -4.814623980131890e-01   +1.176655902594357e-01   -4.107106457071363e-02   +2.806505014358596e-01   +1.947541598993931e-01   -2.350321354099729e-01   +4.528310877777530e-02   -4.673681617519044e-01   -4.910866050450180e-01; +3.267665410703612e-01   +6.078081179760371e-02   +2.174927773419323e-01   +2.076494258906854e-01   +3.848100925635877e-01   +1.246077475169571e-01   -8.143169735181170e-02   +3.405203491117140e-02   +3.867616571190137e-01   +1.963406533887704e-01   +5.589013055185393e-01   -7.118078908986423e-01   +4.778381651623692e-01   -1.542307750527763e-01   -2.607023286134479e-01   -2.593278468706298e-01; +2.393284610635598e-01   -2.490535010639514e-02   +5.930891250789784e-01   -2.772191896293623e-01   -3.146958815408982e-01   -3.679789438242053e-01   +4.008695512604843e-01   +4.963193011280505e-01   +5.984125510521525e-02   +5.566587942828981e-02   +3.732440411415998e-01   -4.571889559776676e-01   -2.164090684051569e-01   +7.045455752630377e-01   -7.324725500439799e-02   -3.896142396790411e-02; -5.843742958794995e-02   +1.918520651391072e-01   +1.197650551995877e-01   -5.882695513547342e-02   +1.303303591800977e-01   -4.001779802589336e-01   -1.585565182441333e-01   -1.170538933347870e-02   +1.625996042235240e-01   -3.306717205346082e-01   -3.632883340406399e-01   +1.602688362887910e-01   +1.314759661018931e-01   +1.206826168294271e-01   +2.785606795923022e-01   +5.301993695055286e-01; +1.370860022266182e-01   +2.115688514812439e-01   +1.040432026480134e-01   +3.056149271505794e-01   +1.053162850222594e-01   -2.059896889989688e-01   -2.535880947882373e-01   +4.180716256792289e-01   -7.740836797355738e-03   +3.919328256004455e-01   -6.984945882587851e-01   +1.811574624348870e-01   +1.551423021431004e-01   -4.638084302229636e-01   -1.062860295168038e-01   -3.947518193406602e-01];
L2I_L1I_iGABA_netcon = [+6.760713240054786e-01   +3.263230835164707e-03   +4.010879052669755e-01   -2.097639056686414e-01   -2.071175070776058e-01   -4.556670789601421e-01   -2.736793897722251e-01   +3.749420059481868e-01; -6.655332711013621e-01   +5.002440768194477e-03   +1.946288690176086e-02   -2.706985005064945e-01   +1.784993877393351e-03   +2.035409277130981e-01   -2.183057217444940e-01   -5.498914783028470e-01; -3.047666118368972e-01   +3.753057692273676e-02   -4.413720076249979e-01   -2.649586530793981e-01   -3.815043358677997e-01   -3.232063341053757e-01   -7.148698647250078e-02   +4.135021278688600e-01; -1.687496842961526e-01   +1.561477866499610e-01   -5.113367584644493e-01   -1.291726596626636e-01   -1.312467717757976e-02   +1.837896292570596e-01   -4.089798383478537e-01   -4.668994390978680e-01; +1.966219353719760e-01   -6.295271924779201e-01   -1.719436714484726e-01   +5.793266024565991e-02   -1.919161677723610e-01   +3.791932390104237e-01   -9.614065717903406e-02   -9.455225928196254e-02; -1.776779501156601e-01   -4.246145859779840e-01   -5.755346019135804e-01   -8.315958855085022e-02   -5.939985803536570e-01   +3.323643194045503e-03   -2.946160398032690e-01   +1.062900956384795e-01; +3.927581211443741e-01   +3.410074777098612e-02   -2.755131500306353e-01   -2.288935901261912e-01   -4.360464759771552e-01   +7.380562150026458e-01   -5.537187694086944e-01   +3.578687405898228e-01; +5.806354108913678e-02   -4.183057795907700e-01   +1.288084452938247e-01   -3.895164598077823e-01   -3.840394719217599e-01   -2.640938551637566e-01   +4.843037614018775e-03   -4.574182414571822e-01; -2.205907527689498e-02   -5.072643061251335e-02   +1.350925590458377e-01   +2.739186197818823e-01   +1.802191962821184e-01   -2.442124133637807e-02   -3.337149847432827e-02   +3.893698653878020e-01; -1.377059993075013e-01   +1.031843507317278e-01   -1.337428827114266e-01   +3.785133058888222e-02   -6.550677538482588e-01   +4.753258530978975e-01   +6.853045472459969e-01   +1.954228961585216e-01; -3.067781268402956e-01   -2.701404244241044e-01   +8.425031454233873e-01   +5.672938463790448e-01   +2.188168040571080e-01   +6.175365731092354e-01   +2.371863239235867e-01   -4.170084188177094e-01; -5.596874258561949e-01   -1.148836573416384e-01   -2.504000946603391e-01   -9.189051866902230e-02   +5.082715955036232e-01   +1.198683932691465e-01   -7.227862884455627e-01   -2.304963379989881e-01; +2.924459673670382e-01   +7.965642621086155e-02   -6.623752872011814e-01   -4.958065343048996e-01   +3.754611492336384e-02   -5.134321783110282e-03   -1.668559838625956e-01   +2.722472062286387e-01; -3.768749007504286e-01   +7.257433166657435e-01   -2.239464599846086e-01   -1.231944851700824e-01   +1.632643445721755e-01   +5.747635235693438e-02   -2.940979695715381e-02   -1.161473075481378e-01; +2.102394671826856e-01   -1.310831442726818e-01   -1.717899911752099e-01   -7.775624341017640e-03   -1.956445640425384e-01   +3.050331977848272e-01   +5.244255191157711e-01   +5.131618566752549e-01; -4.325563129879092e-01   -3.077740644128188e-03   -4.921360132361625e-02   +6.248592772691935e-01   +3.752554426460446e-01   +8.108297454497616e-02   +4.992141884223610e-01   +3.703008453963472e-01];
L1I_L2I_iGABA_netcon = [-4.363602768061836e-01   +6.054053973304754e-01   -7.167018607586126e-01   -6.864106620524724e-02   -2.606840186660349e-01   +1.654606843562536e-01   -1.450713242935437e-01   -1.129373675703236e-01   -2.069187836291092e-01   +2.522192957302344e-01   +6.075353239403736e-02   -2.626506693108631e-01   +3.699382574292209e-01   -1.831465663361539e-01   -5.496432224064582e-02   -5.426320088499065e-01; +3.740711543566112e-01   -1.717066303321653e-02   +1.566207918910227e-01   -3.365220636902054e-01   +6.565066439325971e-01   +2.749758479015751e-01   -1.667216533053470e-01   -1.244834833454515e-01   +3.464421457312142e-01   -2.828098742902114e-01   +5.427044107412107e-02   -2.987885238192810e-01   -6.652445364994283e-02   -4.046590697587355e-01   +1.395591264016683e-01   +2.294148243799289e-01; -4.274792377005154e-01   +1.630976406293178e-01   -6.588577419291536e-02   -3.237082152586786e-01   -2.503345559549202e-01   -2.402295642178358e-02   -2.737852457190434e-01   -6.337633899485849e-01   +4.423606718059605e-01   +1.518916556682611e-01   +2.016968033182671e-01   +5.155307604421518e-02   -4.353573325656481e-01   -9.243498303651275e-02   -5.167668184320093e-02   -5.051272243013263e-01; +2.100229678014081e-01   +6.108989346016933e-01   +1.201218756130046e-01   -1.239296993828080e-01   +4.989556752361990e-01   -1.791540845098562e-01   +1.292605577665735e-02   +2.231314693227305e-01   -8.113492135143079e-02   +3.552675262836693e-01   +7.599207774097268e-02   -4.695288159898028e-02   -6.399201972933145e-02   +5.052967772513212e-01   +4.678505422051980e-02   +5.691095874785315e-02; -2.985992508281026e-02   +6.389982042720752e-02   +3.319019583936232e-03   +1.357846699603359e-01   -8.924396990840477e-02   +3.408120320442228e-01   -2.154513835738245e-01   -1.013079773813837e-01   +2.856717889473874e-01   +5.328353933171320e-01   -3.302817399425455e-01   -1.646849327396310e-02   +5.413406710875973e-01   -3.965687207599382e-01   -1.341053790843390e-01   -1.153898617729897e-01; -1.629101508053554e-01   -4.541839842328010e-01   -3.301995141760642e-02   -2.336660773917649e-01   +2.649332885139142e-02   -2.088550670043207e-01   -2.267135298888012e-01   +1.987359703983405e-01   -4.023295164740979e-01   +3.420019285161352e-02   +7.200093463784543e-02   -5.654993308788573e-01   -4.378286475470011e-02   +1.259736045047002e-01   -1.840942166774197e-01   +4.685328998935551e-01; -4.485955385034884e-01   -1.933907873975454e-01   +3.257852747775624e-01   +1.023910005779247e-01   +5.083306116232625e-01   +1.255498528745584e-01   -1.785900786110527e-02   -4.989189152407124e-01   -6.942982804119119e-03   -5.475651765244330e-01   -8.331816341420882e-01   +3.120439458974333e-01   +5.348338101421250e-02   +4.285718576611450e-01   -2.473043929280537e-01   -2.258569972629633e-01; +3.545227027417295e-01   -3.358881502139342e-01   +1.073479917713625e-01   -1.828015544716782e-01   -1.629160955420526e-01   +4.119657622289857e-02   -3.026226369233971e-01   -2.893630117686917e-01   +1.716659067457967e-02   +2.633959659150651e-01   +2.893972598226393e-01   +7.588455629621328e-02   -5.557765667679718e-02   -2.444786977971823e-01   +1.132161795960601e-01   -3.435855704829132e-01];
L2E_L1E_iAMPA_netcon = [+2.998303228043777e-01   +3.416005545195768e-01   -1.023460549828611e-01   +4.963040270103609e-01   -1.022838854195681e-01   -4.214063924427978e-01   -4.797897417630786e-02   +1.107663328814371e-01; -4.748315015707762e-01   +1.584944548543175e-01   -5.436527404182182e-01   +2.669452301968435e-01   -2.637511360808269e-02   -1.537677131080629e-01   +3.528404777181220e-02   +5.740415234125792e-01; +4.204184769551627e-01   +3.407956141391573e-01   +4.433854435395607e-01   +3.272883853355030e-01   -3.982648027453369e-01   -6.623435517952283e-01   +2.225355156500432e-01   -7.204268159689078e-01; -1.355978964699220e-01   -6.564877500920278e-02   -4.280786998992422e-01   +2.384480854437888e-01   -7.331030304883129e-02   -1.807680154619569e-01   +2.104114633040445e-01   +5.466237967433563e-02; +1.192361713733890e-01   +1.190890031087205e-01   -5.331537473009819e-01   +2.366464533316784e-01   -3.912114461592986e-02   -4.915963956293316e-02   -3.837596398464606e-01   -8.675636681700855e-01; +2.283466895160172e-01   +1.355426945468923e-01   +4.487232535943265e-02   +2.142629373789597e-01   -3.973689228685518e-01   -3.259073280702756e-01   -2.490919520237885e-01   +6.719331900460382e-03; +2.389544412346797e-02   +6.487675034917995e-01   +7.226968751666618e-02   -7.817092367729872e-01   +1.744660981394820e-01   +2.960920595715456e-01   -5.059756306211313e-01   +7.719508782517764e-02; -2.367359316333967e-01   +5.515833112290680e-02   -4.243055914063233e-01   -1.114000529690410e-01   -5.504440931307494e-02   +2.170326301099616e-01   +1.468926453974419e-02   +1.793387009595018e-01; -8.937739007269119e-02   +1.483308144790776e-01   +2.553454696125349e-01   -1.955839279540930e-01   +6.524027151922807e-01   -6.311135627479648e-01   +1.281290703411705e-01   +3.019897277490504e-01; -1.223715568074027e-01   +8.185691736066329e-02   -1.276709863749081e-01   +1.130297249339553e-01   -1.686069582719547e-01   +1.356600128000789e-01   +1.750880377341802e-01   -3.719183147699416e-01; +6.160735010321690e-02   -4.250687801229979e-01   +1.136898279505006e-01   -8.403343349065252e-02   +1.176875270914035e-01   -3.990452819967321e-01   +9.054396535921058e-02   -2.341673914825760e-01; -5.836441443660194e-01   -2.745149141875313e-01   -2.154436591048845e-01   -2.440896689664403e-01   -5.972284364396113e-02   +6.039864891892055e-01   -4.224831416912143e-02   -2.136264836767930e-01; +9.971829139380516e-02   +7.321740143297817e-02   -2.564601595760178e-01   -2.463959018975141e-01   +4.868738275853815e-01   -4.561809549285650e-01   -1.221602881248773e-01   -7.796504595134500e-01; -1.137613311013950e-01   +7.603601315193997e-02   -2.225097608919620e-01   +1.569321852628236e-01   +5.350030201960027e-01   +2.569017487668776e-01   -1.082324494870543e-01   -2.042747073016724e-01; +9.914327135717999e-02   +2.874704858062133e-01   -4.976440721754493e-01   +6.923517784089839e-02   -7.910267925598286e-02   +8.804937378023198e-02   -2.174752540649835e-01   -4.358586910454798e-01; +3.289899293705291e-01   +5.285893039021561e-01   -5.343646892046330e-01   +5.581718339187270e-02   +2.299688046784615e-02   +4.548349017516649e-02   -3.041391745470172e-01   +5.574508253344463e-01];
L1E_L2E_iAMPA_netcon = [+2.040531194253490e-04   +2.993622366485382e-01   +2.478438715027545e-01   -2.036138436997926e-01   +2.620465098427014e-01   -6.781956115406640e-02   -4.059388820045863e-02   -2.262179918982361e-02   -2.863208305805369e-01   +5.718020499979198e-01   -4.132491635930373e-01   -1.022981144486740e-01   +1.635527662645327e-01   +5.675986238960814e-01   +1.973426939552427e-01   +2.567058385050189e-01; +1.703228237539712e-01   +2.191752137435558e-01   -1.698957074553091e-01   +4.476050338443470e-01   -6.188150237332273e-02   -2.428918591123289e-01   -2.750078597822810e-01   +4.759170306998783e-01   +2.506270617326709e-01   +3.801519845932202e-01   -2.805967809670627e-01   -4.696643430118451e-01   -1.028430181248657e-02   -3.034609847217768e-01   -1.064795873696329e-01   +3.977233912371628e-01; -7.989133068035490e-01   +1.685315621406666e-01   -3.985351546119947e-01   +2.690118272667471e-01   -1.441406148557199e-01   -3.606885412954721e-02   -2.056525095965126e-02   +9.295563265036871e-02   -5.381897465531251e-01   -3.557826391794352e-01   -3.092823868733083e-02   +1.955222281097613e-01   +2.901188103229901e-01   +3.829132002935091e-01   +2.534702946419661e-01   +3.839018998057069e-01; +4.974569732893533e-02   +6.028907946312254e-02   -5.533645226115192e-01   -3.052037860748887e-01   -4.997530118615545e-01   +5.324526563405547e-02   -1.307478488969706e-01   +3.626764280842913e-01   -3.359001156323538e-01   -8.770569520917482e-02   +4.274480651045939e-01   +2.500993488259021e-01   +2.798862157467438e-01   -2.505569932155487e-01   -7.247568184452529e-01   -1.109778705788053e-01; +4.403216003771665e-01   +4.026686050164193e-02   -8.218904747071490e-02   -1.317233344528085e-02   +3.372376400537291e-01   -4.713360586213341e-01   +4.618296228812935e-03   -2.444127067196410e-01   +4.724026773653873e-01   +3.264642003967038e-01   -2.301232093159588e-01   -1.576234270935620e-01   -2.156266825496432e-01   +2.876652176490449e-01   -2.443820490252636e-01   -7.356540741354365e-03; -1.094096008613795e-01   -1.270807638258782e-01   -3.211761583102797e-01   -3.653378618776706e-02   +5.013763283393009e-01   -4.654777151092550e-02   +1.862068382214003e-01   -3.722665493999504e-01   -2.258058777109362e-01   -4.376843014359497e-01   +2.435213668965894e-01   -4.198783146073286e-01   -5.466895536498387e-01   -1.725683598058868e-01   +3.560186425283618e-01   +9.798309261648028e-02; -2.887056482362319e-01   +1.917919319123369e-01   +2.195057668832888e-01   +2.176557186112742e-02   -2.538852200594604e-01   +1.290705039755435e-01   +5.214042844850039e-01   -5.249511125777514e-01   -3.111301726330973e-01   -1.507676989878382e-01   -1.932734725252726e-02   -2.939381450860982e-01   -3.934553700407574e-02   -1.353226641082637e-01   +6.567197208833303e-01   +9.554433143918345e-03; +5.242921551721350e-02   +1.872827879416338e-01   -2.079295092485196e-01   -4.464992422998629e-01   +5.417031992433563e-01   -4.153986839293706e-01   +4.229062298057606e-01   -1.275267566064819e-01   -7.171481671864278e-01   +1.628791748935636e-01   -1.923862871201307e-01   -3.780803569223704e-01   -5.151440323892457e-01   -6.508110911624998e-02   -1.042535402875903e-02   -4.413794053885977e-01];
L2I_L2E_iAMPA_netcon = [-4.046227330583473e-01   +1.917082447326151e-01   +2.755855336869409e-01   +2.569512238256558e-01   -2.390500565172292e-01   -4.600493406609450e-01   +6.357623443937807e-02   +1.976823455812144e-01; -1.300992800533191e-01   +2.553008490436221e-01   -3.235541146301061e-01   +2.174013096572718e-01   +5.546407380686852e-01   +3.859686616301501e-01   -4.011505983354139e-01   -1.247565791403735e-01; +3.018667372024627e-01   +5.249749875385455e-01   +7.266456538804086e-02   -3.833617033099450e-01   +2.634786761857942e-01   +4.199601275109929e-02   +2.227191042202245e-01   +4.268498985176614e-01; -3.914453354235632e-03   +3.275824720927381e-01   -1.565593952650610e-01   -3.444992631886190e-01   +6.482917080415544e-01   +3.495564960055786e-01   +1.027089586499167e-01   -6.369469291050790e-02; +2.967551258760167e-01   -2.161072453692874e-01   -3.104490041000708e-01   -5.193800507708384e-01   -6.592966729408901e-01   -7.691759499814801e-02   +6.023538516138529e-01   +2.094787755591292e-01; -8.549329832347206e-02   +4.139684812765110e-02   -1.097136676111510e-01   +2.633124766839689e-01   +9.507893883999627e-02   +1.613134604011123e-01   +2.539773046942900e-01   +1.220663514151173e-01; +3.048878664727376e-01   -3.504695230469706e-01   -1.223395255515467e-01   -6.930618998283544e-02   -1.527091123396774e-01   -1.221390891386125e-01   -2.018090638130434e-01   +1.205541735679910e-01; +4.476193135878256e-01   +1.649344561073365e-01   +2.696633397114050e-01   +1.649669506920530e-01   +7.436715786200496e-01   +1.050466170519604e-01   -7.865156517390115e-03   -2.782275115260391e-02];
L2E_L2I_iGABA_netcon = [-2.289180414800595e-01   -6.505531986831395e-01   -1.320236582435381e-01   +3.373221575127516e-02   +2.347683119245138e-03   +6.423189108193651e-02   -4.013108218958028e-01   -2.306153002596054e-01; -4.058625004275290e-01   -6.269597771595795e-02   -2.710226385515020e-01   -1.393035116435362e-02   -1.135394965308845e-01   +2.417501423448141e-01   -1.103855498123409e-01   -9.068057538872286e-01; -7.816650847758125e-02   -4.289528947161134e-01   -2.178157701310662e-01   +5.373236316006914e-01   -3.196200461293970e-01   -6.116834234296055e-01   +3.847372242203720e-01   -6.005049958952432e-01; -3.215479311838629e-01   +3.546463947686310e-02   -3.692885717440658e-01   +3.085903598912633e-01   -5.990155727064475e-01   -4.590843542351661e-03   -8.272659034957019e-02   +2.896915738997393e-01; +6.862723301075400e-01   -2.075983412851784e-01   +5.155991271220040e-02   -5.374396126731240e-01   +1.611687580651274e-01   -2.193787710663144e-01   -2.641712246035621e-01   +1.630998365873602e-01; +2.152172913066026e-01   +1.997639897966351e-01   +4.631541783344578e-02   +4.340873541128151e-02   +6.463846738997796e-02   -1.517338974412390e-01   +1.664979940680981e-01   +1.509836719499734e-01; -5.588729183781701e-01   -1.523212429186788e-01   +1.203141697277578e-01   +3.837698262544208e-01   +2.148816915595842e-01   +3.917043391418469e-02   -3.557954687916467e-02   -1.852722185146929e-01; +5.463334540100045e-01   -5.449841937029571e-01   -1.995147775629938e-02   -1.468276190517686e-01   +2.760429385998600e-01   -2.911979579536826e-01   +4.858625721558180e-01   -6.217762674908642e-02];
L3E_L2E_iAMPA_netcon = [+4.397760869688987e-02   +5.916582440310385e-01   +4.271550354922205e-01   +4.307095956057420e-01   -2.718904133372253e-01   +9.825206622027076e-02   -1.259663239865235e-01   -3.585357126921574e-01   -5.273134304413223e-02   -1.156399032251996e-01   -5.643819389214702e-02   +2.958646153329056e-01; -6.364481616647089e-01   +3.629313640815468e-01   +3.309094397033708e-01   -7.366540553602554e-01   +4.340890779385052e-01   -6.225336813825515e-02   -3.536592336589315e-01   -2.364391037892433e-01   +1.992346416854554e-01   +2.620448271236326e-01   +3.885215950738569e-01   -2.912910851965238e-01; +1.937011203153715e-01   -4.709403392098792e-02   +3.106573385355099e-01   -1.255003029981443e-01   +1.723541266783257e-01   -2.584857026652801e-01   -1.435163821264832e-02   -2.054241996723863e-02   +2.115709461782044e-01   -5.058647446263401e-01   +3.078098682268731e-01   -4.992155866880797e-01; -3.070513449518026e-01   -3.238894671852142e-01   -2.545913716753916e-01   +2.785369855149079e-01   +4.333588925885882e-01   +2.411447709203782e-01   -2.517161955530980e-01   +6.131149164811251e-01   +1.636405874307056e-01   +1.316374992994898e-01   +1.501221094639368e-01   +2.904882629523068e-01; -1.613708955095704e-01   -7.026292345186996e-01   -5.861646104937463e-02   -2.581902756644403e-01   +2.617490162411748e-01   +2.389068441846408e-02   +3.752036169258438e-01   -3.615706509069053e-01   -3.047722306404994e-01   -3.090103324205392e-01   -1.676999268977692e-01   +1.215317728601907e-01; -3.810933430794408e-02   +6.939896521926281e-03   -3.169553464741340e-01   -4.234540022423206e-01   -3.206800833974744e-02   +1.912284554952148e-01   -4.696752777132392e-01   +1.943536649090546e-01   +1.276037870612432e-01   +4.488478443150506e-01   -4.007404559581106e-01   +5.044742743187591e-01; +2.986384874124829e-02   +4.726627589932351e-01   +8.582488712947536e-02   -3.162283795903505e-04   -2.522902130187714e-01   -1.689474379439683e-01   -9.565195315729356e-02   +3.346955612872984e-01   +1.469476206699286e-02   +2.011683795144159e-01   -8.656147534596717e-02   -1.728909724969711e-01; -2.181919152765988e-01   +2.832514325184701e-01   +3.925061321788902e-01   +1.887271506123958e-01   +4.633645802150639e-01   +3.098614307563294e-02   -9.631936407198763e-02   +6.581931705079350e-02   -2.273759979324775e-01   +9.028068799232587e-01   +2.987333915824844e-01   -6.424344652979981e-01];
L3I_L2I_iGABA_netcon = [-1.085797302380815e-01   +2.621822320880869e-01   +4.236075149454947e-02   +8.798383634103130e-02   -2.025480718966003e-01   -2.300661053163860e-01   +2.326022501945929e-02   -2.810973608064387e-01   -8.155285534069596e-01   +5.670855898033077e-02   -5.682485840652087e-01   +4.924193010621142e-01; +4.470084459328087e-01   -2.006443746411005e-02   +2.605739258559139e-01   -3.448763029785488e-01   -9.908858657368683e-02   +1.557737167981513e-01   +1.684100331016825e-01   +5.127402489850977e-01   -4.945185034955579e-01   +7.794352098203680e-01   -6.830320273494052e-01   +3.779402691753372e-02; +2.221542697783144e-03   -2.775920095978696e-02   +1.674901948021316e-01   -1.501702216368552e-01   -3.860594666466475e-01   +1.381484116940033e-01   -1.660384967916241e-03   -2.360102848959605e-01   +3.103976414252919e-01   +3.696880530455083e-01   +1.947231750483470e-01   -4.043547002614244e-01; +7.284295815611107e-01   -1.409520193927128e-01   -3.005717837297010e-01   -5.929664796926430e-01   -4.787939709321131e-01   +2.475995424452908e-01   -3.322618830435169e-01   +7.940742322394093e-02   -1.682146475094520e-02   +3.249786485711552e-01   +2.060048460684919e-01   +2.873531674523168e-01; -2.031684552262785e-01   -3.234108744607828e-01   -1.996520581155306e-01   -3.338127524110792e-01   +6.700959006536913e-02   +6.161462573629533e-01   +4.894239273706116e-01   +1.924981034703845e-02   -2.271516550167783e-01   +2.680613405284324e-01   +3.000889078390718e-01   -1.906217223178751e-01; +6.234249927496086e-01   -8.836677298816241e-01   -1.345712891000153e-01   -9.468499067095817e-02   -4.765353831396481e-02   -5.335913245512672e-02   -1.863529951394249e-01   -3.468858757169632e-01   -1.640875492446245e-01   +1.423858234391930e-01   -4.603045067894663e-01   +7.941319023565114e-03; -3.621143618301878e-01   +8.223001617592229e-01   +1.484221403056220e-01   -8.078504349490088e-02   -6.205425021864430e-01   +2.163028928915497e-01   -3.359596353395347e-01   +3.645677243230326e-01   +2.781388729527055e-01   +1.576684766850732e-01   +6.698290543814314e-02   -1.614710233590248e-01; +2.122305570421573e-01   -1.892645678189191e-01   -6.590576106829575e-02   -5.148883588449166e-01   -4.523081848263237e-01   +1.497944576464635e-01   -4.466096725757097e-01   -5.317187185194574e-01   +1.537529837799824e-01   +2.566903767111449e-02   -1.214637646551033e-02   -3.924172515361816e-01];
L2E_L3E_iAMPA_netcon = [+5.765136376753830e-01   +2.286536744864623e-01   +6.094775900534486e-01   +4.901880550548827e-02   -2.102789971692738e-01   -8.700108083566889e-02   +4.192407589155145e-01   -1.328843464679840e-01; -5.724335125323797e-01   -2.537337184136010e-01   +7.151396984635373e-01   +2.964538708686151e-01   +5.322759078830583e-03   -4.717774037584917e-02   -7.544860066371899e-01   +1.834673580568937e-01; -3.391250611029286e-01   -1.393398654285261e-01   -1.096842228069189e-01   -6.570303754611810e-01   -3.147894674615020e-01   +8.016153002731126e-02   -4.894750121035233e-02   -1.394546861788400e-01; -1.925545746429930e-01   -3.191187282205729e-02   -1.517493230415538e-01   +3.995080276632224e-01   -2.453542950970374e-01   +1.017710206735393e-01   -2.413850704149683e-01   +3.858798949397069e-01; +3.592851929066751e-01   +5.207932751035761e-01   +2.812365070562125e-01   -1.362722918863872e-01   -5.706394194532547e-01   -6.651505037577807e-02   +2.856474669473161e-01   +3.176421845401889e-01; +2.307146069092126e-01   -8.688995942073202e-03   -4.557190726633473e-01   +2.665089872191393e-01   -9.374766350417615e-02   +2.345555386809866e-01   +2.752823198844698e-01   -1.357266389839037e-01; -1.749163483013071e-01   -2.609020194822137e-01   -2.715153615783014e-01   -9.832885946363526e-02   -3.622783340884501e-01   -6.043514224490704e-01   -7.922954120968848e-02   +5.681018854439056e-02; +3.321399350600576e-02   +2.992770407912656e-02   -2.464134658804369e-01   -1.974041452971126e-02   +3.592572494761880e-01   -6.093809314760780e-01   -7.839647490326291e-01   -4.933406752131334e-01; +2.117941740356378e-01   +5.046200376923913e-01   +5.292287151859332e-01   -3.018154272004728e-01   +3.225592730274396e-03   +2.458633607134575e-01   -5.995720862494377e-01   +9.568551123230662e-02; +5.698520660028469e-01   -3.349341953400780e-01   -3.496459046134841e-01   -1.979733354212205e-01   +4.467601737717901e-01   -1.546562904120833e-01   +1.103691294830485e-01   -1.069356310421781e-02; +6.600629836398688e-01   -5.979743240784491e-01   -2.592132580139624e-01   +1.515445168059924e-01   -2.557621363961850e-01   +7.626832774196564e-01   +5.770207945325014e-01   -7.201484841525597e-01; +4.933509672329141e-01   -6.738003850985713e-02   +3.638778738754087e-01   +4.943634586870794e-01   +3.767264573677708e-01   +6.416615734974198e-01   +4.106071058342438e-01   +4.901395363912813e-01];
L2I_L3I_iGABA_netcon = [-5.947298801255885e-03   -3.334137921489763e-01   +5.791887593187421e-01   -2.698907319289263e-01   -3.237726501279364e-01   -2.681987996394012e-01   -6.056807039253621e-01   -1.113131419736694e-02; +1.423248797295307e-01   -1.062029882769657e-01   +1.123562890176867e-01   -5.944710888685168e-02   +4.044634256908973e-01   -8.018414421783453e-02   -1.636616171981421e-01   -4.195007611287432e-01; +3.436159767257332e-01   +1.404285309086394e-02   +1.600716066143235e-01   +1.664299293277496e-01   +1.753897370275538e-01   +4.019435052532553e-01   -2.223912454470722e-01   +4.892453071300982e-01; +3.012156260845033e-01   -3.039812258384429e-01   +1.212524821046162e-01   -1.168117296500364e-02   -1.690603722880442e-02   -7.849266881171356e-02   +4.133073921136003e-01   +8.833491727171168e-01; -5.176103723221859e-01   -2.906163191430629e-01   +2.176962655896427e-01   +2.298628922439352e-01   +7.687488705072084e-01   -7.222223180719682e-02   +3.311081057718361e-02   +3.638024060684493e-01; -1.239685922399472e-01   -1.126433568168329e-01   +5.370123591933716e-01   -4.920478755087547e-02   +3.195093769300041e-01   -4.701806770753869e-02   +1.105689051998236e-01   -1.208114625634965e-01; +3.777434722695813e-01   -5.044189977682703e-03   +2.348219979076777e-01   +2.478758885815308e-02   +3.038121521241143e-01   -2.349354559281309e-01   +1.829190450751436e-01   -2.381293488599411e-01; +4.676340469975124e-02   +3.362238181882788e-01   +2.284965914709358e-01   +4.282744771219024e-02   +2.650437276600931e-02   -9.260974468414300e-02   -2.607043582935999e-02   -3.354113400987338e-01; +1.191336365434145e-01   -4.860831293315053e-01   -3.085826846252458e-02   +4.539623241583177e-01   -1.983836577771051e-01   +3.502075131269779e-01   -3.480978021080550e-02   +2.269535193250004e-01; +6.473953200660762e-02   -2.629566298120089e-01   -1.210316968101862e-01   +2.777310389719558e-01   +4.677357243320172e-01   -1.038718255731825e-01   -3.327612147743186e-01   -3.220543484205916e-01; +2.508043886752596e-01   +2.409510536726717e-01   -3.661700082646642e-02   +2.704517317646786e-01   -3.995611358910836e-01   -1.069882665677377e-01   -3.680977632787321e-01   -4.377608257111765e-02; +8.301036950092851e-02   -1.642294892181413e-01   -1.849489207383742e-01   -1.492285757043363e-01   +5.300871856078635e-01   +4.846333747881036e-01   -2.345555888760099e-01   -1.522166350888955e-01];
L3I_L3E_iAMPA_netcon = [-1.570456041044062e-01   -2.138118187338275e-02   -2.081688958130157e-01   +6.418498405266573e-01   -9.269839685665947e-02   -5.577196501013205e-01   -2.424169311282800e-01   -1.345909690628109e-01   +1.541810262816030e-01   -2.891502653402361e-01   -1.588047279166773e-01   -4.018810432729133e-01; -4.404494064637235e-01   -2.874403639873075e-01   +2.192452134378846e-01   -7.589365423521427e-03   +2.564494109026090e-01   +3.596591402929540e-01   +3.885468511254113e-01   +2.039431265871093e-01   -3.896067622800792e-01   -1.499662234780778e-01   +2.909189155068785e-01   +6.071617241758815e-01; +8.723844425120271e-02   +1.905242494779159e-02   +6.776521660385653e-01   -1.831700874943891e-01   +4.106512185619097e-01   +2.251950112960088e-01   -2.579092763359262e-01   +4.854035377824046e-01   +3.377145973292398e-01   +1.430967284881206e-01   -1.665602096706262e-01   -2.492856408998968e-01; +4.858287569116561e-01   -1.379618076504550e-01   +1.168047863708891e-01   +5.558359893343352e-01   -6.064923404581542e-02   -3.919068855663127e-01   -1.015590189238749e-02   -3.340340630367311e-01   +2.937792997795307e-01   -4.113333214382556e-01   +5.364204676773239e-02   -2.957317096387772e-01; +2.231737976817039e-01   -4.423569216219124e-01   +4.885793024758038e-01   +1.322997840839079e-01   -5.953189962762735e-01   -4.581910922858299e-01   -4.606059791334868e-01   +1.378958018769062e-01   +4.182693346660045e-02   -3.702551604743348e-01   -2.030716824928085e-01   -1.009659143369176e-01; -3.308951368733205e-01   -2.699759074549676e-01   +1.122043935770328e-01   -2.859983252419865e-01   +2.533128005246980e-01   -3.786501159460358e-01   +1.209091788327542e-01   +6.392855953499703e-01   -7.920004946221592e-01   -6.109148072666173e-01   +1.974217431384884e-01   -1.760833144914660e-01; -3.001614877534003e-01   +9.980921183565361e-03   -1.933609844672168e-01   -1.060523098870696e-01   -2.035475150552334e-01   +4.052603683277329e-01   +1.308628830821726e-01   -3.028081401824881e-01   +3.727112534601913e-02   -6.525822837269609e-01   +1.986457320424652e-01   -1.672596651684544e-01; -3.127469755842715e-01   -3.606158865726545e-01   +2.042600597082921e-01   +2.073030124335740e-01   -1.740536370551112e-01   -1.161277386790306e-01   -2.390197018758788e-01   +3.058876343357270e-01   +1.261966303265354e-01   -4.756359243708936e-02   -2.212585665300576e-01   +2.030444704241656e-01; +1.995381408509121e-01   +3.593630837613465e-01   -4.292228665018751e-01   +1.362684434482752e-01   +3.303092129723634e-01   +3.502499886044416e-01   -1.852078849900687e-01   +3.777398342193392e-01   +2.666087858087937e-01   +9.808433526190660e-02   -4.911548660259850e-02   +3.079847244107640e-01; +2.660212901135616e-01   -4.267349328445273e-01   -2.370006456202154e-01   -1.801251287638075e-01   -7.761973952343987e-02   +7.210674918653152e-01   +4.054279427744880e-01   -5.711005902196675e-01   +2.642146529433800e-01   +1.823403233730886e-01   +8.510200839042729e-01   +3.138131810174568e-01; +2.217101169812362e-01   -1.373283467686580e-01   +4.132489661346066e-01   +8.702691075808751e-02   -7.049480525072274e-03   +5.114184455913607e-01   -2.232539562341510e-01   +2.578987521156109e-01   +1.649870288896205e-01   +6.989301540320042e-03   +7.147064493879049e-02   -3.275588545951451e-01; +6.275085661591745e-02   +1.274894377208190e-01   -5.791456362170625e-02   -7.958419464404860e-02   -3.970367340056050e-01   +3.172750561030669e-01   -1.306584870017166e-01   +5.710360576535858e-01   -5.066383190828497e-01   +3.319731702219206e-01   -3.982906076699414e-01   +4.701090211253114e-01];
L3E_L3I_iGABA_netcon = [+9.085558766381770e-02   +3.930952980208335e-01   +1.222459600416916e-01   -3.894787802382846e-01   -4.070375010952114e-01   +3.411121943466336e-03   +1.366355427477411e-01   +1.102177870752273e-01   +1.684195492731873e-02   +5.497267006018597e-02   +2.390147211849916e-01   -4.968099495966458e-01; +1.111585895896963e-01   +1.532398071947735e-01   +6.422828410686077e-02   -1.613874153781290e-01   +4.530265431133427e-02   -1.791907871567801e-01   -2.036780723047771e-01   -3.861612836124863e-01   +3.756138972667928e-01   -4.505513135708782e-01   +5.604507947789477e-01   +2.583062228041537e-01; -3.035730175082957e-02   +4.001200741267351e-01   +2.545899971806810e-01   -1.745032958830266e-01   +1.013534520789060e-01   +1.870240165248629e-02   +6.253706580864745e-01   -1.463837811767734e-01   -4.110896050370987e-01   +8.724428418146864e-02   -2.012072803980783e-01   +1.520371929700757e-01; +2.872674905612878e-02   +2.952608297845886e-01   +2.139716559459320e-01   +8.454533742909096e-02   -3.902077446707105e-01   -3.908695578587483e-02   -1.125687152823691e-01   +5.154376223417011e-01   -8.494712478100494e-02   +6.877206649946273e-01   -2.789810631720179e-01   +5.086409957532756e-01; -3.692162058926030e-01   +3.682693477164799e-01   +3.410537399077784e-01   +2.398797066857808e-01   -2.475249918476538e-01   -1.032862112637572e-01   -4.323475513666810e-01   -5.444491408880208e-01   -1.035416686714451e-01   -3.478079260204605e-01   -3.594878016349821e-01   -1.759793149591947e-01; +2.171913788723822e-01   -1.265733868673057e-01   +4.454634130139507e-01   +2.550046362657923e-02   +4.364354166037525e-03   -2.805632905928315e-01   -5.545865106394839e-01   -2.988003399494428e-01   -2.575599240056968e-01   +4.725572638671867e-01   -4.609571896144060e-02   -3.339578412536559e-01; +5.692792433248098e-01   -3.552183563632882e-02   +4.131833577674269e-01   -1.386697469718463e-01   -2.074081679829273e-01   -2.999226387293009e-02   +1.958909576292125e-01   -5.990169331988811e-01   +1.049359037176684e-01   +2.001670989159869e-01   -7.275615619465425e-02   +2.867108584423873e-01; -3.554494473469159e-01   +3.127387211795912e-01   -4.355312458778755e-02   -8.012835987405043e-03   +2.443705279106758e-01   -1.567419038349092e-02   -1.303822171898453e-01   +7.226545072704920e-01   +2.711605234391397e-01   +1.092245878727163e-01   +5.271066633599462e-01   -1.689352001175056e-01; -3.064630657079409e-01   +3.077828430672612e-01   -5.457670308394472e-01   -4.926514271660144e-01   -1.217727842504607e-01   +5.697948757706957e-02   +1.381680239352435e-01   +3.621099117673602e-01   -1.843305528983958e-01   +4.068937973608981e-01   -3.929664842668228e-01   +2.298074737899265e-01; +1.390311610645334e-01   +3.292441845945862e-01   +3.853823759033442e-01   +6.595700573175076e-02   -4.238476357658651e-01   -1.957370426654736e-01   +1.440834769564846e-01   +4.974552403719122e-02   +2.786461799811483e-01   +8.855556452876213e-02   +7.339971362476817e-02   +1.740276050546543e-01; +1.281254391198755e-01   -2.179000502305054e-01   -3.966271959151315e-01   -3.751647943008020e-01   -2.623708292433566e-01   -4.587278021852583e-01   +4.968491973227267e-02   +8.365024752907099e-02   +1.091898122058517e-01   -4.580565584634728e-01   -1.141471464678500e-01   +4.993234802865856e-03; -1.041108649117510e-01   +2.347722727046181e-02   -1.619233502955265e-02   +3.075175067553246e-01   -4.556000869142812e-02   -7.878119035403719e-02   +5.698866523255546e-01   -3.093724023501127e-01   +4.001175834311123e-01   -7.059005429454737e-02   +4.074417249280424e-01   +3.027454461807781e-01];
L2E_Input1_iAMPA_netcon = [+1.445120060448959e-02   -3.234975847604638e-01   +1.888035271323142e-01   +7.340668190537394e-01   -2.771979521319045e-01   -2.326306411180273e-01   +2.157084058414678e-01   +1.119301929406383e-01];
L2I_Input2_iAMPA_netcon = [-1.366143590251373e-01   +1.232524547013635e-01   +3.907965258362046e-01   -2.386066757582106e-01   +6.607817885863641e-02   +4.142535785027344e-03   -2.566293688033910e-01   +2.584768596219338e-01];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.4*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 1.0*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 1.0*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.4*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 1.0*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 1.0*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 100*(sin(2*t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 100*(sin(2*t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
