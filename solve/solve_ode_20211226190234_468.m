function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+6.181369587233083e-02   -8.336098873640550e-02   -1.387541947841309e-02   +2.691601493243599e-02   +1.860657259433448e-02   -2.649332223075183e-03   +4.343006863807651e-02   -8.044411738345371e-02   +1.216823461962657e-02   -5.547402791652434e-02   +6.174029139161968e-03   +2.211582099191835e-02   -3.704779924920081e-02   +4.078028645620585e-02   +8.874753056600067e-03   +6.246557549479376e-02; -9.832107497060594e-03   -2.494536426417568e-04   -2.851698613641286e-02   +5.605501559334894e-02   -1.095636536449565e-02   -5.255784683214965e-02   +4.471647083944932e-02   +3.330624845635904e-02   +5.255234610215518e-03   -4.751686037753632e-02   +7.980161938207201e-03   +1.101612752067962e-02   -3.850457958264206e-03   +3.853961496275940e-02   +5.119558144423975e-02   +5.144538386194035e-02; +3.136691501485627e-02   +9.220661235324176e-02   +2.480385282801639e-02   +3.947202468764192e-02   +5.435429516537631e-02   -1.133570456965157e-02   -7.806398997487635e-03   -3.859940736214409e-02   -4.154259884156382e-03   -9.143439286466007e-03   +9.610733606819577e-03   +8.789234447891188e-03   +4.983301327386775e-03   +5.176756417493108e-02   +6.239432649762508e-02   -3.045308583389997e-03; -1.622257807302721e-02   +1.250171612725895e-02   -6.495495792643465e-03   +6.803754263234427e-02   -1.045789172749709e-02   +6.843922035332145e-02   +7.664313961492612e-02   -3.201034573339565e-02   +1.724159060104741e-02   +3.473018206883706e-02   +2.693397814583444e-03   +6.428311393220875e-03   -3.678393119271179e-02   +3.871787173183024e-02   +4.559577377888895e-03   +1.516840276957289e-02; -4.317760136282137e-02   +7.371457864102857e-02   -1.557801769829469e-03   -2.863268763858516e-02   +1.127365081622222e-02   -4.619847556625837e-02   -8.556671584189220e-03   +5.888384524582797e-03   +2.618401816149243e-02   -7.081682845782050e-02   +4.427908371477592e-02   -3.408307255330142e-02   -3.441270109331307e-02   -2.373666538624466e-02   +9.760742868594725e-03   -4.005202357580489e-03; +1.625124001164629e-02   -1.827793234249455e-02   -1.368062139989816e-02   +5.795268537904377e-02   +7.835964267625666e-02   +8.157436514823639e-02   -7.330575721100922e-02   +2.056111628364808e-02   -2.710713759803138e-02   -1.263198189459202e-02   +2.817823445308905e-02   +2.474982426507684e-02   -2.150926371145842e-02   +7.782505702902390e-03   -7.655031584844262e-02   +2.079117664590292e-02; +7.316745840187862e-02   -9.560733700461987e-03   +3.536516265829078e-02   -2.473711847921740e-02   +2.728098440820895e-03   +7.791450164247511e-02   +4.716207355048876e-02   -2.570698403953737e-02   +7.441999120226245e-02   +1.980891386101203e-02   +6.154099835561819e-02   +7.822903570215228e-02   +7.718290753872874e-02   -4.155399465693842e-02   +8.697322691058931e-02   -1.060894434684873e-02; +1.176392940766361e-02   +1.149785409971156e-02   +5.823714593653999e-02   +5.611777654714582e-02   +6.761363071423043e-02   +3.471738414164081e-02   -7.827730773207336e-04   +8.160276801023270e-02   +5.685932559197855e-02   -1.169016061588593e-02   -9.553599446565331e-02   +2.842274491645967e-02   -4.525173831363904e-02   +8.730488939688405e-02   -3.686238291422680e-02   +6.113440408578905e-03; +1.857100398905825e-02   +2.313114315675515e-02   -3.849133737250444e-03   +1.001701436057520e-02   +3.336882613288719e-02   +3.168042297797381e-02   +3.395906281387708e-02   +2.317186117484981e-03   +5.069900027928437e-02   -1.933157383430119e-02   +6.722585324114193e-02   +8.409854625696132e-02   -1.203207690930593e-02   -1.415759526460364e-04   -7.256379731939609e-02   -2.542765155207749e-02; -2.420651864562909e-02   -2.880360548462867e-02   +2.951065371070403e-02   -8.565614762690117e-02   -2.665973076924034e-02   -5.925135669835792e-02   +3.043318331562993e-02   +3.646789425462114e-02   -2.184599269612635e-02   +8.560032911130146e-02   +9.656050890365933e-02   +4.791198567282307e-02   -5.850125709382162e-02   +4.983901351614346e-02   +3.401855260534770e-02   +7.051084355175148e-03; +4.479383937949684e-02   +5.602799290676801e-02   +4.090742688889435e-03   -3.755866624108140e-02   +8.274304904217430e-02   +4.426277422989430e-02   +1.332210350658294e-01   +7.258533381691126e-03   +3.335500758021503e-02   -1.760512035307804e-02   +5.504031539446506e-02   +2.367468985379843e-02   +1.417609528335204e-02   +3.883640295321308e-02   +1.410554856427930e-02   +1.216859581098560e-02; +4.059266405302960e-02   +4.549823169021214e-02   -2.419659413866926e-02   +2.257324380974124e-02   -1.540551712622509e-02   +7.009717139869777e-02   +6.859797098908990e-02   -3.839170826627723e-03   +1.907769341225540e-02   -1.888849728502134e-02   -3.683720316329814e-02   +9.265166836248924e-03   -1.039573865416203e-02   +4.402649998017086e-02   +5.859319680132864e-02   +6.278799024309661e-02; +7.206539661959406e-02   +5.854200504093892e-02   -4.777458795701543e-02   -8.569902957794969e-03   -2.447133654458727e-02   -6.796984914596550e-03   +6.562371259154766e-02   -1.316827062822913e-02   +6.005580491384255e-02   +2.442900840815659e-02   -1.930520147913720e-02   -3.613322688654332e-02   +2.413280468102534e-02   -9.925782403829353e-03   +4.418809048773148e-02   +6.247183406266383e-02; +6.000877820807821e-02   -1.283381489518007e-02   -2.625657420669403e-02   -4.527888961847487e-02   +2.088300701532436e-02   +4.554161875571201e-02   +5.818506045338186e-02   +7.292482066807610e-02   -4.984293090520934e-02   +4.614474220156606e-02   +1.692466655579120e-02   -5.078313834725741e-02   -6.415911611927823e-02   -2.514266705162170e-02   +3.955307261814382e-02   +6.050002572845175e-02; -8.168588184447422e-03   +2.310319344424304e-02   +1.071748103601558e-02   +1.073955246603729e-01   +4.852121133397959e-02   -2.299494680859129e-02   +1.172099602882944e-03   -3.052707884679185e-03   -9.595638651556886e-02   +2.767644356752438e-02   +1.264169068986752e-02   +4.383563876778680e-02   -6.374139161612691e-02   +3.125733049908610e-02   +3.461078979120935e-02   +1.660579129978903e-02; +5.651765698173201e-02   +2.733532129762645e-02   +8.014256498786863e-02   +1.005475371490729e-01   +5.955610042341777e-02   +6.384568362144495e-02   +6.281259719774572e-02   -7.862296765428455e-03   -9.203028396906770e-03   -4.548370206652776e-02   -1.419130044419614e-02   +4.191603325536965e-02   -4.250082543066079e-02   -4.171128405144097e-02   -1.762689662868592e-02   +3.905843459436784e-02];
L1E_L1I_iGABA_netcon = [-7.464334432081347e-02   +1.682867149646070e-02   +4.422858164972898e-02   -3.889271593634763e-04   -5.679775678507305e-02   +5.150580173159928e-02   +2.946239830958928e-02   +3.781400492861761e-02   -4.931497328678638e-02   +3.771905775136659e-02   +5.748799951421711e-03   -6.304288496061025e-03   +5.243350218036143e-02   +5.547716464195614e-02   -3.938789475932617e-03   +9.021898246549215e-03; +7.821225453773605e-02   -3.022726062244575e-02   +6.415899413706050e-03   -2.790691836909356e-02   -4.173847210733057e-02   -4.592838529912437e-02   +7.299276155637414e-02   +3.949759020891987e-02   +3.064615395433655e-02   +2.657985226682528e-02   +1.873521792511724e-02   -2.958136851758383e-02   +1.743831856691037e-02   -3.390723493393719e-02   +2.309186192959350e-02   -1.720769687370435e-02; +3.090356656258971e-02   -2.294392216079518e-03   +1.073468853303511e-02   +3.005253923648181e-02   -4.940594485215098e-02   +2.800815944792901e-02   -1.228665281915689e-03   -5.050618029846429e-03   +1.023308189001531e-02   -4.574086200408460e-03   +1.059270242123403e-02   +1.407231533285624e-01   +7.689832808308410e-02   +2.999520633212268e-02   -3.548377705930323e-02   -1.887031033921074e-02; +8.084033267119635e-02   +1.219375365789583e-02   +5.785313641195017e-02   -3.709676957280610e-02   +6.770364490827982e-02   +1.732628801813745e-02   -1.220031570083888e-02   +3.913095961288256e-02   +3.830841155937176e-02   +1.020452330524581e-02   +4.022215650807421e-04   -6.229954779649310e-02   -2.578848806429153e-02   +3.078193550520977e-02   +6.898493364065783e-02   +4.826230946063253e-03; +1.561793856346281e-02   -9.016756336258020e-04   +3.010734617262589e-02   +3.836135475358276e-02   +4.236262385243170e-03   +3.956509468080014e-03   +4.511170542107964e-02   -1.061561642049679e-02   +2.650398014294053e-03   -1.775947082165403e-02   -2.852132558615079e-02   -5.213695790358545e-02   +7.326346504453435e-02   +2.448228139605111e-02   -1.175119931667678e-03   -4.989920813456243e-02; +3.809961877205645e-02   -3.088160415493545e-02   +5.655777739043899e-02   -8.014466846828520e-02   +1.548892131894600e-02   -1.461201262829598e-02   +6.738677323825233e-02   +1.263144561286931e-02   +3.581647787511043e-02   -6.161958825315758e-02   +5.176648415483254e-03   -4.943464565519215e-03   -6.299510250717054e-03   +2.035580440346330e-02   -4.276590416255149e-02   +3.483509383034790e-02; +2.947963460840686e-02   +3.004665971505177e-02   -1.722349896469728e-02   +4.900559704627906e-02   +9.300528485861451e-02   +4.864054452975501e-03   +1.301129320929777e-02   -2.809249622518287e-02   -2.340240321429611e-02   +5.388916263258874e-02   -1.497785124722731e-02   -4.330675124398667e-02   +7.765626805909220e-02   -2.838069969828926e-02   +3.971361729422018e-03   +1.305816224214137e-02; -5.464810313289201e-03   -1.932872893037459e-02   +3.241590109056468e-03   -1.794257113220283e-02   -5.375335961466161e-03   -2.349399801606835e-04   +7.655355573031064e-02   +2.128023081573146e-02   +3.193821230151707e-02   +5.832852818385068e-02   -1.648388811879211e-02   +2.236502451713891e-02   -2.923250447988250e-02   +1.409297204442957e-02   -2.196608562194235e-02   +1.625614032400775e-02; +1.174014682143021e-02   -5.008504152962830e-03   +7.894088011498761e-03   +3.386089344258940e-02   -1.248057233667960e-02   +1.258925691625936e-02   +6.293671313595164e-02   +6.846001079241433e-03   +4.506851419566537e-02   -2.231127967206278e-02   +1.185216820080166e-02   -3.909833229539379e-02   +5.577285690490107e-02   +4.692605258966343e-02   +5.908301084863610e-02   +6.204840423452552e-02; -4.307889554423870e-02   -4.426942792444855e-02   +2.343683525529175e-02   +7.361403552024828e-02   -3.497667749851426e-02   +4.161828894489517e-03   -1.051255973239979e-02   +4.808904760022207e-02   -3.836308604975251e-04   +2.625560392318760e-02   +4.495045618516842e-02   +1.042688162021817e-02   +4.056735646593331e-02   -1.681725582850153e-02   +6.212530576033276e-02   +3.361730973021951e-02; -7.205293492031520e-03   -1.328885216455598e-02   -3.537042143117451e-03   +1.011021122777477e-02   -4.663649386294545e-03   -6.261316057648100e-03   -1.224499549139967e-02   -3.264793692545557e-02   +4.626671203186768e-02   -9.062111491600539e-03   +3.714058699706681e-02   +5.684101196433486e-03   +6.360506397918482e-03   -2.802816099993623e-03   +5.620590494917403e-02   -4.326411404690834e-02; -7.488342916314216e-03   -8.856158790515444e-04   +9.076841035637115e-03   +3.351519386481046e-02   -5.819699620678927e-02   +3.889991734817592e-02   +1.496105744944774e-02   +1.018356971534328e-02   -5.672538161775665e-03   +5.746967379908349e-02   +4.019445612621568e-03   -4.260316520759770e-02   +7.036917029772363e-02   +6.143911670745977e-02   +2.873812975237404e-03   +4.326754852143788e-02; +4.943444748032558e-02   +2.072928487858951e-02   -1.127037510798858e-02   -5.663121752689029e-03   +5.017825569121847e-02   +2.221451274196560e-02   +4.287630400406485e-02   +8.296761290256474e-02   +9.196081827247179e-02   -6.364784427344472e-02   -1.175264513553139e-02   +2.916806817458598e-02   +3.711572796499725e-03   +3.483366410626014e-02   -3.634849188038522e-02   -8.429863648425965e-03; +1.071111932716812e-01   +3.427149338993797e-02   -4.278750263125826e-03   +1.578972894420128e-03   -1.528054498468214e-02   +3.388123240838033e-02   +6.402415307027788e-02   -1.540558635470631e-02   -5.319374734645817e-02   -5.664755663693277e-02   +2.359415226645008e-02   -4.229821529037443e-02   +1.860308465310452e-02   -4.381708238926774e-02   -2.325160933298045e-02   -3.013245774240571e-03; +6.916979190676441e-03   -2.916738734219053e-02   +1.889392172981533e-02   -3.594988032687824e-02   +1.431091777650490e-02   +3.512973407453309e-03   +5.621765424940204e-03   +2.005074138396405e-02   -2.950578005879459e-02   +8.027015502917911e-02   +6.333015532924365e-03   +8.136345239246659e-02   +6.165013707648431e-02   -2.183317662144748e-02   +8.959474764355926e-04   +2.450198085786911e-02; -2.539312417909098e-02   +1.353287812260391e-03   +2.783406166842532e-02   -5.499757894851226e-02   -1.514666457410566e-03   +9.314434858945946e-02   +1.419918755150974e-02   +1.213740826810613e-03   +2.025059302557804e-02   +5.460251051508003e-02   +3.312927019016992e-03   -8.437709884422578e-03   +2.868000397491340e-02   -4.567814701035575e-02   +2.164134430820704e-02   +3.828669072276085e-03];
L2I_L1I_iGABA_netcon = [+3.386508577744144e-02   +2.369946377560986e-02   +1.006653596991118e-01   +4.602064315177461e-02   -2.713207480115301e-02   -7.383599198307074e-02   +3.941032509840810e-02   +4.641314481650861e-02; +5.886506892347054e-02   +6.485831109283088e-03   +4.423105604825826e-02   -5.971938287591382e-02   +6.853335715825200e-02   +1.934442313102368e-02   +1.465375036737741e-02   +1.155814775088699e-02; -3.786225191518643e-02   +1.188533079753164e-02   -6.748432581431853e-02   +6.240176803999778e-02   -3.012852527439696e-02   +2.620433465084276e-02   -4.031525420036660e-03   -4.430788827955769e-03; +2.093277660656053e-02   -6.328929975509828e-02   +6.273835379624834e-02   -3.821549243831864e-02   +2.494268467702489e-03   +5.078352453534191e-02   +4.936181177157857e-02   +1.203903330580229e-01; -5.612221523807800e-02   +3.290092635642845e-02   +5.792553870656829e-02   -1.578352942843567e-02   -3.281390953301312e-02   -2.912840602598585e-02   -3.817619577810891e-02   -3.138977105317277e-03; +4.521399797421487e-03   +5.793922004179051e-03   +4.945072256360820e-02   +4.965169212312041e-02   +1.474987747296440e-02   +3.622834401447648e-02   -3.677779289421088e-02   -2.825210965255956e-02; +5.018861271288475e-02   +2.794453405665568e-03   -1.827641414230089e-02   +3.272886539732052e-02   +5.094646772283824e-02   +8.461527235137252e-03   +4.996624521063595e-02   +1.253138532009627e-02; +5.944367024052579e-02   -2.687021255269551e-02   +8.997896126580151e-03   +9.904124761845035e-02   +7.995348390420806e-02   +2.143775842001816e-02   +3.990956358729486e-02   +7.004222751381282e-02; +2.538932874417156e-03   -6.675018061808502e-04   +5.950335103544785e-03   -1.551638353298694e-02   +2.524767573841284e-02   +1.376324546228519e-03   -2.029536148129032e-03   +1.022671705843760e-01; +2.253674659681741e-02   +5.994470440662135e-03   +4.224779704370192e-03   +3.306631041431918e-02   +3.462438836841925e-02   -1.339066454384688e-02   -6.028751466277407e-03   -1.224359725587747e-02; +7.758822657297497e-03   -3.826228443516792e-02   +2.657061897220881e-02   +3.410659138227429e-02   +1.367642436614016e-02   -3.127188125160006e-02   +3.632076974066278e-02   +3.861400203262842e-02; +7.381258682241539e-02   +6.704143931837120e-02   -2.726158192859468e-02   -4.775767536532353e-02   -2.679564216359951e-02   +6.102204290364698e-03   +7.132592161510918e-04   +1.929257987788455e-03; -3.519920589987306e-02   +9.722307482937715e-03   +7.761415892511483e-02   +5.209655156745248e-02   +4.304524833873448e-02   -2.101842204084935e-02   +7.156280746702526e-02   -9.479445433144338e-03; +1.994271047922422e-02   +1.109161325730246e-01   -5.960696554736341e-02   +3.661595867232057e-02   +2.520481184160621e-02   -2.097083461942584e-02   +8.616551205628254e-03   -2.940368661921628e-02; +3.208455353951492e-02   +1.703577598271824e-02   +4.087669521992090e-02   -1.517334117252889e-02   -3.531607218091645e-02   +4.170763680646130e-03   -3.324589382810438e-02   +9.583957165783166e-04; +2.625461038757039e-02   -4.202218646598550e-02   +1.008963943482510e-02   +2.682020870886677e-02   +1.042550208210420e-01   +2.678795659306987e-02   +3.746300958020356e-02   +5.215546141207662e-02];
L1I_L2I_iGABA_netcon = [-2.828845134510773e-02   +6.145192918576362e-02   -4.019939567198742e-02   -3.108309521274047e-02   +6.187346939396461e-03   -5.427597467502060e-02   -2.060008601765121e-02   +1.476036247711521e-02   +4.489557550614118e-02   +4.328270437993277e-02   +5.729851128252744e-02   +1.646193060961832e-02   -3.997263829262869e-02   +1.372557666920809e-02   +5.237409108385695e-03   -1.208737345054373e-02; +7.940006720970128e-04   +2.533904736193866e-02   +9.000124172078350e-02   +8.445391479508702e-02   +1.001925757798252e-03   +1.482832778705392e-02   -5.735700603429494e-03   +4.875244901391400e-02   +5.412873465885219e-02   +1.740989179330965e-02   +6.655665779052996e-03   -4.106646986678106e-02   +2.610296751668292e-02   +1.745026886748700e-02   +3.280265884060005e-02   +7.372364163260157e-02; +2.257519354570713e-03   +1.763736462351397e-02   +3.675891716218947e-02   +1.094169119704209e-02   +7.709142398852974e-02   -1.381250596875485e-02   +3.528838448962295e-02   +2.145916380681631e-03   -1.033799914952133e-02   +3.119391276543847e-02   +1.811172643021348e-02   +1.079316086704677e-02   +3.958264050915290e-03   -3.107594748457767e-03   +1.548966912175679e-02   -3.747217216095086e-03; -2.698281781611678e-02   -7.464917953462626e-03   -7.535742019173135e-02   +1.370131895949270e-02   +2.896167814389482e-02   +9.105940808059490e-02   +4.659837578212263e-02   +5.017627312929430e-02   +3.056242286540842e-02   +2.105926815300113e-02   +4.798407029856999e-02   -1.647715703501202e-02   +2.984524723528142e-02   +9.013012218730184e-03   +4.171466093620499e-02   +1.247594756747929e-02; -1.701620923365993e-02   +7.748926553245742e-03   +4.124374897816105e-02   -4.295512322829373e-02   -3.144608154914953e-02   -5.147539129555411e-03   -6.584950037951084e-02   +1.877371794910729e-02   -1.276620405426569e-02   +8.347982578400111e-03   +4.791448895757786e-02   -1.411832585626266e-02   +4.133879713103232e-02   +4.087677994100419e-02   +5.770129912794417e-02   +7.382828149418152e-02; -1.081473025442729e-02   -2.965558648466042e-02   -3.627059182339316e-02   +7.719210605990862e-02   +5.242296731690237e-02   +1.143614642450149e-02   +1.289746835187097e-02   +1.588722157809754e-02   -9.932536893967628e-03   +5.359480310809076e-02   -1.852484723216683e-02   -2.400802602426857e-02   +4.377080254458647e-02   +7.713638077602573e-02   -5.059686333347888e-02   +5.622795362941925e-02; +1.600975329943826e-02   +3.855875970495538e-03   +3.515723616543928e-02   -4.355010994820187e-02   -7.084486063759192e-03   -3.177113213544844e-02   +1.139935814682705e-02   -2.107832105899621e-03   -4.561639541310981e-02   -8.639029047220272e-02   +7.986716721309881e-02   -5.979614807092954e-03   +1.930133268799164e-02   +2.170757143053890e-02   +8.862934621522045e-03   -3.769527820855152e-02; -1.109040985144672e-02   +7.696643467493386e-02   -1.162691111647098e-02   -8.757315996548925e-03   +5.990151435511241e-02   -3.376283493647311e-02   +4.658267577824986e-02   +6.733010186867207e-02   +8.062830431560938e-02   +3.653624865697533e-02   +6.805067645610664e-04   +2.397737126822205e-02   +2.139868151189052e-02   +6.593194885599470e-02   +1.619025068595262e-02   +4.397915233907852e-02];
L2E_L1E_iAMPA_netcon = [-1.504679116510539e-02   +4.394884889557725e-02   -2.647500694225756e-04   +2.231164731833547e-02   -3.687169339564772e-02   -4.367443360734725e-02   -2.397941066472736e-02   -4.380105576378489e-02; +1.989333909209318e-02   +1.021582444115300e-01   -7.392316911523039e-02   +6.484414022610085e-03   -1.476787613116448e-02   +1.071715360917691e-02   +4.891594776778595e-02   +1.793016689010420e-02; +3.689722922194291e-02   -2.744102318279869e-02   +1.243736035258710e-01   +7.145883344610647e-02   +9.433235664264312e-03   +5.765493638793183e-02   -6.026927734080581e-03   -4.461963486541433e-02; +5.701430932836333e-02   +2.628925162333802e-02   +5.947981858819913e-02   +3.481741292237606e-02   +3.946508146937890e-02   -6.722769901327682e-03   +2.572108430733390e-02   -3.896957592621328e-02; +1.022811503389436e-01   +4.310659429485308e-02   +6.578749329054906e-02   -3.209479540968346e-02   +1.899913153735230e-02   -1.067816282874460e-02   -2.088135233000234e-02   +4.702159077597377e-02; +7.589715697265632e-03   +8.383928791973501e-02   -2.135888932289907e-02   -4.365109847316234e-02   -3.946968771314902e-02   +8.933599650245133e-02   +7.045987213444208e-02   -3.941432653457722e-02; +8.552599780282698e-02   -4.074188992423036e-02   -5.063456547037648e-02   +2.981743102228822e-03   -1.963071509543524e-02   +3.231929173743448e-02   +6.572976231281003e-02   -5.773595948244778e-03; +5.985090211162299e-02   +4.269175902959409e-02   -3.216436353822788e-02   +2.759203704788005e-02   +4.567220608801985e-02   +6.219232928419902e-03   +3.305741705591029e-02   -4.417974652666817e-02; +6.468661655875957e-02   -2.857006939979015e-03   +5.371708741044308e-02   +2.137150501372805e-02   -3.063906633372127e-03   +1.337789516896501e-02   -2.381453431150232e-02   +1.132512834466768e-01; +5.854208593498082e-03   +7.505046441778726e-02   +1.119609558691177e-02   +6.101747062136468e-02   +8.639396456929363e-02   -6.822743471192610e-02   -3.811688746844417e-02   +1.326137703218331e-02; +4.417858821476142e-02   +5.757209695668087e-02   +2.456717224151385e-02   -1.551309403186009e-03   +1.190611152561425e-01   +5.144703667815954e-03   -2.070901052796407e-02   -5.061856610705758e-02; +1.415346684114898e-02   +5.579170720223809e-04   -4.878117615543962e-02   +4.862317045541131e-02   -1.433390337305484e-02   -1.035008250303284e-02   -3.724637884616602e-03   -2.781811365173277e-02; +6.122661932407684e-02   +4.806167823958356e-03   +1.816277955899511e-02   -2.616050266448650e-02   +5.890414676042526e-02   -6.276323822236093e-02   -2.929169759065583e-02   -2.237365438907402e-02; +5.742787642972662e-02   +4.873215519118961e-02   -5.997823496826434e-02   -2.802732873806931e-02   +2.599022013779570e-02   +6.800118262041664e-02   +1.054143559688703e-02   +2.803052488188611e-03; -5.457728110408382e-02   +5.214605000850035e-02   +1.726914006199878e-02   -1.379711599386496e-03   +2.336590455544721e-02   +1.302812566833166e-02   -1.712399806839965e-02   +4.348037800283831e-02; +1.944781961227096e-02   +4.622065452971996e-02   +2.444427595927689e-02   -4.681161272039589e-02   +3.970519065011147e-02   +5.807807639990331e-02   +2.375438831741784e-02   -6.271739710965692e-03];
L1E_L2E_iAMPA_netcon = [+6.789218232984630e-03   -1.095124989253066e-02   +3.017667431894036e-03   -7.017671919151811e-02   +2.539923926262243e-02   +5.509746140056908e-02   +3.911547826041473e-02   +5.029635165765933e-02   +1.925486822537003e-02   +2.364286657010498e-02   -1.520130770806064e-02   -5.640897903526854e-02   +5.111971800825334e-02   -5.126322716830647e-02   +1.157486907456127e-01   +3.671943323244842e-02; +5.411703547114274e-02   +1.254778512367066e-02   -4.062092850155787e-02   +7.064249796535993e-03   -4.130857034383084e-03   -6.843741972650469e-02   +3.591659040130221e-02   +3.948191256069366e-03   +1.217221071954306e-03   -7.426705883283898e-03   +1.289197134761411e-02   +2.415493086445537e-02   -1.676087251967461e-02   +3.388885542450483e-02   -9.830225117667624e-03   +2.077758075344857e-02; -5.265134614874314e-03   +3.334375705333568e-02   +8.199646152402764e-03   -2.842771532876164e-02   -6.570699624592266e-02   +6.468350310892235e-03   -5.898230575122789e-02   +2.426507441678624e-02   -5.270269244140135e-03   +1.212505855743621e-02   +8.171419839312569e-02   -2.134066198292972e-02   -4.529160823235018e-02   -6.607003684100521e-03   +4.351102783238343e-02   -2.053053945810865e-03; +2.333515368831426e-02   +5.496984649150108e-02   -1.744171531562196e-02   -8.067679760219354e-03   +6.360886811556639e-02   -4.056785626278336e-02   -7.989071551464732e-03   +1.033350253415413e-02   +5.141084444109316e-02   +8.310246628160470e-02   +4.788524823700646e-02   -6.089943513929955e-02   +9.411890150380754e-02   +2.507683180398525e-02   +8.109087017707482e-04   -1.079006723888338e-02; -2.026379300788008e-02   +1.208917688930109e-02   +3.413877015068867e-02   +3.049222866718626e-02   +1.513504029081205e-02   -3.670505407885601e-03   +1.905024987996719e-02   +2.277040215136563e-02   -2.305107650749432e-02   +3.478687423987170e-02   +2.373145468703233e-02   +8.049259659019638e-02   +3.870713693303188e-02   -9.172694620112418e-04   +1.248248615829323e-02   +2.335090588765270e-02; -1.084365388348022e-02   +6.130462850945980e-03   +5.771214009928430e-05   +1.737210591012250e-02   +2.792901893846214e-02   +5.268068275203655e-02   +2.592839278747941e-02   -9.940833384271182e-03   +7.087761687763250e-02   +3.243446137584201e-02   +3.918196594838956e-02   +4.773150689262386e-02   -7.617077654068081e-03   +2.349246864400939e-02   +1.174000491736503e-02   +1.617296749163059e-02; +7.915355668464620e-02   +3.222625182809682e-02   -3.738221975313935e-02   -5.158344911070945e-02   +2.772709215227471e-02   +8.165737389858460e-02   +3.891999764146237e-02   +1.975875938559972e-02   -2.351642898821581e-02   -3.641398080197412e-02   -1.384405676133082e-02   +1.666533198916510e-03   +1.612203163540931e-02   -7.478703244576755e-02   +3.657455924672076e-02   +8.816981841384389e-03; +6.950543918471999e-02   +6.503840127729835e-02   +3.788388485027566e-02   +1.569922019063555e-02   +4.261959220918592e-02   -2.388375344338577e-03   +1.135628129510256e-02   +9.710138453103024e-03   +1.250266667838332e-02   +4.068795305212039e-02   +1.000340973825038e-01   -4.766241701182228e-02   +2.761588843296310e-03   -1.207566354406012e-02   +4.971287966448715e-02   +8.261349347055782e-02];
L2I_L2E_iAMPA_netcon = [+1.322496578932396e-03   -6.413679284921116e-04   +4.197572831787853e-02   +2.391759449386770e-02   +3.090652627468611e-02   -3.031336842125287e-02   -1.118694993644271e-02   +5.895046329435874e-02; +4.395845976158055e-02   +4.998592030376385e-02   +4.232865491321523e-02   -2.688344234366830e-02   +3.963524674589842e-02   -2.961744347839145e-02   +4.264845180526391e-02   +8.331338483315250e-02; +3.433138884185549e-02   +1.510329638816839e-02   +2.188098918723892e-02   -3.502387885113369e-02   +9.481443618569674e-03   +8.806794831592146e-03   +4.485071853003369e-02   -9.844571498180878e-04; +6.487427311860313e-03   +3.240052958065785e-02   -4.336108294844148e-02   +4.781305034354631e-02   -8.553198081617807e-04   -2.483546882019690e-02   -4.986715437380003e-02   +5.396909211779220e-02; +1.383552858949534e-01   +6.883206051072766e-02   +1.033121451412313e-02   +3.599635351983648e-02   +7.876005008630182e-02   +8.208533890820396e-02   -9.449977023455116e-03   +7.517719416233620e-02; +3.259960179448659e-02   +1.821683407891724e-02   +2.896782793853100e-02   -1.451985334373258e-03   +1.065568066654098e-03   +5.512210686596434e-02   -2.264727086334842e-02   +3.335394477059441e-02; +6.443938898616627e-02   +5.455798867210777e-02   +9.407447991349373e-03   +3.061588982431993e-02   -4.968600883113768e-02   +4.548165299811639e-02   +1.081787916386175e-01   +7.023008383893358e-03; +8.918832774880180e-02   +6.029475147601665e-02   +7.292395294269728e-02   -4.096533366190917e-02   +1.464242769386868e-02   -4.296511852235717e-02   +3.027907352673620e-02   +4.729432454101936e-02];
L2E_L2I_iGABA_netcon = [+6.110231130760056e-02   -9.209062245092664e-03   +6.290605416904194e-02   +4.290485198542036e-02   -5.617690449750119e-02   +4.098480158158119e-02   -1.757237763223571e-02   +6.530850465272695e-02; +2.569742593964492e-02   +5.399371099356819e-02   -8.635225502691839e-03   +1.864496316946031e-02   +1.200685987676700e-02   +6.112053093341754e-02   -1.546769448422974e-02   -1.483669807392883e-02; +3.527050618530877e-02   +4.954466868117659e-02   -1.997047413674148e-02   +5.301958183738550e-02   +2.092499514037084e-02   -2.178202270821999e-02   +2.554650382987550e-02   +2.788955454623774e-03; -6.436323830575923e-02   +1.154860989475058e-02   -3.601393909869991e-02   -2.626131195852494e-02   -3.936242378473968e-02   +4.133860566164455e-02   +9.136332813087679e-03   +6.159044770373684e-02; +1.344343813136931e-02   +6.268073868166232e-02   +2.130834250306493e-02   +5.295085332533693e-03   +1.071008667126768e-01   +3.749078888916161e-02   +4.587172857167254e-02   +6.858617222948937e-02; -1.525596323529057e-02   +4.569768814298610e-03   -7.099252515735661e-03   +1.676789785367749e-02   +1.054274926698640e-02   -2.444205723259375e-02   +5.169420322041977e-02   +6.065705264175671e-02; +9.811078321629584e-02   -1.040395201625114e-01   +8.885118606883232e-03   +1.888075483952008e-02   -1.172838166988789e-02   -1.042282396243803e-02   +5.088411253679558e-03   +8.650715627430893e-03; +4.103303234363154e-02   -1.378946574467487e-02   +3.237639758300229e-02   +3.778082554333320e-02   +1.529885068984197e-02   +7.424244697194773e-02   -1.837435419454453e-02   +3.905818633726971e-02];
L3E_L2E_iAMPA_netcon = [+2.207939689614954e-02   +1.617317092027039e-02   +1.901836245195498e-02   +1.277531852627752e-02   +5.655564978307257e-02   +5.522814757940002e-02   +4.904306918601960e-02   +7.119552596514005e-02   -9.952224778667846e-03   +2.608074001821846e-02   -6.933078461880925e-04   +3.309278051398502e-02; +1.051916072082753e-02   +3.814211701284093e-02   -5.404422662089853e-02   -5.571227225783181e-02   +1.387206794260714e-02   -3.448097650426019e-04   -1.232741448236759e-02   +3.209716733369428e-02   +3.950420686743712e-02   -2.971232483981625e-02   +3.148001459860582e-02   -5.227513613321596e-03; -4.182169290297349e-03   +8.051578695536701e-03   +4.679117958695815e-03   +8.724572393837383e-03   -7.117211724827051e-03   -4.570076407293248e-02   +5.660663883348066e-02   -4.681141852982737e-02   +2.492545579196027e-02   -9.426139834793207e-04   +3.980289070054836e-02   +2.292001654169476e-02; +3.989986035147168e-02   +2.297636156521749e-03   -5.654150712484649e-02   +9.446136716514095e-02   +6.332229134363132e-02   -3.924891261366081e-02   +4.388058329401284e-03   +5.158980046115951e-02   +2.949539253823647e-03   +3.323304157237018e-02   +1.868730445529167e-02   -2.229863228663065e-02; -2.360549569701666e-02   +1.994436077633746e-02   -7.951261005745908e-03   +5.196642405146924e-02   -1.143740893913458e-03   +1.984478566501049e-02   -1.280243673976113e-02   -7.267346156787818e-02   +2.708969577655617e-02   -3.901162509979606e-02   +2.229129201488427e-02   -1.491735982196972e-02; +1.713692882250292e-02   +3.520870893974163e-02   -3.640281911697821e-02   +7.200117003553536e-03   +7.709101578456158e-02   +5.116476319794757e-03   +6.174599724996671e-02   -3.241776252521619e-02   +3.758723699489844e-02   +3.293840306011795e-02   -9.948999493637074e-03   -1.294168248774372e-02; +5.224927675039658e-02   +7.016098304829872e-02   +7.228239976673531e-04   -4.092340641963116e-02   -5.434314505207451e-02   -6.432341398981281e-03   -4.602022370753339e-03   +7.285385669943968e-02   +6.151799656136882e-02   -3.855182019722053e-02   +4.576312128422505e-02   -1.295123097869951e-02; +8.147972447908329e-02   +1.713687834034446e-02   +1.090581293442518e-02   +1.890523900814328e-03   -3.600878535568224e-02   +3.346722909971366e-02   +3.009894443092425e-02   +8.508718380904624e-03   +1.133955725532391e-02   +1.048440000696662e-02   -1.593070717878019e-02   +4.398638574895627e-02];
L3I_L2I_iGABA_netcon = [-2.894461601004648e-03   -1.899286790556942e-02   +3.483361161566398e-02   +7.622087925184717e-02   -3.096728723179193e-02   +5.591987155464388e-04   -4.281155330817365e-02   +1.383269137180596e-02   +3.095691822190219e-02   +1.437761438721093e-02   +2.656852826890680e-02   +6.028070042892086e-02; +6.209664715685008e-02   +2.045495759067267e-02   +6.902187554558326e-02   +4.190169109520286e-02   +9.591344310781458e-03   +2.576304822041629e-02   +8.914263277078128e-03   +3.764554222996973e-02   -6.515122531771343e-02   +1.508754395757317e-04   +2.032366271839679e-02   -1.943198076153781e-03; -1.496860170283056e-02   +1.446245143132480e-02   -4.690912824522026e-02   +3.818396177464756e-02   +4.151053849336522e-02   +1.263603366868967e-02   +3.419194577910209e-02   +9.304393767318089e-03   +8.625988289980811e-04   +4.358418400490070e-02   +1.694878043703775e-02   +1.139712410707181e-01; +5.143667369516458e-02   +2.839606720868067e-02   -1.970203813989889e-02   +6.141711541927511e-03   -1.348349991280400e-02   +5.855174299274426e-02   +5.024144855392983e-02   +2.949623126414469e-02   +1.038029687940471e-02   +1.755209377760062e-02   +1.383467098847080e-02   +4.849618695316137e-02; -2.986208073124031e-03   +5.106660712768399e-02   +4.835221296196927e-02   +9.728308174420901e-02   -3.728741257804578e-02   -3.199088217035426e-02   -1.571765725278354e-02   -1.343495879505561e-02   +1.431268747606060e-02   -7.175932873961707e-02   -2.131654177958849e-02   -7.499378539469869e-04; -7.510942509179694e-02   +3.797831575861486e-02   -1.372986868143956e-03   +4.067859731182547e-02   +3.181317469531564e-03   +9.654605842126775e-03   -3.281771980289633e-02   -4.238248015447079e-02   +3.157701353594786e-02   -9.313469717577424e-04   -1.028012661423715e-02   -5.214846018117132e-02; -9.861509590379017e-03   -9.917281002444506e-03   -4.730281010914626e-02   +4.664137206361531e-02   -1.197816375507501e-02   -2.321314555989304e-02   +7.117277193306623e-02   +7.628538849401109e-02   +8.019734034308859e-02   +5.823524264632399e-02   +9.220398567591760e-02   -2.301584574869027e-02; +2.400375578347196e-02   +1.943457477756333e-02   -3.553190367629049e-02   -5.127260740725492e-02   -1.825094165804008e-03   +3.657840985346925e-02   -1.767678596375541e-02   +1.195015017658548e-02   -1.135373679896834e-02   -7.505078760894825e-02   -1.492094565652599e-02   +4.871753747227434e-02];
L2E_L3E_iAMPA_netcon = [+4.032277294989746e-02   -8.722117708206696e-03   +5.376095103259253e-02   -2.365718970055921e-02   -6.115985507837286e-02   +2.123715528422757e-02   -7.485315673995591e-03   -2.789300472883773e-02; +1.202361506407720e-02   +5.711579501476577e-02   +4.379517775786815e-02   +2.486115836814176e-03   +8.010934824396498e-03   +1.624800448462125e-02   +2.986978489911517e-02   +2.112444827032678e-02; -2.986605804837174e-02   +3.087970291917900e-02   -1.891915215527768e-02   +2.614921199741665e-02   +2.538380060236524e-02   +3.461560686369442e-03   -3.249226825498281e-02   +4.920388739377602e-02; +4.243427372262772e-02   +6.407960179975253e-02   -2.921314657745160e-03   -2.101156705841643e-02   -5.398334042154099e-02   -2.967705073694584e-02   +2.884208429347504e-03   +1.074976223549078e-02; -4.779343290496280e-02   +5.434764455328372e-02   -8.252070866760983e-05   +1.939447270981472e-02   -2.590394835321633e-02   -3.088072770529833e-02   -1.953175010032054e-02   -2.072205962071845e-02; +5.970282946634389e-02   +3.282812998257238e-02   +2.583712218294803e-03   +4.812102002515869e-02   +1.893659944303491e-02   -6.857382122313482e-02   +2.168826991769915e-02   +7.947710419876834e-04; -1.046697324193646e-02   +1.823433086491891e-02   +3.871004088081476e-02   +2.824427207798751e-02   +1.983626987183219e-02   -9.137303850371065e-03   +1.589601849050053e-02   +6.142802177407240e-02; -1.106477022093423e-02   +6.316254526861122e-02   -3.729279602917651e-02   -9.380667189826580e-03   -3.848374903569873e-02   +4.135556520249518e-02   +4.659762417345835e-02   +4.483121046379568e-03; +1.087498372376797e-02   -2.729770140966063e-02   +1.633203179837323e-02   +7.195322558516681e-02   -3.812704228243437e-02   -1.428989911810058e-02   +4.903478745339385e-02   -2.753614322639587e-02; +9.076602452011775e-03   -1.071876196023303e-02   -2.743149942617214e-02   -3.926012681677567e-02   +2.688032386107090e-02   +4.777452567491038e-02   +1.603337931574442e-02   +1.062747681308395e-01; +2.328893701471323e-02   +3.685252056889488e-02   +1.425331764584569e-02   -4.929793635158304e-02   -5.624744884736567e-02   +9.747619421396573e-04   +1.178967789691405e-02   +4.382218814778071e-02; +6.884779971683715e-02   +4.106972403469918e-02   -5.862847562681558e-02   +3.424278046489958e-02   +8.143088198123493e-03   +5.417170489157908e-02   -2.161956545810825e-03   -4.049682076929568e-02];
L2I_L3I_iGABA_netcon = [+9.396287477987741e-02   -1.382751254249790e-03   +2.192502915447526e-02   +4.430533694627081e-02   +5.256470827330238e-02   -1.824333128571504e-02   +1.703860426300370e-03   -4.016811315074429e-02; +2.946419177103649e-02   +8.535557059872752e-02   +5.248686147933881e-02   +6.225795513895141e-02   +3.723629599344579e-03   +2.428011471022122e-02   -8.631012386303243e-03   +4.474458477643537e-02; -1.383512526526902e-02   +9.385035708942699e-02   -6.196170256786460e-02   -9.503291946279295e-03   +4.187124121266053e-02   +1.552405553635947e-02   +2.156308630527814e-02   +1.279858640875534e-02; -9.707568270572557e-05   -4.197793364909569e-02   +2.576121274309317e-02   +2.479525091327702e-02   -1.354095472863272e-02   +3.186908300940123e-02   +4.509586240869518e-02   +4.954653799323103e-02; -7.659505289327544e-02   +3.590904208999167e-02   +3.262521247481166e-02   +3.065821781565356e-02   +7.542090040608210e-03   -2.143001761527732e-02   +2.955848954311634e-02   +1.601752076340932e-02; -5.177297234045596e-02   +4.943741826177904e-02   -3.261906483698182e-03   +3.058365272171907e-02   +3.425614952145863e-02   +2.597998967245106e-02   -4.373264957388610e-03   +4.824739621813254e-02; +2.361689491334872e-02   +2.253833272033253e-02   -2.621285126217183e-02   +5.184959309772668e-02   +6.466034637779004e-02   +4.290369973683648e-02   +6.244703375216064e-04   -2.592072906961260e-02; +4.184825258392610e-02   +3.080107825513147e-02   -8.111439531619264e-03   +7.682938699956453e-02   +6.098350541255692e-03   +3.515734644501153e-02   +4.579854990040610e-02   +7.441763696632910e-02; +1.195176706413055e-02   +1.756188505448011e-02   +4.419506705950219e-02   -4.951840412595349e-03   +4.646739234882225e-02   -3.330120383283729e-02   -2.750526871583985e-02   +5.890492131312500e-02; +2.925353980503343e-02   +8.070684190774113e-03   +4.449960676763598e-02   +1.088647009761329e-02   +1.327631692323061e-02   +2.772323704302862e-02   +2.575892296568325e-02   -9.863607514706626e-03; -4.051808216920846e-02   -4.984470221898350e-02   +5.104250325213616e-03   +6.731656060559697e-02   +2.431332087826403e-02   +4.738956135656631e-02   -4.127314942186684e-02   -1.100640139370206e-02; +6.377932698776584e-02   -2.821181736097649e-02   +4.639031618010153e-02   +6.016107851187192e-02   +1.551920623348593e-02   +2.021689958201251e-02   +7.209390575168105e-02   +2.603969394111999e-02];
L3I_L3E_iAMPA_netcon = [-3.734661943091443e-02   -8.059851211384861e-03   -4.459981495604402e-02   +1.503011543858764e-02   -2.425673930969482e-02   -1.999101677310161e-02   +3.885070991053165e-02   +5.574872008054530e-02   +2.182003638481599e-02   -4.003814912570906e-02   -2.232162717693621e-02   +2.811154377084445e-02; +2.293421216682131e-02   -7.135644639112088e-02   -2.986441405833175e-02   -4.921812923189074e-02   +6.319778828758602e-02   +4.425378293047880e-02   -4.810153669178323e-02   +1.103678496590630e-02   +9.258300522935349e-02   -4.346215685065661e-03   +3.748623358029285e-02   -3.245688408547876e-02; +2.314557467155324e-02   +1.223746085608520e-01   +7.666229057698171e-02   +4.589038729460926e-03   +4.978579623673352e-02   +7.550673060932384e-02   +4.212532522862285e-02   +4.058084527797966e-02   -6.269473300568561e-03   -1.548891304910583e-02   -2.000641924380783e-03   -3.810863923529442e-02; +1.310185226800385e-02   -7.783544737581991e-02   -4.180990208189271e-03   -2.251046511425881e-02   +9.935948453907899e-03   +1.361987117739484e-02   +6.967547865782316e-02   -2.947946202829226e-02   -1.136755450781592e-02   -5.544757335962332e-03   +1.624107496837942e-02   -2.419928651524668e-02; +2.818852949396604e-02   +1.960459317211252e-02   +1.291763019640929e-03   +3.426835739721279e-02   -1.993733120150537e-02   -2.914673426135004e-02   +7.727683837278945e-02   -4.707006567133695e-02   -1.404811706387435e-02   -5.724029677643361e-03   +5.788322659747381e-02   +5.697563531722850e-02; +9.329347700414048e-02   -3.018261441424078e-02   +1.019734620845142e-01   +4.589242011005055e-02   +8.877339204209743e-02   -5.099682176228186e-02   +7.320605325825745e-03   +5.815267894430341e-02   +5.181466086327526e-02   +3.382038633585674e-04   +5.767500261259807e-02   -1.952126454762453e-02; -1.709807200878567e-02   +1.861489511091710e-03   -9.129159012726401e-04   -2.672030548996246e-02   +6.096026338277948e-02   +3.743313577613161e-04   +1.356920051312581e-02   +5.292121642183487e-02   -2.137366309243555e-02   -1.299744841170095e-02   -1.605539281080955e-03   -1.216440640824628e-02; -8.763989371889259e-03   +1.259128593604247e-02   -2.073837966654368e-02   -1.763793462598166e-02   +1.141866356584925e-03   +5.615768568385054e-02   -2.267427691197295e-02   -5.220800691294038e-02   +2.952689557636527e-02   +1.408950034316318e-02   +1.446752371518443e-02   -6.393744675560478e-02; +5.225838053639728e-03   -1.951286168651806e-03   -3.564880141403461e-02   +7.917364599464551e-03   +2.365405411198933e-02   -1.731284817799028e-02   +1.792940325959608e-02   +4.300754130733232e-02   -3.611549168512536e-02   +5.019826569704436e-02   -5.766741433444181e-02   +3.789131576811557e-02; +2.158665139500000e-02   -4.426440860898325e-02   +1.790966737738404e-02   -5.662937716437189e-02   -4.310315853172786e-02   +3.029150028053514e-02   +1.632580714373208e-03   +3.182387234215390e-02   +5.869452829422117e-03   -5.187878800026089e-02   -2.426234110353359e-02   +3.628845365773710e-02; +9.042010507156474e-03   +6.362962469425615e-02   -4.027181249338443e-02   +7.288244890792654e-02   +3.669340477619165e-02   +3.660970192662463e-02   +2.581750101736738e-02   +8.845941195388889e-02   +3.457214559710982e-02   -4.143277332161924e-02   -3.260651594506444e-02   +3.142287275924120e-02; -3.080105409972100e-02   +1.797285076480889e-02   +8.936460141286087e-03   +1.257019771026402e-02   -2.346124446835253e-02   +2.708157199667449e-02   +5.301208218430553e-02   -5.973930988474908e-02   +3.470283958830696e-03   +7.888858976830432e-02   +1.617032423898798e-02   +2.832972479442590e-02];
L3E_L3I_iGABA_netcon = [+3.265836673250912e-02   -2.040932121952216e-02   +3.319373399294236e-02   +1.306668462631210e-02   +5.161757842498328e-03   +5.358163840484551e-02   -2.022071563342571e-02   +2.248671698705377e-02   +6.102114765109733e-02   +3.011481299876191e-02   +4.483102980536752e-02   +1.446566433707061e-02; +1.621152085714608e-02   +2.808455857106616e-02   -1.392893971795034e-02   +1.326896393024432e-02   +6.101977470456835e-02   -5.468426239901224e-03   -2.878722931787957e-02   +4.917267809786409e-02   +3.203006912698225e-02   +8.729420839609268e-02   -1.310280811650072e-02   +3.716425248821494e-02; +1.176616583046656e-02   +1.207389731053586e-01   +6.206209962786750e-02   +2.012318029083063e-03   +2.530958687422014e-02   -8.513762313631860e-02   -6.032981808023849e-03   +9.975146371654359e-02   +9.645353086368197e-02   -1.604310468131633e-02   -3.883942423505197e-02   +3.597046150180376e-02; +1.904449540073811e-02   +4.674839001255640e-02   -2.580974970391390e-03   -5.943594529331800e-02   +4.651294835494808e-02   +2.990415040484265e-02   +6.342058444551457e-02   -6.438500679942592e-04   -6.550140720178371e-02   +7.399293044869096e-03   +1.818894922654951e-02   +1.825225593497938e-02; +2.594814317669659e-02   +3.302676617619908e-02   +6.771438465066540e-02   -7.937336733812078e-02   +9.173043155563818e-03   +3.551714261331916e-02   -5.789790647606909e-02   +6.892139458939607e-03   +5.861419986601449e-02   +3.668043826944208e-02   +6.467492556370628e-02   -6.314465478470981e-02; +2.006617211296541e-02   -6.841192796001960e-02   +3.175262133420869e-02   +7.336950205938128e-02   +1.411573849637001e-02   +6.921326246941913e-02   +5.483309009238760e-02   +8.228441091672686e-02   +1.169391033266158e-02   -1.452730675794222e-02   +7.591790489739139e-02   -2.292237850690458e-02; +7.798899996181596e-02   -3.685362518206551e-02   -1.498864260884444e-03   +1.362431865604950e-02   -1.604664465372467e-02   +3.115403414814717e-02   +7.625767510420435e-02   +9.483589248431831e-02   -5.693239631911348e-02   +5.248846948064037e-03   +3.071146808827159e-02   -3.566192666522485e-02; +4.599193019922433e-02   -2.841454672267903e-02   -3.587954017222806e-02   +5.804301528627846e-03   -5.258171107970003e-02   +4.950275162112447e-02   -4.491137529212839e-03   -4.914987824005230e-03   +2.898826656158029e-02   -1.605073058080120e-02   -2.564334760043469e-02   -1.058650627375670e-02; -3.411405797836914e-02   +7.869018640478377e-03   -2.036466435800008e-02   +2.401466805090726e-03   -2.340520458718121e-02   +8.156342231371390e-02   -6.242894595461428e-02   +2.927619314665342e-03   -2.725083422428339e-02   +1.382850590861500e-02   -1.815531525890988e-02   -1.262476322352365e-02; +5.189602819020116e-02   +9.417460388306083e-02   +1.465375978444564e-02   -3.079617966176110e-02   +1.923172569626835e-02   +5.192792445390151e-03   +6.974460750023616e-02   +6.375409265933990e-02   +5.188453222976198e-02   +1.240137529513753e-02   +2.261315126510507e-02   -7.347013198269680e-03; +8.204511473555166e-02   +4.080100696274531e-02   +3.306119256200639e-03   -3.569580620798985e-02   +3.509325169322670e-02   +1.579802486089506e-02   +6.939262728250718e-03   -6.790727953996759e-02   +2.108615871433301e-02   -7.318779419194429e-02   +2.615746493075857e-02   -7.345038735914554e-02; -2.666610625613683e-02   +1.948480373689634e-02   +2.793202147085513e-02   +4.007350535720254e-02   -8.098734793435014e-03   +5.360214259714928e-02   -8.403711156207128e-03   +4.000529052991302e-02   -5.868304235233415e-03   +5.111831087338105e-02   +7.742393600365769e-03   -6.489242023612024e-02];
L2E_Input1_iAMPA_netcon = [+6.416180051676311e-02   -3.497009657382574e-02   -1.952933749056536e-02   +9.121689612701624e-03   +6.050190123317049e-02   -1.193545289717934e-02   +2.292649179979400e-02   -9.897460170333317e-03];
L2I_Input2_iAMPA_netcon = [+7.790535164231664e-02   -4.496027181969506e-02   +5.490888419489440e-02   +3.641502308347887e-02   +5.812065634128685e-02   +5.400679528024167e-02   -3.829533385976365e-02   +7.357036571029252e-02];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.04*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.9*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.1*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.9*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.1*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.9*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.04*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.9*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.1*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.9*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.1*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.9*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
