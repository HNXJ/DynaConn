function [T,L1I_v,L1I_iNa_m,L1I_iNa_h,L1I_iK_n,L2I_v,L2I_iNa_m,L2I_iNa_h,L2I_iK_n,L3I_v,L3I_iNa_m,L3I_iNa_h,L3I_iK_n,L1E_v,L1E_iNa_m,L1E_iNa_h,L1E_iK_n,L2E_v,L2E_iNa_m,L2E_iNa_h,L2E_iK_n,L3E_v,L3E_iNa_m,L3E_iNa_h,L3E_iK_n,Input1_v,Input1_iNa_m,Input1_iNa_h,Input1_iK_n,Input2_v,Input2_iNa_m,Input2_iNa_h,Input2_iK_n,L1I_L1E_iAMPA_s,L1E_L1I_iGABA_s,L2I_L1I_iGABA_s,L1I_L2I_iGABA_s,L2E_L1E_iAMPA_s,L1E_L2E_iAMPA_s,L2I_L2E_iAMPA_s,L2E_L2I_iGABA_s,L3E_L2E_iAMPA_s,L3I_L2I_iGABA_s,L2E_L3E_iAMPA_s,L2I_L3I_iGABA_s,L3I_L3E_iAMPA_s,L3E_L3I_iGABA_s,L2E_Input1_iAMPA_s,L2I_Input2_iAMPA_s,L1I_v_spikes,L2I_v_spikes,L3I_v_spikes,L1E_v_spikes,L2E_v_spikes,L3E_v_spikes,Input1_v_spikes,Input2_v_spikes,L1E_L1I_iGABA_IGABA,L1E_L2E_iAMPA_IAMPA,L1I_L1E_iAMPA_IAMPA,L1I_L2I_iGABA_IGABA,L2E_Input1_iAMPA_IAMPA,L2E_L1E_iAMPA_IAMPA,L2E_L2I_iGABA_IGABA,L2E_L3E_iAMPA_IAMPA,L2I_Input2_iAMPA_IAMPA,L2I_L1I_iGABA_IGABA,L2I_L2E_iAMPA_IAMPA,L2I_L3I_iGABA_IGABA,L3E_L2E_iAMPA_IAMPA,L3E_L3I_iGABA_IGABA,L3I_L2I_iGABA_IGABA,L3I_L3E_iAMPA_IAMPA,L1I_L1E_iAMPA_netcon,L1E_L1I_iGABA_netcon,L2I_L1I_iGABA_netcon,L1I_L2I_iGABA_netcon,L2E_L1E_iAMPA_netcon,L1E_L2E_iAMPA_netcon,L2I_L2E_iAMPA_netcon,L2E_L2I_iGABA_netcon,L3E_L2E_iAMPA_netcon,L3I_L2I_iGABA_netcon,L2E_L3E_iAMPA_netcon,L2I_L3I_iGABA_netcon,L3I_L3E_iAMPA_netcon,L3E_L3I_iGABA_netcon,L2E_Input1_iAMPA_netcon,L2I_Input2_iAMPA_netcon]=solve_ode

% ------------------------------------------------------------
% Parameters:
% ------------------------------------------------------------
params = load('params.mat','p');
p = params.p;
downsample_factor=p.downsample_factor;
dt=p.dt;
T=(p.tspan(1):dt:p.tspan(2))';
ntime=length(T);
nsamp=length(1:downsample_factor:ntime);

% random_seed was set to shuffle earlier. 

% ------------------------------------------------------------
% Fixed variables:
% ------------------------------------------------------------
L1I_L1E_iAMPA_netcon = [+2.394967441859110e-01   +3.099333347306120e-01   -1.949692765453029e-01   -1.842544709979357e-01   +1.511676163846332e-01   +3.509031905849275e-01   -1.156390846354343e-01   +2.617647096283817e-01   -2.746411659947174e-01   -4.868994855184761e-01   -7.594751638984734e-02   -3.130002913184730e-01   -2.382921360850175e-01   -4.031848722529541e-01   +1.344699868232028e-01   +3.108419532127956e-01; -5.225054510863636e-03   +2.379411247684482e-03   +1.208755177770004e-01   +2.058371525599169e-02   -2.199770426289220e-01   -1.937331719374318e-01   +9.323078428716935e-03   +1.778633241976845e-01   -2.196093090504850e-03   -6.383274657062249e-02   +5.546337979208493e-02   -2.274404897256953e-02   +2.231534176911977e-01   +5.370396220030976e-02   +4.024012461371149e-02   -2.341056691187027e-02; +5.204878382932659e-02   -1.785191557941401e-02   -1.551642086142851e-01   +2.003801869963500e-01   -1.042633932821370e-01   +1.991117433630380e-01   +2.478138158387649e-01   +2.373937937555273e-01   -5.770188721759482e-02   -1.891688043325546e-01   -2.203069754292056e-02   +6.241439670018117e-02   -3.352824409161542e-01   +2.610250399897167e-02   +3.171865249169861e-01   -9.685805470739184e-02; +4.162495291496660e-01   -2.101466438162534e-01   -1.529283659031543e-01   -1.342772174281892e-01   -8.054925442494582e-02   -1.832853075914505e-01   -7.015630391536511e-02   +1.251885353142133e-01   +7.016247871014650e-02   -3.651832739829389e-01   +2.296686416671772e-01   -2.866833492119811e-01   -4.831290683248829e-01   +9.470164117107514e-02   -2.236529691236984e-01   -1.070649738604440e-01; +4.193887418804770e-02   +8.465112478787394e-02   +2.650068052420954e-01   -2.872564334648610e-01   -2.918931274847688e-01   -1.490411391648592e-01   -3.420003910148238e-01   +1.309098030151929e-01   -9.877738927431472e-02   +3.733694285672982e-01   +3.712514421302805e-02   +4.511227383891312e-01   +5.350596998805484e-01   +2.365103494466894e-01   +2.354903060699738e-01   +1.036958060841767e-01; +3.064495441638561e-01   -1.090167605258305e-01   +2.167938127084770e-02   +3.295326676420390e-01   -1.249685668500940e-01   +1.556076765431394e-01   +7.942466266404410e-02   +4.273814732022236e-01   -4.046297973499710e-01   -2.553535526737881e-01   +9.638817873668507e-03   -2.181576868608799e-01   -1.593948858559413e-01   -3.700683180667252e-01   +2.836938292219179e-02   -8.489055805127868e-02; +9.203596235639375e-02   -2.281478660301246e-01   -2.454731640392233e-01   -5.915100877555245e-02   +2.133598276314632e-01   +2.722387234041680e-01   -2.937123978289793e-01   -3.656497571767489e-02   -2.573796107857479e-01   -1.738844284882201e-01   +2.447720400672456e-01   -1.420000606194280e-01   -5.279317242023692e-02   +2.268982963387886e-01   -1.746310215252977e-01   -1.262779179434870e-01; -2.125416893614194e-01   +4.043307627196898e-01   +6.424528993824186e-02   +1.540137878997221e-01   +2.408077536875768e-01   +7.586565229021140e-02   -7.085818748615745e-02   -1.239745532870273e-01   -1.033405391502087e-01   -1.199062255134339e-01   -4.241719014457583e-01   +1.888876727460732e-01   -1.687239542347063e-01   -2.798581060991948e-01   +1.725898013045903e-01   +3.252126748068280e-01; +3.028913254502998e-02   +7.762794320786143e-02   +1.280075716470310e-01   +1.553083171172537e-01   +1.051491735306379e-01   -9.504035362697713e-02   +1.266769490629980e-01   -3.278266079212946e-01   -4.141468579119244e-01   -1.248737839618507e-01   -1.089767086901011e-01   +1.871615866949226e-01   +3.577578108786623e-02   -1.038258736008638e-01   +1.298410011438918e-01   -5.031501339858353e-01; +4.518049564267908e-01   +4.883449963459390e-01   +2.308523181040939e-01   +5.016863445380463e-02   -3.535831493489022e-01   -4.964386569423473e-01   -2.285622493960946e-01   +3.554600117283623e-01   +3.698175022779074e-02   -3.871202218922494e-01   +3.148270398429025e-01   -2.858527772658576e-01   -2.401269366774878e-01   +3.348148018826717e-01   +2.783142706234260e-02   +1.895083499582007e-01; +4.498148254549694e-03   +1.940833598876197e-01   +1.356670075902863e-01   -2.648440452530487e-01   +1.249249591447835e-01   -2.241317171676264e-01   +2.941781299570707e-01   +7.144124519255507e-02   +5.205997708207184e-01   -2.094407899384108e-01   -4.655376485349785e-01   +1.506976559156418e-01   +1.687163388328749e-01   -2.445462708921395e-01   -5.081660329525556e-02   +3.683267683640866e-02; +1.729868212633431e-01   +1.902077354369045e-02   -1.124251972201921e-02   +1.867691698482682e-02   -1.590016018128919e-01   +8.752465877066004e-02   +2.988876064023721e-01   -4.273525053220624e-01   -2.254699909117214e-01   +1.814990359264524e-01   -1.015877986614230e-01   +9.412806429962273e-02   +6.136861260360826e-02   -3.450327785881603e-01   +2.525053218996769e-02   +1.289811176361798e-01; +1.037527290813121e-01   +2.807053541643663e-01   +4.956948012733305e-01   +4.444016125994432e-02   -4.254487540888662e-01   +5.195085822853994e-02   -3.451294752755122e-01   +4.034233646628073e-01   -5.106211294559444e-01   -3.604515895818337e-02   -7.004765969641645e-02   -3.769944466561005e-01   +8.481464317405740e-02   +1.498202960122869e-01   -2.038803762530775e-01   -1.682345970691360e-01; +2.411678660756049e-01   -3.515916698153310e-02   -2.938824839480360e-01   +1.753408911830886e-01   -4.365806662935090e-01   +1.197153243123150e-01   -4.070589697699693e-01   +2.224857943390162e-01   -2.742106399621988e-01   +3.293738872613563e-01   +9.382055962198484e-02   -4.305260489246586e-01   -2.403292671661694e-02   +2.286850832585188e-01   -3.385667652155225e-01   -2.475454686082773e-02; -2.174649605731380e-01   +1.759381700034206e-02   -3.384510296418259e-01   +2.080944327312659e-01   +7.460071754294716e-02   -1.599628650262270e-01   -1.389590478732066e-01   +2.294529350623447e-01   +3.944521827203581e-02   -6.883032175674349e-02   +3.934398568381051e-01   +2.736169611330270e-01   -4.260749693240236e-01   +9.726282291959498e-02   +2.298259524611190e-01   -1.595059992025317e-01; +1.044825382743576e-01   -3.063323512477721e-01   -2.071615731176235e-02   +1.977313282952781e-01   +5.498786926484811e-02   -2.036288895477139e-02   -4.302507341258642e-01   -4.152862043145082e-01   -1.714492382003653e-01   -2.174624910662875e-01   +1.631403595006182e-01   +4.558745022148136e-02   +2.017339607617331e-01   -1.968558768487080e-01   +2.683506913962931e-02   -2.076671045542319e-01];
L1E_L1I_iGABA_netcon = [-9.331686897533759e-02   -4.791027327691200e-01   -8.461207757049248e-02   +1.426499968229950e-01   -1.212489904210485e-01   -2.159979557731673e-01   -1.294347945168394e-01   +2.362669641945009e-01   +4.271363693297503e-02   +2.628577807291487e-01   -8.238921017817459e-04   -1.182888484226012e-01   -1.564276104680802e-01   -1.367567110786624e-01   -1.402714505039915e-01   +2.279022730116228e-01; -2.799039715306261e-01   -1.593063645807116e-01   -3.016381406892679e-02   -2.794252961447795e-02   -1.232564765449668e-01   -6.860596751963616e-02   +2.723166874072491e-01   +2.479669152031930e-01   +8.619825865554845e-02   -9.780474713053558e-03   +5.477950033990656e-02   -1.734611326359604e-01   -2.341748786377767e-01   -2.048281059826788e-01   -2.840985862941345e-01   +3.213147843624028e-01; +3.283375170980875e-01   +3.925288477314223e-01   -2.912111358306344e-01   +1.007952081840874e-01   -2.276279464351596e-01   +3.051319725695839e-01   -2.230135594634288e-01   -1.990616931557355e-01   -9.807017340650753e-02   -2.150189936897136e-01   +2.215248025942025e-01   +2.969853985712653e-02   +1.914664544638019e-01   +1.994036697975899e-01   -8.127017385564690e-02   +2.927513294231767e-01; -9.325487872141346e-02   +2.646838171685255e-01   -1.772595522749207e-01   +2.647476761383049e-01   -1.618746518796254e-01   -1.283231061939824e-02   -2.665954880919026e-01   +1.667608802671882e-01   +1.708770605778105e-01   -1.044594503083974e-01   -1.915197049562850e-01   -3.573303747818157e-02   +8.338808580396195e-02   +6.402325121882330e-02   +1.194233507213558e-01   +3.578221642975549e-02; +2.032397664068168e-01   -2.856373011511483e-01   -2.202676766279113e-02   +4.848867934740003e-02   +1.581622643862097e-01   +1.434028052860222e-01   +9.249407784292887e-02   +3.855478313667656e-01   -1.338149937025769e-01   -1.393592627001196e-01   -3.332849203377268e-01   -1.318404453295147e-01   -8.291169050207525e-02   +5.395644501034579e-01   +2.061514938171875e-01   +7.621092723192875e-02; +1.724014382137623e-01   -1.129096296343602e-01   -1.301477113305946e-01   +2.244604014454202e-01   -9.625810060873613e-02   +4.885902995398748e-02   -1.604827908267280e-01   +4.662564741689104e-01   -6.072369582530236e-02   +1.287136245905631e-01   +1.572524568592422e-02   -4.933780311345282e-03   +7.997043706804807e-02   -1.029017571702263e-01   -3.044314597564603e-01   -6.763494518171566e-02; +2.368497157274825e-01   -1.292030655185069e-01   +5.269016771043743e-01   +7.232774307643408e-03   -1.739413495642864e-01   +2.533756980978106e-01   -1.079033918137893e-01   -2.000794943243185e-01   -5.900220544106333e-02   +1.811741505145348e-01   +8.569694070779126e-02   -3.251881894039849e-01   +2.125470248399642e-01   -2.457877462261471e-02   -1.234426519306215e-01   -1.423411770870483e-01; -6.030582449121293e-01   -4.312003132884267e-01   +5.022732231303180e-01   +2.832632681024648e-01   +3.113963653600896e-01   -2.827973652042180e-01   -1.606860395695845e-01   -4.019694634884855e-01   +2.999670253365239e-01   +1.389038192931025e-01   +2.015419383854522e-01   -4.992392236328055e-02   -3.061715332060444e-01   -1.895862991963760e-01   -6.308922137384793e-03   -7.811891124214403e-02; +2.099376735310190e-01   +2.477975024325590e-01   +1.546380522216410e-01   -2.651064691530440e-01   -2.593273155485604e-03   +2.656750291231962e-02   +2.771100903934277e-01   +1.422141313829740e-01   +6.759303300633254e-02   +2.911121641918467e-01   +5.529343146317976e-02   +2.340520507319112e-02   +3.773400514598587e-01   -3.310653337148780e-01   +3.292077672757855e-01   +9.750151171508624e-02; +9.056627005914217e-02   +5.364529609634067e-02   -3.380934849834780e-01   +6.285774144630009e-02   +2.330453594030101e-01   -1.211247549203016e-01   +2.627743812376376e-01   +6.997250005141259e-03   +3.137563905937529e-01   +1.755412661249745e-01   -1.470909150436122e-01   +2.974069985020591e-01   -3.436389251210477e-01   +5.647716610613075e-03   +1.208035263863442e-01   -2.170093321686134e-02; +1.560454051512245e-01   +1.654025228421750e-01   +1.688324489574174e-01   +3.241553426562349e-02   -1.180000395822238e-01   -1.991415995494273e-01   -8.021439416048043e-02   +1.476321706541041e-01   -2.455704410923980e-01   +2.059979767423974e-01   +2.891926250664918e-02   +2.411869969259637e-01   -1.444966834111429e-01   -7.567080483825185e-02   +6.557892455177691e-02   +2.506941345584194e-01; +2.284718672367171e-01   +5.353509501661079e-02   +8.079856821435925e-02   +5.445027652205579e-02   +3.056220676169070e-01   +3.469402898378675e-01   -9.644644453371434e-02   +4.343452901143321e-01   -7.893964852062596e-02   -7.510938727475053e-02   -2.422569081145883e-01   +3.886427201543337e-02   -3.316065143245130e-01   -6.278868303754266e-02   -2.780298411048270e-01   -3.980490817951175e-02; -3.789823465135497e-02   -3.366279532423798e-01   +2.575899150957917e-01   +3.549550207834549e-01   +1.971243912857975e-01   -2.042202923101605e-01   +1.953035945947544e-02   -2.772836602861283e-01   -2.158066142606049e-01   +1.214395381697235e-01   +1.739044203882885e-01   +8.982975523452547e-02   +4.735425111790307e-01   +1.045136252851658e-01   +1.168461721834056e-02   +2.895425933647383e-01; +9.925107116249907e-02   +2.862626869328539e-01   -2.023127934290078e-01   +2.081194955893378e-01   +3.595202990872003e-01   +1.093812611041345e-02   -1.276038406238839e-01   +9.189705495676692e-02   +3.792807950655613e-01   +9.568848404547978e-02   -1.712382791583686e-01   +2.383157153801296e-01   -2.450963376133061e-01   -5.602019600669358e-02   -2.327657887385573e-01   -3.190166811826741e-01; -1.464775119313734e-01   -1.944585149357841e-01   +4.354060624184463e-02   -1.363675246753072e-01   +2.430957553989353e-01   -1.854064968644035e-01   +4.039168924775000e-01   -2.700990163110977e-01   +2.011645374708104e-01   -2.604079066637564e-01   -1.680127558497903e-01   -2.332720284126596e-01   +3.193239317116843e-01   +1.901422881171889e-01   -1.596831256138675e-01   +3.992501901701198e-01; -5.046477470362569e-02   +2.664864474224010e-01   +1.220280476440833e-01   -2.305042536627392e-01   +5.752289628237085e-02   -2.510468474458678e-01   -2.949287159138400e-01   +8.964383430368576e-02   -1.935973379265329e-02   +2.647980369780555e-01   +3.124504438744216e-01   -3.736889634941279e-01   +8.703648925996763e-02   -7.176413618997707e-02   +1.154722551290668e-01   +4.801747727726741e-02];
L2I_L1I_iGABA_netcon = [+3.900326873883947e-01   -1.404011302850783e-01   +2.733483306544390e-01   +2.733151967863725e-01   -2.492687370383369e-01   -1.314740647419306e-01   +1.895272057139309e-01   +2.541190235783609e-01; +9.150326505239169e-02   +2.944548755507479e-01   -1.086998877734698e-01   -9.451235899006911e-02   +4.121148067059434e-01   +3.071878102003990e-01   +2.173204539774299e-01   -9.191157979694786e-02; -4.283797662073864e-01   +4.239672587837404e-01   +1.809380091513694e-01   -3.018937711370832e-01   -7.779762603651871e-02   +5.398391507695914e-01   -4.531218598597119e-01   +2.844396651290128e-01; -3.262351451450300e-02   -2.585561603974627e-01   -1.246912493265083e-01   +1.796921310826955e-01   -2.908606510229554e-01   +2.346168326687637e-02   +9.811098114374926e-02   -3.748927948993639e-02; +3.842980161193850e-02   +7.385295248305146e-02   +2.328936382958900e-01   -9.671293219491184e-02   -3.017207122619033e-01   -2.344766362184140e-01   +2.536947043947383e-01   +2.001758648014280e-01; +2.551446431151619e-01   -4.693697097140991e-01   +1.786064980984954e-01   -1.296077364900588e-01   +4.879390409648884e-01   -3.489366649374888e-01   +2.019909902873812e-01   -1.218050548941558e-01; -1.290282009225255e-01   +1.478786474257913e-01   +1.678345894781337e-01   -4.573594574262556e-01   +1.732787483740100e-02   -9.843073711909264e-02   +1.043823401814726e-01   +2.586898851974690e-01; -1.291341054015568e-01   -1.248694790986569e-01   -3.013216386840921e-02   +6.061781365310656e-02   -1.949974951803949e-01   +7.847822130581726e-02   -3.449882056777216e-03   +4.292539579907420e-02; -3.339434832167480e-02   +5.381758756247907e-02   +2.402726799950217e-01   +5.968581462860578e-02   -9.593441280683734e-02   -1.644489378861445e-01   +3.460239890253713e-01   +3.775722589044916e-01; -1.884695808683611e-01   +1.263523192590827e-01   -9.440072779692482e-02   -1.149184161225991e-01   -7.238038493784872e-02   +1.184347708803287e-01   -4.684369164662173e-01   -1.267924540367029e-01; -3.947113397543680e-01   -2.272355787345350e-01   +2.156675294612093e-01   -8.301389666019773e-03   +8.012810299471156e-02   -1.481031176576686e-01   -1.848571139781948e-01   -1.094295697398895e-01; +1.549345166183865e-01   -9.207453981245756e-03   +1.382898863988573e-01   +1.341637441654478e-01   -7.079789682843050e-02   +4.814581870131177e-02   -2.105371321830554e-01   -3.775601567179370e-01; -3.389000233651622e-01   +1.945643782296710e-01   +4.497676128524873e-01   -4.380786388774716e-02   +1.283004830418433e-01   +3.018773456331406e-01   +1.360365465096136e-01   +4.730619936199399e-01; +5.022758633068709e-01   +1.445377690601221e-01   -2.238176962262092e-01   +5.521774249470437e-04   -2.997124678220621e-01   -4.839314703378425e-01   -2.909120202265539e-03   +5.010091123360662e-02; +3.667807256887116e-01   -6.464753906226764e-02   +2.740630970063365e-01   +2.741385353737040e-01   +2.490805539162647e-01   +3.645739661562637e-02   +5.735606306893598e-02   +3.237195803813397e-01; -1.388058231876637e-01   +1.927674534491531e-01   -3.450884606561535e-01   +1.468385982549588e-01   +2.199399117540529e-01   +3.772607120827182e-01   +4.798146733357131e-01   +7.651825799448812e-02];
L1I_L2I_iGABA_netcon = [-2.114584256159008e-01   +1.457016447209768e-02   -5.173842396188625e-02   +2.123160262925282e-01   +2.204618118184566e-01   -1.725077455213778e-01   +4.125269705694813e-01   +1.899456792483993e-01   +3.674462834416845e-03   +2.182223229709644e-01   -2.258161084543575e-01   -2.412221815459275e-01   -1.790138245735276e-03   -6.223321196679063e-02   -4.387354835063541e-01   +2.501962661362923e-01; +3.545713162316548e-03   -2.065140971992530e-01   -2.778956748542188e-01   -6.282860363847573e-02   -5.003740147092523e-02   -3.297434148421918e-01   +5.934486117944486e-02   +8.745134357958584e-02   +3.127827632026117e-01   +9.937371713859200e-02   +6.547162913323235e-02   +8.739017548513417e-02   +4.296460399340429e-02   +2.542415807375480e-01   +1.206490051169721e-01   -3.573418503851933e-02; -2.832360131048061e-01   +3.493326332203828e-01   +3.571770038965533e-01   +3.283573546252481e-01   -7.567753046836684e-02   -2.340316879423890e-02   -2.504333053108676e-01   +1.788639930862370e-01   +3.781801985772264e-01   -1.065615234023112e-03   -3.160231325016282e-01   -2.024619474377447e-02   +1.874579616897671e-01   -3.855343075771152e-01   +2.020768673683310e-03   +4.025462836424795e-02; +4.782601699884731e-03   -2.642195744879123e-01   -1.097683010733443e-01   -1.646743632002165e-01   -1.206665561279284e-01   +2.638803876065757e-01   -1.513551830369860e-01   -1.966333393221537e-01   +2.455243353708010e-01   -3.663627792867571e-02   -1.024834266364729e-01   -1.831713379651426e-01   -3.048854295210265e-01   +2.326569483216716e-01   -2.267759753354094e-01   -3.382577114521038e-01; -1.349679078382715e-01   +3.359491710985499e-02   -6.441716224696076e-02   -1.805471032494896e-02   +1.573541333188047e-01   -1.591610650634395e-01   -2.429370049301400e-01   -2.425537385477683e-02   -2.813012984388984e-02   -4.510745830568759e-01   -2.539967149315932e-01   -4.209254893947958e-01   +2.150177250627197e-02   +2.033802454195044e-01   +3.905760200243334e-01   -2.813332727506584e-01; -2.301918649501939e-01   +2.210598848769022e-01   -2.448612898393884e-01   +4.517375544731426e-01   +1.054614824835741e-01   +3.808460654466220e-02   -5.694486212638694e-02   +1.980737488575213e-01   +3.241906236131045e-02   -2.885664900559194e-01   +5.181927752509068e-01   -1.781208740717602e-01   +1.853222302432156e-01   +1.631807126279888e-01   +2.848875544708712e-01   -1.159095166261375e-01; +3.602343040806273e-01   +1.882154461981945e-01   -3.007078149051331e-02   -2.046146806041502e-01   +3.544814675809909e-01   +2.196707326637562e-01   -1.045223222876822e-01   -1.153160185055370e-01   +2.061277396951054e-01   +5.068268995093317e-01   +5.090412782465344e-01   -2.145988470258892e-01   +2.583017638120312e-02   +8.763514892763785e-02   +4.993444968555195e-02   -6.995322816648469e-02; +9.339105783233376e-02   -2.987617021696593e-01   +1.180016470630774e-01   +1.079199760335454e-01   +1.927781954256698e-01   -2.795480409727549e-01   +4.944930790172332e-01   +2.172048335853345e-01   -1.452230362904989e-01   -7.668818242414971e-02   +8.449777846609967e-02   -5.293982473368358e-02   +5.996219427921209e-02   +3.856207824950089e-01   -4.611860219834553e-02   -3.042076026669261e-01];
L2E_L1E_iAMPA_netcon = [+4.545770988539596e-02   -2.120312055580517e-01   +5.720418424594975e-03   -2.541388648935419e-02   +2.623816526166800e-01   +1.218046283327082e-01   -2.617336850293419e-01   +3.354389418591888e-02; +7.742698650082330e-02   +3.269108971873855e-01   -1.394255622517487e-02   -1.064234984080152e-01   -5.381969881524562e-02   +9.578509435399307e-02   -2.286635775963398e-01   -4.771435162025859e-01; -1.005865951812955e-01   +3.192412292654735e-02   +1.688217369827588e-01   +8.090652430584058e-03   -8.716473351024193e-02   +2.335961427286574e-01   +1.630469738843548e-01   -4.618683009487329e-01; -2.823314503799447e-01   -1.590453296437251e-01   +4.693453524169477e-02   -1.555925950588097e-01   +5.030544553485498e-02   -6.741454639388514e-02   -3.439146899259019e-01   -1.063074226092011e-01; +1.527674984709502e-01   -4.479074585704040e-01   -2.756441811297947e-01   +1.592870820184588e-02   +2.997564881138073e-01   -5.409577744394839e-02   -1.478413964854244e-01   +1.366299930059365e-01; -5.083914669701268e-02   -4.839341893931906e-02   +1.629119423508538e-01   -4.882762704709120e-02   +1.942228803481776e-01   -2.606841621719709e-01   -1.005152794003669e-02   +2.678445132010150e-01; +1.549638602992915e-01   +1.596507078500731e-01   +1.041354450441178e-01   +2.639583391460945e-02   -2.036473944159432e-01   -1.159064501919299e-01   -1.962829397698097e-01   +3.167777408736081e-01; +3.796062095055701e-02   -4.057790319143668e-02   +7.724034190487529e-02   +3.650043024109920e-02   -1.235531422381239e-01   +2.112815379489577e-01   -3.877112488830564e-01   -7.406980439386111e-02; +2.767757628988258e-01   -1.534748877624366e-01   +1.443830290680182e-01   +1.254892283957632e-01   +1.778838325223707e-02   -3.655712146319572e-02   +1.578419786506508e-01   +3.420335767694727e-02; +1.645112760026087e-01   -6.500719040426484e-04   -8.438563029392032e-02   +2.315101910073933e-01   +3.259538892063085e-01   +2.311238816643567e-01   +1.328065650810768e-01   -7.338067764291517e-02; -9.571805259017756e-03   +9.844922364425301e-03   -9.817503981196252e-02   -2.712665865201980e-01   +1.789140149165601e-01   +3.321848517272092e-01   +1.573764874275075e-01   +7.538958084678757e-02; +2.625431365354414e-01   +1.287067999934173e-03   -2.975886143786688e-02   -2.086365635038067e-01   -1.422189437150432e-01   +8.799126615508823e-02   +1.863619073567292e-01   +1.829586825934431e-02; +7.978250078340413e-02   -6.262497121220903e-02   +1.137267012293746e-01   -1.216187136564625e-01   -3.021061890414207e-01   -9.054853742655053e-02   -1.126196491726426e-01   +9.506498186348064e-02; -1.461979674597593e-01   -3.977661448920993e-02   +1.351650030789962e-02   +1.552515098504907e-01   -3.801734761400305e-01   +4.013770924565001e-02   -3.248631763534575e-01   +4.155933961481406e-02; -2.119120268953606e-01   +3.218598848130113e-01   +2.454316049967797e-01   +4.309639711040178e-01   +6.220334659535232e-02   -9.600740408788765e-02   -3.715046992230630e-01   -2.539167072401449e-01; +1.701450611448901e-01   -2.938118244118089e-01   +3.022096829901644e-01   +5.802556988078580e-02   -2.997000084248697e-01   +2.867964129335850e-01   +7.450859253361922e-02   -1.072960941548159e-02];
L1E_L2E_iAMPA_netcon = [+1.842620955086008e-01   -1.919102952464759e-01   +1.071785360212788e-01   +3.845907415697965e-01   +2.509033103999231e-01   +9.363183752577492e-02   +1.688846294310206e-01   +3.461063510008477e-01   +9.884045995266035e-02   +6.112737960232395e-02   +2.249077018140083e-01   +3.272393182543858e-01   +3.158971877887412e-02   -2.122684816135377e-01   -9.894359788481580e-02   -1.244794688023320e-01; +1.855308992522503e-01   +1.090010903502542e-01   +4.658511348001173e-01   +1.080458883530776e-01   +8.247783608675363e-02   -1.524561831385782e-02   +2.882803171126110e-01   -5.768265808717299e-02   +2.160545877521096e-01   +3.526791102088248e-02   -3.095105698926616e-01   +1.506009322723512e-02   +1.513998418873082e-01   -2.412125879803270e-01   -1.933025960840616e-02   -7.600546940060435e-02; -1.721902793976621e-01   -2.565808112537883e-01   -3.136841213022314e-01   +4.065063750680616e-02   -2.117918111766823e-01   +1.854542316361262e-01   +7.250484608227931e-02   +1.801184760289310e-01   -2.558571090003399e-01   +3.175681240862424e-02   -1.500940960416991e-01   +1.273868240081673e-01   +3.170557462539053e-02   -3.279324781266866e-01   +1.895391930006438e-01   +8.800918551038885e-02; +2.004947596058254e-01   -5.425303525639032e-02   +5.854261952082693e-01   -1.382734817006630e-01   +2.633222443746353e-01   -6.606431475136466e-02   -2.216857721833446e-01   -9.069315865943224e-02   -3.222602868606772e-01   +8.977172256198734e-03   -3.230616242844432e-01   -1.701165669668926e-01   +3.714875975095230e-02   -2.748242367113000e-01   -1.629307507726125e-01   -7.705639221983272e-02; +3.524839972080124e-02   -1.733321518782704e-02   +5.609242516435664e-01   +4.586098936328636e-03   -2.494810095526015e-02   -3.675064088685329e-01   -1.844235206363704e-01   -1.030677097064860e-01   -2.078485911307826e-01   -4.943472315794684e-02   -3.484758104941671e-01   -5.538372912381206e-02   +2.310062860670146e-01   +2.255985687213092e-01   +2.107418861446518e-01   -3.068431198732463e-02; +3.695353826912382e-02   +2.673835210241504e-01   -9.619268265968514e-02   +1.151380461142429e-01   -1.385157210641225e-01   +1.736323566394567e-01   -8.298565745156583e-02   -4.736933155740283e-01   -1.545412094285815e-01   +1.719000108860047e-01   +1.835919317613949e-01   -1.512751477915059e-01   +7.041897772509785e-02   -4.476757601345712e-01   -3.893477557369314e-02   -9.264937042975196e-02; +9.823703565400478e-02   -7.004879052900516e-03   +4.504491671654832e-02   -2.197727758778559e-01   +1.598278495770691e-01   +2.998794300998209e-01   -1.255175468427962e-01   +2.011669045811638e-01   +1.164526291482853e-01   +3.858355995621605e-01   +2.764409698166839e-01   +4.364504914493764e-01   +6.013525462555720e-02   +1.533991981858445e-01   +1.722367210718515e-01   +7.841313716328746e-02; -2.269528992490568e-01   -1.767282850671949e-01   +2.674094090947198e-02   +1.410616147700122e-02   +6.103707166491699e-02   -2.127378452629143e-01   -6.354060796654629e-02   -1.153248798027556e-01   +1.495419475980340e-01   +1.000800490286397e-01   +1.837269363901152e-01   -1.279087336622887e-01   -4.102915490201746e-01   +2.927285423531045e-01   -9.041375795992684e-02   +4.492910096025315e-01];
L2I_L2E_iAMPA_netcon = [-1.651363245502606e-01   +2.347947360806327e-01   +3.514596053196348e-01   -3.761685481686032e-01   -2.083689929862340e-01   -5.487272474664961e-03   -3.093413768048164e-01   -8.099408396408386e-02; +3.678869147335945e-02   +2.581255330895497e-01   +3.643794769494148e-01   -1.328751921574071e-01   +3.147037691062532e-03   +3.965580394674275e-01   +4.600083987309050e-02   -4.264071326477387e-01; -3.901903853924115e-01   -1.894819103093947e-01   -1.173550810585993e-01   +5.975517635136210e-02   -1.905342593209785e-01   -1.695665817030095e-01   -2.586831369999159e-01   -2.923271051018674e-02; +2.513015274135711e-01   +1.587646998571259e-02   -2.122222043363087e-01   -1.707466532053564e-01   +1.683452762215231e-01   +6.758849292364716e-02   +3.618302173083965e-02   +1.222298263679651e-03; +1.417109574096870e-01   -8.081205166305511e-02   +1.681481539529397e-01   +4.982370712702751e-01   -1.081072284507711e-02   -2.136507949009191e-01   -3.247366881788312e-01   -3.640248098244896e-02; +3.586422022207980e-01   +1.655144016780148e-01   +1.127109318383012e-01   +3.499971971161743e-01   +5.609740566888544e-02   -1.834224117141675e-01   +2.188803164268375e-01   +2.778155313094269e-02; +7.766088407554994e-03   -1.330113713858564e-01   +8.853143358905206e-02   +1.567986688288417e-01   -4.082554779865707e-01   -1.450325680129478e-01   +1.240135028542838e-01   -4.049496722727562e-01; +4.028951806851658e-02   +6.790277444746154e-02   -8.277626262563141e-02   +2.335313828359480e-01   +5.419222941892135e-02   +2.594678728615707e-01   +2.938063870056553e-01   -3.173033255079896e-01];
L2E_L2I_iGABA_netcon = [-3.415949076511400e-01   -3.378653938619277e-01   +3.431087916089626e-02   -2.607031026023669e-01   +7.624706999538709e-02   +5.274850740032144e-03   +2.327060540544260e-01   -4.887591698806375e-01; -7.523879213125245e-02   -1.917478875755675e-02   +1.706268883747753e-01   +1.971951762706408e-01   +2.860098119695078e-01   -2.574605141522684e-01   -7.400138311117541e-02   -5.343790257263580e-02; -1.611669153960538e-01   -1.568960474222484e-01   +2.749284402499946e-01   -8.604268283677807e-02   +2.563389663068074e-01   +4.424414817752674e-01   -2.735652286505397e-01   -3.574737153662386e-02; +6.245525338234148e-02   +9.606211391660321e-02   +1.528125749897683e-02   +1.582623071451753e-01   +5.596015599252894e-01   -3.775441392733664e-01   -1.293291914347084e-01   +2.735674846299256e-01; +3.490368806075494e-02   -1.085261101646157e-01   -3.552704230948287e-01   -8.579503991507992e-02   -3.180126167201062e-01   -2.421118579777925e-01   +4.504442016637730e-01   +3.151038151062518e-01; +1.640738321232489e-01   -7.845085696440304e-02   +1.227429411408223e-02   +5.144562428804181e-02   +2.068007662563959e-01   -6.121052444520560e-02   +9.916973242387672e-02   -2.215427810841878e-01; -1.396419097889589e-01   -1.069334961990470e-01   +6.107151382316014e-01   -2.393656759634448e-02   -2.199957157164747e-01   -2.445006143996470e-01   +1.179837388349709e-01   -1.385707374359502e-01; +1.568570017329014e-01   -2.814381984498464e-01   +2.486979880133042e-01   +9.447202917625963e-02   -3.012155640246211e-01   -5.236766563266908e-02   +3.158082186997659e-01   +3.656807008383087e-01];
L3E_L2E_iAMPA_netcon = [-1.714284571009101e-01   +7.784598841814282e-02   +1.735766566676994e-01   -2.096983365765468e-01   +1.822496965200435e-01   +1.646930174968160e-01   +2.691919036112527e-01   +1.248032859001628e-01   -5.173818682520255e-02   +3.922323362880918e-01   -2.025534508954053e-01   -5.702867545276361e-02; -8.843362210786854e-02   -6.038062057176172e-02   +4.432573922302977e-01   +5.218657479032748e-02   -1.674724498014553e-02   +1.764131640848764e-02   -3.921285597884430e-01   -1.376459399821805e-01   -8.091149457371291e-02   -3.818398986921022e-01   +2.396285283502363e-01   -1.348246177406419e-02; -2.959770783295147e-01   -2.820524447111856e-01   +1.085357471720238e-01   -1.510878671501521e-01   -3.169327143178521e-01   -1.712313671766629e-01   +2.012346842608708e-01   -7.432039142668034e-02   -1.567035457707240e-01   -1.639023413507371e-01   +1.764345569078129e-01   +9.692491102062882e-02; -2.552845488705122e-01   +1.775660799064616e-01   -1.056309765045932e-02   +2.418730719336863e-01   +1.922623453974759e-01   -7.799937374420401e-02   +1.333000002159402e-01   +4.992470853906517e-02   -4.118506082248314e-01   -1.136335880077294e-01   -4.426895412246828e-01   -1.133573961659431e-02; +1.765159125705453e-01   +8.901618804422728e-02   -1.296832670324055e-01   +3.283831896293222e-01   -4.173842367333896e-01   +1.373562211977238e-01   -1.358902123846912e-01   +2.524264948442365e-01   +7.915707903221056e-02   +1.406033736181325e-01   -1.071189453014865e-01   -3.305864783924783e-01; -5.315270856742469e-01   -6.708610518889566e-02   +2.534360964313258e-01   -3.304931253733550e-01   -2.401867228429225e-02   +2.447255172674551e-01   +1.289765955295135e-01   -2.502563712211758e-01   +2.658555760578232e-01   -7.364775019854428e-02   +4.234659326671077e-01   +3.972010756773270e-02; -3.717914254057633e-01   -3.083347853683743e-01   -8.153468399418315e-02   -1.892565806544248e-01   +3.023656472914770e-01   +1.131764304224069e-01   +1.084006848985665e-01   +1.734235615424787e-01   +4.053620726524384e-01   -9.203430193951247e-02   -9.066731002647738e-03   -2.942905022634981e-01; -1.741855668997021e-01   +1.689392050831757e-01   +1.616727890377570e-01   +7.837636407890977e-02   +4.551530138850857e-02   -1.770247541369153e-01   -1.548405253983119e-01   +9.685808041015671e-02   -4.807401509907211e-02   -1.691769956088989e-01   -2.542714989958419e-01   +3.012285379756293e-01];
L3I_L2I_iGABA_netcon = [-2.377754941665253e-01   +3.298304247202478e-01   -1.826003434883736e-01   +1.793741852147084e-01   -8.396488579776046e-02   -1.702607443451840e-03   -2.946780045469735e-01   -8.233520993876559e-02   -1.532139436448759e-01   +1.993524530271772e-01   -2.799688200911308e-01   +1.789588035384893e-01; -3.537805352268208e-01   -7.994709867473376e-02   +3.621297054106717e-01   +2.469938249379584e-01   +3.313728054605150e-01   -1.157037793673917e-02   +4.550252538660922e-01   +9.940467981693937e-02   -1.519503070390428e-01   -1.048248914407330e-01   +1.654139805440215e-01   +1.616368477020675e-01; +5.638616935659208e-02   +5.631057201617748e-02   -3.444647231251333e-03   -3.111729536004240e-01   +1.449551233688938e-01   -7.403939589315420e-02   +6.163239421209052e-02   +3.585382673036830e-01   -1.388449651403921e-01   -2.939638768441908e-01   -2.252493595292193e-01   -1.392086689508029e-02; +1.014237216440721e-01   -2.004472614744022e-02   +1.658486532393003e-01   +1.968957587861614e-02   +4.124400545350283e-01   +1.626548316040991e-01   +9.039265338477988e-02   +3.463110117975821e-01   -1.509545750059268e-02   -3.672172822171967e-01   +2.866414133181231e-01   +7.066256415667552e-02; +3.208409130956182e-01   -1.436958942943624e-01   -4.146421574249727e-01   +1.173042222744463e-01   +3.219247200284705e-01   +4.303556993251887e-02   +8.910611823672937e-02   -5.296509958215738e-01   -2.164876707350737e-01   +6.083550601519089e-02   +4.108972149588405e-01   +1.326375199725466e-01; +2.211741238348647e-02   -3.280421149086804e-02   -1.027834479842938e-01   +9.087126907867768e-02   +1.267120133717894e-01   -1.207659177205264e-02   -4.986636664534161e-01   -3.117983823612234e-01   -2.425196570583005e-01   -6.159422041386781e-03   -2.912023325709880e-01   -1.409868680974107e-01; +2.407941254739849e-01   +6.562285953650289e-02   +3.023101551848379e-01   -4.167150196087127e-01   -2.800244192940577e-01   +2.460900487576325e-01   +3.023180275196587e-01   -1.385523348347187e-01   +1.565097720304740e-01   -1.218332481949424e-01   +1.302073706554321e-01   +4.783164865086327e-01; +7.560766201048277e-02   -1.677619944402148e-01   -2.043641718397835e-01   +2.050487056176193e-01   +1.871376821114237e-01   -8.711669934233482e-02   +8.066336668689053e-02   -2.112001092618221e-01   +2.764979537738343e-02   +1.543477424081190e-01   +5.517052818083168e-02   -5.095773566692577e-02];
L2E_L3E_iAMPA_netcon = [-2.776990827393072e-01   -1.254443665857121e-02   +8.074734921328150e-02   +3.226897773110980e-01   +2.545663814925728e-01   +5.066139630009099e-01   -2.811234892151360e-01   -3.074393761600977e-01; +1.771632724288381e-01   +9.401543095852771e-02   +9.758477967891756e-02   +3.477734968931051e-02   -7.911231391200846e-02   +2.319991167391349e-01   -1.829661622577705e-01   +1.185046424205770e-01; -9.146512910879331e-02   +7.263147326483389e-02   -9.896851884639354e-02   -3.334829073238729e-01   +2.320815751532889e-01   +1.822508821552332e-01   +5.677639684586100e-02   +2.340905307334573e-02; +9.854022110520837e-02   -4.094208429935336e-02   +2.921309018928951e-01   +3.435521880377579e-01   -2.655384848021281e-01   -7.436530151038551e-02   -2.120727627474868e-01   +1.960748677754488e-02; -1.856444062340374e-01   -4.301367960119267e-02   +1.553817892206466e-02   -5.567839887072670e-02   -2.320881967253976e-01   -1.836594856093554e-01   +3.724876641607237e-02   -1.191879016888261e-01; -3.460813859210807e-01   -1.123517858891060e-01   -1.277128750159972e-01   +3.390759246964615e-01   +7.781445699720196e-03   -3.435414890299205e-01   +4.799866591344806e-02   -2.493580871198499e-01; -1.179373241372180e-01   -1.640244568172041e-01   +3.096819831993756e-01   -6.112622847014537e-02   +1.428425263829366e-01   -3.947123568486391e-01   -2.440385874454296e-02   -6.350772347044814e-03; -2.507960550003962e-02   +1.112125956258308e-01   -1.193960609407646e-01   +2.719239111741299e-02   -1.416124198949164e-01   +1.695803883070334e-01   -1.302226683553697e-01   -5.137685188235146e-01; +2.897819497857499e-01   +6.034053143845676e-03   +7.041823903934805e-02   -1.086773183099877e-01   -5.376273784015159e-03   -3.965870698054846e-02   -4.651149834511015e-01   -1.506657816614084e-01; -6.435288965161026e-02   -3.867275099581166e-02   -9.924894328817363e-02   -1.218402247079804e-01   +9.028007650876158e-02   +4.149497025027852e-01   +1.231452049301962e-02   +3.000205681184521e-01; +2.356129300213351e-01   -3.864518207712473e-01   +6.744503198671731e-03   +1.271243372906666e-01   -8.150011470218799e-02   +1.752459023081701e-01   +3.318148033167943e-01   +1.665261072575408e-01; +2.194015415531959e-01   +2.592458975110432e-01   -3.513330933967973e-01   -1.635644931991745e-02   +2.504350762175883e-01   -1.439214393596154e-01   +7.677082218923052e-02   -1.097773674114024e-01];
L2I_L3I_iGABA_netcon = [+1.009322238703801e-01   +7.720318833109974e-03   -1.077544348324680e-01   -3.611842862451811e-01   -4.571376988142127e-01   -6.145062878363741e-02   -1.761861591958041e-01   -5.785044280711555e-02; +3.613301209240585e-01   -2.173880174877944e-01   -3.346792737216082e-01   -3.060422166604975e-01   -8.019041597458011e-02   -2.149699355769835e-01   +2.088843900688770e-01   +1.381099870018306e-01; +2.935562940061717e-02   +1.124671700747980e-01   -9.469711853868906e-02   +3.440567016173261e-01   -1.456134489494409e-01   -9.522233945941588e-02   -1.917962590092472e-01   -2.091083538834495e-01; -2.404159113607144e-01   -2.184016263386386e-01   -1.049616735531967e-01   -2.088840615982673e-01   +6.306010555518476e-02   +1.175783354063878e-01   +1.320175928838291e-01   -2.696034736730909e-02; -3.267483107054825e-02   +1.142876530650025e-01   -2.246608972641526e-01   +1.711268844546507e-01   -1.048036141236091e-01   -8.769983644442463e-02   -2.685341406686599e-01   +5.508541361376997e-01; +1.279695514865438e-01   -1.856105976604603e-01   +1.931856125399321e-01   -2.103026315464085e-01   -2.667213313705488e-01   -1.319826653809630e-02   +1.302522591390247e-01   -4.082353947206779e-01; +3.043008849849815e-05   +5.131259706593033e-02   -1.350505326525815e-01   -1.108811469711911e-01   -4.041095172595531e-01   +8.469879622667043e-04   +4.338143716417999e-01   -4.588034331180680e-01; -2.613970832319323e-01   +1.434161797969898e-01   -4.939146821223905e-01   +3.953327012961994e-01   -3.575153069167608e-01   -2.761072218420936e-01   -3.282611594384943e-01   -6.355737653551130e-04; -1.385472677404062e-02   -9.915498194028273e-02   -2.340997627282431e-01   -3.879708744134081e-02   -4.165074850509732e-01   -7.160810628666434e-02   -7.718784681041843e-02   -3.132755429596823e-01; -3.672561917614376e-02   +9.650041997442607e-02   -2.249832614422092e-01   -6.781366042456960e-02   +2.056258944617731e-01   -7.371186590515795e-02   +1.272982830256710e-01   -2.324506799542589e-02; -5.809977781292849e-02   +3.509222029410313e-01   +2.754304505353140e-01   +1.002914862171944e-01   +6.053594408891416e-03   -4.506209303536785e-02   -6.901821088478288e-02   -1.092596653526116e-01; +2.702300505435044e-02   +1.105491437723531e-01   +2.587778611952082e-02   -9.111439958736983e-02   -2.512616858648855e-01   +2.803295085087645e-01   -3.427090616118522e-01   +2.219478305256513e-02];
L3I_L3E_iAMPA_netcon = [+1.593610558820163e-01   +5.902052049511233e-02   +5.999147809694412e-03   +1.372472023149102e-01   -1.129427339909399e-01   +5.222995815199542e-02   +3.702058059060532e-01   +3.754003122391944e-01   -1.413482544711986e-01   +1.946590562142462e-01   +8.213832565804546e-02   -1.228003612019266e-01; +4.209572216933684e-01   -2.732590825743608e-01   +1.101625973086520e-01   +7.913448319890007e-02   -1.020915950428761e-01   -1.166113166926306e-01   +2.057479165977384e-01   +2.753667524508889e-01   +7.952401206226994e-02   -1.105950995849879e-01   +2.190712600384001e-01   +5.629670001720949e-02; -1.590193807288549e-01   -4.491262299193063e-01   +3.436874305009927e-01   -1.689209496740619e-01   -1.296404261704564e-01   +2.784966026619412e-01   +3.473646994631182e-01   -2.536826766784695e-02   -3.645135566621888e-01   -1.803472608680564e-01   -1.864689125536833e-01   +1.364044822109183e-01; -2.195826522578031e-01   -1.845667375381879e-01   -4.101012271536574e-01   -2.201300832613537e-01   +4.846436669779040e-01   -7.306987080352646e-02   +1.457035502958016e-01   +2.375547868080516e-02   +3.467410227131569e-01   -3.652990654160482e-02   +5.071807701309706e-01   +1.017557672370464e-01; -3.418935182675105e-01   -1.131270613789555e-02   +8.272345096222111e-02   +1.684901607232033e-01   +1.421603617221822e-01   -4.542837902526668e-02   +2.819588791162139e-01   -1.366397483613439e-01   +3.254003482840194e-01   +2.393372200900190e-01   -4.539174808572612e-01   -1.081052327667653e-01; +9.928254336235287e-03   +5.142019741170589e-02   +1.655058128595891e-01   +4.704137999775382e-01   -3.803701354934080e-01   -1.605941716118917e-01   -3.306603454032759e-01   -3.101952988918407e-01   -2.844734520180278e-02   +2.334013908189028e-01   -2.092570647688469e-01   -6.594943269089686e-02; +2.516133786482343e-01   +1.041268499212460e-01   -2.014386167854204e-01   +3.144741052951586e-01   +1.761746141852953e-02   -2.866309700391175e-01   +9.670001670456535e-02   +7.479565023969796e-02   -3.816564219922341e-01   -1.281021053162801e-01   -1.053721804100241e-01   -3.300410490145692e-01; +3.296004377257534e-01   -4.578732243422368e-01   +4.494964058138728e-02   +2.503208699337138e-01   -2.180401838010823e-01   +3.641547312615286e-01   -3.315212880835317e-01   +2.917177546307839e-01   -1.177294636004896e-01   +1.167643364015550e-01   -4.862501770982980e-02   -1.550143350761704e-01; -6.180450713007965e-02   +3.853359722023600e-01   +1.952274448485941e-01   +5.760432097494206e-02   -1.103035911095774e-01   -2.270439252171907e-01   +1.884750106788115e-01   -3.035421888201289e-02   +1.015707998166375e-01   -1.588088363849429e-01   +1.751178986782295e-01   -2.891594420902501e-01; -2.621720774150273e-02   +7.679845507168215e-03   -5.164430724759687e-02   -8.725313726355821e-03   -5.105901182371589e-02   +3.701082222810054e-01   +1.616004203300347e-02   +9.369249305867161e-03   -1.684136491145855e-01   +1.076658103588289e-01   +9.090780218882549e-02   +4.477940011750993e-01; +2.177243450630185e-01   -8.212556870453944e-02   -3.063518643672805e-01   +6.271199750560533e-02   -1.872216120466622e-01   -3.819628040797277e-01   -3.743261442939699e-01   +8.879756963657090e-02   -1.235708112648679e-01   -1.169706699834928e-02   +2.165434221589202e-01   -3.064985530213499e-02; +1.663592473691812e-01   -1.719366763551201e-01   -9.291278140473833e-02   +1.200996456936422e-01   -3.973967130208061e-01   -1.136791943432861e-01   -6.834635178160828e-02   -3.940317173552768e-01   -2.211605834288904e-01   -1.056603974751661e-02   -3.535970287224794e-01   +3.597581001666953e-01];
L3E_L3I_iGABA_netcon = [+4.547499178059899e-02   +2.404165159166776e-01   -2.446033687420237e-01   +3.299144440435936e-02   +2.623242857020707e-01   +2.400918178817855e-01   +4.421055238097468e-01   -1.606585525898031e-01   +2.383685419934107e-01   +1.666073602952102e-01   +1.368258145745931e-01   +2.298805317358260e-01; +3.900173168705006e-01   -1.714455370684183e-01   +1.152369255956251e-01   +1.668959633442124e-01   +8.014668455893115e-02   -1.787902749440097e-01   +3.882991460370144e-01   -1.611878132120741e-01   -2.652241083506494e-01   +3.718302588597570e-02   +1.089630079977520e-01   -2.520006134069597e-01; +1.120541525054718e-01   +2.139910643800744e-01   -2.650013345510163e-01   -8.182510334911110e-02   +1.478840204848847e-01   -3.802925878912087e-01   -2.931865167378402e-01   +1.439364880301937e-01   -9.735699390244532e-02   +2.514731591111789e-01   -2.159750026972271e-01   -4.214896764558209e-01; -7.611511961290265e-02   -2.094326683477438e-01   -2.059073127848367e-01   -3.726102680979201e-02   -1.800167544383935e-01   -1.796533512711550e-01   +1.786216897467934e-01   +1.791298804115641e-01   -1.659634265248251e-02   -8.050157515885212e-02   +4.181122198416259e-01   +2.116287127896848e-01; +1.228051181695377e-01   -3.660588020796535e-01   -3.064768729598414e-01   -1.621279441186256e-01   -2.221158958966026e-01   -1.846920729367910e-01   +2.509090528011906e-02   +8.697610764631436e-02   +9.259385492724914e-02   -1.740111064476657e-01   +1.212913113465120e-01   -2.030924615508670e-02; +1.450946312956628e-01   -2.252220205655782e-01   -1.775696545980566e-01   -4.423541809144280e-01   +2.618510638497552e-01   +1.082269344064252e-01   -1.184091022018521e-01   +3.647887624946514e-02   -7.290212035933322e-02   -1.113071698104831e-03   -7.465961700127308e-02   +9.684253835677392e-02; -2.676376890677515e-01   -1.505469984694854e-01   -1.990674229006518e-01   +1.187910956318139e-02   -1.206299334045251e-01   +2.144941326513702e-01   +1.703299636889440e-01   +5.842714436833549e-02   -2.776570729878005e-01   +5.872809428869200e-01   +3.739767580241540e-01   -4.790594139024452e-02; +6.779103034925434e-02   -2.060794450537470e-01   -1.384009886378494e-01   +1.246102736440288e-01   +1.736833387186776e-02   +1.909958010323361e-01   -4.155258827742953e-01   +2.487182195376597e-01   -9.408194739624028e-02   -2.646015424919869e-01   -2.217173197811945e-02   +3.171241359100141e-01; -2.917697308424411e-01   -3.055015160153040e-01   -1.388819354012979e-01   -4.889726374561233e-01   +3.518413428244275e-01   -1.995854982397804e-01   -1.269306610259232e-01   +2.126637275426883e-01   +6.685101120624211e-02   -2.207427746612873e-01   +1.724285048652963e-01   +3.525798637030746e-01; -1.040131261070765e-01   -1.032278910850894e-01   +4.726641555375318e-01   -1.211172607414569e-02   +3.578003638503968e-03   +7.825187963254403e-02   -3.187165963363727e-01   -2.378969434675426e-01   -9.709540790799390e-02   +1.052802747384424e-01   +1.028648203916394e-01   +4.387854150549683e-01; +1.913402398347157e-01   -8.270019330121846e-02   -5.020528769597742e-02   -1.750391296523545e-01   -7.845580042579350e-02   +3.503460703253108e-02   +1.764005079855723e-01   -9.061264117914071e-02   -4.922580886754771e-02   +8.936040922442835e-02   +4.352518415984094e-03   +2.481188099439952e-01; -2.117158510217442e-01   +8.294923836594029e-02   -5.270807741433348e-01   -3.608354008657749e-02   -7.129212854052022e-02   +2.955520025560051e-01   -1.634276527785708e-01   -1.360273784361865e-01   +2.482270217255033e-01   +1.584741073869383e-01   +2.835227134768085e-01   -1.393077476801339e-01];
L2E_Input1_iAMPA_netcon = [-2.401926245776463e-01   -5.581202782618224e-01   +2.000766512164396e-01   +1.358387728098553e-01   +2.127904409153287e-01   -2.563381670676333e-01   +2.073683266125630e-02   +4.158932494601640e-01];
L2I_Input2_iAMPA_netcon = [+1.657504309563428e-01   -9.387015317953970e-02   +1.315389332316402e-01   -6.839212961160951e-02   +4.532755721736572e-01   +2.301671240490399e-01   -1.335838482354518e-01   +9.636944826141802e-03];

% ------------------------------------------------------------
% Initial conditions:
% ------------------------------------------------------------
t=0; k=1;

% STATE_VARIABLES:
L1I_v_last = zeros(1,p.L1I_Npop);
L1I_v = zeros(nsamp,p.L1I_Npop);
L1I_v(1,:) = L1I_v_last;
L1I_iNa_m_last = p.L1I_iNa_m_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_m = zeros(nsamp,p.L1I_Npop);
L1I_iNa_m(1,:) = L1I_iNa_m_last;
L1I_iNa_h_last = p.L1I_iNa_h_IC+p.L1I_iNa_IC_noise*rand(1,p.L1I_Npop);
L1I_iNa_h = zeros(nsamp,p.L1I_Npop);
L1I_iNa_h(1,:) = L1I_iNa_h_last;
L1I_iK_n_last = p.L1I_iK_n_IC+p.L1I_iK_IC_noise*rand(1,p.L1I_Npop);
L1I_iK_n = zeros(nsamp,p.L1I_Npop);
L1I_iK_n(1,:) = L1I_iK_n_last;
L2I_v_last = zeros(1,p.L2I_Npop);
L2I_v = zeros(nsamp,p.L2I_Npop);
L2I_v(1,:) = L2I_v_last;
L2I_iNa_m_last = p.L2I_iNa_m_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_m = zeros(nsamp,p.L2I_Npop);
L2I_iNa_m(1,:) = L2I_iNa_m_last;
L2I_iNa_h_last = p.L2I_iNa_h_IC+p.L2I_iNa_IC_noise*rand(1,p.L2I_Npop);
L2I_iNa_h = zeros(nsamp,p.L2I_Npop);
L2I_iNa_h(1,:) = L2I_iNa_h_last;
L2I_iK_n_last = p.L2I_iK_n_IC+p.L2I_iK_IC_noise*rand(1,p.L2I_Npop);
L2I_iK_n = zeros(nsamp,p.L2I_Npop);
L2I_iK_n(1,:) = L2I_iK_n_last;
L3I_v_last = zeros(1,p.L3I_Npop);
L3I_v = zeros(nsamp,p.L3I_Npop);
L3I_v(1,:) = L3I_v_last;
L3I_iNa_m_last = p.L3I_iNa_m_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_m = zeros(nsamp,p.L3I_Npop);
L3I_iNa_m(1,:) = L3I_iNa_m_last;
L3I_iNa_h_last = p.L3I_iNa_h_IC+p.L3I_iNa_IC_noise*rand(1,p.L3I_Npop);
L3I_iNa_h = zeros(nsamp,p.L3I_Npop);
L3I_iNa_h(1,:) = L3I_iNa_h_last;
L3I_iK_n_last = p.L3I_iK_n_IC+p.L3I_iK_IC_noise*rand(1,p.L3I_Npop);
L3I_iK_n = zeros(nsamp,p.L3I_Npop);
L3I_iK_n(1,:) = L3I_iK_n_last;
L1E_v_last = zeros(1,p.L1E_Npop);
L1E_v = zeros(nsamp,p.L1E_Npop);
L1E_v(1,:) = L1E_v_last;
L1E_iNa_m_last = p.L1E_iNa_m_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_m = zeros(nsamp,p.L1E_Npop);
L1E_iNa_m(1,:) = L1E_iNa_m_last;
L1E_iNa_h_last = p.L1E_iNa_h_IC+p.L1E_iNa_IC_noise*rand(1,p.L1E_Npop);
L1E_iNa_h = zeros(nsamp,p.L1E_Npop);
L1E_iNa_h(1,:) = L1E_iNa_h_last;
L1E_iK_n_last = p.L1E_iK_n_IC+p.L1E_iK_IC_noise*rand(1,p.L1E_Npop);
L1E_iK_n = zeros(nsamp,p.L1E_Npop);
L1E_iK_n(1,:) = L1E_iK_n_last;
L2E_v_last = zeros(1,p.L2E_Npop);
L2E_v = zeros(nsamp,p.L2E_Npop);
L2E_v(1,:) = L2E_v_last;
L2E_iNa_m_last = p.L2E_iNa_m_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_m = zeros(nsamp,p.L2E_Npop);
L2E_iNa_m(1,:) = L2E_iNa_m_last;
L2E_iNa_h_last = p.L2E_iNa_h_IC+p.L2E_iNa_IC_noise*rand(1,p.L2E_Npop);
L2E_iNa_h = zeros(nsamp,p.L2E_Npop);
L2E_iNa_h(1,:) = L2E_iNa_h_last;
L2E_iK_n_last = p.L2E_iK_n_IC+p.L2E_iK_IC_noise*rand(1,p.L2E_Npop);
L2E_iK_n = zeros(nsamp,p.L2E_Npop);
L2E_iK_n(1,:) = L2E_iK_n_last;
L3E_v_last = zeros(1,p.L3E_Npop);
L3E_v = zeros(nsamp,p.L3E_Npop);
L3E_v(1,:) = L3E_v_last;
L3E_iNa_m_last = p.L3E_iNa_m_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_m = zeros(nsamp,p.L3E_Npop);
L3E_iNa_m(1,:) = L3E_iNa_m_last;
L3E_iNa_h_last = p.L3E_iNa_h_IC+p.L3E_iNa_IC_noise*rand(1,p.L3E_Npop);
L3E_iNa_h = zeros(nsamp,p.L3E_Npop);
L3E_iNa_h(1,:) = L3E_iNa_h_last;
L3E_iK_n_last = p.L3E_iK_n_IC+p.L3E_iK_IC_noise*rand(1,p.L3E_Npop);
L3E_iK_n = zeros(nsamp,p.L3E_Npop);
L3E_iK_n(1,:) = L3E_iK_n_last;
Input1_v_last = zeros(1,p.Input1_Npop);
Input1_v = zeros(nsamp,p.Input1_Npop);
Input1_v(1,:) = Input1_v_last;
Input1_iNa_m_last = p.Input1_iNa_m_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_m = zeros(nsamp,p.Input1_Npop);
Input1_iNa_m(1,:) = Input1_iNa_m_last;
Input1_iNa_h_last = p.Input1_iNa_h_IC+p.Input1_iNa_IC_noise*rand(1,p.Input1_Npop);
Input1_iNa_h = zeros(nsamp,p.Input1_Npop);
Input1_iNa_h(1,:) = Input1_iNa_h_last;
Input1_iK_n_last = p.Input1_iK_n_IC+p.Input1_iK_IC_noise*rand(1,p.Input1_Npop);
Input1_iK_n = zeros(nsamp,p.Input1_Npop);
Input1_iK_n(1,:) = Input1_iK_n_last;
Input2_v_last = zeros(1,p.Input2_Npop);
Input2_v = zeros(nsamp,p.Input2_Npop);
Input2_v(1,:) = Input2_v_last;
Input2_iNa_m_last = p.Input2_iNa_m_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_m = zeros(nsamp,p.Input2_Npop);
Input2_iNa_m(1,:) = Input2_iNa_m_last;
Input2_iNa_h_last = p.Input2_iNa_h_IC+p.Input2_iNa_IC_noise*rand(1,p.Input2_Npop);
Input2_iNa_h = zeros(nsamp,p.Input2_Npop);
Input2_iNa_h(1,:) = Input2_iNa_h_last;
Input2_iK_n_last = p.Input2_iK_n_IC+p.Input2_iK_IC_noise*rand(1,p.Input2_Npop);
Input2_iK_n = zeros(nsamp,p.Input2_Npop);
Input2_iK_n(1,:) = Input2_iK_n_last;
L1I_L1E_iAMPA_s_last =  p.L1I_L1E_iAMPA_IC+p.L1I_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L1I_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L1I_L1E_iAMPA_s(1,:) = L1I_L1E_iAMPA_s_last;
L1E_L1I_iGABA_s_last =  p.L1E_L1I_iGABA_IC+p.L1E_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L1E_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L1E_L1I_iGABA_s(1,:) = L1E_L1I_iGABA_s_last;
L2I_L1I_iGABA_s_last =  p.L2I_L1I_iGABA_IC+p.L2I_L1I_iGABA_IC_noise.*rand(1,p.L1I_Npop);
L2I_L1I_iGABA_s = zeros(nsamp,p.L1I_Npop);
L2I_L1I_iGABA_s(1,:) = L2I_L1I_iGABA_s_last;
L1I_L2I_iGABA_s_last =  p.L1I_L2I_iGABA_IC+p.L1I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L1I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L1I_L2I_iGABA_s(1,:) = L1I_L2I_iGABA_s_last;
L2E_L1E_iAMPA_s_last =  p.L2E_L1E_iAMPA_IC+p.L2E_L1E_iAMPA_IC_noise.*rand(1,p.L1E_Npop);
L2E_L1E_iAMPA_s = zeros(nsamp,p.L1E_Npop);
L2E_L1E_iAMPA_s(1,:) = L2E_L1E_iAMPA_s_last;
L1E_L2E_iAMPA_s_last =  p.L1E_L2E_iAMPA_IC+p.L1E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L1E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L1E_L2E_iAMPA_s(1,:) = L1E_L2E_iAMPA_s_last;
L2I_L2E_iAMPA_s_last =  p.L2I_L2E_iAMPA_IC+p.L2I_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L2I_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L2I_L2E_iAMPA_s(1,:) = L2I_L2E_iAMPA_s_last;
L2E_L2I_iGABA_s_last =  p.L2E_L2I_iGABA_IC+p.L2E_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L2E_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L2E_L2I_iGABA_s(1,:) = L2E_L2I_iGABA_s_last;
L3E_L2E_iAMPA_s_last =  p.L3E_L2E_iAMPA_IC+p.L3E_L2E_iAMPA_IC_noise.*rand(1,p.L2E_Npop);
L3E_L2E_iAMPA_s = zeros(nsamp,p.L2E_Npop);
L3E_L2E_iAMPA_s(1,:) = L3E_L2E_iAMPA_s_last;
L3I_L2I_iGABA_s_last =  p.L3I_L2I_iGABA_IC+p.L3I_L2I_iGABA_IC_noise.*rand(1,p.L2I_Npop);
L3I_L2I_iGABA_s = zeros(nsamp,p.L2I_Npop);
L3I_L2I_iGABA_s(1,:) = L3I_L2I_iGABA_s_last;
L2E_L3E_iAMPA_s_last =  p.L2E_L3E_iAMPA_IC+p.L2E_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L2E_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L2E_L3E_iAMPA_s(1,:) = L2E_L3E_iAMPA_s_last;
L2I_L3I_iGABA_s_last =  p.L2I_L3I_iGABA_IC+p.L2I_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L2I_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L2I_L3I_iGABA_s(1,:) = L2I_L3I_iGABA_s_last;
L3I_L3E_iAMPA_s_last =  p.L3I_L3E_iAMPA_IC+p.L3I_L3E_iAMPA_IC_noise.*rand(1,p.L3E_Npop);
L3I_L3E_iAMPA_s = zeros(nsamp,p.L3E_Npop);
L3I_L3E_iAMPA_s(1,:) = L3I_L3E_iAMPA_s_last;
L3E_L3I_iGABA_s_last =  p.L3E_L3I_iGABA_IC+p.L3E_L3I_iGABA_IC_noise.*rand(1,p.L3I_Npop);
L3E_L3I_iGABA_s = zeros(nsamp,p.L3I_Npop);
L3E_L3I_iGABA_s(1,:) = L3E_L3I_iGABA_s_last;
L2E_Input1_iAMPA_s_last =  p.L2E_Input1_iAMPA_IC+p.L2E_Input1_iAMPA_IC_noise.*rand(1,p.Input1_Npop);
L2E_Input1_iAMPA_s = zeros(nsamp,p.Input1_Npop);
L2E_Input1_iAMPA_s(1,:) = L2E_Input1_iAMPA_s_last;
L2I_Input2_iAMPA_s_last =  p.L2I_Input2_iAMPA_IC+p.L2I_Input2_iAMPA_IC_noise.*rand(1,p.Input2_Npop);
L2I_Input2_iAMPA_s = zeros(nsamp,p.Input2_Npop);
L2I_Input2_iAMPA_s(1,:) = L2I_Input2_iAMPA_s_last;

% MONITORS:
L1I_tspike = -1e32*ones(2,p.L1I_Npop);
L1I_buffer_index = ones(1,p.L1I_Npop);
L1I_v_spikes = zeros(nsamp,p.L1I_Npop);
L2I_tspike = -1e32*ones(2,p.L2I_Npop);
L2I_buffer_index = ones(1,p.L2I_Npop);
L2I_v_spikes = zeros(nsamp,p.L2I_Npop);
L3I_tspike = -1e32*ones(2,p.L3I_Npop);
L3I_buffer_index = ones(1,p.L3I_Npop);
L3I_v_spikes = zeros(nsamp,p.L3I_Npop);
L1E_tspike = -1e32*ones(2,p.L1E_Npop);
L1E_buffer_index = ones(1,p.L1E_Npop);
L1E_v_spikes = zeros(nsamp,p.L1E_Npop);
L2E_tspike = -1e32*ones(2,p.L2E_Npop);
L2E_buffer_index = ones(1,p.L2E_Npop);
L2E_v_spikes = zeros(nsamp,p.L2E_Npop);
L3E_tspike = -1e32*ones(2,p.L3E_Npop);
L3E_buffer_index = ones(1,p.L3E_Npop);
L3E_v_spikes = zeros(nsamp,p.L3E_Npop);
Input1_tspike = -1e32*ones(2,p.Input1_Npop);
Input1_buffer_index = ones(1,p.Input1_Npop);
Input1_v_spikes = zeros(nsamp,p.Input1_Npop);
Input2_tspike = -1e32*ones(2,p.Input2_Npop);
Input2_buffer_index = ones(1,p.Input2_Npop);
Input2_v_spikes = zeros(nsamp,p.Input2_Npop);
L1E_L1I_iGABA_IGABA = zeros(nsamp,p.L1E_Npop);
  L1E_L1I_iGABA_IGABA(1,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA));
L1E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L1E_Npop);
  L1E_L2E_iAMPA_IAMPA(1,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA);
L1I_L1E_iAMPA_IAMPA = zeros(nsamp,p.L1I_Npop);
  L1I_L1E_iAMPA_IAMPA(1,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA);
L1I_L2I_iGABA_IGABA = zeros(nsamp,p.L1I_Npop);
  L1I_L2I_iGABA_IGABA(1,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA));
L2E_Input1_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_Input1_iAMPA_IAMPA(1,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA);
L2E_L1E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L1E_iAMPA_IAMPA(1,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA);
L2E_L2I_iGABA_IGABA = zeros(nsamp,p.L2E_Npop);
  L2E_L2I_iGABA_IGABA(1,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA));
L2E_L3E_iAMPA_IAMPA = zeros(nsamp,p.L2E_Npop);
  L2E_L3E_iAMPA_IAMPA(1,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA);
L2I_Input2_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_Input2_iAMPA_IAMPA(1,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA);
L2I_L1I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L1I_iGABA_IGABA(1,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA));
L2I_L2E_iAMPA_IAMPA = zeros(nsamp,p.L2I_Npop);
  L2I_L2E_iAMPA_IAMPA(1,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA);
L2I_L3I_iGABA_IGABA = zeros(nsamp,p.L2I_Npop);
  L2I_L3I_iGABA_IGABA(1,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA));
L3E_L2E_iAMPA_IAMPA = zeros(nsamp,p.L3E_Npop);
  L3E_L2E_iAMPA_IAMPA(1,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA);
L3E_L3I_iGABA_IGABA = zeros(nsamp,p.L3E_Npop);
  L3E_L3I_iGABA_IGABA(1,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA));
L3I_L2I_iGABA_IGABA = zeros(nsamp,p.L3I_Npop);
  L3I_L2I_iGABA_IGABA(1,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA));
L3I_L3E_iAMPA_IAMPA = zeros(nsamp,p.L3I_Npop);
  L3I_L3E_iAMPA_IAMPA(1,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA);

% ###########################################################
% Numerical integration:
% ###########################################################
n=2;
for k=2:ntime
  t=T(k-1);
  L1I_v_k1 = 0.03*p.L1I_Iapp + ((((-p.L1I_iNa_gNa.*L1I_iNa_m_last.^3.*L1I_iNa_h_last.*(L1I_v_last-p.L1I_iNa_ENa))))+((((-p.L1I_iK_gK.*L1I_iK_n_last.^4.*(L1I_v_last-p.L1I_iK_EK))))+((((-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s_last*L1I_L1E_iAMPA_netcon).*(L1I_v_last-p.L1I_L1E_iAMPA_EAMPA))))+((-(((p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s_last*L1I_L2I_iGABA_netcon).*(L1I_v_last-p.L1I_L2I_iGABA_EGABA)))))))))+0.7*p.L1I_noise*rand(1,p.L1I_Npop);
  L1I_iNa_m_k1 = (((2.5-.1*(L1I_v_last+65))./(exp(2.5-.1*(L1I_v_last+65))-1))).*(1-L1I_iNa_m_last)-((4*exp(-(L1I_v_last+65)/18))).*L1I_iNa_m_last;
  L1I_iNa_h_k1 = ((.07*exp(-(L1I_v_last+65)/20))).*(1-L1I_iNa_h_last)-((1./(exp(3-.1*(L1I_v_last+65))+1))).*L1I_iNa_h_last;
  L1I_iK_n_k1 = (((.1-.01*(L1I_v_last+65))./(exp(1-.1*(L1I_v_last+65))-1))).*(1-L1I_iK_n_last)-((.125*exp(-(L1I_v_last+65)/80))).*L1I_iK_n_last;
  L2I_v_k1 = 0.15*p.L2I_Iapp + ((((-p.L2I_iNa_gNa.*L2I_iNa_m_last.^3.*L2I_iNa_h_last.*(L2I_v_last-p.L2I_iNa_ENa))))+((((-p.L2I_iK_gK.*L2I_iK_n_last.^4.*(L2I_v_last-p.L2I_iK_EK))))+((-(((p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s_last*L2I_L1I_iGABA_netcon).*(L2I_v_last-p.L2I_L1I_iGABA_EGABA)))))+((((-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s_last*L2I_L2E_iAMPA_netcon).*(L2I_v_last-p.L2I_L2E_iAMPA_EAMPA))))+((-(((p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s_last*L2I_L3I_iGABA_netcon).*(L2I_v_last-p.L2I_L3I_iGABA_EGABA)))))+((((-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s_last*L2I_Input2_iAMPA_netcon).*(L2I_v_last-p.L2I_Input2_iAMPA_EAMPA))))))))))+0.7*p.L2I_noise*rand(1,p.L2I_Npop);
  L2I_iNa_m_k1 = (((2.5-.1*(L2I_v_last+65))./(exp(2.5-.1*(L2I_v_last+65))-1))).*(1-L2I_iNa_m_last)-((4*exp(-(L2I_v_last+65)/18))).*L2I_iNa_m_last;
  L2I_iNa_h_k1 = ((.07*exp(-(L2I_v_last+65)/20))).*(1-L2I_iNa_h_last)-((1./(exp(3-.1*(L2I_v_last+65))+1))).*L2I_iNa_h_last;
  L2I_iK_n_k1 = (((.1-.01*(L2I_v_last+65))./(exp(1-.1*(L2I_v_last+65))-1))).*(1-L2I_iK_n_last)-((.125*exp(-(L2I_v_last+65)/80))).*L2I_iK_n_last;
  L3I_v_k1 = 0.15*p.L3I_Iapp + ((((-p.L3I_iNa_gNa.*L3I_iNa_m_last.^3.*L3I_iNa_h_last.*(L3I_v_last-p.L3I_iNa_ENa))))+((((-p.L3I_iK_gK.*L3I_iK_n_last.^4.*(L3I_v_last-p.L3I_iK_EK))))+((-(((p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s_last*L3I_L2I_iGABA_netcon).*(L3I_v_last-p.L3I_L2I_iGABA_EGABA)))))+((((-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s_last*L3I_L3E_iAMPA_netcon).*(L3I_v_last-p.L3I_L3E_iAMPA_EAMPA))))))))+0.7*p.L3I_noise*rand(1,p.L3I_Npop);
  L3I_iNa_m_k1 = (((2.5-.1*(L3I_v_last+65))./(exp(2.5-.1*(L3I_v_last+65))-1))).*(1-L3I_iNa_m_last)-((4*exp(-(L3I_v_last+65)/18))).*L3I_iNa_m_last;
  L3I_iNa_h_k1 = ((.07*exp(-(L3I_v_last+65)/20))).*(1-L3I_iNa_h_last)-((1./(exp(3-.1*(L3I_v_last+65))+1))).*L3I_iNa_h_last;
  L3I_iK_n_k1 = (((.1-.01*(L3I_v_last+65))./(exp(1-.1*(L3I_v_last+65))-1))).*(1-L3I_iK_n_last)-((.125*exp(-(L3I_v_last+65)/80))).*L3I_iK_n_last;
  L1E_v_k1 = 0.03*p.L1E_Iapp + ((((-p.L1E_iNa_gNa.*L1E_iNa_m_last.^3.*L1E_iNa_h_last.*(L1E_v_last-p.L1E_iNa_ENa))))+((((-p.L1E_iK_gK.*L1E_iK_n_last.^4.*(L1E_v_last-p.L1E_iK_EK))))+((-(((p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s_last*L1E_L1I_iGABA_netcon).*(L1E_v_last-p.L1E_L1I_iGABA_EGABA)))))+((((-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s_last*L1E_L2E_iAMPA_netcon).*(L1E_v_last-p.L1E_L2E_iAMPA_EAMPA))))))))+0.7*p.L1E_noise*rand(1,p.L1E_Npop);
  L1E_iNa_m_k1 = (((2.5-.1*(L1E_v_last+65))./(exp(2.5-.1*(L1E_v_last+65))-1))).*(1-L1E_iNa_m_last)-((4*exp(-(L1E_v_last+65)/18))).*L1E_iNa_m_last;
  L1E_iNa_h_k1 = ((.07*exp(-(L1E_v_last+65)/20))).*(1-L1E_iNa_h_last)-((1./(exp(3-.1*(L1E_v_last+65))+1))).*L1E_iNa_h_last;
  L1E_iK_n_k1 = (((.1-.01*(L1E_v_last+65))./(exp(1-.1*(L1E_v_last+65))-1))).*(1-L1E_iK_n_last)-((.125*exp(-(L1E_v_last+65)/80))).*L1E_iK_n_last;
  L2E_v_k1 = 0.15*p.L2E_Iapp + ((((-p.L2E_iNa_gNa.*L2E_iNa_m_last.^3.*L2E_iNa_h_last.*(L2E_v_last-p.L2E_iNa_ENa))))+((((-p.L2E_iK_gK.*L2E_iK_n_last.^4.*(L2E_v_last-p.L2E_iK_EK))))+((((-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s_last*L2E_L1E_iAMPA_netcon).*(L2E_v_last-p.L2E_L1E_iAMPA_EAMPA))))+((-(((p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s_last*L2E_L2I_iGABA_netcon).*(L2E_v_last-p.L2E_L2I_iGABA_EGABA)))))+((((-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s_last*L2E_L3E_iAMPA_netcon).*(L2E_v_last-p.L2E_L3E_iAMPA_EAMPA))))+((((-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s_last*L2E_Input1_iAMPA_netcon).*(L2E_v_last-p.L2E_Input1_iAMPA_EAMPA))))))))))+0.7*p.L2E_noise*rand(1,p.L2E_Npop);
  L2E_iNa_m_k1 = (((2.5-.1*(L2E_v_last+65))./(exp(2.5-.1*(L2E_v_last+65))-1))).*(1-L2E_iNa_m_last)-((4*exp(-(L2E_v_last+65)/18))).*L2E_iNa_m_last;
  L2E_iNa_h_k1 = ((.07*exp(-(L2E_v_last+65)/20))).*(1-L2E_iNa_h_last)-((1./(exp(3-.1*(L2E_v_last+65))+1))).*L2E_iNa_h_last;
  L2E_iK_n_k1 = (((.1-.01*(L2E_v_last+65))./(exp(1-.1*(L2E_v_last+65))-1))).*(1-L2E_iK_n_last)-((.125*exp(-(L2E_v_last+65)/80))).*L2E_iK_n_last;
  L3E_v_k1 = 0.15*p.L3E_Iapp + ((((-p.L3E_iNa_gNa.*L3E_iNa_m_last.^3.*L3E_iNa_h_last.*(L3E_v_last-p.L3E_iNa_ENa))))+((((-p.L3E_iK_gK.*L3E_iK_n_last.^4.*(L3E_v_last-p.L3E_iK_EK))))+((((-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s_last*L3E_L2E_iAMPA_netcon).*(L3E_v_last-p.L3E_L2E_iAMPA_EAMPA))))+((-(((p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s_last*L3E_L3I_iGABA_netcon).*(L3E_v_last-p.L3E_L3I_iGABA_EGABA)))))))))+0.7*p.L3E_noise*rand(1,p.L3E_Npop);
  L3E_iNa_m_k1 = (((2.5-.1*(L3E_v_last+65))./(exp(2.5-.1*(L3E_v_last+65))-1))).*(1-L3E_iNa_m_last)-((4*exp(-(L3E_v_last+65)/18))).*L3E_iNa_m_last;
  L3E_iNa_h_k1 = ((.07*exp(-(L3E_v_last+65)/20))).*(1-L3E_iNa_h_last)-((1./(exp(3-.1*(L3E_v_last+65))+1))).*L3E_iNa_h_last;
  L3E_iK_n_k1 = (((.1-.01*(L3E_v_last+65))./(exp(1-.1*(L3E_v_last+65))-1))).*(1-L3E_iK_n_last)-((.125*exp(-(L3E_v_last+65)/80))).*L3E_iK_n_last;
  Input1_v_k1 = 40*(sin(t)) * (((t>50)));
  Input1_iNa_m_k1 = (((2.5-.1*(Input1_v_last+65))./(exp(2.5-.1*(Input1_v_last+65))-1))).*(1-Input1_iNa_m_last)-((4*exp(-(Input1_v_last+65)/18))).*Input1_iNa_m_last;
  Input1_iNa_h_k1 = ((.07*exp(-(Input1_v_last+65)/20))).*(1-Input1_iNa_h_last)-((1./(exp(3-.1*(Input1_v_last+65))+1))).*Input1_iNa_h_last;
  Input1_iK_n_k1 = (((.1-.01*(Input1_v_last+65))./(exp(1-.1*(Input1_v_last+65))-1))).*(1-Input1_iK_n_last)-((.125*exp(-(Input1_v_last+65)/80))).*Input1_iK_n_last;
  Input2_v_k1 = 40*(sin(t)) * (((t>50)));
  Input2_iNa_m_k1 = (((2.5-.1*(Input2_v_last+65))./(exp(2.5-.1*(Input2_v_last+65))-1))).*(1-Input2_iNa_m_last)-((4*exp(-(Input2_v_last+65)/18))).*Input2_iNa_m_last;
  Input2_iNa_h_k1 = ((.07*exp(-(Input2_v_last+65)/20))).*(1-Input2_iNa_h_last)-((1./(exp(3-.1*(Input2_v_last+65))+1))).*Input2_iNa_h_last;
  Input2_iK_n_k1 = (((.1-.01*(Input2_v_last+65))./(exp(1-.1*(Input2_v_last+65))-1))).*(1-Input2_iK_n_last)-((.125*exp(-(Input2_v_last+65)/80))).*Input2_iK_n_last;
  L1I_L1E_iAMPA_s_k1 = -L1I_L1E_iAMPA_s_last./p.L1I_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L1I_L1E_iAMPA_s_last)/p.L1I_L1E_iAMPA_tauR);
  L1E_L1I_iGABA_s_k1 = -L1E_L1I_iGABA_s_last./p.L1E_L1I_iGABA_tauGABA + ((1-L1E_L1I_iGABA_s_last)/p.L1E_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L2I_L1I_iGABA_s_k1 = -L2I_L1I_iGABA_s_last./p.L2I_L1I_iGABA_tauGABA + ((1-L2I_L1I_iGABA_s_last)/p.L2I_L1I_iGABA_tauGABAr).*(1+tanh(L1I_v_last/10));
  L1I_L2I_iGABA_s_k1 = -L1I_L2I_iGABA_s_last./p.L1I_L2I_iGABA_tauGABA + ((1-L1I_L2I_iGABA_s_last)/p.L1I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L1E_iAMPA_s_k1 = -L2E_L1E_iAMPA_s_last./p.L2E_L1E_iAMPA_tauD + 1/2*(1+tanh(L1E_v_last/10)).*((1-L2E_L1E_iAMPA_s_last)/p.L2E_L1E_iAMPA_tauR);
  L1E_L2E_iAMPA_s_k1 = -L1E_L2E_iAMPA_s_last./p.L1E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L1E_L2E_iAMPA_s_last)/p.L1E_L2E_iAMPA_tauR);
  L2I_L2E_iAMPA_s_k1 = -L2I_L2E_iAMPA_s_last./p.L2I_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L2I_L2E_iAMPA_s_last)/p.L2I_L2E_iAMPA_tauR);
  L2E_L2I_iGABA_s_k1 = -L2E_L2I_iGABA_s_last./p.L2E_L2I_iGABA_tauGABA + ((1-L2E_L2I_iGABA_s_last)/p.L2E_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L3E_L2E_iAMPA_s_k1 = -L3E_L2E_iAMPA_s_last./p.L3E_L2E_iAMPA_tauD + 1/2*(1+tanh(L2E_v_last/10)).*((1-L3E_L2E_iAMPA_s_last)/p.L3E_L2E_iAMPA_tauR);
  L3I_L2I_iGABA_s_k1 = -L3I_L2I_iGABA_s_last./p.L3I_L2I_iGABA_tauGABA + ((1-L3I_L2I_iGABA_s_last)/p.L3I_L2I_iGABA_tauGABAr).*(1+tanh(L2I_v_last/10));
  L2E_L3E_iAMPA_s_k1 = -L2E_L3E_iAMPA_s_last./p.L2E_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L2E_L3E_iAMPA_s_last)/p.L2E_L3E_iAMPA_tauR);
  L2I_L3I_iGABA_s_k1 = -L2I_L3I_iGABA_s_last./p.L2I_L3I_iGABA_tauGABA + ((1-L2I_L3I_iGABA_s_last)/p.L2I_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L3I_L3E_iAMPA_s_k1 = -L3I_L3E_iAMPA_s_last./p.L3I_L3E_iAMPA_tauD + 1/2*(1+tanh(L3E_v_last/10)).*((1-L3I_L3E_iAMPA_s_last)/p.L3I_L3E_iAMPA_tauR);
  L3E_L3I_iGABA_s_k1 = -L3E_L3I_iGABA_s_last./p.L3E_L3I_iGABA_tauGABA + ((1-L3E_L3I_iGABA_s_last)/p.L3E_L3I_iGABA_tauGABAr).*(1+tanh(L3I_v_last/10));
  L2E_Input1_iAMPA_s_k1 = -L2E_Input1_iAMPA_s_last./p.L2E_Input1_iAMPA_tauD + 1/2*(1+tanh(Input1_v_last/10)).*((1-L2E_Input1_iAMPA_s_last)/p.L2E_Input1_iAMPA_tauR);
  L2I_Input2_iAMPA_s_k1 = -L2I_Input2_iAMPA_s_last./p.L2I_Input2_iAMPA_tauD + 1/2*(1+tanh(Input2_v_last/10)).*((1-L2I_Input2_iAMPA_s_last)/p.L2I_Input2_iAMPA_tauR);

  % ------------------------------------------------------------
  % Update state variables:
  % ------------------------------------------------------------
  L1I_v_last = L1I_v_last+dt*L1I_v_k1;
  L1I_iNa_m_last = L1I_iNa_m_last+dt*L1I_iNa_m_k1;
  L1I_iNa_h_last = L1I_iNa_h_last+dt*L1I_iNa_h_k1;
  L1I_iK_n_last = L1I_iK_n_last+dt*L1I_iK_n_k1;
  L2I_v_last = L2I_v_last+dt*L2I_v_k1;
  L2I_iNa_m_last = L2I_iNa_m_last+dt*L2I_iNa_m_k1;
  L2I_iNa_h_last = L2I_iNa_h_last+dt*L2I_iNa_h_k1;
  L2I_iK_n_last = L2I_iK_n_last+dt*L2I_iK_n_k1;
  L3I_v_last = L3I_v_last+dt*L3I_v_k1;
  L3I_iNa_m_last = L3I_iNa_m_last+dt*L3I_iNa_m_k1;
  L3I_iNa_h_last = L3I_iNa_h_last+dt*L3I_iNa_h_k1;
  L3I_iK_n_last = L3I_iK_n_last+dt*L3I_iK_n_k1;
  L1E_v_last = L1E_v_last+dt*L1E_v_k1;
  L1E_iNa_m_last = L1E_iNa_m_last+dt*L1E_iNa_m_k1;
  L1E_iNa_h_last = L1E_iNa_h_last+dt*L1E_iNa_h_k1;
  L1E_iK_n_last = L1E_iK_n_last+dt*L1E_iK_n_k1;
  L2E_v_last = L2E_v_last+dt*L2E_v_k1;
  L2E_iNa_m_last = L2E_iNa_m_last+dt*L2E_iNa_m_k1;
  L2E_iNa_h_last = L2E_iNa_h_last+dt*L2E_iNa_h_k1;
  L2E_iK_n_last = L2E_iK_n_last+dt*L2E_iK_n_k1;
  L3E_v_last = L3E_v_last+dt*L3E_v_k1;
  L3E_iNa_m_last = L3E_iNa_m_last+dt*L3E_iNa_m_k1;
  L3E_iNa_h_last = L3E_iNa_h_last+dt*L3E_iNa_h_k1;
  L3E_iK_n_last = L3E_iK_n_last+dt*L3E_iK_n_k1;
  Input1_v_last = Input1_v_last+dt*Input1_v_k1;
  Input1_iNa_m_last = Input1_iNa_m_last+dt*Input1_iNa_m_k1;
  Input1_iNa_h_last = Input1_iNa_h_last+dt*Input1_iNa_h_k1;
  Input1_iK_n_last = Input1_iK_n_last+dt*Input1_iK_n_k1;
  Input2_v_last = Input2_v_last+dt*Input2_v_k1;
  Input2_iNa_m_last = Input2_iNa_m_last+dt*Input2_iNa_m_k1;
  Input2_iNa_h_last = Input2_iNa_h_last+dt*Input2_iNa_h_k1;
  Input2_iK_n_last = Input2_iK_n_last+dt*Input2_iK_n_k1;
  L1I_L1E_iAMPA_s_last = L1I_L1E_iAMPA_s_last+dt*L1I_L1E_iAMPA_s_k1;
  L1E_L1I_iGABA_s_last = L1E_L1I_iGABA_s_last+dt*L1E_L1I_iGABA_s_k1;
  L2I_L1I_iGABA_s_last = L2I_L1I_iGABA_s_last+dt*L2I_L1I_iGABA_s_k1;
  L1I_L2I_iGABA_s_last = L1I_L2I_iGABA_s_last+dt*L1I_L2I_iGABA_s_k1;
  L2E_L1E_iAMPA_s_last = L2E_L1E_iAMPA_s_last+dt*L2E_L1E_iAMPA_s_k1;
  L1E_L2E_iAMPA_s_last = L1E_L2E_iAMPA_s_last+dt*L1E_L2E_iAMPA_s_k1;
  L2I_L2E_iAMPA_s_last = L2I_L2E_iAMPA_s_last+dt*L2I_L2E_iAMPA_s_k1;
  L2E_L2I_iGABA_s_last = L2E_L2I_iGABA_s_last+dt*L2E_L2I_iGABA_s_k1;
  L3E_L2E_iAMPA_s_last = L3E_L2E_iAMPA_s_last+dt*L3E_L2E_iAMPA_s_k1;
  L3I_L2I_iGABA_s_last = L3I_L2I_iGABA_s_last+dt*L3I_L2I_iGABA_s_k1;
  L2E_L3E_iAMPA_s_last = L2E_L3E_iAMPA_s_last+dt*L2E_L3E_iAMPA_s_k1;
  L2I_L3I_iGABA_s_last = L2I_L3I_iGABA_s_last+dt*L2I_L3I_iGABA_s_k1;
  L3I_L3E_iAMPA_s_last = L3I_L3E_iAMPA_s_last+dt*L3I_L3E_iAMPA_s_k1;
  L3E_L3I_iGABA_s_last = L3E_L3I_iGABA_s_last+dt*L3E_L3I_iGABA_s_k1;
  L2E_Input1_iAMPA_s_last = L2E_Input1_iAMPA_s_last+dt*L2E_Input1_iAMPA_s_k1;
  L2I_Input2_iAMPA_s_last = L2I_Input2_iAMPA_s_last+dt*L2I_Input2_iAMPA_s_k1;

  % ------------------------------------------------------------
  % Conditional actions:
  % ------------------------------------------------------------
  conditional_test=any(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  conditional_indx=(any(Input2_v_last>=0&Input2_v(n-1,:)<0));
  if conditional_test, Input2_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input2_tspike(Input2_buffer_index(i),i)=t; Input2_buffer_index(i)=mod(-1+(Input2_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  conditional_indx=(any(Input1_v_last>=0&Input1_v(n-1,:)<0));
  if conditional_test, Input1_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); Input1_tspike(Input1_buffer_index(i),i)=t; Input1_buffer_index(i)=mod(-1+(Input1_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  conditional_indx=(any(L3E_v_last>=0&L3E_v(n-1,:)<0));
  if conditional_test, L3E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3E_tspike(L3E_buffer_index(i),i)=t; L3E_buffer_index(i)=mod(-1+(L3E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  conditional_indx=(any(L2E_v_last>=0&L2E_v(n-1,:)<0));
  if conditional_test, L2E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2E_tspike(L2E_buffer_index(i),i)=t; L2E_buffer_index(i)=mod(-1+(L2E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  conditional_indx=(any(L1E_v_last>=0&L1E_v(n-1,:)<0));
  if conditional_test, L1E_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1E_tspike(L1E_buffer_index(i),i)=t; L1E_buffer_index(i)=mod(-1+(L1E_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  conditional_indx=(any(L3I_v_last>=0&L3I_v(n-1,:)<0));
  if conditional_test, L3I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L3I_tspike(L3I_buffer_index(i),i)=t; L3I_buffer_index(i)=mod(-1+(L3I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  conditional_indx=(any(L2I_v_last>=0&L2I_v(n-1,:)<0));
  if conditional_test, L2I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L2I_tspike(L2I_buffer_index(i),i)=t; L2I_buffer_index(i)=mod(-1+(L2I_buffer_index(i)+1),2)+1; end; end
  conditional_test=any(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  conditional_indx=(any(L1I_v_last>=0&L1I_v(n-1,:)<0));
  if conditional_test, L1I_v_spikes(n,conditional_indx)=1;inds=find(conditional_indx); for j=1:length(inds), i=inds(j); L1I_tspike(L1I_buffer_index(i),i)=t; L1I_buffer_index(i)=mod(-1+(L1I_buffer_index(i)+1),2)+1; end; end

  if mod(k,downsample_factor)==0 % store this time point

  % ------------------------------------------------------------
  % Store state variables:
  % ------------------------------------------------------------
    L1I_v(n,:) = L1I_v_last;
    L1I_iNa_m(n,:) = L1I_iNa_m_last;
    L1I_iNa_h(n,:) = L1I_iNa_h_last;
    L1I_iK_n(n,:) = L1I_iK_n_last;
    L2I_v(n,:) = L2I_v_last;
    L2I_iNa_m(n,:) = L2I_iNa_m_last;
    L2I_iNa_h(n,:) = L2I_iNa_h_last;
    L2I_iK_n(n,:) = L2I_iK_n_last;
    L3I_v(n,:) = L3I_v_last;
    L3I_iNa_m(n,:) = L3I_iNa_m_last;
    L3I_iNa_h(n,:) = L3I_iNa_h_last;
    L3I_iK_n(n,:) = L3I_iK_n_last;
    L1E_v(n,:) = L1E_v_last;
    L1E_iNa_m(n,:) = L1E_iNa_m_last;
    L1E_iNa_h(n,:) = L1E_iNa_h_last;
    L1E_iK_n(n,:) = L1E_iK_n_last;
    L2E_v(n,:) = L2E_v_last;
    L2E_iNa_m(n,:) = L2E_iNa_m_last;
    L2E_iNa_h(n,:) = L2E_iNa_h_last;
    L2E_iK_n(n,:) = L2E_iK_n_last;
    L3E_v(n,:) = L3E_v_last;
    L3E_iNa_m(n,:) = L3E_iNa_m_last;
    L3E_iNa_h(n,:) = L3E_iNa_h_last;
    L3E_iK_n(n,:) = L3E_iK_n_last;
    Input1_v(n) = Input1_v_last;
    Input1_iNa_m(n) = Input1_iNa_m_last;
    Input1_iNa_h(n) = Input1_iNa_h_last;
    Input1_iK_n(n) = Input1_iK_n_last;
    Input2_v(n) = Input2_v_last;
    Input2_iNa_m(n) = Input2_iNa_m_last;
    Input2_iNa_h(n) = Input2_iNa_h_last;
    Input2_iK_n(n) = Input2_iK_n_last;
    L1I_L1E_iAMPA_s(n,:) = L1I_L1E_iAMPA_s_last;
    L1E_L1I_iGABA_s(n,:) = L1E_L1I_iGABA_s_last;
    L2I_L1I_iGABA_s(n,:) = L2I_L1I_iGABA_s_last;
    L1I_L2I_iGABA_s(n,:) = L1I_L2I_iGABA_s_last;
    L2E_L1E_iAMPA_s(n,:) = L2E_L1E_iAMPA_s_last;
    L1E_L2E_iAMPA_s(n,:) = L1E_L2E_iAMPA_s_last;
    L2I_L2E_iAMPA_s(n,:) = L2I_L2E_iAMPA_s_last;
    L2E_L2I_iGABA_s(n,:) = L2E_L2I_iGABA_s_last;
    L3E_L2E_iAMPA_s(n,:) = L3E_L2E_iAMPA_s_last;
    L3I_L2I_iGABA_s(n,:) = L3I_L2I_iGABA_s_last;
    L2E_L3E_iAMPA_s(n,:) = L2E_L3E_iAMPA_s_last;
    L2I_L3I_iGABA_s(n,:) = L2I_L3I_iGABA_s_last;
    L3I_L3E_iAMPA_s(n,:) = L3I_L3E_iAMPA_s_last;
    L3E_L3I_iGABA_s(n,:) = L3E_L3I_iGABA_s_last;
    L2E_Input1_iAMPA_s(n) = L2E_Input1_iAMPA_s_last;
    L2I_Input2_iAMPA_s(n) = L2I_Input2_iAMPA_s_last;

  % ------------------------------------------------------------
  % Update monitors:
  % ------------------------------------------------------------
  L1E_L1I_iGABA_IGABA(n,:)=(p.L1E_L1I_iGABA_gGABA.*(L1E_L1I_iGABA_s(n,:)*L1E_L1I_iGABA_netcon).*(L1E_v(n,:)-p.L1E_L1I_iGABA_EGABA));
  L1E_L2E_iAMPA_IAMPA(n,:)=-p.L1E_L2E_iAMPA_gAMPA.*(L1E_L2E_iAMPA_s(n,:)*L1E_L2E_iAMPA_netcon).*(L1E_v(n,:)-p.L1E_L2E_iAMPA_EAMPA);
  L1I_L1E_iAMPA_IAMPA(n,:)=-p.L1I_L1E_iAMPA_gAMPA.*(L1I_L1E_iAMPA_s(n,:)*L1I_L1E_iAMPA_netcon).*(L1I_v(n,:)-p.L1I_L1E_iAMPA_EAMPA);
  L1I_L2I_iGABA_IGABA(n,:)=(p.L1I_L2I_iGABA_gGABA.*(L1I_L2I_iGABA_s(n,:)*L1I_L2I_iGABA_netcon).*(L1I_v(n,:)-p.L1I_L2I_iGABA_EGABA));
  L2E_Input1_iAMPA_IAMPA(n,:)=-p.L2E_Input1_iAMPA_gAMPA.*(L2E_Input1_iAMPA_s(n)*L2E_Input1_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_Input1_iAMPA_EAMPA);
  L2E_L1E_iAMPA_IAMPA(n,:)=-p.L2E_L1E_iAMPA_gAMPA.*(L2E_L1E_iAMPA_s(n,:)*L2E_L1E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L1E_iAMPA_EAMPA);
  L2E_L2I_iGABA_IGABA(n,:)=(p.L2E_L2I_iGABA_gGABA.*(L2E_L2I_iGABA_s(n,:)*L2E_L2I_iGABA_netcon).*(L2E_v(n,:)-p.L2E_L2I_iGABA_EGABA));
  L2E_L3E_iAMPA_IAMPA(n,:)=-p.L2E_L3E_iAMPA_gAMPA.*(L2E_L3E_iAMPA_s(n,:)*L2E_L3E_iAMPA_netcon).*(L2E_v(n,:)-p.L2E_L3E_iAMPA_EAMPA);
  L2I_Input2_iAMPA_IAMPA(n,:)=-p.L2I_Input2_iAMPA_gAMPA.*(L2I_Input2_iAMPA_s(n)*L2I_Input2_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_Input2_iAMPA_EAMPA);
  L2I_L1I_iGABA_IGABA(n,:)=(p.L2I_L1I_iGABA_gGABA.*(L2I_L1I_iGABA_s(n,:)*L2I_L1I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L1I_iGABA_EGABA));
  L2I_L2E_iAMPA_IAMPA(n,:)=-p.L2I_L2E_iAMPA_gAMPA.*(L2I_L2E_iAMPA_s(n,:)*L2I_L2E_iAMPA_netcon).*(L2I_v(n,:)-p.L2I_L2E_iAMPA_EAMPA);
  L2I_L3I_iGABA_IGABA(n,:)=(p.L2I_L3I_iGABA_gGABA.*(L2I_L3I_iGABA_s(n,:)*L2I_L3I_iGABA_netcon).*(L2I_v(n,:)-p.L2I_L3I_iGABA_EGABA));
  L3E_L2E_iAMPA_IAMPA(n,:)=-p.L3E_L2E_iAMPA_gAMPA.*(L3E_L2E_iAMPA_s(n,:)*L3E_L2E_iAMPA_netcon).*(L3E_v(n,:)-p.L3E_L2E_iAMPA_EAMPA);
  L3E_L3I_iGABA_IGABA(n,:)=(p.L3E_L3I_iGABA_gGABA.*(L3E_L3I_iGABA_s(n,:)*L3E_L3I_iGABA_netcon).*(L3E_v(n,:)-p.L3E_L3I_iGABA_EGABA));
  L3I_L2I_iGABA_IGABA(n,:)=(p.L3I_L2I_iGABA_gGABA.*(L3I_L2I_iGABA_s(n,:)*L3I_L2I_iGABA_netcon).*(L3I_v(n,:)-p.L3I_L2I_iGABA_EGABA));
  L3I_L3E_iAMPA_IAMPA(n,:)=-p.L3I_L3E_iAMPA_gAMPA.*(L3I_L3E_iAMPA_s(n,:)*L3I_L3E_iAMPA_netcon).*(L3I_v(n,:)-p.L3I_L3E_iAMPA_EAMPA);

    n=n+1;
  end
end

T=T(1:downsample_factor:ntime);

end
